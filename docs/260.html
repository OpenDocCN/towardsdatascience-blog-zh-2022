<html>
<head>
<title>How To Connect To A Snowflake Database With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Python连接到雪花数据库</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-connect-to-a-snowflake-database-with-python-a8f710c3afab#2022-01-10">https://towardsdatascience.com/how-to-connect-to-a-snowflake-database-with-python-a8f710c3afab#2022-01-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""><h1 id="ea34" class="pw-post-title ir is it bd iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp bi translated">如何用Python连接到雪花数据库</h1></div><div class=""><h2 id="6f3d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用雪花连接器或SQLAlchemy Python包与雪花进行交互，并利用本文中提供的模板。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/737cf61dc6cc20b7f239dc5b20bba861.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*exeeAvMQk9oXsSEngCGIDw.jpeg"/></div></div></figure><h2 id="5e53" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">建议的点播课程:</h2><p id="7e99" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated"><em class="mj">你是想通过成为</em> <strong class="ls iu"> <em class="mj">数据工程师</em> </strong> <em class="mj">还是</em> <strong class="ls iu"> <em class="mj">机器学习工程师</em> </strong> <em class="mj">来推进自己的职业生涯吗？我强烈建议您查看以下课程:</em></p><ul class=""><li id="17a4" class="mk ml it ls b lt mm lw mn ld mo lh mp ll mq mi mr ms mt mu bi translated"><a class="ae mv" href="https://imp.i115008.net/jWWEGv" rel="noopener ugc nofollow" target="_blank"> <strong class="ls iu">数据工程纳米学位</strong> </a> <strong class="ls iu"> → </strong> <em class="mj">精品课程！</em></li><li id="5550" class="mk ml it ls b lt mw lw mx ld my lh mz ll na mi mr ms mt mu bi translated"><a class="ae mv" href="https://imp.i115008.net/7mmA9d" rel="noopener ugc nofollow" target="_blank"> <strong class="ls iu">用Apache Kafka进行数据流&amp;Apache Spark nano degree</strong></a></li><li id="5632" class="mk ml it ls b lt mw lw mx ld my lh mz ll na mi mr ms mt mu bi translated"><a class="ae mv" href="https://platform.stratascratch.com/coding?via=antonello" rel="noopener ugc nofollow" target="_blank"> <strong class="ls iu"> <em class="mj"> Python高级编码问题(StrataScratch)</em></strong></a><strong class="ls iu"><em class="mj">→</em></strong><em class="mj">我找到的准备Python的最佳平台&amp; SQL编码面试到此为止！比LeetCode更好更便宜。</em></li></ul><p id="159f" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated"><strong class="ls iu"><em class="mj">&gt;&gt;&gt;</em></strong><em class="mj">还不是中等会员吗？考虑与我的</em> <a class="ae mv" href="https://anbento4.medium.com/membership" rel="noopener"> <strong class="ls iu"> <em class="mj">推荐链接</em> </strong> </a> <em class="mj">签约，以获得Medium必须提供的一切，费用低至每月5美元</em><strong class="ls iu"><em class="mj"/></strong><em class="mj">！</em></p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="d78e" class="nl kv it bd kw nm nn no kz np nq nr lc jz ns ka lg kc nt kd lk kf nu kg lo nv bi translated">介绍</h1><p id="19e5" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">我是在2017年第一次接触雪花的，当时我所在的公司决定从Redshift迁移到一个更具可扩展性的基于<em class="mj">计算的</em> claud数据仓库，以满足他们不断增长的分析需求并支持BI工具。</p><p id="d0a1" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">当时我是一名数据分析师，主要通过DBMS查询雪花。几年过去了，现在，作为一名数据工程师，我投入时间构建数据管道，通过Python自动地<em class="mj">连接</em>、<em class="mj">查询</em>、<em class="mj">插入</em>和<em class="mj">更新</em>数据到雪花中。<strong class="ls iu"> <em class="mj">你是不是很好奇想了解它是怎么做到的？</em>T71】</strong></p><blockquote class="nw"><p id="f9a9" class="nx ny it bd nz oa ob oc od oe of mi dk translated">一晃几年过去了，现在，作为一名数据工程师，我投入时间构建数据管道，通过Python自动<em class="og">连接</em>、<em class="og">查询</em>、<em class="og">插入</em>和<em class="og">更新</em>数据到雪花中。你很想知道这是怎么做到的吗？</p></blockquote><p id="5eda" class="pw-post-body-paragraph lq lr it ls b lt oh ju lv lw oi jx ly ld oj ma mb lh ok md me ll ol mg mh mi im bi translated">在本文中，您将学习如何通过Python与雪花数据库交互，或者使用<code class="fe om on oo op b">snowflake.connector</code>或者<code class="fe om on oo op b">sqlalchemy</code>包。</p><p id="8183" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">当通过Python启用对雪花的安全认证时，这两个包都支持许多技术，但是根据我的经验，两个最流行的选项是<code class="fe om on oo op b">externalBrowser</code>认证和<code class="fe om on oo op b">default</code>认证，因此我将在我的例子中使用它们。</p><p id="75c9" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">现在，让我们通过创建一些您可以在自己的项目中使用的有用的代码模板来一起探索这两种方法。</p><h1 id="a76c" class="nl kv it bd kw nm oq no kz np or nr lc jz os ka lg kc ot kd lk kf ou kg lo nv bi translated">方法1:使用雪花连接器连接</h1><p id="fcc7" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">使用<code class="fe om on oo op b">Snowflake Connector</code>的第一步是按照<a class="ae mv" href="https://docs.snowflake.com/en/user-guide/python-connector-install.html" rel="noopener ugc nofollow" target="_blank">官方文档</a>的建议下载软件包:</p><pre class="kj kk kl km gt ov op ow ox aw oy bi"><span id="1d2e" class="ku kv it op b gy oz pa l pb pc"><strong class="op iu">pip install snowflake-connector-python</strong></span><span id="e66e" class="ku kv it op b gy pd pa l pb pc">or </span><span id="6ff7" class="ku kv it op b gy pd pa l pb pc"><strong class="op iu">pip install snowflake-connector-python==&lt;version&gt;</strong></span></pre><p id="3965" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">然后，您需要在代码中导入它:</p><pre class="kj kk kl km gt ov op ow ox aw oy bi"><span id="dc9a" class="ku kv it op b gy oz pa l pb pc">import snowflake.connector</span></pre><h1 id="cb3b" class="nl kv it bd kw nm oq no kz np or nr lc jz os ka lg kc ot kd lk kf ou kg lo nv bi translated">外部浏览器认证</h1><p id="3ba7" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated"><code class="fe om on oo op b">snowflake.connector</code>包括一个<code class="fe om on oo op b">connect()</code>函数，该函数可以用作<a class="ae mv" href="https://docs.snowflake.com/en/user-guide/python-connector-api.html#connect" rel="noopener ugc nofollow" target="_blank">一个构造函数，用于创建到数据库</a>的连接。</p><p id="20c8" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">函数允许您指定多个参数，其中一些是建立连接所必需的，一些是可选的。</p><p id="c014" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">其中一个参数是<code class="fe om on oo op b">authenticator</code>。引用官方文档，如果您设置了<code class="fe om on oo op b">authenticator = 'externalbrowser'</code>，那么将使用以下方式尝试验证:</p><pre class="kj kk kl km gt ov op ow ox aw oy bi"><span id="a82e" class="ku kv it op b gy oz pa l pb pc">“<em class="mj">your web browser and </em><strong class="op iu"><em class="mj">Okta</em></strong><em class="mj">, </em><strong class="op iu"><em class="mj">ADFS</em></strong><em class="mj">, or any other SAML 2.0-compliant </em></span><span id="24f9" class="ku kv it op b gy pd pa l pb pc"><strong class="op iu"><em class="mj">identity provider</em></strong><em class="mj"> </em><strong class="op iu"><em class="mj">(IdP)</em></strong><em class="mj"> that has been defined for your account</em>”.</span></pre><p id="d9fe" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">例如，如果您的团队使用<em class="mj"> Okta </em>作为身份提供者，您将只需要指定<code class="fe om on oo op b">USER_EMAIL</code>而不需要传递用户<code class="fe om on oo op b">password</code>。这是一个您可以立即使用的模板，只需替换您的凭据即可:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div></figure><p id="f9a1" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated"><strong class="ls iu">优点:</strong><code class="fe om on oo op b">'externalbrowser'</code>认证允许您与您的<code class="fe om on oo op b">personal user</code>建立到SF的连接。它的灵活性使它成为您在本地测试新脚本时的首选连接选项<strong class="ls iu"/>，因为您不需要任何凭证<code class="fe om on oo op b">shared user</code> ( <em class="mj">这增加了您的自主权</em>)。</p><p id="3e31" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">CONS:每次你建立一个新的连接，你的浏览器就会自动打开一个新窗口，这有点烦人，但没什么大不了的…</p><p id="be77" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">当您运行上面的代码时，它返回一个<em class="mj">连接对象</em> <code class="fe om on oo op b">con_eb</code>，该对象又有一个名为<code class="fe om on oo op b">cursor()</code>的方法。在实际与SF交互之前，您还需要创建一个<em class="mj">光标对象</em> <code class="fe om on oo op b">con_eb.cursor()</code>，为了方便使用，它被保存在<code class="fe om on oo op b">db_cursor_eb</code>变量下。</p><h2 id="483c" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">示例#1:创建表格</h2><p id="ba78" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">在第一个例子中，我通过将SQL命令传递给游标对象<code class="fe om on oo op b">execute()</code>方法，在我的首选模式中创建了一个<code class="fe om on oo op b">TRANSACTIONS</code>表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div></figure><p id="74cc" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">命令一执行，您就可以通过运行<code class="fe om on oo op b">db_cursor_eb.fetchone()[0]</code>来验证它是否成功，在这种情况下会返回消息<code class="fe om on oo op b">Table TRANSACTIONS successfully created.</code></p><pre class="kj kk kl km gt ov op ow ox aw oy bi"><span id="529f" class="ku kv it op b gy oz pa l pb pc"><strong class="op iu">INFO: </strong>snowflake.connector.cursor:query: [CREATE OR REPLACE TABLE SCHEMA_NAME.TRANSACTIONS ( TR...]</span><span id="c677" class="ku kv it op b gy pd pa l pb pc"><strong class="op iu">INFO:</strong> snowflake.connector.cursor:query execution done</span><span id="2d5f" class="ku kv it op b gy pd pa l pb pc"><strong class="op iu">INFO:</strong> root:Table TRANSACTIONS successfully created.</span></pre><p id="6b1e" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">通常<code class="fe om on oo op b">fetchone()</code> <a class="ae mv" href="https://docs.snowflake.com/en/user-guide/python-connector-api.html#fetchone" rel="noopener ugc nofollow" target="_blank">检索查询结果集</a>的下一行，但是因为在这种情况下我只是创建一个空表，所以它只是返回执行状态。在生产中显示非常方便的信息！</p><h1 id="3b09" class="nl kv it bd kw nm oq no kz np or nr lc jz os ka lg kc ot kd lk kf ou kg lo nv bi translated">默认身份验证</h1><p id="2c0d" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">如果不指定<code class="fe om on oo op b">authenticator</code>参数，那么在底层，雪花将使用它的内部(默认)验证器。</p><p id="76a9" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">但是，在这种情况下，你需要通过角色<code class="fe om on oo op b">USER_NAME</code>和<code class="fe om on oo op b">PASSWORD</code>。这些应该是你个人的证件或者是某个<code class="fe om on oo op b">shared user</code>的证件。除了这两处小小的改动，该模板与上一个非常相似:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div></figure><p id="e7e0" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated"><strong class="ls iu">优点:</strong>这通常是生产中使用的连接方法，因为它不会通过您的浏览器触发嘈杂的身份验证，也不需要任何额外的身份检查。</p><p id="efce" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">CONS: 在建立连接之前，你需要请求分配一个角色和密码。但这是一点小小的代价，真的…</p><p id="f5c3" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">和以前一样，我创建了一个名为<code class="fe om on oo op b">db_cursor_def</code>的光标对象。</p><h2 id="59c4" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">示例2:插入到表格中</h2><p id="b4d6" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">我现在将使用<code class="fe om on oo op b">db_cursor_def.execute()</code>方法将数据插入到在第一个例子中创建的<code class="fe om on oo op b">TRANSACTIONS</code>表中。</p><p id="8f63" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">要插入的记录将从现有的<code class="fe om on oo op b">SOURCE_TABLE</code>中检索，并用<code class="fe om on oo op b">SELECT</code>命令查询:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div></figure><p id="9d57" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">注意，我将查询<code class="fe om on oo op b">LIMIT</code>设置为<code class="fe om on oo op b">1500</code>记录。</p><p id="9413" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">然后我调用了<em class="mj">游标对象</em> <code class="fe om on oo op b">rowcount</code>属性<a class="ae mv" href="https://docs.snowflake.com/en/user-guide/python-connector-api.html#rowcount" rel="noopener ugc nofollow" target="_blank">，该属性返回最后一次执行</a>所产生的行数，以检查这是否正是插入到<code class="fe om on oo op b">TRANSACTIONS</code>表中的行数:</p><pre class="kj kk kl km gt ov op ow ox aw oy bi"><span id="a3e9" class="ku kv it op b gy oz pa l pb pc"><strong class="op iu">INFO:</strong> snowflake.connector.cursor:query: [INSERT INTO SCHEMA_NAME.TRANSACTIONS (TRX_ID, SOURCE_...]</span><span id="d157" class="ku kv it op b gy pd pa l pb pc"><strong class="op iu">INFO: </strong>snowflake.connector.cursor:query execution done</span><span id="626e" class="ku kv it op b gy pd pa l pb pc"><strong class="op iu">INFO:</strong> root: Total rows inserted: 1500</span></pre><h1 id="f3b7" class="nl kv it bd kw nm oq no kz np or nr lc jz os ka lg kc ot kd lk kf ou kg lo nv bi translated">方法2:使用SQLAlchemy连接</h1><p id="1c1e" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">另一种连接和交互雪花的方法是使用<code class="fe om on oo op b">SQLAlchemy</code>。首先，您需要运行以下命令:</p><pre class="kj kk kl km gt ov op ow ox aw oy bi"><span id="7a33" class="ku kv it op b gy oz pa l pb pc">pip install --upgrade snowflake-sqlalchemy</span></pre><p id="2086" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">它将同时安装<code class="fe om on oo op b">snowflake.sqlalchemy</code>和<code class="fe om on oo op b">sqlalchemy</code>，以防还没有。</p><p id="d9e2" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">然后，您应该从<code class="fe om on oo op b">sqlalchemy</code>导入<code class="fe om on oo op b">create_engine</code>方法，从<code class="fe om on oo op b">snowflake.sqlalchemy</code>导入<code class="fe om on oo op b">URL</code>方法:</p><pre class="kj kk kl km gt ov op ow ox aw oy bi"><span id="8bc9" class="ku kv it op b gy oz pa l pb pc">from snowflake.sqlalchemy import URL<br/>from sqlalchemy import create_engine </span></pre><h1 id="ab00" class="nl kv it bd kw nm oq no kz np or nr lc jz os ka lg kc ot kd lk kf ou kg lo nv bi translated">外部浏览器认证</h1><p id="28c5" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">实际上，要建立与<code class="fe om on oo op b">sqlalchemy</code>的连接，您需要调用<code class="fe om on oo op b">create_engine</code>方法并传递一个<code class="fe om on oo op b"><a class="ae mv" href="https://docs.snowflake.com/en/user-guide/sqlalchemy.html#connection-string-examples" rel="noopener ugc nofollow" target="_blank">connection string</a></code>给它。</p><p id="8192" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">不过，<a class="ae mv" href="https://docs.snowflake.com/en/user-guide/sqlalchemy.html#connection-string-examples" rel="noopener ugc nofollow" target="_blank"><em class="mj">为了方便，可以使用</em> </a> <code class="fe om on oo op b"><a class="ae mv" href="https://docs.snowflake.com/en/user-guide/sqlalchemy.html#connection-string-examples" rel="noopener ugc nofollow" target="_blank">snowflake.sqlalchemy.URL</a></code> <a class="ae mv" href="https://docs.snowflake.com/en/user-guide/sqlalchemy.html#connection-string-examples" rel="noopener ugc nofollow" target="_blank"> <em class="mj">的方法构造连接字符串，连接到数据库</em></a>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div></figure><p id="073b" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">如您所见，为了连接到<code class="fe om on oo op b">externalbrowser</code>认证，您应该指定的参数与<code class="fe om on oo op b">snowflake.connector</code>完全相同。</p><p id="9a47" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">在执行查询之前，最好先创建一个连接对象:<code class="fe om on oo op b">engine_1_con = engine1.connect()</code>。然而，值得一提的是，甚至直接在<code class="fe om on oo op b">engine_1</code>上调用<code class="fe om on oo op b">execute()</code>方法也可以。</p><h2 id="eb8c" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">示例# 3:从表中选择+ FetchAll()</h2><p id="fe33" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">这个例子的目的是向您展示如何使用一个<code class="fe om on oo op b">SELECT</code>语句检索插入到<code class="fe om on oo op b">TRANSACTIONS</code>表中的整个数据集，使用<code class="fe om on oo op b">fetchall()</code>将数据集中的所有行提取到<code class="fe om on oo op b">data</code>并将第一列的内容保存到一个名为<code class="fe om on oo op b">trx_ids</code>的列表中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div></figure><p id="4f74" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">我想向您展示一个如何使用<code class="fe om on oo op b">fetchall()</code>的简单例子，因为在构建数据管道时，您可能会在代码中一次又一次地调用这个方法。</p><p id="bd6c" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">正如所料，检索到的查询<code class="fe om on oo op b">1500 rows</code>和我创建的列表中的前五个<code class="fe om on oo op b">trx_ids</code>显示如下:</p><pre class="kj kk kl km gt ov op ow ox aw oy bi"><span id="3a27" class="ku kv it op b gy oz pa l pb pc"><strong class="op iu">INFO:</strong> snowflake.connector.cursor:query: [SELECT * FROM SCHEMA_NAME.TRANSACTIONS;]</span><span id="e034" class="ku kv it op b gy pd pa l pb pc"><strong class="op iu">INFO</strong>: snowflake.connector.cursor:query execution done</span><span id="c2f5" class="ku kv it op b gy pd pa l pb pc"><strong class="op iu">INFO:</strong> root:Number of rows retrieved: 1500</span><span id="b60d" class="ku kv it op b gy pd pa l pb pc"><strong class="op iu">Output:</strong></span><span id="aeb7" class="ku kv it op b gy pd pa l pb pc">[3440508402, 482408596, 476831653, 3224085714, 3871714048]</span></pre><h1 id="b23d" class="nl kv it bd kw nm oq no kz np or nr lc jz os ka lg kc ot kd lk kf ou kg lo nv bi translated">默认身份验证</h1><p id="8aae" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">通过<code class="fe om on oo op b">default</code>认证连接到带有<code class="fe om on oo op b">sqlalchemy</code>的雪花使用与之前完全相同的语法，并且与<code class="fe om on oo op b">snowflake.connector</code>完全一样，您将需要用<code class="fe om on oo op b">USER_NAME</code>替换<code class="fe om on oo op b">USER_EMAIL</code>并指定一个<code class="fe om on oo op b">PASSWORD</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div></figure><h2 id="359e" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">示例# 4:从表格中选择+转换为熊猫DF</h2><p id="964c" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">在最后一个例子中，我将向您展示如何使用<code class="fe om on oo op b">sqlalchemy</code>引擎创建熊猫数据帧。</p><p id="9a50" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">这可以通过将<code class="fe om on oo op b">engine_2</code>和<code class="fe om on oo op b">sql</code>查询传递给pandas <code class="fe om on oo op b">read_sql()</code>函数来轻松实现:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/413a4d16c4d4c1d0418a3410547e533e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FGTW8yDiUJc_Rlrp_SMPmg.png"/></div></div></figure><p id="dc54" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">因此，如果你计划和熊猫一起工作，我会推荐你用<code class="fe om on oo op b">sqlalchemy</code>连接到<code class="fe om on oo op b">Snowflake</code>来利用这些内置的方法。</p><h1 id="3b9c" class="nl kv it bd kw nm oq no kz np or nr lc jz os ka lg kc ot kd lk kf ou kg lo nv bi translated">结论</h1><p id="24ce" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">在本文中，您已经了解了通过Python 使用不同类型的认证，有两种主要的方式<strong class="ls iu">来连接和交互雪花数据库。</strong></p><p id="c9ee" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly ld nb ma mb lh nc md me ll nd mg mh mi im bi translated">雪花在数据行业越来越受欢迎，因此我希望我上面分享的代码模板将有助于加快您作为数据分析师查询雪花、作为数据科学家创建训练数据集或作为数据工程师构建自动化ETL管道的日常任务。</p><h2 id="2f6f" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">来源</h2><div class="ph pi gp gr pj pk"><a href="https://docs.snowflake.com/en/user-guide/python-connector.html" rel="noopener  ugc nofollow" target="_blank"><div class="pl ab fo"><div class="pm ab pn cl cj po"><h2 class="bd iu gy z fp pp fr fs pq fu fw is bi translated">Python -雪花文档的雪花连接器</h2><div class="pr l"><h3 class="bd b gy z fp pp fr fs pq fu fw dk translated">Python的雪花连接器为开发Python应用程序提供了一个接口，该应用程序可以连接到…</h3></div><div class="ps l"><p class="bd b dl z fp pp fr fs pq fu fw dk translated">docs.snowflake.com</p></div></div></div></a></div><div class="ph pi gp gr pj pk"><a href="https://docs.snowflake.com/en/user-guide/python-connector-api.html" rel="noopener  ugc nofollow" target="_blank"><div class="pl ab fo"><div class="pm ab pn cl cj po"><h2 class="bd iu gy z fp pp fr fs pq fu fw is bi translated">Python连接器API -雪花文档</h2><div class="pr l"><h3 class="bd b gy z fp pp fr fs pq fu fw dk translated">字符串常量，表示接口预期的参数标记格式的类型。连接器支持…</h3></div><div class="ps l"><p class="bd b dl z fp pp fr fs pq fu fw dk translated">docs.snowflake.com</p></div></div></div></a></div><div class="ph pi gp gr pj pk"><a href="https://docs.snowflake.com/en/user-guide/sqlalchemy.html" rel="noopener  ugc nofollow" target="_blank"><div class="pl ab fo"><div class="pm ab pn cl cj po"><h2 class="bd iu gy z fp pp fr fs pq fu fw is bi translated">使用带有Python连接器的雪花SQLAlchemy工具包-雪花文档</h2><div class="pr l"><h3 class="bd b gy z fp pp fr fs pq fu fw dk translated">雪花SQLAlchemy运行在Python的雪花连接器之上，作为一种方言来桥接雪花数据库…</h3></div><div class="ps l"><p class="bd b dl z fp pp fr fs pq fu fw dk translated">docs.snowflake.com</p></div></div></div></a></div></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="8ab1" class="nl kv it bd kw nm nn no kz np nq nr lc jz ns ka lg kc nt kd lk kf nu kg lo nv bi translated">给我的读者一个提示</h1><p id="7fab" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated"><em class="mj">这篇文章包括附属链接，如果你购买的话，我可以免费给你一点佣金</em></p></div></div>    
</body>
</html>