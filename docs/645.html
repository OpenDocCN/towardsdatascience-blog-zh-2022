<html>
<head>
<title>How to work with JSON data in MySQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在MySQL中使用JSON数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-work-with-json-data-in-mysql-11672e4da7e9#2022-01-23">https://towardsdatascience.com/how-to-work-with-json-data-in-mysql-11672e4da7e9#2022-01-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""><h1 id="16f4" class="pw-post-title ir is it bd iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp bi translated">如何在MySQL中使用JSON数据</h1></div><div class=""><h2 id="4da6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在MySQL中学习“NoSQL”</h2></div><p id="fc64" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">MySQL支持原生的<a class="ae le" href="https://en.wikipedia.org/wiki/JSON" rel="noopener ugc nofollow" target="_blank"> JSON </a>数据类型，该数据类型支持JSON文档的自动验证、优化存储和访问。尽管JSON数据应该更好地存储在NoSQL数据库中，比如<a class="ae le" href="https://www.mongodb.com/nosql-explained" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>，但是您仍然会不时地遇到包含JSON数据的表。在本文的第一部分，我们将介绍如何用简单的语句从MySQL的JSON字段中提取数据。在第二部分，我们将介绍如何将MySQL表中的数据聚集到JSON数组或对象中，以便在您的应用程序中方便地使用。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/faca629b98c5c0f73d662ca617320018.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*C4XxyqiFrpvu5N4e.jpg"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">图片来自<a class="ae le" href="https://pixabay.com/photos/hand-business-technology-data-3044387/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>。</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="5ecb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要设置的系统类似于<a class="ae le" href="https://medium.com/codex/how-to-execute-plain-sql-queries-with-sqlalchemy-627a3741fdb1" rel="noopener">上一篇文章</a>中介绍的关于如何用Python执行SQL查询的系统。如果您已经根据该文章中的说明设置了系统，那么您可以继续下一部分。如果没有，您可以按照下面的简化说明来设置您的系统。有关命令和选项的详细解释，请参考<a class="ae le" href="https://medium.com/codex/how-to-execute-plain-sql-queries-with-sqlalchemy-627a3741fdb1" rel="noopener">上一篇文章</a>。</p><p id="dcd0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本质上，我们将在Docker容器中启动一个本地MySQL服务器:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="1804" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以直接在上面启动的控制台中执行SQL查询。或者，如果您更喜欢使用图形界面，您可以安装并使用<a class="ae le" href="https://dbeaver.io/" rel="noopener ugc nofollow" target="_blank"> DBeaver </a>，这是一个非常棒的图形数据库管理器，适用于所有类型的数据库。如果你一直在纠结MySQL workbench，那真的值得一试。关于如何安装和设置DBeaver的更多细节，本文有一个简短但有用的总结。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="1e05" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们首先探索一下可以用来从JSON字段中提取数据的常见MySQL函数和操作符。</p><p id="9884" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">MySQL中有两种主要类型的<a class="ae le" href="https://dev.mysql.com/doc/refman/8.0/en/json.html" rel="noopener ugc nofollow" target="_blank"> JSON值</a>:</p><ul class=""><li id="7604" class="me mf it kk b kl km ko kp kr mg kv mh kz mi ld mj mk ml mm bi translated">JSON数组—用逗号分隔并用方括号([])括起来的值列表。</li><li id="c613" class="me mf it kk b kl mn ko mo kr mp kv mq kz mr ld mj mk ml mm bi translated">JSON object——一个字典/hashmap/object(在不同的编程语言中名称是不同的),它有一组由逗号分隔的键值对，并包含在花括号({})中。</li></ul><p id="8b47" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">JSON数组和对象可以相互嵌套，我们将在后面看到。</p><p id="5174" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以使用<code class="fe ms mt mu mv b">JSON_EXTRACT</code>函数从JSON字段中提取数据。基本语法是:</p><pre class="lg lh li lj gt mw mv mx my aw mz bi"><span id="052b" class="na nb it mv b gy nc nd l ne nf"><strong class="mv iu">JSON_EXTRACT(json_doc, path)</strong></span></pre><p id="a35a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于JSON数组，路径用<code class="fe ms mt mu mv b">$[index]</code>指定，其中索引从0开始:</p><pre class="lg lh li lj gt mw mv mx my aw mz bi"><span id="bd20" class="na nb it mv b gy nc nd l ne nf">mysql&gt; <strong class="mv iu">SELECT JSON_EXTRACT('[10, 20, 30, 40]', '$[0]')</strong>;<br/>+------------------------------------------+<br/>| JSON_EXTRACT('[10, 20, 30, 40]', '$[0]') |<br/>+------------------------------------------+<br/>| 10                                       |<br/>+------------------------------------------+</span></pre><p id="22f2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于JSON对象，路径用<code class="fe ms mt mu mv b">$.key</code>指定，其中<code class="fe ms mt mu mv b">key</code>是对象的一个键。</p><pre class="lg lh li lj gt mw mv mx my aw mz bi"><span id="1c1b" class="na nb it mv b gy nc nd l ne nf">mysql&gt; <strong class="mv iu">SELECT JSON_EXTRACT('{"name": "John", "age": 30}', '$.name')</strong>;<br/>+-------------------------------------------------------+<br/>| JSON_EXTRACT('{"name": "John", "age": 30}', '$.name') |<br/>+-------------------------------------------------------+<br/>| "John"                                                |<br/>+-------------------------------------------------------+</span></pre><p id="99d3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果上面使用的<code class="fe ms mt mu mv b">JSON_EXTRACT</code>只有两个参数，我们可以使用<code class="fe ms mt mu mv b">-&gt;</code>操作符，它是<code class="fe ms mt mu mv b">JSON_EXTRACT</code>的别名。为了演示这个操作符的用法，我们需要一个带有JSON字段的表。请复制以下SQL查询，并在MySQL控制台或DBeaver中执行它们:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="905c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">特别是，MySQL使用<code class="fe ms mt mu mv b">utf8mb4</code>字符集和<code class="fe ms mt mu mv b">utf8mb4_bin</code>排序规则处理JSON上下文中使用的字符串。一个<a class="ae le" href="https://dev.mysql.com/doc/refman/8.0/en/charset-general.html" rel="noopener ugc nofollow" target="_blank">字符集</a>是一组符号和编码，一个校对是一组比较字符集中字符的规则。最好使用相应的字符集和排序规则创建带有JSON字段的表。</p><p id="04a0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为<code class="fe ms mt mu mv b">utf8mb4_bin</code>是二进制排序规则，所以键是区分大小写的，我们需要用正确的大小写来指定它们:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="e60d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们可以使用<code class="fe ms mt mu mv b">-&gt;</code>操作符从JSON字段中提取数据:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="4339" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如我们所见，<code class="fe ms mt mu mv b">-&gt;</code>只是<code class="fe ms mt mu mv b">JSON_EXTRACT</code>的一个快捷方式或别名。</p><p id="b96a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有趣的是，<code class="fe ms mt mu mv b">test_name</code>和<code class="fe ms mt mu mv b">test_id</code>的引号仍然存在。这不是我们想要的。我们希望引号被删除，类似于<code class="fe ms mt mu mv b">name</code>字段。</p><p id="1dfc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要删除提取值的引号，我们需要使用<code class="fe ms mt mu mv b">JSON_UNQUOTE</code>函数。由于<code class="fe ms mt mu mv b">JSON_UNQUOTE(JSON_EXTRACT(…))</code>如此常用，该组合也有一个快捷操作符，即<code class="fe ms mt mu mv b">-&gt;&gt;</code>。让我们在实践中看看:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="6fa5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">证明<code class="fe ms mt mu mv b">-&gt;&gt;</code>和<code class="fe ms mt mu mv b">JSON_UNQUOTE(JSON_EXTRACT(...))</code>结果相同。由于<code class="fe ms mt mu mv b">-&gt;&gt;</code>很少打字，所以在大多数情况下它是首选。</p><p id="32d5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是，如果想从嵌套的JSON数组或JSON对象中提取数据，就不能使用chained <code class="fe ms mt mu mv b">-&gt;</code>或<code class="fe ms mt mu mv b">-&gt;&gt;</code>。你只能使用<code class="fe ms mt mu mv b">-&gt;</code>和<code class="fe ms mt mu mv b">-&gt;&gt;</code>作为顶层，需要使用<code class="fe ms mt mu mv b">JSON_EXTRACT</code>作为嵌套层。让我们提取每个学生的分数:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="b4b1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">干杯！它像预期的那样工作。</p><p id="7747" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从MySQL的JSON字段中提取数据的关键要点:</p><ul class=""><li id="d5cc" class="me mf it kk b kl km ko kp kr mg kv mh kz mi ld mj mk ml mm bi translated">使用<code class="fe ms mt mu mv b">$.key</code>从JSON对象中提取键值。</li><li id="d5ee" class="me mf it kk b kl mn ko mo kr mp kv mq kz mr ld mj mk ml mm bi translated">使用<code class="fe ms mt mu mv b">$[index]</code>从JSON数组中提取元素的值。</li><li id="5d17" class="me mf it kk b kl mn ko mo kr mp kv mq kz mr ld mj mk ml mm bi translated">如果值不是字符串，使用<code class="fe ms mt mu mv b">-&gt;</code>作为<code class="fe ms mt mu mv b">JSON_EXTRACT</code>的快捷方式。</li><li id="1a3c" class="me mf it kk b kl mn ko mo kr mp kv mq kz mr ld mj mk ml mm bi translated">如果值是一个字符串，并且您想要删除提取的字符串的引号，使用<code class="fe ms mt mu mv b">-&gt;&gt;</code>作为<code class="fe ms mt mu mv b">JSON_UNQUOTE(JSON_EXTRACT(...))</code>的快捷方式。</li><li id="46e9" class="me mf it kk b kl mn ko mo kr mp kv mq kz mr ld mj mk ml mm bi translated">如果要从嵌套的JSON数组或JSON对象中提取数据，就不能使用链式<code class="fe ms mt mu mv b">-&gt;</code>或<code class="fe ms mt mu mv b">-&gt;&gt;</code>。您只能对顶层使用<code class="fe ms mt mu mv b">-&gt;</code>和<code class="fe ms mt mu mv b">-&gt;&gt;</code>，需要对嵌套层使用<code class="fe ms mt mu mv b">JSON_EXTRACT</code>。</li></ul><p id="44c2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在MySQL中有很多其他的<a class="ae le" href="https://dev.mysql.com/doc/refman/8.0/en/json-functions.html" rel="noopener ugc nofollow" target="_blank">函数</a>用于处理JSON数据。但是，如果您需要使用这些函数来验证/搜索您的JSON字段或对其执行CRUD操作，您应该认真考虑使用<a class="ae le" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>来存储JSON字段。MongoDB在处理非结构化数据(<a class="ae le" href="https://docs.mongodb.com/manual/core/document/" rel="noopener ugc nofollow" target="_blank">文档</a>)方面要专业和方便得多。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="68d0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面我们介绍了如何从MySQL的JSON字段中提取值。现在我们将学习相反的内容，并探索如何从MySQL表中选择JSON数据。为了继续这一部分，我们需要一些虚拟数据来玩。请复制以下SQL查询，并在MySQL控制台或DBeaver中运行它们:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="f613" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于该表，使用默认字符<a class="ae le" href="https://dev.mysql.com/doc/refman/8.0/en/charset-applications.html" rel="noopener ugc nofollow" target="_blank">和校对</a>。通过这两个查询，我们创建了一个存储从第一部分提取的数据的表。这是数据管道和分析的常见任务，即在数据清理之后执行一些数据分析。实际上，您可能希望将分数存储在一个单独的表中，这样这些表就更加<a class="ae le" href="https://en.wikipedia.org/wiki/Database_normalization" rel="noopener ugc nofollow" target="_blank">规范化</a>。然而，为了简化演示，这里将数据放在同一个表中。</p><p id="fd56" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们现在可以用<code class="fe ms mt mu mv b">JSON_ARRARYAGG</code>函数将数据聚集到一个JSON数组中:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="0e50" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以使用<code class="fe ms mt mu mv b">JSON_OBJECTAGG</code>函数将数据聚合到一个JSON对象中:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="9113" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，可以在您的应用程序中直接使用聚合的数据。<code class="fe ms mt mu mv b">JSON_ARRARYAGG</code>和<code class="fe ms mt mu mv b">JSON_OBJECTAGG</code>可以节省您在应用程序中聚集数据的努力，有时非常方便。例如，您可以使用<code class="fe ms mt mu mv b">json.loads()</code>方法将JSON字符串转换成Python中的数组或字典。</p><p id="e748" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果需要在Python中执行<code class="fe ms mt mu mv b">JSON_ARRARYAGG</code>和<code class="fe ms mt mu mv b">JSON_OBJECTAGG</code>的普通SQL查询，可以使用SQLAlchemy包，如本文<a class="ae le" href="https://medium.com/codex/how-to-execute-plain-sql-queries-with-sqlalchemy-627a3741fdb1" rel="noopener">中的</a>所示。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="9627" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们介绍了如何在MySQL中处理JSON数据。在第一部分中，通过简单的例子讨论了用于从JSON字段中提取数据的函数和操作符。在第二部分中，我们反其道而行之，将规范化数据聚合到JSON数组或对象中，然后可以直接在您的程序中使用。通常我们应该避免在MySQL中存储非结构化数据(文档)。但是，如果无法避免，本文中的知识应该对你的工作有所帮助。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="82d3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">相关文章:</p><ul class=""><li id="c853" class="me mf it kk b kl km ko kp kr mg kv mh kz mi ld mj mk ml mm bi translated"><a class="ae le" href="https://medium.com/codex/how-to-execute-plain-sql-queries-with-sqlalchemy-627a3741fdb1?source=your_stories_page----------------------------------------" rel="noopener">如何用Python中的SQLAlchemy执行普通SQL查询</a></li></ul></div></div>    
</body>
</html>