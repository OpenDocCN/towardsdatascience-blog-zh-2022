<html>
<head>
<title>How to Run Python Tests on Every Commit Using GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用GitHub动作在每次提交时运行Python测试</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/github-automated-testing-python-fdfe5aec9446#2022-01-10">https://towardsdatascience.com/github-automated-testing-python-fdfe5aec9446#2022-01-10</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""><h1 id="1f9c" class="pw-post-title is it iu bd iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq bi translated">如何使用GitHub动作在每次提交时运行Python测试</h1></div><div class=""><h2 id="4d70" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">自动化枯燥的工作，并通过CI管道确保代码质量</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/8fee9419bc867eb0d59123705a03f8f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YwZKIK_vKWZ7JUw-Ooh5NA.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">使用Github Actions工作流运行Python测试——照片由<a class="ae kz" href="https://www.pexels.com/@rethaferguson?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> RF提供。_.来自<a class="ae kz" href="https://www.pexels.com/photo/crop-laboratory-technician-examining-interaction-of-chemicals-in-practical-test-modern-lab-3825573/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">像素</a>的工作室</a></p></figure><p id="315c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">避免错误比修复错误更容易。</p><p id="a5a5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">测试是每个软件项目的关键组成部分。在几种不同类型的软件测试中，有些需要在每次提交时运行。例如，开发人员应该运行单元测试，以确保他们的新更改不会与之前的任何更改相矛盾。</p><p id="f2ef" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然而，每次手动操作都是一种负担。这是一项枯燥、重复但不可避免的任务。编写单元测试很有趣，但不是在每次提交时都运行它们。</p><p id="3659" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">大多数开发团队使用他们的持续集成(CI)管道来触发它们。因此，开发人员不必担心无法运行它们。Github Actions是一种(也许是非常流行的)这样的选项。</p><p id="77a5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这篇文章中，我将向您介绍我使用Github动作自动化Python测试的步骤。</p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/python-automl-sklearn-fd85d3b3c5e"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">让脚本找出优于您的ML模型</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">这个自动ML Python库让每个人都成为数据科学向导</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn kt lz"/></div></div></a></div><h1 id="a93d" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">Python测试如何在GitHub动作上工作</h1><p id="b8ea" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">GitHub Actions有一套预定义的工作流程，您可以即插即用。你也可以为流行的框架如<a class="ae kz" href="https://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> Django </a>找到一个。我建议从其中一个开始，除非你的项目结构是独一无二的。</p><p id="a155" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可以通过点击GitHub存储库页面上的Actions选项卡来访问它。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nl"><img src="../Images/da068e897c48b4423956828b4aadddd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DFatW7YFgsQQKUx3AwW1XQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">GitHub操作入门—作者截图。</p></figure><p id="d13e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这篇文章中，我将使用下面的示例Python程序和测试。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nm nn l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">运行Python测试来确认我们的斐波那契数生成函数是否正常工作。</p></figure><p id="e997" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们可以在本地计算机上用<code class="fe no np nq nr b">pytest app.py</code>运行上面的代码，其中app.py是模块的名称。运行它将导致如下所示的错误。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj ns"><img src="../Images/bdb69b1760485894f8c0702af93cd348.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*l8XhMrimfMvd_CSxMcqsww.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">斐波那契数生成函数测试失败—作者截图。</p></figure><p id="fafe" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，让我们在GitHub Actions上运行这个测试。执行以下操作，使项目成为git存储库，并将其推送到GitHub。</p><pre class="kk kl km kn gu nt nr nu nv aw nw bi"><span id="ddfe" class="nx mp iu nr b gz ny nz l oa ob"># Create a requirement file to install dependencies whenever GitHub Actions runs the tests.<br/>pip freeze &gt; requirement.txt</span><span id="426c" class="nx mp iu nr b gz oc nz l oa ob">git init<br/>git add .<br/>git commit -m 'initial commit'</span><span id="c6d0" class="nx mp iu nr b gz oc nz l oa ob"># Create a remote repository in github.com and do the following.<br/>git remote add origin &lt;Your Repository&gt;<br/>git branch -M main<br/>git push -u origin main</span></pre><p id="9d14" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您的远程存储库将包含两个文件；requirement.txt和app.py。转到操作选项卡并选择Python应用程序。</p><p id="0aca" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这将在中打开名为python-app.yml的新文件。github/工作流文件夹。您可以在这里配置事件、动作等。，以及它们的顺序。</p><p id="5c9b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">默认文件是预先配置的，每当我们将更改推送到主分支或发出拉请求时，它都会运行一组操作。它运行在Python 3.10的Ubuntu容器上。从requirement.txt文件安装完依赖项后，它执行<code class="fe no np nq nr b">pytest</code> shell命令。</p><p id="220e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请将最后一行从<code class="fe no np nq nr b">pytest</code>改为<code class="fe no np nq nr b">pytest app.py</code>，并点击右上角的开始提交按钮。</p><p id="882f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因为我们已经将它配置为在每次推送时运行，所以您不必手动触发任何操作。如果您现在转到Actions选项卡，您可以看到我们创建的新工作流已经开始执行测试。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj od"><img src="../Images/538840d18abd06bd463362e6a0f5209d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8kY3g9ATO-2EKXEk7T4V7w.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">GitHub Actions在提交时自动启动新的工作流——作者截图。</p></figure><p id="e7e0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">不出所料，一开始会失败。单击新的工作流运行，您可以看到它失败的原因。这与我们在本地运行它时出现的错误相同。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oe"><img src="../Images/148169c06b61acf803607ca783ece907.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fgZ4yLzdXQLR1hHqTowcHQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">显示工作流运行错误的GitHub操作—作者截图。</p></figure><p id="85d9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">每当新的变更没有通过测试，GitHub也会给你发一封邮件。如果你正在遵循这个指南，一定要检查你的GitHub账户的收件箱。</p><p id="ff46" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们尝试在本地编辑它，并推送通过所有测试的代码。将断言中的值从54更改为55，如下所示。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nm nn l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">修正的斐波那契数生成函数及其测试。</p></figure><p id="cb51" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在提交这些更改并将其推送到远程存储库。在“操作”选项卡上，您可以看到一个新的工作流正在运行。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj of"><img src="../Images/30dcbfb3880e405712bab42b6e985b2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e0dAEBbE7jLv0hGeCWhQXg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">当我们将新的变更推送到远程存储库时，Github动作会自动触发——作者截图。</p></figure><p id="99ef" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这一次你也可以检查我们所有的测试没有任何错误通过。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj og"><img src="../Images/8c787c43d6d52b11f47a29f64a81bfd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3PqqMbST9H_X9l50861TPg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">GitHub操作工作流运行中的所有测试通过—作者截图。</p></figure><h1 id="5fbc" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">在GitHub操作中使用环境变量。</h1><p id="a646" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">大多数<a class="ae kz" rel="noopener ugc nofollow" target="_blank" href="/python-project-structure-best-practices-d9d0b174ad5d"> python项目都包含环境变量。</a>这些是每个部署所特有的特定变量。这个文件通常不放在远程存储库中。</p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/python-project-structure-best-practices-d9d0b174ad5d"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">让您的Python项目结构更优雅的7种方法</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">以下是易于管理、可伸缩且易于理解的python项目结构的最佳实践。</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="oh l mk ml mm mi mn kt lz"/></div></div></a></div><p id="5b0f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">例如，您可以在. env文件中定义启动基于Python的web应用程序的端口。但是不需要将它提交给远程存储库，因为其他用户可能会使用不同的端口。</p><p id="3a86" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要为GitHub工作流指定环境变量，我们必须再次编辑YAML文件。在将操作系统设置成如下所示之后，让我们添加几行新代码。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nm nn l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">在GitHub操作配置YAML文件中指定环境变量。</p></figure><p id="6342" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们更新代码，从环境文件中读取输入变量。应该是这样的。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nm nn l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">从环境变量中读取值。</p></figure><p id="4f52" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们提交并看看测试是否通过了GitHub Actions工作流。</p><pre class="kk kl km kn gu nt nr nu nv aw nw bi"><span id="7804" class="nx mp iu nr b gz ny nz l oa ob">git commit -am "Read inputs from env variables"<br/>git push</span></pre><p id="1169" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您导航GitHub操作和相应的工作流运行，您现在可以看到测试通过。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj oi"><img src="../Images/2519b2fd68d3a8c58ad5c42627d05d8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*Z9l2Acx0P4_ReDLGj93AIA.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">测试功能从环境文件中读取输入并成功执行—作者截图。</p></figure><h1 id="02df" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">更改工作流运行的触发器</h1><p id="2914" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">每次有人向存储库提交变更时，都要执行一轮全面的测试，这可能有点过分。我们可能想把范围缩小到一个分支左右。</p><p id="b523" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们可以通过YAML文件完成这一工作和许多其他定制工作。在下面的例子中，我们配置为对dev分支的每个push和对main分支的每个pull请求运行测试。这也是大多数开发人员遵循的惯例。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nm nn l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">更改配置YAML文件中工作流的触发函数。</p></figure><p id="0949" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要了解更多关于自定义触发器的不同方法，请查阅<a class="ae kz" href="https://docs.github.com/en/actions/learn-github-actions/workflow-syntax-for-github-actions#on" rel="noopener ugc nofollow" target="_blank"> GitHub Actions的文档</a>。</p><h1 id="c1e9" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">安排测试</h1><p id="e527" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">按照时间表运行测试也很常见。对于某些团队来说，这可能是唯一的做法。其他人可能更喜欢在每次推送时与测试并行进行。</p><p id="01b3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们可以<a class="ae kz" href="https://docs.github.com/en/actions/learn-github-actions/events-that-trigger-workflows#scheduled-events" rel="noopener ugc nofollow" target="_blank">在Github Actions中安排工作流</a>在特定的例程上运行。如果你熟悉玉米工作，你可以在YAML的文件中应用同样的方法。</p><p id="18a7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这里有一个例子，它在每周日午夜运行我们的测试。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nm nn l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">在配置YAML文件中的GitHub动作中安排测试。</p></figure><h1 id="2bb1" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">最后的想法</h1><p id="f12a" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">CI管道是DevOps的革命性一步。在CI管道中执行测试避免了将错误引入系统的机会。</p><p id="5421" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们可以使用GitHub Actions作为一个完美的CI工作流。在这篇文章中，我们讨论了如何在将任何更改推送到存储库之前使用它来执行Python测试。</p><p id="9ed5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们还讨论了如何在cronjobs中调度工作流和定制事件触发器。我们可能必须非常具体地说明何时运行工作流。因为跑步是有代价的。</p><p id="341a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">GitHub Actions的<a class="ae kz" href="https://docs.github.com/en/billing/managing-billing-for-github-actions/about-billing-for-github-actions" rel="noopener ugc nofollow" target="_blank">基本使用是免费的，最多2000分钟</a>的系统时间。即使你的库是私有的，它也适用。但是超过这个限度，你就需要他们的一个付费计划。然而，如果这个库是一个公共库或者如果你使用你的私有库，它是完全免费的。</p></div><div class="ab cl oj ok hy ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="in io ip iq ir"><blockquote class="oq or os"><p id="7914" class="la lb ot lc b ld le jv lf lg lh jy li ou lk ll lm ov lo lp lq ow ls lt lu lv in bi translated">感谢阅读，朋友！在<a class="ae kz" href="https://www.linkedin.com/in/thuwarakesh/" rel="noopener ugc nofollow" target="_blank"><strong class="lc iv">LinkedIn</strong></a><a class="ae kz" href="https://twitter.com/Thuwarakesh" rel="noopener ugc nofollow" target="_blank"><strong class="lc iv">Twitter</strong></a><a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener"><strong class="lc iv">Medium</strong></a>上跟我打招呼。</p><p id="4b7c" class="la lb ot lc b ld le jv lf lg lh jy li ou lk ll lm ov lo lp lq ow ls lt lu lv in bi translated">还不是中等会员？请使用此链接<a class="ae kz" href="https://thuwarakesh.medium.com/membership" rel="noopener"> <strong class="lc iv">成为会员</strong> </a>因为，不需要你额外付费，我为你引荐赚取一小笔佣金。</p></blockquote></div></div>    
</body>
</html>