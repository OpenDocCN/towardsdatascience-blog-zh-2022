<html>
<head>
<title>Multiple Comparison: A Common Pitfall for A/B Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">多重比较:A/B测试的常见陷阱</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/multiple-comparison-a-common-pitfall-for-a-b-testing-d773f19a4a95#2022-01-21">https://towardsdatascience.com/multiple-comparison-a-common-pitfall-for-a-b-testing-d773f19a4a95#2022-01-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="317e" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><strong class="ak">实验和因果推断</strong></h2><div class=""><h1 id="007b" class="pw-post-title jb jc it bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy bi translated"><strong class="ak">多重比较:A/B测试的常见陷阱</strong></h1></div><div class=""><h2 id="d896" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">数据科学家很酷！</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/525b86a624c02576225ce62ecf4c7596.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EnLfRdyx3FngTqkzZs1gpw.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">埃里克·普劳泽特在<a class="ae lh" href="https://unsplash.com/s/photos/multiple?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="li lj l"/></div></figure><h1 id="5bf6" class="lk ll it bd lm ln lo lp lq lr ls lt lu ki lv kj lw kl lx km ly ko lz kp ma mb bi translated"><strong class="ak">简介</strong></h1><p id="3dee" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk ml mm mn mo mp mq mr ms mt mu mv mw mx im bi translated">科技行业最近的一个趋势是，公司越来越多地诉诸科学方法来指导决策。特别是，他们对产品发布和创新采取严格的测试策略。潜在的想法是:</p><blockquote class="my"><p id="f7f5" class="mz na it bd nb nc nd ne nf ng nh mx dk translated">每当有疑问时，A/B就测试它。</p></blockquote><p id="8a83" class="pw-post-body-paragraph mc md it me b mf ni kd mh mi nj kg mk ml nk mn mo mp nl mr ms mt nm mv mw mx im bi translated">为了满足大规模测试需求，科技公司建立了需要卓越工程技术的内部实验平台。例如，<a class="ae lh" href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/36500.pdf" rel="noopener ugc nofollow" target="_blank"> Google </a>构建了一个重叠测试基础设施，支持数百甚至数千个并发实验。微软开发了一个自动触发系统，如果有任何事情出错，它会提醒实验所有者。<a class="ae lh" href="https://medium.com/airbnb-engineering/how-airbnb-achieved-metric-consistency-at-scale-f23cc53dea70" rel="noopener"> Airbnb </a>创建了一个指标存储库，其中包含数以千计的指标，可以轻松提取并进行实时监控。</p><p id="aa47" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">这些例子表明，我们需要一个强大的工程团队来构建和维护所有这些基础设施，这给人留下了一个错误的印象，即实验可以仅由平台工程师和数据工程师完成，而无需数据科学家的帮助。令我惊讶的是，这是业内相当普遍的误解。</p><p id="1d5e" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">在这篇博文中，我们通过一个典型的实验设置，看看如果团队中没有合格的数据科学家或统计学家，事情会变得多么糟糕。</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="4321" class="lk ll it bd lm ln nz lp lq lr oa lt lu ki ob kj lw kl oc km ly ko od kp ma mb bi translated"><strong class="ak">为什么要进行假设检验？</strong></h1><p id="6a93" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk ml mm mn mo mp mq mr ms mt mu mv mw mx im bi translated">在我们正式开始之前，让我们试着回答这个问题:</p><blockquote class="oe of og"><p id="89c1" class="mc md oh me b mf nn kd mh mi no kg mk oi np mn mo oj nq mr ms ok nr mv mw mx im bi translated">为什么我们需要假设检验？</p></blockquote><p id="ad95" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">在线实验的核心思想是从有限的样本中推断总体参数。我们对样本数据进行统计测试，并决定治疗组和对照组之间的差异是实际改善还是仅仅由于随机性。</p><p id="e97a" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">在任何测试场景下，都不可能完全消除不确定因素。没有100%的把握，因为随机性带来的意外因素总是存在的。相反，我们可以通过赋值来量化不确定性的水平，这就是为什么统计学家创造了阿尔法水平(又名。假阳性率)。</p><p id="3260" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">对于任何实验平台来说，准确评估FPR的水平至关重要。太高的FPR使平台无用，因为它总是发射错误的信号，我们不知道什么时候是真信号，什么时候是假信号。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ol"><img src="../Images/a480c96a15d0da98ea36b22805c2bc6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VeWuvKYd_E7OZ5TUlrxKYA.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://unsplash.com/@mullyadii?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">穆利亚迪</a>在<a class="ae lh" href="https://unsplash.com/s/photos/many?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="dc39" class="lk ll it bd lm ln lo lp lq lr ls lt lu ki lv kj lw kl lx km ly ko lz kp ma mb bi translated"><strong class="ak">为什么多重测试是个问题</strong></h1><p id="6553" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk ml mm mn mo mp mq mr ms mt mu mv mw mx im bi translated">这是一个典型的A/B测试用例:产品经理希望了解一个新功能将如何影响整体评估标准(例如，保留)和用户参与度的多个方面，包括购物车添加率、平均会话持续时间、每日活跃用户数、回头客数量和客户满意度得分。此外，她关注网站性能，选择跳出率、会话崩溃率、网站加载时间、功耗指标和收入作为护栏指标。实验中共有10个指标。</p><p id="27d8" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">实验小组建立了一个实验。3周后，她收集了足够的数据，并对新产品充满信心，因为结果返回了几个小P值。那么，让我们推出新功能。</p><blockquote class="oe of og"><p id="9597" class="mc md oh me b mf nn kd mh mi no kg mk oi np mn mo oj nq mr ms ok nr mv mw mx im bi translated">有问题吗？</p></blockquote><p id="fa07" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">是的，膨胀的FPR有一个大问题。具体来说，在多重假设检验中观察到至少一个假阳性的概率，家族误差率(FWER)显著增加。</p><p id="1724" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">下面是一个粗略的计算:将alpha级别设置为5%。</p><ol class=""><li id="7776" class="om on it me b mf nn mi no ml oo mp op mt oq mx or os ot ou bi translated"><em class="oh">单次检测的假阳性率:0.05 </em></li><li id="6eef" class="om on it me b mf ov mi ow ml ox mp oy mt oz mx or os ot ou bi translated"><em class="oh">单次测试第一类错误不落的概率:1 — 0.05 </em></li><li id="5979" class="om on it me b mf ov mi ow ml ox mp oy mt oz mx or os ot ou bi translated"><em class="oh">10次测试中第一类错误的不落概率:(1 — 0.05) ⁰ </em></li><li id="f671" class="om on it me b mf ov mi ow ml ox mp oy mt oz mx or os ot ou bi translated"><em class="oh">10次测试至少犯一次1型错误的概率:1 — (1 — 0.05) ⁰ =0.40，或40%。</em></li></ol><p id="ae99" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">上述过程表明，我们至少会在40%的时间里观察到一个假阳性，即使没有实际差异。</p><p id="662e" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">作为第一个旁注，对5%的alpha水平的正确解释是，如果我们重复重新运行实验，我们会错误地拒绝5%的无效假设，即使没有差异。</p><p id="447e" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">第二点要注意的是，A/A测试是一项实验，我们对两组患者进行相同的治疗条件。据估计，任何单个A/A测试的FPR应接近标称alpha水平(如5%)，多个A/A测试的p值的最终分布应遵循均匀分布。如果你想了解更多关于A/A测试和它们潜在的重要性，看看这篇文章。</p><p id="31fb" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">到目前为止，你可能同意没有适当的统计调整的多重假设检验会增加FWER，这总是发出错误的信号。</p><p id="1fc8" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">在下一节中，我们将深入研究三种流行的统计调整。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pa"><img src="../Images/da6348cec0ca27489925f50dc37fd9d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kK7k4hKH8xaXKeVYlt4Fow.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">本·哈里特在<a class="ae lh" href="https://unsplash.com/s/photos/many?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h2 id="a642" class="pb ll it bd lm pc pd dn lq pe pf dp lu ml pg ph lw mp pi pj ly mt pk pl ma iz bi translated"><strong class="ak">解决方案1: Bonferroni校正</strong></h2><p id="513e" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk ml mm mn mo mp mq mr ms mt mu mv mw mx im bi translated">让我们从最简单的Bonferroni校正(BC)开始。BC方法将α水平除以比较次数，即<em class="oh"> α/n. </em>如果我们将α/n乘以比较次数n，BC方法将FWER保持在α。</p><p id="8a09" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">在我们的示例中，我们对10个指标进行了多次比较。默认情况下，我们选择0.05作为单独的alpha级别。使用BC方法，我们将0.05除以比较次数:0.05/10 = 0.005。如果我们想要得到任何有统计学意义的结果，相应的p值必须小于0.005。</p><p id="fa02" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">正如所见，我们已经将拒绝标准从0.05降低到0.005，使得拒绝零假设变得更加困难。这种方法经常被批评为过于保守和缺乏统计能力。BC方法以假阴性为代价降低了假阳性。</p><p id="f055" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">当然，这种方法有几个优点。例如，它是通用的，适用于所使用的任何检验统计量，与p值无关，或H0的性质(<a class="ae lh" href="https://web.stanford.edu/~hastie/ISLRv2_website.pdf" rel="noopener ugc nofollow" target="_blank"> James等人2021，统计学习介绍</a>)。</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h2 id="c160" class="pb ll it bd lm pc pd dn lq pe pf dp lu ml pg ph lw mp pi pj ly mt pk pl ma iz bi translated"><strong class="ak">解决方案2:霍尔姆-邦费罗尼</strong></h2><p id="2d71" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk ml mm mn mo mp mq mr ms mt mu mv mw mx im bi translated">由于其保守性，BC方法在实践中很少使用，统计学家已经提出了一种改进的版本，称为<strong class="me jd"> Holm-Bonferroni方法。</strong>它也控制FWER，但通过对p值进行排序并调整每个无效假设的拒绝标准。这两种方法的最大区别在于，与BC方法不同，H-B程序的拒绝阈值取决于所有p值。</p><p id="f20d" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">就能力而言，H-B比Bonferroni方法更加强大:它拒绝的无效假设至少与BC一样多。如果你使用Bonferroni，考虑转换到Holm的程序，因为它总是优于。</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h2 id="4c21" class="pb ll it bd lm pc pd dn lq pe pf dp lu ml pg ph lw mp pi pj ly mt pk pl ma iz bi translated"><strong class="ak">方案三:本杰明-霍赫伯格</strong></h2><p id="030a" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk ml mm mn mo mp mq mr ms mt mu mv mw mx im bi translated">与控制FWER的Bonferroni家族不同，Yoav Benjamini和Yosef Hochberg提出了一种称为Benjamini-Hochberg程序的新方法，该方法控制<strong class="me jd">错误发现率(FDR) </strong>，该错误发现率被定义为所有发现(显著结果)中错误阳性的比例。比如你做了100个有意义的结果，其中5个是错误发现(或者错误拒绝)；罗斯福是5%。</p><p id="97be" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">这里有一个FDR和FWER的简单比较:</p><blockquote class="oe of og"><p id="18f4" class="mc md oh me b mf nn kd mh mi no kg mk oi np mn mo oj nq mr ms ok nr mv mw mx im bi translated">FWER:测试中至少有一个或多个假阳性的概率。</p><p id="4a0a" class="mc md oh me b mf nn kd mh mi no kg mk oi np mn mo oj nq mr ms ok nr mv mw mx im bi translated">FDR:错误发现占发现总数的百分比。</p></blockquote><p id="e080" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">在生产中，FDR提供了比FWER更直观的解释。错误发现在整个发现中所占的比例，这对业务人员来说有直观的意义。</p><p id="a2e6" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">相比之下，Benjamini-Hochberg在假阳性率附近提供了较弱的保证，但是比BC显著降低了假阴性率。Benjamini-Hochberg在生产中的I型和II型误差之间提供了一个更好的折衷。</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><p id="87e2" class="pw-post-body-paragraph mc md it me b mf nn kd mh mi no kg mk ml np mn mo mp nq mr ms mt nr mv mw mx im bi translated">Medium最近推出了作家伙伴计划，支持像我这样的普通作家。如果你还不是订户，通过下面的链接注册，我会收到一部分会员费。</p><div class="pm pn gp gr po pp"><a href="https://leihua-ye.medium.com/membership" rel="noopener follow" target="_blank"><div class="pq ab fo"><div class="pr ab ps cl cj pt"><h2 class="bd jd gy z fp pu fr fs pv fu fw jc bi translated">阅读叶雷华博士研究员(以及其他成千上万的媒体作家)的每一个故事</h2><div class="pw l"><h3 class="bd b gy z fp pu fr fs pv fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="px l"><p class="bd b dl z fp pu fr fs pv fu fw dk translated">leihua-ye.medium.com</p></div></div><div class="py l"><div class="pz l qa qb qc py qd lb pp"/></div></div></a></div></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="c322" class="lk ll it bd lm ln nz lp lq lr oa lt lu ki ob kj lw kl oc km ly ko od kp ma mb bi translated"><strong class="ak">外卖</strong></h1><ul class=""><li id="0b3a" class="om on it me b mf mg mi mj ml qe mp qf mt qg mx qh os ot ou bi translated">由于假设检验的随机性，我们希望考虑抽样方差，并评估出现这种极端数据分布的概率。</li><li id="bb7b" class="om on it me b mf ov mi ow ml ox mp oy mt oz mx qh os ot ou bi translated">一种常见的方法是使用假阳性率。</li><li id="d950" class="om on it me b mf ov mi ow ml ox mp oy mt oz mx qh os ot ou bi translated">然而，没有适当调整的多重比较会增加累积的α水平，使A/B测试变得无用。</li><li id="186a" class="om on it me b mf ov mi ow ml ox mp oy mt oz mx qh os ot ou bi translated">这篇文章认为Benjamini-Hochberg方法是平衡假阳性和假阴性的“最佳”方法。</li><li id="e74a" class="om on it me b mf ov mi ow ml ox mp oy mt oz mx qh os ot ou bi translated">这并不意味着Benjamini-Hochberg程序是一个适合所有情况的解决方案。您可能需要选择另一种适合您特定需求的校正方法。</li><li id="96d5" class="om on it me b mf ov mi ow ml ox mp oy mt oz mx qh os ot ou bi translated">最后，数据科学家超级酷。</li></ul></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="c759" class="lk ll it bd lm ln nz lp lq lr oa lt lu ki ob kj lw kl oc km ly ko od kp ma mb bi translated">喜欢读这本书吗？</h1><blockquote class="oe of og"><p id="99b8" class="mc md oh me b mf nn kd mh mi no kg mk oi np mn mo oj nq mr ms ok nr mv mw mx im bi translated">请在<a class="ae lh" href="https://www.linkedin.com/in/leihuaye/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae lh" href="https://www.youtube.com/channel/UCBBu2nqs6iZPyNSgMjXUGPg" rel="noopener ugc nofollow" target="_blank"> YouTube </a>上找到我。</p><p id="6f12" class="mc md oh me b mf nn kd mh mi no kg mk oi np mn mo oj nq mr ms ok nr mv mw mx im bi translated">还有，看看我其他关于人工智能和机器学习的帖子。</p></blockquote></div></div>    
</body>
</html>