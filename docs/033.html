<html>
<head>
<title>Transcribe large audio files offline with Vosk</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Vosk离线转录大型音频文件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/transcribe-large-audio-files-offline-with-vosk-a77ee8f7aa28#2022-01-03">https://towardsdatascience.com/transcribe-large-audio-files-offline-with-vosk-a77ee8f7aa28#2022-01-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""><h1 id="8eaa" class="pw-post-title ir is it bd iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp bi translated">使用Vosk离线转录大型音频文件</h1></div><div class=""><h2 id="8024" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为您的下一个NLP项目转录大型音频文件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c82e3e6998783d386ead99fba4a8bf69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r8PAUhvYzhk6USzhF1n5HA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">乔纳森·贝拉斯克斯在<a class="ae ky" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="8110" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di">我</span>受分析reddit数据的自然语言处理(NLP)项目的启发，我想到了使用播客数据的想法。然而，由于播客是(大)音频文件，人们需要先将它们转录成文本。这个过程也被称为<strong class="lb iu"> A </strong>自动<strong class="lb iu">S</strong>peech<strong class="lb iu">R</strong>ecognition(ASR)或<strong class="lb iu">S</strong>peech-<strong class="lb iu">t</strong>o-<strong class="lb iu">t</strong>ext(STT)。</p><p id="5e3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Google、Azure或AWS等提供商提供了出色的API来完成这项任务。<strong class="lb iu">但是，如果您想要离线转录，或者出于某种原因，您不被允许使用云解决方案，该怎么办？</strong></p><h2 id="0929" class="me mf it bd mg mh mi dn mj mk ml dp mm li mn mo mp lm mq mr ms lq mt mu mv mw bi translated">TL；博士；医生</h2><ul class=""><li id="54b8" class="mx my it lb b lc mz lf na li nb lm nc lq nd lu ne nf ng nh bi translated">Vosk是一个允许你离线转录音频文件的工具包</li><li id="8fed" class="mx my it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">它支持20多种语言和方言</li><li id="a036" class="mx my it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">音频必须首先转换为波形格式(单声道，16Hz)</li><li id="e7bc" class="mx my it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">大型音频文件的转录可以通过使用缓冲来完成</li><li id="ab46" class="mx my it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">Colab笔记本可以在<a class="ae ky" href="https://github.com/darinkist/medium_article_vosk/blob/main/Transcribe_large_audio_files_offline_with_Vosk.ipynb" rel="noopener ugc nofollow" target="_blank">这里找到</a></li></ul><h1 id="d252" class="nn mf it bd mg no np nq mj nr ns nt mm jz nu ka mp kc nv kd ms kf nw kg mv nx bi translated">目标</h1><p id="0c3f" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">这就是为什么我写这篇文章来给你一个备选方案以及如何使用它们的概述。</p><p id="0856" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个想法是使用提供<strong class="lb iu">预训练模型</strong>的包或工具包，这样我们就不必先自己训练模型。</p><p id="07c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我将重点介绍Vosk。还有很多类似于Moziall的DeepSpeech或SpeechRecognition的软件包。然而，DeepSpeech的未来是不确定的，SpeechRecognition除了在线API之外，还包括使用Vosk的CMUSphinx。</p><p id="011c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我假设我们要转录的数据在youtube 上<strong class="lb iu">不可用。如果有，我强烈推荐去看看<code class="fe ob oc od oe b"><a class="ae ky" href="https://pypi.org/project/youtube-transcript-api/" rel="noopener ugc nofollow" target="_blank">youtube-transcript-api</a></code>套餐。它允许你为一个给定的视频获得生成的脚本，这比我们在下面要做的要少得多。</strong></p><h1 id="35b9" class="nn mf it bd mg no np nq mj nr ns nt mm jz nu ka mp kc nv kd ms kf nw kg mv nx bi translated">先决条件:以正确的格式输入数据</h1><p id="e32c" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">在我们进入转录部分之前，我们必须首先将数据转换成正确的格式。播客或其他(长)音频文件通常是mp3格式。然而，这不是包或工具包可以使用的格式。</p><p id="1f8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更具体地说，我们需要将我们的(mp3)音频转换为:</p><ul class=""><li id="7e14" class="mx my it lb b lc ld lf lg li of lm og lq oh lu ne nf ng nh bi translated">波形格式(。wav)</li><li id="b7a2" class="mx my it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">单声道的</li><li id="bc6b" class="mx my it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">16，000赫兹采样速率</li></ul><p id="a453" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转换非常简单。首先我们必须安装<code class="fe ob oc od oe b">ffmpeg</code>，它可以在<a class="ae ky" href="https://ffmpeg.org/download.html" rel="noopener ugc nofollow" target="_blank">https://ffmpeg.org/download.html</a>下找到。</p><p id="b156" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Mac用户可以使用brew下载并安装它:</p><pre class="kj kk kl km gt oi oe oj ok aw ol bi"><span id="8571" class="me mf it oe b gy om on l oo op">brew install ffmpeg</span></pre><p id="e7d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来我们安装<code class="fe ob oc od oe b">pydub</code>包:</p><pre class="kj kk kl km gt oi oe oj ok aw ol bi"><span id="d9c3" class="me mf it oe b gy om on l oo op">pip install pydub</span></pre><p id="937f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码片段将mp3转换成所需的wav格式。它将输出存储在与给定mp3输入文件相同的目录中，并返回其路径。如果我们想跳过几秒钟(例如介绍)，我们可以通过设置我们想跳过的秒数来使用skip参数。如果我们想先尝试一下，我们可以将<em class="oq">摘录</em>参数设置为<em class="oq">真</em>以仅获取音频文件的前30秒<strong class="lb iu"> </strong>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="2917" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这个功能，我们现在可以将我们的播客文件转换成所需的<em class="oq"> wav </em>格式。</p><p id="82ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了有一个(互动)的例子，我选择转录以下播客插曲:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ot os l"/></div></figure><blockquote class="ou ov ow"><p id="6128" class="kz la oq lb b lc ld ju le lf lg jx lh ox lj lk ll oy ln lo lp oz lr ls lt lu im bi translated">请注意:播客是随机选择的。我与创造者没有任何联系，也没有因为说出他们的名字而获得报酬。</p></blockquote><p id="2185" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于前37秒是介绍，我们可以使用skip参数跳过它们。</p><p id="a949" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于第一个例子，我们也将参数摘录设置为<em class="oq">真</em>:</p><pre class="kj kk kl km gt oi oe oj ok aw ol bi"><span id="2815" class="me mf it oe b gy om on l oo op">mp3_to_wav('opto_sessions_ep_69.mp3', 37, True)</span></pre><p id="6b06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的新文件<em class="oq">opto _ sessions _ EP _ 69 _ extract . wav</em>现在有30秒长，从0:37到1:07开始。</p><p id="bd3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以开始转录了！</p><h1 id="29ae" class="nn mf it bd mg no np nq mj nr ns nt mm jz nu ka mp kc nv kd ms kf nw kg mv nx bi translated">沃斯克</h1><p id="08b7" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">Vosk是一个支持20多种语言(如英语、德语、印度语等)的语音识别工具包。)和方言。它可以离线工作，甚至可以在树莓Pi这样的轻量级设备上工作。</p><p id="778c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它的便携式型号每个只有50Mb。然而，还有更大的型号。所有可用型号的列表可以在这里找到:<a class="ae ky" href="https://alphacephei.com/vosk/models" rel="noopener ugc nofollow" target="_blank">https://alphacephei.com/vosk/models</a></p><p id="60c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">拨打以下电话即可轻松安装Vosk:</p><pre class="kj kk kl km gt oi oe oj ok aw ol bi"><span id="727a" class="me mf it oe b gy om on l oo op">pip install vosk</span></pre><p id="72c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装了Vosk之后，我们必须下载一个预先训练好的模型。我决定选择最大的一个:<code class="fe ob oc od oe b">vosk-model-en-us-0.22</code></p><p id="5640" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经拥有了我们需要的一切，让我们打开我们的wave文件并加载我们的模型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="72d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们深入研究转录过程之前，我们必须熟悉一下VOSKs的输出。</p><p id="ee1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">VOSK返回JSON格式的转录，如下所示:</p><pre class="kj kk kl km gt oi oe oj ok aw ol bi"><span id="b754" class="me mf it oe b gy om on l oo op">{<br/>    "text" : "cats are dangerous"<br/>}</span></pre><p id="70e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们也想知道VOSK对每个单词有多自信，并且想知道每个单词的时间，我们可以使用<code class="fe ob oc od oe b">SetWords(True)</code>。例如，一个单词的结果如下所示:</p><pre class="kj kk kl km gt oi oe oj ok aw ol bi"><span id="5014" class="me mf it oe b gy om on l oo op">{<br/>   "result":[<br/>      {<br/>         "conf":0.953349,<br/>         "end":6.090000,<br/>         "start":5.700000,<br/>         "word":"cats"<br/>      },<br/>      {<br/>         etc.<br/>      },<br/>      etc.<br/>   ],<br/>   "text":"cats are dangerous"<br/>}</span></pre><p id="0f5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们想要转录大的音频文件，所以通过逐块转录wave文件来使用缓冲方法是有意义的。以下代码显示了转录方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="fa5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们读入前4000帧(第7行)并将它们交给我们加载的模型(第12行)。该模型返回(以JSON格式)结果，该结果作为dict存储在<em class="oq"> result_dict </em>中。然后，我们只提取文本值，并将其附加到我们的转录列表中(第14行)。</p><p id="3051" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果没有更多的帧要读取(第8行)，循环停止，我们通过调用<em class="oq"> FinalResult() </em>方法来捕捉最终结果。此方法还会刷新整个管道。</p><p id="9f7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果应该是这样的:</p><pre class="kj kk kl km gt oi oe oj ok aw ol bi"><span id="69bb" class="me mf it oe b gy om on l oo op">to success on today show i'm delighted to introduce beth kinda like a technology analyst with over a decade of experience in the private markets she's now the cofounder of io fund which specializes in helping individuals gain a competitive advantage when investing in tech growth stocks how does beth do this well she's gained hands on experience over the years was i were working for or analyzing a huge amount of relevant tech companies in silicon valley the involved in the market</span></pre><blockquote class="ou ov ow"><p id="fda2" class="kz la oq lb b lc ld ju le lf lg jx lh ox lj lk ll oy ln lo lp oz lr ls lt lu im bi translated">注意:如果你对更“时尚”的解决方案感兴趣(使用进度条)，你可以在这里找到我的代码<a class="ae ky" href="https://github.com/darinkist/medium_article_vosk/blob/main/Transcribe_large_audio_files_offline_with_Vosk.ipynb" rel="noopener ugc nofollow" target="_blank"/>。</p></blockquote><h1 id="0168" class="nn mf it bd mg no np nq mj nr ns nt mm jz nu ka mp kc nv kd ms kf nw kg mv nx bi translated">用于离线转录的其他包或工具包</h1><p id="5f16" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">正如在简介中提到的，还有更多可用的包或工具包。然而，它们的实现不像Vosk那么容易。不过如果你有兴趣，我可以推荐<strong class="lb iu">英伟达的NeMo </strong>。</p><h2 id="9d4a" class="me mf it bd mg mh mi dn mj mk ml dp mm li mn mo mp lm mq mr ms lq mt mu mv mw bi translated">英伟达尼莫</h2><p id="48c2" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">NeMo是为从事自动语音识别、自然语言处理和文本到语音合成的研究人员构建的工具包。和VOSK一样，我们也可以从一堆预先训练好的模型中进行选择，这些模型可以在<a class="ae ky" href="https://catalog.ngc.nvidia.com/orgs/nvidia/models/nemospeechmodels" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="3268" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实现需要更多的时间和代码。基于<a class="ae ky" href="https://github.com/titu1994" rel="noopener ugc nofollow" target="_blank"> Somshubra Majumdar的</a> <a class="ae ky" href="https://github.com/NVIDIA/NeMo/blob/c9d04851e8a9c1382326862126788fadd77663ac/tutorials/asr/Streaming_ASR.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>我创建了一个<strong class="lb iu">精简版</strong>，可以在这里<a class="ae ky" href="https://github.com/darinkist/medium_article_vosk/blob/main/NeMo_ASR_example.ipynb" rel="noopener ugc nofollow" target="_blank">找到</a>。</p><h1 id="f4bf" class="nn mf it bd mg no np nq mj nr ns nt mm jz nu ka mp kc nv kd ms kf nw kg mv nx bi translated">结论</h1><p id="fc51" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">Vosk是一个很棒的离线转录工具包。与我测试的其他离线解决方案相比，Vosk是最容易实现的。唯一缺少的东西是标点符号。到目前为止，还没有整合it的计划。但是，与此同时，如果需要，可以使用外部工具。</p></div></div>    
</body>
</html>