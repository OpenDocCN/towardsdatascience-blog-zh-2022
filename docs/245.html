<html>
<head>
<title>NYT Sentiment Analysis with TensorFlow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于张量流的NYT情感分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/nyt-sentiment-analysis-with-tensorflow-7156d77e385e#2022-01-09">https://towardsdatascience.com/nyt-sentiment-analysis-with-tensorflow-7156d77e385e#2022-01-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""><h1 id="4510" class="pw-post-title io ip iq bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">基于张量流的NYT情感分析</h1></div><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a334f87d7d9905618eb9657f26ca99ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cfAgjxkRDf2lobcS"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">乔恩·泰森在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="3315" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们进入拜登政府一年了，我开始想知道与前几任总统的头几年相比，他执政第一年的新闻报道有多积极。为了找到答案，我决定对过去四位总统执政第一年的每个月的NYT文章摘要进行情感分析。下面，我讨论/显示以下步骤的代码:</p><ol class=""><li id="c0f7" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">使用NYT API <a class="ae kc" href="https://github.com/michadenheijer/pynytimes#archive-metadata" rel="noopener ugc nofollow" target="_blank">纽约时报</a></li><li id="5957" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">使用<a class="ae kc" href="https://textblob.readthedocs.io/en/dev/" rel="noopener ugc nofollow" target="_blank">文本Blob </a>进行情感分析</li><li id="982a" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">用TensorFlow训练我自己的情感分析模型</li><li id="e14f" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">比较模型</li><li id="56c9" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">可视化结果</li></ol><p id="e1d1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完整代码，请点击这里下载Jupyter笔记本<a class="ae kc" href="https://github.com/abode118/NYT-Sentiment-Analysis" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="8fe2" class="lp lq iq bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated">第一步。使用NYT API <a class="ae kc" href="https://github.com/michadenheijer/pynytimes#archive-metadata" rel="noopener ugc nofollow" target="_blank">纽约时报</a></h2><p id="2511" class="pw-post-body-paragraph kd ke iq kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">我们将导入所需的包，连接到API，创建一个字典来保存我们的结果，提取相关的数据，将我们的字典保存到一个JSON文件中，这样我们就不必再次提取数据，并关闭我们与API的连接。</p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><h2 id="d747" class="lp lq iq bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated">步骤2:使用<a class="ae kc" href="https://textblob.readthedocs.io/en/dev/" rel="noopener ugc nofollow" target="_blank">文本块</a>进行情感分析</h2><p id="11c7" class="pw-post-body-paragraph kd ke iq kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">我们将再次导入必要的包。然后，我们将在一些随机选择的抽象上测试该模型，以检查其合理性。</p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="54e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我运行这个抽查时，我注意到TextBlob相当不准确。例如，下面的摘要被标为“积极的”:<em class="mt">警方表示，午夜过后不久，曼谷一家高端夜总会发生火灾，造成至少59人死亡，200多人受伤，当时狂欢者正在庆祝新年。</em></p><h2 id="ba81" class="lp lq iq bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated">第三步。用TensorFlow训练我自己的情感分析模型</h2><p id="8041" class="pw-post-body-paragraph kd ke iq kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">因为TextBlob似乎做得不太好，所以我决定练习我的ML技能，并使用TensorFlow建立一个情感分析模型(<a class="ae kc" href="https://jovian.ai/outlink?url=https%3A%2F%2Fwww.tensorflow.org%2Fhub%2Ftutorials%2Ftf2_text_classification" rel="noopener ugc nofollow" target="_blank">本教程</a>非常有帮助)。首先，我们将导入所需的包，并加载我们将用于训练/测试的数据集。我在一个1.6毫米的标注tweets (标注为正面或负面)的数据集上训练了我的模型。然后，我们将以80/20的比例随机拆分用于训练/测试的数据，并将tweets及其标签重新格式化为numpy数组，这样我们就可以在训练模型时将它们作为输入进行加载。</p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="9dea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们将使用keras创建一个序列模型。我们模型的第一层会把句子作为输入，转换成数值的向量(这叫做“单词嵌入”)。幸运的是，有人创建了一个可以做到这一点的模型，可以从tensorflow-hub下载。我在这一层使用的模型可以在这里找到。然后我们将添加两个隐藏层和一个输出层。我们的隐藏层分别有16个和8个节点，并且都使用ReLU激活函数。我们的输出层有1个节点，因为这是一个二元分类问题，我们使用sigmoid激活函数。最后，我们将使用Adam优化器编译我们的模型，使用BinaryCrossentropy计算损失，并使用阈值为0.5的BinaryAccuracy计算准确性(如果我们的模型预测句子为肯定的可能性≥0.5，我们将把句子分类为肯定的)。</p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="0fec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们将留出一些训练数据用于训练过程中的验证。然后，我们将训练模型，评估结果，并使用混淆矩阵可视化我们的模型在测试数据上的表现。</p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="0b13" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，使用我们的测试数据集，我们有79%的准确率。从我们的混淆矩阵中，我们可以看到，当推文是正面的，但我们预测它是负面的时，我们的大多数错误都会发生。所以，我们对模型有一点负面的偏见。但是，让我们看看这79%是否比TextBlob做得更好。</p><h2 id="b850" class="lp lq iq bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated">第四步。比较模型</h2><p id="ed31" class="pw-post-body-paragraph kd ke iq kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">如果我们使用TextBlob对相同的测试数据集进行分类，我们只能达到62%的准确率。注意:TextBlob预测“中性”情绪以及积极和消极情绪。因此，这不是一个直接的比较，但仍然是有帮助的。在下面的测试中，我们随机将TextBlob的“中性”预测重新分类为“正面”或“负面”【TensorFlow的79%准确率明显优于TextBlob的62%准确率。</p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="2996" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">两个模型在摘要样本上的性能的直接比较可以在下面找到。幸运的是，通过TensorFlow模型，我们现在可以准确地将关于火灾、死亡和伤害的标题归类为“负面”总的来说，它在对我们的摘要进行分类时似乎更加准确，尽管仍然不完善。</p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><h2 id="c6c8" class="lp lq iq bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated">第五步。可视化结果</h2><p id="97b3" class="pw-post-body-paragraph kd ke iq kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">首先，我们将使用我们的模型来预测我们在步骤1中提取的所有摘要的情感。然后，我们将计算每个月积极/消极情绪的百分比，并将其添加到我们的字典中。</p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="fadc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们将把数据重新格式化成只包含我们想要可视化的关键统计数据的数据帧。然后我们将创建一些图表来更好地理解结果！<em class="mt">(下载笔记本看看我是如何用seaborn创建这些图表的)</em></p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><h2 id="2421" class="lp lq iq bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated">结论</h2><p id="50e9" class="pw-post-body-paragraph kd ke iq kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">这个项目对我更加熟悉TensorFlow中的建筑模型非常有帮助。TextBlob就是没剪！我在TensorFlow中构建的模型要精确得多，尽管它明显有一点负面偏差(正如我们从混淆矩阵中了解到的)。</p><p id="9451" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我用张量流模型得到的结果非常有趣。基本上，在布什执政的第一年，新闻是最负面的。就所有新闻(只有25%的正面)和直接提到“布什”的新闻摘要(只有28%的正面)而言，都是如此。另一方面，在特朗普的第一年，新闻通常是最积极的(34%积极)，直接新闻报道对奥巴马最积极(63%积极)。有趣的是，直接提到拜登的摘要(57%)比直接提到特朗普的摘要(52%)更负面。这有点令人惊讶，因为NYT公开反对川普。</p><p id="c680" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我打算对我提取和分类的数据进行额外的分析，包括查看最常用的词，以更好地理解这些意想不到的结果。例如，在特朗普执政的第一年，总体新闻报道最为积极，这可能是因为2017年我们的危机比2001年(互联网泡沫破裂、9/11袭击)、2009年(大衰退)和2021年(挥之不去的新冠肺炎疫情)更少。我期待着进一步探索这些数据！</p></div></div>    
</body>
</html>