<html>
<head>
<title>Picking fast people detector working with OpenCV on CPU in 2021</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">2021年在CPU上使用OpenCV的快速人物检测器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/picking-fast-people-detector-working-with-opencv-on-cpu-in-2021-ff8d752088af#2022-01-04">https://towardsdatascience.com/picking-fast-people-detector-working-with-opencv-on-cpu-in-2021-ff8d752088af#2022-01-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""><h1 id="fffc" class="pw-post-title io ip iq bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">2021年在CPU上使用OpenCV的快速人物检测器</h1></div><p id="152f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近，我需要为一个新的宠物项目探测人。我有一段时间没有这样做了，决定看看现在什么是最好的选择。</p><p id="1876" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我通读了一些论文，并进行了基本测试来衡量准确性和性能。</p><p id="eb97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我有要求——物体足够大，但环境可能非常不同，探测器应该尽可能快地工作。因此，我需要一个具有合理权衡的快速检测器。</p><p id="1e55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，我在普通云上运行我的项目，大多数云单元只提供CPU硬件。最后，我使用OpenCV-DNN框架来处理神经网络。</p><p id="b377" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我发现<a class="ae kl" href="https://viso.ai/deep-learning/object-detection/" rel="noopener ugc nofollow" target="_blank">有一篇文章</a>对探测器的发展进行了回顾。简而言之，有三个大时代:</p><ul class=""><li id="6c90" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">传统的计算机视觉方法——2001年的Viola-Jones(又名Haar's cascade)和2006年的梯度方向直方图(HOG)。</li><li id="c8d3" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">基于卷积神经网络的早期解决方案，其中YOLO和MobileSSD取得了最佳结果(2014–2017)</li><li id="c44d" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">YOLO及其后裔统治世界(自2018年起)</li></ul><p id="a8e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">他们的结论是YOLOv4最快(还有第二种意见——yolov 5最快)。</p><p id="9a6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我发现了一个很好的关于旧时代的系列:</p><ul class=""><li id="4a18" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated"><a class="ae kl" href="https://medium.com/@madhawavidanapathirana/https-medium-com-madhawavidanapathirana-real-time-human-detection-in-computer-vision-part-1-2acb851f4e55" rel="noopener">老派方法</a>速度快，可靠性低</li><li id="30fe" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated"><a class="ae kl" href="https://medium.com/@madhawavidanapathirana/real-time-human-detection-in-computer-vision-part-2-c7eda27115c6" rel="noopener">第一个神经网络</a>(到2018年)，其中最快的是MobileSSD</li></ul><p id="d677" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后让我们比较一下OpenCV中提到的方法。</p><p id="98dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不幸的是，YOLOv5仍然不能与OpenCV一起工作——看起来这是一个很长的故事，并且对它们的兼容性进行了一些修复，但目前最新的YOLOv5-ONNX模型没有加载到当前的OpenCV实现中。</p><p id="7ee8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一方面，OpenCV包含Viola-Jones和HOG实现，因此它们将被添加到竞赛中。</p><p id="a982" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为一个例子，我在股票上发现了一个吸引人的图片:</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi la"><img src="../Images/01f3d0616cfd285f3c3e88331c56e9eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3FhvJi8XnknehLeW9Iq4dQ.jpeg"/></div></div><p class="lm ln gj gh gi lo lp bd b be z dk translated"><a class="ae kl" href="https://unsplash.com/photos/PhhtSyCeN0I" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/PhhtSyCeN0I</a></p></figure><h2 id="b2e1" class="lq lr iq bd ls lt lu dn lv lw lx dp ly jy lz ma mb kc mc md me kg mf mg mh mi bi translated">环境</h2><ul class=""><li id="9aad" class="km kn iq jp b jq mj ju mk jy ml kc mm kg mn kk kr ks kt ku bi translated">python 3 64位</li><li id="cfd3" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">OpenCV python</li><li id="e36a" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">MobileSSD(最新一个和OpenCV合作的是SSD _ mobilenet _ v1 _ coco _ 2017 _ 11 _ 17)</li><li id="b243" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">YOLOv4(普通和微型版本)</li></ul><h2 id="cc8c" class="lq lr iq bd ls lt lu dn lv lw lx dp ly jy lz ma mb kc mc md me kg mf mg mh mi bi translated">试验</h2><p id="4158" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">基准测试运行之后，我得到了意想不到的结果:</p><pre class="lb lc ld le gt mr ms mt mu aw mv bi"><span id="e18a" class="lq lr iq ms b gy mw mx l my mz"><strong class="ms ir">yolo </strong>found <em class="na">12 </em>persons in <strong class="ms ir">1.97 </strong>seconds avg</span><span id="83fe" class="lq lr iq ms b gy nb mx l my mz"><strong class="ms ir">tiny_yolo </strong>found <em class="na">8 </em>persons in <strong class="ms ir">0.22 </strong>seconds avg</span><span id="8c28" class="lq lr iq ms b gy nb mx l my mz"><strong class="ms ir">ssd </strong>found <em class="na">14 </em>persons in <strong class="ms ir">0.1 </strong>seconds avg</span><span id="cc9e" class="lq lr iq ms b gy nb mx l my mz"><strong class="ms ir">hog </strong>found <em class="na">2 </em>persons in <strong class="ms ir">0.18 </strong>seconds avg</span><span id="b441" class="lq lr iq ms b gy nb mx l my mz"><strong class="ms ir">haar </strong>found <em class="na">0</em> persons in <strong class="ms ir">0.07 </strong>seconds avg</span></pre><h2 id="7d01" class="lq lr iq bd ls lt lu dn lv lw lx dp ly jy lz ma mb kc mc md me kg mf mg mh mi bi translated">YOLOv4</h2><p id="4cd6" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">Yolo展示了检测方面的最佳结果，但执行速度非常慢——每张图像2秒。他们宣称高端GPU上100 FPS，但弱CPU不是他们的领域。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi la"><img src="../Images/380d18960ca10268ae0775c77acb3990.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gNAcjTPRvh6HgSJZfg45YQ.jpeg"/></div></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">YOLOv4</p></figure><h2 id="b213" class="lq lr iq bd ls lt lu dn lv lw lx dp ly jy lz ma mb kc mc md me kg mf mg mh mi bi translated">小小的YOLO</h2><p id="83dc" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">TinyYolo漏掉了一些小物件却原来是很多(差不多10次！)更快。这一结果与<a class="ae kl" href="https://medium.com/analytics-vidhya/yolov4-vs-yolov4-tiny-97932b6ec8ec" rel="noopener">其他来源</a>一致:</p><blockquote class="nc nd ne"><p id="e8b8" class="jn jo na jp b jq jr js jt ju jv jw jx nf jz ka kb ng kd ke kf nh kh ki kj kk ij bi translated">YOLOv4-tiny的FPS(每秒帧数)大约是YOLOv4的八倍。然而，在MS COCO数据集上测试时，YOLOv4-tiny的精度是YOLOv4的2/3。</p></blockquote><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi la"><img src="../Images/ca8140214a7009383ca0d7058d28e249.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eYpD24CLXsxx3yi69lv4kQ.jpeg"/></div></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">小尤洛</p></figure><h2 id="b2b1" class="lq lr iq bd ls lt lu dn lv lw lx dp ly jy lz ma mb kc mc md me kg mf mg mh mi bi translated">移动固态硬盘</h2><p id="1822" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">相当老的MobileSSD检测器比TinyYOLO快两倍。这是意料之外的。我能有的唯一解释是，当YOLO(即使是一个微小的版本)是为GPU设计的时候，MobileSSD被优化为在CPU上工作。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi la"><img src="../Images/c84b1deccca12b422b9731df372b4e06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TKQ1sR6eyyAbJccsTPyghg.jpeg"/></div></div></figure><h2 id="e7ee" class="lq lr iq bd ls lt lu dn lv lw lx dp ly jy lz ma mb kc mc md me kg mf mg mh mi bi translated">猪</h2><p id="0139" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">HOG比MobileSSD慢，比TinyYolo略快，但检测结果令人失望。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi la"><img src="../Images/d5f29d5f96102cf8b9570e6d2bb96ef1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HijF0W5GiNDehMqbHbUWlw.jpeg"/></div></div></figure><h2 id="32e2" class="lq lr iq bd ls lt lu dn lv lw lx dp ly jy lz ma mb kc mc md me kg mf mg mh mi bi translated">维奥拉-琼斯</h2><p id="6e25" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">快速工作，但一无所获。</p><h1 id="c422" class="ni lr iq bd ls nj nk nl lv nm nn no ly np nq nr mb ns nt nu me nv nw nx mh ny bi translated">结论</h1><p id="636d" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">明显的赢家是MobileSSD。这是一个相当出乎意料的结果。虽然所有测试的神经网络在检测方面都很好，但MobileSSD远远优于YOLO实现。</p><p id="745c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">老派的方法根本不起作用。</p><h1 id="d6ea" class="ni lr iq bd ls nj nk nl lv nm nn no ly np nq nr mb ns nt nu me nv nw nx mh ny bi translated">链接</h1><ul class=""><li id="ccc9" class="km kn iq jp b jq mj ju mk jy ml kc mm kg mn kk kr ks kt ku bi translated"><a class="ae kl" href="https://viso.ai/deep-learning/object-detection/" rel="noopener ugc nofollow" target="_blank">2021年探测器</a></li><li id="6132" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated"><a class="ae kl" href="https://medium.com/@madhawavidanapathirana/https-medium-com-madhawavidanapathirana-real-time-human-detection-in-computer-vision-part-1-2acb851f4e55" rel="noopener">传统计算机视觉探测器</a></li><li id="38a1" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated"><a class="ae kl" href="https://medium.com/@madhawavidanapathirana/real-time-human-detection-in-computer-vision-part-2-c7eda27115c6" rel="noopener">第一个基于CNN的探测器</a></li><li id="9b1e" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated"><a class="ae kl" href="https://github.com/AlexeyAB/darknet" rel="noopener ugc nofollow" target="_blank"> YOLOv4 </a></li><li id="e474" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated"><a class="ae kl" href="https://docs.opencv.org/4.x/d2/d58/tutorial_table_of_content_dnn.html" rel="noopener ugc nofollow" target="_blank"> OpenCV DNN </a></li><li id="8aca" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated"><a class="ae kl" href="https://docs.opencv.org/4.x/d5/d33/structcv_1_1HOGDescriptor.html" rel="noopener ugc nofollow" target="_blank"> OpenCV猪</a></li><li id="03d9" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated"><a class="ae kl" href="https://docs.opencv.org/4.x/db/d28/tutorial_cascade_classifier.html" rel="noopener ugc nofollow" target="_blank"> OpenCV Viola-Jones </a></li><li id="3823" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated"><a class="ae kl" href="https://github.com/tprlab/detectppl" rel="noopener ugc nofollow" target="_blank">在Github上测试源代码</a></li></ul></div></div>    
</body>
</html>