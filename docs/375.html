<html>
<head>
<title>Contrast Enhancement of Grayscale Images Using Morphological Operators</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于形态学算子的灰度图像对比度增强</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/contrast-enhancement-of-grayscale-images-using-morphological-operators-de6d483545a1#2022-01-13">https://towardsdatascience.com/contrast-enhancement-of-grayscale-images-using-morphological-operators-de6d483545a1#2022-01-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""><h1 id="b7c2" class="pw-post-title io ip iq bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">基于形态学算子的灰度图像对比度增强</h1></div><div class=""><h2 id="e4e6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">利用OpenCV中的形态学算子增强灰度图像对比度的简单方法</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4ef2029dce1144bf3bbcf9bf4b6dd9c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*00n2nQhl4-pWH59J"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">米拉德·穆阿菲在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="b68b" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="1183" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">对比度增强是一种非常常见的图像处理技术，用于增强低对比度图像中的特征。几种方法如<em class="mk">对比度拉伸</em>、<em class="mk">直方图均衡</em>、<em class="mk">自适应直方图均衡</em>、<em class="mk">对比度受限自适应直方图均衡</em>或<em class="mk"> CLAHE </em>等。已经被用于增强图像的对比度。在本文中，我们将研究另一种对比度增强的方法，这种方法是使用形态学变换的组合来实现的。</p><h1 id="00fe" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">什么是形态变换或运算符？</h1><p id="1b9a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">形态变换或形态运算符是简单的图像变换，通常应用于二值图像，但也可以应用于灰度图像。形态变换有各种类型，如<em class="mk">侵蚀</em>、<em class="mk">扩张</em>、<em class="mk">张开</em>、<em class="mk">闭合</em>、<em class="mk">渐变</em>、<em class="mk">礼帽</em>和<em class="mk">黑帽</em>。这些变换的两个主要部分是输入图像和被称为<strong class="lq ir">结构化元素(SE) </strong>的内核。在我们详细讨论不同类型的形态变换之前，让我们先了解一下结构元素。</p><h2 id="0fee" class="ml kx iq bd ky mm mn dn lc mo mp dp lg lx mq mr li mb ms mt lk mf mu mv lm mw bi translated">什么是结构元素？</h2><p id="a9f8" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><strong class="lq ir">结构元素(SE) </strong>是在执行形态学操作时检查的每个像素周围的邻域。结构化元素可以有不同的形状和大小，改变它会显著影响转换的性能。</p><p id="7db4" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">OpenCV提供的结构化元素有三种形状——<em class="mk">长方形</em>、<em class="mk">椭圆形</em>和<em class="mk">十字形</em>。下图显示了这三种形状。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/506d402022d55be653f67062144266c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qwLimOLM3AXjZ3GWeOrlQQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">大小为5 x 5的结构元素的不同形状(图片由作者提供)</p></figure><h2 id="8619" class="ml kx iq bd ky mm mn dn lc mo mp dp lg lx mq mr li mb ms mt lk mf mu mv lm mw bi translated">形态运算符的类型</h2><p id="59dd" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">不同类型的形态运算符有:</p><ol class=""><li id="ca77" class="nd ne iq lq b lr mx lu my lx nf mb ng mf nh mj ni nj nk nl bi translated"><strong class="lq ir"> <em class="mk">侵蚀— </em> </strong>根据OpenCV文档，侵蚀算子的工作原理类似于土壤侵蚀。它“侵蚀”，或者更简单地说，去除图像中前景对象的边界。前景对象边界处的像素被移除。它会缩小图像中对象的大小。</li><li id="91fc" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated"><strong class="lq ir"> <em class="mk">膨胀— </em> </strong>膨胀的作用与侵蚀完全相反。它“扩大”或扩展前景对象的边界，从而增加图像中对象的大小。如果我们想要连接前景物体的破碎部分，这是很有用的。</li><li id="331b" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated"><strong class="lq ir"> <em class="mk">开启— </em> </strong>开启操作用于去噪。首先应用腐蚀操作，然后是膨胀操作。腐蚀操作首先从图像中移除所有小的噪声区域，然后应用膨胀来恢复对象的原始大小。</li><li id="71ec" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated"><strong class="lq ir"> <em class="mk">关闭— </em> </strong>关闭是打开的反义词，意思是先膨胀后腐蚀。这对于连接或填充前景对象中出现的小点很有用，同时保持对象的大小。</li><li id="7dea" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated"><strong class="lq ir"> <em class="mk">梯度— </em> </strong>形态学<strong class="lq ir"> <em class="mk"> </em> </strong>从膨胀结果中减去腐蚀结果，得到图像的梯度。渐变操作的结果是图像中前景对象的轮廓。</li><li id="9c32" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated"><strong class="lq ir"> <em class="mk">高帽/白帽— </em> </strong>高帽变换，也称为<em class="mk">白帽变换</em>，是通过从原始图像中去除或减去图像的开口得到的。这个操作符给出了图像中比结构元素小的明亮特征。</li><li id="b80f" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated"><strong class="lq ir"> <em class="mk">黑帽/底帽— </em> </strong>黑帽变换，也称为<em class="mk">底帽变换</em>，是通过从原始图像中去除或减去图像的闭合而得到的。这个操作符给出了图像中比结构元素小的暗特征。</li></ol><blockquote class="nr ns nt"><p id="d30f" class="lo lp mk lq b lr mx jr lt lu my ju lw nu mz lz ma nv na md me nw nb mh mi mj ij bi translated"><strong class="lq ir">注意:</strong>礼帽和黑帽变换更适合灰度图像。</p></blockquote><h2 id="d748" class="ml kx iq bd ky mm mn dn lc mo mp dp lg lx mq mr li mb ms mt lk mf mu mv lm mw bi translated">形态变换如何帮助对比度增强？</h2><p id="3c49" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">简而言之，对比度增强需要做到以下几点:</p><ol class=""><li id="0b82" class="nd ne iq lq b lr mx lu my lx nf mb ng mf nh mj ni nj nk nl bi translated">使得图像中的亮区域更亮。</li><li id="f7f3" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated">使得图像中的暗区域更暗。</li></ol><p id="220e" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">如前所述，顶帽变换的结果是由输入图像中所有亮特征组成的图像，黑帽变换的结果是由输入图像中所有暗特征组成的图像。因此，为了增强对比度，我们需要输入图像的Top和Black Hat变换。</p><p id="604c" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">在获得输入图像的顶帽和黑帽变换之后，我们将<strong class="lq ir">向输入图像添加</strong>顶帽变换，以使其亮区域更亮，并且<strong class="lq ir">从输入图像中减去</strong>黑帽变换，以使其暗区域更暗。</p><p id="7d41" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">上述步骤可以表示为如下所示的等式:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/a1ce0a9d4466695558b0a61407cc233f.png" data-original-src="https://miro.medium.com/v2/resize:fit:288/format:webp/1*uqGuOo4CNOAjeOHIQ2jt2A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">对比度增强方程</p></figure><p id="798e" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">其中<em class="mk"> R </em>为结果图像，<em class="mk"> I </em>为输入图像，<em class="mk"> T </em>和<em class="mk"> B </em>分别为顶帽和黑帽变换。</p><p id="ad48" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">下面的流程图描述了增强对比度的步骤。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/89c87077fca057f6f850ae6093b8277a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NARZVy-1RL3YN51skjeHqA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用形态学变换增强对比度的步骤(图片由作者提供)</p></figure><h1 id="ee36" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">密码</h1><p id="b0c9" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们将使用Python和OpenCV实现这种对比度增强技术。我们需要首先使用pip安装<code class="fe nz oa ob oc b">opencv-python</code>。</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="7be2" class="ml kx iq oc b gy oh oi l oj ok">pip install opencv-python</span></pre><p id="70c6" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">安装OpenCV后，我们将在代码中导入库。</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="f480" class="ml kx iq oc b gy oh oi l oj ok">import cv2 as cv</span></pre><p id="4884" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">我们将使用下面的图片作为我们的代码，它来自GitHub 上的<a class="ae kv" href="https://github.com/ml-workgroup/covid-19-image-repository" rel="noopener ugc nofollow" target="_blank">新冠肺炎图片库。</a></p><blockquote class="nr ns nt"><p id="46d6" class="lo lp mk lq b lr mx jr lt lu my ju lw nu mz lz ma nv na md me nw nb mh mi mj ij bi translated">本库中的图像数据收集自德国汉诺威汉诺威医学院诊断和介入放射学研究所，并根据知识共享署名3.0未经许可获得许可。</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/613a3b0192cef460814574e4cbc9a687.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*F_tzg8Rbp4uTqKDBKMYV8Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">输入图像</p></figure><p id="ab9c" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">我将图像缩小了50%,以减小图像的尺寸。</p><p id="7b66" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">为了读取这个图像，我们将使用OpenCV的<code class="fe nz oa ob oc b">imread</code>函数。</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="4f38" class="ml kx iq oc b gy oh oi l oj ok">filename = # path to the image file<br/>img = cv.imread(filename,0)</span></pre><p id="4086" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">现在我们有了我们的图像，我们将获得这个图像的顶部和黑帽变换。在此之前，我们需要构建我们的结构化元素或内核。为此，我们可以使用OpenCV提供的<code class="fe nz oa ob oc b">getStructuringElement</code>函数。</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="ee1b" class="ml kx iq oc b gy oh oi l oj ok">kernel = cv.getStructuringElement(cv.MORPH_ELLIPSE,(5,5))</span></pre><p id="05e1" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">在上面的代码片段中，我们构建了一个大小为(5，5)的椭圆结构元素。您可以通过更改这些参数进行实验，并观察对输出的影响。</p><p id="4451" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">下一步是使用我们在上一步中构建的内核来获得输入图像的变换。</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="deb6" class="ml kx iq oc b gy oh oi l oj ok"># Top Hat Transform<br/>topHat = cv.morphologyEx(img, cv.MORPH_TOPHAT, kernel)</span><span id="e5de" class="ml kx iq oc b gy om oi l oj ok"># Black Hat Transform<br/>blackHat = cv.morphologyEx(img, cv.MORPH_BLACKHAT, kernel)</span></pre><p id="9714" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">一旦我们有了变换，我们将应用之前看到的方程。</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="4687" class="ml kx iq oc b gy oh oi l oj ok">res = img + topHat - blackHat</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/a18cee79b3514bfb1d5dd095e7339b0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*-GjRCvU82f2qeRrVmKspWA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">大小为(5，5)的椭圆形内核的输出图像</p></figure><p id="23be" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">我们可以看到输入图像的对比度有所提高。一些在输入图像中不突出的微小特征现在是可见的。然而，如果没有仔细选择结构化元素，这种技术也会给图像增加一些噪声。</p><p id="1046" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">例如，下图显示了选择大小为(15，15)的椭圆形结构元素时的输出。肺部和骨骼边缘的微小特征现在比早期输出更加突出和清晰，但我们可以在输出图像中看到一些靠近身体边界的噪声区域，即背景中的白色斑块。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/cad15fce7fd132144b55ae42ff6042d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*ItV7iI42JbzyhzAY5Zkiyw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">输出图像，用于大小为(15，15)的椭圆形内核</p></figure><p id="7d10" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">随着你继续增加结构元素的尺寸，前景特征将变得更加突出，但是背景将开始变得越来越嘈杂。具有大小为(35，35)的结构化元素的输出在背景中有更多的噪声区域。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/f653904fd0542efc14e2ac7441582a22.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*v6a2fyDYERI-trAoI--Lfg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">输出图像，用于大小为(35，35)的椭圆形内核</p></figure><h1 id="b441" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">结论</h1><p id="e791" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">因此，我们看到了如何使用礼帽和黑帽形态学操作的组合来增强灰度图像的对比度。如上所示，一些微小的特征得到了极大的增强，在我们的输出图像中变得更加突出。</p><h2 id="d782" class="ml kx iq bd ky mm mn dn lc mo mp dp lg lx mq mr li mb ms mt lk mf mu mv lm mw bi translated">要记住的要点</h2><ol class=""><li id="346a" class="nd ne iq lq b lr ls lu lv lx on mb oo mf op mj ni nj nk nl bi translated">这种方法可能不如原始的对比度拉伸方法有效，因为它在图像中引入了噪声，因为我们继续增加结构元素的大小。</li><li id="7d76" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated">因为结构化元素基本上是应用变换时要考虑的邻域的大小，所以输出也将取决于输入图像的大小。例如，与250×250图像的(35，35)核相比，1000×1000大小的图像的(35，35)核将形成更小的区域。因此，调整图像大小也会影响此方法的输出。</li><li id="d741" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated">由于Top和Black Hat变换分别为我们提供了比结构化元素小的更亮和更暗的特征，<strong class="lq ir">，</strong>如果要增强的特征的大小小于我们选择的结构化元素的大小，这种对比度增强方法将会很好地工作。因此，精确地增强较大特征的对比度变得困难，因为我们的内核的较大尺寸将在我们的图像背景中引入较大的噪声区域。</li></ol><p id="f4ad" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">感谢您的阅读！:)如果你有任何问题，可以在<a class="ae kv" href="https://www.linkedin.com/in/shivaneej/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系我。</p><h1 id="3b73" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">参考</h1><ol class=""><li id="ca8f" class="nd ne iq lq b lr ls lu lv lx on mb oo mf op mj ni nj nk nl bi translated">OpenCV:形态学变换<a class="ae kv" href="https://docs.opencv.org/3.4/d9/d61/tutorial_py_morphological_ops.html" rel="noopener ugc nofollow" target="_blank">https://docs . OpenCV . org/3.4/d9/d61/tutorial _ py _ morphology _ ops . html</a></li><li id="d288" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated">Kushol R，Nishat R. M .，Rahman A. B. M. A .，Salekin M. M .，“使用具有最佳结构元素形态学算子的医学X射线图像的对比度增强”，arXiv:1905.08545v1 [cs .2019年5月27日</li><li id="559e" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated">辛瑞希·b·温瑟，汉斯·拉塞尔，斯维特拉娜·格贝尔，萨宾·k·马斯克，简·b·辛瑞希斯，延斯·沃格尔-克劳森，弗兰克·k·瓦克，马里乌斯·m·霍普，伯恩哈德·c·迈耶，“新冠肺炎图像储存库”，DOI:10.6084/M9 . fig share . 12676786</li></ol></div></div>    
</body>
</html>