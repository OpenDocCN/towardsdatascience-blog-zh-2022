<html>
<head>
<title>Deploy MNIST Trained Model as a Web Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将MNIST训练模型部署为Web服务</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploy-mnist-trained-model-as-a-web-service-ba333d233a5d#2022-01-04">https://towardsdatascience.com/deploy-mnist-trained-model-as-a-web-service-ba333d233a5d#2022-01-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""><h1 id="553b" class="pw-post-title ir is it bd iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp bi translated">将MNIST训练模型部署为Web服务</h1></div><div class=""><h2 id="3854" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我负责培训、服务和客户实现。该服务接收0到9(张量格式)之间的手写数字图像，并猜测该图像代表哪个数字</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9b71a6ceee49a83eb342a2704bb59343.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8XBXI91-GLsnsQ0HZIQVgg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。</p></figure><p id="6ded" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我的一篇关于深度学习的文章中，我教了如何实现一个简单的图像识别系统。该程序在一个文件中完成所有的编码工作——数据集加载、模型定义、训练和评估。</p><p id="8df7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这篇文章中，我将带您了解如何保存模型并从使用Flask (Python web framework)实现的服务中加载它。</p><p id="08c2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我还将展示如何构建一个简单的客户端来调用服务。</p><p id="2080" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">代码在</strong> <a class="ae lu" href="https://github.com/vinimonteiro/mnist-service" rel="noopener ugc nofollow" target="_blank"> <strong class="la iu"> Github </strong> </a>上有。回购包含以下文件，</p><ul class=""><li id="67ad" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">client.py</li><li id="3a32" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">service.py</li><li id="543f" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">train.py</li><li id="2cda" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">神经网络. py</li></ul><h1 id="3d56" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">培训和保存模型</h1><p id="697a" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">我在之前的<a class="ae lu" rel="noopener" target="_blank" href="/implementing-deep-learning-with-pytorch-image-recognition-d403d5da98ea">文章</a>中提到了培训阶段。我用了PyTorch。</p><p id="167b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是一个简单的神经网络，有一个输入层、两个隐藏层和一个输出层。</p><p id="972b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我用的例子是图像识别的“Hello World”。对于刚开始深度学习的新手来说很棒。</p><p id="9b24" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">训练后，我保存模型学习到的权重/参数。保存学习参数，也称为“保存用于推理”。这是<a class="ae lu" href="https://pytorch.org/tutorials/beginner/saving_loading_models.html#save-load-entire-model" rel="noopener ugc nofollow" target="_blank">推荐的方法</a>。</p><p id="f546" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">尽管保存整个模型更容易(代码更少),但不建议这样做，因为在保存模型时，数据被绑定到类和目录结构。</p><p id="0f12" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是我如何保存模型，</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="d6bb" class="nl mk it nh b gy nm nn l no np">torch.save(model.state_dict(), "model.pth")</span></pre><h1 id="bd16" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">服务</h1><p id="de47" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">为了开发服务，我使用了一个名为Flask的Python web框架。该实现只包含一个端点(<code class="fe nq nr ns nh b">/guess</code>)。</p><p id="5fa5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为参考，我使用了<a class="nt nu ep" href="https://medium.com/u/15510b6546e?source=post_page-----ba333d233a5d--------------------------------" rel="noopener" target="_blank"> Tanuj Jain </a>的这篇<a class="ae lu" rel="noopener" target="_blank" href="/simple-way-to-deploy-machine-learning-models-to-cloud-fd58b771fdcf">文章</a>。Tanuj还讲述了如何在云虚拟机(VM)中部署。</p><p id="cd27" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当执行service.py时，程序加载模型(以前保存的)。模型只加载一次。</p><h2 id="32a8" class="nl mk it bd ml nv nw dn mp nx ny dp mt lh nz oa mv ll ob oc mx lp od oe mz of bi translated">请求和响应</h2><p id="94ce" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">该服务接收包含手写数字(张量表示)的JSON。它将字符串JSON转换为数组，然后再转换为张量。</p><p id="f286" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，它将张量展平到大小784 (28乘以28)并传递给模型。模型输出(10个节点)包含对从0到9的每个数字的猜测。</p><p id="31e1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nq nr ns nh b">torch.argmax</code>返回所有输出节点的最大值。最后，服务响应是一个字符串。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">service.py</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/b8fc0b5b82e1073679b7542cad93e363.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*XHTotqS92G4KoaugIcliPw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图一。服务正在运行。图片由作者提供。</p></figure><p id="fe7a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">该服务在端口8888上运行。可能是任何港口。如果您选择端口80或其他标准端口号，您可能会面临“权限”错误。</p><h2 id="3f52" class="nl mk it bd ml nv nw dn mp nx ny dp mt lh nz oa mv ll ob oc mx lp od oe mz of bi translated">停止服务</h2><p id="87c9" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">如果需要停止服务，我用的方法就是简单的根据某个关键字寻找进程，然后杀死它。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="69b1" class="nl mk it nh b gy nm nn l no np">ps -ef | grep service.py<br/>kill -9 &lt;process&gt;</span></pre><h1 id="96d6" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">客户</h1><p id="e6b4" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">客户端很简单。这是一个加载MNIST数据集并将一些手写数字(张量表示)传递给服务的程序。你选择要发送的号码。</p><p id="3830" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在调用服务之前，代码将张量转换成一个列表，并将其包装在JSON中。此外，在调用服务之前，它将数字显示为图像，以便与服务的响应进行比较。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">client.py</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/868ccab83132629e805d5cddc473e06a.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*xFDbTos9FXI4SraAn7fThg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图二。服务响应。图片由作者提供。</p></figure><h1 id="8892" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">最后的想法</h1><p id="9e97" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">我希望你喜欢这个教程。这里展示的例子是为了让你开始并发展到更有趣的东西。例如，想象在纸上写一个数字，指向你的相机，然后调用服务。</p><p id="b486" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最关键的一步是学习保存、加载模型，并将其作为服务。接下来解释如何在不同的云供应商中部署。我打算写一篇关于它的教程。</p><p id="8243" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">暂时就这样了。感谢阅读。</p></div></div>    
</body>
</html>