<html>
<head>
<title>Price Elasticity: Modeling in Azure ML Designer After the Exploration Data Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">价格弹性:探索数据分析后在Azure ML Designer中建模</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/price-elasticity-modeling-in-azure-ml-designer-after-the-exploration-data-analysis-4f36961ce571#2022-01-11">https://towardsdatascience.com/price-elasticity-modeling-in-azure-ml-designer-after-the-exploration-data-analysis-4f36961ce571#2022-01-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/114470cabfa68b55378bb677e2128d9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HfpWaN-R8GMVx3cgs-AYBA.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">(作者)</p></figure><div class=""><h1 id="238a" class="pw-post-title jg jh ji bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">价格弹性:探索数据分析后在Azure ML Designer中建模</h1></div><div class=""><h2 id="7d25" class="pw-subtitle-paragraph kf jh ji bd b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dk translated">找出EDA对机器学习模型性能的好处</h2></div><p id="1171" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">在我之前关于价格弹性的帖子中，我展示了在创建机器学习模型之前使用<em class="lt"> Exploration Data Analysis </em>分析数据集的重要性，以便更好地了解您的数据优势和劣势:</p><div class="is it gp gr iu lu"><a rel="noopener follow" target="_blank" href="/price-elasticity-data-understanding-and-data-exploration-first-of-all-ae4661da2ecb"><div class="lv ab fo"><div class="lw ab lx cl cj ly"><h2 class="bd jj gy z fp lz fr fs ma fu fw jh bi translated">价格弹性:首先是数据理解和数据探索！</h2><div class="mb l"><h3 class="bd b gy z fp lz fr fs ma fu fw dk translated">本文将展示R中用于更好的数据探索的工具。</h3></div><div class="mc l"><p class="bd b dl z fp lz fr fs ma fu fw dk translated">towardsdatascience.com</p></div></div><div class="md l"><div class="me l mf mg mh md mi ja lu"/></div></div></a></div><p id="c860" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">当时我用Azure Machine Learning Studio Classic作为<em class="lt">无代码/低代码</em>平台，快速训练线性模型。现在，当你试图登录Azure ML Studio Classic时，会弹出一条消息，宣布它将于2024年8月31日退役:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/5c41b252ef3db9c351068f855372ee1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*RA744tVQBlQbT089HXsrHQ.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图1 — Azure ML Studio经典退休(作者)</p></figure><p id="6a1f" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">这就是为什么在这篇文章中，我将使用全新的<strong class="kz jj"> Azure机器学习设计器</strong>(可以认为是旧Azure ML Studio Classic的2.0版本)来应用上面博客文章中显示的所有清理和转换操作。</p><p id="5de3" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">我还将向您展示在Designer中实现残差图(用于检查回归模型的健康状况)的方法。我在我的这篇博文中详细探讨了它们:</p><div class="is it gp gr iu lu"><a href="https://medium.com/microsoftazure/how-to-better-evaluate-the-goodness-of-fit-of-regressions-990dbf1c0091" rel="noopener follow" target="_blank"><div class="lv ab fo"><div class="lw ab lx cl cj ly"><h2 class="bd jj gy z fp lz fr fs ma fu fw jh bi translated">如何更好地评估回归的拟合优度</h2><div class="mb l"><h3 class="bd b gy z fp lz fr fs ma fu fw dk translated">检查剩余健康状况的指标和图表</h3></div><div class="mc l"><p class="bd b dl z fp lz fr fs ma fu fw dk translated">medium.com</p></div></div><div class="md l"><div class="mo l mf mg mh md mi ja lu"/></div></div></a></div><p id="0efb" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">非常感谢我的同事Greta Villa，他帮助我实现了这篇文章中的大部分Python代码。</p><p id="f3c6" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">让我们开始实施我们的价格弹性实验。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><p id="7c30" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">我想当然地认为读者了解Azure ML Designer的基础知识。粗略地说，那些熟悉旧的Azure ML Studio经典平台的人会发现自己非常容易使用该设计器。为了完整起见，<a class="ae my" href="https://docs.microsoft.com/en-us/azure/machine-learning/tutorial-designer-automobile-price-train-score" rel="noopener ugc nofollow" target="_blank">这是一个简单的教程</a>，向初级读者介绍设计师。</p><p id="28bc" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">价格弹性实验的源数据集取自微软关于Azure ML Studio Classic 的教程，每个人都可以免费获得。它们与前一篇博文中分享的数据集相同。为了方便起见，<a class="ae my" href="https://1drv.ms/u/s!AtgrmeCPhKh7kP5EjOgd-EhXbdSlwA" rel="noopener ugc nofollow" target="_blank">这是在执行完所有源数据集之间的连接操作后，到数据集的链接</a>。</p><h2 id="f754" class="mz na ji bd nb nc nd dn ne nf ng dp nh lg ni nj nk lk nl nm nn lo no np nq nr bi translated">在设计器中设置实验</h2><p id="5489" class="pw-post-body-paragraph kx ky ji kz b la ns kj lc ld nt km lf lg nu li lj lk nv lm ln lo nw lq lr ls im bi translated">请继续<a class="ae my" href="https://docs.microsoft.com/en-us/azure/machine-learning/how-to-connect-data-ui#create-datasets" rel="noopener ugc nofollow" target="_blank">在Azure ML中将源数据集</a>注册为<em class="lt"> TabularDataset </em>。将其作为源数据模块导入到设计器画布中。然后添加一个“执行R脚本”模块，以便应用R代码从数据集中删除重复的数据:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/80139c1dd07240fad2e1ba5b44da9d72.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*slbh6Da38gpVEQ7FD9O6zg.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图2 —添加源数据和执行R脚本模块(作者)</p></figure><p id="14bc" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">然后在上面提到的模块中输入下面的R脚本，您也可以在之前的博客文章的“异常值处理”一节中找到:</p><figure class="mk ml mm mn gt iv"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="f3ec" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">此时，我们可以尝试绘制每个产品组合的价格-数量散点图。如果你还记得以前的帖子，有4个产品组合由数字ID (SELL_ID)标识:</p><ul class=""><li id="01ea" class="oa ob ji kz b la lb ld le lg oc lk od lo oe ls of og oh oi bi translated">单个汉堡(1070)</li><li id="c88a" class="oa ob ji kz b la oj ld ok lg ol lk om lo on ls of og oh oi bi translated">汉堡+可乐(2051)</li><li id="1a8b" class="oa ob ji kz b la oj ld ok lg ol lk om lo on ls of og oh oi bi translated">汉堡+柠檬水(2052)</li><li id="b34c" class="oa ob ji kz b la oj ld ok lg ol lk om lo on ls of og oh oi bi translated">汉堡+可乐+咖啡(2053)</li></ul><p id="4b89" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">价格-数量点是通过取与数据集中每个价格相关的所有数量的平均值来计算的，不考虑所有其他变量。对于数量的每个平均值，也使用学生的t分布计算置信区间(详见参考文献)。因此，首先在您的实验中添加一个“执行Python脚本”:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/3d3716d5f73834c9bb3e23e9a73f5296.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*AnhUudyzfBDPUU1VrL6Okg.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图3-添加执行Python脚本以绘制需求曲线(作者)</p></figure><p id="6120" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">然后将以下Python脚本添加到模块中:</p><figure class="mk ml mm mn gt iv"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="3e96" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">正如您可能已经注意到的，在设计器中，不可能像Azure ML Studio Classic那样，直接从“执行Python脚本”或“执行R脚本”模块的输出引脚显示代码生成的图。</p><blockquote class="op"><p id="92a3" class="oq or ji bd os ot ou ov ow ox oy ls dk translated">出于这个原因，为了查看生成的图像，您必须使用Azure ML Python SDK来引用与模块执行相关联的运行，然后使用一些特定于SDK的函数来记录图像。</p></blockquote><p id="4150" class="pw-post-body-paragraph kx ky ji kz b la oz kj lc ld pa km lf lg pb li lj lk pc lm ln lo pd lq lr ls im bi translated">这就是为什么我使用Python而不是R来生成图的原因。</p><p id="a74f" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">运行实验后，您可以点击“执行Python脚本”模块，然后点击“图片”选项卡，以查看脚本创建的图片:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pe"><img src="../Images/8c48d89e71a82314586e83c40a98e5ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5c0MemgJYDqrcMIxPcBV4A.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图4 —所有产品组合的价格-数量散点图(作者)</p></figure><p id="7c6c" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">从与每个产品组合相关的价格-数量散点图中，您可以看到这些点是根据线性函数排列的，并且存在一些异常值，特别是对于2051和2052组合。因此，在对最后一个模块的左输出引脚返回的数据集进行简单分析后，我们将使用另一个“执行R脚本”模块将它们从数据集中排除:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/3faa740468cba2ad1085bd981e75dd82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*pbin1IOv8bzvc-7mvGKFPw.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图5——添加了一个“执行R脚本”模块来删除异常值，并添加了另一个Python模块来显示图表(作者提供)</p></figure><p id="e6b0" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">这里的R脚本删除离群值:</p><figure class="mk ml mm mn gt iv"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="a628" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">在<em class="lt">图5 </em>中，您还可以看到另一个“执行Python脚本”模块，该模块包含与前一个模块相同的脚本来生成散点图，这次使用清理后的数据集作为源。事实上，新的散点图不再显示异常值:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pg"><img src="../Images/1b81825a768c03e72a243aec38053589.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Wi1uBhh_--S5e8rPsX8Gw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图6 —所有产品组合的无异常值的价格-数量散点图(作者)</p></figure><p id="59f7" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">在这一点上，我应用了一系列的特性工程转换，正如我在以前的博客文章中所解释的那样，并且使用如下的一系列模块来修复列名:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/df259372376e6078d5ca2ca973c87556.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*-hwmE0VtOXKatNVplX5rxQ.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图7 —应用特征工程转换(作者)</p></figure><p id="4493" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">用于特征工程转换的R脚本是这样的:</p><figure class="mk ml mm mn gt iv"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="36ee" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">此后，变量HOLIDAY、SELL_ID和WDAY通过<a class="ae my" href="https://docs.microsoft.com/en-us/azure/machine-learning/component-reference/edit-metadata" rel="noopener ugc nofollow" target="_blank">“编辑元数据”模块</a>被转换成分类变量，以便通过<a class="ae my" href="https://docs.microsoft.com/en-us/azure/machine-learning/component-reference/convert-to-indicator-values" rel="noopener ugc nofollow" target="_blank">“转换成指标值”模块</a>用一组一次性编码变量替换它们。然后，使用以下R脚本重命名一些因其不常见的名称而被重命名的功能:</p><figure class="mk ml mm mn gt iv"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="411b" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">接下来，尝试使用Box-Cox变换消除价格和数量变量的偏态，然后使用z得分归一化对所有数值变量进行归一化:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/693729c9def313199ebbe04c653ef2d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/1*HioMEbo9sNfU95CbOseuYw.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图8 —归一化数字特征(作者)</p></figure><p id="4e53" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">Box-Cox转换的R脚本将分别转换T_PRICE和T_QUANTITY中的变量PRICE和QUANTITY。这里是脚本:</p><figure class="mk ml mm mn gt iv"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="5442" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">请注意，变换后的要素将被添加到第一个输入数据集中，并返回到模块的第一个输出引脚。同时，第二个输出引脚返回用于两个变换特征的λ值，以便稍后可以执行逆变换。</p><p id="3cd1" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">类似地，R脚本用于规范化所有数字特征(T_PRICE、T_QUANTITY、YEAR、AVERAGE_TEMPERATURE、DAYS_FROM_BEGINNING):</p><figure class="mk ml mm mn gt iv"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="0d6b" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">你可能想知道为什么我没有使用设计者的本机<a class="ae my" href="https://docs.microsoft.com/en-us/azure/machine-learning/component-reference/normalize-data" rel="noopener ugc nofollow" target="_blank">“规范化数据”模块</a>。原因总是在于我们需要进一步应用逆变换，因此我们需要在第二个输出引脚上返回第二个数据帧，其中包含已变换变量的平均值和标准偏差。</p><p id="f126" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">此时，我们可以将数据集分成一部分用于训练，另一部分用于测试。按照前一篇博文中的划分，我们必须首先通过“编辑元数据”模块转换设计者提供的<em class="lt"> DateTime </em>中的CALENDAR_DATE特征数据类型，然后使用它将日期小于或等于2015-06-30的所有观测值分配给训练数据集:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/6db09787044b4c577d4c5930243a3f2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*eR81ZQAnEZEyO3XFdCVACA.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图9 —使用日历日期将数据集分为测试和训练(作者)</p></figure><p id="5371" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">分割数据模块中使用的<em class="lt">关系表达式</em>如下:</p><blockquote class="pk pl pm"><p id="9a8b" class="kx ky lt kz b la lb kj lc ld le km lf pn lh li lj po ll lm ln pp lp lq lr ls im bi translated">【日历_日期】&lt;= 2015–06–30T00:00:00Z</p></blockquote><p id="a5d1" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">That said, the training and testing workflows are the usual ones (<em class="lt">线性回归</em>、<em class="lt">训练</em>、<em class="lt">得分</em>、<em class="lt">评估模型</em>和<em class="lt">排列特征重要性</em>模块)，图10 中红色突出显示的模块除外:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pq"><img src="../Images/3d2b7015c02f7215599de43ab33fb544.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qNS4fFbk4g1KE_Xg1O-uGw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图10-实验的训练和测试工作流程(作者)</p></figure><p id="b16d" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">测试工作流顶部突出显示的第一个Python脚本从测试数据集中删除了与二战庆祝日相关的观察结果(参见<a class="ae my" rel="noopener" target="_blank" href="/price-elasticity-data-understanding-and-data-exploration-first-of-all-ae4661da2ecb">之前的博客文章</a>),因为它们第一次被视为假日，并且模型无法从数据历史中了解该场合的价格和数量行为。这里是脚本:</p><figure class="mk ml mm mn gt iv"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="95a7" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">另一个突出显示的Python模块包含R脚本的Python移植，您可以在<a class="ae my" href="https://medium.com/microsoftazure/how-to-better-evaluate-the-goodness-of-fit-of-regressions-990dbf1c0091" rel="noopener">“如何更好地评估回归的拟合优度”博文</a>的结尾找到，该博文用于为训练模型生成残差图。这里是脚本:</p><figure class="mk ml mm mn gt iv"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="f370" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">请记住，即使您不使用Azure机器学习，您也可以将之前的Python脚本用于您的自定义机器学习项目。只要记得注释掉<em class="lt"> run.log_residuals </em>函数，用<em class="lt"> fig.show() </em>替换<em class="lt"> run.log_image </em>函数即可。</p><p id="8c1e" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">运行定制评估模块后，只需点击它，然后点击<em class="lt">指标</em>选项卡，即可查看在测试数据集上计算的指标:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pr"><img src="../Images/061e49c9824bb0798e9b57894e8fbebd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GnPUid4mFTTI8omKJz0x5w.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图11——测试数据集上模型的定制度量(作者)</p></figure><p id="472e" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">点击<em class="lt">图像</em>选项卡，您可以访问模块执行期间记录的所有剩余图:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ps"><img src="../Images/82163cbcda0c733e1017f3c8ba1fc954.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JQepo5WVZ6NjKWtBDOdKYA.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图12 —根据测试数据集计算的模型残差图(作者)</p></figure><p id="522f" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">也就是说，在管道的最后，记得对目标变量进行逆变换，这样输出的不再是应用了规范化的Box-Cox变换值，而是真实的量。为了进行逆变换，您需要Box-Cox变换所应用的lambda值以及用于z得分变换的平均值和标准偏差值，所有这些都应用于QUANTITY变量。为此，您必须将之前转换模块的第二个输出引脚链接到相应的<em class="lt">执行R脚本</em>模块，以进行逆转换:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pt"><img src="../Images/c7d5b789038ebcde287c39f8537d5893.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oVPLKcffAFcVkwFc8ZEjUA.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图13 —使用先前输出作为第二输入的逆变换模块(作者)</p></figure><p id="2f62" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">请记住，如果您通过首先应用Box-Cox然后应用z-score来转换数量变量，则应以相反的顺序应用逆转换。</p><p id="2ca4" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">反向z得分变换的R脚本如下:</p><figure class="mk ml mm mn gt iv"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="99c8" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">Box-Cox逆变换的R脚本如下:</p><figure class="mk ml mm mn gt iv"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="3389" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">最后，点击<em class="lt">自动布局</em>重排闪电图标后，完整的流水线看起来如下:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pu"><img src="../Images/4db49876e12636e4b2b9dde4d4bd11d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T73oJuJJpg_H7VymiCuU3Q.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图14 —新实验的完整流程(作者)</p></figure><p id="e6eb" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">右键单击最后一个转换模块的左输出引脚，并单击<em class="lt">预览数据</em>，您可以看到转换数量和原始数量情况下的真实值和得分值:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pv"><img src="../Images/41f4e16968f93367044d20f3e23eefec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jYjbgQcUPl6v6dAr6ugPLg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图15 —逆变换后的得分值(作者)</p></figure><p id="f698" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">一旦您运行了整个管道，我敢打赌您一定很想看看当前的模型是否比之前博客中的模型表现得更好。我们去看看。</p><h2 id="49f5" class="mz na ji bd nb nc nd dn ne nf ng dp nh lg ni nj nk lk nl nm nn lo no np nq nr bi translated">比较模型性能</h2><p id="5ff6" class="pw-post-body-paragraph kx ky ji kz b la ns kj lc ld nt km lf lg nu li lj lk nv lm ln lo nw lq lr ls im bi translated">显然，为了决定两个模型(<a class="ae my" href="https://medium.com/microsoftazure/how-to-better-evaluate-the-goodness-of-fit-of-regressions-990dbf1c0091" rel="noopener"> original </a> vs new)中的哪一个表现得更好，我们需要与用于目标变量的度量尺度无关的标准化度量或系数。例如，考虑目标真值和预测值之间的<em class="lt">归一化均方根误差</em>(NRMSE)<em class="lt">决定系数</em> (R)和现在引入的<em class="lt">斯皮尔曼相关系数</em>(ρ，rho)，这里比较:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pw"><img src="../Images/335535c820c640dd15290266ea5b09c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yTx5RKoCi0eXNOOOTPYDLA.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图16——原始模型和新模型的性能测量(作者)</p></figure><p id="6149" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">对于NRMSE来说，最小的度量就是最好的，而对于其他两个国家来说，最大的度量就是最好的。因此，新模型明显优于原始模型。通过分析<em class="lt">残差图</em>，这一论断也是显而易见的。</p><p id="411d" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">在下图中，我们比较了左边的原始模型和右边的新模型。例如，在图17 的<em class="lt">中，新模型的残差分布呈现更对称的钟形，以零为中心:</em></p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi px"><img src="../Images/efc5eb8d3c7581758679e1de9e708b68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BfoTyPRQE_4CZX5m2QD3rw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图17 —两个模型的残差直方图之间的比较(作者)</p></figure><p id="2489" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">新模型残差正态Q-Q图与<em class="lt">图18 </em>中象限的主对角线明显更接近，这也支持了之前的断言:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi py"><img src="../Images/e2a16fa48dc30e9fc9bdbeb5dcc82834.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MJi5ZA1lP_OxEVQB9mzgJw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图18 —两种模型的正常Q-Q图之间的比较(作者)</p></figure><p id="9a28" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">同样的事情也适用于预测与实际图，在新模型的情况下，点更靠近对角线:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pz"><img src="../Images/211e5310f96ccfa299788fbffb05c223.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9VLrhL-V7M4reU2UXZy05g.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图19——两种模型的预测图与实际图之间的比较(作者)</p></figure><p id="7f74" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">即使在<em class="lt">预测与残差</em>图的情况下，尽管即使对于新模型，异方差仍然很明显，但点更多地集中在0:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi qa"><img src="../Images/3884a6b2c7d4f6d3015ee7a7a858743a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D1AbLYe1aZ4Tt4uKttjUdw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图20——两种模型的预测图与残差图之间的比较(作者)</p></figure><p id="dd34" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">我们可以有把握地说，新型号比原来的性能更好。</p><p id="56a6" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">此外，如果您查看<em class="lt">排列特征重要性</em>模块的结果，您可以看到，从训练数据集中移除具有负得分的高亮特征，您可能会有一个更好的模型，不容易过度拟合:</p><figure class="mk ml mm mn gt iv gh gi paragraph-image"><div class="gh gi qb"><img src="../Images/71543e82288683655e8c75ae4bb03e6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/1*5MVu1PrptWgzb4VXWsSc2w.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图21-可能导致由置换特征重要性模块产生的过拟合的特征</p></figure><p id="b964" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">让我们看看从这个实验中能得出什么结论。</p><h1 id="5c1a" class="qc na ji bd nb qd qe qf ne qg qh qi nh ko qj kp nk kr qk ks nn ku ql kv nq qm bi translated">结论</h1><p id="4d86" class="pw-post-body-paragraph kx ky ji kz b la ns kj lc ld nt km lf lg nu li lj lk nv lm ln lo nw lq lr ls im bi translated">仔细的探索性数据分析(EDA)是获得性能更好的模型的正确方法。我们通过<a class="ae my" rel="noopener" target="_blank" href="/price-elasticity-data-understanding-and-data-exploration-first-of-all-ae4661da2ecb">将EDA应用于价格弹性数据集</a>并训练一个新模型来证明这一点，结果证明这个新模型比原来的模型更好。</p><p id="24bd" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">在下一篇文章中，我们将尝试使用Azure AutoML从本文中看到的相同输入数据集和转换中训练一个额外的模型。</p><h1 id="a3c5" class="qc na ji bd nb qd qe qf ne qg qh qi nh ko qj kp nk kr qk ks nn ku ql kv nq qm bi translated">参考</h1><ul class=""><li id="6211" class="oa ob ji kz b la ns ld nt lg qn lk qo lo qp ls of og oh oi bi translated">置信区间:如何找到它:最简单的方法！—统计如何进行</li><li id="f9b0" class="oa ob ji kz b la oj ld ok lg ol lk om lo on ls of og oh oi bi translated"><a class="ae my" href="https://docs.microsoft.com/en-us/python/api/overview/azure/ml/?view=azure-ml-py" rel="noopener ugc nofollow" target="_blank">Azure Machine Learning SDK for Python—Azure Machine Learning Python |微软文档</a></li><li id="c930" class="oa ob ji kz b la oj ld ok lg ol lk om lo on ls of og oh oi bi translated"><a class="ae my" href="https://docs.microsoft.com/en-us/azure/machine-learning/how-to-log-view-metrics" rel="noopener ugc nofollow" target="_blank">日志&amp;查看指标和日志文件— Azure机器学习|微软文档</a></li></ul></div></div>    
</body>
</html>