<html>
<head>
<title>JSON Schema: Integrity Checking for NoSQL Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JSON模式:NoSQL数据的完整性检查</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/json-schema-integrity-checking-for-nosql-data-b1255f5ea17d#2022-01-21">https://towardsdatascience.com/json-schema-integrity-checking-for-nosql-data-b1255f5ea17d#2022-01-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""><h1 id="fa26" class="pw-post-title io ip iq bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">JSON模式:NoSQL数据的完整性检查</h1></div><div class=""><h2 id="7601" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用JSON模式验证JSON和CSV数据的格式。Python和pandas中的示例代码。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f2114755e7895cbea0db8a08a0d695de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6k7-DcYNHeIf3XfkvCFbFg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在<a class="ae kv" href="https://unsplash.com/s/photos/programming?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kv" href="https://unsplash.com/@lordarcadius?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Vipul Jha </a>拍摄的照片</p></figure><h1 id="6d5b" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">问题是</h1><p id="7322" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">关系数据库有模式。这使您始终知道您拥有的数据是您期望的格式。例如,“名字”和“姓氏”字段必须具有非空字符串值，并且“薪金”必须包含大于0的整数。与模式不匹配的传入数据将被拒绝。</p><p id="7d4b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">但是许多现代数据格式，比如JSON，不是关系型的，也不强制使用模式。JSON允许不同的数据类型与不同行中的相同标记相关联。例如，姓氏可以同时是“Jones”和56.07，也可以完全不存在。也许更糟的是，一个数组可以有混合类型，例如["John "，" Betty "，13.89]</p><p id="450a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">不合规的数据是下游运营的一个大问题。如果找到的值中有两个是“？？?"和“我希望我赚更多的钱”？如果PRIMARY_CARE_DOC字段为空，医院如何联系患者的医生？</p><h1 id="f9f3" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">拯救JSON模式</h1><p id="20ac" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">JSON模式是一个可读的JSON对象，它描述了一组允许的JSON对象。</p><p id="e169" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面是一个简单的例子，说明JSON对象必须有名为LNAME、FNAME和HOURLY_WAGE的字段，LNAME是必需的，没有其他字段。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="581f" class="mu kx iq mq b gy mv mw l mx my">{<br/> “type”: “object”,<br/> “properties”: {<br/>   “HOURLY_WAGE”: {“type”: “number”},<br/>   “FNAME”: {“type”: “string”},<br/>   “LNAME”: {“type”: “string”}<br/>   },<br/> “additionalProperties”: false,<br/> “required”: [“LNAME”]<br/>}</span></pre><p id="8c71" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">所以这个JSON符合上面的模式:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="d3c0" class="mu kx iq mq b gy mv mw l mx my">{<br/>  "LNAME": "Jones",<br/>  "FNAME": "Betty",<br/>  "HOURLY_WAGE": 15<br/>}</span></pre><p id="e3e9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">但事实并非如此，因为缺少LNAME并且不允许使用LAST_NAME:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="818f" class="mu kx iq mq b gy mv mw l mx my">{<br/>  "LAST_NAME": "Jones",<br/>  "FNAME": "Betty",<br/>  "HOURLY_WAGE": 15<br/>}</span></pre><p id="17b5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面是一个更复杂的模式，它规定LNAME中必须有一些内容(不能是空字符串)，HOURLY_WAGE必须在10到30之间，DEPT必须包含一个列出的值。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="743d" class="mu kx iq mq b gy mv mw l mx my">{<br/> “type”: “object”,<br/> “properties”: {<br/>   “HOURLY_WAGE”: {“type”: “number”, “minimum”: 10, “maximum”: 30},<br/>   “FNAME”: {“type”: “string”},<br/>   “LNAME”: {“type”: “string”, “minLength”: 1},<br/>   “DEPT”: {“enum”: [“HR”, “Acct”, “Dev”]} <br/>   },<br/> “additionalProperties”: false,<br/> “required”: [“LNAME”, “DEPT”, “HOURLY_WAGE”]<br/>}</span></pre><p id="d0b5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">所以这符合模式:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="6b47" class="mu kx iq mq b gy mv mw l mx my">{<br/>  "LNAME": "Jones",<br/>  "FNAME": "Betty",<br/>  "HOURLY_WAGE": 15,<br/>  "DEPT": "Acct"<br/>}</span></pre><p id="6f9d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">但这不是。(对象有四个错误— LNAME为空、HOURLY_WAGE太低、不允许DEPT值、不允许名称/字段管理器。)</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="e418" class="mu kx iq mq b gy mv mw l mx my">{<br/>  "LNAME": "",<br/>  "FNAME": "Betty",<br/>  "HOURLY_WAGE": 5,<br/>  "DEPT": "Accounting",<br/>  "MANAGER": "Bob"<br/>}</span></pre><p id="f2da" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">到目前为止，我们已经将模式可视化地应用于一个JSON对象，这在您阅读文章时是很好的。在Python中，如何以编程方式做到这一点？轻松点。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="6789" class="mu kx iq mq b gy mv mw l mx my">from jsonschema import validate</span><span id="dd60" class="mu kx iq mq b gy mz mw l mx my">my_schema = { "my schema here" }<br/>my_json = { "my json object here" }</span><span id="c3fa" class="mu kx iq mq b gy mz mw l mx my">try:<br/>    validate(instance=my_json, schema=my_schema)<br/>except:<br/>    print ("Handle bad JSON here...")</span></pre><h1 id="53ed" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">能力</h1><p id="cda8" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">JSON Schema已经从早期发展成为一种健壮的验证方法，并且拥有比上面显示的更多的功能。检查JSON对象的其他方法包括:</p><ul class=""><li id="b1c6" class="na nb iq lq b lr mk lu ml lx nc mb nd mf ne mj nf ng nh ni bi translated">一个数是另一个数的偶数倍，如5、10、15、20等。</li><li id="530f" class="na nb iq lq b lr nj lu nk lx nl mb nm mf nn mj nf ng nh ni bi translated">字符串匹配给定的正则表达式。</li><li id="1ead" class="na nb iq lq b lr nj lu nk lx nl mb nm mf nn mj nf ng nh ni bi translated">数组具有最小(或最大)数量的元素，或者具有唯一的元素。</li><li id="c08a" class="na nb iq lq b lr nj lu nk lx nl mb nm mf nn mj nf ng nh ni bi translated">字符串是有效的日期时间、日期或时间。</li><li id="445d" class="na nb iq lq b lr nj lu nk lx nl mb nm mf nn mj nf ng nh ni bi translated">字符串是有效的电子邮件地址。</li><li id="ac0f" class="na nb iq lq b lr nj lu nk lx nl mb nm mf nn mj nf ng nh ni bi translated">验证其他模式的元模式。</li><li id="a078" class="na nb iq lq b lr nj lu nk lx nl mb nm mf nn mj nf ng nh ni bi translated">还有更多…</li></ul><p id="653f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">虽然它们看起来可能不像，但下面是完整的、有效的JSON对象，并且可以有一个JSON模式。然而，在我看来，这些“裸JSON”对象是糟糕的样式，因为这些值没有名称标签，因此没有语义。但是请注意，如果遇到这种JSON，您可以<em class="no">为其定义模式。</em></p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="879a" class="mu kx iq mq b gy mv mw l mx my">-77</span><span id="1d8c" class="mu kx iq mq b gy mz mw l mx my">“hello”</span><span id="b163" class="mu kx iq mq b gy mz mw l mx my">[4, 5, 6]</span></pre><p id="1c1e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">JSON模式不具备现代关系系统(如Oracle数据库)的全部验证功能。有一些类型的完整性检查是JSON Schema做不到的。例如，您不能确保特定字段中的值也作为主键出现在另一个文件中(外键约束)。一般来说，JSON模式可以查看一个对象(或相似对象的文件),但不能跨多个数据集查看。</p><h1 id="7f90" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">提示和技巧</h1><p id="656b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">设计JSON模式是一门艺术。如果它们太具体，它们将只接受您想要的确切的数据格式，但却令人头疼，因为它们不允许合理的变化。例如，要求每个员工都有一个经理，这意味着您不能输入其经理刚刚辞职的员工。另一方面，如果模式太松散，它们会接受明显不好的数据，比如根本没有名字的客户。</p><p id="84c7" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">虽然本文主要关注JSON，但是您可以使用JSON模式来验证任何NoSQL(非关系)数据格式。对于CSV/TSV/YAML/etc，只需首先将字符串转换为JSON，然后应用模式。显然，这样做是有时间/性能成本的，但是根据您的应用程序和数据大小，转换的时间可能是值得的。像这样的一些代码将把一个标准的CSV文件转换成有效的JSON…</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="1054" class="mu kx iq mq b gy mv mw l mx my">import pandas as pd</span><span id="2772" class="mu kx iq mq b gy mz mw l mx my">df = pd.read_csv ("my_file.csv", header='infer', sep=',')</span><span id="0c91" class="mu kx iq mq b gy mz mw l mx my">df.to_json ("my_file.json", orient='records', lines=True)</span></pre><h1 id="ab62" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">了解更多信息</h1><p id="2fa2" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">https://www.json.org/json-en.html<a class="ae kv" href="https://www.json.org/json-en.html" rel="noopener ugc nofollow" target="_blank"/></p><p id="08ad" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">https://json-schema.org<a class="ae kv" href="https://json-schema.org" rel="noopener ugc nofollow" target="_blank">(JSON模式)</a></p><p id="7f6f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><a class="ae kv" href="https://jsonschema.net" rel="noopener ugc nofollow" target="_blank">https://jsonschema.net</a>(生成模式的GUI工具，以JSON对象为例)</p><p id="24ee" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><a class="ae kv" href="https://www.jsonschemavalidator.net" rel="noopener ugc nofollow" target="_blank">https://www.jsonschemavalidator.net</a>(测试模式的GUI工具)</p><p id="f314" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><a class="ae kv" href="https://json-schema.org/implementations.html#validator-python" rel="noopener ugc nofollow" target="_blank">https://json-schema . org/implementations . html # validator-python</a>(应用JSON模式的Python库)</p></div></div>    
</body>
</html>