<html>
<head>
<title>Azure Data Factory Basic Concepts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure数据工厂基本概念</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/azure-data-factory-basic-concepts-e10448e54023#2022-01-06">https://towardsdatascience.com/azure-data-factory-basic-concepts-e10448e54023#2022-01-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""><h1 id="5832" class="pw-post-title io ip iq bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">Azure数据工厂基本概念</h1></div><div class=""><h2 id="b2fe" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">有很好的资源可以逐步学习ADF，但是很少有对其基本概念的清晰解释。本文填补了这一空白。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0d46ea614e679c951310e8cc73d882bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RVPRxqz2VUuY7NGXSXzmtw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在<a class="ae kv" href="https://unsplash.com/s/photos/data-factory?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kv" href="https://unsplash.com/@kmuza?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Carlos Muza </a>拍摄的照片</p></figure><p id="1191" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Azure Data Factory (ADF)是一个数据管道orchestrator和ETL工具，是微软Azure云生态系统的一部分。ADF可以从外部世界(FTP、亚马逊S3、甲骨文和更多的)获取数据，转换、过滤、增强数据，并将其移动到另一个目的地。在我为一个健康数据项目所做的工作中，我们使用ADF来驱动我们的数据流，从原始摄取到可以显示的完美分析。</p><p id="cabe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有很多学习ADF的好资源，包括<a class="ae kv" href="https://docs.microsoft.com/en-us/azure/data-factory/introduction" rel="noopener ugc nofollow" target="_blank">简介</a>和<a class="ae kv" href="https://docs.microsoft.com/en-us/azure/data-factory/quickstart-create-data-factory-portal" rel="noopener ugc nofollow" target="_blank">快速入门</a>。然而，当我开始使用ADF时，我没有找到对它所基于的基本概念的清晰解释。本文试图填补这一空白。</p><p id="8952" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让ADF为您做真正的工作涉及到以下几层技术，从您与之交互的最高层抽象一直到最接近数据的软件。</p><ul class=""><li id="53a3" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">Pipeline，您放置小部件和绘制数据路径的图形用户界面</li><li id="588a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">Activity，一个对您的数据做一些事情的图形小部件</li><li id="1104" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">源和接收器，活动中指定数据来源和去向的部分</li><li id="fd99" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">数据集，ADF可以操作的明确定义的数据集</li><li id="3017" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">链接服务，允许ADF访问特定外部数据资源的连接信息</li><li id="8de1" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">集成运行时，一个粘合/网关层，让ADF与自身之外的软件对话</li></ul><p id="cf3d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">理解每一层的用途以及它对整体ADF解决方案的贡献是使用好该工具的关键。我发现从靠近数据的底部开始，以相反的顺序考虑各层，最容易理解ADF。</p><h1 id="56db" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">集成运行时</h1><p id="e945" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">集成运行时提供了ADF和您需要的实际数据或计算资源之间的网关。如果您使用ADF来编组本机Azure资源，如Azure数据湖或数据块，那么ADF知道如何与这些资源对话。只需使用内置的集成运行时，不需要考虑它——不需要设置或配置。</p><p id="9c69" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，假设您希望ADF操作存储在您办公桌下的Oracle数据库服务器上的数据，或者您公司专用网络中的计算机和数据。在这些情况下，您必须使用自托管集成运行时来设置网关。</p><p id="ce3d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个屏幕截图显示了内置的集成运行时。它开箱即用，并且在您访问本机Azure资源时始终存在。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/b86dc503fde869079eaf0d95334d3202.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*K3gYvL0fLR4Nz-DH"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="906f" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">链接服务</h1><p id="f50d" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">一个链接的服务告诉ADF如何看到你想要操作的特定数据或计算机。要访问特定的Azure存储帐户，您需要为其创建一个链接服务并包含访问凭据。要读/写另一个存储帐户，您需要创建另一个链接的服务。为了允许ADF在Azure SQL数据库上操作，您的链接服务将声明Azure订阅、服务器名称、数据库名称和凭据。</p><p id="aa62" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该屏幕截图显示了最常见的Azure存储(Azure Data Lake Gen 2容器/blob)的标准链接服务。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/4bb493a5cb2107474a7c139ea1ff36b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/0*2oOIHSWNspSOQnQo"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="2255" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">数据集</h1><p id="28c6" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">数据集使链接的服务更加具体；它描述了你在存储容器中使用的文件夹，或者数据库中的表，等等。</p><p id="ae9f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该截图中的数据集指向一个Azure存储帐户的一个容器中的一个目录。(容器和目录名称在参数选项卡中设置。)注意数据集如何引用链接的服务。还要注意，这个数据集指定数据是压缩的，这允许ADF在您读取数据时自动解压缩数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/b4c0622f3de80e6038b6ca6e8b335684.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6pbwdUDqM8xPDFaT"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="171c" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">源和汇</h1><p id="b60b" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">顾名思义，源和接收器是数据的来源和目的地。源和汇是建立在数据集上的。ADF主要关心的是将数据从一个地方移动到另一个地方，通常在移动过程中会进行某种转换，因此它需要知道将数据移动到哪里。</p><p id="e87c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">理解数据集和源/汇之间模糊的区别是很重要的。数据集定义了特定的数据集合，但是源或接收器可以重新定义该集合。例如，假设DataSet1被定义为文件夹/Vehicles/GM/Trucks/。当一个源使用DataSet1时，它可以原样使用该集合(默认)，或者将集合缩小到/Vehicles/GM/Trucks/Silverado/或者扩展到/Vehicles/。</p><p id="6326" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据集范围和源/接收器范围之间的权衡涉及到巧妙的设计。我的做法是稍微宽泛地定义数据集(从而减少数据集的数量)，然后允许源和接收器缩小各自在特定情况下的需求。</p><p id="e5a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个源使用上面显示的压缩数据集，缩小它的范围，并确保只选择实际命名为*的文件。zip(否则解压缩会失败)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/c5252016b60a4c3143c7d2162e7b73ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*M1Ttlh9rVJ6BQCqt"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="a7a3" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">活动</h1><p id="a167" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">活动是数据工厂中的GUI部件，执行特定类型的数据移动或转换。有一个移动数据的CopyData活动，一个遍历文件列表的ForEach活动，一个选择文件子集的Filter活动，等等。大多数活动都有一个源和一个汇。</p><h1 id="25b0" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">管道</h1><p id="342c" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">ADF管道是您最直接使用的顶级概念。管道由活动和数据流箭头组成。您可以通过创建管道来编程ADF。您通过运行管道来完成工作，无论是手动还是通过自动触发器。您通过监控管道执行来查看工作结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/897a268b013d2a52b349bc528136612d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_XPMvkFkdXptsFYP"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="48f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该管道从初始数据湖文件夹中获取入站数据，将其移动到cold archive存储，获取文件列表，遍历每个文件，将这些文件复制到解压缩的工作文件夹中，然后根据文件类型应用额外的过滤器。</p><h1 id="60a5" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">结论</h1><p id="1998" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">本文描述了Azure数据工厂的基本概念和操作。ADF还能够进行更复杂的转换，比如在数据块中运行PySpark代码、调用自定义虚拟机、进行webhook调用等。移动和转换完成后，数据可以被传送到各种目的地，包括SQL数据库、普通文件系统和出站FTP。</p><p id="c16f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有关更多信息，请参见:</p><ul class=""><li id="f344" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><a class="ae kv" href="https://docs.microsoft.com/en-us/azure/data-factory/" rel="noopener ugc nofollow" target="_blank">https://docs.microsoft.com/en-us/azure/data-factory/</a></li><li id="de83" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">https://twitter.com/AzDataFactory<a class="ae kv" href="https://twitter.com/AzDataFactory?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor" rel="noopener ugc nofollow" target="_blank"/></li></ul></div></div>    
</body>
</html>