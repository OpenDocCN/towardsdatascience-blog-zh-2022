# 开发软件:使用 Linux，即使是在 Windows 中

> 原文：<https://towardsdatascience.com/developing-software-use-linux-even-in-windows-62dfaff0c3e3>

## 使用相同的操作系统进行*开发*，测试和部署

![](img/efd982666d06ba580d868ec73639a879.png)![](img/efd982666d06ba580d868ec73639a879.png)![](img/efd982666d06ba580d868ec73639a879.png)

在开发、测试和生产中使用相同的环境，因此对于*开发*，测试和部署。由[托尔加·乌尔坎](https://unsplash.com/@tolga__?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 拍摄的照片

下面的六个词构成了今天的故事:

> 在 Linux 中部署？在 Linux 中开发。

这比乍看起来更重要——对任何软件来说，数据科学产品也不例外。

有些人可能认为开发环境并不重要，特别是当项目中使用的编程语言可以在任何操作系统下工作时。但事实远不止如此。

即使你的编程语言可以在任何操作系统中工作，也不意味着它在所有操作系统中的工作方式都是一样的。有时候差异可能不会太大；有时候是这样的。这就像说所有的汽车都以非常相似的方式工作。基本上是这样，但这是否意味着你会使用沙漠环境来开发一辆在斯堪的纳维亚国家使用的汽车？当然不是。在这两种情况下，都需要四轮驱动，但在沙漠中工作良好的汽车可能在严冬条件下工作不太好。也许会，但你不能确定，是吗？

对于软件，事情以类似的方式工作。如果你想开发一个好的产品部署在一个特定的环境中，你应该在尽可能相似的环境中开发它。在 IT 部门，通常不可能重新创建一个生产环境，尤其是当该环境已经运行了相当长一段时间，并且为其客户提供了许多不同的软件产品时。尽管如此，通常还是有可能创建一个类似的环境，而且越类似于生产环境越好。

虽然这个主题很笼统，但本文将集中讨论这个故事的一个方面——但也是最重要的一个方面:操作系统。更准确地说，我将关注开发人员的*工作方式*，并考虑以下问题:当产品将被部署在 Linux 环境中时，我是否应该，或者我是否能够在 Windows 中进行开发？

为了简单起见，我将集中讨论这两个操作系统，原因有二。第一，在行业中，这两者在软件项目中频繁混用。第二，我对这两个操作系统有经验，但对其他操作系统经验不多。根据我开发数据科学软件的经验，在 Windows 机器上开发并部署到 Linux 是很常见的。这就是我几年来的工作方式。而这是*没什么好怕的*，只要你知道怎么做。

当提到三种类型的环境之一时，我将使用以下缩写:

*   DEV for 开发环境，
*   测试测试环境，以及
*   生产环境产品。

# **为什么？**

我想你会同意我的观点，在 IT 领域，开发和生产环境中最重要的一个方面是操作系统。通常情况下，它将是环境中最重要的方面*，在开发、测试和部署时会产生很大的影响。*

不成文的规定如下:

> 在尽可能接近生产环境的环境中开发和测试代码。

注意，规则并不严格。它没有说*同样的环境*，而是*一个尽可能接近生产环境的环境*。由于这个细节，这个规则给了你相当大的调整余地。您可以根据具体情况，尤其是项目所拥有的资源来使用这种余量。但是*如果你不想冒险让这个项目给你带来超出你所能接受的麻烦，尽量不要过度使用这个余量*。如果你真的过度使用保证金，那你就活该头疼，除非你这么做是因为别人让你这么做的。我曾经遇到过这种情况，我非常头疼，因为我得到的开发资源有限，没有任何测试资源。

我想说，这条规则不仅仅与编程或 IT 相关。这是一个相当普遍的规则，类似于我们在科学中发现的许多类似的规则——就此而言，在我们的生活中也是如此。

为了说明这一点，让我给你看一个完全不同的例子。想象你正在开发一种新的植物除草剂。你应该在它将被应用的环境中开发它。让它成为一种用于谷类植物的除草剂。如果是这种情况，那么你不应该想在果园里进行实验(这是开发过程的一部分)，而是用谷物——以及不同的谷物品种，就此而言，不只是一种。此外，你永远不应该把除草剂当作肥料、食品配料或飞机燃料来测试。不，你应该在尽可能接近最终产品的环境中开发和测试产品。

在我们软件开发的舒适区的背景下，应该如何理解这一点？正如你将在下一句中看到的，我们应该以非常相似的方式来理解它。当开发一个软件产品时——不管这个产品是什么——你应该在一个类似于生产环境的环境中开发和测试它。

为什么不能直接用生产环境本身来开发和测试产品呢？当我们已经在使用这种环境时，这难道不是最简单的方法吗(这在行业中是常有的事)，也是最好的方法*？您几乎永远无法重新创建生产环境，除非是一个全新的环境。那么，为什么不使用它而不是重新创建它呢？*

*事实上，这个*看起来是目前为止最好的解决方案:产品将在它将被部署的相同环境中被开发。这样，在开发过程中就已经知道产品将如何在这个环境中工作，可能会发生什么样的问题(如果有的话)，等等。没有其他环境能给我们提供这样的信心，使我们相信产品在生产中会很好地发挥作用。**

*即使这种方法可能很诱人…它不仅不是最好的，而且可能非常危险。在我看来，只有在极少数情况下，当你完全没有其他选择的时候，你才应该选择这个解决方案。在开发软件的时候，我们总是可以对开发环境做一些改变，甚至打破它。有时，要恢复环境，您需要从头重新安装。这就是为什么我们不应该在生产环境中开发的原因:虽然破坏开发或测试环境是每个人都接受的风险，但是破坏生产环境会带来不可接受的风险，尤其是当生产环境已经被其他软件产品使用时。*

*这就是为什么软件通常在开发环境中开发，在测试环境中检查，然后在生产环境中部署。这给了我们自然的顺序`DEV → TEST → PROD`，尽管大多数项目包括混合了三个步骤中的两个，通常是`DEV ↔ TEST`和`TEST ↔ PROD`。*

*不幸的是，现实常常强加限制，迫使软件开发者适应有限的资源。我们经常被迫在两种环境中工作:开发和生产。如果你不幸发现自己在这样的项目中，你必须选择其中的哪一个应该成为测试环境。不幸的是，这两种解决方案都不好——说实话，最终，这类项目的测试阶段并不是真正的测试。虽然涉及到一些测试，但这不是真正的产品测试，除非你能在生产环境中执行。我说过，这是，*也应该是*，业内非常罕见的情况。*

*这三个环境(包括测试)的可用性对于有重要时间限制的项目特别有用。在我过去的一个项目中，我必须检查一个附加包的重新安装。不幸的是，当我这样做时，新版本的包破坏了测试环境。要再次使用它，我必须完全重新安装，但由于时间限制，这是不可能的。因此，在这里我使用开发环境进行开发和测试。但是，如果这发生在只有两个环境(DEV 和 PROD)的项目中会怎么样呢？我将不得不重新安装开发，没有时间了；除了夜以继日地工作，我还有什么选择呢？幸运的是，我是一个幸运的开发人员，有三个环境可以使用。因此，我能够在开发环境中完成产品，尽管我没有真正的可能性来测试产品。我直接从开发转到生产，由于产品的复杂性，这让我很不舒服。此外，在开发期间，开发环境经历了产品环境中没有的小的修改；直到我在 PROD 上完成安装并尝试运行该应用程序的那一刻，我才意识到这一点。最终，在额外的工作之后，一切都结束得很好，我完成了这个项目，并获得了一些重要的经验，从那以后我一直在使用这些经验。拥有三个环境总是一件好事:开发、测试和生产；在 DEV 上开发，然后在 test 上测试，只有在一切就绪后，才在 PROD 中部署。*

*让我们总结一下*为什么？*这里的部分解释了为什么我们应该在尽可能接近生产的环境中开发。为此，让我们使用上面使用的更具体的场景，即 Windows 对 Linux 开发。*

*当你正在开发的软件产品要部署在 Linux 机器上、云中或任何地方时，你应该用 Linux 开发代码。我猜在业界，Linux 是*几乎总是*的生产操作系统。在我们创建软件解决方案的 20 多个数据科学项目中，我记得只有一个项目我们必须将解决方案部署到 Windows 服务器上。这不是一开始就计划好的，而是一系列事件的意外结果。*

*总而言之，作为一名软件开发人员，你应该尽最大努力在尽可能接近计划生产环境的环境中开发和测试软件产品——而不是要部署产品的*实际*生产环境。*

*这基本上意味着，无论何时您在一个项目中工作，其中的解决方案将在 Linux 中部署，您也应该在 Linux 中开发和测试代码。*

# *怎么会？*

*我想前一部分现在对你来说非常有意义。是吗？*

*应该的。这是它应该如何工作。但是很多时候，不管是在小公司还是大公司，甚至是最大的公司，情况都不是这样。*

*假设我们的小公司雇佣了 2-3 名开发人员和大约 10 名其他人员。不是 It 公司，是用的多的公司；比方说，它应用数据科学来支持它的研究，然后将它的结果呈现给外人。它的软件产品是数据科学产品，因此它们使用户能够为他们的数据运行一些模型。*

*像往常一样，该公司的员工使用装有 Windows 操作系统的笔记本电脑。然而，由于规模太小，该公司没有足够的资源来维护自己的服务器，以部署和维护他们的产品。因此，他们转而租用服务器和各种云服务。*

*我想你已经明白我的意思了。开发人员在 Windows 笔记本电脑上工作，但是在 Linux 环境中部署他们的产品。这不是他们的选择；这是他们仅有的资源。他们很少能使用他们的私人资源，即使他们想用(我不会)，所以他们被迫使用他们所拥有的。对于开发，该资源是一台 Windows 笔记本电脑——这台笔记本电脑就是我们应该考虑的开发环境。*

*他们应该如何进行？*

*我们可以列出很多方法，但我将强调其中的两种。人们使用一种时下流行的工具，集装箱化。然而，这不是你通常认为的标准集装箱化。当我设想容器时，我通常看到它们在 PROD 环境中实现。在这里，我们将讨论用于开发的容器，它们不同于 PROD 中使用的容器。当我们讨论*开发容器*时，请记住这一点。*

*第二种方法提供了第一种方法所没有的工作便利性。当在 Windows 机器上使用 Linux 时，这是可行的——但不使用虚拟机，因为这种方法，至少在我看来，很不方便。相反，这种方法使用 Linux 的 Windows 子系统(WSL)。我一直在使用它，在我几乎所有的项目中——我非常重视它。*

*在这两者之间，容器化使您能够使用类似的环境来生产。由于 WSL 使用安装在您机器上的 Linux 子系统，模拟 PROD 操作系统是非常困难的，通常是不可能的，特别是对于几个项目。WSL 的主要好处是它可以在大多数项目中使用，但是这个优点很容易变成一个缺点。一旦我们完成了开发容器，我们将回到这个方法。*

## *开发容器*

*如前所述，它们与生产容器不同:前者用于在 DEV 环境中开发产品，而后者用于在 PROD 环境中安装产品(及其环境)。*

*开发容器提供了一个专用的开发环境。在这里，您可能有单元测试，这在生产容器中是不需要的。同样，您可能需要一些在生产中不需要的附加包。通常，开发容器的组织方式不同于生产容器。简单地说，组织它们就像在本地机器上开发代码一样，没有容器。*

*考虑下面的例子。您开发您的代码，以便一旦代码准备好就可以打包。因此，您的开发容器将包含一个文件夹，您将在其中保存要打包的代码。另一方面，您的生产容器将*而不是*包含这些原始代码。相反，这个包将从包注册中心安装到生产容器中。这导致两种类型的容器具有非常不同的组织结构。*

*通常，您的开发容器将提供与生产容器环境相似的环境。但是，它可以包含 PROD 中不需要的其他工具。因此，在开发环境中运行良好的代码不一定要在生产环境中以同样的方式运行——您需要检查这一点。然后你可以*测试*生产容器，为此，有一个测试环境是很好的。*

*在我看来，开发容器非常有意义，而且非常有帮助。然而，它们有一个明显的缺点:使用它们很困难。一方面，容器应该在不同的机器上以相同的方式运行。另一方面，它们会造成一些困难，尤其是在几台 Windows 机器上使用时；机器越多，发生意外的风险就越大。有时它可能是非常小的事情，但找到解决方案可能比看起来要困难得多。*

## *用于 Linux 的 Windows 子系统(WSL)*

*[WSL](https://learn.microsoft.com/en-us/windows/wsl/about) 提供了一个在 Windows 操作系统中模拟 Linux 的好方法。用了好几年了，很欣赏。*

*当您选择安装了 WSL 的 Windows 机器时，您可以同时使用 Windows 和 Linux。在许多项目中，您可能需要能够使用 Windows。当你别无选择，必须使用 Windows 机器时(这可能是由于公司资源的原因)，WSL 是开发人员的绝佳选择，因为正如我之前提到的，大多数软件产品都部署在 Linux 中。*

*许多用户没有选择，但是我有:我可以选择 Linux 机器。而是选择了 Windows 机，我这么做是有原因的。我这样做是因为有时出于各种原因，我不得不使用 Windows。在这种情况下，Linux 机器没有任何帮助。所以，我有了 Windows——感谢 WSL，我也有了 Linux。如果我没有使用 WSL 的可能性，我会更喜欢使用 Linux 机器。但是自从我可以使用 WSL 以来，我完全可以使用 Windows 笔记本电脑。*

*我知道，这很重要。WSL 不是 Linux。它没有真正的 Linux 快。可能存在差异，有些差异不如其他差异显著。但是，作为一个开发代码的人，所有这些对我来说并没有什么大问题。例如，WSL 没有 Linux 快？我开发代码，而不是运行它；所以，这对我来说根本不是问题。其他问题？是的，我遇到过一些小问题(例如，行尾)，但是它们太容易解决了，我甚至都不记得了。坦白地说，我确实遇到了一个关于行尾的大问题，但是是在…一个开发容器中！*

*在 Windows 机器上使用 WSL 还有一个好处。当你开发一个可以在两个操作系统中使用的产品时，你应该在两个操作系统中检查你的产品。虽然 WSL 当然不是真正的 Linux(尽管 WSL 2 确实有一个 Linux 内核)，但是当某些东西在 WSL 中工作时，它很可能也在 Linux 中工作。例如，我已经编写或合作编写了四个开源包( [easycheck](https://github.com/nyggus/easycheck/) 、 [makepackage](https://github.com/nyggus/makepackage) 、 [perftester](https://github.com/nyggus/perftester) 和[rounder](https://github.com/nyggus/rounder))；我在 WSL 中处理了每一个问题，然后在 Windows 中检查了每一个问题。*

*总而言之，当你在 WSL 中开发时，你可以在一个将要开发产品的操作系统中开发(除非这个 OS 没有 WSL 版本)。一旦完成了 WSL 的安装，一切都变得简单了。最重要的 ide 与 WSL 合作。我使用 Visual Studio 代码，由于专用的 WSL 扩展，它工作得非常好。当我在 WSL 中开发时，我有在 Linux 中开发的相同感觉。*

*老实说，现在我已经好几年没有在 Windows 上开发任何有意义的东西了，我感觉自己像个 Linux 迷。每当我转移到生产环境时，几乎总是在 Linux 中，一切都感觉很自然。如果你曾经试图在 Windows 中开发一个可以在 Linux 中部署的产品，你应该明白我的意思。我去过那里，那种感觉并不好。就好像产品内部的某些东西似乎是错误的，可能会导致大问题。WSL 是一种很好的止痛药，它让我作为开发人员的生活变得更好；实际上，是为了更好。*

# *开发容器还是 WSL？*

*我和他们都合作过。虽然很难说哪个更好，但我知道我更喜欢哪个。这也是为什么我会把重点放在我的喜好上，并解释它们。然后你可以自己决定什么对你的项目更好。*

*老实说，如果没有我信任的 DevOps，我不会选择开发容器。我甚至不知道如何开始！有了一个好的 DevOps，开发容器可能是最好的解决方案——但是有时会减慢你的编码工作。在这种情况下，除非你知道如何解决这样的问题，否则你可能会感到非常沮丧，因为简单的事情似乎无法用简单的解决方案来解决，而你*几乎肯定这些解决方案会奏效*。*

*我记得在一个项目中，我们的 DevOps 在一个两人数据科学团队中编排开发容器，加上他自己作为第三个成员。虽然他对此没有问题(向他致敬！)，我们确实遇到了一些问题，他不得不时不时地帮助我们。有一两次，我不得不重新构建整个容器，因为事情停止工作，没有特别的原因，只有重新安装似乎有所帮助。对我来说，这是一项艰难的工作。我们所有人都必须使用 [Visual Studio 代码](https://code.visualstudio.com/docs/devcontainers/containers)(这对我来说不成问题，因为我以前就用过)，以及一些与容器相关的扩展。*

*我确实记得我在那个项目中遇到的一个重大而不寻常的问题。DevOps 最终找到了问题的根源，那就是 Git。我使用安装在 WSL 中的 Git，这是我一贯的做法。很明显，这个 Git 工具没有很好地与我们的开发容器配合。相反，我应该使用 [Git bash](https://git-scm.com/downloads) 。在我开始使用那个之后，所有这些问题都消失了。我不喜欢这种奇怪的问题。对我来说，这个例子表明开发容器可能很精致——对我的开发人员来说太精致了。*

*总而言之，我认为开发容器提供了一个很好的解决方案，但是对于没有丰富 DevOps 知识的人来说太难了。没有它，任何安装和更改看起来都很困难。如果你遇到一个更大的问题，你可能会觉得自己很无助，就像我在上面描述的项目中几次遇到的那样。*

*另一方面，WSL 提供了一个简单得多的解决方案。要在您的机器上安装它，您不必是 DevOps。在过去的几年里，我在 WSL 中没有遇到任何我自己不能解决的问题。这表明基于 WSL 的解决方案比开发容器更容易使用。*

*然而，WSL 并不是没有代价的。它提供给你一个 Linux 替代品，仅此而已。在那里安装了许多包，在 WSL 和生产容器中有完全相同的环境的可能性很小。因此，使用 WSL 意味着在 Linux 中工作，而不是在相同的——甚至是非常相似的——环境中工作。*

*因此，WSL 是否适合您取决于各种因素，其中最重要的两个因素是您的技能和项目本身。在许多情况下，当次要的细节不那么重要时，它可以是你的解决方案。但是如果他们这样做了，开发容器可以给你提供一个更大的机会，让你的产品运行良好。*

*我们讨论了在`DEV → TEST → PROD`链中开发软件产品的两种方法，但是还有其他方法。我描述了两个我知道并使用过的。如果你知道并使用其他方法在 Windows 下的开发环境*中开发软件产品，但该产品将部署在 Linux* 下的生产环境*中，那么请在评论中描述它。**

*你也可能对使用开发容器和 WSL 有不同的看法。请也在评论里分享一下吧。这篇文章旨在收集知识和观点，并将其传达给其他人，但这个话题很容易带有主观性——对我有效的不一定对你有效。*

*感谢阅读这篇文章。我意识到它比平常少了很多技术性，但这并没有降低它的重要性。事实上，我们已经触及了非常重要的话题。你看，`DEV → TEST → PROD`软件开发链构成了任何软件项目的本质。在一些项目中，它被改变了；例如，没有测试或者有一个额外的预生产(我们可以称之为`PRE-PROD`)环境。*

*您如何组织环境会产生影响，有时这种影响比您在编码过程中需要决定的一些特定的技术细节要大得多。因此，千万不要忽视`DEV → TEST → PROD`基础设施的重要性！*

# *资源*

*[](https://learn.microsoft.com/en-us/windows/wsl/about)  [](https://code.visualstudio.com/docs/devcontainers/containers) *