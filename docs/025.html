<html>
<head>
<title>3 Tricky Data Analysis Questions and How to Solve Them with Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">3个棘手的数据分析问题以及如何用熊猫解决它们</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-tricky-data-analysis-questions-and-how-to-solve-them-with-pandas-ceb53bbb9c9e#2022-01-02">https://towardsdatascience.com/3-tricky-data-analysis-questions-and-how-to-solve-them-with-pandas-ceb53bbb9c9e#2022-01-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""><h1 id="09e8" class="pw-post-title ir is it bd iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp bi translated">3个棘手的数据分析问题以及如何用熊猫解决它们</h1></div><div class=""><h2 id="2f3a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Pandas简化并加速了复杂的任务</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4f9e4939e70a578344cf26134a9478df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fWPTwnLBSgrKVb3uqAvdvw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">micha Parzuchowski在<a class="ae ky" href="https://unsplash.com/s/photos/tricky?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="c2f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas是数据科学生态系统中使用最频繁的库之一。它非常灵活和高效，几乎可以为您可能遇到的任何数据分析和操作问题提供解决方案。</p><p id="6717" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将讨论3个相当棘手的数据分析和操作问题，并看看如何用熊猫来解决它们。</p><p id="8840" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些问题将与我用模拟数据创建的数据集相关。请随意从我的GitHub <a class="ae ky" href="https://github.com/SonerYldrm/datasets" rel="noopener ugc nofollow" target="_blank">页面</a>下载并跟随。我们将使用杂货数据集。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1879" class="ma mb it lw b gy mc md l me mf">import pandas as pd</span><span id="772e" class="ma mb it lw b gy mg md l me mf">grocery = pd.read_csv("groceries.csv")</span><span id="6a87" class="ma mb it lw b gy mg md l me mf">grocery.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/9294b52aab2598aa1c647fc26f2965e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lAbagUPCWTyLnA9OXWVkDA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="96be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该数据集包含一些带有每日销售量和价格信息的杂货产品。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="8909" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">问题1</h2><p id="4615" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">价格列包含一些丢失的值。我们如何用产品的平均价格来替代这些缺失的值呢？请注意，我们不应该用价格列的平均值来填充缺少的值。苹果的缺失值需要用苹果的平均价格来填充，等等。</p><h2 id="3515" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">解决方案1</h2><p id="1946" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">有多种方法可以完成这个操作。最实用的选择之一是在<code class="fe nl nm nn lw b">fillna</code>函数中使用<code class="fe nl nm nn lw b">groupby</code>函数。</p><p id="47b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们先来看看每个产品的均价。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a7be" class="ma mb it lw b gy mc md l me mf">grocery.groupby('product_description')['price'].mean()</span><span id="f2b0" class="ma mb it lw b gy mg md l me mf"># output<br/>product_description<br/>apple           2.077778<br/>butter-0.25    11.400000<br/>cucumber        4.532857<br/>grape           4.400000<br/>milk-1.5        6.078571<br/>onion           2.150714<br/>orange          2.714286<br/>plum            4.389655<br/>tomato          3.121034<br/>yogurt-1        6.693103<br/>Name: price, dtype: float64</span></pre><p id="f2b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是我们不能在<code class="fe nl nm nn lw b">fillna</code>函数中使用这行代码。相反，我们将通过添加<code class="fe nl nm nn lw b">transform</code>方法来稍微改变它。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2f0a" class="ma mb it lw b gy mc md l me mf">grocery["price_new"] = grocery['price'].fillna(<br/>   grocery.groupby('product_description')['price'].transform("mean")<br/>)</span></pre><p id="891a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们通过比较price列中缺少的值和新列中的值来检查结果。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="c280" class="ma mb it lw b gy mc md l me mf">grocery[grocery["price"].isna()].head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/6e6b11749c87fdde2df1fd20a9cde076.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DP5-ZKaNj0UTaLZySr782A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="8bb9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">番茄的缺失值用3.12填充，这是我们之前计算的平均值。类似地，黄瓜和洋葱的缺失值用正确的平均值填充。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="2144" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">问题2</h2><p id="f142" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">如何才能找到每个产品的最高价和最低价的区别？</p><h2 id="6aa1" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">解决方案2</h2><p id="f1d4" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">当然，完成这项任务有多种方式。<code class="fe nl nm nn lw b">groupby</code>函数也为这个任务提供了一个快速的解决方案。我们不需要使用内置的聚合函数，只需要编写自己的函数。</p><p id="3586" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在根据产品描述列对行进行分组之后，我们将应用一个lambda函数来计算最大值和最小值之间的差值。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="0e8b" class="ma mb it lw b gy mc md l me mf">grocery.groupby("product_description")["price"].apply(<br/>    lambda x: x.max() - x.min()<br/>)</span><span id="ba10" class="ma mb it lw b gy mg md l me mf"># output<br/>product_description<br/>apple          0.3<br/>butter-0.25    1.0<br/>cucumber       0.4<br/>grape          0.0<br/>milk-1.5       0.5<br/>onion          0.3<br/>orange         0.3<br/>plum           0.8<br/>tomato         0.6<br/>yogurt-1       1.0<br/>Name: price, dtype: float64</span></pre><p id="7eeb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们检查最高和最低苹果价格之间的差异，以确认我们的结果。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="fa43" class="ma mb it lw b gy mc md l me mf">max_apple = grocery[grocery.product_description=="apple"]["price"].max()</span><span id="7b17" class="ma mb it lw b gy mg md l me mf">min_apple = grocery[grocery.product_description=="apple"]["price"].min()</span><span id="a43c" class="ma mb it lw b gy mg md l me mf">max_apple - min_apple</span><span id="c7aa" class="ma mb it lw b gy mg md l me mf"># output<br/>0.30</span></pre><p id="78fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它等于苹果在<code class="fe nl nm nn lw b">groupby</code>函数输出中的差值。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="329c" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">问题3</h2><p id="f34b" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我们如何创建一个销售金额列来显示每次销售中销售了多少产品(以千克为单位)。</p><p id="0bd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有些产品的单位是千克，所以我们可以只取它们的销售数量列中的值。然而，有些产品是按件出售的。这些产品的重量信息可从描述中提取。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d3c8" class="ma mb it lw b gy mc md l me mf">butter-0.25  # 0.25 kg<br/>milk-1.5     # 1.5 kg<br/>yogurt-1     # 1 kg</span></pre><h2 id="f528" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">解决方案3</h2><p id="507f" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">对于以千克为单位的产品，销售金额值将与销售数量值相同。</p><p id="62ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于按件销售的产品，我们需要从描述中提取kg信息，并乘以销售额。</p><p id="7e95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用<code class="fe nl nm nn lw b">where</code>函数有条件地更新这些值。可以通过使用<code class="fe nl nm nn lw b">st</code>访问器下的<code class="fe nl nm nn lw b">split</code>函数提取重量信息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/8acc08d6f0d9b232e37d68b7f1eaefd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZkSvEf3_qSx9jylRx0FdRw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="0381" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我不想将代码显示为文本，因为在纯文本中它看起来有点复杂。</p><p id="9bd1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nl nm nn lw b">where</code>功能接受一个条件或一组条件。然后，我们可以为符合和不符合条件的行分配单独的值。</p><p id="be43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个条件是在第一个<code class="fe nl nm nn lw b">where</code>函数里面指定的。符合条件的行保持不变。因此，没有片段单元的行将保持不变。</p><p id="2f3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二行和第三行指定如何更新不符合条件的行。第二行从产品描述中提取重量信息。在第三行，这个值乘以销售数量。</p><p id="8ced" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们检查一些结果。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2838" class="ma mb it lw b gy mc md l me mf">grocery.tail()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/b558d1de1887d9494758c6e68921a8e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AN8Vk6uQim0iaOG48fW2kQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="eaba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“黄油-0.25”重0.25公斤。在最后一行，销售数量是36，所以销售额需要是0.25 * 36，等于9。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="28e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas是一个非常棒的数据分析和处理库。它提供了许多功能，简化和加快甚至复杂的任务。</p><p id="4ba1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想在我发表新文章时收到电子邮件，别忘了订阅。</p><p id="a25d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nr">你可以成为</em> <a class="ae ky" href="https://sonery.medium.com/membership" rel="noopener"> <em class="nr">媒介会员</em> </a> <em class="nr">解锁我的全部写作权限，外加其余媒介。如果您使用以下链接，我将收取您的一部分会员费，无需您支付额外费用。</em></p><div class="ns nt gp gr nu nv"><a href="https://sonery.medium.com/membership" rel="noopener follow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd iu gy z fp oa fr fs ob fu fw is bi translated">通过我的推荐链接加入Medium-Soner yl DRM</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">sonery.medium.com</p></div></div><div class="oe l"><div class="of l og oh oi oe oj ks nv"/></div></div></a></div></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="213e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>