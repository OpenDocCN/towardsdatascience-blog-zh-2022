# 掌握 Python 理解

> 原文：<https://towardsdatascience.com/master-python-comprehensions-4ef1c66b452d>

## 以简单性和可读性为目标编写代码

![](img/f36b423d800c0efa89fccd3c482d5b7f.png)

照片由 Unsplash 的 Ksenia Makagonova 拍摄。

Python 最显著的优势之一是它是一种高度表达的语言。没有太多的样板文件，开发人员可以想出优雅的解决方案，如果结构良好，读起来就像一个故事。

这就是语言之美，在 Python 的[禅](https://peps.python.org/pep-0020/)中得到了很好的展现。如果我必须强调其中的一句话，那就是“简单胜于复杂”。我们应该尽可能地坚持这样一条黄金法则，即代码被阅读的次数要比它被编写的次数多得多，无论是被作者、同事还是外部贡献者阅读。因此，直截了当，避免华丽的辞藻，帮助你的队友和未来享受你今天写的东西。

这篇文章将遵循这一思想，通过一系列例子介绍处理数据时最常见的任务之一:转换列表，重点关注简单性和可读性。

# 环

语句是 Python 的控制流工具之一，可以帮助我们迭代序列中的项目。在每一步中，我们都拥有原始数据中的一个元素。

第一个示例是将一系列数字中的偶数元素加 1。

虽然这是一个相对简单的问题，但我们需要执行多个操作:

1.  实例化一个空列表。
2.  迭代`data`的每个元素。
3.  检查元素是否是偶数。
4.  在每一步更新`added`对象。

它完成了工作，但是我们可以使代码更紧凑，更容易理解。我们的主要目标是通过浏览代码来传达我们的意图。

# 地图和过滤器

**高阶函数**接受函数作为参数或者返回函数作为结果。这有点拗口，但是利用 Python 允许我们像对待任何其他对象一样对待函数是很重要的。

`map`将帮助我们在序列的每个元素上运行一个函数，而`filter`添加了跳过某些项目的逻辑。为了简单起见，我们将使用`lambda`来编写我们的函数，但是这个例子也将使用命名定义。

从这个片段中重要的是，能够编写一行程序并不意味着我们应该这样做。

请注意理解最后几行中发生的事情是多么容易，以及编写有意义的名称**的重要性。人们可能不理解`filter`是做什么的，但是通过使用名称`even`,我们帮助我们的读者继续下去，而不要跳到任何实现细节。按照这个逻辑，我应该在这里做得更好，并且在 lambda 表达式中使用`num`而不是`x`。**

# 列表理解

Python 中我最喜欢的特性之一是**理解**。它们在简单直接地表达转换方面非常出色，开发人员可以通过使用不同的符号将这些转换应用于列表、集合、字典和生成器。

我们可以定义集合，并通过函数和条件动态地构建它。

请注意，阅读这段代码时主要关注的是实际的逻辑。一眼就能看出代码的**目的**是什么。然后，我们可以包装这个逻辑，将`data`对象转换成不同的结构。

我发现自己在理解中反复使用的一个小技巧是从一个列表中提取一个元素，如果它存在的话。

这个要点提取理解逻辑，并把它变成一个*迭代器*。在内部，Python 使用`next`从迭代器中的一个元素跳到另一个元素。因此，我们可以应用我们的过滤逻辑，返回我们感兴趣的元素，或者获取它，或者如果它不存在，获取`None`。这种方法让我们可以在代码的后面优雅地处理类型提示和条件。

回到理解。这是否意味着我们应该为循环 或更高阶的函数抛弃*？一点也不。开发人员需要评估不同方法的逻辑有多复杂。每种工具都有它的位置，有了经验，人们就会知道哪种设计变得**更容易维护。***

# 三元运算符

我们已经看到了如何使用条件来过滤掉元素。然而，另一种典型的做法是将条件直接应用于每个元素，作为转换的一种方式。三元运算符有助于我们做到这一点。

通过检查每个元素，我们已经根据项目的属性将数字列表转换为字符串列表。这种情况可能看起来过于简单，但是将这种逻辑与过滤和数据描述符(如 [Pydantic](/how-to-make-the-most-of-pydantic-aa374d5c12d) )组合在一起就成了一个极好的方法。

可读性强、直截了当的永远是赢家。在这种情况下，它比其他选择更优雅。不是因为它更短，而是因为它更好地传递了代码的目的。

# 赋值表达式

我们将以一个来自 [PEP 572](https://peps.python.org/pep-0572/) 的精彩附加节目来结束这个节目。Python 3.8 中提供的赋值表达式允许开发人员为表达式结果命名(赋值变量)，这在处理理解时特别有用。

让我们想象一个函数，它可能为一些输入返回`None`。然后，我们需要将该函数应用于给定的列表，并过滤掉缺失的值。

简单的方法意味着运行该函数两次:

1.  首先，检查输出是否为用于滤波的`None`,以及
2.  然后，存储有效的返回值。

如果函数需要很长时间来运行或者需要一些外部组件，我们应该完全避免这种方法，因为执行两次这个过程是不可能的。

然而，使用赋值表达式(又名 walrus 操作符)，我们可以获得理解的所有好处，而不会牺牲函数方面的任何性能。该函数只执行一次，我们可以在本地使用`res`变量来构建结果列表。

# 结论

Python 是一种非常灵活的语言:有很多途径可以达到相同的结果。因此，了解可供我们选择的方案至关重要。否则，[如果你有锤子，一切看起来都像钉子](https://en.wiktionary.org/wiki/if_all_you_have_is_a_hammer,_everything_looks_like_a_nail)。

在这篇文章中，我们看到了如何使用以下方法过滤和转换数据的不同选择:

*   对于循环，
*   映射和过滤，以及
*   三元运算符和赋值表达式的理解。

难的是没有金科玉律。我们需要找到传达我们意图的最佳方式。这不是聪明的问题，而是清晰的问题。