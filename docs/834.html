<html>
<head>
<title>Convert Images to Tensors in Pytorch and Tensorflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Pytorch和Tensorflow中将图像转换为张量</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/convert-images-to-tensors-in-pytorch-and-tensorflow-f0ab01383a03#2022-01-31">https://towardsdatascience.com/convert-images-to-tensors-in-pytorch-and-tensorflow-f0ab01383a03#2022-01-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""><h1 id="9a0c" class="pw-post-title ir is it bd iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp bi translated">在Pytorch和Tensorflow中将图像转换为张量</h1></div><div class=""><h2 id="117e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">学习以本机方式转换数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9fc169f0bd974333234241a24b7b7fbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fklybe93ULp4MPMRK1y3Fw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/s/photos/machine-learning?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@herfrenchness?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Clarisse Croset </a>拍摄的照片</p></figure><p id="e36f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所知，张量代表了你的机器学习项目的构建模块。它们是不可变的，只能被创建，不能被更新。处理张量是复杂的，因为它在很大程度上依赖于你使用的框架，并且没有关于如何编码它的标准化。</p><p id="800c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，您将经常陷入这样一种情况，即您必须执行自定义操作，例如从Pytorch转换到Tensorflow或改变张量的维度。</p><p id="ea1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，您将学习:</p><ul class=""><li id="dbac" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">在Pytorch和Tensorflow框架中将图像转换为张量</li><li id="a50e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">使用<code class="fe mj mk ml mm b">torch.permute</code>改变Pytorch张量的维度顺序</li><li id="bb5c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">使用<code class="fe mj mk ml mm b">tf.transpose</code>改变张量流张量的维度顺序</li><li id="3507" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">将张量从Pytorch转换为Tensorflow，反之亦然</li></ul><p id="b169" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们继续下一节，开始安装所有必要的Python包。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="597d" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">设置</h1><p id="2f05" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">强烈建议您在继续安装之前创建一个新的虚拟环境。</p><h2 id="f65c" class="nr mv it bd mw ns nt dn na nu nv dp ne li nw nx ng lm ny nz ni lq oa ob nk oc bi translated">Pytorch</h2><p id="2ba7" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">运行以下命令来安装<code class="fe mj mk ml mm b">torch</code>和<code class="fe mj mk ml mm b">torchvision</code>软件包。</p><pre class="kj kk kl km gt od mm oe of aw og bi"><span id="4561" class="nr mv it mm b gy oh oi l oj ok">pip install torch torchvision</span></pre><p id="20dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mj mk ml mm b">torchvision</code>是一个基本的软件包，它提供了相当多的图像<a class="ae ky" href="https://pytorch.org/vision/stable/transforms.html" rel="noopener ugc nofollow" target="_blank">变换功能</a>，如调整大小和裁剪。</p><h2 id="7b02" class="nr mv it bd mw ns nt dn na nu nv dp ne li nw nx ng lm ny nz ni lq oa ob nk oc bi translated">Python图像库</h2><p id="1f61" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">此外，您需要安装Python图像库(PIL ),它在加载您的图像时补充了<code class="fe mj mk ml mm b">torchvision</code>。您可以按如下方式安装它:</p><pre class="kj kk kl km gt od mm oe of aw og bi"><span id="1caf" class="nr mv it mm b gy oh oi l oj ok">pip install Pillow</span></pre><h2 id="2fbc" class="nr mv it bd mw ns nt dn na nu nv dp ne li nw nx ng lm ny nz ni lq oa ob nk oc bi translated">张量流</h2><p id="7f33" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">从版本2开始，Tensorflow的安装变得简单多了。使用以下命令安装它:</p><pre class="kj kk kl km gt od mm oe of aw og bi"><span id="df35" class="nr mv it mm b gy oh oi l oj ok">pip install tensorflow</span></pre><p id="5c5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成安装后，继续下一节的实施。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="1463" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">将图像转换为张量流张量</h1><p id="60e7" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">在本节中，您将学习为Pytorch和Tensorflow框架实现图像到张量的转换代码。</p><p id="f2f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">供您参考，张量流中图像张量的典型轴顺序如下:</p><pre class="kj kk kl km gt od mm oe of aw og bi"><span id="d46d" class="nr mv it mm b gy oh oi l oj ok">shape=(N, H, W, C)</span></pre><ul class=""><li id="4f94" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe mj mk ml mm b">N</code> —批量大小(每批图像的数量)</li><li id="6adc" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe mj mk ml mm b">H</code> —图像的高度</li><li id="96ba" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe mj mk ml mm b">W</code> —图像的宽度</li><li id="52fb" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe mj mk ml mm b">C</code> —通道数(RGB通常使用3个通道)</li></ul><p id="36fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以轻松地加载图像文件(PNG、JPEG等。)和下面的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="e2e3" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">更改张量流张量维度</h1><p id="45fd" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">此外，Tensorflow确实提供了一个名为<code class="fe mj mk ml mm b">tf.transpose</code>的有用函数，可以根据<code class="fe mj mk ml mm b">perm</code>的值改变张量的维数。默认情况下，<code class="fe mj mk ml mm b">perm</code>设置为<code class="fe mj mk ml mm b">[n-1…0]</code>，其中n代表维度的数量。</p><p id="72d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设你想改变张量的形状</p><pre class="kj kk kl km gt od mm oe of aw og bi"><span id="f998" class="nr mv it mm b gy oh oi l oj ok">(224, 224, 3) -&gt; (3, 224, 224)</span></pre><p id="68b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简单地调用<code class="fe mj mk ml mm b">tf.transpose</code>函数如下:</p><pre class="kj kk kl km gt od mm oe of aw og bi"><span id="5d47" class="nr mv it mm b gy oh oi l oj ok">tensor = tf.transpose(tensor, perm=[2, 0, 1])</span></pre><p id="9b68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这在对源自Pytorch的模型(例如，从Pytorch到ONNX到Tensorflow的转换)执行推理时很方便，因为两种框架之间图像张量的标准结构不同。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="1359" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">将图像转换为Pytorch张量</h1><p id="22c5" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">另一方面，Pytorch中图像张量的形状与张量流张量略有不同。而是基于以下<code class="fe mj mk ml mm b">torch.Size</code>:</p><pre class="kj kk kl km gt od mm oe of aw og bi"><span id="aa13" class="nr mv it mm b gy oh oi l oj ok">torch.Size([N, C, H, W])</span></pre><ul class=""><li id="6bcd" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe mj mk ml mm b">N</code> —批量大小(每批图像的数量)</li><li id="bedc" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe mj mk ml mm b">C</code> —通道数(RGB通常使用3个通道)</li><li id="1b5a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe mj mk ml mm b">H</code> —图像的高度</li><li id="fe8c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe mj mk ml mm b">W</code> —图像的宽度</li></ul><p id="1fa7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">加载图像数据有多种方式，其中一种如下:</p><ul class=""><li id="1ce6" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">通过枕形包装装载</li><li id="212c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">设置转换功能</li><li id="6a84" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">对图像应用调整大小变换</li><li id="ce99" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">设置张量转换函数</li><li id="1bfc" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">对图像应用张量转换函数</li></ul><p id="9d74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看看下面的转换脚本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="da36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与Tensorflow使用术语扩展维度来添加新维度不同，Pytorch基于挤压和取消挤压。挤压意味着你将通过截断来减少维度，而unsqueeze将为相应的张量增加一个新的维度。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="e6e7" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">更改Pytorch张量维度</h1><p id="552e" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">此外，您可以通过<code class="fe mj mk ml mm b">torch.permute</code>功能轻松地重新排列张量的维度。假设您想要按如下方式更改形状:</p><pre class="kj kk kl km gt od mm oe of aw og bi"><span id="1170" class="nr mv it mm b gy oh oi l oj ok">(3, 224, 224) -&gt; (224, 224, 3)</span></pre><p id="0b1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">调用<code class="fe mj mk ml mm b">torch.permute</code>函数时，应传入以下输入:</p><pre class="kj kk kl km gt od mm oe of aw og bi"><span id="b92d" class="nr mv it mm b gy oh oi l oj ok">torch.permute(tensor, (1, 2, 0))</span></pre></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="d0e5" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">在Pytorch和Tensorflow之间转换张量</h1><p id="90f2" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">张量转换的一个最简单的基本工作流程如下:</p><ul class=""><li id="5243" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">将张量(A)转换为numpy数组</li><li id="cdb7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">将numpy数组转换为张量(B)</li></ul><h2 id="c355" class="nr mv it bd mw ns nt dn na nu nv dp ne li nw nx ng lm ny nz ni lq oa ob nk oc bi translated">Pytorch到Tensorflow</h2><p id="3786" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">Pytorch中的Tensors自带了一个名为<code class="fe mj mk ml mm b">numpy()</code>的内置函数，该函数会将其转换为numpy数组。</p><pre class="kj kk kl km gt od mm oe of aw og bi"><span id="858b" class="nr mv it mm b gy oh oi l oj ok">py_tensor.numpy()</span></pre><p id="7051" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，简单地调用<a class="ae ky" href="https://www.tensorflow.org/api_docs/python/tf/convert_to_tensor" rel="noopener ugc nofollow" target="_blank"> tf.convert_to_tensor() </a>函数如下:</p><pre class="kj kk kl km gt od mm oe of aw og bi"><span id="614f" class="nr mv it mm b gy oh oi l oj ok">import tensorflow as tf</span><span id="3a71" class="nr mv it mm b gy on oi l oj ok">...</span><span id="3759" class="nr mv it mm b gy on oi l oj ok">tf_tensors = tf.convert_to_tensor(py_tensor.numpy())</span></pre><h2 id="efaf" class="nr mv it bd mw ns nt dn na nu nv dp ne li nw nx ng lm ny nz ni lq oa ob nk oc bi translated">张量流向Pytorch</h2><p id="6aa4" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">另一方面，tensors从Tensorflow到Pytorch的转换遵循相同的模式，因为它有自己的<code class="fe mj mk ml mm b">numpy()</code>函数:</p><pre class="kj kk kl km gt od mm oe of aw og bi"><span id="534e" class="nr mv it mm b gy oh oi l oj ok">tf_tensors.numpy()</span></pre><p id="a881" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随后，您可以调用<a class="ae ky" href="https://pytorch.org/docs/stable/generated/torch.from_numpy.html" rel="noopener ugc nofollow" target="_blank"> torch.from_numpy() </a>进行张量转换:</p><pre class="kj kk kl km gt od mm oe of aw og bi"><span id="9b20" class="nr mv it mm b gy oh oi l oj ok">import torch</span><span id="5e7f" class="nr mv it mm b gy on oi l oj ok">...</span><span id="3fad" class="nr mv it mm b gy on oi l oj ok">py_tensors = torch.from_numpy(tf_tensors.numpy())</span></pre></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="d540" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">结论</h1><p id="0f33" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">让我们回顾一下你今天所学的内容。</p><p id="d7f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文首先简要解释了张量和操作张量的困难。</p><p id="98b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，它通过<code class="fe mj mk ml mm b">pip install</code>进入安装过程。</p><p id="8d3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它继续逐步指导将图像数据转换为Tensorflow张量，以及如何根据自己的需要更改张量的维度。</p><p id="5d77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，还介绍了Pytorch框架的张量转换和相应的维数置换。</p><p id="1c7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，它突出显示了一些代码片段，用于将tensors从Tensorflow转换为Pytorch，反之亦然。</p><p id="1dee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢你阅读这篇文章。祝你有美好的一天！</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="9547" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">参考</h1><ol class=""><li id="d060" class="lv lw it lb b lc nm lf nn li oo lm op lq oq lu or mb mc md bi translated"><a class="ae ky" href="https://www.tensorflow.org/guide/tensor" rel="noopener ugc nofollow" target="_blank">tensor flow——张量介绍</a></li><li id="5769" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu or mb mc md bi translated"><a class="ae ky" href="https://www.tensorflow.org/api_docs/python/tf/io" rel="noopener ugc nofollow" target="_blank"> Tensorflow — tf.io </a></li><li id="3ad2" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu or mb mc md bi translated"><a class="ae ky" href="https://pytorch.org/vision/stable/transforms.html" rel="noopener ugc nofollow" target="_blank">py torch—torch vision . transform</a></li></ol></div></div>    
</body>
</html>