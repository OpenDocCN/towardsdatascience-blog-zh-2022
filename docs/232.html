<html>
<head>
<title>Spreadsheets to Python : Monitoring Covid Made Easy, Using Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">电子表格到Python:使用代码轻松监控Covid</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/spreadsheets-to-python-monitoring-covid-made-easy-using-code-ab29730f2023#2022-01-08">https://towardsdatascience.com/spreadsheets-to-python-monitoring-covid-made-easy-using-code-ab29730f2023#2022-01-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="58cf" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/spreadsheets-to-python" rel="noopener" target="_blank">电子表格到Python </a></h2><div class=""><h1 id="e63d" class="pw-post-title iy iz iq bd ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv bi translated">电子表格到Python:使用代码轻松监控Covid</h1></div><div class=""><h2 id="e378" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated"><em class="ko">探索Python数据分析的诸多乐趣和好处</em></h2></div><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/9a4aa70fb23e39785fcc489573b20102.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BzLBhWi-saDXJngo"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">马丁·桑切斯在<a class="ae lf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="b68f" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">互联网上的大量可用数据给了我们一个前所未有的机会来探索不同现象和事件背后的潜在数字。通常这些数据会随着时间的推移而更新，我们希望通过更新我们的分析来利用这一点。对我来说，从电子表格到代码的最重要的原因之一是这个过程变得非常容易。</p><p id="8f1e" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">几个月前，我写了一篇<a class="ae lf" href="https://blog.filament.so/riding-the-third-wave-e5eca4696a50" rel="noopener ugc nofollow" target="_blank">博客文章</a>，研究英国“第三波”Covid的开始。为了这篇文章，我写了代码从英国政府网站上读入数据。我现在对现在占主导地位的Omicron变种如何影响病例数感兴趣；好消息是，为了找到答案，重用我编写的代码真的很容易。</p><p id="b8a6" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我在<a class="ae lf" href="https://www.filament.so/" rel="noopener ugc nofollow" target="_blank"> Filament </a>中写这篇博客，这是一个基于云的Python平台，它允许我在任何我感兴趣的时候从我的手机或电脑上轻松地重新运行代码。在这一点上我应该说我是灯丝的CSO。当然，同样的代码也可以在其他Python平台上运行。</p><h1 id="69e7" class="mc md iq bd me mf mg mh mi mj mk ml mm kf mn kg mo ki mp kj mq kl mr km ms mt bi translated">英国的Covid案例</h1><p id="b5c9" class="pw-post-body-paragraph lg lh iq li b lj mu ka ll lm mv kd lo lp mw lr ls lt mx lv lw lx my lz ma mb ij bi translated">最近，英国的Covid病例数量大幅增加；让我们看看它与前几波相比如何。为此，我将使用两个库，Pandas用于存储数据，Matplotlib用于绘制数据，所以首先我导入我需要的库。为了避免打断正文，在这篇文章中，所有的代码都放在最后。我鼓励读者自己复制并运行这段代码；或者，<a class="ae lf" href="https://www.filament.so/" rel="noopener ugc nofollow" target="_blank"> Filament </a>的用户可以启动一个包含一系列博客文章代码的工作空间，包括本系列中的文章。</p><p id="de14" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">然后，我导入一个包含每天病例数的csv文件。我选择使用一个按照样本采集日期组织的csv，因为我认为这对于我以后的计算会更准确。这意味着过去几天的数据是不完整的。另一个选择是下载一个按结果报告日期组织的文件。这是最新的，但可能会影响住院率的计算。</p><p id="c6b2" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">一旦文件被导入，就很容易生成一个显示每天病例数的图表。我们可以看到在过去的几个星期里案件的大幅上升！</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mz"><img src="../Images/27cfee4f2c34e629921dd9a9c6601f3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I3L4iM21Sqc9jq8UrzNhjQ.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">作者图片</p></figure><p id="5493" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">在下一张图中，我下载了每天的住院人数。我们预计这些案例会有一点滞后(我们稍后将对此进行更多的探讨)，但即使如此，我们也可以看到最终的大幅增长。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi na"><img src="../Images/641cf00ad3be69cb42dc54ad0c6f5cae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G3tnfLO7YYzJcMVPqWxYIA.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">作者图片</p></figure><p id="7f92" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">最后，死亡。有许多不同的死亡衡量标准；该图显示阳性检测28天内的死亡；死亡不一定来自Covid。很容易将代码改为读取其他度量之一。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nb"><img src="../Images/5db37a7425abdb272ac34f2b4b4810a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FPw8QODC4Ij3cFrg8ZDjLQ.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">作者图片</p></figure><p id="8772" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">这些数据本身就很有趣，但更重要的是，现在只要我想，重新运行代码和更新图表真的很容易:我只需再次点击run！如果我每天手动下载电子表格，这将会困难得多。</p><h1 id="038f" class="mc md iq bd me mf mg mh mi mj mk ml mm kf mn kg mo ki mp kj mq kl mr km ms mt bi translated">住院率</h1><p id="4b19" class="pw-post-body-paragraph lg lh iq li b lj mu ka ll lm mv kd lo lp mw lr ls lt mx lv lw lx my lz ma mb ij bi translated">现在让我们用这些数据做一些简单的计算。我要做的第一件事是查看病例与住院人数的比率，看看这一比率是如何随着时间的推移而变化的。我将错过2020年春天的第一波Covid波，因为测试是有限的，很可能会错过很多病例。相反，我将从2020年9月1日开始。在计算比率之前，我需要做的第一件事是对齐两组数据:结果是住院高峰在病例高峰之后8天。这意味着，平均而言，去医院的人是在阳性检测后8天去的。我通过将入院时间推迟8天来说明这一点。为了让事情更容易查看，我用7天滚动平均值平滑了数据。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nc"><img src="../Images/45ac4fa42ee68454a015d3a2d3c5dfd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-mTjcv1UO7jfcCeZ3noGWA.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">作者图片</p></figure><p id="3900" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">现在我们来看看病例与入院的比例。下图显示了这一点(在右手轴上)。2020年末，英国感染新冠肺炎的人中，约有1/15的人去了医院；到2021年年中，随着疫苗接种的生效，这一比例可能会提高到40分之一。现在这个比例似乎又在提高了；然而，现在确定还为时过早，数据可能受到圣诞节期间报告延迟的影响。我会继续关注事态的发展。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nd"><img src="../Images/7fb947a014c9599ce7edf6eba10cb24c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3q51cKdMV6ReG1b37nL6WQ.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">作者图片</p></figure><p id="5d09" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">最后，让我们看看死亡率，下图中，我将死亡率移动了15天，与病例重叠；我还将它们放大了50倍，这样病例和死亡就可以在同一个轴上查看。大约一年前，每50个病例中有一个死亡，这种情况迅速改善，然后稳定在每250个病例中有一个左右，2021年7月左右的非常高的比率可能是2020年欧洲足球锦标赛的结果，在此期间，我预计大量病例出现在年轻人中，他们不太可能患重病。看起来，最近病例的增加似乎与死亡人数的增加无关，如果持续下去，这将是一个好消息，但也可能是这种转变的产物:在得出确切结论之前，需要更多的数据。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ne"><img src="../Images/d3a9fd84c5b46ec3d7b82266b2c020fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cpXffWuB4TCROsEPnq5RBw.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">作者图片</p></figure><h1 id="44bf" class="mc md iq bd me mf mg mh mi mj mk ml mm kf mn kg mo ki mp kj mq kl mr km ms mt bi translated">结论</h1><p id="71a6" class="pw-post-body-paragraph lg lh iq li b lj mu ka ll lm mv kd lo lp mw lr ls lt mx lv lw lx my lz ma mb ij bi translated">我们已经看到了如何使用Python来可视化和分析从互联网上获得的数据。不幸的是，在这些数据可用于得出关于Covid的Omicron变体的可靠结论之前，需要多一点时间:新一波病例太新，由于圣诞节和新年期间的干扰，可用数据可能还不是最新的。</p><p id="ef42" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">然而，使用代码的伟大之处在于，我现在可以每隔几天简单地通过按下一个“运行”按钮来重新运行分析。这是在Python中执行这种分析的巨大优势。分析也是可适应的，我可以改变平均的数量，不同数据组之间的转换，甚至通过改变一两行并再次运行代码来改变所使用的数据组。</p><p id="85ea" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">上述分析中的一个主要假设是，在当前(第四波)和第二波中，病例和住院(或死亡)之间的时间延迟是相同的。这是一个很难证明的假设——大多数人没有接种疫苗，奥米克隆似乎是一种非常不同的病毒。如果情况稳定下来，这就不重要了；虽然它们上升很快，但微小的偏差可能会对计算出的比率产生很大影响。这是未来需要继续调整的地方，通过代码也可以使之变得更容易。</p><p id="e87a" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我希望这个简单的例子再次展示了在Python中执行数据分析和可视化的价值。</p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><p id="197d" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated"><em class="nm">这篇文章的文本、代码和图像是使用</em> <a class="ae lf" href="http://www.filament.so/" rel="noopener ugc nofollow" target="_blank"> <em class="nm">灯丝</em> </a> <em class="nm">创建的，这是一个用于数据、分析和报告的一体化工作空间。如需了解更多信息，请访问我们的网站</em><a class="ae lf" href="http://www.filament.so/" rel="noopener ugc nofollow" target="_blank"><em class="nm"/></a><em class="nm">。Filament目前正在运行一个封闭的测试程序；前100名使用推荐代码TDSFILAMENT请求访问的人可以跳过等候名单，提前获得访问权限。这个博客和其他博客的所有代码对所有Filament用户都是可用的。</em></p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><h1 id="30c3" class="mc md iq bd me mf nn mh mi mj no ml mm kf np kg mo ki nq kj mq kl nr km ms mt bi translated">保持联系</h1><ul class=""><li id="db74" class="ns nt iq li b lj mu lm mv lp nu lt nv lx nw mb nx ny nz oa bi translated">在<a class="ae lf" href="https://clivesiviour.medium.com/" rel="noopener">媒体</a>上关注我，了解更多类似的故事</li><li id="5f3b" class="ns nt iq li b lj ob lm oc lp od lt oe lx of mb nx ny nz oa bi translated">在<a class="ae lf" href="https://www.linkedin.com/in/clive-siviour/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上连接</li></ul></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><h2 id="bf76" class="og md iq bd me oh oi dn mi oj ok dp mm lp ol om mo lt on oo mq lx op oq ms iw bi translated">笔记</h2><p id="6037" class="pw-post-body-paragraph lg lh iq li b lj mu ka ll lm mv kd lo lp mw lr ls lt mx lv lw lx my lz ma mb ij bi translated">[1]参见此处的合理使用政策:<a class="ae lf" href="https://coronavirus.data.gov.uk/details/download" rel="noopener ugc nofollow" target="_blank">https://coronavirus.data.gov.uk/details/download</a></p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><pre class="kq kr ks kt gt or os ot ou aw ov bi"><span id="7f45" class="og md iq os b gy ow ox l oy oz">#%% Code to import and plot UK Covid Data</span><span id="399c" class="og md iq os b gy pa ox l oy oz">import matplotlib.pyplot as plt<br/>import matplotlib.ticker as tkr<br/>from matplotlib.dates import DateFormatter<br/>import pandas as pd</span><span id="4ef9" class="og md iq os b gy pa ox l oy oz">#%% Read case data into a DataFrame</span><span id="61bf" class="og md iq os b gy pa ox l oy oz">covid_cases=pd.read_csv('<a class="ae lf" href="https://coronavirus.data.gov.uk/api/v1/data?filters=areaType=overview&amp;structure=%7B%22areaType%22:%22areaType%22,%22areaName%22:%22areaName%22,%22areaCode%22:%22areaCode%22,%22date%22:%22date%22,%22newCasesBySpecimenDate%22:%22newCasesBySpecimenDate%22,%22cumCasesBySpecimenDate%22:%22cumCasesBySpecimenDate%22%7D&amp;format=csv'" rel="noopener ugc nofollow" target="_blank">https://coronavirus.data.gov.uk/api/v1/data?filters=areaType=overview&amp;structure=%7B%22areaType%22:%22areaType%22,%22areaName%22:%22areaName%22,%22areaCode%22:%22areaCode%22,%22date%22:%22date%22,%22newCasesBySpecimenDate%22:%22newCasesBySpecimenDate%22,%22cumCasesBySpecimenDate%22:%22cumCasesBySpecimenDate%22%7D&amp;format=csv'</a>)</span><span id="3f3a" class="og md iq os b gy pa ox l oy oz"># Change date formats in the DataFrame, and reorder so that the most recent data are last</span><span id="15f0" class="og md iq os b gy pa ox l oy oz">covid_cases['date']=pd.to_datetime(covid_cases['date'])<br/>covid_cases=covid_cases[::-1]<br/>covid_cases.reset_index(drop=True, inplace=True)</span><span id="b23b" class="og md iq os b gy pa ox l oy oz">#%% Plot</span><span id="5688" class="og md iq os b gy pa ox l oy oz">fig, ax1 = plt.subplots(figsize = [4,3], dpi=200)</span><span id="b8a9" class="og md iq os b gy pa ox l oy oz">ax1.plot(covid_cases['date'], <br/>         covid_cases['newCasesBySpecimenDate'], <br/>         label='Full data', <br/>         color='b'<br/>         )</span><span id="0b3f" class="og md iq os b gy pa ox l oy oz"># Format the axes</span><span id="86b9" class="og md iq os b gy pa ox l oy oz">ax1.tick_params(axis='both', which='major', labelsize=8)</span><span id="3277" class="og md iq os b gy pa ox l oy oz">ax1.set_xlabel('Date', fontsize=10)<br/>ax1.set_ylabel('UK Cases per day', fontsize=10)</span><span id="06a9" class="og md iq os b gy pa ox l oy oz">ax1.set_xticks(ax1.get_xticks())<br/>ax1.set_xticklabels(ax1.get_xticklabels(), rotation=45, ha='center')</span><span id="8a59" class="og md iq os b gy pa ox l oy oz"># this code adds a comma at the thousand separator on the y-axis<br/>ax1.get_yaxis().set_major_formatter(<br/>    tkr.FuncFormatter(lambda x, p: format(int(x), ',')))</span><span id="0493" class="og md iq os b gy pa ox l oy oz"># these two lines are used to set the date format to MMM-YY<br/>date_form = DateFormatter("%b-%y")       <br/>ax1.xaxis.set_major_formatter(date_form) </span><span id="147e" class="og md iq os b gy pa ox l oy oz"><br/>#%% Read hospital admission data into a new DataFrame<br/><br/>covid_hospital=pd.read_csv('https://coronavirus.data.gov.uk/api/v1/data?filters=areaType=overview&amp;structure=%7B%22areaType%22:%22areaType%22,%22areaName%22:%22areaName%22,%22areaCode%22:%22areaCode%22,%22date%22:%22date%22,%22newAdmissions%22:%22newAdmissions%22,%22cumAdmissions%22:%22cumAdmissions%22%7D&amp;format=csv')<br/><br/>covid_hospital['date']=pd.to_datetime(covid_hospital['date'])<br/>covid_hospital=covid_hospital[::-1]<br/>covid_hospital.reset_index(drop=True, inplace=True)</span><span id="8219" class="og md iq os b gy pa ox l oy oz"><br/>#%% Plot<br/><br/>fig, ax2 = plt.subplots(figsize=[4,3] ,dpi=200)<br/><br/>ax2.plot(covid_hospital['date'], <br/>         covid_hospital['newAdmissions'], <br/>         label='Full data', <br/>         color='r'<br/>         )<br/><br/># Format the axes<br/><br/>ax2.tick_params(axis='both', which='major', labelsize=8)<br/><br/>ax2.set_xlabel('Date', fontsize=10)<br/>ax2.set_ylabel('UK Hospital admissions per day', fontsize=10)<br/><br/>ax2.get_yaxis().set_major_formatter(<br/>    tkr.FuncFormatter(lambda x, p: format(int(x), ','))) <br/><br/>ax2.xaxis.set_major_formatter(date_form)<br/></span><span id="1542" class="og md iq os b gy pa ox l oy oz">#%% Read death data into a new DataFrame<br/><br/>covid_deaths=pd.read_csv('https://coronavirus.data.gov.uk/api/v1/data?filters=areaType=overview&amp;structure=%7B%22areaType%22:%22areaType%22,%22areaName%22:%22areaName%22,%22areaCode%22:%22areaCode%22,%22date%22:%22date%22,%22newDeaths28DaysByDeathDate%22:%22newDeaths28DaysByDeathDate%22,%22cumDeaths28DaysByDeathDate%22:%22cumDeaths28DaysByDeathDate%22%7D&amp;format=csv')<br/>                         <br/>covid_deaths['date']=pd.to_datetime(covid_deaths['date'])<br/>covid_deaths=covid_deaths[::-1]<br/>covid_deaths.reset_index(drop=True, inplace=True)</span><span id="8c1e" class="og md iq os b gy pa ox l oy oz"><br/>#%% Plot<br/><br/>fig, ax3 = plt.subplots(figsize=[4,3] ,dpi=200)<br/><br/>ax3.plot(covid_deaths['date'], <br/>         covid_deaths['newDeaths28DaysByDeathDate'], <br/>         label='Full data', <br/>         color='g'<br/>         )<br/><br/># Format the axes<br/><br/>ax3.tick_params(axis='both', which='major', labelsize=8)<br/><br/>ax3.set_xlabel('Date', fontsize=10)<br/>ax3.set_ylabel('UK Deaths per day', fontsize=10)<br/><br/>ax3.get_yaxis().set_major_formatter(<br/>    tkr.FuncFormatter(lambda x, p: format(int(x), ','))) <br/>           <br/>ax3.xaxis.set_major_formatter(date_form)<br/></span><span id="d77e" class="og md iq os b gy pa ox l oy oz">#%% Compare cases and hospital admissions, align admissions<br/><br/># Choose shift and averaging period<br/><br/>shift_1 = 8 # number of days to shift admissions data to compare to case data<br/>av_period = 7 # days over which to average<br/><br/># In order to align the two datasets, I find the index of the date I want to start plotting from<br/>start_1=covid_cases[covid_cases['date']=='2020-09-01'].index[0]<br/>start_2=covid_hospital[covid_hospital['date']=='2020-09-01'].index[0] <br/><br/># Create figure and axes<br/><br/>fig, ax4 = plt.subplots(figsize=[4,3] ,dpi=200)<br/>ax4_2=ax4.twinx() # allows me to plot the data using two y-axes<br/><br/># Now draw the plots<br/><br/>ax4.plot(covid_cases['date'][start_1:-shift_1], <br/>        covid_cases['newCasesBySpecimenDate'][start_1:-shift_1].rolling(av_period).mean(),<br/>        label='Cases', <br/>        color='b'<br/>        )<br/><br/>ax4_2.plot(covid_hospital['date'][start_2:],<br/>          covid_hospital['newAdmissions'][start_2:].rolling(av_period).mean(), <br/>          label='Hospital Admissions         ', <br/>          color=(1,0,0,0.5)<br/>          )<br/><br/>ax4_2.plot(covid_hospital['date'][start_2:-shift_1],<br/>          covid_hospital['newAdmissions'][start_2+shift_1:].rolling(av_period).mean(), <br/>          label='Hospital Admissions         \nShifted', <br/>          color='r'<br/>          )<br/><br/># Format the axes<br/><br/>ax4.legend(fontsize=6, frameon=False, loc='upper left' )<br/>ax4_2.legend(fontsize=6, frameon=False, loc='upper right' )<br/><br/>#ax4_2.legend(fontsize=6, facecolor='white', edgecolor='white',framealpha=1, loc='upper right')<br/><br/>ax4.tick_params(axis='both', which='major', labelsize=8)<br/>ax4_2.tick_params(axis='both', which='major', labelsize=8)<br/><br/>ax4.set_xlabel('Date', fontsize=10)<br/>ax4.set_ylabel('Cases per day', fontsize=10)<br/>ax4_2.set_ylabel('Hospital admissions per day', fontsize=10)        <br/><br/>ax4.set_ylim([0,65000])<br/>ax4_2.set_ylim([0,4500])<br/><br/>ax4.get_yaxis().set_major_formatter(<br/>    tkr.FuncFormatter(lambda x, p: format(int(x), ','))) <br/><br/>ax4_2.get_yaxis().set_major_formatter(<br/>    tkr.FuncFormatter(lambda x, p: format(int(x), ','))) <br/><br/>ax4.set_xticks(ax4.get_xticks())<br/>ax4.set_xticklabels(ax4.get_xticklabels(), rotation=45, ha='center')<br/><br/>ax4.xaxis.set_major_formatter(date_form)</span><span id="1832" class="og md iq os b gy pa ox l oy oz"><br/>#%% Plot hospitalisation ratios<br/><br/># create a DataFrame with the required data<br/><br/>hospitalisation_rate=pd.DataFrame({'Date':covid_cases['date'][start_1:]})<br/><br/>hospitalisation_rate['Cases']=covid_cases['newCasesBySpecimenDate'][start_1:]<br/>hospitalisation_rate.reset_index(drop=True, inplace=True)<br/><br/>temp=pd.DataFrame({'Admissions': covid_hospital['newAdmissions'][start_2:]})<br/>temp.reset_index(drop=True, inplace=True)<br/><br/>hospitalisation_rate['Admissions']=temp<br/><br/>temp=pd.DataFrame({'Admissions_shifted': covid_hospital['newAdmissions'][start_2+shift_1:]})<br/>temp.reset_index(drop=True, inplace=True)<br/><br/>hospitalisation_rate['Admissions_shifted']=temp<br/><br/>del temp<br/><br/>hospitalisation_rate['Ratio']=hospitalisation_rate['Cases'].rolling(7).mean()/hospitalisation_rate['Admissions_shifted'].rolling(7).mean()<br/></span><span id="eb50" class="og md iq os b gy pa ox l oy oz">#%% Plot<br/><br/>fig, ax5 = plt.subplots(figsize=[4,3] ,dpi=200)<br/><br/>ax5.plot(hospitalisation_rate['Date'], <br/>         hospitalisation_rate['Cases'].rolling(7).mean(), <br/>         label='Cases',<br/>         color='b'<br/>         )<br/><br/>ax5.plot(hospitalisation_rate['Date'], <br/>         hospitalisation_rate['Admissions'].rolling(7).mean(), <br/>         label='Hospital Admissions',<br/>         color=(1,0,0,0.5)<br/>         )<br/><br/>ax5.plot(hospitalisation_rate['Date'], <br/>         hospitalisation_rate['Admissions_shifted'].rolling(7).mean(),<br/>         label='Hospital Admissions \nShifted',<br/>         color='r'<br/>         )<br/><br/>ax5_2 = ax5.twinx()<br/><br/>ax5_2.plot(hospitalisation_rate['Date'], <br/>           hospitalisation_rate['Ratio'], <br/>           label='Ratio            ',<br/>           color='k'<br/>           )<br/><br/>ax5.legend(fontsize=6, frameon=False, loc='upper left' )<br/>ax5_2.legend(fontsize=6, frameon=False, loc='upper right')<br/><br/>ax5.tick_params(axis='both', which='major', labelsize=8)<br/>ax5_2.tick_params(axis='both', which='major', labelsize=8)<br/><br/>ax5.set_xlabel('Date', fontsize=10)<br/>ax5.set_ylabel('Cases / Admission per day', fontsize=10)<br/>ax5_2.set_ylabel('Ratio', fontsize=10)    <br/><br/>ax5.get_yaxis().set_major_formatter(<br/>    tkr.FuncFormatter(lambda x, p: format(int(x), ','))) <br/><br/>ax5_2.get_yaxis().set_major_formatter(<br/>    tkr.FuncFormatter(lambda x, p: format(int(x), ','))) <br/><br/>ax5.set_xticks(ax5.get_xticks())<br/>ax5.set_xticklabels(ax5.get_xticklabels(), rotation=45, ha='center')<br/><br/>ax5.xaxis.set_major_formatter(date_form)<br/><br/>ax5.set_ylim(bottom=0)<br/>ax5_2.set_ylim(bottom=0)</span><span id="ff90" class="og md iq os b gy pa ox l oy oz">#%% Plot death ratios<br/><br/># create a DataFrame with the required data<br/><br/>start_3=covid_deaths[covid_deaths['date']=='2020-09-01'].index[0]<br/>shift_2=15<br/><br/>temp=pd.DataFrame({'Deaths_shifted': covid_deaths['newDeaths28DaysByDeathDate'][start_3+shift_2:]})<br/>temp.reset_index(drop=True, inplace=True)<br/><br/>hospitalisation_rate['Deaths_shifted']=temp<br/><br/>del temp<br/><br/>hospitalisation_rate['Deaths_Ratio']=hospitalisation_rate['Cases'].rolling(7).mean()/hospitalisation_rate['Deaths_shifted'].rolling(7).mean()<br/><br/>#%% Plot<br/><br/>fig, ax6 = plt.subplots(figsize=[4,3] ,dpi=200)<br/><br/>ax6.plot(hospitalisation_rate['Date'], <br/>         hospitalisation_rate['Cases'].rolling(7).mean(), <br/>         label='Cases',<br/>         color='b'<br/>         )<br/><br/>ax6.plot(hospitalisation_rate['Date'], <br/>         hospitalisation_rate['Deaths_shifted'].rolling(7).mean()*50, <br/>         label='Deaths Shifted x 50',<br/>         color='lightgreen'<br/>         )<br/><br/>ax6_2 = ax6.twinx()<br/><br/>ax6_2.plot(hospitalisation_rate['Date'], <br/>           hospitalisation_rate['Deaths_Ratio'], <br/>           label='Ratio            ',<br/>           color='k'<br/>           )<br/><br/>ax6.legend(fontsize=6, frameon=False, loc='upper left' )<br/>ax6_2.legend(fontsize=6, frameon=False, loc='upper right')<br/><br/>ax6.tick_params(axis='both', which='major', labelsize=8)<br/>ax6_2.tick_params(axis='both', which='major', labelsize=8)<br/><br/>ax6.set_xlabel('Date', fontsize=10)<br/>ax6.set_ylabel('Cases / Deaths per day', fontsize=10)<br/>ax6_2.set_ylabel('Ratio', fontsize=10)    <br/><br/>ax6.get_yaxis().set_major_formatter(<br/>    tkr.FuncFormatter(lambda x, p: format(int(x), ','))) <br/><br/>ax6_2.get_yaxis().set_major_formatter(<br/>    tkr.FuncFormatter(lambda x, p: format(int(x), ','))) <br/><br/>ax6.set_xticks(ax6.get_xticks())<br/>ax6.set_xticklabels(ax6.get_xticklabels(), rotation=45, ha='center')<br/><br/>ax6.xaxis.set_major_formatter(date_form)<br/><br/>ax6.set_ylim(bottom=0)</span></pre></div></div>    
</body>
</html>