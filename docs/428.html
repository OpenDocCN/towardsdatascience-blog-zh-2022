<html>
<head>
<title>How to Improve AR Predictions Using ARMA For Time Series Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何利用ARMA改进时间序列分析中的AR预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-improve-ar-predictions-using-arma-for-time-series-analysis-483b84984490#2022-01-14">https://towardsdatascience.com/how-to-improve-ar-predictions-using-arma-for-time-series-analysis-483b84984490#2022-01-14</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""><h1 id="5a21" class="pw-post-title is it iu bd iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq bi translated">如何利用ARMA改进时间序列分析中的AR预测</h1></div><div class=""><h2 id="d25d" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">学会使用ARMA模型做出比AR模型更好的预测</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/d36345c2c90b8642797ef04a403ea8ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5XVjt3c2YulvMs43"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">努尔·尤尼斯在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="785c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在我之前的一篇指南中，我们介绍了如何使用时间序列数据，使用自回归模型对未来进行预测。在本帖中，我们将尝试用另一种方法来提高我们预测的准确性。</p><p id="ad23" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请务必查看之前关于实现自回归模型的文章，您可以在下面的链接中找到该文章。</p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/how-to-use-an-autoregressive-ar-model-for-time-series-analysis-bb12b7831024"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">如何使用自回归(AR)模型进行时间序列分析</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">python中使用自回归模型进行预测的初学者指南</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn kt lz"/></div></div></a></div><p id="cf99" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在那篇文章中，我们通过绘制和分析数据的ACF图，得出了AR模型的最佳阶数。对于这种方法，我们将使用<em class="mo"> pmdarima </em>库来为数据集寻找最佳模型和订单。您稍后将会看到，这将意味着从AR模型向ARMA模型的转变，ARMA模型中集成了一个<em class="mo">移动平均</em>组件。</p></div><div class="ab cl mp mq hy mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="in io ip iq ir"><h2 id="df7b" class="mw mx iu bd my mz na dn nb nc nd dp ne lj nf ng nh ln ni nj nk lr nl nm nn no bi translated">数据集</h2><p id="e482" class="pw-post-body-paragraph la lb iu lc b ld np jv lf lg nq jy li lj nr ll lm ln ns lp lq lr nt lt lu lv in bi translated">我们将使用澳大利亚墨尔本市10年间的日最低温度的相同数据，正如我在关于自回归的文章中发现的那样。这些数据的原始记录归澳大利亚气象局所有。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nu"><img src="../Images/e432741130cb86bc8d102b541828b12b.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*NOPiU8p4O4bQWjx5wGzmLg.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">一个表格的屏幕截图，包括前4行数据和标题—由作者创建</p></figure><p id="3598" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果你对本指南中的编码感兴趣，那么我在Github gist  [1]中提供了数据集<a class="ae kz" href="https://gist.github.com/JacobToftgaardRasmussen/78cac8b522ce6d8cab4fc80f7de48ee9" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="e05a" class="mw mx iu bd my mz na dn nb nc nd dp ne lj nf ng nh ln ni nj nk lr nl nm nn no bi translated">代码部分</h2><p id="de76" class="pw-post-body-paragraph la lb iu lc b ld np jv lf lg nq jy li lj nr ll lm ln ns lp lq lr nt lt lu lv in bi translated">在我们开始编写任何代码之前，我首先导入所需的库，因为我是在Google协作笔记本上编写的，所以我将首先使用pip来安装我想要使用的特定版本。</p><pre class="kk kl km kn gu nv nw nx ny aw nz bi"><span id="1c5a" class="mw mx iu nw b gz oa ob l oc od">pip install statsmodels==0.13.1</span></pre><p id="b7ea" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在另一间牢房里。</p><pre class="kk kl km kn gu nv nw nx ny aw nz bi"><span id="673d" class="mw mx iu nw b gz oa ob l oc od">pip install pmdarima</span></pre><p id="b4a2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，我们可以导入我们需要的库和函数，以及将数据读取到pandas数据框架中，并将其分成训练和测试数据。</p><pre class="kk kl km kn gu nv nw nx ny aw nz bi"><span id="171f" class="mw mx iu nw b gz oa ob l oc od">import pandas as pd<br/>import matplotlib.pyplot as plt<br/>import numpy as np<br/>from pmdarima import auto_arima</span><span id="1649" class="mw mx iu nw b gz oe ob l oc od">df = pd.read_csv('australia_temp_data.csv', index_col='Date', parse_dates=True)</span><span id="5650" class="mw mx iu nw b gz oe ob l oc od">df_train = df['Temp'].iloc[:-5]<br/>df_test = df['Temp'].iloc[-5:]</span></pre><p id="a9ed" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在上一篇文章中，我们旨在创建一个自回归模型，只是为了尝试和了解它，因此我们创建了一个ACF图，它将为我们的模型提供一个AR阶数的指标。</p><p id="6664" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本指南中，我们将让<em class="mo"> pmdarima </em>分析我们的数据，并决定哪种模型最适合我们的需求。我们可以用下面的代码做到这一点。</p><pre class="kk kl km kn gu nv nw nx ny aw nz bi"><span id="7649" class="mw mx iu nw b gz oa ob l oc od">model = auto_arima(df_train, start_P=0, start_q=0, stepwise=True, trace=True)</span></pre><p id="4468" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这将提供以下输出(如果您设置可选参数trace=True)</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj of"><img src="../Images/f9550e6222f10e31a5557ce5fdf6025e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*MAM1CUC89sK_ANNhAZa6Yg.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">对我们的数据运行auto_arima的输出屏幕截图—由作者创建</p></figure><p id="797c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这里你可以看到这个函数在尝试不同的ARMA模型，(注意I阶总是0，因此它是ARMA而不是ARIMA)。该函数的目标是最小化你在上面截图的每一行中看到的AIC值。</p><p id="6f5e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">AIC值的绝对值本身没有任何意义，但是它们相对于彼此具有意义，并且我们采用提供最低AIC值的一组顺序。在这种情况下，这将是一个ARIMA(3，0，1)模型，(这实际上是一个ARMA(3，1)模型)。</p><p id="82cb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">运行<code class="fe og oh oi nw b">auto_arima</code>的结果保存在变量<code class="fe og oh oi nw b">model</code>中，我们可以用它来预测未来的值。</p></div><div class="ab cl mp mq hy mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="in io ip iq ir"><h2 id="e4d9" class="mw mx iu bd my mz na dn nb nc nd dp ne lj nf ng nh ln ni nj nk lr nl nm nn no bi translated">先前AR模型的结果</h2><p id="aab1" class="pw-post-body-paragraph la lb iu lc b ld np jv lf lg nq jy li lj nr ll lm ln ns lp lq lr nt lt lu lv in bi translated">在我们继续进行预测之前，让我们先来看看上一篇文章的结果，这样我们就有东西可以比较了。当然，你可以通过查阅那篇文章找到那些结果是如何实现的详细代码，但是为了便于阅读，我在这里也包含了一个摘要版本。这段代码延续了当前文章<strong class="lc iv">中<strong class="lc iv">T3处的代码。</strong></strong></p><pre class="kk kl km kn gu nv nw nx ny aw nz bi"><span id="6376" class="mw mx iu nw b gz oa ob l oc od">from statsmodels.tsa.ar_model import AutoReg</span><span id="5a65" class="mw mx iu nw b gz oe ob l oc od">AR_model = AutoReg(df_train, lags=22).fit()</span><span id="e088" class="mw mx iu nw b gz oe ob l oc od">forecasts = model.forecast(5).tolist()</span><span id="5eb9" class="mw mx iu nw b gz oe ob l oc od">fig = plt.subplots(figsize=(12,8))<br/>plt.plot(forecasts, color="green")<br/>plt.plot(df_test.tolist(), color="blue")<br/>plt.xticks(np.arange(0,6,1))<br/>plt.yticks(np.arange(12.5,17,0.5))<br/>plt.legend(["AR forecasts", "Actual test values"])<br/>plt.show()</span></pre><p id="5c6c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这提供了下面的情节。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oj"><img src="../Images/4c0fbec4deee6b7c3afde7a2b37f16fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cmv7AaQ_dos0KKqon3mkCg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">该图显示了前一篇文章中AR模型的预测，紧挨着实际测试值—由作者创建</p></figure></div><div class="ab cl mp mq hy mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="in io ip iq ir"><h2 id="0ada" class="mw mx iu bd my mz na dn nb nc nd dp ne lj nf ng nh ln ni nj nk lr nl nm nn no bi translated">使用ARMA(3，1)模型创建新的预测</h2><p id="5cce" class="pw-post-body-paragraph la lb iu lc b ld np jv lf lg nq jy li lj nr ll lm ln ns lp lq lr nt lt lu lv in bi translated">现在，让我们尝试用上面创建的新ARMA(3，1)模型来改进这些预测。</p><pre class="kk kl km kn gu nv nw nx ny aw nz bi"><span id="a7f1" class="mw mx iu nw b gz oa ob l oc od">predictions = model.predict(n_periods=(len(df_test)))</span></pre><p id="bb1e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们还可以将这些预测值绘制在测试值旁边，以直观地了解准确性。</p><pre class="kk kl km kn gu nv nw nx ny aw nz bi"><span id="5a29" class="mw mx iu nw b gz oa ob l oc od">fig = plt.subplots(figsize=(12,8))<br/>plt.plot(predictions, color='orange')<br/>plt.plot(df_test.tolist())<br/>plt.xticks(np.arange(0,6,1))<br/>plt.yticks(np.arange(12.5,17,0.5))<br/>plt.legend(["ARMA(3, 1) predictions", "Actual test value"])<br/>plt.show()</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ok"><img src="../Images/299ce3e595a4c65f206671e10f9ac746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aONgmQvLHtN6c_Tr0-y2IQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">显示ARMA(3，1)模型预测值与实际测试值的关系图-由作者创建</p></figure><p id="7471" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如您所见，橙色线看起来比之前图中的绿线更接近蓝色测试值。让我们一起来看一下这三行，这样会更清楚。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ol"><img src="../Images/cdc7d7d185178d59cb9171eca773a542.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QbkTZHBmD-H3GWyVXCwZNg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">AR预测和实际测试值旁边的ARMA(3，1)预测-由作者创建</p></figure><p id="e92a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在很明显，ARMA(3，1)预测更接近实际测试温度。为了进行数值比较，我们可以计算两个不同预测的均方误差以及数据集的平均值。</p><pre class="kk kl km kn gu nv nw nx ny aw nz bi"><span id="86a9" class="mw mx iu nw b gz oa ob l oc od">from sklearn.metrics import mean_squared_error</span><span id="5649" class="mw mx iu nw b gz oe ob l oc od">print('AR model MSE', mean_squared_error(test_values, forecasts))<br/>print('ARMA(3, 1) MSE', mean_squared_error(test_values,predictions))<br/>print(df.Temp.mean())</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj om"><img src="../Images/467fd76dda91caa2f8a3e4aba6cbd4cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*4i5-lQw1SWXaUbrpI1oaIw.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">打印两个MSE值和温度平均值的结果截图—由作者创建</p></figure><p id="85ba" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">从这些结果中我们可以看出，AR模型的预测值平均与测试数据中的实际温度相差约1.18摄氏度，而ARMA(3，1)模型的预测值相差约1.01度。</p><p id="b5b5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">与整个数据集上大约11.18的平均温度相比，我认为这两个模型都做得很好。</p></div><div class="ab cl mp mq hy mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="in io ip iq ir"><h2 id="54e7" class="mw mx iu bd my mz na dn nb nc nd dp ne lj nf ng nh ln ni nj nk lr nl nm nn no bi translated">摘要</h2><p id="ffbf" class="pw-post-body-paragraph la lb iu lc b ld np jv lf lg nq jy li lj nr ll lm ln ns lp lq lr nt lt lu lv in bi translated">总结本文，可以说我们通过在模型中引入MA分量成功地改进了对未来气温的预测。这可以通过使用<em class="mo"> pmdarima </em>库的<em class="mo"> auto_arima </em>函数找到最适合的模型类型及其相应的订单。</p><p id="e9ca" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我希望你喜欢阅读这篇文章，并学到一些有用的东西！</p><p id="1dbf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">感谢阅读。</p><h2 id="e436" class="mw mx iu bd my mz na dn nb nc nd dp ne lj nf ng nh ln ni nj nk lr nl nm nn no bi translated">信用</h2><p id="bc19" class="pw-post-body-paragraph la lb iu lc b ld np jv lf lg nq jy li lj nr ll lm ln ns lp lq lr nt lt lu lv in bi translated">[1](数据来源经Jason Brownlee许可)——Jason Brownlee，<em class="mo">用Python进行时间序列预测的自回归模型</em>，机器学习掌握，可从<a class="ae kz" href="https://machinelearningmastery.com/autoregression-models-time-series-forecasting-python/" rel="noopener ugc nofollow" target="_blank">https://machinelingmastery . com/auto regression-Models-Time-Series-Forecasting-Python/</a>获取，2021年12月20日。</p></div></div>    
</body>
</html>