<html>
<head>
<title>Let the Bot Automate Your Data Processing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让机器人自动处理你的数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/let-the-bot-automate-your-data-processing-e6ef26959d65#2022-01-31">https://towardsdatascience.com/let-the-bot-automate-your-data-processing-e6ef26959d65#2022-01-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""><h1 id="83fa" class="pw-post-title ir is it bd iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp bi translated">让机器人自动处理你的数据</h1></div><div class=""><h2 id="ed85" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用RPA、PyAutoGui和Pandas来避免在SAP和您的数据仓库中进行重复的手动工作</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2032ba629674adc9c981e6e18e9e777a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mk17EXvUogOIQXYqb1FiGQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">戴维·莱夫克在<a class="ae ky" href="https://unsplash.com/s/photos/robot?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="f815" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">背景</strong>:</p><p id="2bc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您是否经常从SAP或其他ERP系统中导出数据？然后，在导入数据仓库之前，您是否会花一些时间处理数据？之后，你不会忘记进行一些数据验证检查，如果你的任何可信度检查触发了警报，你会给同事发电子邮件吗？最后，您必须将这些数据填写到web表单中吗？在这篇文章中，你将找到如何自动完成这些任务的解决方案，这样你就可以专注于人类应该做的事情:享受机器人手中的新鲜混合饮料并放松！</p><p id="711c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">解决</strong>:</p><p id="6822" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们必须导出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/c653c6627df22ee32b8a82a8413019ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:144/format:webp/1*pAxbjzTGMjTlK3yWFtZTAA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GuiAutomate和RPA使用计算机视觉在屏幕上定位像这个导出按钮这样的按钮。</p></figure><p id="cfa3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">..使用SE16N每周一次在SAP中创建表格:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/fcaec668e1726f6beeaa7941f89f5347.png" data-original-src="https://miro.medium.com/v2/resize:fit:370/format:webp/1*TTGAJt0CCcuj96CD1JKNqQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">除了图像识别之外，RPA甚至可以使用OCR(光学字符识别)。</p></figure><p id="abf2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<a class="ae ky" rel="noopener" target="_blank" href="/automatically-run-and-export-sap-transactions-out-of-excel-using-vba-9c63a28ff566">的另一篇文章</a>中，我们学习了如何使用SAP的默认脚本实现自动化。但是，由于贵公司的IT法规，有时您将无法访问此功能。在这种情况下，PyAutoGui和RPA都非常有助于避免重复相同的任务。</p><p id="3457" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从从SAP导出数据开始:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="d040" class="mc md it ly b gy me mf l mg mh"><strong class="ly iu">import</strong> pyautogui<br/><strong class="ly iu">import</strong> opencv <em class="mi"># is needed to use confidence in PyAutoGui for image recognition</em><br/><strong class="ly iu">import</strong> subprocess<br/><strong class="ly iu">import</strong> time<br/><strong class="ly iu">from</strong> timeit <strong class="ly iu">import</strong> default_timer <strong class="ly iu">as</strong> timer <em class="mi"># to log the time it takes the bot for each step</em><br/><strong class="ly iu">import</strong> getpass <em class="mi"># to get the user name</em><br/><br/>username <strong class="ly iu">=</strong>getpass<strong class="ly iu">.</strong>getuser() <em class="mi"># to log the user name on which system the bot is running</em><br/><br/>start <strong class="ly iu">=</strong> timer() <em class="mi">#start the timing</em><br/><br/>subprocess<strong class="ly iu">.</strong>Popen("C:\Program Files (x86)\SAP\FrontEnd\SAPgui\saplogon.exe") <em class="mi"># open your desktop application, eg SAP</em><br/>time<strong class="ly iu">.</strong>sleep(3) <em class="mi"># using any kind of gui scripting requires to wait until application screens are fully loaded</em></span></pre><p id="c15d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SAP开始屏幕现已打开。现在，我们希望机器人找到并点击“SE16N”交易:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="20c2" class="mc md it ly b gy me mf l mg mh">Customse16n <strong class="ly iu">=</strong> pyautogui<strong class="ly iu">.</strong>locateOnScreen('Custom SE16N.png',confidence<strong class="ly iu">=</strong>0.8) <em class="mi"># let PyAutoGui search the image on the screen; image must be at least very similar when using confidence 80%. Use confidence 1 when image must match 100%.</em><br/>pyautogui<strong class="ly iu">.</strong>moveTo(Customse16n) <em class="mi"># moves your cursor upon this button</em><br/>pyautogui<strong class="ly iu">.</strong>click(clicks<strong class="ly iu">=</strong>2) <em class="mi"># double click on the button on which the mouse cursor is now located</em><br/>time<strong class="ly iu">.</strong>sleep(3) <em class="mi">#give a three seconds break within the code to wait for the desktop application to load its programme</em></span></pre><p id="75a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一个屏幕中，机器人将输入我们想要导出的表名。我们将获得一个之前保存在SAP中的变量，运行该事务并将结果保存为文本文件:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="1192" class="mc md it ly b gy me mf l mg mh">pyautogui<strong class="ly iu">.</strong>typewrite('WhatEverSapTable', interval<strong class="ly iu">=</strong>0.001)  <em class="mi"># text entering with 0.001 seconds in between entering each character</em><br/>pyautogui<strong class="ly iu">.</strong>press('enter') <em class="mi"># presses the enter button</em><br/>pyautogui<strong class="ly iu">.</strong>keyDown('fn') <em class="mi"># holding FN down so F8 can run on my marc</em><br/>pyautogui<strong class="ly iu">.</strong>press('f8') <em class="mi"># execute your SAP transaction with F8 works only if you also press FN, see above line</em><br/>time<strong class="ly iu">.</strong>sleep(3)<br/><br/>pyautogui<strong class="ly iu">.</strong>press('f6') <em class="mi">#now getting variant in SAP</em><br/>time<strong class="ly iu">.</strong>sleep(3)<br/>pyautogui<strong class="ly iu">.</strong>typewrite('WhatEverSapTable variant', interval<strong class="ly iu">=</strong>0.001)<br/>pyautogui<strong class="ly iu">.</strong>press('enter')<br/>time<strong class="ly iu">.</strong>sleep(3)<br/>pyautogui<strong class="ly iu">.</strong>keyDown('fn')<br/>pyautogui<strong class="ly iu">.</strong>press('f8') <br/>time<strong class="ly iu">.</strong>sleep(10) <em class="mi"># getting your table via SE16N might take some time in SAP</em></span><span id="80e4" class="mc md it ly b gy mj mf l mg mh">exportresult <strong class="ly iu">=</strong> pyautogui<strong class="ly iu">.</strong>locateOnScreen('export.png',confidence<strong class="ly iu">=</strong>0.8) <em class="mi"># click the export button to save the results</em><br/>pyautogui<strong class="ly iu">.</strong>moveTo(exportresult)<br/>pyautogui<strong class="ly iu">.</strong>click()<br/>time<strong class="ly iu">.</strong>sleep(3)<br/><br/>pyautogui<strong class="ly iu">.</strong>move(0, 140) <em class="mi"># from this export button, we now move the cursor 140 pixel down to "Local File" to save it as text</em><br/>time<strong class="ly iu">.</strong>sleep(3)<br/>pyautogui<strong class="ly iu">.</strong>click()<br/>time<strong class="ly iu">.</strong>sleep(10) <em class="mi"># might take some time depending on the amount of data</em><br/>pyautogui<strong class="ly iu">.</strong>press('enter') <em class="mi"># press enter to confirm</em><br/>time<strong class="ly iu">.</strong>sleep(10)<br/><br/>pyautogui<strong class="ly iu">.</strong>typewrite('contacts.txt', interval<strong class="ly iu">=</strong>0.001) <em class="mi"># saves the file contacts as txt</em><br/>time<strong class="ly iu">.</strong>sleep(3)<br/>pyautogui<strong class="ly iu">.</strong>press('enter')</span></pre><p id="7e6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这只是使用SAP的一个基本例子。但是当然，您可以很容易地将这些代码应用到您想要从中提取数据的任何系统中。顺便说一下，我们还将为机器人为我们执行的每个步骤编写一个日志文件。知道机器人每一步花了多长时间总是好的(我们会花多长时间？):</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="7296" class="mc md it ly b gy me mf l mg mh">end <strong class="ly iu">=</strong> timer() <em class="mi"># end the timing</em><br/>timestr <strong class="ly iu">=</strong> time<strong class="ly iu">.</strong>strftime("%Y%m%d-%H%M%S")<br/><strong class="ly iu">with</strong> open('LogBot.txt', 'a', encoding<strong class="ly iu">=</strong>'utf-8') <strong class="ly iu">as</strong> f: <em class="mi"># 'a'instead of 'w', so current log will be added, not overwritten</em><br/>    f<strong class="ly iu">.</strong>write(' &gt; ' <strong class="ly iu">+</strong> 'BotExport: ' <strong class="ly iu">+</strong>timestr  <strong class="ly iu">+</strong> ': Bot for ' <strong class="ly iu">+</strong> username <strong class="ly iu">+</strong> ': %0.2fs'<strong class="ly iu">%</strong> (end <strong class="ly iu">-</strong> start)<strong class="ly iu">+</strong>'.' <strong class="ly iu">+</strong> '\n')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/9b3f70267b7a1b254f58133e58d6896c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*GrbVX73WTxpXrfgmIIt4Jw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">记录我们的机器人为我们工作的持续时间。</p></figure><p id="d6ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的导出文件如下所示(你会在我的<a class="ae ky" href="https://github.com/DAR-DatenanalyseRehberg/GuiAutomateRpa/blob/main/GuiAutomateRPAPandasMedium.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>中找到这个txt文件):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ml"><img src="../Images/77449811cc086a9e2620d30a96954e0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5NXeC9hn8k87piWKpXrH_g.png"/></div></div></figure><p id="8ba3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将只考虑有效的联系人(列valid = y)。然后，我们需要按公司名称对这个数据帧进行分组，并使用enumerate为文件名中包含公司名称的每个组生成一个文件。这是我们一位同事的要求(出于学习目的):</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="d021" class="mc md it ly b gy me mf l mg mh"><strong class="ly iu">import</strong> pandas <strong class="ly iu">as</strong> pd<br/><br/>df <strong class="ly iu">=</strong> pd<strong class="ly iu">.</strong>read_csv('contacts.txt', delimiter <strong class="ly iu">=</strong> "\t")<br/><br/><em class="mi"># create a df including only valid contacts</em><br/>ValidDf<strong class="ly iu">=</strong>df<strong class="ly iu">.</strong>query('Valid == "y"') <br/><br/><em class="mi"># group per Company Name and save each group as xlsx attaching the Company Name to the file's name</em><br/><strong class="ly iu">for</strong> i, (name, group) <strong class="ly iu">in</strong> enumerate(ValidDf<strong class="ly iu">.</strong>groupby('Company Name')):<br/>    group<strong class="ly iu">.</strong>to_excel('ValidContactsPerCompany {}.xlsx'<strong class="ly iu">.</strong>format(name),index<strong class="ly iu">=False</strong>) </span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/453e6fd75867ef3a429ca5a95a02c032.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*6FDID8Ij05oAFDJREB8hqA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">所有公司名称被分组并分别导出为Excel文件。</p></figure><p id="2068" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们将这个清理后的数据帧导入到我们的SQL Server数据仓库中:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="ceab" class="mc md it ly b gy me mf l mg mh"><strong class="ly iu">import</strong> pyodbc <em class="mi"># to write data to data warehouse instead of text or Excel files</em><br/><br/>YourTableName <strong class="ly iu">=</strong>'YourTableNameIncludingLayer'<br/><br/>conn <strong class="ly iu">=</strong> pyodbc<strong class="ly iu">.</strong>connect('Driver={SQL Server};'<br/>                      'Server=YourSqlServer;'<br/>                      'Database=YourDatabase;'<br/>                      'Trusted_Connection=yes;')<br/><em class="mi"># Create Table</em><br/>cursor<strong class="ly iu">.</strong>execute('CREATE TABLE YourTableNameIncludingLayer ([First Name]  nvarchar(255),[Last Name]  nvarchar(255),[Company Name]  nvarchar(255),[Role in Company]  nvarchar(255),[Address]  nvarchar(255),[Email] nvarchar(255), [Phone Number]   nvarchar(255), [Valid] nvarchar(255))')<br/><br/>insert_to_tmp_tbl_stmt <strong class="ly iu">=</strong> f"INSERT INTO {YourTableName} VALUES (?,?,?,?,?,?,?,?)" <em class="mi"># one ? for each column</em><br/>cursor <strong class="ly iu">=</strong> conn<strong class="ly iu">.</strong>cursor()<br/>cursor<strong class="ly iu">.</strong>fast_executemany <strong class="ly iu">=</strong> <strong class="ly iu">True</strong><br/>cursor<strong class="ly iu">.</strong>executemany(insert_to_tmp_tbl_stmt, ValidDf<strong class="ly iu">.</strong>values<strong class="ly iu">.</strong>tolist())<br/>cursor<strong class="ly iu">.</strong>commit()<br/>cursor<strong class="ly iu">.</strong>close() <br/>conn<strong class="ly iu">.</strong>close()</span></pre><p id="69a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在那里，我们与另一个表进行比较，看看是否真的包括了所有公司名称。因为这可能是由于糟糕的主数据，不是所有当前有效的公司都包括在我们的列表中，这是我们刚刚从ERP中导出的。机器人应该确保我们不会遗漏任何未被发现的东西:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="8d68" class="mc md it ly b gy me mf l mg mh"><strong class="ly iu">import</strong> glob <em class="mi"># glob module is used to retrieve files or pathnames matching specified patterns</em><br/><br/>path <strong class="ly iu">=</strong> r'C:\Users'<br/>all_files <strong class="ly iu">=</strong> glob<strong class="ly iu">.</strong>glob(path <strong class="ly iu">+</strong> "\ValidContactsPerCompany*.xlsx") <em class="mi"># use all Excel files which strings starts with ValidContactsPerCompany. Certainly you can also just use the </em>ValidDf, but again this is mostly for learning purposes on how to deal with different df generating techniques.<br/><br/>li <strong class="ly iu">=</strong> [] <em class="mi"># empty list that will be filled below</em><br/><br/><strong class="ly iu">for</strong> filename <strong class="ly iu">in</strong> all_files:<br/>    DfFromFiles <strong class="ly iu">=</strong> pd<strong class="ly iu">.</strong>read_excel(filename) <br/>    li<strong class="ly iu">.</strong>append(DfFromFiles)<br/><br/>ValidDfFromManyFiles<strong class="ly iu">=</strong> pd<strong class="ly iu">.</strong>concat(li, axis<strong class="ly iu">=</strong>0, ignore_index<strong class="ly iu">=True</strong>) <em class="mi"># concat the list into one df</em></span></pre><p id="aaa4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据基准表运行数据质量检查:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="a82a" class="mc md it ly b gy me mf l mg mh">CompanyInScope<strong class="ly iu">=</strong> pd<strong class="ly iu">.</strong>read_excel(r'C:\Users\CompanyInScope.xlsx')<br/>ValidDfFromManyFilesComparison<strong class="ly iu">=</strong>ValidDfFromManyFiles<strong class="ly iu">.</strong>loc[ValidDfFromManyFiles['Company Name']<strong class="ly iu">.</strong>isin(CompanyInScope['Company Name'])] <br/><em class="mi"># look if there any company names listed which do not exist in our export</em><br/>CompanyExpected <strong class="ly iu">=</strong> pd<strong class="ly iu">.</strong>Index(CompanyInScope['Company Name'])<br/>CompanyExported <strong class="ly iu">=</strong> pd<strong class="ly iu">.</strong>Index(ValidDfFromManyFilesComparison['Company Name'])<br/><em class="mi">print(CompanyExpected.difference(CompanyExported).values)</em></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/6d04fbdf70d3048f9e32e89961293879.png" data-original-src="https://miro.medium.com/v2/resize:fit:382/format:webp/1*ui0lJ4rdorTngbEvwVyIYw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">公司名称8在我们的导出列表中不存在。</p></figure><p id="b410" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前，我们不知道缺少公司名称8是否真的是一个问题。我们的机器人将通过邮件通知它的人类同事，因此她可以检查这是否是由于糟糕的主数据维护:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="a9ce" class="mc md it ly b gy me mf l mg mh">FindOutlookPath <strong class="ly iu">=</strong>r"C:\Program Files (x86)\Microsoft Office\root\Office16\OUTLOOK.EXE"<br/>FindOutlook <strong class="ly iu">=</strong> subprocess<strong class="ly iu">.</strong>Popen(FindOutlookPath)<br/>time<strong class="ly iu">.</strong>sleep(3)<br/><br/>NewMail <strong class="ly iu">=</strong> pyautogui<strong class="ly iu">.</strong>locateOnScreen('Neue.png',confidence<strong class="ly iu">=</strong>0.8) <em class="mi"># Neue stands for New in German</em><br/><em class="mi">#print(NewMail)</em><br/>pyautogui<strong class="ly iu">.</strong>moveTo(NewMail)<br/>pyautogui<strong class="ly iu">.</strong>click()<br/><br/>time<strong class="ly iu">.</strong>sleep(1)<br/>To <strong class="ly iu">=</strong> pyautogui<strong class="ly iu">.</strong>locateOnScreen('An.png',confidence<strong class="ly iu">=</strong>0.8) <em class="mi"># An stands for To in German</em><br/><em class="mi">#print(To)</em><br/>pyautogui<strong class="ly iu">.</strong>moveTo(To)<br/>pyautogui<strong class="ly iu">.</strong>move(90, 0) <em class="mi"># 90 pixel to right to enter address</em><br/>pyautogui<strong class="ly iu">.</strong>click()<br/>pyautogui<strong class="ly iu">.</strong>typewrite('YourColleagueMailAddress', interval<strong class="ly iu">=</strong>0.001)<br/><br/>time<strong class="ly iu">.</strong>sleep(1)<br/>Cc <strong class="ly iu">=</strong> pyautogui<strong class="ly iu">.</strong>locateOnScreen('Cc.png',confidence<strong class="ly iu">=</strong>0.8)<br/><em class="mi">#print(Cc)</em><br/>pyautogui<strong class="ly iu">.</strong>moveTo(Cc)<br/>pyautogui<strong class="ly iu">.</strong>move(90, 0) <em class="mi"># 90 pixel to the right</em><br/>pyautogui<strong class="ly iu">.</strong>click()<br/>pyautogui<strong class="ly iu">.</strong>typewrite('YouOnCc', interval<strong class="ly iu">=</strong>0.001)</span><span id="370a" class="mc md it ly b gy mj mf l mg mh">time<strong class="ly iu">.</strong>sleep(1)<br/>Subject <strong class="ly iu">=</strong> pyautogui<strong class="ly iu">.</strong>locateOnScreen('Betreff.png',confidence<strong class="ly iu">=</strong>0.8) <em class="mi"># Betreff stands for Subject in German</em><br/><em class="mi">#print(Subject)</em><br/>pyautogui<strong class="ly iu">.</strong>moveTo(Subject)<br/>pyautogui<strong class="ly iu">.</strong>move(90, 0) <em class="mi"># ,move 90 pixel to the right for address</em><br/>pyautogui<strong class="ly iu">.</strong>click()<br/>pyautogui<strong class="ly iu">.</strong>typewrite('Data Validation ERP', interval<strong class="ly iu">=</strong>0.001)<br/><br/>time<strong class="ly iu">.</strong>sleep(1)<br/>Signature <strong class="ly iu">=</strong> pyautogui<strong class="ly iu">.</strong>locateOnScreen('Signatur.png',confidence<strong class="ly iu">=</strong>0.8) <em class="mi">#Signatur stands for Signature in German</em><br/><em class="mi">#print(Signature)</em><br/>pyautogui<strong class="ly iu">.</strong>moveTo(Signature)<br/>pyautogui<strong class="ly iu">.</strong>move(0, <strong class="ly iu">-</strong>150) <em class="mi"># from Signature, move 150 pixels top to insert the mail's body above the signature</em><br/>pyautogui<strong class="ly iu">.</strong>click()<br/>pyautogui<strong class="ly iu">.</strong>typewrite('Hi colleague, our bot found a company which is currently missing in our ERP master data: '<strong class="ly iu">+</strong>str(CompanyExpected<strong class="ly iu">.</strong>difference(CompanyExported)<strong class="ly iu">.</strong>values), interval<strong class="ly iu">=</strong>0.001)</span></pre><p id="d4c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为最后一个自动化步骤，让我们假设需要将处理过的数据上传到web表单中。看看<a class="ae ky" href="https://github.com/tebelorg/RPA-Python" rel="noopener ugc nofollow" target="_blank"> Ken Soh </a>用他漂亮的RPA包解决这个任务有多快:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="254b" class="mc md it ly b gy me mf l mg mh"><strong class="ly iu">import</strong> rpa <strong class="ly iu">as</strong> r<br/><br/>r<strong class="ly iu">.</strong>init(turbo_mode <strong class="ly iu">=</strong> <strong class="ly iu">True</strong>) <em class="mi"># to run in quick mode</em><br/>r<strong class="ly iu">.</strong>url('http://rpachallenge.com') <em class="mi"># open this website to fill in forms</em><br/><br/><em class="mi"># timer starts after running this step</em><br/>r<strong class="ly iu">.</strong>click('//*[text()="Start"]')<br/><br/><em class="mi"># loop through and fill in all fields</em><br/><strong class="ly iu">for</strong> i <strong class="ly iu">in</strong> range(len(ValidDfFromManyFiles<strong class="ly iu">.</strong>axes[0])):<br/>    r<strong class="ly iu">.</strong>type('//*[@ng-reflect-name="labelFirstName"]', ValidDfFromManyFiles['First Name'][i])<br/>    r<strong class="ly iu">.</strong>type('//*[@ng-reflect-name="labelLastName"]', ValidDfFromManyFiles['Last Name'][i])<br/>    r<strong class="ly iu">.</strong>type('//*[@ng-reflect-name="labelCompanyName"]', ValidDfFromManyFiles['Company Name'][i])<br/>    r<strong class="ly iu">.</strong>type('//*[@ng-reflect-name="labelRole"]', ValidDfFromManyFiles['Role in Company'][i])<br/>    r<strong class="ly iu">.</strong>type('//*[@ng-reflect-name="labelAddress"]', ValidDfFromManyFiles['Address'][i])<br/>    r<strong class="ly iu">.</strong>type('//*[@ng-reflect-name="labelEmail"]', ValidDfFromManyFiles['Email'][i])<br/>    r<strong class="ly iu">.</strong>type('//*[@ng-reflect-name="labelPhone"]', ValidDfFromManyFiles['Phone Number'][i])<br/>    r<strong class="ly iu">.</strong>click('//*[@value="Submit"]')<br/><br/><em class="mi"># take a screenshot after all forms are filled in, which can also be used as a kind of log file, check also the rpa default log file</em><br/>r<strong class="ly iu">.</strong>snap('page', 'score.png')<br/>r<strong class="ly iu">.</strong>wait(10)<br/>r<strong class="ly iu">.</strong>close()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/8982d674950d50999228bbd637b21e25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*XXW7ehIvNwzzSVe7CIDzYQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Bot将所有数据输入网络表单的速度比我们能做到的要快得多。</p></figure><p id="e093" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">顺便说一下，如果您不知道如何在网站上找到Xpath，只需右键单击该元素，然后按“调查”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/eb5e7e397ee87ad7d453ee7faf6d3d68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dj69suQ1nMXNdjKpGrVgVg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">右键单击对象以研究其Xpath。</p></figure><p id="70ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">总结</strong>:</p><p id="a852" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你在吃午饭的时候，看着你的机器人为你做无聊的工作，感觉不是很好吗？因为这确实是值得一提的一点:GUI自动化接管了你的鼠标和键盘，就像一个人坐在电脑前一样。因此，当机器人将鼠标光标定位在屏幕上的特定区域时，你不应该同时移动鼠标。同样的事情也适用于任何击键。你必须确保在加载之间有足够长的等待时间，这样机器人才能在当前显示的屏幕上运行所有步骤。在Windows pc上工作，我看不到一个简单的解决方案，如何让机器人在后台工作，这样你就可以在同一时间继续工作。无论是添加第二个键盘和鼠标，还是在终端服务器上运行脚本，都没有解决这个问题。也许你们中有人有解决办法？我肯定会洗耳恭听。</p><p id="52ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">非常感谢您的阅读！希望这篇文章对你有帮助。请随时在<a class="ae ky" href="https://de.linkedin.com/in/jesko-rehberg-40653883" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>、<a class="ae ky" href="https://twitter.com/DAR_Analytics" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或<a class="ae ky" href="https://jesko-rehberg.medium.com/virtual-reality-vr-for-education-a532aa5b6272" rel="noopener">工作室</a>与我联系。</p><div class="mq mr gp gr ms mt"><a href="https://jesko-rehberg.medium.com/membership" rel="noopener follow" target="_blank"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd iu gy z fp my fr fs mz fu fw is bi translated">通过我的推荐链接加入Medium-Jesko Rehberg</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">阅读杰斯科·雷伯格(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">jesko-rehberg.medium.com</p></div></div><div class="nc l"><div class="nd l ne nf ng nc nh ks mt"/></div></div></a></div><p id="b468" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在我的Github中下载完整的<a class="ae ky" href="https://github.com/DAR-DatenanalyseRehberg/GuiAutomateRpa" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本和图片</a>。</p></div></div>    
</body>
</html>