<html>
<head>
<title>Gradient Boosted ARIMA for Time Series Forecasting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列预测的梯度增强ARIMA</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/gradient-boosted-arima-for-time-series-forecasting-e093f80772f6#2022-01-26">https://towardsdatascience.com/gradient-boosted-arima-for-time-series-forecasting-e093f80772f6#2022-01-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""><h1 id="44c7" class="pw-post-title ir is it bd iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp bi translated">时间序列预测的梯度增强ARIMA</h1></div><div class=""><h2 id="2eab" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">提升PmdArima的Auto-Arima性能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4aae73d52e8088a07c5f7cf1f25ded88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kC-xl8XOmmaDm_GUI-eChw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://unsplash.com/@spacex" rel="noopener ugc nofollow" target="_blank"> SpaceX </a>在<a class="ae ky" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="d5fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> TLDR: </strong>将梯度推进添加到ARIMA增加了拟合过程的复杂性，但是如果我们在每一轮推进中针对新的(p，d，q)参数进行优化，也可以提高精度。虽然，升压结合其他方法可以获得更大的增益。</p><p id="89d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有代码都住在这里:<a class="ae ky" href="https://github.com/tblume1992/ThymeBoost" rel="noopener ugc nofollow" target="_blank">百里香Github </a></p><p id="1796" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看这篇<a class="ae ky" rel="noopener" target="_blank" href="/thymeboost-a0529353bf34">文章</a>，了解百里香的完整介绍。</p><h1 id="5411" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">介绍</h1><p id="1c9c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">梯度推进多年来一直是机器学习领域的一个热门话题，但在时间序列领域还没有获得太多的关注。理论工作已经完成，但没有多少像ARIMA等传统方法那样获得主流关注。这主要是因为boosting方法的大部分收益(通常)来自以某种方式对数据进行分区的方法，如决策树。我们当然可以尝试以某种方式划分我们的数据，但很多时候我们没有足够的数据来使用非常复杂的方法，这导致了较差的结果。另一方面，提升一些简单的东西，如线性回归，往往会正则化系数，但通常会采用更直接的正则化方法。</p><p id="4e2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">说了这么多，还是来助推一些时间序列的方法吧！</p><p id="730b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">具体来说，我们将着眼于提高ARIMA，并将其与PmdArima进行比较。为了增强效果，我们将使用一个我正在开发的包:<a class="ae ky" href="https://github.com/tblume1992/ThymeBoost" rel="noopener ugc nofollow" target="_blank">百里香增强</a>。这个包使用一个通用的boosting框架来进行时间序列分解和预测，同时包含了梯度boosting中一些通常不会应用的更有用的想法(据我所见)。但就我们的目的而言，我们将只做简单的助推。</p><p id="7d73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的实验将使用一个非常常见的时间序列数据集来:</p><ol class=""><li id="7608" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">从PmdArima拟合自动arima</li><li id="9a1e" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">使用找到的参数来增强简单的ARIMA</li><li id="9642" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">使用PmdArima增强以在每轮搜索新参数</li><li id="6b4d" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">对比结果！</li></ol><h1 id="a6a8" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">航空乘客数据集</h1><p id="f90e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们将尝试的第一个数据集是航空乘客数据集，可以从<a class="ae ky" href="https://www.kaggle.com/rakannimer/air-passengers" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>中找到，并带有开放数据库许可证。让我们看看并导入所有必需的包:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="39b4" class="nl lw it nh b gy nm nn l no np">import numpy as np<br/>import pandas as pd<br/>from matplotlib import pyplot as plt<br/>import seaborn as sns<br/>sns.set_style("darkgrid")#Airlines Data, if your csv is in a different filepath adjust this<br/>df = pd.read_csv('AirPassengers.csv')<br/>df.index = pd.to_datetime(df['Month'])<br/>y = df['#Passengers']<br/>plt.plot(y)<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/e43801365babba2bbf55b5348b04ba84.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/0*aYMySJYtks4CqB3M.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4abc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了判断预测方法，我们将把数据分割成标准的训练/测试分割，其中保留最后30%的数据。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="d5f3" class="nl lw it nh b gy nm nn l no np">test_len = int(len(y) * 0.3)<br/>al_train, al_test = y.iloc[:-test_len], y.iloc[-test_len:]</span></pre><p id="4847" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在快速提醒一下，百里香增强对趋势和季节性做了一些非常具体的假设，所以我们不能在使用季节性(这个时间序列显然有)时直接将其与auto-arima进行比较。但是，我们还是会尝试，只是没有季节性。</p><p id="5c9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先我们使用PmdArima:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="18af" class="nl lw it nh b gy nm nn l no np">import pmdarima as pm<br/># Fit a simple auto_arima model<br/>arima = pm.auto_arima(al_train,<br/>                      seasonal=False,<br/>                      trace=True,<br/>                      )<br/>pmd_predictions = arima.predict(n_periods=len(al_test))<br/>arima_mae = np.mean(np.abs(al_test - pmd_predictions))<br/>arima_rmse = (np.mean((al_test - pmd_predictions)**2))**.5<br/>arima_mape = np.sum(np.abs(pmd_predictions - al_test)) / (np.sum((np.abs(al_test))))</span></pre><p id="56b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/02dfcf2887e2e1d480d00f2f9501e4bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*qo3NbfcLcDL_ZkJ_RJWBiQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b450" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将获取“最佳”参数，并将其传递给百里香增强，以用于每一轮增强。使用的顺序就是PmdArima字典中的顺序，当使用截距时，趋势参数(如果我理解文档的话)将是“c”。这些参数将被传递给百里香增强:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="8eb5" class="nl lw it nh b gy nm nn l no np">#get the order<br/>auto_order = arima.get_params()['order']<br/>from ThymeBoost import ThymeBoost as tb<br/>boosted_model = tb.ThymeBoost(verbose=1)</span><span id="b772" class="nl lw it nh b gy ns nn l no np">output = boosted_model.fit(al_train,<br/>                            trend_estimator='arima',<br/>                            arima_order=auto_order,<br/>                            global_cost='mse')<br/>predicted_output = boosted_model.predict(output, len(al_test))<br/>tb_mae = np.mean(np.abs(al_test - predicted_output['predictions']))<br/>tb_rmse = (np.mean((al_test - predicted_output['predictions'])**2))**.5<br/>tb_mape = np.sum(np.abs(predicted_output['predictions'] - al_test)) / (np.sum((np.abs(al_test))))</span></pre><p id="b9f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果是…非常糟糕:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/98267107064d1697617e687ac7065cf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*GTIfhLI7ytz3RWK57sMvTQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="97bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当看这些预测时，很容易明白为什么:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="25eb" class="nl lw it nh b gy nm nn l no np">boosted_model.plot_results(output, predicted_output)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/eabc37596be536e6a3f97324839b2b85.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*DKjGFXFiHktejVSVhga_eQ.png"/></div></figure><p id="fc0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看起来，当增强(拟合简单的平均值/中值)使得先前发现的参数无用时，出现初始化回合。事实上，如果您查看日志，甚至不会发生任何提升！百里香中的助推程序完全改变了游戏，负面的。</p><p id="4a94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果尝试使用PmdArima搜索新参数呢？</p><p id="1cf4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们试一试。</p><p id="87a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们只需为arima_order参数传递“auto”。让我们看看它是如何做到的:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="b1e4" class="nl lw it nh b gy nm nn l no np">from ThymeBoost import ThymeBoost as tb<br/>boosted_model = tb.ThymeBoost(verbose=1)</span><span id="9ec5" class="nl lw it nh b gy ns nn l no np">output = boosted_model.fit(al_train,<br/>                            trend_estimator='arima',<br/>                            arima_order='auto',<br/>                            global_cost='mse')<br/>predicted_output = boosted_model.predict(output, len(al_test))<br/>tb_mae = np.mean(np.abs(al_test - predicted_output['predictions']))<br/>tb_rmse = (np.mean((al_test - predicted_output['predictions'])**2))**.5<br/>tb_mape = np.sum(np.abs(predicted_output['predictions'] - al_test)) / (np.sum((np.abs(al_test))))</span></pre><p id="a3c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/c8dae7f492f451656dfa49b61b7740a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*hB3q37zbQk5J0cv3bbmkGw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="d94f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">略有改善！查看日志，我们看到总共有4轮:1轮初始化和3轮提升。</p><p id="8495" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，我们在这里不是为了边际改进。除了自动Arima之外，让我们用一个简单的线性趋势来看看效果如何。这可以通过简单地将它们作为列表传递来实现:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="5b3a" class="nl lw it nh b gy nm nn l no np">from ThymeBoost import ThymeBoost as tb<br/>boosted_model = tb.ThymeBoost(verbose=1)</span><span id="ea2d" class="nl lw it nh b gy ns nn l no np">output = boosted_model.fit(al_train,<br/>                            trend_estimator=['linear', 'arima'],<br/>                            arima_order='auto',<br/>                            global_cost='mse')<br/>predicted_output = boosted_model.predict(output, len(al_test))<br/>tb_mae = np.mean(np.abs(al_test - predicted_output['predictions']))<br/>tb_rmse = (np.mean((al_test - predicted_output['predictions'])**2))**.5<br/>tb_mape = np.sum(np.abs(predicted_output['predictions'] - al_test)) / (np.sum((np.abs(al_test))))</span></pre><p id="c26f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/a5d055842c069177bf304fb5e190916a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q2s71VNgJ-YpY_pUhxNfvQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="919d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与所有其他方法相比，这是一个显著的改进！</p><h1 id="6a4d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">结论</strong></h1><p id="34b1" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在本文中，我们探索了一种利用ARIMA的增强方法。我们看到，采用静态的“最佳”参数配置会导致升压过程中的可怕结果。另一方面，如果我们为每一轮提升动态地找到新的参数设置，我们可以在精度上获得边际收益。</p><p id="78a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，也许只是提高ARIMA并不总是最好的事情。相反，也许用其他模型增强ARIMAs可能会让我们有更好的表现。</p><p id="b22e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢这种用时间序列方法提升的方式，我强烈推荐你看看我的另一篇文章:<a class="ae ky" rel="noopener" target="_blank" href="/the-m4-time-series-forecasting-competition-with-thymeboost-b31196fc319">用百里香提升的M4竞赛</a>。本文是一系列文章中的第一篇，我们将应用许多不可靠的不同的百里香增强设置，努力学习所有这些方法如何在框架中工作，并最终(<em class="nx">剧透警告</em>)赢得M4竞赛。</p></div></div>    
</body>
</html>