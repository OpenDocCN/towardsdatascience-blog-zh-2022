<html>
<head>
<title>Build Your First AWS CDK Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建您的第一个AWS CDK项目</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-your-first-aws-cdk-project-18b1fee2ed2d#2022-01-03">https://towardsdatascience.com/build-your-first-aws-cdk-project-18b1fee2ed2d#2022-01-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""><h1 id="06a5" class="pw-post-title ir is it bd iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp bi translated">构建您的第一个AWS CDK项目</h1></div><div class=""><h2 id="6036" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Python使基础设施代码变得简单</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1728b79a5be41eba14783200d76f0216.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rptWISpXkO8zFMNP"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://unsplash.com/@tezos" rel="noopener ugc nofollow" target="_blank">泰佐斯</a>的<a class="ae ky" href="https://unsplash.com/photos/y8wjQZ9XP4A" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="8b61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不久前，我写了一篇关于AWS CloudFormation的文章，这是一个代码为的<a class="ae ky" rel="noopener" target="_blank" href="/infrastructure-as-code-with-aws-207239573de">基础设施工具，它使得在一个中央yaml或json文件中定义和部署基础设施资源变得很容易。这使得开发人员可以轻松地跟踪和监控基础设施的任何更改，并且还可以与大多数AWS服务集成。虽然CloudFormation功能强大，但语法需要一点时间来掌握，而且肯定有一个小的学习曲线。</a></p><p id="ab95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使这个过程更加容易，我们将研究AWS云开发工具包(<a class="ae ky" href="https://aws.amazon.com/cdk/" rel="noopener ugc nofollow" target="_blank"> AWS CDK </a>)。AWS CDK也作为代码工具的基础设施，但它支持许多语言，如Python、TypeScript和Java，您可以使用它们来定义您的资源。这使得<strong class="lb iu">部署和管理您的资源更加简单</strong>，因为您可以使用自己选择的语言和适当的SDK，而不是试图从头构建一个YAML文件或您自己的云形成集。AWS CDK从本质上抽象出了CloudFormation模板构建过程，并在幕后为您处理这一部分。</p><p id="8ba4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在今天的文章中，我们将探索一个简单的Python示例，并观察我们通过AWS CDK定义、部署和管理资源的速度。</p><p id="0f81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意</strong>:对于那些刚接触AWS的人来说(有一些经验来完全理解这篇文章是很好的)，如果你想继续下去，请确保在下面的<a class="ae ky" href="https://aws.amazon.com/console/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">链接</strong> </a>中做一个帐户。确保还安装了<a class="ae ky" href="https://aws.amazon.com/cli/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> AWS CLI </strong> </a> <strong class="lb iu">以使用示例。我还将提供一个我们将使用的服务列表，以及更深入的定义。如果您已经熟悉这些服务，请随意跳到您感兴趣的部分。</strong></p><h1 id="d40d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">目录</h1><ol class=""><li id="9efa" class="mn mo it lb b lc mp lf mq li mr lm ms lq mt lu mu mv mw mx bi translated">先决条件/设置</li><li id="7447" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">CDK命令</li><li id="7f20" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">构建S3桶和Lambda函数的Python示例</li><li id="9cc8" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">其他资源和结论</li></ol><h2 id="cab7" class="nd lw it bd lx ne nf dn mb ng nh dp mf li ni nj mh lm nk nl mj lq nm nn ml no bi translated">1.先决条件/设置</h2><p id="055e" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">在你开始工作之前，你需要一些依赖。如前所述，确保安装了AWS CLI并用您的安全凭证配置了。确保也安装了pip，对于这个例子，我们将使用Python 3.7。要安装CDK，你需要安装<a class="ae ky" href="https://docs.npmjs.com/downloading-and-installing-node-js-and-npm" rel="noopener ugc nofollow" target="_blank">NPM</a>。要安装CDK，请在安装npm后运行以下命令。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安装cdk</p></figure><p id="9b66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要验证CDK已经安装并访问文档，在您的终端中运行以下命令，它会将您重定向到CDK文档。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">访问文档</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/b8c89bade5f25716d4ab6b1ea634b6b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cKFy5Zmnbe0dTMneqSmfHg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">CDK文件(作者截图)</p></figure><p id="4fde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以专注于创建我们的Python CDK项目了。我创建了一个名为“cdk-samples”的目录，并在CLI中为该目录运行以下命令。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建Python CDK应用程序</p></figure><p id="fa1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将在您的环境中安装以下文件和目录。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/81eccca0bbb3a15b04be848dec4458d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H9FKfW1M6O-NZqopqhVNeA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">已安装的目录/文件(作者截图)</p></figure><p id="5e54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要激活虚拟环境，之后我们可以安装任何其他依赖项。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">激活virtualenv</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/4990082eac69fd58ce6d832aedc9d12e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o1nrFPIg2FQBJOq1ihHA6w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">激活虚拟环境(作者截图)</p></figure><p id="f453" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然已经安装了虚拟环境，请确保安装requirements.txt。对于我们的示例，我们将向预先创建的requirements.txt添加S3和Lambda模块，如下所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">通过CLI安装</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">requirements.txt</p></figure><p id="4fc5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们将处理两个主要文件。如果你去cdk_samples目录，会有一个名为<strong class="lb iu">的文件cdk_samples_stack.py </strong>。这是您可以在模块中定义资源的地方。对于这个例子，我们将<strong class="lb iu">创建</strong>一个<strong class="lb iu"> S3桶</strong>和一个<strong class="lb iu"> Lambda函数</strong>，我们将在这里使用Python SDK定义这两个资源。根目录中的<strong class="lb iu"> app.py </strong>文件将合成并执行我们用资源定义的这个模块。</p><h2 id="9ed2" class="nd lw it bd lx ne nf dn mb ng nh dp mf li ni nj mh lm nk nl mj lq nm nn ml no bi translated">2.CDK命令</h2><p id="2174" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">在我们继续之前，我只想介绍一些我们将使用的常见CDK CLI命令，这些命令对您也很有用。</p><p id="7d01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> cdk synth </strong>:这将创建由您的代码定义的CloudFormation模板/堆栈。</p><p id="3205" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> cdk deploy </strong>:这将获取从synth命令创建的CloudFormation堆栈，并部署定义的资源。</p><p id="0015" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> cdk bootstrap </strong>:这与我们的例子相关，因为我们正在处理<a class="ae ky" href="https://docs.aws.amazon.com/cdk/v2/guide/assets.html" rel="noopener ugc nofollow" target="_blank">资产</a>。每当您有本地代码、Docker映像等时，都需要在部署模板之前进行引导。这与我们的用例相关，因为我们在本地文件中定义了Lambda代码。</p><p id="9663" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要查看所有cdk命令的列表，请查看文档<a class="ae ky" href="https://docs.aws.amazon.com/cdk/v2/guide/cli.html" rel="noopener ugc nofollow" target="_blank">这里是</a>。</p><h2 id="2315" class="nd lw it bd lx ne nf dn mb ng nh dp mf li ni nj mh lm nk nl mj lq nm nn ml no bi translated">3.构建S3桶和Lambda函数的Python示例</h2><p id="e6aa" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">导航到cdk_samples_stack目录和其中对应的Python文件。首先，我们将构建一个样本S3桶。我们首先通过CDK导入将要使用的服务。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">CDK堆栈</p></figure><p id="45da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们现在可以定义我们想要创建的S3存储桶。要做到这一点，访问<a class="ae ky" href="https://docs.aws.amazon.com/cdk/api/v1/python/aws_cdk.aws_s3/Bucket.html" rel="noopener ugc nofollow" target="_blank"> S3 CDK Python文档</a>创建一个桶。确保您的存储桶名称是全球唯一的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建S3存储桶</p></figure><p id="8c7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在返回到根目录并在CLI中运行cdk synth，您应该看到终端中显示的CloudFormation模板和S3 bucket资源。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/3a28668364086dfa1988e6c00bc23538.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y3a7Qe3iI5sOI0tGmuYmhg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">cdk synth(作者截图)</p></figure><p id="18ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">模板部署完成后，运行cdk deploy，资源将被部署，您可以在AWS控制台中看到CloudFormation Stack ARN。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/61b28bc24a0d9a22292f9a023cb4f33a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GI2IwfGemsFsNZE9qhYIag.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">cdk部署(作者截图)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/b28543343190c5f7b05054d4e8af683f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c5tJN-BX70MuUsDC2ww8QQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">CDK堆栈控制台(作者截图)</p></figure><p id="2fca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们导航到S3控制台，您应该能够看到我们刚刚创建的S3桶。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/9f68a73478d7a647b4e15d7d90d456a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2HskEJQUUtgeyiGlnf9KSg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">S3桶创建(作者截图)</p></figure><p id="fa24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以按照一个非常简单的过程来创建我们的Lambda函数。回到cdk samples目录，为模拟Lambda函数创建一个Lambda目录。您的目录应该如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/33018840875b5a0e752c1f6647c60e57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*u4k6akJtqEP4aOJoayQ4fw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Lambda目录(作者截图)</p></figure><p id="d219" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于lambda_handler文件，我们将添加一个存根lambda函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">λ处理器</p></figure><p id="1b53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以返回到我们的cdk_example_stack.py文件，并使用下面的<a class="ae ky" href="https://docs.aws.amazon.com/cdk/api/v1/python/aws_cdk.aws_lambda.html" rel="noopener ugc nofollow" target="_blank">文档</a>定义这个Lambda函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">定义λ函数</p></figure><p id="9575" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以运行相同的CDK CLI命令，只是您可能需要在合成和部署之间进行引导，以考虑我们已经定义的本地Lambda函数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/a871cc77494d4074b927405456ec1b7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mVwXEENT1NNgN-YzAxHyuQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">更新的堆栈(作者截图)</p></figure><p id="eb97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们查看CloudFormation控制台，我们现在应该会看到添加了一个Lambda函数，这在Lambda控制台中也可以看到。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/7cc84e251465de2d03583fe39041aadd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DWMerpTEfiruFb-nroOsrw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用Lambda资源更新堆栈(作者截图)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/356952ffd0050da23e45254796f6e63a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WZwaJfuOwhIvETPF4q8sSw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">控制台中的Lambda函数(作者截图)</p></figure><p id="18c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要清理所有资源并删除CloudFormation堆栈，请运行<strong class="lb iu"> cdk destroy </strong>。</p><h2 id="55cb" class="nd lw it bd lx ne nf dn mb ng nh dp mf li ni nj mh lm nk nl mj lq nm nn ml no bi translated">4.其他资源和结论</h2><p id="48f4" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">完整代码举例:<a class="ae ky" href="https://github.com/RamVegiraju/CDK-Examples" rel="noopener ugc nofollow" target="_blank">https://github.com/RamVegiraju/CDK-Examples</a></p><p id="0606" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">https://github.com/aws-samples/aws-cdk-examples CDK样本库:<a class="ae ky" href="https://github.com/aws-samples/aws-cdk-examples" rel="noopener ugc nofollow" target="_blank"/></p><p id="9899" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在一个小时内，我们设法使用裸Python轻松定义和部署了一个简单的AWS应用程序。CDK是一个功能强大的工具，可用于集中跟踪您的资源，并极大地简化基础架构管理。</p></div><div class="ab cl of og hx oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="im in io ip iq"><p id="76ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="om">如果你喜欢这篇文章，请在</em> <a class="ae ky" href="https://www.linkedin.com/in/ram-vegiraju-81272b162/" rel="noopener ugc nofollow" target="_blank"> <em class="om"> LinkedIn </em> </a> <em class="om">上与我联系，并订阅我的媒体</em> <a class="ae ky" href="https://ram-vegiraju.medium.com/subscribe" rel="noopener"> <em class="om">简讯</em> </a> <em class="om">。如果你是新手，使用我的</em> <a class="ae ky" href="https://ram-vegiraju.medium.com/membership" rel="noopener"> <em class="om">会员推荐</em> </a> <em class="om">报名。</em></p></div></div>    
</body>
</html>