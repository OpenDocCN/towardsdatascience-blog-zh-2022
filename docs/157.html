<html>
<head>
<title>Creating Beautiful Topography Maps with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python制作漂亮的地形图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-beautiful-topography-maps-with-python-efced5507aa3#2022-01-06">https://towardsdatascience.com/creating-beautiful-topography-maps-with-python-efced5507aa3#2022-01-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="0ef4" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""><h1 id="b893" class="pw-post-title iy iz iq bd ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv bi translated">用Python制作漂亮的地形图</h1></div><div class=""><h2 id="9fa9" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">当您可以用Python构建引人注目的3D地形图时，谁还需要GIS呢？</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/60e34234b7f8b2c19f35e40189f2db76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uw28JKAptfv6wzZliDtPeg.png"/></div></div></figure><p id="2266" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">制图twitter目前充斥着一些引人注目的单个国家或地区的地形图。这主要是由于可用数据源的扩展和许多无聊的地理书呆子在疫情期间让自己忙碌。有很多工具和方法可以用来生成上面分享的美丽的意大利地图，但是在这篇文章中，我将使用Python向您展示一种非常规的方法，希望您会像我一样确信，如果某件事情值得做，就值得用Python来做。</p><p id="a25e" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">有许多可用的数据源，都有不同程度的分辨率。在纯粹的美学层面上，图像的分辨率越高，最终的图像看起来就越好。从精度的角度来看，较低分辨率的数据集也可能会夸大要素，使相对平坦的区域看起来相当多山。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lw"><img src="../Images/89274659f494fec8bb3144c538a32730.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gXrAUbGkGs5QHJ9C8HYHzw.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">使用高分辨率(7.5弧秒)和低分辨率(1弧分)数据源绘制的意大利地形图。作者图片</p></figure><p id="29a3" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">虽然它们看起来没有什么不同，但左图使用的数据(1)比右图(2)的分辨率高得多，因此相对平坦的区域，例如意大利北部的波河流域，看起来比右图中的实际丘陵要多。因此，今后我们将使用来自美国地质调查局(1)的高分辨率数据。数据可以免费使用，关于数据使用的更多信息可以在下面的<a class="ae mb" href="https://topotools.cr.usgs.gov/GMTED_viewer/gmted2010_fgdc_metadata.html" rel="noopener ugc nofollow" target="_blank">链接</a>中找到。数据被分割成30 x 20度的tif文件，覆盖了全球的不同地区，幸运的是意大利位于其中一个文件中，所以我们不需要担心合并不同的tif文件，尽管我将在以后的文章中探讨这个问题。下载数据非常简单，只需点击您想要的图块，然后按照下载说明进行操作。然后把数据复制到你想编程的任何地方。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mc"><img src="../Images/694cb8fd52ad5de7aaf91be74e6c8e70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5_atZFPDzBcifE-sx_u_wg.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">美国地质勘探局运营的数据交付平台截图。作者图片</p></figure><p id="56e9" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">首先要做的是使用<code class="fe md me mf mg b">rasterio</code>打开并读取数据，这是一个相对简单的过程，但我已经包含了代码。然后，重要的是绘制数据，以了解实际情况和您正在处理的问题。有各种各样的函数可以汇总数据，但是我认为它们很少能很好地代替图表。需要注意的是，<code class="fe md me mf mg b">rasterio.open</code>创建了一个<code class="fe md me mf mg b">rasterio </code>数据集对象，它包含高程值的2D数组(纬度x经度)以及关于所使用的投影和图像范围的信息，这在后面会很重要。read方法将rasterio数据集对象中的数据读入高程值的2D <code class="fe md me mf mg b">numpy </code>数组(在本例中)。2D数组用于绘图，而<code class="fe md me mf mg b">rasterio </code>数据集对象将在以后使用。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mh mi l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mj"><img src="../Images/c0da1ad7e5966d87661cd69f6d908e9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MzmRN2hOefu3_lteLlsAcg.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">原始数据，使用光谱色彩图绘制。作者图片</p></figure><p id="d550" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">有一个迫在眉睫的问题需要解决，数据集包含南欧大部分地区和北非部分地区的信息，而实际上，我们想要的只是意大利。幸运的是，<code class="fe md me mf mg b">rasterio </code>提供了一种基于地理配准形状(如多边形)裁剪栅格的有用方法。在本例中，我使用了NaturalEarth (3)数据集的一部分意大利多边形，通过<code class="fe md me mf mg b">rasterio.mask.mask </code>函数来裁剪栅格。我加载了NaturalEarth shapefile并使用<code class="fe md me mf mg b">geopandas </code>提取了意大利的几何图形，然后使用了蒙版功能。mask函数采用<code class="fe md me mf mg b">rasterio </code>数据集对象，并返回所提供的多边形内的栅格部分。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mh mi l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mk"><img src="../Images/a87f3391a366c9f23777f3e487150d85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GQFoWKRNc9RYwJlAWNug6A.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">作者图片</p></figure><p id="e0dd" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">现在我们有了仅与意大利相对应的海拔值，但是仍然有一个问题。默认情况下,<code class="fe md me mf mg b">rasterio.mask.mask</code>将用0填充所有不在意大利多边形内的值。虽然这是合理的，但这些0将使绘图变得棘手，因为它们在色彩图的底部充当锚，如果0和意大利数据中的最小高程值之间有很大的差距，那么您会看到上面看到的图，其中一半色彩图中有真实数据，另一半色彩图中没有真实数据，因为0和真实数据的最小值之间有差距。例如，如果0和最小值之间的差距等于最小和最大高度之间的差距，那么实际上只有一半的颜色图将用于真实数据。</p><p id="a429" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">为了解决这个问题，mask函数允许您使用关键字<code class="fe md me mf mg b">nodata</code>明确设置什么值将被应用到不在意大利多边形内的值。我在下面加入了一个函数来解决这个问题。在下面的函数中，我传递了意大利<code class="fe md me mf mg b">GeoDataFrame </code>和<code class="fe md me mf mg b">rasterio </code>数据集对象。您会注意到掩膜函数被调用了两次，第一次是如上所述调用，不在意大利面内的值被返回为0。第二次，使用了<code class="fe md me mf mg b">nodata </code>参数，不属于意大利面的值被设置为比意大利地形数据集中的最大值大1(使用第一个掩膜计算)。结果是，我们现在有了一个在值中没有自然间隙的数据集，并且图表开始成形。这个函数返回的还有<code class="fe md me mf mg b">value_range </code>变量。这对应于数组中最小和最大值之间的差距，并且在以后构造颜色图时需要。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mh mi l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ml"><img src="../Images/7c894902625465bf792b97c611c5ccca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bkyVozOk5W43XXGK-_Jk-w.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">作者图片</p></figure><p id="051c" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">现在我们需要构建一个合适的颜色图。绝对明确地说，本文的目的是向您展示如何生成有趣但至关重要的美丽地形图。如果你计划创造一些军事单位将在战斗中使用的东西，那么我建议你使用更定量的颜色图。在这个例子中，我们将基于意大利国旗构建一个颜色图。下面我用意大利国旗的颜色做了一个。仅仅使用这三种颜色会产生一个中间有太多白色的颜色图，所以我在这个颜色图的2号和4号位置添加了额外的绿色和红色，以最小化白色的优势。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mh mi l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mm"><img src="../Images/fbaca30e5881bc2e2612f9d8ea3fab8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*squkUsVLgZGb_f4yvIW6_g.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">作者图片</p></figure><p id="e503" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我们仍然需要处理不属于之前创建的意大利高程数据集的值。我们将这些值设置为比高程数据中的最大值大1。解决方案是用足够的颜色构建一个色彩图，这样意大利高程数据中的每个唯一值都有自己的颜色，然后用我们的背景色替换色彩图中的最后一种颜色(红边)。例如，考虑一个场景，其中最小高程值为10，最大高程值为100，我们将非意大利值设置为101。如果我们用91种颜色创建一个色彩映射表，用我们的背景色替换第91种颜色，那些非意大利值将被映射到第91种颜色，这是我们的背景色。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="71af" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">现在，有了新的颜色图和剪辑数据，我们就可以绘制数据了。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mh mi l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mn"><img src="../Images/dd9759bf6d5d763f12145800ede8cb38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wmcS0sR5T_GGF0r769fCdw.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">作者图片</p></figure><p id="455a" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">虽然我认为这仍然看起来很好，它仍然是2D和地形是三维的。所以最后要做的是添加山体阴影来模拟光照在地形上。山体阴影是表面的3D表示，通常以灰度渲染。较暗和较亮的颜色表示您在地形模型中看到的阴影和高光。山体阴影通常用作地图中的参考底图，以使数据看起来更加三维，从而在视觉上更加有趣。我们将使用<code class="fe md me mf mg b">earthpy </code>山体阴影函数来生成山体阴影数据。有两个参数可以调整，根据数据集的不同，它们会给出明显不同的结果。第一个是<code class="fe md me mf mg b">azimuth </code>值，范围为0-360度，与光源的发光位置有关。0度对应于指向正北的光源。第二个是光源所在的<code class="fe md me mf mg b">altitude </code>，这些值的范围是1-90。下面是几个例子，强调了改变这两个值会产生非常不同的结果。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mh mi l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mo"><img src="../Images/534325bfdf333be08533749800c6487d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Prsds4LZJRW9LTPijV9lw.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">不同的方位角值及其对山体阴影渲染方式的影响。所有的高度都设置为1。作者图片</p></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mo"><img src="../Images/f85a48b47b96562b1fa4681e4af4f082.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uW6nIQDz3CR-vbGldeG3lg.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">不同的高度值及其对山体阴影渲染方式的影响。所有都设置了180°的方位角。作者图片</p></figure><p id="4c56" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">最后我决定方位角值为180，这样我在阿尔卑斯山的南边得到了一个漂亮的阴影，高度值为1。不过，我会鼓励你自己尝试这些价值观。最后是绘制成品的时候了。首先绘制主要的意大利地形数据，在顶部绘制带有小alpha值的山体阴影。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mh mi l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mp"><img src="../Images/20723747e58959531b3d8759240f00e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gFpTw2Og4Bf5ICHPv9wfRw.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">瞧啊。作者图片</p></figure><p id="cfd1" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">放大可以让你真正看到图像的细节！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mp"><img src="../Images/8746371a7c187c2a3b7bed63b8bc34bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SPDzjeMe0WCCjhFV67ilpA.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">作者图片</p></figure><p id="7b46" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">这就是我们的意大利地形图，一幅非常赏心悦目的意大利地形图，随时可以裱起来挂在你的墙上。这种方法可以应用于任何国家或地区，但是如果一个国家的数据跨越多个tif文件，则需要额外的步骤。我将在以后的文章中讨论这个问题，所以请订阅以确保你能看到它。</p><p id="9743" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">(1)-高分辨率数据源- Danielson，J.J .和Gesch，D.B .，2011，全球多分辨率地形高程数据2010 (GMTED2010):美国地质调查局公开文件报告2011–1073，26页doi: <a class="ae mb" href="https://doi.org/10.5066/F7J38R2N" rel="noopener ugc nofollow" target="_blank"> 10.5066/F7J38R2N </a>数据免费使用，关于使用的进一步信息可在此处找到- <a class="ae mb" href="https://topotools.cr.usgs.gov/GMTED_viewer/gmted2010_fgdc_metadata.html" rel="noopener ugc nofollow" target="_blank"> https://topotools.cr.usgs</a></p><p id="2cd8" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">(2)—低分辨率数据源- <a class="ae mb" href="http://dx.doi.org/10.7289/V5C8276M" rel="noopener ugc nofollow" target="_blank"> doi:10.7289/V5C8276M </a></p><p id="39ff" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">(3)—natural earth—<a class="ae mb" href="https://www.naturalearthdata.com/" rel="noopener ugc nofollow" target="_blank">https://www.naturalearthdata.com/</a></p></div></div>    
</body>
</html>