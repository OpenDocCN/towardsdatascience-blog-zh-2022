<html>
<head>
<title>Using Compute Power to Iterate Faster Through ML Experiments</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用计算能力更快地迭代ML实验</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-compute-power-to-iterate-faster-through-ml-experiments-94c72342adaf#2022-01-07">https://towardsdatascience.com/using-compute-power-to-iterate-faster-through-ml-experiments-94c72342adaf#2022-01-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""><h1 id="e1ed" class="pw-post-title io ip iq bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">使用计算能力更快地迭代ML实验</h1></div><div class=""><h2 id="43c6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在机器学习环境中使用Python模板进行引导实验并提高生产率</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/66e954e75cfcaa67d29c14ab127a5d65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L1632n0WdKgK0x1j3DuRfQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">(图片由<a class="ae kv" href="https://unsplash.com/photos/KsSxzBnozMY" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>提供)</p></figure><p id="66e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我已经创建了一个<a class="ae kv" href="https://github.com/Yann21/cookiecutter-exp-launcher" rel="noopener ugc nofollow" target="_blank"> Python模板</a>，它使得在AWS上运行ML实验变得很方便，所以你也可以为你的项目利用大规模云计算。这缩短了实验周期时间，允许您批量进行多个实验，并提高整体生产率。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="cef9" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">动机</h1><p id="20ae" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">等待脚本终止是我最讨厌的事情。这不仅是浪费时间，而且不断的上下文切换会让人分心和疲惫。一个严重的违规者是ML实验，它会持续几分钟到几天。作为开发生命周期的一部分，ML实验可以在任何时候进行，只要你想在一组新的超参数上评估你的模型(如在超参数优化中)，探索新的特性(特性选择)，或者尝试一个新的模型架构。在某种程度上，特性和模型架构只是超参数的美化形式。ML实验总是可以被认为是调整一组受限的二元超参数，以最大化您的评估指标。</p><p id="ecee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当然，你可能有纪律去读毕晓普第一次你的10分钟实验运行。但是在第十次迭代之后，有可能<em class="mw">实验疲劳</em>会出现，你会在reddit上离开。有没有一种方法，如果不能缩短等待时间，至少可以将多个实验一起批量进行？答案是肯定的。</p><p id="9d61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">释放ML计算能力的主要因素是并行化。有趣的是，在云中，无论是24小时租用一台服务器，还是1小时租用24台服务器，您支付的费用都是一样的。换句话说，通过将您的工作负载划分为24个块，并在商用机器上运行它们，您将以同样的价格获得快24倍的结果！所有这些工作都是因为超参数调整——我们已经看到的ML实验的同义词——在构造上是令人尴尬的并行。</p><h1 id="7161" class="lz ma iq bd mb mc mx me mf mg my mi mj jw mz jx ml jz na ka mn kc nb kd mp mq bi translated">入门指南</h1><p id="dbfc" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">让我们把这些想法放在一起，直接进入使用<a class="ae kv" href="https://www.cs.toronto.edu/~delve/data/boston/bostonDetail.html" rel="noopener ugc nofollow" target="_blank">波士顿数据集</a>预测房地产价格的问题。为了简单起见，实验将包括调整一些XGBoost参数，如max_depth ( <a class="ae kv" href="https://xgboost.readthedocs.io/en/latest/parameter.html" rel="noopener ugc nofollow" target="_blank">参见XGBoost文档</a>)，以最大化我们的模型的性能，如MSE所测量的。</p><ol class=""><li id="a368" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated">先决条件</li></ol><ul class=""><li id="2cbe" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nl ni nj nk bi translated"><strong class="ky ir"> Cookiecutter </strong>:用<code class="fe nm nn no np b"> $~ pip install cookiecutter</code>安装Cookiecutter</li><li id="fe5e" class="nc nd iq ky b kz nq lc nr lf ns lj nt ln nu lr nl ni nj nk bi translated"><strong class="ky ir"> AWS区域</strong>:这个可以在<a class="ae kv" href="https://console.aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS控制台</a> <em class="mw">的右上角找到，比如eu-central-1。</em></li><li id="e339" class="nc nd iq ky b kz nq lc nr lf ns lj nt ln nu lr nl ni nj nk bi translated">你必须创建一个账户，并复制在这里找到的wandb密钥<a class="ae kv" href="https://wandb.ai/authorize" rel="noopener ugc nofollow" target="_blank">https://wandb.ai/authorize</a>。</li><li id="29da" class="nc nd iq ky b kz nq lc nr lf ns lj nt ln nu lr nl ni nj nk bi translated"><strong class="ky ir">模板</strong>:最后，用下面的命令下载模板:</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/12dc88c2232627f5f8308b9281db4057.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wfqvoerMX2TypZ6U5Kgt4Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">下载cookiecutter模板。(图片由作者提供)</p></figure><p id="201f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.添加您自己的代码</p><ul class=""><li id="87e7" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nl ni nj nk bi translated"><strong class="ky ir"> src/demo.py </strong>该文件包含参数化实验的代码以及顶部的输入参数。在我们的例子中，它在波士顿数据集上评估XGBoost模型。</li><li id="10cc" class="nc nd iq ky b kz nq lc nr lf ns lj nt ln nu lr nl ni nj nk bi translated"><strong class="ky ir">wandb/sweep . YAML</strong><strong class="ky ir"/>YAML文件定义了将要探索的值的范围。在这次演示中，我们决定对180个不同的超参数组合进行网格搜索。除了网格搜索，还有一些其他策略，比如贝叶斯优化，你可以在这里探索<a class="ae kv" href="https://docs.wandb.ai/guides/sweeps/configuration" rel="noopener ugc nofollow" target="_blank">。</a></li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="906b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">3.执行您的应用</p><pre class="kg kh ki kj gt ny np nz oa aw ob bi"><span id="2583" class="oc ma iq np b gy od oe l of og">$~ cd ml-exp/</span><span id="a626" class="oc ma iq np b gy oh oe l of og">Initialize AWS resources (done only once)<br/>$~ ./cli.py init</span><span id="fa78" class="oc ma iq np b gy oh oe l of og">Build and push the Docker application to AWS<br/>$~ ./cli.py docker</span><span id="7363" class="oc ma iq np b gy oh oe l of og">Pull the trigger<br/>$~ ./cli.py run 20</span></pre><p id="3c76" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此时，您已经在AWS上初始化了必要的资源，并将应用程序构建到Docker容器中，该容器运行在20个不同的服务器上。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/f7349a8ee9f694fa23c5bc43128bf4a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kHLW4IagUgjfMLcLTZZO5w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">ECS仪表板:并行运行的20个实验。(图片由作者提供)</p></figure><p id="da0e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">瞧！结果将开始慢慢进入你的wandb仪表板。你将能够可视化你的结果，推断出正确的结论，并准备下一轮实验。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/58ace2b1f1d86c03efb40163c5a19f4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qm1PoXs8s2F-fmpgCa82uw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示实验结果的Wandb平行图。(图片由作者提供)</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/f0926481aaa58f564acbc10c588610af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SMXfKiZt4dDuxXWBQX84UQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">一眼看去，模型深度越大，正则化程度越高，波士顿数据集的MSE就越小。我们也许应该为下一轮尝试更高的max_depth和reg_lambda值。(图片由作者提供)</p></figure><p id="e93a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在引擎盖下，wandb负责协调实验。它将超参数注入到您的容器群中，这些容器并行运行且相互独立。AWS容器对超参数进行评估后，wandb会检索结果，并将所有内容汇总到一个并行绘图仪表板中。很酷吗？</p><pre class="kg kh ki kj gt ny np nz oa aw ob bi"><span id="da93" class="oc ma iq np b gy od oe l of og">Don't forget to tear down your AWS resources when you're done<br/>$~ ./cli.py clean</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="db8e" class="oc ma iq bd mb ok ol dn mf om on dp mj lf oo op ml lj oq or mn ln os ot mp ou bi translated">结论</h2><p id="bc99" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">总之，我们已经看到了如何创建一个简单的实验，用yaml配置文件对其进行参数化，并快速评估其在AWS容器上的潜力。我们通过大规模并行化使实验更快，通过批量处理多个参数使实验更简单，让像我这样的单任务者非常高兴，从而两全其美。</p><p id="90cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你碰巧需要更多的火力，我会推荐你看看成熟的<a class="ae kv" href="https://github.com/ashleve/lightning-hydra-template" rel="noopener ugc nofollow" target="_blank">闪电-hydra-template </a>回购，它有更多的功能。</p><p id="53fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这里找到我的模板<a class="ae kv" href="https://github.com/Yann21/cookiecutter-exp-launcher" rel="noopener ugc nofollow" target="_blank">的源代码</a>或者回去开始在云中运行你自己的应用程序。</p><p id="6f9a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">非常感谢你的阅读。我期待您的宝贵反馈！</p></div></div>    
</body>
</html>