<html>
<head>
<title>Song Lyrics Over Time: Sentiment and Lexical Diversity Analysis in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">随着时间的推移，歌词的情感和词汇多样性分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/lyrics-analysis-5e1990070a4b#2022-01-31">https://towardsdatascience.com/lyrics-analysis-5e1990070a4b#2022-01-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""><h1 id="9bb8" class="pw-post-title io ip iq bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">随着时间的推移，歌词的情感和词汇多样性分析</h1></div><div class=""><h2 id="8ea7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Quanteda和IBM的音调分析仪对1958年以来公告牌百强歌曲进行分析</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f0fa555ab5029ae677444aafe8d5649c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hg-aNAR9X5TrFuR7oZf6DQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由来自<a class="ae kv" href="https://www.pexels.com/photo/photo-of-person-playing-acoustic-guitar-1751731/" rel="noopener ugc nofollow" target="_blank">佩克斯</a>的<a class="ae kv" href="https://www.pexels.com/@brent-keane-181485" rel="noopener ugc nofollow" target="_blank">布伦特·基恩</a>拍摄</p></figure><p id="2f80" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">毫无疑问，这些年来音乐已经发生了变化。但是如果我们看看美国排名前100的歌曲的歌词，有什么可观察到的趋势吗？</p><p id="f737" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我想到近几十年来的一些歌词时，我当然可以同情婴儿潮一代的观点，即音乐已经变得愚蠢。</p><p id="a876" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">想想《爱你的方式》中的阿姆:</p><blockquote class="ls"><p id="8f9b" class="lt lu iq bd lv lw lx ly lz ma mb lr dk translated">现在你可以看着她离开窗户<br/>我猜这就是为什么他们称之为窗玻璃</p></blockquote><p id="b3a9" class="pw-post-body-paragraph kw kx iq ky b kz mc jr lb lc md ju le lf me lh li lj mf ll lm ln mg lp lq lr ij bi translated">还是坎耶在抬高自己</p><blockquote class="ls"><p id="b677" class="lt lu iq bd lv lw lx ly lz ma mb lr dk translated">噗噗声<br/>噗噗声<br/>噗噗声<br/>等等。</p></blockquote><p id="da14" class="pw-post-body-paragraph kw kx iq ky b kz mc jr lb lc md ju le lf me lh li lj mf ll lm ln mg lp lq lr ij bi translated">暂且把这些不太光彩的当代音乐例子放在一边，歌词真的变得不那么复杂了吗？或者，就此而言，他们身上的主导情绪发生了变化吗？</p><p id="52ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你<strong class="ky ir"> <em class="mh"> CBA阅读</em> </strong>的文章，或者对编码不感兴趣——请随意通过在<a class="ae kv" href="https://datastudio.google.com/reporting/428bdb5c-8375-4566-a013-e8f7a3821256" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="mh">仪表盘</em> </strong> </a>中播放我整理的结果来回答这些问题。如果你想比较几个著名说唱歌手的歌词复杂度或每首歌的平均字数，艺术家过滤器是预设的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mi mj l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">按作者分类的仪表板</p></figure></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="70db" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">获得公告牌百强歌词</h1><p id="8594" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">首先，获得美国公告牌前100首歌曲的歌曲和艺术家名单。Billboard API和RSS feed已经被弃用，但幸运的是，这方面的数据可以追溯到1958年，可以在<a class="ae kv" href="https://www.kaggle.com/dhruvildave/billboard-the-hot-100-songs" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上找到。</p><p id="2805" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用一个<a class="ae kv" href="https://lyricsovh.docs.apiary.io/#reference/0/lyrics-of-a-song/search" rel="noopener ugc nofollow" target="_blank">免费歌词API </a>来获取所有这些歌曲的歌词，因此艺术家姓名和歌曲名称需要被URL编码成适合请求的格式。</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="26c4" class="nt ms iq np b gy nu nv l nw nx"># Get list of top 100 US songs since 1958 and process for lyrics API<br/># Read in Billboard hot 100 songs<br/>billboard &lt;- read.csv("billboard_hot_100.csv")</span><span id="3a47" class="nt ms iq np b gy ny nv l nw nx"># Select needed cols<br/>billboard &lt;- billboard %&gt;% select(date, artist, song)</span><span id="260f" class="nt ms iq np b gy ny nv l nw nx"># Drop all the repeated data<br/>billboard &lt;- billboard %&gt;% distinct(artist, song, .keep_all = TRUE)</span><span id="5e35" class="nt ms iq np b gy ny nv l nw nx"># Process the columns into URL encoding format<br/>billboard$artist_url &lt;- billboard$artist %&gt;%<br/>  str_replace_all(" ", "%20") %&gt;%<br/>  paste0("/")<br/>billboard$song_url &lt;- billboard$song %&gt;%<br/>  str_replace_all(" ", "%20") %&gt;%<br/>  paste0("/")<br/># Merge the two url encoded cols<br/>billboard$url &lt;- paste0(billboard$artist_url, billboard$song_url)</span><span id="3bb4" class="nt ms iq np b gy ny nv l nw nx"># Create column to add lyrics to<br/>billboard$lyrics &lt;- 0</span></pre><p id="9978" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来我们要歌词。出于礼貌，您可能希望在for循环中添加一些结果的中间保存，以及一些<code class="fe nz oa ob np b">Sys.sleep()</code>延迟。对我来说，最初的过程需要大约8个小时(带睡眠)才能运行，所以可以随意使用包含<a class="ae kv" href="https://github.com/louismagowan/lyrics_analysis" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中抓取的数据的lyrics_raw.csv文件。</p><p id="5f05" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">并非所有的歌曲都可以请求歌词(API的数据库中没有歌词，歌曲/标题拼写不一致等。)-但我们仍然获得了足够大的样本用于我们的分析(约16K首歌曲，所有前100首歌曲的45%)。</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="67dd" class="nt ms iq np b gy nu nv l nw nx"># Make requests to lyrics API<br/>base_url &lt;- "<a class="ae kv" href="https://api.lyrics.ovh/v1/" rel="noopener ugc nofollow" target="_blank">https://api.lyrics.ovh/v1/</a>"</span><span id="b58b" class="nt ms iq np b gy ny nv l nw nx"># Add counter to check calls are working with<br/>counter = 0<br/>for (i in 1:length(billboard$url)){</span><span id="f490" class="nt ms iq np b gy ny nv l nw nx"># Get the url string to add to the base<br/>  song_url &lt;- billboard$url[i]<br/>  # Construct the full request URL for that song<br/>  full_url &lt;- paste0(base_url, song_url)<br/>  # Make request<br/>  r &lt;- GET(full_url)<br/>  # Increment counter<br/>  counter &lt;- counter + 1<br/>  # If the request was okay, add lyrics<br/>  if (r$status_code == 200){<br/>    # Remove source line<br/>    lyrics &lt;- content(r)$lyrics %&gt;%<br/>      str_replace("Paroles de la chanson.*\r\n", "")<br/>    # Add song's lyrics<br/>    billboard$lyrics[i] &lt;- lyrics<br/>  }<br/>}<br/># Save to a csv<br/>write.csv(billboard, "lyrics_raw.csv", row.names = FALSE)</span></pre></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="1688" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">情感分析</h1><p id="d85e" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">现在我们有了我们需要的歌词，我们可以使用<a class="ae kv" href="https://www.ibm.com/uk-en/cloud/watson-tone-analyzer" rel="noopener ugc nofollow" target="_blank"> IBM的音调分析器</a>来分析每首歌词中的主要情绪/情感。IBM Cloud给新用户200美元的免费积分，这对于我的样本量来说已经足够了。</p><blockquote class="oc od oe"><p id="7172" class="kw kx mh ky b kz la jr lb lc ld ju le of lg lh li og lk ll lm oh lo lp lq lr ij bi translated">IBM Cloud为新用户提供200美元的免费积分</p></blockquote><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="6145" class="nt ms iq np b gy nu nv l nw nx"># Enter params for the request<br/>ibm_key &lt;- "mind_your_own_beeswax"<br/>ibm_url &lt;- "<a class="ae kv" href="https://api.eu-gb.tone-analyzer.watson.cloud.ibm.com/instances/mind_your_own_beeswax_again/v3/tone" rel="noopener ugc nofollow" target="_blank">y</a>our_ibm_url"<br/>ibm_version = "your_ibm_version"</span><span id="bae9" class="nt ms iq np b gy ny nv l nw nx"># Construct df to append IBM data to<br/>tone_df &lt;- data.frame()<br/># Add counter to check calls are working with<br/>counter = 0</span><span id="5f50" class="nt ms iq np b gy ny nv l nw nx"># Iterate through each song's lyrics, analysing sentiment<br/>for (i in 1:length(billboard$lyrics)){<br/>  # Get lyrics of current song<br/>  current_song &lt;-  billboard$lyrics[i]<br/>  # Add lyrics to params for URL / request<br/>  params = list(version = ibm_version, text = current_song)<br/>  # Increment counter<br/>  counter &lt;- counter + 1</span><span id="e4a3" class="nt ms iq np b gy ny nv l nw nx"># Make the request<br/>  r &lt;- GET(url = ibm_url,<br/>           query = params,<br/>           authenticate('apikey', ibm_key))</span><span id="0d09" class="nt ms iq np b gy ny nv l nw nx"># If the request was okay, add lyrics<br/>  if (r$status_code == 200){<br/>    # Parse the data<br/>    parsed_r &lt;- fromJSON(rawToChar(r$content))<br/>    # Merge tone data with billboard data into new df<br/>    tone_df &lt;- parsed_r$document_tone$tones %&gt;%<br/>      bind_cols(billboard[i, ]) %&gt;%<br/>      bind_rows(tone_df)<br/>  }<br/>}<br/># Save the data in a csv<br/>write.csv(tone_df, "tone_raw.csv", row.names = FALSE)</span></pre><h2 id="9ff7" class="nt ms iq bd mt oi oj dn mx ok ol dp nb lf om on nd lj oo op nf ln oq or nh os bi translated">让我们来看看这些结果</h2><p id="ef49" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">使用一个标准的线性回归，随着时间的推移，歌词似乎变得越来越愤怒，越来越不快乐。(完整的带注释的可视化代码可以在<a class="ae kv" href="https://github.com/louismagowan/lyrics_analysis" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中找到)。</p><blockquote class="oc od oe"><p id="f55b" class="kw kx mh ky b kz la jr lb lc ld ju le of lg lh li og lk ll lm oh lo lp lq lr ij bi translated">随着时间的推移，歌词变得越来越愤怒，越来越不快乐</p></blockquote><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ot mj l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="bcc6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">十年的感悟呢？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/336955f284f7867f8067d16e0c477eb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ub2C5790ajJS0Ir4uzVvGQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="fabf" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">词汇多样性分析</h1><p id="15eb" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">我们已经看了情绪，但是抒情的复杂性呢？我们可以从词汇多样性的角度来分析这一点。我使用了<a class="ae kv" href="https://rdrr.io/cran/koRpus/man/TTR.html" rel="noopener ugc nofollow" target="_blank">类型-标记比率</a>和<a class="ae kv" href="https://rdrr.io/cran/koRpus/man/maas.html" rel="noopener ugc nofollow" target="_blank"> Maas </a>来度量词汇多样性，因为它们计算量不大，而且很常用。</p><blockquote class="oc od oe"><p id="ea0c" class="kw kx mh ky b kz la jr lb lc ld ju le of lg lh li og lk ll lm oh lo lp lq lr ij bi translated">词汇多样性是文本中独特的单词/词干的比例</p></blockquote><p id="1969" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其工作流程如下:</p><ol class=""><li id="8b72" class="ov ow iq ky b kz la lc ld lf ox lj oy ln oz lr pa pb pc pd bi translated">用Quanteda构建一个语料库并进行处理</li><li id="7131" class="ov ow iq ky b kz pe lc pf lf pg lj ph ln pi lr pa pb pc pd bi translated">用<code class="fe nz oa ob np b">quanteda.textstats::textstat_lexdiv()</code>分析词汇多样性</li><li id="1e42" class="ov ow iq ky b kz pe lc pf lf pg lj ph ln pi lr pa pb pc pd bi translated">绘图结果</li></ol><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="55bd" class="nt ms iq np b gy nu nv l nw nx"># Make lyrics into a corpus<br/>lyric_corpus &lt;- corpus(billboard, text_field = "lyrics")</span><span id="cbb4" class="nt ms iq np b gy ny nv l nw nx"># Get number of tokens in each song<br/>docvars(lyric_corpus)$ntoken &lt;- lyric_corpus %&gt;% ntoken()<br/># Filter out the songs with barely any lyrics<br/>lyric_corpus &lt;- corpus_subset(lyric_corpus, ntoken &gt; 50)</span><span id="1a11" class="nt ms iq np b gy ny nv l nw nx"># Tokenize lyrics and calculate lexical diversity<br/>lexdiv &lt;- lyric_corpus %&gt;%<br/>  # Remove numbers and punctuation<br/>  tokens(remove_punct = TRUE,<br/>         remove_numbers = TRUE,<br/>         remove_symbols = TRUE) %&gt;%<br/>  # Make all lowercase<br/>  tokens_tolower() %&gt;% <br/>  # Calculate lexical diversity using quanteda<br/>  textstat_lexdiv(measure = c("TTR", "Maas"))</span><span id="5413" class="nt ms iq np b gy ny nv l nw nx"># Merge lexical diversity measures into docvars<br/>lexdiv &lt;- bind_cols(docvars(lyric_corpus), lexdiv[, 2:3])<br/># Make year into date<br/>lexdiv$year &lt;- lexdiv$year %&gt;% paste0("-01-01") %&gt;% as.Date()</span><span id="4e9f" class="nt ms iq np b gy ny nv l nw nx"># Make into long format for plotting<br/>lexdiv &lt;- lexdiv %&gt;% pivot_longer(c(TTR, Maas),<br/>                                names_to = "lexdiv_measure",<br/>                                values_to = "lexdiv_value"<br/>                                )<br/># Group by year<br/>lexdiv_grouped &lt;- lexdiv %&gt;% group_by(year, lexdiv_measure) %&gt;%<br/>  summarise(lexdiv_value = mean(lexdiv_value, <br/>                       na.rm = TRUE))</span></pre><p id="d141" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这两项指标都显示词汇多样性随着时间的推移而下降。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pj"><img src="../Images/1665b5f419e977cf805e69ef19b2a3fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DQF91ZJGtAYL4qf09ixt7w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="e964" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">我们走吧！r中快速简单的情感/词汇多样性分析</strong></p><p id="0a52" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">在Maas和TTR中，歌曲的词汇多样性已经随着时间的推移而略有下降(尽管这可能部分是由于歌曲中的单词数量增加，请参见</strong><a class="ae kv" href="https://github.com/louismagowan/lyrics_analysis" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir">GitHub repo</strong></a><strong class="ky ir">了解详细信息)。</strong></p><p id="7123" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">情感分析显示，随着时间的推移，歌词变得越来越愤怒，越来越不快乐。</strong></p><p id="6101" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，我们应该警惕从这个分析中得出太多的结论。如果说任何类型的数据会受到更广泛的社会条件和/或潜在变量的影响，那么音乐数据就是。我不认为歌词中日益增长的愤怒是因为我们作为一个社会变得更加愤怒——这可能与歌曲中日益增长的亵渎或说唱的出现有关。至于更少的快乐…你的猜测和我的一样好。</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="3a58" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">链接</h1><ul class=""><li id="3f3c" class="ov ow iq ky b kz nj lc nk lf pk lj pl ln pm lr pn pb pc pd bi translated">LinkedIn : <a class="ae kv" href="https://www.linkedin.com/in/louismagowan/" rel="noopener ugc nofollow" target="_blank">路易斯·马戈万</a></li><li id="315c" class="ov ow iq ky b kz pe lc pf lf pg lj ph ln pi lr pn pb pc pd bi translated">GitHub: <a class="ae kv" href="https://github.com/louismagowan/lyrics_analysis" rel="noopener ugc nofollow" target="_blank">歌词_分析</a></li></ul></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="5090" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">来源</h1><ul class=""><li id="1a77" class="ov ow iq ky b kz nj lc nk lf pk lj pl ln pm lr pn pb pc pd bi translated"><a class="ae kv" href="https://api.lyrics.ovh/v1/" rel="noopener ugc nofollow" target="_blank">歌词API </a></li><li id="66e2" class="ov ow iq ky b kz pe lc pf lf pg lj ph ln pi lr pn pb pc pd bi translated"><a class="ae kv" href="https://www.ibm.com/uk-en/cloud/watson-tone-analyzer" rel="noopener ugc nofollow" target="_blank"> IBM音调分析器</a></li><li id="79a4" class="ov ow iq ky b kz pe lc pf lf pg lj ph ln pi lr pn pb pc pd bi translated"><a class="ae kv" href="https://quanteda.io/index.html" rel="noopener ugc nofollow" target="_blank"> Quanteda </a></li><li id="e67d" class="ov ow iq ky b kz pe lc pf lf pg lj ph ln pi lr pn pb pc pd bi translated"><a class="ae kv" href="https://www.kaggle.com/dhruvildave/billboard-the-hot-100-songs" rel="noopener ugc nofollow" target="_blank">公告牌百强</a></li></ul></div></div>    
</body>
</html>