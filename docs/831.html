<html>
<head>
<title>Creating a dual-axis Combo Chart in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python创建双轴组合图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-a-dual-axis-combo-chart-in-python-52624b187834#2022-01-31">https://towardsdatascience.com/creating-a-dual-axis-combo-chart-in-python-52624b187834#2022-01-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""><h1 id="fdc4" class="pw-post-title ir is it bd iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp bi translated">用Python创建双轴组合图</h1></div><div class=""><h2 id="1b5f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Matplotlib、Seaborn和Pandas plot()创建双轴组合图的实践教程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b97161918c08146ae8efb7797c633854.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vs_RFpJWO97IG9FIs3hITw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@firmbee?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Firmbee.com</a>在<a class="ae ky" href="https://unsplash.com/s/photos/data-visualization?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><blockquote class="kz la lb"><p id="9fc4" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">可视化数据对于分析数据至关重要。如果你看不到你的数据——从多方面看，你将很难分析这些数据。</p><p id="ae4c" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">来源于Python数据[1]</p></blockquote><p id="d1a0" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">python中有许多不同的图形来可视化数据，幸好有Matplotlib、Seaborn、Pandas、Plotly等。在数据分析过程中，你可以做一些非常强大的可视化。其中<strong class="lf iu">组合图</strong>是在同一个图形上组合两种图表类型(如条形图和折线图)。这是Excel最受欢迎的内置图表之一，广泛用于显示不同类型的信息。</p><p id="77fd" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">在同一个图表上绘制多个图表非常容易，但是使用双轴一开始可能会有点混乱。在本文中，我们将探索如何用Matplotlib、Seaborn和Pandas <code class="fe mc md me mf b">plot()</code>创建双轴组合图。这篇文章的结构如下:</p><ol class=""><li id="c269" class="mg mh it lf b lg lh lj lk lz mi ma mj mb mk ly ml mm mn mo bi translated">为什么使用双轴:使用同一轴的问题</li><li id="e23e" class="mg mh it lf b lg mp lj mq lz mr ma ms mb mt ly ml mm mn mo bi translated">Matplotlib</li><li id="b7bc" class="mg mh it lf b lg mp lj mq lz mr ma ms mb mt ly ml mm mn mo bi translated">海生的</li><li id="7adf" class="mg mh it lf b lg mp lj mq lz mr ma ms mb mt ly ml mm mn mo bi translated">熊猫情节()</li></ol><blockquote class="mu"><p id="76fe" class="mv mw it bd mx my mz na nb nc nd ly dk translated">源代码请查看<a class="ae ky" href="https://github.com/BindiChen/machine-learning/blob/master/data-visualization/0006-dual-axis-combo-chart/dual-axis-combo-chart.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>。更多教程可从<a class="ae ky" href="https://github.com/BindiChen/machine-learning" rel="noopener ugc nofollow" target="_blank"> Github Repo </a>获取。</p></blockquote><p id="75c5" class="pw-post-body-paragraph lc ld it lf b lg ne ju li lj nf jx ll lz ng lo lp ma nh ls lt mb ni lw lx ly im bi translated">为了演示，我们将使用来自维基百科的<a class="ae ky" href="https://en.wikipedia.org/wiki/London" rel="noopener ugc nofollow" target="_blank">伦敦气候数据</a>:</p><pre class="kj kk kl km gt nj mf nk nl aw nm bi"><span id="82be" class="nn no it mf b gy np nq l nr ns"><strong class="mf iu">x_label</strong> = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']<br/><strong class="mf iu">average_temp</strong> = [5.2, 5.3,7.6,9.9,13.3,16.5,18.7, 18.5, 15.7, 12.0, 8.0, 5.5]<br/><strong class="mf iu">average_percipitation_mm</strong> = [55.2, 40.9, 41.6, 43.7, 49.4, 45.1, 44.5, 49.5, 49.1, 68.5, 59.0, 55.2]</span><span id="984c" class="nn no it mf b gy nt nq l nr ns">london_climate = pd.DataFrame(<br/>  {<br/>    'average_temp': average_temp,<br/>    'average_percipitation_mm': average_percipitation_mm<br/>  }, <br/>  index=x_label<br/>)</span></pre></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><h1 id="149b" class="ob no it bd oc od oe of og oh oi oj ok jz ol ka om kc on kd oo kf op kg oq or bi translated">1.为什么使用双轴:使用同一轴的问题</h1><p id="a0ca" class="pw-post-body-paragraph lc ld it lf b lg os ju li lj ot jx ll lz ou lo lp ma ov ls lt mb ow lw lx ly im bi translated">在同一个图表上绘制多个图表非常容易。例如，使用Matplotlib，我们可以简单地一个接一个地调用图表函数。</p><pre class="kj kk kl km gt nj mf nk nl aw nm bi"><span id="3625" class="nn no it mf b gy np nq l nr ns"><strong class="mf iu">plt.plot</strong>(x, y1, "-b", label="average temp")<br/><strong class="mf iu">plt.bar</strong>(x, y2, width=0.5, alpha=0.5, color='orange', label="average percipitation mm", )<br/>plt.legend(loc="upper left")<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/b20bcc7e1124de7637637bcaf8793be6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8e51uGkFcTiFYMivLl6ZeA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">单轴组合图(图片由作者提供)</p></figure><p id="206b" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">这当然会创建一个组合图，但是折线图和条形图使用相同的y轴。查看和解释可能非常困难，尤其是当数据在不同的范围内时。</p><p id="34e3" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">我们可以使用双轴有效地解决这个问题。但是一开始使用双轴可能会有点混乱。让我们继续探索如何用Matplotlib、Seaborn和Pandas <code class="fe mc md me mf b">plot()</code>创建双轴组合图。</p><h1 id="4737" class="ob no it bd oc od oy of og oh oz oj ok jz pa ka om kc pb kd oo kf pc kg oq or bi translated">2.Matplotlib</h1><p id="a374" class="pw-post-body-paragraph lc ld it lf b lg os ju li lj ot jx ll lz ou lo lp ma ov ls lt mb ow lw lx ly im bi translated">制作双轴组合图的诀窍是使用共享同一x轴的两个不同的轴。这可以通过<strong class="lf iu"> <em class="le"> Matplotlib </em> </strong>中的<code class="fe mc md me mf b">twinx()</code>方法实现。这会生成共享同一x轴的两个独立的y轴:</p><pre class="kj kk kl km gt nj mf nk nl aw nm bi"><span id="d282" class="nn no it mf b gy np nq l nr ns"># Create figure and axis #1<br/>fig, ax1 = plt.subplots()</span><span id="4c8b" class="nn no it mf b gy nt nq l nr ns"># plot line chart on axis #1<br/>ax1.plot(x, average_temp) <br/>ax1.set_ylabel('average temp')<br/>ax1.set_ylim(0, 25)<br/>ax1.legend(['average_temp'], loc="upper left")</span><span id="75b5" class="nn no it mf b gy nt nq l nr ns"># set up the 2nd axis<br/><strong class="mf iu">ax2 = ax1.twinx()</strong></span><span id="cf12" class="nn no it mf b gy nt nq l nr ns"># plot bar chart on axis #2<br/>ax2.bar(x, average_percipitation_mm, width=0.5, alpha=0.5, color='orange')<br/><strong class="mf iu">ax2.grid(False)</strong> # turn off grid #2<br/>ax2.set_ylabel('average percipitation mm')<br/>ax2.set_ylim(0, 90)<br/>ax2.legend(['average_percipitation_mm'], loc="upper right")</span><span id="0e58" class="nn no it mf b gy nt nq l nr ns">plt.show()</span></pre><p id="d77b" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">我们通常会在<code class="fe mc md me mf b">ax1</code>上绘制折线图。诀窍是调用<code class="fe mc md me mf b">ax2 = ax1.twinx()</code>来设置第二个轴，并在其上绘制条形图。注意，<code class="fe mc md me mf b">ax2.grid(False)</code>被调用来隐藏第二轴上的网格，以避免网格显示问题。因为两个图表使用相同的x值，所以它们共享相同的x轴。通过执行代码，您应该得到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/90aa94ae7f2c65781e58b2ba7d48f317.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XVr8N1JeBHzata49Sc2IEw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用Matplotlib的双轴组合图(图片由作者提供)</p></figure><h1 id="b04e" class="ob no it bd oc od oy of og oh oz oj ok jz pa ka om kc pb kd oo kf pc kg oq or bi translated">3.海生的</h1><p id="69ea" class="pw-post-body-paragraph lc ld it lf b lg os ju li lj ot jx ll lz ou lo lp ma ov ls lt mb ow lw lx ly im bi translated">Seaborn是一个构建在<strong class="lf iu"> <em class="le"> Matplotlib </em> </strong>之上的高级数据可视化库。在幕后，它使用<strong class="lf iu"> <em class="le"> Matplotlib </em> </strong>来绘制它的情节。对于底层配置和设置，我们总是可以调用<strong class="lf iu"> <em class="le"> Matplotlib </em> </strong>的API，这就是在<strong class="lf iu"> <em class="le"> Seaborn </em> </strong>中制作双轴组合图的窍门:</p><pre class="kj kk kl km gt nj mf nk nl aw nm bi"><span id="3ea5" class="nn no it mf b gy np nq l nr ns"># plot line graph on axis #1<br/>ax1 = sns.lineplot(<br/>    x=london_climate.index, <br/>    y='average_temp', <br/>    data=london_climate_df, <br/>    sort=False, <br/>    color='blue'<br/>)<br/>ax1.set_ylabel('average temp')<br/>ax1.set_ylim(0, 25)<br/>ax1.legend(['average_temp'], loc="upper left")</span><span id="f06a" class="nn no it mf b gy nt nq l nr ns"># set up the 2nd axis<br/><strong class="mf iu">ax2 = ax1.twinx()</strong></span><span id="8cff" class="nn no it mf b gy nt nq l nr ns"># plot bar graph on axis #2<br/>sns.barplot(<br/>    x=london_climate.index, <br/>    y='average_percipitation_mm', <br/>    data=london_climate_df, <br/>    color='orange', <br/>    alpha=0.5, <br/>    <strong class="mf iu">ax = ax2</strong>       # Pre-existing axes for the plot<br/>)<br/>ax2.grid(b=False) # turn off grid #2<br/>ax2.set_ylabel('average percipitation mm')<br/>ax2.set_ylim(0, 90)<br/>ax2.legend(['average_percipitation_mm'], loc="upper right")</span><span id="2fcf" class="nn no it mf b gy nt nq l nr ns">plt.show()</span></pre><p id="701f" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><code class="fe mc md me mf b">sns.lineplot()</code>返回一个Matplotlib轴对象<code class="fe mc md me mf b">ax1</code>。然后，类似于Matplotlib解决方案，我们也调用<code class="fe mc md me mf b">ax2 = ax1.twinx()</code>来设置第二个轴。之后，使用参数<code class="fe mc md me mf b">ax = ax2</code>调用<code class="fe mc md me mf b">sns.barplot()</code>在现有轴<code class="fe mc md me mf b">ax2</code>上绘图。通过执行代码，您应该得到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/016305533ea3bbac637f6e11758b15fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0g3GxexvGcqrIDX2vt9uVA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用Seaborn的双轴组合图(图片由作者提供)</p></figure><p id="4840" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">您可能会注意到图例显示不正确，条形图为黑色。我们可以做的一个修复是使用<code class="fe mc md me mf b">mpatches.Patch()</code>创建一个自定义图例:</p><pre class="kj kk kl km gt nj mf nk nl aw nm bi"><span id="88a2" class="nn no it mf b gy np nq l nr ns">import matplotlib.patches as mpatches</span><span id="aa9d" class="nn no it mf b gy nt nq l nr ns"># plot line graph on axis #1<br/>ax1 = sns.lineplot(<br/>    x=london_climate.index, <br/>    y='average_temp', <br/>    data=london_climate_df, <br/>    sort=False, <br/>    color='blue'<br/>)<br/>ax1.set_ylabel('average temp')<br/>ax1.set_ylim(0, 25)<br/><strong class="mf iu">ax1_patch = mpatches.Patch(color='blue', label='average temp')<br/>ax1.legend(handles=[ax1_patch], loc="upper left")</strong></span><span id="a9a8" class="nn no it mf b gy nt nq l nr ns"># set up the 2nd axis<br/>ax2 = ax1.twinx()</span><span id="196e" class="nn no it mf b gy nt nq l nr ns"># plot bar chart on axis #2<br/>sns.barplot(<br/>    x=london_climate.index, <br/>    y='average_percipitation_mm', <br/>    data=london_climate_df, <br/>    color='orange', <br/>    alpha=0.5, <br/>    ax = ax2       # Pre-existing axes for the plot<br/>)<br/>ax2.grid(False) # turn off grid #2<br/>ax2.set_ylabel('average percipitation mm')<br/>ax2.set_ylim(0, 90)<br/><strong class="mf iu">ax2_patch = mpatches.Patch(color='orange', label='average percipitation mm')<br/>ax2.legend(handles=[ax2_patch], loc="upper right")</strong></span><span id="5e1d" class="nn no it mf b gy nt nq l nr ns">plt.show()</span></pre><p id="499f" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><code class="fe mc md me mf b">mpatches.Patch()</code>创建一个Matplotlib 2D艺术家对象，我们将它传递给轴的图例。通过执行代码，您将获得以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/9090fc3b8d01f9cc6556d7b60a772b4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sPpb8CjqKbPPDtQrS2-okw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用Seaborn的双轴组合图(图片由作者提供)</p></figure><h1 id="ed5c" class="ob no it bd oc od oy of og oh oz oj ok jz pa ka om kc pb kd oo kf pc kg oq or bi translated">4.熊猫情节</h1><p id="308e" class="pw-post-body-paragraph lc ld it lf b lg os ju li lj ot jx ll lz ou lo lp ma ov ls lt mb ow lw lx ly im bi translated">熊猫用<code class="fe mc md me mf b">plot()</code>的方法制作图表。在引擎盖下，它默认调用Matplotlib的API来创建图表(注意:后端默认为Matplotlib)。诀窍是将参数<code class="fe mc md me mf b">secondary_y</code>设置为<code class="fe mc md me mf b">True</code>以允许在辅助y轴上绘制第二个图表。</p><pre class="kj kk kl km gt nj mf nk nl aw nm bi"><span id="ba3d" class="nn no it mf b gy np nq l nr ns"># Create the figure and axes object<br/>fig, ax = plt.subplots()</span><span id="15f5" class="nn no it mf b gy nt nq l nr ns"># Plot the first x and y axes:<br/>london_climate.plot(<br/>    use_index=True, <br/>    kind='bar',<br/>    y='average_percipitation_mm', <br/>    ax=ax, <br/>    color='orange'<br/>)</span><span id="f17a" class="nn no it mf b gy nt nq l nr ns"># Plot the second x and y axes. <br/># By secondary_y = True a second y-axis is requested<br/>london_climate.plot(<br/>    use_index=True, <br/>    y='average_temp', <br/>    ax=ax, <br/>    <strong class="mf iu">secondary_y=True, </strong><br/>    color='blue'<br/>)</span><span id="f520" class="nn no it mf b gy nt nq l nr ns">plt.show()</span></pre><p id="883b" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">注意，我们还设置了<code class="fe mc md me mf b">use_index=True</code>来使用索引作为x轴的刻度。通过执行代码，您应该得到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/037ab3f92c78106496e41cf70513129b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mhmrseVrgO_Et_WkwKMTEA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用熊猫图()的双轴组合图(图片由作者提供)</p></figure><h1 id="0aaa" class="ob no it bd oc od oy of og oh oz oj ok jz pa ka om kc pb kd oo kf pc kg oq or bi translated">结论</h1><p id="76bb" class="pw-post-body-paragraph lc ld it lf b lg os ju li lj ot jx ll lz ou lo lp ma ov ls lt mb ow lw lx ly im bi translated">在本文中，我们学习了如何用<strong class="lf iu"><em class="le">【Matplotlib】</em></strong><strong class="lf iu"><em class="le">Seaborn</em></strong><strong class="lf iu"><em class="le">Pandas</em></strong><code class="fe mc md me mf b">plot()</code>创建双轴组合图。组合图是数据可视化中最流行的图表之一，知道如何创建双轴组合图对分析数据非常有帮助。</p><p id="f413" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">感谢阅读。请查看<a class="ae ky" href="https://github.com/BindiChen/machine-learning/blob/master/data-visualization/0006-dual-axis-combo-chart/dual-axis-combo-chart.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>获取源代码，如果您对机器学习的实用方面感兴趣，请继续关注。更多教程可从<a class="ae ky" href="https://github.com/BindiChen/machine-learning" rel="noopener ugc nofollow" target="_blank"> Github Repo </a>获得。</p><h1 id="542a" class="ob no it bd oc od oy of og oh oz oj ok jz pa ka om kc pb kd oo kf pc kg oq or bi translated">参考</h1><ul class=""><li id="8d8e" class="mg mh it lf b lg os lj ot lz ph ma pi mb pj ly pk mm mn mo bi translated">[1] Python数据— <a class="ae ky" href="https://pythondata.com/visualizing-data-overlaying-charts/" rel="noopener ugc nofollow" target="_blank">可视化数据—用Python叠加图表</a></li></ul></div></div>    
</body>
</html>