<html>
<head>
<title>Advanced Code Documentation with Sphinx — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Sphinx高级代码文档—第2部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/advanced-code-documentation-with-sphinx-part-2-32c82860a535#2022-01-24">https://towardsdatascience.com/advanced-code-documentation-with-sphinx-part-2-32c82860a535#2022-01-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""><h1 id="561b" class="pw-post-title ir is it bd iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp bi translated">Sphinx高级代码文档—第2部分</h1></div><div class=""><h2 id="db6c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Sphinx的扩展提供了一个用户友好的界面来理解代码库——即使对于非技术用户也是如此</h2></div><p id="57bc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> <em class="le">更新</em> </strong> <em class="le">:本文是系列文章的一部分。查看</em> <a class="ae lf" rel="noopener" target="_blank" href="/advanced-code-documentation-beyond-comments-and-docstrings-2cc5b2ace28a"> <em class="le">第1部分</em> </a> <em class="le">，</em> <a class="ae lf" rel="noopener" target="_blank" href="/advanced-code-documentation-with-coverage-and-unit-tests-part-3-3f7b698497fb"> <em class="le">第3部分</em> </a> <em class="le">！</em></p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/de8395abb0e3d62a5312af858337edd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xgu5Vu--YHZwmeGV"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">格伦·卡斯滕斯-彼得斯在<a class="ae lf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2d1a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上周，我在Read Docs上发表了一篇关于<a class="ae lf" rel="noopener" target="_blank" href="/advanced-code-documentation-beyond-comments-and-docstrings-2cc5b2ace28a">如何设置、定制和部署Sphinx文档的文章，这应该足以让你的第一稿启动并运行。但实际上，您的代码库可能是一个复杂的函数和类结构，或者您可能希望向观众展示如何使用Jupyter笔记本与您的代码库进行交互的示例。这篇文章将涉及到增强你的(不那么)初始文档的方法。</a></p><div class="lw lx gp gr ly lz"><a rel="noopener follow" target="_blank" href="/advanced-code-documentation-beyond-comments-and-docstrings-2cc5b2ace28a"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd iu gy z fp me fr fs mf fu fw is bi translated">注释和文档字符串之外的高级代码文档</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">使用Sphinx并阅读文档以获得用户友好的界面来理解代码库——即使对于非技术用户也是如此</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn lq lz"/></div></div></a></div><h1 id="c2d6" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">目录</h1><ul class=""><li id="75e1" class="ng nh it kk b kl ni ko nj kr nk kv nl kz nm ld nn no np nq bi translated"><a class="ae lf" href="https://medium.com/p/32c82860a535/#0bb3" rel="noopener">函数和类的更多格式</a></li><li id="6364" class="ng nh it kk b kl nr ko ns kr nt kv nu kz nv ld nn no np nq bi translated"><a class="ae lf" href="https://medium.com/p/32c82860a535/#601b" rel="noopener">使用扩展查看Jupyter笔记本和减价文本</a></li><li id="a629" class="ng nh it kk b kl nr ko ns kr nt kv nu kz nv ld nn no np nq bi translated"><a class="ae lf" href="https://medium.com/p/32c82860a535/#041f" rel="noopener">添加徽章以展示代码质量</a></li><li id="2812" class="ng nh it kk b kl nr ko ns kr nt kv nu kz nv ld nn no np nq bi translated"><a class="ae lf" href="https://medium.com/p/32c82860a535/#dd64" rel="noopener">托管关于融合的文档</a></li></ul></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><h1 id="0bb3" class="mo mp it bd mq mr od mt mu mv oe mx my jz of ka na kc og kd nc kf oh kg ne nf bi translated">函数和类的更多格式</h1><p id="d73b" class="pw-post-body-paragraph ki kj it kk b kl ni ju kn ko nj jx kq kr oi kt ku kv oj kx ky kz ok lb lc ld im bi translated">Python类允许对函数和数据进行分组，并提供面向对象编程(OOP)的特性，这是一种构建灵活、可重复代码的方式。类中的函数被称为类方法。</p><p id="a388" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在第一篇文章中，我们使用<code class="fe ol om on oo b">automodule</code>将文档字符串转换成函数的文档。当使用类时，我们可以使用<code class="fe ol om on oo b">autoclass</code>执行同样的操作。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi op"><img src="../Images/c7f15b57e85e17c4d4034306a70c16f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bYk8lcFHTKmg8XHuj4RAPA.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">使用自动模块(左)和自动类(右)的文档–作者图片</p></figure><blockquote class="oq or os"><p id="93d1" class="ki kj le kk b kl km ju kn ko kp jx kq ot ks kt ku ou kw kx ky ov la lb lc ld im bi translated">Sphinx很灵活，有其他方法可以达到相同的效果，甚至可以更改显示以包含或排除项目。修改Sphinx布局是通过使用扩展实现的，这可能需要安装额外的Python包，修改<code class="fe ol om on oo b">conf.py</code>文件，或者更改<code class="fe ol om on oo b">.rst</code>文件。</p></blockquote><p id="94f1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在后面的章节中，扩展的使用也是相关的。完整的扩展列表的一部分可以在<a class="ae lf" href="https://www.sphinx-doc.org/en/master/usage/extensions/index.html" rel="noopener ugc nofollow" target="_blank"> Sphinx文档中找到。</a></p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ow"><img src="../Images/5b3fa81f39154ba15aa7299b2128e2b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xeNnMQrf48qqzZuwdnGiog.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">使用<em class="ox"> autodocsumm的文档–作者图片</em></p></figure><p id="2428" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要以表格格式显示所有类方法的列表，安装Python包<code class="fe ol om on oo b">autodocsumm</code>并将其包含在<code class="fe ol om on oo b">conf.py</code>中，如下所示:</p><pre class="lh li lj lk gt oy oo oz pa aw pb bi"><span id="2bcf" class="pc mp it oo b gy pd pe l pf pg">extensions = ["autodocsumm"]<br/>autodoc_default_options = {"autosummary": True}</span></pre><p id="a5d7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我发现<code class="fe ol om on oo b">autodocsumm</code>扩展非常有用，因为我可以用表格的形式查看所有的类方法。还有其他流行的扩展如<code class="fe ol om on oo b">autodoc</code>和<code class="fe ol om on oo b">autosummary</code>。个人觉得<code class="fe ol om on oo b">autodocsumm</code>是两者的结合，比较好用。</p><h1 id="601b" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">使用扩展查看Jupyter笔记本和减价文本</h1><p id="4394" class="pw-post-body-paragraph ki kj it kk b kl ni ju kn ko nj jx kq kr oi kt ku kv oj kx ky kz ok lb lc ld im bi translated">Jupyter笔记本是自包含的文档，可以向用户展示如何与你的代码库交互，展示一个示例案例研究，或者它只是一种漂亮的、有组织的方式来显示代码。本着持续集成持续交付(CI/CD)的精神，最好让Sphinx文档显示Jupyter笔记本，而不是通过文本、代码和图像在<code class="fe ol om on oo b">.rst</code>文件中复制笔记本。</p><p id="8908" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要展示Jupyter笔记本，安装Python包<code class="fe ol om on oo b">nbsphinx</code>并将其添加到<code class="fe ol om on oo b">conf.py</code>文件的扩展列表中，类似于上一节。您还需要运行<code class="fe ol om on oo b">conda install pandoc</code>。这就完成了安装，Jupyter笔记本路径可以添加到<code class="fe ol om on oo b">index.rst</code>中，就像<code class="fe ol om on oo b">index.rst</code>指向其他<code class="fe ol om on oo b">.rst</code>文件一样。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ow"><img src="../Images/b2e44fdf53d2b5f8ec461eaab41db31f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W1X1hncv7q6-PGVVHzhVtw.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">狮身人面像上展示的朱庇特笔记本——作者图片</p></figure></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><p id="2962" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">降价文本是常用于<code class="fe ol om on oo b">README</code>的文本文件。为了展示Markdown文件，所需的Python包应该是<code class="fe ol om on oo b">myst_parser</code>，类似地，将其添加到<code class="fe ol om on oo b">conf.py</code>中的扩展列表。现在，您可以通过以下方式指向<code class="fe ol om on oo b">index.rst</code>中的降价文本，</p><pre class="lh li lj lk gt oy oo oz pa aw pb bi"><span id="0fc4" class="pc mp it oo b gy pd pe l pf pg">.. include:: ../../README.md<br/>   :parser: myst_parser.sphinx_</span></pre><p id="3d43" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">还有其他扩展如<code class="fe ol om on oo b">m2r</code>、<code class="fe ol om on oo b">m2r2</code>或<code class="fe ol om on oo b">recommonmark</code>也可以显示降价文本，但是<code class="fe ol om on oo b">myst_parser</code>是<a class="ae lf" href="https://www.sphinx-doc.org/en/master/usage/markdown.html" rel="noopener ugc nofollow" target="_blank"> Sphinx文档</a>中推荐的处理降价文本的方式。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ph"><img src="../Images/363f8d8bf9ac347e6e8dbad9bfa3e4a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J2VYVXeCX-urdzrbywc53w.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">在Sphinx上整合README Markdown–作者图片</p></figure><p id="94b4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您还可以在Sphinx上包含其他格式的文件，请访问我的<a class="ae lf" href="https://github.com/kayjan/sphinx-advanced" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>以保持更新！</p><h1 id="041f" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">添加徽章以展示代码质量</h1><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/d586f1da80ed2a100fda60bdfc05ecff.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*Pj9ve1SZ70D6lw_EegyMYw.png"/></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">狮身人面像上的徽章——作者图片</p></figure><p id="a7d3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">徽章显示文档的状态——构建状态、单元测试结果、维护质量、python包版本、发布版本、python版本兼容性、许可证、下载次数等。</p><p id="4268" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">徽章通常由图像URL、路径URL和替代文本组成。它在<code class="fe ol om on oo b">.rst</code>文件中有这样的格式</p><pre class="lh li lj lk gt oy oo oz pa aw pb bi"><span id="9a5f" class="pc mp it oo b gy pd pe l pf pg">.. image:: image-URL<br/>   :target: path-URL<br/>   :alt: Alt-Text</span></pre><p id="8c22" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是<code class="fe ol om on oo b">.md</code>文件中徽章的格式</p><pre class="lh li lj lk gt oy oo oz pa aw pb bi"><span id="c36b" class="pc mp it oo b gy pd pe l pf pg">[![<!-- -->Alt-Text<!-- -->](<!-- -->image-URL<!-- -->)](<!-- -->path-URL<!-- -->)</span></pre><p id="1d5a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">徽章可以是静态的也可以是动态的。对于静态徽章，我推荐使用<a class="ae lf" href="https://img.shields.io" rel="noopener ugc nofollow" target="_blank"> shields.io </a>或<a class="ae lf" href="https://badgen.net" rel="noopener ugc nofollow" target="_blank">badgen.net</a>来生成图片URL。动态徽章会被刷新，并且通常会由持续集成持续交付(CI/CD)流程自动刷新。动态徽章的一些示例包括<a class="ae lf" href="https://readthedocs.org/" rel="noopener ugc nofollow" target="_blank">阅读文档</a>、<a class="ae lf" href="https://circleci.com/" rel="noopener ugc nofollow" target="_blank">圈子CI </a>或<a class="ae lf" href="https://www.travis-ci.com/" rel="noopener ugc nofollow" target="_blank"> Travis CI </a>徽章等等。</p><h1 id="dd64" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">托管关于Confluence的文档</h1><p id="df8c" class="pw-post-body-paragraph ki kj it kk b kl ni ju kn ko nj jx kq kr oi kt ku kv oj kx ky kz ok lb lc ld im bi translated"><a class="ae lf" href="https://www.atlassian.com/software/confluence" rel="noopener ugc nofollow" target="_blank"> Confluence </a>是一个团队知识共享工作区，团队成员可以在这里协作处理工作和文档信息。将Sphinx与Confluence集成在一起，可以将项目文档和代码文档保存在一个一站式门户中。</p><p id="b485" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要进行设置，这需要Python包<code class="fe ol om on oo b">sphinxcontrib-confluencebuilder</code>，同样将其添加到<code class="fe ol om on oo b">conf.py</code>中的扩展列表。在Confluence中，从<code class="fe ol om on oo b">Space Settings &gt; Manage space &gt; Space details</code>获取空格键，并在这里创建一个API令牌<a class="ae lf" href="https://id.atlassian.com/manage-profile/security/api-tokens" rel="noopener ugc nofollow" target="_blank">。现在您已经有了在Confluence上发布Sphinx文档的所有细节！</a></p><p id="5092" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要执行链接Sphinx和Confluence的最后一步，在<code class="fe ol om on oo b">conf.py</code>中添加以下信息，最后运行<code class="fe ol om on oo b">make confluence</code>来构建您的Confluence文档。</p><pre class="lh li lj lk gt oy oo oz pa aw pb bi"><span id="7463" class="pc mp it oo b gy pd pe l pf pg">confluence_publish = True<br/>confluence_space_key = CONFLUENCE_SPACE_KEY<br/>confluence_server_url = 'https://&lt;your-page&gt;.atlassian.net/wiki/'<br/>confluence_server_user = '&lt;your-email&gt;@gmail.com&gt;<br/>confluence_server_pass = CONFLUENCE_API_KEY</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi pj"><img src="../Images/704cf3f1d2f9b960707c13cf07646c15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9ooYvXT2q4O09j3mIylaGQ.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">Confluence页面上的Sphinx文档–图片由作者提供</p></figure></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><p id="73fb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">希望你已经学会了一些先进实用的使用斯芬克斯的方法。Sphinx绝对是一个让代码库脱颖而出的工具，为用户提供可读性和可理解性。</p><div class="lw lx gp gr ly lz"><a rel="noopener follow" target="_blank" href="/advanced-code-documentation-with-coverage-and-unit-tests-part-3-3f7b698497fb"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd iu gy z fp me fr fs mf fu fw is bi translated">包含覆盖率和单元测试的高级代码文档—第3部分</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">评估文档的完整性并对文档字符串执行单元测试——使用和不使用Sphinx</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="pk l mk ml mm mi mn lq lz"/></div></div></a></div><p id="4853" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些是演示中使用的<a class="ae lf" href="https://github.com/kayjan/sphinx-advanced" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>、<a class="ae lf" href="https://kayjan-sphinx-advanced.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">阅读文档文档</a>和<a class="ae lf" href="https://kayjan.atlassian.net/wiki/spaces/SPHINXADVA/overview" rel="noopener ugc nofollow" target="_blank">汇合页面</a>的链接。</p><p id="0b17" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">感谢您的阅读！如果你喜欢这篇文章，请随意分享。</strong></p></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><h1 id="5a88" class="mo mp it bd mq mr od mt mu mv oe mx my jz of ka na kc og kd nc kf oh kg ne nf bi translated">相关链接</h1><p id="9b14" class="pw-post-body-paragraph ki kj it kk b kl ni ju kn ko nj jx kq kr oi kt ku kv oj kx ky kz ok lb lc ld im bi translated">阅读我个人项目的文档:<a class="ae lf" href="https://kayjan.readthedocs.io/" rel="noopener ugc nofollow" target="_blank">https://kayjan.readthedocs.io/</a></p><p id="646c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">狮身人面像文献:<a class="ae lf" href="https://www.sphinx-doc.org/en/master/" rel="noopener ugc nofollow" target="_blank">https://www.sphinx-doc.org/en/master/</a></p><p id="26f7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">带有Confluence的Sphinx文档:<a class="ae lf" href="https://sphinxcontrib-confluencebuilder.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">https://sphinxcontrib-Confluence builder . readthedocs . io/en/stable/</a></p></div></div>    
</body>
</html>