<html>
<head>
<title>Machine Learning Model Deployment on Heroku Using Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Flask在Heroku上部署机器学习模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/machine-learning-model-deployment-on-heroku-using-flask-467acb4a34da#2022-01-19">https://towardsdatascience.com/machine-learning-model-deployment-on-heroku-using-flask-467acb4a34da#2022-01-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""><h1 id="5985" class="pw-post-title io ip iq bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">使用Flask在Heroku上部署机器学习模型</h1></div><div class=""><h2 id="437b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">机器学习平台即服务</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/41e0b19927a9f88cd1f9a7ecfb515781.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*fbK2SneazjpzFoEZbIycxw.jpeg"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">凯文·Ku在Unsplash上的照片</p></figure><p id="0a8c" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">几周前，我写了一篇关于使用Spark部署机器学习模型的帖子，如果你想批量而非实时地进行预测，这是一种部署ML模型的好方法。</p><div class="lo lp gp gr lq lr"><a rel="noopener follow" target="_blank" href="/machine-learning-model-deployment-using-spark-585e80b2eae1"><div class="ls ab fo"><div class="lt ab lu cl cj lv"><h2 class="bd ir gy z fp lw fr fs lx fu fw ip bi translated">使用Spark的机器学习模型部署</h2><div class="ly l"><h3 class="bd b gy z fp lw fr fs lx fu fw dk translated">Spark使ML部署更容易</h3></div><div class="lz l"><p class="bd b dl z fp lw fr fs lx fu fw dk translated">towardsdatascience.com</p></div></div><div class="ma l"><div class="mb l mc md me ma mf kl lr"/></div></div></a></div><p id="da6b" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">但是如果你想要实时预测，那么这个解决方案并不理想，因为…</p><ol class=""><li id="861a" class="mg mh iq ku b kv kw ky kz lb mi lf mj lj mk ln ml mm mn mo bi translated">做出预测需要几秒钟，而且不是实时的。</li><li id="a393" class="mg mh iq ku b kv mp ky mq lb mr lf ms lj mt ln ml mm mn mo bi translated">手动部署会有一些停机时间。</li><li id="e47f" class="mg mh iq ku b kv mp ky mq lb mr lf ms lj mt ln ml mm mn mo bi translated">没有UI来测试解决方案。</li></ol><p id="8d22" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">将机器学习模型部署为服务可以解决大多数问题，预测将是实时的。但是会有一些问题，比如可伸缩性、监控和服务中断。尽管有许多云提供商来解决这些问题并提供24*7支持。尽管如此，如果你是一家小公司或者刚刚开始从事AI/ML，并且不想花更多时间来处理云部署或DevOps任务，并且想要一个快速部署选项，那么使用Flask在Heroku上部署你的机器学习模型将解决你的所有问题。</p><h1 id="a194" class="mu mv iq bd mw mx my mz na nb nc nd ne jw nf jx ng jz nh ka ni kc nj kd nk nl bi translated">Heroku使用烧瓶</h1><p id="8a15" class="pw-post-body-paragraph ks kt iq ku b kv nm jr kx ky nn ju la lb no ld le lf np lh li lj nq ll lm ln ij bi translated">Heroku是Salesforce的平台即服务工具。Heroku由AWS支持，所有Heroku应用程序/服务都托管在AWS上。AWS提供基础设施并处理所有负载平衡、资源利用、联网、日志记录、监控，Heroku充当中间人，提供具有所有云功能的可扩展、自动化的快速部署平台。使用Flask将提供UI来测试，并且它可以与企业级应用程序集成。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/3a0eeddb27f68db028e688f81cea859f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*DU72-AeG_s55k-SFs2Cmng.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure></div><div class="ab cl ns nt hu nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="ij ik il im in"><h2 id="240b" class="nz mv iq bd mw oa ob dn na oc od dp ne lb oe of ng lf og oh ni lj oi oj nk ok bi translated">使用Flask在Heroku上部署的步骤</h2><p id="56a4" class="pw-post-body-paragraph ks kt iq ku b kv nm jr kx ky nn ju la lb no ld le lf np lh li lj nq ll lm ln ij bi translated">使用Flask在Heroku上部署从创建机器学习模型到部署有7个步骤。这些步骤对于所有机器学习模型都是一样的，你可以使用这些步骤在Heroku上部署任何ML模型。</p><ol class=""><li id="7afe" class="mg mh iq ku b kv kw ky kz lb mi lf mj lj mk ln ml mm mn mo bi translated">创建ML模型并保存(pickle)它</li><li id="4ada" class="mg mh iq ku b kv mp ky mq lb mr lf ms lj mt ln ml mm mn mo bi translated">为UI和python主文件(app.py)创建Flask文件，这些文件可以从步骤1中取消选取机器学习模型并进行预测</li><li id="44c1" class="mg mh iq ku b kv mp ky mq lb mr lf ms lj mt ln ml mm mn mo bi translated">创建requirements.txt来设置Flask web app和所有python依赖项</li><li id="90d0" class="mg mh iq ku b kv mp ky mq lb mr lf ms lj mt ln ml mm mn mo bi translated">创建Procfile以启动Flask app命令</li><li id="5339" class="mg mh iq ku b kv mp ky mq lb mr lf ms lj mt ln ml mm mn mo bi translated">在Github repo中提交步骤1、2、3和4中的文件</li><li id="2873" class="mg mh iq ku b kv mp ky mq lb mr lf ms lj mt ln ml mm mn mo bi translated">在Heroku上创建账户/登录，创建一个app，连接Github repo，选择branch</li><li id="8d8e" class="mg mh iq ku b kv mp ky mq lb mr lf ms lj mt ln ml mm mn mo bi translated">在Heroku上选择手动部署(或启用自动部署)</li></ol><p id="1809" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><strong class="ku ir">大功告成！！</strong></p><p id="4991" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">您可以在Heroku仪表板中检查日志或使用Heroku CLI。在日志的结尾，它会给出访问UI上部署的应用程序的URL。该网址将有语法像-【https://app-name.herokuapp.com/】<strong class="ku ir"/></p><h1 id="5b77" class="mu mv iq bd mw mx my mz na nb nc nd ne jw nf jx ng jz nh ka ni kc nj kd nk nl bi translated">深潜</h1><p id="2806" class="pw-post-body-paragraph ks kt iq ku b kv nm jr kx ky nn ju la lb no ld le lf np lh li lj nq ll lm ln ij bi translated">现在让我们来看看上面7个步骤的实际代码实现(用python)。</p><p id="e10c" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在<strong class="ku ir">步骤1 </strong>中，我们创建一个ML模型并将其保存在pickle文件中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="f854" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这里第3行中的gbc是为收入预测而训练的梯度提升分类器模型。如果你想知道我是如何创建这个梯度推进预测模型的，请参考GitHub <a class="ae kr" href="https://github.com/charumakhijani/heroku-ml-deployment/blob/main/IncomePrediction.ipynb" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><p id="a86e" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在第二步<strong class="ku ir">中，</strong>我们将创建flask文件——index.html和app.py</p><p id="3993" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><strong class="ku ir">index.html，</strong>是一个烧瓶UI <a class="ae kr" href="https://github.com/charumakhijani/heroku-ml-deployment/blob/main/templates/index.html" rel="noopener ugc nofollow" target="_blank">文件</a>，用于向模型提供输入(或特征)。</p><p id="d3c0" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><strong class="ku ir"> app.py </strong>，是一个python主文件，它从步骤1中解开梯度增强模型，呈现flask UI页面index.html，并基于来自UI的输入进行预测。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="32c2" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在<strong class="ku ir">步骤3 </strong>中，我们将创建requirements.txt来添加flask应用程序的所有依赖项。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="2b26" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在<strong class="ku ir">步骤4 </strong>中，我们将创建Procfile来指定Heroku app在启动时执行的命令。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="c3b1" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在<strong class="ku ir">步骤5 </strong>中，我们将把步骤1–4中的所有文件添加到Github repo中。收益预测的Github回购<a class="ae kr" href="https://github.com/charumakhijani/heroku-ml-deployment" rel="noopener ugc nofollow" target="_blank">可以在这里</a>找到。</p><p id="b621" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在<strong class="ku ir">步骤6 </strong>中，我们将登录Heroku并创建一个新的app，这里是-收入-预测-api-heroku。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oo op di oq bf or"><div class="gh gi on"><img src="../Images/ba8a95caaf04d2472f97a442ea2a404a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NnHch9nRDscKDR0C7Z0nBA.jpeg"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><p id="6b6a" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">接下来，我们将在步骤5中创建的GitHub repo连接到Heroku应用程序，并选择一个分支。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oo op di oq bf or"><div class="gh gi os"><img src="../Images/687b4beec35ba1370faa1b764d93bca6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z-jnACwtfyVUXOLgOsQkZg.jpeg"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><p id="cdc0" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">最后，在<strong class="ku ir">步骤7 </strong>中，选择手动(或自动)部署，您可以看到构建日志滚动。一旦应用程序被部署，您将在日志中获得应用程序的URL并显示成功消息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oo op di oq bf or"><div class="gh gi ot"><img src="../Images/5cbf507fed547a61953a696d1e9c7b94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QYMrdyyeAp-gL2DQpLYU1A.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><p id="6859" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">点击“查看”,将带您进入第2步中的Flask UI页面。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oo op di oq bf or"><div class="gh gi ou"><img src="../Images/4560aa9d31ccb42c4c197841f5b120e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jGDBsA2VmDhtEtTcx3pgNQ.jpeg"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><p id="ed16" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">一旦你填写了所有的字段并点击预测，它将给出最终的预测结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oo op di oq bf or"><div class="gh gi ov"><img src="../Images/2f79fa55b964b2612dde9afa1c7d516d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QkqzR5X3lrCBTvVCPs7LJg.jpeg"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><h2 id="b388" class="nz mv iq bd mw oa ob dn na oc od dp ne lb oe of ng lf og oh ni lj oi oj nk ok bi translated">Heroku日志</h2><p id="13cd" class="pw-post-body-paragraph ks kt iq ku b kv nm jr kx ky nn ju la lb no ld le lf np lh li lj nq ll lm ln ij bi translated">您可以在<a class="ae kr" href="https://devcenter.heroku.com/articles/heroku-cli" rel="noopener ugc nofollow" target="_blank"> heroku-cli </a>中查看Heroku应用程序部署日志。下载cli后，打开命令提示符并登录Heroku。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oo op di oq bf or"><div class="gh gi ow"><img src="../Images/c083b3dd1ecf457b1f9a70d294453ecb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uTQZqT12a5yqkgYvLM8R-A.jpeg"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><p id="3742" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">登录后，您可以使用命令查看部署日志</p><p id="5837" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">heroku logs -app <app-name/></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oo op di oq bf or"><div class="gh gi ox"><img src="../Images/c92be5d39ad4385d8adc99fe6a1e5d5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w1HoKv4Qr-LMrRebgjZLhw.jpeg"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><p id="3057" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">您可以在日志中看到所有加载的构建库和应用程序部署步骤。如果在部署过程中出现任何错误/失败，这些日志对于调试更有用。</p><blockquote class="oy oz pa"><p id="fd2c" class="ks kt pb ku b kv kw jr kx ky kz ju la pc lc ld le pd lg lh li pe lk ll lm ln ij bi translated">就这样！使用这些简单的步骤，任何机器学习模型都可以部署在Heroku上，以获得实时预测。</p></blockquote></div><div class="ab cl ns nt hu nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="ij ik il im in"><h2 id="8b2a" class="nz mv iq bd mw oa ob dn na oc od dp ne lb oe of ng lf og oh ni lj oi oj nk ok bi translated"><strong class="ak">局限性</strong></h2><ol class=""><li id="243c" class="mg mh iq ku b kv nm ky nn lb pf lf pg lj ph ln ml mm mn mo bi translated"><strong class="ku ir">成本- </strong> Heroku每小时的定价比AWS/Azure贵很多。所以如果你在Heroku上使用多个大规模的应用，那肯定会是一件成本更高的事情。</li><li id="27ad" class="mg mh iq ku b kv mp ky mq lb mr lf ms lj mt ln ml mm mn mo bi translated">与AWS/Azure相比，Heroku支持的地理区域有限。</li><li id="9549" class="mg mh iq ku b kv mp ky mq lb mr lf ms lj mt ln ml mm mn mo bi translated"><strong class="ku ir">手动扩展- </strong> Heroku不提供web应用的自动扩展，但允许手动水平和垂直扩展。</li><li id="a6ef" class="mg mh iq ku b kv mp ky mq lb mr lf ms lj mt ln ml mm mn mo bi translated"><strong class="ku ir">部署与Git链接- </strong> Heroku部署与Git链接，如果您使用其他版本控制工具，这是一个限制。</li></ol><h1 id="608c" class="mu mv iq bd mw mx my mz na nb nc nd ne jw nf jx ng jz nh ka ni kc nj kd nk nl bi translated"><strong class="ak">结论</strong></h1><p id="1d54" class="pw-post-body-paragraph ks kt iq ku b kv nm jr kx ky nn ju la lb no ld le lf np lh li lj nq ll lm ln ij bi translated">使用Heroku生产ML模型是一个很好的选择，如果你正在部署一个中小规模的应用程序，不要担心自动伸缩，只想专注于构建ML应用程序而不是基础设施。</p><p id="ed6e" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">虽然使用Heroku部署会花费更多；同样的成本可以通过更少的资源来构建/监控本地/云基础架构和执行开发运维任务来节省。Heroku是初学者友好的，你可以在几秒钟内创建一个服务器并部署应用程序。在AWS的支持下，Heroku提供了所有的云平台功能，如扩展、日志、监控、配置和健康检查。此外，您还可以获得24x7全天候运营支持，并且不会停机/停机时间最短。</p><p id="9234" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">要使用Heroku访问实时预测的完整代码，请参考GitHub <a class="ae kr" href="https://github.com/charumakhijani/heroku-ml-deployment" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><p id="6ed4" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><strong class="ku ir">如果您想了解更多模型部署策略，请参考- </strong></p><div class="lo lp gp gr lq lr"><a href="https://medium.com/swlh/productionizing-machine-learning-models-bb7f018f8122" rel="noopener follow" target="_blank"><div class="ls ab fo"><div class="lt ab lu cl cj lv"><h2 class="bd ir gy z fp lw fr fs lx fu fw ip bi translated">生产机器学习模型</h2><div class="ly l"><h3 class="bd b gy z fp lw fr fs lx fu fw dk translated">将模型部署到产品中是一件复杂的事情。</h3></div><div class="lz l"><p class="bd b dl z fp lw fr fs lx fu fw dk translated">medium.com</p></div></div><div class="ma l"><div class="pi l mc md me ma mf kl lr"/></div></div></a></div><p id="7590" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">谢谢你的阅读。如果你喜欢这个故事，请喜欢，分享和关注更多这样的内容。如往常一样，请联系我们以获得任何问题/评论/反馈。</p><p id="3a14" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><em class="pb">Github:</em><a class="ae kr" href="https://github.com/charumakhijani" rel="noopener ugc nofollow" target="_blank">https://github.com/charumakhijani</a><em class="pb"><br/>领英:</em><a class="ae kr" href="https://www.linkedin.com/in/charumakhijani/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/charumakhijani/</a></p></div></div>    
</body>
</html>