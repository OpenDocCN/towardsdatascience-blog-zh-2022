<html>
<head>
<title>How Ranking Time Series Data Can Identify Abnormal Behaviour</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列数据的排序如何识别异常行为</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-ranking-timeseries-data-can-identify-abnormal-behaviour-475c7fd21fb5#2022-01-13">https://towardsdatascience.com/how-ranking-timeseries-data-can-identify-abnormal-behaviour-475c7fd21fb5#2022-01-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="5707" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/notes-from-industry" rel="noopener" target="_blank">行业笔记</a></h2><div class=""><h1 id="928d" class="pw-post-title jb jc it bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy bi translated">时间序列数据的排序如何识别异常行为</h1></div><div class=""><h2 id="4d9c" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">通过简单的python脚本告知您的维护策略并防止故障</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/22a7e1de2896a0e48b461f5076ff0c3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sGGbkDXffWVIMOVn"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">美国公共电力协会在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2c11" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">温度和压力等传感器读数有助于了解资产的“正常”行为。当读数偏离该标准时，它可能是损坏或低效运行的指示，如果不加以纠正，可能会导致代价高昂的设备故障。因此，这些数据有助于形成任何主动维护或检查活动。</p><p id="8de4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，问题是温度与许多因素有关；资产的工作强度(例如生产水平)、环境温度和冷却效率。这使得寻找和识别<em class="me">真正</em>关注的温度水平和变化变得棘手，可能需要昂贵的数据专家，有时我们只是没有收集足够的数据来获得准确的结果，或者没有兴趣在这方面投资。</p><p id="b245" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，我们可以做一些更简单的事情。</p><p id="c129" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果我们有多种资产，例如发电机，我们可以将每个发电机的行为相对于其他发电机进行排序。通过随着时间的推移跟踪这一排名，我们可以寻找行为变化的<em class="me">证据。</em>然后可以对此进行标记，以便进行深入调查。代码非常简单，不需要昂贵复杂的模型就可以获得结果。</p><p id="1a8e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">本文侧重于工程应用，但很容易看出如何将其应用于任何受多种因素影响的基准测试。</p><h1 id="7794" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">一个例子</h1><p id="e57d" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">让我们以发电机为例，假设您有20台不同发电机的历史发电量和温度读数。只考虑发电机正常生产的时间。发电机A是2016年排名最高的生产商(最高产量)，也是最热门的——这并不奇怪，我们知道这两者是相关的。在同一年，发电机B是最冷的(第19位)之一，具有中等的包装生产水平(第11位)。在接下来的四年里，这些相同类型的排名持续稳定，所以我们有信心这是他们的“标准”。</p><p id="0acf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，在2021年，发现发电机A是该年第二热的，但却是最低的生产者之一。好像有什么不对劲，为什么还是这么热？此外，发电机B现在是第七热的发电机，但其生产值没有改变。这也很奇怪，这种发电机在这些生产水平下不会运行得这么热，还会发生什么呢？</p><p id="9e03" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">只看温度读数可能会忽略发电机A的异常温度，因为从表面上看，温度读数没有太大变化，是它们与发电的关系发生了变化。孤立地看待这两者可能没有突出问题。同样，B可能已经被遗漏，因为发电机仅是第七热的，因此可能被认为不够热而不必担心。</p><p id="6410" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是一个首过指标，现在应该对这两项资产进行全面的数据调查。当时还有什么在影响这个系统？例如，资产是否长期离线？通讯中断了吗？传感器精度有问题吗？是否存在可能导致此类行为的已知问题？回答这些问题，了解检查或主动工作是否符合您的利益。</p><h1 id="5d11" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">代码</h1><p id="dffb" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">这个例子使用python中的pandas库。一般来说，工作流程是:</p><ol class=""><li id="e452" class="nc nd it lk b ll lm lo lp lr ne lv nf lz ng md nh ni nj nk bi translated"><strong class="lk jd">源时间序列数据</strong> —以:时间戳、资产、世代、温度的形式</li><li id="9dc4" class="nc nd it lk b ll nl lo nm lr nn lv no lz np md nh ni nj nk bi translated"><strong class="lk jd">按期望的时间间隔</strong>分组——获得年或月平均值、总和、偏差等。</li><li id="70ca" class="nc nd it lk b ll nl lo nm lr nn lv no lz np md nh ni nj nk bi translated"><strong class="lk jd">申请排名</strong></li><li id="bb72" class="nc nd it lk b ll nl lo nm lr nn lv no lz np md nh ni nj nk bi translated"><strong class="lk jd">分析结果</strong></li></ol><p id="76bd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面是更详细的工作流程。</p><h1 id="0c2e" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">准备要排序的数据</h1><pre class="ks kt ku kv gt nq nr ns nt aw nu bi"><span id="d85c" class="nv mg it nr b gy nw nx l ny nz"># import pandas library<br/>import pandas as pd</span><span id="c485" class="nv mg it nr b gy oa nx l ny nz"># read in timeseries data, may be via csv or queried direct<br/># from a database<br/>df = pd.read_csv(r'filepath\filename.csv')</span><span id="6835" class="nv mg it nr b gy oa nx l ny nz"># create a variable for your desired time interval<br/># i.e. year or month<br/>df['year'] = pd.to_datetime(df['TimeStamp']).dt.to_period('Y')</span><span id="aa7a" class="nv mg it nr b gy oa nx l ny nz"># group the data by generator and year and find the aggregate values<br/>#e.g. average temperature over the year<br/>df2 = df.groupby(['GeneratorId','year']).agg({'average_temp': ['std', 'mean'], 'generation': ['std', 'sum']})</span><span id="44b1" class="nv mg it nr b gy oa nx l ny nz"># write to excel<br/>df2.to_csv(r'filepath\filename.csv', index = False)</span></pre><p id="9788" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">虽然您可以在这一步应用排名，但我建议导出数据子集，并对照实际值进行检查。这将确保脚本像预期的那样工作，并可能使您以后免受代码中任何讨厌的错误的困扰。</p><h1 id="d0e2" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">对数据进行排序</h1><p id="44f5" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">这个函数非常简单，一旦读回python apply:</p><pre class="ks kt ku kv gt nq nr ns nt aw nu bi"><span id="1c1a" class="nv mg it nr b gy nw nx l ny nz">df2['average_temp_rank'] = df_year.groupby('year')['average_temp_mean'].rank(pct=True)</span></pre><p id="5ea9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这将把温度等级应用到名为“average_temp_rank”的新列中。对其他要排序的值重复此操作，如generation sum，就这样！</p><h1 id="360d" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">分析一下</h1><p id="42c3" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">然后可以在python或excel中进行进一步的分析，以跟踪这些排名是如何变化的。一种方法可以是趋势代排名:温度排名比率，这是保持稳定还是变得不匹配？</p><p id="aab8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">上面没有提到的是一段时间内的<strong class="lk jd">标准差</strong>排名。温度波动是否超过正常值？特别是在发电机中，这些频繁的波动会导致材料因这些变化而膨胀和收缩，从而导致损坏。</p><h1 id="01d3" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">深入挖掘</h1><p id="7154" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">如前所述，这部分是关键。排名分析将为我们提供一些线索，表明有什么地方出了问题，从而引发更广泛的调查。</p><p id="d5ae" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">虽然这是一个简化的例子，但显然排名分析可以有一系列有用的应用。请在评论中告诉我你如何在你的行业中使用它们。</p></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><div class="ks kt ku kv gt oi"><a href="https://medium.com/@hollydalligan/membership" rel="noopener follow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd jd gy z fp on fr fs oo fu fw jc bi translated">通过我的推荐链接加入Medium-Holly Dalligan</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">medium.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow lb oi"/></div></div></a></div></div></div>    
</body>
</html>