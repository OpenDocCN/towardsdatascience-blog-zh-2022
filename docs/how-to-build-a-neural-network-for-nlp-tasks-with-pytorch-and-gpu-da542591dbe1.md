# 如何用 PyTorch 和 GPU 构建用于 NLP 任务的神经网络

> 原文：<https://towardsdatascience.com/how-to-build-a-neural-network-for-nlp-tasks-with-pytorch-and-gpu-da542591dbe1>

## 使用 Google Colab 对文本数据建模的框架

![](img/2af4ca8b591276b2d1f1e89de35fc948.png)

斯蒂夫·约翰森摄:[https://www . pexels . com/photo/blue-red-and-black-abstract-painting-2130475/](https://www.pexels.com/photo/blue-red-and-black-abstract-painting-2130475/)

T 他的文章旨在作为一个框架，使用 Python、神经网络和 GPU 来解决自然语言处理(NLP)问题。虽然理解这里的一切需要很高的数学水平，但我写这篇文章的目的是让一个完全的初学者或经验丰富的老手从中有所收获。我希望一个初学者带走解决 NLP 问题的一般框架，而一个老手可能使用它作为在 PyTorch 中将模型推送到 GPU 的参考。

我们开始吧！

## NLP:数据和预处理

尽管数据清理不是建模过程中最令人兴奋的方面，但它无疑是最重要的。数据清理和预处理指的是将原始文本数据结构化和格式化成我们可以建模的东西。对这一过程的关注可以成就或破坏后续模型的统计推断。我们将使用来自 NLTK(用于 NLP 的 Python 库)语料库模块的数据，该模块包括电影评论及其*真相*分类(无论评论是正面还是负面)。让我们首先导入我们将需要的模块并下载必要的数据…

该项目的相关进口报表

在 NLP 中有很多被抛弃的术语——让我们介绍一些更相关的术语…

*   **文集**—*文档的集合*
*   **文档** —来自*语料库*的文本主体
*   **令牌**—*文档中的单词列表*
*   **词汇** —词汇

用粗笔画，所有包含#ElonMusk 的 tweets 就是一个*语料库*的例子。包含#ElonMusk 的所有 tweet 集合中的每个 tweet 都是一个*文档*。因此，每个文档中的每个单词都是一个*令牌*。这个环境中的词汇属于社交词汇；也就是使用#ElonMusk 时在社交语境中使用的词汇。

为了开始 Python 中的预处理，我们将创建两个列表。第一个列表包含电影评论语料库中的每个文档。第二个列表包含基本事实，一个对应于评论是正面还是负面的值(“正面”或“负面”)。

创建文档及其各自类别的列表

让我们看一下每个列表中的单个元素，这样我们就可以更好地了解我们正在处理的数据…

**文件[0]:**

```
"plot : two teen couples go to a church party..."
```

这是*文档*列表中的众多电影评论之一。

**猫[0]:**

```
0
```

这是与上述电影评论相对应的类别(负面)。请注意，在代码中，我们是如何将负数(' neg ')转换为 0，将正数(' pos ')转换为 1 的——这对于我们的神经网络模型是必要的。

我们的目标是建立一个神经网络，可以学习电影评论中常用的词，这些词可以是积极的，也可以是消极的。在此之前，我们需要清理一下电影评论文本。

让我们构建一个函数来清理和预处理每个文档。

预处理和清洗改编自[数据营](https://www.datacamp.com/tutorial/discovering-hidden-topics-python)

再一次，让我们分解一些语言学术语…

*   **令牌化** —将*文档*转换为*令牌列表*
*   **词干化**——孤立词根(*示教* = *示教*)
*   **终止词**——无信息贡献的词( *the* 、*和*、*同为*)

*预处理*功能为每个文档建立一个*标记器*和一个*词干器*。我们通过遍历列表中的每一个文档，并从删除所有标点符号和减少所有单词开始。在某些情况下，我们需要考虑不同的情况，但为了简单起见，我们将' *GREAT'* 和' *great* 视为同一事物。

接下来，我们将标记器应用于文档，创建一个单词列表，在其中应用*停止单词*移除和词干。如果这个列表中有一个单词存在于 NLTK 预定义的停止单词列表中，我们会将其从单词列表中删除。这里的目标是开发尽可能小的单词列表，同时保持尽可能多的关于原始文档的信息。换句话说，如果我们有一长串不相关的信息，我们会给我们的模型带来不必要的噪音，让它更难学习。例如，“*”*很可能出现在正面和负面的电影评论中。因此，在清理后的文本中包含“*”和“*”不会帮助我们的模型学习。

最后，我们将把剩下的单词“T42”转换成“教学”。*“-ing”*结尾是为了语法目的而存在的，但是这个词的词根意义没有改变，所以我们打算以类似的方式在所有文档中对其进行建模。再一次，我们想最小化我们的模型面临的噪音，所以它有最好的学习机会。

既然我们已经预处理了文档，我们需要开发一个文档术语矩阵，即所谓的*文档术语矩阵*。这听起来可能很复杂，但它实际上是一个文档矩阵和每个文档中的术语。也许更合适的名称是*文档-令牌矩阵*，因为每行对应一个文档，每列对应一个令牌以及它在文档中出现的次数。这意味着对于所有文档中的每一个标记，都有一个用于*的列，其中矩阵中的每个值都对应于它在该文档中出现的次数。*

让我们为预处理的电影评论数据建立一个文档术语矩阵。

创建文档术语矩阵并将其转换为数据框架

现在我们准备开始构建我们的语言模型。我想强调的是，我们仍然可以做大量的事情来进一步预处理这些数据。在继续构建模型之前，我们可以应用降维技术、聚类算法等等，从我们的文档(文档术语矩阵)中进一步提取有意义的信息。虽然深入探讨降维技术超出了本文的范围，但我想留下一些我创建的资源来进行降维主题的教育…

*   [主成分分析](https://github.com/Quant-Guild/PCA_Tutorial)
*   [奇异值分解](/singular-value-decomposition-158469b433ad)

事不宜迟，让我们进入有趣的部分，构建模型。

## NLP:使用 GPU 在 PyTorch 中构建神经网络模型

在本节中，我们将构建神经网络来学习如何对电影评论进行分类。我们还将学习如何使用 PyTorch 和 GPU，通过并行化来提高训练速度。我推荐使用 Google Colab 和他们的免费 GPU 层来开始。如果您对直观理解并行化及其如何加速计算感兴趣，请查看下一篇文章的直觉部分。

*   [随机化奇异值分解](https://medium.com/quant-guild/parallelizing-randomized-singular-value-decomposition-using-gpus-62dff9e0c945)

训练任何机器学习或人工智能的第一步是将数据分割成*训练*和*测试集*。我不会在模型开发的哲学上花太多时间，我们将一起构建每个组件。如果你有兴趣更深入地理解我通常所说的建模艺术，请随意阅读以下文章…

*   [人工智能训练营](https://medium.com/swlh/artificial-intelligence-bootcamp-8745d61a9d25)
*   [机器如何学习？](/how-do-machines-learn-e3b023bfa28d)
*   [线性回归与神经网络](/linear-regression-v-s-neural-networks-cd03b29386d4)

首先，我们将数据分成训练集和测试集。

为我们的分类模型创建电影评论的训练和测试集

现在我们已经准备好建立我们的分类模型了。我非常支持边做边学(在这里是编码)。然而，理解构成人工智能模型的基础数学是有好处的。让我们从代码开始，提供一些关于我们所做的数学选择的直觉。

PyTorch GPU 二进制分类模型

在这种情况下，神经网络最重要的功能选择是输出层的激活功能。摆在我们面前的任务是一个二进制分类任务，因此我们需要将一个输入分类为两个类别之一( *1 或 0，正或负*)。我们选择一个 *sigmoid* 激活函数来做这件事。该激活函数将其输入压缩到对应于电影评论是否正面的概率中。如果概率大于 50%,我们会说电影评论是正面的，否则我们会说它是负面的。我们的神经网络将*通过调整其权重来学习*输入到概率的正确映射，以改进其对训练集中的基本事实的预测。一旦我们训练了我们的模型，我们将用测试集来测试它；我们这样做是为了确保我们的模型不会*记忆* ( *过度拟合*)训练集中的观察值。

注意，在上面的代码块中，我们包含了一个语句*。到(' cuda')'* 。这会将模型推送到 GPU，因此当开始训练过程时，它会自动并行化。这将显著提高培训过程的绩效。

*注意:使用 GPU 时最常见的错误之一是在使用 GPU 时试图访问存储在 CPU 中的内存，反之亦然。永远记住变量在内存中的存储位置。*

我们现在准备使用训练数据来训练模型。

PyTorch GPU 模型培训

在模型被充分训练后，我们需要测试它的表现如何*样本外*。我们将使用我们的模型*尚未见过的测试数据*来确定我们的模型对新数据的分类能力。这将确保我们的神经网络模型实际上是在*学习*一些东西，而不仅仅是*过度拟合*训练数据。

创建一个二元测试集来与基本事实进行比较

```
print(classification_report(y_hat_int, y_test))
```

```
 precision    recall  f1-score   support

           0       0.87      0.88      0.88       258
           1       0.87      0.86      0.87       242

    accuracy                           0.87       500
   macro avg       0.87      0.87      0.87       500
weighted avg       0.87      0.87      0.87       500
```

使用分类报告功能，我们可以比较模型的预测和实际情况，以确定模型的准确性。

上面的打印输出告诉我们，我们的模型在确定哪些电影评论是正面的，哪些是负面的方面做得非常好！

*一些最后的想法…*

这里我们观察到相对平衡的支持，测试集中正面和负面评论的数量。需要注意的是，在我们的训练和测试集中，我们通常希望有一个像这样平衡的类表示。如果类别不平衡，我们的模型可以*学习*猜测出现最多的类别，这意味着它真的没有学到任何东西。

这在异常检测问题(如洗钱和医疗保险欺诈)中很常见，因为异常的发生通常只占数据的一小部分(比如 0.01%)。因此，一个模型仅仅通过猜测出现最多的类就可以获得大约 99.99%的准确率。

当然，这是一个有趣的问题，我们可以在另一篇文章中探讨！

## **参考文献**

[](https://www.kaggle.com/datasets/nltkdata/movie-review) [## 电影评论

### 情感极性数据集版本 2.0

www.kaggle.com](https://www.kaggle.com/datasets/nltkdata/movie-review) 

```
Bo Pang and Lillian Lee. 2004\. A Sentimental Education: Sentiment Analysis 
Using Subjectivity Summarization Based on Minimum Cuts. In ACL.
```

非常感谢您的阅读！我希望你喜欢这篇文章——如果你有任何问题，请随时发表评论或联系我们:*roman@quantguild.com*。

如果你有兴趣了解更多，请查看 [Quant Guild](https://quantguild.com/) ！

Quant Guild 是我创办的一所在线学校，你可以在那里学习包括数学、统计学、计算机科学和数据科学在内的主题。

如果你对更多**免费课程和资源**感兴趣，或者想在 Quant Guild 支持我们，你可以看看我们的…

*   [GitHub](https://github.com/Quant-Guild)
*   [YouTube](https://www.youtube.com/quantguild)
*   [中等](https://medium.com/quant-guild)
*   [帕特里翁](https://www.patreon.com/quantguild)
*   [网站](https://quantguild.com/)
*   [领英](https://www.linkedin.com/company/76565075/admin/)

除此之外，下期再见！

**RMP**