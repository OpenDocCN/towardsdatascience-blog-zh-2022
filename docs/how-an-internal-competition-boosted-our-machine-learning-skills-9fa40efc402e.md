# 内部竞争如何提升我们的机器学习技能

> 原文：<https://towardsdatascience.com/how-an-internal-competition-boosted-our-machine-learning-skills-9fa40efc402e>

## *在享受乐趣的同时为您的人工智能创新提供动力*

W 我们都热衷于开放协作来学习、成长和激发创新，但有时你需要感受竞争对手的压力来推动自己前进。通过我们公司内部的人工智能竞赛，我们做到了这一点。我们选择了一个相关的挑战，我们的工程师在小组中相互竞争，以开发-同时-最好和最有效的机器学习模型。

没错:我们在这里使用了一种权衡，因为对于现实世界的人工智能问题，你不能总是抓住性能最高的最大模型。需要考虑成本和时间限制。

这个比赛是 Slimmer AI 钟爱的 AI 伙伴计划的一部分。这个项目划分并构建了专门的 R&D 时间，在这段时间里，我们的机器学习工程师在最先进的技术上进行合作、实验、学习和进步，以解决大问题。目的是加强他们的个人发展，并推进我们不久的将来的公司目标。我们按季度周期工作，所以我们承诺用整整三个月的周期来投入这场竞赛。

最终，比赛的形式将决定它是否有助于公司和员工的成长，或者它是否只是一个打发时间的有趣活动。要实现你的目标，你需要找到理想的主题，组建合适的团队，并创造完美的条件。

在这篇文章中，我将分享我们所做的一些决定，以及这些决定是如何被事后评估的，这样你就可以在你自己的团队中展开一场更加成功的竞赛。

![](img/ced9f0755549c6c7d16949d6da8c50d3.png)

在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上[鲍炯](https://unsplash.com/@ba0_tru0ng?utm_source=medium&utm_medium=referral)的照片

# **规则**

## **完美的挑战**

为了最大限度地发挥作用，竞赛必须既强化我们在过去一年中获得的知识*又包含一种新的元素来进一步推动我们的专业知识。我们选择致力于自然语言处理(NLP)领域内的一项挑战，因为我们过去一年的创新有相当一部分发生在那里。之前，我们探讨了命名实体识别和少量学习等主题，并认为通过结合它们来更深入地研究这些概念是有意义的。此外，在不久的将来，我们的一个产品精通多语言人工智能解决方案，这具有战略意义。我们知道我们也必须解决这个问题。*

包含数千个数据集的拥抱脸中枢在寻找正确的挑战方面提供了宝贵的帮助。它让我们发现了 [XTREME 数据集](https://github.com/google-research/xtreme)，这是一个多语言多任务 NLP 基准。它涵盖了 40 种不同类型的语言，包括 9 项需要对不同层次的语法和语义进行推理的任务。在九项任务中，我们选择了四项与我们最近的研发工作一致的任务。多任务和多语言方面给团队增加了新的挑战，从而确保比赛是一次相关的学习经历。

## **没有选择退出**

就像伙伴计划的其他部分一样，参加比赛不是可有可无的。该团队高度重视持续学习，因此积极参与创新活动只是工作的一部分。作为回报，每周有半天时间用于竞赛等联谊活动。

比赛还有另一个强制性的方面，让参赛队伍引以为豪:想出一个很棒的队名。因此，我们有像 Ditto(一个“变形金刚”神奇宝贝)、neuronary Networks 和 Astrology(由前天文学毕业生组成)这样的团队试图确保他们的第一名。

## **黄金情侣**

我们将我们的机器学习工程师团队分成两人一组。我们不希望人们独自应对挑战，因为我们希望促进合作，并从彼此的优势中学习。然而，我们也不想让车队变得更大，也不想制造免费骑行的诱惑。

结对的选择是一个深思熟虑的过程，在这个过程中，我们希望将高年级学生与低年级学生配对，每对学生中至少有一个人具有相关的主题经验，并通过让在前一年中合作不多的人联合起来加强新的联系。当然，团队的专业知识需要平衡，以确保每个人都有公平的机会。是的，我们确实很想写一个优化算法来解决这个问题，但是我们最终手工做得相当成功。

## **高效良好**

一开始，我们非常清楚获胜的标准。我们对四个选定任务的得分进行平均，以根据性能对每个团队的模型进行排名。

然而，在测试阶段，团队的效率也会被评分。我们打算使用由[实验撞击跟踪器](https://github.com/Breakend/experiment-impact-tracker)计算的功率度量，但是这没有提供我们希望的可靠结果。因此，我们转而简单地使用测试阶段的总持续时间作为模型效率的近似值。毕竟，当所有型号运行在相同的硬件上时，效率较低的型号通常会更慢。

为了选出最终的获胜者，我们为拥有最高效模型的两个团队创建了一个重新排名规则。拥有最高效模式的团队在整体绩效排名中被提升了两位。第二高效的团队被推上了一个位置。请注意，只有当平均任务得分的绩效差异在 100 分的范围内小于 10，并且效率差异大于 5%时，这种重新排序才适用。我们不希望一个超级快速但随机的模型爬上队伍。

## **独立评估**

当训练数据集被移交给竞争团队时，评估测试数据集和最终测试数据集被保留。然后，指派一名未参与的工程师根据保留的数据对模型进行评估。有三次机会在评估测试数据集上运行模型，每次尝试后都会更新中间排行榜。最终的测试数据集只在最后使用一次来确定最终排名。

## **协作竞赛**

当然，团队需要竞争，但我们也希望人们基于彼此的发现快速学习和创新。我们每周举行站立会议，人们在会上分享他们遇到或测试过的有趣方法。每个团队都对具体的实现和参数保密。

此外，所有提交的作品将在比赛结束后分享。虽然这样做是为了确保更多的学习和促进干净的代码，但这也是防止作弊的万无一失措施，因为测试集可以在网上免费获得。

![](img/7dcc04f5f705b49c6f7f9dbf92373c2a.png)

图片由更苗条的 AI 提供

# **比赛**

每个团队必须提交一个可以处理 40 种不同语言和四种不同 NLP 任务的模型:

*   确定一个前提句是必然的，矛盾的，还是对一个假设句中立的。
*   判断两个句子是否是彼此的释义。
*   执行词性标注(例如，识别名词、动词、代词等。).
*   执行命名实体识别(例如，识别命名的人员、组织、位置等。).

三个月每周四个小时的时间远远不够从头开始训练一个成功的模特。你也不应该真的有高质量的预训练模型可用的开源。团队尝试寻找和微调最适合的预训练模型，始终记住不必要的笨重会受到惩罚。

## **技巧**

现在，这是我们为那些渴望一睹我们团队成就的人提供技术支持的地方。如果您对此不感兴趣，请随意跳到下一部分。

大多数团队使用一个 mBERT 模型作为他们的基础。不是因为它是最好的，而是因为它是我们非常熟悉的建筑。BERT 模型只允许 512 个令牌序列作为输入，这对于数据集中一些较长的样本来说是个问题。团队尝试了各种技术来更好地服务较长的输入序列，例如不要在单词中间剪切序列，或者为后续句子添加更多上下文。他们还试验了模型的架构。例如，通过向分类头添加第二层来获得改进的结果。

学习率在微调过程中至关重要，有两个动作被证明特别有用。首先，一些团队不仅训练头部，还解冻编码器，并对模型的较低层使用持续较低的学习速率。第二，带热身的学习速度表可以提高成绩。在预热过程中，学习率首先从低值上升到初始学习率，然后再次下降到较低值。

一个团队通过不填充样本成功地加速了他们的模型并提高了效率。取而代之的是，他们将所有的样本背靠背的连接在一起，使用一个分隔符来表示他们的划分。当然，在生产系统中，这只有在样品也成批出现时才有效。通过启用混合精度训练和并行标记化，还发现了其他重大改进。

我们支持吴恩达目前正在倡导的[以数据为中心的人工智能运动](https://datacentricai.org/)。在某一点上，通过改进数据而不是进一步微调模型可以获得更大的收益。为了提高不常用语言的性能，团队成功地进行了过采样和添加常用语言翻译样本的实验。从多种语言中一次性取样增强了模型的概括能力，而不是一个接一个地对语言进行训练。

## **获胜的队伍**

最后，最后的结果非常接近。有一个团队非常大胆，提交了一个 InfoXML 架构，而不是使用 mBERT。使用这种野兽模型，他们在性能方面被推到第一位。然而，他们的模型效率非常低，比第二名慢了三倍多，以至于他们不幸在伟大的重新排名中失去了第一名(如果你忘记了我们是如何评估模型的，请回过头来看)。实际上，这种模式是如此的低效，以至于第三个表演团队也走在了他们的前面。这意味着表现最佳的型号在最终排行榜上名列第三。第二个表演队获得了冠军。多好的旅程啊！

![](img/f7775a71c85088cd238f82adf100c217.png)

我们人工智能竞赛的最终结果。虽然蓝队神经质网络在他们的最终提交上得分最高(折线图)，但他们的模型速度慢得多，效率低得多(条形图)，导致他们因处罚而下降了两个位置。粉红色的亚军团队垃圾古伯带着一等奖回家。图片由更苗条的 AI 提供。

# **吸取的教训**

比赛结束时的一项调查显示:

*   10 个工程师中有 9 个认为他们在构建深度学习模型方面扩大了自己的知识和技能。
*   10 人中有 8 人认为这项任务很有趣，比赛本身也是一次非常有价值的经历。
*   每个人都觉得有足够的能力和支持来完成他们自己的实验。
*   大多数人认为没有足够的时间和计算资源来完成他们想要的所有实验。

我们是一家数据驱动的公司，所以显然我们喜欢可量化的调查结果，以数字方式跟踪我们朝着正确的方向前进。然而，没有通过回顾得到的更深层次的个人反馈，我们是做不到的。这些见解有助于持续改进。

那么，我们从复古中学到了什么？

## **从一个工作版本开始**

很多时间都花在了创建数据加载器和获得端到端的工作管道上。给真正的 ML 创新留下更少的空间。虽然一些工程师发现这种体验非常有价值，但我们不认为我们需要重复这一点，并且可能会为我们的下一次竞争提供基线模型和数据加载器，以便人们可以直接进入好的东西。

## **进一步细化标准**

事后看来，因为一个模型的效率比它的亚军低 5%而严厉惩罚它似乎有点过于严厉。我们很幸运，重新排序规则在我们的案例中运行良好，因为表现最好的团队之间的效率差异是如此之大。但下一次，我们可能会根据我们提供的基准模型的性能来校准这些阈值，并在将这些数字刻在石头上之前与整个团队进行核对。我们也可以尝试激励训练较少的模型。

## **面向所有人的 GPUs】**

除了竞争对手，我们还有用户需要服务，所以时间限制仍然存在。然而，为了克服资源限制，下次我们将为每个团队提供专用的云 GPU，而不是共享我们的内部 GPU。我们可能会给每个团队相同的资源预算，以刺激更有效和更环保的模型训练。

## **引入新工具**

虽然几个深度学习库已经在我们的技术堆栈中存在多年，但 [PyTorch Lightning 库](https://www.pytorchlightning.ai/)对许多工程师来说是新的，比赛让整个团队获得了使用它的经验。许多工程师喜欢这种动手体验，这让我们最终扩大了我们的技术堆栈，因为每个人都熟悉它。下一次，我们将快速浏览一些有用的库，并加入到竞赛中。

## **带回禅意**

人们对比赛变得如此热情，以至于兼顾比赛和其他责任变得相当有压力。我们的工作不是制造压力，所以这是我们下次要避免的。更大的团队可能会有所帮助，但我们都同意要避免搭便车，这可能会让每个人都失去动力。因此，我们可能会在下一次比赛中奖励更多的中间提交。我们甚至可以在每个中间阶段宣布获胜者，让每个人公开分享他们的代码，然后让其他团队在下一次提交时对其进行改进。希望这能平均分配工作量，让紧张保持在一个令人愉快的水平。

## **保持学术性**

我们讨论了数据集多少有些人为的、颇具学术性的本质是否是一个好主意。作为一家应用人工智能公司，我们不应该使用真实世界的数据吗？总的来说，我们的结论是所选的数据集非常适合我们的目的。我们一年中的每一天都在研究现实世界的人工智能问题。专注于更具学术性的任务让每个人都有空间专注于创新部分并提高技术技能，而不是试图用肮脏的数据抓住不断发展的问题陈述。

## **少一点对话？**

我们从一开始就知道，试图促进合作竞争可能有点愚蠢。想吃掉你的蛋糕，还能拥有它。事实上，尽管团队在每周的站立会议上肯定分享了进展和突破，但他们也提到他们有点不愿意分享他们最好的想法，这是可以理解的。下一次，我们可能会对单口相声采用问答的形式，因为每个人都非常愿意帮助其他陷入困境的人。这与中间提交后的代码共享相结合，可能仍然会创造一个开放的环境，而不会破坏竞争元素。

# **结论**

举办比赛是为了提高我们的技术能力，并从中获得乐趣。虽然下一次我们可能会改变一些规则，但我们很高兴两个目标显然都达到了。

在比赛中，我们获得了训练多任务模型和准备数据的新的实践经验。在下一个季度，当来自竞争对手的代码直接应用于商业产品的开发时，这种经验已经被证明是有用的。我们在多语言培训方面的经验目前帮助我们设计一个新的人工智能应用程序。由于他们的实践经验，所有的工程师都更加意识到他们可以预期的机遇和挑战。在更高的技术层面上，我们的整个团队获得了使用新 ML 库的实践经验，大大加快了新产品的开发时间。

但是人工智能奖学金和它的竞争不仅仅是学习和推动创新。这也是一个联系和庆祝成功的地方。虽然参与者显然很喜欢这场比赛，但公司的其他人也加入了公布中间排名的每周例会。获胜的队伍在我们公司的圣诞晚会上成为焦点，并将在我们食堂的名人堂的墙砖上找到永恒的荣耀，上面有他们的名字。在这一年中，远程工作让我们在身体上的距离超出了我们的期望，比赛证明了这是一个享受乐趣和为共同目标建立联系的好机会。

![](img/b87ea034769771234c05be2db7ebcdc7.png)

*竞赛获胜者在我们的名人堂中找到了永恒的荣耀。*图片由更苗条的 AI 提供。

特别感谢[sy bren Jansen](https://sybrenjansen.medium.com/)——我们的人工智能创新负责人——精心设计和组织了这次活动！我们可能会很快再次举办另一场比赛，但我们推动创新的其他有趣想法也在不断增加。我想最好说…敬请期待！

如果你想了解更多关于我们在 Slimmer AI 的工作，请随时联系或访问我们的网站了解更多信息。

如果你想到了其他创意方案来让持续学习和创新变得有趣，请在评论中分享这份快乐！