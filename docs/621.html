<html>
<head>
<title>Python Automation: Connecting to Oracle Database using Cx Oracle</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python自动化:使用Cx Oracle连接到Oracle数据库</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automation-python-scripts-connecting-to-oracle-database-using-cx-oracle-1fe1801821b5#2022-01-21">https://towardsdatascience.com/automation-python-scripts-connecting-to-oracle-database-using-cx-oracle-1fe1801821b5#2022-01-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""><h1 id="f114" class="pw-post-title ir is it bd iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp bi translated">Python自动化:使用Cx Oracle连接到Oracle数据库</h1></div><div class=""><h2 id="dfb1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我如何使用Cx Oracle和其他一些Python库来自动化小型ETL任务</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5c7b4b285455e276a1669eda6fde7c55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MP3dLOP8S2vaauHxR2CGuA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://www.pexels.com/photo/close-up-photo-of-person-typing-on-laptop-1181675/" rel="noopener ugc nofollow" target="_blank">像素</a>的图像</p></figure><p id="ae66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我一直使用cx_Oracle Python扩展模块来访问我的Oracle数据库，因此我能够自动化我的大多数小任务。</p><p id="6104" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Oracle提供的在线文档可以帮助您直接访问Oracle数据库，但在本文中，我将演示如何使用Cx Oracle和其他一些python库来自动执行从本地计算机到Oracle数据库的小型ETL任务。</p><p id="254d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目标是编写一个<strong class="lb iu"> python脚本</strong>，它读取本地文件夹中的文件，执行数据清理和转换，然后插入到Oracle数据库中。然后，可以通过任务调度程序对这个python脚本文件进行调度，以便它可以按照设定的时间表自动运行。将添加额外的日志记录代码来跟踪脚本中发生的事情。</p><p id="4618" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">先决条件:</strong></p><p id="7efb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您可以在python脚本中编写Cx Oracle之前，您需要安装<a class="ae ky" href="https://cx-oracle.readthedocs.io/en/latest/user_guide/installation.html" rel="noopener ugc nofollow" target="_blank"> Oracle客户端库</a>，当您成功安装这些库后，您就可以开始编写python脚本了。为了开始这个脚本，我导入了这些库:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a748" class="ma mb it lw b gy mc md l me mf">import pandas as pd<br/>import cx_Oracle<br/>import math<br/>import logging</span></pre><h1 id="163e" class="mg mb it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">记录器信息块:</h1><p id="c8c4" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li mz lk ll lm na lo lp lq nb ls lt lu im bi translated">logger info代码块生成一个日志文件，记录您的脚本是否成功运行。如果脚本是自动执行的，这些日志会很有用，这样您就可以得到命令状态的通知。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h1 id="0a08" class="mg mb it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">数据加载和清理:</h1><p id="2736" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li mz lk ll lm na lo lp lq nb ls lt lu im bi translated">第一个python函数从服务器或本地文件夹读取文件，在必要时清理和转换数据，然后返回所需的数据框输出，该输出将用于插入Oracle数据库表。代码非常简单，可以添加任何额外的命令来转换数据集。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h1 id="73ac" class="mg mb it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">Cx Oracle连接</h1><p id="f2b0" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li mz lk ll lm na lo lp lq nb ls lt lu im bi translated">第二个python函数是数据库连接和Oracle命令发生的地方。块的第一部分需要连接细节，如用户名、密码、主机名、端口和SID，以便python可以与Oracle通信。第二部分是通过简短的SQL查询定义命令或任务。我在函数中添加了3个查询，Truncate <em class="ne">(清除表但保留表模式)</em>、Insert <em class="ne">(在表中注入数据)</em>和Grant Access <em class="ne">(授予公共访问权限以便用户可以查询您的表)</em> —如果需要，可以添加更多的查询。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h1 id="a9ae" class="mg mb it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">脚本运行程序</h1><p id="9d63" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li mz lk ll lm na lo lp lq nb ls lt lu im bi translated">调用这两个函数的python脚本的最后一部分。如果您已经注意到logger.info在整个脚本的大多数行中都被调用，这使得跟踪每个命令的状态变得更加容易。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="136c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个python脚本文件现在可以用作批处理文件的一部分，可以通过任务调度器上传或通过命令提示符<em class="ne">运行(logger info也通过cmd打印通知)</em>。</p><p id="5de7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你对导入速度感兴趣，我已经在小型到大型数据集上进行了测试。例如，对于100万行代码，python脚本花了大约12分钟才成功导入到我的Oracle表上。当然，这取决于您本地机器上的其他几个因素。</p><p id="32b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总的来说，这个简单的python脚本和自动化过程将帮助您节省时间来完成占用您一些时间的小任务。</p><blockquote class="nf ng nh"><p id="ef72" class="kz la ne lb b lc ld ju le lf lg jx lh ni lj lk ll nj ln lo lp nk lr ls lt lu im bi translated">【https://www.kathleenlara.com/】网站:<a class="ae ky" href="https://www.kathleenlara.com/" rel="noopener ugc nofollow" target="_blank"/></p><p id="5de6" class="kz la ne lb b lc ld ju le lf lg jx lh ni lj lk ll nj ln lo lp nk lr ls lt lu im bi translated"><strong class="lb iu">推特:</strong><a class="ae ky" href="https://twitter.com/itskathleenlara" rel="noopener ugc nofollow" target="_blank">https://twitter.com/itskathleenlara</a></p></blockquote></div></div>    
</body>
</html>