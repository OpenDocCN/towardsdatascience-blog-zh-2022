<html>
<head>
<title>Analyzing My WhatsApp Database using SQL and Redash</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SQL和Redash分析我的WhatsApp数据库</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/analyzing-my-whatsapp-database-using-sql-and-redash-5ef9bd6a0b0#2022-01-10">https://towardsdatascience.com/analyzing-my-whatsapp-database-using-sql-and-redash-5ef9bd6a0b0#2022-01-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""><h1 id="6bd4" class="pw-post-title ir is it bd iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp bi translated">使用SQL和Redash分析我的WhatsApp数据库</h1></div><div class=""><h2 id="c354" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何创建一个包含一些关键绩效指标的交互式仪表盘，显示您和您的朋友如何使用WhatsApp</h2></div><p id="9938" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">几个月前，我在浏览WhatsApp聊天记录时，突然有了一个想法:为什么不提取我的WhatsApp数据库，并对其进行一些数据分析？可以提取许多关于我和我的联系人如何使用WhatsApp的有趣元数据。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/b4b5aa673a9ffb6685d08a3a114baed4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ec0xG8k0lXmud0qE"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">照片由<a class="ae lu" href="https://unsplash.com/@linkedinsalesnavigator?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> LinkedIn销售解决方案</a>在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="a4da" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这不是一个简单的过程，因为你需要以某种方式将数据库从你的手机复制到你的电脑上，然后理解它，一旦你理解了它的结构，就要考虑可以提取哪些有用的信息以及如何呈现它。这花了我很多时间，但现在我对结果感到非常自豪，我真的很高兴能与你们分享这些成果。</p><p id="9a5c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我将向你解释:</p><ul class=""><li id="dfee" class="lv lw it kk b kl km ko kp kr lx kv ly kz lz ld ma mb mc md bi translated">如何将你的WhatsApp数据库从iPhone或Android手机复制到电脑上</li><li id="cc3c" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">如何从原始数据库中获得这个实验的相关数据</li><li id="7cf1" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">SQL查询获取关于我们使用WhatsApp的最有趣的KPI</li><li id="3226" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">如何创建一个交互式仪表板来可视化这些KPIs我们将使用<a class="ae lu" href="http://redash.io" rel="noopener ugc nofollow" target="_blank"> Redash </a>,但也可以随意选择其他—。</li></ul><p id="f04d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你想亲自尝试，你需要几样东西:</p><ul class=""><li id="3775" class="lv lw it kk b kl km ko kp kr lx kv ly kz lz ld ma mb mc md bi translated">有根的安卓手机或者iPhone(不需要越狱)</li><li id="76f0" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">将手机连接到电脑的USB电缆</li><li id="b209" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated"><a class="ae lu" href="https://developer.android.com/studio/releases/platform-tools" rel="noopener ugc nofollow" target="_blank"> adb </a>如果你的手机是安卓系统，或者是装有<a class="ae lu" href="https://www.microsoft.com/en-us/p/itunes/9pb2mz1zmb1s" rel="noopener ugc nofollow" target="_blank"> iTunes </a>的Windows PC，或者是苹果电脑如果是iPhone</li><li id="57f7" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">安装在计算机上的sqlite3 用于处理数据库</li><li id="0710" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated"><a class="ae lu" href="https://gcc.gnu.org" rel="noopener ugc nofollow" target="_blank"> gcc </a>和<a class="ae lu" href="https://www.gnu.org/software/make/" rel="noopener ugc nofollow" target="_blank"> make </a>安装在你的电脑上编译备份解压程序(除非你有Mac，因为这个工具已经为macOS编译好了)</li><li id="dba2" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated"><a class="ae lu" href="https://www.docker.com/get-started" rel="noopener ugc nofollow" target="_blank"> Docker </a>安装在您的电脑上，用于部署<a class="ae lu" href="https://redash.io" rel="noopener ugc nofollow" target="_blank"> Redash </a>或任何其他仪表板工具</li></ul><p id="7e92" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你准备好加入我了吗？我们走吧！</p><h1 id="839d" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">#1.提取WhatsApp数据库</h1><h2 id="2cdf" class="nb mk it bd ml nc nd dn mp ne nf dp mt kr ng nh mv kv ni nj mx kz nk nl mz nm bi translated">从安卓手机上</h2><p id="0928" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">如果你有一部Android手机，我很抱歉地告诉你，你需要<a class="ae lu" href="https://www.androidauthority.com/root-android-277350/" rel="noopener ugc nofollow" target="_blank">一个根设备</a>。WhatsApp数据库存储在限制访问的文件系统位置，因此您需要特殊权限才能获得它。有一些替代方法可以获得它，但是最终都需要root访问权限。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ns"><img src="../Images/a2e5f8fe36aa3e21b7ab87985b0506a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m1UqACDzLuQJLo27"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">照片由<a class="ae lu" href="https://unsplash.com/@andymant?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Andrew M </a>在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="7982" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你有你的手机根，你必须按照这些步骤安装adb <a class="ae lu" href="https://www.xda-developers.com/install-adb-windows-macos-linux/" rel="noopener ugc nofollow" target="_blank">，然后用USB线连接你的手机并运行你的工作目录中的命令:</a></p><pre class="lf lg lh li gt nt nu nv nw aw nx bi"><span id="ffe4" class="nb mk it nu b gy ny nz l oa ob">adb root<br/>adb shell sqlite3 wa.db “.backup ‘wa.db.bak’”<br/>adb pull /data/data/com.whatsapp/databases/msgstore.db<br/>adb pull /data/data/com.whatsapp/databases/wa.db.bak wa.db<br/>sqlite3 msgstore.db .dump &gt; whatsapp.sql<br/>sqlite3 wa.db .dump &gt;&gt; whatsapp.sql<br/>sqlite3 whatsapp.db &lt; whatsapp.sql</span></pre><p id="5bd6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们在这里做的是获得root权限，获得存储WhatsApp数据的两个数据库，并将它们合并成一个数据库。</p><h2 id="7ba2" class="nb mk it bd ml nc nd dn mp ne nf dp mt kr ng nh mv kv ni nj mx kz nk nl mz nm bi translated">从iPhone上</h2><p id="1e2b" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">有了<a class="ae lu" href="https://www.idownloadblog.com/jailbreak/#whatis" rel="noopener ugc nofollow" target="_blank">越狱的iPhone </a>，这个过程可能会更容易——它可能看起来类似于上面对Android的解释——但由于我的iPhone没有越狱(世界上大多数人也没有越狱)，我们将从备份中提取它。</p><p id="43c7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，你得把你的iPhone连接到电脑上，并进行备份。你可以在苹果官方网站上找到<a class="ae lu" href="https://support.apple.com/kb/HT211229" rel="noopener ugc nofollow" target="_blank"> Mac </a>和<a class="ae lu" href="https://support.apple.com/kb/HT212156" rel="noopener ugc nofollow" target="_blank"> Windows </a>的详细说明。然后，我们将使用名为<a class="ae lu" href="https://github.com/Siguza/imobax" rel="noopener ugc nofollow" target="_blank"> <em class="oc"> imobax </em> </a>的开源工具从备份中提取WhatsApp数据库。如果你有Mac，可以直接从<a class="ae lu" href="https://github.com/Siguza/imobax/releases/latest" rel="noopener ugc nofollow" target="_blank">这里</a>下载可执行文件。如果你使用的是Windows，那么你需要自己使用<em class="oc"> gcc </em>和<em class="oc"> make </em>来编译它(关于如何安装它的说明<a class="ae lu" href="https://dev.to/gamegods3/how-to-install-gcc-in-windows-10-the-easier-way-422j" rel="noopener ugc nofollow" target="_blank">这里是</a>):只需将存储库下载到你的计算机上，并在文件夹中运行命令“<em class="oc"> make </em>”。</p><p id="5164" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您使用了Mac进行备份，它将存储在<em class="oc">~/Library/Application Support/mobile sync/Backup</em>中。如果你是在Windows中做的，这个目录将会是<em class="oc">% user profile % \ Apple \ mobile sync \ Backup</em>或者<em class="oc">% appdata % \ Apple Computer \ mobile sync \ Backup</em>。在这些目录中，将有一个包含您的备份的文件夹，在所有备份的文件中，包括我们的数据库。问题是这些文件有随机的字母数字名称。这就是imobax将帮助我们的地方，它告诉我们哪个文件是数据库。</p><pre class="lf lg lh li gt nt nu nv nw aw nx bi"><span id="ccf8" class="nb mk it nu b gy ny nz l oa ob">./imobax -l &lt;backup location&gt;  | grep ChatStorage.sqlite | awk ‘{print $1}’</span></pre><p id="bb09" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的命令将给出数据库的名称。只需在备份文件夹中搜索，复制到你的工作目录中，随心所欲的重命名，比如<em class="oc"> whatsapp.db </em>。</p><h1 id="2889" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">#2.探索数据库</h1><p id="7088" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">WhatsApp数据库充满了表格，有些表格有无数的列和行。它们中的大多数都与我们无关，所以让我们看看我们将使用哪些表和列。</p><h2 id="264a" class="nb mk it bd ml nc nd dn mp ne nf dp mt kr ng nh mv kv ni nj mx kz nk nl mz nm bi translated">在Android上</h2><ul class=""><li id="614e" class="lv lw it kk b kl nn ko no kr od kv oe kz of ld ma mb mc md bi translated"><strong class="kk iu"> <em class="oc"> wa_contacts </em> </strong>:关于您的联系人和群组的信息<br/><em class="oc">unseen _ msg _ count</em>:该联系人/群组未阅读的消息数量<br/> ➣ <em class="oc"> jid </em>:联系人或群组的标识符:联系人将以“<em class="oc">@ s . whatsapp . net”</em>结尾，群组以“<em class="oc">@ g . us”<br/></em>➣<em class="oc">display _ name</em></li><li id="9381" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated"><strong class="kk iu"> <em class="oc"> chat_view </em> </strong>:聊天会话<br/> ➣ <em class="oc"> raw_string_jid </em>:联系人/群组的标识符<br/>➣<em class="oc">last _ message _ row _ id</em>:消息中该聊天的最后一条消息的fk<br/>➣<em class="oc">sort _ timestamp</em>:该联系人/群组的最后一条消息的日期</li><li id="f178" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated"><strong class="kk iu"> <em class="oc">消息</em></strong><br/>➣<em class="oc">key _ from _ me</em>:0为传入消息，1为传出消息<br/> ➣ <em class="oc"> media_wa_type </em>:消息是否为文本(0)、图片(1)、视频(2)、语音消息(3)……<br/>➣<em class="oc">时间戳</em>:以<a class="ae lu" href="https://en.wikipedia.org/wiki/Unix_time" rel="noopener ugc nofollow" target="_blank"> UNIX时间格式发送或接收消息的日期和时间</a>。<br/> ➣ <em class="oc">数据</em>:信息的文本(对于没有文本的彩信为空)<br/> ➣ <em class="oc"> key_remote_jid </em>:远程部分的标识符(如果收到信息，则为发送方，如果发送信息，则为接收方)</li></ul><h2 id="8ce0" class="nb mk it bd ml nc nd dn mp ne nf dp mt kr ng nh mv kv ni nj mx kz nk nl mz nm bi translated">在iPhone上</h2><ul class=""><li id="de05" class="lv lw it kk b kl nn ko no kr od kv oe kz of ld ma mb mc md bi translated"><strong class="kk iu"> <em class="oc"> ZWACHATSESSION </em> </strong>:关于您的联系人和群组的信息<br/> ➣ <em class="oc"> ZMESSAGECOUNTER </em>:与该联系人/群组交换的消息数量<br/> ➣ <em class="oc"> ZSESSIONTYPE </em>:如果是与联系人的私人消息，则为0；如果是群组，则为1；如果是广播，则为2；如果是状态，则为3。<br/> ➣ <em class="oc"> ZUNREADCOUNT </em>:未从该联系人/群组读取的消息数<br/> ➣ <em class="oc"> ZLASTMESSAGE </em> : FK为该联系人/群组的最后一条消息<em class="oc">zwa message</em><br/>➣<em class="oc">zlastmessagedate</em>:该联系人/群组的最后一条消息的日期<br/> ➣ <em class="oc"> ZCONTACTJID </em>:该联系人或群组的标识符:联系人将以“【结束</li><li id="f221" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated"><strong class="kk iu"> <em class="oc"> ZWAMESSAGE </em> </strong>:发送和接收的消息<br/> ➣ <em class="oc"> ZISFROMME </em> : 0为传入消息，1为传出消息<br/> ➣ <em class="oc"> ZMESSAGETYPE </em>:消息是文本(0)、图像(1)、视频(2)、语音消息(3)……<br/>➣<em class="oc">zmessagedate</em>:消息发送或接收的日期和时间<a class="ae lu" href="https://en.wikipedia.org/wiki/Unix_time" rel="noopener ugc nofollow" target="_blank"> UNIX时间 但是时间戳从2001年1月1日开始，而不是从1970年1月1日开始(</a><a class="ae lu" href="https://www.oreilly.com/library/view/practical-mobile-forensics/9781788839198/a78b0a6a-e0f5-45b8-bce9-b82c3e7a3b7a.xhtml" rel="noopener ugc nofollow" target="_blank">此处解释</a> ) <br/> ➣ <em class="oc"> ZTEXT </em>:消息的文本(对于没有文本的多媒体消息为空)<br/> ➣ <em class="oc"> ZFROMJID </em>:发送者的标识符； 如果消息是由用户发送的(<em class="oc"> ZISFROMME </em> == 1)，该字段将为空<br/> ➣ <em class="oc"> ZTOJID </em>:接收方的标识符；如果用户收到消息(<em class="oc"> ZISFROMME </em> == 0)，该字段将为空</li></ul><h1 id="493b" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">#3.转换数据</h1><p id="8524" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">为了以后使我们的SQL查询更容易，现在在我们的数据库中创建两个视图是一个好主意:一个用于私人的、单独的消息(让我们称之为<em class="oc"> friends_messages </em>)，另一个用于来自群聊的消息(<em class="oc"> group_messages </em>)。这不仅简化了SQL查询，还允许我们对iPhone和Android使用相同的查询。</p><h2 id="9d12" class="nb mk it bd ml nc nd dn mp ne nf dp mt kr ng nh mv kv ni nj mx kz nk nl mz nm bi translated">在Android上</h2><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="og oh l"/></div></figure><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="b7cc" class="nb mk it bd ml nc nd dn mp ne nf dp mt kr ng nh mv kv ni nj mx kz nk nl mz nm bi translated">在iPhone上</h2><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="og oh l"/></div></figure><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="og oh l"/></div></figure><h1 id="7fca" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated"># 4.设置可视化工具</h1><p id="88ae" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">在我的实验中，我使用了<a class="ae lu" href="https://redash.io" rel="noopener ugc nofollow" target="_blank"> Redash </a>来创建一个仪表板，以可视化KPI，我们将在以后研究这些KPI。遵循本指南，可以使用Docker <a class="ae lu" href="https://redash.io/help/open-source/dev-guide/docker" rel="noopener ugc nofollow" target="_blank">轻松部署这个开源工具。不言而喻，您可以自由使用任何其他支持SQLite的可视化工具，如PowerBI、Tableau等。</a></p><p id="b665" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦我们导入了上一步创建的数据库视图，下一步就是创建一个查询来获取联系人列表和另一个查询来获取组列表。这将是需要的，然后能够显示一个下拉列表，以过滤那些关于单个联系人或组的关键绩效指标。在Redash中，这是通过创建这两个SQL查询来完成的，然后在相应的KPI上添加一个类型为“<em class="oc">查询的下拉列表</em>的参数，在SQL查询中可以称为“<em class="oc"> {{ parameter_name }} </em>”。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oi"><img src="../Images/4dbc544d733bc5c7395e447a0dd57bbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LR_VUzWgDGlJoBK2esDacQ.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">Redash查询中一个名为"<em class="oj"> friend_name" </em>的变量的定义，它将从一个包含您所有联系人姓名的下拉列表中获取值</p></figure><h2 id="977a" class="nb mk it bd ml nc nd dn mp ne nf dp mt kr ng nh mv kv ni nj mx kz nk nl mz nm bi translated">用于检索所有联系人姓名的SQL查询:</h2><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="6936" class="nb mk it bd ml nc nd dn mp ne nf dp mt kr ng nh mv kv ni nj mx kz nk nl mz nm bi translated">用于检索所有组名称的SQL查询:</h2><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="og oh l"/></div></figure><h1 id="2285" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">#5.定义和可视化KPI</h1><p id="55c6" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">现在我们准备动手编写一些SQL查询来提取一些关于我们如何使用WhatsApp的有趣KPI。实际可以提取的KPI数量只是受到你的想象力和创造力的限制，所以欢迎你自己创造。我会给你们留下一些我创作的作品:</p><h2 id="c6e5" class="nb mk it bd ml nc nd dn mp ne nf dp mt kr ng nh mv kv ni nj mx kz nk nl mz nm bi translated">KPI #1:在过去30天里与你交谈最多的人</h2><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="d26f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该查询可以用垂直条形图来可视化，X轴上的列为“<em class="oc"> friend_name </em>”，Y轴上的列为“<em class="oc"> number_of_messages </em>”。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/d16ec9c02c88cc20e7073582e310a04c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*ZkOF48n3lb1Q6lwbKU4ffA.png"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">最近30天内与我交谈最多的前20位联系人(出于隐私原因，底部的姓名被删除)</p></figure><h2 id="c3ef" class="nb mk it bd ml nc nd dn mp ne nf dp mt kr ng nh mv kv ni nj mx kz nk nl mz nm bi translated">KPI #2:你的每一个朋友每天的信息数量</h2><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="a83a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个查询可以用一个折线图来可视化，X轴上是列“<em class="oc"> day </em>”，Y轴上是列“<em class="oc"> ma_mom </em>”。请注意查询的第一行，其中计算了30天的移动平均值。如果没有它，图表看起来会非常清晰和嘈杂，因此应用这个过滤器。</p><p id="874e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另外需要注意的是<em class="oc"> {{ friend_name }} </em>是一个变量，所以Redash(或者相应的可视化工具)会用选中的联系人替换它。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ol"><img src="../Images/0bf8958e6784055f7aa345454ae1cb60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uOoxDT894XJ7tDW7_zNuag.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">一段时间内每天与联系人交换的消息数量。该值已经用30天移动平均值进行了平滑。</p></figure><h2 id="f5ba" class="nb mk it bd ml nc nd dn mp ne nf dp mt kr ng nh mv kv ni nj mx kz nk nl mz nm bi translated">KPI #3:一天中或一周中你和你的朋友交谈最多的时刻</h2><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="215e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于这个KPI，我们使用sqlite函数<em class="oc"> strftime() </em>按一天中的小时和一周中的天对消息进行分组，然后计算一周中每天的小时和天中交换的消息总数。然后我们可以在数据透视表中绘制它。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi om"><img src="../Images/223b45bc87e7226e4bef79f88b29f48c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BwXb-khAwnEk9LRSgH2HUg.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">这张热图显示了一周中每天每小时与朋友交换的信息数量</p></figure><h2 id="e073" class="nb mk it bd ml nc nd dn mp ne nf dp mt kr ng nh mv kv ni nj mx kz nk nl mz nm bi translated">KPI #4:写邮件最长的前10位朋友</h2><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="4f6a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这个查询中，我们计算每个联系人发送给我们的邮件的平均长度，得到前10个，然后绘制成垂直条形图。但是把长文拆分写在几条消息里是很正常的，所以这个KPI不是很准确。考虑到这一事实，我试图计算它，但是需要非常复杂的算法，不幸的是不能用sqlite实现。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi on"><img src="../Images/ed93efca0663555c028f98e466787eac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*puZVIaGM_AXHrf0eoXBNVg.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">此图表显示了平均来说写邮件最长的前10位联系人发送的邮件的平均字母数(出于隐私原因，底部的姓名被剪掉)</p></figure><h2 id="6338" class="nb mk it bd ml nc nd dn mp ne nf dp mt kr ng nh mv kv ni nj mx kz nk nl mz nm bi translated">KPI #5:一段时间内组中每个成员发送的消息数量</h2><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="5e6d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">与KPI #2类似，这里我们使用30天移动平均值过滤每个组成员每天发送的消息数量，包括我自己("<em class="oc"> Me </em>")。由于我们使用的是组，所以使用视图“<em class="oc"> group_messages </em>”来代替“<em class="oc"> friend_messages </em>”，并且在仪表板中定义了一个新变量(“<em class="oc"> group_name </em>”)，因此用户可以选择他想要查看该图表的组。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oo"><img src="../Images/9cef8b280bf873fce96e843b0a6f69eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tCpcceg13J5LoGdKBlhlJw.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">每个小组参与者(包括我自己)的参与率(每天过滤的消息数量，以30天的移动平均值计算)的变化</p></figure></div><div class="ab cl op oq hx or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="im in io ip iq"><p id="941a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是一个很大的帖子，我已经涵盖了一个很长的过程:从我们的手机中提取数据库，清理数据，用SQL做一些分析，然后在图表中可视化这些结果。我从中获得了很多乐趣，所以我欢迎你们亲自尝试，并尝试制定一些新的KPI。请随意发表您的印象、发现或改进的评论，我将很高兴阅读您的来信！</p><h2 id="1f7d" class="nb mk it bd ml nc nd dn mp ne nf dp mt kr ng nh mv kv ni nj mx kz nk nl mz nm bi translated">来源</h2><ol class=""><li id="dc4b" class="lv lw it kk b kl nn ko no kr od kv oe kz of ld ow mb mc md bi translated">ADB文档:<a class="ae lu" href="https://developer.android.com/studio/command-line/adb#shellcommands" rel="noopener ugc nofollow" target="_blank">https://developer . Android . com/studio/command-line/ADB # shell commands</a></li><li id="eeb4" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ow mb mc md bi translated">SQLite 3窗口函数:<a class="ae lu" href="https://sqlite.org/windowfunctions.html" rel="noopener ugc nofollow" target="_blank">https://sqlite.org/windowfunctions.html</a></li><li id="25c6" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ow mb mc md bi translated"><em class="oc"> strftime </em>手动:<a class="ae lu" href="https://man7.org/linux/man-pages/man3/strftime.3.html" rel="noopener ugc nofollow" target="_blank">https://man7.org/linux/man-pages/man3/strftime.3.html</a></li><li id="fb4d" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ow mb mc md bi translated"><em class="oc"> WhatsApp在众目睽睽之下:在哪里以及如何收集法医文物</em>:<a class="ae lu" href="https://blog.group-ib.com/whatsapp_forensic_artifacts" rel="noopener ugc nofollow" target="_blank">https://blog.group-ib.com/whatsapp_forensic_artifacts</a></li><li id="0f26" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ow mb mc md bi translated"><em class="oc">WhatsApp DB中的奇遇——从备份中提取消息(附代码示例)</em>:<a class="ae lu" href="https://medium.com/@Med1um1/extracting-whatsapp-messages-from-backups-with-code-examples-49186de94ab4" rel="noopener">https://medium . com/@ med 1um 1/extracting-WhatsApp-messages-from-backups-with-code-examples-49186 de 94 ab 4</a></li></ol></div></div>    
</body>
</html>