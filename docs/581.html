<html>
<head>
<title>Clean Messy Address Data Effortlessly Using Geopy and Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Geopy和Python轻松清理杂乱的地址数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/transform-messy-address-into-clean-data-effortlessly-using-geopy-and-python-d3f726461225#2022-01-20">https://towardsdatascience.com/transform-messy-address-into-clean-data-effortlessly-using-geopy-and-python-d3f726461225#2022-01-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""><h1 id="8717" class="pw-post-title ir is it bd iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp bi translated">使用Geopy和Python轻松清理杂乱的地址数据</h1></div><div class=""><h2 id="c8c8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">处理缺少邮政编码、缺少州、拼错街道名称、拼错城市名称的地址</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/76a8bdcdc807529e4bf31e5fc94e4ea3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZWclsVZ10ysWhCETDBg1dg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="376d" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">背景</h1><p id="76ff" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">你以前在你的数据科学项目中处理过杂乱的地址数据吗？如果是这样，您可能会注意到可能有许多种转录错误，例如，缺少邮政编码、缺少州、拼错的街道名称、拼错的城市名称以及数据中不同种类的缩写。如果您需要清理和标准化这些原始地址数据，这很快就会变成一场噩梦。</p><p id="d4b0" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">在这篇文章中，我想分享一种替代方法来清理杂乱的地址数据，这种方法可以省去您的麻烦，让您有更多的时间和精力来开发令人敬畏的机器学习模型。</p><h1 id="8609" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">原始地址数据的常见问题</h1><p id="7bca" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">首先，让我们创建一个样本数据集。在这个数据集中，我们有带有常见转录错误的原始地址，例如，<strong class="ls iu">缺少邮政编码，缺少州，拼错街道名称，拼错城市名称，或者一个地址数据点</strong>中的多个错误。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="22a6" class="mw kz it ms b gy mx my l mz na">import pandas as pd</span><span id="e281" class="mw kz it ms b gy nb my l mz na">messy_address = pd.read_excel("messy address.xlsx")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/83039e52758e5d7fc173ff66ffb496b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UO9FNmjS6ucAbVExLTB6DQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者创建的图像</p></figure><h1 id="230d" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">地质公园</h1><p id="fd43" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">清理原始地址数据的目标是获得标准化格式的地址信息，其中包含完整的地理信息，例如街道名称、街道名称、城市、州和邮政编码。</p><p id="8f6d" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">为了实现这一点，我们将使用<code class="fe nd ne nf ms b"><a class="ae ng" href="https://geopy.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">geopy</a></code>，这是一个Python库，允许用户访问几个<strong class="ls iu">流行的地理编码web服务</strong>，如谷歌地图、必应地图、MapQuest、百度等等。</p><p id="6764" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">这个想法很简单。当您在上述地理编码web服务之一中手动搜索地址时，您可能并不总是输入完整的地址信息。很可能你会在打字中出现拼写错误，这与原始地址数据中的抄写错误非常相似。通常，这些地理编码web服务足够智能，能够理解您的意思，并从其服务器以干净的格式返回匹配的地址。</p><p id="8df3" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">使用<code class="fe nd ne nf ms b"><a class="ae ng" href="https://geopy.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">geopy</a></code>，我们可以通过无缝地将原始地址传递给这些地理编码web服务来输出干净的地址数据。</p><h1 id="7961" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">安装库</h1><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="9a9b" class="mw kz it ms b gy mx my l mz na">pip install geopy</span></pre><h1 id="2199" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">初始地理编码服务API</h1><p id="707e" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">正如我上面提到的，有许多地理编码API可用。可以使用免费API，比如，<strong class="ls iu"> OpenStreetMap </strong>或者付费API，比如，<strong class="ls iu"> Google Maps。这完全取决于你将如何部署你的程序。你会得到你所付出的。如果只是为了你自己喜欢的项目，一个免费的API可能会很好。如果您将部署用于商业目的，您应该考虑付费API，因为您可以扩展每日API配额限制。</strong></p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="eeaa" class="mw kz it ms b gy mx my l mz na"># <strong class="ms iu">OpenStreetMap Free API</strong><br/>from geopy.geocoders import Nominatim<br/>geolocator = Nominatim(user_agent="<a class="ae ng" href="mailto:aaron_clover@hotmail.com" rel="noopener ugc nofollow" target="_blank">Y</a>our Email")</span><span id="e3e6" class="mw kz it ms b gy nb my l mz na"># <strong class="ms iu">Google Maps Paid API</strong><br/>from geopy.geocoders import GoogleV3<br/>geolocator = GoogleV3(api_key='Your Google Maps API Key')</span></pre><p id="1748" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">为了使用谷歌地图API，我们需要一个谷歌地图API。但是不用担心。你可以按照这个<a class="ae ng" href="https://yoast.com/help/generate-set-google-maps-api-key/" rel="noopener ugc nofollow" target="_blank"> <strong class="ls iu">快速教程</strong> </a>为<strong class="ls iu">免费</strong>生成自己的谷歌地图API密匙。</p><p id="161a" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">您自己的Google API键看起来类似于“aizaybdj 88 HN 7 ltgkhhk 5 wh fav 8 a 5 ozl x2e _ k”。你可以复制并保存这个API密匙到你电脑的某个地方。</p><p id="a26d" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">初始化地理编码服务API后，编码就很简单了。您可能想要创建自己的函数来从API中提取干净的地址。</p><p id="ae48" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">如果你想批量处理原始地址，你可以使用Pandas库的lambda函数。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="3409" class="mw kz it ms b gy mx my l mz na">def extract_clean_address(address):<br/>    try:<br/>        location = geolocator.geocode(address)<br/>        return location.address<br/>    except:<br/>        return ''</span><span id="60a8" class="mw kz it ms b gy nb my l mz na">messy_address['clean address'] = messy_address.apply(lambda x: extract_clean_address(x['Raw Address']) , axis =1  )</span></pre><p id="940a" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">正如您从下面看到的，从Google Maps API返回的干净地址看起来比原始地址更干净、更完整。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/57a2bd18bdbaae5e5996350286f88e7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-rzweActvnq3MyskHIIKgA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者创建的图像</p></figure><h1 id="4834" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">从原始地址中提取经度和纬度</h1><p id="fc6d" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">使用<code class="fe nd ne nf ms b"><a class="ae ng" href="https://geopy.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">geopy</a></code>可以对原始地址做更多的事情。例如，您可以从地理编码web APIs中提取经度和纬度。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="5d78" class="mw kz it ms b gy mx my l mz na">def extract_lat_long(address):<br/>    try:<br/>        location = geolocator.geocode(address)<br/>        return [location.latitude, location.longitude]<br/>    except:<br/>        return ''</span><span id="cff2" class="mw kz it ms b gy nb my l mz na">messy_address['lat_long'] = messy_address.apply(lambda x: extract_lat_long(x['Raw Address']) , axis =1)<br/>messy_address['latitude'] = messy_address.apply(lambda x: x['lat_long'][0] if x['lat_long'] != '' else '', axis =1)<br/>messy_address['longitude'] = messy_address.apply(lambda x: x['lat_long'][1] if x['lat_long'] != '' else '', axis =1)<br/>messy_address.drop(columns = ['lat_long'], inplace = True)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/8c8048ce5def6d9d9f68999f960fdca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Df0OPLq0Fcd2ASAv7rv1dg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者创建的图像</p></figure><h1 id="ed27" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">最后一个音符</h1><p id="65e4" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">除了提取干净的地址和地理坐标，我们还可以使用<code class="fe nd ne nf ms b"><a class="ae ng" href="https://geopy.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">geopy</a> </code>来计算两个地址点之间的地理距离和行驶时间。但是请记住，其中一些地理编码web服务是付费服务。您可能会有一些免费的日常请求，但是在使用它们之前，您应该检查它们的政策和价格。</p><h1 id="9cf9" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">感谢您的阅读！！！</h1><p id="4957" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">如果你喜欢这篇文章，并且想<strong class="ls iu">请我喝杯咖啡，</strong>请<a class="ae ng" href="https://ko-fi.com/aaronzhu" rel="noopener ugc nofollow" target="_blank">点击这里</a>。</p><p id="acd0" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">您可以注册一个<a class="ae ng" href="https://aaron-zhu.medium.com/membership" rel="noopener"> <strong class="ls iu">会员</strong> </a>来解锁我的文章的全部访问权限，并且可以无限制地访问介质上的所有内容。如果你想在我发表新文章时收到电子邮件通知，请订阅 。</p></div></div>    
</body>
</html>