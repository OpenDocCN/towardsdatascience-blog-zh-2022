# 改善数据管道的四种软件工程最佳实践

> 原文：<https://towardsdatascience.com/four-software-engineering-best-practices-to-improve-your-data-pipelines-484c1f368e28>

## 从敏捷到抽象，用我们思考软件的方式思考数据可以让我们避免很多痛苦。

![](img/38842dcfc3a36a3748a28aa6ff3dc982.png)

由[路](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)上[车头](https://unsplash.com/@headwayio?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)拍摄

让我们从一些重要的事情开始:数据工程和软件工程之间有一些主要的区别。

同时，它们足够相似，以至于许多起源于软件工程的最佳实践对数据工程非常有帮助，只要你正确地构建它们。

在本文中，我将介绍几个软件工程最佳实践，以及它们如何帮助您创建和维护更好的数据管道。我将特别关注管道，因为这是我们在[河口](https://www.estuary.dev/product/)关注的内容，但是这些原则同样适用于您的数据堆栈。

讨论将是高层次的。我自己不是软件工程师，我也不认为你必须从这些原则中获得战略和领导价值。

# 软件工程与数据工程的异同

数据和软件产品不同，其利益相关者也不同。

一般来说，构建软件产品需要高技术团队之间的协作。该产品可以交付给各种各样的用户群，通常是商业性的。例如，一家银行可能为其客户创建一个移动应用程序。

相比之下，数据产品往往存在于企业的范围内。所涉及的利益相关者和参与者可以是技术含量很高的工程师，也可以是需要数据来完成工作的非技术专业人员。例如，同一家银行可能会创建关于其客户的金融和人口统计数据产品*来帮助安全、销售和战略。*

如果你在读这篇文章，你会在数据空间里闲逛，这意味着我可能不需要去纠缠这些区别。您已经亲眼目睹了数据如何被视为与软件完全不同，尤其是从业务角度来看。

但是数据工程和软件工程的基本实践是相同的。您正在编写、维护和部署代码来解决一个可重复的问题。正因为如此，有一些有价值的软件工程最佳实践可以转化为数据工程最佳实践。许多最新的数据趋势——如数据网格和数据操作——以一种新的方式应用软件工程实践，并取得了出色的结果。

# 软件工程与数据工程的历史

为了理解为什么这些最佳实践来自软件，并且只是最近才被应用于数据，我们需要看看历史。

软件工程学科在 20 世纪 60 年代首次得到认可。当时，认为创造软件的行为是一种工程形式的想法是一种挑衅性的想法。事实上，术语“软件工程”是有意选择的，目的是让人们停下来，并鼓励从业者将科学原理应用到他们的工作中。在接下来的几十年里，软件工程师测试并提炼了应用科学和机械工程的原理。

(查看[这篇普林斯顿的文章](https://www.princeton.edu/~hos/Mahoney/articles/finding/finding.html)，了解所有这些大胆主张的更多细节。)

然后，在 20 世纪 90 年代，该行业落后于日益增长的软件需求，导致了众所周知的“应用程序开发危机”[危机鼓励软件工程师采用*敏捷开发*和相关实践。这意味着优先考虑一个快速的生命周期，迭代，并为软件背后的人类系统赋予价值。](https://techbeacon.com/app-dev-testing/agility-beyond-history-legacy-agile-development)

另一方面，我们所知的数据工程是一个相对年轻的领域。当然，[数据在人类历史的大部分时间里就已经存在，关系数据库是在 20 世纪 70 年代创建的。但直到 2000 年，数据库还只是由一小部分管理人员(通常是 IT 人员)管理。数据基础设施作为具有许多组件的企业级资源是一个相对较新的发展(更不用说它仍在快速变化中)。而职位名称“数据工程师”](https://medium.com/@eczachly/data-data-engineering-the-past-present-and-future-ac3ad5795ddf)[起源于 2010 年代。](https://quanthub.com/what-is-data-engineering/#:~:text=Around%202011%20the%20term%20%E2%80%9CData,the%20data%20quickly%20and%20correctly.)

简而言之，软件工程师已经做了大约 60 年的工作，至少大体上类似于他们今天仍然在做的事情。在那段时间里，他们解决了很多问题。数据工程界可以利用这一点。

话不多说，这里有一些你可以(也应该)应用到数据管道的软件工程最佳实践。

# 1 —设置(短)生命周期

产品(软件或数据)的生命周期是一个循环过程，包括规划、构建、记录、测试、部署和维护。

敏捷软件开发通过缩短开发生命周期来扭转这一局面，以便在满足需求的同时继续迭代和改进产品。

同样，您可以——也应该——为您的数据管道实现快速的生命周期。

整个组织对新数据产品的需求将会快速而频繁地增长。确保您已准备好开始您的生命周期工作流程。

*   **与利益相关者一起制定**计划，以确保你的管道将交付所需的产品。
*   **构建**管道——根据平台和接口的不同，你可以编写一个规范或者创建一个 DAG。
*   **文档**管道——这可能包括模式、元数据或书面文档( [dbt 文档](https://docs.getdbt.com/docs/building-a-dbt-project/documentation)是一个有趣的例子，尽管在数据堆栈的不同部分)。
*   **在部署之前测试**管道——管道工具可能有内置测试，或者您可以编写自己的测试。
*   **部署**管线。
*   **监控**it——注意错误警报并进行更新。
*   **随着用例的变化快速迭代**——继续在以前的管道上构建并回收组件。

将敏捷开发方法集成到数据中的概念是 DataOps 框架的一个重要组成部分。查看我关于这个主题的整篇文章。

# 2-选择正确的抽象层次

为了保持您的数据生命周期紧凑，不要迷失在技术实现细节中是很重要的。这需要抽象。

软件工程师对抽象的概念相当熟悉。抽象是将信息简化成更一般的对象或系统。也可以认为是泛化或者建模。

在软件工程中，相关的抽象层次通常存在于代码本身中。例如，函数或面向对象的编程语言是有用的工具，但是它们没有揭示它们是如何执行的细节。

在数据方面，你需要使用比代码更高的抽象层次。这有两个主要原因:

*   数据产品和它们所服务的业务用例之间的直接联系意味着你会想用更“真实”的术语来谈论数据。搞清楚这个抽象层次意味着建立一个[通用语义层](https://www.atscale.com/blog/what-is-a-semantic-layer-why-would-i-want-one/)——并且有助于避免在不同的 BI 工具和用户组中出现多个、冲突的语义层的常见问题。
*   你会在数据利益相关者中发现更广泛的技术层次，这意味着谈论一些高度技术性的东西，比如代码，不是很有用。

对于数据管道，两个相关的抽象是从一个系统获取数据并将其推送到另一个系统的行为(在河口，我们使用术语*捕获*和*具体化*，但语义会有所不同)。

当我们使用“捕获”和“具体化”这样的术语来谈论管道时，工程师和业务用户都能够围绕管道的语义值团结起来(它从系统 X 获得数据到系统 Y，以便我们可以做 Z)。

# 3 —创建声明性数据产品

好吧，你抓到我了，这真的只是抽象讨论的延续，但它会给那个讨论更多的实质内容。

让我们考虑将*数据作为一种产品的想法。这是流行的[数据网格](/this-article-wont-tell-you-how-to-build-a-data-mesh-f2f35428be3d)框架的核心原则。*

*数据即产品*归公司内的不同领域所有:拥有不同技能但共享数据运营用例的团队。*数据即产品*可以快速转化为多种形式的可交付成果，但*始终由*用例驱动。换句话说:它们是关于*什么*而不是*如何。*

与此平行的软件工程是[声明式编程。](https://dev.to/ruizb/declarative-vs-imperative-4a7l)声明式编程关注*程序能做什么*。这与命令式编程相反，命令式编程确切地说明了任务应该如何执行。

声明式编程是命令式编程之上的一种抽象:在运行时，当程序被编译时，它必须决定如何进行。但是声明式编程在运行时允许更多的灵活性，潜在地节省了资源。此外，它更容易在精神上保持控制，使其更加平易近人。

通过使您的管道具有声明性——首先基于它们的功能而不是它们的机制来构建——您将能够更好地支持数据即产品文化。

你将从管道要交付的产品开始；比方说，一个特定的物化视图，并在此基础上设计管道。管道化的声明性方法使人们更难迷失在技术细节中，忘记数据的商业价值。

# 4 —防止故障

无论是软件开发还是数据管道，失败都是不可避免的。这是我们许多人从惨痛的教训中学到的:匆忙修复灾难性崩溃的系统，因停机而丢失进度或数据，或者只是允许一个愚蠢的错误进入生产。

您可以也应该在软件和数据环境中应用非常相似的预防和备份措施。

以下是一些重要的考虑事项。这些功能中有许多可以通过[数据编排工具](https://airbyte.com/blog/data-orchestration-trends)或者通过管道供应商提供的工具来实现。

# 测试

这应该是管道生命周期的一部分，就像在软件中一样。

除了在部署之前进行全面的手动测试之外，您还应该编写自动化的单元测试来关注生产中的管道。

如何编写这些依赖于您的平台以及您必须如何与它交互。例如，如果你为你的管道使用气流，你将[创建 Python 脚本](https://levelup.gitconnected.com/airflow-unit-testing-for-bug-free-data-pipeline-d96f87a3cc8f)来测试它们。或者，你可能更喜欢或要求[一个更强大的监控设置](https://www.montecarlodata.com/blog-what-is-data-testing/)来捕捉所有潜在的问题。

根据经验，数据管道应用的转换越多，需要的测试就越多。

# 版本控制

软件工程师使用版本控制(通常是 Git)来协作工作，并保留将软件回滚到以前版本的能力。

如果您使用供应商的产品，它可能会提供 GitOps 工作流，这意味着工程师可以在他们喜欢的开发环境中使用 Git 在管道上进行协作。然而，并不是所有人都这样。

即使您不能将 Git 用于您数据基础设施，您的供应商也会启用一些选项来备份您的管道，所以一定要充分利用这个功能。

# 分布式存储和回填能力

云托管和存储的出现降低了停机和数据丢失的风险，但这种风险并没有消失。

你的数据基础设施应该是[分布式](https://www.confluent.io/learn/distributed-systems/)；也就是说，不同的组件应该分布在不同的服务器上，使其具有容错能力。您对此的控制程度取决于您选择的云提供商和供应商。

# 总是迭代

软件工程最佳实践的最后一课是:当某些东西不起作用时，迭代。

现状和最佳实践总是在不断变化。这适用于软件工程，当然也适用于数据工程。

最好的方法总是经过深思熟虑的，安全地引入变化，并包括所有利益相关者的认同。

从这些原则开始，用它们来适应你的数据团队的系统和文化。注意积极的效果和需要改进的地方，并从那里开始。

*本文改编自* [*河口博客*](https://www.estuary.dev/blogs/) *。你可以在*[*LinkedIn*](https://www.linkedin.com/company/estuary-tech/)*上找到我们的团队，在*[*GitHub*](https://github.com/estuary/flow)*上找到我们的代码。*