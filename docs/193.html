<html>
<head>
<title>How to Convert a Shapefile to a DataFrame in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中将Shapefile转换为DataFrame</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-convert-a-shapefile-to-a-dataframe-in-python-a6ca9a893504#2022-01-07">https://towardsdatascience.com/how-to-convert-a-shapefile-to-a-dataframe-in-python-a6ca9a893504#2022-01-07</a></blockquote><div><div class="fc ik il im in io"/><div class="ip iq ir is it"><h2 id="2138" class="iu iv iw bd b dl ix iy iz ja jb jc dk jd translated" aria-label="kicker paragraph">数据操作</h2><div class=""><h1 id="4e30" class="pw-post-title je jf iw bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">如何在Python中将Shapefile转换为DataFrame</h1></div><div class=""><h2 id="b4b7" class="pw-subtitle-paragraph kc jf iw bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">GeoPandas Python库概述，附带一个分步示例</h2></div><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj ku"><img src="../Images/75f8d4f939a9a7107665824bdffbac11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6kkluDdFOO8jdVb0"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">由<a class="ae lk" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae lk" href="https://unsplash.com/@geojango_maps?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> GeoJango Maps </a>拍摄</p></figure><p id="444c" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">数据科学应用程序通常需要处理地理空间中数据。Shapefiles是存储使用基于文件的数据库组织的地理空间数据的文件。GIS专业人员、地方政府机构和企业使用Shapefiles进行制图和分析。</p><p id="946e" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">在这篇博文中，我将通过一个实际的例子描述一种用Python处理地理空间数据的优雅方式。我将使用<a class="ae lk" href="https://geopandas.org/en/stable/index.html" rel="noopener ugc nofollow" target="_blank"> GeoPandas </a>，这是一个Python库，用于处理地理空间数据，如绘图、分析和绘图。GeoPandas扩展了如此受欢迎的Pandas库来处理地理数据。我还将看看如何使用<code class="fe mh mi mj mk b">matplotlib</code>绘制结果。</p><p id="b2bd" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">可以通过以下命令安装GeoPandas:</p><pre class="kv kw kx ky gu ml mk mm mn aw mo bi"><span id="dbf2" class="mp mq iw mk b gz mr ms l mt mu">pip3 install geopandas</span></pre><p id="5ec2" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">本教程组织如下:</p><ul class=""><li id="4861" class="mv mw iw ln b lo lp lr ls lu mx ly my mc mz mg na nb nc nd bi translated">加载数据集</li><li id="0016" class="mv mw iw ln b lo ne lr nf lu ng ly nh mc ni mg na nb nc nd bi translated">绘图数据</li><li id="9273" class="mv mw iw ln b lo ne lr nf lu ng ly nh mc ni mg na nb nc nd bi translated">几何上的操作</li></ul><h1 id="2ff5" class="nj mq iw bd nk nl nm nn no np nq nr ns kl nt km nu ko nv kp nw kr nx ks ny nz bi translated">加载数据集</h1><p id="ca7c" class="pw-post-body-paragraph ll lm iw ln b lo oa kg lq lr ob kj lt lu oc lw lx ly od ma mb mc oe me mf mg ip bi translated">要加载地理数据集，我可以利用<code class="fe mh mi mj mk b">read_file()</code>函数，它会自动检测数据集的格式。如果文件是shapefile，我应该确保包含shapefile的文件夹也包含。prj，。dbf，还有。shx文件。</p><p id="aed3" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">在本教程中，我利用了由<a class="ae lk" href="https://mapcruzin.com/free-italy-arcgis-maps-shapefiles.htm" rel="noopener ugc nofollow" target="_blank"> Map Cruzin </a>提供的包含意大利兴趣点的数据集。这个shapefile来源于<a class="ae lk" href="https://www.openstreetmap.org/" rel="noopener ugc nofollow" target="_blank">OpenStreetMap.org</a>，并在<a class="ae lk" href="https://opendatacommons.org/licenses/odbl/" rel="noopener ugc nofollow" target="_blank">开放数据公共开放数据库许可</a> (ODbL)下获得许可。</p><pre class="kv kw kx ky gu ml mk mm mn aw mo bi"><span id="32b2" class="mp mq iw mk b gz mr ms l mt mu"><strong class="mk jg">import</strong> geopandas <strong class="mk jg">as</strong> gpd</span><span id="bded" class="mp mq iw mk b gz of ms l mt mu">df <strong class="mk jg">=</strong> gpd.read_file('../../Datasets/italy-points-shape/points.shp')<br/>df.head()</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj og"><img src="../Images/ee01027e6cd421a04c2c9e23cc9d515f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XPOTLYHBzrnV44HU9sMeCg.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="6581" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">几何字段可能包含点、多线、多边形等。数据集可能包含多个几何字段，但只能将一个几何字段设置为活动的。这可以通过<code class="fe mh mi mj mk b">set_geometry()</code>功能来完成。</p><pre class="kv kw kx ky gu ml mk mm mn aw mo bi"><span id="2fc4" class="mp mq iw mk b gz mr ms l mt mu">df <strong class="mk jg">=</strong> df.set_geometry('geometry')</span></pre><p id="af45" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">该文件作为GeoPandas数据帧加载。因为GeoPandas数据帧是Pandas数据帧的子类，所以我可以对我的GeoPandas数据帧使用Pandas数据帧的所有方法。例如，我可以通过<code class="fe mh mi mj mk b">shape</code>属性显示记录的数量:</p><pre class="kv kw kx ky gu ml mk mm mn aw mo bi"><span id="820e" class="mp mq iw mk b gz mr ms l mt mu">df.shape</span></pre><p id="01e1" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">该数据集包含47，427个文件。</p><h1 id="3039" class="nj mq iw bd nk nl nm nn no np nq nr ns kl nt km nu ko nv kp nw kr nx ks ny nz bi translated">绘图数据</h1><p id="de5a" class="pw-post-body-paragraph ll lm iw ln b lo oa kg lq lr ob kj lt lu oc lw lx ly od ma mb mc oe me mf mg ip bi translated">我可以绘制第一张地图，通过GeoPandas提供的<code class="fe mh mi mj mk b">plot()</code>功能。如果一个文件包含多个几何图形</p><pre class="kv kw kx ky gu ml mk mm mn aw mo bi"><span id="bf5f" class="mp mq iw mk b gz mr ms l mt mu">df.plot()</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj oh"><img src="../Images/dd82aa7899c6823b32b217054a7058a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*IR1_NhzsIQOzGTTTNRr74A.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="957c" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">以前的地图太小，因此可以使用<code class="fe mh mi mj mk b">matplotlib</code>进行改进。首先，我可以增加体型。我定义了一个具有所需大小的<code class="fe mh mi mj mk b">subplot()</code>，然后将<code class="fe mh mi mj mk b">ax</code>变量传递给地理数据框架图:</p><pre class="kv kw kx ky gu ml mk mm mn aw mo bi"><span id="0e94" class="mp mq iw mk b gz mr ms l mt mu">import matplotlib.pyplot as plt</span><span id="3057" class="mp mq iw mk b gz of ms l mt mu">fig, ax = plt.subplots(1, 1, figsize=(15, 15))<br/>df.plot(ax=ax)</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj oi"><img src="../Images/0b1dfac428dd333c5a744ba97c878412.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*prvjUlKeGgl3HpEO7x9m-Q.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="8f1a" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我也可以根据类型栏改变点的颜色。这种类型的图称为Chorophlet图。我计算了不同类型的数量:</p><pre class="kv kw kx ky gu ml mk mm mn aw mo bi"><span id="4a12" class="mp mq iw mk b gz mr ms l mt mu">len(df['type'].value_counts())</span></pre><p id="554c" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">有301种不同的类型。为了提高地图的可读性，我删除了点数小于300的类型。</p><pre class="kv kw kx ky gu ml mk mm mn aw mo bi"><span id="2d02" class="mp mq iw mk b gz mr ms l mt mu">target_types = df[‘type’].value_counts() &gt; 300 tc = target_types[target_types == True].index</span><span id="c16f" class="mp mq iw mk b gz of ms l mt mu"><strong class="mk jg">def</strong> myfilter(x):<br/>    <strong class="mk jg">return</strong> x <strong class="mk jg">in</strong> tc</span><span id="f7ff" class="mp mq iw mk b gz of ms l mt mu">df['delete'] <strong class="mk jg">=</strong> df['type'].apply(<strong class="mk jg">lambda</strong> x: myfilter(x))<br/>df <strong class="mk jg">=</strong> df[df['delete']]</span></pre><p id="500b" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">现在我检查剩余类型的数量</p><pre class="kv kw kx ky gu ml mk mm mn aw mo bi"><span id="6b81" class="mp mq iw mk b gz mr ms l mt mu">len(df['type'].value_counts())</span></pre><p id="134c" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">有26种类型。</p><p id="74b1" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">现在，我简单地通过将<code class="fe mh mi mj mk b">column</code>属性传递给<code class="fe mh mi mj mk b">plot()</code>函数来绘制Chorophlet地图。我可以通过设置<code class="fe mh mi mj mk b">legend=True</code>来显示图例。</p><pre class="kv kw kx ky gu ml mk mm mn aw mo bi"><span id="556c" class="mp mq iw mk b gz mr ms l mt mu">fig, ax <strong class="mk jg">=</strong> plt.subplots(1, 1, figsize<strong class="mk jg">=</strong>(15, 15))<br/>df.plot(ax<strong class="mk jg">=</strong>ax, column<strong class="mk jg">=</strong>'type', legend<strong class="mk jg">=True</strong>, cmap<strong class="mk jg">=</strong>'viridis')</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj oj"><img src="../Images/4690fb9298eb6567bcc4802d69ab770d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xytuKwsvyRPOoReLZ520-Q.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="1d5f" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">有趣的是，大多数景点都位于意大利北部。</p><h1 id="1995" class="nj mq iw bd nk nl nm nn no np nq nr ns kl nt km nu ko nv kp nw kr nx ks ny nz bi translated">几何上的操作</h1><p id="fef3" class="pw-post-body-paragraph ll lm iw ln b lo oa kg lq lr ob kj lt lu oc lw lx ly od ma mb mc oe me mf mg ip bi translated">GeoPandas允许直接在几何域上进行许多操作。例如，我可以计算出每个点离给定点的距离，即意大利首都罗马。我通过<code class="fe mh mi mj mk b">points_from_xy()</code>函数将坐标转换成几何图形:</p><pre class="kv kw kx ky gu ml mk mm mn aw mo bi"><span id="8c49" class="mp mq iw mk b gz mr ms l mt mu">rome_longitude <strong class="mk jg">=</strong> [12.496365]<br/>rome_latitude <strong class="mk jg">=</strong> [41.902782]<br/>rome_point <strong class="mk jg">=</strong> gpd.points_from_xy(rome_longitude,rome_latitude)</span></pre><p id="a6c7" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">然后，我计算<code class="fe mh mi mj mk b">df</code>中每个点离<code class="fe mh mi mj mk b">rome_point</code>的距离。我使用<code class="fe mh mi mj mk b">distance()</code>功能，该功能应用于活动几何图形:</p><pre class="kv kw kx ky gu ml mk mm mn aw mo bi"><span id="1b50" class="mp mq iw mk b gz mr ms l mt mu">df['distance'] <strong class="mk jg">=</strong> df['geometry'].distance(rome_point[0])</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj ok"><img src="../Images/90cc9357bffb379f156c683405ee04df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K92mb6mavIyzeCqH78ysfg.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="ef8a" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我通过增加距离对数据集进行排序</p><pre class="kv kw kx ky gu ml mk mm mn aw mo bi"><span id="c744" class="mp mq iw mk b gz mr ms l mt mu">df <strong class="mk jg">=</strong> df.sort_values(by<strong class="mk jg">=</strong>'distance', ascending<strong class="mk jg">=True</strong>)</span></pre><p id="5c7e" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">最后，我只选择罗马附近的兴趣点，即距离小于0.2</p><pre class="kv kw kx ky gu ml mk mm mn aw mo bi"><span id="e200" class="mp mq iw mk b gz mr ms l mt mu">df_rome <strong class="mk jg">=</strong> df[df['distance'] <strong class="mk jg">&lt;</strong> 0.2]</span></pre><p id="daee" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">然后，我绘制出最终的数据帧:</p><pre class="kv kw kx ky gu ml mk mm mn aw mo bi"><span id="9a06" class="mp mq iw mk b gz mr ms l mt mu">fig, ax <strong class="mk jg">=</strong> plt.subplots(1, 1, figsize<strong class="mk jg">=</strong>(15, 15))<br/>df_rome.plot(ax<strong class="mk jg">=</strong>ax, column<strong class="mk jg">=</strong>'type', legend<strong class="mk jg">=True</strong>, cmap<strong class="mk jg">=</strong>'viridis')</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj ol"><img src="../Images/b307cfc77636ea8a86ed24c7284b99ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*EyvBeioK2YIjckee9xDZtQ.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><h1 id="8dab" class="nj mq iw bd nk nl nm nn no np nq nr ns kl nt km nu ko nv kp nw kr nx ks ny nz bi translated">摘要</h1><p id="517b" class="pw-post-body-paragraph ll lm iw ln b lo oa kg lq lr ob kj lt lu oc lw lx ly od ma mb mc oe me mf mg ip bi translated">恭喜你！您刚刚学习了如何通过GeoPandas用Python表示地理数据！</p><p id="195f" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">您已经了解了如何使用GeoPandas对地理数据执行高效操作。尽管Pandas在许多任务上表现出色，但它并不适合在位置感知应用程序中处理地理空间数据。GeoPandas通过向Pandas添加非常适合地理空间数据的功能来解决这个问题。</p><p id="ca24" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">你可以从我的<a class="ae lk" href="https://github.com/alod83/data-science/blob/master/Preprocessing/GeoPandas/GeoPandas.ipynb" rel="noopener ugc nofollow" target="_blank"> Github库</a>下载本教程的代码。</p><p id="dca9" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">如果你已经走了这么远来阅读，对我来说今天已经很多了。谢谢！你可以在<a class="ae lk" href="https://alod83.medium.com/which-topics-would-you-like-to-read-c68314dc6813" rel="noopener">这篇文章</a>中读到更多关于我的信息。</p><h1 id="209c" class="nj mq iw bd nk nl nm nn no np nq nr ns kl nt km nu ko nv kp nw kr nx ks ny nz bi translated">相关文章</h1><div class="om on gq gs oo op"><a rel="noopener follow" target="_blank" href="/how-to-manipulate-a-pandas-dataframe-in-sql-7d1a1503f47"><div class="oq ab fp"><div class="or ab os cl cj ot"><h2 class="bd jg gz z fq ou fs ft ov fv fx jf bi translated">如何在SQL中操作熊猫数据帧</h2><div class="ow l"><h3 class="bd b gz z fq ou fs ft ov fv fx dk translated">这是一个现成的代码，包含一些使用SQL查询操作Python Pandas数据框架的技巧。</h3></div><div class="ox l"><p class="bd b dl z fq ou fs ft ov fv fx dk translated">towardsdatascience.com</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd le op"/></div></div></a></div><div class="om on gq gs oo op"><a rel="noopener follow" target="_blank" href="/how-to-anonymise-places-in-python-55597d0ded24"><div class="oq ab fp"><div class="or ab os cl cj ot"><h2 class="bd jg gz z fq ou fs ft ov fv fx jf bi translated">如何在Python中匿名化地点</h2><div class="ow l"><h3 class="bd b gz z fq ou fs ft ov fv fx dk translated">一个现成的代码，根据地名数据库识别和隐藏地点</h3></div><div class="ox l"><p class="bd b dl z fq ou fs ft ov fv fx dk translated">towardsdatascience.com</p></div></div><div class="oy l"><div class="pe l pa pb pc oy pd le op"/></div></div></a></div><div class="om on gq gs oo op"><a rel="noopener follow" target="_blank" href="/how-to-transform-data-extracted-from-wikipedia-into-a-map-in-python-8325dce0710b"><div class="oq ab fp"><div class="or ab os cl cj ot"><h2 class="bd jg gz z fq ou fs ft ov fv fx jf bi translated">如何将从维基百科提取的数据转换成Python中的地图</h2><div class="ow l"><h3 class="bd b gz z fq ou fs ft ov fv fx dk translated">一个现成的代码，可以通过Selenium、GeoPy和leav在从维基百科提取的条目列表上创建一个地图</h3></div><div class="ox l"><p class="bd b dl z fq ou fs ft ov fv fx dk translated">towardsdatascience.com</p></div></div><div class="oy l"><div class="pf l pa pb pc oy pd le op"/></div></div></a></div><div class="om on gq gs oo op"><a rel="noopener follow" target="_blank" href="/deepnote-a-collaborative-framework-for-your-python-notebooks-99390a6766e9"><div class="oq ab fp"><div class="or ab os cl cj ot"><h2 class="bd jg gz z fq ou fs ft ov fv fx jf bi translated">deep note:Python笔记本的协作框架</h2><div class="ow l"><h3 class="bd b gz z fq ou fs ft ov fv fx dk translated">Deepnote入门</h3></div><div class="ox l"><p class="bd b dl z fq ou fs ft ov fv fx dk translated">towardsdatascience.com</p></div></div><div class="oy l"><div class="pg l pa pb pc oy pd le op"/></div></div></a></div></div></div>    
</body>
</html>