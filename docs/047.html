<html>
<head>
<title>Notes about the Box-Cox Transformations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于Box-Cox变换的注记</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/notes-about-the-box-cox-transformations-18d7cd594265#2022-01-03">https://towardsdatascience.com/notes-about-the-box-cox-transformations-18d7cd594265#2022-01-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""><h1 id="367c" class="pw-post-title ir is it bd iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp bi translated">关于Box-Cox变换的注记</h1></div><div class=""><h2 id="9139" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">经过一些测试，这里是我能提供的最好的结果</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2a874d0d737a5737ce329d09cf8e8ea8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M0dWzRRvQX8Lpoz9uA8CMg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">法比安·金特罗在<a class="ae ky" href="https://unsplash.com/s/photos/bell-curve?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h2 id="935c" class="lg lh it bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">Box-Cox变换</h2><p id="2c25" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk lp ml mm mn lt mo mp mq lx mr ms mt mu im bi translated">这篇文章以一个有趣的故事开始。博克斯-考克斯变换是由两位统计学家创造的:乔治<strong class="me iu">博克斯</strong>和大卫<strong class="me iu">考克斯爵士。他们曾经见过面，并同意一起写一篇论文，因为他们觉得有趣的是，他们的名字听起来很相似，就像押韵一样。对我们来说幸运的是，它赋予了他们转换数据的公式以生命。</strong></p><p id="c7c1" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">好吧，撇开好奇不谈，Box-Cox实际上是幂变换，其目标是稳定方差，并使您的数据更像众所周知的钟形<strong class="me iu">正态分布。</strong></p><blockquote class="na"><p id="fa8d" class="nb nc it bd nd ne nf ng nh ni nj mu dk translated">Box-Cox变换会改变数据的形状，使其更接近正态分布。</p></blockquote><p id="5b6b" class="pw-post-body-paragraph mc md it me b mf nk ju mh mi nl jx mk lp nm mm mn lt nn mp mq lx no ms mt mu im bi translated">如果你有兴趣深化你的知识，了解这背后的数学，我在这篇文章的结尾留下了几个链接供参考。</p><h2 id="15c5" class="lg lh it bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">我为什么要在乎？</h2><p id="ce94" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk lp ml mm mn lt mo mp mq lx mr ms mt mu im bi translated">我一直在研究和学习我能用这个有趣的工具做什么。</p><p id="f0f6" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">相信你知道什么是正态分布，它给我们带来的好处是什么。许多统计测试和理论坚定地依赖于正态分布的假设，其中最著名的是置信区间和假设检验。</p><p id="7a92" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">因此，如果你有一个非正态分布的数据，你就失去了这些好处。</p><p id="f352" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">让我们看看这个例子。我有一个汽车价格数据集<em class="np">(不，不是mtcars数据集……)。</em>如果我绘制直方图和QQ图，我会发现这不是一条正常曲线。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="a52b" class="lg lh it nr b gy nv nw l nx ny"># Creating a subplot grid<br/>fig , g = plt.subplots(1,2, figsize=(18,6))</span><span id="0cf8" class="lg lh it nr b gy nz nw l nx ny">#Plot 1 = Histogram<br/>g1 = sns.histplot(data=df, x='Price_in_thousands', ax=g[0]);</span><span id="cacf" class="lg lh it nr b gy nz nw l nx ny"># Plot2 - QQPlot<br/>g2 = scs.probplot(df.Price_in_thousands, dist='norm', plot=plt)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/8cc864f86ea43947d8e7585673b62273.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2rdguJ0JmQJdSmQNxUrdSA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">直方图和QQ图—价格。图片由作者提供。</p></figure><p id="1402" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">现在让我们检查它的统计描述。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="469d" class="lg lh it nr b gy nv nw l nx ny">df[['Price_in_thousands']].describe().round(2).T</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/2c4a2d1cb06fb405ede81be37548d21d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*jglcqbzc_VQYU9nKg18R4A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。</p></figure><p id="c1d9" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">好的。现在，如果这条曲线遵循正态分布，我们可以很容易地看出，68%的值或多或少都在一个标准偏差内。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="4fc0" class="lg lh it nr b gy nv nw l nx ny"># Values within + or - 1 std from the mean divided by the number of rows</span><span id="5a1c" class="lg lh it nr b gy nz nw l nx ny">df[df['Price_in_thousands'].between( 25.97 - 14.15, 25.97 + 14.15 )]['Price_in_thousands'].count()/ df.shape[0]</span><span id="f591" class="lg lh it nr b gy nz nw l nx ny"><strong class="nr iu">[OUT]:</strong><br/>0.8461538461538461</span></pre><p id="fd6e" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">看吧。我们有84%的数据在1个标准偏差内。但是如果我们对数据使用来自<code class="fe oc od oe nr b">scipy</code>的Box-Cox变换，看看接下来会发生什么。还要注意，<code class="fe oc od oe nr b">boxcox()</code>函数返回转换后的数据和<code class="fe oc od oe nr b">lambda</code>数。λ是一个最佳估计值，它使数据成为一个像集合一样的正态分布，这在以后会很有用。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="d656" class="lg lh it nr b gy nv nw l nx ny"># Import library<br/>import scipy.stats as scs</span><span id="491f" class="lg lh it nr b gy nz nw l nx ny"># Transformation Box-Cox<br/>fit_price, lam = scs.boxcox(df['Price_in_thousands'])</span><span id="ab6a" class="lg lh it nr b gy nz nw l nx ny"># Create the plot grid<br/>fig , g = plt.subplots(1,2, figsize=(18,6))</span><span id="1d86" class="lg lh it nr b gy nz nw l nx ny"># Histogram<br/>g1 = sns.histplot(fit_price, ax=g[0]);</span><span id="7110" class="lg lh it nr b gy nz nw l nx ny"># QQPlot<br/>g2 = scs.probplot(fit_price, dist='norm', plot=plt);</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/cceb1eb33465b9df12b2a03d0f70dbb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7JIZgIWioZxXYiOqJVujXA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">转换成类似正态分布的数据。图片由作者提供。</p></figure><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="4460" class="lg lh it nr b gy nv nw l nx ny"># Stats<br/>pd.DataFrame(fit_price).describe().round(2).T</span><span id="de26" class="lg lh it nr b gy nz nw l nx ny"><strong class="nr iu">[OUT]:</strong><br/>count | mean |  std |  min  | 25%  | 50%  | 75%  | max<br/>117.0 | 1.62 |  0.1 |  1.37 | 1.55 | 1.61 | 1.68 | 1.84</span></pre><p id="4316" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">看看现在多好。曲线呈钟形，QQ图几乎完全位于红线上方。</p><p id="501e" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">让我们检查一下68%的数据是否在平均值的正负1个标准差范围内。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="fa9c" class="lg lh it nr b gy nv nw l nx ny"># Create a dataframe object with the fitted price<br/>dff = pd.DataFrame(fit_price, columns=['fitted_price'])</span><span id="1026" class="lg lh it nr b gy nz nw l nx ny"># Calculate percentage data within 1 std divided by total rows.<br/>dff[dff.fitted_price.between( 1.62  - 0.1, 1.62 + 0.1 )].count()/ dff.shape[0]</span><span id="6c5b" class="lg lh it nr b gy nz nw l nx ny"><strong class="nr iu">[OUT]:</strong><br/>fitted_price    0.675214 <br/>dtype: float64</span></pre><p id="e9cd" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">哇！就在现场！是68%。</p><h2 id="64c6" class="lg lh it bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">置信区间</h2><p id="a55e" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk lp ml mm mn lt mo mp mq lx mr ms mt mu im bi translated">从正态分布来看，计算置信区间变得更加容易。如果我们知道95%的数据都在2个标准偏差以内，那么我们就可以考虑这些范围内的数据。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="0386" class="lg lh it nr b gy nv nw l nx ny"># Confidence Interval 95%<br/>upper = 1.62 + 0.2<br/>lower = 1.62 - 0.2</span><span id="fd5e" class="lg lh it nr b gy nz nw l nx ny">print(f'The confidence interval for 95% level is between {round(lower,2)} and {upper}.')</span><span id="0f91" class="lg lh it nr b gy nz nw l nx ny"><strong class="nr iu">[OUT]:</strong> <br/>The confidence interval for 95% level is between 1.42 and 1.82.</span></pre><p id="4e2f" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">然而，我们不能忘记价值观是变化的。那么，现在怎么办？</p><p id="de5d" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">来自<code class="fe oc od oe nr b">scipy</code>的另一个好工具是逆Box-Cox操作。为了使用它，您必须导入<code class="fe oc od oe nr b">from scipy.special import inv_boxcox</code>。然后，请注意，当我们转换数据时，我们找到了最佳的λ。现在是使用它进行逆运算的时候了。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="9333" class="lg lh it nr b gy nv nw l nx ny"># Import the inverse Box-Cox<br/>from scipy.special import inv_boxcox</span><span id="e245" class="lg lh it nr b gy nz nw l nx ny"># Apply the inversion using the lambda value found on the prior transformation<br/>upper_invert = inv_boxcox(upper, lam)<br/>lower_invert = inv_boxcox(lower, lam)</span><span id="1c15" class="lg lh it nr b gy nz nw l nx ny"># Print the result<br/>print(f'The confidence interval for 95% level is between {round(lower_invert,2)} and { round(upper_invert,2) }.')</span><span id="92df" class="lg lh it nr b gy nz nw l nx ny"><strong class="nr iu">[OUT]:</strong><br/>The confidence interval for 95% level is between 10.74 and 70.86.</span></pre><h2 id="c30a" class="lg lh it bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">最后的想法</h2><p id="99fc" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk lp ml mm mn lt mo mp mq lx mr ms mt mu im bi translated">我测试了Box-Cox变换的其他用途。例如，如果我们在运行线性回归模型之前将数据转换为正态分布是否有用？</p><p id="4709" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">我的测试在那方面没有结论。我发现有时使用它是有用的，但是转换并不是对所有情况都有效。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/d9fd6d6da1841d1503ff91c51e573be2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ySiNwX-d6A9oBEf1b8T25Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">价格和独立变量之间的线性关系。图片由作者提供。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/31fda776593eb7e23e64e925a3912a36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6-jrRkEW5ae6ojGaac5hzA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">转换价格和转换自变量之间的线性关系。图片由作者提供。</p></figure><p id="2e0f" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">对于上面的数据集，我创建了两个模型。没有转换数据的第一个仍然比有转换变量的第二个好。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/5a1ccedf58a5a1c370f63b833e2e42e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/1*y_Y7cPkOCZRRcswetP9_VA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">比较模型1和模型2。图片由作者提供。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/a22357525238ba95ce3c3c18c532b83c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mYhdIs3FckT1pgJOxza5Ww.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">比较模型1和模型2。图片由作者提供。</p></figure><p id="e723" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">我看不出应用这些转换有什么不同。</p><p id="ba17" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">我相信，当数据呈指数增长时，它可能会更有帮助，而且我们能够通过转换将数据<em class="np">线性化。一些论文说，线性回归的转换——当需要时——必须从因变量开始，如果不够，那么尝试转换自变量。</em></p><h2 id="7b00" class="lg lh it bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">在你走之前</h2><p id="e60d" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk lp ml mm mn lt mo mp mq lx mr ms mt mu im bi translated">这些是我关于Box-Cox变换的笔记。</p><ul class=""><li id="7d91" class="ok ol it me b mf mv mi mw lp om lt on lx oo mu op oq or os bi translated">它们是<em class="np">功率变换，</em>意味着将有一个功率因数λ应用于数据以对其进行变换。</li><li id="00e5" class="ok ol it me b mf ot mi ou lp ov lt ow lx ox mu op oq or os bi translated">应用Box-Cox后，数据的形状发生了变化。</li><li id="687a" class="ok ol it me b mf ot mi ou lp ov lt ow lx ox mu op oq or os bi translated">数据分布将变得近似正常。</li><li id="7f68" class="ok ol it me b mf ot mi ou lp ov lt ow lx ox mu op oq or os bi translated">你可以利用这一点，比如应用置信区间或假设检验。</li><li id="fdc1" class="ok ol it me b mf ot mi ou lp ov lt ow lx ox mu op oq or os bi translated">用<code class="fe oc od oe nr b">scipy.stats.boxcox()</code>来改造。</li><li id="786f" class="ok ol it me b mf ot mi ou lp ov lt ow lx ox mu op oq or os bi translated">用<code class="fe oc od oe nr b">scipy.special.inv_boxcox()</code>完成转换的逆过程</li><li id="745e" class="ok ol it me b mf ot mi ou lp ov lt ow lx ox mu op oq or os bi translated">我看不出我所做的测试对线性回归有很大的影响。</li></ul><h2 id="113a" class="lg lh it bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">参考</h2><p id="55ba" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk lp ml mm mn lt mo mp mq lx mr ms mt mu im bi translated"><a class="ae ky" href="https://en.wikipedia.org/wiki/Power_transform" rel="noopener ugc nofollow" target="_blank">来自维基百科的Box-Cox变换</a></p><p id="fc19" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">Scipy文档<a class="ae ky" href="https://docs.scipy.org/doc/scipy/reference/reference/generated/scipy.stats.boxcox.html" rel="noopener ugc nofollow" target="_blank"> boxcox </a>和<a class="ae ky" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.special.inv_boxcox.html" rel="noopener ugc nofollow" target="_blank"> inv_boxcox </a></p><p id="1655" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated"><a class="ae ky" href="https://www.statisticshowto.com/box-cox-transformation/" rel="noopener ugc nofollow" target="_blank"> Box-Cox定义</a></p><p id="5ff3" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated"><a class="ae ky" href="https://www.statology.org/box-cox-transformation-python/" rel="noopener ugc nofollow" target="_blank">Python中的Box-Cox</a></p><p id="cb16" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">如果这些内容有用，请关注我。</p><div class="oy oz gp gr pa pb"><a href="https://gustavorsantos.medium.com/" rel="noopener follow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd iu gy z fp pg fr fs ph fu fw is bi translated">古斯塔沃·桑托斯-中等</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">生成词云，快速分析文本中最常用的词。词云是一个众所周知的工具使用的数据…</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">gustavorsantos.medium.com</p></div></div><div class="pk l"><div class="pl l pm pn po pk pp ks pb"/></div></div></a></div></div></div>    
</body>
</html>