<html>
<head>
<title>Create a Location Generator GAN</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建位置生成器GAN</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/create-a-location-generator-gan-33680d81289f#2022-01-19">https://towardsdatascience.com/create-a-location-generator-gan-33680d81289f#2022-01-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""><h1 id="4b3c" class="pw-post-title io ip iq bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">创建位置生成器GAN</h1></div><div class=""><h2 id="6fff" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">根据几个城市的公共位置数据训练一个快速GAN，以预测电动自行车在世界各地的实际位置</h2></div><p id="85f4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本帖中，我们将探索在美国各城市的地图数据和公共电动自行车反馈上训练一个<a class="ae lb" href="https://arxiv.org/pdf/2007.15651" rel="noopener ugc nofollow" target="_blank">捷径</a>生成对抗网络(GAN)模型。然后，我们可以通过为包括东京在内的世界各地的城市创建<a class="ae lb" href="https://gretel.ai/blog/what-is-synthetic-data" rel="noopener ugc nofollow" target="_blank">合成数据集</a>，来测试模型的学习和归纳能力。如果您愿意跟随，请<a class="ae lb" href="https://github.com/gretelai/GAN-location-generator" rel="noopener ugc nofollow" target="_blank">从GitHub克隆示例repo </a>👇并为您自己的城市创建合成位置数据集！</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/055a7cd3acbb003a783c937fad7cd112.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ppqexshlakRFxAKSgOsQlw.jpeg"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">信用:sylv1rob1 via ShutterStock</p></figure><pre class="ld le lf lg gt ls lt lu lv aw lw bi"><span id="7bef" class="lx ly iq lt b gy lz ma l mb mc">git clone <a class="ae lb" href="https://github.com/gretelai/GAN-location-generator.git" rel="noopener ugc nofollow" target="_blank">https://github.com/gretelai/GAN-location-generator.git</a></span></pre><p id="1357" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<a class="ae lb" href="https://gretel.ai/blog/using-generative-differentially-private-models-to-build-privacy-enhancing-synthetic-datasets-from-real-data" rel="noopener ugc nofollow" target="_blank">之前的一篇博客</a>中，我们训练了一个<a class="ae lb" href="https://github.com/gretelai/gretel-synthetics" rel="noopener ugc nofollow" target="_blank">基于LSTM的语言模型</a>关于来自电动自行车反馈的精确位置数据，并使用该模型为相同地区(例如加利福尼亚州圣莫尼卡)生成合成的和隐私增强的数据集。通过以不同的方式构建问题并结合地图数据，我们可以<strong class="kh ir">创建一个模型，生成人类可能在世界各地访问的精确位置</strong>。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi md"><img src="../Images/7501b9b52d9ff1ad67cf8985333b4c9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ErnG2svp-XNZKhuDgC_xvQ.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">使用地图数据向地理数据集添加上下文。来源:Gretel.ai</p></figure><h1 id="67d3" class="me ly iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">入门指南</h1><p id="9f42" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">我们可以通过将电动自行车的位置数据作为像素编码到图像中来建模，然后训练为类似于CycleGAN、Pix2pix和<a class="ae lb" href="https://github.com/NVlabs/stylegan" rel="noopener ugc nofollow" target="_blank"> StyleGAN </a>的图像翻译任务。在这篇文章中，我们将使用由pix2pix和CycleGAN的作者创建的较新的<a class="ae lb" href="https://github.com/taesungp/contrastive-unpaired-translation" rel="noopener ugc nofollow" target="_blank">对比不成对翻译</a> (FastCUT)模型，因为它的内存效率高，训练速度快(对高分辨率位置有用)，并且通过最少的参数调整就可以很好地推广。跟随GitHub<a class="ae lb" href="https://github.com/gretelai/GAN-location-generator.git" rel="noopener ugc nofollow" target="_blank">https://github.com/gretelai/GAN-location-generator.git</a>上完整的端到端示例，或者为您自己的城市创建合成位置数据</p><h1 id="4eb1" class="me ly iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">步伐</h1><h2 id="ddfe" class="lx ly iq bd mf na nb dn mj nc nd dp mn ko ne nf mp ks ng nh mr kw ni nj mt nk bi translated"><strong class="ak">模型训练步骤</strong></h2><ol class=""><li id="0796" class="nl nm iq kh b ki mv kl mw ko nn ks no kw np la nq nr ns nt bi translated">从地图上精确的电动自行车位置库创建域名</li><li id="ce84" class="nl nm iq kh b ki nu kl nv ko nw ks nx kw ny la nq nr ns nt bi translated">从相同的地图创建域名，但没有位置</li><li id="4599" class="nl nm iq kh b ki nu kl nv ko nw ks nx kw ny la nq nr ns nt bi translated">翻译域名的培训捷径B →域名</li></ol><h2 id="25fd" class="lx ly iq bd mf na nb dn mj nc nd dp mn ko ne nf mp ks ng nh mr kw ni nj mt nk bi translated"><strong class="ak">合成数据生成步骤</strong></h2><ol class=""><li id="f3d9" class="nl nm iq kh b ki mv kl mw ko nn ks no kw np la nq nr ns nt bi translated">对于目标地理位置，请下载新地图(DomainC)</li><li id="91a7" class="nl nm iq kh b ki nu kl nv ko nw ks nx kw ny la nq nr ns nt bi translated">对捷径模型运行推理以预测指示器位置(translate DomainC-&gt;DomainA)</li><li id="c04f" class="nl nm iq kh b ki nu kl nv ko nw ks nx kw ny la nq nr ns nt bi translated">使用CV处理图像以查找踏板车位置并转换为纬度/LON</li></ol><h1 id="611e" class="me ly iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">创建训练数据集</h1><p id="847b" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">安装完依赖项后，运行<code class="fe nz oa ob lt b">python -m locations.create_training_data</code>创建一对512x512px的地图图像，包括和不包括来自e-bike数据集的位置数据。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi oc"><img src="../Images/5474793145653fe20c451ad1df899567.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qP2Je4Klp4-_5NnoBaH2tg.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">来源:Gretel.ai</p></figure><p id="78ee" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，在数据集上训练我们的模型——本质上是训练捷径模型来预测电动自行车的位置将在哪里得到地图。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="c694" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">快捷模型将数据记录到<a class="ae lb" href="https://github.com/fossasia/visdom" rel="noopener ugc nofollow" target="_blank"> Visdom </a>，这让我们可以监控模型训练。在下图中，我们可以看到模型损失在训练过程中减少，也可以看到图像转换任务的预览。第一个图像是真实的DomainA地图数据，第二个是带有预测的scooter位置(假)的DomainA图像的翻转版本，第三个是真实的DomainB位置。我们可以看到，即使在25个时代之后，该模型也在学习预测什么看起来像合理的踏板车位置——例如，街角和道路沿线。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi of"><img src="../Images/bd73548617c63582465f833ad8e99c66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8JLwGwDpzPRtXg7l5VKcvQ.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">来源:Gretel.ai</p></figure><p id="4d89" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当运行推荐的200个时代时，模型似乎过拟合，预测的踏板车位置从图像中消失。对于这个例子，我在更早的纪元(纪元30)中看到了最好的性能。这是一些模型预测的来自旧金山的真实世界v .合成图像。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi og"><img src="../Images/f622a37320be0a2932b1133e175d6200.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9xkFuOqg_yv8qQd5Wuo2Lw.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">来源:Gretel.ai</p></figure><h1 id="7ea0" class="me ly iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">创建测试数据集</h1><p id="f85e" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">运行以下命令创建东京市区地图位置15x15格网的训练数据集，或修改纬度和经度参数以创建任何地理区域的合成位置。注意，根据快捷python代码的工作方式，我们需要将地图网格图像复制到<code class="fe nz oa ob lt b">testA</code>和<code class="fe nz oa ob lt b">testB</code>目录中。</p><pre class="ld le lf lg gt ls lt lu lv aw lw bi"><span id="466c" class="lx ly iq lt b gy lz ma l mb mc">python -m location_utils.create_test_dataset --lat 35.652832 --lon 139.839478 --name Tokyo</span></pre><p id="9764" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在可以使用我们的模型来处理为上面的网格创建的每个图像，以预测电动自行车在东京的位置。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="6357" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">查看单个图像的结果:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi og"><img src="../Images/f6cd9c086cfe84765f2d574a86eec999.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*huwagriwtyDZDzAsrICsUA.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">东京市中心综合生成的电动自行车位置。来源:Gretel.ai</p></figure><h1 id="ca7a" class="me ly iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">将合成图像转换回坐标</h1><p id="fc68" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">现在，我们的任务是从东京的图像中获取合成的电动自行车，并将它们转换为现实世界的坐标，以建立我们的合成位置数据集。为了提取电动自行车的位置，我们使用OpenCV应用了一个图像蒙版，在图像中搜索任何洋红色像素组。一旦创建了蒙版，我们就可以计算蒙版中任何像素到图像文件名中编码的中心点纬度和经度的距离。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="0f4b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，根据城市在世界上的位置，每个纬度或经度之间的物理距离可能会有很大差异，当将像素映射到位置时，我们需要使用基于椭球的模型来计算精确的偏移。幸运的是，<code class="fe nz oa ob lt b">geopy</code> Python库使这变得容易。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="810d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下图使用了<code class="fe nz oa ob lt b">cv2.imshow()</code>函数来预览蒙版图像，然后我们将蒙版图像转换回经纬度坐标。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi og"><img src="../Images/38b152f9684a7096198086ecabcc8e2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XvVGJgDwP5CcSq3qXim48Q.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">使用OpenCV检测合成图像中的踏板车位置。来源:Gretel.ai</p></figure><h1 id="476e" class="me ly iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">把所有的放在一起</h1><p id="42d8" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">现在，我们可以处理所有图像，并将合成位置拼接成一个新的东京数据集。</p><p id="b13c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在查看整个东京的数据时，尤其是针对水路生成位置时，肯定会出现一些误报。也许进一步的模型调整，或在训练数据中提供更多的水道的负面例子(domainA或domainB)会减少假阳性。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi oh"><img src="../Images/95550a6494b266229a5be6688062565a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bx9XwXFAXQnbIT2H6CR7Mw.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">为东京市中心组装合成踏板车。来源:Gretel.ai</p></figure><p id="a343" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，结果是令人鼓舞的(给定很少的模型或数据集调整)-模型似乎能够模拟电动自行车数据集的分布和位置，该数据集是使用世界不同地区的地图进行训练的。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi oi"><img src="../Images/56da29d67cda4bc0b11c3affa608b604.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6XvPMbgZIl50vdGWDsW9yg.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">东京市中心的电动自行车位置预测。来源:Gretel.ai</p></figure><h1 id="6107" class="me ly iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">结论</h1><p id="6899" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">在本帖中，我们尝试应用视觉领域的上下文(例如地图数据)和表格数据，来创建世界上任何地方的真实位置数据。</p><p id="7ec3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你喜欢这个例子或者有任何问题，请在GitHub 上留下<a class="ae lb" href="https://github.com/gretelai/GAN-location-generator" rel="noopener ugc nofollow" target="_blank"> ⭐️，或者在我们的</a><a class="ae lb" href="https://gretel.ai/slackinvite" rel="noopener ugc nofollow" target="_blank"> Slack </a>上告诉我们！</p><h1 id="98c3" class="me ly iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">信用</h1><p id="6946" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">下面的作者为我们在这个例子中应用的快速算法提供了优秀的论文和代码。<a class="ae lb" href="https://arxiv.org/pdf/2007.15651" rel="noopener ugc nofollow" target="_blank"/>由朴、埃夫罗斯、张、朱(2020)</p><p id="9863" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<a class="ae lb" href="https://gretel.ai" rel="noopener ugc nofollow" target="_blank"> Gretel.ai </a>，我们构建API，让<a class="ae lb" href="https://gretel.ai/blog/what-is-synthetic-data" rel="noopener ugc nofollow" target="_blank">合成数据</a>对开发者和数据科学家来说变得简单和可扩展。</p></div></div>    
</body>
</html>