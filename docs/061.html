<html>
<head>
<title>Reproducible Data Science with Conda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Conda的可再现数据科学</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/reproducible-data-science-with-conda-48f9de6eabd5#2022-01-03">https://towardsdatascience.com/reproducible-data-science-with-conda-48f9de6eabd5#2022-01-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="41af" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">教程|管理环境| CONDA</h2><div class=""><h1 id="f584" class="pw-post-title jb jc it bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy bi translated">使用Conda的可再现数据科学</h1></div><div class=""><h2 id="2843" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">可重复的数据科学，快速简单的方法</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi kr"><img src="../Images/d12068a51f23e2853713cc0b02d9842a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Y6vUgbghg4vMVhdhqd2n9g.png"/></div><p class="kz la gj gh gi lb lc bd b be z dk translated">(图片由作者提供)</p></figure><p id="0526" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">对于任何类型的研究，重要的是其结果可以被他人复制。如果他们没有复制测试的方法和工具，他们可能会得出不同的甚至是矛盾的结论。在数据科学环境中，有两个非常重要的变异来源需要控制:代码本身，以及用于运行代码的包。</p><p id="b130" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">对于代码本身，你可能已经在使用某种版本控制系统，比如<a class="ae lz" href="https://git-scm.com/about" rel="noopener ugc nofollow" target="_blank"> git </a>或<a class="ae lz" href="https://github.com/features" rel="noopener ugc nofollow" target="_blank"> GitHub </a>。这些确保了使用了正确的代码版本。只要您和您的团队正确使用它，找到最新版本的代码应该是一件简单的事情。</p><div class="ma mb gp gr mc md"><a rel="noopener follow" target="_blank" href="/github-desktop-for-data-scientists-b9d8a3afc5ea"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd jd gy z fp mi fr fs mj fu fw jc bi translated">面向数据科学家的GitHub桌面</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">没有命令行中的版本控制可怕</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">towardsdatascience.com</p></div></div><div class="mm l"><div class="mn l mo mp mq mm mr kx md"/></div></div></a></div><p id="f17d" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">变化的另一个来源是代码运行的环境，比如使用的python版本或者安装的包的版本。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h2 id="cdc3" class="mz na it bd nb nc nd dn ne nf ng dp nh lm ni nj nk lq nl nm nn lu no np nq iz bi translated">一个例子</h2><p id="994e" class="pw-post-body-paragraph ld le it lf b lg nr kd li lj ns kg ll lm nt lo lp lq nu ls lt lu nv lw lx ly im bi translated">在这里，我假设您已经掌握了git和GitHub，但是需要知道如何确保相同的代码以相同的方式运行。如果这听起来有点混乱，让我们后退一步，看一个例子，这将有助于解释它。</p><p id="b0f7" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">在<a class="ae lz" href="https://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank"> scikit learn </a>模块中，有一个<code class="fe nw nx ny nz b"><a class="ae lz" href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.LatentDirichletAllocation.html#sklearn.decomposition.LatentDirichletAllocation" rel="noopener ugc nofollow" target="_blank">LatentDirichletAllocation</a></code> <a class="ae lz" href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.LatentDirichletAllocation.html#sklearn.decomposition.LatentDirichletAllocation" rel="noopener ugc nofollow" target="_blank"> (LDA) </a>功能。这个函数对文本文档执行主题建模，根据文档中包含的单词确定文档中的主题。这个函数有一个名为<code class="fe nw nx ny nz b">learning_method</code>的参数，它极大地改变了完成这个任务的方式。有一种<code class="fe nw nx ny nz b">batch</code>方法，它在每一步中使用所有的训练数据，还有一种<code class="fe nw nx ny nz b">online</code>方法，它使用小批量的训练数据来增量地更新模型。</p><p id="69a0" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">当scikit learn发布0.20版本时，他们将参数<code class="fe nw nx ny nz b">learning_method</code>的默认值从<code class="fe nw nx ny nz b">online</code>更改为<code class="fe nw nx ny nz b">batch</code>。这意味着任何使用版本0.19.2训练此模型的人都会让它以不同于运行版本0.20.4的人的方式运行，假设他们没有显式设置此参数。</p><p id="eba7" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">首先，这如何改变模型的输出？嗯，根据这篇论文的摘要，</p><blockquote class="oa"><p id="a6ae" class="ob oc it bd od oe of og oh oi oj ly dk translated">…在线LDA发现主题模型与批处理中发现的模型一样好，甚至更好…而且只需很少的时间。</p></blockquote><p id="5e52" class="pw-post-body-paragraph ld le it lf b lg ok kd li lj ol kg ll lm om lo lp lq on ls lt lu oo lw lx ly im bi translated">因此，无论选择哪种方法，模型的输出都不会有太大的不同。问题在于计算的速度。对于生产环境，尤其是使用数百万条记录来训练该模型的生产环境，速度很重要。如果没有必要，您不希望不必要地升级机器或配置虚拟机来处理大得多的数据。论文提到了这一点，但是scikit learn在他们的文档中也提到了<code class="fe nw nx ny nz b">LatentDirichletAllocation</code> (LDA)函数的速度。来自<a class="ae lz" href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.LatentDirichletAllocation.html#sklearn.decomposition.LatentDirichletAllocation" rel="noopener ugc nofollow" target="_blank">版本1.0.2文档</a>:</p><blockquote class="oa"><p id="8dd6" class="ob oc it bd od oe of og oh oi oj ly dk translated">一般来说，如果数据量很大，在线更新会比批量更新快很多。</p></blockquote><p id="5685" class="pw-post-body-paragraph ld le it lf b lg ok kd li lj ol kg ll lm om lo lp lq on ls lt lu oo lw lx ly im bi translated">因此，如果我们运行完全相同的代码来训练LDA模型，但我们使用2个不同版本的scikit learn，我们可能需要完全不同的时间和计算资源来训练模型。为了确保我们使用相同版本的scikit learn，我们可以设置、导出和加载一个环境。这样，每个人都将使用相同的默认参数运行相同版本的包。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="e9f4" class="op na it bd nb oq or os ne ot ou ov nh ki ow kj nk kl ox km nn ko oy kp nq oz bi translated">让事物与环境保持一致</h1><p id="adb6" class="pw-post-body-paragraph ld le it lf b lg nr kd li lj ns kg ll lm nt lo lp lq nu ls lt lu nv lw lx ly im bi translated">环境只是定义代码运行环境的一种方式。在公共存储库中，你可能会看到一个<code class="fe nw nx ny nz b">requirements.txt</code>或者一个<code class="fe nw nx ny nz b">environment.yml</code>。这些文件将包含用于分析的环境中的包的列表，使用了哪个版本，以及可能是从哪里安装的。在python中有几种管理环境的方法，但是在这里我们将集中在使用conda和<code class="fe nw nx ny nz b">environment.yml</code>文件从命令行进行管理。</p><h2 id="e4d4" class="mz na it bd nb nc nd dn ne nf ng dp nh lm ni nj nk lq nl nm nn lu no np nq iz bi translated">先决条件</h2><p id="c1cc" class="pw-post-body-paragraph ld le it lf b lg nr kd li lj ns kg ll lm nt lo lp lq nu ls lt lu nv lw lx ly im bi translated">首先，为了在Windows的命令行中使用conda命令，您需要下载并安装<a class="ae lz" href="https://docs.anaconda.com/anaconda/navigator/index.html" rel="noopener ugc nofollow" target="_blank"> Anaconda Navigator </a>。这是我喜欢安装python的方式，因为它允许使用conda命令和非常简单的环境管理，同时允许安装许多流行的工具，如Jupyter笔记本。它还在Windows上安装了Anaconda提示符，允许您从命令行轻松地与python交互，而无需将其添加到您的系统路径中。你可以在Anaconda的网站上了解更多关于安装它的信息。</p><h2 id="5c37" class="mz na it bd nb nc nd dn ne nf ng dp nh lm ni nj nk lq nl nm nn lu no np nq iz bi translated">创造新环境</h2><p id="76f7" class="pw-post-body-paragraph ld le it lf b lg nr kd li lj ns kg ll lm nt lo lp lq nu ls lt lu nv lw lx ly im bi translated">如果你刚刚开始一个项目，创造一个环境是一个很好的起点。<strong class="lf jd">从Anaconda提示符</strong>中，基本命令是</p><pre class="ks kt ku kv gt pa nz pb pc aw pd bi"><span id="cb26" class="mz na it nz b gy pe pf l pg ph">$ conda create --name envname</span></pre><p id="86bb" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">其中<code class="fe nw nx ny nz b">envname</code>是要创建的环境的名称。如果您想要安装特定版本的python，您可以将它包含在环境创建命令中。</p><pre class="ks kt ku kv gt pa nz pb pc aw pd bi"><span id="9e28" class="mz na it nz b gy pe pf l pg ph">$ conda create --name envname python=3.7</span></pre><p id="7e44" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">如果您需要安装软件包，或者这些软件包的特定版本，也可以在这里指定。</p><pre class="ks kt ku kv gt pa nz pb pc aw pd bi"><span id="271b" class="mz na it nz b gy pe pf l pg ph">$ conda create --name envname scipy=0.15.0</span></pre><p id="959a" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">当您创建环境时，您可以添加多个参数来获得您想要的环境，指定python的一个版本并一次性安装您想要的包和版本。不知道需要哪些包或版本？不要担心，您可以在以后安装更多的包到环境中。</p><h2 id="277c" class="mz na it bd nb nc nd dn ne nf ng dp nh lm ni nj nk lq nl nm nn lu no np nq iz bi translated">激活环境</h2><p id="7e47" class="pw-post-body-paragraph ld le it lf b lg nr kd li lj ns kg ll lm nt lo lp lq nu ls lt lu nv lw lx ly im bi translated">一旦创建了环境，您需要激活它来使用它。</p><pre class="ks kt ku kv gt pa nz pb pc aw pd bi"><span id="a17a" class="mz na it nz b gy pe pf l pg ph">$ conda activate envname</span></pre><p id="75c1" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">其中<code class="fe nw nx ny nz b">envname</code>是环境的名称。您将在下一个命令的命令行中看到该环境的名称，表明您现在正在使用该环境。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/afc6233da7d629576b6dd88639d9a62e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*7wQsGZp9Q7Hmqt6SApBHKQ.png"/></div><p class="kz la gj gh gi lb lc bd b be z dk translated">“基地”变“DS-775”，我的环境(作者截图)</p></figure><p id="5a0f" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">一旦环境被激活，你就可以启动一个Jupyter笔记本，像平常一样开发。</p><h2 id="9ba3" class="mz na it bd nb nc nd dn ne nf ng dp nh lm ni nj nk lq nl nm nn lu no np nq iz bi translated">列出环境</h2><p id="f2f9" class="pw-post-body-paragraph ld le it lf b lg nr kd li lj ns kg ll lm nt lo lp lq nu ls lt lu nv lw lx ly im bi translated">如果您已经创建了多个环境，或者即使您使用某个特定的环境已经有一段时间了，您可能想要查看哪些环境是在您的机器上创建的。</p><pre class="ks kt ku kv gt pa nz pb pc aw pd bi"><span id="4787" class="mz na it nz b gy pe pf l pg ph">$ conda env list</span></pre><p id="3edc" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">提供系统上所有环境及其位置的列表。如果您忘记了环境名称的拼写，这也使得激活环境变得容易。</p><h2 id="5b2e" class="mz na it bd nb nc nd dn ne nf ng dp nh lm ni nj nk lq nl nm nn lu no np nq iz bi translated">环境和environment.yml文件</h2><p id="bbfc" class="pw-post-body-paragraph ld le it lf b lg nr kd li lj ns kg ll lm nt lo lp lq nu ls lt lu nv lw lx ly im bi translated">如前所述，一些开发人员会在他们的存储库中包含一个<code class="fe nw nx ny nz b">environment.yml</code>文件，这样其他人就可以使用相同的包复制他们的工作。这对于生产环境也很有帮助，这样我们就可以避免我在介绍示例中讨论的包版本之间的差异问题。</p><pre class="ks kt ku kv gt pa nz pb pc aw pd bi"><span id="5e7f" class="mz na it nz b gy pe pf l pg ph">$ conda create -f environment.yml</span></pre><p id="f0f8" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">从包含<code class="fe nw nx ny nz b">environment.yml</code>的目录中，运行上面的命令。f标志告诉conda我们想要使用文件中的信息来创建环境。</p><p id="b765" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">如果我们想创建<code class="fe nw nx ny nz b">environment.yml</code>文件，我们可以在环境激活时导出它。</p><pre class="ks kt ku kv gt pa nz pb pc aw pd bi"><span id="3f86" class="mz na it nz b gy pe pf l pg ph">$ conda activate myenv<br/>$ conda env export &gt; environment.yml</span></pre><p id="6cff" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这将在当前目录中创建文件，其中包含我们在另一台机器上复制环境所需的所有内容。只需将该文件发送到另一台机器，并使用它创建环境。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="119c" class="op na it bd nb oq or os ne ot ou ov nh ki ow kj nk kl ox km nn ko oy kp nq oz bi translated">结论</h1><p id="239d" class="pw-post-body-paragraph ld le it lf b lg nr kd li lj ns kg ll lm nt lo lp lq nu ls lt lu nv lw lx ly im bi translated">我们讨论了使用环境背后的动机，提供了一个例子，当使用相同包的不同版本时，相同的代码可以提供不同的执行。我们还介绍了一些使用conda从命令行管理环境的最有用的命令，例如创建环境，使用<code class="fe nw nx ny nz b">environment.yml</code>文件创建环境，以及创建<code class="fe nw nx ny nz b">environment.yml</code>文件与他人共享您的环境。</p><div class="ma mb gp gr mc md"><a href="https://realdrewdata.medium.com/membership" rel="noopener follow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd jd gy z fp mi fr fs mj fu fw jc bi translated">通过我的推荐链接加入Medium-Drew Seewald</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">realdrewdata.medium.com</p></div></div><div class="mm l"><div class="pj l mo mp mq mm mr kx md"/></div></div></a></div><p id="3ca9" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">有关使用conda管理python环境的更多信息，请查看以下资源:</p><ul class=""><li id="f9ab" class="pk pl it lf b lg lh lj lk lm pm lq pn lu po ly pp pq pr ps bi translated">康达备忘单:<a class="ae lz" href="https://docs.conda.io/projects/conda/en/4.6.0/_downloads/52a95608c49671267e40c689e0bc00ca/conda-cheatsheet.pdf" rel="noopener ugc nofollow" target="_blank">https://docs . conda . io/projects/conda/en/4 . 6 . 0/_ downloads/52a 95608 c 49671267 e 40 c 689 E0 BC 00 ca/conda-Cheat Sheet . pdf</a></li><li id="8904" class="pk pl it lf b lg pt lj pu lm pv lq pw lu px ly pp pq pr ps bi translated">Conda用户指南，管理环境:<a class="ae lz" href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html" rel="noopener ugc nofollow" target="_blank">https://docs . conda . io/projects/conda/en/latest/User-Guide/tasks/manage-Environments . html</a></li></ul></div></div>    
</body>
</html>