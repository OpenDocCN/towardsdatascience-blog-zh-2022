<html>
<head>
<title>How to Use ECMWF Weather Forecasts in Machine Learning Models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在机器学习模型中使用ECMWF天气预报</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-use-ecmwf-weather-forecasts-in-machine-learning-models-92fc3730c5cf#2022-01-13">https://towardsdatascience.com/how-to-use-ecmwf-weather-forecasts-in-machine-learning-models-92fc3730c5cf#2022-01-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""><h1 id="662a" class="pw-post-title io ip iq bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">如何在机器学习模型中使用ECMWF天气预报</h1></div><div class=""><h2 id="e582" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">加载数据、查询历史天气、训练ML模型</h2></div><p id="22a7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">欧洲中期天气预报中心(ECMWF)提供全球天气预报。如果您有一个需要将天气作为输入要素的ML问题(例如，您试图预测雨伞或冰淇淋的需求)，您可以使用ECMWF数据根据历史数据训练您的ML模型，并在预测时使用ECMWF的实时预测。</p><p id="942a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最近，谷歌<a class="ae lb" href="https://github.com/google/weather-tools" rel="noopener ugc nofollow" target="_blank">开源了一组Apache Beam pipeline</a>，使天气数据更容易纳入数据分析和机器学习项目。让我们兜一圈。</p><h2 id="f8c4" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">示例ML问题</h2><p id="3961" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">我想使用天气数据作为一个模型的输入，预测纽约人将会保留他们租用的自行车多长时间。我的假设是，如果天气太热或下雨，人们会将自行车存放的时间缩短。所以，让我们把天气作为输入特征之一。</p><p id="b2a8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">纽约自行车租赁数据在BigQuery中作为公共数据集提供。尝试在<a class="ae lb" href="https://console.cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank"> BigQuery </a>中查询:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="0dec" class="lc ld iq mf b gy mj mk l ml mm">SELECT <br/>  start_station_name,<br/>  EXTRACT(hour from starttime) AS hourofday,<br/>  EXTRACT(dayofweek from starttime) AS dayofweek,<br/>  tripduration,<br/>FROM `bigquery-public-data.new_york_citibike.citibike_trips`<br/>LIMIT 5</span></pre><p id="778a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以训练一个XGBoost模型，根据其他因素(如起点站名称、一天中的时间和一周中的日期)来预测自行车租赁的持续时间:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="5137" class="lc ld iq mf b gy mj mk l ml mm">CREATE OR REPLACE MODEL weather.rental_duration_nowx<br/>OPTIONS(<strong class="mf ir">model_type='boosted_tree_regressor', </strong><br/>        input_label_cols=['tripduration']) AS<br/>SELECT <br/>  <strong class="mf ir">start_station_name,<br/>  </strong>EXTRACT(hour from starttime) AS<strong class="mf ir"> hourofday,<br/>  </strong>EXTRACT(dayofweek from starttime) AS<strong class="mf ir"> dayofweek,<br/>  tripduration</strong><br/>FROM `bigquery-public-data.new_york_citibike.citibike_trips`<br/>WHERE EXTRACT(year from starttime) = 2018</span></pre><p id="072f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所得模型在保留数据上的中值绝对误差= 265秒。让我们看看能否利用天气信息改进这个基本模型。</p><h2 id="364d" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">环境设置</h2><ol class=""><li id="cafb" class="mn mo iq kh b ki lv kl lw ko mp ks mq kw mr la ms mt mu mv bi translated">去<a class="ae lb" href="https://console.cloud.google.com/vertex-ai/workbench/" rel="noopener ugc nofollow" target="_blank">谷歌云控制台</a>启动一个顶点工作台笔记本。我选择了一台相对最小的机器——没有GPU和n1-standard-2的最新TensorFlow版本——因为我们不会在笔记本上做太多工作。</li><li id="ccd7" class="mn mo iq kh b ki mw kl mx ko my ks mz kw na la ms mt mu mv bi translated">从控制台中的链接打开JupyterLab并启动终端。</li><li id="c32d" class="mn mo iq kh b ki mw kl mx ko my ks mz kw na la ms mt mu mv bi translated">为了从ECMWF获取数据，您必须向ECMWF注册，并在登录时获取您的API密钥。</li></ol><ul class=""><li id="5be9" class="mn mo iq kh b ki kj kl km ko nb ks nc kw nd la ne mt mu mv bi translated">气候数据(哥白尼):<a class="ae lb" href="https://cds.climate.copernicus.eu/user/register?destination=%2F%23!%2Fhome" rel="noopener ugc nofollow" target="_blank">注册</a>和<a class="ae lb" href="https://cds.climate.copernicus.eu/api-how-to#install-the-cds-api-key" rel="noopener ugc nofollow" target="_blank">获得你的API密匙</a>。将url、key放在主目录中一个名为<strong class="kh ir"> ~/的文件中。cdsapirc </strong>如页面所示。这些数据是免费的，但是您需要注册并获得API密钥。</li><li id="0dca" class="mn mo iq kh b ki mw kl mx ko my ks mz kw na la ne mt mu mv bi translated">天气预报(火星):<a class="ae lb" href="https://apps.ecmwf.int/registration/" rel="noopener ugc nofollow" target="_blank">注册</a>，<a class="ae lb" href="https://api.ecmwf.int/v1/key/" rel="noopener ugc nofollow" target="_blank">获取你的API密匙</a>。在<strong class="kh ir"> ~/中输入网址、电子邮件和密钥。ecmwfapirc </strong>如页面所示。这些数据不是免费的(详见本博客最后一节)。</li></ul><p id="c8d2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了跟随我，为哥白尼注册并设置了密钥。MARS提要是可选的。</p><p id="9cf4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.安装天气工具包:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="aa3c" class="lc ld iq mf b gy mj mk l ml mm">pip install google-weather-tools</span></pre><p id="1654" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.创建将向其中加载查询数据的BigQuery数据集:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="7128" class="lc ld iq mf b gy mj mk l ml mm">bq mk weather</span></pre><p id="7d28" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">4.创建一个存储桶来临时存储下载的文件:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="831c" class="lc ld iq mf b gy mj mk l ml mm">PROJECT=$(gcloud config get-value project)<br/>BUCKET=${PROJECT}-ecmwf<br/>gsutil mb gs://$BUCKET</span></pre><p id="ea6a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">记下已经创建的存储桶的名称。您将在下一步中需要它。</p><h2 id="0dd5" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">下载历史观察</h2><p id="970b" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">先来验证一下天气对自行车租赁是否有影响。在我们开始使用天气预报之前，我们可以尝试使用天气观测。ERA5是我们想要的数据集。</p><p id="b657" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">5.下载示例配置<a class="ae lb" href="https://github.com/google/weather-tools/blob/main/configs/era5_example_config.cfg" rel="noopener ugc nofollow" target="_blank"> era5_example_config.cfg </a>:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="5859" class="lc ld iq mf b gy mj mk l ml mm">wget <a class="ae lb" href="https://raw.githubusercontent.com/google/weather-tools/main/configs/era5_example_config.cfg" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/google/weather-tools/main/configs/era5_example_config.cfg</a></span></pre><p id="b249" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">6.更改示例以反映我们想要的数据(确保从~/编辑BUCKET和KEY。此文件中的cdsapirc):</p><figure class="ma mb mc md gt nf"><div class="bz fp l di"><div class="ng nh l"/></div></figure><ul class=""><li id="7447" class="mn mo iq kh b ki kj kl km ko nb ks nc kw nd la ne mt mu mv bi translated">数据集、变量:我们想要的(关于选项，请查看数据集的<a class="ae lb" href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels" rel="noopener ugc nofollow" target="_blank">列表</a>和<a class="ae lb" href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels?tab=form" rel="noopener ugc nofollow" target="_blank">数据集文档</a>)。我挑选了温度和降雨量的每小时数据。</li><li id="9317" class="mn mo iq kh b ki mw kl mx ko my ks mz kw na la ne mt mu mv bi translated">target_path:确保将我的示例中的bucket名称改为您在步骤4中的bucket名称。</li><li id="3f99" class="mn mo iq kh b ki mw kl mx ko my ks mz kw na la ne mt mu mv bi translated">api_key:确保设置您的。cdsapirc值。</li><li id="5d55" class="mn mo iq kh b ki mw kl mx ko my ks mz kw na la ne mt mu mv bi translated">区域:包括纽约市在内的经度范围(纬度=41，经度=-74)</li></ul><p id="dc13" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">6.下载数据:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="89b5" class="lc ld iq mf b gy mj mk l ml mm">weather-dl era5_example_config.cfg \<br/>   --project $PROJECT --region us-west1 \<br/>   --runner DataflowRunner --temp_location=gs://${BUCKET}/temp</span></pre><p id="9292" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将启动一个数据流作业，您可以在<a class="ae lb" href="https://console.cloud.google.com/dataflow" rel="noopener ugc nofollow" target="_blank">https://console.cloud.google.com/dataflow</a>进行监控</p><figure class="ma mb mc md gt nf gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi ni"><img src="../Images/980a75297f77c82d36133ca752d18ef7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vpf7vlJ1San4SGKBgfPpag.png"/></div></div><p class="np nq gj gh gi nr ns bd b be z dk translated">获取数据的数据流管道[图片由作者提供]</p></figure><p id="5cbd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">等待作业完成(大约6分钟)。请注意，我们一月份只有几天时间。</p><p id="cbd7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">7.检查FetchData步骤的日志以验证正在下载哪些文件:</p><figure class="ma mb mc md gt nf gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi nt"><img src="../Images/30a7e56e105eba8036ee5646164a7d54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bE6JG8nYXrFsUyb2F_W4UQ.png"/></div></div><p class="np nq gj gh gi nr ns bd b be z dk translated">如何看待数据流日志[图片由作者提供]</p></figure><p id="8653" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">8.验证数据是否已下载:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="a075" class="lc ld iq mf b gy mj mk l ml mm">gsutil ls -l gs://$BUCKET/era5/2018/01/01.nc</span></pre><h2 id="b46f" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">[可选]下载一年的历史数据</h2><p id="7465" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">下载一年的历史数据将需要<strong class="kh ir">1-10个小时</strong>才能完成，这取决于你是否拥有付费的ECMWF许可证。所以，你可以跳过这一步。要了解事情是如何工作的，您在上一步中下载的少量数据就足够了。</p><p id="b37a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nu">注意:如果在配置中使用多个许可证，您可以获得更快的下载速度。参数subsections docs(</em><a class="ae lb" href="https://github.com/google/weather-tools/blob/main/Configuration.md#subsections" rel="noopener ugc nofollow" target="_blank"><em class="nu">https://github . com/Google/weather-tools/blob/main/configuration . MD # subsections</em></a><em class="nu">)描述了如何做到这一点。因此，拥有CDS许可证的团队可以一起更快地获取数据。</em></p><p id="2c84" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">9.通过指定日期范围，将纪元配置扩展到所有月份和所有日期，而不是单独列出具体的月份/日期等。(和以前一样，记得更改下面清单中的BUCKET和KEY)。</p><figure class="ma mb mc md gt nf"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="b7fe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">重新运行作业。已经下载的数据将被跳过。同样:这需要<strong class="kh ir">几个小时</strong>才能完成。所以，如果你只是想看看事情是如何运作的，可以跳过这一步。</p><h2 id="7097" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">将数据加载到BigQuery</h2><p id="8410" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">您已经下载了ERA5数据，但是它是netcdf格式的，不太有利于将其合并到ML模型中。让我们将它加载到BigQuery中，使数据更加可用。</p><p id="0bbf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">10.将数据加载到BigQuery</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="bfc6" class="lc ld iq mf b gy mj mk l ml mm">weather-mv --uris "gs://$BUCKET/era5/**.nc" \<br/>           --output_table $PROJECT.weather.newyork \<br/>           --temp_location gs://$BUCKET/temp \<br/>           --direct_num_workers 2</span></pre><p id="486c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在“本地”运行它，但是您也可以通过指定DataflowRunner在数据流中运行它，就像使用weather-dl工具一样:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="7da1" class="lc ld iq mf b gy mj mk l ml mm">weather-mv --uris "gs://$BUCKET/era5/**.nc" \<br/>           --output_table $PROJECT.weather.newyork \<br/>           --project $PROJECT --region us-west1 \<br/>           --runner DataflowRunner \<br/>           --temp_location=gs://${BUCKET}/temp</span></pre><p id="a995" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">11.检查我们刚刚得到的数据:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="c977" class="lc ld iq mf b gy mj mk l ml mm">SELECT <br/>  time, longitude, latitude,<br/>  ROUND(t2m, 2) as temperature, <br/>  ROUND(tp, 2) AS rain<br/>FROM weather.newyork<br/>LIMIT 5</span></pre><p id="10c7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结果应该是这样的:</p><figure class="ma mb mc md gt nf gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/40ba7b2ab325859b57414b70ae07593c.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*gaiMMMo6UdUdQjMC8CTgXA.png"/></div></figure><h2 id="3953" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">使用天气数据训练ML模型</h2><p id="fce2" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">12.将天气数据与自行车数据结合起来，这样我们就可以知道每次租赁的地点/时间的天气:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="7d08" class="lc ld iq mf b gy mj mk l ml mm">SELECT <br/>  start_station_name,<br/>  EXTRACT(hour from starttime) AS hourofday,<br/>  EXTRACT(dayofweek from starttime) AS dayofweek,<br/>  tripduration,<br/>  <strong class="mf ir">ROUND(t2m, 2) as temperature, <br/>  ROUND(tp, 2) AS rain</strong><br/><strong class="mf ir">FROM weather.newyork</strong><br/>JOIN `bigquery-public-data`.new_york_citibike.citibike_trips<strong class="mf ir"><br/>ON ABS(DATETIME_DIFF(EXTRACT(DATETIME FROM time), starttime, HOUR)) &lt; 3<br/>   AND ABS(start_station_latitude - latitude) &lt; 0.5<br/>   AND ABS(start_station_longitude - longitude) &lt; 0.5</strong><br/>LIMIT 5</span></pre><figure class="ma mb mc md gt nf gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/daaa65ea86257bd315fd3fe398b4f6de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*wXUCXFdDTc3QCYjrZEWX-Q.png"/></div></figure><p id="9efd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">13.让我们在上面的查询中编写一个更有效的连接，方法是更改自行车表中的时间和位置字段以匹配天气数据的时间/空间分辨率，并保存连接的数据以用于ML元数据跟踪和重新训练:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="157f" class="lc ld iq mf b gy mj mk l ml mm">CREATE OR REPLACE TABLE weather.citibike_trips AS<br/>WITH citibike_trips AS (<br/>    SELECT <br/>    start_station_name,<br/>    EXTRACT(hour from starttime) AS hourofday,<br/>    EXTRACT(dayofweek from starttime) AS dayofweek,<br/>    tripduration,<br/>    TIMESTAMP_ADD(TIMESTAMP_TRUNC(CAST(starttime AS TIMESTAMP), HOUR), <br/>                  INTERVAL CAST(ROUND(EXTRACT(hour from starttime)/6) AS INT64) HOUR) AS time,<br/>    ROUND(start_station_latitude*2)/2 AS latitude,<br/>    ROUND(start_station_longitude*2)/2 AS longitude<br/>    FROM `bigquery-public-data`.new_york_citibike.citibike_trips<br/>    WHERE EXTRACT(YEAR FROM starttime) = 2018<br/>)<br/>SELECT <br/>    trips.*, <br/>    ROUND(t2m, 2) as temperature, <br/>    ROUND(tp, 2) AS rain<br/><strong class="mf ir">FROM citibike_trips trips<br/>JOIN weather.newyork</strong><br/><strong class="mf ir">USING (time, latitude, longitude)</strong></span></pre><p id="81ea" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">14.天气有多重要？用天气训练XGBoost模型:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="a629" class="lc ld iq mf b gy mj mk l ml mm">CREATE OR REPLACE MODEL weather.rental_duration_wx<br/>OPTIONS(model_type='boosted_tree_regressor', <br/>        input_label_cols=['tripduration']) AS</span><span id="e71e" class="lc ld iq mf b gy nx mk l ml mm">SELECT <br/>  start_station_name,<br/>  hourofday,<br/>  dayofweek,<br/>  <strong class="mf ir">temperature, <br/>  rain,</strong><br/>  tripduration<br/>FROM weather.citibike_trips</span></pre><p id="68d7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">15.比较评估误差:</p><p id="456a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不考虑天气因素:中值绝对误差= 265秒</p><p id="1ce8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">天气:中值绝对误差= 245秒。</p><p id="2361" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">成功！当我们知道天气时，我们能够更好地预测自行车租赁的持续时间…</p><h2 id="40ec" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">[可选]下载您想要的天气预报数据</h2><p id="5100" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">在我的工作流程中(如上)，我使用了事后几天创建的<em class="nu">再分析</em>数据。所以，你实际上不能用它来进行实时机器学习。对于实时ML，你需要近乎实时产生和传播的天气<em class="nu">预报</em>数据。<strong class="kh ir">这不是免费的，您需要从ECMWF获得商业许可才能下载预测数据。</strong></p><p id="151f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">16.下载示例配置<a class="ae lb" href="https://github.com/google/weather-tools/blob/main/configs/mars_example_config.cfg" rel="noopener ugc nofollow" target="_blank">configs/mars _ example _ config . CFG</a>:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="0e92" class="lc ld iq mf b gy mj mk l ml mm">wget <a class="ae lb" href="https://raw.githubusercontent.com/google/weather-tools/main/configs/mars_example_config.cfg" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/google/weather-tools/main/configs/mars_example_config.cfg</a></span></pre><p id="15a2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">17.您必须对param行进行的关键更改是:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="de46" class="lc ld iq mf b gy mj mk l ml mm">target_path=gs://<strong class="mf ir">BUCKET</strong>/newyork/<br/>param=max2t6/min2t6/maxtpr6<br/>step=6/12/18/24<br/>time=0500<br/>date=2018-01-01/to/2018-12-31</span></pre><ul class=""><li id="2ea6" class="mn mo iq kh b ki kj kl km ko nb ks nc kw nd la ne mt mu mv bi translated">param:我们想要的天气变量是地表以上2m处的6小时最高和最低温度(大约是人面部高度的温度)和6小时最大降水率。你可以在这里找到所有天气参数的<a class="ae lb" href="https://www.ecmwf.int/en/forecasts/datasets/set-i" rel="noopener ugc nofollow" target="_blank">描述。</a></li><li id="f092" class="mn mo iq kh b ki mw kl mx ko my ks mz kw na la ne mt mu mv bi translated">步骤、时间、日期:获取0500 UTC(纽约市午夜)做出的提前6小时、12小时、18小时、24小时的预测，并获取2018年做出的所有预测。</li></ul><p id="be95" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，使用weather-dl下载数据，并使用weather-mv将其添加到BigQuery中。工作流程的其余部分保持不变！</p><p id="3f04" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">尽情享受吧！</p></div></div>    
</body>
</html>