# 你可能认识的人:聚集用户的算法背后

> 原文：<https://towardsdatascience.com/people-you-may-know-behind-the-algorithms-that-bring-users-together-a7e1a2b8fec0>

## 机器学习模型如何向人们推荐人

![](img/5133be4f3d8b57969b3687d616238c3d.png)

由[创意基督徒](https://unsplash.com/@creativechristians?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

联系是社交媒体的核心。基本的[价值假设](https://www.forbes.com/sites/scottpollack/2012/04/12/the-value-hypothesis/?sh=5874f49e14af)是连接的用户更投入，投入的用户更有可能回来。“我们怎样才能让用户联系得更紧密，”因此是社交媒体应用中最关键的问题之一。答案是一类被称为“你可能认识的人”，或 **PYMK** 的算法，它向你显示你最有可能联系的用户候选人的定期更新列表。

脸书对 PYMK 的解释如下:

> “你可能认识的人”是你可能想交朋友的人的列表，因为你们有共同点，比如共同的朋友、学校或工作场所。

[LinkedIn](https://www.linkedin.com/help/linkedin/answer/a544682/people-you-may-know-feature?lang=en) 写道:

> “我的网络”页面上的“您可能认识的人”功能会向您推荐 LinkedIn 会员。这些推荐是基于你和其他 LinkedIn 成员之间的共同点，以及你从电子邮件和手机通讯录中导入的联系人。

这是推特:

> Twitter 的账户建议是基于为你做出个性化建议的算法。

还有[抖音](https://support.tiktok.com/en/account-and-privacy/account-privacy-settings/suggested-accounts):

> 为了帮助您在抖音上找到并关注您可能认识的人，我们可能:
> 通过向您显示他们的视频和您个人资料中的“查找朋友”功能，向您推荐帐户。向抖音上的其他人推荐您的帐户，以便他们可以关注您。

但是这些算法到底是如何工作的呢？引擎盖下发生了什么？在这篇文章中，我们将深入探讨

*   PYMK 的基本机器学习模型架构，
*   模型服务考虑事项，
*   重新排序方法，以及
*   对 PYMK 未来的展望。

让我们开始吧(在简短的免责声明之后)。

免责声明:PYMK 是有争议的。一些用户不喜欢 PYMK，因为他们或者不想在他们的社交媒体订阅中看到某些人，或者出于隐私考虑不想向其他人展示，或者两者兼而有之。这些是产品方面的考虑，而不是技术方面的考虑，因此超出了本文的范围。在这里，我们将保持它的技术性。

## PYMK 的基本模型架构

与其他[排名模型](/learning-to-rank-a-primer-40d2ff9960af)类似，PYMK 算法的一个好主意是**两阶段建模方法**，由候选人选择(第一阶段)和候选人排名(第二阶段)组成。第一阶段将整个用户群过滤为更易管理的候选数量(例如从 10 亿到 1000)，第二阶段根据连接概率，即两个用户连接的可能性，对这些候选进行排序。然后向用户显示排名最高的候选项，其中一个按钮用于“连接”，另一个按钮用于“忽略”。

接下来让我们放大到这两个阶段。

**候选人选择。**也许最简单也是最直观的候选人选择启发法是“**朋友的朋友**”(**FOF**):考虑所有二级亲属关系作为可能的 PYMK 候选人。事实证明，这种启发实际上非常强大:脸书 2010 年的公开幻灯片解释说，92%的新连接来自用户的(平均)17K FOFs 之一。换句话说，FOF 候选人选择将 PYMK 候选人池减少了 6 个数量级(假设整个用户数以十亿计)，同时仍然保留了 92%的召回率。 [LinkedIn](https://www.infoq.com/presentations/recommendation-massive-data/) 也使用 FOF 候选人选择，他们将它与其他启发式方法相结合，如选择同事的所有关系。

**排名。**我们可以用**二进制分类模型**对 PYMK 候选者(在第一阶段提取)进行排名，其中排名仅仅是模型分数本身:分数越高，连接的概率越高。在离线模型训练期间，我们可以训练模型来预测用户之间的现有连接。然后，在推理时，我们可以对用户的所有 PYMK 候选项进行评分，并显示列表中的前 N 名候选项。

为了训练这样一个二元分类器，我们需要一组丰富多样的特征。这些可以包括:

*   公共连接的数量，
*   无论两个用户是否在同一雇主处工作，或者过去是否在同一雇主处工作，
*   这两个用户是否去了同一所学校，
*   任何共同兴趣、团体、技能或爱好的存在，
*   两个用户是否有共同的职称，
*   用户位置之间的物理距离，
*   两个用户发布的文本内容的语义相似性(使用某种形式的文本嵌入)，或者
*   两个用户在帖子中是否被一起标记。
*   两个用户是否喜欢对方的帖子。

最后，我们应该跟踪哪些指标来评估 PYMK 管道的绩效？对于候选人选择，我们需要知道召回率，比如上面提到的 FOF 选择的 92%召回率。对于分类器，我们希望使用 ROC-AUC 或 PR-AUC 等指标来量化模型性能。一旦该模型被部署，一个重要的指标可以是**点击率**(精确度的代表)以及 **PYMK 覆盖率**，即所有因 PYMK(召回的代表)而建立的连接的比率。一个“完美的”PYMK 算法将预见所有新的连接，并因此实现 100%的 PYMK 覆盖。

## 模型服务注意事项

在推理时，我们希望向用户显示前 N 名 PYMK 候选人，例如前 10 名。如果用户从该列表中选择或删除了候选人，我们将希望立即从剩余的候选人池中回填该列表。

一种方法是**离线计算**，我们离线计算每个用户的 PYMK 列表，并将其存储在数据库中。然后，一旦用户访问应用程序，我们可以直接从存储中提取他们的个人 PYMK 列表。这种离线计算可以每天运行。

离线计算的优点是低延迟，因为在服务时间，我们只需要从数据库中读取候选列表，而不是运行排名模型。然而，缺点是我们浪费了计算资源:例如，如果在某一天只有 1%的用户打开他们的应用程序，那么那天用于计算 PYMK 的 99%的计算资源都被浪费了。LinkedIn 的工程师[报告说](https://www.infoq.com/presentations/recommendation-massive-data/)广泛的离线计算对他们来说变得“非常昂贵”,因此他们离开了它。

另一种方法是**在线计算**，一旦用户打开应用程序，我们就运行整个模型(候选人选择和排名)。这解决了资源浪费的问题:如果用户不打开应用程序，那么就不会为该用户进行计算。然而，在线计算增加了延迟，因此保持排名模型轻量级是很重要的，例如具有很少参数和低延迟的简单逻辑回归模型。深度神经网络在这种情况下可能不会很好地工作，因为它可能会增加太多的延迟。

另一个需要考虑的是多长时间再培训一次 PYMK 排名模型。一般来说，较新的模型比陈旧的模型表现得更好，因为社交图是动态的，而不是静态的:每天都有新用户和新联系加入其中。LinkedIn 的工程师[报告](https://www.infoq.com/presentations/recommendation-massive-data/)说，从历史上看，他们的 PYMK 计算需要几天时间，并被存储到磁盘上，这意味着推荐在推断时已经过期几天了。在一个小规模的概念验证中，他们能够证明具有新数据的推荐表现得更好(“*至少在过去三四年中最大的提升之一*”)。这一发现激励他们从 Hadoop 中迁移出来，构建 Gaia，这一服务使他们能够以更有效的方式运行重量级的基于图形的算法，如 PYMK。

## 重新排序方法

这里概述的候选选择+排序方法的问题是，这种方法优化了全局性能，但该算法仍可能导致某些用户不希望的结果。这些不希望的结果可以通过**重新排序**来解决，我们根据某些启发式规则重新排序 PYMK 列表。换句话说，重新排序是对指定不足的建模目标的特别修正。让我们来看看 [LinkedIn](https://engineering.linkedin.com/blog/2021/optimizing-pymk-for-equity-in-network-creation) 正在生产中使用的两种重新排名算法，印象折扣和参与度重新排名。

**印象折扣。**LinkedIn 的 PYMK 算法的一个问题是，知名度高的用户(如行业影响者)会收到大量的连接请求。我个人可以证实这一点:我已经收到了数百个 LinkedIn 连接请求，这些请求来自我完全没有关系的人。如果这种请求泛滥隐藏了来自我确实认识并且想要联系的人的请求，那就特别麻烦。

LinkedIn 用他们所谓的“印象折扣”来解决这个问题。其基本思想是根据所示候选人的未决请求总数重新排列 PYMK 结果。因此，LinkedIn 不是按 p 给 PYMK 排名，而是按 p/N 之类的东西给他们排名，其中 p 是联系的概率(根据机器学习模型分数计算)，N 是用户已经收到的未完成邀请的数量。

印象折扣有用吗？看起来是这样的:在一项 A/B 测试中(我在这里[提到过](/the-joy-of-a-b-testing-theory-practice-and-pitfalls-de58acbdb04a))，LinkedIn 显示，印象折扣将“超载”用户的数量减少了 50%，即那些报告他们收到太多邀请的用户。

**定亲。**LinkedIn 的 PYMK 算法的另一个问题是，根据定义，训练数据偏向于高参与度用户(称为频繁会员，FMs)，而不利于低参与度用户(称为非频繁会员，IMs)。结果，PYMK 列表将包含比 IMs 多得多的 FM，为 IMs 创建一个恶性循环:低参与度导致更少的连接请求导致更低的参与度，等等。

这个问题可以通过“参与度重新排序”来解决:在我们有了初始的 PYML 列表、向上排序的 im 和向下排序的 FM 之后，向用户显示的最终列表包含 50%的 FM 和 50%的 im。

使用 A/B 测试，LinkedIn 显示，参与度重新排名使发送到即时消息的邀请增加了约 5%。有趣的是，发送给 FMs 的邀请并没有减少:这些用户可能是如此受欢迎，以至于即使人为地将他们在 PYMK 排名靠后也没有改变他们收到的请求数量。因此，总体而言，参与度重新排名解决了它想要解决的问题，即减轻 PYMK 对 IMs 的偏见。

![](img/0ef9288c3476f538911bd4bccd21dd0f.png)

照片由[本杰明·戴维斯](https://unsplash.com/@bendavisual?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

## 对未来的展望

社交媒体在过去的几年里经历了快速的变化，它的未来还未确定——事实上，它现在正在展现。

抖音的崛起表明，用户实际上可能更喜欢从整个平台上通过算法选择的内容，而不是只来自他们自己的社交网络的内容。企业家 Michael Mignano [称](https://mignano.medium.com/the-end-of-social-media-a88ffed21f86)这种发展为“*社交媒体的终结和推荐媒体的兴起*”。**推荐媒体**不太强调朋友和社交网络。相反，内容本身，以及它与用户偏好的匹配程度，是在整个平台上分发内容的最重要因素。米格纳米写道:

> 推荐媒体来了。因此，对于我们如何、何时以及为什么消费内容，我们将做出更少的明确选择(“这些是我的朋友”)和更多的隐含选择(“这是算法建议我应该花费注意力的地方”)。

那么，也许社交媒体的未来没有明确的联系，因此没有 PYMK 算法。

## 在你走之前…

*享受这个内容？在我的* [*个人资料页面*](https://medium.com/@samuel.flender) *找到更多我的文章。在 Medium 上关注/订阅，这样你就不会错过我以后写的新帖。* [*成为中等会员*](https://medium.com/@samuel.flender/membership) *这样就可以无限查看文章了。并确保在*[*LinkedIn*](https://www.linkedin.com/in/sflender/)*和/或*[*Twitter*](https://twitter.com/samflender)*上关注我！*