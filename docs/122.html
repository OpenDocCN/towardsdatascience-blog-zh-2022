<html>
<head>
<title>Charting with Plotly Dash</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用虚线绘制图表</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/charting-with-dash-583b65a22ace#2022-01-05">https://towardsdatascience.com/charting-with-dash-583b65a22ace#2022-01-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""><h1 id="ccb6" class="pw-post-title ir is it bd iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp bi translated"><strong class="ak">用绘图破折号制图</strong></h1></div><div class=""><h2 id="4b1f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><strong class="ak"> 3:使用破折号选择图表以更好地讲述故事</strong></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/85f385114317d282674ca992ede8236a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OI5PqloA6Ah9SEGs"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@girlwithredhat?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">戴红帽的女孩</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="35be" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">简介</strong></h1><p id="4090" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">数据可视化中最常见的问题之一是试图根据消息的性质建立最合适的图<strong class="lt iu">。</strong>当可视化的目标不仅仅是显示给定时间段内各种定量变量的趋势或变化模式，而是将其与<strong class="lt iu">成分分析</strong>(组成整体的各个部分是如何相关的)联系起来时，这个问题就更加重要了。最常用的可视化工具是多折线图、堆积条形图和堆积面积图。</p><p id="2a3b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当对应于显示的水平轴的时间段具有许多值时，可能难以确定垂直轴上指示的每个数值变量的精确值。然后可以方便地添加第二个图表来显示这些确切的值，以提高消息的质量。在这种情况下，最常用的可视化工具是饼状图、树形图和旭日图。</p><p id="3cb5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">问题是:对于上述情况，哪种组合可以实现最佳的讲故事效果？</p><p id="faa8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们将尝试通过使用Python框架Dash的应用程序来回答这个问题，使用的数据集对应于2007-2020年期间的世界生物乙醇产量。</p><h1 id="c2e0" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">破折号</strong></h1><p id="6517" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Dash是一个开源的免费库，由加拿大蒙特利尔的IT公司<strong class="lt iu"> Plotly </strong>创建。它是一个<strong class="lt iu"> python框架</strong>，用于创建名为<strong class="lt iu"> Dash Apps </strong>的dataviz应用和仪表盘。Dash主要基于ReactJS(前端)、Flask(后端)、Plotly(数据可视化工具)。</p><p id="3871" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Dash Apps有几个优点:(1)你不仅可以用python设计应用，还可以用Julia，。NET，或R；(2)您不需要成为Java、CSS或HTML方面的专家来构建分析型web应用程序；(3)应用程序呈现在浏览器中，您可以通过URL与几个人共享您的仪表板；(4)它是多平台的，应用程序的设计可以调整到任何你想使用它的屏幕。</p><h1 id="d553" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">仪表盘应用</strong></h1><p id="b693" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了更好地理解本文中开发的一些概念，我推荐阅读我以前在这个中型平台上写的关于Dash的文章(<a class="ae ky" rel="noopener" target="_blank" href="/charting-with-plotly-dash-fa96c171409b">用Plotly Dash 1制作图表:损耗模式</a>，<a class="ae ky" rel="noopener" target="_blank" href="/charting-with-plotly-dash-ee9334441c11">用Dash 2制作图表:用于转换的单选项目)。</a></p><p id="3708" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">本质上，Dash应用由<strong class="lt iu">两部分组成:</strong> (1)描述应用外观的<strong class="lt iu">布局</strong>；(2)允许应用程序被动响应的<strong class="lt iu">回调</strong>。</p><p id="b8bb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们总是通过布局开始构建应用程序的过程。这是我们放置应用程序组件的地方。为此，我们使用了两个库:(1)<em class="ms">dash _ html _ components(html)</em>它提供了HTML组件(标题、段落、换行符等的HTML标签。);(2)<em class="ms">dash _ core _ components(DCC)</em>提供了滑块、图形、下拉等组件。布局清楚地定义了我们的应用程序的视觉外观。</p><p id="73f4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">每个Dash应用的反应性(交互性)都是通过回调来实现的。这是一个有两个部分的<strong class="lt iu">函数:(1)装饰器<strong class="lt iu"/>，在这里你指出输入和输出组件。用户可以修改输入组件。输出组件显示应用对输入组件变化的反应。装饰器必须用<em class="ms"> @app.callback() </em>初始化；(2)<strong class="lt iu">函数定义</strong>，根据某个输入组件的变化，对要显示的活动进行编码。函数定义必须用<em class="ms"> def </em>初始化。</strong></p><h1 id="5b2d" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">我们的Dash App </strong></h1><p id="0c72" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们的布局包括以下内容:</p><ul class=""><li id="3f27" class="mt mu it lt b lu mn lx mo ma mv me mw mi mx mm my mz na nb bi translated">标题在最上面；</li><li id="0e59" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated">三个选项卡，每个选项卡都有一个相关的回调函数(<em class="ms"> dcc。tab</em>)；</li><li id="6570" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated">一个滑块，用户可以在那里拖动来改变年份(<em class="ms"> dcc。滑块</em>)；</li><li id="ebe7" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated">两个图表:左边的图表显示了特定年份的生物乙醇产量；右边的图表显示了世界生物乙醇的产量。图表</li></ul><p id="2979" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们的回拨包括以下内容:</p><ul class=""><li id="1e4c" class="mt mu it lt b lu mn lx mo ma mv me mw mi mx mm my mz na nb bi translated">两个输入:一个用于选项卡组件，另一个用于滑块[ <em class="ms"> Input() </em> ]</li><li id="03ae" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated">两个输出:一个用于屏幕左侧的图表，另一个用于屏幕右侧的图表<em class="ms"> (Output()) </em></li><li id="374b" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated">函数build_graph，我们在其中对将显示在屏幕上的六个图表进行编码(<em class="ms"> def build_graph() </em>)</li></ul><h1 id="c4e7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">我们的代码</strong></h1><p id="9230" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们使用了一个<strong class="lt iu">公共领域数据集</strong>:按国家或地区划分的全球乙醇产量(百万加仑)。数据来源:<a class="ae ky" href="https://ethanolrfa.org/markets-and-statistics/annual-ethanol-production" rel="noopener ugc nofollow" target="_blank">可再生燃料协会(RFA) </a>。最后更新2021年6月[1]。</p><p id="1953" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">像往常一样，我们通过导入熊猫库作为<em class="ms"> pd </em>，Plotly Express作为<em class="ms"> px </em>，plotly.graph_objects作为<em class="ms"> go </em>，并将我们的<em class="ms"> csv </em>文件转换成dataframe来开始代码:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="5517" class="nm la it ni b gy nn no l np nq">import pandas as pd<br/>import plotly.express as px<br/>import plotly.graph_objects as go</span><span id="7879" class="nm la it ni b gy nr no l np nq"># Step 1: world bioethanol production (units in Mgal)<br/>df_bioet = pd.read_csv(path + 'world_bioethanol_2007_2020.csv',<br/>               index_col = False, sep = ';', engine = 'python',<br/>               header = 1)</span></pre><p id="4319" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">首先，我们必须执行某些替换，并将pandas对象转换为指定的数据类型:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="0ce7" class="nm la it ni b gy nn no l np nq">df_bioet['2007']  = df_bioet['2007'].str.replace(',','')<br/>df_bioet['2008']  = df_bioet['2008'].str.replace(',','')<br/>………………………………………………………………………………………………………………………………………………….<br/>df_bioet['2019']  = df_bioet['2019'].str.replace(',','')<br/>df_bioet['2020']  = df_bioet['2020'].str.replace(',','')</span><span id="8b35" class="nm la it ni b gy nr no l np nq">df_bioet = df_bioet.astype(<br/>           {'2007': int, '2008': int, '2009': int, '2010': int,<br/>            '2011': int, '2012': int, '2013': int, '2014': int,<br/>            '2015': int, '2016': int, '2017': int, '2018': int,<br/>            '2019': int, '2020': int},<br/>             errors = 'ignore')</span><span id="663d" class="nm la it ni b gy nr no l np nq">df_bioet['Country']= df_bioet['Country'].apply(str)<br/>tipo1 = df_bioet.dtypes</span></pre><p id="67cc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们必须对原始数据帧进行一定数量的修改，以将其转换为适合绘图的数据帧:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="aa5c" class="nm la it ni b gy nn no l np nq">df_bioet_f1 = df_bioet.iloc[-1:]<br/>df_bioet_f1 = df_bioet_f1.transpose()</span><span id="23e2" class="nm la it ni b gy nr no l np nq">df_bioet_f1.columns = df_bioet_f1.iloc[0]<br/>df_bioet_f1 = df_bioet_f1[1:]</span><span id="81e3" class="nm la it ni b gy nr no l np nq">df_bioet_f1.index.names = ['Year']<br/>df_bioet_f1.reset_index(level = 0, inplace = True)</span><span id="1cc9" class="nm la it ni b gy nr no l np nq">df_bioet_f2 = df_bioet.iloc[:-1]</span></pre><p id="ccc5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面的屏幕截图显示了名为df_bioet_f2的数据帧的记录:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/16ff9869321c9c79b55363202b960fed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*tHfL2lIYVtmMS63FuFWsZg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="339e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在我们准备好第一张图表:一张特定年份世界生物乙醇产量的<a class="ae ky" rel="noopener" target="_blank" href="/pie-donut-charts-with-plotly-d5524a60295b"> <strong class="lt iu">标准饼状图</strong></a>；</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="8ad4" class="nm la it ni b gy nn no l np nq">h1 = 600<br/>w1 = 600<br/>year = '2007'<br/>text_title = "World Bioethanol Production "<br/>titlefont  = dict(family = 'Arial', color='white', size= 30)</span><span id="3a05" class="nm la it ni b gy nr no l np nq">col_discr_map = {'USA':'orange', 'Brazil':'darkgreen',<br/>                 'European Union':'blue', 'CANADA': 'yellow',<br/>                 'CHINA' : 'red','Rest of World' : 'darkred'}</span><span id="eb52" class="nm la it ni b gy nr no l np nq"># First Figure: pie for a specific year</span><span id="f57f" class="nm la it ni b gy nr no l np nq">fig1 = px.pie(data_frame = df_bioet_f2,<br/>              values = '2007', names = 'Country',<br/>              color = 'Country',<br/>              color_discrete_map= col_discr_map)</span><span id="4c91" class="nm la it ni b gy nr no l np nq">fig1.update_layout(template = 'plotly_dark',<br/>            title = dict(text = text_title + str(year),  x = 0.5),<br/>            title_font= titlefont,<br/>            width  = w1, height = h1)</span></pre><p id="af88" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们的第二张图是生物乙醇生产区域的<strong class="lt iu">多线图</strong>:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="2763" class="nm la it ni b gy nn no l np nq">xyaxesfont = dict(family='Verdana', color='white', size= 15)<br/>xytickfont = dict(family='Calibri', color='white', size= 15)</span><span id="812b" class="nm la it ni b gy nr no l np nq"># Second Figure: line chart for productive regions</span><span id="f5d2" class="nm la it ni b gy nr no l np nq">df_bioet_f4 = df_bioet_f2.transpose()<br/>df_bioet_f4.columns = df_bioet_f4.iloc[0]<br/>df_bioet_f4 = df_bioet_f4[1:]</span><span id="9336" class="nm la it ni b gy nr no l np nq">df_bioet_f4.rename(columns={'Country': 'Year'})<br/>df_bioet_f4.index.names = ['Year']<br/>df_bioet_f4.reset_index(level = 0, inplace = True)</span><span id="8110" class="nm la it ni b gy nr no l np nq">fig2 = px.line(df_bioet_f4, x = 'Year', y = ['USA', 'Brazil', <br/>               'European Union','Canada',<br/>               'China', 'Rest of World'],<br/>                color_discrete_map= col_discr_map)</span><span id="e6ba" class="nm la it ni b gy nr no l np nq">fig2.update_layout(template = 'plotly_dark',<br/>                   hovermode = 'y',<br/>                   legend_title="Region",<br/>                   width  = w1 +200, height = h1)</span><span id="9c08" class="nm la it ni b gy nr no l np nq">fig2.update_xaxes(title_text = 'Year',<br/>                  title_font = xyaxesfont,<br/>                  tickfont   = xytickfont)</span><span id="9d06" class="nm la it ni b gy nr no l np nq">fig2.update_yaxes(title_text = "Production (Mgal)",<br/>                  title_font = xyaxesfont,<br/>                  tickfont   = xytickfont)</span></pre><p id="9bac" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在是时候开始开发我们的应用程序了。</p><p id="ea96" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在本文中，我们假设您已经安装了库Dash如果没有，请遵循这些说明<a class="ae ky" href="https://dash.plotly.com/installation" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="86aa" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">首先我们需要导入以下库:<em class="ms">破折号</em>，主库；<em class="ms">dash _ html _ components(html)</em>用于构建布局；<em class="ms">dash _ core _ components(DCC)</em>渲染一组选项卡、一个滑块和plotly图形；<em class="ms">输出，输入</em>来自模块<em class="ms"> dash.dependencies </em>的函数用于回调装饰器。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="f71b" class="nm la it ni b gy nn no l np nq">import dash<br/>from dash import html<br/>from dash import dcc<br/>from dash.dependencies import Output, Input</span></pre><p id="57fb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，是时候定义一些<em class="ms"> css </em>属性来对布局中包含的组件(尤其是选项卡)进行样式化了:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="0462" class="nm la it ni b gy nn no l np nq">external_stylesheets=['https://codepen.io/chriddyp/pen/bWLwgP.css']</span><span id="9022" class="nm la it ni b gy nr no l np nq">app = dash.Dash(__name__, external_stylesheets=external_stylesheets)</span><span id="aa51" class="nm la it ni b gy nr no l np nq">tab_style = {"background": "darkred",'color': 'white',<br/>             'text-transform': 'uppercase',<br/>             'justify-content': 'center',<br/>             'border': 'grey','border-radius': '10px',<br/>             'font-size': '12px','font-weight': 600,<br/>             'align-items': 'center','padding':'12px'}</span><span id="90be" class="nm la it ni b gy nr no l np nq">tab_selected_style = {"background": "darkblue",'color': 'white',<br/>                      'text-transform': 'uppercase',<br/>                      'justify-content': 'center',<br/>                      'border-radius': '10px',<br/>                      'font-weight': 600,'font-size': '12px',<br/>                      'align-items': 'center','padding':'12px'}</span></pre><p id="e41e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们的布局(<em class="ms"> app.layout) </em>包括一个标题，三个标签(<em class="ms"> dcc。选项卡</em>)，滑块(<em class="ms"> dcc。滑块</em>)，和两个图表(<em class="ms"> dcc。图表</em>)。都是用<em class="ms"> html包装的。</em>div([])容器。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="732c" class="nm la it ni b gy nn no l np nq">app.layout= html.Div(children =[html.Div([<br/>             html.H1(children = 'World Bioethanol Production',<br/>               style = {'textAlign' : 'center', 'color':'darkblue',<br/>                        'fontSize'  : '30px', 'fontWeight': 'bold'}<br/>                     ),<br/>               html.Br(),<br/>             html.Div([<br/>               html.Br(),<br/>               dcc.Tabs(id="Chart_Tabs",<br/>                        value='Chart_P',<br/>                        children=[<br/>                        dcc.Tab(label='PieChart/LineChart',<br/>                                value='Chart_P',<br/>                                style=tab_style,<br/>                                selected_style=tab_selected_style),<br/>                        dcc.Tab(label='Treemap/StackedBars',<br/>                                value='Chart_T',<br/>                                style=tab_style,<br/>                                selected_style=tab_selected_style),<br/>                        dcc.Tab(label='Sunburst/StackedAreas',<br/>                                value='Chart_S',<br/>                                style=tab_style,<br/>                                selected_style=tab_selected_style),<br/>                                    ]),<br/>               html.Div(id='Tabs_Content'),<br/>               html.Br(),<br/>            html.Div([<br/>               html.Br(),<br/>               html.Div([html.H6('Drag to change the year')],<br/>                                 style={'text-align': 'Left'}),<br/>               dcc.Slider(id = "Year_Slider", updatemode = 'drag',<br/>                          min=2007, max=2020,step=1,value=2007,<br/>                          tooltip={"placement":"bottom",<br/>                          "always_visible": True}),<br/>                         ]),<br/>            html.Div([<br/>               html.Br(),<br/>               dcc.Graph(id = 'A-reactive-graph', figure = fig1,<br/>                         style={'width': '80vh',<br/>                         'display': 'inline-block'}),<br/>                      ], className = 'five columns'),<br/>            html.Div([<br/>               html.Br(),<br/>               dcc.Graph(id = 'A-static-graph', figure = fig2,<br/>                         style={'width': '80vh',<br/>                         'display': 'inline-block'}),<br/>                      ], className = 'six columns'),<br/>                   ]),<br/>                 ]),<br/>             ])</span></pre><p id="4b86" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如前所述，我们的回调装饰器由<strong class="lt iu">两个输入</strong>(一个用于选项卡组件，另一个用于滑块)和<strong class="lt iu">两个输出</strong>(一个用于屏幕左侧的图表，另一个用于屏幕右侧的图表):</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="551f" class="nm la it ni b gy nn no l np nq">@app.callback(Output('A-reactive-graph',  'figure'),              <br/>              Output('A-static-graph',    'figure'),            [Input(component_id='Chart_Tabs',component_property='value'),       Input(component_id='Year_Slider',component_property='value')])</span></pre><p id="d1e0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们在回调函数<em class="ms"> build_graph: </em>中编写了六个图表</p><ol class=""><li id="9d41" class="mt mu it lt b lu mn lx mo ma mv me mw mi mx mm nt mz na nb bi translated">图1，一个饼状图；</li><li id="15a9" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm nt mz na nb bi translated">图2，多线图表；</li><li id="4d56" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm nt mz na nb bi translated">图3，一个<a class="ae ky" rel="noopener" target="_blank" href="/treemaps-why-and-how-cfb1e1c863e8">树形图</a>；</li><li id="0c0a" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm nt mz na nb bi translated">图4，<a class="ae ky" rel="noopener" target="_blank" href="/stacked-bar-charts-with-plotly-express-85885e91874f">堆积条形图</a>；</li><li id="30a8" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm nt mz na nb bi translated">图7，一张<a class="ae ky" href="https://medium.com/analytics-vidhya/treemaps-sunburst-charts-with-plotly-c87670cb1897" rel="noopener">旭日图</a>；</li><li id="aefd" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm nt mz na nb bi translated">图六，<a class="ae ky" rel="noopener" target="_blank" href="/area-charts-with-plotly-express-510a1f12ac11">堆叠区域</a>。</li></ol><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="c3e6" class="nm la it ni b gy nn no l np nq">def build_graph(value_T, value_S):<br/>    if value_T ==   'Chart_P':<br/>       fig1 = px.pie(data_frame = df_bioet_f2,<br/>                     values = str(value_S), names = 'Country',<br/>                     color  = 'Country',<br/>                     color_discrete_map= col_discr_map)<br/>       fig1.update_layout(template = 'plotly_dark',<br/>                                     + str(value_S),  x = 0.5),<br/>                          title_font= titlefont,<br/>                          width  = w1, height = h1)</span><span id="d468" class="nm la it ni b gy nr no l np nq">       fig2 = px.line(df_bioet_f4, x = 'Year', y = ['USA', 'Brazil',<br/>              'European Union','Canada', 'China', 'Rest of World'],<br/>               color_discrete_map= col_discr_map)</span><span id="0cc4" class="nm la it ni b gy nr no l np nq">       fig2.update_layout(template = 'plotly_dark',<br/>                          title = dict(text = "World Production ",<br/>                                      x = 0.5),<br/>                          title_font= titlefont,<br/>                          hovermode = False,<br/>                          legend_title="Region",<br/>                          width  = w1 +200, height = h1)</span><span id="72ca" class="nm la it ni b gy nr no l np nq">       fig2.update_xaxes(title_text = 'Year',<br/>                         title_font = xyaxesfont,<br/>                         tickfont =   xytickfont)</span><span id="4645" class="nm la it ni b gy nr no l np nq">       fig2.update_yaxes(title_text = "Production (Mgal)",<br/>                         title_font = xyaxesfont,<br/>                         tickfont =   xytickfont)</span><span id="59e2" class="nm la it ni b gy nr no l np nq">      return fig1, fig2,</span><span id="44e4" class="nm la it ni b gy nr no l np nq">   elif value_T == 'Chart_T':<br/>        fig3 = px.treemap(df_bioet_f2, path = ['Country'],<br/>                          values = str(value_S),<br/>                          color  = 'Country',<br/>                          color_discrete_map= col_discr_map)</span><span id="ac1e" class="nm la it ni b gy nr no l np nq">        fig3.update_layout(template = 'plotly_dark',<br/>                           title = dict(text = "Production Year "<br/>                                        + str(value_S),  x = 0.5),<br/>                           title_font=  titlefont,<br/>                           hovermode = 'y',<br/>                           width  = w1, height = h1)</span><span id="47e0" class="nm la it ni b gy nr no l np nq">       fig3.data[0].textinfo = 'label + value'<br/>       fig3.data[0].hovertemplate = '%{label}&lt;br&gt;%{value}'</span><span id="8eac" class="nm la it ni b gy nr no l np nq">       fig4 = go.Figure(data=[<br/>                 go.Bar(name='USA',x=df_bioet_f4['Year'],  <br/>                                   y=df_bioet_f4['USA'],<br/>                        marker_color = 'orange'), <br/>                 go.Bar(name='Brazil',x=f_bioet_f4['Year'],<br/>                                      y=df_bioet_f4['Brazil'],<br/>                        marker_color = 'darkgreen'),</span><span id="1026" class="nm la it ni b gy nr no l np nq">                 go.Bar(name='Eur.Union',x=df_bioet_f4['Year'],<br/>                             y=df_bioet_f4['European <br/>                              Union'],<br/>                        marker_color = 'blue'),<br/>                 go.Bar(name='Canada',x=df_bioet_f4['Year'],    <br/>                                     y=df_bioet_f4['Canada'],       <br/>                       marker_color = 'yellow'),<br/>                 go.Bar(name='China',x=df_bioet_f4['Year'],     <br/>                                    y=df_bioet_f4['China'],<br/>                        marker_color = 'red'),<br/>                 go.Bar(name='Rest of World',x=df_bioet_f4['Year'],   <br/>                                   y=df_bioet_f4['Rest of World'],<br/>                        marker_color = 'darkred'),]</span><span id="75b6" class="nm la it ni b gy nr no l np nq">       fig4.update_layout(barmode='stack')<br/>       fig4.update_layout(template = 'plotly_dark',<br/>                          title = dict(text = "World Production ",   <br/>                                       x = 0.5),<br/>                          title_font= titlefont,<br/>                          hovermode = False,<br/>                          width  =  w1 + 200, height = h1)</span><span id="cc66" class="nm la it ni b gy nr no l np nq">       fig4.update_xaxes(title_text = 'Year',<br/>                         title_font = xyaxesfont,<br/>                         tickfont =   xytickfont)</span><span id="f1b9" class="nm la it ni b gy nr no l np nq">       fig4.update_yaxes(title_text = "Production (Mgal)",<br/>                         title_font = xyaxesfont,<br/>                         tickfont =   xytickfont)<br/>       return fig3, fig4,<br/>    elif value_T == 'Chart_S':<br/>       fig7 = px.sunburst(df_bioet_f2, path = ['Country'],<br/>                            values = str( value_S),<br/>                            color  = 'Country',<br/>                            color_discrete_map= col_discr_map)</span><span id="5d3b" class="nm la it ni b gy nr no l np nq">       fig7.update_layout(template = 'plotly_dark',<br/>                            title = dict(text = "Production Year "<br/>                                         + str(value_S),  x = 0.5),<br/>                            title_font=  titlefont,<br/>                            hovermode = 'y',<br/>                            width  = w1, height = h1)</span><span id="f261" class="nm la it ni b gy nr no l np nq">       fig7.data[0].textinfo = 'label + value'<br/>       fig7.data[0].hovertemplate = '%{label}&lt;br&gt;%{value}' <br/>  <br/>       fig6 = go.Figure()<br/>       fig6.add_trace(go.Scatter(x = df_bioet_f4['Year'], <br/>                                 y = df_bioet_f4['USA'],<br/>                                 name = 'USA',<br/>                                 mode = 'lines', <br/>                             line= dict(width=0.5, color='orange'),<br/>                                 stackgroup = 'one'))<br/>       fig6.add_trace(go.Scatter(x = df_bioet_f4['Year'],<br/>                                 y = df_bioet_f4['Brazil'],<br/>                                 name = 'BRAZIL',<br/>                                 mode = 'lines', <br/>                            line= dict(width=0.5,color='darkgreen'),<br/>                                stackgroup = 'one'))<br/>       fig6.add_trace(go.Scatter(x=df_bioet_f4['Year'],<br/>                                 y=df_bioet_f4['European Union'],<br/>                                 name = 'EUROPEAN UNION',<br/>                                 mode = 'lines',          <br/>                             line=dict(width=0.5, color='blue'),<br/>                                stackgroup = 'one'))\<br/>       fig6.add_trace(go.Scatter(x = df_bioet_f4['Year'], <br/>                                 y = df_bioet_f4['Canada'],<br/>                                 name = 'CANADA',<br/>                                 mode = 'lines', <br/>                             line= dict(width=0.5,color='yellow'),<br/>                                 stackgroup = 'one'))<br/>       fig6.add_trace(go.Scatter(x = df_bioet_f4['Year'],<br/>                                 y = df_bioet_f4['China'],<br/>                                 name = 'CHINA',<br/>                                 mode = 'lines',  <br/>                             line=dict(width=0.5, color='red'),<br/>                                stackgroup = 'one'))<br/>       fig6.add_trace(go.Scatter(x = df_bioet_f4['Year'],<br/>                                 y = df_bioet_f4['Rest of World'],<br/>                                 name = 'REST OF WORLD',<br/>                                 mode = 'lines',       <br/>                             line=dict(width=0.5, color='darkred'),<br/>                                stackgroup = 'one'))</span><span id="4e06" class="nm la it ni b gy nr no l np nq">       fig6.update_layout(template = 'plotly_dark',<br/>                            title = dict(text = "World Production ",                       <br/>                                         x = 0.5, y = 0.95),             <br/>                            title_font= titlefont,<br/>                            hovermode = False,<br/>                            width  =  w1 + 200, height = h1)<br/>       fig6.update_xaxes(title_text = 'Year',<br/>                           title_font = xyaxesfont,<br/>                           tickfont =   xytickfont)     <br/>       fig6.update_yaxes(title_text = "Production (Mgal))",<br/>                           title_font = xyaxesfont,<br/>                           tickfont =   xytickfont)<br/>       return fig7, fig6,</span></pre><h1 id="a79b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">我们的申请</strong></h1><p id="9f5b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">运行服务器需要下面两行代码:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="399d" class="nm la it ni b gy nn no l np nq">if __name__ == '__main__':<br/>     app.run_server(debug = False, port = 8080)</span></pre><p id="b374" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您应该会在Python开发环境中看到一条类似于以下屏幕截图所示的消息:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/b244522b9c90fc83c4768fa54ecb065a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*ZqCdRt-_taZOfHndouBfrg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><p id="74db" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在您的浏览器中复制<em class="ms"> url </em>，您将看到我们应用程序的第一个屏幕，其中有饼状图和多条线图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/ebb8a796d102942fd424aeddb6c4d29d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BVRaybeenEptoVZbflO89g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1:应用程序的第一个屏幕。图片由作者用破折号。</p></figure><p id="a38e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">单击带有文本树形图/堆积条形图的选项卡，您将看到我们应用程序的第二个屏幕，带有树形图和堆积条形图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/2912e8c59e9c174ae37be4c000be6383.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iEPMsvESSYe56Eq08goWLA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2:应用程序的第二个屏幕。图片由作者用破折号。</p></figure><p id="25b8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">单击带有文本旭日图/堆积面积的选项卡，您将看到我们的应用程序的第三个屏幕，上面有旭日图和堆积面积图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/8c79e604f18154612ae0de1b32363ee4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*FBZ6jBE5bZ-Gl9giuD0Mpg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3:应用程序的第三个屏幕。图片由作者用破折号。</p></figure><p id="c391" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">拖动任一屏幕上的滑块，您会看到左侧图表发生相应变化，而右侧图表保持不变:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/3b87958b124709a94058eb90189bf129.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*4xnTY_CMQM13kTnzfEEXzQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4:拖动后在第二个屏幕上产生的变化。图片由作者用破折号。</p></figure><h1 id="c4f6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">分析</strong></h1><p id="ea5b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">第一屏:饼状图之所以吸引人，是因为它们简单且广为人知。但它们不太适合进行精确的比较，尤其是当类别之间的差异很小时。我们的多线图表也有它的缺点，因为四条较低的线是交叉重叠的。</p><p id="574e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">第二个屏幕:树形图适用于在<strong class="lt iu">非层级扁平结构中表示相对比例，在</strong>相对较小的空间中比较嵌套矩形方案中组成整体的部分。堆积条形图广泛用于<strong class="lt iu">动态构成分析</strong>以显示类别构成如何随时间变化。</p><p id="165a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">第三个屏幕:旭日图类似于树状图，但是类别之间的比较非常困难，因为我们用切片和角度而不是矩形来表示它们。堆积面积图存在一些困难，因为每条线都跟随下面的线的基线，随着时间的推移，每个特定的趋势都类似于下面的趋势。</p><h1 id="d9b2" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">结论</strong></h1><p id="866e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">对于前面描述的情况(随时间变化的趋势+成分分析)，最好的叙述方式是将树形图与堆积条形图结合起来。</p><p id="baf1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你对这篇文章感兴趣，请阅读<a class="ae ky" href="https://medium.com/@dar.wtz" rel="noopener">我以前的</a>(https://medium.com/@dar.wtz)</p><p id="239e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">[1]年度乙醇产量，RFA，可再生燃料协会，<a class="ae ky" href="https://ethanolrfa.org/markets-and-statistics/annual-ethanol-production" rel="noopener ugc nofollow" target="_blank">https://ethanolrfa . org/markets-and-statistics/annual-Ethanol-Production</a></p></div></div>    
</body>
</html>