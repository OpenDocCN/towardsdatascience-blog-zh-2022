<html>
<head>
<title>How I apply Continuous Integration to Machine Learning Projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何将持续集成应用到机器学习项目中</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-i-apply-continuous-integration-to-machine-learning-projects-8273274a565a#2022-01-26">https://towardsdatascience.com/how-i-apply-continuous-integration-to-machine-learning-projects-8273274a565a#2022-01-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""><h1 id="5dd7" class="pw-post-title io ip iq bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">我如何将持续集成应用到机器学习项目中</h1></div><div class=""><h2 id="9647" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">CI在软件项目中非常有用，也可以为ML项目带来好处。</h2></div><h1 id="d558" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">介绍</h1><p id="dc33" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">持续集成(CI)已经被证明是软件开发中的一个极好的实践。然而，当涉及到机器学习(ML)项目时，由于工作的不同性质，CI并没有被应用(甚至没有被提及)太多。</p><p id="01c6" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">从我的经验来看，CI在软件项目中非常有用，我确信它也能给ML项目带来好处。因此，我尝试使用开源工具为一个ML项目构建一个简单的CI工作流。在这篇文章中，我将分享它的样子以及我是如何做到的。</p><h1 id="b86a" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">什么是持续集成？</h1><p id="e763" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">持续集成和交付(CI/CD)是一种软件开发实践，在这种实践中，在相同代码基础上工作的软件开发人员将代码集成到主分支，并定期交付他们的产品，以便对系统所做的更改更易于管理。CI/CD已经成为软件产品开发的核心，因为如果处理得当，它可以确保软件质量并以可持续的方式提高生产率。此外，CI/CD与敏捷方法学也相处得很好，这使得它在软件行业中更受欢迎。</p><p id="c123" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">CI/CD的工作流程从开发人员在他的本地环境中修改代码开始，直到它满足验收标准。然后，他必须通过运行测试来确保他所做的更改不会破坏现有的功能。一旦通过，开发者将把新代码提交给CI/CD服务器，CI/CD服务器将在中立环境下再次运行测试，以确保可再现性。如果一切正常，新代码将被合并到主分支，这样新版本就可供参与同一项目的其他人使用，并在需要时交付。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi ly"><img src="../Images/bf1efdd45d1fc46ebafa6d8c21eaed70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B-G63XwcKOPm9FfD2DFTRw.jpeg"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">简单的持续集成工作流(图片由作者提供)。</p></figure><h1 id="831e" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">机器学习项目中的CI/CD挑战</h1><p id="f434" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">机器学习的采用在过去几年中增长迅速。通常，这是通过将ML模型嵌入到作为系统一部分的应用程序或数据管道中来实现的。这一趋势给CI/CD带来了新的挑战，因为与传统软件不同，ML应用程序不仅会受到代码变化的影响，还会受到模型训练所依据的数据的影响。</p><p id="0188" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">另一个关键挑战是质量控制。在软件项目中，单元/集成/回归测试确保集成和交付变更是否安全。如果所有的测试都通过了，它就通过了，否则就没有通过。由于几个原因，这不适合ML模型。首先，输入和输出之间的映射可以是动态的，因为某些类型的ML模型具有不确定的行为。第二，ML模型的输入可以是极其复杂的格式，例如高维向量或图像。像开发人员编写测试时通常所做的那样生成输入将是非常低效和令人疲惫的(如果可能的话)。</p><h1 id="8925" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">为ML项目构建CI工作流</h1><h2 id="ba20" class="mo kg iq bd kh mp mq dn kl mr ms dp kp lg mt mu kr lk mv mw kt lo mx my kv mz bi translated">先决条件</h2><p id="805a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">上一节提到了两个必须解决的关键挑战。对于数据版本控制，有一些开源工具可以用来解决这个现成的问题。我选择的这个叫做<a class="ae na" href="https://dvc.org/" rel="noopener ugc nofollow" target="_blank">数据版本控制</a> (DVC)，主要是因为它的功能可以通过命令行界面获得，不需要任何代码。另外，DVC被设计成可以直观地与Git一起工作，并且还提供了其他一些不错的特性，比如ML pipeline。</p><p id="4ff3" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">质量控制更加棘手，因为它不再是一个通过或失败的问题。两个ML模型可以对相同的数据进行预测，问题是哪一个更好(以及好多少)。准确性、损失和R分数等性能指标似乎是更合适的标准。</p><h2 id="6064" class="mo kg iq bd kh mp mq dn kl mr ms dp kp lg mt mu kr lk mv mw kt lo mx my kv mz bi translated">开发团队责任</h2><p id="2bbb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">使用评估度量代替测试既解决了问题，同时也产生了问题。一方面，它使标准更加合适。另一方面，正确的度量标准是特定于问题的，只有开发团队能够选择它们。所以不能标准化。</p><p id="910c" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">新的职责必须添加到开发团队中，以避免这个问题。由于评估指标将被用作质量关口，ML管道不仅要生成模型，还要生成性能报告。此外，报告应该遵循一个预定义的约定，这样它就可以跨分支进行比较。例如，它必须是JSON格式，位于名为<code class="fe nb nc nd ne b">model</code>的文件夹下，文件名为<code class="fe nb nc nd ne b">performance.json</code>，如下所示。</p><pre class="lz ma mb mc gt nf ne ng nh aw ni bi"><span id="e551" class="mo kg iq ne b gy nj nk l nl nm">{<br/>    "accuracy": 0.9219429016113281,<br/>    "precision": 0.9634803263573233,<br/>    "recall": 0.9050901747682986,<br/>    "iou": 0.8753447772456544<br/>}</span></pre><p id="428a" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">通过这种方式，团队可以自由地为他们的应用选择正确的度量标准，并通过在他们的ML管道中添加一些额外的工作来增加过程的透明度。</p><h2 id="0484" class="mo kg iq bd kh mp mq dn kl mr ms dp kp lg mt mu kr lk mv mw kt lo mx my kv mz bi translated">工作流程</h2><p id="141e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">综合所有因素，设计的工作流程如下:</p><ol class=""><li id="9405" class="nn no iq kz b la lt ld lu lg np lk nq lo nr ls ns nt nu nv bi translated">开发人员从main分支。</li><li id="6e76" class="nn no iq kz b la nw ld nx lg ny lk nz lo oa ls ns nt nu nv bi translated">开发人员在本地机器(或远程服务器)上进行更改和运行实验，直到得到想要的结果。</li><li id="810b" class="nn no iq kz b la nw ld nx lg ny lk nz lo oa ls ns nt nu nv bi translated">开发人员创建一个针对主要分支机构的PR。</li><li id="5d3c" class="nn no iq kz b la nw ld nx lg ny lk nz lo oa ls ns nt nu nv bi translated">CI服务器重新运行实验分支以确保再现性。</li><li id="dec0" class="nn no iq kz b la nw ld nx lg ny lk nz lo oa ls ns nt nu nv bi translated">CI服务器将性能指标与主分支进行比较，并报告给GitHub上的PR页面，以便其他成员可以查看。</li><li id="5760" class="nn no iq kz b la nw ld nx lg ny lk nz lo oa ls ns nt nu nv bi translated">如果获得批准，代码将被合并到main中。</li><li id="c509" class="nn no iq kz b la nw ld nx lg ny lk nz lo oa ls ns nt nu nv bi translated">CI服务器再次重新运行该实验，但这一次模型被推送到远程存储以供将来部署，并提供性能报告以供比较。</li></ol><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi ob"><img src="../Images/26ec5e7660b3887967109768b766d33d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R_bWFJbYjOOlblOkW6j8wg.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">ML项目的持续集成工作流(图片由作者提供)。</p></figure><h2 id="e9b5" class="mo kg iq bd kh mp mq dn kl mr ms dp kp lg mt mu kr lk mv mw kt lo mx my kv mz bi translated">履行</h2><p id="12fe" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">工作流是用GitHub动作实现的。它包含如下两个关键阶段:</p><p id="0204" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated"><strong class="kz ir"> <em class="oc">实验再现</em> </strong> <br/>再现性工作包括检验数据集和运行整个ML管道(预处理、训练和评估)。这些是使用两个DVC命令完成的:<code class="fe nb nc nd ne b">dvc pull</code>和<code class="fe nb nc nd ne b">dvc repro</code>。<br/><code class="fe nb nc nd ne b">dvc repro</code>运行ML管道并输出训练好的模型和性能报告(在一个简单的项目中，这可能等同于运行<code class="fe nb nc nd ne b">train.py</code>脚本)这是GitHub操作中的样子:</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="40d7" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated"><strong class="kz ir"> <em class="oc">报告生成</em> </strong> <br/>报告应该显示主分支和实验分支之间的性能比较，以便评审者可以看到变更如何影响模型。DVC通过<code class="fe nb nc nd ne b">dvc metrics diff</code>提供了这一功能，在这里您可以将当前变更的指标与任何公共分支进行比较。输出是这样一种人类可读的格式:</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="4c5c" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">使用GitHub Actions Marketplace上的<a class="ae na" href="https://github.com/marketplace/actions/create-or-update-comment" rel="noopener ugc nofollow" target="_blank"> Create or Update Comment </a>操作，该输出被保存到一个文件中并在PR页面上可见。</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="adb1" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">如果你感兴趣，完整的GitHub动作配置可以在<a class="ae na" href="https://github.com/thanakorn/cloud_segmentation/blob/main/.github/workflows/pr.yml" rel="noopener ugc nofollow" target="_blank">这里</a>找到。下图显示了创建请购单时的工作流程:</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi of"><img src="../Images/0ffeca930eed02ed89c3ae064bbd89bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ekhBsHmhC-bmrtWYxUrFzw.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">创建PR时，工作流程开始(图片由作者提供)。</p></figure><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi og"><img src="../Images/e7c257849d77b8225eb52250fdbea74a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xqN7yMcMfpSilNtT24Qr7g.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">CI服务器重现实验并比较性能(图片由作者提供)。</p></figure><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi oh"><img src="../Images/fcfdf1de1fcf5abff6d63effaca669d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dfPf5Ic6vboUJwlHytlghg.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">工作流执行完成时会生成报告(图片由作者提供)。</p></figure><h1 id="e92d" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">结论</h1><p id="5702" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">ML项目就像软件行业中的一种新型动物。将CI/CD应用到他们身上代表了与传统软件项目不同的挑战，因此需要不同的方法。本文提出的方法提供了一种将CI/CD应用于数据科学的方法。然而，它远非完美，有很大的改进空间。尽管如此，它仍然说明了CI/CD对ML作品是多么有用。</p></div></div>    
</body>
</html>