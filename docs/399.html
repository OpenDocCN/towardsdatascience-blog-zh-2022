<html>
<head>
<title>Build recommendation system using Scala, Spark and Hadoop</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用Scala、Spark和Hadoop构建推荐系统</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-recommendation-system-using-scala-spark-and-hadoop-d2ee35c97d3c#2022-01-13">https://towardsdatascience.com/build-recommendation-system-using-scala-spark-and-hadoop-d2ee35c97d3c#2022-01-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""><h1 id="ad4e" class="pw-post-title io ip iq bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">利用Scala、Spark和Hadoop构建推荐系统</h1></div><div class=""><h2 id="7aea" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在分布式Hadoop集群上使用Scala和Spark构建的电影推荐器</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/44c7747b6cb2f9fd2e33a87ec6c9342a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ZQEWxoWCcE5CJDnjSkT8w.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@tysonmoultrie?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">泰森·莫尔特里</a>在<a class="ae kv" href="https://unsplash.com/s/photos/movie?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="3934" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">推荐系统是一种广泛使用的机器学习技术，在电子商务(亚马逊，阿里巴巴)，视频流(网飞，迪士尼+)，社交网络(脸书，Linkedin)和其他许多领域都有很多应用。由于这些服务中的大量数据，现在大多数行业级推荐系统都构建在Spark和Hadoop这样的大数据框架中。所以在这篇博客中，我想向你展示我是如何使用Scala、Spark和Hadoop构建一个电影推荐系统的。</p><h1 id="e0f8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">1.推荐系统介绍</h1><h1 id="d89c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">1.1不同的推荐系统算法</h1><p id="7d75" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">推荐系统算法可以分为两种主要类型:基于内容的推荐和协同过滤。下面是一个描述它们之间差异的汇总表。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/027dc05b65b22f898859df1fbfb26d33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JP_-yjaBtN1x-UZ4Ct54BQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">推荐算法:基于内容与协同过滤(图片由作者提供)</p></figure><h1 id="2eb7" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">1.2协同过滤和Spark ALS</h1><p id="467a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在这篇文章中，我们将使用协同过滤作为推荐算法。协同过滤的工作原理是这样的:首先，我们把所有用户对所有项目的评分看作一个矩阵，这个矩阵可以分解为两个独立的矩阵，一个是用户矩阵，其中行代表用户，列是潜在因素；另一种是项目矩阵，其中行是潜在因素，列代表项目(见下图)。在这个因式分解过程中，评分矩阵中缺失的值可以被填充，作为用户对项目评分的预测，然后我们可以使用它们向用户提供推荐。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/a89648275ea6909a1e0341251bf43375.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mrsLV99J9jWxT0rw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="mr">协同过滤中的矩阵分解</em>(图片由作者提供)</p></figure><p id="8436" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" rel="noopener" target="_blank" href="/prototyping-a-recommender-system-step-by-step-part-2-alternating-least-square-als-matrix-4a76c58714a1"> ALS(交替最小二乘法)</a>是一种协作过滤的数学优化实现，它使用交替最小二乘法(ALS)和加权λ正则化(ALS-WR)来寻找最佳因子权重，以最小化预测和实际评级之间的最小二乘法。<a class="ae kv" href="https://spark.apache.org/docs/latest/ml-guide.html" rel="noopener ugc nofollow" target="_blank"> Spark的MLLib包</a>有一个<a class="ae kv" href="https://spark.apache.org/docs/latest/mllib-collaborative-filtering.html" rel="noopener ugc nofollow" target="_blank">内置的ALS函数</a>，我们将在本帖中使用。</p><h1 id="b4f9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">2.系统设置</h1><ul class=""><li id="a1d9" class="ms mt iq ky b kz mk lc ml lf mu lj mv ln mw lr mx my mz na bi translated">20.04.3</li><li id="e86e" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated">JDK 11.0.13</li><li id="ec5b" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated">Scala 2.12.11</li><li id="0ac1" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated">火花3.2.0</li><li id="ea22" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated">Hadoop 3.2.2</li><li id="c4a8" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated">IntelliJ IDEA (2021.3.1)</li></ul><p id="6b0b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于系统先决条件的详细设置，请跟随我在<a class="ae kv" href="https://towardsai.net/" rel="noopener ugc nofollow" target="_blank">上的<a class="ae kv" href="https://pub.towardsai.net/how-to-set-up-your-environment-for-spark-7820b84491ef" rel="noopener ugc nofollow" target="_blank">帖子</a>前往AI </a>。</p><h1 id="87a8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">3.资料组</h1><p id="d086" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在这个项目中，我们将使用来自明尼苏达大学双城分校的<a class="ae kv" href="https://creativecommons.org/publicdomain/zero/1.0/" rel="noopener ugc nofollow" target="_blank"> CC0许可证</a>的<a class="ae kv" href="https://grouplens.org/datasets/movielens/" rel="noopener ugc nofollow" target="_blank"> MovieLens数据集</a>。可以从<a class="ae kv" href="https://www.kaggle.com/prajitdatta/movielens-100k-dataset/metadata" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>下载<strong class="ky ir"> ml-100k </strong> (16M)。</p><p id="fe20" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行以下命令解压缩zip文件:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="5961" class="nl lt iq nh b gy nm nn l no np">unzip ml-100k.zip</span></pre><p id="2264" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你会看到解压后的<code class="fe nq nr ns nh b">ml-100k</code>文件夹包含多个文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/692ca3459fca2b8239bd6e69b07e3e9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IlPQQ97hOw6LQZLV.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="3eeb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们主要使用两个数据文件:</p><ul class=""><li id="c51d" class="ms mt iq ky b kz la lc ld lf nu lj nv ln nw lr mx my mz na bi translated"><code class="fe nq nr ns nh b">u.data</code>:用户评分数据，包括<strong class="ky ir">用户id </strong>、<strong class="ky ir">物品id </strong>、<strong class="ky ir">评分</strong>、<strong class="ky ir">时间戳</strong>。</li><li id="6c14" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated"><code class="fe nq nr ns nh b">u.item</code>:电影数据，包括<strong class="ky ir">项目id </strong>、<strong class="ky ir">电影名称</strong>、<strong class="ky ir">上映日期</strong>、<strong class="ky ir"> imdb url </strong>等。</li></ul><h1 id="00ff" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">4.火花运转</h1><h1 id="7386" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">4.1从Github克隆代码</h1><p id="96c0" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在Spark中运行之前，使用以下命令将代码从我的<a class="ae kv" href="https://github.com/haocai1992/MovieRecommender" rel="noopener ugc nofollow" target="_blank"> Github库</a>克隆到您的本地目录:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="40cc" class="nl lt iq nh b gy nm nn l no np">git clone <a class="ae kv" href="https://github.com/haocai1992/MovieRecommender.git" rel="noopener ugc nofollow" target="_blank">https://github.com/haocai1992/MovieRecommender.git</a></span></pre><p id="f774" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在IntelliJ IDEA中打开文件夹。您的项目结构应该如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/9db2415ddddd2f8bdc22b0b38af4724e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*W_W1mu1twcFndC4X.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="cf57" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">4.2在HDFS准备数据</h1><p id="ef66" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在我们开始之前，我们需要在终端中启动hadoop HDFS和YARN服务(参见本文<a class="ae kv" href="https://haocai1992.github.io/data/science/2022/01/11/how-to-set-up-your-environment-for-spark.html" rel="noopener ugc nofollow" target="_blank">中的</a>)。</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="f239" class="nl lt iq nh b gy nm nn l no np">$ hadoop namenode -format<br/>$ start-all.sh</span></pre><p id="d66c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后我们需要将ml-100k数据集上传到Hadoop HDFS:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="33f5" class="nl lt iq nh b gy nm nn l no np">$ hadoop fs -put ~/Downloads/ml-100k /user/caihao/movie</span></pre><h1 id="0678" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">4.3 Spark中的培训推荐模型</h1><p id="5e46" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">使用以下工具在Spark中训练推荐模型:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="3ae4" class="nl lt iq nh b gy nm nn l no np">$ spark-submit --driver-memory 512m --executor-cores 2 --class RecommenderTrain --master yarn --deploy-mode client ~/Desktop/spark_test/MovieRecommender/out/artifacts/MovieRecommender_jar/MovieRecommender.jar</span></pre><p id="deb2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用以下工具查看您在HDFS训练的模特:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="322f" class="nl lt iq nh b gy nm nn l no np">$ hadoop fs -ls -h /user/caihao/movie</span></pre><p id="036e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将在这里看到您的模型:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/e93ecdd80769efb6e51a7c4eae228286.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CPXBmsNB0ArkLB9j.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="ae7f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">4.4在Spark中生成建议</h1><p id="6c39" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">为Spark中的<code class="fe nq nr ns nh b">userID=100</code>推荐电影使用:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="c014" class="nl lt iq nh b gy nm nn l no np">$ spark-submit --driver-memory 512m --executor-cores 2 --class Recommend --master yarn --deploy-mode client ~/Desktop/spark_test/MovieRecommender/out/artifacts/MovieRecommender_jar2/MovieRecommender.jar --U 100</span></pre><p id="b044" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将看到以下输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/52b53f9a93f8e1a3b59fd11c5acefdb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ho7IUwcdM0m1-i13.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="5c26" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">或者在Spark中为<code class="fe nq nr ns nh b">movieID=200</code>推荐用户使用:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="3f59" class="nl lt iq nh b gy nm nn l no np">./bin/spark-submit --driver-memory 512m --executor-cores 2 --class Recommend --master yarn --deploy-mode client ~/Desktop/spark_test/MovieRecommender/out/artifacts/MovieRecommender_jar2/MovieRecommender.jar --M 200</span></pre><p id="4343" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将看到以下输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/bba0700e9018819d38cef173bbdc4d29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5EfIHQoLQHNH5bqq.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="5903" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">5.在数据块中运行PySpark版本</h1><p id="0a6b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果你不了解Scala，我还创建了一个Python版本的推荐系统！它使用PySpark并运行在Databricks上。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/25566566c10ab27842d50363eb731bb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JiAF2uPBuzz_zCph.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="8019" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里检查我的代码:<a class="ae kv" href="https://databricks-prod-cloudfront.cloud.databricks.com/public/4027ec902e239c93eaaa8714f173bcfc/1453840335288608/1737910144074584/970786577303733/latest.html" rel="noopener ugc nofollow" target="_blank">我的数据块笔记本</a>。</p><p id="9cf5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要了解更多关于如何在数据块上创建集群和运行Spark的信息，请查看本教程。</p><h1 id="d6fc" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">6.推荐系统设计</h1><p id="be7c" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们的系统设计如下。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/456d83d00e763f7fb20a3ef180452480.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qaYJET7TD6O2Kz7M.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="c58b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">总之，有两个Scala对象:</p><ul class=""><li id="9049" class="ms mt iq ky b kz la lc ld lf nu lj nv ln nw lr mx my mz na bi translated"><code class="fe nq nr ns nh b">RecommenderTrain.scala</code>:读取评级文件(<code class="fe nq nr ns nh b">u.data</code>)，准备数据，训练ALS模型，保存模型。</li><li id="33cd" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated"><code class="fe nq nr ns nh b">Recommender.scala</code>:读取电影文件(<code class="fe nq nr ns nh b">u.item</code>)，加载ALS模型，生成电影推荐。</li></ul><h1 id="3dec" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">7.履行</h1><h1 id="cd71" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">7.1培训ALS模型— <code class="fe nq nr ns nh b">RecommenderTrain.scala</code></h1><p id="b0af" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><code class="fe nq nr ns nh b">RecommenderTrain.scala</code>是一个Scala对象，包含三个主要方法。</p><h2 id="1653" class="nl lt iq bd lu oc od dn ly oe of dp mc lf og oh me lj oi oj mg ln ok ol mi om bi translated">7.1.1 <code class="fe nq nr ns nh b">prepareData</code></h2><p id="3607" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><code class="fe nq nr ns nh b">prepareData</code>从path中读取<strong class="ky ir"> ratings </strong>数据，解析有用字段并返回<code class="fe nq nr ns nh b">ratingsRDD</code>。</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="d2a0" class="nl lt iq nh b gy nm nn l no np">def PrepareData(sc: SparkContext, dataPath:String): RDD[Rating] = {<br/>    // reads data from dataPath into Spark RDD.<br/>    val file: RDD[String] = sc.textFile(dataPath)<br/>    // only takes in first three fields (userID, itemID, rating).<br/>    val ratingsRDD: RDD[Rating] = file.map(line =&gt; line.split("\t") match {<br/>      case Array(user, item, rate, _) =&gt; Rating(user.toInt, item.toInt, rate.toDouble)<br/>    })<br/>    println(ratingsRDD.first()) // Rating(196,242,3.0)<br/>    // return processed data as Spark RDD<br/>    ratingsRDD<br/>}</span></pre><h2 id="0ba5" class="nl lt iq bd lu oc od dn ly oe of dp mc lf og oh me lj oi oj mg ln ok ol mi om bi translated">7.1.2 <code class="fe nq nr ns nh b">ALS.train</code></h2><p id="ec5d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><code class="fe nq nr ns nh b">ALS.train</code>对<code class="fe nq nr ns nh b">ratingsRDD</code>进行显式评级训练，并返回一个<code class="fe nq nr ns nh b">MatrixFactorizationModel</code>对象。</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="1527" class="nl lt iq nh b gy nm nn l no np">val model: MatrixFactorizationModel = ALS.train(ratings=ratingsRDD, rank=5, iterations=20, lambda=0.1)</span></pre><p id="87a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于训练参数的信息:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/c6670bfaa56d4deb0e32f3fe0ff7da2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OPxdFYyw_8N-DBTQxXMJQg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><code class="fe nq nr ns nh b">ALS.train (Image by Author)</code>中的参数</p></figure><h2 id="bc06" class="nl lt iq bd lu oc od dn ly oe of dp mc lf og oh me lj oi oj mg ln ok ol mi om bi translated">7.1.3 <code class="fe nq nr ns nh b">saveModel</code></h2><p id="4448" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><code class="fe nq nr ns nh b">saveModel</code>将模型保存到路径。</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="4c4c" class="nl lt iq nh b gy nm nn l no np">def saveModel(context: SparkContext, model:MatrixFactorizationModel, modelPath: String): Unit ={<br/>    try {<br/>      model.save(context, modelPath)<br/>    }<br/>    catch {<br/>      case e: Exception =&gt; println("Error Happened when saving model!!!")<br/>    }<br/>  finally {<br/>  }<br/>  }<br/>}</span></pre><h1 id="9bd5" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">7.2生成建议— <code class="fe nq nr ns nh b">Recommend.scala</code></h1><p id="8c61" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><code class="fe nq nr ns nh b">Recommend.scala</code>是一个Scala对象，包含四个主要方法。</p><h2 id="6307" class="nl lt iq bd lu oc od dn ly oe of dp mc lf og oh me lj oi oj mg ln ok ol mi om bi translated">7.2.1 <code class="fe nq nr ns nh b">prepareData</code></h2><p id="40fd" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><code class="fe nq nr ns nh b">prepareData</code>从path中读取<strong class="ky ir"> movies </strong>数据，解析有用字段并返回<code class="fe nq nr ns nh b">movieTitle</code>。</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="c84e" class="nl lt iq nh b gy nm nn l no np">def prepareData(sc: SparkContext, dataPath:String): RDD[(Int, String)] ={<br/>    println("Loading Data......")<br/>    // reads data from dataPath into Spark RDD.<br/>    val itemRDD: RDD[String] = sc.textFile(dataPath)<br/>    // only takes in first two fields (movieID, movieName).<br/>    val movieTitle: RDD[(Int, String)] = itemRDD.map(line =&gt; line.split("\\|")).map(x =&gt; (x(0).toInt, x(1)))<br/>    // return movieID-&gt;movieName map as Spark RDD<br/>    movieTitle<br/>}</span></pre><h2 id="072a" class="nl lt iq bd lu oc od dn ly oe of dp mc lf og oh me lj oi oj mg ln ok ol mi om bi translated">7.2.2 <code class="fe nq nr ns nh b">MatrixFactorizationModel.load</code></h2><p id="5f41" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><code class="fe nq nr ns nh b">MatrixFactorizationModel.load</code>从路径加载ALS模型。</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="29a6" class="nl lt iq nh b gy nm nn l no np">val model: MatrixFactorizationModel = MatrixFactorizationModel.load(sc=sc, path=modelPath)</span></pre><h2 id="2efe" class="nl lt iq bd lu oc od dn ly oe of dp mc lf og oh me lj oi oj mg ln ok ol mi om bi translated">7.2.3 <code class="fe nq nr ns nh b">model.recommendProducts</code></h2><p id="10b2" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><code class="fe nq nr ns nh b">model.recommendProducts</code>为给定的用户ID推荐电影。</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="eb09" class="nl lt iq nh b gy nm nn l no np">val recommendP = model.recommendProducts(user=inputUserID, num=10)</span></pre><h2 id="dcf6" class="nl lt iq bd lu oc od dn ly oe of dp mc lf og oh me lj oi oj mg ln ok ol mi om bi translated">7.2.4 <code class="fe nq nr ns nh b">model.recommendUsers</code></h2><p id="684b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><code class="fe nq nr ns nh b">model.recommendUsers</code>为给定的itemID推荐用户。</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="7956" class="nl lt iq nh b gy nm nn l no np">val recommendU = model.recommendUsers(product=inputMovieID, num=10)</span></pre><h1 id="f333" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">8.摘要</h1><p id="8b61" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">好了，我们已经用Scala + Spark + Hadoop(用PySpark + Databricks)构建了一个推荐系统，祝贺你！我希望这篇文章对你有用。</p><p id="3cc6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Github回购:<a class="ae kv" href="https://github.com/haocai1992/MovieRecommender" rel="noopener ugc nofollow" target="_blank">https://github.com/haocai1992/MovieRecommender</a></p><div class="oo op gp gr oq or"><a href="https://github.com/haocai1992/MovieRecommender" rel="noopener  ugc nofollow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd ir gy z fp ow fr fs ox fu fw ip bi translated">GitHub-haokai 1992/moviere commender:使用Scala、Spark和…</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">(照片由Tyson Moultrie在Unsplash上提供)此回购包含此博客的源代码。推荐系统是一种…</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">github.com</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf kp or"/></div></div></a></div><h1 id="fb45" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">9.引文</h1><ul class=""><li id="383d" class="ms mt iq ky b kz mk lc ml lf mu lj mv ln mw lr mx my mz na bi translated"><strong class="ky ir">专题图片</strong>:由<a class="ae kv" href="https://unsplash.com/@tysonmoultrie?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">泰森摩尔</a>在<a class="ae kv" href="https://unsplash.com/s/photos/movie?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。<a class="ae kv" href="https://unsplash.com/photos/BQTHOGNHo08" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/BQTHOGNHo08</a>。</li><li id="abcb" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated">MovieLens数据集:F. Maxwell Harper和Joseph A. Konstan。2015.电影镜头数据集:历史和背景。ACM交互式智能系统汇刊(TiiS) 5，4，第19篇(2015年12月)，19页。DOI = http://dx . DOI . org/10.1145/2827872</li></ul><h1 id="b487" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">接触</h1><ul class=""><li id="c725" class="ms mt iq ky b kz mk lc ml lf mu lj mv ln mw lr mx my mz na bi translated"><strong class="ky ir">作者</strong>:蔡皋</li><li id="40b2" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated"><strong class="ky ir">电子邮件</strong>:<a class="ae kv" href="https://haocai1992.github.io/data/science/2022/01/13/haocai3@gmail.com" rel="noopener ugc nofollow" target="_blank">haocai3@gmail.com</a></li><li id="eed6" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated"><strong class="ky ir">Github</strong>:<a class="ae kv" href="https://github.com/haocai1992" rel="noopener ugc nofollow" target="_blank">https://github.com/haocai1992</a></li><li id="e257" class="ms mt iq ky b kz nb lc nc lf nd lj ne ln nf lr mx my mz na bi translated"><strong class="ky ir">领英</strong>:<a class="ae kv" href="https://www.linkedin.com/in/haocai1992/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/haocai1992/</a></li></ul></div></div>    
</body>
</html>