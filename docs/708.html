<html>
<head>
<title>Customize Your Data Frame with Pandas Crosstab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用熊猫交叉表自定义您的数据框</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/customize-your-data-frame-with-pandas-crosstab-843b4ca8fb5b#2022-01-25">https://towardsdatascience.com/customize-your-data-frame-with-pandas-crosstab-843b4ca8fb5b#2022-01-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""><h1 id="bba2" class="pw-post-title ir is it bd iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp bi translated">使用熊猫交叉表自定义您的数据框</h1></div><div class=""><h2 id="2b36" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">只需用交叉表透视您的表数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0d861ce33ae09bc12dfa23ab978cf9fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XXKE7Jt1u92S72U5"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">罗伯特·基恩在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="7844" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="818a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">交叉表函数是帮助您在Pandas中重塑数据的众多方法之一。乍一看，它的用途似乎与pivot类似，您可以使用Pandas Crosstab执行许多与Pandas Pivot Table相同的操作。然而，有一些特殊的区别:</p><ul class=""><li id="db23" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm mu mv mw mx bi translated">交叉表支持您规范化生成的数据框并返回百分比值。</li><li id="96c5" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">函数的输入不一定是数据帧。对于它的行和列，它也可以接受类似数组的对象。</li></ul><p id="df73" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">本文将为您提供一个获得大多数特性的简明摘要。</p><h1 id="78cb" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">资料组</h1><p id="d96e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在本文中，我将使用一个名为“Taxis”的公开可用的<code class="fe ng nh ni nj b">seaborn</code>数据集，可以通过以下方式轻松获得:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="7401" class="no la it nj b gy np nq l nr ns">import seaborn as sns </span><span id="115a" class="no la it nj b gy nt nq l nr ns">df = sns.load_dataset('taxis')<br/>df.head()</span></pre><p id="e00c" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">以下是数据集的一瞥:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/108852456501f72c045629292684e681.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k0z52LW_CJPdlAzI90oFXw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1:出租车数据集——作者提供的图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/57424c764abba75be253fd0675006646.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w0JXxiyPV2n8stAP09xv5A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2:数据信息—作者图片</p></figure><p id="76ee" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">现在，让我们开始看看我们有什么。</p><h1 id="672c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">句法</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="2433" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">我们可以把一些基本参数的细节解释如下。更多详细信息见<a class="ae ky" href="https://pandas.pydata.org/docs/reference/api/pandas.crosstab.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> <em class="ny">本文档</em> </strong> </a>:</p><ul class=""><li id="87f6" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm mu mv mw mx bi translated"><strong class="lt iu"> index: V </strong>行中作为分组依据的值。</li><li id="9e82" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated"><strong class="lt iu">列:</strong>列中作为分组依据的值。</li><li id="34db" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated"><strong class="lt iu">值:</strong>要聚合的数据</li><li id="ae22" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated"><strong class="lt iu"> aggfunc: </strong>要使用的聚合函数</li><li id="ca6d" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated"><strong class="lt iu">边距:</strong>获取<strong class="lt iu"> </strong>行或列的小计</li><li id="c242" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated"><strong class="lt iu">规格化:</strong>将所有值除以值的总和</li></ul><p id="e83a" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">下面的例子将帮助你更好地理解这个概念。</p><h1 id="7388" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">分组</h1><p id="a3f0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">可以看出，该数据集包含关于取货地点和付款方式的信息。我想看看每种支付方式在每个地方使用了多少次。使用Crosstab可以简单地构建一个频率矩阵表，以不同地方每种支付方式的总计数作为值。</p><p id="0909" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">我将<strong class="lt iu"> <em class="ny">取货地点(区)</em> </strong>传递给<code class="fe ng nh ni nj b">index</code>参数，并将<strong class="lt iu"> <em class="ny">付款方式</em> </strong>设置为<code class="fe ng nh ni nj b">columns.</code></p><p id="bd0b" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">结果显示为多索引交叉表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/31af52b9f8e5b461dba6fe6b94d43e64.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*03mfvnIIlUuiQ4Nalymw2g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3:不同地点付款方式的频率表—按作者分类的图片</p></figure><h1 id="06dc" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">使用aggfunc</h1><p id="d6b8" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果我想计算取货地点在皇后区和布朗克斯区的现金用户的平均距离，那么对备选聚合函数应用<code class="fe ng nh ni nj b">aggfunc</code>。在这里，<code class="fe ng nh ni nj b">aggfunc = "mean”</code>将被使用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/7e22989a4aa1121675d00a2060925f1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*JJp2J9oE6c_4YHppEngK2w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4:平均距离</p></figure><p id="a036" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">因此，很容易观察到，顾客使用现金从皇后区旅行的平均距离约为5.3英里，这是从布朗克斯区(2.1英里)开始的距离的两倍多。</p><h1 id="b738" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">小计</h1><p id="d728" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">交叉表的一个便利特性是为行和列添加小计。例如，我很好奇不同取货地点的人用现金和信用卡支付的总费用。<code class="fe ng nh ni nj b">margins</code>和<code class="fe ng nh ni nj b">margins_name</code>在这种情况下应用如下代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/036338c66a29c8d91463869c590b96ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:870/format:webp/1*k7F0qyXd24eFSgfddLYgkw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图5:不同行政区每个类别的总和——按作者分类的图片</p></figure><h1 id="72d4" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">规范化交叉表</h1><p id="1194" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">以图5中的结果为例。对于每一行和每一列，我想找出每个值相对于小计的百分比。要查找行百分比值，<code class="fe ng nh ni nj b">normalize = "index"</code>。同时，<code class="fe ng nh ni nj b">normalize = "columns"</code>将帮助您找到基于列总数的百分比值。设置<code class="fe ng nh ni nj b">normalize = "all"</code>意味着值以整个数据框的百分比计算。</p><p id="a6f1" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">下图6描述了不同地点每种支付方式的百分比。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/0ee6ec10fa5768ce4796736bece42426.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*Ew8lcAbcI1D5AiNFt06JXA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图6:按列总数的标准化—按作者的图像</p></figure><h1 id="0ca9" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">为什么交叉表</h1><p id="57d6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">其实有些任务也可以用<strong class="lt iu"> <em class="ny"> unstack </em> </strong>和<strong class="lt iu"> <em class="ny"> pivot_ table来解决。然而，有时候，我发现交叉表是最容易使用的方法，因为它的语法容易记忆，转换也很快，而其他两种方法可能需要一些步骤才能得到最终答案。</em></strong></p><p id="1a8b" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">也就是说，根据不同的情况，使用让你最舒服的工作方法。</p><h1 id="3fd6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">参考</h1><h2 id="4704" class="no la it bd lb od oe dn lf of og dp lj ma oh oi ll me oj ok ln mi ol om lp on bi translated">数据集</h2><p id="71b5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><em class="ny"> Waskom，m .等人，2017年。mwaskom/seaborn:v 0 . 8 . 1(2017年9月)，芝诺多。可在:</em><a class="ae ky" href="https://doi.org/10.5281/zenodo.883859." rel="noopener ugc nofollow" target="_blank"><em class="ny">https://doi.org/10.5281/zenodo.883859.</em></a>以BSD-3许可证发布。</p><h2 id="b646" class="no la it bd lb od oe dn lf of og dp lj ma oh oi ll me oj ok ln mi ol om lp on bi translated">其他人</h2><div class="oo op gp gr oq or"><a href="https://pandas.pydata.org/docs/reference/api/pandas.crosstab.html" rel="noopener  ugc nofollow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd iu gy z fp ow fr fs ox fu fw is bi translated">pandas.crosstab - pandas 1.4.0文档</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">编辑描述</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">pandas.pydata.org</p></div></div></div></a></div><div class="oo op gp gr oq or"><a href="https://datagy.io/pandas-crosstab/" rel="noopener  ugc nofollow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd iu gy z fp ow fr fs ox fu fw is bi translated">熊猫交叉表-完整指南(带示例)*数据</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">Pandas交叉表功能是Pandas允许您定制数据的众多方式之一。从表面上看，它…</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">datagy.io</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf ks or"/></div></div></a></div></div></div>    
</body>
</html>