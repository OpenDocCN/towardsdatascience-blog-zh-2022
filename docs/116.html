<html>
<head>
<title>A Data Quality Test Approach with Python to Identify Non-Standard Character Patterns</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一种用Python识别非标准字符模式的数据质量测试方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-data-quality-test-approach-with-python-to-identify-non-standard-character-patterns-864affcb9195#2022-01-05">https://towardsdatascience.com/a-data-quality-test-approach-with-python-to-identify-non-standard-character-patterns-864affcb9195#2022-01-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""><h1 id="9fe9" class="pw-post-title io ip iq bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">一种用Python识别非标准字符模式的数据质量测试方法</h1></div><div class=""><h2 id="cca8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><strong class="ak">用Python高效执行数据质量测试的用户友好方法</strong></h2></div><p id="1372" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">在你的数据中有一些标准是必要的吗？除了标准测试之外，是否要进行全面的数据质量测试？在本帖中，我们将创建一个程序来学习数据中的常见字符模式，并将非标准字符模式报告为数据质量问题。另外，您不会因为额外的配置而浪费时间，因为它与不同的数据集兼容。</strong></p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/dfa95db3b63a9e81302b5e341e28e5ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rbJMgXY3eIJK08SFJilktA.jpeg"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">照片由艾尔丹姆·卡普奇(作者)拍摄</p></figure><p id="748d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一拿到数据，我们就直接投入探索。数据探索是任何数据相关项目的重要组成部分，它直接影响模型的效率和结果的准确性。检查数据质量有多种方法，如缺失值插补。对于需要预定义标准的字符字段，还有各种数据质量测试。例如，检查每个单元格的长度以识别过长或过短的单元格，或者搜索非字母字符。</p><p id="7c64" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们说得更清楚些。您有一个带有国家ISO代码和税号的客户数据集。您希望通过分别评估每个国家/地区的税号标准的符合性来确认每个客户的税号的正确性。考虑到您正在处理一个包含多个国家的数据集，第一种可能的方法是找到每个国家的税号标准，将信息嵌入到脚本中，并报告不符合这些标准的记录。如果您想对商店号、客户id或其他一些希望以标准格式存储在数据库中的列进行额外的测试，该怎么办呢？为数据的每个附加列定义模式可能会浪费时间。我们试图在这篇文章中提出一个解决这个具体挑战的方案。</p><p id="5f47" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是我们将要经历的步骤:</p><ol class=""><li id="f80b" class="lr ls iq kh b ki kj kl km ko lt ks lu kw lv la lw lx ly lz bi translated">目标</li><li id="5238" class="lr ls iq kh b ki ma kl mb ko mc ks md kw me la lw lx ly lz bi translated">探索数据</li><li id="f745" class="lr ls iq kh b ki ma kl mb ko mc ks md kw me la lw lx ly lz bi translated">清除数据(仅针对缺失值)</li><li id="6dd7" class="lr ls iq kh b ki ma kl mb ko mc ks md kw me la lw lx ly lz bi translated">拆分记录</li><li id="1ec1" class="lr ls iq kh b ki ma kl mb ko mc ks md kw me la lw lx ly lz bi translated">将记录转换为模式关键字</li><li id="ae20" class="lr ls iq kh b ki ma kl mb ko mc ks md kw me la lw lx ly lz bi translated">计算每个国家的模式频率</li><li id="a48f" class="lr ls iq kh b ki ma kl mb ko mc ks md kw me la lw lx ly lz bi translated">识别税号模式频率低于阈值的客户</li><li id="51eb" class="lr ls iq kh b ki ma kl mb ko mc ks md kw me la lw lx ly lz bi translated">报告</li></ol></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="e50a" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated"><strong class="ak"> 1。目标</strong></h1><p id="f532" class="pw-post-body-paragraph kf kg iq kh b ki ne jr kk kl nf ju kn ko ng kq kr ks nh ku kv kw ni ky kz la ij bi translated">在大多数情况下，id号长度相似，由字母和数字组成。在一些罕见的情况下，它们也可以有一些特殊字符，如“-”(破折号)或“*”(星号)。更重要的是，字母、数字和特殊字符在每个id中的位置通常是相同的。例如，假设有一个雇员id标准，在两个字母字符后有五个数字字符。在这种情况下，我们期望雇员数类似于AB-12345。这就是为什么我们将每条记录转换成一个模式键，这样AB-12345就被编码为L-L-S-N-N-N-N-N，在这一步之后，我们将计算模式频率。</p><p id="1a44" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用:</p><ul class=""><li id="8def" class="lr ls iq kh b ki kj kl km ko lt ks lu kw lv la nj lx ly lz bi translated">l代表字母</li><li id="1735" class="lr ls iq kh b ki ma kl mb ko mc ks md kw me la nj lx ly lz bi translated">n代表数字</li><li id="7e03" class="lr ls iq kh b ki ma kl mb ko mc ks md kw me la nj lx ly lz bi translated">s代表特殊字符</li></ul><p id="7b94" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我们将首先识别数据集中的常见模式(如果有的话)，然后找出不符合这些模式的记录。</p><h1 id="2c36" class="mm mn iq bd mo mp nk mr ms mt nl mv mw jw nm jx my jz nn ka na kc no kd nc nd bi translated"><strong class="ak"> 2。探索数据</strong></h1><p id="14af" class="pw-post-body-paragraph kf kg iq kh b ki ne jr kk kl nf ju kn ko ng kq kr ks nh ku kv kw ni ky kz la ij bi translated">为了简单起见，我们将只使用一列(税号)来检查是否有非标准格式的记录。由于数据隐私，不可能使用真实税号的数据集，所以我建了一个假的。你可以使用<a class="ae np" href="https://github.com/erdemcapci/Data_Quality/blob/main/Datasets/VAT_Dataset.csv" rel="noopener ugc nofollow" target="_blank"> CSV文件</a>的副本，在<a class="ae np" href="https://github.com/erdemcapci/Data_Quality/blob/main/Scripts/Data_Quality_Standards.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上到达<code class="fe nq nr ns nt b">Jupyter</code>笔记本。</p><p id="8368" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的数据集包含三列:</p><ul class=""><li id="f229" class="lr ls iq kh b ki kj kl km ko lt ks lu kw lv la nj lx ly lz bi translated"><strong class="kh ir">客户Id: </strong>客户的唯一标识符</li><li id="5b1c" class="lr ls iq kh b ki ma kl mb ko mc ks md kw me la nj lx ly lz bi translated"><strong class="kh ir">国家ISO代码:</strong>两个字母的国家代码</li><li id="94ac" class="lr ls iq kh b ki ma kl mb ko mc ks md kw me la nj lx ly lz bi translated"><strong class="kh ir">税号:</strong>任意字符类型的客户税号</li></ul><p id="09ab" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将使用<code class="fe nq nr ns nt b">pandas</code>库来处理数据。让我们导入数据，重命名列，并快速查看前5行。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/0cb86043e8a689497f18e11f20f4d502.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*JmDOwVpeMYXYZZZlVNfGDA.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">df的前5行(图片由作者提供)</p></figure><p id="49f0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有一个18060行3列的数据框。</p><h1 id="ed8f" class="mm mn iq bd mo mp nk mr ms mt nl mv mw jw nm jx my jz nn ka na kc no kd nc nd bi translated">3.清理数据</h1><p id="92ce" class="pw-post-body-paragraph kf kg iq kh b ki ne jr kk kl nf ju kn ko ng kq kr ks nh ku kv kw ni ky kz la ij bi translated">由于我们已经在致力于数据质量，详细的数据清理是不必要的。这就是为什么我们只删除<em class="nx"> Check_Column中缺少值的行。(潜在的额外清理是删除前导和尾随空格。)</em></p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="b71e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">总共有八个值缺失。删除这些行后，我们还剩18052行。由于没有税号信息，此八行列表需要在项目结束时作为非标准id记录单独报告。</p><p id="264f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，让我们用每个国家的客户数量来研究我们的数据。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ny"><img src="../Images/f9776c50bbe71160ccaa4916634a6bea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wbdfn9i8GU6mnetf-2RorQ.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">客户数量(图片由作者提供)</p></figure><h1 id="4401" class="mm mn iq bd mo mp nk mr ms mt nl mv mw jw nm jx my jz nn ka na kc no kd nc nd bi translated">4.拆分记录</h1><p id="92e6" class="pw-post-body-paragraph kf kg iq kh b ki ne jr kk kl nf ju kn ko ng kq kr ks nh ku kv kw ni ky kz la ij bi translated">以下是翻译的步骤:</p><ol class=""><li id="2868" class="lr ls iq kh b ki kj kl km ko lt ks lu kw lv la lw lx ly lz bi translated">让我们通过使用<code class="fe nq nr ns nt b">map</code>函数来确保<em class="nx"> Check_Column </em>值都是字符串。</li><li id="6fd4" class="lr ls iq kh b ki ma kl mb ko mc ks md kw me la lw lx ly lz bi translated">定义一个<code class="fe nq nr ns nt b">split</code>函数，我们将使用该函数将每个VAT号拆分成其字符。</li><li id="5a76" class="lr ls iq kh b ki ma kl mb ko mc ks md kw me la lw lx ly lz bi translated">拆分<em class="nx">校验_列</em>并将字符保存到<em class="nx"/><em class="nx">校验_列_拆分</em>列<em class="nx">。</em></li></ol><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/cc39cb19031f519998dd8565b2191f5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*AMEMj1iWgLy5m_2eNKbv4w.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">前5行(作者图片)</p></figure><p id="d018" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的列表包含了来自<em class="nx"> Check_Column的每个字符。</em></p><h1 id="86fe" class="mm mn iq bd mo mp nk mr ms mt nl mv mw jw nm jx my jz nn ka na kc no kd nc nd bi translated">5.将记录转换为模式关键字</h1><p id="3f27" class="pw-post-body-paragraph kf kg iq kh b ki ne jr kk kl nf ju kn ko ng kq kr ks nh ku kv kw ni ky kz la ij bi translated">在翻译阶段，我们受益于ASCII(美国信息交换标准代码)代码。每个字符都有一个ASCII码。幸运的是，ASCII码是根据字符类型排序的。你可以在<a class="ae np" href="http://ascii-code.com" rel="noopener ugc nofollow" target="_blank">ascii-code.com</a>网站上找到字符的ASCII表示列表。在Python中，我们将使用<code class="fe nq nr ns nt b">ord</code>函数来查找字符的ASCII表示。</p><p id="c5e4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们需要使用DEC(十进制)表示法对ASCII码进行分类:</p><ul class=""><li id="3e03" class="lr ls iq kh b ki kj kl km ko lt ks lu kw lv la nj lx ly lz bi translated"><strong class="kh ir">特殊字符:</strong>32–47/58–64/91–96/123+</li><li id="1e44" class="lr ls iq kh b ki ma kl mb ko mc ks md kw me la nj lx ly lz bi translated"><strong class="kh ir">字母:</strong>65–90/97–122</li><li id="6f3f" class="lr ls iq kh b ki ma kl mb ko mc ks md kw me la nj lx ly lz bi translated"><strong class="kh ir">数字:</strong>48–57</li></ul><p id="94fa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">注:</strong>根据您正在使用的语言，您可能需要添加更多的字母。在这种情况下，我们需要添加一个条件。例如，如果要将(( C带分音符)和(( A带分音符)翻译成字母，我们需要大写和小写字母ASCII表示。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/457433e7d64fefe0a6a9fc36882f5e8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:414/format:webp/1*uL221JBVGtNfC9Qo8ekINQ.png"/></div></figure><p id="dd73" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们为附加字母创建一个列表，并将它们的ASCII表示存储在另一个列表中，而不是一个接一个地翻译附加字母。在脚本的前面部分将附加字母分配给列表会更有效。在本文中，为了清楚起见，我将它添加到了本节中。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/c6563efdc717cbdefde7566ab4fe43b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*YIvOEua6_nBV_sersfxikA.png"/></div></figure><p id="604f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了额外的ASCII表示后，让我们创建我们的ASCII翻译函数。该函数遍历每个记录的字符，将它们转换成ASCII码，并将转换后的字符作为字符串输出。</p><p id="17fb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们使用<code class="fe nq nr ns nt b">apply</code>对每条记录运行该函数，并将翻译后的字符保存到<em class="nx">Check _ Column _ Translated</em>列中。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi oc"><img src="../Images/ff4e302627dbb305046f9805ea1d2dca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CEbqhxNPoeE3xrkYns8Jag.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">前5行(作者图片)</p></figure><p id="5232" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此时，我们可以猜测TT国家的标准模式，似乎是L-L-N-N-N-N-N-N-N-N-N，但是当然，现在说什么都为时过早。首先，我们需要计算每个国家的模式频率。</p><h1 id="ea9d" class="mm mn iq bd mo mp nk mr ms mt nl mv mw jw nm jx my jz nn ka na kc no kd nc nd bi translated">6.计算每个国家的模式频率</h1><p id="fcc5" class="pw-post-body-paragraph kf kg iq kh b ki ne jr kk kl nf ju kn ko ng kq kr ks nh ku kv kw ni ky kz la ij bi translated">要查找每个国家的模式频率:</p><ol class=""><li id="fcec" class="lr ls iq kh b ki kj kl km ko lt ks lu kw lv la lw lx ly lz bi translated"><code class="fe nq nr ns nt b">groupby</code>在国家和模式级别上的df，这将给我们按国家的模式的数量。</li><li id="19c1" class="lr ls iq kh b ki ma kl mb ko mc ks md kw me la lw lx ly lz bi translated"><code class="fe nq nr ns nt b">groupby</code>按国家的df，这将为我们提供客户总数。</li><li id="da75" class="lr ls iq kh b ki ma kl mb ko mc ks md kw me la lw lx ly lz bi translated"><code class="fe nq nr ns nt b">merge</code>两个分组的表格都能够计算出频率。</li><li id="276d" class="lr ls iq kh b ki ma kl mb ko mc ks md kw me la lw lx ly lz bi translated">通过将模式数除以该国家的客户总数来计算模式百分比。</li></ol><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi od"><img src="../Images/b9d6e023ee39bc2a2a1a7fd94541c414.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*24UmkYgVmSeMg7zVnPORxw.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">前5行(作者图片)</p></figure><p id="5cb6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们有了频率，让我们看看每个国家的最高模式频率。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi oe"><img src="../Images/4fbe2cfe0527249606fd05336be56140.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BsNb_c0SAIkeeQXLw8ekWg.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">按国家/地区列出的顶级模式频率(按作者列出的图片)</p></figure><p id="c616" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很高兴看到26个国家中有18个国家的通用模式百分比高于%75。最不常见的百分比是JJ国家的%60。可能有几个原因会导致这种情况。要么是有另一种模式也和顶模式一样常见，要么是数据质量根本不高。不过，我们现在不需要担心最常见的模式。我们的重点是识别不常见的模式，以突出数据质量问题。</p><p id="6b2b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在让我们以国家“AA”为例来观察所有的模式。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi of"><img src="../Images/b08ae9378bc1b9d8ba417529b1155299.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-je5yTcBPnTrHQ_T1H3VOg.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">县“AA”模式频率(图片由作者提供)</p></figure><p id="fa2a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">似乎在国家“AA”中最常用的模式是L-L-N-N-N-N-N-N-N-N，大约有%97，还有五种模式很少使用。我们对这些作为潜在数据错误的非常见模式感兴趣。</p><h1 id="e577" class="mm mn iq bd mo mp nk mr ms mt nl mv mw jw nm jx my jz nn ka na kc no kd nc nd bi translated">7.识别模式频率低于阈值的客户</h1><p id="f960" class="pw-post-body-paragraph kf kg iq kh b ki ne jr kk kl nf ju kn ko ng kq kr ks nh ku kv kw ni ky kz la ij bi translated">让我们记住我们的两个主表:</p><p id="9558" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 1。df </strong>:客户级数据</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi oc"><img src="../Images/ff4e302627dbb305046f9805ea1d2dca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CEbqhxNPoeE3xrkYns8Jag.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">前5排<strong class="bd og"> df </strong>(图片由作者提供)</p></figure><p id="061c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 2。grp_tbl: </strong>国家/地区和模式级别的数据，以及按国家/地区列出的模式百分比和客户总数信息</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi od"><img src="../Images/b9d6e023ee39bc2a2a1a7fd94541c414.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*24UmkYgVmSeMg7zVnPORxw.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated"><strong class="bd og"> grp_tbl </strong>前5排(图片由作者提供)</p></figure><p id="b51b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们合并<em class="nx"> Country </em>和<em class="nx">Check _ Column _ Translated</em>列上的<strong class="kh ir"> df </strong>和<strong class="kh ir"> grp_tbl </strong>表，以获得带有模式百分比的客户级别结果。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi oh"><img src="../Images/0267a4742a03c6948213c504b5e9775c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N80k_X7m3fMCBQn9d3dcgg.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated"><strong class="bd og"> df_all_temp </strong>表(图片由作者提供)</p></figure><p id="2985" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们选择一个低阈值，然后过滤掉比该阈值高的<em class="nx"> Pattern_Pct </em>行。这样，我们可以列出具有非通用税务模式的客户。在脚本的早期将阈值分配给变量会更有效。在本文中，为了清楚起见，我将它添加到了本节中。在下面的例子中，我使用1%作为阈值。</p><p id="8983" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">注意:</strong>你需要小心阈值。如果您的组项目之一(在我们的示例中，对应于国家)的记录少于100条，您将不会有任何1%阈值的结果。例如，假设国家AB有95个客户，最常见的模式用于94个客户。这意味着只有一个客户有不同的模式。那么，1%阈值将不会突出显示该结果，因为该特定客户的模式百分比将高于%1。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi oi"><img src="../Images/436e3fec7c0f4ad2d21e93047fb09fde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bpVpB22rfHBzVdCrRT8pPg.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated"><strong class="bd og"> df_all </strong>表格(图片由作者提供)</p></figure><p id="8859" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，在18052个客户中，有392个在我们的数据集中有不常见的税号模式。</p><h1 id="94c5" class="mm mn iq bd mo mp nk mr ms mt nl mv mw jw nm jx my jz nn ka na kc no kd nc nd bi translated">8.报告</h1><p id="938c" class="pw-post-body-paragraph kf kg iq kh b ki ne jr kk kl nf ju kn ko ng kq kr ks nh ku kv kw ni ky kz la ij bi translated">我们有我们的结果，我们可以称之为<strong class="kh ir">异常</strong>。现在，让我们准备演示数据。</p><p id="243e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们列出了具有非通用税号模式的客户，但是我们的利益相关者可能希望将这些模式与每个客户所在国家最常见的模式进行比较。让我们快速浏览一下我们在第6部分创建的<strong class="kh ir"> grp_cntry_max </strong>表。</p><p id="d3f0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> grp_cntry_max: </strong>具有最常见模式和模式百分比信息的国家级数据(此表也是<strong class="kh ir"> grp_tbl </strong>的子集)</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/a917538e646b236bc292935d72f48285.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*mA1vfftbi9S-nokblXzuRw.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated"><strong class="bd og"> grp_cntry_max </strong>的前5行(图片由作者提供)</p></figure><p id="7015" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们将<strong class="kh ir"> grp_cntry_max </strong>与<strong class="kh ir"> df_all_temp </strong>合并。在合并之前，我们将重命名这些列，以防止名称冲突并增加清晰度。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ok"><img src="../Images/0ed338fc80cfc817041e7582243a9705.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ce5Si9P9oZer1zX5c86Q7w.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated"><strong class="bd og"> df_report </strong>的前5行(图片由作者提供)</p></figure><p id="87aa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这部分之后，还有各种潜在的可视化机会。下面我分享两个不同可视化方法的场景。</p><p id="a56c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">注意:</strong>许多不同的Python包提供了更多的格式化选项。我建议探索它们以获得更吸引人的视觉效果。</p><p id="bd62" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">场景1: </strong>我们的利益相关方将审查并修正例外数量最多的前10个国家的数据。他们希望了解前10个国家中哪个国家的例外比例较高，以便进行有效的计划。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/067e3919910b988d4994f7495bcb0042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*Q4Va4XE1-VVrrJhpORRZpw.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">前10个国家例外数字饼图(图片由作者提供)</p></figure><p id="ed58" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">情景2: </strong>我们的利益相关者希望了解哪些国家的例外情况与其客户总数相比比例更高。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi om"><img src="../Images/b9bc47c73abf1e6345bc69cdfa00498a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HCK8KXQe1u-mXGkUZ9bsNw.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">例外百分比条形图(按作者分类的图片)</p></figure><p id="287f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">结论:</strong>现在，我们熟悉了我们的数据集，知道了它的弱点。我们准备继续我们的分析，或者将我们的异常作为数据治理项目的结果提出来。</p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><p id="e298" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">备注1: </strong>您可以对每个数据集使用这种方法。只需更新列名、定义阈值、创建附加字母列表并运行脚本。您也可以在没有分组的整个数据集上运行此操作(例如按国家分组)。您可以通过用任何静态值(如“A”)创建一个新列来实现。</p><p id="ca89" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">备注2: </strong>即使这是一个全面的测试，也可能仍然不够。例如，您可能会遗漏所有id都相同的数据集，如“00000000”或“AAAAAA”。</p><p id="2605" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">备注3: </strong>翻译特殊字符是一种保守的做法。如果您的数据没有特殊字符，您可以保留它们的原始值。</p></div></div>    
</body>
</html>