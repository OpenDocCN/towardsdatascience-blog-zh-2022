<html>
<head>
<title>Getting Started with Google APIs in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的Google APIs入门</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/getting-started-with-google-apis-in-python-7f07b5d8b806#2022-11-01">https://towardsdatascience.com/getting-started-with-google-apis-in-python-7f07b5d8b806#2022-11-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="776f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Python和Google API自动完成Gmail、Google Drive、Calendar或任何其他Google API的速成课程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b7ef8e7c988c504b0c17e698526ccdfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fknNz_Ul3E8GBdO9Diq04Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">产生稳定的扩散</p></figure><p id="27ee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">谷歌有数百个API，包括Gmail、Drive、地图、翻译、分析等等。所有这些共享相同的概念，如授权、分页或媒体上传/下载。在本文中，我们将探索所有这些概念，并尝试使用上述一些API，了解您可以使用任何或所有Google API做的所有很酷的事情。</p><h1 id="5fbb" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">安装</h1><p id="7905" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">为了能够访问API，我们需要首先在Google Cloud中创建一个项目。为此，请前往<a class="ae mr" href="https://console.cloud.google.com/cloud-resource-manager" rel="noopener ugc nofollow" target="_blank">云资源管理器</a>并点击<em class="ms">创建项目</em>。或者，您也可以通过CLI使用<code class="fe mt mu mv mw b">gcloud projects create $PROJECT_ID</code>来完成。几秒钟后，你会在列表中看到新项目。</p><p id="8292" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们需要为这个项目启用API。你可以在<a class="ae mr" href="https://console.cloud.google.com/apis/library" rel="noopener ugc nofollow" target="_blank"> API库</a>中找到所有可用的API。我们将在接下来的部分中使用的功能包括Gmail、Drive和Forms，但是您可以选择您想要启用的功能。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mx"><img src="../Images/cc84b72899f1f53d0873831e26cbc057.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yCuC3dIYhmzX0M98ZMTvgQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">启用Google API</p></figure><p id="9cde" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">API现在可以使用了，但是我们需要凭证来访问它。根据应用程序的类型，有几种不同类型的凭据。它们中的大多数适合于需要/要求用户同意的应用，例如客户端(桌面)或Android/iOS应用。对我们来说，更好的凭证类型是<em class="ms">服务帐户</em>，因为它适合自动化——也就是说——无需用户交互即可访问。<em class="ms">服务帐户</em>凭证然而，不能与许多API一起工作——例如，照片API不支持它，并且所有Google Workspace(g suite)API(例如，Gmail、Sheets、Docs…)仅在您拥有自己的带有<a class="ae mr" href="https://developers.google.com/identity/protocols/oauth2/service-account#delegatingauthority" rel="noopener ugc nofollow" target="_blank">域范围访问委托</a>的工作空间时才允许它。因此，我们唯一的选择是使用OAuth凭证。</p><p id="b5c7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要创建OAuth凭证，请转到<a class="ae mr" href="https://console.cloud.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank">凭证页面</a>，点击<em class="ms">创建凭证</em>并选择<em class="ms"> OAuth客户端ID </em>。您将被要求配置<em class="ms"> OAuth同意屏幕</em>，然后创建它——在第一个屏幕中，您将被要求选择用户类型，我们将选择<em class="ms">外部</em>。</p><p id="8273" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在下一个屏幕中，您将在<em class="ms">开发者联系信息</em>下指定<em class="ms">应用名称</em>、<em class="ms">用户支持电子邮件</em>和电子邮件地址。之后您可以点击<em class="ms">保存并继续</em>，跳过<em class="ms">范围</em>部分。在<em class="ms">测试用户</em>部分，点击<em class="ms">添加用户</em>并添加您将用于测试的Google帐户的电子邮件地址(您可能需要为此创建额外的Google帐户)，点击<em class="ms">保存并再次继续</em>。总之，配置应该如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/b7eda3c219783f280c364276cad38b16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nnqkweSy5M0DIiSJt8LWQA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Google同意屏幕摘要1</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/dd3b38bc7557abe28eeee3b64ece91aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*uZvxaf7pG6L4e4maug9EOw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Google同意屏幕摘要2</p></figure><p id="725f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们需要返回到<a class="ae mr" href="https://console.cloud.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank">凭证页面</a>点击<em class="ms">创建凭证</em>并选择<em class="ms"> OAuth客户端ID </em>。接下来，我们将选择<em class="ms">应用程序类型</em>作为<em class="ms">桌面应用程序</em>，并为其命名:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/a06c06f13540f57803e6f5429eed2b24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*6-aMihXxv0484d0FkVTq_g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Google API OAuth应用程序</p></figure><p id="d0f8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您将看到客户端ID和客户端密码——单击<em class="ms">下载JSON </em>按钮，以名称<code class="fe mt mu mv mw b">credentials.json</code>保存它们——我们稍后会用到它们。</p><p id="8585" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">完成后，我们现在有了启用API的项目和OAuth申请/同意屏幕，这将允许我们授权访问我们选择的API和范围。</p><p id="4a5c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，我们需要安装Python客户端库来使用API。我们需要两个，一个用于认证，一个用于实际的Google APIs:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><h1 id="b639" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">访问API</h1><p id="b3c4" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">现在我们准备开始编写一些Python代码。我们需要做的第一件事是进行身份验证并获得用户同意:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="db04" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们从定义访问API的访问范围开始。要找到你需要的，在特定的API文档页面中搜索<em class="ms">“范围”</em>，第一个结果应该会导致类似于<a class="ae mr" href="https://developers.google.com/gmail/api/auth/scopes" rel="noopener ugc nofollow" target="_blank"> Gmail </a>或<a class="ae mr" href="https://developers.google.com/photos/library/guides/authorization" rel="noopener ugc nofollow" target="_blank">照片</a>的页面。选择您需要的所有范围，并将它们添加到<code class="fe mt mu mv mw b">SCOPES</code>列表中。这里我们选择<code class="fe mt mu mv mw b">gmail.readonly</code>进行测试。</p><p id="6379" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们检查<code class="fe mt mu mv mw b">token.json</code>是否存在，它是一个存储用户访问和刷新令牌的文件。该文件是在授权流程首次完成时自动创建的。如果文件在那里，但是它存储的凭证无效，我们尝试刷新它们。如果文件不存在，我们让用户通过OAuth流登录。这将打开浏览器选项卡，要求您登录。在这里，您应该使用您在OAuth屏幕设置期间指定的测试用户。</p><p id="2781" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在接受应用程序请求的作用域后，将创建<code class="fe mt mu mv mw b">token.json</code>文件。当您再次运行此身份验证代码时，将使用该令牌(假设它没有过期)，因此您不必再次在浏览器中批准它。</p><p id="620f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您决定在某个时候改变作用域，一定要删除<code class="fe mt mu mv mw b">token.json</code>，因为应用程序需要重新授权。</p><h1 id="9630" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">基础知识</h1><p id="a171" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">Google API Python客户端库包含了所有Google API的函数，这使得它变得非常复杂和难以导航。大部分也是生成的代码(包括文档)，这对用户体验没有帮助。现在让我们看看所有各种Google APIs的基本模式，它们可以帮助我们更好地理解客户端库，从而更有效地导航和使用它。</p><p id="2c88" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">无论您选择使用哪种API，它们都有一个共同点——创建API对象和发出请求的方式:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="9142" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">无论你想调用Gmail API还是任何其他API，你总是会通过提供API名称、版本和先前创建的凭证，从<code class="fe mt mu mv mw b">googleapiclient.discovery</code>使用<code class="fe mt mu mv mw b">build</code>函数来<em class="ms">【构建】</em>服务<em class="ms">。然后，使用返回的<code class="fe mt mu mv mw b">service</code>对象，您可以调用该API的任何函数。因为这是生成的代码，你不会得到自动完成，所以最好的方法是找到你的选项，是去文档页面。URL有点难找到，不过一般来说，你可以浏览<a class="ae mr" href="https://googleapis.github.io/google-api-python-client/docs/dyn/" rel="noopener ugc nofollow" target="_blank">https://Google apis . github . io/Google-API-python-client/docs/dyn/</a>来找到你需要的API组和方法。例如，对于上面的<code class="fe mt mu mv mw b">service.users().messages()</code>，你可以从<a class="ae mr" href="https://googleapis.github.io/google-api-python-client/docs/dyn/gmail_v1.users.messages.html" rel="noopener ugc nofollow" target="_blank">转到</a>。</em></p><p id="990f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，不要忘记调用<code class="fe mt mu mv mw b">.execute()</code>方法，否则得不到任何真正的响应。说到这里，响应将只是Python dictionary形式的JSON，您必须遍历它以获得您想要的数据——要了解您可以预期的字段，请查看上面生成的文档，其中包括示例响应对象。</p><p id="180a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当您需要弄清楚单个方法的各个参数时，基于上述API文档构建方法链会很好地工作，但是当您试图导航或学习一般的API选项时，可能不太方便。为此，你最好搜索REST API参考，比如Gmail<a class="ae mr" href="https://developers.google.com/gmail/api/reference/rest" rel="noopener ugc nofollow" target="_blank">的参考。浏览一下，您会很快注意到它遵循了与Python方法链(<code class="fe mt mu mv mw b">.users().messages().list</code>)相同的结构:</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/1d1e18b2e418eb75c93ac5d4aa2ed02a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qejMznKK_kiBtPWhWl1zog.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Gmail API参考</p></figure><h1 id="5d9d" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">踢轮胎</h1><p id="d332" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">既然我们知道了如何导航API并调用它的端点，那么让我们试试它的轮胎，看看各种各样的Google APIs能为我们做些什么。</p><p id="aadf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们已经介绍了Gmail API，所以在这里，我们可以看看它的更多方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="d7cd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面的片段显示了我们如何从登录的帐户发送电子邮件。这是通过创建一个消息对象来实现的，该对象随后被base64编码，并使用<code class="fe mt mu mv mw b">body</code>参数传递给<code class="fe mt mu mv mw b">.send(...)</code>。还要注意，我们使用了<code class="fe mt mu mv mw b">"me"</code>作为<code class="fe mt mu mv mw b">userId</code>的值——这是一个特殊的值，用于标识当前登录的用户。</p><p id="14be" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">假设您有一堆带有附件的电子邮件，您希望提取这些附件以进行备份或进一步处理。您可以使用Gmail API抓取这些附件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="7829" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里我们假设您已经有了一些消息及其ID。我们使用这个<code class="fe mt mu mv mw b">message_info</code>来查询消息对象的API。然后，我们遍历消息有效负载的各个部分，寻找引用附件的部分——也就是具有非空<code class="fe mt mu mv mw b">filename</code>属性的部分。然后，我们使用在消息部分找到的ID向API请求每个附件。返回的附件数据是base64编码的，这里我们假设它是明文数据，但也可能是PDF、图像等。</p><p id="8ef0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Gmail API是最广泛的API之一，人们可以用它做更多的事情，所以请确保查看它的<a class="ae mr" href="https://developers.google.com/gmail/api/reference/rest" rel="noopener ugc nofollow" target="_blank"> API参考</a>。</p><p id="942f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从Gmail继续，另一个受欢迎的谷歌服务是<em class="ms"> Drive </em>，让我们看看如何从它上面搜索和下载文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="b875" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们使用<code class="fe mt mu mv mw b">.files().list()</code>方法来搜索文件。为了便于搜索，我们在<code class="fe mt mu mv mw b">q</code>参数中指定了一个查询，其格式为<code class="fe mt mu mv mw b">query_term operator values</code>——在本例中——<code class="fe mt mu mv mw b">mimeType</code>为<code class="fe mt mu mv mw b">query_term</code> , <code class="fe mt mu mv mw b">=</code>为<code class="fe mt mu mv mw b">operator</code>,<code class="fe mt mu mv mw b">'image/png'</code>为<code class="fe mt mu mv mw b">values</code>。这个查询确保我们只接收MIME类型为<code class="fe mt mu mv mw b">image/png</code>的文件。您可以构建许多查询，在<a class="ae mr" href="https://developers.google.com/drive/api/guides/ref-search-terms" rel="noopener ugc nofollow" target="_blank">文档</a>中有一个完整的列表。在我们的搜索中，我们还指定了<code class="fe mt mu mv mw b">fields</code>参数，它告诉API只返回文件的ID和名称，而不是完整的有效负载。</p><p id="72a6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从API获得文件列表后，我们使用<code class="fe mt mu mv mw b">.files().get_media</code>获得文件元数据，然后使用该信息创建<code class="fe mt mu mv mw b">downloader</code>对象，用它下载实际文件。最后，我们将下载的数据写入一个文件。</p><p id="ec12" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">除了管理文件，使用其他API时也需要Google Drive API。例如，如果您想访问您的<em class="ms"> Google表单</em>，您需要使用Drive API来搜索它们:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="d02c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了搜索表单，我们使用与搜索图像时相同的<code class="fe mt mu mv mw b">.files().list</code>方法，唯一的不同是我们改变了<code class="fe mt mu mv mw b">q</code>参数来搜索Google表单。</p><p id="2444" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，我们可以使用返回的信息来处理我们的表单，例如获取所有表单响应。注意，在这个例子中，我们将<code class="fe mt mu mv mw b">static_discovery</code>指定为<code class="fe mt mu mv mw b">False</code>，这是因为目前静态发现文档不是Python客户端库的一部分，因此我们需要从互联网上获取它，否则我们会得到<code class="fe mt mu mv mw b">UnknownApiNameOrVersion</code>异常。</p><p id="f40b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面的例子还演示了在初始调用<code class="fe mt mu mv mw b">list</code>后使用<code class="fe mt mu mv mw b">list_next</code>进行分页。这很方便，因为我们不必处理存储在响应对象中的“下一页令牌”,相反，我们只需将请求和响应对象传递给<code class="fe mt mu mv mw b">list_next</code>方法，让库来处理剩下的部分。</p><p id="a2b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">另一个你可能想要检查的API是<em class="ms">照片API </em>，然而这个需要更多的努力来使它工作:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="b453" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">与Forms API一样，对于Photos API，我们也需要将<code class="fe mt mu mv mw b">static_discovery</code>指定为<code class="fe mt mu mv mw b">False</code>。然而，这个问题更多——如果你试图在前面提到的<a class="ae mr" href="https://googleapis.github.io/google-api-python-client/docs/dyn/" rel="noopener ugc nofollow" target="_blank">生成的API参考</a>中寻找它，它根本不存在。这是因为它还没有像这个<a class="ae mr" href="https://github.com/googleapis/google-api-python-client/issues/1594" rel="noopener ugc nofollow" target="_blank"> GitHub问题</a>中提到的那样发布，所以在此期间，如果我们想看看有哪些方法可供我们使用，我们需要通过如上所示的私有属性做一点挖掘。</p><p id="3b14" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然不太方便，但该API仍可用于——例如——将图像上传到相册:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="3c0b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们首先创建一个样本相册，我们将在其中上传我们的图像—这是必要的，因为您只允许将图像上传到您的应用程序创建的相册。之后，我们将上传图像，这是一个两步过程—首先我们必须上传图像字节，然后我们将上传的数据与图像相关联。</p><p id="9c92" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第一步，我们必须使用raw REST API，将图像数据发布到Photos API <code class="fe mt mu mv mw b">uploads</code>端点。之后，我们使用相册ID、图像名称和从原始数据上传返回的上传令牌构建一个请求体，然后使用<code class="fe mt mu mv mw b">batchCreate</code>方法将其发送给API。在这个例子中，我们只上传了一个图像，但是您可以使用一个<code class="fe mt mu mv mw b">batchCreate</code>调用上传多个图像，同时将多个项目传递给请求体中的<code class="fe mt mu mv mw b">newMediaItems</code>条目。</p><p id="22f3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">回到Google Workspace APIs，让我们看看日历API。假设我们希望在日历中创建新活动时收到通知:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="3af6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从Calendar API的角度来看，我们需要做的就是建立一个事件将要到来的通道。我们通过使用包含ID、地址和通道到期(生存时间)的主体调用<code class="fe mt mu mv mw b">.events().watch()</code>来实现这一点。这里的地址必须是互联网上的一个HTTPS网站(不是<code class="fe mt mu mv mw b">localhost</code>)。在开发过程中，最简单的设置方法是使用像<a class="ae mr" href="https://ngrok.com/" rel="noopener ugc nofollow" target="_blank"> ngrok </a>这样的服务，它会将请求转发给你的<code class="fe mt mu mv mw b">localhost</code>。</p><p id="33ed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在设置了转发(使用ngrok或任何其他工具)之后，您应该开始看到HTTP POST请求进来，您可以在其中开始处理。示例请求可能如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="8451" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们要看的最后一个API是<em class="ms">事实检查工具API </em>，我们可以用它来验证/反驳几乎任何事情:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="f6c6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个和以前的没什么不同。以前，我们只使用OAuth进行身份验证，但是事实检查工具API是一个公共API，不需要访问/授权用户数据，因此可以使用基本的API密钥身份验证。要获得谷歌云API密匙，请点击这里的<a class="ae mr" href="https://github.com/googleapis/google-api-python-client/blob/main/docs/api-keys.md" rel="noopener ugc nofollow" target="_blank">指南</a>。</p><p id="42f8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们在上面的例子中还演示了一个新的东西，那就是使用批处理请求——而不是直接单独调用<code class="fe mt mu mv mw b">.claims().search()</code>,这里我们使用<code class="fe mt mu mv mw b">new_batch_http_request</code>创建一个批处理，并将所有我们想要的搜索请求添加到其中。在将请求添加到批处理中时，我们还提供了一个<code class="fe mt mu mv mw b">callback</code>函数，在特定的请求被执行后会调用这个函数。在这种情况下，回调函数- <code class="fe mt mu mv mw b">print_claim_review</code> -通过打印我们搜索的原始索赔及其文本评级来处理响应。</p><p id="5a9f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您像上面的代码片段那样只发出几个请求，这种批处理可能没有意义，但是如果您必须发出数千个API调用，则可能通过最小化HTTP请求开销来提高性能。</p><h1 id="f9c8" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">结论</h1><p id="3e45" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在本文中，我试图捕捉大多数常见的工作流和概念，比如批处理、分页、搜索或认证，这些都是您在使用Google APIs时可能会遇到的。然而，这并不是使用它们可以完成的所有事情的详尽指南，所以一定要查看其他资源，例如<a class="ae mr" href="https://github.com/googleapis/google-api-python-client/tree/main/samples" rel="noopener ugc nofollow" target="_blank"> Python API客户端示例</a>或Google Workspace <a class="ae mr" href="https://github.com/googleworkspace/python-samples" rel="noopener ugc nofollow" target="_blank">示例和片段</a>。此外，对于任何严肃的应用程序，你肯定也应该研究测试，API客户端文档包括关于模拟的章节。</p><p id="3400" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，还有很多本文没有涉及的API。一些值得探索的是<a class="ae mr" href="https://cloud.google.com/translate/docs/reference/rest/" rel="noopener ugc nofollow" target="_blank">翻译API </a>、<a class="ae mr" href="https://cloud.google.com/speech-to-text/docs/reference/rest" rel="noopener ugc nofollow" target="_blank">语音转文本</a>或<a class="ae mr" href="https://developers.google.com/maps/documentation/routes/reference/rest" rel="noopener ugc nofollow" target="_blank">路由API(地图)</a>，它们都包含一个免费层。</p><p id="db44" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="ms">本文原帖</em><a class="ae mr" href="https://martinheinz.dev/blog/84" rel="noopener ugc nofollow" target="_blank"><em class="ms">martinheinz . dev</em></a></p></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><p id="1e34" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae mr" href="https://medium.com/@martin.heinz/membership" rel="noopener">成为会员</a>阅读媒体上的每一个故事。<strong class="la iu">你的会员费直接支持我和你看的其他作家。你还可以在媒体上看到所有的故事。</strong></p><div class="nk nl gp gr nm nn"><a href="https://medium.com/@martin.heinz/membership" rel="noopener follow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd iu gy z fp ns fr fs nt fu fw is bi translated">通过我的推荐链接加入媒体-马丁·海因茨</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">阅读马丁·海因茨(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">medium.com</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob ks nn"/></div></div></a></div></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><p id="fe31" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可能也喜欢…</p><div class="nk nl gp gr nm nn"><a rel="noopener follow" target="_blank" href="/exploring-google-analytics-realtime-data-with-python-8625849c7d7a"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd iu gy z fp ns fr fs nt fu fw is bi translated">用Python探索Google Analytics实时数据</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">使用REST API和Python充分利用所有Google Analytics特性和数据</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">towardsdatascience.com</p></div></div><div class="nw l"><div class="oc l ny nz oa nw ob ks nn"/></div></div></a></div><div class="nk nl gp gr nm nn"><a rel="noopener follow" target="_blank" href="/python-f-strings-are-more-powerful-than-you-might-think-8271d3efbd7d"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd iu gy z fp ns fr fs nt fu fw is bi translated">Python f-strings比您想象的更强大</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">了解Python的f字符串的未知特性——格式化的字符串文字——以及您的文本格式化…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">towardsdatascience.com</p></div></div><div class="nw l"><div class="od l ny nz oa nw ob ks nn"/></div></div></a></div></div></div>    
</body>
</html>