<html>
<head>
<title>Introducing tidyverse — the Solution for Data Analysts Struggling with R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">tidyverse简介——为数据分析师解决R</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introducing-tidyverse-the-solution-for-data-analysts-struggling-with-r-e48f502f57c5#2022-06-01">https://towardsdatascience.com/introducing-tidyverse-the-solution-for-data-analysts-struggling-with-r-e48f502f57c5#2022-06-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b860" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">tidyverse库包提供了一种简单的“类似SQL的方式”在R</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/958e2afc8b728ad85c9bcfc44391879c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k3Az18QJWwm1-6RE5y_3LQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">r不需要很难。图片来自<a class="ae kv" href="https://pixabay.com/sv/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure><blockquote class="kw kx ky"><p id="cfa0" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我刚刚开始了计算机科学的大学学习，并渴望通过R学习数据分析的秘密。在计算了几个月的统计问题的答案后，令我失望的是，我意识到如果不查阅课程R手册，我仍然只能编写几行代码。所有的方括号、逗号和美元符号在我的脑海里混为一谈，甚至连过滤数据框中的行这样简单的任务都感觉远非简单明了。</p><p id="f485" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我开始认为R和我并不兼容，并决定每当我需要分析数据时就求助于python和pandas。</p></blockquote><p id="76b1" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">你也很难理解R吗？如果是这样，我有好消息告诉你。使用R有一种更简单、更直观的方法:tidyverse库！它不仅仅是另一套工具。这是r中完全不同的数据分析方式。</p><blockquote class="kw kx ky"><p id="fb7b" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我第一次真正接触tidyverse是在我开始为现在的雇主工作的时候。他们在R中完成了大部分高级分析。当我承认我的R技能很差时，我很惊讶地听到我的同事回答说没关系，因为他们反正用tidyverse！</p></blockquote><h1 id="157e" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">介绍tidyverse</h1><p id="220f" class="pw-post-body-paragraph kz la iq lc b ld mr jr lf lg ms ju li lw mt ll lm lx mu lp lq ly mv lt lu lv ij bi translated"><a class="ae kv" href="https://www.tidyverse.org/" rel="noopener ugc nofollow" target="_blank"> tidyverse </a>是一个R包集合，是专门为数据分析师和科学家的需求而开发的。该集合包括许多不同类型场景的逻辑，例如，时间智能、数据争论和字符串操作。</p><p id="15f3" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">软件包中包含的功能设计得尽可能直观易用，并且只需要最少的调整。一个例子是管道，即。<strong class="lc ir">%&gt;%</strong>-符号。管道的功能是将不同的数据争论步骤链接在一起，而不必将每个步骤的结果保存到不同的变量中。这使得代码更加整洁，编写速度更快。看看下面伪代码在逻辑上的区别。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/2c3889b3c0823015adb548cb6cfc022d.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*A2tRBYGEGaNrQTXYuWTC6Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">base R与tidyverse中数据争论步骤的链接</p></figure><p id="3646" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">另一个例子是常见数据框修改函数的类似SQL的命名。要过滤数据框中的行，可以使用<strong class="lc ir"> filter </strong>函数，要选择特定的列，可以使用<strong class="lc ir"> select </strong>函数。</p><p id="ce8f" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">另一个很好的例子是<strong class="lc ir">扫视</strong>函数。Glimpse的主要优点是它可以垂直打印列名。相比之下，<strong class="lc ir">头</strong>——检查数据的基本R函数——水平打印它们。使用<strong class="lc ir">glow，</strong>所有的列名将适合打印区域，不管有多少。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/7435bbfe54f74993c3efd1dd56061e4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-GslyeCPudewUApZ1fdIxw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Base R的头部功能vs tidyverse的一瞥功能</p></figure><h1 id="a305" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">与tidyverse的数据争论</h1><p id="641f" class="pw-post-body-paragraph kz la iq lc b ld mr jr lf lg ms ju li lw mt ll lm lx mu lp lq ly mv lt lu lv ij bi translated">了解tidyverse好处的最好方法之一是尝试一些基本的数据角力练习；选择一些列，过滤一些行并操作一些值。让我们用内置的<a class="ae kv" href="https://www.statology.org/iris-dataset-r/" rel="noopener ugc nofollow" target="_blank"> <em class="lb">虹膜</em>数据集</a>来试试这些东西。</p><p id="84b5" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">在开始争论之前，下载并加载tidyverse。这可能需要几分钟时间。</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="459a" class="nd ma iq mz b gy ne nf l ng nh">install.packages("tidyverse")<br/>library(tidyverse)</span></pre><h2 id="3eb5" class="nd ma iq bd mb ni nj dn mf nk nl dp mj lw nm nn ml lx no np mn ly nq nr mp ns bi translated">创建新数据:<a class="ae kv" href="https://tibble.tidyverse.org/reference/tribble.html" rel="noopener ugc nofollow" target="_blank">三表</a></h2><p id="c567" class="pw-post-body-paragraph kz la iq lc b ld mr jr lf lg ms ju li lw mt ll lm lx mu lp lq ly mv lt lu lv ij bi translated">iris数据集非常有限，只有关于花的种类和尺寸的信息。让我们通过链接到每个物种的维基百科页面来丰富数据。我们可以通过使用三重函数创建新的数据框来实现这一点。</p><p id="e6fb" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">列名前用<strong class="lc ir"> ~ </strong>标记，每列内容用逗号分隔。</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="f304" class="nd ma iq mz b gy ne nf l ng nh">iris_wikipedia &lt;- tribble(<br/>  ~ Species,<br/>  ~ Wikipedia,<br/>  'setosa',<br/>  '<a class="ae kv" href="https://en.wikipedia.org/wiki/Iris_setosa'" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Iris_setosa'</a>,<br/>  'versicolor',<br/>  '<a class="ae kv" href="https://en.wikipedia.org/wiki/Iris_versicolor'" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Iris_versicolor'</a>,<br/>  'virginica',<br/>  '<a class="ae kv" href="https://en.wikipedia.org/wiki/Iris_virginica'" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Iris_virginica'</a><br/>)</span></pre><h2 id="c47a" class="nd ma iq bd mb ni nj dn mf nk nl dp mj lw nm nn ml lx no np mn ly nq nr mp ns bi translated">结合其他数据:<a class="ae kv" href="https://dplyr.tidyverse.org/reference/mutate-joins.html" rel="noopener ugc nofollow" target="_blank">加入</a></h2><p id="640e" class="pw-post-body-paragraph kz la iq lc b ld mr jr lf lg ms ju li lw mt ll lm lx mu lp lq ly mv lt lu lv ij bi translated">现在，当我们有了维基百科的数据，我们可以用一个连接把它和虹膜数据集结合起来。tidyverse提供了几种类型的连接，但是我们选择左连接。<em class="lb">物种</em>列将作为连接中的一个键，我们必须确保两个数据集中的数据类型相同。在<em class="lb"> iris </em>数据集中，数据类型是factor，而在<em class="lb"> iris_wikipedia中是character。</em></p><p id="72e2" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">让我们用mutate函数改变后者的数据类型(下面将进一步介绍这个函数)。</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="8a36" class="nd ma iq mz b gy ne nf l ng nh">iris_wikipedia &lt;- tribble(<br/>  ~ Species,<br/>  ~ Wikipedia,<br/>  'setosa',<br/>  '<a class="ae kv" href="https://en.wikipedia.org/wiki/Iris_setosa'" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Iris_setosa'</a>,<br/>  'versicolor',<br/>  '<a class="ae kv" href="https://en.wikipedia.org/wiki/Iris_versicolor'" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Iris_versicolor'</a>,<br/>  'virginica',<br/>  '<a class="ae kv" href="https://en.wikipedia.org/wiki/Iris_virginica'" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Iris_virginica'</a><br/>) <strong class="mz ir">%&gt;%<br/>  mutate(Species = as.factor(Species))</strong></span></pre><p id="a8a5" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">在定义了原始的<em class="lb">虹膜数据集</em>作为我们的起点之后，我们取它，并借助tidyverse的管道函数将其发送给left_join函数。<strong class="lc ir">如果数据集包含具有相同名称和数据类型的列，只需将新数据集的名称提供给left_join </strong>。如果列名不同，则通过参数<code class="fe nt nu nv mz b">by = <a class="ae kv" href="https://rdrr.io/r/base/c.html" rel="noopener ugc nofollow" target="_blank">c</a>("column_name_in_base_dataset" = "column_name_in_new_dataset")</code>将键作为分配给<strong class="lc ir">的向量提供</strong></p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="ac31" class="nd ma iq mz b gy ne nf l ng nh">our_wrangled_data &lt;- iris %&gt;%<br/>  left_join(iris_wikipedia) </span></pre><h2 id="2c57" class="nd ma iq bd mb ni nj dn mf nk nl dp mj lw nm nn ml lx no np mn ly nq nr mp ns bi translated">过滤行:<a class="ae kv" href="https://dplyr.tidyverse.org/reference/filter.html" rel="noopener ugc nofollow" target="_blank">过滤</a></h2><p id="585c" class="pw-post-body-paragraph kz la iq lc b ld mr jr lf lg ms ju li lw mt ll lm lx mu lp lq ly mv lt lu lv ij bi translated">假设我们只想在分析中包括“圣淘沙”这个物种。我们通过将上一步的输出通过管道传输到<strong class="lc ir">过滤器</strong>函数来实现。注意，这里使用了两个等号。不等于被定义为！=.</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="4846" class="nd ma iq mz b gy ne nf l ng nh">our_wrangled_data &lt;- iris %&gt;%<br/>  left_join(iris_wikipedia) <strong class="mz ir">%&gt;% <br/>  filter(Species == "setosa")</strong></span></pre><h2 id="cb7d" class="nd ma iq bd mb ni nj dn mf nk nl dp mj lw nm nn ml lx no np mn ly nq nr mp ns bi translated">选择列:<a class="ae kv" href="https://dplyr.tidyverse.org/reference/select.html" rel="noopener ugc nofollow" target="_blank">选择</a></h2><p id="97ff" class="pw-post-body-paragraph kz la iq lc b ld mr jr lf lg ms ju li lw mt ll lm lx mu lp lq ly mv lt lu lv ij bi translated">我们只对sepal和维基百科相关的数据感兴趣，因此只选择那些栏目。select函数既可以用来选择我们想要的列，也可以用来选择我们不想要的列。在后一种情况下，我们只需在列名前添加一个减号:select(-unwanted_column_name)。</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="5d88" class="nd ma iq mz b gy ne nf l ng nh">our_wrangled_data &lt;- iris %&gt;%<br/>  left_join(iris_wikipedia) %&gt;% <br/>  filter(Species == "setosa") <strong class="mz ir">%&gt;%<br/>  select(Sepal.Length, Sepal.Width, Wikipedia)</strong></span></pre><h2 id="af6f" class="nd ma iq bd mb ni nj dn mf nk nl dp mj lw nm nn ml lx no np mn ly nq nr mp ns bi translated">创建新列或修改现有列:<a class="ae kv" href="https://dplyr.tidyverse.org/reference/mutate.html" rel="noopener ugc nofollow" target="_blank"> mutate </a></h2><p id="11f5" class="pw-post-body-paragraph kz la iq lc b ld mr jr lf lg ms ju li lw mt ll lm lx mu lp lq ly mv lt lu lv ij bi translated">函数mutate既可以用于<strong class="lc ir">更改现有列</strong>的内容，也可以用于<strong class="lc ir">创建具有指定逻辑的新列。</strong></p><p id="74d2" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">在本例中，我们创建了新的列<em class="lb"> Long。Sepal </em> <strong class="lc ir"> </strong>如果行的<em class="lb"> Sepal，则获得布尔值true。长度</em>比所有刚毛萼片长度的平均值长。如果我们将新列命名为<em class="lb">萼片。长度</em>，它会覆盖现有的<em class="lb">萼片。长度</em>列。这是我们在加入之前对<em class="lb"> iris_wikipedia </em>的<em class="lb">物种</em>栏目所做的。</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="2f00" class="nd ma iq mz b gy ne nf l ng nh">our_wrangled_data &lt;- iris %&gt;%<br/>  left_join(iris_wikipedia) %&gt;% <br/>  filter(Species == "setosa") %&gt;%<br/>  select(Sepal.Length, Sepal.Width, Wikipedia)<strong class="mz ir"> %&gt;%<br/>  mutate(Long.Sepal = if_else(Sepal.Length &gt; mean(Sepal.Length),<br/>                              TRUE,<br/>                              FALSE))</strong></span></pre><h2 id="9134" class="nd ma iq bd mb ni nj dn mf nk nl dp mj lw nm nn ml lx no np mn ly nq nr mp ns bi translated">按具体栏目分组:<a class="ae kv" href="https://dplyr.tidyverse.org/reference/group_by.html" rel="noopener ugc nofollow" target="_blank"> group_by </a> &amp; <a class="ae kv" href="https://dplyr.tidyverse.org/reference/summarise.html" rel="noopener ugc nofollow" target="_blank">总结</a></h2><p id="5856" class="pw-post-body-paragraph kz la iq lc b ld mr jr lf lg ms ju li lw mt ll lm lx mu lp lq ly mv lt lu lv ij bi translated">在tidyverse中，group_by既可用于创建一个<strong class="lc ir">汇总数据帧</strong>(SQL中的group by)，也可用于创建一个<strong class="lc ir">汇总列</strong>，同时保留原始数据帧(SQL中的<a class="ae kv" rel="noopener" target="_blank" href="/a-guide-to-advanced-sql-window-functions-f63f2642cbf9">窗口函数</a>)。在前一种情况下，group_by与summarise一起使用。在后一种情况下，它通常与mutate和ungroup一起使用，后者会移除group_by环境，因此可能的后续函数会应用于整个数据框，而不仅仅是分组的数据。</p><p id="cd39" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">两个版本都试试吧。我们从基本分组开始，以便概括平均信息<em class="lb">萼片。长度</em>为基于其<em class="lb">长度的观察值。萼片</em>状态。</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="955d" class="nd ma iq mz b gy ne nf l ng nh">our_wrangled_data &lt;- iris %&gt;%<br/>  left_join(iris_wikipedia) %&gt;% <br/>  filter(Species == "setosa") %&gt;%<br/>  select(Sepal.Length, Sepal.Width, Wikipedia) %&gt;%<br/>  mutate(Long.Sepal = if_else(Sepal.Length &gt; mean(Sepal.Length),<br/>                              TRUE,<br/>                              FALSE))<strong class="mz ir"> %&gt;%</strong><br/>  <strong class="mz ir">group_by(Long.Sepal) %&gt;%<br/>  summarise(Mean.Sepal.Length = mean(Sepal.Length))</strong></span></pre><p id="fbec" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">我们得到以下输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/362fdf58e706c335133d50efcf2c3120.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KL2Wyi5zx17fg05xLaVyVw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">将我们的数据框分组后输出</p></figure><p id="c9a9" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">为了获得相同的聚合平均值信息，但保留数据帧结构，在使用group_by函数后，我们使用mutate 【T0，】创建一个新列。这创建了与summarise函数相同的方法，但是行数保持不变。</p><p id="2d57" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">由于这是最后一步，所以不需要取消<strong class="lc ir">和</strong>的组合。然而，为了防止我们以后添加更多的转换步骤，现在就把它包含进来是个好主意，这样以后就不会忘记了。</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="ae13" class="nd ma iq mz b gy ne nf l ng nh">our_wrangled_data &lt;- iris %&gt;%<br/>  left_join(iris_wikipedia) %&gt;% <br/>  filter(Species == "setosa") %&gt;%<br/>  select(Sepal.Length, Sepal.Width, Wikipedia) %&gt;%<br/>  mutate(Long.Sepal = if_else(Sepal.Length &gt; mean(Sepal.Length),<br/>                              TRUE,<br/>                              FALSE)) <strong class="mz ir">%&gt;%<br/>  group_by(Long.Sepal) %&gt;%<br/>  mutate(Mean.Sepal.Length.Sepal.Group = mean(Sepal.Length)) %&gt;% <br/>  ungroup()</strong></span></pre><p id="ab54" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li lw lk ll lm lx lo lp lq ly ls lt lu lv ij bi translated">输出如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/fef476f0663f69cca98f3c4294d338ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DhFqRXNWQEBX82__aCce3g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建分组列后的输出</p></figure><h1 id="0ec4" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结论</h1><p id="f318" class="pw-post-body-paragraph kz la iq lc b ld mr jr lf lg ms ju li lw mt ll lm lx mu lp lq ly mv lt lu lv ij bi translated">在这些和相关函数的帮助下，我估计我完成了70 %的数据争论。缺少的一个主要东西是数据导入。我主要使用的是<a class="ae kv" href="https://community.snowflake.com/s/article/How-To-Connect-Snowflake-with-R-RStudio-using-RODBC-driver-on-Windows-MacOS-Linux" rel="noopener ugc nofollow" target="_blank">雪花</a>和<a class="ae kv" href="https://cran.r-project.org/web/packages/AzureStor/vignettes/intro.html" rel="noopener ugc nofollow" target="_blank"> Azure存储</a>连接器，但是对于大多数广泛使用的数据存储解决方案来说，R连接器是存在的。</p></div></div>    
</body>
</html>