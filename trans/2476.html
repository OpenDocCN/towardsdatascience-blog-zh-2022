<html>
<head>
<title>Parallelization with MultiProcessing in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的多处理并行化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/parallelization-w-multiprocessing-in-python-bd2fc234f516#2022-05-30">https://towardsdatascience.com/parallelization-w-multiprocessing-in-python-bd2fc234f516#2022-05-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="837c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">并行运行您的数据科学任务以加快计算速度</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0307407e67fa23abc06ce815bacb7971.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P3Q4zyC3PbbObqRW8MKMjA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://unsplash.com/@deepakrautela" rel="noopener ugc nofollow" target="_blank">迪帕克·劳特拉</a>从<a class="ae ky" href="https://unsplash.com/photos/jM7nOw748Ho" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="b17a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文将直观地介绍多处理是如何工作的，以及使用它来并行运行作业的相关步骤。我将使用pandas和numpy提供示例函数来并行运行计算量大的任务，以降低时间复杂度。以下是这篇文章的提纲:</p><h2 id="cbfb" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated"><strong class="ak">目录</strong></h2><ul class=""><li id="99b3" class="mo mp it lb b lc mq lf mr li ms lm mt lq mu lu mv mw mx my bi translated">什么是多重处理？</li><li id="039d" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">并行化背后的直觉</li><li id="5968" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">数据<br/> -需求<br/> -生成数据</li><li id="e26d" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">正在检查可用处理器的数量</li><li id="654e" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">并行化单参数函数<br/> -常规实现<br/> -并行实现</li><li id="82c9" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">并行化多参数函数<br/> -常规实现<br/> -并行实现</li><li id="4f82" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">结束语</li><li id="bf50" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">资源</li></ul><h1 id="2e69" class="ne lw it bd lx nf ng nh ma ni nj nk md jz nl ka mg kc nm kd mj kf nn kg mm no bi translated">什么是多重处理？</h1><p id="dc12" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">多重处理是指一个程序在两台或多台计算机上同时执行[1]。多重处理是Python 2.6以上版本中安装的一个模块。这是一个支持用户在一台机器上创建和销毁多个处理器的包。这使得程序员能够编写利用机器上所有可用处理器的代码[2]。它适用于Unix和Windows [2]。</p><blockquote class="ns nt nu"><p id="e8b4" class="kz la nv lb b lc ld ju le lf lg jx lh nw lj lk ll nx ln lo lp ny lr ls lt lu im bi translated"><code class="fe nz oa ob oc b"><a class="ae ky" href="https://docs.python.org/3/library/multiprocessing.html#module-multiprocessing" rel="noopener ugc nofollow" target="_blank">multiprocessing</a></code>包中的<code class="fe nz oa ob oc b"><a class="ae ky" href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool" rel="noopener ugc nofollow" target="_blank">Pool</a></code>函数允许程序员跨多个输入值并行执行一个函数，将输入数据分布到多个进程中(数据并行)。<br/>【2】<a class="ae ky" href="https://docs.python.org/3/library/multiprocessing.html" rel="noopener ugc nofollow" target="_blank">https://docs.python.org/3/library/multiprocessing.html</a></p></blockquote><h1 id="4410" class="ne lw it bd lx nf ng nh ma ni nj nk md jz nl ka mg kc nm kd mj kf nn kg mm no bi translated">并行化背后的直觉</h1><p id="5b5e" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">在数学中，如果两条或多条直线共面且不相交于任何一点，则它们是平行的。类似地，编程中的并行化指的是让一个功能同时在两个或多个进程上运行。这些进程在运行时从不相互影响。下图概述了一个函数的正常执行和一个函数在多个CPU(处理器)上的并行执行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/9b7c05606810a978ba798ff8e15d69a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6lfEaUwnWFo4hzlOTtDDOg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">正常运行一项功能与并行运行一项功能的过程。图片由作者提供。</p></figure><h1 id="0e53" class="ne lw it bd lx nf ng nh ma ni nj nk md jz nl ka mg kc nm kd mj kf nn kg mm no bi translated">数据</h1><p id="f455" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">下面是我们将要合成的数据集，用于并行执行代码。</p><h2 id="cf75" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">要求</h2><p id="a43b" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">运行下面的脚本需要以下依赖项和版本。</p><pre class="kj kk kl km gt oe oc of og aw oh bi"><span id="0e72" class="lv lw it oc b gy oi oj l ok ol">pandas&gt;=1.2.4<br/>numpy&gt;=1.20.1</span></pre><h2 id="cbc3" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">生成数据</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="0d74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面脚本的结果应该会产生类似下面的输出。这些值会有所不同，因为这些值是随机生成的，但是数据的整体结构将保持不变。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/bf50772a032844f114554798a7e4ff9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aZheEMF0Qd_VrXsF1pfLCQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">合成数据集。图片由作者提供。</p></figure><h1 id="5282" class="ne lw it bd lx nf ng nh ma ni nj nk md jz nl ka mg kc nm kd mj kf nn kg mm no bi translated">正在检查可用处理器的数量</h1><p id="cba9" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">以下命令允许您确定正在使用的计算机中可用的处理器数量:</p><pre class="kj kk kl km gt oe oc of og aw oh bi"><span id="5298" class="lv lw it oc b gy oi oj l ok ol">from multiprocessing import cpu_count<br/>cpu_count()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/f4552d2ae276dafae235415ad7be2877.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a_HTL92OHOEyS3scIoNdzg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">本教程中可用的CPU数量。图片由作者提供。</p></figure><p id="d10f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，即使有多个处理器可用，计算机上的大多数(如果不是全部)应用程序也只使用一个处理器。如果你要并行执行一个需要大量计算能力的脚本，你的计算机基本上会瘫痪。您可能正在使用的大多数其他应用程序几乎肯定会大幅变慢。建议使用一台远程计算机(你可以通过AWS / GCP / Azure /任何其他云平台租用)，它有足够数量的CPU可供使用。</p><h1 id="6bc6" class="ne lw it bd lx nf ng nh ma ni nj nk md jz nl ka mg kc nm kd mj kf nn kg mm no bi translated">并行化单参数函数</h1><p id="cb82" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">下面的函数将计算每个读者阅读的平均图书价格。</p><h2 id="dc61" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">常规实施</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="87f1" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">并行实现</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="f4c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，仅仅因为您可以并行化一个函数，并不意味着您总是应该这样做。在Python pandas中执行的上述相同函数的下面1行实现比普通和并行实现快得多。当你发现最有效的时间复杂度实现并不足够时，并行化你的工作。</p><pre class="kj kk kl km gt oe oc of og aw oh bi"><span id="4b86" class="lv lw it oc b gy oi oj l ok ol">gb_df = d.groupby('reader_id')['book_price'].mean().reset_index()</span></pre><h1 id="292a" class="ne lw it bd lx nf ng nh ma ni nj nk md jz nl ka mg kc nm kd mj kf nn kg mm no bi translated">并行化多参数函数</h1><p id="71be" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">下面的函数将生成与每个用户已经阅读的类型相关联的标准化的1热编码。</p><h2 id="7bb3" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">常规实施</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="fc15" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">并行实现</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><h1 id="9820" class="ne lw it bd lx nf ng nh ma ni nj nk md jz nl ka mg kc nm kd mj kf nn kg mm no bi translated">结束语</h1><p id="0a85" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">本文概述了对多重处理和并行执行程序的直觉和理解。它通过一个教程指导用户当函数有单个和多个参数时如何并行执行它们的函数。请注意，仅仅因为您可以并行运行一个函数并不意味着它总是最佳解决方案。以最有效的时间复杂度来确定脚本的执行，如果脚本仍然花费过多的时间，那么并行运行它。</p><p id="f6ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要了解代码，你可以参考我的GitHub上与本教程相关的Jupyter笔记本。</p><p id="58c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想转型进入数据行业，并希望得到经验丰富的导师的指导和指引，那么你可能想看看最敏锐的头脑。Sharpest Minds是一个导师平台，导师(他们是经验丰富的实践数据科学家、机器学习工程师、研究科学家、首席技术官等。)将有助于你的发展和学习在数据领域找到一份工作。点击查看<a class="ae ky" href="https://www.sharpestminds.com/?r=vatsal-patal" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="cd96" class="ne lw it bd lx nf ng nh ma ni nj nk md jz nl ka mg kc nm kd mj kf nn kg mm no bi translated">资源</h1><ul class=""><li id="9129" class="mo mp it lb b lc mq lf mr li ms lm mt lq mu lu mv mw mx my bi translated">[1]https://en.wikipedia.org/wiki/Multiprocessing<a class="ae ky" href="https://en.wikipedia.org/wiki/Multiprocessing" rel="noopener ugc nofollow" target="_blank"/></li><li id="2863" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">[2]https://docs.python.org/3/library/multiprocessing.html<a class="ae ky" href="https://docs.python.org/3/library/multiprocessing.html" rel="noopener ugc nofollow" target="_blank"/></li></ul></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><p id="9511" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢读这篇文章，你可能会发现我写的关于数据科学和机器学习的其他文章也很有趣。下面来看看吧。</p><div class="ox oy gp gr oz pa"><a rel="noopener follow" target="_blank" href="/random-walks-with-restart-explained-77c3fe216bca"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd iu gy z fp pf fr fs pg fu fw is bi translated">带重启的随机漫步解释</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">理解带重启的随机游走算法及其在Python中的相关实现</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">towardsdatascience.com</p></div></div><div class="pj l"><div class="pk l pl pm pn pj po ks pa"/></div></div></a></div><div class="ox oy gp gr oz pa"><a rel="noopener follow" target="_blank" href="/recommendation-system-matrix-factorization-svd-explained-c9a50d93e488"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd iu gy z fp pf fr fs pg fu fw is bi translated">推荐系统—矩阵分解(SVD)解释</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">利用潜在因素推荐构建推荐系统管道</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">towardsdatascience.com</p></div></div><div class="pj l"><div class="pp l pl pm pn pj po ks pa"/></div></div></a></div><div class="ox oy gp gr oz pa"><a rel="noopener follow" target="_blank" href="/comprehensive-guide-to-github-for-data-scientist-d3f71bd320da"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd iu gy z fp pf fr fs pg fu fw is bi translated">面向数据科学家的GitHub综合指南</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">通过UI和命令行为数据科学家提供的GitHub教程</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">towardsdatascience.com</p></div></div><div class="pj l"><div class="pq l pl pm pn pj po ks pa"/></div></div></a></div><div class="ox oy gp gr oz pa"><a rel="noopener follow" target="_blank" href="/active-learning-in-machine-learning-explained-777c42bd52fa"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd iu gy z fp pf fr fs pg fu fw is bi translated">机器学习中的主动学习解释</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">Python中主动学习管道的直觉和实现</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">towardsdatascience.com</p></div></div><div class="pj l"><div class="pr l pl pm pn pj po ks pa"/></div></div></a></div><div class="ox oy gp gr oz pa"><a rel="noopener follow" target="_blank" href="/text-similarity-w-levenshtein-distance-in-python-2f7478986e75"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd iu gy z fp pf fr fs pg fu fw is bi translated">Python中带Levenshtein距离的文本相似度</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">用Python构建抄袭检测管道</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">towardsdatascience.com</p></div></div><div class="pj l"><div class="ps l pl pm pn pj po ks pa"/></div></div></a></div><div class="ox oy gp gr oz pa"><a rel="noopener follow" target="_blank" href="/text-summarization-in-python-with-jaro-winkler-and-pagerank-72d693da94e8"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd iu gy z fp pf fr fs pg fu fw is bi translated">用Jaro-Winkler和PageRank实现Python中的文本摘要</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">用Jaro-Winkler和PageRank构建一个文本摘要器</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">towardsdatascience.com</p></div></div><div class="pj l"><div class="pt l pl pm pn pj po ks pa"/></div></div></a></div><div class="ox oy gp gr oz pa"><a rel="noopener follow" target="_blank" href="/link-prediction-recommendation-engines-with-node2vec-c97c429351a8"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd iu gy z fp pf fr fs pg fu fw is bi translated">使用Node2Vec的链接预测推荐引擎</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">在Python中使用节点嵌入进行链接预测</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">towardsdatascience.com</p></div></div><div class="pj l"><div class="pu l pl pm pn pj po ks pa"/></div></div></a></div><div class="ox oy gp gr oz pa"><a rel="noopener follow" target="_blank" href="/optimize-training-predicting-sk-learn-models-in-python-with-sparse-matrices-1612072a025d"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd iu gy z fp pf fr fs pg fu fw is bi translated">使用稀疏矩阵优化Python中SK-Learn模型的训练和预测</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">使用稀疏矩阵训练SK-Learn模型的速度提高了40倍</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">towardsdatascience.com</p></div></div><div class="pj l"><div class="pv l pl pm pn pj po ks pa"/></div></div></a></div><div class="ox oy gp gr oz pa"><a rel="noopener follow" target="_blank" href="/recommendation-systems-explained-a42fc60591ed"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd iu gy z fp pf fr fs pg fu fw is bi translated">推荐系统解释</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">用Python解释和实现基于内容的协同过滤和混合推荐系统</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">towardsdatascience.com</p></div></div><div class="pj l"><div class="pw l pl pm pn pj po ks pa"/></div></div></a></div><div class="ox oy gp gr oz pa"><a rel="noopener follow" target="_blank" href="/word2vec-explained-49c52b4ccb71"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd iu gy z fp pf fr fs pg fu fw is bi translated">Word2Vec解释道</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">解释Word2Vec的直观性&amp;用Python实现它</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">towardsdatascience.com</p></div></div><div class="pj l"><div class="px l pl pm pn pj po ks pa"/></div></div></a></div><div class="ox oy gp gr oz pa"><a rel="noopener follow" target="_blank" href="/bayesian-a-b-testing-explained-344a6df88c1a"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd iu gy z fp pf fr fs pg fu fw is bi translated">贝叶斯A/B测试解释</h2><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">towardsdatascience.com</p></div></div><div class="pj l"><div class="py l pl pm pn pj po ks pa"/></div></div></a></div></div></div>    
</body>
</html>