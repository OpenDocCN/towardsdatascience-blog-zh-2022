<html>
<head>
<title>Are You Using Feature Distributions to Detect Outliers?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">您是否使用特征分布来检测异常值？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/are-you-using-feature-distributions-to-detect-outliers-48e2ae3309#2022-08-30">https://towardsdatascience.com/are-you-using-feature-distributions-to-detect-outliers-48e2ae3309#2022-08-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/ac56e1e0b8e0a11bced4266259be33ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_oMdKaV_CLYpRKX8"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">威尔·梅尔斯在<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><div class=""/><div class=""><h2 id="84f2" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">这里有三种更好的方法。</h2></div><p id="9ee5" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh">作为数据科学家，你可能遇到过这种情况:数据点不合适，对你的模型的性能有不良影响。你如何发现它们？你看了盒子或者散点图了吗？在检测之后，您是丢弃异常值还是使用其他方法来提高数据质量？在本文中，我将解释三种检测异常值的方法。</strong></p><h1 id="2201" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">定义和数据</h1><p id="ce71" class="pw-post-body-paragraph kv kw jg kx b ky mj kh la lb mk kk ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">离群值被定义为与其他观察值显著不同的数据点。但重要的是什么？如果一个数据点的单独特征看起来正常，但特征值的组合很少或不太可能，您应该怎么办？在大多数项目中，数据将包含多个维度，这使得肉眼很难发现异常值。或者用箱线图。</p><p id="fabd" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面，你可以看到我将在本文中使用的数据的散点图。它<a class="ae jd" href="https://www.openml.org/search?type=data&amp;sort=runs&amp;id=41211&amp;status=active" rel="noopener ugc nofollow" target="_blank">存放来自OpenML </a>(知识共享许可)的数据。这些图表和数据使解释检测技术变得更加容易。我将只使用四个特性(GrLivArea、YearBuilt、LotArea、OverallQual)和目标销售价格。该数据包含1460个观察值。</p><figure class="mp mq mr ms gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mo"><img src="../Images/8acef2f90d30715a00cde3e7bd640087.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T-R7BIau_CHOZcgOKb318A.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">与销售价格(目标)相比的特性图。图片作者。</p></figure><p id="fdb4" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">根据这些图，您预计哪些点会被检测为异常值？🤓</p><p id="5f50" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">加载数据并绘制异常值的代码:</p><figure class="mp mq mr ms gt is"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h1 id="dfab" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">检测方法</h1><p id="3f56" class="pw-post-body-paragraph kv kw jg kx b ky mj kh la lb mk kk ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">让我们开始吧！我将讨论的三种检测方法是库克距离、DBSCAN和隔离森林。随意跳过你熟悉的部分。</p><h2 id="8fae" class="mv ls jg bd lt mw mx dn lx my mz dp mb le na nb md li nc nd mf lm ne nf mh ng bi translated"><strong class="ak"> 1。库克的距离</strong></h2><p id="9eb6" class="pw-post-body-paragraph kv kw jg kx b ky mj kh la lb mk kk ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">介绍Cook距离[1]的原文章标题为:<em class="nh">线性回归中有影响观测值的检测</em>。这正是库克距离所做的:它衡量一个数据点对回归模型的影响有多大。该方法通过测量移除数据点时模型中拟合值的变化来计算数据点的库克距离。</p><p id="5b01" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh">数据点的库克距离越高，该点对确定模型中的拟合值的影响越大。</strong>如果一个数据点与其他库克距离相比具有较高的库克距离，则该数据点更有可能是异常值。</p><p id="7b72" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在Python中，很容易计算厨师的距离值。建立回归模型后，您可以立即计算距离。下面你可以看到库克的距离值的Id图:</p><figure class="mp mq mr ms gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ni"><img src="../Images/ba557217bace2c0f1317b42216b27923.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OKRfPSLA7-jsJUlxUGfZ9w.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">每个数据点Id的厨师距离值。高库克距离意味着该数据点更有可能是异常值。图片作者。</p></figure><p id="ab93" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有不同的方法来确定要将哪些点标记为异常值。任何高于4/ <em class="nh"> n </em>的值都值得研究，其中<em class="nh"> n </em>是样本大小(本例中为1460)。另一种方法是计算厨师距离的平均值<em class="nh"> </em>，并去除大于3* <em class="nh"> </em>的值。我使用最后一种方法来确定异常值。用这种方法有28个异常值。我在没有他们的情况下重新训练了模型。下面你看到的结果，很好的改善，对不对？当心！在删除异常值之前，您必须对其进行调查！稍后将详细介绍这一点。</p><figure class="mp mq mr ms gt is gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/7ae17e45fcd83bec5bf60b583b0127c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*JZfVfmfQCzyBkMdlWfBBdQ.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">剔除异常值前后的结果。图片作者。</p></figure><p id="5772" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">根据库克距离的异常值以橙色表示:</p><figure class="mp mq mr ms gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mo"><img src="../Images/01201fa2063650b44d29d27159863cd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y5r25OCglDpVk9h-c_B8gA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">库克距离的橙色异常值。图片作者。</p></figure><p id="4fc2" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">计算库克距离并显示异常值的代码:</p><figure class="mp mq mr ms gt is"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="ce3b" class="mv ls jg bd lt mw mx dn lx my mz dp mb le na nb md li nc nd mf lm ne nf mh ng bi translated">2.基于密度的噪声应用空间聚类</h2><p id="30b6" class="pw-post-body-paragraph kv kw jg kx b ky mj kh la lb mk kk ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">您可能知道DBSCAN(带噪声的应用程序的基于密度的空间聚类)是一种聚类技术。给定一个数据集，<strong class="kx jh"> DBSCAN查找高密度的岩心样本，并使用这些样本创建聚类</strong> [2]。您不必指定聚类的数量(与K-Means一样)，这是DBSCAN的一个很好的优势。</p><p id="8973" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用DBSCAN，您必须指定两个参数:epsilon <em class="nh"> (eps) </em>和最小样本数<em class="nh"> (min_samples)。</em>ε是距离度量，也是最重要的参数:它是两个样本之间的最大距离，其中一个样本被认为与另一个样本相邻。最小样本是一个点的邻域中被认为是核心点的样本数。这包括点本身，因此如果<em class="nh"> min_samples </em>等于1，则每个点都是一个聚类。</p><p id="f8e1" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">DBSCAN对于检测异常值非常有用。DBSCAN将数据点分为三组:一组是具有<strong class="kx jh">核心</strong>数据点的组，这些数据点在距离它们小于<em class="nh"> eps </em>的距离内至少有<em class="nh"> min_samples </em>。比有<strong class="kx jh">边界</strong>点，这些点至少有一个核心点在距离它们小于<em class="nh"> eps </em>的距离内。最后一组包含不是核心点或边界点的点。这些点是<strong class="kx jh">噪声</strong>点，或者潜在的异常值。核心点和边界点接收它们的聚类号，而噪声点接收cluster -1。</p><figure class="mp mq mr ms gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nk"><img src="../Images/6542ba009a3159dbc71d75586d855478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MwbwzpTwRaUrB24qCUDf1A.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">最小样本量为三的核心、边界和噪声点。图片作者。</p></figure><p id="cc8a" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在使用DBSCAN进行异常值检测之前，可能有必要对数据进行缩放。在这个例子中，我使用了一个<a class="ae jd" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html" rel="noopener ugc nofollow" target="_blank"> StandardScaler </a>，因为数据特征具有非常不同的比例(总体质量值从1到10，年构建值从1860到2020，LotArea从0到250000)。</p><p id="0ad0" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如何找到<em class="nh"> eps </em>和<em class="nh"> min_samples </em>的正确值？对于<em class="nh"> min_samples </em>，可以使用经验法则D+1，其中D等于数据集中的维数。在本例中，我们将使用<em class="nh"> min_samples = </em> 6 <em class="nh">。</em>参数<em class="nh"> eps </em>有点难，可以用K-distance图找到正确的值。你看到手肘了吗？<em class="nh"> eps </em>的值在1左右，我最后一次运行用的是1.1。</p><figure class="mp mq mr ms gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/b9ed9827ad7ee62a41e2c07b0290dc73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LuGYqzMRwDYKAahb6XMPhQ.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图片作者。</p></figure><p id="b089" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面你可以看到正常点和异常点的曲线图。当我们使用1.1的ε和6的最小样本时，根据DBSCAN，橙色点是异常值。</p><figure class="mp mq mr ms gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mo"><img src="../Images/a72d0031c96e092ede3e4fdc65cc73d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*esjuHNwneXDI7NBuwOpi_w.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">DBSCAN检测到橙色中的异常值。图片作者。</p></figure><p id="d9fd" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">代码DBSCAN:</p><figure class="mp mq mr ms gt is"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="de4d" class="mv ls jg bd lt mw mx dn lx my mz dp mb le na nb md li nc nd mf lm ne nf mh ng bi translated">3.隔离森林</h2><p id="6969" class="pw-post-body-paragraph kv kw jg kx b ky mj kh la lb mk kk ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">作为异常检测模型，隔离森林非常好。它是如何工作的？</p><p id="533b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">孤立森林由树木组成，就像普通的随机森林一样。在每棵树中，随机特征被选择，并且在该特征的最大值和最小值之间随机分割值。对于每个样本<strong class="kx jh">，</strong>，您可以计算出分离该样本所需的树分裂数。到样本的平均路径长度越短，越有可能是异常值(或异常值)。这有道理吧？<strong class="kx jh">如果您需要更少的分割来获得一个数据点，它与其他数据点不同，因为该点更容易隔离</strong>:</p><figure class="mp mq mr ms gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nm"><img src="../Images/5dbb852fb8c6d50ce09c7fe34b136b07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s_L43ROWfkp9DuY8ib6Www.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">孤立森林中的一棵树。通过一次分割，一个点与其他点分离。这一点得到高异常分数。图片作者。</p></figure><p id="8598" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">由于树的灵活性，您还可以将这种技术应用于分类数据。</p><p id="2207" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">隔离林的参数呢？一些参数与正常随机森林中的参数相同:您可以选择树的数量(<em class="nh"> n_estimators </em>)、每棵树的最大样本数量(<em class="nh"> max_samples </em>)以及用于训练的特征数量(<em class="nh"> max_features </em> ) <em class="nh">)。还有一个重要的参数:污染度。您可以将污染视为数据集中异常值的比例。它用于确定阈值，以决定哪些点是异常值。如果您想要对数据点及其异常分数进行排序，您可以使用scikit learn中的decision_function。并对数值进行升序排序:分数越高，该点越正常。</em></p><p id="f069" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">隔离森林有一个缺点。正常的边缘点也容易隔离。这些点有可能被归类为异常值，尽管它们是正常的。使用这种技术时，请记住这一点。</p><p id="479f" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">隔离林发现异常值(橙色):</p><figure class="mp mq mr ms gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mo"><img src="../Images/8813da8693e5c2d82a77ea53a67c72af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*orLrnruv43YdMBVVLuCzmQ.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">橙色的异常值。图片作者。</p></figure><p id="6a5a" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用隔离林查找离群值的代码:</p><figure class="mp mq mr ms gt is"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h1 id="911c" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">技术比较</h1><p id="d129" class="pw-post-body-paragraph kv kw jg kx b ky mj kh la lb mk kk ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">但是等等…三种异常值检测技术中没有一种能找到与另一种完全相同的异常值！很奇怪，不是吗？19个点由所有三种技术检测，而另外42个点由两种或仅一种技术检测:</p><figure class="mp mq mr ms gt is gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/54aa864af5cbfc5a553ac78eb01f07f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*wE0lpz8TkBkuYIpPKQTBKQ.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">比较每种方法的异常值数量以及它们之间的关系。图片作者。</p></figure><p id="27cf" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这部分取决于参数和方法之间的差异。一个简短的总结:库克的距离使用一个经过训练的模型来计算每个点的影响，DBSCAN使用点之间的距离，隔离森林计算点到点的平均路径长度。根据具体情况，您可以选择最佳技术。</p><h1 id="264e" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">下一步是什么？</h1><p id="6c55" class="pw-post-body-paragraph kv kw jg kx b ky mj kh la lb mk kk ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">检测到异常值后，您应该如何处理它们？我希望你不要把它们扔掉，就像它们从未存在过一样！它们进入了数据集，所以如果你不做任何事情来阻止它，它就有可能再次发生。</p><p id="dec9" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可以在下面的文章中找到关于处理异常值的提示:</p><div class="ip iq gp gr ir no"><a href="https://hennie-de-harder.medium.com/dont-throw-away-your-outliers-c37e1ab0ce19" rel="noopener follow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd jh gy z fp nt fr fs nu fu fw jf bi translated">不要扔掉你的离群值！</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">在你尝试这些技术之前。</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">hennie-de-harder.medium.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc ix no"/></div></div></a></div></div><div class="ab cl od oe hu of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="ij ik il im in"><h1 id="ddcb" class="lr ls jg bd lt lu ok lw lx ly ol ma mb km om kn md kp on kq mf ks oo kt mh mi bi translated">参考</h1><p id="9835" class="pw-post-body-paragraph kv kw jg kx b ky mj kh la lb mk kk ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">[1]库克博士(1977年)。线性回归中影响观测值的检测。技术计量学，19(1)，15–18。多伊:10.1080/0040176767686</p><p id="74fb" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">[2] Ester，m .，H. P. Kriegel，J. Sander，和X. Xu，“一种在带有噪声的大型空间数据库中发现聚类的基于密度的算法”。摘自:第二届知识发现和数据挖掘国际会议论文集，俄勒冈州波特兰市，AAAI出版社，第226–231页。1996</p></div></div>    
</body>
</html>