<html>
<head>
<title>Develop Lambdas And Debug Them Locally Using SAM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SAM开发Lambdas并在本地调试它们</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/develop-lambdas-and-debug-them-locally-using-sam-8f367793cc1a#2022-04-18">https://towardsdatascience.com/develop-lambdas-and-debug-them-locally-using-sam-8f367793cc1a#2022-04-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6010" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">开发无服务器应用程序有其挑战性，SAM为这些挑战提供了一个解决方案。了解如何使用SAM开发lambdas并在本地调试它们。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0ad4021c28e45796971a0317c5d23824.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*csN3G-_pXo5KLooRgZ05MA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由珀西·博尔梅尔提供。Gopher由拓也·上田提供，原始Go Gopher由勒内·弗伦奇提供(CC BY 3.0)</p></figure><p id="5ac6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">无服务器应用程序很棒，我们可以在生产中以超快的速度启动并运行一个功能，正常运行时间非常长，而且几乎没有成本。</p><p id="bb3f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Lambda是一项AWS服务，它允许您部署可运行的小段代码。例如，我们可以部署一个小型的Go二进制程序来执行一个任务，并通过一个API来触发它，调度它，或者让它基于其他几个事件来执行。</p><p id="cefd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，调试这些服务可能很难，因为它们运行在云上。我过去构建函数的方式可以很容易地在本地运行它们，并且简单地用lambda处理程序包装那个函数。这是可行的，但是有时我们想要调试整个流程以及我们使用的服务。</p><p id="0c76" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我经常鼓吹软件需要在本地运行，SAM帮助我们在本地运行我们的云应用。</p><p id="a4f7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本教程中，我希望你已经有了一些要求，否则就没有理由阅读如何本地调试lambda了。</p><ul class=""><li id="06b3" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">拥有足够IAM权限的AWS帐户</li><li id="8c4e" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">安装和配置AWS CLI</li></ul><p id="8557" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您没有AWS帐户或AWS CLI，请按照官方<a class="ae mi" href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-prereqs.html" rel="noopener ugc nofollow" target="_blank">文档</a>安装。</p><p id="6642" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你更喜欢视频格式，你可以在我的<a class="ae mi" href="https://www.youtube.com/watch?v=QWfuA5SrmW8&amp;t=1693s" rel="noopener ugc nofollow" target="_blank"> Youtube </a>上找到这篇文章。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">本文的视频版本</p></figure><p id="b88d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以在<a class="ae mi" href="https://github.com/percybolmer/sam-go-lambda-demo" rel="noopener ugc nofollow" target="_blank"> GitHub </a>找到视频中使用的完整代码。</p><h2 id="c25c" class="ml mm it bd mn mo mp dn mq mr ms dp mt lh mu mv mw ll mx my mz lp na nb nc nd bi translated">山姆是谁？</h2><p id="22a9" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">Sam(无服务器应用模型)是一个帮助我们构建云应用的AWS框架。Sam有一个模板语言，我们可以用它来编写云架构的结构，我们可以利用该模板在本地部署和运行它。Sam正在幕后使用<a class="ae mi" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/Welcome.html" rel="noopener ugc nofollow" target="_blank"> CloudFormation </a>，你现在不需要了解CF。</p><p id="9d70" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我们将创建几个简单的lambda，并使用SAM对它们进行测试，我们还将尝试通过附加远程调试器来调试lambda。SAM允许我们使用docker在本地运行lambdas或lambdas的API。</p><p id="1a27" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用SAM与IDE无关，您可以使用任何IDE来利用SAM。据我所知，大多数人确实倾向于使用VS代码，因为他们有很棒的插件，我们将在最后介绍。</p><p id="fdab" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们从安装SAM开始，你可以找到关于如何在<a class="ae mi" href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html" rel="noopener ugc nofollow" target="_blank"> AWS </a>上安装的官方文档。</p><p id="1399" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我使用的是Linux，所以下面是我安装SAM的方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用于安装SAM的安装脚本</p></figure><p id="a8bf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以通过运行version命令进行验证</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="1d61" class="ml mm it nl b gy np nq l nr ns">sam --version</span></pre><h2 id="b8ba" class="ml mm it bd mn mo mp dn mq mr ms dp mt lh mu mv mw ll mx my mz lp na nb nc nd bi translated">创建Lambda</h2><p id="8f42" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">让我们创建第一个简单的lambda。我将在本教程中使用Go来演示，但是你应该能够使用任何你想要的支持lambdas的语言。您可以在<a class="ae mi" href="https://docs.aws.amazon.com/lambda/latest/dg/welcome.html" rel="noopener ugc nofollow" target="_blank"> AWS文档</a>中找到关于您的语言的代码示例，每种支持的语言都有一个名为<code class="fe nt nu nv nl b">Working with $LANGUAGENAME</code>的章节。</p><p id="fb6a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">创建一个新文件夹并初始化一个go模块，创建一个名为<code class="fe nt nu nv nl b">main.go</code>的文件和一个名为<code class="fe nt nu nv nl b">template.yml</code>的文件。暂时忘记模板文件，让它保持空白，我们稍后会谈到它。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="c7d6" class="ml mm it nl b gy np nq l nr ns">touch sam-lambda-demo<br/>cd sam-lambda-demo<br/>go mod init programmingpercy.tech/sam-demo<br/>touch main.go<br/>touch template.yml</span></pre><p id="22a8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们用整个宇宙中存在的最简单的λ来填充<code class="fe nt nu nv nl b">main.go</code>，我们将接受一个包含名称的输入事件，我们将打印<code class="fe nt nu nv nl b">Hello $name</code>。</p><p id="7ea9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你猜对了，这是一个Hello World Lambda！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">main . go—gopher历史上最简单的lambda。</p></figure><p id="d562" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nt nu nv nl b">Event</code>结构定义了我们的lambda输入应该是什么样子，我们将输出一个<code class="fe nt nu nv nl b">string,error</code>。您可以返回您想要的任何结构，或者任何AWS定义的事件。稍后，当我们尝试在lambda前面使用API网关时，我们将介绍AWS事件。</p><h2 id="f18a" class="ml mm it bd mn mo mp dn mq mr ms dp mt lh mu mv mw ll mx my mz lp na nb nc nd bi translated">使用Sam模板</h2><p id="64a7" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">在我们开始调试之前，我将介绍SAM的一些简单方面，以便我们理解正在发生的事情。</p><p id="a283" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Sam打包了一系列功能，它甚至可以将您的应用程序部署到AWS中。现在，让我们慢慢来，构建lambda并尝试调用它。</p><blockquote class="nw nx ny"><p id="0c39" class="ky kz nz la b lb lc ju ld le lf jx lg oa li lj lk ob lm ln lo oc lq lr ls lt im bi translated">当我说应用程序时，我指的是整个云资源集，而不是您的单个Go二进制文件——资源集构成了我们的无服务器应用程序</p></blockquote><p id="4e6d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了构建我们的应用程序，我们首先需要定义应用程序拥有哪些云资源。这是在<code class="fe nt nu nv nl b">template.yml</code>中使用特定的格式完成的。</p><p id="7ba7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将从我能想象到的最简单的模板开始，并经历一切是什么。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">template.yml —单个lambda的简单SAM模板文件</p></figure><p id="8344" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在文件的开头，你会看到一些我从未见过改变的默认设置。我们定义要使用的模板版本。事实上，根据<a class="ae mi" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/format-version-structure.html" rel="noopener ugc nofollow" target="_blank">文档</a>只有一个有效版本。</p><p id="1930" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将重点关注<code class="fe nt nu nv nl b">Resources</code>部分。在其中，我们可以定义整个SAM应用程序将拥有哪些资源。</p><p id="4388" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">语法非常简单，您以资源的名称开始yml，我们创建一个名为<code class="fe nt nu nv nl b">HelloGopher</code>的lambda。这可以是你喜欢的任何东西，重要的是你可以用这个名字来引用其他资源，当你需要一个特定的arn时，这很重要。</p><p id="1cf5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所有资源都接受一个<code class="fe nt nu nv nl b">Type</code>输入，类型可以是cloudformation允许的任何东西，通常是<code class="fe nt nu nv nl b">AWS::Serverless:RESOURCETYPE</code>。如你所见，我们将类型设置为<code class="fe nt nu nv nl b">AWS::Serverless::Function</code>，这告诉cloudformation为我们生成一个lambda。</p><p id="8681" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">每种类型都有自己的一组可用属性，可以在文档中找到。要找到函数的可用属性，请查看它们的<a class="ae mi" href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-function.html" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="f048" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nt nu nv nl b">CodeUri</code>非常重要，这是包含我们代码的ZIP文件的本地路径或S3路径。在这个例子中，我使用了同一个文件夹，在一个真实的项目中，你可能有lambdas，你可以创建一个类似于<code class="fe nt nu nv nl b">lambdas/hello-gopher/</code>的文件夹结构，并将codeuri更改为一个更具可伸缩性的解决方案。</p><p id="5e63" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nt nu nv nl b">Handler</code>用于设置一旦执行lambda就会调用的某个二进制文件，让我们试着用SAM来解释这个。</p><p id="bf02" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您现在尝试通过运行<code class="fe nt nu nv nl b">sam local invoke</code>来运行Lambda，您应该会看到一个崩溃报告，说没有这样的文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由于没有这样的文件，Sam崩溃</p></figure><p id="db29" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这只是因为我们将<code class="fe nt nu nv nl b">Handler</code>设置为指向尚不存在的<code class="fe nt nu nv nl b">hello-gopher</code>二进制文件。让我们开始利用山姆来帮助我们。</p><h2 id="b3c7" class="ml mm it bd mn mo mp dn mq mr ms dp mt lh mu mv mw ll mx my mz lp na nb nc nd bi translated">Sam构建和调用</h2><p id="1430" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">我们可以使用SAM来打包我们的应用程序，build命令带有许多参数标志。例如，您可以构建并将其发送到S3。</p><p id="e7b8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用SAM build很好，因为它将利用您的模板文件，并通过使用<code class="fe nt nu nv nl b">runtime</code>属性来使用go的正确版本。</p><p id="4de6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它非常容易使用，在与您的<code class="fe nt nu nv nl b">template.yml</code>相同的文件夹中运行以下命令</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="883a" class="ml mm it nl b gy np nq l nr ns">sam build</span></pre><p id="2052" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您应该会看到一个<code class="fe nt nu nv nl b">.aws</code>文件夹出现，打开该文件夹会显示lambda和名为<code class="fe nt nu nv nl b">hello-gopher</code>的二进制文件。</p><p id="fcd6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过本地调用lambda重试运行项目的时间。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="2f18" class="ml mm it nl b gy np nq l nr ns">sam local invoke</span></pre><p id="0d8a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你应该看到它打印，你好，但没有给出名称。这是因为我们需要添加输入事件。这是通过使用<code class="fe nt nu nv nl b">-e</code>或<code class="fe nt nu nv nl b">--event</code>选项来完成的，它们可以指向一个文件或一个JSON字符串。我更喜欢使用文件，因为这也可以作为lambda的示例文档。</p><p id="9129" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在名为<code class="fe nt nu nv nl b">event.json</code>的文件夹中创建一个文件，并粘贴到与lambda中的事件结构相匹配的JSON中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">event . JSON——我们期望lambda中的有效负载。</p></figure><p id="f8d0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，再次调用lambda，但是这次我们添加了指向<code class="fe nt nu nv nl b">event-json</code>文件的<code class="fe nt nu nv nl b">-e</code>标志。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Sam使用有效负载调用</p></figure><p id="a64d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">令人惊讶的是，它现在打印了我们在有效载荷中使用的名称。AWS SDK中有大量的自定义lambda事件可以使用，但是我们将在特定于lambda的教程中介绍这些事件。</p><p id="693c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有一个<code class="fe nt nu nv nl b">-d</code>标志允许我们传入一个远程调试端口，记住这一点非常重要。这是允许我们将调试器附加到lambda的特性。</p><p id="f9b9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请注意，我们只有一个lambda，但是如果您有多个lambda，您可以通过在命令中添加lambda的名称来指定要运行的lambda。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="d0ab" class="ml mm it nl b gy np nq l nr ns">sam local invoke hello-gopher # Runs a specific lambda</span></pre><p id="4bf0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想运行一个lambda并将其作为一个服务公开，就像它在真实的云上运行一样，你可以使用<code class="fe nt nu nv nl b">start-lambda</code>命令来模拟。</p><p id="d1d6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们尝试运行以下命令</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="9ddc" class="ml mm it nl b gy np nq l nr ns">sam local start-lambda</span></pre><p id="0e80" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这应该会打印出lambda公开的URL，我们可以将它添加到AWS cli来调用lambda。默认的网址是<a class="ae mi" href="http://127.0.0.1:3001/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:3001 </a>。</p><p id="a55a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以使用URL作为AWS CLI的端点，通过以下命令调用它。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="6375" class="ml mm it nl b gy np nq l nr ns">aws lambda invoke --function-name HelloGopher --endpoint "<a class="ae mi" href="http://127.0.0.1:3001" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:3001</a>" --payload '{ "name": "percy"}' response.json</span></pre><p id="5d63" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个命令将调用lambda，插入有效负载并将响应输出到<code class="fe nt nu nv nl b">response.json</code>。</p><h2 id="d9f4" class="ml mm it bd mn mo mp dn mq mr ms dp mt lh mu mv mw ll mx my mz lp na nb nc nd bi translated">Sam API网关</h2><p id="3498" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">很多时候，您希望在运行Lambda时，前面有一个API网关。API网关将把Lambda作为HTTP API公开。</p><p id="e262" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">与SAM一起管理和设置非常简单。我们需要创建lambda资源监听的<code class="fe nt nu nv nl b">Events</code>，这不一定是HTTP，它可以是SQS或许多其他AWS服务事件。使用类型<code class="fe nt nu nv nl b">API</code>会让Sam知道这是一个API网关。</p><p id="0368" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将修改<code class="fe nt nu nv nl b">template.yml</code>来添加API端点作为POST。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">template.yml —添加API事件</p></figure><p id="4471" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们还需要修改lambda来接受API网关事件，这些事件的结构有点不同。它们用一些元数据(如请求标识符)包装原始请求。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">main . go——修改了我们的lambda，使其作为API端点运行</p></figure><p id="f7ed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要打开API并在本地公开端点，这在您开发具有许多端点的API并希望在本地尝试您的系统时非常方便，我们可以再次使用SAM。</p><p id="fe44" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们构建新的Lambda并用<code class="fe nt nu nv nl b">sam local start-api</code>运行API。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="184c" class="ml mm it nl b gy np nq l nr ns">sam build<br/>sam local start-api</span></pre><p id="2720" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您应该看到一个输出，它指定了API在哪个端口上运行，对我来说，输出如下。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="cf2e" class="ml mm it nl b gy np nq l nr ns">Mounting HelloGopher at <a class="ae mi" href="http://127.0.0.1:3000/api/hellogopher" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:3000/api/hellogopher</a> [POST]</span></pre><p id="158c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以用CURL来尝试，并发送预期的数据负载。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="e6f4" class="ml mm it nl b gy np nq l nr ns">curl -X POST localhost:3000/api/hellogopher -d '{"name": "percy"}'</span></pre><h2 id="6721" class="ml mm it bd mn mo mp dn mq mr ms dp mt lh mu mv mw ll mx my mz lp na nb nc nd bi translated">Sam环境变量</h2><p id="8748" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">大多数时候，你的lambda需要配置。很多时候这是通过使用环境变量来完成的。</p><p id="7c40" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我建议在<code class="fe nt nu nv nl b">template.yml</code>中指定期望的变量，这提供了使用CLI修改变量的能力，我们将很快介绍这一点。</p><p id="5bb5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了添加环境，我们修改了模板并添加了一个简单的<code class="fe nt nu nv nl b">Environment</code>属性。</p><p id="60dd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是我的<code class="fe nt nu nv nl b">template.yml</code>和一个名为<code class="fe nt nu nv nl b">my-cool-variable</code>的环境变量的片段。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">template.yml —将环境变量添加到我们的lambda中</p></figure><p id="1bf4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们需要开始使用lambda中的环境变量，我将只把它的值添加到输出中，修改<code class="fe nt nu nv nl b">main.go</code>中的第31行如下。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">main.go:31 —添加了环境变量</p></figure><p id="d6d8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这看起来似乎微不足道，但是您现在可以在SAM CLI中非常灵活地利用它来设置新的变量。我们可以使用<code class="fe nt nu nv nl b">-n</code>参数修改调用之间的变量。记住，在API中可以有多个lambda端点，每个lambda可以需要自己的一组环境变量。</p><p id="3bda" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以创建一个特殊的环境JSON文件来控制每个lambdas环境。您必须使用来自<code class="fe nt nu nv nl b">template.yml</code>的资源名称，并且只有在<code class="fe nt nu nv nl b">template.yml</code>中指定的环境是可修改的。如果你试图设置一个没有在模板中声明的变量，它将不会被添加。</p><p id="a5f2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">创建一个名为<code class="fe nt nu nv nl b">environments.json</code>的新文件，我们将用它来修改每个lambda resources环境变量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">environments.json —我们要修改的变量</p></figure><p id="9175" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">尝试使用<code class="fe nt nu nv nl b">-n</code>标志重新构建并执行API来指出环境文件，您现在应该会看到打印出的新值。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="008f" class="ml mm it nl b gy np nq l nr ns">sam local start-api -n environments.json</span></pre><p id="4063" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">还有一些参数，它们与环境变量不同，但它们与云的形成有更大的关系，我们在这里不讨论细节。</p><h2 id="a17c" class="ml mm it bd mn mo mp dn mq mr ms dp mt lh mu mv mw ll mx my mz lp na nb nc nd bi translated">Sam生成事件</h2><p id="83fb" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">并不是所有的lambda都被公开为API，例如，一些lambda监听SQS事件或S3事件来触发它们。</p><p id="c98f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一种非常常见的方法是用lambda监听SQS事件，遗憾的是这很难测试。没有办法将Sam连接到SQS队列来测试它，相反，测试它的方法是生成一个SQS有效负载并使用该有效负载调用lambda。这将模拟一个被发射到lambda中的现场事件。</p><p id="2ecb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在你可能想知道，SQS事件看起来如何？我不知道，我们也不需要知道，因为Sam可以帮助我们为通常与lambdas相关的已知AWS服务生成虚假的有效载荷。</p><p id="214d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们从更新<code class="fe nt nu nv nl b">template.yml</code>并添加一个新的lambda开始，这个lambda将在一个名为<code class="fe nt nu nv nl b">my-awesome-queue</code>的队列上监听SQS事件。现在，正如我所说的，我们不能让萨姆在本地监听<code class="fe nt nu nv nl b">my-awesome-queue</code>，但是我们可以伪造有效载荷。以下要点显示了如何告诉山姆关于SQS的事情，<code class="fe nt nu nv nl b">template.yml</code>中唯一的新部分是新的lambda，它会触发SQS事件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">yml——我们添加了一个lambda函数，它在SQS队列上触发</p></figure><p id="47ea" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe nt nu nv nl b">CodeUri</code>中，我们指定了<code class="fe nt nu nv nl b">./sqslambda</code>的位置，所以我们可以从创建那个文件夹开始，并用我们的lambda在其中添加一个<code class="fe nt nu nv nl b">main.go</code>。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="3f6b" class="ml mm it nl b gy np nq l nr ns">mkdir ./sqslambda<br/>touch main.go</span></pre><p id="0411" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们新的lambda将非常简单，只将输入事件打印到日志中。我们将使用来自AWS SDK的相同的<code class="fe nt nu nv nl b">events</code>包，并指定该事件是一个<code class="fe nt nu nv nl b">SQSEvent</code>。我们可以进入SDK，尝试使用JSON标签复制SQSEvent结构，但这将是一项繁重的工作。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">。/sqslambda/main.go —接受SQS负载的简单lambda</p></figure><p id="7d40" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，在我们触发这个lambda之前，我们需要一个SQSEvent。我们可以使用<a class="ae mi" href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-cli-command-reference-sam-local-generate-event.html" rel="noopener ugc nofollow" target="_blank"> Generate-Event </a>命令为我们创建一个<code class="fe nt nu nv nl b">event.json</code>文件，我们可以将它作为有效载荷传入。</p><p id="1357" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">语法非常简单，使用<code class="fe nt nu nv nl b">generate-event</code>后跟服务名和<code class="fe nt nu nv nl b">receive-message</code>子命令。目前实际上只有一个子命令，即receive-message。谁知道也许他们已经计划好了<code class="fe nt nu nv nl b">send-message</code>？</p><p id="296e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将在<code class="fe nt nu nv nl b">--body</code>中传递一个参数，用于修改SQS有效载荷的主体，主体是用户特定的有效载荷。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="de58" class="ml mm it nl b gy np nq l nr ns">sam local generate-event sqs receive-message --body 'My Own Event Payload'</span></pre><p id="2516" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">运行它，您将看到一个生成的JSON有效负载，它模拟了一个SQS事件。您可以将这个有效负载写入一个名为<code class="fe nt nu nv nl b">event.json</code>的文件，并像以前一样使用<code class="fe nt nu nv nl b">-e</code>标志将该有效负载传递给调用。</p><p id="7f63" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于<code class="fe nt nu nv nl b">-e</code>标志有一个很好的技巧，但是，如果你传递一个<code class="fe nt nu nv nl b">-</code>作为输入，它将从标准输入中读取值。这意味着我们可以将生成事件命令与调用链接在一起。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="0695" class="ml mm it nl b gy np nq l nr ns">sam local generate-event sqs receive-message --body 'My Own Event Payload' | sam local invoke -e - SQSLambda</span></pre><p id="84f0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">运行该命令应该会打印出整个事件并调用lambda。</p><p id="28ee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">太好了，我们现在可以测试任何lambda，不管是什么服务触发了它。</p><h2 id="d633" class="ml mm it bd mn mo mp dn mq mr ms dp mt lh mu mv mw ll mx my mz lp na nb nc nd bi translated">附加远程调试器</h2><p id="9b14" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">在开发服务时，调试是一个非常重要的方面，附加一个调试器来查看运行时发生了什么是解决问题的最有用的方法之一。</p><p id="8f6a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为此，我们可以在Sam命令中添加<code class="fe nt nu nv nl b">-d</code>标志来打开远程调试器端口，您可以将端口指定为-d的参数。这适用于所有调用，<code class="fe nt nu nv nl b">start-lambda</code>和<code class="fe nt nu nv nl b">start-api</code>也接受调试器标志。</p><blockquote class="nw nx ny"><p id="c7da" class="ky kz nz la b lb lc ju ld le lf jx lg oa li lj lk ob lm ln lo oc lq lr ls lt im bi translated">Sam需要安装Linux Delve调试器，如果您没有运行Linux，您仍然可以使用“GOOS = Linux go arch = amd64 go install github.com/go-delve/delve/cmd/dlv@latest"”来安装它们</p></blockquote><p id="0bdd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">记住调试器应该安装在您的主机上，我们可以使用<code class="fe nt nu nv nl b">--debugger-path=hostURL/to/debugger</code>参数指定调试器的位置。我还需要使用delveAPI版本2来让调试器顺利运行。</p><p id="0f19" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们运行SQS事件来调试lambda。我将添加它所需的调试标志，以便在调试模式下公开lambda。请注意，当您使用<code class="fe nt nu nv nl b">-d</code>调用时，它会在开始时暂停lambda并等待调试器连接。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="c380" class="ml mm it nl b gy np nq l nr ns">sam local invoke SQSLambda -d 8099 --debugger-path=/home/percy/go/bin --debug-args="-delveAPI=2"</span></pre><p id="f43a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们需要附加一个调试器，如何做取决于你是使用VS代码还是Goland等等。我正在使用VS代码，所以我将在我的<code class="fe nt nu nv nl b">.vscode/launch.json</code>中添加一个新的配置。如果你用的是Goland，请看这里如何附加调试器<a class="ae mi" href="https://www.jetbrains.com/help/go/attach-to-running-go-processes-with-debugger.html" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">。vscode/launch.json —这是我们的调试附件</p></figure><p id="a4de" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">基本上我们所做的是创建一个新的附加请求到一个远程调试器，在localhost:8099上。确保您使用的端口与您给<code class="fe nt nu nv nl b">-d</code>命令的端口相同。</p><p id="f4fe" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">保存文件并在第13行的<code class="fe nt nu nv nl b">sqslambda/main.go</code>中放置一个调试器。然后运行调试配置。您应该看到它在您放置的断点处中断。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/0c9ebe2683646dd08b14038d55a94227.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/1*gwx_iFIbbcS1yI3Vpt9vjg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们在调试时附加了一个断点</p></figure><p id="7151" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，让它运行需要一点工作，有一些技巧可以自动运行调试器命令，比如在launch.json中使用预启动效果。但是，如果您使用VS代码，我将很快介绍如何使用AWS插件，这将使调试更加容易。他们不再需要使用任何CLI命令，这非常方便。</p><h2 id="5b65" class="ml mm it bd mn mo mp dn mq mr ms dp mt lh mu mv mw ll mx my mz lp na nb nc nd bi translated">在SAM中使用VS代码</h2><p id="f359" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">如果你正在使用VS代码，我建议你下载AWS工具包，如果你还没有的话。</p><p id="845d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">进入扩展，搜索<code class="fe nt nu nv nl b">AWS toolkit</code>并安装它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/b11eb32d77ba3db8d0e027227036f54a.png" data-original-src="https://miro.medium.com/v2/resize:fit:498/format:webp/1*_ux1bnpnFwFQhRMAiKteDQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用AWS云资源的VS代码扩展</p></figure><p id="0ecd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下载后打开扩展并登录您想要的配置文件，只需按下<code class="fe nt nu nv nl b">Connect to AWS</code>按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/665fde10533a8e2dff1f08417a6ac6af.png" data-original-src="https://miro.medium.com/v2/resize:fit:464/format:webp/1*Z1tz76Azl26eE0U1S3zycQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用插件连接到AWS</p></figure><p id="cb43" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个过程应该很简单，它会要求您进行一些配置，如默认区域、要使用的配置文件等。选择您想要的选项。之后，您应该会看到一堆云服务出现。</p><p id="78be" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本教程中，除了本地部署，我们不会部署任何SAM应用程序，但是您可以这样做(即使没有插件)。</p><p id="08f7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">该插件现在将添加许多SAM内置功能，以取代需要运行命令行。最好的特性是现在每个lambda上面都会有一个文本，询问你是否想要创建一个调试配置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/c87fdd6f8d00668766ce6eb41551a58c.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*jsDU_mFWtLuir7okG8lRBw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">AWS插件可以为我们生成调试处理程序。</p></figure><p id="4438" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">点击<code class="fe nt nu nv nl b">Add Debug Configuration</code>，你的<code class="fe nt nu nv nl b">launch.json</code>应该会更新。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">launch.json — AWS插件为我们生成了一个全新的调试器。</p></figure><p id="a4b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，这看起来和我们之前创建的有很大不同。这是这个插件很酷的一点，它创建了一个独特的调试类型，叫做<code class="fe nt nu nv nl b">aws-sam</code>，允许我们调用lambdas。还有一种API调用的请求类型，可以通过访问API lambda并为其生成一个调试调用来生成。</p><p id="fbb8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如您所见，您可以指定调用目标、环境变量和有效负载。这些都非常方便，所以我们可以跳过使用API，而只使用一个简单的launch.json。</p><p id="3d93" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您应该熟悉所有您可以更改的内容，因为这正是我们在本文中讨论的内容。</p><p id="3130" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">那么，为什么我们不从一开始就使用插件呢？因为那样会有太多的魔法，我们也不明白插件在为我们做什么。我相信，从长远来看，学习工具的基础是最好的，而且你不一定要使用VS代码，而是任何你想要的IDE，因为我们知道如何附加调试器，以及为什么我们需要这样做。</p><h2 id="e674" class="ml mm it bd mn mo mp dn mq mr ms dp mt lh mu mv mw ll mx my mz lp na nb nc nd bi translated">设置本地堆栈和SAM网络</h2><p id="ea89" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">如果您的lambdas使用其他AWS资源，您可以模拟那些使用Localstack的资源。在本教程中，我不会讨论localstack，但是我们将看看如何强制SAM资源与localstack实例在同一个网络上运行。</p><p id="f542" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您使用localstack并通过docker运行它，请确保您还指定了docker网络。如果您在名为<code class="fe nt nu nv nl b">mock-aws-network</code>的docker网络上运行localstack，您可以通过在大多数命令上使用输入标志<code class="fe nt nu nv nl b">docker-network mock-aws-network</code>来让Sam使用相同的网络。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="9182" class="ml mm it nl b gy np nq l nr ns">sam local invoke --docker-network mock-aws-network<br/>sam local start-api --docker-network mock-aws-network</span></pre><p id="e3aa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这很方便，因为lambdas倾向于使用其他需要通信的AWS服务，这样我们也可以调试它。</p><p id="0b55" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你使用的是VS代码插件，你可以把这一行添加到<code class="fe nt nu nv nl b">launch.json</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">launch.json —指定用于Sam的docker网络</p></figure><h2 id="914b" class="ml mm it bd mn mo mp dn mq mr ms dp mt lh mu mv mw ll mx my mz lp na nb nc nd bi translated">结论</h2><p id="c564" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">在本教程中，我们学习了如何使用SAM开发lambdas，以及如何在本地调试它们。我认为SAM在开发lambdas时提供了帮助，消除了我在开始开发无服务器应用程序时遇到的许多挫折。调试之类的事情很难，但现在不再是了。</p><p id="097f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">SAM中还有更多我没有在这里介绍的特性，比如创建其他AWS资源(SQS队列等)以及在lambda中直接引用它们的ARN。</p><p id="d816" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您应该开始试用SAM，并找出它提供的所有令人惊奇的工具。</p><p id="ab20" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢您的阅读，一如既往，我喜欢反馈和讨论。</p></div></div>    
</body>
</html>