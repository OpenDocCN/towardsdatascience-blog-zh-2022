<html>
<head>
<title>A Guide to using h20.ai in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R中使用h20.ai的指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-guide-to-using-h2o-ai-in-r-99cf6265bc05#2022-11-02">https://towardsdatascience.com/a-guide-to-using-h2o-ai-in-r-99cf6265bc05#2022-11-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="599e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">学习如何使用R语言处理h20库</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0f0aae8673ae79d04c9e3e1402addeab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OLY3ywEDsupO4n2I"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://unsplash.com/@pawel_czerwinski" rel="noopener ugc nofollow" target="_blank">pawel _ czerwinsk</a>@ unsplash . com提供</p></figure><p id="bc6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">【免责声明:此帖子包含一些我的Udemy课程的附属链接】</em></p><p id="e33e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lw translated">R有许多机器学习库，可以用来训练模型。从<em class="lv"> caret </em>到独立的库，如<em class="lv"> randomForest </em>、<em class="lv"> rpart </em>或<em class="lv"> glm </em>，当您想要执行一些数据科学任务时，R提供了广泛的选项。</p><p id="edc5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个你可能从未听说过的好奇库是<em class="lv"> h2o </em>。作为一个用于分布式和可扩展机器学习的内存平台，<em class="lv"> h2o </em>可以在您需要增强计算能力时在强大的集群上运行。关于它的另一个有趣的地方是，它不是R独有的库——例如，你也可以通过使用<a class="ae ky" href="https://docs.h2o.ai/h2o/latest-stable/h2o-py/docs/intro.html" rel="noopener ugc nofollow" target="_blank"> Python </a>来使用相同的<em class="lv"> API </em>。</p><p id="8a15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，<em class="lv"> h2o </em>是一个非常有趣和多样化的库。它包含了如此多不同的特性(从训练模型到automl功能),以至于在使用它的时候很容易迷失方向，特别是由于这个包可以使用大量的方法和函数。特性的多样性是我写这篇博客的主要原因——我想帮助你浏览h2o界面！</p><p id="56d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇博文中，我们将介绍一些<em class="lv"> h2o </em>的例子(带代码)，即:</p><ul class=""><li id="ce35" class="mf mg it lb b lc ld lf lg li mh lm mi lq mj lu mk ml mm mn bi translated">训练几个机器学习模型；</li><li id="7b7c" class="mf mg it lb b lc mo lf mp li mq lm mr lq ms lu mk ml mm mn bi translated">做一些超参数调优；</li><li id="2151" class="mf mg it lb b lc mo lf mp li mq lm mr lq ms lu mk ml mm mn bi translated">执行<em class="lv"> automl </em>程序；</li><li id="7c3a" class="mf mg it lb b lc mo lf mp li mq lm mr lq ms lu mk ml mm mn bi translated">浏览一下可解释性模块；</li></ul><p id="538e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">开始吧！</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="6346" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">加载数据</h1><p id="f87c" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">在这篇博文中，我们将使用<a class="ae ky" href="https://www.kaggle.com/hmavrodiev/london-bike-sharing-dataset" rel="noopener ugc nofollow" target="_blank">伦敦自行车共享数据集</a> —该数据集包含伦敦自行车共享计划的自行车需求信息。如果您想了解更多信息，请访问<a class="ae ky" href="https://www.kaggle.com/datasets/hmavrodiev/london-bike-sharing-dataset" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>链接，查看对这些列的描述以及这些数据是如何生成的。</p><p id="128d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在大多数情况下，这是一个监督学习问题，我们希望根据特定时间内关于日期和天气的几个特征来预测每小时新骑自行车的次数。</p><p id="fd9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用R的<code class="fe nx ny nz oa b">read.csv</code>来加载数据集:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="1ebc" class="of nb it oa b gy og oh l oi oj">london_bike &lt;- read.csv(‘./london_merged.csv’)</span></pre><p id="3250" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">加载完数据后，让我们对数据类型做一个小小的检查。如果我们在<code class="fe nx ny nz oa b">london_bike</code>上调用<code class="fe nx ny nz oa b">str</code>命令，我们会看到:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="22ec" class="of nb it oa b gy og oh l oi oj">'data.frame': 17414 obs. of  10 variables:<br/> $ timestamp   : chr  "2015-01-04 00:00:00" "2015-01-04 01:00:00" "2015-01-04 02:00:00" "2015-01-04 03:00:00" ...<br/> $ cnt         : int  182 138 134 72 47 46 51 75 131 301 ...<br/> $ t1          : num  3 3 2.5 2 2 2 1 1 1.5 2 ...<br/> $ t2          : num  2 2.5 2.5 2 0 2 -1 -1 -1 -0.5 ...<br/> $ hum         : num  93 93 96.5 100 93 93 100 100 96.5 100 ...<br/> $ wind_speed  : num  6 5 0 0 6.5 4 7 7 8 9 ...<br/> $ weather_code: num  3 1 1 1 1 1 4 4 4 3 ...<br/> $ is_holiday  : num  0 0 0 0 0 0 0 0 0 0 ...<br/> $ is_weekend  : num  1 1 1 1 1 1 1 1 1 1 ...<br/> $ season      : num  3 3 3 3 3 3 3 3 3 3 ...</span></pre><p id="7c39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的数据帧只包含数字列(除了我们不会使用的时间戳)，因为我们希望算法将<code class="fe nx ny nz oa b">weather_code</code>和<code class="fe nx ny nz oa b">season</code>视为分类变量(至少在第一个实验中)，所以让我们将它们转换为因子:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="8aca" class="of nb it oa b gy og oh l oi oj">london_bike$weather_code &lt;- as.factor(london_bike$weather_code)<br/>london_bike$season &lt;- as.factor(london_bike$season)</span></pre><p id="2b82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将数据集加载到R中后，让我们通过创建一个训练和测试帧将数据一分为二。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="2ea1" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">列车测试分离</h1><p id="ef0c" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated"><em class="lv"> h2o </em>具有执行列车测试分割的便利功能。为了让<code class="fe nx ny nz oa b">h2o</code>运行起来，我们需要加载并初始化我们的库:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="f984" class="of nb it oa b gy og oh l oi oj">library(h2o)<br/>h2o.init()</span></pre><p id="acc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们键入<code class="fe nx ny nz oa b">h2o.init()</code>时，我们正在建立一个本地<em class="lv"> h2o </em>集群。默认情况下，<em class="lv"> h2o </em>将旋转所有可用的CPU，但是您可以使用<code class="fe nx ny nz oa b">nthread</code>指定特定数量的CPU进行初始化。</p><p id="6186" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是R中其他机器学习库的主要区别之一——为了使用<code class="fe nx ny nz oa b">h2o</code>，我们总是需要启动一个<em class="lv"> h2o </em>集群。这样做的好处是，如果您有一个运行在服务器上的<em class="lv"> h2o </em>实例，您可以连接到那台机器并使用那些计算资源，而不需要过多地修改代码(您只需要将您的<code class="fe nx ny nz oa b">init</code>指向另一台机器)。</p><p id="4e56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe nx ny nz oa b">h2o.splitFrame</code>，我们可以方便地创建我们数据的随机训练测试分割，但在此之前，我们需要将我们的数据帧转换成一个特殊的对象，以便<em class="lv"> h2o </em>能够识别:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="83ee" class="of nb it oa b gy og oh l oi oj">london_bike.h2o &lt;- as.h2o(london_bike)</span></pre><p id="c50c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一次学习:<em class="lv"> h2o </em>不能处理普通的R数据帧，只能处理特殊类型的对象<code class="fe nx ny nz oa b">h2OFrame</code>，所以使用<code class="fe nx ny nz oa b">as.h2o</code>转换数据帧的步骤是强制性的。</p><p id="6cbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在已经准备好使用新的<code class="fe nx ny nz oa b">london_bike.h2o</code>对象进行训练测试分割:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="f6f5" class="of nb it oa b gy og oh l oi oj">london_bike_split <strong class="oa iu">&lt;-</strong> h2o.splitFrame(data <strong class="oa iu">=</strong> <!-- -->london_bike.h2o<!-- -->, ratios <strong class="oa iu">=</strong> 0.8, seed <strong class="oa iu">=</strong> 1234)</span><span id="c5bc" class="of nb it oa b gy ok oh l oi oj">training_data &lt;- london_bike_split[[1]]<br/>test_data &lt;- london_bike_split[[2]]</span></pre><p id="e6fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe nx ny nz oa b">h2o.splitFrame</code>，我们可以立即将数据集分成两个不同的<code class="fe nx ny nz oa b">h2o</code>帧— <code class="fe nx ny nz oa b">ratios</code>定义我们希望分配给训练数据的百分比，在上面的函数中，我们将数据集的80%用于训练目的，剩下20%作为维持集。</p><p id="416e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着我们的数据在测试和训练之间以<em class="lv"> h2o </em>格式分割，我们已经准备好训练我们的第一个<em class="lv"> h2o </em>模型了！</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="61e4" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">训练模型</h1><p id="5afb" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">由于其简单性，我们要训练的第一个模型将是线性回归。这个模型可以用<code class="fe nx ny nz oa b">h2o.glm</code>函数训练，首先，我们需要定义目标和特征变量:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="2d20" class="of nb it oa b gy og oh l oi oj">predictors &lt;- c("t1", "t2", "hum", "wind_speed", "weather_code",      <br/>                "is_holiday","is_weekend", "season")</span><span id="f3ca" class="of nb it oa b gy ok oh l oi oj">response &lt;- "cnt"</span></pre><p id="86d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为列<code class="fe nx ny nz oa b">cnt</code>包含每小时使用的自行车数量，所以这是我们的响应/目标列。</p><p id="90f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要训练模型，我们可以执行以下操作:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="c3e4" class="of nb it oa b gy og oh l oi oj">london_bike_model &lt;- h2o.glm(x = predictors,<br/>                      y = response,<br/>                      training_frame = training_data)</span></pre><p id="44d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和..就是这样！只有三个参数，我们可以训练我们的模型:</p><ul class=""><li id="4eb2" class="mf mg it lb b lc ld lf lg li mh lm mi lq mj lu mk ml mm mn bi translated"><code class="fe nx ny nz oa b">x</code>定义我们将用作特性的列的名称。</li><li id="68b0" class="mf mg it lb b lc mo lf mp li mq lm mr lq ms lu mk ml mm mn bi translated"><code class="fe nx ny nz oa b">y</code>定义目标列</li><li id="595f" class="mf mg it lb b lc mo lf mp li mq lm mr lq ms lu mk ml mm mn bi translated">在<code class="fe nx ny nz oa b">training_frame</code>参数中，我们传递训练数据集。</li></ul><p id="af97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经准备好模型了！让我们将我们的预测与测试集上的真实值进行比较——我们可以方便地使用<code class="fe nx ny nz oa b">h2o.predict</code>函数从我们的模型中获得预测:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="aba3" class="of nb it oa b gy og oh l oi oj">test_predict &lt;- h2o.predict(object = london_bike_model, <br/>                            newdata = test_data)</span></pre><ul class=""><li id="14fb" class="mf mg it lb b lc ld lf lg li mh lm mi lq mj lu mk ml mm mn bi translated"><code class="fe nx ny nz oa b">object</code>接收我们想要应用于数据的模型。</li><li id="929e" class="mf mg it lb b lc mo lf mp li mq lm mr lq ms lu mk ml mm mn bi translated"><code class="fe nx ny nz oa b">newdata</code>接收我们将应用模型的数据。</li></ul><p id="f848" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以用测试集中的<code class="fe nx ny nz oa b">cnt</code>来<code class="fe nx ny nz oa b">cbind</code>我们的预测:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="7ba7" class="of nb it oa b gy og oh l oi oj">predictions_x_real &lt;- cbind(<br/>  as.data.frame(test_data$cnt),<br/>  as.data.frame(test_predict)<br/>)</span></pre><p id="f2ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以快速地将我们的预测与目标进行比较:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/1760c4dca0ceed2af0011854f1898464.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*F3TWIa-Pn1mBFJmJCFZAgw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">线性回归模型实际值与预测值-作者图片</p></figure><p id="1484" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">显然，我们的模型有点超出了我们的目标——让我们使用<code class="fe nx ny nz oa b">alpha </code>参数在<code class="fe nx ny nz oa b">h2o.train</code>中应用一些正则化:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="34f3" class="of nb it oa b gy og oh l oi oj">london_bike_model_regularized &lt;- h2o.glm(x = predictors,<br/>                             y = response,<br/>                             training_frame = training_data,<br/>                             alpha = 1)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/94a6e93ae3c4dba962f3d7108c486a0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*Ms4yM52Hkh631PyAtD1-cQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">正则化模型-预测与实际-作者提供的图像</p></figure><p id="0326" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nx ny nz oa b">h2o.glm</code>中，<code class="fe nx ny nz oa b">alpha=1</code>代表套索回归。我们的模型似乎没有改善太多，我们可能需要做更多的功能工程或尝试线性回归的其他论点(尽管这不太可能使我们的模型改善太多)。</p><p id="6024" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<a class="ae ky" href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/glm.html" rel="noopener ugc nofollow" target="_blank">库的文档</a>中，你会发现这个广义线性模型函数中有大量的参数需要调整。<strong class="lb iu">从第一次训练过程中得到的一个重要收获是<em class="lv"> h2o的</em>训练实现包含许多我们可以实验和测试的可调整参数。</strong></p><p id="0d39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当评估我们的模型时，我们只是通过绘制我们对真实目标的预测来进行视觉“测试”。当然，如果我们想做更科学的评估，我们在<em class="lv"> h2o </em>框架中有所有著名的回归和分类指标可用！</p><p id="c26f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看，下一个。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="2d9e" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">评估我们的模型</h1><p id="a0e2" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">我们可以用h20做的一件很酷的事情是将测试集直接传递到我们的模型中，并使用它来提取验证指标。例如，如果我们想要从一个测试集中检索度量，我们可以直接将它插入到任何<code class="fe nx ny nz oa b">h2o</code>训练模型的<code class="fe nx ny nz oa b">validation_frame</code>参数中:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="21e5" class="of nb it oa b gy og oh l oi oj">london_bike_model &lt;- h2o.glm(x = predictors,<br/>                             y = response,<br/>                             training_frame = training_data,<br/>                             validation_frame = test_data)</span></pre><p id="3e6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过这个新的<code class="fe nx ny nz oa b">validation_frame</code>参数将使我们能够非常快速地提取两个数据帧的指标——例如，让我们为我们的模型获得训练和测试的均方误差(这里称为<code class="fe nx ny nz oa b">valid</code>):</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="810a" class="of nb it oa b gy og oh l oi oj">h2o.rmse(london_bike_model, train=TRUE, valid=TRUE)</span><span id="0f7d" class="of nb it oa b gy ok oh l oi oj">train    valid <br/>936.5602 927.4826</span></pre><p id="8808" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们的目标变量的平均值是每小时1143辆自行车，我们的模型表现得并不好。我们还看到，过度拟合的证据似乎很少，因为训练集和测试集似乎都很相似。</p><p id="1767" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们怎样才能改变我们想看的指标呢？我们只是调整了<code class="fe nx ny nz oa b">h2o</code>功能！例如，如果我们想查看r平方，我们只需使用<code class="fe nx ny nz oa b">h2o.r2</code>:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="ea8d" class="of nb it oa b gy og oh l oi oj">h2o.r2(london_bike_model, train=TRUE, valid=TRUE)</span><span id="9da1" class="of nb it oa b gy ok oh l oi oj">train     valid <br/>0.2606183 0.2456557</span></pre><p id="4dc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">超级简单！好处是你不必担心如何自己实现这些指标的所有细节。</p><p id="5cc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个例子中，我正在跟踪一个回归问题，但是，当然，您也有可用的分类模型和度量。对于<code class="fe nx ny nz oa b">h2o</code>中可用的所有指标，检查以下<a class="ae ky" href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/performance-and-prediction.html#mse-mean-squared-error" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><p id="6c3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的线性回归表现不佳，这有点出乎意料——我们没有执行任何功能工程，我们可能违反了太多的线性回归假设。但是，如果我们可以训练简单的线性回归，我们可能可以在<code class="fe nx ny nz oa b">h2o</code>中训练其他类型的模型，对吗？没错！让我们在下一节看到这一点。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="321a" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">更多模型示例</h1><p id="7080" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">正如你可能已经猜到的，如果我们改变与训练过程相关的<code class="fe nx ny nz oa b">h2o</code>功能，我们将适合其他类型的模型。让我们通过调用<code class="fe nx ny nz oa b">h2o.randomForest</code>来训练一个随机森林:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="ff38" class="of nb it oa b gy og oh l oi oj">london_bike_rf &lt;- h2o.randomForest(x = predictors,<br/>                             y = response,<br/>                             ntrees = 25,<br/>                             max_depth = 5,<br/>                             training_frame = training_data,<br/>                             validation_frame = test_data)</span></pre><p id="cb4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在函数调用中为我的随机森林设置了两个超参数:</p><ul class=""><li id="f806" class="mf mg it lb b lc ld lf lg li mh lm mi lq mj lu mk ml mm mn bi translated"><code class="fe nx ny nz oa b">ntrees</code>设定森林中的树木数量。</li><li id="23be" class="mf mg it lb b lc mo lf mp li mq lm mr lq ms lu mk ml mm mn bi translated"><code class="fe nx ny nz oa b">maxdepth</code>设置每棵树的最大深度。</li></ul><p id="cdad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果需要，您可以通过调用R控制台上的<code class="fe nx ny nz oa b">help(h2o.randomForest)</code>找到所有可调整的参数。</p><p id="271b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很酷的一点是，我们现在可以在这个新模型上使用我们所了解的模型度量，只需将我们提供的模型切换到度量函数中即可——例如，为了获得这个模型的<code class="fe nx ny nz oa b">rmse</code>,我们将第一个参数切换到<code class="fe nx ny nz oa b">london_bike_rf</code>:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="1ac6" class="of nb it oa b gy og oh l oi oj">h2o.rmse(london_bike_rf, train=TRUE, valid=TRUE)</span><span id="471e" class="of nb it oa b gy ok oh l oi oj">train    valid <br/>909.1772 900.5366</span></pre><p id="0e1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并且获得了<code class="fe nx ny nz oa b">r2</code>:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="ed6e" class="of nb it oa b gy og oh l oi oj">h2o.r2(london_bike_rf, train=TRUE, valid=TRUE)<br/>train     valid <br/>0.3032222 0.2888506</span></pre><p id="f6bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，我们的代码实际上没有改变。唯一被修改的是我们输入第一个论点的模型。这使得这些度量函数高度适应新模型，只要它们在<em class="lv"> h2o </em>框架内被训练。</p><p id="583d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你跟随这个<a class="ae ky" href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science.html#supervised" rel="noopener ugc nofollow" target="_blank">链接</a>，你会发现你可以用库训练的其他模型。从这个列表中，让我们安装一个神经网络，使用<code class="fe nx ny nz oa b">h2o.deeplearning</code>:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="142f" class="of nb it oa b gy og oh l oi oj">nn_model &lt;- h2o.deeplearning(x = predictors,<br/>                       y = response,<br/>                       hidden = c(6,6,4,7),<br/>                       epochs = 1000,<br/>                       train_samples_per_iteration = -1,<br/>                       reproducible = TRUE,<br/>                       activation = "Rectifier",<br/>                       seed = 23123,<br/>                       training_frame = training_data,<br/>                       validation_frame = test_data)</span></pre><p id="1db0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nx ny nz oa b">hidden</code>是<code class="fe nx ny nz oa b">h2o.deeplearning</code>函数中非常重要的一个参数。它需要一个向量来表示我们将在神经网络中使用的隐藏层和神经元的数量。在我们的例子中，我们使用的是<code class="fe nx ny nz oa b">c(6,6,4,7)</code>，4个隐藏层，每个层有6、6、4和7个节点。</p><p id="ee01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的<code class="fe nx ny nz oa b">h2o.r2</code>函数会和神经网络一样工作吗？让我们测试一下:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="73d5" class="of nb it oa b gy og oh l oi oj">h2o.r2(nn_model, train=TRUE, valid=TRUE)<br/>    train     valid <br/>0.3453560 0.3206021</span></pre><p id="49a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有用！</p><p id="527d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">底线是:我们在<em class="lv"> h2o </em>框架中使用的大多数函数对于其他模型是可调整的。这是一个非常好的特性，因为它使得用更少的代码在模型之间切换变得容易，避免了过于复杂或者容易出错的开发。</p><p id="ff44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">h2o 的另一个很酷的特性是，我们可以非常平滑地进行超参数调谐——接下来让我们看看如何进行。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="dec9" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">超参数调谐</h1><p id="7b27" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">在<code class="fe nx ny nz oa b">h2o</code>中，执行超参数搜索也非常简单——您只需要知道:</p><ul class=""><li id="c1da" class="mf mg it lb b lc ld lf lg li mh lm mi lq mj lu mk ml mm mn bi translated">您要在其中执行搜索的模型。</li><li id="a40f" class="mf mg it lb b lc mo lf mp li mq lm mr lq ms lu mk ml mm mn bi translated">每个模型可用的参数名称。</li><li id="c341" class="mf mg it lb b lc mo lf mp li mq lm mr lq ms lu mk ml mm mn bi translated">要测试哪些参数的值。</li></ul><p id="cad8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记住，在我们上面训练的随机森林中，我们已经手动设置了<code class="fe nx ny nz oa b">ntrees</code>和<code class="fe nx ny nz oa b">maxdepth</code>。</p><p id="6821" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在网格示例中，我们将对两个参数加上<code class="fe nx ny nz oa b">min_rows</code>进行搜索。我们可以通过使用<code class="fe nx ny nz oa b">h2o.grid</code>功能来实现:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="e2e7" class="of nb it oa b gy og oh l oi oj"># Grid Search <br/>rf_params &lt;- list(ntrees = c(2, 5, 10, 15),<br/>                    max_depth = c(3, 5, 9),<br/>                    min_rows = c(5, 10, 100))</span><span id="bb53" class="of nb it oa b gy ok oh l oi oj"># Train and validate a grid of randomForests<br/>rf_grid &lt;- h2o.grid("randomForest", <br/>                      x = predictors, <br/>                      y = response,<br/>                      grid_id = "rf_grid",<br/>                      training_frame = training_data,<br/>                      validation_frame = test_data,<br/>                      seed = 1,<br/>                      hyper_params = rf_params)</span></pre><p id="bc46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先声明包含我们将在网格搜索中使用的值列表的<code class="fe nx ny nz oa b">rf_params</code>，然后，我们将该网格传递给<code class="fe nx ny nz oa b">h2o.grid</code>中的<code class="fe nx ny nz oa b">hyper_params</code>参数。<code class="fe nx ny nz oa b">h2o</code>要做的是训练和评估每一个可用的超参数组合。</p><p id="5ace" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看我们的搜索结果非常简单:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="3852" class="of nb it oa b gy og oh l oi oj">h2o.getGrid(grid_id = "rf_grid",<br/>            sort_by = "r2",<br/>            decreasing = TRUE)</span></pre><p id="f002" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nx ny nz oa b">h2o.getGrid</code>函数根据一个特定的度量为我们提供了最佳超参数的汇总。在这种情况下，我们选择了<code class="fe nx ny nz oa b">r2</code>，但是其他指标，比如<code class="fe nx ny nz oa b">RMSE</code>或者<code class="fe nx ny nz oa b">MSE</code>也可以。让我们看看网格搜索的前5个结果:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="8c6e" class="of nb it oa b gy og oh l oi oj">Hyper-Parameter Search Summary: ordered by decreasing r2<br/>  max_depth min_rows   ntrees        model_ids      r2<br/>1   9.00000  5.00000 15.00000 rf_grid_model_30 0.33030<br/>2   9.00000  5.00000 10.00000 rf_grid_model_21 0.32924<br/>3   9.00000  5.00000  5.00000 rf_grid_model_12 0.32573<br/>4   9.00000 10.00000 15.00000 rf_grid_model_33 0.32244<br/>5   9.00000 10.00000 10.00000 rf_grid_model_24 0.31996</span></pre><p id="7783" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们最好的模型是<code class="fe nx ny nz oa b">max_depth</code>为9、<code class="fe nx ny nz oa b">min_rows</code>为5和<code class="fe nx ny nz oa b">ntrees</code>为15的那个——这个模型的r2达到了<em class="lv"> 0.3303 </em>。</p><p id="2eb5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">酷的部分？您可以将该网格扩展到<code class="fe nx ny nz oa b">?h2o.randomForest</code>中可用的任何超参数，或者扩展到<code class="fe nx ny nz oa b">h2o</code>的<a class="ae ky" href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science.html#supervised" rel="noopener ugc nofollow" target="_blank">文档</a>中可用的任何模型，从而为相同的功能带来无限的可能性。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="3e07" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">AutoML功能</h1><p id="0bff" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">如果您需要一种快速和原始的方式来查看不同模型在您的数据集上的执行方式，<code class="fe nx ny nz oa b">h2o</code>还有一个有趣的<code class="fe nx ny nz oa b">automl</code>例程:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="f0e9" class="of nb it oa b gy og oh l oi oj">aml &lt;- h2o.automl(x = predictors, <br/>                  y = response,<br/>                  training_frame = training_data,<br/>                  validation_frame = test_data,<br/>                  max_models = 15,<br/>                  seed = 1)</span></pre><p id="5969" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nx ny nz oa b">max_models</code>参数指定在特定<code class="fe nx ny nz oa b">automl</code>集合上测试的模型的最大数量。请记住，<code class="fe nx ny nz oa b">automl</code>例程可能需要一段时间运行，这取决于您的资源。</p><p id="746f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过检查<code class="fe nx ny nz oa b">aml@leaderboard</code>来访问我们例程的顶级模型:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="ae72" class="of nb it oa b gy og oh l oi oj">aml@leaderboard</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/8c82e5e92d8e0e3edede4c9a92d40917.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HRucZvufDOfyRMaqQntVrw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Automl顶级车型—图片由作者提供</p></figure><p id="3148" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过上表，我们可以看到一款<em class="lv">堆叠套装</em>型号胜出(至少就<code class="fe nx ny nz oa b">rmse</code>而言)。我们还可以通过拨打以下电话了解最佳型号的更多信息:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="c33c" class="of nb it oa b gy og oh l oi oj"><strong class="oa iu">h2o.get_best_model</strong>(aml)</span><span id="aa99" class="of nb it oa b gy ok oh l oi oj">Model Details:<br/>==============</span><span id="f964" class="of nb it oa b gy ok oh l oi oj">H2ORegressionModel: stackedensemble<br/>Model ID:  StackedEnsemble_AllModels_1_AutoML_1_20221027_95503 <br/>Number of Base Models: 15</span><span id="4bd3" class="of nb it oa b gy ok oh l oi oj">Base Models (count by algorithm type):</span><span id="0308" class="of nb it oa b gy ok oh l oi oj">deeplearning          drf          gbm          glm <br/>           4            2            8            1</span></pre><p id="336b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nx ny nz oa b">h2o.get_best_model(aml)</code>的结果返回关于在我们的<code class="fe nx ny nz oa b">automl</code>例程中获得最佳分数的模型的更多信息。通过上面的片段，我们知道我们的集合集合了以下结果:</p><ul class=""><li id="2c95" class="mf mg it lb b lc ld lf lg li mh lm mi lq mj lu mk ml mm mn bi translated">4深度学习模型；</li><li id="e46e" class="mf mg it lb b lc mo lf mp li mq lm mr lq ms lu mk ml mm mn bi translated">2 .森林植被；</li><li id="7370" class="mf mg it lb b lc mo lf mp li mq lm mr lq ms lu mk ml mm mn bi translated">8个梯度助推模型；</li><li id="f71d" class="mf mg it lb b lc mo lf mp li mq lm mr lq ms lu mk ml mm mn bi translated">1广义线性模型；</li></ul><p id="1d33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据您的用例，<code class="fe nx ny nz oa b">automl</code>例程可能是一种快速、肮脏的方式，用来理解集合和单个模型如何对您的数据起作用，给你下一步该去哪里的提示。例如，帮助您决定是否需要更复杂的模型，或者您是否可能需要获取更多的训练数据/特征。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="fdbf" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">可解释性</h1><p id="c70e" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">最后，让我们来看看一些<em class="lv"> h2o </em>的可解释模块。在本例中，我们将使用上面训练的随机森林模型:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="cfe9" class="of nb it oa b gy og oh l oi oj">london_bike_rf &lt;- h2o.randomForest(x = predictors,<br/>                             y = response,<br/>                             ntrees = 25,<br/>                             max_depth = 5,<br/>                             training_frame = training_data,<br/>                             validation_frame = test_data)</span></pre><p id="502c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就像大多数机器学习库一样，我们可以用<code class="fe nx ny nz oa b">h2o</code>接口直接抓取变量重要性图:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="19f3" class="of nb it oa b gy og oh l oi oj">h2o.varimp_plot(london_bike_rf)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/23f90f67cbde3e2e7e2b05650f7733be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*p9nsxSufTLmQAa-bKCftAw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">随机森林变量重要性-作者图片</p></figure><p id="18e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过重要性图，我们注意到<em class="lv">湿度(</em> <code class="fe nx ny nz oa b">hum</code>)和<em class="lv">温度(</em> <code class="fe nx ny nz oa b"><em class="lv">t1, t2</em></code>)是我们训练的随机森林最重要的变量。调用<code class="fe nx ny nz oa b">varimp_plot</code>会立即显示特定模型的重要性图，而不需要配置其他任何东西。</p><p id="509d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nx ny nz oa b">h2o</code>中，单个变量的重要性并不是唯一可用的解释模型——我们还可以快速检查<code class="fe nx ny nz oa b">shap</code>的值:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="b7da" class="of nb it oa b gy og oh l oi oj">h2o.shap_summary_plot(london_bike_rf, test_data)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/17b3fae6c133575e68829b645143b800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*t8WA_DiM1m6Hb-s2mA4Emg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">形状摘要图—作者提供的图像</p></figure><p id="1ee4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧啊。通过<code class="fe nx ny nz oa b">shap_summary_plot</code>，我们了解了我们的特征和目标之间的关系方向。例如:</p><ul class=""><li id="fac0" class="mf mg it lb b lc ld lf lg li mh lm mi lq mj lu mk ml mm mn bi translated">更高的温度解释了更多的自行车使用。</li><li id="69af" class="mf mg it lb b lc mo lf mp li mq lm mr lq ms lu mk ml mm mn bi translated">较低的湿度也解释了更多的自行车使用。</li></ul><p id="8d8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的例子中，我们已经为我们的<code class="fe nx ny nz oa b">test_data</code>询问了<code class="fe nx ny nz oa b">shap</code>的一般解释，但是我们也可以使用<code class="fe nx ny nz oa b">h2o</code>来检查单个行的可解释性——例如，让我们看看测试集的第4行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/0f21a854e66de4ba1afa8edeecb8bd8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yzUbtz8IG8V8Ogmgbuy82Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">测试集的第4行—作者提供的图片</p></figure><p id="7ff8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基本上，这是一月份非常寒冷的一天，这个因素可能影响了伦敦的自行车使用，从而影响了我们模型的预测——让我们将这一行传递给shap解释器:</p><pre class="kj kk kl km gt ob oa oc od aw oe bi"><span id="ff01" class="of nb it oa b gy og oh l oi oj">h2o.shap_explain_row_plot(london_bike_rf, test_data, row_index = 4)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/a1bd52cc11cf9adf9a447df3719879fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*Z28Ha4C_N8NpbBrznPm0fA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Shap解说2015年1月4日下午5点—图片由作者提供</p></figure><p id="83ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有意思！几个特征使得对自行车使用量的预测下降。例如:</p><ul class=""><li id="d3d9" class="mf mg it lb b lc ld lf lg li mh lm mi lq mj lu mk ml mm mn bi translated">高湿度值(93)对预测有负面影响。</li><li id="4903" class="mf mg it lb b lc mo lf mp li mq lm mr lq ms lu mk ml mm mn bi translated">事实上，这一天是一个周末意味着更少的通勤，有助于我们的预测。</li></ul><p id="7a92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看一个夏天，一周一天的行程:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/3956242e7ddee720ed7d964bb3a0d184.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*6Y-2Wot2t-MvfK7lQq8VEw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Shap解释者2015年6月30日下午1点—图片由作者提供</p></figure><p id="61de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，我们有相反的。温度和湿度变量对自行车使用率的高值有积极作用(预测值约为2617)。</p><p id="9537" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，通过分析行，您可能会注意到小时将是一个非常重要的特性——您能添加这个特性并在<code class="fe nx ny nz oa b">h2o</code>框架中训练更多的模型吗？自己试试，在你的曲目中加入一些<code class="fe nx ny nz oa b">h2o</code>的练习！</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><p id="a0c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢你花时间阅读这篇文章！我希望这个指南能帮助你开始使用<code class="fe nx ny nz oa b">h2o</code>，并且你现在可以测试这个库是否适合你的数据科学管道。虽然其他库，如<em class="lv"> caret、</em>更有名，但<em class="lv"> h2o </em>不应该作为执行机器学习任务的竞争者而被丢弃。<code class="fe nx ny nz oa b">h2o</code>的主要优点是:</p><ul class=""><li id="5cd3" class="mf mg it lb b lc ld lf lg li mh lm mi lq mj lu mk ml mm mn bi translated">有趣的<code class="fe nx ny nz oa b">automl</code>和可解释的特点。</li><li id="a5e1" class="mf mg it lb b lc mo lf mp li mq lm mr lq ms lu mk ml mm mn bi translated">通过本地环境在远程服务器上运行<code class="fe nx ny nz oa b">h2o</code>任务的能力。</li><li id="bfe3" class="mf mg it lb b lc mo lf mp li mq lm mr lq ms lu mk ml mm mn bi translated">大量不同的模型可以使用和应用。</li><li id="85f4" class="mf mg it lb b lc mo lf mp li mq lm mr lq ms lu mk ml mm mn bi translated">简单的即插即用功能，可执行超参数搜索或模型评估。</li></ul><p id="c532" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随意查看我在R库上写的其他指南，比如<a class="ae ky" rel="noopener" target="_blank" href="/a-guide-to-using-caret-in-r-71dec0bda208"> <em class="lv">脱字符号</em> </a> <em class="lv">，</em> <a class="ae ky" rel="noopener" target="_blank" href="/introduction-to-ggplot2-in-r-73242b99889"> <em class="lv"> ggplot2 </em> </a>或者<a class="ae ky" rel="noopener" target="_blank" href="/8-cool-dplyr-function-to-learn-in-r-8736d7fa899c"> <em class="lv"> dplyr </em> </a> <em class="lv">。</em></p><p id="2388" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">如果你想参加我的R课程，请随时加入这里(</em> <a class="ae ky" href="https://www.udemy.com/course/r-for-absolute-beginners/?couponCode=MEDIUMREADERSSEP" rel="noopener ugc nofollow" target="_blank"> <em class="lv">绝对初学者R编程</em> </a> <em class="lv">)或这里(</em> <a class="ae ky" href="https://www.udemy.com/course/r-for-data-science-first-step-data-scientist/?couponCode=MEDIUMOCTOBER" rel="noopener ugc nofollow" target="_blank"> <em class="lv">数据科学训练营</em> </a> <em class="lv">)。我的R课程适合初学者/中级开发人员，我希望有你在身边！</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/09eaaadab0110fb024bff389c20c5ca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:546/format:webp/0*6lu8iA77kHI4Qmiw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.udemy.com/course/r-for-data-science-first-step-data-scientist/?couponCode=MEDIUMOCTOBER" rel="noopener ugc nofollow" target="_blank">数据科学训练营课程</a> —图片由作者提供</p></figure><div class="op oq gp gr or os"><a href="https://medium.com/membership/@ivopbernardo" rel="noopener follow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">通过我的推荐链接加入Medium-Ivo Bernardo</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">阅读我在Medium上的所有故事，了解更多关于数据科学和分析的信息。加入中级会员，您将…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">medium.com</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg ks os"/></div></div></a></div><p id="abd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是这篇文章中使用的代码的要点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="c9e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">本文中使用的数据集受开放政府许可条款和条件约束，可从</em><a class="ae ky" href="https://www.kaggle.com/hmavrodiev/london-bike-sharing-dataset" rel="noopener ugc nofollow" target="_blank"><em class="lv">https://www . ka ggle . com/hmavrodiev/London-bike-sharing-dataset</em></a>获得</p></div></div>    
</body>
</html>