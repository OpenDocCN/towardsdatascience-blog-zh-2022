<html>
<head>
<title>The Battle of Interactive Geographic Visualization Part 5 — Folium</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">交互式地理可视化之战第五讲——叶子</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-battle-of-interactive-geographic-visualization-part-5-folium-cc2213d29a7#2022-03-18">https://towardsdatascience.com/the-battle-of-interactive-geographic-visualization-part-5-folium-cc2213d29a7#2022-03-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="42aa" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">PYTHON。数据科学。地理可视化。</h2><div class=""/><div class=""><h2 id="6702" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用 follow 包创建漂亮的交互式 Geoplots</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/39a98dcbd9e5781131ad61416b550e69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7_8aZINFRDtO4wxy"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://unsplash.com/@claybanks?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">粘土银行</a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><h2 id="7353" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">我们离开的地方</h2><p id="0c82" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">在这个系列中，我们已经确定了制作美丽的地理散射图的四(4)种方法:</p><ul class=""><li id="8bfa" class="mw mx it mf b mg my mj mz lr na lv nb lz nc mv nd ne nf ng bi translated"><strong class="mf jd">全息视图</strong> — <a class="ae lh" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-1-interactive-geoplot-using-one-line-of-8214e9ed1bb4">交互式地理可视化之战第一部分——使用一行代码的交互式地理地图</a></li><li id="bc24" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv nd ne nf ng bi translated"><strong class="mf jd"> Plotly Express — </strong> <a class="ae lh" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-2-interactive-geoplot-using-one-line-of-2118af59a77c">交互式地理可视化之战第二部分——使用一行代码的交互式 geo plot</a></li><li id="d43a" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv nd ne nf ng bi translated"><strong class="mf jd"> Plotly Go </strong> — <a class="ae lh" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-3-plotly-graph-objects-go-c3d3f2a00132">交互式地理可视化之战第三部分——Plotly 图形对象(Go) </a></li><li id="6400" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv nd ne nf ng bi translated"><strong class="mf jd">牛郎星</strong>——<a class="ae lh" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-4-altair-5b67e3e5e29e">交互式地理可视化之战第四集——牛郎星</a></li></ul><p id="2d92" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">在本文中，我们将学习如何使用我最喜欢的地理可视化软件包，follow，创建一个类似的但更加定制的绘图。</p><p id="de1d" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">我还将向您展示如何使用为我们的 geoviz 提供即时升级的“标记集群”功能。</p><h2 id="38d0" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">叶子与情节</h2><p id="fd56" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">Folium 可能是 Python 用户使用最广泛的地理可视化工具之一，这些用户打算为个人甚至商业用途创建更多定制地图。</p><p id="be63" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">它是建立在 needs 之上的，比我们到目前为止介绍过的任何一个包都能覆盖更多的制图需求。</p><p id="1d6a" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">另一方面，Plotly 的优势是在语法和扩展使用上更容易，特别是它的高级绘图库 Plotly Express。你也可以用这个包做很多事情，但是没有用 leav 做的多。</p><h1 id="ce61" class="np lj it bd lk nq nr ns ln nt nu nv lq ki nw kj lu kl nx km ly ko ny kp mc nz bi translated">编码</h1><p id="0f66" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">确保首先安装叶子:</p><pre class="ks kt ku kv gt oa ob oc od aw oe bi"><span id="7a95" class="li lj it ob b gy of og l oh oi">pip install folium</span></pre><h1 id="f71d" class="np lj it bd lk nq nr ns ln nt nu nv lq ki nw kj lu kl nx km ly ko ny kp mc nz bi translated">预赛</h1><p id="4759" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">和其他人一样，让我们装载我们的包:</p><pre class="ks kt ku kv gt oa ob oc od aw oe bi"><span id="c232" class="li lj it ob b gy of og l oh oi">import numpy as np<br/>import pandas as pd</span><span id="0a40" class="li lj it ob b gy oj og l oh oi">import folium<br/>from folium.plugins import MarkerCluster<br/>import geopandas as gpd</span><span id="c6e0" class="li lj it ob b gy oj og l oh oi">from shapely import geometry<br/>from shapely.geometry import Point<br/>from shapely.geometry.polygon import Polygon</span></pre><h2 id="9600" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">加载数据集</h2><pre class="ks kt ku kv gt oa ob oc od aw oe bi"><span id="a76d" class="li lj it ob b gy of og l oh oi">df = pd.read_csv('data/Coffee Brands Footprint.csv',<br/>                index_col=0)<br/>df.head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ok"><img src="../Images/ef1824a2692764bf0ca4f9f4655a750f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6DUxL6bIgLUhI-pW.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片:我们数据集的前五次观察。</p></figure><p id="698f" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">加载数据集后，我们可以开始创建我们的叶子地图！</p><h1 id="fec3" class="np lj it bd lk nq nr ns ln nt nu nv lq ki nw kj lu kl nx km ly ko ny kp mc nz bi translated">叶子代码</h1><h2 id="6e36" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">启动地图</h2><p id="0622" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">以下代码启动了叶子图:</p><pre class="ks kt ku kv gt oa ob oc od aw oe bi"><span id="384f" class="li lj it ob b gy of og l oh oi">m = folium.Map(location=[14.577924, 121.073972],<br/>            tiles="cartodbpositron") #Latitude first before Longitude</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ol"><img src="../Images/c2d3013fd27fb2591990dcea5c14f273.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wh6UCYho5Yad_yi_UVzVAQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片作者:初始化的树叶地图</p></figure><p id="6ee8" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated"><code class="fe om on oo ob b">Folium.Map</code>有可以控制初始缩放的参数和控制地图的图块。我们选择了图块<code class="fe om on oo ob b">cartodbpositron</code>,因为它离我们其他包的底图更近。</p><h2 id="4b82" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">启动标记集群</h2><p id="494f" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">叶子的<code class="fe om on oo ob b">MarkerCluster</code>插件是我们 geoviz 的一个很好的补充，因为它可以为我们提供一些即时的见解。这是一种聚类形式，因此您可以立即评估哪些区域中有您的研究对象。</p><p id="edb1" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">另一个明显的好处是，它有助于保持你的地图看起来干净，因为它不会有太多的标记杂乱。</p><p id="a4cb" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">要启动 MarkerCluster 对象:</p><pre class="ks kt ku kv gt oa ob oc od aw oe bi"><span id="4c82" class="li lj it ob b gy of og l oh oi">marker_cluster = MarkerCluster(control=False).add_to(m)</span></pre><p id="2ee6" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">我们将它存储在一个名为<code class="fe om on oo ob b">marker_cluster</code>的变量中，因为我们稍后将调用它，或者更确切地说，添加到它。</p><p id="af0b" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">不要忘记将这个<code class="fe om on oo ob b">MarkerCluster</code>对象添加到我们名为<code class="fe om on oo ob b">m</code>的地图对象中。</p><h2 id="aac4" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">启动标记</h2><p id="7bae" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">要为此启动标记，我们需要做一个初步的步骤来存储在一个元组中或列出我们的地理编码。</p><pre class="ks kt ku kv gt oa ob oc od aw oe bi"><span id="a250" class="li lj it ob b gy of og l oh oi">#We need this cause apparently, folium can recognize not a geoseries but a normal tuple/list<br/>df.reset_index(drop=True, inplace=True)<br/>df['geocode'] = [[df['lat'][i],df['lng'][i]] for i in range(len(df)) ]</span></pre><p id="f3c5" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">现在，让我们创建带有定制工具提示的标记，显示咖啡店的品牌或名称。</p><pre class="ks kt ku kv gt oa ob oc od aw oe bi"><span id="3aae" class="li lj it ob b gy of og l oh oi">for point in df.index: # loop through the plots</span><span id="bf18" class="li lj it ob b gy oj og l oh oi">html = """</span><span id="d6ed" class="li lj it ob b gy oj og l oh oi">&lt;h3&gt;{name}&lt;/h3&gt;&lt;br&gt;</span><span id="5be9" class="li lj it ob b gy oj og l oh oi">"""</span><span id="1d86" class="li lj it ob b gy oj og l oh oi">popup_contents = folium.Html(html.format(name = df.loc[point, 'name']),<br/>                                             script = True)</span><span id="2495" class="li lj it ob b gy oj og l oh oi">popup = folium.Popup(popup_contents, max_width=1500)</span><span id="4f01" class="li lj it ob b gy oj og l oh oi"># mark every addresses in the map from the data<br/>        folium.Marker(df['geocode'][point],<br/>                     popup=popup).add_to(marker_cluster)</span></pre><p id="7b75" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">让我们分解上面的代码(步骤 1-3 用于弹出内容，步骤 4 用于标记):</p><ol class=""><li id="868e" class="mw mx it mf b mg my mj mz lr na lv nb lz nc mv op ne nf ng bi translated">HTML 字符串将包含我们的工具提示，单击散点图中的点时将显示该工具提示。</li><li id="9932" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv op ne nf ng bi translated">因此，在我们的<code class="fe om on oo ob b">folium.HTML</code>对象中会有这个空字符串。</li><li id="f752" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv op ne nf ng bi translated">因此，我们将它存储在一个可以进一步定制的<code class="fe om on oo ob b">folium.Popup</code>对象中。</li><li id="23c1" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv op ne nf ng bi translated">最后，要向这些商店添加 pin，<code class="fe om on oo ob b">folium.Marker </code>为每个位置添加一个 pin，并确保这些商店是集群的，您需要将它添加到我们已经创建的<code class="fe om on oo ob b">marker_cluster </code>变量中。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oq"><img src="../Images/88e301e6b021c000505cb33a8098ed67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*flh5uz7T-NvBoNS8AsZ9PA.gif"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">GIF 作者:CircleMarker 在行动</p></figure><p id="2a8e" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">为了简单地显示和聚集这些咖啡店，我们已经完成了！</p><p id="2f53" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">然而，如果你想实现我们曾经使用的彩色标记，就像在过去的文章中一样，那么我们需要选择一个不同的标记——圆形标记。</p><h2 id="f65e" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">添加彩色圆圈标记，以提高识别能力</h2><p id="4b63" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">您可以添加之前的标记，也可以选择添加圆形标记。下面是这样做的代码:</p><p id="8e19" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">我们首先需要声明我们的品牌及其颜色:</p><pre class="ks kt ku kv gt oa ob oc od aw oe bi"><span id="ddba" class="li lj it ob b gy of og l oh oi">#Let's Create a Color Dictionary for the Markers<br/>coffee_brands = ["Coffee Bean and Tea Leaf", "Starbucks", "Tim Hortons", "Coffee Project"]</span><span id="e1cf" class="li lj it ob b gy oj og l oh oi">color_dict = {<br/>    "Starbucks": ' #00704A',<br/>    "Coffee Bean and Tea Leaf": '#362d26',<br/>    "Coffee Project": '#654321',<br/>    "Tim Hortons": '#dd0f2d'<br/>}</span></pre><p id="3d42" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">接下来，我们需要迭代每个品牌，并迭代添加彩色圆圈标记。请注意，这段代码用常规的<code class="fe om on oo ob b">folium.Marker</code>替换了我们现有的代码。</p><pre class="ks kt ku kv gt oa ob oc od aw oe bi"><span id="7eb6" class="li lj it ob b gy of og l oh oi">#Since we need to add a filter for this, we need to add them by brand:<br/>for brand in coffee_brands:<br/>    df_i = df[df['brand']==brand]<br/>    df_i.loc[:, "color"] = color_dict[brand]<br/>    <br/>    <br/>    for index, row in df_i.iterrows():<br/>        <br/>        ####### START OF THE SAME CODE FOR POPUP #######<br/>        html = """</span><span id="af9d" class="li lj it ob b gy oj og l oh oi">&lt;h3&gt;{name}&lt;/h3&gt;&lt;br&gt;</span><span id="d90e" class="li lj it ob b gy oj og l oh oi">"""</span><span id="aab6" class="li lj it ob b gy oj og l oh oi">popup_contents = folium.Html(html.format(name = row['name']),<br/>                                             script = True)</span><span id="c325" class="li lj it ob b gy oj og l oh oi">popup = folium.Popup(popup_contents, max_width=1500)<br/>        ####### END OF THE SAME CODE FOR POPUP #######<br/>        folium.vector_layers.CircleMarker(radius = 8,<br/>                                                  location = (row.lat,<br/>                                                              row.lng),<br/>                                                  color = row.color,<br/>                                                  fill = True,<br/>                                                  fill_color = row.color,<br/>                                                  name = brand,<br/>                                                  popup=popup,<br/>                                                  control = True,<br/>                                                  overlay = True<br/>                                                 ).add_to(marker_cluster)</span></pre><p id="a3dd" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">让我们分解上面的代码:</p><ol class=""><li id="7139" class="mw mx it mf b mg my mj mz lr na lv nb lz nc mv op ne nf ng bi translated">您可能已经注意到，添加标记对于 leav 来说是一个迭代过程。根本没有办法批量添加它们，所以对于我们的目的来说，它们必须是循环的一部分。因此，第一步是对品牌进行分组或过滤，这样你就可以给一个品牌分配一种颜色。</li><li id="ec20" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv op ne nf ng bi translated">在过滤一个品牌后，你就可以创造另一个增加市场的循环。<strong class="mf jd">请注意，弹出内容必须添加到每个标记中，因此它们也是循环的一部分，并且具有与上面相同的代码。</strong></li><li id="04ce" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv op ne nf ng bi translated">最后，就像在<code class="fe om on oo ob b">folium.Marker</code>中一样，我们在<code class="fe om on oo ob b">folium.vector_layers.CircleMarker</code>中添加必要的参数，比如半径的大小、填充颜色和颜色，它们将遵循循环开始时分配的颜色。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oq"><img src="../Images/c41b7316d1b2016b34074ebc8ac6b079.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*vNVl1gnI0SjcjjoaACNXgA.gif"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者 GIF。圆圈标记在起作用</p></figure><h1 id="7f47" class="np lj it bd lk nq nr ns ln nt nu nv lq ki nw kj lu kl nx km ly ko ny kp mc nz bi translated">结束语</h1><p id="e3c6" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">如你所见，我们可以用叶子做的事情范围是惊人的。如果您为地图设计了特定的单幅图块，也可以自定义单幅图块。</p><p id="56e2" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">一个非常有用的定制是添加工具提示。正如我们所看到的，HTML 代码可以包含更多的信息，这就是为什么它也是用于部署商业项目的包。</p><p id="38a8" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">我建议数据科学家探索更多的功能，例如添加热图和自定义标记以包含图标。每个点周围的半径也可能有助于某些地理空间项目，这也可以通过令人惊讶的叶包来完成。</p><p id="bc28" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">让我知道你的想法！</p></div></div>    
</body>
</html>