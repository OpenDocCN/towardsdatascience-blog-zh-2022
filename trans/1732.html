<html>
<head>
<title>Analyze US Debt to the Penny with the US Treasury Debt API, Python, and Tableau</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用美国国债API、Python和Tableau分析美国债务</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/analyze-us-debt-to-the-penny-with-the-us-treasury-debt-api-python-and-tableau-ab9aaa44e0e3#2022-04-23">https://towardsdatascience.com/analyze-us-debt-to-the-penny-with-the-us-treasury-debt-api-python-and-tableau-ab9aaa44e0e3#2022-04-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="d16e" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">数据分析、数据工程、美国政府、Python和Tableau</h2><div class=""/><div class=""><h2 id="4963" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">美国财政部通过其债务信息API可以轻松检索美国联邦政府债务数据</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/b9c40799259552809b06731c8a976c3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*z15LWHH8TRlQPTPt"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">美国采购一分硬币。丹·丹尼斯在<a class="ae lh" href="https://unsplash.com/s/photos/coin?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="461c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">根据<a class="ae lh" href="https://usdebtclock.org/" rel="noopener ugc nofollow" target="_blank">美国国债时钟</a>，在我写这篇文章的时候，美国联邦政府已经累积了30403148491160美元的债务。那超过三十万亿美元。</p><p id="f1d2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可以通过美国财政部管理的美国财政部直接债务信息API，以编程方式检索美国政府债务水平数据，精确到便士。本文将向您展示如何编写一个Python程序来检索债务数据。然后，它将演示如何在Tableau Public中创建一个面积图来可视化数据。</p><h1 id="23b3" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">债务信息API和数据摘要</h1><p id="69e6" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">调用债务信息API很简单。它的基本网址是“<em class="nb">http://www.treasurydirect.gov/NP_WS/debt</em>”您可以向基本URL添加参数来检索特定数据。该API可以通过web浏览器或任何编程语言调用，包括Python。</p><p id="d2c5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">API参数在这里<a class="ae lh" href="https://www.treasurydirect.gov/webapis/webapisdebt.htm" rel="noopener ugc nofollow" target="_blank">描述</a>。在本教程中，我们将搜索、检索和查看从2002年1月1日到2022年4月21日的二十多年的每日债务记录。以下是该日期范围内债务信息API的格式。它使用API文档中所说的“债务搜索端点”</p><blockquote class="nc nd ne"><p id="44f5" class="li lj nb lk b ll lm kd ln lo lp kg lq nf ls lt lu ng lw lx ly nh ma mb mc md im bi translated"><a class="ae lh" href="https://www.treasurydirect.gov/NP_WS/debt/search?startdate=2002-01-01&amp;enddate=2022-04-21" rel="noopener ugc nofollow" target="_blank">https://www.treasurydirect.gov/NP_WS/debt/search?开始日期=2002-01-01 &amp;结束日期=2022-04-21 </a></p></blockquote><p id="65e1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请注意"https://www.treasurydirect.gov/NP_WS/debt/search后面的开始日期和结束日期参数。:"</p><ul class=""><li id="1253" class="ni nj it lk b ll lm lo lp lr nk lv nl lz nm md nn no np nq bi translated">开始日期= 2002–01–01</li><li id="4cf6" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md nn no np nq bi translated">结束日期=2022年4月21日</li></ul><p id="0582" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一个问号(？)位于第一个参数之前，而与符号(&amp;)位于后续参数之前。</p><p id="5614" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要运行此查询，请将完整的URL粘贴到web浏览器的地址栏中。然后，按下[返回]。它应该会返回如下图所示的记录。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/2c486e73b4b6385ea9ca6f4e94b73649.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OOSrwFo90LM56U8G"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">美国债务数据样本。Randy Runtsch截图。</p></figure><p id="fbdf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请注意数据表周围的边框。默认情况下，API以这种表格格式返回数据。但是出于编程目的，它也可以返回j <em class="nb"> son、jsonp和xhtml </em> (XML)格式的数据。下一节中的Python程序需要一个JSON输出，因此我们将在URL中添加“format”参数，以JSON格式返回数据。以下是完整的网址:</p><blockquote class="nc nd ne"><p id="e43c" class="li lj nb lk b ll lm kd ln lo lp kg lq nf ls lt lu ng lw lx ly nh ma mb mc md im bi translated">https://www.treasurydirect.gov/NP_WS/debt/search?开始日期=2002年1月1日&amp;结束日期=2022年4月21日&amp;格式=json</p></blockquote><p id="388d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您也可以在web浏览器中运行这个API调用，但是JSON格式的数据是不可读的。</p><h1 id="8837" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">Python程序检索总债务数据并将其写入文件</h1><p id="fff8" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">我在Windows 10上使用Python 3.10和<a class="ae lh" href="https://visualstudio.microsoft.com/vs/community/" rel="noopener ugc nofollow" target="_blank">微软Visual Studio社区2022 </a>集成开发环境(IDE)，编写并运行了下面描述和显示的Python程序。您可以在Windows上随意使用这些工具，或者在您选择的平台上使用最新版本的Python和您首选的IDE或代码编辑器。</p><h2 id="f10e" class="nx mf it bd mg ny nz dn mk oa ob dp mo lr oc od mq lv oe of ms lz og oh mu iz bi translated">Python代码</h2><p id="20f7" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">为了调用债务信息API，我在模块<em class="nb"> c_us_debt_api.py </em>中写了一个名为<em class="nb"> c_us_debt </em>的Python类。模块<em class="nb"> get_us_debt.py </em>是程序的入口点。它创建c_us_debt的一个实例，并用文件名、开始日期和结束日期参数调用它。</p><p id="a95a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Python代码模块如下所示。下一节介绍描述代码如何工作的伪代码。</p><p id="19b8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> c_us_debt_api.py: </strong></p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">Python类c_us_debt检索美国债务总额数据并将其写入JSON格式的文件。由Randy Runtsch编写的代码。</p></figure><p id="f5ed" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> get_us_debt.py: </strong></p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">调用c_us_debt类的Python get_us_debt.py代码模块。由Randy Runtsch编写的代码。</p></figure><h2 id="868c" class="nx mf it bd mg ny nz dn mk oa ob dp mo lr oc od mq lv oe of ms lz og oh mu iz bi translated">伪代码</h2><p id="35f2" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">这段伪代码描述了程序的工作原理:</p><ol class=""><li id="714e" class="ni nj it lk b ll lm lo lp lr nk lv nl lz nm md ok no np nq bi translated">创建一个文件夹，程序将在其中写入输出文件，该文件包含一个JSON结构和每天的美国债务数据。</li><li id="fd21" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md ok no np nq bi translated">在程序的入口点模块(get_us_debt.py)中，调用c_us_debt_api.py的构造函数，给它发送这些参数:输出文件夹和文件的名称，格式为“YYYY-MM-DD”的债务记录开始日期，格式为“YYYY-MM-DD”的债务记录结束日期。</li><li id="8209" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md ok no np nq bi translated">在c_us_debt类的构造函数(__init__())中，将基URL和参数设置到对象变量中。调用get_data()函数来处理请求。</li><li id="eebd" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md ok no np nq bi translated">在get_data()函数中，构建完整的URL，使用get调用带有完整URL的债务信息API，将返回的JSON数据结构写入指定的输出文件夹和文件。</li></ol><h1 id="46a6" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">在Tableau Public中可视化债务数据</h1><p id="0190" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">我选择使用免费的Tableau公共数据可视化桌面应用程序和网站来可视化美国自2002年1月1日以来的债务总额。虽然本教程的重点不是教你如何使用Tableau，但它描述了构建可视化的步骤，如下所示。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ol"><img src="../Images/7d56f78d247c17dd2a0e00c81020f853.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rMr4l4KnQU5GylyK"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">Tableau公众桌面美国总债务面积图截图。由兰迪·朗奇创作。</p></figure><p id="50c1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你可以在这里下载<a class="ae lh" href="https://www.tableau.com/products/public" rel="noopener ugc nofollow" target="_blank"> Tableau公共桌面软件</a>。该应用程序适用于Windows和Mac OS。Tableau发布了这些<a class="ae lh" href="https://www.tableau.com/learn/training/20221" rel="noopener ugc nofollow" target="_blank">免费培训视频</a>来教你如何使用这个工具。</p><p id="5887" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">用Tableau Public创建美国总债务面积图的步骤:</strong></p><ol class=""><li id="9c84" class="ni nj it lk b ll lm lo lp lr nk lv nl lz nm md ok no np nq bi translated">运行上一节描述的Python程序，创建一个文件，其中包含按日期排列的JSON格式的美国总债务记录。</li><li id="f940" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md ok no np nq bi translated">下载并安装Tableau公共桌面。创建一个帐户。</li><li id="14af" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md ok no np nq bi translated">启动Tableau公共桌面。</li><li id="b0b4" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md ok no np nq bi translated">打开包含总债务记录的JSON文件作为新的数据源。</li><li id="7dca" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md ok no np nq bi translated">您应该会看到如下所示的数据源窗口。</li><li id="5254" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md ok no np nq bi translated">请注意，您将使用“生效日期”和“债务总额”字段中的数据来创建图表。</li><li id="7605" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md ok no np nq bi translated">单击屏幕底部的第一个“新工作表”选项卡。</li><li id="2f39" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md ok no np nq bi translated"><em class="nb">生效日期</em>字段中的值是无效的日期值，因为每条记录都包含一个后缀“EDT”，表示该日期为东部夏令时。使用以下计算创建一个名为<em class="nb"> Date </em>的新计算字段:<em class="nb"> DATE(DATEPARSE( "MMMM dd，yyyy "，LEFT([生效日期]，LEN([生效日期]) — 4))。</em>此计算将删除“EDT”并将其转换为标准日期。</li><li id="2f22" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md ok no np nq bi translated">在新的<em class="nb">日期</em>字段的下拉菜单中，将其数据类型更改为“日期”</li><li id="8f7d" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md ok no np nq bi translated">创建面积图，如下面的第二个屏幕截图所示。为了精确地描述债务，请务必选择“精确日期”作为<em class="nb">日期</em>，并将<em class="nb">总债务</em>更改为“维度”</li><li id="242f" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md ok no np nq bi translated">从主菜单中选择[工作表]和[工具提示…]，编辑工具提示文本。</li><li id="6237" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md ok no np nq bi translated">点击主菜单中的[分析]、[趋势线]和[显示趋势线]，添加趋势线。</li><li id="ca94" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md ok no np nq bi translated">根据需要继续修改工作表，包括更改颜色、字体等。</li><li id="c99a" class="ni nj it lk b ll nr lo ns lr nt lv nu lz nv md ok no np nq bi translated">当面积图如你所愿出现时，用你选择的名字发布到Tableau公共服务器。为此，单击主菜单中的[文件]和[保存到Tableau Public…]。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/d802eb50fe4a3f2491f5eb23500f93cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mQ4RsPkcmKIeVP_I"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">Tableau公共桌面显示的美国总债务JSON数据源。Randy Runtsch截图。</p></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/db00b09e562c03a9a93327482b2cd308.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R5xXIXLc7PM_IflP"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">在Tableau Public Desktop中设置总负债面积图。Randy Runtsch截图。</p></figure><p id="d1a3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请注意，世界上的任何人都可以查看发布到Tableau公共服务器的所有工作表。此外，这是从Tableau Public Desktop保存工作表的唯一方法。例如，商业版Tableau Desktop的用户可以将工作簿保存到他们的本地驱动器、Tableau Server的私有实例或Tableau Public。</p><p id="44f1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你可以在这里查看我的美国政府债务总额图表。请随意下载一份，在Tableau Public Desktop中编辑，并使用您自己的帐户将其发布到Tableau Public服务器。</p><h1 id="0ac9" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">其他美国财政部数据API</h1><p id="d01d" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">虽然本教程涵盖了美国的总债务数据，但是您也可以调用<a class="ae lh" href="https://www.treasurydirect.gov/webapis/webapisecurities.htm" rel="noopener ugc nofollow" target="_blank">财政部安全信息API </a>来查询和检索大量关于美国政府证券的数据，比如国债和票据。你可以通过其<a class="ae lh" href="https://fiscaldata.treasury.gov/api-documentation/" rel="noopener ugc nofollow" target="_blank">财政数据网页</a>上描述的80个附加API访问其他类型的美国财政部数据。</p><h1 id="0625" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">摘要</h1><p id="6e11" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">本教程提供了编写Python程序以使用债务信息API检索美国政府债务数据的基本说明。它还描述了如何使用Tableau Public来可视化债务数据。我希望这些信息对您有所帮助。</p></div><div class="ab cl om on hx oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="im in io ip iq"><p id="7eb1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> <em class="nb"> P.S. </em> </strong> <em class="nb">首先，你要</em> <a class="ae lh" href="https://rruntsch.medium.com/subscribe" rel="noopener"> <strong class="lk jd"> <em class="nb">把我的帖子收进你的收件箱</em> </strong> </a> <em class="nb">。接下来，通过成千上万像我一样的作家的故事，体验所有的媒介，考虑一下每月只需5美元就能注册成为会员的</em><a class="ae lh" href="https://rruntsch.medium.com/membership" rel="noopener"><strong class="lk jd"><em class="nb"/></strong></a><em class="nb">。你也将有机会通过写作赚钱。</em></p></div></div>    
</body>
</html>