<html>
<head>
<title>A Better Way to Process Images for OCR</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为 OCR 处理图像的更好方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-better-way-to-process-images-for-ocr-aa634b94d573#2022-03-09">https://towardsdatascience.com/a-better-way-to-process-images-for-ocr-aa634b94d573#2022-03-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1bbc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我希望我能早点发现斯坎泰勒</h2></div><p id="8d79" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我的上一篇文章中，我介绍了如何使用 Python 代码为 OCR 处理图像。OCR 要求文本视图清晰，可以从左向右阅读。文本看起来越像刚打印出来的，结果就越准确。我最近写了一个更智能的算法，并发现了一个开源软件 ScanTailor，它在处理图像方面做得更好，特别是在几何扭曲(即文本卷曲)方面！我希望这种方法将有助于开发更精确的页面裁剪算法，并重新激起人们对改进 ScanTailor 的兴趣。查看<a class="ae lb" rel="noopener" target="_blank" href="/intelligently-cropping-page-marginalia-ab04744a1111">上一篇文章</a>了解图像处理每个步骤的更多细节。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="496e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于相对干净的图像，前面的代码在将图像分割成单个文本列时工作得很好，但是当图像非常失真或“脏”时，性能就很差。该算法依赖于在列之间找到一个干净的空白，但是在所有的边上都有很多黑色的区域，不容易被剪掉。</p><p id="86ec" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">新的算法方法使用 OpenCV 的 EAST 文本检测器来寻找所有文本的边界框。然后，我基于边界框所有最左边的垂直边缘创建了一个直方图。(边框的右边缘不如左边缘精确，这意味着单词的两端通常会被剪切掉)</p><blockquote class="lj lk ll"><p id="61a8" class="kf kg lm kh b ki kj jr kk kl km ju kn ln kp kq kr lo kt ku kv lp kx ky kz la ij bi translated">“OpenCV 的 EAST text detector 是一种深度学习模型，基于一种新颖的架构和训练模式。它能够(1)在 720p 图像上以 13 FPS 的速度近乎实时地运行，并且(2)获得最先进的文本检测精度。”</p></blockquote><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/5a53cc3491b2455d26abf815c17ec8eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*xTCj_XbnpUHkCBGy4emz-Q.png"/></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">OpenCV 的 EAST 文本检测器在扫描的页面上识别边界框。【图文由作者提供。Quién es quién en Colombia，第二版。(波哥大:奥利韦里奥·佩里，1948 年)。]</p></figure><p id="0b39" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我根据最长的连续“空白”空间和边界框中从最高的后续尖峰开始的第二个文本列的起点来搜索白色中心列。第二个文本列的起点是裁剪位置。我们希望裁剪白色中间列的起点和第二个文本列的边缘的起点之间的点。但是，如果我们平均这些位置，作物位置往往太左。(我们这里的工作误差很小！)</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/401d07b808f93bc0ff82809902be67cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*DVEBUUbQLufKzLqyA1f74A.png"/></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">图像上每个长度方向位置左边缘的边界框数量的直方图。[作者提供的图片]</p></figure><p id="0eb2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是有些页面是倾斜的，所以在图像旋转之前没有 0 度垂直线。我通过顺时针和逆时针旋转图像 0.5 度来解决这个问题。每次旋转都以最长的连续“空白”空间来计分。获取边界框花费了相当多的时间，所以如果分数≥8，为了加快代码速度，我选择了那个旋转角度。这个选择是基于观察和反复试验。</p><p id="9414" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">起初，我真的很高兴这些图像被裁剪得几乎完美，误差率为 0.4%——直到我运行 OCR。结果很糟糕。靠近装订的文本或文本扭曲的页面上的文本均未被读取。OCR 假定它要查找的文本可以放入一个矩形框中。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi md"><img src="../Images/879e0c98e16be98c5ad4b9ed448aa2ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*tQGZ8Pu9tmcdys2A7iWhGA.png"/></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">页面扭曲时，边界框位置的近似性较差。【图文由作者提供；由<em class="me">撰写，第二版。(波哥大:奥利韦里奥·佩里，1948 年)。]</em></p></figure><p id="040c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在 Python 上寻找解开文本的方法时，我偶然发现了一个开源软件(直到生产阶段才完成，但自 2014 年以来一直没有维护过)，名为<a class="ae lb" href="https://github.com/scantailor/scantailor" rel="noopener ugc nofollow" target="_blank"> ScanTailor </a>。它执行页面分割、倾斜校正、内容选择、二进制化和边距修正，而<a class="ae lb" href="https://github.com/Tulon/scantailor/releases/tag/EXPERIMENTAL_2015_06_20" rel="noopener ugc nofollow" target="_blank">实验版本</a>还可以校正几何失真和斑点。</p><p id="c6db" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该软件并不完美，我不得不手动修改许多页面，但它的界面使简单的拖动和点击变得非常容易。我花了大约一个小时来纠正错误，但与花在编写实际代码上的更多时间相比，这是一个很好的权衡。另外，请注意，文本非常少的页面可能会被删除！</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mf"><img src="../Images/e707bb2034df3f1d19cf3981d3f9ae73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SeooHC4j0OKNoaYuUe_sPQ.png"/></div></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">在处理之前的图像以修复几何扭曲、分割页面、选择内容和去斑之后，ScanTailor 程序的屏幕截图。【图文由作者提供；第二版。(波哥大:奥利韦里奥·佩里，1948 年)。]</p></figure><p id="015f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ScanTailor 也快得多，处理我的图像批次需要 1 个小时，而我的代码需要 8 个小时。但是软件稍微不稳定，RAM 用多了就死机，所以我建议把每次运行分解成批次，每次保存。</p><p id="157e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae lb" href="https://graphicdesign.stackexchange.com/questions/30948/best-way-to-flatten-a-curled-photographed-book-photograph" rel="noopener ugc nofollow" target="_blank">论坛</a>提供了几个其他选项，<a class="ae lb" href="https://graphicdesign.stackexchange.com/questions/30948/best-way-to-flatten-a-curled-photographed-book-photograph" rel="noopener ugc nofollow" target="_blank"> </a>但这是我找到的最直接、最好的解决方案。(我用的是 Windows！)</p><p id="0bc6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这种无代码的解决方案对于那些没有技术技能的人来说绝对是一个很大的优势，所以我希望这篇文章能帮助你为 OCR 准备图像！</p></div></div>    
</body>
</html>