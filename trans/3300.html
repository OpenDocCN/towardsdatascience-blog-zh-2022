<html>
<head>
<title>Querying Pandas DataFrames using the query() Method</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用query()方法查询熊猫数据帧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/querying-pandas-dataframes-using-the-query-method-c1b887b5c461#2022-07-22">https://towardsdatascience.com/querying-pandas-dataframes-using-the-query-method-c1b887b5c461#2022-07-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c041" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用类似SQL的语法查询您的熊猫数据帧</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/27c7cbcfe4ba30a19b54df6693c1d71d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FWy6ecglmM9TrwIy"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">约翰·施诺布里奇在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="d1ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大多数Pandas用户都熟悉从Pandas数据帧中检索行和列的<code class="fe lv lw lx ly b">iloc[]</code>和<code class="fe lv lw lx ly b">loc[]</code>索引器方法。然而，随着检索数据的规则变得越来越复杂，这些方法变得非常笨拙。既然大多数开发人员都熟悉SQL，为什么不使用类似于SQL的东西来查询您的数据框架呢？</p><p id="db34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实证明，你可以用<code class="fe lv lw lx ly b">query()</code>方法做到这一点。因此，在本文中，我将展示一些例子，说明如何使用<code class="fe lv lw lx ly b">query()</code>方法在数据帧上执行查询。</p><h1 id="767b" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">获取数据</h1><p id="b7df" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">在这篇文章中，我将使用泰坦尼克号数据集。</p><blockquote class="mw mx my"><p id="1a99" class="kz la mz lb b lc ld ju le lf lg jx lh na lj lk ll nb ln lo lp nc lr ls lt lu im bi translated"><strong class="lb iu">数据来源</strong>:本文数据来源于<a class="ae ky" href="https://www.kaggle.com/datasets/tedllh/titanic-train" rel="noopener ugc nofollow" target="_blank"><em class="it">https://www.kaggle.com/datasets/tedllh/titanic-train</em></a><em class="it">。</em></p><p id="cb02" class="kz la mz lb b lc ld ju le lf lg jx lh na lj lk ll nb ln lo lp nc lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">许可— </em> </strong> <em class="it">数据库内容许可(DbCL)v 1.0</em><a class="ae ky" href="https://opendatacommons.org/licenses/dbcl/1-0/" rel="noopener ugc nofollow" target="_blank"><em class="it">https://opendatacommons.org/licenses/dbcl/1-0/</em></a></p></blockquote><p id="6f1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将CSV文件加载到熊猫数据帧中:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="ad6e" class="nh ma it ly b gy ni nj l nk nl">import pandas as pd</span><span id="8e0a" class="nh ma it ly b gy nm nj l nk nl">df = pd.read_csv('titanic_train.csv')<br/>df</span></pre><p id="64c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据帧有891行和12列:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/86b3bf6afc7025c9419ba9b7489ee1be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6wyWPmzpGl_PBh_RJXNKNw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="5ceb" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">使用query()方法</h1><p id="9036" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">让我们找到所有从南安普顿登船的乘客。使用<em class="mz">方括号索引</em>，代码如下所示:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="50a2" class="nh ma it ly b gy ni nj l nk nl">df[df['Embarked'] == 'S']</span></pre><p id="1c98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，如果你使用<code class="fe lv lw lx ly b">query()</code>方法，它看起来更整洁:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="2fc8" class="nh ma it ly b gy ni nj l nk nl">df.<strong class="ly iu">query</strong>(<strong class="ly iu">'Embarked == "S"'</strong>)</span></pre><blockquote class="mw mx my"><p id="097a" class="kz la mz lb b lc ld ju le lf lg jx lh na lj lk ll nb ln lo lp nc lr ls lt lu im bi translated">如果您想与SQL进行比较，<code class="fe lv lw lx ly b">query()</code>方法中的表达式就像SQL中的WHERE语句。</p></blockquote><p id="33eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果是所有乘客从<em class="mz">南安普敦</em>出发的数据帧:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/13b061a2639b842dd533a30f4087d95c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lEUxGk_UBYY5lfpUa0lzvA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6914" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">query()</code>方法接受字符串形式的查询。因此，如果您正在查询一个字符串列，您需要确保您的字符串被正确地括起来。下图说明了这一点:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/d32ee717bbdf13cf71fcc077be32a17d.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/format:webp/1*zc1OsPtjURqIVuHlw-pCEg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="549f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，您可能希望将变量值传递到查询字符串中。您可以使用<code class="fe lv lw lx ly b">@</code>字符来完成:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="e42f" class="nh ma it ly b gy ni nj l nk nl">embarked = 'S'<br/>df.query('Embarked == @embarked')</span></pre><p id="5e77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，您也可以使用f弦，如下所示:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="e058" class="nh ma it ly b gy ni nj l nk nl">df.query(f'Embarked == "{embarked}"')</span></pre><blockquote class="mw mx my"><p id="0d12" class="kz la mz lb b lc ld ju le lf lg jx lh na lj lk ll nb ln lo lp nc lr ls lt lu im bi translated">就个人而言，我认为使用<code class="fe lv lw lx ly b">@</code>字符比f弦方式更简单、更优雅。</p></blockquote><p id="e8e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果列名中包含空格，您可以使用反斜杠(<code class="fe lv lw lx ly b">``</code>)将列名换行:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="a4d2" class="nh ma it ly b gy ni nj l nk nl">df.query('<strong class="ly iu">`Embarked On`</strong> == @embarked')</span></pre><h1 id="8ec3" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">就地执行查询</h1><p id="68ec" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">当您使用<code class="fe lv lw lx ly b">query()</code>方法执行查询时，该方法将结果作为数据帧返回，而原始数据帧保持不变。如果您想更新数据帧，使用<code class="fe lv lw lx ly b">inplace</code>参数，如下所示:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="77c6" class="nh ma it ly b gy ni nj l nk nl">df.query('Embarked == "S"'<strong class="ly iu">,</strong> <strong class="ly iu">inplace=True</strong>)</span></pre><p id="3752" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当<code class="fe lv lw lx ly b">inplace</code>设置为<code class="fe lv lw lx ly b">True</code>时，<code class="fe lv lw lx ly b">query()</code>方法将不返回值。相反，原始数据帧被修改。</p><h1 id="6776" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">指定多个条件</h1><p id="c459" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">您可以在查询中指定多个条件。例如，说我想得到从<em class="mz">南安普敦</em> ('S ')或<em class="mz">瑟堡</em> ('C ')登船的所有乘客。使用方括号索引，这种语法很快变得非常笨拙:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="b2bc" class="nh ma it ly b gy ni nj l nk nl">df[(df['Embarked'] == 'S') | (df['Embarked'] == 'C')]</span></pre><p id="7fe9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，在您的条件中，您需要引用您的dataframe ( <code class="fe lv lw lx ly b">df</code>)两次。使用<code class="fe lv lw lx ly b">query()</code>方法，这是在公园散步:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="c619" class="nh ma it ly b gy ni nj l nk nl">df.query(<strong class="ly iu">'Embarked in ("S","C")'</strong>)</span></pre><p id="135a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述语句产生以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/1bbd24f3d352807631d6b75f77cb2f54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PAZ5hKh6jo7dBw9yh9g52A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3149" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想查找所有从<em class="mz">南安普敦</em> ('S ')或<em class="mz">瑟堡</em> ('C ')出发的<strong class="lb iu">而非</strong>的乘客，您可以在Pandas中使用否定运算符(~):</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="8c3e" class="nh ma it ly b gy ni nj l nk nl">df[<strong class="ly iu">~(</strong>(df['Embarked'] == 'S') | (df['Embarked'] == 'C')<strong class="ly iu">)</strong>]</span></pre><p id="57e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe lv lw lx ly b">query()</code>方法，您只需要使用<code class="fe lv lw lx ly b">not</code>操作符:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="e97f" class="nh ma it ly b gy ni nj l nk nl">df.query('Embarked <strong class="ly iu">not</strong> in ("S","C")')</span></pre><p id="f4f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下输出显示了从Queenstown ('Q ')出发的乘客以及缺少值的乘客:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/47564418334c33efec9b962304a587e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BLmUGy8Of52yNZ3UvsIo-Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0758" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谈到缺失值，如何查询缺失值？当应用于列名时，您可以使用<code class="fe lv lw lx ly b">isnull()</code>方法查找缺失值:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="8701" class="nh ma it ly b gy ni nj l nk nl">df.query('<strong class="ly iu">Embarked.isnull()</strong>')</span></pre><p id="9303" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在将显示在<strong class="lb iu">开始的</strong>列中缺少值的行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/2641c8fac063f1924259bc3b0edf81dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cUkdaPNdgQpvObZXFPqgQA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b377" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实际上，可以直接在列名上调用各种Series方法。以下是一些例子:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="9b1e" class="nh ma it ly b gy ni nj l nk nl"><strong class="ly iu">df.query('Name.str.len() &lt; 20')</strong>  # find passengers whose name is <br/>                                 # less than 20 characters</span><span id="44e1" class="nh ma it ly b gy nm nj l nk nl"><strong class="ly iu">df.query(f'Ticket.str.startswith("A")')</strong> # find all passengers whose <br/>                                        # ticket starts with A</span></pre><h1 id="8370" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">比较数字列</h1><p id="7126" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">您还可以轻松地比较数字列:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="44a2" class="nh ma it ly b gy ni nj l nk nl">df.query('Fare &gt; 50')</span></pre><p id="7abb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下输出显示了票价大于50的所有行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/88120d07159946006429fa815d2874ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8XLXnWHiIO5OnxPEj9V1pw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="af38" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">比较多列</h1><p id="577a" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">您还可以使用<code class="fe lv lw lx ly b">and</code>、<code class="fe lv lw lx ly b">or</code>和<code class="fe lv lw lx ly b">not</code>操作符来比较多个列。以下语句检索所有费用大于50且年龄大于30的行:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="785d" class="nh ma it ly b gy ni nj l nk nl">df.query('Fare &gt; 50 and Age &gt; 30')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/d3b30557359608b69b9dc2f0e6b03e6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lCi4WKDrW8HlseGkS2BO6A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="718e" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">查询索引</h1><p id="5d77" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">通常，当您想要基于索引值检索行时，您可以使用<code class="fe lv lw lx ly b">loc[]</code>索引器，如下所示:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="25dd" class="nh ma it ly b gy ni nj l nk nl">df.loc[[1],:]  # get the row whose index is 1; return as a dataframe</span></pre><p id="29aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe lv lw lx ly b">query()</code>方法，事情更加直观:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="9eac" class="nh ma it ly b gy ni nj l nk nl">df.query('index==1')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/25dbde891fd01720505d4ee5862adf8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gXY8wgtZbMZtHDNOI_uSCQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a223" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果希望检索索引值小于5的所有行:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="5210" class="nh ma it ly b gy ni nj l nk nl">df.query('index&lt;5')</span></pre><p id="8493" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的语句显示了结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/61742a9ad70cbed6b66c1e5f6e55b43e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wUTiqukS0Dq6zADyeVpIqA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="76c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以指定索引值的范围:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="667f" class="nh ma it ly b gy ni nj l nk nl">df.query('6 &lt;= index &lt; 20')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/86ba94fe2307f2a5f5cc4e7ca4a2b07f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uOUKBQB-hLCgW3_c-SDtVA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="f663" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">比较多列</h1><p id="01c8" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">您还可以比较列之间的值。例如，以下语句检索其<strong class="lb iu"> Parch </strong>值大于<strong class="lb iu"> SibSp </strong>值的所有行:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="680d" class="nh ma it ly b gy ni nj l nk nl">df.query('Parch &gt; SibSp')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/6365530d3921b4a1a4f2a77129dfd6f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zXX7nCVYuyD1LCPyAGL0fQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><div class="nx ny gp gr nz oa"><a href="https://weimenglee.medium.com/membership" rel="noopener follow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">加入媒介与我的介绍链接-李伟孟</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">阅读李维孟(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">weimenglee.medium.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo ks oa"/></div></div></a></div><h1 id="4a2f" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">相关文章</h1><div class="nx ny gp gr nz oa"><a href="https://weimenglee.medium.com/performing-exploratory-data-analysis-eda-using-pivot-tables-in-pandas-3f402f95681b" rel="noopener follow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">使用Pandas中的数据透视表执行探索性数据分析(EDA)</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">了解如何使用Pandas中的pivot_table()函数来聚合数据</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">weimenglee.medium.com</p></div></div><div class="oj l"><div class="op l ol om on oj oo ks oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a rel="noopener follow" target="_blank" href="/working-with-multi-index-pandas-dataframes-f64d2e2c3e02"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">使用多索引熊猫数据框架</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">了解如何轻松使用多索引数据框架</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">towardsdatascience.com</p></div></div><div class="oj l"><div class="oq l ol om on oj oo ks oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a rel="noopener follow" target="_blank" href="/working-with-multi-index-pandas-dataframes-f64d2e2c3e02"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">使用多索引熊猫数据框架</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">了解如何轻松使用多索引数据框架</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">towardsdatascience.com</p></div></div><div class="oj l"><div class="oq l ol om on oj oo ks oa"/></div></div></a></div><h1 id="f00b" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">摘要</h1><p id="8d1b" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">从上面的例子可以看出，<code class="fe lv lw lx ly b">query()</code>方法使得搜索行的语法更加自然，更像英语。为了确保您真正理解query的工作原理，这里有一些挑战(在尝试这些问题之前不要看下面的答案):</p><ul class=""><li id="3935" class="or os it lb b lc ld lf lg li ot lm ou lq ov lu ow ox oy oz bi translated">显示票价高于平均票价的所有行</li><li id="1574" class="or os it lb b lc pa lf pb li pc lm pd lq pe lu ow ox oy oz bi translated">查找姓名中包含称呼博士的所有乘客</li><li id="3f76" class="or os it lb b lc pa lf pb li pc lm pd lq pe lu ow ox oy oz bi translated">找出所有付了最高票价的乘客</li><li id="7d03" class="or os it lb b lc pa lf pb li pc lm pd lq pe lu ow ox oy oz bi translated">找到所有有机舱号的乘客</li><li id="cc4b" class="or os it lb b lc pa lf pb li pc lm pd lq pe lu ow ox oy oz bi translated">找到所有机票号码以STON开头的乘客</li></ul><h2 id="f6c9" class="nh ma it bd mb pf pg dn mf ph pi dp mj li pj pk ml lm pl pm mn lq pn po mp pp bi translated">答案</h2><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="3f47" class="nh ma it ly b gy ni nj l nk nl">df.query(f'Fare &lt; {df["Fare"].mean()}')<br/>df.query('Name.str.contains(" Dr. ")')<br/>df.query(f'Fare == {df["Fare"].max()}')<br/>df.query('~Cabin.isnull()')<br/>df.query('Ticket.str.contains("^STON")')</span></pre></div></div>    
</body>
</html>