<html>
<head>
<title>Creating Excel Reports with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 创建 Excel 报表</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-excel-reports-with-python-e8c94072f09d#2022-02-07">https://towardsdatascience.com/creating-excel-reports-with-python-e8c94072f09d#2022-02-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b922" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在不打开 Excel 的情况下创建 Excel 文件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/46ba2eac644e7b7b4ba40ce4af169074.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Yscn9pvxmontVh4pJ3FBw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@mbaumi?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">米卡·鲍梅斯特</a>在<a class="ae ky" href="https://unsplash.com/s/photos/excel?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="432a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Excel 非常受欢迎。</p><p id="ec98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从<a class="ae ky" href="https://www.investopedia.com/articles/personal-finance/032415/importance-excel-business.asp" rel="noopener ugc nofollow" target="_blank"> Investopedia </a>来看，“在商业中，从字面上看，任何行业的任何职能都可以受益于那些拥有强大 Excel 知识的人。Excel 是一个强大的工具，已经成为全球业务流程中不可或缺的一部分”</p><p id="e258" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">业务用户喜欢 Excel，因此大量的报告需要在 Excel 中。</p><p id="e0b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但这并不意味着我们必须使用 Excel 来处理数据。</p><p id="5df8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们将学习使用 Python 和 Pandas 创建 Excel 报表，而无需打开 Excel。</p><h2 id="b42f" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">背景</h2><p id="bf52" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">作为一名数据分析师，我的第一个任务是在 Excel 中运行生产力报告。运行这个报告需要我手动下载两个大型数据集，将数据导入 Excel，合并数据，并执行计算。</p><p id="ddcb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为数据集很大——至少对 Excel 来说——我经历了持续的滞后和可怕的死亡之轮。</p><p id="65bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它花了整整 8 个小时的工作日才完成。</p><p id="5eea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，在我可以(当然是手动的)分发之前，它必须被发送给一个主管进行双重检查。</p><p id="c643" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该报告必须每两周用新数据重新创建一次。在一年的时间里，仅复制一份报告就要花费超过 5 周的时间！</p><p id="efe4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我知道一定有更好的方法。</p><h2 id="61f8" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">任务</h2><p id="a7ea" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在这里，我们将使用 Python 为我们想象的小部件工厂创建一个 Excel 报表。</p><p id="a9e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">widget factory 委托我们创建一份报告，详细说明工人和团队创建 widget 的平均时间。他们希望报告是一个 Excel 文档，每个团队都有一张表格。</p><h2 id="b7d3" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">资料组</h2><p id="a379" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们将继续使用我们在本文的<a class="ae ky" rel="noopener" target="_blank" href="/generating-fake-data-with-python-c7a32c631b2a">中创建的小部件工厂数据集，在那里我们通过 Python 生成假数据。</a></p><h2 id="39eb" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">创建报告</h2><p id="e974" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们所有的数据操作都是使用 Python 和 Pandas 完成的。</p><p id="491d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们使用 Pandas 读入数据集，并检查每个数据集的形状。</p><p id="a412" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们使用<code class="fe mt mu mv mw b">.agg()</code>通过<code class="fe mt mu mv mw b">worker_id</code>查找汇总统计数据。对数据进行分组后，我们就有了一个需要扁平化的具有多索引的分组数据集。</p><p id="fc40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还想处理一些列标题的格式。当我们写到 Excel 时，我们希望标题是漂亮的，所以我们现在可以处理它了。</p><p id="8e10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们将分组的数据集合并回工人数据集，以获得工人姓名和团队。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/b74214f06079b8c68c3ecbb290c9b0a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6UIkAW58lUISMY4Ba9UB7Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">按员工分类的汇总统计数据—按作者分类的图片</p></figure><p id="68d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将数据集形状打印为双重检查，以确保我们对数据集的操作和合并是正确的。我们可以看到我们有 5000 行，并且确信这是正确的，因为 worker 数据集也有 5000 行。</p><p id="c5ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是为每个团队将数据分割成单独的数据帧。</p><p id="5d3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要一个独特的团队名称列表。我们可以使用<code class="fe mt mu mv mw b">unique()</code>来寻找唯一的名字，而不是硬编码这些名字。这将有助于防止将来数据发生变化——我们的代码不会崩溃！</p><p id="dad9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们创建一个空字典，用于存储团队数据帧。</p><p id="0ab8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们遍历各个团队，为每个团队创建一个新的数据帧，并将其存储在字典中，关键字是团队名称。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="9c0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们通过打印每个团队数据帧的形状来仔细检查这是否如预期的那样工作。正如所料，这些行加起来有 5000 行！</p><p id="2851" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们准备将最终报告写入 Excel。</p><h2 id="3ed9" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">写入 Excel</h2><p id="221b" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们将使用 Pandas 和 XlsxWriter 创建我们的 Excel 报表。</p><p id="ffd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://xlsxwriter.readthedocs.io/" rel="noopener ugc nofollow" target="_blank"> XlsxWriter </a>是熊猫用来编写 Excel 的 XLSX 格式文件的默认模块。</p><p id="fa48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以使用以下命令安装它:</p><pre class="kj kk kl km gt na mw nb nc aw nd bi"><span id="1732" class="lv lw it mw b gy ne nf l ng nh">pip install xlsxwriter</span></pre><p id="429f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们创建一个变量来存储文件名和路径。</p><p id="654b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们使用 Pandas 的<code class="fe mt mu mv mw b">ExcelWriter</code>来编写我们的 Excel 文件。</p><p id="6b77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">熊猫的文档指示:“作者应该被用作上下文管理器。”非常简单，这告诉我们应该将代码包装在一个<code class="fe mt mu mv mw b">with</code>块中，以确保我们的外部资源(这里是我们正在创建的 Excel 文件)在我们完成后关闭。</p><p id="5a75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，遍历我们的数据帧字典，将每个数据帧写到它自己的表中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="28f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以在 Excel 中打开完成的报告了！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/02f21522e154f21562db016624888ac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1He0zxNSrEtYxyKzbc4dJQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">已完成的 Excel 报告—作者图片</p></figure><p id="b7f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然我们已经成功地将报告写到 Excel 中，并为每个团队提供了单独的表格，但它看起来并不漂亮。</p><p id="2165" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们添加一些格式来改善该报告的外观:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="8980" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们为每列添加了下拉箭头，冻结了顶行，并为每列的宽度添加了适当的间距。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/9ad1307d22703263966657e398e18ae1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gib6_FQk8l637ti6qxEzag.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带格式的 Excel 报表-按作者排序的图像</p></figure><p id="e415" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样看起来好多了！我们的报告现在可以分发了！</p><h2 id="879e" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">结论</h2><p id="e7e8" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在这里，我们学习了使用 Python、Pandas 和 XlsxWriter 创建 Excel 报表。</p><p id="edcd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然我们只触及了 XlsxWriter 功能的表面，但我们能够使用 Python 创建 Excel 报表，而无需打开 Excel！</p></div></div>    
</body>
</html>