<html>
<head>
<title>Xarray Recipes for Earth Scientists</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">地球科学家的食谱</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/xarray-recipes-for-earth-scientists-c12a10c6a293#2022-02-26">https://towardsdatascience.com/xarray-recipes-for-earth-scientists-c12a10c6a293#2022-02-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="86c3" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">气候数据科学</h2><div class=""/><div class=""><h2 id="c1d9" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">帮助您分析数据的代码片段</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/1487b2f1d021a7ead71cdcfa5790b131.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ShM0muCDQwRdwtvw"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@flyd2069?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">飞:D </a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="c541" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">地球科学数据通常打包在带有标注维度的NetCDF文件中，这使得<code class="fe me mf mg mh b">xarray</code>成为完美的分析工具。<code class="fe me mf mg mh b">Xarray</code>有一些强大而通用的内置方法，比如<code class="fe me mf mg mh b">resample()</code>、<code class="fe me mf mg mh b">groupby()</code>和<code class="fe me mf mg mh b">concat()</code>。这个包是地理空间分析的组成部分，这就是为什么它是<a class="ae lh" href="https://pangeo.io/architecture.html" rel="noopener ugc nofollow" target="_blank"> Pangeo软件栈</a>的主干。<code class="fe me mf mg mh b">Xarray</code>在开源<a class="ae lh" href="http://www.apache.org/licenses/LICENSE-2.0.html" rel="noopener ugc nofollow" target="_blank"> Apache许可</a>下可用。</p><p id="1124" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">本文是面向地球科学家的片段集。</p><pre class="ks kt ku kv gt mi mh mj mk aw ml bi"><span id="9063" class="mm mn it mh b gy mo mp l mq mr"><strong class="mh jd">Table of Contents</strong></span><span id="9314" class="mm mn it mh b gy ms mp l mq mr"><a class="ae lh" href="#b377" rel="noopener ugc nofollow">0. Installation</a><br/>  <a class="ae lh" href="#0b57" rel="noopener ugc nofollow">0.1 Tutorial dataset</a><br/><a class="ae lh" href="#e7e2" rel="noopener ugc nofollow">1. Climatology and Anomalies</a><br/><a class="ae lh" href="#ab3a" rel="noopener ugc nofollow">2. Downsampling: Monthly Average</a><br/>  <a class="ae lh" href="#b23c" rel="noopener ugc nofollow">2.1 Monthly Max, Min, Median, etc.</a><br/>  <a class="ae lh" href="#4043" rel="noopener ugc nofollow">2.2 N-month Average</a><br/><a class="ae lh" href="#3865" rel="noopener ugc nofollow">3. Upsampling: Daily Interpolation</a><br/><a class="ae lh" href="#c729" rel="noopener ugc nofollow">4. Weighted Average</a><br/><a class="ae lh" href="#544f" rel="noopener ugc nofollow">5. Moving Average</a><br/><a class="ae lh" href="#88e6" rel="noopener ugc nofollow">6. Ensemble Average</a><br/><a class="ae lh" href="#3b71" rel="noopener ugc nofollow">7. Assign New Variables or Coordinate</a><br/>  <a class="ae lh" href="#2360" rel="noopener ugc nofollow">7.1 Assign new variable</a><br/>  <a class="ae lh" href="#4417" rel="noopener ugc nofollow">7.1 Changing time coordinate</a><br/>  <a class="ae lh" href="#6c13" rel="noopener ugc nofollow">7.2 Changing longitude coordinate</a><br/><a class="ae lh" href="#7044" rel="noopener ugc nofollow">8. Select a Specific Location</a><br/><a class="ae lh" href="#3108" rel="noopener ugc nofollow">9. Fill in Missing Values</a><br/>  <a class="ae lh" href="#a0d9" rel="noopener ugc nofollow">9.1 Fill NaN with value</a><br/>  <a class="ae lh" href="#d007" rel="noopener ugc nofollow">9.2 Replace with climatology</a><br/>  <a class="ae lh" href="#9608" rel="noopener ugc nofollow">9.3 Interpolate between points</a><br/>  <a class="ae lh" href="#2521" rel="noopener ugc nofollow">9.4 Forward/backward filling</a><br/><a class="ae lh" href="#7a5f" rel="noopener ugc nofollow">10. Filter Data</a><br/><a class="ae lh" href="#bbe5" rel="noopener ugc nofollow">11. Mask Data</a><br/><a class="ae lh" href="#7d35" rel="noopener ugc nofollow">12. Final Thoughts</a><br/>  <a class="ae lh" href="#a90b" rel="noopener ugc nofollow">12.1 Split-apply-combine</a></span></pre></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="b377" class="na mn it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">0.装置</h1><p id="0ab5" class="pw-post-body-paragraph li lj it lk b ll nr kd ln lo ns kg lq lr nt lt lu lv nu lx ly lz nv mb mc md im bi translated"><a class="ae lh" href="https://xarray.pydata.org/en/v0.21.1/getting-started-guide/installing.html#" rel="noopener ugc nofollow" target="_blank">开发者推荐</a>使用<code class="fe me mf mg mh b">conda</code>包管理器和社区维护的<code class="fe me mf mg mh b">conda-forge</code>通道进行安装。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><h2 id="0b57" class="mm mn it bd nb ny nz dn nf oa ob dp nj lr oc od nl lv oe of nn lz og oh np iz bi translated">0.1教程数据集</h2><p id="996f" class="pw-post-body-paragraph li lj it lk b ll nr kd ln lo ns kg lq lr nt lt lu lv nu lx ly lz nv mb mc md im bi translated">安装完成后，尝试加载这个<a class="ae lh" href="https://xarray.pydata.org/en/stable/generated/xarray.tutorial.open_dataset.html" rel="noopener ugc nofollow" target="_blank">教程数据集</a>，它是两年来每天采样4次的空气温度。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><blockquote class="oi oj ok"><p id="44b5" class="li lj ol lk b ll lm kd ln lo lp kg lq om ls lt lu on lw lx ly oo ma mb mc md im bi translated">这个数据集可以用来研究本文中的食谱</p></blockquote><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi op"><img src="../Images/9c3756cc32ac893422307f073181272f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OVpBbqW6AHswv4rUy9NPkg@2x.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</p></figure></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="e7e2" class="na mn it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">1.气候学和异常</h1><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><ul class=""><li id="e952" class="oq or it lk b ll lm lo lp lr os lv ot lz ou md ov ow ox oy bi translated"><strong class="lk jd">气候学</strong>:月气候学需要对一个时间序列中的所有一月进行平均，然后是所有二月，等等。</li><li id="6f61" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated"><strong class="lk jd">异常</strong>:这些是与气候学的偏差或者是原始时间序列与气候学的差异。例如，如果时间序列是每月的，那么2013年1月的异常值就是2013年1月的值减去1月的气候学值。</li></ul><p id="1432" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe me mf mg mh b"><a class="ae lh" href="https://xarray.pydata.org/en/stable/generated/xarray.Dataset.groupby.html" rel="noopener ugc nofollow" target="_blank">groupby()</a></code>将收集所有相似的坐标值，在本例中，每个组包含每个月——不考虑年份。然后，我们计算每组的平均值，并将它们重新组合在一起</p><p id="eb19" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">提供给<code class="fe me mf mg mh b">groupby()</code>的参数指定了我们想要分组的内容。您可以通过<code class="fe me mf mg mh b"><a class="ae lh" href="https://xarray.pydata.org/en/stable/generated/xarray.core.accessor_dt.DatetimeAccessor.html" rel="noopener ugc nofollow" target="_blank">.dt</a></code> <a class="ae lh" href="https://xarray.pydata.org/en/stable/generated/xarray.core.accessor_dt.DatetimeAccessor.html" rel="noopener ugc nofollow" target="_blank">访问器</a>获取月份，这就是我们在本例中所做的。</p><p id="ebe9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">计算月距平时，我们先按月分组，然后减去气候学。例如，从一月组的每个成员中减去一月气候学，然后每隔一个月重复一次。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="ab3a" class="na mn it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">2.缩减采样:月平均值</h1><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><ul class=""><li id="2b87" class="oq or it lk b ll lm lo lp lr os lv ot lz ou md ov ow ox oy bi translated"><strong class="lk jd">下采样</strong>:降低样本的频率。例如，从每日时间序列变为每月时间序列</li></ul><p id="28d5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了用<code class="fe me mf mg mh b">xarray</code>实现这一点，我们使用<code class="fe me mf mg mh b"><a class="ae lh" href="https://xarray.pydata.org/en/stable/generated/xarray.Dataset.resample.html" rel="noopener ugc nofollow" target="_blank">.resample()</a></code>。所提供的参数指定了时间维度(如<code class="fe me mf mg mh b">time</code>)和重采样频率(如每月)。在上面的示例中，采样频率字符串<code class="fe me mf mg mh b">'1MS’</code>表示每月采样一次，新的时间向量以月初为中心(<em class="ol"> 2000年1月1日</em>、<em class="ol"> 2000年2月1日</em>等)。).</p><p id="10d3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">采样频率(如<code class="fe me mf mg mh b">‘1MS’</code>)指定如何对数据进行重新采样。其他选项见<a class="ae lh" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases" rel="noopener ugc nofollow" target="_blank"> Pandas文档</a>中的偏移别名。</p><p id="3054" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了计算月平均值，你必须附上<code class="fe me mf mg mh b">.mean()</code>。移除此方法将返回DatasetResample对象。请务必说明您想对样本做什么。</p><h2 id="b23c" class="mm mn it bd nb ny nz dn nf oa ob dp nj lr oc od nl lv oe of nn lz og oh np iz bi translated"><strong class="ak"> 2.1月最大值、最小值、中位数等。</strong></h2><p id="7eba" class="pw-post-body-paragraph li lj it lk b ll nr kd ln lo ns kg lq lr nt lt lu lv nu lx ly lz nv mb mc md im bi translated">还有一套其他方法可以和<code class="fe me mf mg mh b">resample()</code>一起使用，包括:<code class="fe me mf mg mh b">max</code>、<code class="fe me mf mg mh b">min</code>、<code class="fe me mf mg mh b">median</code>、<code class="fe me mf mg mh b">std</code>、<code class="fe me mf mg mh b">var</code>、<code class="fe me mf mg mh b">quantile</code>、<code class="fe me mf mg mh b">sum</code></p><p id="0158" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">查看<a class="ae lh" href="https://xarray.pydata.org/en/stable/generated/xarray.Dataset.resample.html" rel="noopener ugc nofollow" target="_blank">重采样文档</a>了解更多细节</p><h2 id="4043" class="mm mn it bd nb ny nz dn nf oa ob dp nj lr oc od nl lv oe of nn lz og oh np iz bi translated">2.2 N月平均值</h2><p id="c7f3" class="pw-post-body-paragraph li lj it lk b ll nr kd ln lo ns kg lq lr nt lt lu lv nu lx ly lz nv mb mc md im bi translated">如果你想每两个月平均一次，而不是每月平均一次，会怎么样？在这种情况下，您只需在采样频率字符串中提供采样的月数:</p><ul class=""><li id="03e5" class="oq or it lk b ll lm lo lp lr os lv ot lz ou md ov ow ox oy bi translated"><strong class="lk jd">月平均</strong>:<code class="fe me mf mg mh b">‘1MS’</code>(1可选)</li><li id="9ab3" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated"><strong class="lk jd">两个月平均值</strong> : <code class="fe me mf mg mh b">‘2MS’</code></li><li id="aba9" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi">…</li><li id="29e4" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated"><strong class="lk jd"> 15个月平均值</strong> : <code class="fe me mf mg mh b">‘15MS’</code>(我不知道你为什么会想这么做，但你可以)</li></ul></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="3865" class="na mn it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">3.上采样:每日插值</h1><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><ul class=""><li id="6223" class="oq or it lk b ll lm lo lp lr os lv ot lz ou md ov ow ox oy bi translated"><strong class="lk jd">上采样</strong>:增加采样频率。例如，从每月时间序列变为每天时间序列</li></ul><p id="0df2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是一个使用线性插值将数据从月分辨率提升到日分辨率的示例。换句话说，将“低”时间分辨率(例如每月)转换成“高”分辨率(例如每天)。所提供的参数指定了时间维度(例如<code class="fe me mf mg mh b">time</code>)和重采样频率(例如每天)。在上面的例子中，采样频率字符串<code class="fe me mf mg mh b">'1D’</code>表示每天采样。</p><p id="e7ff" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后我们附加<code class="fe me mf mg mh b">.interpolate(“linear”)</code>在点之间进行线性插值。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="c729" class="na mn it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">4.加权平均值</h1><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><ul class=""><li id="e289" class="oq or it lk b ll lm lo lp lr os lv ot lz ou md ov ow ox oy bi translated"><strong class="lk jd">加权平均值</strong>:根据重要性缩放的值的平均值。计算方式为权重之和乘以值除以权重之和。</li></ul><p id="bf5e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对地理空间数据进行平均时，对数据进行加权通常很重要，这样小区域就不会扭曲结果。例如，如果您的数据位于一个统一的经纬度网格上，那么两极附近的数据比低纬度地区占用的面积要小。如果你计算全球的平均温度，那么北极的权重应该小于热带，因为它占据的面积更小。</p><p id="ef23" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这个例子中，我做了一个普通的方法，用纬度的余弦来加权。这个例子来自于<a class="ae lh" href="https://xarray.pydata.org/en/stable/examples/area_weighted_temperature.html" rel="noopener ugc nofollow" target="_blank"> xarray网页</a>。</p><p id="a2e7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当用<code class="fe me mf mg mh b">xarray</code>计算加权平均值时，注意<code class="fe me mf mg mh b">ds.weighted(weights)</code>是“加权类”的一个实例除了加权平均值，我们还可以计算加权标准差、加权和等。见选项<a class="ae lh" href="https://xarray.pydata.org/en/stable/generated/xarray.core.weighted.DatasetWeighted.html" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><p id="e57a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">另一种方法是按网格单元面积加权，见下面的帖子</p><div class="pe pf gp gr pg ph"><a rel="noopener follow" target="_blank" href="/the-correct-way-to-average-the-globe-92ceecd172b7"><div class="pi ab fo"><div class="pj ab pk cl cj pl"><h2 class="bd jd gy z fp pm fr fs pn fu fw jc bi translated">平均全球的正确方法</h2><div class="po l"><h3 class="bd b gy z fp pm fr fs pn fu fw dk translated">为什么对数据进行面积加权很重要</h3></div><div class="pp l"><p class="bd b dl z fp pm fr fs pn fu fw dk translated">towardsdatascience.com</p></div></div><div class="pq l"><div class="pr l ps pt pu pq pv lb ph"/></div></div></a></div></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="544f" class="na mn it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">5.移动平均数</h1><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><ul class=""><li id="ccce" class="oq or it lk b ll lm lo lp lr os lv ot lz ou md ov ow ox oy bi translated"><strong class="lk jd">移动平均:</strong>通过在特定间隔内平均来平滑数据的技术。间隔由特定数量的数据点定义，称为<em class="ol">窗口长度</em>。</li></ul><p id="d181" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">滚动平均/运行平均/移动平均是一种平滑短期波动以提高信噪比的技术。您使用<code class="fe me mf mg mh b"><a class="ae lh" href="https://xarray.pydata.org/en/stable/generated/xarray.Dataset.rolling.html" rel="noopener ugc nofollow" target="_blank">.rolling()</a></code>方法，并向其提供应用平均值和窗口长度的尺寸。</p><p id="7841" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在上面的例子中，我对气温教程数据集应用了30天的运行平均值。由于数据每天采样4次，因此每30天有120个样本。</p><p id="d257" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你可以提供给<code class="fe me mf mg mh b">rolling()</code>的一个可选参数是<code class="fe me mf mg mh b">center=True</code>，这将把标签设置在窗口的中心而不是开始。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="88e6" class="na mn it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">6.总体均值</h1><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><ul class=""><li id="9daa" class="oq or it lk b ll lm lo lp lr os lv ot lz ou md ov ow ox oy bi translated"><strong class="lk jd">总体平均</strong>:对同一数量的多个估计值进行平均。例如，CMIP模型的集合是集合的一个例子。</li></ul><p id="5277" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您有一个包含多个相关变量的数据集，您可以在一个新的维度上连接它们，然后执行统计。</p><p id="12ec" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我之前写过这个主题，描述了用<code class="fe me mf mg mh b">xarray</code>实现这一点的不同技术。我现在更喜欢上面的代码。</p><div class="pe pf gp gr pg ph"><a rel="noopener follow" target="_blank" href="/pythonic-way-to-perform-statistics-across-multiple-variables-with-xarray-d0221c78e34a"><div class="pi ab fo"><div class="pj ab pk cl cj pl"><h2 class="bd jd gy z fp pm fr fs pn fu fw jc bi translated">使用Xarray跨多个变量执行统计的Pythonic方式</h2><div class="po l"><h3 class="bd b gy z fp pm fr fs pn fu fw dk translated">首先在数据集中创建一个分类维度</h3></div><div class="pp l"><p class="bd b dl z fp pm fr fs pn fu fw dk translated">towardsdatascience.com</p></div></div><div class="pq l"><div class="pw l ps pt pu pq pv lb ph"/></div></div></a></div></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="3b71" class="na mn it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">7.分配新变量或坐标</h1><p id="d9a9" class="pw-post-body-paragraph li lj it lk b ll nr kd ln lo ns kg lq lr nt lt lu lv nu lx ly lz nv mb mc md im bi translated"><code class="fe me mf mg mh b">Xarray</code>提供了三种“赋值”方法:</p><ul class=""><li id="b782" class="oq or it lk b ll lm lo lp lr os lv ot lz ou md ov ow ox oy bi translated"><code class="fe me mf mg mh b"><a class="ae lh" href="https://xarray.pydata.org/en/stable/generated/xarray.Dataset.assign.html" rel="noopener ugc nofollow" target="_blank">.assign()</a></code> →将新的数据变量分配给数据集</li><li id="8407" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated"><code class="fe me mf mg mh b"><a class="ae lh" href="https://xarray.pydata.org/en/stable/generated/xarray.Dataset.assign_coords.html" rel="noopener ugc nofollow" target="_blank">.assign_coords()</a></code> →给数据集分配新坐标</li><li id="e871" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated"><code class="fe me mf mg mh b"><a class="ae lh" href="https://xarray.pydata.org/en/stable/generated/xarray.Dataset.assign_attrs.html" rel="noopener ugc nofollow" target="_blank">.assign_attrs()</a></code> →给数据集分配新属性</li></ul><h2 id="2360" class="mm mn it bd nb ny nz dn nf oa ob dp nj lr oc od nl lv oe of nn lz og oh np iz bi translated">7.1分配新变量</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="3076" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要向数据集添加新变量，可以使用<code class="fe me mf mg mh b">.assign()</code>。请记住，<code class="fe me mf mg mh b">xarray</code>没有<code class="fe me mf mg mh b">‘inplace’</code>选项，您总是需要显式地将对象赋给一个变量。</p><p id="5bf5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本例中，我将单位从摄氏度改为开尔文，并将其赋给一个名为<code class="fe me mf mg mh b">temp_k</code>的变量。单位很重要，还记得<a class="ae lh" href="https://solarsystem.nasa.gov/missions/mars-climate-orbiter/in-depth/" rel="noopener ugc nofollow" target="_blank">火星气候轨道器</a>事件吗？</p><p id="4d03" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">第二行是可选的，只是向新变量添加属性。</p><h2 id="4417" class="mm mn it bd nb ny nz dn nf oa ob dp nj lr oc od nl lv oe of nn lz og oh np iz bi translated">7.1改变时间坐标</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="ef95" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是一个改变时间坐标的例子。当您希望时间坐标从每月的15号而不是1号开始时，这很有用。</p><h2 id="6c13" class="mm mn it bd nb ny nz dn nf oa ob dp nj lr oc od nl lv oe of nn lz og oh np iz bi translated">7.2改变经度坐标</h2><p id="f2ed" class="pw-post-body-paragraph li lj it lk b ll nr kd ln lo ns kg lq lr nt lt lu lv nu lx ly lz nv mb mc md im bi translated">经度有两种约定</p><ul class=""><li id="18f4" class="oq or it lk b ll lm lo lp lr os lv ot lz ou md ov ow ox oy bi translated"><strong class="lk jd">【360°约定】</strong>:0°到360°，本初子午线为0°，数值向东递增</li><li id="1301" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated"><strong class="lk jd">【180°约定】</strong> : -180W到180E，以本初子午线的零点为中心</li></ul><blockquote class="oi oj ok"><p id="ea74" class="li lj ol lk b ll lm kd ln lo lp kg lq om ls lt lu on lw lx ly oo ma mb mc md im bi translated">我编造了大会的名字。如果有合适的名字，请告诉我</p></blockquote><p id="3571" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">从180°变为360°</strong></p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="2468" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">从360°变为180°</strong></p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="c73d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">或者，您可以使用列表理解来使其更加直观。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="7044" class="na mn it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">8.选择一个特定位置</h1><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="5e52" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用<code class="fe me mf mg mh b">sel()</code>选择特定的纬度/经度位置。默认情况下，<code class="fe me mf mg mh b"> sel()</code>在数据集中查找精确匹配，但是提供<code class="fe me mf mg mh b">method=’nearest’</code>告诉<code class="fe me mf mg mh b">xarray</code>查找与您的选择最接近的匹配。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="3108" class="na mn it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">9.填写缺失的值</h1><p id="d67b" class="pw-post-body-paragraph li lj it lk b ll nr kd ln lo ns kg lq lr nt lt lu lv nu lx ly lz nv mb mc md im bi translated">通常情况下，您的数据会缺少需要填充的值。</p><p id="d823" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">不幸的是，这个问题没有“一刀切”的解决方案</p><p id="b4af" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">常用方法:</strong></p><ul class=""><li id="23d3" class="oq or it lk b ll lm lo lp lr os lv ot lz ou md ov ow ox oy bi translated">用某个值填充缺失的值</li><li id="acd9" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">用气候学填补缺失值</li><li id="0af3" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">在点之间插值</li><li id="6c40" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated">传播价值观</li></ul><h2 id="a0d9" class="mm mn it bd nb ny nz dn nf oa ob dp nj lr oc od nl lv oe of nn lz og oh np iz bi translated">9.1用值填充NaN</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="cf71" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用<code class="fe me mf mg mh b">fillna()</code>方法是替换缺失值的一种简单方法。在上面的例子中，我使用0作为填充值，但这可以是任何值，选择取决于具体情况。</p><h2 id="d007" class="mm mn it bd nb ny nz dn nf oa ob dp nj lr oc od nl lv oe of nn lz og oh np iz bi translated">9.2替换为气候学</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="2907" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要替换为气候值，首先必须通过<code class="fe me mf mg mh b">grouby()</code>将数据分组，然后使用随气候值一起提供的<code class="fe me mf mg mh b">fillna()</code>。</p><h2 id="9608" class="mm mn it bd nb ny nz dn nf oa ob dp nj lr oc od nl lv oe of nn lz og oh np iz bi translated">9.3点之间的插值</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="6fe0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">另一种方法是使用<code class="fe me mf mg mh b"><a class="ae lh" href="https://xarray.pydata.org/en/stable/generated/xarray.Dataset.interpolate_na.html" rel="noopener ugc nofollow" target="_blank">interpolate_na()</a></code>对缺失值进行插值。这是时间上的线性插值。</p><blockquote class="oi oj ok"><p id="b272" class="li lj ol lk b ll lm kd ln lo lp kg lq om ls lt lu on lw lx ly oo ma mb mc md im bi translated">参见<code class="fe me mf mg mh b"><a class="ae lh" href="https://xarray.pydata.org/en/stable/generated/xarray.Dataset.interpolate_na.html" rel="noopener ugc nofollow" target="_blank"><strong class="lk jd">interpolate_na()</strong></a></code> <a class="ae lh" href="https://xarray.pydata.org/en/stable/generated/xarray.Dataset.interpolate_na.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd">文档</strong> </a>获取完整的interp方法列表。</p></blockquote><h2 id="2521" class="mm mn it bd nb ny nz dn nf oa ob dp nj lr oc od nl lv oe of nn lz og oh np iz bi translated">9.4向前/向后填充</h2><pre class="ks kt ku kv gt mi mh mj mk aw ml bi"><span id="a0d2" class="mm mn it mh b gy mo mp l mq mr">ds.ffill('time')<br/>ds.bfill('time')</span></pre><ul class=""><li id="e1c5" class="oq or it lk b ll lm lo lp lr os lv ot lz ou md ov ow ox oy bi translated"><a class="ae lh" href="https://xarray.pydata.org/en/stable/generated/xarray.Dataset.ffill.html" rel="noopener ugc nofollow" target="_blank">向前填充</a> → <code class="fe me mf mg mh b">ffill()</code>向前传播数值</li><li id="86fd" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md ov ow ox oy bi translated"><a class="ae lh" href="https://xarray.pydata.org/en/stable/generated/xarray.Dataset.bfill.html" rel="noopener ugc nofollow" target="_blank">向后填充</a> → <code class="fe me mf mg mh b">bfill()</code>向后传播数值</li></ul><p id="5f11" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这些方法用第一个非NaN值填充NaN值，沿着提供的维度，<code class="fe me mf mg mh b">ffill()</code>向前填充，<code class="fe me mf mg mh b">bfill()</code>向后填充。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="7a5f" class="na mn it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">10.过滤数据</h1><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="3bb7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">基于条件表达式选择数据。只有表达式计算结果为True的数据才会被保留，其他数据都不会被保留。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="bbe5" class="na mn it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">11.分离数据</h1><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="051e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">基于条件表达式屏蔽数据。如果提供的条件为真，掩码值将为真，否则为假。这可以通过简单地乘以1变成1和0的掩码。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="7d35" class="na mn it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">12.最后的想法</h1><p id="df7e" class="pw-post-body-paragraph li lj it lk b ll nr kd ln lo ns kg lq lr nt lt lu lv nu lx ly lz nv mb mc md im bi translated">我希望这篇文章对你的工作有所帮助，并展示了<code class="fe me mf mg mh b">xarray</code>的威力。请记住，这篇文章仅仅提供了一个人的观点。对于其中一些问题，可能有更有效或更直观的解决方案。因此，我强烈鼓励反馈和评论</p><p id="1ae5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我在这篇文章中没有提到的一个常见任务是重新划分数据。我鼓励你去看看令人惊叹的xESMF包。</p><p id="dcd6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，这篇文章中的例子可以用于其他目的。例如，计算气候学实际上是一个<a class="ae lh" href="https://xarray.pydata.org/en/stable/user-guide/groupby.html#groupby" rel="noopener ugc nofollow" target="_blank">分割-应用-组合策略</a>的应用。</p><h2 id="a90b" class="mm mn it bd nb ny nz dn nf oa ob dp nj lr oc od nl lv oe of nn lz og oh np iz bi translated">12.1拆分-应用-合并</h2><ol class=""><li id="c5f1" class="oq or it lk b ll nr lo ns lr px lv py lz pz md qa ow ox oy bi translated"><strong class="lk jd">将</strong>数据分成组，</li><li id="0c61" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md qa ow ox oy bi translated"><strong class="lk jd">对每组应用</strong>一个函数</li><li id="0129" class="oq or it lk b ll oz lo pa lr pb lv pc lz pd md qa ow ox oy bi translated">将所有的组重新组合在一起。</li></ol><p id="45b4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当计算气候学时，“应用”步骤是平均的。但是，这可以换成:<code class="fe me mf mg mh b">max</code>、<code class="fe me mf mg mh b">min</code>、<code class="fe me mf mg mh b">median</code>、<code class="fe me mf mg mh b">std</code>、<code class="fe me mf mg mh b">var</code>、<code class="fe me mf mg mh b">quantile</code>或<code class="fe me mf mg mh b">sum</code>。使用<code class="fe me mf mg mh b">map()</code>甚至可以提供一个自定义方法。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><p id="3d9a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="ol">感谢阅读和支持媒体作者</em></p></div></div>    
</body>
</html>