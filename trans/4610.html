<html>
<head>
<title>The Ultimate Beginner’s Guide to Geospatial Raster Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">地理空间栅格数据入门指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-ultimate-beginners-guide-to-geospatial-raster-data-feb7673f6db0#2022-10-13">https://towardsdatascience.com/the-ultimate-beginners-guide-to-geospatial-raster-data-feb7673f6db0#2022-10-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="343d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于栅格文件、地理配准、元数据和栅格Python库，您需要了解的一切</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9453f27080305d04c9534c073a0c890a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FUghFy8jINnE2zZV"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">丹尼尔·科鲁奇在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="650e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大多数航空照片和卫星图像都是光栅文件。<br/>这种格式常用来表示现实世界的现象。如果您正在处理地理数据，那么您很有可能必须处理它。</p><p id="814d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要在Python中使用地理栅格文件，需要不同的理论概念。在进入编程部分之前，我强烈建议您阅读介绍性部分。</p><h2 id="430b" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">目录</h2><ol class=""><li id="9a02" class="mo mp it lb b lc mq lf mr li ms lm mt lq mu lu mv mw mx my bi translated">简介:<em class="mz">第一概念。</em></li><li id="d39f" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu mv mw mx my bi translated">应用:<em class="mz">栅格用在哪里？</em></li><li id="363c" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu mv mw mx my bi translated">色彩映射表:<em class="mz">离散和连续色彩映射表，用于可视化栅格。</em></li><li id="0dee" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu mv mw mx my bi translated">地理参考:<em class="mz"> CRS和仿射变换。</em></li><li id="f9dc" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu mv mw mx my bi translated">栅格的元数据:<em class="mz">与栅格相关的所有数据。</em></li><li id="32ba" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu mv mw mx my bi translated">Rasterio: <em class="mz">在Python中读取、保存、地理配准和可视化栅格文件。</em></li></ol></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="4d02" class="nm lw it bd lx nn no np ma nq nr ns md jz nt ka mg kc nu kd mj kf nv kg mm nw bi translated">介绍</h1><blockquote class="nx"><p id="acb2" class="ny nz it bd oa ob oc od oe of og lu dk translated">栅格由按行和列组织的像元(或像素)矩阵组成，其中每个像元包含一个表示信息的值</p></blockquote><figure class="oi oj ok ol om kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/d1c1de68181f3a194d557f8e2b637beb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ljV2PPLAN3NIR0NLWR8Lrw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">光栅结构。图片由作者提供。</p></figure><p id="b594" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">地理栅格中的每个像素都与特定的地理位置相关联。这意味着如果栅格的分辨率为1 <em class="mz"> m/px </em>，<em class="mz"> </em>每个像素覆盖1m的区域。有关这方面的更多详细信息，请参见地理配准部分。</p><p id="f356" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，</p><blockquote class="nx"><p id="d6b9" class="ny nz it bd oa ob oc od oe of og lu dk translated">栅格包含一个或多个大小相同的图层，称为波段</p></blockquote><figure class="oi oj ok ol om kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/7737087a94df032d74d3169a78842b91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*inyh6IzY8AVghlNt8Zu98Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">三波段栅格。图片由作者提供。</p></figure><p id="448b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">任何类型的数值都可能存储在一个单元格中。根据上下文，单元格可能包含不同范围内的整数或浮点值。</p><p id="760d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">jpg、png和位图都是光栅文件，但是本指南不考虑它们，因为它们是非地理文件。地理栅格通常以TIFF格式保存。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="a2b8" class="nm lw it bd lx nn no np ma nq nr ns md jz nt ka mg kc nu kd mj kf nv kg mm nw bi translated">应用程序</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/da5a72d21b76f1e75239ea84861c58f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mcoAE4fBPdPZbUo_"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@nasa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> NASA </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="278d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于栅格的应用方式多种多样，以下是最常见的应用:</p><ul class=""><li id="fd5b" class="mo mp it lb b lc ld lf lg li oo lm op lq oq lu or mw mx my bi translated">卫星图像</li><li id="7d0f" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu or mw mx my bi translated">专题地图</li><li id="26a4" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu or mw mx my bi translated">数字高程模型(DEM)</li></ul><h2 id="fe42" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">卫星图像</h2><p id="d66f" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li os lk ll lm ot lo lp lq ou ls lt lu im bi translated">来自卫星的影像通常保存在多波段栅格中。电磁波谱被分成多个部分，可以被卫星探测到。并不是所有的都属于可见光谱，但通常有些是在红外波段，人眼是看不见的。</p><p id="c4fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">栅格文件非常适合这种类型的影像，因为卫星感测到的每个电磁波谱部分都可以存储在波段中。</p><p id="eed9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Sentinel-2是最受欢迎的卫星之一，它使用13个光谱带拍摄照片，一部分来自可见光谱，另一部分来自红外光谱。因此，每个输出文件都是一个包含13个波段的栅格(其中3个波段为红色、绿色和蓝色)。</p><p id="7c56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是从Sentinel-2拍摄的照片(仅显示RGB波段):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/e2db5ad8c39ee25baec5bc99c4e1dcc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oRDpTa8dYqEsYbUxAsRGPw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">明斯克市(白俄罗斯)，哨兵-2卫星图像。<a class="ae ky" href="https://commons.wikimedia.org/wiki/File:Minsk_city_(Belarus),_Sentinel-2_satellite_image,_2019-05-19.jpg" rel="noopener ugc nofollow" target="_blank">包含修改后的哥白尼哨兵数据2019 </a>，<a class="ae ky" href="https://creativecommons.org/licenses/by-sa/3.0/igo/deed.en" rel="noopener ugc nofollow" target="_blank"> CC BY-SA 3.0 IGO </a>，via Wikimedia Commons。</p></figure><h2 id="07d3" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">专题地图</h2><p id="3eca" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li os lk ll lm ot lo lp lq ou ls lt lu im bi translated">专题地图用于对地理区域进行分类。每个区域都与共享某些特征的特定类别相关联。例如，我们可以根据种植园的类型对农业区进行分类。栅格非常适合此任务，因为每个像元都可以存储表示像素关联区域所属类的整数值。</p><p id="d039" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是意大利伦巴第大区的专题地图示例。根据类别，每个像素存储0到6之间的值:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/58d901afc40c3ef812b07ebad02f9919.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BJcuNYp9CHXS5nZZiWSJNg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">伦巴第(意大利)，专题地图。图像来自<a class="ae ky" href="https://www.kaggle.com/datasets/ignazio/sentinel2-crop-mapping" rel="noopener ugc nofollow" target="_blank"> Sentinel-2图像时间序列，用于作物制图</a>。</p></figure><h2 id="8090" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">数字高程模型(DEM)</h2><p id="8604" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li os lk ll lm ot lo lp lq ou ls lt lu im bi translated">数字高程模型用于表示地表起伏。DEM是一种栅格，其像素包含浮点值:表面的高程值。</p><p id="37e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里显示的是火星表面区域的DEM:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/a3e1fbd6ca55231eb6a92595e0f4b21a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9pS9Wbk0TNaMDbcFg02Xxw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">火星表面的一个陨石坑。图片来自<a class="ae ky" href="https://www.uahirise.org/dtm/ESP_019147_2395" rel="noopener ugc nofollow" target="_blank"> UAHiRISE </a>(已编辑)。</p></figure><p id="351c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使第一个文件可视化，只显示了可见的波段，但是第二个和第三个文件不能直接可视化，因为保存在每个单元格中的值不是一种颜色，而是一条信息。</p><p id="1cb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一节中，将重点介绍可视化这种栅格文件所需的解决方法。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="f6fa" class="nm lw it bd lx nn no np ma nq nr ns md jz nt ka mg kc nu kd mj kf nv kg mm nw bi translated">彩色地图</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/44a1d6a38f9f7e6663c5de53e8af481f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HW_LG4Oj8rasJjuo"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">亚历山大·格雷在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="6b8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于栅格对可存储的数值类型和范围没有限制，因此并不总是能够直观地显示它们。例如，我上面显示的最后一幅图像是两个单波段光栅:在前者中，每个像素是一个介于0和6之间的整数，而在后者中，是一个介于<em class="mz"> -4611 </em>和- <em class="mz"> 3871 </em>之间的浮点数。他们的信息不代表一种颜色<em class="mz">。</em></p><p id="9f4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了直观显示这些类型的栅格，我们使用色彩映射表，即</p><blockquote class="nx"><p id="7667" class="ny nz it bd oa ob oc od oe of og lu dk translated">将单元格值映射到颜色的函数</p></blockquote><p id="41a0" class="pw-post-body-paragraph kz la it lb b lc oz ju le lf pa jx lh li pb lk ll lm pc lo lp lq pd ls lt lu im bi translated">因此，当通过色彩映射表可视化栅格时，其值将被颜色替换。</p><p id="7449" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">彩色地图主要有两种类型:<strong class="lb iu">连续</strong>和<strong class="lb iu">非连续</strong>。</p><h2 id="7688" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">非连续彩色地图</h2><p id="4fb3" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li os lk ll lm ot lo lp lq ou ls lt lu im bi translated">它们是通过使用<em class="mz">值-颜色</em>对定义分段函数来实现的。</p><p id="7650" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在专题地图示例中，我定义了7个值-颜色对:&lt;0, black&gt;、&lt;1, red&gt;、&lt;3, orange&gt;、&lt;4, yellow&gt;、&lt;5, blue&gt;、&lt;6, gray&gt;、&lt;2, green&gt;。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/b767dcbb9a4a4b1d6ce251ec12ce4e3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DhmyWQadYahkOZpmKxS-Qw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">不连续的色彩映射表。图片由作者提供。</p></figure><p id="4118" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当栅格包含一小组值时，通常使用这种方法。</p><h2 id="f0a1" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">连续彩色地图</h2><p id="a095" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li os lk ll lm ot lo lp lq ou ls lt lu im bi translated">它们是通过使用连续函数将栅格值的间隔与颜色的间隔相关联而得到的。</p><p id="0d48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，在应用此类色彩映射表之前，会使用以下公式在范围[0，1]内缩放所有栅格值:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/9d6d57370ca32d4ebf4003588d9a2c08.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/1*FVagmYGjNBMQMhNIRvURSA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">最小-最大比例公式。使用<a class="ae ky" href="https://www.codecogs.com/latex/eqneditor.php" rel="noopener ugc nofollow" target="_blank">编码生成的图像</a>。</p></figure><p id="1909" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在灰度色图中，使用线性函数将[0，1]范围内的值与[0，255]范围内的灰度值相关联:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/04a8f3a021e5864b1f4353ca05ddc3fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*1u2m5d9SUY3iG4CZR9Hiaw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">灰度色图。图片由作者提供。</p></figure><p id="55bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">彩条以适当的方式显示结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/73e0fbecf0b90a0411a9e4ba29828bf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*87UFMMwQrKmlemGYPQVHbg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">灰度色图。图片由作者提供。</p></figure><p id="7527" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，0值用黑色表示，1值用白色表示，它们之间的所有值用不同形状的灰色表示。</p><p id="217f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了更好地可视化栅格，我们还可以定义一个RGB色彩映射表，其中每个栅格值都与一个红色、绿色和蓝色值相关联。</p><p id="4b21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是文献中称为Turbo的流行色彩映射表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/dc71ee9890680368809f9bf9aeb8a5c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*0OiTYE_KwhcnDvKSoAuXGA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Turbo色彩映射表。图片由作者和查表从<a class="ae ky" href="https://gist.github.com/mikhailov-work/ee72ba4191942acecc03fe6da94fc73f" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></figure><p id="568c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该色图以蓝色阴影开始表示最低值，以红色阴影结束表示最高值:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/ec2f795ea8c3b70ef9ed175504e330cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*YbSxKsZjs886BSWP73CXsQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Turbo色彩映射表。图片由作者提供。</p></figure><p id="0821" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在DEM示例中，我使用这种颜色图将高程信息转换成颜色。这是将一系列值映射到颜色时使用的颜色映射表(而不是像非连续颜色映射表中的小集合)。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="bf64" class="nm lw it bd lx nn no np ma nq nr ns md jz nt ka mg kc nu kd mj kf nv kg mm nw bi translated">地理参考</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/640b45cf40dc1be729171dcd0e0e1572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*04t08cE0ZBbxIZiG"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@geojango_maps?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> GeoJango Maps </a>拍摄</p></figure><p id="b36b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">地理栅格中的每个像元覆盖一个特定的地理区域，其坐标(由行和列表示)可以转换为现实世界的地理坐标。翻译过程使用两个组件:T4坐标参考系统(CRS)T5和仿射变换T7。</p><p id="eafe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在继续之前，重要的是要知道地球的形状是通过一个几何图形来近似的，称为<strong class="lb iu">旋转椭球</strong>或<strong class="lb iu">椭球</strong>。由于这个数字是一个近似值，多年来已经使用不同大小的轴定义了多个球状体。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/39f0937378e842b97a5c9c68d24c4839.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hbLcdJUh0F3zklb7ehRKFA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">球体。<a class="ae ky" href="https://commons.wikimedia.org/wiki/File:Ellipsoide.svg" rel="noopener ugc nofollow" target="_blank"> Ag2gaeh </a>，<a class="ae ky" href="https://creativecommons.org/licenses/by-sa/4.0" rel="noopener ugc nofollow" target="_blank"> CC BY-SA 4.0 </a>，via Wikimedia Commons(已编辑)。</p></figure><h2 id="c038" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">坐标参考系统</h2><blockquote class="nx"><p id="3d1c" class="ny nz it bd oa ob oc od oe of og lu dk translated">CRS是一种用于精确测量地球表面坐标位置的框架</p></blockquote><p id="dc48" class="pw-post-body-paragraph kz la it lb b lc oz ju le lf pa jx lh li pb lk ll lm pc lo lp lq pd ls lt lu im bi translated">每个CRS都基于特定的椭球体，因此，如果两个CRS使用不同的椭球体，则相同的坐标表示两个不同的位置。</p><p id="a6cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CRS可以分为:</p><ul class=""><li id="94e2" class="mo mp it lb b lc ld lf lg li oo lm op lq oq lu or mw mx my bi translated"><strong class="lb iu">地理坐标系，</strong>利用角度单位(度)。角距离从定义的原点开始测量。</li><li id="4d19" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu or mw mx my bi translated"><strong class="lb iu">基于地理坐标系的投影坐标系</strong>。它使用空间投影来投影椭球体，空间投影是一组用于将3D数据展平到2D平面上的数学计算。它使用线性单位(英尺、米等)。)来测量该位置距离平面原点的距离(在两个轴上)。</li></ul><p id="f1e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最流行的地理坐标系之一是<strong class="lb iu"> WGS84 </strong>、<strong class="lb iu">T3【也称<a class="ae ky" href="https://epsg.io/4326" rel="noopener ugc nofollow" target="_blank"> EPSG:4326 </a>。它基于一个椭球体，其半短轴(称为赤道半径)等于6378137米，半长轴(称为极地半径)等于6356752米。WGS84使用<strong class="lb iu">纬度</strong>来找出一个地方距离赤道多远，使用<strong class="lb iu">经度</strong>来找出一个地方距离本初子午线多远。两者都以度为单位。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pk"><img src="../Images/9050fcffe1b792b57b86048b36af6f4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8F4ccflJmQvHnNuPcjUxYw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">地球的纬度和经度。Djexplo ，CC0，通过维基共享。</p></figure><p id="5424" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如<em class="mz">40° 43 ' 50.1960 ' ' N，73° 56 ' 6.8712 ' ' W</em>是使用经纬度的纽约市位置。</p><p id="bead" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">而最流行的投影坐标系之一是<strong class="lb iu"> UTM </strong> / <strong class="lb iu"> WGS84 </strong>，也称为<a class="ae ky" href="https://epsg.io/32632" rel="noopener ugc nofollow" target="_blank"> EPSG:32632 </a>。它将WGS84球体投影到一个平面上，然后使用(x，y)以米为单位定义坐标。</p><p id="2ca8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">栅格文件中使用的CRS取决于多种因素，例如数据的采集时间、数据的地理范围和数据的用途。请记住，您可以将CRS的坐标转换为另一个坐标。也有用于地球外表面地理参考的CRS，如月球和火星。</p><h2 id="6653" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">仿射变换</h2><p id="3d6b" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li os lk ll lm ot lo lp lq ou ls lt lu im bi translated">地理配准栅格使用仿射变换从影像坐标映射到真实坐标(采用CRS定义的格式)。</p><blockquote class="nx"><p id="f8bb" class="ny nz it bd oa ob oc od oe of og lu dk translated">仿射变换用于将像素位置映射到所选的CRS坐标中</p></blockquote><p id="80e3" class="pw-post-body-paragraph kz la it lb b lc oz ju le lf pa jx lh li pb lk ll lm pc lo lp lq pd ls lt lu im bi translated">仿射变换是保持共线性(如果三个或三个以上的点都位于同一条直线上，则称它们共线)和直线上各点之间的距离比的任何变换。</p><p id="6b02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些都是仿射变换:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/dcaaa85646cf48460f2a67149c938fba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PlJFp8TWt3EhEfZAlHMetw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">仿射变换。图片由作者提供。</p></figure><p id="1b02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在地理配准中，大多数情况下，只需要进行缩放和平移变换。将它们与正确的系数一起应用，可以将栅格像元坐标转换为真实坐标。读取地理栅格时，这些系数已经在元数据中定义。</p><p id="181f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用于转换的关系是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/1bda59b24912a9d395777067a0746454.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/format:webp/1*rO9WpKcbs-dYeFLn2XguhA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">光栅坐标和CRS坐标之间的关系。使用<a class="ae ky" href="https://www.codecogs.com/latex/eqneditor.php" rel="noopener ugc nofollow" target="_blank">编码</a>生成的图像。</p></figure><p id="ad5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果<strong class="lb iu"> scale_x </strong>和<strong class="lb iu"> scale_y </strong>是CRS单位(度、米、英尺等)中的<strong class="lb iu"> pixel_width </strong>和<strong class="lb iu"> pixel_height </strong>。)，<strong class="lb iu"> r </strong>是图像在现实世界中的<strong class="lb iu">旋转</strong>，<strong class="lb iu"> x_origin </strong>和<strong class="lb iu"> y_origin </strong>是光栅左上角像素的<strong class="lb iu">坐标</strong>，参数为:</p><ul class=""><li id="5e03" class="mo mp it lb b lc ld lf lg li oo lm op lq oq lu or mw mx my bi translated">a = scale _ x cos(r)</li><li id="00a5" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu or mw mx my bi translated">b = scale _ y sin(r)</li><li id="15fc" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu or mw mx my bi translated">c = x _ origin∙cos(r)+y _ origin∙sin(r)</li><li id="8e9d" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu or mw mx my bi translated">d = scale _ x sin(r)</li><li id="06fb" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu or mw mx my bi translated">e = scale _ y cos(r)</li><li id="15c1" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu or mw mx my bi translated">f = x _ origin∙sin(r)+y _ origin∙cos(r)</li></ul><p id="5588" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请记住，根据所使用的CRS，scale_x、scale_y、x_origin和y_origin中的一个或多个可以是负值。</p><p id="fce4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于大多数图像都是<strong class="lb iu">朝北</strong>，因此<strong class="lb iu"> r = 0 </strong>，参数可以简化为:</p><ul class=""><li id="65ef" class="mo mp it lb b lc ld lf lg li oo lm op lq oq lu or mw mx my bi translated">A =标度x</li><li id="f033" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu or mw mx my bi translated">B = 0</li><li id="cb3e" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu or mw mx my bi translated">C = x _原点</li><li id="18dc" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu or mw mx my bi translated">E =比例y</li><li id="9734" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu or mw mx my bi translated">D = 0</li><li id="518f" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu or mw mx my bi translated">F = y _原点</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/dcc5e0d98ca7ab3bf9f0a882c2b87a0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gQmvuERXi7uk94Z3m71P1Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">地理参考示例。图片由作者提供。</p></figure><p id="00ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">a和E定义缩放比例，而C和F定义从原点的平移。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="e19f" class="nm lw it bd lx nn no np ma nq nr ns md jz nt ka mg kc nu kd mj kf nv kg mm nw bi translated">[计]元数据</h1><p id="e08c" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li os lk ll lm ot lo lp lq ou ls lt lu im bi translated">每个地理栅格都有关联的元数据。以下是最重要的字段:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi po"><img src="../Images/f597d8a1588518fa928a338dbb589088.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NnycP5uavexDzaqvv0-fTA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">元数据字段。图片由作者提供。</p></figure><h2 id="5106" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">深部热疗</h2><p id="fdbb" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li os lk ll lm ot lo lp lq ou ls lt lu im bi translated">此字段存储坐标参考系统的信息，例如名称、测量单位、椭球体轴和原点坐标。</p><h2 id="dcf4" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">转变</h2><p id="84d8" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li os lk ll lm ot lo lp lq ou ls lt lu im bi translated">它存储用于将光栅像素坐标映射到CRS坐标的系数A、B、C、D、E、F。</p><h2 id="76e9" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">数据类型</h2><p id="2d60" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li os lk ll lm ot lo lp lq ou ls lt lu im bi translated">通常被称为<em class="mz">数据类型</em>。它定义了存储在栅格中的数据类型，如Float32、Float64、Int32等。</p><h2 id="fc93" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">NoData值</h2><p id="1edb" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li os lk ll lm ot lo lp lq ou ls lt lu im bi translated">栅格的每个像元都必须包含一个值，并且栅格不支持空值。如果生成栅格的源无法为某些像元提供值，则使用nodata值填充这些像元。如果nodata值设置为0，这意味着当读取0时，它不是一个要考虑的值，因为它表明源不能提供正确的值。通常，栅格数据类型为Float32，将nodata值设置为<strong class="lb iu">≈</strong>-3.4028235 10 ⁸.</p><h2 id="0fb8" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">宽度、高度和带数</h2><p id="9ffd" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li os lk ll lm ot lo lp lq ou ls lt lu im bi translated">它们分别是每个波段的宽度、每个波段的高度和栅格的波段数。</p><h2 id="c3f8" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">驾驶员</h2><p id="2b7f" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li os lk ll lm ot lo lp lq ou ls lt lu im bi translated">驱动程序为光栅文件提供了更多功能。大多数情况下，地理栅格使用GTiff驱动程序，该驱动程序允许将地理配准信息集成到文件中。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="8842" class="nm lw it bd lx nn no np ma nq nr ns md jz nt ka mg kc nu kd mj kf nv kg mm nw bi translated">拉斯特里奥</h1><p id="02c5" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li os lk ll lm ot lo lp lq ou ls lt lu im bi translated">第一个用于访问地理栅格文件的库是<a class="ae ky" href="http://GT(1) × GT(5)  = 10m × 10m" rel="noopener ugc nofollow" target="_blank">地理空间数据抽象库，GDAL </a>。它最初是用C开发的，后来扩展到Python。这样，Python版本只提供了对C版本的少量抽象。基于GDAL的Rasterio 试图通过提供一个更简单、更高级的接口来解决这个问题。</p><p id="2a5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要从PyPI安装最新版本的Rasterio，请使用:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="9ab1" class="pu lw it pq b be pv pw l px py">pip install rasterio</span></pre><p id="0cf2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些是必需的导入:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="3933" class="pu lw it pq b be pv pw l px py">import rasterio<br/>from rasterio.crs import CRS<br/>from rasterio.enums import Resampling<br/>from matplotlib import pyplot as plt<br/>from mpl_toolkits.axes_grid1 import make_axes_locatable<br/>import numpy as np<br/>from pprint import pprint</span></pre><h2 id="d7c8" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">读取栅格</h2><p id="f9ec" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li os lk ll lm ot lo lp lq ou ls lt lu im bi translated">要打开光栅文件，请使用:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="efbb" class="pu lw it pq b be pv pw l px py">raster = rasterio.open('raster.tiff')</span></pre><p id="647b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要打印波段数，请使用:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="7da5" class="pu lw it pq b be pv pw l px py">print(raster.count)</span></pre><p id="f281" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要将所有栅格作为NumPy数组读取，请使用:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="e0a0" class="pu lw it pq b be pv pw l px py">raster_array = raster.read()  # shape = (n_bands x H x W)</span></pre><p id="5d67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，要仅读取特定波段，请使用:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="225c" class="pu lw it pq b be pv pw l px py">first_band = raster.read(1)  # shape = (H x W)</span></pre><p id="6c0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请记住，波段索引从1开始。</p><p id="ce01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要读取与栅格相关联的所有元数据，请使用:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="0942" class="pu lw it pq b be pv pw l px py">metadata = dataset.meta<br/>pprint(metadata)</span></pre><p id="9feb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="2768" class="pu lw it pq b be pv pw l px py">{'count': 1,<br/> 'crs': CRS.from_epsg(32632),<br/> 'driver': 'GTiff',<br/> 'dtype': 'uint8',<br/> 'height': 2496,<br/> 'nodata': 255.0,<br/> 'transform': Affine(10.0, 0.0, 604410.0,<br/>       0.0, -10.0, 5016150.0),<br/> 'width': 3072}</span></pre><p id="0834" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">读取栅格时，可能没有数据值，建议用NaN值替换它们。为此，请使用:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="c408" class="pu lw it pq b be pv pw l px py">first_band[first_band == metadata['nodata']] = np.nan</span></pre><p id="e70b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要按给定因子调整栅格的大小，首先定义输出形状:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="2713" class="pu lw it pq b be pv pw l px py">out_shape = (raster.count, int(raster.height * 1.5), int(raster.width * 1.5))</span></pre><p id="7ce7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后使用:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="c315" class="pu lw it pq b be pv pw l px py">scaled_raster = raster.read(out_shape=out_shape,<br/>                resampling=Resampling.bilinear)</span></pre><p id="6931" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mz">请记住，缩放栅格后，仿射变换的A和F系数必须更改为新的像素分辨率，否则，地理配准将给出错误的坐标。</em></p><h2 id="7421" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">形象化</h2><p id="706b" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li os lk ll lm ot lo lp lq ou ls lt lu im bi translated">要使用色彩映射表和色彩条显示栅格波段，请使用:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="a10f" class="pu lw it pq b be pv pw l px py">fig, ax = plt.subplots()<br/>im = ax.imshow(raster.read(1), cmap='viridis')<br/>divider = make_axes_locatable(ax)<br/>cax = divider.append_axes('right', size='5%', pad=0.10)<br/>fig.colorbar(im, cax=cax, orientation='vertical')<br/>plt.savefig('cmap_viz')</span></pre><p id="69c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pz"><img src="../Images/d5bd8f6c5d5b8fa31ab6e849018a5186.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*AgBWmE8s0GXY-aoSr2TMRg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">光栅可视化示例。图片由作者提供。</p></figure><p id="a7a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于多波段卫星栅格，要显示前3个可见波段，请使用:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="4579" class="pu lw it pq b be pv pw l px py">rgb_bands = raster.read()[:3]  # shape = (3, H, W)<br/>plt.imshow(rgb_bands)</span></pre><p id="9567" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，卫星影像在前三个波段存储RGB。如果不是这种情况，则必须根据波段的顺序来改变索引。</p><h2 id="9bfe" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">地理参考</h2><p id="2c12" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li os lk ll lm ot lo lp lq ou ls lt lu im bi translated"><em class="mz">通过以下方法获得的坐标将被返回，并且必须使用当前的CRS单位提供。</em></p><p id="d6e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要查找像素(I，j)的实际坐标，其中I是行，j是列，请使用:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="e5ba" class="pu lw it pq b be pv pw l px py">x, y = raster.xy(i, j)</span></pre><p id="4908" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">做相反的用法:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="1895" class="pu lw it pq b be pv pw l px py">i, j = raster.index(x, y)</span></pre><p id="6f22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要显示数据的界限:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="9f11" class="pu lw it pq b be pv pw l px py">print(raster.bounds)</span></pre><p id="d57c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="1561" class="pu lw it pq b be pv pw l px py">BoundingBox(left=604410.0, bottom=4991190.0, right=635130.0, top=5016150.0)</span></pre><p id="0ab4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本例中的栅格是使用ESPG:32632作为CRS进行地理配准的，因此输出坐标以米为单位。</p><h2 id="f5dd" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">保存栅格</h2><p id="70e0" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li os lk ll lm ot lo lp lq ou ls lt lu im bi translated">步骤1 —找到所需CRS的<a class="ae ky" href="https://epsg.io/" rel="noopener ugc nofollow" target="_blank"> EPSG </a>代码，然后检索其信息:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="95af" class="pu lw it pq b be pv pw l px py">crs = CRS.from_epsg(32632)</span></pre><p id="1b55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在此示例中，使用了EPSG:32632，这在本指南的第四部分中有所提及。</p><p id="127e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">步骤2-定义仿射变换:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="1392" class="pu lw it pq b be pv pw l px py">transformation = Affine(10.0, 0.0, 604410.0, 0.0, -10.0, 5016150.0)</span></pre><p id="6c26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">系数A、B、C、D、E、F的用途已在本指南的第四部分进行了解释。</p><p id="001c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">步骤3-保存栅格:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="1bc6" class="pu lw it pq b be pv pw l px py"># a NumPy array representing a 13-band raster<br/>array = np.random.rand(13,3000,2000)<br/>with rasterio.open(<br/>    'output.tiff',<br/>    'w',<br/>    driver='GTiff',<br/>    count=array.shape[0],  # number of bands<br/>    height=array.shape[1],<br/>    width=array.shape[2],<br/>    dtype=array.dtype,<br/>    crs=crs,<br/>    transform=transform<br/>) as dst:<br/>    dst.write(array)</span></pre><p id="f812" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果不需要地理参考，设置<code class="fe qa qb qc pq b">crs = None</code>和<code class="fe qa qb qc pq b">transform = None</code>。</p><p id="ff15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">write方法还有另一种语法:</p><pre class="kj kk kl km gt pp pq pr bn ps pt bi"><span id="59d7" class="pu lw it pq b be pv pw l px py">dst.write(array_1, 1)<br/># ...<br/>dst.write(array_13, 13)</span></pre><p id="a7f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是在大多数情况下，编写一个单独的3d数组更容易。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="bdc5" class="nm lw it bd lx nn no np ma nq nr ns md jz nt ka mg kc nu kd mj kf nv kg mm nw bi translated">结论</h1><p id="2eb6" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li os lk ll lm ot lo lp lq ou ls lt lu im bi translated">本指南展示了在栅格(由一个或多个相同大小的矩阵组成的集合，称为波段)中，每个像元包含一条信息。这些信息根据任务而变化，例如卫星图像、专题地图和数字高程模型。此外，根据应用程序的不同，您可能需要色彩映射表来将其可视化。此外，您发现使用坐标参考系统和仿射变换，可以将每个细胞位置映射到真实世界的坐标。最后，您会看到Rasterio使读取、写入、可视化和地理参考操作变得非常容易。如果您需要一个程序来打开栅格，<a class="ae ky" href="https://www.qgis.org/" rel="noopener ugc nofollow" target="_blank"> QGIS </a>和<a class="ae ky" href="https://www.esri.com/en-us/arcgis/products/arcgis-desktop/overview" rel="noopener ugc nofollow" target="_blank"> ArcGIS </a>是不错的选择。</p><h2 id="59b2" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated"><strong class="ak">附加资源</strong></h2><ul class=""><li id="96d0" class="mo mp it lb b lc mq lf mr li ms lm mt lq mu lu or mw mx my bi translated"><a class="ae ky" href="https://docs.qgis.org/3.22/en/docs/gentle_gis_introduction/coordinate_reference_systems.html" rel="noopener ugc nofollow" target="_blank">坐标参考系统</a></li><li id="ed58" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu or mw mx my bi translated"><a class="ae ky" href="https://desktop.arcgis.com/en/arcmap/10.3/guide-books/map-projections/what-are-map-projections.htm" rel="noopener ugc nofollow" target="_blank">地图投影</a></li><li id="c479" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu or mw mx my bi translated"><a class="ae ky" href="https://github.com/rasterio/affine" rel="noopener ugc nofollow" target="_blank">仿射变换库</a></li><li id="99d3" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu or mw mx my bi translated"><a class="ae ky" href="https://rasterio.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank"> Rasterio官方文件</a></li></ul><p id="f5eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读，我希望你发现这是有用的。</p></div></div>    
</body>
</html>