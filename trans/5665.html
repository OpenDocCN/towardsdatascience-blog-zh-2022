<html>
<head>
<title>Automate Streamlit Web App using Interactive AgGrid with Google Sheets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用交互式 AgGrid 和 Google Sheets 自动化 Streamlit Web 应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automate-streamlit-web-app-using-interactive-aggrid-with-google-sheets-81b93fd9e648#2022-12-22">https://towardsdatascience.com/automate-streamlit-web-app-using-interactive-aggrid-with-google-sheets-81b93fd9e648#2022-12-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d89a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><em class="kf">可定制的</em> AgGrid 数据表连接到谷歌工作表数据库</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/7f952204784640a3d0b45f0a549bb63b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-FZ1CmtXHCWjjng7"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">这幅图像旨在展示 Streamlit、Google Sheet 和 AgGrid table 之间微妙的抽象联系，由互联的电话描绘，允许数据在它们之间无缝流动。照片由<a class="ae kw" href="https://unsplash.com/@ptrikutam?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">帕万·特里库塔姆</a>在<a class="ae kw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h2 id="b285" class="kx ky iq bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated"><strong class="ak">TL；博士</strong></h2><ul class=""><li id="f95f" class="lt lu iq lv b lw lx ly lz lg ma lk mb lo mc md me mf mg mh bi translated">这篇博客文章演示了如何在 Streamlit 应用程序中使用 AgGrid 库来创建交互式数据表。</li><li id="f17a" class="lt lu iq lv b lw mi ly mj lg mk lk ml lo mm md me mf mg mh bi translated">它展示了如何将表连接到 Google Sheets 数据库，并将数据从表发送到数据库。</li><li id="d8fd" class="lt lu iq lv b lw mi ly mj lg mk lk ml lo mm md me mf mg mh bi translated">此外，还实现了 JavaScript 回调，用于向 AgGrid 表添加行。</li></ul><h1 id="dcae" class="mn ky iq bd kz mo mp mq lc mr ms mt lf jw mu jx lj jz mv ka ln kc mw kd lr mx bi translated">1.介绍</h1><p id="b111" class="pw-post-body-paragraph my mz iq lv b lw lx jr na ly lz ju nb lg nc nd ne lk nf ng nh lo ni nj nk md ij bi nl translated">treamlit 是一个流行的开源框架，用于构建数据科学和机器学习应用。它允许开发人员使用简单的 Python 代码创建交互式的、基于 web 的应用程序。然而，Streamlit 中内置的数据表组件功能有限，并不总是适合更高级的用例。这就是 AgGrid 库的用武之地。AgGrid 是一个强大的 JavaScript 库，可以用来创建交互式数据网格和表格。</p><p id="0a19" class="pw-post-body-paragraph my mz iq lv b lw nu jr na ly nv ju nb lg nw nd ne lk nx ng nh lo ny nj nk md ij bi translated">在 Streamlit 应用程序中实现 AgGrid 对于数据科学家和机器学习工程师来说特别有用，他们希望构建用户友好的应用程序，允许用户查看、操作和分析数据。AgGrid 提供了多种功能，如过滤、排序和聚合，可以帮助用户更好地理解和处理大型数据集。它还支持多种数据类型，包括数字、字符串和日期，并且可以根据应用程序的需要进行定制。</p><p id="92b5" class="pw-post-body-paragraph my mz iq lv b lw nu jr na ly nv ju nb lg nw nd ne lk nx ng nh lo ny nj nk md ij bi translated">在这篇博文中，我们将演示如何在 Streamlit 应用程序中使用 AgGrid，并将其连接到 Google Sheets 数据库。我们将向您展示如何创建一个可定制的数据表，将数据从表发送到数据库，以及使用 JavaScript 函数向表中添加行。</p><h1 id="5619" class="mn ky iq bd kz mo mp mq lc mr ms mt lf jw mu jx lj jz mv ka ln kc mw kd lr mx bi translated">2.先决条件</h1><p id="9ff7" class="pw-post-body-paragraph my mz iq lv b lw lx jr na ly lz ju nb lg nc nd ne lk nf ng nh lo ni nj nk md ij bi translated">要阅读这篇博文，您需要安装以下库:</p><ul class=""><li id="92be" class="lt lu iq lv b lw nu ly nv lg nz lk oa lo ob md me mf mg mh bi translated"><code class="fe oc od oe of b">streamlit</code>:这是主要的 Streamlit 库，用于在 Python 中构建交互式数据应用。要安装它，您可以使用下面的命令:<code class="fe oc od oe of b">pip install streamlit</code></li><li id="ae95" class="lt lu iq lv b lw mi ly mj lg mk lk ml lo mm md me mf mg mh bi translated"><code class="fe oc od oe of b">pandas</code>:这个库用于 Python 中的数据操作和分析。在我们的用例中，它用于读/写数据和创建数据帧。DataFrame 是一种表格数据结构，可用于存储和操作数据。要安装它，您可以使用下面的命令:<code class="fe oc od oe of b">pip install pandas</code></li><li id="bc55" class="lt lu iq lv b lw mi ly mj lg mk lk ml lo mm md me mf mg mh bi translated"><code class="fe oc od oe of b">streamlit-aggrid</code>:这是一个 Streamlit 扩展或包装器，提供与 AgGrid 库的集成。它用于创建和自定义数据表。要安装它，您可以使用下面的命令:<code class="fe oc od oe of b">pip install streamlit-aggrid</code></li><li id="8f93" class="lt lu iq lv b lw mi ly mj lg mk lk ml lo mm md me mf mg mh bi translated"><code class="fe oc od oe of b">gspread</code>:这是一个用于与 Google Sheets 交互的 Python 库。它用于连接 Google Sheets 数据库。要安装它，您可以使用下面的命令:<code class="fe oc od oe of b">pip install gspread</code></li><li id="4deb" class="lt lu iq lv b lw mi ly mj lg mk lk ml lo mm md me mf mg mh bi translated"><code class="fe oc od oe of b">google-auth</code>和<code class="fe oc od oe of b">google-auth-oauthlib</code>:这些库用于谷歌服务的认证。它们是<code class="fe oc od oe of b">gspread</code>库工作所必需的。要安装它们，您可以使用下面的命令:<code class="fe oc od oe of b">pip install google-auth google-auth-oauthlib</code></li></ul><p id="efc6" class="pw-post-body-paragraph my mz iq lv b lw nu jr na ly nv ju nb lg nw nd ne lk nx ng nh lo ny nj nk md ij bi translated">或者，您可以从终端使用以下命令一起安装这些库，</p><pre class="kh ki kj kk gt og of oh bn oi oj bi"><span id="6e25" class="ok ky iq of b be ol om l on oo"># Installation of the dependencies <br/>pip install streamlit pandas streamlit-aggrid gspread</span></pre><h1 id="8d68" class="mn ky iq bd kz mo mp mq lc mr ms mt lf jw mu jx lj jz mv ka ln kc mw kd lr mx bi translated">3.设置简单的 AgGrid 表</h1><p id="0a0d" class="pw-post-body-paragraph my mz iq lv b lw lx jr na ly lz ju nb lg nc nd ne lk nf ng nh lo ni nj nk md ij bi translated">一旦我们安装了依赖项，我们就可以开始创建一个虚拟数据帧，用于填充 AgGrid 表。我们将首先导入必要的库并创建一个示例数据框架，</p><pre class="kh ki kj kk gt og of oh bn oi oj bi"><span id="db6b" class="ok ky iq of b be ol om l on oo"># Importing the dependencies<br/><br/>import streamlit as st <br/>import pandas as pd<br/>from st_aggrid import AgGrid, JsCode<br/>from st_aggrid.grid_options_builder import GridOptionsBuilder</span></pre><pre class="op og of oh bn oi oj bi"><span id="37fc" class="ok ky iq of b be ol om l on oo"># Creates a Streamlit header and an Expander <br/># to provide some context for the app.<br/><br/>st.header("AgGrid Demo `Part 3`")<br/>with st.expander('🤩 What I plan to demonstrate today ? ', expanded=False):<br/>    st.markdown('''<br/>                <br/>                ◻ 1. Implementing `button` within AgGrid table<br/>                <br/>                ◻ 2. Display any `update` made from the user-end<br/>                <br/>                ◻ 3. `Download` the AgGrid table<br/>                <br/>                ◻ 4. `Connect` to Database<br/>                ''')<br/><br/># Create an AgGrid table from a pandas DataFrame<br/>d = {‘Type’:[‘Notebook’, ‘DVDs’] ,’Quantity’: [1, 2],’Price’: [400, 200]}<br/>df = pd.DataFrame(data = d)</span></pre><p id="71c0" class="pw-post-body-paragraph my mz iq lv b lw nu jr na ly nv ju nb lg nw nd ne lk nx ng nh lo ny nj nk md ij bi translated">现在我们有了一个示例数据帧，我们可以使用<code class="fe oc od oe of b">AgGrid</code>函数在 Streamlit 中将它显示为一个 AgGrid 表:</p><pre class="kh ki kj kk gt og of oh bn oi oj bi"><span id="d8c0" class="ok ky iq of b be ol om l on oo"># Display the Dataframe in AgGrid<br/>AgGrid(df)</span></pre><p id="9438" class="pw-post-body-paragraph my mz iq lv b lw nu jr na ly nv ju nb lg nw nd ne lk nx ng nh lo ny nj nk md ij bi translated">这将为我们提供一个包含虚拟数据的基本 AgGrid 表，但是它的交互性不是很好。为了使我们的 AgGrid 表更具交互性，我们可以使用 JavaScript 添加一些特性，比如单元格渲染器和单元格上的点击事件。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi oq"><img src="../Images/ef1d5d5afc4b06287c7661e000817786.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KCESkcu4G_MMX7YWfYGiyA.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">来自演示 Streamlit 应用程序的屏幕截图，展示了(上)AgGrid 表(下)默认 Streamlit-data frame-按作者分类的图像之间的差异</p></figure><h1 id="a290" class="mn ky iq bd kz mo mp mq lc mr ms mt lf jw mu jx lj jz mv ka ln kc mw kd lr mx bi translated">4.实现一个允许向 AgGrid 表中添加新行的按钮</h1><p id="01c4" class="pw-post-body-paragraph my mz iq lv b lw lx jr na ly lz ju nb lg nc nd ne lk nf ng nh lo ni nj nk md ij bi translated">要向 AgGrid 表添加按钮，我们需要使用 JavaScript 创建一个自定义单元格渲染器。单元格渲染器是一个返回要在单元格中显示的 HTML 元素的函数。</p><p id="50e3" class="pw-post-body-paragraph my mz iq lv b lw nu jr na ly nv ju nb lg nw nd ne lk nx ng nh lo ny nj nk md ij bi translated">我们将首先创建一个 JavaScript 函数，当单击按钮时，该函数向 AgGrid 表添加一个新行。为此，我们将使用 AgGrid API 提供的<code class="fe oc od oe of b">applyTransaction</code>方法。这个方法允许我们通过应用一个事务对网格进行修改。在这种情况下，我们使用<code class="fe oc od oe of b">add</code>事务向表中由<code class="fe oc od oe of b">rowIndex</code>指定的索引处添加一个新的空行。</p><pre class="kh ki kj kk gt og of oh bn oi oj bi"><span id="6f85" class="ok ky iq of b be ol om l on oo"># JavaScript function to add a new row to the AgGrid table<br/>js_add_row = JsCode ('''<br/>function(e) {<br/> let api = e.api;<br/> let rowPos = e.rowIndex + 1; <br/> api.applyTransaction({addIndex: rowPos, add: [{}]}) <br/>};<br/>'''<br/>)</span></pre><p id="9075" class="pw-post-body-paragraph my mz iq lv b lw nu jr na ly nv ju nb lg nw nd ne lk nx ng nh lo ny nj nk md ij bi translated">接下来，我们将定义一个单元格呈现器，它将在<code class="fe oc od oe of b">'🔧'</code> AgGrid 列的每个单元格中呈现一个按钮。单元格渲染器是一个定义如何渲染单元格的类。在本例中，我们使用 HTML <code class="fe oc od oe of b">button</code>元素来呈现按钮。该按钮将有一个<code class="fe oc od oe of b">onclick</code>事件，当点击时调用<code class="fe oc od oe of b">js_add_row</code>函数。我们还在按钮上应用了一些基本的 CSS 样式，使它看起来更有吸引力。</p><pre class="kh ki kj kk gt og of oh bn oi oj bi"><span id="27ce" class="ok ky iq of b be ol om l on oo"># Cell renderer for the '🔧' column to render a button<br/>cellRenderer_addButton = JsCode('''<br/>    class BtnCellRenderer {<br/>        init(params) {<br/>            this.params = params;<br/>            this.eGui = document.createElement('div');<br/>            this.eGui.innerHTML = `<br/>            &lt;span&gt;<br/>                &lt;style&gt;<br/>                .btn_add {<br/>                    background-color: #71DC87;<br/>                    border: 2px solid black;<br/>                    color: #D05732;<br/>                    text-align: center;<br/>                    display: inline-block;<br/>                    font-size: 12px;<br/>                    font-weight: bold;<br/>                    height: 2em;<br/>                    width: 10em;<br/>                    border-radius: 12px;<br/>                    padding: 0px;<br/>                }<br/>                &lt;/style&gt;<br/>                &lt;button id='click-button' <br/>                    class="btn_add" <br/>                    &gt;&amp;#x2193; Add&lt;/button&gt;<br/>            &lt;/span&gt;<br/>        `;<br/>        }<br/>        getGui() {<br/>            return this.eGui;<br/>        }<br/>    };<br/>    ''')</span></pre><h1 id="70b6" class="mn ky iq bd kz mo mp mq lc mr ms mt lf jw mu jx lj jz mv ka ln kc mw kd lr mx bi translated">5.用按钮功能可视化 AgGrid</h1><p id="30cf" class="pw-post-body-paragraph my mz iq lv b lw lx jr na ly lz ju nb lg nc nd ne lk nf ng nh lo ni nj nk md ij bi translated">现在我们已经定义了 JavaScript 函数，我们可以创建一个 AgGrid 表并配置它来显示我们的按钮。为此，我们将首先使用<code class="fe oc od oe of b">from_dataframe</code>方法从我们的熊猫数据帧中创建一个<code class="fe oc od oe of b">GridOptionsBuilder</code>对象。这将根据 DataFrame 中的数据为我们的 AgGrid 表创建一个默认配置。</p><p id="07bb" class="pw-post-body-paragraph my mz iq lv b lw nu jr na ly nv ju nb lg nw nd ne lk nx ng nh lo ny nj nk md ij bi translated">接下来，我们将使用<code class="fe oc od oe of b">configure_column</code>方法指定字段名为<code class="fe oc od oe of b">'🔧'</code>的列应该使用我们的<code class="fe oc od oe of b">cellRenderer_addButton</code>单元格渲染器，我们还将指定<code class="fe oc od oe of b">onCellClicked</code>事件应该触发我们的<code class="fe oc od oe of b">js_add_row</code> JavaScript 函数。</p><pre class="kh ki kj kk gt og of oh bn oi oj bi"><span id="0e82" class="ok ky iq of b be ol om l on oo"># Create a GridOptionsBuilder object from our DataFrame<br/>gd = GridOptionsBuilder.from_dataframe(df)<br/><br/># Configure the default column to be editable<br/># sets the editable option to True for all columns<br/>gd.configure_default_column(editable=True)<br/><br/># Configure the '🔧' column to use our the cell renderer <br/># and onCellClicked function<br/>gd.configure_column( field = '🔧', <br/>                     onCellClicked = js_add_row,<br/>                     cellRenderer = cellRenderer_addButton,<br/>                     lockPosition='left')<br/>                    )<br/>gridoptions = gd.build()</span></pre><p id="423e" class="pw-post-body-paragraph my mz iq lv b lw nu jr na ly nv ju nb lg nw nd ne lk nx ng nh lo ny nj nk md ij bi translated">最后，我们可以使用<code class="fe oc od oe of b">AgGrid</code>函数并传入<code class="fe oc od oe of b">GridOptionsBuilder</code>对象来创建我们的 AgGrid 表。注意，为了从用户界面的角度简化，我们使用<code class="fe oc od oe of b">st.form()</code>布局在 Streamlit 前端创建一个表单。该表单有一个标题，上面写着“库存清单”🔖和一个标记为“确认项目”的提交按钮🔒".<code class="fe oc od oe of b">AgGrid</code>函数中使用的参数在代码块中被很好地注释了。</p><pre class="kh ki kj kk gt og of oh bn oi oj bi"><span id="9c21" class="ok ky iq of b be ol om l on oo"># AgGrid Table with Button Feature<br/># Streamlit Form helps from rerunning on every widget-click<br/># Also helps in providing layout<br/><br/>with st.form('Inventory') as f:<br/>    st.header('Inventory List 🔖')<br/>    <br/># Inside the form, we are displaying an AgGrid table using the AgGrid function. <br/># The allow_unsafe_jscode parameter is set to True, <br/># which allows us to use JavaScript code in the AgGrid configuration<br/># The theme parameter is set to 'balham', <br/># which applies the Balham theme to the table<br/># The height parameter is set to 200, <br/># which specifies the height of the table in pixels.<br/># The fit_columns_on_grid_load parameter is set to True, <br/># which ensures that the columns of the table are resized to fit <br/># the width of the table when it is first displayed<br/><br/>    response = AgGrid(df,<br/>                    gridOptions = gridoptions, <br/>                    editable=True,<br/>                    allow_unsafe_jscode = True, <br/>                    theme = 'balham',<br/>                    height = 200,<br/>                    fit_columns_on_grid_load = True)<br/>    st.write(" *Note: Don't forget to hit enter ↩ on new entry.*")<br/>    st.form_submit_button("Confirm item(s) 🔒", type="primary")<br/></span></pre><p id="1f6c" class="pw-post-body-paragraph my mz iq lv b lw nu jr na ly nv ju nb lg nw nd ne lk nx ng nh lo ny nj nk md ij bi translated">就是这样！现在您应该有一个工作的 AgGrid 表，在<code class="fe oc od oe of b">'🔧'</code>列的每个单元格中有一个按钮，单击该按钮时会向表中添加一个新行。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi or"><img src="../Images/18d3597dedd79183578ea31c41e16890.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EcFW1cXZwQoEQ2_PmgadMg.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">应用程序的屏幕截图，显示 AgGrid 表中呈现的“添加按钮”——图片由作者提供</p></figure><h1 id="ab64" class="mn ky iq bd kz mo mp mq lc mr ms mt lf jw mu jx lj jz mv ka ln kc mw kd lr mx bi translated">6.以表格或图的形式获取 AgGrid 数据</h1><p id="8c0c" class="pw-post-body-paragraph my mz iq lv b lw lx jr na ly lz ju nb lg nc nd ne lk nf ng nh lo ni nj nk md ij bi translated">表格中的数据很容易获取。每当前端用户确认 AgGrid 表中的任何更改并触发<code class="fe oc od oe of b">st.form_submit_button()</code>时，<code class="fe oc od oe of b">st.table</code>函数用于以表格形式显示 AgGrid 表中的更新数据。</p><pre class="kh ki kj kk gt og of oh bn oi oj bi"><span id="0443" class="ok ky iq of b be ol om l on oo"># Visualize the AgGrid when submit button triggered           <br/>st.subheader("Updated Inventory")<br/># Fetch the data from the AgGrid Table<br/>res = response['data']<br/>st.table(res) </span></pre><p id="4244" class="pw-post-body-paragraph my mz iq lv b lw nu jr na ly nv ju nb lg nw nd ne lk nx ng nh lo ny nj nk md ij bi translated">然后我们使用<code class="fe oc od oe of b">st.bar_chart</code>函数显示来自 AgGrid 表的数据的条形图，使用<code class="fe oc od oe of b">Type</code>列作为 x 轴，使用<code class="fe oc od oe of b">Price</code>列作为 y 轴。</p><pre class="kh ki kj kk gt og of oh bn oi oj bi"><span id="ca9b" class="ok ky iq of b be ol om l on oo"># Plotting the data<br/>st.subheader(“Visualize Inventory”)<br/>st.bar_chart(data=res, x = ‘Type’, y = ‘Price’)</span></pre><h1 id="823a" class="mn ky iq bd kz mo mp mq lc mr ms mt lf jw mu jx lj jz mv ka ln kc mw kd lr mx bi translated">7.将 AgGrid 数据保存在本地或云中</h1><p id="eeab" class="pw-post-body-paragraph my mz iq lv b lw lx jr na ly lz ju nb lg nc nd ne lk nf ng nh lo ni nj nk md ij bi translated">为了用户界面的美观，我们使用<code class="fe oc od oe of b">st.columns</code>函数创建了两列，在第一列中，我们有一个标签，上面写着“保存在本地机器中？”。在第二列中，我们的目标是创建一个按钮，将 AgGrid 数据更新到连接的 Google Sheet。</p><p id="c098" class="pw-post-body-paragraph my mz iq lv b lw nu jr na ly nv ju nb lg nw nd ne lk nx ng nh lo ny nj nk md ij bi translated"><strong class="lv ir"> a)本地下载:</strong><code class="fe oc od oe of b">csv</code>变量设置为对 AgGrid 表中的数据调用<code class="fe oc od oe of b">convert_df</code>函数的结果。单击该按钮时，会下载名为“file.csv”的 CSV 文件。</p><pre class="kh ki kj kk gt og of oh bn oi oj bi"><span id="8d8b" class="ok ky iq of b be ol om l on oo"># Function<br/>@st.experimental_memodef <br/>convert_df(df): <br/>```Converts the data to a CSV format```<br/>  return df.to_csv(index=False).encode(‘utf-8’)<br/><br/><br/>st.subheader("Store Inventory")<br/>col1,col2 = st.columns(2)<br/># https://docs.streamlit.io/knowledge-base/using-streamlit/how-download-pandas-dataframe-csv<br/>csv = convert_df(response['data'])<br/>col1.write("Save in Local Machine?")<br/>col1.download_button(<br/>   "Press to Download 🗳️",<br/>   csv,<br/>   "file.csv",<br/>   "text/csv",<br/>   key='download-csv'<br/>)</span></pre><p id="e553" class="pw-post-body-paragraph my mz iq lv b lw nu jr na ly nv ju nb lg nw nd ne lk nx ng nh lo ny nj nk md ij bi translated"><strong class="lv ir"> b)实时更新到云端:</strong> Google Sheets 可以作为云存储解决方案，以表格格式存储和访问数据。数据可以由多个用户同时访问和修改，更改会自动保存并实时同步。</p><p id="0270" class="pw-post-body-paragraph my mz iq lv b lw nu jr na ly nv ju nb lg nw nd ne lk nx ng nh lo ny nj nk md ij bi translated"><em class="os">注意，在这一步，为了获得服务账户信息，您需要创建一个谷歌云平台(GCP)项目和一个服务账户，然后下载服务账户密钥文件。参考文献[3]对这些步骤进行了详细阐述。</em></p><p id="bdac" class="pw-post-body-paragraph my mz iq lv b lw nu jr na ly nv ju nb lg nw nd ne lk nx ng nh lo ny nj nk md ij bi translated">下面的步骤描述了所使用的代码(为了更好地理解，对代码进行了很好的注释)，</p><ul class=""><li id="6135" class="lt lu iq lv b lw nu ly nv lg nz lk oa lo ob md me mf mg mh bi translated">下面的代码首先导入<code class="fe oc od oe of b">service_account</code>模块和<code class="fe oc od oe of b">gspread</code>库。<code class="fe oc od oe of b">gspread</code>库用于从 Python 访问和修改 Google Sheets 文档。</li></ul><pre class="kh ki kj kk gt og of oh bn oi oj bi"><span id="9047" class="ok ky iq of b be ol om l on oo"># Importing the necessary Library<br/>from google.oauth2 import service_account<br/>import gspread <br/><br/>def send_to_database(res):<br/>    # Create a list of scope values to pass to the credentials object<br/>    scope = ['https://spreadsheets.google.com/feeds',<br/>            'https://www.googleapis.com/auth/drive']<br/><br/>    # Create a credentials object using the service account info and scope values<br/>    credentials = service_account.Credentials.from_service_account_info(<br/>                st.secrets["gcp_service_account"], scopes = scope)<br/>    <br/>    # Authorize the connection to Google Sheets using the credentials object<br/>    gc = gspread.authorize(credentials)<br/>    <br/>    # Open the Google Sheets document with the specified name<br/>    sh = gc.open("AgGrid-Database")<br/>    <br/>    # Access the worksheet within the document with the specified name<br/>    worksheet = sh.worksheet("Sheet1") <br/>    <br/>    # Set up a progress bar<br/>    my_bar = st.progress(0)<br/>    <br/>    # Iterate through the rows of the data frame<br/>    for ind in res.index:<br/>        # Calculate the percentage complete<br/>        percent_complete = (ind+1)/len(res) <br/>        # Update the progress bar<br/>        my_bar.progress(percent_complete)<br/>        <br/>        # Get the values in the first column of the worksheet<br/>        values_list = worksheet.col_values(1)<br/>        # Calculate the next empty row in the worksheet<br/>        length_row = len(values_list)<br/>        <br/>        # Update the cells in the worksheet with the data from the data frame<br/>        worksheet.update_cell(length_row+1, 1, res['Type'][ind])<br/>        worksheet.update_cell(length_row+1, 2, str(res['Quantity'][ind]))<br/>        worksheet.update_cell(length_row+1, 3, str(res['Price'][ind]))<br/>       <br/>    # Return a success message<br/>    return st.success("Updated to Database ", icon="✅")\<br/><br/># If the "Send to Database" button is clicked, execute the send_to_database() function<br/>col2.write("Save in Shared Cloud?")<br/>if col2.button("Send to Database"):<br/>    send_to_database(res)</span></pre><ul class=""><li id="405d" class="lt lu iq lv b lw nu ly nv lg nz lk oa lo ob md me mf mg mh bi translated">该函数首先定义一个列表<code class="fe oc od oe of b">scope</code>，指定服务帐户应该拥有的权限。在这种情况下，服务帐户被授权访问 Google Sheets API 和 Google Drive API。</li><li id="4611" class="lt lu iq lv b lw mi ly mj lg mk lk ml lo mm md me mf mg mh bi translated">接下来，我们需要检索必要的凭证来访问我们的 Google Sheets 数据库。代码使用<code class="fe oc od oe of b">Credentials.from_service_account_info()</code>方法创建一个<code class="fe oc od oe of b">Credentials</code>对象，并传递存储在<code class="fe oc od oe of b">st.secrets</code>字典中的服务帐户信息。该方法返回一个<code class="fe oc od oe of b">Credentials</code>对象，该对象可用于验证到 Google Sheets 和 Google Drive 的连接。</li><li id="aba3" class="lt lu iq lv b lw mi ly mj lg mk lk ml lo mm md me mf mg mh bi translated">然后使用<code class="fe oc od oe of b">Credentials</code>对象使用<code class="fe oc od oe of b">gspread.authorize()</code>方法来验证到 Google Sheets 的连接。<code class="fe oc od oe of b">gc.open()</code>方法用于打开名为“AgGrid-Database”的 Google Sheets 文档，而<code class="fe oc od oe of b">sh.worksheet()</code>方法用于访问名为“Sheet1”的文档中的工作表。</li><li id="b142" class="lt lu iq lv b lw mi ly mj lg mk lk ml lo mm md me mf mg mh bi translated">然后代码使用<code class="fe oc od oe of b">st.progress()</code>方法建立一个进度条。它遍历 DataFrame <code class="fe oc od oe of b">res</code>的行，对于每一行，它使用<code class="fe oc od oe of b">worksheet.col_values()</code>方法检索工作表第一列中的值。然后使用<code class="fe oc od oe of b">update_cell()</code>方法用数据框<code class="fe oc od oe of b">res</code>中的数据更新工作表中的单元格。</li><li id="ecf9" class="lt lu iq lv b lw mi ly mj lg mk lk ml lo mm md me mf mg mh bi translated">最后，当所有数据都写入工作表时，代码使用<code class="fe oc od oe of b">st.success()</code>方法返回一条成功消息。该代码还包含一个<code class="fe oc od oe of b">if</code>语句，当单击“发送到数据库”按钮时，该语句执行<code class="fe oc od oe of b">send_to_database()</code>函数。</li></ul><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ot"><img src="../Images/d92d393ef56407ba18e9fe4c7dd512b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*JN6eR25QCrwIlvXZQXPn8g.gif"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">将数据从 AgGrid 表更新到云(Google Sheets)——作者视频</p></figure></div><div class="ab cl ou ov hu ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="ij ik il im in"><h1 id="18f9" class="mn ky iq bd kz mo pb mq lc mr pc mt lf jw pd jx lj jz pe ka ln kc pf kd lr mx bi translated">8.结论</h1><p id="9cfe" class="pw-post-body-paragraph my mz iq lv b lw lx jr na ly lz ju nb lg nc nd ne lk nf ng nh lo ni nj nk md ij bi translated">总之，使用上面的代码行创建的 web 应用程序演示了 AgGrid 表中各种功能的实现，包括添加新行、显示用户所做的更新、下载表以及连接到数据库的能力。该应用程序易于使用，界面简洁，功能直观。无论你是想跟踪库存，更新待办事项列表，还是管理任何其他数据，这款网络应用都能满足你。该应用的现场演示可以在<a class="ae kw" href="https://avra-youtube-aggrid.streamlit.app/aggrid-button-app" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="e91d" class="mn ky iq bd kz mo mp mq lc mr ms mt lf jw mu jx lj jz mv ka ln kc mw kd lr mx bi translated">9.参考</h1><p id="7141" class="pw-post-body-paragraph my mz iq lv b lw lx jr na ly lz ju nb lg nc nd ne lk nf ng nh lo ni nj nk md ij bi translated">[1] A.Gadhir，<a class="ae kw" href="https://blog.ag-grid.com/cell-renderers-in-ag-grid-every-different-flavour/" rel="noopener ugc nofollow" target="_blank">如何在 AG 网格单元格中添加按钮</a>，(2020)</p><p id="1f00" class="pw-post-body-paragraph my mz iq lv b lw nu jr na ly nv ju nb lg nw nd ne lk nx ng nh lo ny nj nk md ij bi translated">[2] <a class="ae kw" href="https://www.w3schools.com/css/css3_buttons.asp" rel="noopener ugc nofollow" target="_blank"> CSS 按钮—基本按钮样式</a>，W3CSS</p><p id="811a" class="pw-post-body-paragraph my mz iq lv b lw nu jr na ly nv ju nb lg nw nd ne lk nx ng nh lo ny nj nk md ij bi translated">[3] <a class="ae kw" href="https://docs.streamlit.io/knowledge-base/tutorials/databases/private-gsheet" rel="noopener ugc nofollow" target="_blank">将 Streamlit 连接到一个私有的 Google 工作表</a>，Streamlit (2021)</p><p id="ff96" class="pw-post-body-paragraph my mz iq lv b lw nu jr na ly nv ju nb lg nw nd ne lk nx ng nh lo ny nj nk md ij bi translated">[4] P.Fonseca，<a class="ae kw" href="https://github.com/PablocFonseca/streamlit-aggrid" rel="noopener ugc nofollow" target="_blank"> streamlit-aggrid Python 包</a>，(2020)</p><h1 id="d6eb" class="mn ky iq bd kz mo mp mq lc mr ms mt lf jw mu jx lj jz mv ka ln kc mw kd lr mx bi translated">10.代码</h1><p id="93fe" class="pw-post-body-paragraph my mz iq lv b lw lx jr na ly lz ju nb lg nc nd ne lk nf ng nh lo ni nj nk md ij bi translated">这里是完整的代码，快速开始，玩得开心！</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="pg ph l"/></div></figure><p id="3a19" class="pw-post-body-paragraph my mz iq lv b lw nu jr na ly nv ju nb lg nw nd ne lk nx ng nh lo ny nj nk md ij bi translated">请随意写下您的反馈。Tada！</p></div></div>    
</body>
</html>