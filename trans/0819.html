<html>
<head>
<title>An Introduction to Plotly for Matplotlib Users</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Matplotlib 用户的 Plotly 介绍</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/an-introduction-to-plotly-for-matplotlib-users-9f4f0d2113bc#2022-03-07">https://towardsdatascience.com/an-introduction-to-plotly-for-matplotlib-users-9f4f0d2113bc#2022-03-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="1341" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">Python 科学绘图</h2><div class=""/><div class=""><h2 id="708e" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用类似于 matplotlib 的自定义功能，轻松地将交互性构建到您的绘图中</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/5f990641f812046ff206f3e0a5df007a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Jn4wfVA0OQ3ZvRHN"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://unsplash.com/@kobuagency?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> KOBU 机构</a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="a01d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我在这个平台上写的第一批文章是一系列关于<code class="fe me mf mg mh b">matplotlib</code>的教程，这是一个令人难以置信的 Python 可视化库，我在研究生院广泛使用，可以无限定制以创建美丽的图形。作为一名数据可视化爱好者，我一直在寻找更好的方法来创建图形和信息图，随着时间的推移，我越来越多地遇到了<code class="fe me mf mg mh b">plotly</code>。<code class="fe me mf mg mh b">plotly</code>最吸引人的特点是交互性是最重要的——虽然与<code class="fe me mf mg mh b">matplotlib</code>的交互性肯定是可能的(事实上，我有<a class="ae lh" href="https://medium.com/towards-data-science/intro-to-dynamic-visualization-with-python-animations-and-interactive-plots-f72a7fb69245" rel="noopener">另一篇关于这个主题的文章</a>),来自<code class="fe me mf mg mh b">plotly</code>的数字可以直接导出到 HTML 和 Javascript，web 浏览器的自然语言，使我们的交互式可视化易于与他人共享。</p><p id="1238" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这篇文章的目的是从一个重度<code class="fe me mf mg mh b">matplotlib</code>用户的心态出发，给出在<code class="fe me mf mg mh b">plotly</code>中开始探索可视化的工具。希望在本教程结束时，你已经可以制作漂亮的交互式图表了！</p><h1 id="fa84" class="mi mj it bd mk ml mm mn mo mp mq mr ms ki mt kj mu kl mv km mw ko mx kp my mz bi translated"><strong class="ak">安装 Plotly </strong></h1><p id="d2bf" class="pw-post-body-paragraph li lj it lk b ll na kd ln lo nb kg lq lr nc lt lu lv nd lx ly lz ne mb mc md im bi translated">首先也是最重要的，我们需要确保我们已经安装了<code class="fe me mf mg mh b">plotly</code>——我们可以用<code class="fe me mf mg mh b">pip</code>非常简单地做到这一点:</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="5604" class="nj mj it mh b gy nk nl l nm nn">pip install plotly</span></pre><h1 id="3961" class="mi mj it bd mk ml mm mn mo mp mq mr ms ki mt kj mu kl mv km mw ko mx kp my mz bi translated">Plotly Express 与 Plotly Graph 对象</h1><p id="cc64" class="pw-post-body-paragraph li lj it lk b ll na kd ln lo nb kg lq lr nc lt lu lv nd lx ly lz ne mb mc md im bi translated">在<code class="fe me mf mg mh b">plotly</code>中有几个开发图的接口——最简单的是使用<code class="fe me mf mg mh b">plotly.express</code>。使用<code class="fe me mf mg mh b">plotly.express</code>的好处是你可以用最少的代码行从一个数据帧到一个图表。一个例子如下:</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="ffdf" class="nj mj it mh b gy nk nl l nm nn"><strong class="mh jd"># Import plotly express<br/></strong>import plotly.express as px<br/>import pandas as pd</span><span id="f60e" class="nj mj it mh b gy no nl l nm nn"><strong class="mh jd"># Import iris dataset</strong><br/>iris = pd.read_csv("<a class="ae lh" href="https://raw.githubusercontent.com/mwaskom/seaborn-data/master/iris.csv" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/mwaskom/seaborn-data/master/iris.csv</a>")</span><span id="84b3" class="nj mj it mh b gy no nl l nm nn"><strong class="mh jd"># Plot with plotly.express</strong><br/>fig = px.scatter(iris, x="sepal_length", y="sepal_width", color="species", height=600, width=600)<br/>fig.show()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi np"><img src="../Images/466aec58686e1337bc3e9a8143a0f175.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j6S7izL47uA7O2eJvhumEQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">plotly express 的输出—由作者生成的图形</p></figure><p id="ba56" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">正如我们所看到的，<code class="fe me mf mg mh b">px.scatter()</code>可以直接接收一个数据帧，如果需要，您可以使用<code class="fe me mf mg mh b">color</code>参数来选择如何分割数据(在这种情况下，我们为<code class="fe me mf mg mh b">species</code>的每个唯一值指定不同的散点图颜色)以立即生成多系列散点图。我们只需要使用一行代码就可以做到这一点！</p><p id="7461" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">另一方面，Plotly 图形对象要求您一条一条地构建图形。不过对我来说，来自<code class="fe me mf mg mh b">matplotlib</code>，这感觉更自然，所以<strong class="lk jd">我个人喜欢用</strong> <code class="fe me mf mg mh b"><strong class="lk jd">graph_objects</strong></code> <strong class="lk jd"> API 来生成我的</strong> <code class="fe me mf mg mh b"><strong class="lk jd">plotly</strong></code> <strong class="lk jd">人物。</strong></p><p id="bd9e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe me mf mg mh b">plotly</code>中的主要构建模块与<code class="fe me mf mg mh b">matplotlib</code>中的非常相似，是一个<code class="fe me mf mg mh b">Figure()</code>。我们从创造我们的形象开始:</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="bf4b" class="nj mj it mh b gy nk nl l nm nn"><strong class="mh jd"># Import plotly graph objects<br/></strong>import plotly.graph_objects as go</span><span id="71e4" class="nj mj it mh b gy no nl l nm nn"><strong class="mh jd"># Create figure</strong><br/>fig = go.Figure()</span></pre><p id="d368" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，我们可以为数据框架中的每个物种添加踪迹。此外，我们可以使用<code class="fe me mf mg mh b">fig.update_layout()</code>固定高度和宽度(我们将在后面更详细地讨论):</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="f78b" class="nj mj it mh b gy nk nl l nm nn"><strong class="mh jd"># Add traces<br/></strong>for species, group in iris.groupby("species"):<br/>    fig.add_trace(<br/>        go.Scatter(<br/>            x=group["sepal_length"],<br/>            y=group["sepal_width"],<br/>            name=species,<br/>            mode="markers"<br/>        )<br/>    )</span><span id="c57d" class="nj mj it mh b gy no nl l nm nn">fig.update_layout(height=600, width=600)<br/>fig.show()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nq"><img src="../Images/879ac4e500afc42d6137b25ec9993154.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1sotuAMDKMh24hWZuNMnZA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">plotly 图形对象的输出—由作者生成的图形</p></figure><p id="cd78" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您会注意到的第一件事是没有轴标签或图例标题——当我们使用<code class="fe me mf mg mh b">plotly.graph_objects</code>时，因为我们没有为<code class="fe me mf mg mh b">x</code>或<code class="fe me mf mg mh b">y</code>传递列名，所以没有列名用作轴标签的默认值(同样也没有列名用作图例标题)。虽然这会导致代码稍微多一点，但我认为将轴标签保留为<code class="fe me mf mg mh b">sepal_length</code>和<code class="fe me mf mg mh b">sepal_width</code>看起来也不太好，尤其是如果这个图要出版的话。因此，无论如何您都必须进行更新，所以让我们现在就做:</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="8f1c" class="nj mj it mh b gy nk nl l nm nn">fig.update_layout(<br/>    xaxis_title_text="Sepal Length",<br/>    yaxis_title_text="Sepal Width",<br/>    legend_title_text="Species"  <br/>)</span></pre><p id="ad4b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您会注意到的另一件事是，悬停文本在<code class="fe me mf mg mh b">plotly.express</code>和<code class="fe me mf mg mh b">plotly.graph_objects</code>的结果之间是不同的，如下所示。后者只有每个分散点的(x，y)坐标，而前者有特征的标签。这是因为我们在调用<code class="fe me mf mg mh b">plotly.express</code>时传递了列名。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nr"><img src="../Images/80ae551cf8f6da0b11bcb2b5f1cda579.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WhAso6e57w5U08P5t-sQVA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">默认悬停文本的差异—由作者制作的图形</p></figure><p id="0728" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">再一次，我认为默认的悬停文本看起来仍然不太好，所以无论如何我都会重新做，所以我不介意在我们的<code class="fe me mf mg mh b">plotly.graph_objects</code>实现中添加一些额外的代码来做得更好。我们可以使用 HTML 来定义悬停工具提示的格式——我将把物种名称加粗，然后在下面的单独行中显示萼片长度和萼片宽度。要访问数据点值，我们可以使用<code class="fe me mf mg mh b">%{x}</code>和<code class="fe me mf mg mh b">%{y}</code>(因为我使用的是 f 字符串，所以我需要通过将它们加倍来避开花括号)。最后，为了删除对比色中包含物种名称的额外文本(上图中的<code class="fe me mf mg mh b">versicolor</code>，我们使用 HTML <code class="fe me mf mg mh b">&lt;extra&gt;</code>标签并将其留空。</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="96ab" class="nj mj it mh b gy nk nl l nm nn"><strong class="mh jd"># Add traces<br/></strong>for species, group in iris.groupby("species"):<br/>    fig.add_trace(<br/>        go.Scatter(<br/>            x=group["sepal_length"],<br/>            y=group["sepal_width"],<br/>            name=species.title(),<br/>            mode="markers",<br/>            hovertemplate=f"&lt;b&gt;{species.title()}&lt;/b&gt;&lt;br&gt;Sepal Length: %{{x}}&lt;br&gt;Sepal Width: %{{y}}&lt;extra&gt;&lt;/extra&gt;"<br/>        )<br/>    )</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ns"><img src="../Images/fb12fd86576098dd9aa73a415a253d2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FmtzS-tq7Ept5Kk4Q4Shpg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">格式化的最终 plottly plot—作者制作的图形</p></figure><p id="d7fd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们走吧！轴标签格式正确，我们现在有了一个图例标题，我们的悬停工具提示看起来比默认的<code class="fe me mf mg mh b">plotly.express</code>要好很多。在我看来，额外的几行代码是一种非常值得的权衡。</p><h1 id="6b93" class="mi mj it bd mk ml mm mn mo mp mq mr ms ki mt kj mu kl mv km mw ko mx kp my mz bi translated"><strong class="ak">剧情定制</strong></h1><p id="8bb5" class="pw-post-body-paragraph li lj it lk b ll na kd ln lo nb kg lq lr nc lt lu lv nd lx ly lz ne mb mc md im bi translated">由<code class="fe me mf mg mh b">plotly</code>生成的默认图形看起来已经很不错了，但是我们也可以像在<code class="fe me mf mg mh b">matplotlib</code>中一样对它们进行高度定制。与我们如何使用<code class="fe me mf mg mh b">plt.rcParams["key"] = value</code>定制<code class="fe me mf mg mh b">matplotlib</code>图形类似，在<code class="fe me mf mg mh b">plotly</code>中，我们将使用以下内容:</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="4c02" class="nj mj it mh b gy nk nl l nm nn">fig.update_layout(<br/>    key1=val1,<br/>    key2=val2,<br/>    keyn=valn<br/>)</span></pre><p id="7a2c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，让我们从绘图中删除所有默认样式，这可以通过在创建 figure 对象时将<code class="fe me mf mg mh b">layout_template</code>设置为<code class="fe me mf mg mh b">None</code>来实现。</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="8def" class="nj mj it mh b gy nk nl l nm nn">fig = go.Figure(layout_template=None)<br/>fig.update_layout(height=600, width=600)<br/>fig.show()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nt"><img src="../Images/346813fcff5bc7175aaa862c12ceaf40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q48SitjXp5FMfHZLTdR9lg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">没有布局模板的无样式打印图形-由作者制作的图形</p></figure><p id="047f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们现在有了一个空白画布，可以在上面添加我们自己的样式定制。让我们首先使用 Python 中的 Yahoo Finance 包加载一些财务数据，然后在我们的非样式轴上绘制这些数据。注意— <code class="fe me mf mg mh b">go.Scatter()</code>通过使用<code class="fe me mf mg mh b">mode</code>关键字参数用于<strong class="lk jd">散点图和折线图:</strong></p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="a0bd" class="nj mj it mh b gy nk nl l nm nn"><strong class="mh jd"># Import packages<br/></strong>import yfinance as yf</span><span id="51d9" class="nj mj it mh b gy no nl l nm nn"><strong class="mh jd"># Load stock data<br/></strong>aapl = yf.Ticker("AAPL").history(period="3mo")<br/>aapl["ticker"] = "AAPL"</span><span id="ac37" class="nj mj it mh b gy no nl l nm nn">msft = yf.Ticker("MSFT").history(period="3mo")<br/>msft["ticker"] = "MSFT"</span><span id="8e0d" class="nj mj it mh b gy no nl l nm nn">nvda = yf.Ticker("NVDA").history(period="3mo")<br/>nvda["ticker"] = "NVDA"</span><span id="84d4" class="nj mj it mh b gy no nl l nm nn">df = aapl.append(msft).append(nvda).reset_index()</span><span id="535f" class="nj mj it mh b gy no nl l nm nn"><strong class="mh jd"># Plot data<br/></strong>fig = go.Figure(layout_template=None)<br/>for ticker, group in df.groupby("ticker"):<br/>    fig.add_trace(<br/>        go.Scatter(<br/>            x=group["Date"],<br/>            y=group["Close"],<br/>            name=ticker,<br/>            mode="lines",<br/>            hovertemplate=f"{ticker}&lt;br&gt;%{{x}}&lt;br&gt;$%{{y}}&lt;extra&gt;&lt;/extra&gt;"<br/>        )<br/>    )</span><span id="f44d" class="nj mj it mh b gy no nl l nm nn">fig.update_layout(height=600, width=600)<br/>fig.show()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nu"><img src="../Images/4f0ede86b2351076dd8c60c19afb32cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YeMYyHsBdRM6m_R3edmolg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">未定型的财务情节——作者制作的图表</p></figure><p id="ca74" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，让我们进行一些定制——在本文中，我将创建一个以学术为主题的情节风格，并从《金融时报》的一些情节中获得灵感。</p><h2 id="099c" class="nj mj it bd mk nv nw dn mo nx ny dp ms lr nz oa mu lv ob oc mw lz od oe my iz bi translated"><strong class="ak">学院派剧情</strong></h2><p id="a6e6" class="pw-post-body-paragraph li lj it lk b ll na kd ln lo nb kg lq lr nc lt lu lv nd lx ly lz ne mb mc md im bi translated">你在学术论文中发现的一个典型特征是，轴线出现在所有四个面上。做这个的相关布局参数是<code class="fe me mf mg mh b">showline</code>和<code class="fe me mf mg mh b">mirror</code>，我们可以分别用<code class="fe me mf mg mh b">linewidth</code>和<code class="fe me mf mg mh b">linecolor</code>调整线宽和颜色。注意，这些都是由 JSON 对象表示的，因此您有两个选项来输入布局参数:嵌套字典或由下划线分隔的键。例如，如果我们想在 x 轴上显示这条线，我们可以执行以下任一操作(我更喜欢后者):</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="4368" class="nj mj it mh b gy nk nl l nm nn">fig.update_layout(<br/>    {"xaxis": {"showline": True}}<br/>)</span><span id="99bf" class="nj mj it mh b gy no nl l nm nn">fig.update_layout(<br/>    xaxis_showline=True<br/>)</span></pre><p id="d98f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，让我们围绕我们的图创建一个方框——<code class="fe me mf mg mh b">ticks</code>的<code class="fe me mf mg mh b">mirror</code>选项值将轴线和刻度镜像到图的另一侧:</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="3f25" class="nj mj it mh b gy nk nl l nm nn">fig.update_layout(<br/>    xaxis_showline=True,<br/>    xaxis_mirror="ticks",<br/>    xaxis_linewidth=2,<br/>    yaxis_showline=True,<br/>    yaxis_mirror="ticks",<br/>    yaxis_linewidth=2<br/>)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi of"><img src="../Images/60faa4e14a09dad515f2e3c76995e5bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x8lugHEEnIVnuWbKvf-OQQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">地块周围的方框—作者制作的图形</p></figure><p id="229e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">从上面的图中，我们仍然缺少记号，缺省情况下不显示。我们可以使用<code class="fe me mf mg mh b">ticks</code>键选择将刻度置于图的内部或外部，并分别使用<code class="fe me mf mg mh b">tickwidth</code>和<code class="fe me mf mg mh b">ticklen</code>键设置刻度的宽度和长度。</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="f57b" class="nj mj it mh b gy nk nl l nm nn">fig.update_layout(<br/>    xaxis_ticks="inside",<br/>    xaxis_ticklen=8,<br/>    xaxis_tickwidth=2,<br/>    yaxis_ticks="inside",<br/>    yaxis_ticklen=8,<br/>    yaxis_tickwidth=2<br/>)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi og"><img src="../Images/97d9fd5daa13760ce363bbed1524d1db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b9N_7c4VAdPa-JSDsjJCrQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者制作的图</p></figure><p id="4cee" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">开始看起来更像我们在研究论文中看到的一般学术风格的情节！我们要做的最后一些修饰性的改变是移除网格，添加轴标签，改变字体和字体大小。</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="0008" class="nj mj it mh b gy nk nl l nm nn">fig.update_layout(<br/>    font_family="Avenir",<br/>    hoverlabel_font_family="Avenir",<br/>    xaxis_title_text="Date",<br/>    xaxis_title_font_size=18,<br/>    xaxis_tickfont_size=16,<br/>    xaxis_showgrid=False,<br/>    yaxis_title_text="Closing Price ($)",<br/>    yaxis_title_font_size=18,<br/>    yaxis_tickfont_size=16,<br/>    yaxis_showgrid=False<br/>)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oh"><img src="../Images/b685d5d7651ecf6eafdebc4204be3670.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sx7anzG5gQhWqZKFK3SKtA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">最终学术风格图—作者制作的图形</p></figure><p id="bed9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">看起来棒极了！最后一项簿记工作——注意我们如何在<code class="fe me mf mg mh b">update_layout()</code>的关键输入中反复使用<code class="fe me mf mg mh b">xaxis</code>和<code class="fe me mf mg mh b">yaxis</code>？这是我会考虑使用嵌套字典的时候之一。我们可以更有效地写出所有的布局更改，如下所示:</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="4845" class="nj mj it mh b gy nk nl l nm nn">fig.update_layout(<br/>    font_family="Avenir",<br/>    hoverlabel_font_family="Avenir",<br/>    xaxis=dict(<br/>        showline=True,<br/>        mirror="ticks",<br/>        linewidth=2,<br/>        ticks="inside",<br/>        ticklen=8,<br/>        tickwidth=2,<br/>        title_text="Date",<br/>        title_font_size=18,<br/>        tickfont_size=16,<br/>        showgrid=False<br/>    ),<br/>    yaxis=dict(<br/>        showline=True,<br/>        mirror="ticks",<br/>        linewidth=2,<br/>        ticks="inside",<br/>        ticklen=8,<br/>        tickwidth=2,<br/>        title_text="Closing Price ($)",<br/>        title_font_size=18,<br/>        tickfont_size=16,<br/>        showgrid=False<br/>    ),<br/>    height=600,<br/>    width=600<br/>)</span></pre><h2 id="ea00" class="nj mj it bd mk nv nw dn mo nx ny dp ms lr nz oa mu lv ob oc mw lz od oe my iz bi translated"><strong class="ak">金融时报启发的情节</strong></h2><p id="d464" class="pw-post-body-paragraph li lj it lk b ll na kd ln lo nb kg lq lr nc lt lu lv nd lx ly lz ne mb mc md im bi translated">我们现在可以做一个与上面类似的练习，制作一个类似于<a class="ae lh" href="https://ig.ft.com/coronavirus-chart/" rel="noopener ugc nofollow" target="_blank">金融时报</a>的图表。从刚才检查的情节来看，下面是我们需要做的一系列事情:</p><ol class=""><li id="41db" class="oi oj it lk b ll lm lo lp lr ok lv ol lz om md on oo op oq bi translated">更改网格、脊线、绘图背景和文本的颜色</li><li id="47ff" class="oi oj it lk b ll or lo os lr ot lv ou lz ov md on oo op oq bi translated">在底部添加 x 轴脊椎</li><li id="d04f" class="oi oj it lk b ll or lo os lr ot lv ou lz ov md on oo op oq bi translated">把字体改成类似的</li><li id="9714" class="oi oj it lk b ll or lo os lr ot lv ou lz ov md on oo op oq bi translated">为线条的终点添加标记，并为每个股票代码添加文本注释，而不是图例</li></ol><p id="d11b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们逐一实现这些步骤。我们将从完全未定型的身材开始。</p><p id="1eb5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">改变颜色</strong></p><p id="7d91" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用谷歌 Chrome 众多颜色选择器扩展中的一个，我能够从图中获得重要的颜色，它们如下:</p><p id="19f9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">网格颜色:</strong> #E6D86D</p><p id="bb57" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> X 轴书脊颜色:</strong> #66605B</p><p id="9a69" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">剧情背景颜色:</strong> #FFF0E4</p><p id="d9ff" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">文本颜色:</strong> #66605B</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="fc45" class="nj mj it mh b gy nk nl l nm nn">fig.update_layout(<br/>    xaxis=dict(<br/>        zeroline=False,<br/>        gridcolor="#e6d8cd",<br/>        tickfont_size=16,<br/>        tickfont_color="#66605b"<br/>    ),<br/>    yaxis=dict(<br/>        zeroline=False,<br/>        gridcolor="#e6d8cd",<br/>        tickfont_size=16,<br/>        tickfont_color="#66605b"<br/>    ),<br/>    plot_bgcolor="#fff0e4",<br/>    paper_bgcolor="#fff0e4",<br/>    height=600,<br/>    width=800<br/>)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ow"><img src="../Images/038be0214d08d1930f384ce6915fc75f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MP3m281JTWHb-ZRh2T1ohQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者制作的图</p></figure><p id="1c42" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">添加 X 轴脊椎</strong></p><p id="8080" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们通过将 x 轴的<code class="fe me mf mg mh b">showline</code>设置为<code class="fe me mf mg mh b">True</code>并改变线的颜色来反映我们的示例图。</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="8027" class="nj mj it mh b gy nk nl l nm nn">fig.update_layout(<br/>    xaxis=dict(<br/>        showline=True,<br/>        linecolor="#66605b"<br/>    )<br/>)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ox"><img src="../Images/74675cbcd6c0aaec0aa2273cdab76867.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JL4SQHYBK588poFVGqSBFQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者制作的图</p></figure><p id="d862" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">改变字体</strong></p><p id="8da4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这个例子中，我将使用一种叫做<a class="ae lh" href="https://en.bestfonts.pro/font/metric" rel="noopener ugc nofollow" target="_blank"> Metric </a>的字体，它看起来与 FT 使用的字体相似。我们可以将它添加到我们的绘图和悬停信息中，如下所示:</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="eb9c" class="nj mj it mh b gy nk nl l nm nn">fig.update_layout(<br/>    font_family="Metric",<br/>    hoverlabel_font_family="Metric"<br/>)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oy"><img src="../Images/ebfb30bf1ccafcd0115a0974ca4af664.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h8AZUwO0xT_BYdKwNJZoiQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者制作的图</p></figure><p id="3461" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">添加标记和文本注释</strong></p><p id="5299" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是最复杂的更改—为了在最终点创建标记，我们将添加另一个散布追踪，其中只有一个点对应于最终值。此外，我将根据 FT 绘图示例中的颜色定义 3 种颜色，并将其用于三条轨迹。最后，我们可以向这些分散点添加文本注释。注意，我们还必须确保隐藏这些分散点的悬停信息，这样我们就不会对同一个点有两个悬停工具提示。</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="4005" class="nj mj it mh b gy nk nl l nm nn">colors = ["#7f042e", "#2090ce", "#eb5e8d"]</span><span id="ead3" class="nj mj it mh b gy no nl l nm nn">i = 0<br/>for ticker, group in df.groupby("ticker"):<br/>    fig.add_trace(<br/>        go.Scatter(<br/>            x=[group["Date"].iloc[-1]],<br/>            y=[group["Close"].iloc[-1]],<br/>            mode="markers+text",<br/>            marker_color=colors[i],<br/>            marker_size=8,<br/>            hoverinfo="skip",<br/>            text=ticker,<br/>            textposition="middle right",<br/>            textfont = dict(color=colors[i], size=16)<br/>        )<br/>    )<br/>    fig.add_trace(<br/>        go.Scatter(<br/>            x=group["Date"], <br/>            y=group["Close"], <br/>            name=ticker, <br/>            mode="lines",<br/>            line_color=colors[i],<br/>            hovertemplate=f"&lt;b&gt;{ticker}&lt;/b&gt;&lt;br&gt;Date: %{{x}}&lt;br&gt;Closing Price: $%{{y}}&lt;extra&gt;&lt;/extra&gt;"<br/>        )<br/>    )<br/>    i+=1</span></pre><p id="a7ef" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，我们只需要删除图例，我们将手动添加一个 x 轴范围，以确保我们的注释在稍微偏离图表区域时不会被剪切。我们还可以在我们的情节顶部添加一个标题。</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="cbd2" class="nj mj it mh b gy nk nl l nm nn">fig.update_layout(<br/>    xaxis=dict(range=["2021-12-01", "2022-03-15"]),<br/>    showlegend=False,<br/>    title="Stock Prices in the Past Three Months",<br/>    title_font_size=24,<br/>    title_x=0.1,<br/>    title_xanchor="left",<br/>)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oz"><img src="../Images/b100b6227928bda53963dfbfd8b9b8fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6TDUmnsPe55UUX2LtJVBQA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">《金融时报》风格的最终股票走势图——由作者制作</p></figure><p id="fed6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">非常酷！现在你可以看到默认的<code class="fe me mf mg mh b">plotly</code>图表的可定制程度。</p><h1 id="2322" class="mi mj it bd mk ml mm mn mo mp mq mr ms ki mt kj mu kl mv km mw ko mx kp my mz bi translated">保存和加载布局</h1><p id="b6a0" class="pw-post-body-paragraph li lj it lk b ll na kd ln lo nb kg lq lr nc lt lu lv nd lx ly lz ne mb mc md im bi translated">最后，一旦你完成调整你的地块到它的最终形式，你可能想要保存你的布局，以便你可以很容易地加载和重用它在未来。最简单的方法是保存代表绘图布局的 JSON 对象。我们可以这样做:</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="a26b" class="nj mj it mh b gy nk nl l nm nn"><strong class="mh jd"># Import JSON package<br/></strong>import json</span><span id="311d" class="nj mj it mh b gy no nl l nm nn"><strong class="mh jd"># Get layout JSON from figure<br/></strong>layout = fig.layout.to_plotly_json()</span><span id="7d4a" class="nj mj it mh b gy no nl l nm nn"><strong class="mh jd"># Save layout</strong><br/>with open("layout.json", "w", encoding="utf-8") as f:<br/>    json.dump(layout, f, ensure_ascii=False, indent=4)<br/>f.close()</span></pre><p id="da1f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，稍后，添加我们保存的布局很简单，加载 JSON 文件并用它更新布局。</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="874c" class="nj mj it mh b gy nk nl l nm nn"><strong class="mh jd"># Load layout<br/></strong>layout = json.load(open("layout.json"))</span><span id="5181" class="nj mj it mh b gy no nl l nm nn"><strong class="mh jd"># Add layout</strong><br/>fig.update_layout(layout)</span></pre><h1 id="fa97" class="mi mj it bd mk ml mm mn mo mp mq mr ms ki mt kj mu kl mv km mw ko mx kp my mz bi translated"><strong class="ak">输出地块</strong></h1><p id="1ebc" class="pw-post-body-paragraph li lj it lk b ll na kd ln lo nb kg lq lr nc lt lu lv nd lx ly lz ne mb mc md im bi translated">我们可以用两种方式导出最终的图形——像我们在<code class="fe me mf mg mh b">matplotlib</code>中做的那样导出光栅化或矢量化的图像，或者导出为保持交互性的 HTML 文件。为了保存图像，我们需要安装一个名为<code class="fe me mf mg mh b">kaleido</code>的依赖项:</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="d8c3" class="nj mj it mh b gy nk nl l nm nn">pip install kaleido</span></pre><p id="5d97" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦我们这样做了，我们可以用<code class="fe me mf mg mh b">fig.write_image()</code>保存一个光栅图。我们可以保存为各种格式，如 JPEG、PNG 或 PDF，还可以提供一个<code class="fe me mf mg mh b">scale</code>值，以确保我们的应用程序在最终图像中有足够的 DPI。</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="e3a3" class="nj mj it mh b gy nk nl l nm nn">fig.write_image("plot.png", scale=2)</span></pre><p id="2393" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，如果我们想保存交互情节，我们需要导出到 HTML。我们可以使用<code class="fe me mf mg mh b">fig.write_html()</code>来做到这一点——这个函数的一个可选参数是<code class="fe me mf mg mh b">include_plotlyjs</code>，它设置是否在 HTML 文件本身中包含整个 Plotly javascript。这通常会增加大约 3.5 MB 的整体文件大小，因此如果您希望收件人只使用 CDN 来获取 Plotly JS，而不是将其包含在文件中，您可以在此处设置。</p><pre class="ks kt ku kv gt nf mh ng nh aw ni bi"><span id="ef7d" class="nj mj it mh b gy nk nl l nm nn">fig.write_html("plot.html", include_plotlyjs="cdn")</span></pre><h1 id="4e0f" class="mi mj it bd mk ml mm mn mo mp mq mr ms ki mt kj mu kl mv km mw ko mx kp my mz bi translated">结论</h1><p id="3ded" class="pw-post-body-paragraph li lj it lk b ll na kd ln lo nb kg lq lr nc lt lu lv nd lx ly lz ne mb mc md im bi translated">这是使用<code class="fe me mf mg mh b">plotly</code>创建和定制交互式人物的基本介绍。你可以进入<code class="fe me mf mg mh b">plotly</code> <a class="ae lh" href="https://plotly.com/python-api-reference/generated/plotly.graph_objects.Layout.html" rel="noopener ugc nofollow" target="_blank">布局文档</a>查看使用<code class="fe me mf mg mh b">fig.update_layout()</code>时的所有可能性。本文中的<code class="fe me mf mg mh b">plotly.ipynb</code>笔记本将在这个<a class="ae lh" href="https://github.com/venkatesannaveen/python-science-tutorial" rel="noopener ugc nofollow" target="_blank"> Github 资源库</a>中提供。</p><p id="5627" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">感谢您的阅读！我感谢任何反馈，你可以在<a class="ae lh" href="https://twitter.com/naveenv_92" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上找到我，并在<a class="ae lh" href="https://www.linkedin.com/in/naveenvenkatesan/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上与我联系，以获取更多更新和文章。</p></div></div>    
</body>
</html>