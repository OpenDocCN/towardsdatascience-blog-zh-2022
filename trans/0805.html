<html>
<head>
<title>10 Quick SQL Tips After Writing Daily in SQL for 3 Years</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">三年来每天用 SQL 写作的 10 个快速 SQL 技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/10-quick-sql-tips-after-writing-daily-in-sql-for-3-years-37bdba0637d0#2022-03-07">https://towardsdatascience.com/10-quick-sql-tips-after-writing-daily-in-sql-for-3-years-37bdba0637d0#2022-03-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="467d" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">数据科学</h2><div class=""/><div class=""><h2 id="1351" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">这些技巧解决了您作为数据专业人员将会遇到的常见 SQL 问题</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/6d54b27c0561c6e2293f5723b1784764.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rcBGAuH-nT2SZt8KE8a68w.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">来自<a class="ae lh" href="https://www.pexels.com/photo/man-in-black-jacket-wearing-black-headphones-3831645/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的 Andrea Piacquadio 的照片</p></figure><p id="429a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我从事数据专业工作已经 3 年了，但看到其他人在考虑进入数据相关领域时，几乎没有 SQL 知识或经验，这仍然让我感到惊讶。<strong class="lk jd">我怎么强调这一点都不为过，不管你渴望得到什么样的数据角色，SQL 都是基础。</strong></p><p id="f10f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当然，我也见过一些例外的人，他们在 SQL 之外的其他领域拥有惊人的技能，却得到了这份工作，但他们在被聘用后仍然不得不学习 SQL。我认为，如果不学习 SQL，成为一名数据专家几乎是不可能的。</p><p id="fba9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这些 SQL 技巧适用于所有人，不管你有多少经验。这些是我实际上经常使用的 SQL 技巧，不是什么新奇有趣但实际上不太适合你的工作流程的东西。为了方便起见，我按难易程度列出了这些。</p><p id="ea5c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我将使用这个 SQLite 沙盒数据库作为我的代码示例:<a class="ae lh" href="https://www.sql-practice.com/" rel="noopener ugc nofollow" target="_blank">https://www.sql-practice.com/</a>。</p><h2 id="bf81" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">1.检查表中的不同计数</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="29a5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">第一个例子展示了如何检查列是否是表中的主键。当然，这通常会用在您创建的表中，因为大多数数据库都可以选择在信息模式元数据中列出主键。</p><p id="20f1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果两列中的数字相等，那么您在查询的第二部分中计算的列可能是主键。这不是一个保证，但它可以帮助你找到它。</p><p id="1cc7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当您有多个创建主键的列时，这只会稍微复杂一点。要解决这个问题，只需将构成主键的列连接在 DISTINCT 关键字之后。一个简单的例子是连接沙箱表中的名和姓来创建一个主键。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h2 id="e1e6" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">2.查找重复记录的示例</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="c955" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">沙盒表是您将在工作中使用的数据库的简化版本。很多时候，您会希望查找数据库中出现重复值的原因。这就是下一个查询派上用场的地方。</p><p id="1b3b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可以使用 HAVING 关键字对重复的值进行排序。在沙盒数据库中，您可以看到名字“John”是最常重复的。然后运行另一个查询，过滤到“John”以查看重复值的原因，您可以很快看到它们都有不同的姓氏和患者 ID。</p><h2 id="9002" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">3.用不同的</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="625a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于 COUNT(*)列，该查询的输出将是 4531，对于其余两列，输出将是 4530。指定列时，COUNT 关键字将排除计算空值。但是，当您使用星号时，空值将包含在计数中。当检查一个列是否是主键时，这可能会令人困惑，这就是我为什么要提到它的原因。</p><h2 id="12c8" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">4.CTE &gt;子查询</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="2de6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">三年前，当我刚开始做数据分析师时，我编写的 SQL 查询包含的子查询比我愿意承认的要多。我很快意识到这不会产生可读的代码。在大多数情况下，您希望使用 CTE(公共表表达式)来代替子查询。为您想要包含的一行程序保留子查询。</p><h2 id="7d51" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">5.一起使用 SUM 和 CASE</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="6793" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您想要合计满足特定条件的患者数量，WHERE 子句可以发挥作用。但是如果你想检查多个条件，你可以使用 SUM 和 CASE 当关键字在一起。这简化了代码，也易于阅读。</p><p id="7b24" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这种组合也可以用在 WHERE 子句中，如下例所示。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h2 id="51d5" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">6.小心日期</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="7283" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此沙盒数据集的所有日期都被截断到一天。这意味着本例中 birth_date 列的时间部分都是 00:00:00。然而，在真实世界的数据集中，情况通常不是这样。</p><p id="8009" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">根据您的 SQL 开发 IDE，您的设置可能会隐藏显示时间组件。但是仅仅因为时间被隐藏，并不意味着它不是数据的一部分。</p><p id="c7ca" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在上面的例子中，我人为地给病人#1 添加了一秒钟。如您所见，当使用 BETWEEN 关键字时，这 1 秒钟足以将患者从结果中排除。</p><p id="48dd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我看到数据专业人员忽略的另一个常见例子是加入仍然有时间成分的日期。大多数时候，他们实际上打算在被截断的日期加入，但最终没有得到他们想要的结果；或者更糟，他们没有意识到他们没有得到正确的结果。</p><h2 id="8ef7" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">7.不要忘记窗口函数</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="21ec" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">窗口函数是保存所有数据行的好方法，然后在另一列中添加重要的聚合细节。在这种情况下，我们能够保留所有的数据，但是添加了一个“城市最大权重”列。</p><p id="6d3a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我见过一些分析师尝试解决方法，当一个窗口函数可以使代码更短，更易读，并且很可能节省他们的时间。</p><p id="535b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">有许多不同的窗口函数，但是上面的例子是一个普通而简单的用例。</p><h2 id="0d88" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">8.尽可能避免截然不同</h2><p id="a9b6" class="pw-post-body-paragraph li lj it lk b ll my kd ln lo mz kg lq lr na lt lu lv nb lx ly lz nc mb mc md im bi translated">下面的最后 3 个技巧没有具体的代码片段要展示，但是和上面的例子一样重要。在我的职业生涯中，我发现数据专业人员经常会在不理解数据的情况下添加一个 distinct 来防止重复。</p><p id="837a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是一个错误。如果你不能解释为什么数据中会有重复，你可能会从你的分析中排除一些有用的信息。你应该总是能够解释为什么在一个表上放一个 distinct，为什么会有重复的。WHERE 子句通常是首选的，因为这样您就可以看到被排除的内容。</p><h2 id="09cd" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">9.SQL 格式</h2><p id="ffa0" class="pw-post-body-paragraph li lj it lk b ll my kd ln lo mz kg lq lr na lt lu lv nb lx ly lz nc mb mc md im bi translated">这已经说了很多，但值得重复。确保格式化您的 SQL。最好创建更多具有良好格式的代码行，而不是试图将所有代码浓缩在几行代码中。它会让你的发展和别人的发展更快。</p><p id="f61b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你可以在我上面的代码片段中看到，我在 WHERE 子句中使用了 TRUE 关键字。这是为了使 WHERE 子句中的所有参数都以 AND 开头。这样，争论就从同一点开始了。</p><p id="dc2d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">另一个快速技巧是在 SELECT 子句中的列的开头添加逗号。这使得任何遗漏的逗号都很容易找到，因为它们都是对齐的。</p><h2 id="c2e8" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">10.调试提示</h2><p id="5674" class="pw-post-body-paragraph li lj it lk b ll my kd ln lo mz kg lq lr na lt lu lv nb lx ly lz nc mb mc md im bi translated">一些 SQL 查询可能是很难调试的问题。当我过去遇到这些问题时，对我帮助最大的是非常勤奋地记录我的步骤。</p><p id="12c7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了记录我的步骤，我将在查询前的注释中对一段代码进行编号。注释描述了我在查询部分尝试做的事情。然后我会在运行查询后在评论标题下写下我的答案。</p><p id="1bdf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在你调试的时候，很容易看到你已经尝试了什么，我保证你会用这种方法更快地解决它。</p><h2 id="ad73" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">结论</h2><p id="7ec5" class="pw-post-body-paragraph li lj it lk b ll my kd ln lo mz kg lq lr na lt lu lv nb lx ly lz nc mb mc md im bi translated">希望你从这些建议中学到了有用的东西。在用 SQL 编码时，你发现了哪些有用的技巧？我也期待听到你的建议，请在评论中链接其他有用的文章，谢谢！</p></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><div class="ks kt ku kv gt nk"><a href="https://medium.com/@andreasmartinson/membership" rel="noopener follow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd jd gy z fp np fr fs nq fu fw jc bi translated">加入 Medium 并通过我的推荐链接支持我</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">medium.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny lb nk"/></div></div></a></div><p id="1a2e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你喜欢这篇文章，请在 LinkedIn 上联系我，或者看看我的另一个故事:</p><div class="nz oa gp gr ob nk"><a rel="noopener follow" target="_blank" href="/why-is-nobody-talking-about-sql-anti-joins-f970a5f6cb54"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd jd gy z fp np fr fs nq fu fw jc bi translated">如何在您的数据科学职业生涯中使用 SQL 反连接</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">为什么你应该知道他们</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">towardsdatascience.com</p></div></div><div class="nt l"><div class="oc l nv nw nx nt ny lb nk"/></div></div></a></div><div class="nz oa gp gr ob nk"><a rel="noopener follow" target="_blank" href="/5-window-function-examples-to-take-your-sql-skills-to-the-next-level-2b3306650bb6"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd jd gy z fp np fr fs nq fu fw jc bi translated">5 个窗口函数示例，让您的 SQL 技能更上一层楼</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">如果你想掌握 SQL 中的数据操作，你需要理解窗口函数</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">towardsdatascience.com</p></div></div><div class="nt l"><div class="od l nv nw nx nt ny lb nk"/></div></div></a></div></div></div>    
</body>
</html>