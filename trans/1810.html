<html>
<head>
<title>Monitor! Easy MLOps Model Monitoring With New Relic</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">班长！使用New Relic轻松监控MLOps模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/monitor-easy-mlops-model-monitoring-with-new-relic-ef2a9b611bd1#2022-04-27">https://towardsdatascience.com/monitor-easy-mlops-model-monitoring-with-new-relic-ef2a9b611bd1#2022-04-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f243" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">监控ML模型的简单方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/37ead6523f4cf920d47689989b8148ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*L3YUrDBiAvpEWJ58.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">“可观察性仪表板”，Wallusy，<a class="ae ky" href="https://pixabay.com/illustrations/charts-tables-graph-statistics-6246450/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>。</p></figure><p id="86a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在都知道数据和模型监控极其重要。即使您的生产就绪模型没有发生变化，数据分布也可能会发生变化，并可能会影响您的输出，从而直接影响您的用户，一旦发生这种情况，您可能会遇到面向客户的生产问题。</p><p id="f093" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文旨在成为一个简短的教程，帮助您开始ML模型监控，在本指南的结尾，您将知道如何监控任何ML模型。</p><p id="b91c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅供参考，如果您想了解更多关于监控必要性的原因，请阅读下面的文章。</p><div class="lv lw gp gr lx ly"><a rel="noopener follow" target="_blank" href="/monitor-stop-being-a-blind-data-scientist-ac915286075f"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">班长！不要再做一个盲目的数据科学家。</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">监控和警报如何帮助您更好地控制您的数据，以及它的实际应用有多少…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">towardsdatascience.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><h2 id="95cb" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">监控和可观察性</h2><p id="f0bb" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">开发人员和数据科学生产系统之间的监控和可观察性差距是真实的，我们需要谈论它。有许多平台设计用于监控工程系统，也有许多其他平台设计用于监控ML系统，但没有一个具有高度先进功能的系统能够开箱即用地支持这两种系统，至少目前还没有。</p><p id="5102" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">NR开始向这个方向发展，提供ML模型监控，允许数据科学家将他们的模型度量和输出发送到开发人员使用的同一个平台。您可以获得自动和定制的仪表板、警报和相关的系统事件。如果您想要更高级的功能和见解来减少平均解析时间，您还可以与ML模型监控公司集成，如<a class="ae ky" href="https://www.superwise.ai/" rel="noopener ugc nofollow" target="_blank"> Superwise </a>、<a class="ae ky" href="https://www.aporia.com/" rel="noopener ugc nofollow" target="_blank"> Aporia </a>、<a class="ae ky" href="https://www.comet.ml/site/" rel="noopener ugc nofollow" target="_blank"> Comet </a>、<a class="ae ky" href="https://truera.com/" rel="noopener ugc nofollow" target="_blank"> Truera </a>、<a class="ae ky" href="https://dagshub.com/dashboard" rel="noopener ugc nofollow" target="_blank"> DagsHub </a>、<a class="ae ky" href="https://www.monalabs.io/" rel="noopener ugc nofollow" target="_blank"> Mona Labs </a>、&amp;、<a class="ae ky" href="https://algorithmia.com/" rel="noopener ugc nofollow" target="_blank"> Algorithmia </a> (DataRobot)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/6ccb178c32b03b2b020c3d3dc5f33186.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oVCeMir1ULKaMbA632SJ0w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ML模型监控集成，如NR I/O中所示，图片由作者提供。</p></figure><h1 id="f547" class="nm mo it bd mp nn no np ms nq nr ns mv jz nt ka my kc nu kd nb kf nv kg ne nw bi translated">ML监控入门</h1><p id="6849" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">通过使用GitHub上提供的开源“<a class="ae ky" href="https://github.com/newrelic-experimental/ml-performance-monitoring" rel="noopener ugc nofollow" target="_blank">ML-performance-monitoring</a>”python库，发送ML数据变得很容易。</p><div class="lv lw gp gr lx ly"><a href="https://github.com/newrelic-experimental/ml-performance-monitoring" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">GitHub—new relic-experimental/ml-performance-monitoring:一个用于发送模型的Python包…</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">ml-performance-monitoring提供了一个Python库，用于发送机器学习模型的推理数据和性能…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">github.com</p></div></div><div class="mh l"><div class="nx l mj mk ml mh mm ks ly"/></div></div></a></div><p id="a874" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这组工具将允许您直接从代码中监控各种ML输出。首先，你需要注册一个<em class="ny">免费</em> NR账户，每月最多100GB。接下来，您将能够直接从python脚本或Jupyter笔记本进行监控，利用预先构建的仪表板，创建自定义仪表板，以及创建警报。这可以针对模型度量、数据漂移、概念漂移、概率、标签等等来完成。</p><h2 id="eea5" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">安装</h2><p id="8134" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">首先，你需要安装GitHub包。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="3545" class="mn mo it oa b gy oe of l og oh">$ pip install git+https://github.com/newrelic-experimental/ml-performance-monitoring.git</span></pre><h2 id="6dbe" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">获取插入键</h2><p id="fea5" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">现在去<a class="ae ky" href="https://docs.newrelic.com/docs/apis/intro-apis/new-relic-api-keys/#keys-ui" rel="noopener ugc nofollow" target="_blank">拿</a>你的insert键，这是一个允许你发送数据到平台的键，把它放在你的<code class="fe oi oj ok oa b">NEW_RELIC_INSERT_KEY</code>环境变量中。这个键可以在下面的API键<a class="ae ky" href="https://docs.newrelic.com/docs/apis/intro-apis/new-relic-api-keys/#keys-ui" rel="noopener ugc nofollow" target="_blank"> UI </a>中找到。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/5877aba3bef1f0c8db3d8297ecc3c6e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ivOVy2HY4t1td6pY.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">钥匙<a class="ae ky" href="https://docs.newrelic.com/docs/apis/intro-apis/new-relic-api-keys/#keys-ui" rel="noopener ugc nofollow" target="_blank">管理</a> UI，文档，新遗物。</p></figure><h2 id="3e76" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">准备的</h2><p id="6ecf" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我们从导入、加载波士顿数据集、分割和拟合模型开始。这些步骤非常基本，不需要进一步解释。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="1a48" class="mn mo it oa b gy oe of l og oh">from ml_performance_monitoring.monitor import wrap_model<br/>import numpy as np<br/>from sklearn.metrics import mean_squared_error<br/>from sklearn.datasets import load_boston<br/>from sklearn.model_selection import train_test_split<br/>import xgboost as xgb</span><span id="41dd" class="mn mo it oa b gy om of l og oh">boston_dataset = load_boston()</span><span id="28e3" class="mn mo it oa b gy om of l og oh">X, y = (<br/>    boston_dataset["data"],<br/>    boston_dataset["target"],)</span><span id="8aec" class="mn mo it oa b gy om of l og oh">X_train, X_test, y_train, y_test = train_test_split(<br/>    X, y, test_size=0.2, random_state=123<br/>)</span><span id="c21e" class="mn mo it oa b gy om of l og oh">print(X_train[:5], y_train[:5])</span><span id="7112" class="mn mo it oa b gy om of l og oh">xg_reg = xgb.XGBRegressor(<br/>    objective="reg:linear",<br/>    colsample_bytree=0.3,<br/>    learning_rate=0.1,<br/>    max_depth=5,<br/>    alpha=10,<br/>    n_estimators=10,<br/>)</span><span id="9b73" class="mn mo it oa b gy om of l og oh">xg_reg.fit(X_train, y_train)</span></pre><h2 id="c369" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">监视</h2><p id="b14f" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">然后我们想发送一些基于模型的数据。我们用一组元数据键值创建一个字典，并准备需要发送的数据。使用wrap_model()包装您的模型或管道，因为您仍然可以正常使用它，例如在fit()、predict()等方面。这个包装器会将您的推理数据和data_metrics自动发送给NR。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="bc44" class="mn mo it oa b gy oe of l og oh">metadata = {"environment": "aws", "dataset": "Boston housing prices", "version": "1.0"}<br/>features_columns, labels_columns = (<br/>    list(boston_dataset["feature_names"]),<br/>    ["target"],<br/>)</span><span id="562f" class="mn mo it oa b gy om of l og oh">ml_performence_monitor_model = wrap_model(<br/>    insert_key=None,  # set the environment variable NEW_RELIC_INSERT_KEY or send your insert key here<br/>    model=xg_reg,<br/>    model_name="XGBoost Regression on Boston Dataset",<br/>    metadata=metadata,<br/>    send_data_metrics=True,<br/>    features_columns=features_columns,<br/>    labels_columns<!-- -->="categorical"<!-- -->,<br/>)</span><span id="e1a4" class="mn mo it oa b gy om of l og oh">y_pred = ml_performence_monitor_model.predict(<br/>    X=X_test,<br/>)</span><span id="55e6" class="mn mo it oa b gy om of l og oh">rmse = round(np.sqrt(mean_squared_error(y_test, y_pred)), 3)<br/>print(f"RMSE: {rmse}")<br/>metrics = {"RMSE": rmse,}</span><span id="90e2" class="mn mo it oa b gy om of l og oh"># Send your model metrics as a dictionary.<br/>ml_performence_monitor_model.record_metrics(metrics=metrics)</span></pre><h2 id="641b" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">查询您的数据</h2><p id="97d1" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">现在，您将希望看到您的数据，并在平台上验证它，即确保它在一个表中。</p><p id="313e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过以下查询<a class="ae ky" href="https://docs.newrelic.com/docs/query-your-data/explore-query-data/get-started/introduction-querying-new-relic-data/" rel="noopener ugc nofollow" target="_blank">查询</a>来做到这一点:<br/> <code class="fe oi oj ok oa b">Select * From InferenceData Where entity.name='XGBoost Regression on Boston Dataset' Since 1 hour Ago Limit Max</code></p><p id="6f8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者转到ML模型监控视图</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/a04ff041a93964f5efb06bff62e9d139.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BQ6fdNZT753_iMSrZzJ4jw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ML模型监控，图片由作者提供。</p></figure><p id="d256" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择“XGBoost Regression on Boston Dataset”模型，这将显示嵌入式模型视图。另一方面，如果它没有显示任何模型，可能是出了问题，您需要进行调试。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/e5cdcf075af22ebd31429612eff9ba1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fQrV0GT2oveuu7IYB44_zA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">实体视图，作者图片。</p></figure><p id="6ba6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦您选择了您的模型，您将会看到嵌入式模型视图的内部。如下图所示，报告了大量有价值的信息，如预测量、漂移、分布和特征。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/4fd2ae61d294a8ec6aaa7420350f3c1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*90jnD6wZNpoN2SgzuwTzzg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">嵌入式模型视图，作者图片。</p></figure><p id="50f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您单击底部表格中的某一行，将会出现一个新视图并显示附加信息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/0a8f58db52c6d61fc261782ea07585d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YX9mkQRtwyyAFAOkQoYcPA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">深入了解更多信息，图片由作者提供。</p></figure><h2 id="a4ab" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">从Jupyter笔记本电脑进行监控</h2><p id="edb5" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">如果你正在寻找一个端到端的例子。有一款<a class="ae ky" href="https://github.com/newrelic-experimental/ml-performance-monitoring/blob/main/examples/sklearn.RandomForestClassifier_on_Iris_dataset.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>可以完成以上所有功能，并深入展示如何直接从笔记本内部进行监控，例如，如下图所示，我们可以看到如何记录F1、精度、召回、漂移等性能指标。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/ff74f67de0020197801e4f7fbdd477b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yue9WrafkjSU6KgqsvS2HQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">演示笔记本，作者图片。</p></figure><h2 id="2978" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">摘要</h2><p id="156a" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我希望这篇文章能够帮助您完成监控ML模型的第一步。如果这种方法对你不起作用，记住市场上有无数其他不可思议的解决方案，其中一些是自助的，它允许你进行快速POCing。如果你有兴趣了解更多，我整理了以下市场评论。</p><div class="lv lw gp gr lx ly"><a href="https://www.stateofmlops.com/" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">https://www.stateofmlops.com</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">监控公司市场评论</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">www.stateofmlops.com</p></div></div><div class="mh l"><div class="os l mj mk ml mh mm ks ly"/></div></div></a></div></div><div class="ab cl ot ou hx ov" role="separator"><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy"/></div><div class="im in io ip iq"><p id="4e43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Ori Cohen博士拥有计算机科学博士学位，主要研究机器学习。他是<a class="ae ky" href="https://book.mlcompendium.com/" rel="noopener ugc nofollow" target="_blank"> ML &amp; DL纲要</a>和<a class="ae ky" href="http://www.stateofmlops.com" rel="noopener ugc nofollow" target="_blank">StateOfMLOps.com</a>的作者，并且对AIOps &amp; MLOps领域很感兴趣。现在，他是Justt.ai数据科学的高级数据总监。</p></div></div>    
</body>
</html>