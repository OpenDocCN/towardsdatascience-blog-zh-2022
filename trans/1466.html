<html>
<head>
<title>Stop Hardcoding Values in Python Apps — Use YAML Configuration Files Instead</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">停止在Python应用程序中硬编码值-改用YAML配置文件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/stop-hardcoding-values-in-python-apps-use-yaml-configuration-files-instead-4a30290a91dd#2022-04-11">https://towardsdatascience.com/stop-hardcoding-values-in-python-apps-use-yaml-configuration-files-instead-4a30290a91dd#2022-04-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e2bf" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><strong class="ak">硬编码配置是个糟糕的主意。考虑这个替代方案</strong></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d051e951cc76e47a041db2b45361f46d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6c7nPGAd9UDMka7v"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@altumcode?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> AltumCode </a>拍摄</p></figure><p id="5955" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在数百个Python文件中搜索和替换值甚至没有您想象的那么有趣。拥有一个单一的中央配置文件使得调整API URLs、数据库连接和其他内容变得更加容易。今天，您将了解如何使用YAML配置文件使您的Python应用程序更加健壮。</p><p id="4b53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，<em class="lv">什么是YAML </em>？YAML代表另一种标记语言。这是一种在编写配置文件时经常使用的数据序列化语言。它在许多编程语言中都很流行，因为它超级易读。其他文件格式，如<a class="ae ky" href="https://betterdatascience.com/python-json-configuration-file/" rel="noopener ugc nofollow" target="_blank"> JSON </a>，也是人类可读的，但它们比不上YAML提供的简单性。</p><p id="30f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天，您将学习如何用Python读写YAML文件，以及更多内容。但首先，让我们安装这个东西。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="9c8e" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">如何安装YAML Python库</h1><p id="2e41" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">YAML没有附带Python，所以我们必须安装它。根据您使用的是Pip还是Anaconda，安装命令会有所不同。以下是两者的安装命令:</p><p id="5df8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pip:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="a6ea" class="nf me it nb b gy ng nh l ni nj">pip install PyYAML</span></pre><p id="18e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">蟒蛇:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="83b4" class="nf me it nb b gy ng nh l ni nj">conda install -c conda-forge -y pyyaml</span></pre><p id="e382" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我们开始使用Python处理YAML文件所需要的全部内容。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="9db8" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">如何用Python读取YAML配置文件</h1><p id="32e1" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我创建了一个包含两个文件的新文件夹:</p><ul class=""><li id="9fee" class="nk nl it lb b lc ld lf lg li nm lm nn lq no lu np nq nr ns bi translated"><code class="fe nt nu nv nb b">app.py</code> -包含今天的Python代码。</li><li id="f268" class="nk nl it lb b lc nw lf nx li ny lm nz lq oa lu np nq nr ns bi translated"><code class="fe nt nu nv nb b">config.yaml</code> -包含我们不想在Python脚本中硬编码的配置数据。</li></ul><p id="47a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">至于YAML文件的内容，可以把它们看作是键值对。我们今天将与远程REST API进行通信，因此配置文件将包含API端点和保存数据的本地路径:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="cac3" class="nf me it nb b gy ng nh l ni nj">api_url: https://gorest.co.in/public/v2/users<br/>save_dir: /Users/dradecic/Desktop/users_data<br/>save_file: users.json</span></pre><p id="749a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">配置文件比JSON可读性更好，因为我们去掉了所有的花括号和缩进。</p><p id="6e53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">但是如何用Python读取这个文件呢？</strong>用Python阅读YAML文件最好使用上下文管理器语法。<code class="fe nt nu nv nb b">yaml.load()</code>方法将解析文件的内容，并将它们存储为Python字典对象:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="ad1f" class="nf me it nb b gy ng nh l ni nj">import yaml<br/></span><span id="131c" class="nf me it nb b gy ob nh l ni nj">with open("config.yaml", "r") as f:<br/>    config = yaml.load(f, Loader=yaml.FullLoader)</span><span id="add1" class="nf me it nb b gy ob nh l ni nj">print(config)</span></pre><p id="44a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以从shell中运行上面的代码—下面是您将看到的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/575f66bc256fa334629eed46686b70a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fIz0GBAbl3ItQboKwfStrA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1 —读取Python中的YAML配置文件(图片由作者提供)</p></figure><p id="4fa1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">配置存储为键值对，这意味着访问值将非常容易。在我们这样做之前，让我们也探索一下如何从Python写YAML文件。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="30db" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">如何在Python中保存YAML配置文件</h1><p id="c178" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如果要从Python保存YAML配置文件，请用三重引号将配置数据括起来。下面的代码向您展示了如何存储两个常规的键-值对和另一个以列表作为值的键:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="ce9f" class="nf me it nb b gy ng nh l ni nj">import yaml<br/></span><span id="8e7e" class="nf me it nb b gy ob nh l ni nj">yml_config = """key: value<br/>another_key: another value<br/>list_of_keys:<br/>- value 1<br/>- value 2<br/>- value 3<br/>"""</span><span id="f3ae" class="nf me it nb b gy ob nh l ni nj">with open("configw.yaml", "w") as f:<br/>    f.write(yml_config)</span></pre><p id="ea9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相应的YAML文件如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/cdfd8c9238c7f2cefd50f42d6383ad4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GbRlanJ9stJ94z2FnYVLmw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2 —用Python编写YAML配置文件(图片由作者提供)</p></figure><p id="21e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从这里开始，按照上一节中的描述阅读它。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="9b9e" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">如何在Python应用程序中使用YAML配置文件</h1><p id="4a30" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们现在将制作一个小的Python脚本，它连接到一个远程<a class="ae ky" href="https://gorest.co.in/" rel="noopener ugc nofollow" target="_blank"> REST API </a>并下载JSON格式的数据。我们在<code class="fe nt nu nv nb b">config.yaml</code>文件中已经有了URL和路径——只要确保更新路径以匹配您的操作系统。</p><p id="86c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码片段向API端点发出GET请求，并将响应保存在本地。如果目录结构不存在，它还会创建目录结构:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="bfeb" class="nf me it nb b gy ng nh l ni nj">import json<br/>import yaml<br/>import pathlib<br/>import requests<br/></span><span id="e7ba" class="nf me it nb b gy ob nh l ni nj">with open("config.yaml", "r") as f:<br/>    config = yaml.load(f, Loader=yaml.FullLoader)<br/></span><span id="bec2" class="nf me it nb b gy ob nh l ni nj">def get_users() -&gt; dict:<br/>    r = requests.get(config["api_url"])<br/>    return r.text<br/></span><span id="b6df" class="nf me it nb b gy ob nh l ni nj">def save_users(users: dict) -&gt; None:<br/>    path = pathlib.Path(config["save_dir"])<br/>    if not path.exists():<br/>        path.mkdir()</span><span id="7bf7" class="nf me it nb b gy ob nh l ni nj">    with open(f"{config['save_dir']}/{config['save_file']}", "w") as f:<br/>        json.dump(users, f)<br/></span><span id="0909" class="nf me it nb b gy ob nh l ni nj">if __name__ == "__main__":<br/>    users = get_users()<br/>    save_users(users=users)</span></pre><p id="0b87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面你会看到<code class="fe nt nu nv nb b">users_data</code>目录的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/cd3b2addb2c0b56ba9fc7bac4cfdf89b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dM2fnVWy5I8ngMgz02SCAg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3 —保存的JSON文件(作者提供的图片)</p></figure><p id="72fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是如何将YAML配置文件集成到Python项目中的方法。接下来让我们做一个简短的回顾。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="0a4d" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">Python中的YAML配置文件概要</h1><p id="5d27" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">硬编码值从来都不是一个好主意。当然，在一个Python脚本中修改几个东西是很容易的，但是想象一下你有数百个这样的脚本——这很容易变成一场噩梦，你几乎肯定会错过一些地方。</p><p id="4684" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天，您已经学习了如何在Python中使用YAML配置文件。整个设置非常简单，但它不是万能的解决方案。例如，你不能在YAML文件中使用编程逻辑。唯一的解决方法是在Python脚本中包含生成YAML文件的逻辑，但这并不方便。</p><p id="eff0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过使用Python文件进行配置，这个缺点很容易解决。如果你想了解更多，请继续关注。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="7cdb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">喜欢这篇文章吗？成为</em> <a class="ae ky" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="lv">中等会员</em> </a> <em class="lv">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="of og gp gr oh oi"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd iu gy z fp on fr fs oo fu fw is bi translated">通过我的推荐链接加入Medium-Dario rade ci</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">medium.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow ks oi"/></div></div></a></div></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="0733" class="nf me it bd mf ox oy dn mj oz pa dp mn li pb pc mp lm pd pe mr lq pf pg mt ph bi translated">推荐阅读</h2><ul class=""><li id="ab1e" class="nk nl it lb b lc mv lf mw li pi lm pj lq pk lu np nq nr ns bi translated"><a class="ae ky" href="https://betterdatascience.com/best-data-science-prerequisite-books/" rel="noopener ugc nofollow" target="_blank">学习数据科学先决条件(数学、统计和编程)的5本最佳书籍</a></li><li id="6ef7" class="nk nl it lb b lc nw lf nx li ny lm nz lq oa lu np nq nr ns bi translated"><a class="ae ky" href="https://betterdatascience.com/top-books-to-learn-data-science/" rel="noopener ugc nofollow" target="_blank">2022年学习数据科学的前5本书</a></li><li id="61f8" class="nk nl it lb b lc nw lf nx li ny lm nz lq oa lu np nq nr ns bi translated"><a class="ae ky" href="https://betterdatascience.com/python-json-configuration-file/" rel="noopener ugc nofollow" target="_blank">Python中的JSON配置文件</a></li></ul><h2 id="97c3" class="nf me it bd mf ox oy dn mj oz pa dp mn li pb pc mp lm pd pe mr lq pf pg mt ph bi translated">保持联系</h2><ul class=""><li id="9dc3" class="nk nl it lb b lc mv lf mw li pi lm pj lq pk lu np nq nr ns bi translated">雇用我作为一名<a class="ae ky" href="https://betterdatascience.com/contact/" rel="noopener ugc nofollow" target="_blank">技术作家</a></li><li id="1164" class="nk nl it lb b lc nw lf nx li ny lm nz lq oa lu np nq nr ns bi translated">订阅<a class="ae ky" href="https://www.youtube.com/c/BetterDataScience" rel="noopener ugc nofollow" target="_blank"> YouTube </a></li><li id="edd3" class="nk nl it lb b lc nw lf nx li ny lm nz lq oa lu np nq nr ns bi translated">在<a class="ae ky" href="https://www.linkedin.com/in/darioradecic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上连接</li></ul></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="8d41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">原载于2022年4月11日</em><a class="ae ky" href="https://betterdatascience.com/python-yaml-configuration-files/" rel="noopener ugc nofollow" target="_blank"><em class="lv">https://betterdatascience.com</em></a><em class="lv">。</em></p></div></div>    
</body>
</html>