<html>
<head>
<title>Unhappy about your time series anomalies? Synthesize them!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对你的时间序列异常不满意？合成他们！</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/unhappy-about-your-time-series-anomalies-synthesize-them-908495475947#2022-05-10">https://towardsdatascience.com/unhappy-about-your-time-series-anomalies-synthesize-them-908495475947#2022-05-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fdf8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">生成您自己的具有真实异常的多元时间序列数据集</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bf6892576f372dfff7cab2c5e2a2b14d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QmD1cSDR5vU9y6-d"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@maxberg?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马克西姆·伯格</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="af19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您曾经处理过时间序列数据的异常检测问题，您可能已经搜索过包含相关异常的带注释的数据集。而你可能在这个搜索中挣扎过，尤其是在寻找适合研究工业物联网用例的多元时间序列数据时。此外，即使当您处理真实的传感器数据时，您可能仍然很难找到异常，根据定义，这些异常在制造过程中是罕见的。</p><p id="73e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在写一些关于异常检测的文章时，我搜索了这样一个好的数据集来说明我的思维过程。基本上，我需要:</p><ul class=""><li id="321f" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">包括多个传感器的多元数据集</li><li id="4262" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">跨越几个月(最好是一年)</li><li id="a44b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">以合理的采样率(大约1到5分钟)</li><li id="ae33" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">包括一些已知的异常来验证我的结果</li></ul><p id="33e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我找到的唯一满足所有这些标准的数据集是Kaggle上的一个<a class="ae ky" href="https://www.kaggle.com/datasets/nphantawee/pump-sensor-data" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">水泵数据集</strong> </a>。不幸的是，没有与该数据集相关联的许可，这使得它不可能在诸如Medium之类的出版物上实际使用，因为这被认为是一种商业用途。</p><p id="8bed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我决定尝试使用我在处理工业传感器和制造过程数据时遇到的异常类型来生成自己的多元数据集…</p><p id="1f05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我鼓励你跟随这篇博文，浏览GitHub来获得这个系列的Jupyter笔记本<a class="ae ky" href="https://github.com/michaelhoarau/smarter-anomaly-detection" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"/></a>。你可以使用你常用的Jupyter环境，或者用Amazon SageMaker创建一个。在您克隆了repo之后，您可以打开第一个文件(<code class="fe mk ml mm mn b">synthetic_0_data_generation.ipynb</code>)并按照本文进行操作。</p><h1 id="e0a0" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">初始化</h1><p id="a739" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我们将从头开始构建数据集，仅使用基本的Python库:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="65fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里没有什么特别的:数据处理库(<code class="fe mk ml mm mn b">numpy</code>和<code class="fe mk ml mm mn b">pandas</code>)、<code class="fe mk ml mm mn b">random</code>生成器库和<code class="fe mk ml mm mn b">matplotlib</code>来可视化我们的时间序列。在处理日期操作时，我喜欢使用<code class="fe mk ml mm mn b">relativedelta</code>方法:当涉及到在给定信号中组合几种类型的异常时，我们将使用它。</p><p id="f576" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了这个，我们就可以开始了！让我们从生成我们的时间序列的基本信号开始…</p><h1 id="3f3e" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">生成基线</h1><p id="b8b6" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我们将首先定义数据集的范围:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="a78d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想以10分钟的常规采样率生成一年的数据。然后，我用这个日期时间索引生成一个空的数据帧。</p><h2 id="874f" class="nn mp it bd mq no np dn mu nq nr dp my li ns nt na lm nu nv nc lq nw nx ne ny bi translated">随机生成值</h2><p id="2da3" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">您的第一反应可能是沿着我们刚刚创建的日期时间轴生成随机值:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="7489" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码产生以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/ccec734115bb20574f55ea1b7f11d836.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bYz099IkQU6HnRn3F4tgEA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">随机值生成(图片由作者提供)</p></figure><p id="7f4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种白噪声看起来不真实:没有模式可寻，使用这种方法产生多个信号来合成多变量数据集对于模拟真实过程不是很有用。如果你在测量一台机器的温度，数值不会如此混乱地变化。<em class="mj">这就是随机漫步发挥作用的地方……</em></p><h2 id="13d9" class="nn mp it bd mq no np dn mu nq nr dp my li ns nt na lm nu nv nc lq nw nx ne ny bi translated">利用随机漫步过程</h2><p id="1913" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">真实的数据应该显示模式:在给定的时间点，一个值实际上会与以前的值有某种程度的关系。在概率学中，随机行走是在给定向某个方向移动的概率的情况下，确定对象的可能位置(这里是我们的时间序列的值)的过程。</p><p id="2506" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我用来生成随机游走的函数:我的时间序列从一个初始值(<code class="fe mk ml mm mn b">start</code>)开始，然后我随机添加一个量(<code class="fe mk ml mm mn b">step</code>)。我可以使用<code class="fe mk ml mm mn b">min_value</code>和<code class="fe mk ml mm mn b">max_value</code>参数将我的时间序列约束在一定范围内。我也可以玩概率<code class="fe mk ml mm mn b">probability</code>来给我的时间序列一个减少或增加的趋势:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="bede" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们生成几个图来可视化我们可以获得的行为:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="22c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是这段代码的结果图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/25cba368403643e9ee9d2cd9a08096e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aHCoemE_UbJ96cIwt2c-Iw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">随机漫步生成的时间序列(图片由作者提供)</p></figure><p id="68e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这看起来好多了:这些信号实际上看起来很真实！我现在将使用该函数为位于不同范围内的20个信号的多元数据集生成基线<strong class="lb iu">(我对此使用不同的初始值)。这将模拟测量过程不同维度的传感器数据(例如)。这是我得到的结果:</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/1df1897329ced77f5fba5291abcd648b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3hy-p9tPBD0rNgUZUiuVXQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用随机游走过程生成的多元数据集的基线(图片由作者提供)</p></figure><p id="0174" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们现在添加一些异常在那里…</p><h1 id="ab87" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">添加异常</h1><h2 id="2db7" class="nn mp it bd mq no np dn mu nq nr dp my li ns nt na lm nu nv nc lq nw nx ne ny bi translated">添加电平转换</h2><p id="665e" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">当一个过程或一系列设备经历不同的操作模式时，可以看到时间序列数据中的电平移动。当环境条件经历突然变化时，这也可能发生。下面是我用来模拟作为Pandas系列输入的给定信号电平转换的函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="fb89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此功能允许您在给定的时间点(在<code class="fe mk ml mm mn b">start</code>和<code class="fe mk ml mm mn b">end</code>之间)向一个方向(<code class="fe mk ml mm mn b">magnitude_shift</code>)移动给定时间序列的一部分。当一个转变发生时，你的信号也可能更平滑(<code class="fe mk ml mm mn b">magnitude_multiply</code> &lt; 1.0)或者更混乱(<code class="fe mk ml mm mn b">magnitude_multiply</code> &gt; 1.0)。</p><p id="f795" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有两个由该函数产生的电平转换示例:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/6a8f916182e655d40e560f886ee9b324.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U5Dh9ik2XLqg12SFXjussA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">电平转换示例(图片由作者提供)</p></figure><p id="33a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第一个信号上，我们增加了一个正电平移动和一个平滑的信号。在第二种情况下，电平移动是负的，我们在这个时间范围内模拟一个更混乱的行为。</p><p id="9857" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是生成该图的相关代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="ba73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我将使用该函数向随机选择的三个信号添加两个随机电平转换。我还会将另一个随机电平移动添加到五个其他信号中，这些信号也是随机选择的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/0103b0272bb49b542089ef4adf260ba4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MWoJX6IXIGZW_s-teqkSNg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">添加了随机等级偏移的多元数据集(图片由作者提供)</p></figure><p id="406b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种异常很常见，但是很容易发现。现在，让我们看看如何将渐变添加到信号中，以模拟过程的缓慢退化…</p><h2 id="6797" class="nn mp it bd mq no np dn mu nq nr dp my li ns nt na lm nu nv nc lq nw nx ne ny bi translated">添加趋势或渐变</h2><p id="dc12" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">为了给时间序列添加渐变，我使用了以下函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="ad5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基本上，我生成一个新的随机行走，用一个<code class="fe mk ml mm mn b">degradation_slope</code>修改随机行走概率，用一个<code class="fe mk ml mm mn b">degradation_speed</code>修改随机行走步骤。使用此函数，我将对我的多元数据集中随机选择的一些信号添加几个降级(参见下面的紫色和黄色信号):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/c1383d267dba976ba0c29ac31cff4bcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1xnF4SVBapXA_wPXnO_zTQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">添加了缓慢降解的多元数据集(图片由作者提供)</p></figure><h2 id="9bcf" class="nn mp it bd mq no np dn mu nq nr dp my li ns nt na lm nu nv nc lq nw nx ne ny bi translated">添加灾难性故障</h2><p id="afc6" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">通常，在数据集中出现缓慢的退化模式后，灾难性的故障可能随之而来。为了模拟这种情况，我将在退化模式后立即将几个信号设置为0.0。对此我有一个非常简单的函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="296c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看我的笔记本，看看我是如何在我们刚刚生成的降级模式之后添加这些故障的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/800af1d70e732fa4d77423884a399518.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I6pTDcP11tQ02pX5tYvY1w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">添加了突发故障的多元数据集(图片由作者提供)</p></figure><p id="50b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧！如果您想查看在这种类型的数据集上训练和评估异常检测模型的示例，请查看以下文章:</p><div class="oc od gp gr oe of"><a rel="noopener follow" target="_blank" href="/your-anomaly-detection-model-is-smarter-than-you-think-c1cade5fcabe"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd iu gy z fp ok fr fs ol fu fw is bi translated">你的异常检测模型比你想象的要聪明</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">多变量时间序列异常检测模型可以提供丰富的见解，如果你投资一些时间在后处理…</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">towardsdatascience.com</p></div></div><div class="oo l"><div class="op l oq or os oo ot ks of"/></div></div></a></div><div class="oc od gp gr oe of"><a rel="noopener follow" target="_blank" href="/top-3-ways-your-anomaly-detection-models-can-earn-your-trust-f59072a6199c"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd iu gy z fp ok fr fs ol fu fw is bi translated">异常检测模型赢得您信任的三大方法</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">将异常检测模型结果连接回原始信号</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">towardsdatascience.com</p></div></div><div class="oo l"><div class="ou l oq or os oo ot ks of"/></div></div></a></div><h1 id="4dbb" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">结论</h1><p id="3dcb" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">在本文中，您了解了如何利用一些合成生成技术来创建具有真实外观的多元时间序列数据。</p><p id="07c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你觉得这篇文章很有见地:如果你不想错过我即将发布的帖子，请随时在这里给我留下评论，并不要犹豫订阅我的<a class="ae ky" href="https://michoara.medium.com/subscribe" rel="noopener"> <strong class="lb iu">中型电子邮件源</strong> </a>！想支持我和以后的工作？<strong class="lb iu">通过我的推荐链接加入Medium </strong>:</p><div class="oc od gp gr oe of"><a href="https://michoara.medium.com/membership" rel="noopener follow" target="_blank"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd iu gy z fp ok fr fs ol fu fw is bi translated">通过我的推荐链接加入Medium-Michal Hoa RAU</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">michoara.medium.com</p></div></div><div class="oo l"><div class="ov l oq or os oo ot ks of"/></div></div></a></div></div></div>    
</body>
</html>