<html>
<head>
<title>Tinkering with the USDA Food Database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">修补美国农业部的食品数据库</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tinkering-with-the-usda-food-database-5db92f7f044f#2022-10-25">https://towardsdatascience.com/tinkering-with-the-usda-food-database-5db92f7f044f#2022-10-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8ba6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为机器学习算法和进一步的统计分析准备美国农业部食品数据中心数据库。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/82638072c03dc666507ebcb94a277a2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*U94q4IjQtkpEseVi"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@brunoschagas?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Bruno Scramgnon </a>拍摄的照片</p></figure><p id="a705" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们大多数人都熟悉食品上的营养标签。即使我们没有真正读它们，我们也知道它们在那里。情况并不总是如此。直到20世纪70年代初，大多数食品中都没有营养标签。直到20世纪90年代初，它们才成为强制性的。今天，一些食物甚至在营养标签上标明了必需氨基酸的含量。现在有一种明显的趋势，那就是对我们放进嘴里的食物的成分和化学成分有更多的了解。</p><p id="bcdc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想知道，这个故事不是关于营养建议的。我不会告诉你什么该吃，什么不该吃。如果你正在寻找这样的建议，这个故事不适合你，抱歉。</p><p id="d614" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">营养标签在一定程度上是有帮助的，但是如果我们想了解更多呢？作为数据科学家，如果我们想更深入地挖掘营养数据会怎样？嗯，我们首先需要数据。<a class="ae ky" href="https://fdc.nal.usda.gov" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">美国农业部食品数据中心</strong> </a>数据库是一个很好的选择。</p><p id="67c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据科学家和开发人员为制造分析工具以使消费者更容易获得营养信息所做的一切努力都会产生重大影响。</p><p id="fc44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个故事中，我与你分享我在不得不修补这个数据库的几天中构建的工具。我希望这些工具可以帮助你分析食物数据库，如果运气好的话，还可以在营养领域创建你自己的模型和工具。故事的主要范围是<strong class="lb iu">将<strong class="lb iu">数据</strong>构造成简单的<strong class="lb iu">平面数据帧</strong>，以用于使用<strong class="lb iu">机器学习和优化算法的进一步分析。</strong></strong></p><h2 id="48d5" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">故事结构</h2><ul class=""><li id="98ce" class="mo mp it lb b lc mq lf mr li ms lm mt lq mu lu mv mw mx my bi translated">数据库版本和文档</li><li id="414e" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">数据库许可</li><li id="b5a2" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">形成原始营养数据</li><li id="8e51" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">营养细节数据</li><li id="e077" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">营养<em class="ne"> id </em> vs. <em class="ne">营养_编号</em></li><li id="0862" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">搜索营养名称</li><li id="a3b7" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">搜索食物名称</li><li id="6249" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">活力</li><li id="50da" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">大量要素</li><li id="d8d0" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">质量守恒</li><li id="dc97" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">阿特沃特通用因子系统</li><li id="f2e8" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">最大无NaN数据框架</li><li id="61b1" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">结构化数据创建</li><li id="1ade" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">最后的话</li></ul><p id="ce11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">数据库版本和文档</strong></p><p id="4dff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可通过以下链接查阅美国农业部食品数据中心数据库:</p><p id="7d0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://fdc.nal.usda.gov" rel="noopener ugc nofollow" target="_blank">https://fdc.nal.usda.gov</a></p><p id="4219" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并可在此下载:</p><p id="b0cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://fdc.nal.usda.gov/download-datasets.html" rel="noopener ugc nofollow" target="_blank">https://fdc.nal.usda.gov/download-datasets.html</a></p><p id="4af5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个故事中使用的数据库是2021年10月<strong class="lb iu">的CSV版本，所有数据类型的完整下载</strong>。</p><p id="752b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下载的目录(<code class="fe nf ng nh ni b">FoodData_Central_csv_2021–10–28</code>)中，有一个文件:</p><p id="24c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nf ng nh ni b">Download &amp; API Field Descriptions October 2021.pdf</code></p><p id="9e15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">…它描述了每个表以及表之间的关系。我们在下文中将该文件称为<strong class="lb iu">文档</strong>，并将下载的目录称为<strong class="lb iu">数据库目录</strong>。</p><p id="f647" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">数据库许可</strong></p><p id="0535" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该数据库是在<strong class="lb iu">公共领域，</strong>因此它<strong class="lb iu"> </strong>是<a class="ae ky" href="https://fdc.nal.usda.gov/api-guide.html" rel="noopener ugc nofollow" target="_blank">没有版权</a>。然而，</p><blockquote class="nj"><p id="e780" class="nk nl it bd nm nn no np nq nr ns lu dk translated">如果开发者将FoodData Central列为数据来源，美国农业部将不胜感激。而且，如果可能的话，美国农业部希望看到使用这些数据的产品，或者被告知它们的用途</p><p id="ccd3" class="nk nl it bd nm nn no np nq nr ns lu dk translated"><a class="ae ky" href="https://fdc.nal.usda.gov/api-guide.html" rel="noopener ugc nofollow" target="_blank">美国农业部食品数据中心许可</a></p></blockquote><p id="8661" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated"><strong class="lb iu">格式化原始营养数据</strong></p><p id="b2b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个故事的主要目标是为数据挖掘和机器学习算法创建食物营养结构化数据。换句话说，我们希望生成以食物项目为索引的平面数据框架，以营养成分为特征(列)。</p><p id="1c0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据库目录中有一个名为<code class="fe nf ng nh ni b">food_nutrient.csv</code>的文件。该文件包含对我们很重要的三列:</p><ul class=""><li id="fc6f" class="mo mp it lb b lc ld lf lg li ny lm nz lq oa lu mv mw mx my bi translated"><code class="fe nf ng nh ni b">fdc_id</code>:数据库中每种食品的唯一通用id。</li><li id="8886" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe nf ng nh ni b">nutrient_id</code>:营养素相关表中每种营养素的id。</li><li id="b0e6" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe nf ng nh ni b">amount</code>:每100克食物的营养素含量。营养素的单位在另一个表中，可以使用<code class="fe nf ng nh ni b">nutrient_id</code>查阅。我们将在后面的故事中这样做。</li></ul><p id="cc55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们加载表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="bfd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在此定义您的目录路径。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/236b6bdb6efeafbf1f555b58501cfbea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ElICqS48P32N8tRj8adtEQ.png"/></div></div></figure><p id="e73c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个表有重复的fdc _ ids，因为一种食物有很多营养成分。所以我们用<code class="fe nf ng nh ni b">fdc_id</code>和<code class="fe nf ng nh ni b">nutrient_id</code>对营养成分进行分组:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/105f764459a373dd62ca2585cd1c6974.png" data-original-src="https://miro.medium.com/v2/resize:fit:458/format:webp/1*He58Nz7AS8hhKHwXOYQnXQ.png"/></div></figure><p id="2a35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个<code class="fe nf ng nh ni b">pandas MultiIndex</code>，所以现在我们拆分<code class="fe nf ng nh ni b">MultiIndex</code>，在多索引的第二层创建营养列:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/2f3475deee1d642c5a60f91cab706dfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Y5rOQhIEMwNPWJFi3dFKQ.png"/></div></div></figure><p id="6e1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个数据帧是我们想要的原始数据，大概是我们想要的格式。索引是每种食物的id——<code class="fe nf ng nh ni b">fdc_id</code>,每一列是一个<code class="fe nf ng nh ni b">nutrient_id</code>。我们必须理解它，并开发工具来使用它。</p><p id="c82e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，有很多<code class="fe nf ng nh ni b">NaN</code>价值观。因此出现了第一个问题:</p><p id="1306" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nf ng nh ni b">NaN</code>值是指零营养测量值还是简单的缺失测量值？</p><p id="739b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们检查数据帧中是否有实际的零:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><blockquote class="og oh oi"><p id="34ad" class="kz la ne lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi translated">真实的</p></blockquote><p id="aa4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以断定<strong class="lb iu">零测量值被报告为0 </strong>，<code class="fe nf ng nh ni b"><strong class="lb iu">NaN</strong></code> <strong class="lb iu">值为缺失测量值</strong>。我可能已经猜到了，但这是很好的彻底。</p><p id="2ba0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">营养详细数据</strong></p><p id="7d58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要理解上一节的<code class="fe nf ng nh ni b">df_nutrients</code>中的列id。为此，我们将加载描述每种营养素的表格。该表在<code class="fe nf ng nh ni b">nutrient.csv</code>下的数据库目录中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/46edd1b502ef30336c59473afa3f12f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*keFGbXP5E4DJTLOswEiL_Q.png"/></div></figure><p id="1d68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将这个数据帧命名为<code class="fe nf ng nh ni b">df_nutrients_details</code>。该数据框包含营养物的<code class="fe nf ng nh ni b">name</code>，用于测量的单位(<code class="fe nf ng nh ni b">unit_name</code>)两个不同的标识符<code class="fe nf ng nh ni b">id</code>和<code class="fe nf ng nh ni b">nutrient_nbr</code>。</p><p id="9b3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">营养<em class="ne"> id </em> vs. <em class="ne">营养_编号</em>T39】</strong></p><p id="cd1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据文件，<code class="fe nf ng nh ni b">food_nutrient.csv</code>表中的<code class="fe nf ng nh ni b">nutrient_id</code>应为<code class="fe nf ng nh ni b">df_nutrient_details</code>中的<code class="fe nf ng nh ni b">id</code>。但是还有其他的可能性。<code class="fe nf ng nh ni b">df_nutrient_details</code>中还有一个<code class="fe nf ng nh ni b">nutrienr_nbr</code>，这个有点混乱。</p><p id="3f6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nf ng nh ni b">nutrient_id</code>有三种可能，可能是:</p><ol class=""><li id="da90" class="mo mp it lb b lc ld lf lg li ny lm nz lq oa lu on mw mx my bi translated">来自<code class="fe nf ng nh ni b">df_nutrients_details</code>的<code class="fe nf ng nh ni b">id</code>索引。</li><li id="aab1" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu on mw mx my bi translated"><code class="fe nf ng nh ni b">nutrient_nbr</code>出自<code class="fe nf ng nh ni b">df_nutrients_details</code>。</li><li id="2425" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu on mw mx my bi translated"><code class="fe nf ng nh ni b">id</code>和<code class="fe nf ng nh ni b">nutrient_nbr</code>都有。</li></ol><p id="944f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要在进一步行动前搞清楚这一点。</p><p id="5feb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在得出结论之前，我们需要解决一些问题。</p><p id="b4a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，营养素_ ids的范围是什么？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><blockquote class="og oh oi"><p id="95b4" class="kz la ne lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi">(203, 2063)</p></blockquote><p id="d9bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nf ng nh ni b">df_nutrients_details</code>中<code class="fe nf ng nh ni b">id</code>的范围是什么？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><blockquote class="og oh oi"><p id="cc02" class="kz la ne lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi">(1001, 2064)</p></blockquote><p id="2ea9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nf ng nh ni b">nutrient_nbr</code>的范围是什么？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><blockquote class="og oh oi"><p id="f06a" class="kz la ne lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi">(200, 958)</p></blockquote><p id="f607" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看来<code class="fe nf ng nh ni b">nutrient_id</code>既是<code class="fe nf ng nh ni b">id</code>又是<code class="fe nf ng nh ni b">nutrient_nbr</code>。让我们进一步调查一下。</p><p id="316d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nf ng nh ni b">df_nutrients</code>列中的所有假设id都在实际id中吗？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><blockquote class="og oh oi"><p id="3e96" class="kz la ne lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi translated">真实的</p></blockquote><p id="5236" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nf ng nh ni b">df_nutrients</code>栏中所有假设的营养素参考值都在实际营养素参考值中吗？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><blockquote class="og oh oi"><p id="821a" class="kz la ne lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi translated">真实的</p></blockquote><p id="2808" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们假设，其实<code class="fe nf ng nh ni b">id</code>和<code class="fe nf ng nh ni b">nutrient_nbr</code>可以互换使用。如果是这种情况，对于给定的食物，假定的id列和假定的nutrient_nbr列之间不能有重叠。换句话说，一个单一的营养测量要么通过它的<code class="fe nf ng nh ni b">id</code>要么通过它的<code class="fe nf ng nh ni b">nutrient_nbr</code>来说明，但不能同时通过两者来说明。</p><p id="dfcf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，问题来了:营养素_nbrs和id有重叠吗:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><blockquote class="og oh oi"><p id="b2f9" class="kz la ne lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi translated">错误的</p></blockquote><p id="aff2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我们可以假设<code class="fe nf ng nh ni b">id</code>和<code class="fe nf ng nh ni b">nutrient_nbr</code>是可以互换的。因此，我们将把<code class="fe nf ng nh ni b">nutrient_nbr</code>列转换成id，并在下文中将这些id称为<code class="fe nf ng nh ni b">nutrient_id</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/d0eb9b0422cc371edc207e830a414158.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CGJrNVZYYEPJP_otbAjg3Q.png"/></div></div></figure><p id="cbe9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还会将<code class="fe nf ng nh ni b">df_nutrients</code>列转换为整数类型，并删除任何没有营养测量的食物:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="bad0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">搜索营养素名称</strong></p><p id="4fbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在是时候写一些真正的代码了。我们想开始理解营养数据框架。到目前为止，<code class="fe nf ng nh ni b">nutrient_id</code>专栏并没有对我们说太多。我们需要能够通过名称搜索营养物质，然后获得它们的<code class="fe nf ng nh ni b">nutrient_id</code>。</p><p id="4f78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用复杂的<code class="fe nf ng nh ni b">pandas</code>链式方法来搜索和过滤<code class="fe nf ng nh ni b">df_nutrients_details</code>中的数据，从而搜索营养名称。然而，最好编写一个类来以简单的方式处理它，并避免每次我们想要执行搜索时编写熊猫链。一开始，编写我们自己的类可能看起来比较长，但是相信我，它会简化以后的事情。</p><p id="78b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是<code class="fe nf ng nh ni b">NutrientSearch</code>类:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="4793" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看它是做什么的，它是如何做到的，以及为什么。</p><p id="b971" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该类用<code class="fe nf ng nh ni b">df_nutrients_details</code>和<code class="fe nf ng nh ni b">df_nutrients</code>初始化。这就是我们需要的全部信息。只有两个公共方法，<code class="fe nf ng nh ni b">search_nutrient</code>，它允许我们按名称搜索养分:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/559ec63dd48b8f9f8e897cad0f656060.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*DdQtFGvHjHcnqKYy1Ke01Q.png"/></div></figure><p id="cbc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有<code class="fe nf ng nh ni b">get_all_nutrients</code>法，列出了所有营养成分:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/b8f49cc80fa9959a50b6213bc4dc7522.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*RLRxiyPdAos2gqkd1fg_jg.png"/></div></figure><p id="97e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两种方法都有两个可选的布尔夸尔:</p><ul class=""><li id="7e36" class="mo mp it lb b lc ld lf lg li ny lm nz lq oa lu mv mw mx my bi translated"><code class="fe nf ng nh ni b">valid_nutrient</code>:如果<code class="fe nf ng nh ni b">True</code>，我们检查营养素是否在<code class="fe nf ng nh ni b">df_nutrients</code>栏中。毕竟，对于一种数据中不存在的营养物质，我们没有多大用处。</li><li id="c353" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe nf ng nh ni b">n_foods</code>:如果<code class="fe nf ng nh ni b">True</code>，则在返回的数据帧中添加一列，列出每种营养没有<code class="fe nf ng nh ni b">NaN</code>测量的食物数量。</li></ul><p id="a6c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">返回的数据帧由<code class="fe nf ng nh ni b">id</code>索引，这是上一节描述的<code class="fe nf ng nh ni b">nutrient_id</code>。它有一个营养物栏<code class="fe nf ng nh ni b">name</code>和描述测量单位的<code class="fe nf ng nh ni b">unit_name</code>。记住，所有的测量都是以每100克食物为单位的。最后，前面讨论过的可选<code class="fe nf ng nh ni b">n_foods</code>列。</p><p id="ddfd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">类中的其他方法只是帮助处理实际的搜索、验证和计算<code class="fe nf ng nh ni b">n_foods</code>。</p><p id="72b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">搜索食物名称</strong></p><p id="1a0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要执行的下一个搜索是关于食物名称的。到目前为止，我们知道了<code class="fe nf ng nh ni b">df_nutrients</code>的每一行的fdc_id，但是这并不是很有用，除非我们给每个fdc_id分配一个食品名称。</p><p id="75b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也就是说，我们导入包含每种食物描述的<code class="fe nf ng nh ni b">food.csv</code>表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/d90698d45218bde4e8a77f8bc3e45df7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0XVQDVWocXAkBxqXbxYMpg.png"/></div></div></figure><p id="8a92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们必须注意此后的食品描述或食品名称，因为有重复的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><blockquote class="og oh oi"><p id="a0d1" class="kz la ne lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi translated">真实的</p></blockquote><p id="5d2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们找出每个<code class="fe nf ng nh ni b">data_type</code>的计数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/35f842cb1eaa3f60af5a78cbcf9172f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*SqdUc8xAp-oX4QpqCVC69Q.png"/></div></figure><p id="37c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大部分食物来自<code class="fe nf ng nh ni b">branded_food</code>。因此，我们将导入<code class="fe nf ng nh ni b">branded_food.csv</code>表以了解更多信息:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/21a1c8a5d701529a40b752d248bec8da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z2MX0Tryczv856LFGD_7TA.png"/></div></div></figure><p id="2bb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们需要编写另一个类来搜索食物名称。同样，我们会经常搜索食物名称，所以最好编写一次工具代码，简化我们的生活。</p><p id="a242" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是<code class="fe nf ng nh ni b">FoodNameSearch</code>类:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="9ac1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看它是做什么的，它是如何做到的，以及为什么。</p><p id="4aba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先用<code class="fe nf ng nh ni b">df_foods</code>、<code class="fe nf ng nh ni b">df_branded_foods</code>和<code class="fe nf ng nh ni b">df_nutrients</code>初始化该类。它有三个公共方法。<code class="fe nf ng nh ni b">search_by_name</code>，它允许我们输入一个字符串(或正则表达式)并返回一个<code class="fe nf ng nh ni b">pandas Series</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/eb844b041fab9035e7c2696980c5ae25.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*jK9tNnZczjCSpv3evUI-oQ.png"/></div></figure><p id="7cd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nf ng nh ni b">search_single_fdc_id</code>将fdc_id映射到food_name，它返回一个字符串:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><blockquote class="og oh oi"><p id="3f0d" class="kz la ne lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi translated">愚蠢的山羊和切达山羊奶酪通心粉和山羊奶酪，比萨饼和冰淇淋形状的意大利面，愚蠢的山羊和切达奶酪|纳什芬奇公司</p></blockquote><p id="6401" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，<code class="fe nf ng nh ni b">search_fdc_ids</code>接受fdc_ids的iterable并返回一个<code class="fe nf ng nh ni b">pandas Series</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/3a27fbbf15188a8d8e30e7398a7344a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*mDS1_O4aN0gceH1u0x0vlA.png"/></div></figure><p id="0b86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了位置参数之外，所有方法都有一个可选的布尔参数:<code class="fe nf ng nh ni b">valid_nutrients</code>。此标志控制是否仅包括无<code class="fe nf ng nh ni b">NaN</code>营养测量的fdc _ ids。毕竟，没有营养测量的食物对我们来说没有更多的用处。</p><p id="8c51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其他方法，私有方法，是助手。他们验证fdc _ ids并将<code class="fe nf ng nh ni b">brand_owner</code>数据添加到<code class="fe nf ng nh ni b">branded_food</code>名称中。对于品牌食品，在食品名称和品牌所有者之间插入一个“|”。这样做是为了帮助消除歧义，但仍然不能保证产生不重复的食品名称。</p><p id="e804" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">能量</strong></p><p id="f4d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事不宜迟，让我们开始数据清理的第一步。在本节中，我们将了解能量测量的意义。目标是通过由<code class="fe nf ng nh ni b">fdc_id</code>索引的<code class="fe nf ng nh ni b">Series</code>产生食物的单一能量测量。</p><p id="bdfe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用我们闪亮的新<code class="fe nf ng nh ni b">NutrientSearch</code>类来寻找能量营养素:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/559ec63dd48b8f9f8e897cad0f656060.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*DdQtFGvHjHcnqKYy1Ke01Q.png"/></div></figure><p id="4913" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据库中有四个能量测量值。普通能量<em class="ne">千卡，这是大多数食物使用的热量。另一个<em class="ne">能量</em>以kJ(千焦)为单位。最后，两份<a class="ae ky" href="https://en.wikipedia.org/wiki/Atwater_system" rel="noopener ugc nofollow" target="_blank">阿特沃特</a>能量，很少的食物。</em></p><p id="f387" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也就是说，让我们创建一个只有能量测量值的数据框架:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/1e732b37fb5344e1420efe07b6b53996.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*e9O4MPJ9edDU7jfgt7f0Iw.png"/></div></figure><p id="8c10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并将千焦能量转化为千卡能量:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/b7cfba5c093525a406fe29eadbfb0338.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*jQvOi_ExO5zwQtkm6A4oOA.png"/></div></figure><p id="b56b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">多少千焦能量测量值与千卡测量值重叠？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><blockquote class="og oh oi"><p id="db22" class="kz la ne lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi">7934</p></blockquote><p id="aa8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，几乎所有以kJ为单位的测量都是多余的。</p><p id="f709" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们希望放弃过高的能量测量值。根据<a class="ae ky" href="https://en.wikipedia.org/wiki/Atwater_system" rel="noopener ugc nofollow" target="_blank">阿特沃特通用因子系统</a>，每克能量最大的营养素是脂肪，9千卡/克，这些能量是针对100克食物测得的；因此，任何比900千卡大得多的测量值都可能是错误的，应该丢弃:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/64c707da3c8a8170f794ea238fab8319.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*wwCdllyHt08HJfQclsSnsw.png"/></div></figure><p id="b14d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将选择使用<code class="fe nf ng nh ni b">nutrient_id</code> 1008的能量测量作为能量的基础:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/c3f24a1a07692c47c5a4256e24a6c319.png" data-original-src="https://miro.medium.com/v2/resize:fit:406/format:webp/1*DHKoC35jCUrT7PI4ijFc2w.png"/></div></div></figure><p id="9698" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">宏量营养素</strong></p><p id="1ea8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">提供能量的三种最著名的常量营养素是:</p><ul class=""><li id="d651" class="mo mp it lb b lc ld lf lg li ny lm nz lq oa lu mv mw mx my bi translated">碳水化合物</li><li id="594e" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">脂肪</li><li id="f176" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">蛋白质</li></ul><p id="31f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">酒精在技术上被认为是提供能量的宏量营养素，但目前，我们将忽略它。</p><p id="04ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本节中，我们希望为这三种宏量营养素生成三个<code class="fe nf ng nh ni b">Series</code>地面实况。</p><p id="9aca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们先搜索一下脂肪:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/e5e5ea024aa1b99ccaa9b080cb06ce1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*UNQkDFG7kehmbE3d6IsARg.png"/></div></figure><p id="77aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">显然，<code class="fe nf ng nh ni b">nutrient_id</code> 1004正是我们想要的，因为它存在于大多数食物中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/e25f5784e5f6a39159bc0e04ad6ee2e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:404/format:webp/1*ojDC5EV-V-q_alPSn4owpA.png"/></div></figure><p id="7e8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，蛋白质呢:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/6d6762134776ea3ef269970b2d28107d.png" data-original-src="https://miro.medium.com/v2/resize:fit:518/format:webp/1*aMx6qOvuwi59kuy41sdG-A.png"/></div></figure><p id="fc75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里没有太多选择:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/8692a4abfe34f9561d13bc1f3448d6c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:398/format:webp/1*Y8XXH1-HHVYGp8mJxGMpVA.png"/></div></figure><p id="793a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，让我们搜索碳水化合物:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/800a4a3de4b8a69d430a530b01dae6dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*0nIF9UOCDeF2lz6N7giICQ.png"/></div></figure><p id="63ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大多数食物中都含有1005，所以我们将使用它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/454824cdfd0b66814e6714e1e3b52b6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:402/format:webp/1*-jBO3xBUgKNNnDbHcdQyZg.png"/></div></figure><p id="44cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">质量守恒</strong></p><p id="21c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了进一步清理数据，我们希望找出大于100克的质量测量值。记住，所有的测量都是以每100克食物为单位的。因此任何测量的报告质量都不能超过这个值。</p><p id="d652" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="http://toolbox.foodcomp.info/ToolBox_Carbohydrate.asp" rel="noopener ugc nofollow" target="_blank">食物质量</a>由上一节讨论的三种常量营养素的质量加上下列物质的质量组成:</p><ul class=""><li id="461e" class="mo mp it lb b lc ld lf lg li ny lm nz lq oa lu mv mw mx my bi translated">酒精</li><li id="67d0" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">纤维</li><li id="4379" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">水</li><li id="560b" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">灰</li></ul><p id="17ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">寻找这些营养物质:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/ecc878808ecf69c15e1da04c1252c990.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*UP-OCVMLaJTmWg7K8dVffA.png"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/156ac35d06dd2180ae7927b657ff8f91.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/1*YYZiEnC1yqCvAAI-ZGuelw.png"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/44e36756c4c9bf05b0b39fa4c0bb870b.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*G8uWThcnLNoAGSLQMt4nmg.png"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/0826aa6b7b28c29a9392916462742fff.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*W09NLLwILhWUgQWYeUEagw.png"/></div></figure><p id="ec0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们生产他们的<code class="fe nf ng nh ni b">Series</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="6657" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，所有这些系列的测量单位都是克。</p><p id="d4f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将假设这些序列的‘T2’值实际上为零。这样做没有害处，因为如果未测量的值大于零，这将增加质量，而不是减少质量。</p><p id="6328" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将连接上一节的碳水化合物、脂肪和蛋白质系列，然后将酒精、纤维、水和酒精的质量设置为零，除非它们不是<code class="fe nf ng nh ni b">NaN</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/9af3b38629b2152f3c298b93e42e39ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*jmsyjLxdCXOveYQpYkuJCQ.png"/></div></figure><p id="af8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们对每行的质量求和:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/5add0bf098fbef9a92f0944f6b1c7d9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:346/format:webp/1*wVNo-pX7x25dVQoalmt1iQ.png"/></div></div></figure><p id="61b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">显然，有些质量差得很远。</p><p id="18fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们删除所有质量大于100的fdc _ ids:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/fb1c354f06019b7cea9e1690865aefa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:352/format:webp/1*tBnO7shG4FcjgynjN_Vqrg.png"/></div></figure><p id="0a3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是总质量的分布情况:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/3c431fa5a79a1cddbce93d74bbf1dd71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*-SKDv4lsB4sJsweToB1NYA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">总质量直方图[图片由作者提供]。</p></figure><p id="6146" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有很多质量不是100。这可能有许多原因:</p><ul class=""><li id="b0ac" class="mo mp it lb b lc ld lf lg li ny lm nz lq oa lu mv mw mx my bi translated">也许有一些质量营养素被我们忽略了，或者我们使用了不同的<a class="ae ky" href="http://toolbox.foodcomp.info/ToolBox_Carbohydrate.asp" rel="noopener ugc nofollow" target="_blank">质量术语</a>。</li><li id="27dd" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">也许一些质量测量是错误的。</li></ul><p id="78e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将假设前者并继续下去。如果我们假设是后者，我们最终会放弃很多食物。</p><p id="6fe9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了清理数据，我们需要从先前生成的数据中删除任何没有通过质量守恒过滤器的fdc _ ids:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="180f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">阿特沃特通用因子系统</strong></p><p id="e83b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">食物中能量的计算方法有很多。最简单的，也许是最常用的，是<a class="ae ky" href="https://en.wikipedia.org/wiki/Atwater_system" rel="noopener ugc nofollow" target="_blank">阿特沃特通用因子系统</a>。该系统为每克碳水化合物、脂肪、蛋白质和酒精分配固定的能量值，并认为总能量是这些能量的总和。这些因素如下:</p><ul class=""><li id="9f49" class="mo mp it lb b lc ld lf lg li ny lm nz lq oa lu mv mw mx my bi translated">碳水化合物:4千卡/克</li><li id="7618" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">脂肪:9千卡/克</li><li id="f151" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">蛋白质:4千卡/克</li><li id="fbcc" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">酒精:7千卡/克(大约。)</li></ul><p id="4f36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其他系统包括作为能量项的纤维；其他人使用特定的因素。然而，为了简单起见，我们坚持使用通用因子系统。</p><p id="593c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑到这些营养成分，让我们创建一个包括它们的数据框架，以及报告的能量:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi po"><img src="../Images/983f35e7146cc7da005ec09fb42f0432.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*2KWfxyZPe_91urbY3G4N9A.png"/></div></figure><p id="c122" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们使用阿特沃特通用因子系统来估算能量:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="34ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些是能量、报告能量和估计能量的描述性统计数据:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/d3ff4f65726a7c28337e8a03f5740b06.png" data-original-src="https://miro.medium.com/v2/resize:fit:424/format:webp/1*P2fRu8opLsnrsbndAAJZFw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">能源的描述性统计。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/02e2b4692c4fcc60a1e16e09de84765d.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/format:webp/1*rnEBKks5DkBK_m1VZeoGLg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用阿特沃特通用因子进行能量估算的描述性统计。</p></figure><p id="43f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是两种能量的直方图和另一种能量差的直方图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pr"><img src="../Images/0fed112517cf07761ea20692fc0d2f1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3H1Mlon-y5_2NsOCqu3ARQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">报告的能量直方图，使用阿特沃特通用因子系统估算的能量直方图，以及它们之间的差异直方图[图片由作者提供]。</p></figure><p id="8ba3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到，大多数报道的能量倾向于与阿特沃特估计的能量一致，但不完全一致。</p><p id="a4cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使进一步的宏量营养素计算更容易，我们将放弃报告的能量，而使用阿特沃特能量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/df9ca0d3b6f0580b73e6f93088e318b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*kJbR4HC5OVtFSjdiGfjAvA.png"/></div></figure><p id="c9d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们制作了一个名为<code class="fe nf ng nh ni b">df_emacros</code>的数据框架，包含能量和常量营养素(能量常量营养素)的基本事实。</p><p id="dc82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有食物都必须有能量和常量营养素的测量值。因此，我们将删除所有先前生成的数据中不在<code class="fe nf ng nh ni b">df_emacros</code>中的所有fdc _ ids:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="1a2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们从<code class="fe nf ng nh ni b">df_nutrients</code>中删除能量、碳水化合物、脂肪、蛋白质和酒精的所有营养标识。因为我们现在在<code class="fe nf ng nh ni b">df_emacros</code>中已经有了这些测量值</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="fc70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这一节和上一节中，我们已经对数据做了许多更改，所以现在应该重新实例化我们的搜索类，以包含最新的数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="5f8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">最大无NaN数据帧</strong></p><p id="31e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当试图从“df_nutrients”中去除NaN值时，我们将面临一个问题。问题是，我们可以很容易地在数据帧的所有行和列中找到由任何给定的营养成分创建的nan。</p><p id="ca77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们稍微偏离一下数据，使用简单的数据框架来关注这个问题。考虑这个数据框架:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/3e56a6f6820dd14624473af9f90b712d.png" data-original-src="https://miro.medium.com/v2/resize:fit:306/format:webp/1*-iOG1QY4jRID75HTa716uw.png"/></div></figure><p id="3da3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们对列或行使用<code class="fe nf ng nh ni b">dropna</code>方法，我们将得到一个空的数据帧。相反，我们想要一种算法，以这样一种方式删除列，即保持列最大化非<code class="fe nf ng nh ni b">NaN</code>行的数量。</p><p id="5766" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个例子中，如果我们删除<code class="fe nf ng nh ni b">B</code>列，我们将得到一个2x2的数据帧。</p><p id="b884" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们提出了一种贪婪算法来实现这一点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="7252" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">函数<code class="fe nf ng nh ni b">get_maximal_no_nan_df</code>实现算法。其他函数只是助手。<code class="fe nf ng nh ni b">get_maximal_no_nan_df</code>服用</p><ul class=""><li id="164a" class="mo mp it lb b lc ld lf lg li ny lm nz lq oa lu mv mw mx my bi translated">作为位置参数的数据帧。</li><li id="ddb6" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe nf ng nh ni b">min_data_size</code>夸尔格。它控制我们想要保留的最小行数。如果我们试图保留大多数行，该算法将丢弃许多列。相反，如果我们将其设置为较低的值，它将保留许多列。该值可以是大于或等于1的整数，也可以是小于1的浮点数。在前一种情况下，它被认为是行的字面数量；在后者中，它被视为总行数的一部分。</li></ul><p id="73dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事不宜迟，我们来测试一下算法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pt"><img src="../Images/062ffa9a716606f0a1dbadd2cbf38c95.png" data-original-src="https://miro.medium.com/v2/resize:fit:202/format:webp/1*1IVK29Wm7JseKJq8pnZl9Q.png"/></div></figure><p id="3859" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它像预期的那样工作。</p><p id="59f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">结构化数据创建</strong></p><p id="3191" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们拥有了创建适合进一步分析的结构化数据的所有元素。</p><p id="c013" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们获取所有的营养，只保留那些存在于一百多种食物中的营养:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pu"><img src="../Images/4150f97361fc8c3845c2ad476140190c.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*-wLWhPF8BA8iYEuLMGziLg.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pv"><img src="../Images/64f4def56a54f24dceeeda63b47723f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3uCMOZx3iBW3N9QkYMvGnA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">出现次数最多的营养素、大量营养素和能量不包括在内[图片由作者提供]。</p></figure><p id="043a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要再编写一个类来创建我们想要的数据帧，也就是说，具有选定营养成分的数据帧。我保证这是我们编写的最后一个类。这个类将使用上一节中的最大no <code class="fe nf ng nh ni b">NaN</code>算法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="4c07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个类用<code class="fe nf ng nh ni b">df_emacros</code>、<code class="fe nf ng nh ni b">NutrientSearch</code>类的一个实例和<code class="fe nf ng nh ni b">FoodNameSearch</code>类的一个实例初始化。所以它几乎使用了我们迄今为止开发的所有东西。</p><p id="a4dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它只有一个公共方法，<code class="fe nf ng nh ni b">create_data</code>。这个方法只有一个位置参数，一个可迭代的营养标识(任一列表，熊猫索引元组)。有许多夸尔格:</p><ul class=""><li id="d2a3" class="mo mp it lb b lc ld lf lg li ny lm nz lq oa lu mv mw mx my bi translated"><code class="fe nf ng nh ni b">no_nans</code>:如果设置为<code class="fe nf ng nh ni b">True</code>，则使用最大编号<code class="fe nf ng nh ni b">NaN</code>算法来保留尽可能多的列。否则，它会保留所有列以及所有的<code class="fe nf ng nh ni b">NaN</code>值。</li><li id="0411" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe nf ng nh ni b">with_nutrient_names</code>:是否将营养素id更改为实际营养素名称的列名。</li><li id="c93b" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe nf ng nh ni b">include_food_name</code>:是否包含食品名称列。在这两种情况下，生成的数据帧都由fdc_id进行索引。</li><li id="6086" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe nf ng nh ni b">shallow_valid_mass</code>:如果<code class="fe nf ng nh ni b">True</code>，将验证以克为单位测量的位置参数iterable中没有任何营养素大于100克。如果一些食物含有这种无效的营养成分，它将从结果数据框中被丢弃。</li><li id="cd4e" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe nf ng nh ni b">min_data_size</code>:与上一节<code class="fe nf ng nh ni b">get_maximal_no_nan_df</code>功能相同。</li></ul><p id="3365" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有的私有方法都是帮助者。</p><p id="0dab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们可以创建我们想要的格式的数据。让我们实例化该类并使用来自<code class="fe nf ng nh ni b">df_all_nutrient</code>"的所有索引(nutrient _ ids)；即大多数营养物质，至少是一百多种食物中的营养物质:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pw"><img src="../Images/dae204b74b295a29cd578233853299aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AOyz9pgYyiMFxM1wSt5vKQ.png"/></div></div></figure><p id="9f83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个数据帧没有<code class="fe nf ng nh ni b">Na</code>，我们设法保留了114行84列。减少营养元素的数量可能会创建具有更多行(食物项目)的数据帧。</p><p id="c3d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">最后的话</strong></p><p id="685f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们停止了对实际食物营养成分的进一步分析。那是故意的。首先，这个故事的想法不是告诉你什么该吃，什么不该吃。此外，这个故事太长了。</p><p id="47f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这里开发的工具可以帮助您在第一次清理和结构化数据时节省大量时间。从这里开始的路线图是生成含有选定营养成分的数据帧，以进一步分析食物成分。食物集群、食谱的食物元素推荐器和每日营养摄入优化器只是我头脑中的一些想法</p></div><div class="ab cl px py hx pz" role="separator"><span class="qa bw bk qb qc qd"/><span class="qa bw bk qb qc qd"/><span class="qa bw bk qb qc"/></div><div class="im in io ip iq"><p id="b9b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="ne">注:</em> </strong> <em class="ne">故事通篇所有数据帧和系列图像均为作者原创图像。</em></p></div><div class="ab cl px py hx pz" role="separator"><span class="qa bw bk qb qc qd"/><span class="qa bw bk qb qc qd"/><span class="qa bw bk qb qc"/></div><div class="im in io ip iq"><p id="b12a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这个故事对你有用。 <a class="ae ky" href="https://medium.com/subscribe/@diego-barba" rel="noopener"> <em class="ne">订阅</em> </a> <em class="ne">到我的邮件列表如果你想知道更多这样的故事。</em></p></div><div class="ab cl px py hx pz" role="separator"><span class="qa bw bk qb qc qd"/><span class="qa bw bk qb qc qd"/><span class="qa bw bk qb qc"/></div><div class="im in io ip iq"><p id="142c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ne">喜欢这个故事吗？通过我下面的推荐链接成为一个媒体成员来支持我的写作。无限制地访问我的故事和许多其他内容。</em></p><div class="qe qf gp gr qg qh"><a href="https://medium.com/@diego-barba/membership" rel="noopener follow" target="_blank"><div class="qi ab fo"><div class="qj ab qk cl cj ql"><h2 class="bd iu gy z fp qm fr fs qn fu fw is bi translated">通过我的推荐链接加入Medium-Diego Barba</h2><div class="qo l"><h3 class="bd b gy z fp qm fr fs qn fu fw dk translated">阅读迭戈·巴尔巴(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="qp l"><p class="bd b dl z fp qm fr fs qn fu fw dk translated">medium.com</p></div></div><div class="qq l"><div class="qr l qs qt qu qq qv ks qh"/></div></div></a></div></div></div>    
</body>
</html>