<html>
<head>
<title>Cost-Optimization Strategies within AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS中的成本优化策略</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/cost-optimisations-within-aws-72a9149c92e5#2022-09-07">https://towardsdatascience.com/cost-optimisations-within-aws-72a9149c92e5#2022-09-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e9d7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">考虑减少EC2、Lambda和S3的经常性费用</h2></div><p id="6a2f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在过去的四年里，我与亚马逊网络服务公司(Amazon Web Services)进行了广泛的合作，在我的圈子里经常出现的一个话题是在云中运行应用程序和数据库的成本。无论是在<a class="ae le" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank">简单存储服务</a> (S3)中存储数据的价格，保留<a class="ae le" href="https://aws.amazon.com/ebs/" rel="noopener ugc nofollow" target="_blank">弹性块存储</a> (EBS)卷的快照的价格，还是运行<a class="ae le" href="https://aws.amazon.com/ec2/" rel="noopener ugc nofollow" target="_blank">弹性云计算</a> (EC2)实例的价格，费用很容易累积，并在我们审查即将到来的账单时引起我们的注意。</p><p id="ed8c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">思考最近我在EC2、<a class="ae le" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> Lambda </a>和S3工作中应用的成本优化，让我们探索如何分析我们的费用并利用AWS的功能来减少我们的账单。这绝不是一篇独特的博文AWS和其他贡献者提供了大量的材料——但我希望它能成为未来参考的有用补充。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/cfcbf0c4f3bdb323d523cafd064bdf88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QL-VT0N-qpYFBYDR2NXH4w.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">来源:作者成本浏览器截图</p></figure><h1 id="e086" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">成本浏览器</h1><p id="7da0" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">在AWS控制台中，我们可以导航到<a class="ae le" href="https://aws.amazon.com/aws-cost-management/aws-cost-explorer/" rel="noopener ugc nofollow" target="_blank">成本浏览器</a>以了解我们现有的费用和预测的未来账单。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ms"><img src="../Images/3f2c424d74cf995048ad376948ecc40c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sIvwCohgsdMMWOT3YASbsA.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">来源:作者的AWS搜索截图</p></figure><p id="a4cd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将引导我们进入成本管理主页，在这里我们可以查看到目前为止AWS成本的高级图表。谢天谢地，我的个人账单看起来很健康，但商业账户可能会有明显更高的数字。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mt"><img src="../Images/4b0f20719d052057e405ee68ca221e1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j1bbkT63Y4rg9bMmViPqdw.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">来源:作者的成本管理截图</p></figure><p id="6b15" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">选择条形图上方的“在成本浏览器中查看”,我们将自己重定向到一个更复杂的图表，该图表具有分解费用的过滤器。按服务对成本进行分组，我们看到在我的案例中，税收对我的成本的贡献最大，其次是<a class="ae le" href="https://aws.amazon.com/kms/" rel="noopener ugc nofollow" target="_blank">关键管理服务</a> (KMS)。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mu"><img src="../Images/1ec5ada253aff3aa51a0f88c39131155.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S02EYcV53AjcZ6XYDiSPGw.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">来源:作者成本浏览器截图</p></figure><p id="4426" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一个可能证明特别有价值的分组是标签。通过应用于不同AWS资源的定义良好的标签键和值框架，按标签进行的计费细分对于更深入地了解AWS费用的来源非常有用——特别是如果资源是按部门、团队或不同的组织粒度层进行标记的话。</p><p id="c6c3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对我们的成本来源有了更好的理解，让我们从EC2开始，探索AWS在其几个最受欢迎的服务中提供了哪些功能来帮助我们减少账单。</p><h1 id="983c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">弹性云计算(EC2)</h1><p id="ff99" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">EC2覆盖了各种不同的资源，是一种伞式服务，用于服务器实例、<a class="ae le" href="https://aws.amazon.com/elasticloadbalancing/" rel="noopener ugc nofollow" target="_blank">流量负载平衡器</a>和<a class="ae le" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html" rel="noopener ugc nofollow" target="_blank">弹性网络接口</a>以及其他基础设施。实例可能需要持久存储，采用EBS卷的形式。此外，我们可能希望使用<a class="ae le" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html" rel="noopener ugc nofollow" target="_blank">机器映像</a>轻松启动与现有配置匹配的副本实例，或者我们可能希望使用快照保留<a class="ae le" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSSnapshots.html" rel="noopener ugc nofollow" target="_blank"> EBS卷的备份。</a></p><p id="886c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些不同的资源和策略的成本很容易攀升。首先从EC2实例开始，我们可以采用<a class="ae le" href="https://aws.amazon.com/savingsplans/compute-pricing/" rel="noopener ugc nofollow" target="_blank"> EC2实例节省计划</a>来降低特定实例类型和AWS区域的计算费用，或者探索<a class="ae le" href="https://aws.amazon.com/savingsplans/compute-pricing/" rel="noopener ugc nofollow" target="_blank">计算节省计划</a>来降低计算成本，而不考虑类型和区域。前者在编写时节省高达72%，而后者节省高达66%，并扩展到<a class="ae le" href="https://aws.amazon.com/fargate/" rel="noopener ugc nofollow" target="_blank"> ECS Fargate </a>和Lambda函数。</p><p id="8050" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">EC2还提供<a class="ae le" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instance-purchasing-options.html" rel="noopener ugc nofollow" target="_blank">不同的购买选项</a>以供举例。这包括<a class="ae le" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-reserved-instances.html" rel="noopener ugc nofollow" target="_blank">保留实例</a>，在这种情况下，我们可能会以较低的成本承诺一年或三年的特定配置，以及<a class="ae le" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-spot-instances.html" rel="noopener ugc nofollow" target="_blank">现场实例</a>，在这种情况下，如果我们乐意应用程序被中断，我们可能会支付明显较低的成本。</p><p id="831e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">考虑了实例购买和计算计划之后，我们可以将注意力转向EBS支持的机器映像和卷快照。<a class="ae le" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/snapshot-lifecycle.html" rel="noopener ugc nofollow" target="_blank">数据生命周期管理器</a>对于自动化这些资源的创建、保留和删除非常有用。但是，这不会管理通过其他方式创建的映像和快照，也不包括实例存储支持的映像。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mv"><img src="../Images/861161f009880b3fa722d545a6ee9df9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qn7pRrm0dYWh38BpmJ4IVA.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">来源:作者的数据生命周期管理器截图</p></figure><p id="cf7b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">虽然对降低成本没有帮助，但另一个值得强调的功能是EC2 <a class="ae le" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/recycle-bin.html" rel="noopener ugc nofollow" target="_blank">回收站</a>。如果我们手动删除图像和快照，或者依靠数据生命周期管理器，回收站可以作为一个安全网来避免意外删除资源—在可配置的时间内保留图像和快照，我们可以在它们被永久删除之前恢复它们。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mw"><img src="../Images/a574e2e27086c7b0ed71f92ae5796d5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JcyqOKc-7K8aUrFxuz8ssw.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">来源:作者EC2回收站截图</p></figure><h1 id="ff77" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">λ函数</h1><p id="f834" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">在讨论了EC2实例之后，让我们考虑一下前面提到的Lambda服务。与EC2不同，Lambda函数是无服务器的，因此主要考虑资源使用和配置，而不是供应成本。</p><p id="56cb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，让我们探索一下<a class="ae le" href="https://docs.aws.amazon.com/lambda/latest/dg/foundation-arch.html" rel="noopener ugc nofollow" target="_blank">指令集架构</a>的功能。2021年9月，AWS <a class="ae le" href="https://aws.amazon.com/blogs/aws/aws-lambda-functions-powered-by-aws-graviton2-processor-run-your-functions-on-arm-and-get-up-to-34-better-price-performance/" rel="noopener ugc nofollow" target="_blank">推出了Arm/Graviton2处理器</a>，用于全面上市，作为当前运行x86处理器的功能的更便宜、更高性能的替代品。AWS文档<a class="ae le" href="https://docs.aws.amazon.com/lambda/latest/dg/foundation-arch.html#foundation-arch-steps" rel="noopener ugc nofollow" target="_blank">建议了从x86切换到Graviton2的迁移步骤</a>，这对于节省初始成本是明智的。</p><p id="249a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一个更微妙的成本将我们的注意力转移到了<a class="ae le" href="https://aws.amazon.com/cloudwatch/" rel="noopener ugc nofollow" target="_blank"> CloudWatch </a>中Lambda的日志配置。默认情况下，Lambda会自动为其函数创建日志组，除非已经存在一个与名称<code class="fe mx my mz na b">/aws/lambda/{functionName}</code>匹配的组。这些默认组不配置日志保留期，让日志无限累积，增加了CloudWatch的成本。考虑使用匹配的名称和保留策略显式配置组，以维护可管理的日志量。</p><p id="4e59" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，同样重要的是，考虑Lambda函数的内存容量。Lambda <a class="ae le" href="https://aws.amazon.com/lambda/pricing/" rel="noopener ugc nofollow" target="_blank">根据以GB秒为单位的计算时间</a>收费，其中以秒为单位的持续时间是从函数代码执行时开始计算，直到它返回或终止，四舍五入到最接近的毫秒。为了减少这些时间，我们需要最佳的内存配置。<a class="ae le" href="https://docs.aws.amazon.com/lambda/latest/operatorguide/profile-functions.html" rel="noopener ugc nofollow" target="_blank"> AWS Lambda功率调谐</a>可以帮助识别这些优化，尽管考虑到底层使用<a class="ae le" href="https://aws.amazon.com/step-functions/" rel="noopener ugc nofollow" target="_blank"> AWS阶跃函数</a>会有显著的初始成本。</p><h1 id="df3a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">简单存储服务(S3)</h1><p id="6378" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">离开处理服务，让我们现在考虑S3境内的数据存储。持久化高达5TB的对象，S3使用“桶”来存储理论上无限数量的对象。没有默认的对象保留策略，因此存储桶大小可能会快速增长，从而增加我们的AWS账单。我们不仅要为我们存储的数据量付费，还要为我们使用的<a class="ae le" href="https://aws.amazon.com/s3/storage-classes/" rel="noopener ugc nofollow" target="_blank">S3存储类别</a>付费。</p><p id="1df7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有几种价格不同的课程可供选择。标准(默认)类是最昂贵的，允许对具有高可用性和短访问时间的对象进行常规访问。非频繁访问(IA)类降低了需要有限访问(通常每月一次)的数据的成本，而通过<a class="ae le" href="https://aws.amazon.com/s3/storage-classes/glacier/" rel="noopener ugc nofollow" target="_blank"> Glacier </a>的归档选项进一步降低了成本。</p><p id="ae83" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了管理存储类别和数据保留时间，我们可以关注一下<a class="ae le" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-lifecycle-mgmt.html" rel="noopener ugc nofollow" target="_blank"> S3生命周期配置</a>规则。应用这些规则，我们可以自动将数据转移到不同的存储类别，然后分别在数据创建后的X天和Y天将其永久删除。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nb"><img src="../Images/735242a10c1ac8a75065f1f5add0acc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IMdeXOQ7DUtqwYGbPplqOA.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">来源:作者提供的S3生命周期配置规则的屏幕截图</p></figure><h1 id="7185" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="d218" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">这篇博客文章只涵盖了AWS众多不同服务中的一小部分，希望能为EC2、Lambda和S3的成本优化考虑提供有用的参考。账单和费用是一个经常性的话题——毫无疑问，我们中的很多人都会遵循这里提到的策略，但我相信还有很多其他的选择和想法值得分享。请告诉我们你是否采取了不同的方法来减少你的账单，以及这些方法被证明有多有效。</p></div></div>    
</body>
</html>