<html>
<head>
<title>Bokeh Interactive Plots: Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">散景互动图:第二部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/bokeh-interactive-plotting-part-2-316f8d58f476#2022-02-18">https://towardsdatascience.com/bokeh-interactive-plotting-part-2-316f8d58f476#2022-02-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="57bb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何构建自定义交互式散景应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2be87c08fbe2f2c267d7177b10d1693c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rag2Gte3fmciEsp7"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://unsplash.com/@micheile?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">视觉故事||米歇尔</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="9594" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">概观</h1><p id="5c19" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这是包含散景交互式可视化的三篇文章系列的第二部分。因为这篇文章是建立在前一篇文章的基础上的，所以我建议先阅读<a class="ae ky" href="https://medium.com/@katyhagerty19/bokeh-stock-comparison-tool-part-1-81afb176a14e" rel="noopener">第1部分</a>。</p><div class="mn mo gp gr mp mq"><a href="https://medium.com/@katyhagerty19/bokeh-stock-comparison-tool-part-1-81afb176a14e" rel="noopener follow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd iu gy z fp mv fr fs mw fu fw is bi translated">散景互动图:第1部分</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">如何指导构建自定义交互式散景应用程序</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">medium.com</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne ks mq"/></div></div></a></div><p id="f877" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">第1部分构建了Bokeh应用程序框架来比较管理基金和指数。第2部分扩展了该框架，增加了将指数与证券交易所中的任何证券进行比较的选项，如eft、共同基金、股票和指数基金。第2部分功能位于应用程序的新选项卡上，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/45f54a9310af914aec2e0d460e065cb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*OAEoYtH-LDipviSB7P0OMA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><p id="190b" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">第2部分旨在尽可能多地重用第1部分，但仍然需要对功能进行一些修改。由于选项卡1上的管理基金与指数图仍然使用这些功能，任何添加都必须以不破坏现有图的方式扩展功能。</p><p id="1871" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">对于选项卡2上的股票与指数图，两个数据集都依赖于<code class="fe nl nm nn no b">yf_fund</code>,因为雅虎财经同时跟踪指数和股票数据。因此，<code class="fe nl nm nn no b">create_source</code>和<code class="fe nl nm nn no b">make_plot</code>需要改进，以便在<code class="fe nl nm nn no b">yf_fund</code>生成两个数据集的情况下工作。之前，<code class="fe nl nm nn no b">create_source</code>和<code class="fe nl nm nn no b">make_plot</code>分别从<code class="fe nl nm nn no b">yf_fund</code>和<code class="fe nl nm nn no b">managed_fund</code>获得一个输入。</p><h1 id="4dac" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">密码</h1><p id="1a28" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Git存储库可以在这里找到<a class="ae ky" href="https://github.com/katyhagerty/index_fund_comparison" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="b977" class="np la it bd lb nq nr dn lf ns nt dp lj ma nu nv ll me nw nx ln mi ny nz lp oa bi translated">小工具</h2><p id="30b0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Tab 2使用一种新的小部件TextInput，它允许用户输入证券的股票代码。除此之外，选项卡2上的其他部件与选项卡1上的部件相匹配。因为现在有两组小部件，所以字典存储的是小部件而不是变量名。不是显式定义每个小部件，而是用一个循环来定义小部件。当编辑<code class="fe nl nm nn no b">update</code>以使用选项卡1和选项卡2时，该方法将被证明是有用的。</p><p id="659e" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">字典还存储Dataframe和ColumnDataSource对象。其他函数将填充这些字典。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><h2 id="f2d5" class="np la it bd lb nq nr dn lf ns nt dp lj ma nu nv ll me nw nx ln mi ny nz lp oa bi translated">功能</h2><p id="3cbe" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">第2部分引入了一个新函数<code class="fe nl nm nn no b">find_min_date</code>。它使用<code class="fe nl nm nn no b">tab_no</code>并找到选项卡绘图的最小日期。对于选项卡1，最小日期将取决于索引开始的时间。对于选项卡2，该函数检查股票(<code class="fe nl nm nn no b">fund_1</code>)和指数(<code class="fe nl nm nn no b">fund_2</code>)的开始时间。选项卡2上股票与指数图的<code class="fe nl nm nn no b">min_date</code>将是最近的日期。最近的日期表示两个资产的时间线相交的开始。这是必要的，因为如果一种资产比另一种资产有更多的增长时间，这是不公平的比较。<code class="fe nl nm nn no b">start_date_picker</code>和<code class="fe nl nm nn no b">end_date_picker</code>小部件使用<code class="fe nl nm nn no b">min_date</code>来设置用户可以选择的最小日期。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><p id="832e" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">与第1部分一样，<code class="fe nl nm nn no b">yf_fund</code>使用Yahoo Finance模块来获取股票市场数据。之前，<code class="fe nl nm nn no b">yf_fund</code>只读入指标数据。现在，它还可以获取给定股票代码的数据。这可能是股票，共同基金，或交易所交易基金。对<code class="fe nl nm nn no b">yf_fund</code>的唯一主要补充是<code class="fe nl nm nn no b">line 18</code>，它将股票分割考虑在内。每当一家公司决定将一股现有股票分割成多股时，就会发生股票分割。例如，当亚马逊在1998年发行2比1的股票分割时，现有股东的股票数量翻了一番。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><p id="e7ce" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">在第1部分中，两个不同的函数<code class="fe nl nm nn no b">managed_fund</code>和<code class="fe nl nm nn no b">yf_fund</code>为<code class="fe nl nm nn no b">create_source</code>生成两个输入。然而，要使用零件2，<code class="fe nl nm nn no b">create_source</code>也必须合并<code class="fe nl nm nn no b">df_fund1</code>和<code class="fe nl nm nn no b">df_fund2</code>，即使<code class="fe nl nm nn no b">yf_fund </code>创建了两者。如果<code class="fe nl nm nn no b">yf_fund</code>创建两个输入，则列名重叠。<code class="fe nl nm nn no b">line 16</code>中的<code class="fe nl nm nn no b">rsuffix</code>参数为<code class="fe nl nm nn no b">df_fund2</code>中的列添加后缀，以解决列名重叠的问题。<code class="fe nl nm nn no b">lines 12</code>和<code class="fe nl nm nn no b">line 13 </code>搜索所有的列名，确定哪些列有投资头寸的数据。然后，<code class="fe nl nm nn no b">line 16</code>使用这些列来找出两项投资之间的差异</p><p id="2f14" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated"><code class="fe nl nm nn no b">Line 6</code>和<code class="fe nl nm nn no b">line 7</code>标识保存图例标签的列的名称。<code class="fe nl nm nn no b">Line 9</code>和<code class="fe nl nm nn no b">line 10</code>用更通用的名称重命名图例列。这些通用名是<code class="fe nl nm nn no b">make_plot</code>所必需的。关于为什么列需要占位符标签的更全面的解释，请参见<code class="fe nl nm nn no b">make_plot</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><p id="66d4" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">与<code class="fe nl nm nn no b">create_source</code>中的变化类似，<code class="fe nl nm nn no b">make_plot</code>中的编辑包括添加变量，以便识别正确的列。<code class="fe nl nm nn no b">make_plot</code>只被调用两次——一次是在选项卡1上绘制共同基金与指数图，另一次是在选项卡2上绘制股票与指数图。因此，有时数据位于名为Managed Position和Stock Position的列中，有时数据位于名为Stock Position和Stock Position_2的列中。<code class="fe nl nm nn no b">position1</code>和<code class="fe nl nm nn no b">position2</code>标识哪些列包含相关数据。<code class="fe nl nm nn no b">label1</code>和<code class="fe nl nm nn no b">label2</code>是<code class="fe nl nm nn no b">TOOLTIPS</code>弹出框的标签。</p><p id="bb1e" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">为了保持<code class="fe nl nm nn no b">TOOLTIPS</code>的正确格式，必须将<code class="fe nl nm nn no b">position1</code>和<code class="fe nl nm nn no b">position2</code>添加为f字符串。f字符串允许表达式嵌入到字符串中，只要这些嵌入的表达式在大括号内。<code class="fe nl nm nn no b">TOOLTIPS</code>如果列名包含空格，也使用大括号。为了正常工作，每个f弦需要三套背带。f字符串最里面的一对表示嵌入的信息。最外面的两个大括号确保输出字符串包含一组大括号。输出需要一组大括号，因为列名包含一个空格。例如，如果为Tab 2图调用了<code class="fe nl nm nn no b">make_plot</code>，f字符串将输出<code class="fe nl nm nn no b">‘{Stock Position}’</code>和<code class="fe nl nm nn no b">‘{Stock Position_2}’</code>，并且<code class="fe nl nm nn no b">TOOLTIPS</code>将搜索这些列名。</p><p id="610f" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated"><code class="fe nl nm nn no b">create_source</code>定义了<code class="fe nl nm nn no b">legend1</code>和<code class="fe nl nm nn no b">legend2</code>。它们标识了<code class="fe nl nm nn no b">df_source</code>中包含股票代码的列。图例使用这些列名作为标签，如<code class="fe nl nm nn no b">line 21</code>和<code class="fe nl nm nn no b">line 23</code>所示。正如第1部分所讨论的，散景以表格格式存储所有可更新的信息。因为每当用户选择新的证券时，图例标签都会改变，所以它们必须存储在列中。</p><p id="19a2" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">重要的是要记住<code class="fe nl nm nn no b">make_plot</code>只在初始化时被调用。不是每次用户更改输入和更新数据集时都调用它。在更新期间，新数据替换了<code class="fe nl nm nn no b">source</code>中的旧数据。替换<code class="fe nl nm nn no b">source</code>中的数据会改变图形，而不会调用<code class="fe nl nm nn no b">make_plot</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><h2 id="32ed" class="np la it bd lb nq nr dn lf ns nt dp lj ma nu nv ll me nw nx ln mi ny nz lp oa bi translated">回调函数</h2><p id="c644" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe nl nm nn no b">update</code>有了新的参数<code class="fe nl nm nn no b">tab_no</code>，因为不同的标签需要不同的功能。对于选项卡1，<code class="fe nl nm nn no b">update</code>调用<code class="fe nl nm nn no b">managed_fund</code>和<code class="fe nl nm nn no b">yf_fund</code>。对于选项卡2，<code class="fe nl nm nn no b">update</code>只调用<code class="fe nl nm nn no b">yf_fund</code>。然后，<code class="fe nl nm nn no b">create_source</code>从<code class="fe nl nm nn no b">managed_fund</code>和/或<code class="fe nl nm nn no b">yf_fund</code>获取输出数据，并合并两个数据帧。之后，合并的Dataframe被转换成<code class="fe nl nm nn no b">new_source</code>，一个ColumnDataSource对象。接下来，<code class="fe nl nm nn no b">new_source</code>替换<code class="fe nl nm nn no b">source</code>中的数据。再次重申，更新<code class="fe nl nm nn no b">source</code>是改变显示数据所需要的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><h2 id="0bc5" class="np la it bd lb nq nr dn lf ns nt dp lj ma nu nv ll me nw nx ln mi ny nz lp oa bi translated">用事件触发回调</h2><p id="aec8" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">回调函数<code class="fe nl nm nn no b">update</code>需要链接到事件。更改小部件值调用<code class="fe nl nm nn no b">update</code>。散景回调函数只接受三个参数，<code class="fe nl nm nn no b">attr</code>、<code class="fe nl nm nn no b">old</code>和<code class="fe nl nm nn no b">new</code>。然而，现在应用程序有多个标签，<code class="fe nl nm nn no b">update</code>需要知道刷新哪个标签。<code class="fe nl nm nn no b">partial</code>解决了这个困境。<code class="fe nl nm nn no b">partial</code>是<code class="fe nl nm nn no b">functools</code>模块的一部分，向现有函数添加额外的参数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="db3b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">案例研究:标准普尔500对间谍</h1><p id="9c7b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">由于股票与指数图有能力收集任何可交易基金的数据，该应用程序可以比较指数基金如何达到其跟踪的指数。SPY是跟踪标准普尔500指数的ETF，也是最受欢迎的ETF之一。自1993年成立以来，SPY的平均年回报率为10.5%。如下所示，间谍镜像标准普尔500很好，但并不完美。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/2fe2fae4c79fc9f230e1b2f71a68cfc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R7bcn2HPMd6zRlYscXdqhA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><h1 id="4523" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">案例研究:标准普尔500对GME</h1><blockquote class="ol om on"><p id="6a5e" class="lr ls oo lt b lu nf ju lw lx ng jx lz op nh mc md oq ni mg mh or nj mk ml mm im bi translated">市场中的时间胜过市场时机。</p></blockquote><p id="296b" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">去年，GameStop股票爆炸。简而言之，许多个人投资者集体决定购买GME的股票，这推动了需求，提高了股价。他们疯狂的想法给投资者带来了巨大的收益，也给做空股票的华尔街对冲基金带来了巨大的损失。</p><p id="2778" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">GME上涨如此之快，以至于1000美元的投资会在不到4周的时间里产生超过20000美元的收益。然后，股票价格猛跌。尽管GME在几天内有不可思议的增长，GME强调了不要试图把握市场时机的重要性。只要问问那些高价买入的人，他们很快就看到了投资池。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/e5ff8354c1b4cf333e34c0afe353c52c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PFwJuteJKwm6El6xXqBcxQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><h1 id="a702" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">后续步骤</h1><p id="1e89" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">第3部分添加了一个新的选项卡，其中有一个股票对比图和一个文本框，显示投资的增值、两种投资之间的差异以及成本基础。</p><p id="a0d9" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated"><a class="ae ky" href="https://medium.com/@katyhagerty19/bokeh-interactive-plots-part-3-683153f5f5ce" rel="noopener">https://medium . com/@ katyhagerty 19/bokeh-interactive-plots-part-3-683153 F5 F5 ce</a></p><p id="cf29" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">欢迎所有反馈。我总是渴望学习新的或更好的做事方法。请随时留下您的评论或联系我katyhagerty19@gmail.com。</p><div class="mn mo gp gr mp mq"><a href="https://medium.com/@katyhagerty19/membership" rel="noopener follow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd iu gy z fp mv fr fs mw fu fw is bi translated">加入我的介绍链接媒体-凯蒂哈格蒂</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">medium.com</p></div></div><div class="mz l"><div class="ot l nb nc nd mz ne ks mq"/></div></div></a></div><h1 id="7928" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">参考</h1><p id="cd8d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">[1]尼克拉斯，史蒂文。<a class="ae ky" href="https://www.investopedia.com/articles/investing/122215/spy-spdr-sp-500-trust-etf.asp" rel="noopener ugc nofollow" target="_blank">间谍:SPDR S &amp; P 500 ETF信托</a> (2021)，Investopedia</p></div></div>    
</body>
</html>