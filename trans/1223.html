<html>
<head>
<title>The Battle of Interactive Geographic Visualization Part 6 — Greppo</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">交互式地理可视化之战第六讲——格雷波</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-battle-of-interactive-geographic-visualization-part-6-greppo-4f615a1dae43#2022-03-28">https://towardsdatascience.com/the-battle-of-interactive-geographic-visualization-part-6-greppo-4f615a1dae43#2022-03-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="84d9" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">PYTHON。数据科学。地理可视化</h2><div class=""/><div class=""><h2 id="0266" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用 Greppo 库创建漂亮的交互式 Geoplots</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/dc75baf7e07231b4ad58fa40c02e944f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fHAFUbig-U2wYYaq"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@tobiash?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">托拜厄斯</a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><h1 id="51e2" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">我们离开的地方</h1><p id="723e" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">在这个系列中，我们已经确定了五(5)种制作美丽地理散射图的方法。</p><ul class=""><li id="7bcd" class="mw mx it mc b md my mg mz mj na mn nb mr nc mv nd ne nf ng bi translated"><strong class="mc jd">全息视图</strong> — <a class="ae lh" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-1-interactive-geoplot-using-one-line-of-8214e9ed1bb4">交互式地理可视化之战第一部分——使用一行代码的交互式地理地图</a></li><li id="f11c" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated"><strong class="mc jd"> Plotly Express — </strong> <a class="ae lh" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-2-interactive-geoplot-using-one-line-of-2118af59a77c">交互式地理可视化之战第二部分——使用一行代码的交互式 geo plot</a></li><li id="1beb" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated"><strong class="mc jd"> Plotly Go </strong> — <a class="ae lh" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-3-plotly-graph-objects-go-c3d3f2a00132">交互式地理可视化之战第三部分——Plotly 图形对象(Go) </a></li><li id="ca90" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated"><strong class="mc jd">牛郎星</strong>——<a class="ae lh" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-4-altair-5b67e3e5e29e">交互式地理可视化之战第四集——牛郎星</a></li><li id="6516" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated"><strong class="mc jd">叶</strong> — <a class="ae lh" href="https://medium.com/towards-data-science/the-battle-of-interactive-geographic-visualization-part-5-folium-cc2213d29a7?source=user_profile---------0-------------------------------" rel="noopener">交互式地理可视化之战第五部分—叶</a></li></ul><p id="0f17" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">在本文中，我们将学习如何创建，不仅仅是地理可视化，而是一个应用程序。对，一个 app！</p><p id="599f" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">因此，这篇文章可以与 Holoviews 的系列文章相提并论，其中易于部署是数据科学家的优势，他们希望在向利益相关者演示时避免展示我们的 Jupyter 笔记本。</p><p id="5a58" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">我们的目标是创建与前五篇文章几乎相似的地图。</p><p id="203b" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">所以，不多说了，让我们开始吧:</p><h1 id="0ecd" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">五个简单的步骤</h1><p id="2d76" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">创建这个漂亮的地理空间应用程序有五个简单的步骤:</p><ol class=""><li id="b1cd" class="mw mx it mc b md my mg mz mj na mn nb mr nc mv np ne nf ng bi translated">创建一个包含 Python 脚本和数据集的文件夹。</li><li id="eafd" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv np ne nf ng bi translated">创建基础层</li><li id="6c66" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv np ne nf ng bi translated">导入数据</li><li id="26ab" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv np ne nf ng bi translated">将数据添加为矢量图层</li><li id="0e27" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv np ne nf ng bi translated">输入其他详细信息</li></ol><h2 id="223c" class="nq lj it bd lk nr ns dn lo nt nu dp ls mj nv nw lu mn nx ny lw mr nz oa ly iz bi translated">步骤 1:创建一个包含 Python 脚本和数据集的文件夹。</h2><p id="0834" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">与大多数应用程序一样，将它们放在一个文件夹中是一个很好的做法。在我的例子中，它位于<code class="fe ob oc od oe b">geospatial_app</code>文件夹中:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi of"><img src="../Images/96729e3c62cdfb90275ff3d08bd4debb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*LinN-zxXpIjYRS7_pSh5kQ.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片:通过 Bash 改变目录来访问我们的脚本和数据集的位置。</p></figure><blockquote class="og oh oi"><p id="dd85" class="ma mb oj mc b md my kd mf mg mz kg mi ok nm ml mm ol nn mp mq om no mt mu mv im bi translated">如您所见，将它保存在一个<code class="fe ob oc od oe b">.py</code>文件中很重要:一个 Python 脚本。因此，对于下面的步骤，请注意，这些将在 Python 脚本中编写。</p></blockquote><h2 id="b215" class="nq lj it bd lk nr ns dn lo nt nu dp ls mj nv nw lu mn nx ny lw mr nz oa ly iz bi translated">步骤 2:创建基础层。</h2><p id="5102" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">基础图层类似于我们用于 follow 应用程序的图块(<em class="oj">回想一下，在创建基础地图时，我们指定</em> <code class="fe ob oc od oe b"><em class="oj">tiles</em></code> <em class="oj">)。</em>)</p><p id="fb4c" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">这方面代码如下:</p><pre class="ks kt ku kv gt on oe oo op aw oq bi"><span id="e958" class="nq lj it oe b gy or os l ot ou">app.base_layer(<br/>    name="Open Street Map",<br/>    visible=True,<br/>    url="<a class="ae lh" href="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png" rel="noopener ugc nofollow" target="_blank">https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png</a>",<br/>    subdomains=None,<br/>    attribution='(C) OpenStreetMap contributors',<br/>)</span><span id="6ca6" class="nq lj it oe b gy ov os l ot ou">app.base_layer(<br/>    name="CartoDB Light",<br/>    visible=True,<br/>    url="<a class="ae lh" href="https://cartodb-basemaps-a.global.ssl.fastly.net/light_all/{z}/{x}/{y}&lt;a href=" rel="noopener ugc nofollow" target="_blank">@2x</a>.png"&gt;https://cartodb-basemaps-a.global.ssl.fastly.net/light_all/{z}/{x}/{y}<a class="ae lh" href="http://twitter.com/2x" rel="noopener ugc nofollow" target="_blank">@2x</a>.png",<br/>    subdomains=None,<br/>    attribution='&amp;copy; &lt;a target="_blank" href="<a class="ae lh" href="http://osm.org/copyright" rel="noopener ugc nofollow" target="_blank">http://osm.org/copyright</a>"&gt;OpenStreetMap&lt;/a&gt; contributors',<br/>)</span></pre><p id="dcee" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">在上面的代码中，我们创建了两个可以交替使用的基础层。格式如下:<strong class="mc jd"> </strong> <a class="ae lh" href="https://docs.greppo.io/map-components/base-layer.html" rel="noopener ugc nofollow" target="_blank"> <strong class="mc jd"> Greppo 文档:基础层。</strong> </a></p><p id="88ae" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">为了检查我们是否正确，转到代码所在的文件夹并运行下面的命令<code class="fe ob oc od oe b">greppo serve app.py</code>。格式是<code class="fe ob oc od oe b">greppo serve {script name}</code>。在我们的例子中，我们选择将脚本命名为<code class="fe ob oc od oe b">app.py</code>，因此它将是<code class="fe ob oc od oe b">greppo serve.</code>之后的内容</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi of"><img src="../Images/068255af584b66045d753f827f75491b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*lkNmihLHjq47-cfA3d0t5g.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片由作者提供:在文件夹中输入命令“greppo serve app.py”来运行应用程序</p></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ow"><img src="../Images/14f143c5f6e7477d07a19cbfdcfb2a44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*8kUrDoyERVVegZFf_YOREw.gif"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者 GIF:创建基础层</p></figure><h2 id="1073" class="nq lj it bd lk nr ns dn lo nt nu dp ls mj nv nw lu mn nx ny lw mr nz oa ly iz bi translated">步骤 3:导入我们的地理空间数据</h2><p id="868a" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">与我们的其他产品一样，导入非常简单:</p><pre class="ks kt ku kv gt on oe oo op aw oq bi"><span id="d9b8" class="nq lj it oe b gy or os l ot ou">df = pd.read_csv('Coffee Brands Footprint.csv',<br/>                index_col=0)</span></pre><p id="3f51" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">现在，由于我们需要此特定包的地理数据框架，我们只需添加:</p><pre class="ks kt ku kv gt on oe oo op aw oq bi"><span id="1f52" class="nq lj it oe b gy or os l ot ou">#Geometry<br/>geometry = [Point(xy) for xy in zip(df.lng, df.lat)]<br/>gdf = gpd.GeoDataFrame(df, geometry=geometry)</span></pre><p id="72d7" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">这也是我们为过去的文章所做的，所以在这一部分没有什么新的。继续前进。</p><h2 id="6e52" class="nq lj it bd lk nr ns dn lo nt nu dp ls mj nv nw lu mn nx ny lw mr nz oa ly iz bi translated">步骤 4:将数据添加为矢量图层</h2><p id="cf0a" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">既然我们想用不同的颜色识别不同的品牌，那么<strong class="mc jd">将不同的品牌视为它们的数据集</strong>就很重要。</p><p id="1f82" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">这样做的原因是，造型是每层完成的，每层只能有一种颜色。因此，我们的解决方法是将每个品牌视为不同的层。</p><p id="16df" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">首先，创建一个颜色字典，就像我们用叶子做的那样:</p><pre class="ks kt ku kv gt on oe oo op aw oq bi"><span id="8327" class="nq lj it oe b gy or os l ot ou">#We need to add this iteratively, to achieve different colors in the map, we need to separate the brands and treat them as a dataframe</span><span id="6807" class="nq lj it oe b gy ov os l ot ou">#Borrowing this from our earlier codes<br/>color_dict = {<br/>    "Starbucks": ' #00704A',<br/>    "Coffee Bean and Tea Leaf": '#362d26',<br/>    "Coffee Project": '#654321',<br/>    "Tim Hortons": '#dd0f2d'<br/>}</span></pre><p id="d912" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">最后，反复添加品牌:</p><pre class="ks kt ku kv gt on oe oo op aw oq bi"><span id="9e09" class="nq lj it oe b gy or os l ot ou">for brand in color_dict.keys():<br/>    <br/>    app.vector_layer(<br/>        data = gdf[gdf.brand==brand],<br/>        name = f"{brand} Coffee Shops in the Philippines",<br/>        description = f"Scatter plot of {brand} Coffee Shops in the Philippines",<br/>        style = {"fillColor": color_dict[brand],<br/>                "fillOpacity":0.5,<br/>                "opacity":0.5},<br/>    )</span></pre><p id="5a4c" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">瞧啊。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ow"><img src="../Images/38d9b4c34f16f96c1ddd39d5f981c8b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*_upv5dqBP8aw5tKqhk7Rgw.gif"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者 GIF。添加了图层的地理空间应用程序</p></figure><p id="5a21" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">最后，让我们命名我们的应用程序并输入更多详细信息:</p><h2 id="8e84" class="nq lj it bd lk nr ns dn lo nt nu dp ls mj nv nw lu mn nx ny lw mr nz oa ly iz bi translated">步骤 5:输入其他详细信息</h2><pre class="ks kt ku kv gt on oe oo op aw oq bi"><span id="369e" class="nq lj it oe b gy or os l ot ou">app.display(name='title', value='The Battle of Interactive Geographic Visualization Part 6 — Greppo')<br/>app.display(name='description',<br/>            value='A Greppo demo app for vector data using GeoPandas DataFrame')</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ow"><img src="../Images/00e555519aadc6248efeee76db19b84f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*uvC7xX7is2h-ettCumTN2Q.gif"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者 GIF。添加了图层和标题的最终地理空间应用程序</p></figure><h1 id="898b" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">结束语</h1><p id="4fa9" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">正如我们所见，使用 Greppo 部署和创建地理空间可视化应用程序非常简单。</p><p id="eb4f" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">与 Holoviews 不同，应用程序元素的排列似乎已经固定，定制也不像我们在 leav 中那样广泛。</p><p id="dc52" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">尽管如此，这个库为我们提供了工具箱中的另一个工具，我们可以使用它来探索，因为前端足够令人愉快和漂亮，可以给我们的利益相关者留下深刻印象。</p><p id="1f88" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">让我知道你的想法！</p></div></div>    
</body>
</html>