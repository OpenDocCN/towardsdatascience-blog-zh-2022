<html>
<head>
<title>MLOps — Data And Model Versioning With DVC And Azure Blob Storage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MLOps —通过DVC和Azure Blob存储进行数据和模型版本控制</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/large-data-versioning-with-dvc-and-azure-blob-storage-a-complete-guide-b97344827c81#2022-04-11">https://towardsdatascience.com/large-data-versioning-with-dvc-and-azure-blob-storage-a-complete-guide-b97344827c81#2022-04-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="387f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于如何跟踪数据的端到端方法—不到5分钟！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0f788087616b55935f6d7a5a5c52d67b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nRHSRN3ZgmmdLKi7"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@fabioha" rel="noopener ugc nofollow" target="_blank">法比奥</a>在<a class="ae ky" href="https://unsplash.com/photos/oyXis2kALVg" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="9135" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="006f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">软件工程师主要使用Git，因为它是源代码版本控制的好方法。另一方面，机器学习从业者可能很容易面临其局限性，因为大多数项目不仅涉及不同版本的源代码，还涉及不同版本的数据和模型。如果没有合适的工具，跟踪哪些数据用于训练哪个模型可能会很快变成一场长期灾难，并带来许多挫折。</p><p id="e171" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">接下来是<code class="fe ms mt mu mv b"><strong class="lt iu">Data Version Control</strong></code>，或简称为<code class="fe ms mt mu mv b"><strong class="lt iu">DVC</strong></code>，我认为它是最伟大的开源工具之一，通过以类似于Git的方式处理数据版本，弥合了Git和数据科学家之间的鸿沟。</p><p id="c540" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">本文旨在为您提供一些使用DVC在Microsoft Azure Blob存储上对大型数据集进行版本化的实践经验。</p><h1 id="1cbd" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">开始</h1><p id="0f38" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了能够成功地进行所有体验，您需要创建一个Azure帐户并登录到您的门户网站。</p><p id="c029" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在本节中，我们将从设置Microsoft Blob存储开始，然后是DVC，最后是创建它们之间的交互:从Blob存储中推送和提取数据。</p><h2 id="04c0" class="mw la it bd lb mx my dn lf mz na dp lj ma nb nc ll me nd ne ln mi nf ng lp nh bi translated">设置Azure Blob存储</h2><p id="9754" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">设置Azure Blob包括两个主要步骤:<code class="fe ms mt mu mv b">1)create a storage account</code>，<code class="fe ms mt mu mv b">2)create a container inside that storage account</code>，它将托管我们的数据。</p><ol class=""><li id="43f1" class="ni nj it lt b lu mn lx mo ma nk me nl mi nm mm nn no np nq bi translated"><strong class="lt iu">创建存储账户</strong></li></ol><ul class=""><li id="b143" class="ni nj it lt b lu mn lx mo ma nk me nl mi nm mm nr no np nq bi translated">选择<strong class="lt iu">创建资源</strong>并搜索<code class="fe ms mt mu mv b">Storage account</code>，然后选择<strong class="lt iu">创建</strong>按钮。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/80d7d8330e53016d7ea75c99a757be7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QmmxPXbun34hyPhOq6xwdA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Azure存储帐户创建(图片由作者提供)</p></figure><ul class=""><li id="182a" class="ni nj it lt b lu mn lx mo ma nk me nl mi nm mm nr no np nq bi translated">提供每个部分的所有信息后，从<strong class="lt iu">基础</strong>、<strong class="lt iu">高级等。</strong>到<strong class="lt iu">审查+创建</strong>，我得到了我的存储的如下最终配置结果。为了简单起见，我忽略了标记部分。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/b924637d00759dc054b6e6d05d332e2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_9S_V5uWR0lRAvyTQzmeCw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">存储帐户最终配置(图片由作者提供)</p></figure><ul class=""><li id="1dfc" class="ni nj it lt b lu mn lx mo ma nk me nl mi nm mm nr no np nq bi translated">一旦您对结果感到满意，只需点击<strong class="lt iu">创建</strong>，即可获得以下消息，表明您的存储帐户已成功部署！🎉</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/70d9008792dc233fe2d0269f894cf8f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nAbvq8akzySPqd_1ysw9sQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">存储帐户的成功部署消息(图片由作者提供)</p></figure><p id="cf4e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> 2。创建存储容器</strong></p><p id="c937" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">通过选择<strong class="lt iu">转到资源按钮，您可以获得以下完整的存储概述。</strong>之后，按照步骤1到4创建您的容器。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/c9d88eed0875555ce00a13255be4ff2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pp9pySwi85NvyLqgb8lGWA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">容器创建步骤:1到4(图片由作者提供)</p></figure><p id="393b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">创建容器后，您可以选择容器名称<code class="fe ms mt mu mv b">dvcazurecontainer</code>来获取与其相关的所有细节。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/fd77e0baecd4b3c963cd4c32e953fe5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*41EO0gNPddTLwSIYOYmq0A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">容器详细信息(图片由作者提供)</p></figure><p id="a8a8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">注</strong>:记住橙色矩形中的所有大写信息，因为当尝试使用DVC连接到Blob存储时，这些信息非常重要。</p><h2 id="15c6" class="mw la it bd lb mx my dn lf mz na dp lj ma nb nc ll me nd ne ln mi nf ng lp nh bi translated">建立DVC</h2><p id="f01d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们从使用下面的pip命令安装DVC开始。</p><pre class="kj kk kl km gt nx mv ny nz aw oa bi"><span id="7a3e" class="mw la it mv b gy ob oc l od oe">pip install dvc</span></pre><p id="dadb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一旦完成安装DVC，运行以下命令告诉DVC，你正在考虑将当前文件夹作为DVC文件夹。</p><pre class="kj kk kl km gt nx mv ny nz aw oa bi"><span id="3b12" class="mw la it mv b gy ob oc l od oe">dvc init</span></pre><p id="5201" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">前面的命令生成类似下图的输出</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/d7449a018a9932b22fd2cf012a0b6e2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ZcwYDXba3F0YIPXNRRGNg.png"/></div></div></figure><p id="ca82" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">同样，它创建了一个<strong class="lt iu">。dvc </strong>文件夹，以便跟踪我们将添加到远程存储器的文件。</p><h2 id="5e3f" class="mw la it bd lb mx my dn lf mz na dp lj ma nb nc ll me nd ne ln mi nf ng lp nh bi translated">DVC与Azure博客的互动</h2><p id="2b5d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在，我们已经正确配置了DVC和Blob存储，是时候考虑我们想要跟踪的数据了。</p><p id="034d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">关于数据</strong></p><p id="7699" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我实现了以下下载<strong class="lt iu">的脚本。csv </strong>和<strong class="lt iu">。我的<a class="ae ky" href="https://github.com/keitazoumana/streamlit-spam-detector" rel="noopener ugc nofollow" target="_blank"> Github账号</a>中的pkl </strong>文件，保存在<strong class="lt iu"> data </strong>文件夹中，稍后会推送到DVC。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">视频_下载_自_网址. py</p></figure><p id="4d88" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">项目存储库结构如下所示:</p><pre class="kj kk kl km gt nx mv ny nz aw oa bi"><span id="22e1" class="mw la it mv b gy ob oc l od oe">|--- AzureDVC<br/>|       |------- .dvc <br/>|       |------- <strong class="mv iu">data </strong><br/>|       |         |---- <strong class="mv iu">spam_detector_model.pkl</strong><br/>|       |         |---- <strong class="mv iu">spam.csv</strong><br/>|       |------- download_data.py</span></pre><p id="3877" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">导出环境变量</strong></p><p id="0269" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下一步是配置Azure credentials环境变量，DVC将使用这些变量与Azure进行交互。</p><pre class="kj kk kl km gt nx mv ny nz aw oa bi"><span id="1060" class="mw la it mv b gy ob oc l od oe"># Environment variables &amp; Exports<br/>CLIENT_ID="your_client_ID"<br/>USERNAME=“your_email”<br/>PASSWORD=“your_password”</span><span id="a96c" class="mw la it mv b gy oi oc l od oe"># Start the exports<br/>export AZURE_CLIENT_ID= CLIENT_ID<br/>export AZURE_USERNAME= USERNAME<br/>export AZURE_PASSWORD= PASSWORD</span></pre><p id="d067" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">之后，我们为代码可读性设置常量变量。</p><pre class="kj kk kl km gt nx mv ny nz aw oa bi"><span id="225e" class="mw la it mv b gy ob oc l od oe"># Constants Variables<br/>ACCOUNT_NAME="azuredvcdemo"<br/>CONTAINER_URL=<a class="ae ky" href="https://azuredvcdemo.blob.core.windows.net/dvcazurecontainer" rel="noopener ugc nofollow" target="_blank">https://azuredvcdemo.blob.core.windows.net/dvcazurecontainer</a><br/>CONTAINER_NAME=dvcazurecontainer</span></pre><p id="d6bf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">接下来，设置blob存储和DVC之间的链接</p><pre class="kj kk kl km gt nx mv ny nz aw oa bi"><span id="dad0" class="mw la it mv b gy ob oc l od oe">dvc remote add -d zoumanaremote CONTAINER_URL</span><span id="3cd3" class="mw la it mv b gy oi oc l od oe">dvc remote modify zoumanaremote url azure://CONTAINER_NAME/</span><span id="fb8d" class="mw la it mv b gy oi oc l od oe">dvc remote modify zoumanaremote account_name ACCOUNT_NAME</span></pre><p id="dba0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">是时候添加我们想要在Azure Blob上存储和监控的数据了。这是通过以下命令完成的。</p><pre class="kj kk kl km gt nx mv ny nz aw oa bi"><span id="a441" class="mw la it mv b gy ob oc l od oe">dvc add data</span></pre><p id="57d8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">该指令生成一个<strong class="lt iu"> data.dvc </strong>文件，其中包含如何访问原始数据的信息，但不提供任何相关信息。这个<strong class="lt iu"> data.dvc </strong>的内容是这样的:</p><pre class="kj kk kl km gt nx mv ny nz aw oa bi"><span id="dc5f" class="mw la it mv b gy ob oc l od oe">outs:<br/>- md5: a966ec281923bc3c9d7d1c40fde056b3.dir<br/>  size: 20248421<br/>  nfiles: 2<br/>  path: data</span></pre><ul class=""><li id="85c3" class="ni nj it lt b lu mn lx mo ma nk me nl mi nm mm nr no np nq bi translated"><code class="fe ms mt mu mv b">md5</code>是使用DVC跟踪的原始数据文件夹的哈希值。</li><li id="adac" class="ni nj it lt b lu oj lx ok ma ol me om mi on mm nr no np nq bi translated"><code class="fe ms mt mu mv b">size</code>是数据文件夹中文件的大小。</li><li id="34af" class="ni nj it lt b lu oj lx ok ma ol me om mi on mm nr no np nq bi translated"><code class="fe ms mt mu mv b">nfiles</code>是数据文件夹中文件的数量。在本例中，我们有2个文件，一个. csv文件和一个. pkl文件。</li><li id="99b0" class="ni nj it lt b lu oj lx ok ma ol me om mi on mm nr no np nq bi translated"><code class="fe ms mt mu mv b">path</code>是原始文件夹的路径。</li></ul><p id="5e72" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">使用以下命令将数据推送到容器中。</p><pre class="kj kk kl km gt nx mv ny nz aw oa bi"><span id="3c90" class="mw la it mv b gy ob oc l od oe">dvc push</span></pre><p id="7c6c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">从Azure门户，我们可以看到已经执行了更改，这可以通过相同的<code class="fe ms mt mu mv b">md5</code>哈希值的存在来观察。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/f9de557a05db3fafa99645290729d6c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FP7s9KDKm279osDPVDgCgw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">DVC将结果从Azure门户推送到我的容器中(图片由作者提供)</p></figure><p id="c3d8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，数据在Azure Blob存储上可用。使用下面的命令，您最终可以在需要的时候将它下载到您的本地项目存储库中。</p><pre class="kj kk kl km gt nx mv ny nz aw oa bi"><span id="2916" class="mw la it mv b gy ob oc l od oe">dvc pull</span></pre><h1 id="fc90" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="df27" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">恭喜你！🎉 🍾您刚刚学习了如何使用DVC和Azure Blob存储进行大型数据监控。我希望你喜欢阅读这篇文章，它给了你所需的技能。请在下面找到更多资源来帮助您进一步学习。</p><p id="4788" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">此外，如果你喜欢阅读我的故事，并希望支持我的写作，可以考虑<a class="ae ky" href="https://zoumanakeita.medium.com/membership" rel="noopener">成为一个媒体成员</a>。每月支付5美元，你就可以无限制地阅读媒体上的故事。通过使用<a class="ae ky" href="https://zoumanakeita.medium.com/membership" rel="noopener">我的注册链接</a>，我将获得一小笔佣金。</p><p id="0f55" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">欢迎在<a class="ae ky" href="https://zoumanakeita.medium.com/" rel="noopener">媒体</a>、<a class="ae ky" href="https://twitter.com/zoumana_keita_" rel="noopener ugc nofollow" target="_blank">推特</a>和<a class="ae ky" href="https://www.youtube.com/channel/UC9xKdy8cz6ZuJU5FTNtM_pQ" rel="noopener ugc nofollow" target="_blank"> YouTube </a>上关注我，或者在<a class="ae ky" href="https://www.linkedin.com/in/zoumana-keita/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上打招呼。讨论人工智能、人工智能、数据科学、自然语言处理和人工智能是一种乐趣！</p><p id="7b46" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">再见🏃🏾‍♂️</p><h1 id="410c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">额外资源</h1><p id="d5c3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><a class="ae ky" href="https://docs.microsoft.com/en-us/azure/storage/blobs/" rel="noopener ugc nofollow" target="_blank"> Azure Blob存储文档</a></p><p id="c4ed" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><a class="ae ky" href="https://nishantrana.me/2020/11/23/fixed-authorizationpermissionmismatch-azure-blob-storage/" rel="noopener ugc nofollow" target="_blank">授权许可不匹配故障排除</a></p><p id="284a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><a class="ae ky" href="https://dvc.org/doc/command-reference/remote/add" rel="noopener ugc nofollow" target="_blank"> DVC文档</a></p></div></div>    
</body>
</html>