<html>
<head>
<title>It’s Time to Say GoodBye to pd.read_csv() and pd.to_csv()</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">是时候告别pd.read_csv()和pd.to_csv()了</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/its-time-to-say-goodbye-to-pd-read-csv-and-pd-to-csv-27fbc74e84c5#2022-05-26">https://towardsdatascience.com/its-time-to-say-goodbye-to-pd-read-csv-and-pd-to-csv-27fbc74e84c5#2022-05-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0b27" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">讨论熊猫的另一个重要警告</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/638f2b93d1521af2db966a0a89c5d0fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*l4rgBy_Rw5vFc6Fc"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">黑白情缘印花纺织品(来源:<a class="ae kv" href="https://www.pexels.com/photo/wood-laptop-writing-business-4271925/" rel="noopener ugc nofollow" target="_blank"> Pexels </a></p></figure><p id="8b4e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Pandas对CSV的输入输出操作是串行的，这使得它们非常低效和耗时。当我看到这里有足够的并行化空间时，我感到很沮丧，但不幸的是，Pandas还没有提供这种功能。虽然我从来不赞成首先用熊猫创建CSV(阅读我下面的帖子就知道为什么)，但我知道可能会有除了使用CSV别无选择的情况。</p><div class="ls lt gp gr lu lv"><a rel="noopener follow" target="_blank" href="/why-i-stopped-dumping-dataframes-to-a-csv-and-why-you-should-too-c0954c410f8f"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">为什么我停止向CSV转储数据帧，为什么您也应该这样做</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">是时候告别pd.to_csv()和pd.read_csv()了</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">towardsdatascience.com</p></div></div><div class="me l"><div class="mf l mg mh mi me mj kp lv"/></div></div></a></div><p id="0401" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，在本帖中，我们将探索<strong class="ky ir"> Dask </strong>和<strong class="ky ir"> DataTable </strong>，这是数据科学家最喜欢的两个类似熊猫的库。我们将根据Pandas、Dask和Datatable在以下参数上的表现进行排名:</p><ol class=""><li id="d943" class="mk ml iq ky b kz la lc ld lf mm lj mn ln mo lr mp mq mr ms bi translated"><strong class="ky ir">读取CSV并获取熊猫数据帧所花费的时间</strong></li></ol><p id="b10d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们通过Dask和DataTable读取CSV，它们将分别生成Dask数据帧和DataTable数据帧，<strong class="ky ir">而不是Pandas数据帧</strong>。假设我们想要坚持传统的Pandas语法和函数(由于熟悉的原因)，我们必须首先将它们转换成Pandas数据帧，如下所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/e953cc0b349b9e1297a62152e7df559b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TPQCp-dQErN73FekQPG-mg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">描述将Pandas数据帧转换为Dask和DataTable数据帧的代码片段(图片由作者提供)</p></figure><p id="f91e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.<strong class="ky ir">将熊猫数据帧存储到CSV所需的时间</strong></p><p id="9e03" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">目标是从给定的熊猫数据帧生成一个CSV文件。对于熊猫，我们已经知道了<em class="mu"> df.to_csv() </em>方法。然而，要从Dask和DataTable创建CSV，我们首先需要将给定的Pandas数据帧转换成它们各自的数据帧，然后将它们存储在CSV中。因此，在本次分析中，我们还将考虑数据帧转换所需的时间。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/14ff7c3349b163cfd1958f7ec349c5e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iH4aFiL-WfPiMlW68ZVwVg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用Pandas、Dask和DataTable将数据帧保存到CSV的代码片段(图片由作者提供)</p></figure><h1 id="e0ea" class="mv mw iq bd mx my mz na nb nc nd ne nf jw ng jx nh jz ni ka nj kc nk kd nl nm bi translated">实验设置:</h1><ol class=""><li id="ad64" class="mk ml iq ky b kz nn lc no lf np lj nq ln nr lr mp mq mr ms bi translated">出于实验目的，我用Python生成了一个随机数据集，包含可变的行和三十列——包括字符串、浮点和整数数据类型。</li><li id="33cd" class="mk ml iq ky b kz ns lc nt lf nu lj nv ln nw lr mp mq mr ms bi translated">我将下面描述的每个实验重复了五次，以减少随机性，并从观察结果中得出公正的结论。我在下面报告的数字是五次实验的平均值。</li><li id="fa26" class="mk ml iq ky b kz ns lc nt lf nu lj nv ln nw lr mp mq mr ms bi translated">Python环境和库:</li></ol><ul class=""><li id="64e5" class="mk ml iq ky b kz la lc ld lf mm lj mn ln mo lr nx mq mr ms bi translated">Python 3.9.12</li><li id="e9d9" class="mk ml iq ky b kz ns lc nt lf nu lj nv ln nw lr nx mq mr ms bi translated">熊猫</li><li id="4f8e" class="mk ml iq ky b kz ns lc nt lf nu lj nv ln nw lr nx mq mr ms bi translated">数据表1.0.0</li><li id="3abd" class="mk ml iq ky b kz ns lc nt lf nu lj nv ln nw lr nx mq mr ms bi translated">Dask 2022.02.1</li></ul><h1 id="9042" class="mv mw iq bd mx my mz na nb nc nd ne nf jw ng jx nh jz ni ka nj kc nk kd nl nm bi translated"><strong class="ak">实验1:读取CSV花费的时间</strong></h1><p id="b7c2" class="pw-post-body-paragraph kw kx iq ky b kz nn jr lb lc no ju le lf ny lh li lj nz ll lm ln oa lp lq lr ij bi translated">下图描述了Pandas、Dask和DataTable读取CSV文件并生成Pandas数据帧所用的时间(秒)。CSV的行数范围从100k到500万。</p><div class="kg kh ki kj gt ab cb"><figure class="ob kk oc od oe of og paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/e93afbb1678796390063a5da350668ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*VnGD5P-p8W4rElM9S_fWYw.png"/></div></figure><figure class="ob kk oc od oe of og paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/95c6fc58a4571cb19559c1e31d6bb136.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*GCFKHxshDmFUHrsSDI6gFQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk oh di oi oj translated">描述熊猫、数据表和Dask读取CSV所用时间的折线图(图片由作者提供)</p></figure></div><ol class=""><li id="cee1" class="mk ml iq ky b kz la lc ld lf mm lj mn ln mo lr mp mq mr ms bi translated">实验结果表明，当行数小于一百万时，Dask和Pandas从CSV生成Pandas数据帧所用的时间大致相同。</li><li id="8d60" class="mk ml iq ky b kz ns lc nt lf nu lj nv ln nw lr mp mq mr ms bi translated">然而，当我们超过一百万行时，Dask的性能会恶化，并且生成Pandas数据帧比生成Pandas本身要花费更多的时间。</li><li id="7981" class="mk ml iq ky b kz ns lc nt lf nu lj nv ln nw lr mp mq mr ms bi translated">在这两种情况下，Datatable在Pandas中生成一个数据帧所需的时间最少，提供了4到5倍的速度提升——这使它成为目前为止最好的选择。</li></ol><h1 id="1fae" class="mv mw iq bd mx my mz na nb nc nd ne nf jw ng jx nh jz ni ka nj kc nk kd nl nm bi translated">实验2:保存到CSV所需的时间</h1><p id="7bb1" class="pw-post-body-paragraph kw kx iq ky b kz nn jr lb lc no ju le lf ny lh li lj nz ll lm ln oa lp lq lr ij bi translated">下图描述了Pandas、Dask和DataTable从给定的Pandas数据帧生成CSV文件所用的时间(秒)。行数范围从100k到500万。</p><div class="kg kh ki kj gt ab cb"><figure class="ob kk oc od oe of og paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/eba3fffc629ce57f572413bea4883bd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*evI8dzFEtsQ_6830hObfBg.png"/></div></figure><figure class="ob kk oc od oe of og paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/ada53fe2190d3ed7c77e938b876786e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*KB0K1CZxy4NguLgstmbECg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk oh di oi oj translated">描述Pandas、DataTable和Dask将数据帧存储到CSV所需时间的折线图(图片由作者提供)</p></figure></div><ol class=""><li id="d9d0" class="mk ml iq ky b kz la lc ld lf mm lj mn ln mo lr mp mq mr ms bi translated">在所有情况下，Dask在将Pandas数据帧存储到CSV时的表现都不如Pandas。</li><li id="74cb" class="mk ml iq ky b kz ns lc nt lf nu lj nv ln nw lr mp mq mr ms bi translated">与实验1类似，DataTable表现最好——将相对于熊猫的保存过程提高了近<strong class="ky ir"> 8倍。</strong></li></ol><h1 id="2be6" class="mv mw iq bd mx my mz na nb nc nd ne nf jw ng jx nh jz ni ka nj kc nk kd nl nm bi translated">结束语</h1><p id="ccac" class="pw-post-body-paragraph kw kx iq ky b kz nn jr lb lc no ju le lf ny lh li lj nz ll lm ln oa lp lq lr ij bi translated">老实说，我不太喜欢CSV。如果你仔细阅读了我之前的帖子(我在上面链接过，或者你可以在这里阅读<a class="ae kv" href="https://medium.com/towards-data-science/why-i-stopped-dumping-dataframes-to-a-csv-and-why-you-should-too-c0954c410f8f" rel="noopener"/>)和你现在正在阅读的帖子，你可能也会和我产生共鸣。自从我发现与CSV相关的众多问题后，我尽可能地停止使用它们。</p><p id="1865" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">总之，我认为除非您需要在非pythonic环境(如Excel)之外查看数据框架，否则根本不需要CSV。更喜欢像拼花地板、羽毛或泡菜这样的格式来存储你的数据帧。尽管如此，如果您看不到其他选择，至少通过利用DataTable而不是Pandas来优化您的输入和输出操作。</p></div><div class="ab cl ok ol hu om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="ij ik il im in"><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/bea1c3dad53793c9e359b01a8c72e431.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*45rJUYJE1BVRyw0kyOxhHA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">毒枭迷因由作者使用迷因创造者。</p></figure></div></div>    
</body>
</html>