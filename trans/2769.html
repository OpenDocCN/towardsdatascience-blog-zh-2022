<html>
<head>
<title>High-Quality Data Comes With High-Quality Validations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">高质量的数据伴随着高质量的验证</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-validation-for-pandas-b24613959364#2022-06-15">https://towardsdatascience.com/data-validation-for-pandas-b24613959364#2022-06-15</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="d126" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">以下是如何在数据管道的每个阶段确保熊猫数据帧的质量</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/5e6f362562936e3c8d2964a23ed5e04b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZE-nu1owGNiTK4Lqx_iwiQ.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由来自<a class="ae kz" href="https://www.pexels.com/photo/close-up-photo-of-blue-background-2441454/" rel="noopener ugc nofollow" target="_blank">佩克斯</a>的哈里森<a class="ae kz" href="https://www.pexels.com/photo/close-up-photo-of-blue-background-2441454/" rel="noopener ugc nofollow" target="_blank">坎德林</a>拍摄。</p></figure><p id="0550" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">通过挑选正确的垃圾，你可以在垃圾中建造一座城堡。</p><p id="6b0b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">大多数数据科学项目都是这样——建造城堡🏰从垃圾桶里。在数据湖中数千个数据集的池中，您需要挑选正确的数据集并修复几乎正确的数据集。</p><p id="6a31" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你需要一个强大的数据集验证工具。</p><p id="e025" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">数据质量是任何现代分析项目的一个基本方面。但是我验证数据集的老派技术有更多的漏洞🐛比蝴蝶还多。</p><p id="5c3c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我写自己的验证码；有很多异常处理。</p><p id="538a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">尝试不同的逻辑将花费大量的时间来重新编码😦。此外，我需要编写专门的文档来理解我的验证逻辑。</p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/stop-firefighting-data-quality-issues-4c064bcbbb53"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">停止解决数据质量问题。</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">高质量的数据是通过系统和定期的质量评估实现的。</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn kt lz"/></div></div></a></div><p id="0b60" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是我最近发现了一个Python库，它去掉了大部分样板文件。有了它，您可以为模式中的Pandas数据帧编写更直观的验证逻辑。</p><p id="f314" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">它删除了我大量的代码。相反，几行代码提供了更强大的处理验证错误的方法。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="mo mp l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">来自<a class="ae kz" href="https://giphy.com/gifs/littlemix-little-mix-black-magic-MUnlAiiNn7HZutahjH" rel="noopener ugc nofollow" target="_blank">吉菲</a>的动画。</p></figure><p id="5057" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们学习如何使用熊猫验证工具包<a class="ae kz" href="https://pandera.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> Pandera </a>来确保高质量的数据。</p><p id="1bef" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本帖中，我们将讨论</p><ul class=""><li id="d627" class="mq mr iu lc b ld le lg lh lj ms ln mt lr mu lv mv mw mx my bi translated">使用YAML配置验证Pandas数据框架:</li><li id="de79" class="mq mr iu lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated">可在数据管道中的任何位置重用的验证批注；</li><li id="20c6" class="mq mr iu lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated">定义动态验证，以及。</li><li id="5289" class="mq mr iu lc b ld mz lg na lj nb ln nc lr nd lv mv mw mx my bi translated">用复杂假设验证数据框架。</li></ul><p id="fbf5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是在我们做任何事情之前，让我们在你的计算机上安装Pandera。</p><pre class="kk kl km kn gu ne nf ng nh aw ni bi"><span id="c1b8" class="nj nk iu nf b gz nl nm l nn no">pip install pandera</span></pre><p id="e6e9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们也创建一个虚拟数据集来与示例一起工作。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="np mp l"/></div></figure><h1 id="7594" class="nq nk iu bd nr ns nt nu nv nw nx ny nz ka oa kb ob kd oc ke od kg oe kh of og bi translated">用YAML配置验证熊猫数据帧</h1><p id="e63c" class="pw-post-body-paragraph la lb iu lc b ld oh jv lf lg oi jy li lj oj ll lm ln ok lp lq lr ol lt lu lv in bi translated">我喜欢YAML的配置！它们易于理解并且可以灵活扩展。做一个或者改装一个不需要130的智商。</p><p id="ac55" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">YAML文件是分层的键值映射。把它们想象成Python中没有花括号的字典。项目列表可以放在以连字符开头的单独的行中。您可以使用缩进来扩展子配置。</p><p id="24ab" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要更深入地了解YAML文件，请<a class="ae kz" href="https://circleci.com/blog/what-is-yaml-a-beginner-s-guide/" rel="noopener ugc nofollow" target="_blank">参阅Alek Sharma的本指南</a>。</p><p id="1376" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">下面的YAML文件对我们的数据集做了一些基本的检查。配置不是很直接吗？</p><p id="e848" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请阅读代码上的注释，以便更好地理解验证检查。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="np mp l"/></div></figure><p id="396c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对于数据集中的每一列，我们指定字段是否可以有空值、重复项等。我们还可以测试字段值是否在预定义的列表中，或者确认逻辑，比如小于特定的数量。</p><p id="a448" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们在项目中使用它来验证我们的虚拟数据集。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="np mp l"/></div></figure><p id="8f64" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">上面的代码从文件系统中读取yaml文件，并从中创建一个模式。然后，我们可以使用schema对象来验证数据帧。</p><p id="9aca" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">上面的验证调用将返回df，因为什么也没有发生。😧</p><p id="e113" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是让我们稍微改变一下我们的YAML文件。请注意，新版本有一个额外的验证来检查年龄变量是否小于60。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="np mp l"/></div></figure><p id="d991" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果再次尝试验证示例数据帧，您将看到以下错误。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj om"><img src="../Images/127d713f1d222bf828fdd8142d9a0e9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OzUsPCXU8MBsBQmAR0XvsQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Pandera引发的验证错误。图片由<a class="ae kz" href="https://thuwarakesh.medium.com" rel="noopener">作者提供。</a></p></figure><p id="c572" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这个错误是工具性的。除了提高它，Pandera还打印出不符合要求的记录。</p><p id="33e6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可以使用普通的Python代码来实现这个逻辑。但是对于我们和任何阅读我们代码的人来说，使用YAML文件更舒服。</p><h1 id="8445" class="nq nk iu bd nr ns nt nu nv nw nx ny nz ka oa kb ob kd oc ke od kg oe kh of og bi translated">使用验证注释方便地测试管道中的数据帧。</h1><p id="aa98" class="pw-post-body-paragraph la lb iu lc b ld oh jv lf lg oi jy li lj oj ll lm ln ok lp lq lr ol lt lu lv in bi translated">在复杂的管道中，您需要在不同的点测试您的数据帧。通常，我们需要在转换前后检查数据完整性。</p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/the-prefect-way-to-automate-orchestrate-data-pipelines-d4465638bac2"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">自动化和编排数据管道的完美方式</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">我正在将我所有的ETL工作从Airflow迁移到这个超级酷的框架中</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="on l mk ml mm mi mn kt lz"/></div></div></a></div><p id="f2de" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可以像以前一样使用已加载模式的验证方法。但是，Pandera有一个更好的方法，使用函数注释。</p><p id="9ffc" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Pandera有check_input和check_output注释。当用这些来注释一个函数时，它将测试函数参数和返回值中的数据帧。</p><p id="2e50" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要使用它，我们需要定义两个模式；一个用于输入(参数)，另一个用于返回数据帧。</p><p id="5e03" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">除了前面的YAML文件，让我们创建另一个如下指定的文件并加载它。姑且称之为<code class="fe oo op oq nf b">schema2</code>。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="np mp l"/></div></figure><p id="e790" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">下面是一个使用注释来验证函数的输入和输出数据帧的示例。请注意，Pandera假设第一个参数是dataframe。如果您有多个参数，请确保第一个是您的数据帧</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="np mp l"/></div></figure><p id="839a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Pandera对上述功能进行了两次测试。它在函数执行之前用<code class="fe oo op oq nf b">schema</code> <strong class="lc iv">测试输入数据集。此外，在</strong>功能执行后不久，用<code class="fe oo op oq nf b">schema2</code> <strong class="lc iv">测试输出数据帧。</strong></p><p id="dd2c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">玩弄<code class="fe oo op oq nf b">schema2</code>，诱发一些错误。</p><h1 id="36b0" class="nq nk iu bd nr ns nt nu nv nw nx ny nz ka oa kb ob kd oc ke od kg oe kh of og bi translated">动态定义模式以实现快速验证。</h1><p id="ad9b" class="pw-post-body-paragraph la lb iu lc b ld oh jv lf lg oi jy li lj oj ll lm ln ok lp lq lr ol lt lu lv in bi translated">从YAML文件加载并不是创建模式的唯一方式。然而，这是我最喜欢的方式。您可以完全在Python代码中创建模式。</p><p id="8bb5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">下面是我们第一个YAML文件的Python版本。注意相似之处。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="np mp l"/></div></figure><p id="e74e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在Python代码中定义模式有一个额外的好处。除了内置检查之外，您还可以定义自定义检查。</p><p id="c5c9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">例如，下面的代码检查order_value列的总和是否大于1000。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="np mp l"/></div></figure><p id="65aa" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是您很少需要编写定制代码，因为最常用的代码已经包含在模块中了。你只要抓住正确的。</p><h1 id="4d54" class="nq nk iu bd nr ns nt nu nv nw nx ny nz ka oa kb ob kd oc ke od kg oe kh of og bi translated">用复杂的假设验证管道中的数据框架。</h1><p id="2935" class="pw-post-body-paragraph la lb iu lc b ld oh jv lf lg oi jy li lj oj ll lm ln ok lp lq lr ol lt lu lv in bi translated">在所有伟大的功能中，这是我最喜欢的。</p><p id="3418" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">检查数据帧中的常见异常是没问题的。但是，做完整的假设检验是一个游戏改变者。我们可以根据更复杂的假设来验证数据集。</p><p id="84dd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">例如，在我们的购物数据集中，我们可以检查男性顾客是否比女性顾客购买更多。</p><p id="8598" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">下面的代码可以做到这一点。注意，要使这个工具工作，您需要安装假设和scipy。</p><pre class="kk kl km kn gu ne nf ng nh aw ni bi"><span id="c46c" class="nj nk iu nf b gz nl nm l nn no">pip install hypothesis scipy pandera[strategies,hypothesis]</span></pre><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="np mp l"/></div></figure><p id="02f8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，我们要测试的关系是“大于”由于我们的样本数据集没有证据支持这一假设，它将失败。但是如果你把关系改为“相等”,测试就通过了。此外，“等于”是默认设置。所以你可以把它拿掉。</p><h1 id="b780" class="nq nk iu bd nr ns nt nu nv nw nx ny nz ka oa kb ob kd oc ke od kg oe kh of og bi translated">最后的想法</h1><p id="9eaf" class="pw-post-body-paragraph la lb iu lc b ld oh jv lf lg oi jy li lj oj ll lm ln ok lp lq lr ol lt lu lv in bi translated">验证数据帧从未如此简单。</p><p id="79b1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我曾经为我需要执行的每个检查编写专用代码。当你在许多数据集上工作时，这是一件棘手的事情。当您在数据管道上工作时，经常会遇到这种情况。</p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/how-to-speed-up-python-data-pipelines-up-to-91x-80d7accfe7ec"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">如何将Python数据管道加速到91X？</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">一个5分钟的教程可以为您的大数据项目节省数月时间。</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="or l mk ml mm mi mn kt lz"/></div></div></a></div><p id="0645" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您需要在每个数据集上编写类似的代码。通常我的代码分布在几个笔记本上。</p><p id="a6ce" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但随着潘德拉的发现，我可以在一个地方管理他们。我更喜欢把它们放在YAML的档案里。但是我们也可以在Python代码中定义它。</p><p id="3fb8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">它从我们的代码中提取了大量的样板代码。它使我们的代码更具可读性，更不容易出错，并提供更多信息。</p><p id="8421" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">此外，我们还可以在数据集列上使用假设检验，这非常棒。</p></div><div class="ab cl os ot hy ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="in io ip iq ir"><blockquote class="oz pa pb"><p id="ed73" class="la lb pc lc b ld le jv lf lg lh jy li pd lk ll lm pe lo lp lq pf ls lt lu lv in bi translated">感谢阅读，朋友！在<a class="ae kz" href="https://www.linkedin.com/in/thuwarakesh/" rel="noopener ugc nofollow" target="_blank"><strong class="lc iv">LinkedIn</strong></a><a class="ae kz" href="https://twitter.com/Thuwarakesh" rel="noopener ugc nofollow" target="_blank"><strong class="lc iv">Twitter</strong></a><a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener"><strong class="lc iv">Medium</strong></a>上跟我打招呼。</p><p id="7c92" class="la lb pc lc b ld le jv lf lg lh jy li pd lk ll lm pe lo lp lq pf ls lt lu lv in bi translated">还不是中等会员？请使用此链接<a class="ae kz" href="https://thuwarakesh.medium.com/membership" rel="noopener"> <strong class="lc iv">成为会员</strong> </a>因为，不需要你额外付费，我为你引荐赚取一小笔佣金。</p></blockquote></div></div>    
</body>
</html>