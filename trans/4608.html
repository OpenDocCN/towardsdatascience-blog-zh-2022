<html>
<head>
<title>Create a Maintainable Data Pipeline with Prefect and DVC</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用提督和DVC创建一个可维护的数据管道</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/create-a-maintainable-data-pipeline-with-prefect-and-dvc-1d691ea5bcea#2022-10-13">https://towardsdatascience.com/create-a-maintainable-data-pipeline-with-prefect-and-dvc-1d691ea5bcea#2022-10-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a504" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使您的管道更易于支持和维护</h2></div><h1 id="d098" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">动机</h1><p id="3aa1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在工程中，可维护性是指产品维护的难易程度:</p><ul class=""><li id="f984" class="lw lx it lc b ld ly lg lz lj ma ln mb lr mc lv md me mf mg bi translated">满足新要求</li><li id="ab65" class="lw lx it lc b ld mh lg mi lj mj ln mk lr ml lv md me mf mg bi translated">应对不断变化的环境</li><li id="8ef7" class="lw lx it lc b ld mh lg mi lj mj ln mk lr ml lv md me mf mg bi translated">提高产品的性能</li></ul><p id="82e7" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">在数据科学项目中，构建可维护的管道至关重要，因为:</p><ul class=""><li id="ed91" class="lw lx it lc b ld ly lg lz lj ma ln mb lr mc lv md me mf mg bi translated">数据的特征可能会经常改变</li><li id="658b" class="lw lx it lc b ld mh lg mi lj mj ln mk lr ml lv md me mf mg bi translated">数据科学家需要尝试处理数据的新方法，引入新功能和模型来提高产品质量</li><li id="b56a" class="lw lx it lc b ld mh lg mi lj mj ln mk lr ml lv md me mf mg bi translated">项目的最终目标可能会改变</li><li id="249c" class="lw lx it lc b ld mh lg mi lj mj ln mk lr ml lv md me mf mg bi translated">该项目需要扩大规模以满足新的需求</li><li id="fc12" class="lw lx it lc b ld mh lg mi lj mj ln mk lr ml lv md me mf mg bi translated">管道在其生命周期中可能由不同的数据科学家构建和修改</li></ul><p id="5a25" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">那么如何构建一个可维护的管道呢？让我们从识别可维护管道的一些特征开始。</p><p id="60aa" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">可维护的管道应该:</p><ul class=""><li id="e384" class="lw lx it lc b ld ly lg lz lj ma ln mb lr mc lv md me mf mg bi translated"><strong class="lc iu">容易对</strong>对<strong class="lc iu">对</strong>对<strong class="lc iu">理解</strong></li><li id="8dd0" class="lw lx it lc b ld mh lg mi lj mj ln mk lr ml lv md me mf mg bi translated"><strong class="lc iu">很容易看出</strong>对管道的改动</li><li id="a2ca" class="lw lx it lc b ld mh lg mi lj mj ln mk lr ml lv md me mf mg bi translated"><strong class="lc iu">可重用</strong>减少需要验证和维护的代码总量</li><li id="60ee" class="lw lx it lc b ld mh lg mi lj mj ln mk lr ml lv md me mf mg bi translated"><strong class="lc iu">可观察的</strong>便于调试或确保管道正常工作</li><li id="60c9" class="lw lx it lc b ld mh lg mi lj mj ln mk lr ml lv md me mf mg bi translated"><strong class="lc iu">快速试验</strong>有效改进现有模型</li></ul><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi mp"><img src="../Images/b613863d605d08e58cfab53829b41437.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y1LyzO4LqBYVQy4VluLGJQ.png"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">作者图片</p></figure><p id="f9eb" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">在这篇文章中，<strong class="lc iu">你将学习如何使用提督和DVC的组合来创建一个可维护的管道。</strong></p><h1 id="558b" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">什么是DVC？</h1><p id="4cc9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><a class="ae nf" href="https://dvc.org/doc/start" rel="noopener ugc nofollow" target="_blank"> DVC </a>是数据版本控制系统。它本质上类似于Git的数据。</p><div class="ng nh gp gr ni nj"><a rel="noopener follow" target="_blank" href="/introduction-to-dvc-data-version-control-tool-for-machine-learning-projects-7cb49c229fe0"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">DVC介绍:机器学习项目的数据版本控制工具</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">就像Git一样，但是有数据！</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">towardsdatascience.com</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx mz nj"/></div></div></a></div><h1 id="f774" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">什么是提督？</h1><p id="9a6a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><a class="ae nf" href="https://www.prefect.io/" rel="noopener ugc nofollow" target="_blank">perfect</a>是一个开源库，允许你编排和观察用Python定义的数据管道。</p><div class="ng nh gp gr ni nj"><a href="https://medium.com/the-prefect-blog/orchestrate-your-data-science-project-with-prefect-2-0-4118418fd7ce" rel="noopener follow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">使用Prefect 2.0协调您的数据科学项目</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">让您的数据科学管道能够抵御故障</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">medium.com</p></div></div><div class="ns l"><div class="ny l nu nv nw ns nx mz nj"/></div></div></a></div><p id="7211" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">让我们来看看如何利用提督和DVC一起创建一个可维护的数据管道。</p><h1 id="b94f" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">容易理解</h1><p id="0a80" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">当管道的组件被很好地定义和适当地命名时，评审者可以关注更高层次的构建块以及它们如何组合在一起，而忽略每个块的细节。</p><p id="4b85" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">为了使管道更容易理解，您可以:</p><ul class=""><li id="feb1" class="lw lx it lc b ld ly lg lz lj ma ln mb lr mc lv md me mf mg bi translated">将代码分成更小的组件，每个组件只做一件事</li><li id="c0ac" class="lw lx it lc b ld mh lg mi lj mj ln mk lr ml lv md me mf mg bi translated">为每个组件指定一个描述性名称</li></ul><div class="ng nh gp gr ni nj"><a rel="noopener follow" target="_blank" href="/python-clean-code-6-best-practices-to-make-your-python-functions-more-readable-7ea4c6171d60"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">Python干净代码:让Python函数更具可读性的6个最佳实践</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">停止编写需要3分钟以上才能理解的Python函数</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">towardsdatascience.com</p></div></div><div class="ns l"><div class="nz l nu nv nw ns nx mz nj"/></div></div></a></div><p id="5a56" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">例如，在下面的代码中，可能很难理解<code class="fe oa ob oc od b">compare_two_keywords</code>函数的每一行代码。</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="8e50" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">让我们将流程分成更小的函数，每个函数只做一件事。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi og"><img src="../Images/cec45eea9466f99c24ee9a4358980a60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*SsxdiLj07GBe7RfIpB-VnA.gif"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">作者图片</p></figure><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="45b4" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">现在，由于内部函数的描述性名称，评审者可以理解<code class="fe oa ob oc od b">compare_two_keywords</code>函数是做什么的。</p><h1 id="dcf3" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">可观察量</h1><p id="b6cb" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">能够观察您的管道使得理解逻辑和调试代码更加容易。在本节中，您将学习如何通过以下方式使您的代码可被观察到:</p><ul class=""><li id="d4a2" class="lw lx it lc b ld ly lg lz lj ma ln mb lr mc lv md me mf mg bi translated">记录正在执行的组件</li><li id="19f7" class="lw lx it lc b ld mh lg mi lj mj ln mk lr ml lv md me mf mg bi translated">可视化管道中的组件</li><li id="a276" class="lw lx it lc b ld mh lg mi lj mj ln mk lr ml lv md me mf mg bi translated">可视化管道的输入和输出</li></ul><h2 id="dd79" class="oh kj it bd kk oi oj dn ko ok ol dp ks lj om on ku ln oo op kw lr oq or ky os bi translated">记录正在执行的组件</h2><p id="6bb0" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">目前，我们不知道执行文件时运行的是哪个组件，这使得调试变得很困难。</p><p id="17b1" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">为了了解哪个组件正在运行，我们可以将<code class="fe oa ob oc od b">@flow</code>添加到外部函数，将<code class="fe oa ob oc od b">@task</code>添加到内部函数。</p><p id="fe44" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">一个<a class="ae nf" href="https://docs.prefect.io/concepts/flows/" rel="noopener ugc nofollow" target="_blank">流程</a>是所有完美工作流的基础。一个<a class="ae nf" href="https://docs.prefect.io/concepts/tasks/" rel="noopener ugc nofollow" target="_blank">任务</a>代表一个流程中执行的不同的工作。</p><p id="b83b" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">简单地说，任务是做一件事的功能，而流是包含几个任务的功能。</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="0cbe" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">现在，当执行Python脚本时，您应该看到正在执行哪个任务及其状态。</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="7dc4" class="oh kj it bd kk oi oj dn ko ok ol dp ks lj om on ku ln oo op kw lr oq or ky os bi translated">可视化流程中的组件</h2><p id="124e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Prefect UI中的雷达图允许您可视化流程中任务及其状态之间的依赖关系。</p><p id="e5ee" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">例如，在下面的雷达图中，红色节点是失败的任务，而绿色节点是成功的任务。如果两个任务由一条线连接起来，它们就相互依赖(例如，一个任务使用另一个任务的输出)。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi ot"><img src="../Images/bf595ba62fb6c445687ea626fdd1f2ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9MRbIMKyn_RQueB5jMdnzg.png"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">作者图片</p></figure><p id="01a2" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">通过查看雷达图，审阅者能够更快地理解任务之间的关系。</p><h2 id="0a31" class="oh kj it bd kk oi oj dn ko ok ol dp ks lj om on ku ln oo op kw lr oq or ky os bi translated">用DVC可视化输入和输出</h2><p id="7087" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><em class="ou">阶段</em>代表单独的数据过程。有时，您可能希望可视化管道不同阶段的输入和输出。</p><p id="7d11" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">DVC允许你通过文件<code class="fe oa ob oc od b">dvc.yaml</code>指定管道中的阶段及其依赖关系</p><p id="f4d5" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">比如在<a class="ae nf" href="https://github.com/khuyentran1401/prefect-dvc" rel="noopener ugc nofollow" target="_blank">这个项目</a>中，我用<code class="fe oa ob oc od b">dvc.yaml</code> : <code class="fe oa ob oc od b">process_data</code>和<code class="fe oa ob oc od b">train</code>指定了两个阶段。在每个阶段，</p><ul class=""><li id="9399" class="lw lx it lc b ld ly lg lz lj ma ln mb lr mc lv md me mf mg bi translated"><code class="fe oa ob oc od b">cmd</code>指定执行阶段的命令</li><li id="71fe" class="lw lx it lc b ld mh lg mi lj mj ln mk lr ml lv md me mf mg bi translated"><code class="fe oa ob oc od b">deps</code>指定阶段的依赖关系</li><li id="6d27" class="lw lx it lc b ld mh lg mi lj mj ln mk lr ml lv md me mf mg bi translated"><code class="fe oa ob oc od b">outs</code>指定阶段的输出</li><li id="f978" class="lw lx it lc b ld mh lg mi lj mj ln mk lr ml lv md me mf mg bi translated"><code class="fe oa ob oc od b">plots</code>指定该阶段的情节</li><li id="6df6" class="lw lx it lc b ld mh lg mi lj mj ln mk lr ml lv md me mf mg bi translated"><code class="fe oa ob oc od b">params</code>指定代码中使用的影响结果的值</li></ul><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="1fee" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">现在，评审者可以通过运行<code class="fe oa ob oc od b">dvc dag --outs</code>来可视化每个阶段的输出文件:</p><pre class="mq mr ms mt gt ov od ow ox aw oy bi"><span id="eb2c" class="oh kj it od b gy oz pa l pb pc">                          +----------+                    <br/>                          | data/raw |                    <br/>                          +----------+                    <br/>                                *                         <br/>                                *                         <br/>                                *                         <br/>                      +-------------------+               <br/>                      | data/intermediate |               <br/>                      +-------------------+               <br/>                  ****          *          *****          <br/>              ****              *              ****      <br/>           ***                  *                  ***   <br/>+------------+         +-------------------+         +-------+<br/>| data/final |         | model/cluster.pkl |         | image |<br/>+------------+         +-------------------+         +-------+</span></pre><h1 id="4909" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">可重复使用的</h1><p id="6bab" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">很多时候，您可能想要重用管道的一些组件，比如配置和凭证。这减少了需要验证和维护的代码总量。</p><p id="aa2f" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">Prefect允许你用<a class="ae nf" href="https://docs.prefect.io/concepts/blocks/" rel="noopener ugc nofollow" target="_blank">块</a>做同样的事情。块提供了一种安全的方式来存储配置和功能，以便与外部系统(如AWS、GitHub、Slack或Microsoft Azure)进行交互。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi pd"><img src="../Images/eebcc7a62dd5d52d90be3eef9ea1a3ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R-LJid3730X9McAaKxjaWw.png"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">作者图片</p></figure><p id="2dec" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">让我们尝试通过<a class="ae nf" href="https://docs.prefect.io/ui/overview/" rel="noopener ugc nofollow" target="_blank">提督UI </a>使用secret块存储一个秘密。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi pe"><img src="../Images/5b1ba92b0707b036adace77ee0689add.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4QEprfEDq-8wo90pmYxTOQ.png"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">作者图片</p></figure><p id="bede" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">要在机密块中存储值，请单击添加，然后插入名称和值。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi pf"><img src="../Images/b74023b5eca84f4a3fb049f624382b12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xqLzU4zhUiPcGioKA4N89w.png"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">作者图片</p></figure><p id="16a3" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">现在，您和任何有权访问您的工作空间的人都可以在不同的Python脚本中访问这个秘密。</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="oe of l"/></div></figure><h1 id="c00f" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">很容易看出变化</h1><p id="1d46" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">当您对代码和参数进行更改时，了解这些更改是有用的。</p><p id="b6b0" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">DVC允许您使用命令<code class="fe oa ob oc od b">dvc status</code>查看管道中的变化:</p><pre class="mq mr ms mt gt ov od ow ox aw oy bi"><span id="a7ce" class="oh kj it od b gy oz pa l pb pc">$ dvc status<br/>process_data:                                                                                                       <br/>        changed deps:<br/>                modified:           src/process_data.py</span></pre><p id="b7c9" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">您也可以使用命令<code class="fe oa ob oc od b">dvc params diff</code>跟踪参数的变化:</p><pre class="mq mr ms mt gt ov od ow ox aw oy bi"><span id="d95f" class="oh kj it od b gy oz pa l pb pc">$ dvc params diff<br/>Path                           Param                             HEAD    workspace<br/>config/process/process_1.yaml  remove_outliers_threshold.Income  60000   61000</span></pre><h1 id="3a74" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">快速实验</h1><p id="bcb6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">建立管道也很重要，这样数据从业者就可以快速地试验不同的代码、参数和模型。</p><p id="eca1" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">有了Prefect，您可以通过下面解释的概念快速进行实验。</p><h2 id="6a1e" class="oh kj it bd kk oi oj dn ko ok ol dp ks lj om on ku ln oo op kw lr oq or ky os bi translated"><strong class="ak">时间表</strong></h2><p id="6dee" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">您可以安排流程定期运行，例如每天或一周中的某一天。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/05db06533ceacade4b3827f41512c432.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3W8A2eQwHCXweb7y.png"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">作者图片</p></figure><h2 id="7c7b" class="oh kj it bd kk oi oj dn ko ok ol dp ks lj om on ku ln oo op kw lr oq or ky os bi translated">重试次数</h2><p id="3ba0" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">假设您正试图连接到一个数据库。有时行得通，有时行不通。通常，如果无法连接到数据库，整个管道都会失败，您需要重新运行整个流程。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/324b0832881e4c3d8fce85e4c3cf6829.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_quw6geywFke717a.gif"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">作者图片</p></figure><p id="6508" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">在这种情况下，重新运行失败特定次数的任务比重新运行整个管道更有效。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/742aadd42f7276c1a46de897d9cb15f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PvdFL-brasPp4mCc.gif"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">作者图片</p></figure><p id="4b5f" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">提督允许你自动重试失败。要启用重试，请向您的任务添加<code class="fe oa ob oc od b">retries</code>和<code class="fe oa ob oc od b">retry_delay_seconds</code>参数:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="601e" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">在上面的代码中，<code class="fe oa ob oc od b">read_data</code>将最多重试3次，并在每次重试之间等待5秒钟。</p><h2 id="b140" class="oh kj it bd kk oi oj dn ko ok ol dp ks lj om on ku ln oo op kw lr oq or ky os bi translated">通知</h2><p id="25f7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">你的血流可能需要几个小时。您可以在流程完成或失败时向Slack通道或电子邮件发送通知，而不是经常检查代码的状态。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/16b432ebee51cee497febefe02a36b3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wIbn5CElAR1hKJMv.png"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">作者图片</p></figure><div class="ng nh gp gr ni nj"><a href="https://medium.com/the-prefect-blog/sending-slack-notifications-in-python-with-prefect-840a895f81c" rel="noopener follow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">使用提督在Python中发送松弛通知</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">通过松弛通知了解Python代码的进度</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">medium.com</p></div></div><div class="ns l"><div class="ph l nu nv nw ns nx mz nj"/></div></div></a></div><h2 id="d991" class="oh kj it bd kk oi oj dn ko ok ol dp ks lj om on ku ln oo op kw lr oq or ky os bi translated">贮藏</h2><p id="963d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">想象你运行一个流程两次。流程中的最后一个任务在您第一次运行时失败，因此您修复了您的任务，流程成功运行。</p><p id="104c" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">但是任务<code class="fe oa ob oc od b">fill_missing_description</code>运行时间比较长，需要等待第二次运行完成。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi pi"><img src="../Images/8dc8547826c29597645b6a4f30a24d10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kO6chZCMbrWw4VkR.gif"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">作者图片</p></figure><p id="2a99" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">不需要重新运行<code class="fe oa ob oc od b">fill_missing_description</code>，您可以在第一次运行时使用缓存来保存任务的结果，然后在第二次运行时重用它的结果。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi pi"><img src="../Images/c4add8ca6650d189f6d1ec6fc2d41166.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cRUalccjpC3sc11r.gif"/></div></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">作者图片</p></figure><p id="72da" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">要在提督中使用缓存，请指定<code class="fe oa ob oc od b">cache_key_fn</code>。缓存关键字指示一次运行是否与另一次运行相同。如果Prefect找到一个带有匹配缓存键的运行，它将使用缓存的运行。</p><p id="204a" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">要根据输入缓存任务，使用<code class="fe oa ob oc od b">task_input_hash</code>。如果任务输入没有改变，提督将使用缓存的结果。</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="2029" class="oh kj it bd kk oi oj dn ko ok ol dp ks lj om on ku ln oo op kw lr oq or ky os bi translated">仅当管道更改时才触发运行</h2><p id="ce0e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">有时，当有变化时，您可能希望只运行管道<strong class="lc iu">。这可以防止你在不必要的跑步上浪费时间和资源。</strong></p><p id="edfb" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">要在有变化时运行管道，使用命令<code class="fe oa ob oc od b">dvc repro</code>。</p><p id="20df" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">例如，当我的代码没有变化时，这是我运行命令时得到的输出:</p><pre class="mq mr ms mt gt ov od ow ox aw oy bi"><span id="6d55" class="oh kj it od b gy oz pa l pb pc">$ dvc repro<br/>'data/raw.dvc' didn't change, skipping                                                                              <br/>Stage 'process_data' didn't change, skipping                                                                        <br/>Stage 'train' didn't change, skipping                                                                               <br/>Data and pipelines are up to date.</span></pre><p id="dd62" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">如果<code class="fe oa ob oc od b">train</code>阶段的代码发生变化，则只执行<code class="fe oa ob oc od b">train</code>阶段的代码。</p><h1 id="8b83" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">结论</h1><p id="7633" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">恭喜你！您刚刚学习了如何使用DVC和提督创建可维护的管道。通过几个步骤来建立您的管道，您的团队在进行更改时会更有信心。</p><p id="3cee" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">查看这个资源库，了解一个全面的项目，该项目包括“提督”和“DVC ”:</p><div class="ng nh gp gr ni nj"><a href="https://github.com/khuyentran1401/prefect-dvc/" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">GitHub-khuyentran 1401/prefect-DVC</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">一个关于如何使用DVC·DVC的提督演示:数据版本控制提督:编排和观察数据流</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">github.com</p></div></div><div class="ns l"><div class="pj l nu nv nw ns nx mz nj"/></div></div></a></div></div><div class="ab cl pk pl hx pm" role="separator"><span class="pn bw bk po pp pq"/><span class="pn bw bk po pp pq"/><span class="pn bw bk po pp"/></div><div class="im in io ip iq"><p id="15bd" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">我喜欢写一些基本的数据科学概念，并尝试不同的数据科学工具。你可以在LinkedIn和Twitter上与我联系。</p><p id="8f06" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">如果你想查看我写的所有文章的代码，请点击这里。在Medium上关注我，了解我的最新数据科学文章，例如:</p><div class="ng nh gp gr ni nj"><a rel="noopener follow" target="_blank" href="/validate-your-pandas-dataframe-with-pandera-2995910e564"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">用Pandera验证你的熊猫数据框架</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">确保您的数据符合您的期望</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">towardsdatascience.com</p></div></div><div class="ns l"><div class="pr l nu nv nw ns nx mz nj"/></div></div></a></div><div class="ng nh gp gr ni nj"><a rel="noopener follow" target="_blank" href="/dagshub-a-github-supplement-for-data-scientists-and-ml-engineers-9ecaf49cc505"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">Dag shub:GitHub对数据科学家和ML工程师的补充</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">将您的数据、模型、实验和代码保存在一个地方</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">towardsdatascience.com</p></div></div><div class="ns l"><div class="ps l nu nv nw ns nx mz nj"/></div></div></a></div><div class="ng nh gp gr ni nj"><a href="https://pub.towardsai.net/github-actions-in-mlops-automatically-check-and-deploy-your-ml-model-9a281d7f3c84" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">MLOps中的GitHub动作:自动检查和部署您的ML模型</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">使用GitHub动作自动化您的ML管道</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">pub.towardsai.net</p></div></div><div class="ns l"><div class="pt l nu nv nw ns nx mz nj"/></div></div></a></div><div class="ng nh gp gr ni nj"><a rel="noopener follow" target="_blank" href="/create-robust-data-pipelines-with-prefect-docker-and-github-12b231ca6ed2"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">使用Prefect、Docker和GitHub创建强大的数据管道</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">将您的工作流存储在GitHub中，并在Docker容器中执行它</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">towardsdatascience.com</p></div></div><div class="ns l"><div class="pu l nu nv nw ns nx mz nj"/></div></div></a></div><h1 id="5b32" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">参考</h1><p id="7a64" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">维基媒体基金会。(2022年10月9日)。<em class="ou">可维护性</em>。维基百科。检索于2022年10月11日，发自https://en.wikipedia.org/wiki/Maintainability<a class="ae nf" href="https://en.wikipedia.org/wiki/Maintainability" rel="noopener ugc nofollow" target="_blank"/></p><p id="8afd" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated"><em class="ou">可维护的ETL:让您的管道更容易支持和扩展的技巧</em>。多线程。(未注明)。2022年10月11日检索，来自<a class="ae nf" href="https://multithreaded.stitchfix.com/blog/2019/05/21/maintainable-etls/" rel="noopener ugc nofollow" target="_blank">https://multithreaded . stitchfix . com/blog/2019/05/21/maintainable-etls/</a></p></div></div>    
</body>
</html>