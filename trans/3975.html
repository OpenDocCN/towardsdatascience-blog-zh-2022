<html>
<head>
<title>Learning to Rank for Product Recommendations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习产品推荐排名</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/learning-to-rank-for-product-recommendations-a113221ad8a7#2022-09-03">https://towardsdatascience.com/learning-to-rank-for-product-recommendations-a113221ad8a7#2022-09-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3ce4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">本文将介绍如何使用流行的XGBoost库来解决学习排序(LTR)问题</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b4d9a7665d509bcb97138296514429a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0Hlw7StBsU06xvrW"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@malvestida?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Malvestida </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="cce5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">LTR最常见的用例是搜索引擎和推荐系统。排名的最终目的是按照有意义的顺序排列项目。<br/>本文将使用流行的XGBoost库进行电影推荐。</p><p id="9629" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开始做LTR的时候，我的第一个问题是，传统的机器学习和排名问题有什么区别？这就是我的发现。在传统的机器学习问题中，每个实例都有一个目标类或值。例如，如果您正在处理一个客户流失预测问题，那么您拥有每个客户和相关类别的特性集。同样，我们的输出将是一个客户id和预测类或概率分数。但是在LTR中，我们没有针对每个实例的单一类或值。相反，我们有多个项目和它们每个实例的基本真值，我们的输出将是这些项目的最优排序。例如，如果我们有用户过去与项目的交互，我们的目标是建立一个能够预测最佳用户-项目对的模型。</p><p id="87b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在是时候进入编码部分了。为简单起见，我将使用movielens小型数据集。您可以使用下面的链接下载数据集。</p><div class="ls lt gp gr lu lv"><a href="https://grouplens.org/datasets/movielens/latest/" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">MovieLens最新数据集</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">这些数据集会随着时间的推移而变化，不适合用于报告研究结果。我们将保留下载…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">grouplens.org</p></div></div><div class="me l"><div class="mf l mg mh mi me mj kp lv"/></div></div></a></div><p id="6ee0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们加载数据集，并对数据集进行基本的预处理。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/b5cc288f3cdd5ecddbb2c690f7c46597.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*RMEpw6n3Zhr1LDqw8Gmv3Q.png"/></div></figure><p id="2f7c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个数据集中，我们有100，000个评级和3，600个标签应用程序，由600个用户应用于9，000部电影。</p><p id="7e6f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们快速看一下评级栏。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/e468d7f74806ec1e579451db558ff16c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*FUU-C9onw6-0kg1qR9eevw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">按值查看计数</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/fbc3c62723603f0177bc073939a821b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*5ci_Q9rTiCw86IvNQzDpqQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">按日名称查看计数</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mm"><img src="../Images/e0e431d597f52c199302ed17a45d442b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*w5_d6-R3rCA22gG-pm1vIQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">按接收小时数查看计数</p></figure></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="fb54" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看了上面的图之后，我为建模添加了一个基于时间、基于天的特性。因此，我将创建用户级和项目级功能。例如，对于某部电影“X ”,我得到了与之互动的用户总数，收到了5、4、3、2和1星的评论。此外，我正在添加每天收到的评论和下午5点后收到的评论。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="3c55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们将数据集分成训练集和测试集。我会用过去作为训练，最新的数据会用来评估模型。</p><p id="0600" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在是时候创建模型输入了。由于排名模型不同于传统的监督模型，我们必须向模型中输入额外的信息。现在是创建模型的时候了。我们将使用xgboost，XGBRanker。让我们把重点放在它的<em class="mw">上。配合</em>方法。下面是<em class="mw"> XGBRanker()的docstring。适合()。</em></p><blockquote class="mx my mz"><p id="ab1f" class="kw kx mw ky b kz la jr lb lc ld ju le na lg lh li nb lk ll lm nc lo lp lq lr ij bi translated">签名:model.fit(X，y，group，sample_weight=None，eval_set=None，sample_weight_eval_set=None，eval_group=None，eval_metric=None，early_stopping_rounds=None，verbose=False，xgb_model=None，callbacks=None) <br/> Docstring:拟合梯度增强模型</p><p id="ca28" class="kw kx mw ky b kz la jr lb lc ld ju le na lg lh li nb lk ll lm nc lo lp lq lr ij bi translated">因素</p><p id="e878" class="kw kx mw ky b kz la jr lb lc ld ju le na lg lh li nb lk ll lm nc lo lp lq lr ij bi translated">X : array_like特征矩阵<br/> y : array_like标签<br/> group : array_like <strong class="ky ir">训练数据的组大小</strong>T5】sample _ weight:array _ like组权重<br/>..注意:权重是针对分级任务中的每个组的，一个权重被分配给每个组(而不是每个数据点)。这是因为我们只关心每个组内数据点的相对顺序，所以给单个数据点分配权重没有意义。</p></blockquote></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="b403" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">根据下面的文档字符串，我们必须为训练和测试样本输入组。所以问题是如何在排名模型中创建组数组。我看到很多人很难理解这个群参数。</p><p id="55ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">简而言之，group参数表示每个用户的交互次数。根据下面的片段，你可以看到一号用户与两个项目(11和12)进行了交互。因此，用户1的组大小为2。此外，组长度应该等于数据集中唯一用户的数量，组大小的总和应该等于数据集中记录的总数。在下面的例子中<strong class="ky ir"> <em class="mw">组</em> </strong> <em class="mw"> </em>参数是<em class="mw">【2，1，4】</em>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/b7316837948270d6200549cb33c62b27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZJA1if1apPVbRsKfbjGu0Q.png"/></div></div></figure><p id="c55b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们创建模型输入。我们可以使用下面的代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="3922" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们将训练和测试输入输入到模型中。是时候对模型进行训练和评估了。在此之前，为了文章的完整性，我需要解释几个术语。</p><p id="eef9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">建立模型时，衡量预测的质量至关重要。评估推荐模型的可用度量有哪些？很少，但最常用的度量是<a class="ae kv" href="http://en.wikipedia.org/wiki/NDCG" rel="noopener ugc nofollow" target="_blank">归一化贴现累积增益(NDCG) </a>和<a class="ae kv" href="http://en.wikipedia.org/wiki/Mean_average_precision#Mean_average_precision" rel="noopener ugc nofollow" target="_blank">平均精度(MAP) </a>。在这里，我将使用NDCG作为评估指标。NDCG是CG(累积增益)的增强版。在CG中，推荐一个订单并不重要。如果您的结果包含任何顺序的相关项目，这将给您更高的值，表明我们的预测是好的。但在现实世界中，情况并非如此。我们在推荐时应该优先考虑相关项目。为了实现这一点，当低相关性项目在结果中较早出现时，我们应该进行惩罚。这就是DCG的做法。但是，当不同的用户有不同的项目/交互计数时，DCG仍然会受到影响。这就是<a class="ae kv" href="http://en.wikipedia.org/wiki/NDCG" rel="noopener ugc nofollow" target="_blank">归一化贴现累计收益(NDCG) </a>发挥作用的地方。它将使DCG度量标准正常化。</p><p id="0c83" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们可以移动到模型部分。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="819a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们可以做出一些预测。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="556a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是一些生成的预测。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/c8c8e4c8a622bb9afedb941877fda398.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4H2IqDzkA5-GQR-VZEAZHg.png"/></div></div></figure><p id="eb90" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">评估你的推荐模型的覆盖面总是好的。使用覆盖率度量，您可以检查测试集中培训产品的百分比。覆盖面越广，模型越好。在某些情况下，模型试图预测受欢迎的商家，以最大化NDCG和MAP@k。我在处理<a class="ae kv" href="https://play.google.com/store/apps/details?id=com.atlinkcom.starpointapp&amp;hl=en&amp;gl=US" rel="noopener ugc nofollow" target="_blank"> starpoints </a>产品推荐时遇到了这个问题。当我们对我们的评估标准有疑问时，我们可以快速检查我们模型的覆盖率。在这个模型中，我得到了大约2%的覆盖率。表明我们的模型应该进一步改进。</p><p id="a485" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，我们可以如下绘制特征重要性。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/603f3fbde98921ac37cc7a1b29ecf48d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iZjarbWIPuck-G2K8p0ZgA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">特性对XGBRanker的重要性</p></figure><h1 id="3d3f" class="ng nh iq bd ni nj nk nl nm nn no np nq jw nr jx ns jz nt ka nu kc nv kd nw nx bi translated">结论</h1><p id="b98e" class="pw-post-body-paragraph kw kx iq ky b kz ny jr lb lc nz ju le lf oa lh li lj ob ll lm ln oc lp lq lr ij bi translated">在本文中，我们介绍了学习排序问题的基础知识，如何对排序问题建模，以及一些与评估推荐模型相关的技巧。虽然本文展示了如何使用xgboost解决产品排名问题，但是我们也可以使用这种方法解决其他排名问题。</p><p id="902c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="mw">参考文献</em> </strong></p><p id="7ae2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">麦克斯韦·哈珀和约瑟夫·康斯坦。2015.电影镜头数据集:历史和背景。美国计算机学会交互式智能系统汇刊5，4:19:1–19:19。<a class="ae kv" href="https://doi.org/10.1145/2827872" rel="noopener ugc nofollow" target="_blank"><em class="mw">https://doi.org/10.1145/2827872</em></a></p><p id="8c7b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读。您可以使用<a class="ae kv" href="https://colab.research.google.com/drive/1pyhxI2skMUVsVVwZQ2uX2Pse8Y_NZH2N?usp=sharing" rel="noopener ugc nofollow" target="_blank">此</a>链接访问colab笔记本。</p><p id="2a5d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<a class="ae kv" href="http://www.linkedin.com/in/ransaka" rel="noopener ugc nofollow" target="_blank"> <em class="mw"> LinkedIn </em> </a>上和我联系。</p></div></div>    
</body>
</html>