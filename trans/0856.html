<html>
<head>
<title>Parallel Processing with Python and AWS EC2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 和 AWS EC2 进行并行处理</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/parallel-processing-with-python-and-aws-ec2-3b01fdc8272#2022-03-08">https://towardsdatascience.com/parallel-processing-with-python-and-aws-ec2-3b01fdc8272#2022-03-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e06f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">更快地运行您的脚本</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/db80885f54569564f519426446cf6407.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ple4cm09-LhCcx9L"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae ky" href="https://unsplash.com/@max_duz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Max Duzij </a>拍摄的照片</p></figure><h1 id="b923" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="b61b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在进行数据科学项目时，我经常遇到的一个问题是需要加快脚本的速度。这可能是在探索性数据分析期间，或者可能是在自然语言处理时获得文档相似性。无论如何，在这种情况下，我可怜的计算机要么在我运行脚本几个小时时变慢，要么在我需要再次使用计算机之前花费太长时间。然后等了这么久，我甚至可能需要回去编辑，重新运行剧本！</p><p id="3291" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">有几种方法可以解决这个问题，但在本文中，我将首先直接用 Python 介绍我的方法，然后引入 AWS EC2。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="85b0" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">多重处理</h1><p id="7464" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">你电脑的 CPU(很可能)有多个内核，每个内核可以执行不同的任务。这意味着当你运行一个 Python 脚本时，你可以继续检查空闲时间和回复邮件，但是我们经常希望尽快得到我们的脚本结果。为了实现这一点，我们可以使用 Python 的多处理库来并行使用我们的所有(或 1 个以上)CPU 内核。</p><p id="c5c4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面的要点给出了一个简单的方法来实现函数<code class="fe ne nf ng nh b">process</code>的多重处理，该函数为<code class="fe ne nf ng nh b">i_list</code>中的每个参数<code class="fe ne nf ng nh b">i</code>运行。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="ba8c" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">AWS EC2</h1><p id="0d1b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">然而，我们可能并不总是拥有生成结果的本地计算能力，甚至不想让脚本在本地运行。Amazon EC2 也被称为 Amazon Elastic Compute Cloud，它支持创建具有不同计算能力级别的虚拟机，这对于将我们的本地脚本运行扩展到云是完美的。</p><ol class=""><li id="4aad" class="nk nl it lt b lu mn lx mo ma nm me nn mi no mm np nq nr ns bi translated">创建一个虚拟机，并按照<a class="ae ky" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstancesLinux.html" rel="noopener ugc nofollow" target="_blank">标准步骤连接</a>。</li></ol><pre class="kj kk kl km gt nt nh nu nv aw nw bi"><span id="a577" class="nx la it nh b gy ny nz l oa ob">1. Open an SSH client.<br/>2. Locate your private key file. The key used to launch this instance is temp-cluster.pem<br/>3. Run this command, if necessary, to ensure your key is not publicly viewable.<br/>	chmod 400 temp-cluster.pem<br/>4. Connect to your instance using its Public DNS:<br/>	ec2-1234.eu-west-1.compute.amazonaws.com<br/>5. Example: <br/>	ssh -i "temp-cluster.pem" ubuntu@ec2-1234.eu-west-1.compute.amazonaws.com</span></pre><p id="3ca1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">2.用 Python 设置 VM，并安装所需的 Python 包。在我的上一个项目中，我做了一些自然语言处理，需要去除停用词。</p><pre class="kj kk kl km gt nt nh nu nv aw nw bi"><span id="6dfc" class="nx la it nh b gy ny nz l oa ob">sudo apt update<br/>sudo apt install python3-pip</span><span id="f4ce" class="nx la it nh b gy oc nz l oa ob">pip install nltk<br/>python3 -m nltk.downloader stopwords<br/>pip install numpy pandas sklearn scipy</span></pre><p id="ceb2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">3.要将文件(通常是我们的脚本)移动到 EC2 实例，我们可以使用 secure copy 命令。默认路径是/home/ubuntu。</p><pre class="kj kk kl km gt nt nh nu nv aw nw bi"><span id="5f25" class="nx la it nh b gy ny nz l oa ob">scp -i .ssh/temp-cluster.pem Documents/nlp_script.py ubuntu@ec2-1234.eu-west-1.compute.amazonaws.com:/home/ubuntu</span></pre><p id="643d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">4.现在，如果需要，我们可以创建一个文件夹来保存脚本输出，然后运行 Python3 脚本。</p><pre class="kj kk kl km gt nt nh nu nv aw nw bi"><span id="71f2" class="nx la it nh b gy ny nz l oa ob">sudo mkdir script_output_folder<br/>python3 nlp_script.py<br/><br/># List directory folders<br/>ls -d */<br/># List folder contents<br/>ls -R</span></pre><p id="6d7c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">5.为了在会话断开或计算机关闭的情况下保持脚本运行，我们可以使用 tmux。</p><pre class="kj kk kl km gt nt nh nu nv aw nw bi"><span id="58ae" class="nx la it nh b gy ny nz l oa ob"># Install tmux<br/>sudo apt-get install tmux</span><span id="fae5" class="nx la it nh b gy oc nz l oa ob"># Start a terminal session<br/>tmux new -s mywindow</span><span id="387b" class="nx la it nh b gy oc nz l oa ob"># Restart local computer, ssh to reconnect to the EC2 instance, and <br/>resume the terminal window<br/>tmux a -t mywindow</span></pre><p id="bd1e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">6.最后，从 EC2 实例下载文件。</p><pre class="kj kk kl km gt nt nh nu nv aw nw bi"><span id="c28f" class="nx la it nh b gy ny nz l oa ob"># To copy the script back to the local "Documents" folder<br/>scp -i .ssh/temp-cluster.pem ubuntu@ec2-1234.eu-west-1.compute.amazonaws.com:/home/ubuntu/nlp_script.py Documents<br/><br/># Zip a folder for easy download<br/>zip -r squash.zip /home/ubuntu/script_output_folder/<br/><br/># Use wildcards to download many files<br/>scp -i .ssh/temp-cluster.pem ubuntu@ec2-1234.eu-west-1.compute.amazonaws.com:/home/ubuntu/script_output_folder/* Documents</span></pre><p id="9239" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一旦我们所有的处理完成并下载回我们的本地驱动器，EC2 实例就可以删除了。我们现在可以正常访问新文件了。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="fb35" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">最后的想法</h1><p id="d64b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您可能是在试图弄清楚 Python 中的并行处理或者如何使用 Amazon EC2 实例来实现它的时候偶然看到这篇文章的，在这种情况下，我希望这对您有所帮助！</p></div></div>    
</body>
</html>