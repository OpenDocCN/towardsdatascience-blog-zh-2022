<html>
<head>
<title>Plotting Heat Maps in Python using Bokeh, Folium, and hvPlot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Bokeh、Folium和hvPlot在Python中绘制热图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/plotting-heat-maps-in-python-using-bokeh-folium-and-hvplot-eb7c7f49dbc6#2022-08-23">https://towardsdatascience.com/plotting-heat-maps-in-python-using-bokeh-folium-and-hvplot-eb7c7f49dbc6#2022-08-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5c5a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">热图是一种有用的可视化工具，Python有几个很好的工具来制作它们</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a2b7325267cf13de027f8a9ffb970fbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5J4z84fewL037kfZnwzzUQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">凯尔西·奈特在<a class="ae ky" href="https://unsplash.com/s/photos/map?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="fe3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我一直很喜欢地图，但是，为空间数据创建引人注目的可视化效果是一项挑战。对于Python程序员来说，一个特别困难的领域是当我们的数据有很多点时创建地图。太多的点会很快变得不方便查看和浏览器渲染。</p><p id="1b93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">热图在这种情况下特别有用，因为它们可以快速给出数据的密度和空间分布，而无需离散绘制每个点。这与散点图形成对比，散点图本质上只是叠加在地图顶部的点的散点图。散点图很容易制作，但是当你有很多数据点时，由于过度绘制，它们很难查看。</p><p id="4f0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本帖中，我们将学习如何使用散景、树叶和hvPlot来可视化全美180万起野火的发生。我们将讨论每个库的优缺点，并找出在2022年使用哪个库最好。</p><h1 id="d1d4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">我们的数据</h1><p id="b254" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们正在处理的数据记录了从1992年到2015年发生在美国的超过180万起野火。每个火灾记录包含位置、最终火灾规模、发现日期等信息。这是一个有趣的数据集，足够大，可以展示可视化大数据集的一些挑战，而不会太大，让大多数笔记本电脑无法使用。</p><p id="3e54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将wildfire数据从SQLite数据库快速导入到Pandas数据框架中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/935efa17957f21eb80f6a6afac6d6a3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Egrxags0mXt-wW3oz9iEFg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者创建</p></figure><h2 id="50c6" class="mv lw it bd lx mw mx dn mb my mz dp mf li na nb mh lm nc nd mj lq ne nf ml ng bi translated">数据聚合</h2><p id="0a22" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">有许多方法可以聚集数据，以便我们可以更有效地将其可视化；一些图书馆甚至可以为我们处理所有这些。首先，让我们试着将发生在彼此附近的火灾进行分组。</p><p id="2c45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过截断纬度和经度值，创建一个合并截断的纬度-经度值的新列，然后按照新列对数据帧进行分组来实现这一点。一旦你看到代码就会明白:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/ffd365d6fc14f24933888a1bd703e21b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v_EWeKGZE2yrjw2RiMKB1w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者创建</p></figure><p id="817f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在有64，250组火灾，而不是180万个单独的火灾。这有助于我们减少要渲染的数据点的数量，现在我们可以聚合信息，如火灾计数或每个组中的平均火灾大小。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/fd2d302ebbbad834b715277382c33406.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RWkyDGJ0HYJgLSgYTGaiqQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者创建</p></figure><p id="3a2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一种非常简单的将我们的火聚集成组的方法，但我认为它有助于展示使用更大的空间数据集的一些挑战。在保留信息的同时减少视觉混乱(这会使地图难以阅读)是一种平衡。</p><h1 id="921a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">散景</h1><blockquote class="nj nk nl"><p id="f817" class="kz la nm lb b lc ld ju le lf lg jx lh nn lj lk ll no ln lo lp np lr ls lt lu im bi translated"><strong class="lb iu">注:</strong>互动剧情可以在这个<a class="ae ky" href="https://nbviewer.org/github/wino6687/medium_hvPlot_Intro/blob/master/heatmap_examples.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">直播笔记本</strong> </a>上找到。</p></blockquote><p id="72ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Bokeh是一个很棒的Python绘图库，可以很好地制作可以在线共享的绘图。散景的优势之一是它的交互性很强，允许缩放、平移和搜索特定坐标。我们可以使用聚合数据集创建散点图，其功能类似于热图:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/56d1793093722f4ad8af659fb47a54c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rrPkKdq1dCjVk7DAiRPn7Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者创建</p></figure><p id="aba1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这还不算太糟！我让第一个图保持简单，以强调Colorcet的冷色图。此外，由于野火已经在美国各地发生，我们不一定需要一张底图来理解我们正在看的东西。</p><p id="48ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，这个图在它实际能够教给我们的方面是非常有限的，而且有更好的方法来制作这种热图，而不是绘制64，000个离散的点——即使64，000个点少于1，800，000个点。我们很可能画得太多了，所以我们失去了细节，因为有这么多的点放在彼此的顶部。它看起来很酷，但我们将在以后看到更多有用的情节。</p><p id="2e80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们制作第二个图，因为我们已经准备好了数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/95ec32e13e64ddb6fab41ba7a1cf7b94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H7e7nQfBEQhHs2qT9ks1PA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者创建</p></figure><p id="e45d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然这个图非常相似，但比较这两个图确实有助于我们理解美国西部的火灾往往更大，尽管它们发生的频率更低。</p><h1 id="3984" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">薄层</h1><p id="cd60" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">follow是优秀的JavaScript库fleet . js的Python包装器。虽然它可能受到包装器库的一些限制——比直接使用fleet更少的定制——但follow仍然将fleet . js的许多优势带入了Python生态系统。</p><p id="e76e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们展示一个更独特的热图，将我们的数据转换成适合我们的梯度。将离散数据点转换为网格值(图像)的过程称为光栅化。这样，我们可以将离散的火灾数据点聚合成一个数值网格。虽然我们失去了每一场火灾的信息，但我们得到了一张反应更灵敏的地图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/ff1925f88703b132ed3f437399f15868.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SoW6Hud6isOgjY_jGO9RBA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者创建</p></figure><p id="d1b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我应该注意到，我们可能会通过调整梯度来彻底改变这个图，这很容易做到。这个图看起来可能有很多代码，但是，这个图非常灵敏，内置的<code class="fe nt nu nv nw b">HeatMap</code>函数是一个很好的工具，可以轻松地从离散的数据点创建适当的连续可视化。</p><h1 id="e452" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">hvPlot</h1><p id="f5ce" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">叶是一个强大的图书馆，但我再次发现我最喜欢的任务工具来自全息视图。我使用Holoviews、hvPlot、Colorcet、Datashader和Geoviews在更短的时间内不断获得更好的绘图。</p><p id="7b59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这听起来像是很多库，但是你不必与它们中的大多数进行交互，除非你需要一些特定的东西；否则一切都会在你的引擎盖下发生。让我们使用Holoviews中的工具重新创建我们的情节。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/e849b4c0f628f8d77f6ec9c75b254432.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*nmRcUADroXKSEfo31M4nLQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者创建</p></figure><p id="649e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这绝对是最好的热图。我需要将弹出窗口中的x/y标签调整为lat/long，但除此之外，hvPlot为我做了我想要的一切。它甚至给了我一个像样的彩条作为传说，这可能是一个痛苦与其他图书馆。</p><p id="ad13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您会注意到，我确实不得不从几个库中把它放在一起:</p><ul class=""><li id="346a" class="nx ny it lb b lc ld lf lg li nz lm oa lq ob lu oc od oe of bi translated"><strong class="lb iu">全息视图</strong>用于访问底图图块。</li><li id="acdf" class="nx ny it lb b lc og lf oh li oi lm oj lq ok lu oc od oe of bi translated"><strong class="lb iu"> Datashader </strong>用于栅格化，并给了我一个简单的方法将经度和纬度转换成米，这是hvPlot的首选。</li><li id="d77e" class="nx ny it lb b lc og lf oh li oi lm oj lq ok lu oc od oe of bi translated"><strong class="lb iu"> Colorcet </strong>为彩色地图。</li></ul><p id="98b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有这些的关键部分是<code class="fe nt nu nv nw b">rasterize=True</code>，它告诉hvPlot让DataShader栅格化数据，使其更容易处理。Datashader确实很有意思，但是值得有自己的帖子来深入讨论它是如何工作的；现在，重要的是要知道，它正在处理将我们的许多离散数据点转换成更容易呈现和更容易可视化的网格值。</p><h1 id="3f16" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">包扎</h1><p id="fa4a" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">令人惊讶的是Python的空间可视化工具在过去几年中取得了如此大的进步，并且有许多很好的选项可供选择来创建您心目中的情节。</p><p id="dcc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Holoviews能够提供的特性和易用性给我留下了深刻的印象，而不会因为混乱的堆栈跟踪而导致无尽的错误。制作新的图表和仪表盘很有趣，而且一路上很少遇到问题。</p><h1 id="a83c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">资源</h1><ul class=""><li id="e1fa" class="nx ny it lb b lc mn lf mo li ol lm om lq on lu oc od oe of bi translated"><a class="ae ky" href="https://nbviewer.org/github/wino6687/medium_hvPlot_Intro/blob/master/heatmap_examples.ipynb" rel="noopener ugc nofollow" target="_blank">互动剧情直播笔记本</a></li><li id="da47" class="nx ny it lb b lc og lf oh li oi lm oj lq ok lu oc od oe of bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/holoviz-is-simplifying-data-visualization-in-python-d51ca89739cf">HV plot简介</a></li><li id="e227" class="nx ny it lb b lc og lf oh li oi lm oj lq ok lu oc od oe of bi translated"><a class="ae ky" href="https://holoviews.org/" rel="noopener ugc nofollow" target="_blank">全息视图文档</a></li><li id="8aa5" class="nx ny it lb b lc og lf oh li oi lm oj lq ok lu oc od oe of bi translated"><a class="ae ky" href="https://python-visualization.github.io/folium/" rel="noopener ugc nofollow" target="_blank">叶文件</a></li><li id="fc8b" class="nx ny it lb b lc og lf oh li oi lm oj lq ok lu oc od oe of bi translated"><a class="ae ky" href="https://docs.bokeh.org/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">散景文档</a></li></ul><blockquote class="nj nk nl"><p id="2466" class="kz la nm lb b lc ld ju le lf lg jx lh nn lj lk ll no ln lo lp np lr ls lt lu im bi translated"><strong class="lb iu">注意:</strong>如果你喜欢在Medium上阅读我和其他人的内容，考虑使用下面的链接订阅，以支持这样的内容创建，并解锁无限的故事！</p></blockquote><div class="oo op gp gr oq or"><a href="https://medium.com/@willmnorris/membership" rel="noopener follow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd iu gy z fp ow fr fs ox fu fw is bi translated">用我的推荐链接加入媒体-威尔·诺里斯</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">阅读威尔·诺里斯(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">medium.com</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf ks or"/></div></div></a></div><h1 id="55f9" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">引文</h1><ul class=""><li id="80f0" class="nx ny it lb b lc mn lf mo li ol lm om lq on lu oc od oe of bi translated"><a class="ae ky" href="https://www.kaggle.com/datasets/rtatman/188-million-us-wildfires?datasetId=2478&amp;searchQuery=wildfire" rel="noopener ugc nofollow" target="_blank">野火数据</a> —公共域(CC0)</li></ul><p id="7a50" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">短，凯伦C. 2017。美国1992–2015年的空间野火发生数据[FPA <em class="nm"> FOD </em> 20170508]。第四版。柯林斯堡，CO:林务局研究数据档案。【https://doi.org/10.2737/RDS-2013-0009.4 T4】</p></div></div>    
</body>
</html>