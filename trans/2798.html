<html>
<head>
<title>When R Meets SQL to Query Dataframes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当R遇到SQL查询数据帧时</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/when-r-meets-sql-to-query-data-frames-a94d9d92b0f2#2022-06-16">https://towardsdatascience.com/when-r-meets-sql-to-query-data-frames-a94d9d92b0f2#2022-06-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4df1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在R数据帧上运行SQL命令的全面概述。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/50e7f766ec2d1ced8202693a90b2e293.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zhOwK5Ab0xdYwIVO.jpg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://pixabay.com/users/peggy_marco-1553824/" rel="noopener ugc nofollow" target="_blank"> Peggy_Marco </a>在<a class="ae ky" href="https://pixabay.com/illustrations/meet-relationship-business-1019875/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上</p></figure><h1 id="2f2b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="2166" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">作为一名数据科学家，您可能已经听说过SQL和r。SQL非常适合与关系数据库进行交互。另一方面，r是执行高级统计分析的一个很好的工具。然而，有些任务在SQL中比在R中简单，反之亦然。如果我们能有一种工具，可以结合每种工具的优点，会怎么样？这就是<code class="fe mn mo mp mq b"><strong class="lt iu">sqldf</strong></code>派上用场的地方。本文旨在强调<code class="fe mn mo mp mq b">sqldf</code>的一些特性，类似于SQL中的特性。</p><h1 id="7d8e" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">什么是SQLDf</h1><p id="097e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe mn mo mp mq b">sqldf</code>是一个开源库，用于在R数据帧上运行SQL语句。它可以与SQLite、H2、PostgreSQL和MySQL数据库等多种数据库协同工作。</p><h1 id="5644" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">入门指南</h1><h2 id="fb6f" class="mr la it bd lb ms mt dn lf mu mv dp lj ma mw mx ll me my mz ln mi na nb lp nc bi translated">安装软件包</h2><p id="51a5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">是时候动手了！但是，我们首先需要使用<strong class="lt iu"><em class="nd">install . packages</em></strong>函数安装<code class="fe mn mo mp mq b">sqldf</code> <strong class="lt iu"> <em class="nd"> </em> </strong>库。</p><pre class="kj kk kl km gt ne mq nf ng aw nh bi"><span id="8c1d" class="mr la it mq b gy ni nj l nk nl"># Install the library <br/>install.packages("sqldf") </span><span id="04c4" class="mr la it mq b gy nm nj l nk nl"># Load the library <br/>library("sqldf")</span></pre><h2 id="0a66" class="mr la it bd lb ms mt dn lf mu mv dp lj ma mw mx ll me my mz ln mi na nb lp nc bi translated">数据和预处理</h2><p id="cb3c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在本文中，我们将使用一个标准的机器学习数据集，称为“<em class="nd">成人收入</em>”，在<a class="ae ky" href="https://archive.ics.uci.edu/ml/datasets/Adult" rel="noopener ugc nofollow" target="_blank"> UCI机器学习</a>许可证下免费提供。通过直接从<a class="ae ky" href="https://raw.githubusercontent.com/keitazoumana/Medium-Articles-Notebooks/main/data/adult-all.csv" rel="noopener ugc nofollow" target="_blank">我的Github </a>中读取或者使用<code class="fe mn mo mp mq b">read.csv()</code>功能下载并保存在你当前的工作目录中，开始获取数据集。</p><pre class="kj kk kl km gt ne mq nf ng aw nh bi"><span id="f8b4" class="mr la it mq b gy ni nj l nk nl">data_url = "<a class="ae ky" href="https://raw.githubusercontent.com/keitazoumana/Medium-Articles-Notebooks/main/data/adult-all.csv" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/keitazoumana/Medium-Articles-Notebooks/main/data/adult-all.csv</a>"</span><span id="6a98" class="mr la it mq b gy nm nj l nk nl"># Read the data<br/>income_data &lt;- read.csv(data_url)</span><span id="9b11" class="mr la it mq b gy nm nj l nk nl"># Check the first 5 rows of the data<br/>head(income_data, 5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/cc135e67a90f060011a6e769d86f30c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IvAA2UxR6Is2ubeweFAtSA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据集的前5行(图片由作者提供)</p></figure><p id="538d" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">数据的列(V1，V1，…，V15)是不可理解的，我们可以用下面的语法重命名它们。这些名字来自<a class="ae ky" href="https://archive.ics.uci.edu/ml/datasets/Adult" rel="noopener ugc nofollow" target="_blank"> UCI机器学习</a>网站，所以没有什么是发明的。</p><pre class="kj kk kl km gt ne mq nf ng aw nh bi"><span id="590f" class="mr la it mq b gy ni nj l nk nl">new_columns = c("Age", "Workclass", "fnlwgt", "Education", "EducationNum", "MartialStatus", "Occupation", <br/>           "Relationship", "Race", "Sex", "CapitalGain", <br/>           "CapitalLoss", "HoursPerWeek", "Country", "Income")</span><span id="2537" class="mr la it mq b gy nm nj l nk nl"># Change column names<br/>colnames(income_data) &lt;- new_columns</span><span id="062d" class="mr la it mq b gy nm nj l nk nl"># Check the first 5 rows of the data again<br/>head(income_data, 5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/30379b1fad76343d4549da50441362a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sxV5cX0lkTs56UYKn8SrRw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">重命名列后数据集的前5行(作者图片)</p></figure><p id="aa21" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">正如您在前面的屏幕截图中看到的，更改已经成功执行。</p><p id="d318" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">最后，让我们使用tidy向数据集添加一个<strong class="lt iu"> ID </strong>列，这将是每个人的标识符。在本文的后面，您会发现本专栏的好处。</p><pre class="kj kk kl km gt ne mq nf ng aw nh bi"><span id="6be9" class="mr la it mq b gy ni nj l nk nl"># Add the ID column to the dataset<br/>income_data$ID &lt;- 1:nrow(income_data)</span><span id="fa05" class="mr la it mq b gy nm nj l nk nl"># Show the first 5 rows</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/c9089bbecedbb887eaf08330c4bfa7d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3GtOQMznL0VTCyMHW5Ksgg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">添加ID列后数据集的前5行(图片由作者提供)</p></figure><h1 id="ffa3" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">使用sqldf的SQL查询</h1><p id="70fa" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了能够执行任何SQL查询，您需要使用<code class="fe mn mo mp mq b">sqldf</code>函数，该函数将字符串格式 的查询作为参数<strong class="lt iu"> <em class="nd">，如下所示。</em></strong></p><pre class="kj kk kl km gt ne mq nf ng aw nh bi"><span id="3a10" class="mr la it mq b gy ni nj l nk nl"><strong class="mq iu">sqldf</strong>("YOUR_SQL_QUERY")</span></pre><p id="59f1" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">在这一节中，我们将讨论从简单到更高级的不同查询，从选择列开始。</p><h2 id="4f4e" class="mr la it bd lb ms mt dn lf mu mv dp lj ma mw mx ll me my mz ln mi na nb lp nc bi translated">列选择</h2><p id="d874" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们可以检索满足一个或多个条件的数据列。例如，我们可以提取古巴成年人的年龄、种族、性别、每周工作时间和收入。</p><p id="dd2c" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated"><strong class="lt iu">注意</strong>:在语法中，确保不要忘记<strong class="lt iu">古巴</strong>周围的<strong class="lt iu">“</strong>符号，以使其工作。</p><pre class="kj kk kl km gt ne mq nf ng aw nh bi"><span id="33cc" class="mr la it mq b gy ni nj l nk nl">cuba_query = "SELECT Age, Race, Sex, HoursPerWeek, Income \<br/>              FROM income_data \ <br/>              WHERE Country = 'Cuba'"<br/>cuba_data = sqldf(cuba_query)<br/>head(cuba_data, 5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/d9f1414947b63252eac96ce633f874cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:578/format:webp/1*SJ9vxkPYXs21v4Hzcx0oKw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">关于古巴成年人的前5行数据(图片由作者提供)</p></figure><p id="f469" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">我们可能想增加一个额外的限制，以便只获得每周工作40小时以上且不到40岁的古巴成年人。</p><pre class="kj kk kl km gt ne mq nf ng aw nh bi"><span id="a1dd" class="mr la it mq b gy ni nj l nk nl">cuba_query_2 = "SELECT Age, Race, Sex, HoursPerWeek, Income \<br/>              FROM income_data \ <br/>              WHERE Country = 'Cuba'\ <br/>              AND HoursPerWeek &gt; 40 \ <br/>              AND Age &gt; 40"</span><span id="9e0f" class="mr la it mq b gy nm nj l nk nl">cuba_data_2 = sqldf(cuba_query_2)<br/>head(cuba_data_2, 5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/dda524250d7767dd60184bac808cf7cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:568/format:webp/1*2FUvIyASY0-qKjE5X6Q2fg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">40岁以上、每周工作超过40小时的古巴成年人(图片由作者提供)</p></figure><h2 id="b2ad" class="mr la it bd lb ms mt dn lf mu mv dp lj ma mw mx ll me my mz ln mi na nb lp nc bi translated">GROUP BY语句</h2><p id="434b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">除了选择列之外，我们可能还希望将数据划分到不同的组中，以便在诸如<code class="fe mn mo mp mq b">AVG()</code>、<code class="fe mn mo mp mq b">COUNT()</code>、<code class="fe mn mo mp mq b">MAX()</code>、<code class="fe mn mo mp mq b">MIN()</code>和<code class="fe mn mo mp mq b">SUM()</code>等函数的帮助下获得更全面的概述。使用<code class="fe mn mo mp mq b">GROUP BY</code>，不同行中具有相同值的特定列将被分组在一起。</p><p id="405d" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">例如，让我们考虑每个国家每周的平均工作时间，然后按照平均工作时间的升序排序。</p><pre class="kj kk kl km gt ne mq nf ng aw nh bi"><span id="2fe5" class="mr la it mq b gy ni nj l nk nl"># Prepare the query<br/>wwh_per_country_query = "SELECT Country, AVG(HoursPerWeek) <br/>                         AS AvgWorkHours \<br/>                         FROM income_data <br/>                         GROUP BY Country <br/>                         ORDER BY AvgWorkHours ASC"</span><span id="7bce" class="mr la it mq b gy nm nj l nk nl"># Run the query<br/>wwh_per_country_data = sqldf(wwh_per_country_query) </span><span id="089c" class="mr la it mq b gy nm nj l nk nl"># Get the first 5 observations <br/>head(wwh_per_country_data, 5)</span><span id="cd9a" class="mr la it mq b gy nm nj l nk nl"># Get the last 5 observations<br/>tail(wwh_per_country_data, 5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/66934cabba0fade6d4f06a32f46785cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:402/format:webp/1*RG_GTgtK1PVTk3gKoghOVQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">平均每周工作时间:<strong class="bd ny">前5次观察</strong>(图片由作者提供)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/22dc0cdad608b18b4f62d8d6015acec5.png" data-original-src="https://miro.medium.com/v2/resize:fit:378/format:webp/1*lUkDYGc913AjS01A_QBK3Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">平均每周工作时间:<strong class="bd ny">最近5次观察</strong>(图片由作者提供)</p></figure><p id="3e08" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">为了更清楚，我们来分解一下查询。</p><ul class=""><li id="1ecf" class="oa ob it lt b lu no lx np ma oc me od mi oe mm of og oh oi bi translated">我们选择所有的国家和他们各自的每周工作时间。然后使用<code class="fe mn mo mp mq b">AVG</code>函数计算平均工时的结果，并存储在一个名为<strong class="lt iu"> AvgWorkHours </strong>的新列中。</li><li id="1dd1" class="oa ob it lt b lu oj lx ok ma ol me om mi on mm of og oh oi bi translated"><code class="fe mn mo mp mq b">GROUP BY Country</code>:上一条语句结束时，所有同名国家的结果都是<strong class="lt iu"> AvgWorkHours </strong>。然后，GROUP BY用于创建每个国家的唯一实例及其相应的AvgWorkHours。</li><li id="6ec4" class="oa ob it lt b lu oj lx ok ma ol me om mi on mm of og oh oi bi translated"><code class="fe mn mo mp mq b">ORDER BY AvgWorkHours ASC</code>:最后一条语句用于使用<code class="fe mn mo mp mq b">ASC</code>(升序)函数对AvgWorkHours进行升序排序。</li></ul><p id="ec61" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">如果你是一个更图形化的人，你可以使用纯R脚本显示前面的结果。从R切换到SQL！是不是很神奇:)</p><pre class="kj kk kl km gt ne mq nf ng aw nh bi"><span id="ea48" class="mr la it mq b gy ni nj l nk nl"># Create a plot</span><span id="fdd3" class="mr la it mq b gy nm nj l nk nl"># Create room for the plot<br/>graphics.off()</span><span id="ad7d" class="mr la it mq b gy nm nj l nk nl"># Sets or adjusts plotting parameters<br/>par("mar")<br/>par(mar = c(12, 4, 2, 2) + 0.2)</span><span id="c077" class="mr la it mq b gy nm nj l nk nl"># Show the final plot<br/>barplot(height = wwh_per_country_data$AvgWorkHours, <br/>        names.arg = wwh_per_country_data$Country,<br/>        main ="Average Working Hours Per Country",<br/>        ylab = "Average Weekly Hours",<br/>        las = 2)</span></pre><ul class=""><li id="30bd" class="oa ob it lt b lu no lx np ma oc me od mi oe mm of og oh oi bi translated"><code class="fe mn mo mp mq b">par()</code> <strong class="lt iu"> <em class="nd"> </em> </strong>函数用于调整绘图参数，<code class="fe mn mo mp mq b">mar</code>为长度为4的向量，分别设置下、左、上、右的边距大小。</li><li id="4fd8" class="oa ob it lt b lu oj lx ok ma ol me om mi on mm of og oh oi bi translated"><code class="fe mn mo mp mq b">las=2</code>用于以垂直方式显示国家名称，以便更直观。值为1将水平显示它们。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/a72bf6c1d4e1611841339b42c25e351e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J36vUSaSmtZvZu5vkpW3gw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">平均每周工作时间(图片由作者提供)</p></figure><blockquote class="op oq or"><p id="a704" class="lr ls nd lt b lu no ju lw lx np jx lz os nq mc md ot nr mg mh ou ns mk ml mm im bi translated">这只是sqldf所能做的？只是列选择和分组依据？</p></blockquote><p id="8f5d" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">当然不是！可以执行更多的SQL查询。让我们用连接的使用来结束这篇文章。</p><h2 id="9456" class="mr la it bd lb ms mt dn lf mu mv dp lj ma mw mx ll me my mz ln mi na nb lp nc bi translated">JOINS语句</h2><p id="60d1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">它们用于根据链接这些表的列，组合来自至少两个数据集(即表)的行。为了成功演示这个场景，我们需要创建一个额外的数据集。</p><p id="c2af" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated"><strong class="lt iu">数据集创建</strong></p><p id="44d5" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">让我们从创建两个不同的数据集开始。</p><ul class=""><li id="296f" class="oa ob it lt b lu no lx np ma oc me od mi oe mm of og oh oi bi translated">第一个被称为<code class="fe mn mo mp mq b"><strong class="lt iu">personal_info_data</strong></code>，它将包含一个人的所有个人信息。</li><li id="b82e" class="oa ob it lt b lu oj lx ok ma ol me om mi on mm of og oh oi bi translated">第二个名为<code class="fe mn mo mp mq b"><strong class="lt iu">backg_info_data</strong></code>,包含所有的学术、薪水等信息。</li></ul><pre class="kj kk kl km gt ne mq nf ng aw nh bi"><span id="5651" class="mr la it mq b gy ni nj l nk nl"># Prepare the query <br/>query_pers_info = "SELECT ID, Age, MartialStatus, Relationship, Race, Sex, Country FROM income_data"</span><span id="480e" class="mr la it mq b gy nm nj l nk nl"># Store the result in the personal_info_data variable<br/><strong class="mq iu">personal_info_data</strong> = sqldf(query_pers_info)</span><span id="85fe" class="mr la it mq b gy nm nj l nk nl"># Show the first 5 rows of the result<br/>head(<strong class="mq iu">personal_info_data</strong>, 5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/2d3b47b0d2a93904a6a3dc11648cf667.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*z4oJCeJ6dgKGbauj8dpDKw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">个人信息数据的结果:前5行(作者图片)</p></figure><p id="1d9e" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">创建第二个使用与前一个相似的方法。</p><pre class="kj kk kl km gt ne mq nf ng aw nh bi"><span id="cd32" class="mr la it mq b gy ni nj l nk nl"># Prepare the query<br/>query_backg_info = "SELECT ID,Workclass, Education, Occupation, CapitalGain, CapitalLoss, HoursPerWeek, Income FROM income_data"</span><span id="6791" class="mr la it mq b gy nm nj l nk nl"># Store the result in the backg_info_data variable <br/><strong class="mq iu">backg_info_data</strong> = sqldf(query_backg_info)</span><span id="35ee" class="mr la it mq b gy nm nj l nk nl"># Show the first 5 rows of the result<br/>head(<strong class="mq iu">backg_info_data</strong>, 5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/9c734018a82d563c275982fc3f5b0706.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*Wx04vLoRQZHR8HwQnsb_uA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">背景信息数据的结果:前5行(作者图片)</p></figure><p id="d400" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">注意<code class="fe mn mo mp mq b"><strong class="lt iu">personal_info_data</strong></code>中的<strong class="lt iu"> ID </strong>是指<code class="fe mn mo mp mq b"><strong class="lt iu">backg_info_data</strong></code> <strong class="lt iu">中的<strong class="lt iu"> ID </strong>。</strong>因此，我们两个数据集之间的关系是<strong class="lt iu"> ID </strong>列。<code class="fe mn mo mp mq b">sqldf</code>可以执行所有<a class="ae ky" href="https://en.wikipedia.org/wiki/Join_(SQL)" rel="noopener ugc nofollow" target="_blank">不同类型的连接</a>，但是我们的重点将放在<strong class="lt iu">内部连接</strong>上，它返回两个表中具有匹配值的所有记录。</p><p id="e4bf" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">以下语句提取成年人的年龄、婚姻状况、国家、教育和收入。</p><pre class="kj kk kl km gt ne mq nf ng aw nh bi"><span id="9e2e" class="mr la it mq b gy ni nj l nk nl"># Prepare the query<br/>join_query = "SELECT p_info.ID, \<br/>                  p_info.Age, \<br/>                  p_info.MartialStatus, \<br/>                  p_info.Country, \<br/>                  bg_info.Education,\<br/>                  bg_info.Income \<br/>              FROM personal_info_data p_info \ <br/>              INNER JOIN backg_info_data bg_info \<br/>              ON p_info.ID = bg_info.ID"</span><span id="a743" class="mr la it mq b gy nm nj l nk nl"># Run the qery<br/>join_data = sqldf(join_query)</span><span id="c3f5" class="mr la it mq b gy nm nj l nk nl"># Show the first 5 observations<br/>head(join_data, 5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/4b77a5af3883ec50e1b0aad89f7753b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*RGXDfSW4aHkTU_eebZnfCQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">连接查询的前5个观察结果(图片由作者提供)</p></figure><p id="cd43" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">为了清楚和可读性，该查询被分解，并创建了额外的变量。</p><ul class=""><li id="d1b1" class="oa ob it lt b lu no lx np ma oc me od mi oe mm of og oh oi bi translated"><code class="fe mn mo mp mq b">sp_info</code>:写personal_info_data就太长了。教育，个人信息数据。MaritalStatus等。我们创建一个别名/实例来代替原来的名字。别名大部分时间都比原来的短。</li><li id="c8fc" class="oa ob it lt b lu oj lx ok ma ol me om mi on mm of og oh oi bi translated"><code class="fe mn mo mp mq b">bg_info:</code>与上一个类似的是backg_info_data的别名。</li></ul><h1 id="c5e3" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="991a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">没有一个R用户掉队！🎉 🍾您刚刚学习了如何使用<code class="fe mn mo mp mq b">sqldf</code>与R数据框进行交互。如果您仍然在执行复杂的任务，而使用SQL可能会更容易，那么现在是时候尝试一下<code class="fe mn mo mp mq b">sqldf</code>了，它可能会帮助您和您的同事节省时间并提高效率！</p><p id="559d" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">此外，如果你喜欢阅读我的故事，并希望支持我的写作，考虑<a class="ae ky" href="https://zoumanakeita.medium.com/membership" rel="noopener">成为一个媒体成员</a>解锁无限制访问媒体上的故事。这样做，我会得到一点佣金。</p><p id="37b1" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">欢迎在<a class="ae ky" href="https://zoumanakeita.medium.com/" rel="noopener">媒体</a>、<a class="ae ky" href="https://twitter.com/zoumana_keita_" rel="noopener ugc nofollow" target="_blank">推特</a>、<a class="ae ky" href="https://www.youtube.com/channel/UC9xKdy8cz6ZuJU5FTNtM_pQ" rel="noopener ugc nofollow" target="_blank"> YouTube </a>上关注我，或者在<a class="ae ky" href="https://www.linkedin.com/in/zoumana-keita/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上问好。讨论人工智能、人工智能、数据科学、自然语言处理和人工智能是一种乐趣！</p><h1 id="8c71" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">额外资源</h1><p id="a4f4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><a class="ae ky" href="https://cran.r-project.org/web/packages/sqldf/README.html#:~:text=Links-,Overview,and%20a%20few%20additional%20functions" rel="noopener ugc nofollow" target="_blank">R网站上的SQL文档</a></p><p id="39fa" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated"><a class="ae ky" href="https://archive.ics.uci.edu/ml/datasets/Adult" rel="noopener ugc nofollow" target="_blank"> UCI机器学习</a></p><p id="0ae2" class="pw-post-body-paragraph lr ls it lt b lu no ju lw lx np jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated"><a class="ae ky" href="https://github.com/keitazoumana/Medium-Articles-Notebooks/blob/main/sqldf_tutorial.R" rel="noopener ugc nofollow" target="_blank"> R文章的源代码</a></p></div></div>    
</body>
</html>