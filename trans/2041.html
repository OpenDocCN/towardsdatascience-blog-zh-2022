<html>
<head>
<title>How to Set Up a Custom Domain for Different GCP Applications Using a Load Balancer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用负载平衡器为不同的GCP应用程序设置自定义域</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-set-up-a-custom-domain-for-different-gcp-applications-using-a-load-balancer-bbcad40fed#2022-05-09">https://towardsdatascience.com/how-to-set-up-a-custom-domain-for-different-gcp-applications-using-a-load-balancer-bbcad40fed#2022-05-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9bb6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用简单的例子揭开神秘的负载平衡器的神秘面纱</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6c5cf52b4128e3ebf4b38f9c6a150461.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GszvxspbSanUfOrI.jpg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由Pixabay上的<a class="ae ky" href="https://pixabay.com/illustrations/internet-social-media-network-blog-4463031/" rel="noopener ugc nofollow" target="_blank"> geralt </a>提供</p></figure><p id="9a2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，我们只能通过虚拟机(VM)的IPs或带有Google签名的长URL访问我们在Google云平台(GCP)上的应用程序，如Cloud Run、Cloud Function、App Engine以及云存储对象。如果我们想通过自定义域访问它们，我们需要使用负载平衡器。</p><p id="f6bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谷歌云平台上的<a class="ae ky" href="https://cloud.google.com/load-balancing" rel="noopener ugc nofollow" target="_blank">云负载平衡器</a>实际上是一个相当复杂的概念，当你阅读<a class="ae ky" href="https://cloud.google.com/load-balancing/docs/load-balancing-overview" rel="noopener ugc nofollow" target="_blank">官方文档</a>时，你很容易迷失。简单地说，负载平衡器让您可以从世界各地使用一个IP地址访问您的应用程序。从技术上来说，它涉及到根据流量扩大和缩小后端服务。</p><p id="2e80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本帖中，我们将介绍最实际的案例，并使用负载平衡器为我们的后端应用程序添加自定义域。我们将介绍如何使用自定义域来访问虚拟机、云运行服务和云存储桶。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="f196" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">准备</h2><p id="914f" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在创建云负载平衡器之前，我们首先需要获得一个自定义域，保留一个静态IP，添加DNS记录，并创建一个SSL证书。此外，我们还需要创建一个VM实例、一个云运行服务和一个存储桶。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="07cd" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">获取自定义域</h2><p id="326b" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">您可以从任何域名注册机构获得自定义域名。比较流行的域名注册商，请查看<a class="ae ky" href="https://www.forbes.com/advisor/business/software/best-domain-registrar/" rel="noopener ugc nofollow" target="_blank">这篇文章</a>。我的域名(<a class="ae ky" href="https://www.superdataminer.com/" rel="noopener ugc nofollow" target="_blank">superdataminer.com</a>)的注册人是DOMAIN.COM。从技术上讲，你选择哪个域名注册商并不重要。重要的是价格，通常包括起步价和续约费。如果您需要一些特殊服务，也可能会有一些额外的费用。一个参考文献中的排名可能会有偏差。但是，如果不同的推荐人总是将同一个注册商排在前面，那么情况就不会很糟糕。需要注意的是，有些注册卡的起步价可能很低，甚至免费，但如果你想续费的话，起步价可能会很贵。因此，一定要检查不同的参考排名和比较，选择一个最适合你的项目。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="89fd" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">保留静态IP</h2><p id="7f01" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">为了使用Google Cloud Load Balancer为我们的应用程序添加自定义域，我们需要为它保留一个静态IP。在GCP控制台上搜索“IP”并选择“IP地址”。然后点击“保留外部静态地址”以保留静态地址。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/0e1845e2549fd836d0aa830c74be987f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*lrkNbNHIG9vK7cWgBcTEqw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/4ea57e989beb3df8f8b129bbb5ad1b5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GnvJ2Ko77r5tE1HpRa0wTw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="8c29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">给它一个名称，并将类型设置为“Global ”,因为该IP旨在被全局访问。所有其他选项都可以保留为默认值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/50aaf56fe2f4cec25bdccf08d50e9d99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zCj8JOPh_QGe50QmHv5mdw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="2865" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们点击“保留”时，将为我们保留一个静态IP。请记住这个静态IP，因为它将用于为您的域添加DNS记录。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/29cf4fd61aa22bb1c1bf82dbaef930a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2hYI2vEz6FPlkoDMW8wuJQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="0203" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">为静态IP添加DNS记录</h2><p id="10bb" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们需要为静态IP添加一些DNS记录，这样我们的域就可以指向这个IP。登录您的域注册商并添加以下DNS记录:</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="2536" class="mc md it nf b gy nj nk l nl nm">NAME                  TYPE     DATA<br/>@                     A        &lt;Your-Ststic-IP&gt;<br/>www                   CNAME    superdataminer.com<br/>api                   CNAME    superdataminer.com</span></pre><p id="587f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nn no np nf b">@</code>名是指根域名，在本帖中是<a class="ae ky" href="https://www.superdataminer.com/" rel="noopener ugc nofollow" target="_blank">superdataminer.com</a>,<code class="fe nn no np nf b">www</code>是对应<a class="ae ky" href="https://www.superdataminer.com/" rel="noopener ugc nofollow" target="_blank">www.superdataminer.com</a>的子域，同样适用于<code class="fe nn no np nf b">api</code>子域。此外，<code class="fe nn no np nf b">A</code>代表“地址”,指定目标域的IP地址，而<code class="fe nn no np nf b">CNAME</code>代表“圆锥形名称”,实际上是指向所创建的<code class="fe nn no np nf b">A</code>记录的别名。</p><p id="e5e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于DOMAIN.COM，您可以在购买的域名上点击“管理”,然后在左侧导航栏上找到“DNS &amp;名称服务器”选项卡。最后，单击“DNS记录”选项卡，然后单击“添加DNS记录”来添加新的DNS记录:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/a7738307b04bfcb2082602c867f2f4fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gYW8SnCjprwRfwApV8dsuw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7207" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">按照上面的指示为每个DNS记录填写表格。特别是，IP地址是上面创建的静态IP。此外，我们需要为记录设置一个TTL，它告诉DNS解析器将缓存该记录多长时间。对于这个例子，TTL设置为什么值并不重要。通常，较小的TTL意味着DNS记录更改可以更快地传播。如果你想了解更多关于DNS TTL的知识，网上有很多参考资料。比如<a class="ae ky" href="https://social.dnsmadeeasy.com/blog/long-short-ttls/" rel="noopener ugc nofollow" target="_blank">这个</a>就是个好的。最后，优先级字段可以留空。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/9597f82b140ff0a8023b5810d36ae0ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Ew_-kKj8M9d884WRNBJuQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/aabda5250746cac89c699e277e7c7795.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*MiecXK5N3ta6c695qGowOA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b290" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加的DNS记录将如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/28b6b0b9a46bfcdff319008e9c87da16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PkeOz1mwthEBxgHy_VER0Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b6a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在已经添加了所有DNS记录，我们需要等待一些时间来传播更改，这可能需要几个小时甚至几天。然而，通常我们只需要等待几个小时甚至十几分钟就可以让它们繁殖。如果你的需要更长的时间，不要担心，只要多一点耐心，他们最终会工作。</p><p id="5a3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加完DNS记录后，您可以使用<code class="fe nn no np nf b">ping</code>或<code class="fe nn no np nf b">dig</code>命令来检查它们是否被正确添加以及它们是否被传播:</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="401c" class="mc md it nf b gy nj nk l nl nm">$ <strong class="nf iu">ping superdataminer.com</strong><br/>$ <strong class="nf iu">ping </strong><a class="ae ky" href="http://www.superdataminer.com" rel="noopener ugc nofollow" target="_blank"><strong class="nf iu">www.superdataminer.com</strong></a><br/>$ <strong class="nf iu">ping api.superdataminer.com</strong><br/>64 bytes from 230.190.111.34.bc.googleusercontent.com (<strong class="nf iu">&lt;Your-static-IP&gt;</strong>)</span><span id="f259" class="mc md it nf b gy nu nk l nl nm">$ <strong class="nf iu">dig superdataminer.com</strong><br/>;; ANSWER SECTION:<br/>superdataminer.com. 3469 IN A <strong class="nf iu">&lt;Your-static-IP&gt;</strong></span><span id="0c14" class="mc md it nf b gy nu nk l nl nm">$ <strong class="nf iu">dig </strong><a class="ae ky" href="http://www.superdataminer.com" rel="noopener ugc nofollow" target="_blank"><strong class="nf iu">www.superdataminer.com</strong></a><br/>;; ANSWER SECTION:<br/><a class="ae ky" href="http://www.superdataminer.com" rel="noopener ugc nofollow" target="_blank">www.superdataminer.com</a>. 3529 IN CNAME superdataminer.com.<br/>superdataminer.com. 3453 IN A <strong class="nf iu">&lt;Your-static-IP&gt;</strong></span><span id="452a" class="mc md it nf b gy nu nk l nl nm">$ <strong class="nf iu">dig api.superdataminer.com</strong><br/>;; ANSWER SECTION:<br/>api.superdataminer.com. 3522 IN CNAME superdataminer.com.<br/>superdataminer.com. 3406 IN A <strong class="nf iu">&lt;Your-static-IP&gt;</strong></span></pre><p id="8f4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果IP地址是上面保留的静态IP，那么这意味着DNS记录已经被正确设置并且已经被传播。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="cd9a" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">创建虚拟机</h2><p id="a900" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">现在，让我们在GCP上创建一个虚拟机，并在其中运行一个Flask应用程序。请在计算引擎页面上创建一个虚拟机实例，该实例也可以在搜索框中进行搜索。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/0716c18954540b943395d1566265fa4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*DTaPMj9quuF0tvwocfo2Qg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/63e9086ee60b0bcd6bfc90e16e630b1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4vgHgctUyXnFijIh-jPjAQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b32d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于测试目的，我们将选择最低配置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/f69a054ae7a94680ec2a5c083c7f656b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*svem8cHn6PnJWqHJUi_3Ag.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6d82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想为生产创建一个虚拟机实例，那么您应该选择适合您的应用程序的配置。</p><p id="fc12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，重要的是，由于我们将从GCP之外访问虚拟机，我们需要允许HTTP和HTTPS流量:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/d882d33672bb9a2af9cabc8011b7ef69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*s_7HEhjQd7isKoQ68K_ozg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="53e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击“CREATE”后，将调配并创建虚拟机实例。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/c3b135d519d0ed2427ab42b00b95e1e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oAwFnAlSrzR_oaWLOUUIUQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0f9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们可以通过自定义端口(5000)访问VM实例之前，我们需要为它创建一个特定的防火墙规则。在GCP控制台上搜索“防火墙”，然后选择“防火墙VPC网络”。单击“创建规则”创建新的防火墙规则。首先，我们需要给它一个唯一的名字:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/5ffdc369de00a8868609174835f7d3dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*tdRlD7aVWLT9Tcp_lEWBcg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="befb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们需要指定目标、IP范围和端口:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/493628613e27217c213c6becbb6847d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*Pdv4y0Q9-Sy51IKOxMqJaw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="8ac3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以使用默认端口，即80用于HTTP，443用于HTTPS。然而，这里我们演示了如何为我们的应用程序指定一个自定义端口，这在默认端口不适用的许多情况下是很有帮助的。</p><p id="4b97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们需要为新的防火墙规则添加标签(上面指定的<code class="fe nn no np nf b">flask</code>标签)到我们的VM实例中。在虚拟机实例上单击“编辑”,并为其添加一个网络标记:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/14b76c0adabb1e14397d3c9ef0868417.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*mMsd1jnQFCBdpl65YMxZ2w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="5ed2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击“保存”保存更改。现在，让我们通过单击实例右侧的SSH链接登录到虚拟机实例，如上所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/686e4c15024b6348c4b3dffb5baa57a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zouZhhD8r7ueKOJr52i7FQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b94b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于<code class="fe nn no np nf b">git</code>不可用，我们先安装一下:</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="24c5" class="mc md it nf b gy nj nk l nl nm">$ sudo apt update<br/>$ sudo apt install git</span></pre><p id="b766" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在低CPU/内存配置的虚拟机中安装软件/库可能会非常慢，所以在安装<code class="fe nn no np nf b">git</code>和<code class="fe nn no np nf b">pip/venv</code>(如下)时要有点耐心。</p><p id="a3ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后为Flask克隆这个示例项目并安装<code class="fe nn no np nf b">requirements.txt</code>中指定的库。</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="db77" class="mc md it nf b gy nj nk l nl nm">$ git clone <a class="ae ky" href="https://github.com/lynnkwong/flask-cloud-run-app.git" rel="noopener ugc nofollow" target="_blank">https://github.com/lynnkwong/flask-cloud-run-app.git</a><br/>$ cd flask-cloud-run-app</span><span id="e33d" class="mc md it nf b gy nu nk l nl nm">$ sudo apt install python3-pip<br/>$ sudo apt install python3-venv</span><span id="3477" class="mc md it nf b gy nu nk l nl nm">$ python3 -m venv .venv<br/>$ source .venv/bin/activate</span><span id="ef82" class="mc md it nf b gy nu nk l nl nm">(.venv) $ pip install -r requirements.txt</span></pre><p id="779b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，虚拟环境是用Python的<code class="fe nn no np nf b">venv</code>库创建的。这些库安装在虚拟环境中，而不是直接安装在系统中，建议在生产中使用。</p><p id="c20d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，让我们启动应用程序。请注意，我们需要为它设置一个环境变量，这样我们就可以知道响应来自VM实例，而不是来自云运行，我们将很快展示这一点。</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="a513" class="mc md it nf b gy nj nk l nl nm">(.venv) $ export APP_NAME="App in VM instance"<br/>(.venv) $ gunicorn -w 4 -b 0.0.0.0:5000 app:app &amp;</span></pre><p id="8d3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用<code class="fe nn no np nf b"><a class="ae ky" href="https://flask.palletsprojects.com/en/2.1.x/deploying/wsgi-standalone/#gunicorn" rel="noopener ugc nofollow" target="_blank">gunicorn</a></code>在VM实例中启动Flask应用程序。注意命令末尾的&amp;符号(&amp;)，即使我们退出控制台，它也能保持应用程序运行。</p><p id="66fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当您尝试使用Flask应用程序的外部IP从任何地方访问它时，您可以得到一个响应:</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="e402" class="mc md it nf b gy nj nk l nl nm">$ curl &lt;Your-VM-external-IP&gt;:5000<br/>&lt;h1&gt;Hello from App in VM instance!&lt;h1&gt;</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="3c59" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">创建实例组</h2><p id="ef86" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们需要为VM实例创建一个“实例组”,这样它就可以用于在负载平衡中创建后端服务。在GCP控制台中搜索“实例组”，选择“实例组”，然后单击“创建实例组”。我们需要选择“新的非托管实例组”来实现负载平衡。然后，在我们设置网络和实例之前，指定一个名称、区域和区域。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/8b70ea15029e5e4f132ca14e2026b58c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QgO4PR2DDxUK0SnhzKtLjw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="c8c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于“网络和实例”部分，选择默认网络和子网，然后选择要包含在此实例组中的虚拟机。我们可以在一个实例组中选择多个虚拟机，负载平衡器会平衡流量。对于本教程，我们只有一个虚拟机实例。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/e99504a995fa3fa1ca936f627a714827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rVrBSf3SWbYzrXPlw-5jhQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="57bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重要的是，对于“端口映射”部分，我们需要创建一个映射，因为我们在VM中运行的Flask应用程序使用端口5000。因此，我们需要为它创建一个映射:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/db289ab37aa9d091ab6870c4bee2d0f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y6EiVG80fUcDOZMcxhuNpw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="e880" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们为实例组创建后端服务时，将使用这个端口映射。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="75e7" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">创建云运行服务</h2><p id="2c97" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在GCP控制台中找到“云运行”选项卡，然后单击“创建服务”来创建服务。您可以从现有的容器映像或源存储库中部署服务的一个修订版。我们将选择后者，因为我们不需要事先创建自定义图像。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/a42046e7798b75325dc49755c54af952.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*S7Q84Zxn_pxnd-456dvS7w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="12bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想跟进，请在单击“使用云构建设置”后，分叉<a class="ae ky" href="https://github.com/lynnkwong/flask-cloud-run-app" rel="noopener ugc nofollow" target="_blank">此回购</a>并设置您的云构建以链接到此回购:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/161a24d98b95bf2ae853a0c8ab7e6043.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*7eNyJBcCyX2kfAEZg6lDgw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/6bbaf1f61a623d7d212a17381683ea0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*m2u2_Is7muUbBEUgnW4Vpg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="97c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您在这个repo中设置了您的存储库，那么您不需要做任何更改。默认设置可以工作。单击“保存”后，将为源代码创建一个云构建触发器。将来，每当您将一些新代码推送到repo时，都会构建一个新的映像，并部署一个新的服务(技术上来说是服务的新版本)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/c209605c52379b9111b65bc35f6aaf33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*ENPYT1gtdZW-21PtjFA5KA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="dca9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，出于测试目的，我们将为我们的服务“允许所有流量”和“允许未经身份验证的调用”。如果您的应用程序有高安全性要求，您可能希望选择不同的方法。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/969e177a48bc81d9c3617ea44701217e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*J8kjeP3J9zJqanFz47QVSg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a2fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，因为我们的Flask应用程序需要一个环境变量，所以让我们为它创建一个环境变量。展开“容器、变量和机密、连接、安全性”部分，并单击“变量和机密”选项卡。添加一个名为“APP_NAME”的新环境变量:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/a73a38703d2829abe09721ac3434b982.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*kCU66tM01ztNkqKrKCXiCg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b2ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，一切都准备好了，您可以保留其他选项的默认值。点击“点击”创建服务。过一会儿，您的服务将可用，您可以通过云自动运行分配的URL访问您的Flask应用程序:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/5a8922c67ae6ab4fa2fd1f241237ceeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JyHg8ziirWgvYC-ZpgwM7g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/3163dd9d989ebcd2bd8b92ad43b64523.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*iVPKlqnDFL4SexGrvA7LFg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="c61e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您的部署出现任何问题，请查看“LOGS”选项卡中的日志。通常你会在那里找到原因。</p><p id="9245" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要了解更多关于如何为Flask应用程序创建云运行服务的信息，请查看<a class="ae ky" href="https://betterprogramming.pub/how-to-deploy-a-web-application-to-cloud-run-automatically-6967d7c7d42a" rel="noopener ugc nofollow" target="_blank">这篇文章</a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="46a4" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">创建一个桶并上传一些图像</h2><p id="c17a" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">首先，去谷歌云存储，创建一个存储你的图片的桶。通常情况下，您只需指定存储段名称并选择一个区域，其他选项都可以保留为默认值:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/954df2546ed77d811bd80a3093648c77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*aK96ZHrSZKnKx_wmFEs5fA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="2373" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您可以创建文件夹并将文件上传到bucket，就像使用Google Drive一样。本文中使用的图片是从<a class="ae ky" href="https://pixabay.com/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>下载的免费图片。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/dbac6bb32a923d2a344773d5695ee436.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*wbGWyotYlkvS6Dx40lZHfQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/aa632be78776f131f155e1341e0d2aa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*Qf5QckIDh-eAv1N0LBvfUw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="5263" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，只有经过身份验证的用户才能访问桶中的图像，外部用户无法访问。如果我们想将图像公开，让任何地方的任何人都可以访问，我们需要更改bucket的权限。若要添加权限主体，请单击“权限”，然后单击“添加”。要公开一个存储桶，我们需要为“所有用户”添加一个“存储对象查看者”角色。谷歌会警告你这一行动，但如果你知道你在做什么，你可以安全地确认它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/1502b04970c10a3914278c6fa8f7c237.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*ntzutol0sNCPvOYq7yfc9g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="1c8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，任何人在任何地方都可以访问这些图像:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/2a9d57c2789fc1ba6234a4324ad6d217.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6DHp0QJhsM7-GmJsp5oftg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="9dc6" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">创建SSL证书资源</h2><p id="99ea" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">因为我们正在创建一个HTTPS负载平衡器，所以我们需要为它创建一个SSL证书资源。出于生产目的，建议使用<a class="ae ky" href="https://cloud.google.com/load-balancing/docs/ssl-certificates/google-managed-certs" rel="noopener ugc nofollow" target="_blank">谷歌管理的证书</a>，这也比自签名证书更容易设置。</p><p id="d29e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Google管理的证书的入口点有点隐藏。如果你在谷歌云控制台的搜索框中搜索“SSL证书”，找到的是自签名证书，而不是我们要找的谷歌管理的证书。要找到正确的，你需要首先进入负载平衡页面，点击“高级菜单”找到它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/db5ca08acfd45f109b2e585145a163d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WcrX9GcD2KSZAp3PtHPY9g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="c4b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在“高级菜单”打开的“负载平衡组件”页面中，单击“证书”选项卡，然后单击“创建SLL证书”按钮，创建一个新的Google管理的证书:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/cc509173b683b4698a3344ee38f6cbf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d_zWMvQTI-DEoszu_w1ldQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="9743" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">按如下方式填写表格:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/c8cfdd05eb6474bf2cd854ce6006b2e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/1*M7SiLS4Q3_9LTYNUHTxaNw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6b96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重要的是:</p><ul class=""><li id="e626" class="ow ox it lb b lc ld lf lg li oy lm oz lq pa lu pb pc pd pe bi translated">给它一个描述性的名称，因为稍后创建负载平衡器时会用到它。</li><li id="ca04" class="ow ox it lb b lc pf lf pg li ph lm pi lq pj lu pb pc pd pe bi translated">在“创建模式”中，选择“创建谷歌管理的证书”。</li><li id="5109" class="ow ox it lb b lc pf lf pg li ph lm pi lq pj lu pb pc pd pe bi translated">在“域名”部分，输入您从域名注册商处购买的域名。我们应该添加根域(<a class="ae ky" href="https://www.superdataminer.com/" rel="noopener ugc nofollow" target="_blank">superdataminer.com</a>)和所有子域(本例中只有api.superdataminer.com)。<br/> <strong class="lb iu">注意</strong>:所有的域必须指向同一个IP地址，也就是负载均衡器的IP，否则无法置备证书！</li></ul><p id="38a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后单击“创建”创建证书:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pk"><img src="../Images/ff68c3b22f34cb15c757e1e6daffc479.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YyxRY0UP7heNuIiCZyi3bw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="c60b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SSL证书的状态在变为“活动”之前会保持一段时间，稍后我们创建负载平衡器时会更详细地演示这一点。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="b985" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">创建一个谷歌云负载平衡器</h2><p id="429d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">最后，一切都准备好了，我们可以开始创建一个Google Cloud负载平衡器来为我们的应用程序设置一个自定义域。在GCP控制台的搜索框中搜索“负载”，然后选择“负载平衡”。在打开的窗口中，点击“创建负载平衡器”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/2e6574376be2580b8c81c052139fe2a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kb5KgxKFd75SgSGqvBuXRg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6388" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后单击“HTTP(S)负载平衡”上的“开始配置”，这就是我们要创建的配置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/806a0d00ae46f2dc253c834066415f7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*sLNFY7CpD7GMxOws280RIw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="697a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">保留默认选项如下，这是我们想要的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/0589fdab916dc24e4100a4757cea59fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*rDuozhBjPa8teeDFmNxpVw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="387c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击“继续”后，我们需要为负载平衡器指定一个名称，然后设置后端、主机和路径规则以及前端的配置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/365018c609a6a4115a61ee9878abd2be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*vlKvbpDXsQmxxrKN_963Pg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="10e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先点击“后端配置”。因为我们还没有任何后端服务，所以我们需要先创建它们。我们将分别为一个实例组、一个无服务器云运行服务和一个云存储桶创建一个后端服务。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="9f21" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">为实例组创建后端服务</h2><p id="47ad" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在“后端配置”部分，单击“后端服务和后端存储桶”，并选择“创建后端服务”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi po"><img src="../Images/8ce539365c5fe31ebf8053b022ce15d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*3fJvpaMLQy58qzetuxuhvQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="787a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在“创建后端服务”窗口中，指定后端服务的名称，并选择“实例组”作为后端类型。然后将协议更改为“HTTP ”,并将命名端口设置为“flask ”,这是我们在上面为实例组创建的端口。协议可以是HTTP，不必是HTTPS，因为流量是从负载均衡器转发到GCP系统内部的实例组的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/95651ffe3618622a19b8c22bce3ef043.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*BmraKy7PPczxk8rsj_CIbw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="ac7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后在“后端”部分，选择我们创建的实例组。将自动检测并选择端口号:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/add84e25754a7e930707ea7d6096ae90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*QWPZC8gCJ4WRE_0ghAtAUQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7ceb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重要的是，我们需要为实例组创建一个健康检查策略，否则实例组的后端服务将无法正常工作:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pr"><img src="../Images/fa1dff98dbdfe4e95db0dfa72dbdad78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*LQaU5wJDmawZcQqBWZjUJQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="fdb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在“健康检查”的新窗口中，指定名称、协议和端口。其他选项可以保留为缺省值，除非您想根据自己的特定需求对性能进行微调。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/48263f39104b71ab316d4c0d097d65aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*Jjfg2fhyzHjMQOh6-UFvog.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="d5a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，协议可以是“TCP ”,因为运行状况检查是由内部IPs在GCP系统内部完成的。</p><p id="15b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建运行状况检查策略后，我们可以单击“CREATE”为实例组创建后端服务。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/82c6a1f9b864c01599a23cd309d6cc17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wVlkJa8rySQYDMXymQNIvQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="befa" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">为云运行创建后端服务</h2><p id="1cf7" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">为云运行创建后端服务的过程实际上与为实例组创建后端服务的过程非常不同，尽管两者属于同一类型。要为云运行创建后端服务，我们也需要从“后端配置”开始:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pt"><img src="../Images/235d7ac4b31a20d3157cf6f91335261d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*iJnPtlOSyuXhEOdWydCMKg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7091" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在打开的“创建后端服务”窗口中，指定后端服务的名称，并选择“无服务器网络端点组”作为后端类型。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pr"><img src="../Images/bcd7fd7174fae5b96a8488063d2f7279.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*lBn4P4rX7wJg5tAJbt2cpA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="74a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们需要为我们的云运行服务创建一个无服务器网络端点组(NEG ):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pu"><img src="../Images/bec3a6f56530cfd76136edf819012383.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*F0FbcY4VkqEwrLIifbVeMw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="beb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击“创建无服务器网络端点组”为我们的无服务器云运行服务创建后端:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pv"><img src="../Images/4c63ac0ddac4806f65ff0bbcf6f571fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*ZfYuEJjfOsvQh67fdazbpg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="fa26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有时，GCP用户界面可能会有一个错误，当您尝试创建网络端点组时，您无法选择云运行服务。这是在创建本教程时发生的。在这种情况下，您可以使用<code class="fe nn no np nf b">gcloud</code>命令创建一个:</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="e908" class="mc md it nf b gy nj nk l nl nm"><strong class="nf iu">gcloud compute network-endpoint-groups create</strong> &lt;neg-name&gt; \<br/>  <strong class="nf iu">--region</strong>=&lt;region&gt; \<br/> <strong class="nf iu"> --network-endpoint-type=serverless</strong> \<br/> <strong class="nf iu"> --cloud-run-service</strong>=&lt;serviceName&gt;</span></pre><p id="cd65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于本教程，该命令将是:</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="3149" class="mc md it nf b gy nj nk l nl nm"><strong class="nf iu">gcloud compute network-endpoint-groups create</strong> neg-superdataminer \<br/>  <strong class="nf iu">--region</strong>=europe-west1 \<br/>  <strong class="nf iu">--network-endpoint-type=serverless</strong> \<br/>  <strong class="nf iu">--cloud-run-service</strong>=superdataminer-cloud-run</span></pre><p id="c222" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当该命令成功完成时，您会看到:</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="52cd" class="mc md it nf b gy nj nk l nl nm">Created network endpoint group [neg-superdataminer].</span></pre><p id="c5e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您遇到这种权限错误:</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="bff0" class="mc md it nf b gy nj nk l nl nm">ERROR: (gcloud.compute.network-endpoint-groups.create) Could not fetch resource:<br/> - Required 'compute.regionNetworkEndpointGroups.create' permission for</span></pre><p id="463c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以运行以下命令来验证您的Google Cloud SDK:</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="8649" class="mc md it nf b gy nj nk l nl nm">$ <strong class="nf iu">gcloud auth login</strong><br/>$ <strong class="nf iu">gcloud config set project</strong> &lt;Your-Project-ID&gt;<br/>$ <strong class="nf iu">gcloud auth application-default login</strong></span></pre><p id="14d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当从UI或通过<code class="fe nn no np nf b">gcloud</code>命令创建无服务器网络端点组时，您可以选择并使用它来创建您的后端服务:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pw"><img src="../Images/4087ac9d1f2a570aeaf43297b43bd50b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*b0M52BwWLsjcOEkx4rnv8w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="81a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，单击“创建”为我们的云运行服务创建后端服务。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi px"><img src="../Images/61be04eba83e26116c2db1543788eacd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FfjR9bAasIRic2LEvcQKrA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="dfee" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">为云存储创建后端服务</h2><p id="2762" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">最后，让我们继续为您的云存储桶创建一个后端桶:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi py"><img src="../Images/2c96ace7cd6ede958241a0d7afba75c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xk9ouzFEL0jn2MQiWYhx1Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="e659" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在打开的“创建后端存储桶”窗口中，输入后端存储桶的名称，并选择您想要访问的云存储桶。此外，建议启用云CDN来更快地交付内容并节省成本，尤其是静态内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pz"><img src="../Images/42529bb9d8e3675b6c77c2b7256fdb86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*-Y5Z3TZhEyfOZWEHmUj2Jw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4da7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个过程简单得多，通常你不会遇到任何问题。现在，我们的负载平衡器的所有后端配置都已完成:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qa"><img src="../Images/70be8c0fde73267c360586a263e0ee03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*21XdOy9gMzbTb49_LbhX5w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="123c" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">指定主机和路径规则</h2><p id="93ee" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">配置后端后，我们需要指定主机和路径规则，这些规则决定了您的流量将如何定向。流量可以被定向到后端服务或存储桶，正如我们上面配置的那样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qb"><img src="../Images/1a14b3b5dc830b99c0a667c888fe0c92.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*6UV4Nb8bjKbS8EoUc6g8Kg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="2ee0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">指定了三个主机和路径规则:</p><ul class=""><li id="b1db" class="ow ox it lb b lc ld lf lg li oy lm oz lq pa lu pb pc pd pe bi translated">第一个是默认的，其主机和路径不能更改。所有不匹配的主机和路径都会被发送到分配给这个规则的后端，也就是我们的云运行服务。</li><li id="2434" class="ow ox it lb b lc pf lf pg li ph lm pi lq pj lu pb pc pd pe bi translated">第二个是图像的规则。它指定图像将被定向到“superdataminer.com/images/*”。这个规则的后端是上面创建的Bucket后端。</li><li id="c3bb" class="ow ox it lb b lc pf lf pg li ph lm pi lq pj lu pb pc pd pe bi translated">第三个是API子域，其后端是实例组。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="3965" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">前端配置</h2><p id="3af9" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">最后，我们来设置前端配置。点击左侧的“前端配置”,设置配置如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qb"><img src="../Images/e1ace3b2c3fb1921243b3c9dfbdea1d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*ZVzUxSQV7gHhROoL7Rykgw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="62fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重要的是，我们需要:</p><ul class=""><li id="08fe" class="ow ox it lb b lc ld lf lg li oy lm oz lq pa lu pb pc pd pe bi translated">指定前端的名称。</li><li id="a809" class="ow ox it lb b lc pf lf pg li ph lm pi lq pj lu pb pc pd pe bi translated">将协议更改为“HTPPS(包括HTTP/2)”。</li><li id="1b2d" class="ow ox it lb b lc pf lf pg li ph lm pi lq pj lu pb pc pd pe bi translated">将IP设置为之前保留的静态IP。</li><li id="01ab" class="ow ox it lb b lc pf lf pg li ph lm pi lq pj lu pb pc pd pe bi translated">选择之前创建的SSL证书。</li></ul><p id="3d19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，“启用HTTP到HTTPS重定向”选项可能无法正常工作。在这种情况下，如果需要，您需要创建一个单独的HTTP前端。</p><p id="298e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在一切准备就绪。我们可以检查并最终确定配置，然后单击“<strong class="lb iu">创建</strong>🔥“创建负载平衡器，如果一切正常，就创建它。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="9f19" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">检查您的SSL证书的状态</h2><p id="e01d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如前所述，您的SSL证书的状态将保持在“<a class="ae ky" href="https://cloud.google.com/load-balancing/docs/ssl-certificates/troubleshooting#domain-status" rel="noopener ugc nofollow" target="_blank">供应</a>甚至“<a class="ae ky" href="https://cloud.google.com/load-balancing/docs/ssl-certificates/troubleshooting#domain-status" rel="noopener ugc nofollow" target="_blank">失败_不可见</a>，直到满足以下两个条件:</p><ul class=""><li id="74c4" class="ow ox it lb b lc ld lf lg li oy lm oz lq pa lu pb pc pd pe bi translated">如上所示，DNS记录已经正确添加，并且已经为您的静态IP进行了传播。</li><li id="a7e4" class="ow ox it lb b lc pf lf pg li ph lm pi lq pj lu pb pc pd pe bi translated">SSL证书已经附加到负载平衡器的前端，如上所示。</li></ul><p id="9e66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果满足以上两个条件，状态将更改为“活动”，这意味着一切正常:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qc"><img src="../Images/591bb597a1042380ae65987aa9ed91b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*RvyhcNNmlcpqB-KB-vQdRw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="5a67" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">测试负载平衡器</h2><h2 id="5f27" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">测试实例组</h2><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="00f9" class="mc md it nf b gy nj nk l nl nm">$ curl <a class="ae ky" href="https://api.superdataminer.com" rel="noopener ugc nofollow" target="_blank">https://api.superdataminer.com</a><br/>&lt;h1&gt;Hello from App in VM instance!&lt;h1&gt;</span></pre><h2 id="2a4d" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">测试云运行</h2><p id="9944" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">当你访问<a class="ae ky" href="https://www.superdataminer.com/" rel="noopener ugc nofollow" target="_blank">https://superdataminer.com</a>时，你会看到来自云润的问候:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qd"><img src="../Images/ae9ae419a61bb541df5011142becf06b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*XAl1TOREAjHbNs6f9LJvZA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="5c9d" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">测试云存储桶</h2><p id="755a" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">当你访问<a class="ae ky" href="https://superdataminer.com/images/cloud-compute.jpg" rel="noopener ugc nofollow" target="_blank">https://superdataminer.com/images/cloud-compute.jpg</a>时，你可以看到谷歌云存储桶中的图片:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qe"><img src="../Images/a651379416ec8c540aec42959429d2db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kr6KPyH5P1a8qesfvzy0xA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供(原始图片由Pixabay上的<a class="ae ky" href="https://pixabay.com/illustrations/cloud-computer-hosting-3406627/" rel="noopener ugc nofollow" target="_blank"> kreatikar </a>提供)</p></figure><p id="3f05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">干杯！所有GCP应用程序的自定义域都像预期的那样工作。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="6826" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇长文中，我们详细讨论了如何创建一个负载平衡器，并为您的后端服务和云存储桶分配一个自定义域。现在，您应该对什么是负载平衡器以及如何使用它为您在GCP的应用程序提供服务有了更好的理解。</p><p id="0409" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">乍看之下，负载平衡可能会让人不知所措。然而，如果你仔细遵循这些步骤，并试图理解每一个步骤背后的逻辑，它实际上并不复杂。如果您在为本文中演示的示例设置负载平衡器时遇到任何问题，欢迎您给我留言或私信，我会尽力帮助您。</p><p id="9c87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外，请注意域名<a class="ae ky" href="https://www.superdataminer.com/" rel="noopener ugc nofollow" target="_blank">superdataminer.com</a>在这篇文章中只是用于演示，当你阅读这篇文章时，它可能会被用于其他用途。因此，如果你想继续下去，你需要有自己的域名。</p></div></div>    
</body>
</html>