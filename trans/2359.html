<html>
<head>
<title>How To Create User-Defined Iterables in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中创建用户定义的可重复项</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/make-class-iterable-python-4d9ec5db9b7a#2022-05-24">https://towardsdatascience.com/make-class-iterable-python-4d9ec5db9b7a#2022-05-24</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="20f2" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">在Python中创建迭代器和可迭代的用户定义类</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/d75823e57f14b4d42578978cea93c6c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4BW-pnYmTAGqmmnSlj7bZg.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><a class="ae kz" href="https://unsplash.com/@hngstrm?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">亨利&amp;公司</a>在<a class="ae kz" href="https://unsplash.com/s/photos/loop?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h2 id="4bb5" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">介绍</h2><p id="ba55" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">在我以前的一篇文章中，我讨论了Iterable和Iterator对象，以及它们是如何参与Python迭代协议的。</p><div class="mp mq gq gs mr ms"><a rel="noopener follow" target="_blank" href="/python-iterables-vs-iterators-688907fd755f"><div class="mt ab fp"><div class="mu ab mv cl cj mw"><h2 class="bd iv gz z fq mx fs ft my fv fx it bi translated">Python中的Iterables vs迭代器</h2><div class="mz l"><h3 class="bd b gz z fq mx fs ft my fv fx dk translated">理解Python中Iterables和迭代器的区别</h3></div><div class="na l"><p class="bd b dl z fq mx fs ft my fv fx dk translated">towardsdatascience.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng kt ms"/></div></div></a></div><p id="f27c" class="pw-post-body-paragraph lw lx iu ly b lz nh jv mb mc ni jy me lj nj mg mh ln nk mj mk lr nl mm mn mo in bi translated">在今天的文章中，我们将探索如何创建用户定义的迭代器，这些迭代器可以在用户定义的类中使用，以使它们成为可迭代的。换句话说，我们将展示如何创建一个用户定义的类，并实现所有需要的方法，以满足迭代协议中描述的Python Iterables的特征。</p></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><h2 id="0935" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">Python中的迭代器和可迭代对象</h2><p id="1929" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">迭代器和可迭代对象是Python迭代协议的两个主要结构。简而言之，Python中的Iterable是一个对象，您可以在其上迭代其元素，而Iterator是一个对象，它返回Iterable对象并用于在迭代过程中产生值。</p><p id="0e1e" class="pw-post-body-paragraph lw lx iu ly b lz nh jv mb mc ni jy me lj nj mg mh ln nk mj mk lr nl mm mn mo in bi translated">换句话说，</p><ul class=""><li id="2847" class="nt nu iu ly b lz nh mc ni lj nv ln nw lr nx mo ny nz oa ob bi translated">Iterable对象实现<code class="fe oc od oe of b">__iter__()</code>方法并返回一个Iterator对象</li><li id="c46b" class="nt nu iu ly b lz og mc oh lj oi ln oj lr ok mo ny nz oa ob bi translated">Iterator对象实现了<code class="fe oc od oe of b">__next__()</code>方法，并在iterable对象的元素用尽时引发一个<code class="fe oc od oe of b">StopIteration</code>。此外，迭代器对象本身是一个Iterable，因为它也必须实现<code class="fe oc od oe of b">__iter__()</code>方法并简单地返回自身。</li></ul><p id="c548" class="pw-post-body-paragraph lw lx iu ly b lz nh jv mb mc ni jy me lj nj mg mh ln nk mj mk lr nl mm mn mo in bi translated">有关Python中迭代协议、迭代器和可迭代对象的更多细节，请务必阅读引言中所附的文章，在该文章中我们将更详细地讨论这些概念。</p></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><h2 id="141d" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建用户定义的迭代器和可迭代对象</h2><p id="c4a3" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">现在让我们假设我们想要创建一些对象来说明一所大学是如何运作的。显然，我将要使用的例子会过于简化，因为这里的最终目标是展示如何实现和使用可迭代对象和迭代器。</p><pre class="kk kl km kn gu ol of om on aw oo bi"><span id="2d89" class="la lb iu of b gz op oq l or os">class Student:</span><span id="f7a2" class="la lb iu of b gz ot oq l or os">    def __init__(self, first_name, last_name):<br/>        self.first_name = first_name<br/>        self.last_name = last_name </span><span id="54ea" class="la lb iu of b gz ot oq l or os">    def __str__(self):<br/>        return f'Student Name: {self.first_name} {self.last_name}'</span><span id="7012" class="la lb iu of b gz ot oq l or os">class Lecturer:</span><span id="7386" class="la lb iu of b gz ot oq l or os">    def __init__(self, first_name, last_name, subject):<br/>        self.first_name = first_name<br/>        self.last_name = last_name<br/>        self.subject = subject</span><span id="4eee" class="la lb iu of b gz ot oq l or os">    def __str__(self):<br/>        return f'{self.subject} Lecturer: '<br/>               f'{self.first_name} {self.last_name}'</span><span id="3ea5" class="la lb iu of b gz ot oq l or os">class UniversityClass:<br/>    <br/>    def __init__(self, lecturers=[], students=[]):<br/>        self.lecturers = lecturers<br/>        self.students = students</span><span id="f9d1" class="la lb iu of b gz ot oq l or os">    def add_student(student):<br/>        raise NotImplementedError</span><span id="1d19" class="la lb iu of b gz ot oq l or os">    def remove_student(student):<br/>        raise NotImplementedError</span><span id="3c32" class="la lb iu of b gz ot oq l or os">    def add_lecturer(lecturer):<br/>        raise NotImplementedError</span><span id="ac2f" class="la lb iu of b gz ot oq l or os">    def remove_lecturer(lecturer):<br/>        raise NotImplementedError</span></pre><p id="41c3" class="pw-post-body-paragraph lw lx iu ly b lz nh jv mb mc ni jy me lj nj mg mh ln nk mj mk lr nl mm mn mo in bi translated">现在让我们也创建一些<code class="fe oc od oe of b">Student</code>和<code class="fe oc od oe of b">Lecturer</code>对象的实例，然后我们将使用它们来创建一个<code class="fe oc od oe of b">UniversityClass</code>对象的实例:</p><pre class="kk kl km kn gu ol of om on aw oo bi"><span id="4244" class="la lb iu of b gz op oq l or os">s1 = Student('Andrew', 'Brown')<br/>s2 = Student('Helen', 'White')<br/>s3 = Student('George', 'Johnson')</span><span id="dd3b" class="la lb iu of b gz ot oq l or os">l1 = Lecturer('Maria', 'Richardson', 'Algorithms')<br/>l2 = Lecturer('Bob', 'Johanson', 'Programming')</span><span id="a551" class="la lb iu of b gz ot oq l or os">uni_cl = UniversityClass(lecturers=[l1 ,l2], students=[s1, s2, s3])</span></pre><p id="d159" class="pw-post-body-paragraph lw lx iu ly b lz nh jv mb mc ni jy me lj nj mg mh ln nk mj mk lr nl mm mn mo in bi translated">现在让我们假设我们想要迭代一个<code class="fe oc od oe of b">UniversityClass</code>对象的实例，以便访问每个成员，包括某个班级的讲师和学生。</p><pre class="kk kl km kn gu ol of om on aw oo bi"><span id="abb8" class="la lb iu of b gz op oq l or os">for member in uni_cl:<br/>    print(member)</span></pre><p id="c5f7" class="pw-post-body-paragraph lw lx iu ly b lz nh jv mb mc ni jy me lj nj mg mh ln nk mj mk lr nl mm mn mo in bi translated">上面的命令将失败，并显示一个错误，提示我们<code class="fe oc od oe of b">UniversityClass</code>不是一个可迭代的对象。</p><pre class="kk kl km kn gu ol of om on aw oo bi"><span id="fc10" class="la lb iu of b gz op oq l or os">Traceback (most recent call last):<br/>  File "iterable_example.py", line 45, in &lt;module&gt;<br/>    for member in uni_cl:<br/>TypeError: 'UniversityClass' object is not iterable</span></pre><p id="239a" class="pw-post-body-paragraph lw lx iu ly b lz nh jv mb mc ni jy me lj nj mg mh ln nk mj mk lr nl mm mn mo in bi translated">为了能够迭代用户定义的<code class="fe oc od oe of b">UniversityClass</code>类，我们需要创建一个迭代器，我们将在使<code class="fe oc od oe of b">UniversityClass</code>成为可迭代对象时使用它。</p><p id="a620" class="pw-post-body-paragraph lw lx iu ly b lz nh jv mb mc ni jy me lj nj mg mh ln nk mj mk lr nl mm mn mo in bi translated">如前所述，迭代器必须实现<code class="fe oc od oe of b">__next__()</code>方法，当Iterable对象的元素用尽时抛出一个<code class="fe oc od oe of b">StopIteration</code>，还必须实现返回自身实例的<code class="fe oc od oe of b">__iter__()</code>方法。</p><p id="66a3" class="pw-post-body-paragraph lw lx iu ly b lz nh jv mb mc ni jy me lj nj mg mh ln nk mj mk lr nl mm mn mo in bi translated">首先，让我们创建一个迭代器对象，我们将在其中实现<code class="fe oc od oe of b">__next__()</code>方法中的逻辑。注意，这里期望的行为是首先返回讲师，一旦这些大学类成员的集合用尽，我们将开始返回学生。</p><pre class="kk kl km kn gu ol of om on aw oo bi"><span id="1d0a" class="la lb iu of b gz op oq l or os">class UniversityClassIter:</span><span id="640e" class="la lb iu of b gz ot oq l or os">    def __init__(self, university_class):<br/>        self._lect = university_class.lecturers<br/>        self._stud = university_class.students<br/>        self._class_size = len(self._lect) + len(self._stud)<br/>        self._current_index = 0</span><span id="b6ab" class="la lb iu of b gz ot oq l or os">    def __iter__(self):<br/>        return self</span><span id="8982" class="la lb iu of b gz ot oq l or os">    def __next__(self):<br/>        if self._current_index &lt; self._class_size:<br/>            if self._current_index &lt; len(self._lect):<br/>                member = self._lect[self._current_index] <br/>            else:<br/>                member = self._stud[<br/>                    self._current_index - len(self._lect)]</span><span id="95a8" class="la lb iu of b gz ot oq l or os">            self._current_index += 1<br/>            return member</span><span id="f0eb" class="la lb iu of b gz ot oq l or os">        raise StopIteration</span></pre><p id="1eac" class="pw-post-body-paragraph lw lx iu ly b lz nh jv mb mc ni jy me lj nj mg mh ln nk mj mk lr nl mm mn mo in bi translated">既然我们已经创建了适当的迭代器类，现在我们可以继续修改<code class="fe oc od oe of b">UniversityClass</code>对象，使其实现<code class="fe oc od oe of b">__iter__()</code>方法。</p><pre class="kk kl km kn gu ol of om on aw oo bi"><span id="aad2" class="la lb iu of b gz op oq l or os">class UniversityClass:<br/>    <br/>    def __init__(self, lecturers=[], students=[]):<br/>        self.lecturers = lecturers<br/>        self.students = students</span><span id="68cd" class="la lb iu of b gz ot oq l or os">    def add_student(student):<br/>        raise NotImplementedError<br/>    <br/>    def remove_student(student):<br/>        raise NotImplementedError<br/>    <br/>    def add_lecturer(lecturer):<br/>        raise NotImplementedError<br/>    <br/>    def remove_lecturer(lecturer):<br/>        raise NotImplementedError</span><span id="5861" class="la lb iu of b gz ot oq l or os">    def __iter__(self):<br/>        return UniversityClassIter(self)</span></pre><p id="7abf" class="pw-post-body-paragraph lw lx iu ly b lz nh jv mb mc ni jy me lj nj mg mh ln nk mj mk lr nl mm mn mo in bi translated">瞧啊。我们现在已经创建了一个用户定义Iterable。让我们测试一下——这一次，如果我们试图迭代一个<code class="fe oc od oe of b">UniversityClass</code>对象的实例，我们应该能够检索所创建的类的讲师和学生:</p><pre class="kk kl km kn gu ol of om on aw oo bi"><span id="7f43" class="la lb iu of b gz op oq l or os">s1 = Student('Andrew', 'Brown')<br/>s2 = Student('Helen', 'White')<br/>s3 = Student('George', 'Johnson')</span><span id="12a9" class="la lb iu of b gz ot oq l or os">l1 = Lecturer('Maria', 'Richardson', 'Algorithms')<br/>l2 = Lecturer('Bob', 'Johanson', 'Programming')</span><span id="c6b3" class="la lb iu of b gz ot oq l or os">uni_cl = UniversityClass(lecturers=[l1 ,l2], students=[s1, s2, s3])</span><span id="3ec7" class="la lb iu of b gz ot oq l or os">for member in uni_cl:<br/>   print(member)</span></pre><p id="26d2" class="pw-post-body-paragraph lw lx iu ly b lz nh jv mb mc ni jy me lj nj mg mh ln nk mj mk lr nl mm mn mo in bi translated">现在输出将是:</p><pre class="kk kl km kn gu ol of om on aw oo bi"><span id="0b73" class="la lb iu of b gz op oq l or os">Algorithms Lecturer: Maria Richardson<br/>Programming Lecturer: Bob Johanson<br/>Student Name: Andrew Brown<br/>Student Name: Helen White<br/>Student Name: George Johnson</span></pre></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><h2 id="297e" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">完整代码</h2><p id="17ed" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">今天教程的完整代码也作为GitHub要点分享如下——在Python中创建自己的用户定义类和iterables时，可以随意使用它作为参考！</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ou ov l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Python中用户定义的可重复项的示例类—来源:作者</p></figure></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><h2 id="6b3b" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">最后的想法</h2><p id="32e5" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">在今天的教程中，我们讨论了Python中的可迭代对象和迭代器，以及它们是如何参与迭代协议的。此外，我们展示了如何通过实现所有必需的方法来创建用户定义的Iterable。</p></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><p id="0f39" class="pw-post-body-paragraph lw lx iu ly b lz nh jv mb mc ni jy me lj nj mg mh ln nk mj mk lr nl mm mn mo in bi translated"><a class="ae kz" href="https://gmyrianthous.medium.com/membership" rel="noopener"> <strong class="ly iv">成为会员</strong> </a> <strong class="ly iv">阅读介质上的每一个故事。你的会员费直接支持我和你看的其他作家。你也可以在媒体上看到所有的故事。</strong></p><div class="mp mq gq gs mr ms"><a href="https://gmyrianthous.medium.com/membership" rel="noopener follow" target="_blank"><div class="mt ab fp"><div class="mu ab mv cl cj mw"><h2 class="bd iv gz z fq mx fs ft my fv fx it bi translated">通过我的推荐链接加入Medium-Giorgos Myrianthous</h2><div class="mz l"><h3 class="bd b gz z fq mx fs ft my fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="na l"><p class="bd b dl z fq mx fs ft my fv fx dk translated">gmyrianthous.medium.com</p></div></div><div class="nb l"><div class="ow l nd ne nf nb ng kt ms"/></div></div></a></div></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><p id="676e" class="pw-post-body-paragraph lw lx iu ly b lz nh jv mb mc ni jy me lj nj mg mh ln nk mj mk lr nl mm mn mo in bi translated"><strong class="ly iv">你可能也会喜欢</strong></p><div class="mp mq gq gs mr ms"><a rel="noopener follow" target="_blank" href="/python-iterables-vs-iterators-688907fd755f"><div class="mt ab fp"><div class="mu ab mv cl cj mw"><h2 class="bd iv gz z fq mx fs ft my fv fx it bi translated">Python中的Iterables vs迭代器</h2><div class="mz l"><h3 class="bd b gz z fq mx fs ft my fv fx dk translated">理解Python中Iterables和迭代器的区别</h3></div><div class="na l"><p class="bd b dl z fq mx fs ft my fv fx dk translated">towardsdatascience.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng kt ms"/></div></div></a></div></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu ms"><a rel="noopener follow" target="_blank" href="/requirements-vs-setuptools-python-ae3ee66e28af"><div class="mt ab fp"><div class="mu ab mv cl cj mw"><h2 class="bd iv gz z fq mx fs ft my fv fx it bi translated">Python中的requirements.txt与setup.py</h2><div class="mz l"><h3 class="bd b gz z fq mx fs ft my fv fx dk translated">了解Python中requirements.txt、setup.py和setup.cfg在开发和分发时的用途…</h3></div><div class="na l"><p class="bd b dl z fq mx fs ft my fv fx dk translated">towardsdatascience.com</p></div></div><div class="nb l"><div class="ox l nd ne nf nb ng kt ms"/></div></div></a></div></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu ms"><a rel="noopener follow" target="_blank" href="/how-to-merge-pandas-dataframes-221e49c41bec"><div class="mt ab fp"><div class="mu ab mv cl cj mw"><h2 class="bd iv gz z fq mx fs ft my fv fx it bi translated">如何合并熊猫数据帧</h2><div class="mz l"><h3 class="bd b gz z fq mx fs ft my fv fx dk translated">对熊猫数据帧执行左、右、内和反连接</h3></div><div class="na l"><p class="bd b dl z fq mx fs ft my fv fx dk translated">towardsdatascience.com</p></div></div><div class="nb l"><div class="oy l nd ne nf nb ng kt ms"/></div></div></a></div></div></div>    
</body>
</html>