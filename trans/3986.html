<html>
<head>
<title>Crack SQL Interview Question with Useful Procedure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用实用程序破解SQL面试问题</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/practical-sql-questions-for-data-science-interview-3b5c9d726baa#2022-09-05">https://towardsdatascience.com/practical-sql-questions-for-data-science-interview-3b5c9d726baa#2022-09-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7f3b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">逐步解决SQL面试问题</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d94de64b4ae67aa5d70b8044959700a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0GSCAdgxf-2Bx0n_"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Andrea Davis 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="71c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将回顾Airbnb数据科学访谈中的一个SQL问题。我希望本文中解释的过程能够帮助您更有效地编写SQL查询。</p><p id="8c17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL问题:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ec7c" class="ma mb it lw b gy mc md l me mf"><strong class="lw iu">Host Popularity Rental Prices</strong></span><span id="2d2f" class="ma mb it lw b gy mg md l me mf">You’re given a table of rental property searches by users. The table consists of search results and outputs host information for searchers. Find the minimum, average, maximum rental prices for each host’s popularity rating. The host’s popularity rating is defined as below: <br/>0 reviews: New <br/>1 to 5 reviews: Rising <br/>6 to 15 reviews: Trending Up <br/>16 to 40 reviews: Popular <br/>more than 40 reviews: Hot</span><span id="74f1" class="ma mb it lw b gy mg md l me mf">Source: <a class="ae ky" href="https://platform.stratascratch.com/coding/9632-host-popularity-rental-prices?code_type=1" rel="noopener ugc nofollow" target="_blank">stratascratch.com</a></span></pre><p id="ecb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">表格:airbnb _主机_搜索</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/49798d614dcd41ca8cdcb44ce79c3c9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KbPjqYFdE010v2BJhMWT9A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="937a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">第一步</strong>:在我们开始编写查询之前，我们需要检查原始数据并提出问题，以便更好地理解相关信息。这不是大学考试，我们可以向面试官或数据制作者提出任何合理的问题和假设。比如，</p><ul class=""><li id="d8f9" class="mi mj it lb b lc ld lf lg li mk lm ml lq mm lu mn mo mp mq bi translated">数据集是否包含重复的属性？我们如何唯一地识别一个属性？我们可以使用字段“ID”来唯一地标识一个属性吗？在本练习中，ID表示搜索ID，它与属性ID无关，因此，在本练习中我们可以忽略该字段。是的，数据集中有重复的属性，因为用户可能会从不同的搜索中查看相同的属性，并且所有搜索输出(包括重复的)都将记录在原始数据中。我们需要向面试官提出重复的问题，因为包括重复会产生一个扭曲的结果。所以我们需要想办法自己去鉴定一个房产(下一步会多讲)。</li><li id="82bb" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated">这个问题似乎表明，主持人的受欢迎程度是根据评论的数量来定义的。原始数据是否包括给定物业的历史和最近评论数？如果是这样，我们需要澄清如何确定最近的审查数量。例如，“搜索日期”是否可用？但是对于这个练习，数据集只包含一个属性最近的评论数量，因此，我们不需要担心找到最近的评论数量。</li></ul><p id="d832" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">步骤2 </strong>:并非原始数据中的所有字段都会被使用。我们需要确定<strong class="lb iu">相关变量</strong>和任何<strong class="lb iu">额外的</strong>变量，我们需要自己创建这些变量来解决问题。在这个练习中，我们需要以下变量。</p><ul class=""><li id="5290" class="mi mj it lb b lc ld lf lg li mk lm ml lq mm lu mn mo mp mq bi translated">属性ID:我们需要找到唯一标识属性的方法。一种连接几个特征变量的常见方法，如价格、房间类型、host_since、邮政编码和评论数量。通过组合不同的字段，我们应该能够唯一地标识一个属性。</li><li id="83e0" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated">主持人的受欢迎程度评级:根据评论的数量，酒店评级分为“新”、“上升”、“上升趋势”、“受欢迎”和“热门”。</li><li id="d443" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated">价格:这个变量在原始数据中很容易得到。基于原始价格信息，我们可以计算给定流行度评级类别的最小值、平均值和最大值。</li></ul><p id="c2dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第三步:我们需要准备数据，为分析做好准备。在这一步中，我们将专注于保存和构建我们在第2步中确定的变量。</p><p id="cefb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用<code class="fe mw mx my lw b">CONCAT(price, room_type, host_since, zipcode, number_of_reviews)</code>来创建属性ID。</p><p id="f860" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">主持人的受欢迎程度评级需要做一些工作，因为它将根据评论的数量被分配不同的值(即，“新”、“上升”、“趋势上升”、“受欢迎”和“热门”)。<code class="fe mw mx my lw b">CAEE-WHEN-END</code>函数是处理多个条件语句的完美函数。</p><p id="dfd2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">原始数据中存在重复数据，我们需要通过删除重复观测值来准备数据，否则，在计算平均值、最小值和最大值时，我们会得到不准确的结果。增加<code class="fe mw mx my lw b">DISTINCT</code>可以解决这个问题。</p><p id="ab00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以运行下面的查询来准备数据。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="7430" class="ma mb it lw b gy mc md l me mf">SELECT <strong class="lw iu">DISTINCT </strong>CONCAT(price, room_type, host_since, zipcode, number_of_reviews) AS <strong class="lw iu">id</strong>, <strong class="lw iu">price</strong>,</span><span id="1e3d" class="ma mb it lw b gy mg md l me mf">CASE</span><span id="e807" class="ma mb it lw b gy mg md l me mf">WHEN number_of_reviews = 0 THEN 'New'</span><span id="6b1b" class="ma mb it lw b gy mg md l me mf">WHEN number_of_reviews &gt;=1  AND number_of_reviews &lt;=5  THEN 'Rising'</span><span id="03c0" class="ma mb it lw b gy mg md l me mf">WHEN number_of_reviews &gt;=6  AND number_of_reviews &lt;=15 THEN 'Trending Up'</span><span id="7e56" class="ma mb it lw b gy mg md l me mf">WHEN number_of_reviews &gt;=16 AND number_of_reviews &lt;=40 THEN 'Popular'</span><span id="133a" class="ma mb it lw b gy mg md l me mf">WHEN number_of_reviews &gt;40 THEN 'Hot'</span><span id="c993" class="ma mb it lw b gy mg md l me mf">END AS <strong class="lw iu">popularity_rating</strong></span><span id="a803" class="ma mb it lw b gy mg md l me mf">FROM airbnb_host_searches</span></pre><p id="5355" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们期望得到的初步数据集类似于下表。我们有一个物业ID，它代表一个独特的物业及其租赁价格和受欢迎程度。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/63e77ccd1e6260fc9d62ef6cac4068ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*O4lPH9NLC3-__s98KYLapQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4c61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">第四步</strong>:找到编写查询的最有效方法。子查询和公用表表达式(CTE)都是处理复杂SQL查询的有用工具。我发现CTE比子查询更有效，更有优势。</p><p id="45e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据设计，CTE是可重复使用的。不必在需要使用子查询的每个地方都声明相同的子查询，可以使用CTE定义一次临时表，然后在需要时引用它。</p><p id="7ffd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CTE比子查询更具可读性。因为CTE可以重用，所以使用CTE比使用子查询可以编写更少的代码。此外，人们倾向于按照顺序而不是嵌套的方式更容易地遵循逻辑和思想。编写查询时，使用CTE可以更容易地将复杂的查询分解成较小的部分。</p><p id="4655" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于本练习，我们可以使用<code class="fe mw mx my lw b">WITH</code>语句准备步骤3中的数据，并将其存储在一个名为cte的临时表中。然后，我们将使用SQL聚合函数、<code class="fe mw mx my lw b">MIN()</code>、<code class="fe mw mx my lw b">AVG()</code>、<code class="fe mw mx my lw b">MAX()</code>来计算带有<code class="fe mw mx my lw b">GROUP BY</code>的每个人气评级类别的最低、平均和最高租赁价格。</p><p id="35d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终的解决方案如下所示:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="bbcc" class="ma mb it lw b gy mc md l me mf">WITH cte AS(</span><span id="b1da" class="ma mb it lw b gy mg md l me mf">SELECT DISTINCT CONCAT(price, room_type, host_since, zipcode, number_of_reviews) AS id, price,</span><span id="9a00" class="ma mb it lw b gy mg md l me mf">CASE</span><span id="3af9" class="ma mb it lw b gy mg md l me mf">WHEN number_of_reviews = 0 THEN 'New'</span><span id="a408" class="ma mb it lw b gy mg md l me mf">WHEN number_of_reviews &gt;=1  AND number_of_reviews &lt;=5  THEN 'Rising'</span><span id="a318" class="ma mb it lw b gy mg md l me mf">WHEN number_of_reviews &gt;=6  AND number_of_reviews &lt;=15 THEN 'Trending Up'</span><span id="5813" class="ma mb it lw b gy mg md l me mf">WHEN number_of_reviews &gt;=16 AND number_of_reviews &lt;=40 THEN 'Popular'</span><span id="2c3d" class="ma mb it lw b gy mg md l me mf">WHEN number_of_reviews &gt;40 THEN 'Hot'</span><span id="12ab" class="ma mb it lw b gy mg md l me mf">END AS popularity_rating</span><span id="2457" class="ma mb it lw b gy mg md l me mf">FROM airbnb_host_searches</span><span id="ed7f" class="ma mb it lw b gy mg md l me mf">)</span><span id="2e0d" class="ma mb it lw b gy mg md l me mf">SELECT popularity_rating,</span><span id="9c94" class="ma mb it lw b gy mg md l me mf">MIN(price) price_min,</span><span id="a7e7" class="ma mb it lw b gy mg md l me mf">AVG(price) price_avg,</span><span id="7857" class="ma mb it lw b gy mg md l me mf">MAX(price) price_max</span><span id="675a" class="ma mb it lw b gy mg md l me mf">FROM cte</span><span id="1ede" class="ma mb it lw b gy mg md l me mf">GROUP BY popularity_rating</span></pre><p id="f232" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该查询将产生答案:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/f67c32ff86fd154c2e9bbc237325055a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G2wEcGsrY1CCy-SoeFPeKw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0fa5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">解决SQL问题类似于侦探工作。你被测试把分散的拼图拼在一起，还需要逻辑合理地解释步骤。这里的关键是让面试官或你的同事参与到这个过程中来，这样他们就能理解你的观点和你做出的任何假设。</p><p id="e286" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想探索更多的<strong class="lb iu"> SQL面试问题</strong>，请查看我的文章:</p><ul class=""><li id="116f" class="mi mj it lb b lc ld lf lg li mk lm ml lq mm lu mn mo mp mq bi translated"><a class="ae ky" href="https://medium.com/geekculture/comprehensive-sql-cheat-sheet-f821c5abf85a" rel="noopener"> <strong class="lb iu">综合SQL小抄</strong> </a></li><li id="11b4" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/practical-sql-questions-for-data-science-interview-3b5c9d726baa"> <strong class="lb iu">破解SQL面试问题的有用程序</strong> </a></li><li id="c8f4" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/sql-for-data-analysis-subquery-vs-cte-699ef629d9eb"> <strong class="lb iu">破解SQL面试问题:子查询vs CTE</strong></a></li><li id="1786" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/crack-sql-interview-question-join-vs-case-when-statement-116d40a361f0"> <strong class="lb iu">破解SQL面试问题:Join vs Case-When语句</strong> </a></li><li id="a2a5" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/crack-sql-interview-question-window-functions-with-partition-by-599d792c07c3"> <strong class="lb iu">破解SQL面试题:带分区的窗口函数——By</strong></a></li><li id="730c" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/crack-sql-interview-question-date-part-function-aff0b15478d9"> <strong class="lb iu">破解SQL面试问题:Date_Part函数</strong> </a></li><li id="d622" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated"><a class="ae ky" href="https://medium.com/geekculture/crack-sql-interview-questions-row-number-rank-and-dense-rank-ef439749f3ff" rel="noopener"> <strong class="lb iu">破解SQL面试题:ROW_NUMBER、RANK和DENSE_RANK </strong> </a></li><li id="a546" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated"><a class="ae ky" href="https://python.plainenglish.io/crack-sql-interview-question-unnest-string-to-array-1b75578cbe75" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">破解SQL面试问题:UNNEST，STRING_TO_ARRAY </strong> </a></li><li id="144d" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated"><a class="ae ky" href="https://medium.com/geekculture/crack-sql-interview-question-generate-series-string-agg-split-part-fbc0e5e42d7d" rel="noopener"> <strong class="lb iu">破解SQL面试问题:GENERATE_SERIES，STRING_AGG，SPLIT_PART </strong> </a></li><li id="5087" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated"><a class="ae ky" href="https://medium.com/geekculture/crack-sql-interview-question-self-join-and-non-equi-join-1cb2a181104a" rel="noopener"> <strong class="lb iu">破解SQL面试问题:自连接和非等同连接</strong> </a></li><li id="2e57" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated"><a class="ae ky" href="https://medium.com/geekculture/crack-sql-interview-question-any-operator-d39e07e0e224" rel="noopener"> <strong class="lb iu">破解SQL面试问题:任意运算符</strong> </a></li><li id="0a28" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated"><a class="ae ky" href="https://medium.com/geekculture/crack-sql-interview-question-subquery-d9db4763eef4" rel="noopener"> <strong class="lb iu">破解SQL面试问题:子查询</strong> </a></li></ul><h1 id="452c" class="nb mb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">感谢您的阅读！！！</h1><p id="65ad" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">如果你喜欢这篇文章，并且想<strong class="lb iu">请我喝杯咖啡，</strong>请<a class="ae ky" href="https://ko-fi.com/aaronzhu" rel="noopener ugc nofollow" target="_blank">点击这里</a>。</p><p id="8965" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以注册一个<a class="ae ky" href="https://aaron-zhu.medium.com/membership" rel="noopener"> <strong class="lb iu">会员</strong> </a>来解锁我的文章的全部访问权限，并且可以无限制地访问介质上的所有内容。如果你想在我发表新文章时收到电子邮件通知，请订阅。</p></div></div>    
</body>
</html>