<html>
<head>
<title>3 Methods for Aggregating Data with Python Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python Pandas 聚合数据的 3 种方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-methods-for-aggregating-data-with-python-pandas-14ceb75b6f6e#2022-03-25">https://towardsdatascience.com/3-methods-for-aggregating-data-with-python-pandas-14ceb75b6f6e#2022-03-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dd8b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">熊猫提供最适合你的需求</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ed726614bcfefa21c123852dbf11eb4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e0eTdvLDdoSpTh6V_N_3jQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/s/photos/big-small?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae ky" href="https://unsplash.com/@alpduran?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Alp Duran </a>拍摄的照片</p></figure><p id="f2ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas 是 Python 的一个数据分析和操作库，也是最受欢迎的库之一。我认为它最大的优点是易用性和简洁的语法。</p><p id="c640" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas 在如何执行常见操作方面非常灵活，因此它几乎总能提供完全符合您需求的解决方案。</p><p id="69de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将回顾用 Pandas 聚合数据的不同方法。你将看到熊猫如何提供各种方法来完成一项特定的任务。</p><blockquote class="lv lw lx"><p id="eef4" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">注:本文原载于 datasciencehowto.com<a class="ae ky" href="https://datasciencehowto.com/2022/10/29/3-methods-for-aggregating-data-with-python-pandas/" rel="noopener ugc nofollow" target="_blank">。</a></p></blockquote><p id="9d13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从创建一个填充了模拟数据的样本数据帧开始。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="446c" class="mh mi it md b gy mj mk l ml mm">import pandas as pd<br/>import numpy as np<br/>from random import shuffle</span><span id="5826" class="mh mi it md b gy mn mk l ml mm">pg = ["A","B","C","D"] * 25<br/>supplier = ["S1","S2"] * 50<br/>shuffle(pg)<br/>shuffle(supplier)</span><span id="a3d6" class="mh mi it md b gy mn mk l ml mm">df = pd.DataFrame({<br/>    "product_code": np.arange(1000,1100),<br/>    "product_group": pg,<br/>    "supplier": supplier,<br/>    "price": np.round(np.random.rand(100) * 5, 2),<br/>    "sales_qty": np.random.randint(10, 200, size=100)     <br/>})</span><span id="df7a" class="mh mi it md b gy mn mk l ml mm">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/bb97b8842e3ae19c0610467388ccabd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ee19nUMiny0lgyZvBqalxw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df 的前 5 行(图片由作者提供)</p></figure><p id="091a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用 NumPy 来生成带有随机数的数组。产品组和供应商列是用 Python 列表创建的。为了增加随机性，内置随机库中的洗牌模块用于洗牌。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h2 id="ea17" class="mh mi it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">1.直接使用聚合函数</h2><p id="4ca1" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">显而易见的方法是使用集合函数，如均值、中值、最小值等。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="8687" class="mh mi it md b gy mj mk l ml mm">df.mean()</span><span id="6d01" class="mh mi it md b gy mn mk l ml mm"><strong class="md iu"># Output</strong><br/>product_code    1049.5000<br/>price              2.6519<br/>sales_qty        103.5300<br/>dtype: float64</span></pre><p id="53be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种方法中，Pandas 只计算数字列的聚合值。但是，在未来的版本中将不推荐使用此功能，并且此操作将生成类型错误。因此，建议首先选择感兴趣的列，然后进行聚合。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="8633" class="mh mi it md b gy mj mk l ml mm">df[["price","sales_qty"]].mean()</span><span id="a188" class="mh mi it md b gy mn mk l ml mm"><strong class="md iu"># Output</strong><br/>price          2.6519<br/>sales_qty    103.5300<br/>dtype: float64</span></pre><p id="a5fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然产品代码列是数字，但我们不能真正谈论平均产品代码，所以我们不选择它。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h2 id="0d60" class="mh mi it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">2.具有应用功能的多个聚合</h2><p id="5e23" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">我们有时需要在一次操作中计算多个聚合。这可以通过向 apply 函数传递一个函数列表来实现。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="8a87" class="mh mi it md b gy mj mk l ml mm">df["price"].apply(["mean","median"])</span><span id="c68e" class="mh mi it md b gy mn mk l ml mm"><strong class="md iu"># Output</strong><br/>mean      2.6519<br/>median    2.8550<br/>Name: price, dtype: float64</span></pre><p id="4fb4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果多个列上有多个聚合，apply 函数将返回一个数据帧，其中包含索引中的函数名。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="47d7" class="mh mi it md b gy mj mk l ml mm">df[["price","sales_qty"]].apply(["mean","median"])</span><span id="4d35" class="mh mi it md b gy mn mk l ml mm"><strong class="md iu"># Output</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/4de22b8d7cde219fa16468969a6b6e45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Du9C_V0ncw4oz02oy3OFLQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="8545" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果要对不同的列应用不同的聚合函数，可以使用 Python 字典，如下所示:</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="65b0" class="mh mi it md b gy mj mk l ml mm">df[["price","sales_qty"]].apply(<br/>   {"price":"mean","sales_qty":"median"}<br/>)</span><span id="b895" class="mh mi it md b gy mn mk l ml mm"><strong class="md iu"># Output<br/></strong>price          2.6519<br/>sales_qty    102.5000<br/>dtype: float64</span></pre><p id="47d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在输出中看到的值是价格列的平均值和销售量列的中值。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h2 id="737f" class="mh mi it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">3.agg 功能</h2><p id="0125" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">一次计算多个聚合的另一种方法是 agg 函数。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="76fd" class="mh mi it md b gy mj mk l ml mm">df[["price","sales_qty"]].agg(["mean","median"])</span></pre><p id="5199" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这一行代码与上面的 apply 函数产生相同的输出。</p><p id="4980" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">agg 函数还允许为聚合列分配定制的名称。这里有一个例子。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="f59f" class="mh mi it md b gy mj mk l ml mm">df[["price","sales_qty"]].agg(<br/>    avg_price = ("price","mean"),<br/>    max_price = ("price","max"),<br/>    median_sales_qty = ("sales_qty","median")<br/>)</span><span id="ae2e" class="mh mi it md b gy mn mk l ml mm"><strong class="md iu"># Output</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/f509e0f4306c31564b43e75643707b3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jrpsLcCS1mYpyG2sBO03cQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="b042" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要聚合的列和聚合函数写在一个元组中。输出是只填入相关值的数据帧。</p><p id="108b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当与 groupby 函数一起使用时，命名聚合会很方便。我们来做一个例子。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="ddb7" class="mh mi it md b gy mj mk l ml mm">df.groupby("product_group").agg(<br/>    avg_price = ("price","mean"),<br/>    max_price = ("price","max"),<br/>    product_count = ("product_code","count"),<br/>    avg_sales = ("sales_qty","mean")<br/>)</span><span id="0095" class="mh mi it md b gy mn mk l ml mm"><strong class="md iu"># Output</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/f831ae7955b404adeffd714c9007af57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xAhYDu94LKJ5nnlmEXXSgQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h2 id="378c" class="mh mi it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">奖励:描述</h2><p id="7a8b" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">describe 函数计算以下聚合和统计数据:</p><ul class=""><li id="b1da" class="nv nw it lb b lc ld lf lg li nx lm ny lq nz lu oa ob oc od bi translated">数数</li><li id="c72b" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">意思是</li><li id="6d81" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">标准偏差</li><li id="ad30" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">部</li><li id="257b" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">25%(第一个四分位数)</li><li id="5f18" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">50%(第二个四分位数或中位数)</li><li id="2214" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">75%(第三个四分位数)</li><li id="55e8" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">最大</li></ul><p id="22b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从最低到最高排序时，25%的值低于第一个四分位数，50%的值低于第二个四分位数，依此类推。</p><p id="ec81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">describe 函数可以应用于一列或一组列。我们也可以直接在数据帧上使用它。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="db6f" class="mh mi it md b gy mj mk l ml mm">df[["price","sales_qty"]].describe()</span><span id="d138" class="mh mi it md b gy mn mk l ml mm"><strong class="md iu"># Output</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/c9e7244b364768e8a364d26c33165364.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VULFr0mg_kP3cXwJgiXEwQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="5d51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">describe 函数提供了数字列的概述。对于探索性的数据分析是相当有用的。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><p id="aae5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ly">你可以成为</em> <a class="ae ky" href="https://sonery.medium.com/membership" rel="noopener"> <em class="ly">媒介会员</em> </a> <em class="ly">解锁我的全部写作权限，外加其余媒介。如果你已经是了，别忘了订阅</em><a class="ae ky" href="https://sonery.medium.com/subscribe" rel="noopener"><em class="ly"/></a><em class="ly">如果你想在我发表新文章时收到电子邮件。</em></p><div class="ok ol gp gr om on"><a href="https://sonery.medium.com/membership" rel="noopener follow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd iu gy z fp os fr fs ot fu fw is bi translated">通过我的推荐链接加入 Medium-Soner yl DRM</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">sonery.medium.com</p></div></div><div class="ow l"><div class="ox l oy oz pa ow pb ks on"/></div></div></a></div><p id="4c02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>