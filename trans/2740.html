<html>
<head>
<title>Time Series Forecasting: Prediction Intervals</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列预测:预测间隔</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-forecasting-prediction-intervals-360b1bf4b085#2022-06-14">https://towardsdatascience.com/time-series-forecasting-prediction-intervals-360b1bf4b085#2022-06-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="45bc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">满怀信心地估计未来观测的范围</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0195fdc26a7e89ce136209ae8dcab47d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZZncsZQF6CtTkgCqfSTbOQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">目标图像—由<a class="ae kv" href="https://unsplash.com/@javaistan" rel="noopener ugc nofollow" target="_blank"> Afif Kusuma </a></p></figure><p id="f663" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在现实世界中预测是一项重要的任务。考虑预测能源需求、温度、食物供应和健康指标等等。在这些情况下获得不准确的预测会对人们的生活产生重大影响。</p><p id="3466" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是预测间隔的用处。预测区间用于提供一个范围，在该范围内，预测可能具有特定的置信度。例如，如果您以95%的置信度进行了100次预测，那么100次预测中会有95次落在预测区间内。通过使用预测间隔，您可以考虑预测中的不确定性和数据的随机变化。</p><h2 id="3fe9" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">加载温度数据</h2><p id="8995" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在本文中，我们将预测巴西圣保罗的月平均气温。<a class="ae kv" href="https://www.kaggle.com/datasets/volpatto/temperature-timeseries-for-some-brazilian-cities" rel="noopener ugc nofollow" target="_blank">数据集</a>由NCEI⁶和NASA⁷.收集和策划感谢所有参与分享这个数据集的人！(许可证:CC0 —公共领域)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/0bf6df48ef7c8f21a12515682d97dadf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BSfiXsBWpjx2iQpIModY_A.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">圣保罗皮涅罗斯——作者<a class="ae kv" href="https://unsplash.com/@wylkon" rel="noopener ugc nofollow" target="_blank">威尔肯·卡多萨</a></p></figure><p id="bdfa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不幸的是，在现实世界中，数据从来都不是您想要的格式。在下面的单元格中，我们使用Pandas将其转换为两列。日期和温度。使用Matplotlib将结果数据可视化。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/45f5d9ba41702483631c55d1d4fbf890.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SNocUH0gFRZcvUJjdsAnzg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">未清除的温度数据—按作者</p></figure><p id="484b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上图中，我们可以看到数据集有缺失值和错误。这些点充满了999.9的温度。我们可以简单地对大约1980年到大约2015年之间的372个数据点进行采样，其中不包含错误。在本文的其余部分，我们将使用这个数据样本。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mu"><img src="../Images/d9fe7e0599cfbefb2caf306fe56e6e36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zQoyg5QH5zxZLU4SjXybjg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">温度数据的干净样本—作者</p></figure><h2 id="ea39" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">创建模型</h2><p id="e308" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我曾与许多时间序列模型，但我总是回来ARIMA模型。这些模型是可靠的，并且通常优于竞争模型类型(NeuralProphet、指数平滑、最后值)。</p><p id="f728" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用ARIMA的修改版，名为萨里玛。萨里玛为ARIMA增加了一个滞后项，用于跟踪数据中的季节性。使用名为pmdarima⁹的软件包，我们可以自动调整模型参数。关于ARIMA车型更详细的解释，请点击这里查看这篇精彩的文章<a class="ae kv" rel="noopener" target="_blank" href="/time-series-forecasting-with-arima-sarima-and-sarimax-ee61099e78f6">。</a></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/3366573daaaa91f1f42cef709f9f2a97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*7w6tPz3bWuqXXqy_VvVn3A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">最佳ARIMA参数—作者</p></figure><p id="91e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的单元格给出了适合我们的ARIMA模型的最佳订单和季节性订单。在下面的单元格中，我们就是这样做的，并在验证数据集上迭代地进行一步预测。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr ms l"/></div></figure><h1 id="dfe3" class="mw lt iq bd lu mx my mz lx na nb nc ma jw nd jx md jz ne ka mg kc nf kd mj ng bi translated">预测区间</h1><h2 id="60a9" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">方法1: RMSFE</h2><p id="7044" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我们可以使用的第一种方法称为RMSFE(均方根预测误差)。RMSFE与RMSE非常相似。唯一的区别是RMSFE必须根据对未知数据(即验证或测试集)。</p><p id="3c8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">需要注意的是，只有假设验证预测的残差呈正态分布，我们才能使用这种方法。为了验证这一点，我们将使用PP图，并用Anderson-Darling、Kolmogorov-Smirnov和D'Agostino K平方检验来检验其正态性。</p><p id="4f26" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">PP图(概率对概率)根据正态分布图绘制数据样本，如果正态分布，数据点将形成一条直线。</p><p id="61e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">三个正态性检验使用p值确定数据样本来自正态分布总体的可能性。每个检验的零假设是“样本来自正态分布的总体”。这意味着，如果得到的p值低于选定的α值，则拒绝零假设。因此，有证据表明数据来自非正态分布。对于本文，我们将使用0.01的Alpha值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/143b57d193806df795c6e9b9cf89acc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p5SnRnNT0OvOijuVu-EyEg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">PP图和正态性检验——作者</p></figure><p id="0312" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太好了！所有三个测试都返回了大于alpha值0.01的p值。这意味着不能拒绝零假设，并且数据点很可能来自正态分布。我们现在可以使用RMSFE在我们的预测中生成预测间隔。</p><p id="b6f0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里的第一步是选择我们想要提供的置信度。我们希望我们的预测落在75%、95%或99%的预测区间内吗？我们将使用95%的预测区间。在正态分布中，95%的数据点落在平均值的1.96个标准偏差内，因此我们用RMSFE乘以1.96来获得预测区间大小。如下图所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mu"><img src="../Images/4ffda668a76678cf1b6d0ace5ef9e3af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b6lRYvZU7-aBncxM_fQCmQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">RMSFE预测区间-按作者</p></figure><p id="8b87" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种方法的缺点是预测区间高度依赖于验证预测的残差。这并不是世界末日，但是预测区间很可能过度适应验证集中的变化。</p><h2 id="a742" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">方法2: BCVR(自举交叉验证残差)</h2><p id="9eec" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated"><em class="ni">注意:BCVR是我提出的一种理论方法！</em></p><p id="1804" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们姑且称这种方法为BCVR(自举交叉验证残差)。BCVR试图获得交叉验证和引导的好处。自举残差是一种生成预测区间的常用方法，通常与具有正态分布残差的RMSFE方法产生相似的结果，但在非正态残差上的表现略好于RMSFE。此外，通过使用交叉验证，BCVR应该生成更能代表整个数据集的残差分布。</p><p id="def8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以从执行交叉验证来生成残差开始。我们随机选择一个长度在250到372点之间的训练样本，进行一步预测。然后，我们计算该预测的残差，并重复该过程1000次。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="277b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们可以检验残差分布的正态性。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/5282c5667a3e5b39ff4f78d1f9a123d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TICbOotGruzqzluIL3V7wg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">PP-Plot BCVR方法—作者</p></figure><p id="6deb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">哦不！我们的p值远低于Alpha阈值，因此应该拒绝零假设？不用担心，我们可以使用一种叫做bootstrapping的技术来获得剩余方差的度量。为了做到这一点，我们采取交叉验证的残差，并执行随机抽样替换。然后，我们计算重采样集的标准偏差，并将其存储在一个数组中。我们重复这个过程几次，然后取存储的自举标准偏差的平均值/中值。</p><p id="66ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于应该引导多少次，数学家们并没有达成共识，但是我在这个实现中使用了提前停止来减少计算需求。在下面的单元格中，我们每200次迭代检查一次自举样本的平均标准差。如果平均标准偏差与先前测量值的偏差不超过0.001%，则我们终止循环。在我们的例子中，早期停止发生在第7500次迭代。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mu"><img src="../Images/5c01ce8ee1866671ffefe179cf6bab88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MdnL--V9R39DjZbCBDXjJg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">BCVR预测间隔-按作者</p></figure><p id="fef5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">BCVR方法的缺点是对于一台机器来说计算量很大。幸运的是，这种方法非常适合集群计算。这意味着可以在多台机器之间分配工作负载。例如，如果我们有一个包含10个节点的集群，并且想要执行1000个引导样本，我们可以让每个节点同时执行100个样本。这将大大减少计算时间，并允许我们增加自举样本的数量。</p><h2 id="e868" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">RMSFE与BCVR</h2><p id="1eae" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">这两种方法如何比较？</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mu"><img src="../Images/2f423db8614ff03636b2aa40eb8b5c38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k6DEqp3kIfuLhn4hgZIU8g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">BCVR与RMSFE预测区间对比——作者</p></figure><p id="4cc1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这两种情况下，所有75个点都落在预测区间内。虽然不太可能(各有2%的机会)，但有些点非常接近边界。这两种方法的区间范围略有不同。BCVR方法产生的预测区间范围比RMSFE方法稍窄(见上面BCVR预测区间周围的淡蓝色线)。</p><h2 id="1dc5" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">最后的想法</h2><p id="738f" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">该示例表明，所提出的BCVR实现可用于生成更能代表整个群体的预测区间。看到它应用于不同的场景会很有趣。</p><p id="6f54" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这篇文章的代码可以在这里找到。</p><h2 id="93d1" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated"><strong class="ak">参考文献</strong></h2><ol class=""><li id="a52d" class="nj nk iq ky b kz ml lc mm lf nl lj nm ln nn lr no np nq nr bi translated"><a class="ae kv" href="https://otexts.com/fpp2/prediction-intervals.html" rel="noopener ugc nofollow" target="_blank">预测:原则与实践——罗布·J·海曼和乔治·阿萨纳索普洛斯</a></li><li id="3c80" class="nj nk iq ky b kz ns lc nt lf nu lj nv ln nw lr no np nq nr bi translated"><a class="ae kv" href="https://www.real-statistics.com/regression/confidence-and-prediction-intervals/#:~:text=The%20confidence%20interval%20consists%20of,concept%20called%20a%20prediction%20interval" rel="noopener ugc nofollow" target="_blank">预测值的置信区间和预测区间— Charles Zaiontz </a></li><li id="5013" class="nj nk iq ky b kz ns lc nt lf nu lj nv ln nw lr no np nq nr bi translated"><a class="ae kv" rel="noopener" target="_blank" href="/add-prediction-intervals-to-your-forecasting-model-531b7c2d386c">将预测区间添加到您的预测模型中— Marco Cerliani </a></li><li id="8103" class="nj nk iq ky b kz ns lc nt lf nu lj nv ln nw lr no np nq nr bi translated"><a class="ae kv" href="https://saattrupdan.github.io/2020-03-01-bootstrap-prediction/" rel="noopener ugc nofollow" target="_blank">引导预测区间—丹·萨图普·尼尔森</a></li><li id="8fbf" class="nj nk iq ky b kz ns lc nt lf nu lj nv ln nw lr no np nq nr bi translated">常态测试的温和介绍——杰森·布朗利</li><li id="288a" class="nj nk iq ky b kz ns lc nt lf nu lj nv ln nw lr no np nq nr bi translated"><a class="ae kv" href="https://www.ncei.noaa.gov/" rel="noopener ugc nofollow" target="_blank"> NCEI(国家环境信息中心</a></li><li id="c3c9" class="nj nk iq ky b kz ns lc nt lf nu lj nv ln nw lr no np nq nr bi translated"><a class="ae kv" href="https://data.giss.nasa.gov/gistemp/" rel="noopener ugc nofollow" target="_blank">美国宇航局GISS(戈达德太空研究所)</a></li><li id="2147" class="nj nk iq ky b kz ns lc nt lf nu lj nv ln nw lr no np nq nr bi translated"><a class="ae kv" href="https://en.wikipedia.org/wiki/Shapiro%E2%80%93Wilk_test" rel="noopener ugc nofollow" target="_blank">夏皮罗-维尔克测试—维基百科</a></li><li id="9f9a" class="nj nk iq ky b kz ns lc nt lf nu lj nv ln nw lr no np nq nr bi translated"><a class="ae kv" href="http://alkaline-ml.com/pmdarima/1.8.3/modules/classes.html" rel="noopener ugc nofollow" target="_blank"> Pmdarina </a></li></ol></div></div>    
</body>
</html>