<html>
<head>
<title>Getting Started with Normalizing Flows: Linear Algebra &amp; Probability</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">规范化流程入门:线性代数与概率</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/getting-started-with-normalizing-flows-linear-algebra-probability-f2b863ff427d#2022-09-27">https://towardsdatascience.com/getting-started-with-normalizing-flows-linear-algebra-probability-f2b863ff427d#2022-09-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8041" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">变易法则、双射与微分同胚</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ee1c0dfd78d5635cf3535a53de8418eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_sDVbBizzxavmCvbuT67AQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">平静的流动(鸣谢:作者)</p></figure><p id="9e77" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">生成模型的基础是理解数据样本的来源分布。在我以前的一篇文章中，通过完成期望最大化算法的步骤，展示了一个生成模型的例子，其中我们假设潜在变量产生了期望的数据。我们还知道其他一些基于神经网络的方法，如变分自动编码器(VAE)和生成对抗网络(GAN ),它们显示了(它们的变体)引人注目的应用，但是它们缺少一个关键特征；它们不允许对新点的概率密度进行精确评估。通过标准化流量，可以通过易处理的分布进行采样和密度估计。</p><p id="7405" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了理解标准化流的基本原理，我们在这里讨论必要的本科水平的概率和线性代数，这将有助于逐步掌握将简单分布转换为复杂分布的概念。你能从这篇文章中学到什么？</p><ol class=""><li id="8636" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">什么是双射和微分同胚？</li><li id="d351" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">线性代数和雅可比矩阵基础。</li><li id="d7f4" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">转换概率分布和雅可比矩阵。</li><li id="4610" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">规范化流程在前面的概念中处于什么位置？</li><li id="4b11" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">通过使用张量流概率库检查我们的理解。</li></ol></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="b737" class="mp mq it bd mr ms mt dn mu mv mw dp mx lh my mz na ll nb nc nd lp ne nf ng nh bi translated">1.双射与微分同胚；</h2><p id="554e" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">一个函数<em class="nn"> f </em> : <em class="nn"> A </em> → <em class="nn"> B </em>如果这2个集合(<em class="nn"> A </em>，<em class="nn"> B </em>)的元素有完美的一一对应，那么这个函数就是双射的。双射函数最重要的性质是存在一个<em class="nn">反函数，它可以撤销函数</em>的作用。</p><p id="474d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例:由公式<em class="nn">f</em>(<em class="nn">x</em>)=<em class="nn">x</em>+7定义的从集合{1，2，3，4}到集合{8，9，10，11}的函数是一个双射。</p><p id="5633" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> <em class="nn">微分同胚:</em> </strong>把<em class="nn"> x </em>看作一个<em class="nn"> D </em>维向量，我们想定义一个<em class="nn"> x </em>上的联合分布。基于流建模的主要思想是将<em class="nn"> x </em>表示为从<em class="nn"> p_u </em> ( <em class="nn"> u </em>)采样的实向量<em class="nn"> u </em>的变换<em class="nn"> ϕ </em>:</p><p id="676f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="nn">x</em>=<em class="nn">ϕ</em>(<em class="nn">u</em>)其中，<em class="nn">u</em>∽<em class="nn">p _ u</em>(<em class="nn">u</em>)……(<em class="nn">eq</em>:1)</p><p id="54f5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里<em class="nn"> p_u(u) </em>称为流量模型的基分布。基于流的模型的定义属性是变换<em class="nn"> ϕ </em>必须可逆，并且<em class="nn"> ϕ </em>和Inv( <em class="nn"> ϕ) </em> <em class="nn">必须可微</em>。这些变换被称为<em class="nn">微分同胚</em>，并且要求<em class="nn"> u </em>也必须是<em class="nn"> D </em>维的[1]。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="9867" class="mp mq it bd mr ms mt dn mu mv mw dp mx lh my mz na ll nb nc nd lp ne nf ng nh bi translated">2.变量和雅可比矩阵的变化:</h2><p id="10c0" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">在这里，我们得到了大学线性代数课的帮助。</p><p id="8731" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">考虑一个线性变换<em class="nn"> T </em> : R →R(在数学中，维数为<em class="nn"> n </em>的实坐标空间，表示为Rⁿ).这样的线性变换可以用一个2×2矩阵<em class="nn"> A </em>来描述。将有序对作为列向量，我们可以写出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/099082ae6608715e29ec5b0e045745ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yC7GnLRORDQiK4o--_VINg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">情商。2.1:线性变换和雅可比矩阵</p></figure><p id="d58e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">矩阵<em class="nn"> A </em>将单位正方形(两边为标准单位向量<em class="nn"> i </em>和<em class="nn"> j </em>的正方形)发送到两边为A的<em class="nn">列</em>的平行四边形，即<em class="nn"> a c </em>、<em class="nn"> b d </em>。偏导数矩阵<em class="nn"> A </em>(如果T是线性变换，它将是常数矩阵)有一个行列式；这叫做<em class="nn"> T </em>的<strong class="la iu">雅可比</strong>。这个平行四边形的面积是|<em class="nn">det</em>(<em class="nn">A</em>)|<em class="nn">A</em>的行列式的绝对值。</p><p id="77e1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一般来说，如果<em class="nn"> D </em>是R中的任意区域，<em class="nn">D _</em>1 =<em class="nn">T</em>(<em class="nn">D</em>)是它在这种线性变换下的像，那么:Area(<em class="nn">D _</em>1)= |<em class="nn">det</em>(<em class="nn">A</em>)| Area(<em class="nn">D</em>)。我们举一个在R空间从笛卡尔坐标转换到极坐标的例子，就可以很容易地验证这一点。我们知道变换规则由<em class="nn">x</em>=<em class="nn">r</em>cos<em class="nn">θ</em>，<em class="nn">y</em>=<em class="nn">r</em>sin<em class="nn">θ</em>给出，那么变换的雅可比矩阵为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/18ab25ec434b21e0a1d010f22a71b9cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*GYy_M6aKgzN3C_gN9UyGjw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">情商。2.2:用于从笛卡尔坐标系转换到极坐标系统的雅可比矩阵</p></figure><p id="3900" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">利用上面雅可比矩阵的定义我们可以得到面积元素为:<em class="nn"> dA </em> ( <em class="nn"> x </em>，<em class="nn">y</em>)= |<em class="nn">det</em><em class="nn">J</em>|<em class="nn">dA</em>(<em class="nn">r</em>，<em class="nn"> θ </em> ) = <em class="nn"> r dr dθ。</em>最后，变量公式的变换在多元微积分中非常有用，我们可以总结如下:</p><p id="ea9f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">设<em class="nn"> T </em>是从<em class="nn"> D_ </em> 1到<em class="nn"> D </em>的一个<em class="nn"> C </em>微分同胚(若t是<em class="nn"> r </em>次连续可微，<em class="nn"> T </em>称为一个<em class="nn"> C </em> ʳ微分同胚)。对于<em class="nn"> D: </em>中的任何连续功能<em class="nn"> f </em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/233bfbdced91becee169082ccd2de4ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*iDjeuGca0XwKqLT6AFHf6Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">情商。2.3:使用雅可比的变换规则</p></figure><p id="297d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个表达式可以推广到n维。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="d45d" class="mp mq it bd mr ms mt dn mu mv mw dp mx lh my mz na ll nb nc nd lp ne nf ng nh bi translated">3.1.变量的概率和变化:</h2><p id="4100" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">我们将上述概念从单/多变量函数扩展到概率分布。考虑一个简单的变换，一个均匀分布在单位立方体上的随机变量<em class="nn"> U </em>，<em class="nn">U</em>∈【0，1】。我们可以将<em class="nn"> U </em>缩放一个因子<em class="nn"> n </em>得到一个新的随机变量<em class="nn"> X </em>(如下图1所示)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/eef435e7bdcdd4486e17783562d5fc50.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*TO7WnI_vjWKteZXPXioUVQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">情商。3.1.1:用因子n缩放随机变量</p></figure><p id="afcd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于总概率是守恒的，我们可以写成:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/ee9d4771ad96502ace17d843469bc834.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*tgwo8m9Empqv5CKLNVaGFA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">情商。3.1.2:概率总和为1</p></figure><p id="388c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于我们从单位体积的立方体上的随机变量(<em class="nn"> V_u </em>)开始，缩放随机变量也将缩放概率密度，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/4d62744c56172c407979a5c6e911d3df.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*dcOCaCEw3Y_069PjyrPNew.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">情商。3.1.3:当n&gt;1时，概率密度缩小</p></figure><p id="ad26" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">前面关于从<em class="nn"> u </em> → <em class="nn"> x </em>的变换的讨论(图1)告诉我们，由于映射函数(可逆)<em class="nn">【ϕ】</em>，从<em class="nn">p</em>(<em class="nn">u</em>)→<em class="nn">p</em>(<em class="nn">x</em>)的变换，有多少<em class="nn"> du </em>被收缩/拉伸到<em class="nn"> dx </em></p><p id="6ff3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为什么这很重要？因为这是流量正常化的起点。我们就是这样从情商开始的。1在微分同胚一节之前。我们考虑从概率分布<em class="nn"> p_u </em>采样的实向量<em class="nn"> u </em>和改变<em class="nn"> u→x </em>的变换函数<em class="nn"> ϕ </em>。对于基于流动的模型，<em class="nn"> ϕ </em>是一个微分同胚。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/1af5230d22d33b37750fb545d1ef574c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ao4xQoGEPqNY8xLsj8LOnw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1:使用微分同胚变换概率分布:由于总概率总是1，我们在变换后得到一个收缩/拉伸的空间。(鸣谢:作者幻灯片)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="d128" class="mp mq it bd mr ms mt dn mu mv mw dp mx lh my mz na ll nb nc nd lp ne nf ng nh bi translated">3.2.转换概率分布:</h2><p id="aeab" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">为了推导一些转换概率分布的简单公式，我们从方程开始。3.1.2.上一节中又考虑了一个单一的区域，所以我们可以去掉积分:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/fa48281da18cc727b7d676fb670a258f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qbZHRsH-1uUqWnq1qVIxgA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">情商。3.2.1:概率守恒导致第一对数概率公式。</p></figure><p id="c689" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们记得我们通过映射函数<em class="nn"> ϕ </em>从<em class="nn"> u </em>到<em class="nn"> x </em>的转换为<em class="nn">x</em>=<em class="nn">ϕ</em>(<em class="nn">u</em>)；<em class="nn">u</em>= inv {<em class="nn">ϕ}</em>(<em class="nn">x</em>)。从前面关于变换的讨论(在线性代数部分)中，我们知道由线性/非线性变换引起的拉伸/收缩可以通过雅可比矩阵的行列式来量化。非常类似地，这里的变换规则也变成了:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/a5031c80f510663555f951dbc125068c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GCo1-kPOfWLl6JWGylS01Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">情商。3.2.2:根据之前的线性代数讨论，用雅可比矩阵写出之前的方程。</p></figure><p id="ca20" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">R.这个方程的H.S现在完全取决于基本变量<em class="nn"> u </em>。雅可比矩阵定义保持不变:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/82f7c4a05e51c6c2bc2f5d0f43d3e99b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*vEESMaIJiZIJl0iRLlzLdw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">情商。3.2.3:强大的雅各比派:它所代表的…</p></figure><p id="6801" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">取上式两边的对数，我们可以写成如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/a4bac07703515e1f520dd63f0d5ec938.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fjU2TUXBY8_0Lsgtjt5hlA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">情商。3.2.4:取等式的对数。3.2.2.</p></figure><p id="7a99" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于变换函数<em class="nn"> ϕ </em>是可逆的，我们也可以写出如下等式:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/683dd12ad8c705cde43b16163bc7e4ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qsDkyQtSwk2REdQeiP6uMw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">情商。3.2.5:由于可逆变换，我们可以增加一些步骤并重写等式。3.2.4以不同的形式。</p></figure><p id="71b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们稍后将使用这些转换规则来转换概率分布。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="5eae" class="mp mq it bd mr ms mt dn mu mv mw dp mx lh my mz na ll nb nc nd lp ne nf ng nh bi translated">4.标准化流程:</h2><p id="4f7d" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">在介绍了所有必要的基础知识和数学公式之后，我们准备介绍标准化流程。</p><p id="8036" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">之前我们只讨论了一种通过可逆函数<em class="nn"> ϕ </em>的变换。微分同胚(通过函数变换使得函数及其逆均可微)的一个非常重要的性质是它们是<em class="nn">可复合的</em>即<em class="nn">给定两个这样的变换ϕ1，ϕ2，它们的复合ϕ1⋅ϕ2也是可逆的和可微的。</em>逆矩阵和雅可比行列式由下式给出</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/63abad0254d4913bf308b8aadb042047.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*d22NeHAXDKwMcb8qKPnMMA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">情商。4:多重微分同胚的组合。</p></figure><p id="d73b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">规范化流程背后的想法是将多个微分同胚<em class="nn"> ϕ </em> 1、<em class="nn"> ϕ </em> 2、⋯ <em class="nn"> ϕk </em>链接在一起，以逐渐获得来自复杂分布<em class="nn"> p_X </em> ( <em class="nn"> x </em>)的<em class="nn"> x【原始数据】，从<em class="nn"> u </em>开始，来自简单基础分布<em class="nn">p _ u</em>(<em class="nn">u<em class="nn"/></em></em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/274e93dd445cab04091028d9cf0173cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uVWjeomT-9EQQiJqwRLWog.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2:标准化流程做什么？通过一系列微分同胚将简单分布(例如:N(0，I))转换为复杂分布。(鸣谢:作者幻灯片)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="5fd7" class="mp mq it bd mr ms mt dn mu mv mw dp mx lh my mz na ll nb nc nd lp ne nf ng nh bi translated">张量流概率库的简单例子:</h2><p id="717b" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">我们将从使用TensorFlow概率库的一些简单的正向和反向转换的例子开始，该概率库具有<a class="ae ob" href="https://www.tensorflow.org/probability/api_docs/python/tfp/bijectors/Bijector" rel="noopener ugc nofollow" target="_blank">双投影器模块</a>。让我们加载必要的库:</p><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="122d" class="mp mq it od b gy oh oi l oj ok">import tensorflow as tf</span><span id="1d7e" class="mp mq it od b gy ol oi l oj ok">import tensorflow_probability as tfp</span><span id="0646" class="mp mq it od b gy ol oi l oj ok">tfd = tfp.distributions</span><span id="b970" class="mp mq it od b gy ol oi l oj ok">tfb = tfp.bijectors</span></pre><p id="e453" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> <em class="nn">变换张量:</em> </strong>让我们使用两个最简单的双射运算(缩放和移位)并将它们组合起来，以“正向”变换一个张量，并执行反向运算以再次检索原始张量:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="8001" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们从一个常数张量[1]开始。, 2., 3.]然后我们通过<code class="fe oo op oq od b">tfb.Chain</code>链接两个双射操作(移动3个单位和缩放2个单位)。然后，我们可以很容易地执行正向和反向操作，我们验证，在正向变换后，使用反向变换，我们得到了原始张量。</p><p id="7759" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> <em class="nn">变换分布:</em> </strong>在前面的例子中我们变换了一个张量，但这里我们来变换一个分布。我们从正态分布中抽取样本，并使用我们之前用于变换的相同链式双射运算:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="3cbb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">仅考虑正态分布中的5个随机样本，我们应用链式双投影器(scale &amp; shift ),下面是正向变换的结果图(直方图)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/71bdde3be4577561f300d47017892d7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-bngSp3V4QISKb28rmlS2A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3:正态分布的样本(左)和正向变换后的结果(3个单位移位+ 2个单位标度)。</p></figure><p id="6ec2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们还检查了等式2中描述的对数概率规则。3.2.4 &amp; 3.2.5.这些很容易检查，因为双投影器在张量流概率中有方法<code class="fe oo op oq od b">forward_log_det_jacobian</code>和<code class="fe oo op oq od b">inverse_log_det_jacobian</code>。</p><p id="e356" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果考虑2D分布，而不是1D分布，会发生什么？让我们看一个从2D均匀分布开始的例子，并应用如下的缩放双射运算:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="ee6d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2D均匀分布在x方向上缩放-2个单位，在y方向上缩放0.5个单位。我们可以对缩放双射前后的100个样本进行散点图绘制:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/d5877d2d6872dcb3e29657ff39f81f5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lISYkd4eVOXLcFhsJo_epw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4:通过正向运算变换2D分布(变换函数是双射的)。</p></figure><p id="ec70" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对角矩阵将始终独立地在两个维度上执行缩放操作，即矩形分布保持矩形，我们在上一个示例中看到了这一点。</p><p id="28f1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果要从矩形分布变成四边形分布呢？这里我们可以使用下三角矩阵进行缩放双射运算。让我们看看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="e86c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从矩形分布开始，我们最终得到如下四边形分布:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/d9f01c0f99c4785e95ce6f6e6215a49a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xw9mxuppej-AVBm2Bk1A2A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图5:与图4相同，但是这里我们将矩形分布转换为四边形分布。这里显示了这些分布的示例。</p></figure><p id="7d3e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就像以前一样，我们可以通过应用如下的逆变换来恢复到原始分布:</p><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="ab34" class="mp mq it od b gy oh oi l oj ok">y2_inv = scale_bijector2.inverse(scale_bijector2(x))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/2e1fa9b51ff8f080a44ef718bd5d0033.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gFncnESVw5-9XXIUv-Eu9w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图6:我们总是可以执行逆变换(只要变换是双射的)并取回原始样本(来自均匀的2D分布)。</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="a5ec" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们讨论了标准化流程的核心概念和构建模块。从线性代数、雅可比行列式和概率分布变换开始，我们已经看到了线性代数中雅可比行列式的概念如何无缝地用于变换概率分布。最后，我们使用了张量流概率库中的双射器模块来验证我们推导的概念和公式。</p><p id="5543" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在下一篇文章中，我将更多地关注复杂分布的转换(例如，从正态分布到双峰分布等)。)使用双射函数，但是这里使用的概念和公式在研究标准化流的任何阶段都将非常有用。</p><p id="d12b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">干杯，保持坚强！！</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="4957" class="mp mq it bd mr ms mt dn mu mv mw dp mx lh my mz na ll nb nc nd lp ne nf ng nh bi translated">参考资料:</h2><p id="8163" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">[1]“用于概率建模和推理的标准化流”:G. Papamakarios等人[arXiv: <a class="ae ob" href="https://arxiv.org/abs/1912.02762" rel="noopener ugc nofollow" target="_blank"> 1912.02762 </a>。</p><p id="5863" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">[2] <a class="ae ob" href="https://blog.evjang.com/2018/01/nf1.html" rel="noopener ugc nofollow" target="_blank">正常化流动:分布和决定因素</a> : Eric Jang。</p><p id="b8a4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">[3]本帖使用的笔记本:<a class="ae ob" href="https://github.com/suvoooo/Learn-TensorFlow/blob/master/TF-Proba/Norm-Flows/Normalizing%20Flows_GettingStarted.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub链接</a>。</p></div></div>    
</body>
</html>