<html>
<head>
<title>Apache Airflow Architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">阿帕奇气流架构</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/apache-airflow-architecture-496b9cb28288#2022-07-25">https://towardsdatascience.com/apache-airflow-architecture-496b9cb28288#2022-07-25</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="4286" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">深入探讨Apache Airflow架构及其如何编排工作流</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/3be49c7ad5e04cef75d37fd8f99ba166.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l3j3Mos25Enb3FDsK8n2ew.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">由<a class="ae kz" href="https://unsplash.com/s/photos/blocks?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae kz" href="https://unsplash.com/@lastnameeaster?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> La-Rel Easter </a>拍摄的照片</p></figure><p id="7132" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">就管道调度和执行而言，Apache Airflow是最常用的框架之一，并且在过去几年中已经在数据工程社区中获得了巨大的吸引力。</p><p id="134a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">该技术本身由许多不同的组件组成，这些组件协同工作以执行特定的操作。在今天的文章中，我们将讨论Apache Airflow的整体架构，并了解不同的组件如何相互交互，以便将数据管道带入生活。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="5245" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">主要组件</h1><p id="31a4" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">Airflow可以构建、安排和执行工作流程。每个工作流被表示为由任务组成的有向无环图(DAG)。现在，这些任务将执行某些操作，它们之间也可能有一些依赖关系。</p><p id="af2e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">例如，假设我们希望将外部数据库中的数据接收到Google Cloud Big Query(这是一个托管数据仓库服务)中，然后执行几个转换步骤。在这种情况下，我们将构建一个包含两个任务的DAG第一个任务负责将数据从外部数据库复制到BigQuery，第二个任务执行转换步骤。另外，第二任务将依赖于第一任务的成功执行。</p><p id="ee8a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，Airflow由几个不同的组件组成，这些组件执行特定的操作并协同工作，以便让用户设计、构建、调度和执行工作流。在接下来的几节中，我们将介绍Airflow的架构，并讨论它的一些最重要的组件。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="2fcb" class="na me iu bd mf nb nc dn mj nd ne dp mn lj nf ng mp ln nh ni mr lr nj nk mt nl bi translated">调度程序</h2><p id="2a2f" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">本质上执行两个特定任务的调度程序；它调度和触发工作流，此外，它还向执行者提交所有调度的工作流。</p><p id="1a12" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">为了确定是否可以触发任何任务，调度程序需要运行一个负责监控DAG文件夹(包含DAG的所有Python文件都应该位于该文件夹中)的子进程。默认情况下，调度程序将每分钟进行一次查找(但这可以在气流配置文件中进行调整)。</p><p id="0324" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">调度程序使用执行器来运行准备好的任务。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="6998" class="na me iu bd mf nb nc dn mj nd ne dp mn lj nf ng mp ln nh ni mr lr nj nk mt nl bi translated">执行者</h2><p id="0286" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">执行者负责运行任务。一个气流装置在任何给定时间只能有一个执行器。执行器在气流配置文件(<code class="fe nm nn no np b">airflow.cfg</code>)的<code class="fe nm nn no np b">[core]</code>部分定义。举个例子，</p><pre class="kk kl km kn gu nq np nr ns aw nt bi"><span id="2c10" class="na me iu np b gz nu nv l nw nx">[core]<br/>executor = KubernetesExecutor</span></pre><p id="d034" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">注意，本质上有两种类型的执行者；本地和远程。当地执行者包括<code class="fe nm nn no np b"><a class="ae kz" href="https://airflow.apache.org/docs/apache-airflow/stable/executor/debug.html" rel="noopener ugc nofollow" target="_blank">DebugExecutor</a></code>、<code class="fe nm nn no np b"><a class="ae kz" href="https://airflow.apache.org/docs/apache-airflow/stable/executor/local.html" rel="noopener ugc nofollow" target="_blank">LocalExecutor</a></code>和<code class="fe nm nn no np b"><a class="ae kz" href="https://airflow.apache.org/docs/apache-airflow/stable/executor/sequential.html" rel="noopener ugc nofollow" target="_blank">SequentialExecutor</a></code>。一些远程执行者是<code class="fe nm nn no np b"><a class="ae kz" href="https://airflow.apache.org/docs/apache-airflow/stable/executor/celery.html" rel="noopener ugc nofollow" target="_blank">CeleryExecutor</a></code>和<code class="fe nm nn no np b"><a class="ae kz" href="https://airflow.apache.org/docs/apache-airflow/stable/executor/kubernetes.html" rel="noopener ugc nofollow" target="_blank">KubernetesExecutor</a></code>。</p><p id="f942" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">本地执行器在调度程序的进程内部本地运行任务。另一方面，远程执行者远程执行他们的任务(例如，在Kubernetes集群中的一个pod中)，通常使用一个工人池。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="7e4c" class="na me iu bd mf nb nc dn mj nd ne dp mn lj nf ng mp ln nh ni mr lr nj nk mt nl bi translated">长队</h2><p id="e231" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">一旦调度器识别出可以被触发的任务，它将按照它们应该被执行的正确顺序把它们推入任务队列。</p><p id="56f0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然后，气流工作者将从队列中取出任务，以便执行它们。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="71aa" class="na me iu bd mf nb nc dn mj nd ne dp mn lj nf ng mp ln nh ni mr lr nj nk mt nl bi translated">工人</h2><p id="1712" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">气流工用来执行分配的任务。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="b782" class="na me iu bd mf nb nc dn mj nd ne dp mn lj nf ng mp ln nh ni mr lr nj nk mt nl bi translated">元数据数据库</h2><p id="6ca2" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">这是一个由执行器、调度程序和web服务器用来存储它们的状态的数据库。默认情况下，SQLite数据库会加速运行，但是Airflow可以使用SQLAlchemy支持的任何数据库作为其元数据数据库。尽管一般来说用户倾向于对Postgres有强烈的偏好。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="48bd" class="na me iu bd mf nb nc dn mj nd ne dp mn lj nf ng mp ln nh ni mr lr nj nk mt nl bi translated">网络服务器</h2><p id="8a11" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">这是一个Flask web服务器，它公开了一个用户界面，允许用户管理、调试和检查工作流及其任务。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ny"><img src="../Images/4d0732a457f430bf8867785566fcdb6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-1IiqCQDB0ul18ypNsI3_A.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">气流用户界面—来源:<a class="ae kz" href="https://airflow.apache.org/docs/apache-airflow/stable/ui.html#dags-view" rel="noopener ugc nofollow" target="_blank"> Apache气流文档</a></p></figure></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="1e97" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">大局</h1><p id="2ec1" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">下图说明了我们之前讨论的不同组件如何相互交互以及交换数据和消息以执行特定任务。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nz"><img src="../Images/fcf8a06dddcbaf8c951fbd13c0eb3143.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BrWpKPZswr1AlJJ-rfJ1Gw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">简而言之的气流建筑——来源:作者</p></figure><p id="3ab2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Web服务器本质上需要与工作器、DAG文件夹和元数据数据库通信，以便分别获取任务执行日志、DAG结构和任务状态。</p><p id="f934" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">工作者需要与DAG文件夹通信，以便推断DAG的结构并执行其任务，还需要与元数据数据库通信，以便读取和存储关于连接、变量和XCOM的信息。</p><p id="c729" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">调度程序必须与DAG文件夹通信以推断DAG的结构并调度它们的任务，还必须与元数据数据库通信以写入关于DAG运行和相关任务的信息。此外，它需要与任务队列进行通信，它将在任务队列中推送准备好被触发的任务。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="78f3" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">最后的想法</h1><p id="f311" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">Airflow是一个强大的工具，让用户(主要是工程师)设计、构建、调试、调度和执行各种工作流。在今天的教程中，我们学习了气流中一些最重要的组成部分，它们协同工作以执行特定的操作。</p><p id="3ed9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在开始使用一个框架或工具之前，花时间去理解它的基本架构总是非常重要的。大多数情况下，这将帮助您编写更有意义、更高效的代码。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><p id="1b77" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://gmyrianthous.medium.com/membership" rel="noopener"> <strong class="lc iv">成为会员</strong> </a> <strong class="lc iv">阅读介质上的每一个故事。你的会员费直接支持我和你看的其他作家。你也可以在媒体上看到所有的故事。</strong></p><div class="oa ob gq gs oc od"><a href="https://gmyrianthous.medium.com/membership" rel="noopener follow" target="_blank"><div class="oe ab fp"><div class="of ab og cl cj oh"><h2 class="bd iv gz z fq oi fs ft oj fv fx it bi translated">通过我的推荐链接加入Medium-Giorgos Myrianthous</h2><div class="ok l"><h3 class="bd b gz z fq oi fs ft oj fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ol l"><p class="bd b dl z fq oi fs ft oj fv fx dk translated">gmyrianthous.medium.com</p></div></div><div class="om l"><div class="on l oo op oq om or kt od"/></div></div></a></div></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><p id="676e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">相关文章你可能也喜欢</strong></p><div class="oa ob gq gs oc od"><a rel="noopener follow" target="_blank" href="/airflow-dags-decorators-b5dc03c76f07"><div class="oe ab fp"><div class="of ab og cl cj oh"><h2 class="bd iv gz z fq oi fs ft oj fv fx it bi translated">使用气流装饰器创作Dag</h2><div class="ok l"><h3 class="bd b gz z fq oi fs ft oj fv fx dk translated">用Python decorators创作Apache Airflow DAGs和任务</h3></div><div class="ol l"><p class="bd b dl z fq oi fs ft oj fv fx dk translated">towardsdatascience.com</p></div></div><div class="om l"><div class="os l oo op oq om or kt od"/></div></div></a></div></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu od"><a rel="noopener follow" target="_blank" href="/hashicorp-vault-airflow-cfdddab31ea"><div class="oe ab fp"><div class="of ab og cl cj oh"><h2 class="bd iv gz z fq oi fs ft oj fv fx it bi translated">如何用气流设置HashiCorp保险库</h2><div class="ok l"><h3 class="bd b gz z fq oi fs ft oj fv fx dk translated">将HashiCorp Vault与Apache Airflow集成</h3></div><div class="ol l"><p class="bd b dl z fq oi fs ft oj fv fx dk translated">towardsdatascience.com</p></div></div><div class="om l"><div class="ot l oo op oq om or kt od"/></div></div></a></div></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu od"><a rel="noopener follow" target="_blank" href="/run-airflow-docker-1b83a57616fb"><div class="oe ab fp"><div class="of ab og cl cj oh"><h2 class="bd iv gz z fq oi fs ft oj fv fx it bi translated">如何使用Docker在本地运行气流</h2><div class="ok l"><h3 class="bd b gz z fq oi fs ft oj fv fx dk translated">在本地机器上使用Docker运行Airflow的分步指南</h3></div><div class="ol l"><p class="bd b dl z fq oi fs ft oj fv fx dk translated">towardsdatascience.com</p></div></div><div class="om l"><div class="ou l oo op oq om or kt od"/></div></div></a></div></div></div>    
</body>
</html>