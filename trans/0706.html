<html>
<head>
<title>Is your data too big? Take a sample</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你的数据太大了吗？取样</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/are-your-data-too-big-take-a-sample-98ae54e4c49c#2022-02-28">https://towardsdatascience.com/are-your-data-too-big-take-a-sample-98ae54e4c49c#2022-02-28</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="7b23" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">Python和SQL中表格数据采样介绍</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/f92c04949cd0630fa3bca3c16cf04465.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1qK6_-xm4u-9yHKy4TvM3A.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@mockupgraphics?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">实体模型图形</a>在<a class="ae kz" href="https://unsplash.com/s/photos/slice?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="ee07" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">学术界和商业从业者投入了相当大的努力来利用今天可用的大量数据。自20世纪90年代问世以来，术语<strong class="lc iv">大数据</strong>已经引起了广泛关注。然而,“大”的实际含义仍然难以捉摸，因为随着存储和处理能力随着每一次技术进步而提高，划分<strong class="lc iv">大数据</strong>和<strong class="lc iv">小数据</strong>的阈值也在演变。</p><p id="f603" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然而，在任何数据科学项目的早期阶段，都不太可能需要如此大量的数据。那时，重点应该放在探索性分析上，由常见的描述性统计数据支持，同时通过测试一些小模型来选择适当的技术。</p><p id="4e20" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">此外，您可能会发现在笔记本电脑或其他资源有限的计算机上执行这些任务很方便。当您证明一切都按预期运行时，有足够的时间在高端服务器上部署您的成熟模型。</p><p id="a67d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因此，每个数据科学家都应该精通从大型数据集中提取样本。该程序应<strong class="lc iv">快捷</strong>并保留原始数据的<strong class="lc iv">统计属性</strong>。后者通常通过随机选择要保留的记录来确保。关于速度和效率，我们的选择取决于数据格式和我们可以使用的工具。</p><p id="a265" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">数据集通常以各种形式呈现，或者是<strong class="lc iv">结构化</strong>(例如系列、表格、面板)或者是<strong class="lc iv">非结构化</strong>(例如文本、图像)。这篇文章涵盖了对存储在文件或数据库中的表格数据进行采样的技巧。</p><h2 id="a40e" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">采样“逗号分隔值”(CSV)文件</h2><p id="848d" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">尽管<strong class="lc iv"> CSV文件</strong>相当古老(起源于1972年左右)，但这是一种在长格式或宽格式表格中存储结构化数据的流行方式。一个CSV文件由多个以换行符结束的<strong class="lc iv">记录</strong>(行)组成，每个记录包含由<strong class="lc iv">分隔符</strong>(通常为<code class="fe mu mv mw mx b">,</code>)分隔的各种<strong class="lc iv">字段</strong>(列)。此外，第一行通常是为标题<strong class="lc iv">保留的，其语法与任何给定的行相同。</strong></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj my"><img src="../Images/7386f668f24ee4007efb93d8dff8f419.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EV5EVQuUOJPNbTlFq2PyqA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">包含财务信息的CSV文件示例。图片作者。</p></figure><p id="3a19" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这种形式的主要<strong class="lc iv">优势</strong>是:</p><ul class=""><li id="d3cd" class="mz na iu lc b ld le lg lh lj nb ln nc lr nd lv ne nf ng nh bi translated">纯文本，可读性强，易于理解。</li><li id="9c89" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated">不是专有的。</li><li id="13a6" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated">大小没有限制(只有可用的存储空间)。</li></ul><p id="2298" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">相反，也有一些<strong class="lc iv">限制</strong>:</p><ul class=""><li id="0b70" class="mz na iu lc b ld le lg lh lj nb ln nc lr nd lv ne nf ng nh bi translated">没有标准。然而，RFC 4180非常接近。</li><li id="7ca7" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated">这些文件只能按顺序处理。</li><li id="5e47" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated">文本字段通常要求<em class="nn">转义</em>特殊字符，如换行符或逗号，以防止干扰解析。因此，文本字段通常用引号括起来。</li><li id="77e2" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated">在某些国家，逗号(<code class="fe mu mv mw mx b">,</code>)起到小数点的作用(如<code class="fe mu mv mw mx b">3,141592</code>)。这种一致性通常需要选择完全不同的分隔符，比如分号(<code class="fe mu mv mw mx b">;</code>)、竖线(<code class="fe mu mv mw mx b">|</code>)或制表符。</li><li id="b954" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated">CSV文件没有明确说明字符编码，所以在读写它们的时候必须小心。</li><li id="438b" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated">此格式不支持元数据。例如，您应该预先知道字段类型或自动检测它们。除非打开文件并进行检查，否则无法确定文件头是否存在。</li></ul><p id="8c56" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">抛开这些障碍，CSV文件非常受欢迎。根据具体情况，它们可能会变得太大而无法在有限的硬件上有效处理。如果您曾经遇到过这个问题，不要担心:在Python中获取样本相对简单。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="no np l"/></div></figure><p id="8959" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">上面的代码加载大约10%的CSV文件内容，随机选择要读取的行。这种方法足以保持样本的统计特性。请注意，这种方法更可取，因为<strong class="lc iv">在您阅读</strong>时进行采样，而不是将整个文件加载到内存中(这可能不可行)然后再选取样本。</p><p id="66b3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">它调用包<strong class="lc iv">熊猫</strong>中的<code class="fe mu mv mw mx b">read_csv(...)</code>函数。具体来说，它将一个callable传递给参数<code class="fe mu mv mw mx b">skiprows</code>，该参数根据0和1之间的均匀分布的随机变量动态地决定要处理哪些行。因此，为了保留大约10%的内容，必须丢弃每一个结果大于0.1的行。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nq"><img src="../Images/57166d40e33a67f53f6ae0886f37f43b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3XkHyhKAUVRdZsMLyVL4Eg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">随机样本。图片作者。</p></figure><h2 id="4c00" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">随机性和可重复样本</h2><p id="0b7b" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">那<code class="fe mu mv mw mx b">seed(...)</code>呢？抽样本质上是随机的，所以你每次做都会得到不同的结果。在某些情况下，您可能需要选择是可重复的，因此无论您采样多少次或由谁采样，结果都保持不变。在这些情况下，修复随机数生成器的种子是明智的。你可能已经注意到，在互联网上，42是随机种子的一个普遍选择:这个解释是为了纪念道格拉斯·亚当斯的名著《银河系漫游指南》。</p><h2 id="5033" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">采样数据库表</h2><p id="bdcc" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated"><strong class="lc iv">关系数据库</strong>(与非关系数据库相对)是以表格形式存储和组织数据的软件包。<strong class="lc iv">数据库表</strong>由记录和列组成。它们通常通过<strong class="lc iv">主键/外键</strong>关系链接在一起，以减少冗余并提高完整性。这种设计技术被称为<strong class="lc iv">规范化</strong>。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nr"><img src="../Images/494526cc2ffe8ff699f9eba16eacc148.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sqXL30wj-yWrUCagwgnPWw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">关系数据库中两个表的示例。图片作者。</p></figure><p id="dfed" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">维护数据库的原因之一是能够查询表中特定的可用数据子集。为此，大多数供应商支持一种叫做<em class="nn">结构化查询语言</em>的标准语言，简称为<strong class="lc iv"> SQL </strong>。</p><p id="d3c0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">识别哪些列最有可能被查询并在其上建立索引是很好的做法。<strong class="lc iv">数据库索引</strong>是一种内部数据结构，它以消耗额外的存储空间为代价来加速查询。像书籍索引一样，它允许快速定位表中的数据，而不需要完全从上到下阅读。</p><p id="d748" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">编写高效的查询在数据科学中至关重要。最后，我们通常需要将数据排列在一个大表中来训练和测试模型。有时数据本身已经非规范化，这降低了查询的复杂性，因为不需要将表连接在一起。在其他不太有利的情况下，我们需要编写查询来组合所有相关的表，并适当地返回所需的数据。虽然反规范化提高了性能，但它也是以更高的存储要求为代价的。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nr"><img src="../Images/77cbb83f3f353bf48aa0e4cfac0ecf18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VSmfPCVJ7YdOaP9-cjqu_g.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">规范化与非规范化数据。图片作者。</p></figure><p id="ca76" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">回到我们的主题，从一个大的<strong class="lc iv">数据库表</strong>甚至从一个长的<strong class="lc iv">查询结果</strong>中检索一个样本是很容易的。一些SQL特性是特定于供应商的，因此下面的例子是为两个最著名的开源数据库编写的:<strong class="lc iv"> PostgreSQL </strong>和<strong class="lc iv"> MariaDB </strong> (mySQL)。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="no np l"/></div></figure><p id="7e39" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这三个示例检索了10%的样本。这个想法与CSV文件非常相似。对于结果中的每条记录，我们以0到1之间的概率形式计算一个随机数。如果这样的概率低于某个阈值，则记录被处理。否则，它将被丢弃。</p><p id="2c7d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">或者，您可以使用下面的代码来检索一个具有<strong class="lc iv">特定大小</strong>(例如，100行)的样本。可惜比较慢。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="no np l"/></div></figure><h2 id="f1fa" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">Python和SQL协同工作</h2><p id="e3b7" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">下面的代码显示了一个完整的示例:</p><ol class=""><li id="e0bf" class="mz na iu lc b ld le lg lh lj nb ln nc lr nd lv ns nf ng nh bi translated">建立与postgreSQL数据库的连接。</li><li id="5ef0" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ns nf ng nh bi translated">执行SQL并随机选择大约10%的结果行。</li><li id="9722" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ns nf ng nh bi translated">将结果存储在熊猫<code class="fe mu mv mw mx b">DataFrame</code>中。</li></ol><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="no np l"/></div></figure><h2 id="f1a0" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">结论</h2><p id="15ba" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">在任何分析的早期阶段采集样本，都有可能快速发现数据中的一般趋势和模式。这将指导后续的决策，例如实现哪些模型。</p><p id="5d08" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">样本应该有多大？有很多因素需要考虑，从统计意义到记忆限制。它应该足够小，可以放入你的计算机的内存中，并且易于管理，所以初步的结果不会花太多时间。但有一个问题:如果太微弱，一个小样本可能会错过你试图检测的效果。</p><p id="a530" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">希望这篇文章对你有价值。编码快乐！</p></div><div class="ab cl nt nu hy nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="in io ip iq ir"><h2 id="8a75" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">参考</h2><ul class=""><li id="6b0f" class="mz na iu lc b ld mp lg mq lj oa ln ob lr oc lv ne nf ng nh bi translated"><a class="ae kz" href="https://en.wikipedia.org/wiki/Comma-separated_values" rel="noopener ugc nofollow" target="_blank">逗号分隔值</a>。</li><li id="cee0" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated"><a class="ae kz" href="https://datatracker.ietf.org/doc/html/rfc4180" rel="noopener ugc nofollow" target="_blank"> RFC 4180 </a>。</li><li id="21f5" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated">熊猫包:<a class="ae kz" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html" rel="noopener ugc nofollow" target="_blank"> read_csv() </a>。</li><li id="fa4c" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated">随机包:<a class="ae kz" href="https://docs.python.org/3/library/random.html#random.random" rel="noopener ugc nofollow" target="_blank"> random() </a>，<a class="ae kz" href="https://docs.python.org/3/library/random.html#random.seed" rel="noopener ugc nofollow" target="_blank"> seed() </a>。</li><li id="e361" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated">《银河系漫游指南》(道格拉斯·亚当斯，1979)。</li><li id="efb9" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated"><a class="ae kz" href="https://en.wikipedia.org/wiki/SQL" rel="noopener ugc nofollow" target="_blank">结构化查询语言(SQL) </a>。</li><li id="96c4" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated"><a class="ae kz" href="https://en.wikipedia.org/wiki/Database_index" rel="noopener ugc nofollow" target="_blank">数据库索引</a>。</li><li id="0ba2" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated"><a class="ae kz" href="https://en.wikipedia.org/wiki/Database_normalization" rel="noopener ugc nofollow" target="_blank">数据库规范化</a>。</li><li id="76af" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated"><a class="ae kz" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a> : <a class="ae kz" href="https://www.postgresql.org/docs/14/sql-select.html" rel="noopener ugc nofollow" target="_blank">选择表样本</a>，<a class="ae kz" href="https://www.postgresql.org/docs/current/functions-math.html" rel="noopener ugc nofollow" target="_blank"> random() </a>。</li><li id="5c96" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated"><a class="ae kz" href="https://mariadb.org/" rel="noopener ugc nofollow" target="_blank"> MariaDB </a> : <a class="ae kz" href="https://mariadb.com/kb/en/rand/" rel="noopener ugc nofollow" target="_blank"> rand() </a>。</li><li id="c273" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated"><a class="ae kz" href="https://mariadb.com/kb/en/data-sampling-techniques-for-efficiently-finding-a-random-row/" rel="noopener ugc nofollow" target="_blank">从表中获取随机行</a>(高级)。</li></ul></div></div>    
</body>
</html>