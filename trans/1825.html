<html>
<head>
<title>Time Series Modeling with Orbit 101</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用轨道101进行时间序列建模</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-modeling-with-orbit-101-f6a262c1eaf6#2022-04-28">https://towardsdatascience.com/time-series-modeling-with-orbit-101-f6a262c1eaf6#2022-04-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="189b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">轨道入门教程(面向对象<strong class="ak"> - </strong> O <strong class="ak"> r </strong>面向<strong class="ak">B</strong>ayes<strong class="ak">I</strong>an<strong class="ak">T</strong>ime序列预测)</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5072c9f7f16ab7a3a23fcc6c4141e73a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mEHUROmF2WuUTe6bcMI5eg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自unsplash.com<a class="ae ky" href="https://unsplash.com/photos/6EnTPvPPL6I" rel="noopener ugc nofollow" target="_blank">艾萨克·史密斯</a></p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="26e6" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">目录</h1><ul class=""><li id="7eda" class="ly lz it ma b mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated"><strong class="ma iu">什么是轨道？</strong></li><li id="4921" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated"><strong class="ma iu">有哪些用例？</strong></li><li id="d77d" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated"><strong class="ma iu">弄脏你的手！</strong> <br/> -轨道模型的区别(DLT vs LGT) <br/> -数据<br/> - EDA <br/> -用轨道建立模型<br/> -更多关于回溯测试<br/> -进入未知——预测未来</li><li id="3d23" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated"><strong class="ma iu">数据来源</strong></li><li id="89ef" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated"><strong class="ma iu">参考文献</strong></li></ul><p id="36ef" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">特别感谢Orbit的首席开发者和建筑师Edwin Ng回顾了这个故事并提供了宝贵的建议。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="d266" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">什么是轨道？</h1><p id="4d8a" class="pw-post-body-paragraph mv mw it ma b mb mc ju my md me jx na mf nm nc nd mh nn nf ng mj no ni nj ml im bi translated"><a class="ae ky" href="https://github.com/uber/orbit" rel="noopener ugc nofollow" target="_blank">轨道</a>是面向对象<strong class="ma iu">对象</strong>对象<strong class="ma iu">对象</strong>对象<strong class="ma iu">对象</strong>对象<strong class="ma iu">对象</strong>对象<strong class="ma iu">对象</strong>对象<strong class="ma iu">对象</strong>对象<strong class="ma iu">对象</strong>对象对象对象对象对象<strong class="ma iu">对象<strong class="ma iu">对象</strong>对象<strong class="ma iu">对象【时间】对象</strong>对象【】对象</strong>对象【时间】对象它是一个开源的python包，具有面向对象的设计，使用结构化贝叶斯时间序列模型来产生时间序列推理和预测。在后端，Orbit利用概率编程语言(PPL)如<a class="ae ky" href="https://mc-stan.org/" rel="noopener ugc nofollow" target="_blank"> Stan </a>和<a class="ae ky" href="https://pyro.ai/" rel="noopener ugc nofollow" target="_blank"> Pyro </a>进行后验近似。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/c2cd9627639987cdbbe03fd4980e9e4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l-B0WH7rHwagnTNj0OtF9g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Orbit Github首页(作者截图)</p></figure><p id="1ad4" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">与具有类似目的的其他包/接口(如Prophet by Meta、pyro、pymc3等)相比，Orbit更容易实现，使用更灵活，功能更多，同时还能产生准确的估计。Orbit提供了一个端到端的建模解决方案，包括EDA功能、多种类型的模型、各种后验估计方法(MAP、MCMC、SVI)、基于核的时变回归、高级特征选择方法、回溯测试功能、模型诊断和验证功能以及可视化、Orbit主题绘图风格和调色板，并且它正在扩展。</p><p id="2261" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">此外，在优步内部数据和M4 M3的竞争数据上，Orbit都优于流行的时间序列模型，如<a class="ae ky" href="https://en.wikipedia.org/wiki/Autoregressive_integrated_moving_average" rel="noopener ugc nofollow" target="_blank">萨里玛</a>和<a class="ae ky" href="https://facebook.github.io/prophet/" rel="noopener ugc nofollow" target="_blank">先知</a>。(关于所用模型、测试指标和数据的更多细节可以在这篇<a class="ae ky" href="https://arxiv.org/pdf/2004.08492.pdf" rel="noopener ugc nofollow" target="_blank">文章</a>中找到。)这是一个高性能的软件包，将严格的统计方法和具有挑战性的业务问题联系起来。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="bdb8" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">有哪些用例？</h1><p id="9b7f" class="pw-post-body-paragraph mv mw it ma b mb mc ju my md me jx na mf nm nc nd mh nn nf ng mj no ni nj ml im bi translated">Orbit由优步营销数据科学团队开发，是优步营销组合模型背后的核心引擎。在优步，它主要用于对推动业务KPI的营销渠道的增量和效率进行公正的测量。Orbit还可以帮助预测未来的KPI，这是规划未来营销预算和优化不同地区和渠道的预算分配的重要组成部分。借助贝叶斯模型和动态系数，Orbit可以优先吸收不同时间的实验结果，将提升测试与真实世界的数据相结合，并提供数据驱动的见解，帮助提高优步营销活动的投资回报率。如果你有兴趣了解更多关于营销组合模型(MMM)的知识，请查看我的另一个故事<a class="ae ky" rel="noopener" target="_blank" href="/marketing-mix-modeling-101-d0e24306277d">这里</a>是关于MMM的非技术性介绍。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/271cfa62da288fff8b625f684808e1e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OC3FdIZgGVwRHVnY8Y2Utw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">示例MMM结果—营销支出和贡献(图片由作者提供)</p></figure><p id="85be" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">优步的其他使用案例包括支付欺诈检测和基础设施容量规划。优步的风险团队利用Orbit从早期检测和预防支付欺诈。优步的容量规划团队已经利用Orbit为工程团队规划了未来几年的计算和存储容量。</p><p id="8095" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">在外部，Orbit团队还与包括Meta、Spotify、Pinterest在内的企业合作，解决Orbit具有挑战性的预测问题。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="0c88" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">把手弄脏！</h1><p id="d48d" class="pw-post-body-paragraph mv mw it ma b mb mc ju my md me jx na mf nm nc nd mh nn nf ng mj no ni nj ml im bi translated">在深入研究代码之前，让我们看一下Orbit支持的两个主要模型:阻尼局部趋势模型(DLT)和局部全球趋势模型(LGT)。两种模型都使用指数平滑法，并将时间序列分解成不同的部分:趋势、季节性、回归和误差项。这两个模型之间的主要区别是，DLT使用阻尼趋势因子，而不是LGT的混合趋势因子，DLT引入了回归分量，这在外生回归变量已知时很有帮助。哪种模型结构在预测中表现更好取决于数据和使用情况。虽然数学不是本文的重点，但以下函数可能有助于您理解。更多细节可以在这篇<a class="ae ky" href="https://arxiv.org/pdf/2004.08492.pdf" rel="noopener ugc nofollow" target="_blank">文章</a>中找到。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/6e7c0c93e08beba5c14bc938495d3fe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dOMFxSmFA4yLTKrpev9VrQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">轨道模型的数学(表格由作者使用优步营销数据科学团队发表的论文中的信息制作)</p></figure><p id="8edd" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">现在让我们真的把手弄脏吧！在本教程中，我将只使用DLT。本文中的数据和分析仅用于演示如何使用Orbit，我并不追求学术严谨性或帮助任何数据驱动的决策。</p><h2 id="280e" class="ns lh it bd li nt nu dn lm nv nw dp lq mf nx ny ls mh nz oa lu mj ob oc lw od bi translated">1.数据</h2><p id="c215" class="pw-post-body-paragraph mv mw it ma b mb mc ju my md me jx na mf nm nc nd mh nn nf ng mj no ni nj ml im bi translated">经济与我们所做的一切都息息相关，所以我想预测一下未来几年美国的经济会是什么样子。国内生产总值被认为是经济整体表现的良好指标。国内生产总值也是一个周期性和流行的指标，很容易从公共数据来源获得，是时间序列分析的良好候选对象。我将尝试使用Orbit来预测美国的实际GDP和其他一些被认为是经济指标的特征，包括CPI(消费者价格指数)、失业率、短期利率(3个月到期的国债的市场收益率)和长期利率(10年到期的国债的市场收益率)。在数据集中，所有变量都汇总到季度级别，并进行对数转换。我从1982年到2021年总共有160个数据点。</p><p id="5eba" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated"><strong class="ma iu"> <em class="oe">数据来源</em> </strong>:本文中我使用的所有数据均来自经济数据聚合平台<a class="ae ky" href="https://fred.stlouisfed.org/" rel="noopener ugc nofollow" target="_blank"> FRED </a>。请看这个故事结尾的详细数据来源和引用。</p><h2 id="dcba" class="ns lh it bd li nt nu dn lm nv nw dp lq mf nx ny ls mh nz oa lu mj ob oc lw od bi translated">2.电子设计自动化(Electronic Design Automation)</h2><p id="ceb3" class="pw-post-body-paragraph mv mw it ma b mb mc ju my md me jx na mf nm nc nd mh nn nf ng mj no ni nj ml im bi translated">首先，让我们导入分析所需的所有模块和函数。</p><p id="013b" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">我从orbit导入了一些方便的绘图功能来做ed a、模型诊断和Orbit自己的主题风格和调色板。我还导入了DLT，我将使用的模型，以及一些用于回溯测试和计算评估所需度量的辅助函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">导入模块的要点(作者的要点)</p></figure><p id="f40c" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">我们来看看数据。我的目标是真实GDP <code class="fe oh oi oj ok b">real_gdp_log</code>的日志版本，特征是下面变量的日志版本。</p><pre class="kj kk kl km gt ol ok om on aw oo bi"><span id="d961" class="ns lh it ok b gy op oq l or os"># Target<br/># ‘real_gdp’: real GDP</span><span id="38a0" class="ns lh it ok b gy ot oq l or os"># Features<br/># ‘dgs_3m’: short term interest rate <br/># ‘gs_10y’: long term interest rate<br/># ‘unemp_rate’: unemployment rate<br/># ‘cpi’: Consumer Price Index</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/6f251101684345e906ee0edc63a39a95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pUfA6VUui9f5p0FKVOhugg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我的数据一览(按作者排列的表格)</p></figure><p id="6613" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">Orbit有一些方便的EDA功能来帮助可视化数据和检查数据模式。<code class="fe oh oi oj ok b">eda_plot</code>模块中的<code class="fe oh oi oj ok b">warp_plot_ts</code>可以方便地在一行代码中绘制所有变量的时间序列图。</p><pre class="kj kk kl km gt ol ok om on aw oo bi"><span id="46b2" class="ns lh it ok b gy op oq l or os">eda_plot.wrap_plot_ts(df, <br/>                      date_col = 'quarter', <br/>                      var_list=['quarter', 'real_gdp', <br/>                                'cpi', 'dgs_3m', 'gs_10y', <br/>                                'unemp_rate']<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/5be08759ba1358125444fc36237c2ed3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6jtZJ-EII34BRw3HTdTstQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">变量的数据模式(按作者分类的图表)</p></figure><p id="51d5" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">另一个有用的EDA图表在同一图表中以不同的比例绘制了两个变量，这使我们能够直观地显示两个变量之间的关系，即使变量的值处于非常不同的比例，例如GDP(非常大的数字)与失业率(范围为0-1)。</p><pre class="kj kk kl km gt ol ok om on aw oo bi"><span id="19d5" class="ns lh it ok b gy op oq l or os">for i in ['cpi_log','dgs_3m_log','gs_10m_log','unemp_rate_log']:<br/>    eda_plot.dual_axis_ts_plot(df=df, <br/>                               var1='real_gdp_log', var2=i, <br/>                               fig_width=10, fig_height=3, <br/>                               date_col='quarter')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/3269b608f0df6e73a55f860e316c2198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OqsisU1Bpjw7nWLE_aD2vg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">功能与目标(按作者分类的图表)</p></figure><p id="04e3" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">从图表中我们可以看到，该目标有明显的上升趋势，在20世纪90年代初、互联网泡沫破裂、2008年大衰退和2020年COVID爆发前后有一些较大的下降。所有其他变量也有一些明显的趋势，并根据简单的相关性分析与目标高度相关。还有其他类型的EDA可以用于时间序列分析。为了这个故事的目的，我不会深究它们。</p><h2 id="b9ee" class="ns lh it bd li nt nu dn lm nv nw dp lq mf nx ny ls mh nz oa lu mj ob oc lw od bi translated">3.用轨道建立模型</h2><p id="249d" class="pw-post-body-paragraph mv mw it ma b mb mc ju my md me jx na mf nm nc nd mh nn nf ng mj no ni nj ml im bi translated">我将我的数据分为两部分:训练和测试，测试规模为16(我的总数据集的10%，因为它是季度数据，所以是4年)，并实例化了一个DLT模型。主要有两种估计量可供选择:<code class="fe oh oi oj ok b">‘stan-mcmc’</code>(马尔可夫链蒙特卡罗)和<code class="fe oh oi oj ok b">‘stan-map’</code>(最大后验概率)，以及四种global_trend_option to可供选择:<code class="fe oh oi oj ok b">‘linear’, ‘loglinear’, ‘flat’, ‘logistic’</code>。在对所有8个组合进行回溯测试后，趋势为<code class="fe oh oi oj ok b">‘linear’</code>的<code class="fe oh oi oj ok b">‘stan-mcmc’</code>在该数据集上表现最佳。<code class="fe oh oi oj ok b">Seasonality</code>设为4是因为我认为应该有年度季节性，而且我有季度数据。</p><p id="2665" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">使用<code class="fe oh oi oj ok b">regressor_col</code>参数，我指定了我想要添加到模型中的所有回归量，并使用<code class="fe oh oi oj ok b">regressor_sign</code>参数以与<code class="fe oh oi oj ok b">regressor_col</code>相同的顺序指定了预期符号。我不确定CPI是否应该正面影响GDP，因为通货膨胀可能会提振经济，所以我将其设置为<code class="fe oh oi oj ok b">‘=’</code>，这意味着模型和数据将决定后续迹象。我设置了<code class="fe oh oi oj ok b">seed</code>以便结果是可重复的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">实例化、拟合和预测DLT模型(作者要点)</p></figure><p id="b27a" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">拟合和预测功能与sklearn和其他流行的统计软件包非常相似。我将我的test_df传递到预测中，并将<code class="fe oh oi oj ok b">decompose</code>指定为<code class="fe oh oi oj ok b">True</code>，这样在预测结果中，我会将趋势、季节性和回归量组件与预测结果一起分解。</p><p id="0f38" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">正如您在下面的预测数据框中所看到的，对于每个组件，我们也获得了平均值、95%和5%的百分比。与许多其他软件包不同，Orbit还提供完整的参数分布。要获得参数分布，请对训练好的模型对象使用<code class="fe oh oi oj ok b">.get_posterior_samples()</code>。(<code class="fe oh oi oj ok b">dlt_model.get_posterior_samples()</code>)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/21d684c6275e3efe9d3da6af933134d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CzO5kbPd1MwMzsp0ydYa5A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">predicted_df的前5行(按作者排列的表格)</p></figure><p id="96c8" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">我用<code class="fe oh oi oj ok b">.get_regressor_coefs()</code>检查了回归变量的系数。看起来这些迹象是意料之中的，失业率正在发挥更大的作用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/43f48d7fb9ffa068a7dc1ff3e62cf777.png" data-original-src="https://miro.medium.com/v2/resize:fit:574/format:webp/1*Yif3HKgkLoHt6A2bNcFAQw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">特征系数(作者列表)</p></figure><p id="a839" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">我喜欢的两个方便的模型结果绘图函数是用于绘制分解序列的<code class="fe oh oi oj ok b">plot_predicted_components()</code>和用于检查预测与实际的<code class="fe oh oi oj ok b">plot_predicted_data()</code>。</p><p id="4bff" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated"><code class="fe oh oi oj ok b">plot_predicted_components(predicted_df, ‘quarter’)</code>产生以下分解系列。我们可以看到一个上升趋势，第三季度的年度季节性高于其他季度，以及covid导致的回归下降。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/8745c6bf35224284d2b55ce2229f35b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eIoZ3a52PGbd38w7LRpc1A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">分解趋势、季节性和回归(按作者绘制)</p></figure><p id="7d31" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">在下面的函数中，我指定了train_df来提供训练期间的实际目标，predicted_df用于预测目标，test_actual用于测试期间的实际目标，以及target列和date列。基于这个回溯测试样本，我的预测看起来很棒，MAPE小于1%(平均绝对百分比误差)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/bb44c4bddaf26145d8d5f58d900e95bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*aDCPd_ippzAf9Sm_lrZ2lw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">MAPE公式(作者图片)</p></figure><pre class="kj kk kl km gt ol ok om on aw oo bi"><span id="669b" class="ns lh it ok b gy op oq l or os">plot_predicted_data(training_actual_df=train_df, <br/>                    predicted_df=predicted_df,<br/>                    date_col='quarter', <br/>                    actual_col='real_gdp_log',<br/>                    test_actual_df=test_df)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/847de8e8a473821ba5c501b06823e7a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GpNguz98W4mo8uIHuakkUQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">培训和测试期间的预测与实际(由作者绘制)</p></figure><p id="5300" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated"><strong class="ma iu">具有信息先验的回归</strong></p><p id="cdf6" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">Orbit还支持贝叶斯时间序列建模，并允许用户使用外部信息作为回归变量的先验。例如，用户可以使用基于以前的研究、实验结果、类似产品的信息或以前模型的结果的行业基准。当与观测数据一起工作时，先验非常强大，尤其是当数据稀疏或质量低时。我们可以设置sigma来控制从先验到后验的变化水平。这样，模型可以利用以前从观测数据中获得的知识和信息，并且模型结果将保持在合理的范围内。</p><p id="43a2" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">使用regressor_beta_prior和regressor_sigma_prior参数，可以很容易地将先前的beta和sigma传递给DLT。两个参数都接受一个长度和顺序与regressor_col和regressor_sign相同的数值列表，如下例所示。我计划用一个模拟数据集写另一个关于未来使用轨道先验的故事。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用先验知识实例化、拟合和预测DLT模型(作者要点)</p></figure><p id="c425" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated"><strong class="ma iu"> 4。关于回溯测试的更多信息</strong></p><p id="da9d" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">如果您想要多个回测样本或使用回测来调整超参数，来自Orbit的<code class="fe oh oi oj ok b">BackTester</code>非常有用。</p><p id="9293" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">为了创建一个<code class="fe oh oi oj ok b">BackTester</code>，我需要之前实例化的模型对象和完整的数据框作为输入。<code class="fe oh oi oj ok b">min_train_len</code>定义了训练时间段的最小长度。<code class="fe oh oi oj ok b">incremental_len</code>定义每个回溯测试样本的增量步骤。<code class="fe oh oi oj ok b">forecast_len</code>定义回溯测试的预测长度。<br/> <code class="fe oh oi oj ok b">window_type</code>有<code class="fe oh oi oj ok b">‘expanding’</code>和<code class="fe oh oi oj ok b">‘rolling’</code>两个选项。<code class="fe oh oi oj ok b">'expanding’</code>扩展窗口并为每个训练样本增加更多的训练时间，<code class="fe oh oi oj ok b">‘rolling’</code>创建滑动窗口，训练样本保持相同大小。</p><pre class="kj kk kl km gt ol ok om on aw oo bi"><span id="428c" class="ns lh it ok b gy op oq l or os"># create a backtester based on the model we instantiated earlier <br/>backtest = BackTester(model = dlt_model, <br/>                      df = df, <br/>                      min_train_len = 100, <br/>                      incremental_len = 12, <br/>                      forecast_len=12, <br/>                      window_type = 'expanding')</span><span id="3ff2" class="ns lh it ok b gy ot oq l or os">ts_splitter = backtest.get_splitter()<br/>_ = ts_splitter.plot()</span></pre><p id="6c24" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">在我的例子中，第一个训练样本是我的数据中的前100个数据点，接下来的12个数据点是我的第一个回溯测试样本。然后，窗口将扩展12个数据点，这使我的第二个训练样本成为数据中的前112个数据点，然后接下来的12个数据点将成为我的第二个回溯测试样本，依此类推。对于我的数据长度，我有5个回测样本。<code class="fe oh oi oj ok b">.get_splitter()</code>功能有助于可视化训练和回测样本分割。在下图中，蓝色表示训练样本，橙色表示测试样本。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/dbe380c8b4fd57c5e2152bc16e9b98db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KuliHsosxlKzWf1xBLw1ug.png"/></div></div></figure><p id="2d5b" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">在我们拆分数据之后，我们可以使用<code class="fe oh oi oj ok b">.fit_predict()</code>来拟合和预测，并使用<code class="fe oh oi oj ok b">.score()</code>来检查跨回溯测试样本平均的不同评估指标。对于不同的回测样本，该模型也表现良好。</p><pre class="kj kk kl km gt ol ok om on aw oo bi"><span id="5f00" class="ns lh it ok b gy op oq l or os">backtest.fit_predict()<br/>bt_predicted_df = backtest.get_predicted_df()<br/>backtest.score()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/5b5c7ba01649e4bab785f16f46d32cec.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*vtc1BWt1vBme1EVt6WsMTA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">回溯测试平均分数(按作者列出的表格)</p></figure><p id="e982" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">另一个有趣的可视化多重回溯测试性能的功能是gif maker。(这需要安装<code class="fe oh oi oj ok b">imageio</code>包。)它生成一个很酷的gif图，依次展示所有样本的性能。<br/>看起来在某些时间段，我的模型确实倾向于过度预测。作为一个潜在的下一步，我可以做一些其他的测试，如其他趋势选项，但现在我对整体结果还满意。</p><pre class="kj kk kl km gt ol ok om on aw oo bi"><span id="c8da" class="ns lh it ok b gy op oq l or os">plot_bt_predictions2(bt_pred_df=bt_predicted_df, metrics=wmape, <br/>                     figsize=(16, 8), is_visible=False,<br/>                     fig_dir='result/', export_gif=True,<br/>                     markersize=80, imageio_args={'fps': 2.5})</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/af938baab32487bc7a6c45481d9c1b5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*vdrJc_m4G1jdR_YEkACcrQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用不同回测样本的预测(图片由作者提供)</p></figure><p id="7348" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">您可以使用<code class="fe oh oi oj ok b">BackTester</code>和轨道网格搜索功能<code class="fe oh oi oj ok b">.grid_search_orbit()</code>来调整超参数。我对默认设置的模型很满意，我不想让这篇文章太冗长，所以我没有包括这一部分。这里可以找到一个<a class="ae ky" href="https://orbit-ml.readthedocs.io/en/latest/tutorials/backtest.html" rel="noopener ugc nofollow" target="_blank">的例子。</a></p><h2 id="9f38" class="ns lh it bd li nt nu dn lm nv nw dp lq mf nx ny ls mh nz oa lu mj ob oc lw od bi translated">5.走向未知——预测未来</h2><p id="4318" class="pw-post-body-paragraph mv mw it ma b mb mc ju my md me jx na mf nm nc nd mh nn nf ng mj no ni nj ml im bi translated">最后，我用自己有限的知识和乐观的经济前景为这些特征创建了一个未来输入数据框架。我假设CPI会略有上升，因为我们一直面临着高通胀，失业率会相当平稳，因为COVID后，人们应该回到工作岗位，利率将在未来4年内增长更高。</p><p id="01f0" class="pw-post-body-paragraph mv mw it ma b mb mx ju my md mz jx na mf nb nc nd mh ne nf ng mj nh ni nj ml im bi translated">使用相同的DLT函数，但拟合全部历史数据，并使用我编造的forecast_input_df进行预测，对未来4年美国实际GDP的预测看起来很有希望。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">实例化、拟合和预测DLT模型(作者要点)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/e53081da7a6f59426e398b9976b6cd1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mrEIBQ6iBOrwOF9SwNeXiw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">预测(由作者绘制)</p></figure><h1 id="4410" class="lg lh it bd li lj pg ll lm ln ph lp lq jz pi ka ls kc pj kd lu kf pk kg lw lx bi translated">谢谢你，并关注我更多！</h1><p id="4af9" class="pw-post-body-paragraph mv mw it ma b mb mc ju my md me jx na mf nm nc nd mh nn nf ng mj no ni nj ml im bi translated">感谢您阅读到目前为止，并了解轨道。我计划为Orbit编写更多教程，深入演示其他用例及功能。敬请关注，关注我，并订阅电子邮件以获取更多关于数据科学和其他有趣主题的故事！</p><h1 id="dc9b" class="lg lh it bd li lj pg ll lm ln ph lp lq jz pi ka ls kc pj kd lu kf pk kg lw lx bi translated">数据源</h1><ul class=""><li id="48ee" class="ly lz it ma b mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated"><strong class="ma iu">实际GDP </strong>:美国经济分析局，实际国内生产总值【GDPC1】，检索自圣路易斯美联储银行弗雷德；https://fred.stlouisfed.org/series/GDPC1,2022年4月26日。</li><li id="4321" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated"><strong class="ma iu"> CPI </strong>:美国劳工统计局，所有城市消费者的消费价格指数:美国城市平均值中的所有项目【CPIAUCSL】，检索自圣路易斯美联储银行FRED<a class="ae ky" href="https://fred.stlouisfed.org/series/CPIAUCSL," rel="noopener ugc nofollow" target="_blank">https://fred.stlouisfed.org/series/CPIAUCSL,</a>2022年4月26日。</li><li id="cb4b" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated"><strong class="ma iu">3个月到期的国债市场收益率</strong>:美联储系统(美国)理事会，3个月固定到期的美国国债市场收益率【DGS3MO】，从圣路易斯美联储银行FRED处检索；https://fred.stlouisfed.org/series/DGS3MO, 2022年4月26日</li><li id="14d7" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated"><strong class="ma iu">10年期国债的市场收益率:</strong>美联储系统(美国)理事会，10年期恒定到期美国国债的市场收益率[DGS10]，从圣路易斯美联储银行FRED处检索；https://fred.stlouisfed.org/series/DGS10,2022年4月26日<a class="ae ky" href="https://fred.stlouisfed.org/series/DGS10," rel="noopener ugc nofollow" target="_blank">。</a></li><li id="4c56" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated"><strong class="ma iu">失业率:</strong>美国劳工统计局，失业率【UNRATE】，检索自圣路易斯美联储银行弗雷德；https://fred.stlouisfed.org/series/UNRATE,2022年4月26日。</li></ul><h1 id="4085" class="lg lh it bd li lj pg ll lm ln ph lp lq jz pi ka ls kc pj kd lu kf pk kg lw lx bi translated">参考</h1><p id="d4bd" class="pw-post-body-paragraph mv mw it ma b mb mc ju my md me jx na mf nm nc nd mh nn nf ng mj no ni nj ml im bi translated">[1]<a class="ae ky" href="https://arxiv.org/abs/2004.08492" rel="noopener ugc nofollow" target="_blank">Orbit:Orbit开发团队使用指数平滑法</a>进行概率预测<br/>【2】Orbit<a class="ae ky" href="https://github.com/uber/orbit" rel="noopener ugc nofollow" target="_blank">github</a><br/><a class="ae ky" href="https://eng.uber.com/orbit/" rel="noopener ugc nofollow" target="_blank">介绍Orbit，Orbit开发团队在优步工程博客<br/>【4】<a class="ae ky" href="https://arxiv.org/abs/2106.03322" rel="noopener ugc nofollow" target="_blank">上发布的用于时间序列推断和预测的开源包</a>Bayesian时变系数模型及其在营销组合建模中的应用</a>Orbit开发团队发布的<br/>【5】<a class="ae ky" href="https://orbit-ml.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">Orbit文档中心</a></p></div></div>    
</body>
</html>