<html>
<head>
<title>Data Contracts — From Zero To Hero</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据契约—从零到英雄</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-contracts-from-zero-to-hero-343717ac4d5e#2022-09-09">https://towardsdatascience.com/data-contracts-from-zero-to-hero-343717ac4d5e#2022-09-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c6fa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">数据契约的实用方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/a04503ed6d454ca64d862860076ad819.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*D1bUt5LrNWt0onftu7y2kw.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">书写数据契约——作者图像，稳定扩散生成。</p></figure><p id="158f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最近，社交媒体上围绕数据合同有很多噪音。一些数据从业者<a class="ae lq" href="https://www.youtube.com/watch?v=4BEpYAp3Qu4" rel="noopener ugc nofollow" target="_blank">分享了关于利弊的观点</a>，但主要是关于它是什么及其定义。虽然我认为数据契约是一个疯狂的话题，但我想分享我的经验和如何开始的实用技巧。数据契约是真实而有价值的东西，你现在就可以用比你想象的更少的努力开始利用它。但是我们为什么首先需要它们呢？</p><h1 id="2fdd" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">🔥数据契约有什么模糊之处？</h1><h2 id="e12b" class="mj ls it bd lt mk ml dn lx mm mn dp mb ld mo mp md lh mq mr mf ll ms mt mh mu bi translated">积极主动而不是被动</h2><p id="2245" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">如果你从事数据工作，你很可能会多次遇到这个问题:数据是错误的，而你不知道为什么。数据上游似乎有问题，但你的内部同事都不知道为什么，那么我们该怎么办？我们应该联系谁？</p><blockquote class="na nb nc"><p id="421c" class="ku kv nd kw b kx ky ju kz la lb jx lc ne le lf lg nf li lj lk ng lm ln lo lp im bi translated">我们怎么会在那里结束？</p></blockquote><p id="c75b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">随着数据不再是头等公民，数据团队大多开始在服务于其他初始目标的现有基础架构上进行分析。他们将根据现有的操作数据库“插入”他们的管道，将数据卸载到一个仓库，并处理其余的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/625db39fcf47a5ff76f0c45d6f620c0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IQlswhoRpCf7A3dNUluevQ.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="5c94" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">数据团队被困在锤子(他们无法控制的操作数据库)和大声疾呼其需求的业务之间。</p><p id="8685" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">他们可以在某种程度上变一些魔术，但是<a class="ae lq" href="https://en.wikipedia.org/wiki/Garbage_in,_garbage_out" rel="noopener ugc nofollow" target="_blank">垃圾进垃圾出</a>。上游的问题越多，对数据团队的挑战就越大。</p><p id="be3e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是数据契约可以发挥作用的地方。数据团队有一个明确的方法来询问他们需要什么，并提出一个更严格的过程来处理变更管理。</p><h1 id="4a14" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">📎我们如何实现这样的契约？</h1><h2 id="75bf" class="mj ls it bd lt mk ml dn lx mm mn dp mb ld mo mp md lh mq mr mf ll ms mt mh mu bi translated">如果我们能从头开始重新做每件事会怎么样？</h2><p id="6a5c" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">起初这似乎不现实，因为你很少有机会从绿地基础设施开始。然而，以今天的云技术，这并不那么遥不可及。</p><p id="c4fd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">事件驱动的架构有助于支持数据契约，原因有多种:</p><ul class=""><li id="eb7a" class="nm nn it kw b kx ky la lb ld no lh np ll nq lp nr ns nt nu bi translated">事件可以是强类型的，每个事件都可以与一个模式版本相关联。</li><li id="137e" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp nr ns nt nu bi translated">如果你使用一个无服务器的事件流，并且基础设施是自包含的(每个主题)，那么它是便宜的。</li><li id="e0ba" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp nr ns nt nu bi translated">事件平台(又名发布/订阅)为传统的下游数据消费(对象存储、数据仓库)提供了内置的连接器。</li></ul><p id="0339" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">像AWS Kinesis或Kafka(有像AWS MSK或Confluent这样的托管Kafka)这样的技术，云发布/订阅是让你开始的好选择。</p><p id="da74" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个想法是与后端创建一个全新的合同，并就(数据)消费者的最佳需求达成一致。</p><p id="2ee9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">后端人员通常有分析之外的事件驱动模式的用例。例如，微服务之间的通信。这里有两个选项:</p><ol class=""><li id="032f" class="nm nn it kw b kx ky la lb ld no lh np ll nq lp oa ns nt nu bi translated">对模式做出妥协，使其既适合数据分析又适合他们的用例</li><li id="9bb0" class="nm nn it kw b kx nv la nw ld nx lh ny ll nz lp oa ns nt nu bi translated">创建一个专门针对数据分析使用情形的活动</li></ol><p id="70a4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">争取1。避免在源头创建爆炸式的事件类型，但是由于涉及到更多的利益相关者，讨论变更可能会有点困难。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/8b2951b24b81daac9c02912afe98402c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ly_7kcyTi28cW6kdX22cJQ.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><h2 id="402b" class="mj ls it bd lt mk ml dn lx mm mn dp mb ld mo mp md lh mq mr mf ll ms mt mh mu bi translated">定义创建/修改合同的流程</h2><p id="19f7" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">像Kafka或AWS MSK这样的大多数事件平台都有自己的模式注册中心(在AWS中是AWS胶合注册中心)。对于创建的每个主题，您都需要注册一个模式。</p><p id="e89a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在数据生产者和数据消费者之间实现这样一个过程的简单方法是重用一个<strong class="kw iu"> git过程</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi ob"><img src="../Images/c3e23390e844ef418b351aabf8ccb088.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oObxlk3T4SXVqXfmYzQJNA.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="e6cc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所有模式创建/更改/删除都可以通过git pull请求来完成。有了主题的明确的所有权和消费者，您可以很快知道谁可以批准对模式的更改。CI/CD管道在合并时用相应的模式选择并部署变更。</p><p id="1ef7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这一过程的美妙之处在于<strong class="kw iu">它迫使讨论在做出任何改变之前发生</strong>。</p><h1 id="a0a2" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">🚀生产清单</h1><p id="7adb" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">当用事件总线实现数据契约时，这里有一些东西值得推荐。</p><h2 id="9125" class="mj ls it bd lt mk ml dn lx mm mn dp mb ld mo mp md lh mq mr mf ll ms mt mh mu bi translated">技巧1:请使用类型化模式</h2><p id="d679" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">维护JSON schema是一件痛苦的事情。太多自由了。类型化事件的通用标准是使用<a class="ae lq" href="https://avro.apache.org/" rel="noopener ugc nofollow" target="_blank"> Avro </a>。它受到所有模式注册中心的支持，并且与其他处理引擎(Flink、Spark等)有很多互操作性。)进行进一步改造。</p><h2 id="663b" class="mj ls it bd lt mk ml dn lx mm mn dp mb ld mo mp md lh mq mr mf ll ms mt mh mu bi translated">提示2:不要在筑巢领域疯狂</h2><p id="7408" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">因为我们通常以列格式分析数据，所以拥有太多嵌套的复杂字段对于模式演化来说是一个挑战，处理起来也很昂贵。如果您有许多嵌套字段，可以考虑将事件分成多个具有特定模式的事件。</p><h2 id="b2d9" class="mj ls it bd lt mk ml dn lx mm mn dp mb ld mo mp md lh mq mr mf ll ms mt mh mu bi translated">技巧3:但是你可以在嵌套字段上做一些妥协</h2><p id="f5ba" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">如果生产者不确定所有模式的定义(例如，他们依赖于第三方API)，您可以在定义中尽可能地深入，将其余的未知部分作为JSON字符串。展开/访问这样的字段会在计算上花费更多，但是它在数据生产者方面留下了更多的灵活性。</p><h2 id="0df9" class="mj ls it bd lt mk ml dn lx mm mn dp mb ld mo mp md lh mq mr mf ll ms mt mh mu bi translated">技巧4:在事件中设置额外的元数据字段。</h2><p id="aa99" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">类似于<code class="fe oc od oe of b">owner</code>、<code class="fe oc od oe of b">domain</code>、<code class="fe oc od oe of b">team_channel</code>，或者用特定的字段标识PII列将有助于以后明确所有权、血统和访问管理。</p><p id="d568" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Schemata 是一个很好的资源，可以用来使用模式事件建模或从中获得灵感。</p><h2 id="f1c7" class="mj ls it bd lt mk ml dn lx mm mn dp mb ld mo mp md lh mq mr mf ll ms mt mh mu bi translated">提示5:不要改变给定字段的数据类型。</h2><p id="e464" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">最好用新类型重命名字段。虽然我们可以在下游建立一个机制来检测模式版本，但是允许在没有重命名的情况下对字段进行类型更改总是会导致令人头疼的问题。如果你接受一个案子，你将不得不处理所有其他的。所以如果把一个<code class="fe oc od oe of b">int</code>改成一个<code class="fe oc od oe of b">string</code>不伤人；当你把一辆<code class="fe oc od oe of b">int</code>换成<code class="fe oc od oe of b">float</code>或者把一辆<code class="fe oc od oe of b">float</code>换成<code class="fe oc od oe of b">int</code>会发生什么？</p><h2 id="71d3" class="mj ls it bd lt mk ml dn lx mm mn dp mb ld mo mp md lh mq mr mf ll ms mt mh mu bi translated">技巧6:没有事件总线，您仍然可以实现数据契约</h2><p id="1d16" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">如果您在<code class="fe oc od oe of b">git</code>中为您的操作数据库保存了所有的DDL语句，您仍然可以实现上面的大部分内容。例如，在对数据库进行任何更改时，都会有一个git流程提醒需要批准的消费者。然而，这有点困难，因为当创建模式时，数据团队没有机会发言。</p><h1 id="efa2" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">🪃把所有权还给数据生产者</h1><p id="baca" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">数据契约只是将所有权还给数据生产者的一种趋势，而不是让数据团队承受我们扔给他们的任何数据。</p><p id="dee6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这很棒。它让下游的一切变得更容易，并且<strong class="kw iu">避免了产品和数据之间的孤岛</strong>。</p><p id="055a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最大的挑战是组织。数据团队必须<strong class="kw iu">跨越障碍，并与后端讨论新流程</strong>，这可能会令人害怕。强调当前的棘手问题并让人们了解数据的使用方式有助于推动讨论。</p><p id="5009" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于工具本身来说，可以使用事件平台<strong class="kw iu">发布/订阅服务</strong>、<strong class="kw iu">模式注册表、</strong>和<strong class="kw iu"> git </strong>为数据契约流程逐步进行设置。</p><p id="6c79" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在你的公司内找到一个合适的项目发起人，并从头到尾实现管道。没有必要进行大爆炸式迁移；从小事件开始，接下来延伸格局！</p><h2 id="52ce" class="mj ls it bd lt mk ml dn lx mm mn dp mb ld mo mp md lh mq mr mf ll ms mt mh mu bi translated">📚进一步阅读</h2><p id="e8d3" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated"><a class="ae lq" href="https://barrmoses.medium.com/implementing-data-contracts-7-key-learnings-d214a5947d5e" rel="noopener">实施数据契约:<a class="ae lq" href="https://www.linkedin.com/in/barrmoses/" rel="noopener ugc nofollow" target="_blank">巴尔·摩西</a>的7条关键经验</a></p><p id="dc70" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://dataproducts.substack.com/p/the-rise-of-data-contracts" rel="noopener ugc nofollow" target="_blank">数据合约的兴起</a>作者<a class="ae lq" href="https://www.linkedin.com/in/chad-sanderson/" rel="noopener ugc nofollow" target="_blank">查德·桑德森</a></p><h1 id="9fad" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">迈赫迪·瓦扎又名迈赫迪欧·🧢</h1><p id="8bb2" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">感谢阅读！🤗 🙌如果你喜欢这个，<strong class="kw iu">跟随我上</strong>🎥<a class="ae lq" href="https://www.youtube.com/channel/UCiZxJB0xWfPBE2omVZeWPpQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> Youtube </strong> </a>，<strong class="kw iu"> </strong>🔗<a class="ae lq" href="https://linkedin.com/in/mehd-io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> LinkedIn </strong> </a>了解更多数据/代码内容！</p><p id="074a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">支持我写作</strong> ✍️通过加盟传媒通过本<strong class="kw iu"> </strong> <a class="ae lq" href="https://mehdio.medium.com/membership" rel="noopener"> <strong class="kw iu">链接</strong> </a></p></div></div>    
</body>
</html>