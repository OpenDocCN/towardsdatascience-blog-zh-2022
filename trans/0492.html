<html>
<head>
<title>Switching from a Frequentist Approach to Bayesian for A/B Testing Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">A/B测试分析从频率主义方法到贝叶斯方法的转换</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/switching-from-a-frequentist-approach-to-bayesian-for-a-b-testing-analysis-b5b5eae0ce5e#2022-02-19">https://towardsdatascience.com/switching-from-a-frequentist-approach-to-bayesian-for-a-b-testing-analysis-b5b5eae0ce5e#2022-02-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9cf9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从技术和业务角度概述两种方法之间的主要差异</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7c595b56eb6223e163840340efb54e06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4tcqUeowqlL1xC9I"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">卡蒂亚·奥斯丁在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2361" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当分析A/B测试结果时，贝叶斯方法可以在许多不同的方面取代传统的频率方法。此外，从实现到解释，贝叶斯方法可能与频率主义方法非常不同。</p><p id="23b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您对从传统的频率主义方法转换到贝叶斯方法感兴趣，该博客从业务角度和技术角度总结了两种方法之间的主要差异。</p><h1 id="63d9" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">1.理论差异概述</h1><p id="c26b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">虽然这个博客并不关注A/B测试的基础，但是我想提供一个关于使用贝叶斯方法的<strong class="lb iu">分析过程的一般概念:</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/ae549c86fdd86cde60732c41f4bc2ba5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IXDDcKWnU_NrhmDxQ3kbAw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a4aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们强调一下贝叶斯方法和频率主义方法的一些理论差异。</p><p id="3e80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">* <strong class="lb iu">何时分析测试数据</strong></p><p id="ea90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于Frequentist方法，你需要先通过收集足够的样本来完成实验，然后再分析数据，这就把测试限定为“离线实验”。对于贝叶斯来说，分析可以在收集数据的实验过程中开始。随着新一批数据的到来，贝叶斯分析会提供更新的结果，直到我们得出假设检验的结论。这个过程使得贝叶斯的“在线实验”成为可能，节省了时间和资源。有关更多讨论，请参见下面的第3节。</p><p id="8fd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">* <strong class="lb iu">测试中KPI的数据分布:</strong></p><p id="93f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两种方法都需要了解数据分布。对于Frequentist，根据您想要测试的KPI的分布情况，需要进行不同的测试[Ref。1]:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/55fc1fa3255ee6284a98487f976dc8fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P6yZe9P6fEfFPhgx4cREcA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">参考文献。一</p></figure><p id="e7ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于贝叶斯，不同分布的KPI需要不同的共轭族。例如，像CTR(点击率)这样的KPI将使用Beta-二项式共轭进行更新。我们需要为Beta分布设置先验(a和b的参数)，使用收集的数据更新Bayes规则，并获得a和b的更新参数的后验。然后，我们使用MCMC从后验分布中采样，并对测试结果进行推断。</p><p id="b6f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">* <strong class="lb iu">样本量</strong></p><p id="5e76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Frequentist要求在实验前计算样本量。此外，一些测试，如t-test，有假设，测试组中的样本数需要平衡，以保持假设。作为比较，贝叶斯不需要预先定义的样本大小，并且允许在测试组之间存在一些不平衡的样本大小。</p><p id="6edd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">* <strong class="lb iu">测试结果说明</strong></p><p id="0b0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于频率主义者，结论可能是“我们拒绝/未能拒绝变量A优于B的假设”。这个结论是基于对整个测试期间收集的历史数据的观察。<br/>对于贝叶斯来说，结果可以用概率来表示，比如“变体A以98%的概率优于B”。</p><h1 id="73bf" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">2.从商业角度看贝叶斯的优势</h1><p id="c450" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">A/B测试是帮助做出商业决策的工具。通常，LOB或业务合作伙伴希望了解并从分析中学习，而不需要了解太多统计数据的细节，如p值或CI。在商业环境下，用贝叶斯方法解释A/B测试结果比Frequentist有一些天然的优势:</p><p id="5005" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">1) <strong class="lb iu">结果用概率更容易理解。</strong>作为一种概率方法，贝叶斯方法提供了一种可能性，即哪种变体比其他的更好。这种概率结果量化了对业务结论的信心，因此与Frequentist方法使用的p值相比，对于没有统计学背景的人来说更容易理解。</p><p id="309d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2) <strong class="lb iu">通过在线实验可以实现更快的迭代。</strong>贝叶斯分析支持在线实验中的早期停止，这实现了更快的测试迭代。基于你选择的更新频率，每一批数据进来后结果都会得到更新，不需要等到概率达到99%才停止测试。</p><p id="c6cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑这样一种情况，在运行测试3天后，贝叶斯给出了变体A优于变体b的概率为80%。当您继续收集数据2天以上时，这一概率可能会继续增加到99%,但如果您已经对A以80%的概率更好的结果感到满意，则不必再等两天。那么测试可以在这里停止，您可以通过快速切换到另一个测试来节省时间和资源。</p><p id="5cba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3) <strong class="lb iu">贝叶斯结果可以用来做预测。</strong>这与Frequentist方法有很大不同，frequent ist方法给出实验期间收集的样本的汇总统计数据。因为这些描述性的统计数据是基于历史观察的，所以你不能对未来看不见的数据做出任何结论。相反，贝叶斯方法从数据中学习参数的分布，并根据观察到的数据给出未观察到的未来值的后验预测分布。因此，你可以做一个类似“变量A的CTR预计为12%”的陈述，这是除了假设检验之外从AB检验中学习的一个好东西。</p><p id="8343" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，贝叶斯并不是一个完美的方法。Frequentist在估计实验长度方面有其优势。有了设计好的样本量，就有可能根据实验过程中获得的样本数量来估计需要多长时间。至于贝叶斯，很难预测需要多长时间才能得出结论，变体A更好的概率是99%。每天获得更多的样本有助于获得更有信心的结论(随着概率的增加)，但是我们不知道这个特定的实验需要多长时间。然而，根据我的经验和实践，贝叶斯方法通常会给出稳健的结果，而频率主义方法只需要较少的样本。</p><h1 id="77da" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">3.从技术角度来看会有什么</h1><p id="adfe" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">有了上面提到的所有优点，我希望你已经对将贝叶斯分析应用到你的A/B测试中感兴趣了。所以下一个问题是:实施贝叶斯方法有多困难？答案是，它可能需要更多的考虑:</p><h2 id="4714" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">3.1离线实验或在线实验</h2><p id="bb2b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">首先，你需要弄清楚你更喜欢线下实验还是线上实验:</p><ul class=""><li id="265a" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated"><strong class="lb iu">离线实验:</strong></li></ul><p id="48c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您在完成数据收集后开始分析，因此贝叶斯框架只需要用所有收集的数据更新一次。由于贝叶斯没有设计好的样本量，所以你不知道在完成分析后是否需要更多的样本。此外，你可能会花更多的时间收集数据，而贝叶斯可以用更少的数据给你一个结论。</p><ul class=""><li id="8a30" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated"><strong class="lb iu">在线实验:</strong></li></ul><p id="cceb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着实验的进行，你可以开始分析数据。贝叶斯框架将在实验期间多次运行并更新结果，但是您可以控制它运行的频率以及在您输入数据时的批量大小。在线实验支持快速迭代，因为一旦满足停止规则，您就可以停止实验。</p><p id="b9ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我建议在线实验充分利用贝叶斯方法的优势——比频率主义方法做出更快的决定。</p><p id="8866" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你决定使用在线实验，你需要选择多久运行一次分析，因为贝叶斯分批获取数据来更新结果。这种选择是灵活的，比如每天、每两天或每8小时更新一次结果，等等。此外，考虑你的业务需求——如果你想迭代得更快，使用高频率更新，这样一旦你达到你想要的结果，你就可以早点停止。它还可能取决于您的数据管道，比如您的数据库更新和获取新数据的频率。</p><h2 id="317f" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">3.2输入数据的粒度级别</h2><p id="c7ab" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">您可能需要对数据进行额外的预处理，因为粒度级别不同于Frequentist方法。Frequentist的输入数据将被聚合到用户/ID级别，因此它分析在测试期间为每个用户/ID收集的所有数据。然而，在线实验中贝叶斯方法的粒度级别将取决于您执行贝叶斯更新的频率。选择更新频率后，作为预处理步骤，您需要相应地聚合数据。例如，您正在测试CTR(点击率),更新频率为24小时，您将需要计算每天“看到的”事件总数和“点击”事件数，并有一个如下所示的输入数据框:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/62ab4ad48128060d693df16bed94e564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5x3C7lmSpkwVtro6R71G2w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="e9cb" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">3.3多重比较</h2><p id="c898" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">当您同时测试多个变量时，您可能会遇到多重比较问题。一个解决方案是使用分层贝叶斯方法。原因类似于将Bonferroni调整用于Frequentist方法。</p><h2 id="e7cd" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">3.4优先权的选择</h2><p id="54ae" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果你有一个像样的样本量，比如几百个或者更多，那么使用一个非信息先验，因为它不会对你的结果有太大影响。</p><p id="cdc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您的数据量很小，除非您非常有信心使用从历史数据中学习到的定制先验，否则非信息先验仍然是一个很好的选择，以避免不适当的先验带来的偏差。</p><p id="f888" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么什么时候使用你自己的先验呢？如果你有下列情况之一:1)你以前用大量历史数据做过类似的测试，2)你有一个收集的数据几乎不能代表的专家意见，3)你有有限的时间进行测试，并且对结果有一些专家知识和信心。</p><h1 id="d5f7" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">4.摘要</h1><p id="f72f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">总之，从Frequentist转向Bayesian有一些考虑和挑战。但是我仍然认为，如果您正在寻找对业务合作伙伴更可解释的结果，或者希望在时间有限的情况下用更多的迭代来测试fast，那么这些改变是值得的。我希望这篇博客能帮助你理解预期会发生什么，以及使用频率主义方法和贝叶斯方法分析AB测试结果的主要区别。感谢您的阅读！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/3d63afb73cbfbfab1482357347186ec0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kr7_0M6yp08QfzMwR6AwBA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="c73f" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">💖<strong class="ak">喜欢这个故事？DS和ML粉丝请随意</strong> <a class="ae ky" href="https://mingjie-zhao.medium.com/subscribe" rel="noopener"> <strong class="ak">订阅邮件列表</strong> </a> <strong class="ak">，</strong> <a class="ae ky" href="https://medium.com/@mingjie-zhao/membership" rel="noopener"> <strong class="ak">成为会员</strong> </a> <strong class="ak">！</strong>🤩</h2><h2 id="2c26" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">这篇博客最初发表在我的个人网站上。</h2><p id="2e59" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><strong class="lb iu">参考文献</strong> <br/> 1)维基<a class="ae ky" href="https://en.wikipedia.org/wiki/A/B_testing" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/A/B_testing</a></p></div></div>    
</body>
</html>