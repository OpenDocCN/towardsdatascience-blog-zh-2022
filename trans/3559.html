<html>
<head>
<title>Data Cleansing in Polars</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Polars中的数据清理</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-cleansing-in-polars-f9314ea04a8e#2022-08-08">https://towardsdatascience.com/data-cleansing-in-polars-f9314ea04a8e#2022-08-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f17f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何在Polars数据框中执行数据清理</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/458331665a5d5d06dd5e5775c9c0b8b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ytjsuMV28LgvoFkU"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Hans-Jurgen Mager 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="5c09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将继续探索Polars DataFrame库。这一次，我将关注数据科学家花费最多时间的事情— <em class="lv">数据清理</em>。数据清理是检测和更正数据集中损坏值的过程。在现实生活中，这个看似简单的过程需要花费大量时间，因为您遇到的大多数数据都可能包含缺失值、错误值或不相关的值。</p><h1 id="a444" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">加载数据帧</h1><p id="87e9" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在这篇文章中，我将使用泰坦尼克号数据集。</p><blockquote class="mt mu mv"><p id="a109" class="kz la lv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">数据来源</em> </strong> <em class="it">:本文数据来源来自</em><a class="ae ky" href="https://www.kaggle.com/datasets/tedllh/titanic-train" rel="noopener ugc nofollow" target="_blank"><em class="it">https://www.kaggle.com/datasets/tedllh/titanic-train</em></a><em class="it">。</em></p><p id="df57" class="kz la lv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">许可— </em> </strong> <em class="it">数据库内容许可(DbCL)v 1.0</em><a class="ae ky" href="https://opendatacommons.org/licenses/dbcl/1-0/" rel="noopener ugc nofollow" target="_blank"><em class="it">https://opendatacommons.org/licenses/dbcl/1-0/</em></a></p></blockquote><p id="d332" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，将CSV加载到Polars数据框中:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8708" class="ne lx it na b gy nf ng l nh ni">import polars as pl<br/>q = (<br/>    pl.scan_csv('titanic_train.csv')    <br/>)<br/>df = q.collect()<br/>df</span></pre><p id="7494" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据帧包含891行12列:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/260d296cae3335e76a834b3df5ff8daa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_k5bKRbxYyl-RHdxHIGs9w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><blockquote class="mt mu mv"><p id="b778" class="kz la lv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated">CSV文件中所有缺失的值将作为<code class="fe nk nl nm na b">null</code> <strong class="lb iu"> </strong>加载到Polars数据框中。</p></blockquote><h1 id="837a" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">寻找空值</h1><p id="d863" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">要检查特定列中的空值，使用<code class="fe nk nl nm na b">select()</code>方法选择该列，然后调用<code class="fe nk nl nm na b">is_null()</code>方法:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8a3e" class="ne lx it na b gy nf ng l nh ni">df.select(<br/>    pl.col('Cabin').is_null()  <br/>)</span></pre><p id="f526" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nk nl nm na b">is_null()</code>方法将结果作为布尔值的数据帧返回:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/39bc9bf069683532bb66110bfc60ed5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:404/format:webp/1*NgS_kZJsnM3jD9sCimzXKA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="424b" class="ne lx it bd ly no np dn mc nq nr dp mg li ns nt mi lm nu nv mk lq nw nx mm ny bi translated">计算空值的数量</h2><p id="9447" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">知道列中有多少行有空值比看到一个满是布尔值的数据帧更有用。因此，您可以使用<code class="fe nk nl nm na b">sum()</code>方法:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="4080" class="ne lx it na b gy nf ng l nh ni">df.select(<br/>    pl.col('Cabin').is_null()<strong class="na iu">.sum() </strong> <br/>)</span></pre><p id="937f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从下面的结果可以看出，<strong class="lb iu">舱</strong>列有687个空值:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/a7b30bb89bc5967b6198a9004508395d.png" data-original-src="https://miro.medium.com/v2/resize:fit:336/format:webp/1*Vet2thOhFaXNWaOW6bcarg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><blockquote class="mt mu mv"><p id="9965" class="kz la lv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated"><code class="fe nk nl nm na b">sum()</code>与<code class="fe nk nl nm na b">count()</code>之间的差异—<code class="fe nk nl nm na b">sum()</code>方法只对那些为<code class="fe nk nl nm na b">true</code>的值求和；而<code class="fe nk nl nm na b">count()</code>方法对所有值求和，包括<code class="fe nk nl nm na b">false</code>。</p></blockquote><p id="0dcc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想知道<em class="lv">列中的任何</em>值是否包含null，请使用<code class="fe nk nl nm na b">any()</code>方法:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="728e" class="ne lx it na b gy nf ng l nh ni">df.select(<br/>    pl.col('Cabin').is_null()<strong class="na iu">.any()   # returns true</strong><br/>)</span></pre><p id="96d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，要查看<em class="lv">列中的所有</em>值是否都为空，请使用<code class="fe nk nl nm na b">all()</code>方法:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="d346" class="ne lx it na b gy nf ng l nh ni">df.select(<br/>    pl.col('Cabin').is_null()<strong class="na iu">.all()  # returns false</strong><br/>)</span></pre><h2 id="d318" class="ne lx it bd ly no np dn mc nq nr dp mg li ns nt mi lm nu nv mk lq nw nx mm ny bi translated">对数据帧中每一列的空值数量进行计数</h2><p id="80f0" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">通常，您希望快速浏览一下数据帧中的哪些列包含空值，而不是逐个检查每一列。因此，遍历列并打印结果会很有用。您可以通过调用<code class="fe nk nl nm na b">get_columns()</code>方法并遍历它来获取数据帧中的所有列:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="0cbb" class="ne lx it na b gy nf ng l nh ni">for col in df.get_columns():<br/>    print(f'{col.name} - {col.is_null().sum()}')</span></pre><p id="ef33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码片段打印出以下输出:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="95b5" class="ne lx it na b gy nf ng l nh ni">PassengerId - 0<br/>Survived - 0<br/>Pclass - 0<br/>Name - 0<br/>Sex - 0<br/><strong class="na iu">Age - 177</strong><br/>SibSp - 0<br/>Parch - 0<br/>Ticket - 0<br/>Fare - 0<br/><strong class="na iu">Cabin - 687</strong><br/><strong class="na iu">Embarked - 2</strong></span></pre><p id="097b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以看到以下列包含空值:</p><ul class=""><li id="a515" class="oa ob it lb b lc ld lf lg li oc lm od lq oe lu of og oh oi bi translated"><strong class="lb iu">年龄</strong></li><li id="9081" class="oa ob it lb b lc oj lf ok li ol lm om lq on lu of og oh oi bi translated"><strong class="lb iu">机舱</strong></li><li id="6d27" class="oa ob it lb b lc oj lf ok li ol lm om lq on lu of og oh oi bi translated"><strong class="lb iu">上船</strong></li></ul><h1 id="3e14" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">替换空值</h1><p id="3cc6" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">一旦确定了哪些列包含空值，下一个逻辑步骤就是:</p><ul class=""><li id="62c2" class="oa ob it lb b lc ld lf lg li oc lm od lq oe lu of og oh oi bi translated">用其他值填充空值</li><li id="e91b" class="oa ob it lb b lc oj lf ok li ol lm om lq on lu of og oh oi bi translated">删除包含空值的行</li></ul><h2 id="f0b3" class="ne lx it bd ly no np dn mc nq nr dp mg li ns nt mi lm nu nv mk lq nw nx mm ny bi translated">填充整个数据帧</h2><p id="c613" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">您可以使用<code class="fe nk nl nm na b">fill_null()</code>方法填充整个数据帧中的空值:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="6cb1" class="ne lx it na b gy nf ng l nh ni">df.<strong class="na iu">fill_null(strategy='backward')</strong></span></pre><p id="0190" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的语句中，我使用了<em class="lv">向后填充</em>策略，其中所有的空值都用下一个非空值<em class="lv">填充:</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/067dbf2857b149da141e9a34d1c0b342.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TuD7guKn7LLF0arxqAcRCg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><blockquote class="mt mu mv"><p id="db3c" class="kz la lv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated">请注意，最后一行的<strong class="lb iu">舱室</strong>列包含一个空值。这是因为它没有下一行来引用要填充的值。</p></blockquote><p id="ebcb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以使用<em class="lv">向前填充</em>策略，其中所有空值都用<em class="lv">之前的</em>非空值填充:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="288e" class="ne lx it na b gy nf ng l nh ni">df.fill_null(strategy='<strong class="na iu">forward</strong>')</span></pre><p id="ff51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述语句的输出如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/06ff1905eca7ce0fe9f88d61a8c109a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NdwPyiehOtWeZNT19XIehQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><blockquote class="mt mu mv"><p id="63d8" class="kz la lv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated">现在您将意识到第一行的Cabin值是<code class="fe nk nl nm na b">null</code>,因为它没有前一行来引用要填充的值。</p></blockquote><p id="667f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也可以用固定值填充空值，如0:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="ba83" class="ne lx it na b gy nf ng l nh ni">df.fill_null(0)</span></pre><p id="3857" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述语句的输出如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/27313b182e161551b42794f8aa654943.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pQcFmEbskusnPrl7PpYr4w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="472f" class="ne lx it bd ly no np dn mc nq nr dp mg li ns nt mi lm nu nv mk lq nw nx mm ny bi translated">填写特定的栏</h2><p id="52d4" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">根据列的数据类型，您通常会对不同的列采用不同的填充值。例如，您可以使用<em class="lv">向后填充</em>策略填充<strong class="lb iu">舱</strong>列:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="6725" class="ne lx it na b gy nf ng l nh ni">df.select(<br/>    pl.col('Cabin').<strong class="na iu">fill_null(fill_value='backward')</strong><br/>)</span></pre><blockquote class="mt mu mv"><p id="16dc" class="kz la lv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated">注意，当您在表达式上调用<code class="fe nk nl nm na b">fill_null()</code>方法时，为策略设置的参数是<code class="fe nk nl nm na b">fill_value</code>而不是<code class="fe nk nl nm na b">strategy</code>。</p></blockquote><p id="20ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，上面的语句返回的数据帧只包含<strong class="lb iu">舱</strong>列:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/3b3c384ccfa7e42df7e29e4600feb442.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*QS5ouaTfWPFVXkU15_6njw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="c2b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果要在数据帧中包含其他列，请添加以下粗体语句:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="a5fe" class="ne lx it na b gy nf ng l nh ni">df.select(<br/>    <strong class="na iu">[<br/>        pl.exclude('Cabin'),      # select all columns except Cabin</strong><br/>        pl.col('Cabin').fill_null(fill_value='backward')<br/><strong class="na iu">    ]</strong><br/>)</span></pre><p id="7c6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在返回整个数据帧:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/28dffd56d8efe5db99026b8a7f2ed1a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H2tlLTQVH0N4hL6eEp-m9w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="f8fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以用固定值替换特定列中的空值:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="67ab" class="ne lx it na b gy nf ng l nh ni">df.select(<br/>    [<br/>        pl.exclude('<strong class="na iu">Age</strong>'),<br/> <strong class="na iu">       pl.col('Age').fill_null(fill_value=0)</strong><br/>    ]<br/>)</span></pre><p id="3692" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者用该列的平均值替换它们:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="439d" class="ne lx it na b gy nf ng l nh ni">df.select(<br/>    [<br/>        pl.exclude('<strong class="na iu">Age</strong>'),<br/> <strong class="na iu">       pl.col('Age').fill_null(fill_value=pl.col('Age').mean())</strong><br/>    ]<br/>)</span></pre><p id="d70e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述代码片段返回以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/b847ec1510647a1d16a3ebdd42034c3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bQc7JgH1TZn8v9Ufn23kjg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7eb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想用列中出现频率最高的值替换空值，该怎么办？例如，对于<strong class="lb iu">登船</strong>列，您希望用大多数乘客登船的港口替换空值。在这种情况下，您可以使用<code class="fe nk nl nm na b">mode()</code>方法:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="7f89" class="ne lx it na b gy nf ng l nh ni">df.select(<br/>    [<br/>        pl.exclude('Embarked'),<br/>        pl.col('Embarked').fill_null(<br/>            fill_value=<strong class="na iu">pl.col('Embarked').mode()</strong>)<br/>    ]<br/>)</span></pre><p id="15dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nk nl nm na b">mode()</code>方法返回一列中出现频率最高的值。</p><blockquote class="mt mu mv"><p id="e7c8" class="kz la lv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated">请注意，<code class="fe nk nl nm na b">mode()</code>不能在浮点列上工作。</p></blockquote><h2 id="a658" class="ne lx it bd ly no np dn mc nq nr dp mg li ns nt mi lm nu nv mk lq nw nx mm ny bi translated">删除行和列</h2><p id="1638" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">有时，当数据帧中有空值时，删除行是有意义的，特别是当空值的行数相对于您拥有的总行数很小时。要删除整个数据帧中所有包含空值的行，请使用<code class="fe nk nl nm na b">drop_nulls()</code>方法:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="6752" class="ne lx it na b gy nf ng l nh ni">df.drop_nulls()</span></pre><p id="6915" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，这样做之后，结果剩下183行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/ff4c662d29f649bbe7b05e63ca946aeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t37UNAjm_MCnys1Vr1xgEw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a2a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的数据集中，这样做并不是一个好主意，因为<strong class="lb iu"> Cabin </strong>列具有最多的空值。因此，您应该真正删除<strong class="lb iu">舱</strong>列，就像这样:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="7488" class="ne lx it na b gy nf ng l nh ni">df.select(<br/><strong class="na iu">     pl.exclude('Cabin')</strong><br/>)</span></pre><p id="ce39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以使用<code class="fe nk nl nm na b">drop()</code>方法来删除一列或多列:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="491f" class="ne lx it na b gy nf ng l nh ni">df.<strong class="na iu">drop</strong>(['Cabin'])            # drop the Cabin column<br/>df.<strong class="na iu">drop</strong>(['Ticket','Fare'])    # drop the Ticket and Fare columns</span></pre><p id="d839" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，<code class="fe nk nl nm na b">drop()</code>方法并不修改原始数据帧——它只是返回删除了指定列的数据帧。如果你想修改原始数据帧，使用<code class="fe nk nl nm na b">drop_in_place()</code>方法:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="be9f" class="ne lx it na b gy nf ng l nh ni">df.<strong class="na iu">drop_in_place</strong>('Ticket')</span></pre><blockquote class="mt mu mv"><p id="bbda" class="kz la lv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated">注意，<code class="fe nk nl nm na b">drop_in_place()</code>方法只能删除一列。它将删除的列作为Polars系列返回。</p></blockquote><p id="7211" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于<code class="fe nk nl nm na b">drop_nulls()</code>方法，您还可以使用<code class="fe nk nl nm na b">subset</code>参数删除基于特定列的行:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="5c43" class="ne lx it na b gy nf ng l nh ni">df.drop_nulls(<strong class="na iu">subset</strong>=['Age','Embarked'])</span></pre><p id="e201" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，只有在<strong class="lb iu"> Age </strong>和<strong class="lb iu">abowed</strong>列中具有空值的行将被删除:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/222d75ff1944cf7907ab97ae8bbd249a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xpsSf-irolXEHHk4ksk6mw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7527" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以在特定的列上直接调用<code class="fe nk nl nm na b">drop_nulls()</code>方法:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="d6a8" class="ne lx it na b gy nf ng l nh ni">df.select(<br/><strong class="na iu">    pl.col(['Embarked']).drop_nulls()</strong><br/>)</span></pre><p id="4499" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，结果将是一个数据帧，其中包含删除了空值的<strong class="lb iu">装载的</strong>列:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/a4c278292488a5821b28ede180955bcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:396/format:webp/1*l73zNuScpwDpihHvCGraQQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="7761" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">删除重复值</h1><p id="4666" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我将在本文中讨论的最后一种数据清理技术是删除重复项。对于本例，我将手动创建一个Polars数据帧:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="96fd" class="ne lx it na b gy nf ng l nh ni">import polars as pl</span><span id="3936" class="ne lx it na b gy ov ng l nh ni">df = pl.DataFrame(<br/>    {<br/>        "A": [1,4,4,7,7,10,10,13,16],<br/>        "B": [2,5,5,8,18,11,11,14,17],<br/>        "C": [3,6,6,9,9,12,12,15,18]        <br/>    }<br/>)<br/>df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/93d970250f031fe27c180e9fbc1d2560.png" data-original-src="https://miro.medium.com/v2/resize:fit:230/format:webp/1*I7yRdV8d_YjFZ2Ryj_TJ7g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6ac0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意有一些重复的行，例如4、5、6以及10、11、12。此外，有些行中A列和C列的值是重复的，例如7，9。</p><h2 id="60a2" class="ne lx it bd ly no np dn mc nq nr dp mg li ns nt mi lm nu nv mk lq nw nx mm ny bi translated">使用unique()方法</h2><p id="4303" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">首先，让我们使用<code class="fe nk nl nm na b">unique()</code>方法删除重复项:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="76f3" class="ne lx it na b gy nf ng l nh ni">df.unique()</span></pre><blockquote class="mt mu mv"><p id="167c" class="kz la lv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated">也可以用<code class="fe nk nl nm na b">distinct()</code>的方法。然而，在Polars 0 . 13 . 13版本中，它已经被弃用，因此不推荐使用它。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/7bd1766b76de28f7490c790567781537.png" data-original-src="https://miro.medium.com/v2/resize:fit:236/format:webp/1*dP60WfZ5lw_axxG-V3OIpA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0300" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从输出中可以观察到，如果您没有给<code class="fe nk nl nm na b">distinct()</code>方法提供任何参数，所有重复的行将被删除，只有一行将被保留。</p><p id="94a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以使用<code class="fe nk nl nm na b">subset</code>参数删除基于特定列的重复项:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="3fc6" class="ne lx it na b gy nf ng l nh ni">df.unique(<strong class="na iu">subset=['A','C']</strong>, keep='first')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/46332b0f20c1d657804cfe949cb2c660.png" data-original-src="https://miro.medium.com/v2/resize:fit:230/format:webp/1*5RyqxOnYMaC1ad7V4lHdjQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="2dbf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的结果中，观察到行7，8，9被保留，而下一行7，18，9被删除。这是因为对于这两行，它们的A列和c列有重复的值。<code class="fe nk nl nm na b">keep=’first’</code>参数(默认参数值)保留第一个重复的行并删除其余的。</p><p id="2000" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想保留最后一个重复行，请将<code class="fe nk nl nm na b">keep</code>设置为<code class="fe nk nl nm na b">‘last’</code>:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="2e29" class="ne lx it na b gy nf ng l nh ni">df.unique(subset=['A','C'], <strong class="na iu">keep='last'</strong>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/c5bdd15d96aee8f8087b4f14d393f228.png" data-original-src="https://miro.medium.com/v2/resize:fit:228/format:webp/1*prUJxJx3x790bU8x059Qog.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="f66c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，现在将保留第7、18、9行。</p><h2 id="512c" class="ne lx it bd ly no np dn mc nq nr dp mg li ns nt mi lm nu nv mk lq nw nx mm ny bi translated">删除所有重复的行</h2><p id="a2d2" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">如何删除Polars中所有重复的行？不像在Pandas中，您可以将<code class="fe nk nl nm na b">drop_duplicates()</code>方法中的<code class="fe nk nl nm na b">keep</code>参数设置为<code class="fe nk nl nm na b">False</code>来删除<em class="lv">所有的</em>重复行:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="797f" class="ne lx it na b gy nf ng l nh ni"><strong class="na iu"># Assuming df is a Pandas DataFrame</strong><br/>df.drop_duplicates(<strong class="na iu">keep=False</strong>)</span></pre><p id="9ba4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Polars中的<code class="fe nk nl nm na b">unique()</code>方法中的<code class="fe nk nl nm na b">keep</code>参数不接受<code class="fe nk nl nm na b">False</code>值。所以如果你想删除重复的值，你必须做一些不同的事情。</p><p id="77c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，您可以使用<code class="fe nk nl nm na b">is_duplicated()</code>方法获得一系列结果，表明数据帧中的哪些行是重复的:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="1a6c" class="ne lx it na b gy nf ng l nh ni">df.is_duplicated()</span></pre><p id="105b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将得到如下结果:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="5d57" class="ne lx it na b gy nf ng l nh ni">shape: (9,)<br/>Series: '' [bool]<br/>[<br/>	false<br/>	true<br/>	true<br/>	false<br/>	false<br/>	true<br/>	true<br/>	false<br/>	false<br/>]</span></pre><p id="f58f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要获取所有不重复的行(实际上是删除所有重复的行)，可以使用<em class="lv">方括号索引</em>方法:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="3f7e" class="ne lx it na b gy nf ng l nh ni">df[~df.is_duplicated()]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/57582b9d1fd8cf5c775f9e02f6abd84e.png" data-original-src="https://miro.medium.com/v2/resize:fit:230/format:webp/1*ir_Hyy-84dMwyZpAGuKO2Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6835" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是因为在Polars中不推荐使用<em class="lv">方括号索引</em>方法，所以你应该使用一个更加极性友好的方法。您可以使用<code class="fe nk nl nm na b">filter()</code>和<code class="fe nk nl nm na b">pl.lit()</code>方法完成此操作:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8218" class="ne lx it na b gy nf ng l nh ni">df.<strong class="na iu">filter</strong>(<br/>    <strong class="na iu">pl.lit</strong>(~df.is_duplicated())<br/>)</span></pre><p id="8fb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果将与之前的结果相同。</p><p id="9ddf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，如果您想要删除基于特定列的所有重复项，您可以简单地使用<code class="fe nk nl nm na b">pl.col()</code>方法并传入特定的列名:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="0ef0" class="ne lx it na b gy nf ng l nh ni">df.filter(<br/>    ~<strong class="na iu">pl.col(['A','C'])</strong>.is_duplicated()<br/>)</span></pre><p id="1c1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述语句生成以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/c0b1f58a772bd9b4c7c95e5e37de36ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:232/format:webp/1*wNovb5imH1d05j6VAbIy3Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><div class="pa pb gp gr pc pd"><a href="https://weimenglee.medium.com/membership" rel="noopener follow" target="_blank"><div class="pe ab fo"><div class="pf ab pg cl cj ph"><h2 class="bd iu gy z fp pi fr fs pj fu fw is bi translated">加入媒介与我的介绍链接-李伟孟</h2><div class="pk l"><h3 class="bd b gy z fp pi fr fs pj fu fw dk translated">阅读李维孟(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="pl l"><p class="bd b dl z fp pi fr fs pj fu fw dk translated">weimenglee.medium.com</p></div></div><div class="pm l"><div class="pn l po pp pq pm pr ks pd"/></div></div></a></div><blockquote class="mt mu mv"><p id="7858" class="kz la lv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated">我将在即将到来的新加坡ML会议(2022年11月22-24日)上主持一个关于Polars的研讨会。如果你想在Polars数据框架上快速起步，请在<a class="ae ky" href="https://mlconference.ai/machine-learning-advanced-development/using-polars-for-data-analytics-workshop/" rel="noopener ugc nofollow" target="_blank">https://ml conference . ai/machine-learning-advanced-development/using-Polars-for-data-analytics-workshop/</a>注册我的研讨会。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/b1bb1beb7127f109628516f77a2b9338.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*3mrWppY0VhWWEoBm5A4qHA.png"/></div></figure><h1 id="1b1b" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">摘要</h1><p id="5358" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在本文中，我向您展示了如何:</p><ul class=""><li id="47ac" class="oa ob it lb b lc ld lf lg li oc lm od lq oe lu of og oh oi bi translated">检查数据帧中的空值</li><li id="7b17" class="oa ob it lb b lc oj lf ok li ol lm om lq on lu of og oh oi bi translated">计算空值的数量</li><li id="798a" class="oa ob it lb b lc oj lf ok li ol lm om lq on lu of og oh oi bi translated">使用不同的策略替换空值-固定值、向前填充和向后填充</li><li id="dea9" class="oa ob it lb b lc oj lf ok li ol lm om lq on lu of og oh oi bi translated">删除包含空值的行</li><li id="7232" class="oa ob it lb b lc oj lf ok li ol lm om lq on lu of og oh oi bi translated">删除整列</li><li id="b00c" class="oa ob it lb b lc oj lf ok li ol lm om lq on lu of og oh oi bi translated">删除重复的行</li></ul><p id="e8ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我唯一的愿望是Polars中的<code class="fe nk nl nm na b">unique()</code>方法中的<code class="fe nk nl nm na b">keep</code>参数接受<code class="fe nk nl nm na b">False</code>值，这样我就可以简单地删除重复的行，而不需要求助于使用<code class="fe nk nl nm na b">filter()</code>方法。如果你知道更有效的方法，请在评论中告诉我！</p></div></div>    
</body>
</html>