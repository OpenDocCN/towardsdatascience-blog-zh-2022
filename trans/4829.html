<html>
<head>
<title>Deploying a Data Science Platform on AWS: Running containerized experiments (Part II)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在AWS上部署数据科学平台:运行容器化实验(第二部分)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploying-a-data-science-platform-on-aws-running-containerized-experiments-part-ii-bef0e22bd8ae#2022-10-26">https://towardsdatascience.com/deploying-a-data-science-platform-on-aws-running-containerized-experiments-part-ii-bef0e22bd8ae#2022-10-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="e90a" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">数据科学云基础架构</h2><div class=""/><div class=""><h2 id="3b6c" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">使用开源软件在AWS上部署数据科学平台的分步指南</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/9cb57bb4174e1b04503af663ac27d395.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fp8-TBN_xi0mcAFY"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">由<a class="ae le" href="https://unsplash.com/@guibolduc?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Guillaume Bolduc </a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="cbab" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在我们的<a class="ae le" rel="noopener" target="_blank" href="/deploying-a-data-science-platform-on-aws-setting-up-aws-batch-part-i-da4a7566db7e">上一篇</a>文章中，我们看到了如何配置AWS批处理，并通过执行一个启动容器、等待3秒钟然后关闭的任务来测试我们的基础设施。</p><p id="141e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在本文中，我们将利用现有的基础设施，但这一次，我们将执行一个更有趣的例子。</p><p id="03bc" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们将通过构建一个容器并将其存储在<a class="ae le" href="https://aws.amazon.com/ecr/" rel="noopener ugc nofollow" target="_blank"> Amazon ECR </a>中来将我们的代码发送到AWS，这是一个允许我们存储Docker图像的服务。</p><blockquote class="mb mc md"><p id="3fe5" class="lf lg me lh b li lj ka lk ll lm kd ln mf lp lq lr mg lt lu lv mh lx ly lz ma ij bi translated">如果你想及时了解我的数据科学内容。在<a class="ae le" href="https://medium.com/@edublancas" rel="noopener">媒体</a>或<a class="ae le" href="https://twitter.com/edublancas" rel="noopener ugc nofollow" target="_blank">推特</a>上关注我。感谢阅读！</p></blockquote><h1 id="5ab3" class="mi mj iq bd mk ml mm mn mo mp mq mr ms kf mt kg mu ki mv kj mw kl mx km my mz bi translated">使用<code class="fe na nb nc nd b">aws</code> CLI进行身份验证</h1><p id="745e" class="pw-post-body-paragraph lf lg iq lh b li ne ka lk ll nf kd ln lo ng lq lr ls nh lu lv lw ni ly lz ma ij bi translated">我们将再次使用<code class="fe na nb nc nd b">aws</code> CLI来配置基础架构，因此请确保您已经过身份验证并且拥有足够的权限:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="b54c" class="mi mj iq bd mk ml mm mn mo mp mq mr ms kf mt kg mu ki mv kj mw kl mx km my mz bi translated"><strong class="ak">检查码头工人</strong></h1><p id="da6c" class="pw-post-body-paragraph lf lg iq lh b li ne ka lk ll nf kd ln lo ng lq lr ls nh lu lv lw ni ly lz ma ij bi translated">这部分我们将使用Docker，因此请确保它已启动并运行:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="f183" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="74ad" class="mi mj iq bd mk ml mm mn mo mp mq mr ms kf mt kg mu ki mv kj mw kl mx km my mz bi translated"><strong class="ak">创建亚马逊ECR存储库</strong></h1><p id="1deb" class="pw-post-body-paragraph lf lg iq lh b li ne ka lk ll nf kd ln lo ng lq lr ls nh lu lv lw ni ly lz ma ij bi translated">我们首先创建一个存储库，它将托管我们的Docker映像:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="5828" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">创建ECR存储库:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="5488" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="c85b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">上面的命令将打印存储库URI，将其赋给下一个变量，因为我们以后会用到它:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="7f61" class="mi mj iq bd mk ml mm mn mo mp mq mr ms kf mt kg mu ki mv kj mw kl mx km my mz bi translated"><strong class="ak">获取一些样本代码</strong></h1><p id="b147" class="pw-post-body-paragraph lf lg iq lh b li ne ka lk ll nf kd ln lo ng lq lr ls nh lu lv lw ni ly lz ma ij bi translated">我们现在将使用两个开源工具(<a class="ae le" href="https://github.com/ploomber/ploomberhttps://github.com/ploomber/ploomber" rel="noopener ugc nofollow" target="_blank"> Ploomber </a>和<a class="ae le" href="https://github.com/ploomber/soopervisorhttps://github.com/ploomber/soopervisor" rel="noopener ugc nofollow" target="_blank"> Soopervisor </a>)来编写我们的计算任务，生成Docker映像，将其推送到ECR，并在AWS批处理中调度一个作业。</p><p id="213d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们安装软件包:</p><p id="89a9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">注意:我们建议您在虚拟环境中安装它们。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="ec4a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们来举个例子。这个例子训练和评估一个机器学习模型:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="d56a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="3717" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们看看文件:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="5e03" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="34c4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">该结构是典型的<a class="ae le" href="https://github.com/ploomber/ploomber" rel="noopener ugc nofollow" target="_blank"> Ploomber </a>项目。Ploomber允许您轻松地将计算工作流组织为函数、脚本或笔记本，并在本地执行它们。要了解更多信息，请查看Ploomber的文档。</p><p id="6d85" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">另一方面，<a class="ae le" href="https://github.com/ploomber/soopervisor/" rel="noopener ugc nofollow" target="_blank">soobervisor</a>允许您导出一个Ploomber项目并在云中执行它。</p><p id="e2ad" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">下一个命令将告诉Soopervisor创建必要的文件，以便我们可以导出到AWS批处理:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="3b0d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><pre class="kp kq kr ks gt nl nd nm nn aw no bi"><span id="6bde" class="np mj iq nd b gy nq nr l ns nt">===================Loading DAG===================<br/>No pipeline.aws-env.yaml found, looking for pipeline.yaml instead<br/>Found /Users/Edu/dev/ploomber.io/raw/ds-platform-part-ii/example/pipeline.yaml.<br/>Loading... Adding /Users/Edu/dev/ploomber.io/raw/ds-platform-part-ii/example/aws-env/Dockerfile... <br/>===================Done===================<br/>Fill in the configuration in the 'aws-env' section in soopervisor.yaml then submit to AWS Batch with: soopervisor export aws-env<br/>Environment added, to export it: $ soopervisor export aws-env<br/>To force execution of all tasks: $ soopervisor export aws-env --mode force</span></pre><p id="e58c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><code class="fe na nb nc nd b">soopervisor add</code>将创建一个<code class="fe na nb nc nd b">soopervisor.yaml</code>文件和一个<code class="fe na nb nc nd b">aws-batch</code>文件夹。</p><p id="54cd" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><code class="fe na nb nc nd b">aws-batch</code>文件夹包含一个<code class="fe na nb nc nd b">Dockerfile</code>(我们需要它来创建一个Docker映像):</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="36ea" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="ed49" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><code class="fe na nb nc nd b">soopervisor.yaml</code>文件包含配置参数:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="24df" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="7d08" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这里我们必须配置一些参数，我们创建了一个小脚本来生成配置文件:</p><ul class=""><li id="fc7c" class="nu nv iq lh b li lj ll lm lo nw ls nx lw ny ma nz oa ob oc bi translated"><code class="fe na nb nc nd b">job_queue</code>:作业队列的名称</li><li id="8e18" class="nu nv iq lh b li od ll oe lo of ls og lw oh ma nz oa ob oc bi translated"><code class="fe na nb nc nd b">aws_region</code>:您的AWS批处理基础设施所在的区域</li><li id="61ad" class="nu nv iq lh b li od ll oe lo of ls og lw oh ma nz oa ob oc bi translated"><code class="fe na nb nc nd b">repository</code>:URI集控室</li></ul><p id="dc3f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">以下是我的基础架构的价值(用您的替换):</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="5561" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><em class="me">注意:如果您没有作业队列名称，您可以从</em> <a class="ae le" href="https://us-east-1.console.aws.amazon.com/batch/home?region=us-east-1#queues" rel="noopener ugc nofollow" target="_blank"> <em class="me"> AWS控制台</em> </a> <em class="me">获取(确保您在正确的区域)。</em></p><p id="0ba0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们下载一个实用程序脚本来帮助创建配置文件:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="8031" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="6470" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">创建<code class="fe na nb nc nd b">soopervisor.yaml</code>配置文件:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="4b77" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="e166" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">文件看起来是这样的:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="570e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="bdbc" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在让我们使用<code class="fe na nb nc nd b">soopervisor export</code>来执行AWS批处理中的命令。这样的命令将为我们做几件事:</p><ul class=""><li id="f058" class="nu nv iq lh b li lj ll lm lo nw ls nx lw ny ma nz oa ob oc bi translated">构建Docker容器</li><li id="9953" class="nu nv iq lh b li od ll oe lo of ls og lw oh ma nz oa ob oc bi translated">将其推送到亚马逊ECR存储库</li><li id="4c78" class="nu nv iq lh b li od ll oe lo of ls og lw oh ma nz oa ob oc bi translated">将作业提交给AWS批处理</li></ul><p id="81d0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们需要安装<code class="fe na nb nc nd b">boto3</code>,因为它是向AWS批处理提交作业的依赖项:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="b082" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">通过Amazon ECR认证，这样我们就可以推送图片:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="8a0c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="9b7e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在让我们导出项目。请记住，该命令需要几分钟时间:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="eb17" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果一切顺利，您将看到类似这样的内容:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="aa6d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果您在使用<code class="fe na nb nc nd b">soopervisor export</code>命令时遇到问题，或者无法推送至ECR，请加入我们的<a class="ae le" href="https://ploomber.io/community" rel="noopener ugc nofollow" target="_blank">社区</a>，我们将帮助您！</p><p id="b11e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">一旦命令执行完毕，作业将被提交给AWS批处理。让我们使用<code class="fe na nb nc nd b">aws</code> CLI列出提交到队列的作业:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="63cf" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="1a18" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">一分钟后，你会看到任务显示为<code class="fe na nb nc nd b">SUCCEEDED</code>(如果没有完成，会显示为<code class="fe na nb nc nd b">RUNNABLE</code>、<code class="fe na nb nc nd b">STARTING</code>或<code class="fe na nb nc nd b">RUNNING</code>)。</p><p id="6477" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">然而，有一个问题:AWS批处理运行了我们的代码，但是不久之后，它关闭了EC2实例，因此，我们不再能够访问输出。</p><p id="229f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">为了解决这个问题，我们将在项目中添加一个S3客户端，这样所有的输出都会被存储。</p><h1 id="4c1a" class="mi mj iq bd mk ml mm mn mo mp mq mr ms kf mt kg mu ki mv kj mw kl mx km my mz bi translated"><strong class="ak">创建一个S3存储桶来存储输出</strong></h1><p id="467e" class="pw-post-body-paragraph lf lg iq lh b li ne ka lk ll nf kd ln lo ng lq lr ls nh lu lv lw ni ly lz ma ij bi translated">让我们首先在S3创建一个桶。S3桶名必须是唯一的，您可以在您的终端中运行以下代码片段，或者选择一个唯一的名称并将其赋给<code class="fe na nb nc nd b">BUCKET_NAME</code>变量:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="edbc" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="7c33" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">创建存储桶:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="6244" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="5dd0" class="mi mj iq bd mk ml mm mn mo mp mq mr ms kf mt kg mu ki mv kj mw kl mx km my mz bi translated"><strong class="ak">向我们的管道添加客户端</strong></h1><p id="9e27" class="pw-post-body-paragraph lf lg iq lh b li ne ka lk ll nf kd ln lo ng lq lr ls nh lu lv lw ni ly lz ma ij bi translated">Ploomber允许我们指定一个S3桶，它会负责为我们上传所有输出。我们只需要创建一个短文件。<code class="fe na nb nc nd b">generate.py</code>脚本可以为我们创建一个:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="7e93" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="4ad7" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们需要配置我们的<code class="fe na nb nc nd b">pipeline.yaml</code>文件，以便它上传工件到S3。让我们使用<code class="fe na nb nc nd b">generate.py</code>文件，让它为我们做这件事:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="3a29" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">此外，让我们将<code class="fe na nb nc nd b">boto3</code>添加到我们的依赖项中，因为我们将调用它来将工件上传到S3:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="b7a1" class="mi mj iq bd mk ml mm mn mo mp mq mr ms kf mt kg mu ki mv kj mw kl mx km my mz bi translated"><strong class="ak">授予AWS批处理权限以访问存储桶</strong></h1><p id="aba3" class="pw-post-body-paragraph lf lg iq lh b li ne ka lk ll nf kd ln lo ng lq lr ls nh lu lv lw ni ly lz ma ij bi translated">让我们将S3权限添加到AWS批处理任务中。生成策略:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="47d6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="d7e4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">应用它:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="e5d2" class="mi mj iq bd mk ml mm mn mo mp mq mr ms kf mt kg mu ki mv kj mw kl mx km my mz bi translated"><strong class="ak">执行工作负荷</strong></h1><p id="33b2" class="pw-post-body-paragraph lf lg iq lh b li ne ka lk ll nf kd ln lo ng lq lr ls nh lu lv lw ni ly lz ma ij bi translated">我们现在准备在AWS批处理上执行我们的任务！</p><p id="ee64" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们确保我们能够推进ECR:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="d0db" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="ce9d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">再次提交任务:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="c570" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">注意，这一次，<code class="fe na nb nc nd b">soopervisor export</code>命令快了很多，因为它缓存了我们的Docker图像！</p><p id="c6bf" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们检查任务的状态:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="e0ee" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="c20a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">一分钟后，您应该会看到它是<code class="fe na nb nc nd b">SUCCEEDED</code>。</p><p id="4d5f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">检查我们的bucket的内容，我们将看到任务输出(一个<code class="fe na nb nc nd b">.parquet</code>文件):</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="4266" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="c34f" class="mi mj iq bd mk ml mm mn mo mp mq mr ms kf mt kg mu ki mv kj mw kl mx km my mz bi translated"><strong class="ak">包装完毕</strong></h1><p id="91af" class="pw-post-body-paragraph lf lg iq lh b li ne ka lk ll nf kd ln lo ng lq lr ls nh lu lv lw ni ly lz ma ij bi translated">在这篇文章中，我们学习了如何上传代码并通过Docker映像在AWS批处理中执行它。我们还配置了AWS Batch来读写S3存储桶。有了这种配置，我们可以开始以可扩展的方式运行数据科学实验，而不用担心维护基础架构！</p><p id="9c84" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在本系列的下一篇(也是最后一篇)文章中，我们将看到如何轻松地生成数百个实验并检索结果。</p><p id="c7f6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果你想第一个知道最终部分什么时候出来；在<a class="ae le" href="https://twitter.com/ploomber" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae le" href="https://www.linkedin.com/company/ploomber/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或<a class="ae le" href="https://www.getrevue.co/profile/ploomber" rel="noopener ugc nofollow" target="_blank">上关注我们，订阅我们的简讯</a>！</p><h1 id="94b1" class="mi mj iq bd mk ml mm mn mo mp mq mr ms kf mt kg mu ki mv kj mw kl mx km my mz bi translated"><strong class="ak">尾声:清理基础设施</strong></h1><p id="64c7" class="pw-post-body-paragraph lf lg iq lh b li ne ka lk ll nf kd ln lo ng lq lr ls nh lu lv lw ni ly lz ma ij bi translated">如果你想删除我们在这篇文章中创建的基础设施，这里有一些命令。</p><p id="f8c2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">删除ECR存储库:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="391b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="221a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">删除S3存储桶:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="a525" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure></div><div class="ab cl oi oj hu ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ij ik il im in"><p id="1b11" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><em class="me">最初发布于</em><a class="ae le" href="https://ploomber.io/blog/ds-platform-part-ii/" rel="noopener ugc nofollow" target="_blank"><em class="me">ploomber . io</em></a></p></div></div>    
</body>
</html>