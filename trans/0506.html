<html>
<head>
<title>How to Scrape Data from PDF Files Using Python and PDFQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python和PDFQuery从PDF文件中抓取数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/scrape-data-from-pdf-files-using-python-and-pdfquery-d033721c3b28#2022-02-21">https://towardsdatascience.com/scrape-data-from-pdf-files-using-python-and-pdfquery-d033721c3b28#2022-02-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="06b8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">有效地从PDF文件中提取数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/09869e1027e05b01f2382bcbed7a7d78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SLwrjTpeOD4MpwrYqJUBmg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="5c9f" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">背景</h1><p id="2aca" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">在<a class="ae mm" rel="noopener" target="_blank" href="/scrape-data-from-pdf-files-using-python-fe2dc96b1e68"> <strong class="ls iu">之前的文章</strong> </a>中，我谈到了如何使用Python中的<a class="ae mm" rel="noopener" target="_blank" href="/scrape-data-from-pdf-files-using-python-fe2dc96b1e68"> <strong class="ls iu"> tabula-py </strong> </a>和<strong class="ls iu"> Pandas </strong>从PDF文件中的<strong class="ls iu">结构化</strong>和<strong class="ls iu">非结构化</strong>数据中抓取数据。在本文中，我将介绍一种从PDF文件中抓取数据的替代方法:<strong class="ls iu"> PDFQuery </strong>。</p><h2 id="7d01" class="mn kz it bd la mo mp dn le mq mr dp li lz ms mt lk md mu mv lm mh mw mx lo my bi translated">必需的库</h2><ul class=""><li id="f35f" class="mz na it ls b lt lu lw lx lz nb md nc mh nd ml ne nf ng nh bi translated"><strong class="ls iu"> PDFQuer </strong> y:从PDF文件中抓取文本</li><li id="cc04" class="mz na it ls b lt ni lw nj lz nk md nl mh nm ml ne nf ng nh bi translated"><strong class="ls iu">熊猫</strong>:构建和操作我们的面板数据</li></ul><h2 id="d32e" class="mn kz it bd la mo mp dn le mq mr dp li lz ms mt lk md mu mv lm mh mw mx lo my bi translated">安装库</h2><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="be47" class="mn kz it no b gy ns nt l nu nv">pip install pdfquery<br/>pip install pandas</span></pre><h2 id="b85b" class="mn kz it bd la mo mp dn le mq mr dp li lz ms mt lk md mu mv lm mh mw mx lo my bi translated">导入库</h2><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="a1cc" class="mn kz it no b gy ns nt l nu nv">import pdfquery<br/>import pandas as pd</span></pre><h1 id="1e8f" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">方法1:使用文本框坐标抓取PDF数据</h1><p id="b24c" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">让我们做一个简单的例子，下面的PDF文件包含了<strong class="ls iu">非结构化格式</strong>的W2数据，其中我们没有典型的<strong class="ls iu">行列结构</strong>。相反，相关信息(如员工的SSN、姓名、地址、雇主、工资等。)都是以这种W2的形式分散的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/5f4e745b8df43b4c9f9e0ae48389b813.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ls8U-PQQkSm8ZlhDFhKo8Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="9400" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">首先，我们需要将PDF转换成可扩展标记语言(XML)，其中包含给定PDF页面的数据和元数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/9838bfe418a1fc6d2d6c19016edd4348.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5zBFkBu9N_fXQS2cBYBknQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="12ad" class="mn kz it no b gy ns nt l nu nv">pdf = pdfquery.PDFQuery('file.pdf')<br/>pdf.load()<br/>pdf.tree.write('pdfXML.txt', pretty_print = True)</span></pre><p id="b6e2" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">XML定义了一组规则，用于以人类可读和机器可读的格式对PDF进行编码。以下是雇员SSN的XML片段。它包括数据(987–654–3210)和元数据(例如，文本框坐标、高度、宽度等。)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/ebecd6134186c73401ecef9d3ba71fc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F6V22QapyXPo5DuHSFiivQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="9f56" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">代码片段中文本框内的值[195，735，243，745]是指文本框的“左、下、右、上”坐标。你可以用X-Y坐标来思考pdf页面。X轴横跨PDF页面的宽度，Y轴横跨页面的高度。每个元素都有由4个坐标组成的边界框定义的边界。这些坐标(X0，Y0，X1，Y1)代表文本框的左侧、底部、右侧和顶部，这将为我们提供我们在PDF页面中感兴趣的数据的位置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/dab6457811c0ab83e1c587b4d2867849.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ckul1Wxb3bl3P_G__ip4wA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b389" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">接下来，使用XML文件中的文本框坐标，我们可以使用相应的文本框坐标分别提取每条相关信息，然后将所有收集到的信息合并到单个观察中。下面，我们编写一个函数来使用“pdf . pq(' lttextline horizontal:overlaps _ bbox(" #，#，#，#，# ")”。text()"来提取每个文本框中的数据，然后使用pandas来构造一个dataframe。</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="c4f5" class="mn kz it no b gy ns nt l nu nv">def pdfscrape(pdf):<br/>    # Extract each relevant information individually<br/>    ssn              = pdf.pq('LTTextLineHorizontal:overlaps_bbox("195, 735,  243, 745")').text()<br/>    employer_name    = pdf.pq('LTTextLineHorizontal:overlaps_bbox("48,  686,  300, 696")').text()<br/>    employer_address = pdf.pq('LTTextLineHorizontal:overlaps_bbox("48,  649,  300, 684")').text()<br/>    first_name       = pdf.pq('LTTextLineHorizontal:overlaps_bbox("48,  590,  150, 601")').text()<br/>    last_name        = pdf.pq('LTTextLineHorizontal:overlaps_bbox("175, 590,  280, 601")').text()<br/>    employee_address = pdf.pq('LTTextLineHorizontal:overlaps_bbox("48,  543,  260, 577")').text()<br/>    medicare_wage_tip= pdf.pq('LTTextLineHorizontal:overlaps_bbox("370, 662,  430, 672")').text()<br/># Combined all relevant information into single observation<br/>    page = pd.DataFrame({<br/>                         'ssn': ssn,<br/>                         'employer_name': employer_name,<br/>                         'employer_address': employer_address,<br/>                         'first_name': first_name,<br/>                         'last_name': last_name,<br/>                         'employee_address': employee_address,<br/>                         'medicare_wage_tip': medicare_wage_tip<br/>                       }, index=[0])<br/>    return(page)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/2cabd095318b650c6fe2e37debcec310.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xxCTmQ5YgNtwn4lzHEh__A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4a41" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">如果后续页面中的信息以类似的方式显示，我们可以使用for-loop自动完成这个过程。在下面的代码中，我们可以使用“pdf.doc.catalog['Pages']得到页数。resolve()['Count']”。要从特定页面提取数据，我们可以使用“pdf.load(#)”。</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="867d" class="mn kz it no b gy ns nt l nu nv">pagecount = pdf.doc.catalog['Pages'].resolve()['Count']</span><span id="1b05" class="mn kz it no b gy og nt l nu nv">master = pd.DataFrame()<br/>for p in range(pagecount):<br/>    pdf.load(p)<br/>    page = pdfscrape(pdf) <br/>    master = master.append(page, ignore_index=True)<br/>    <br/>master.to_csv('output.csv', index = False)</span></pre><h1 id="03be" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">方法2:使用邻近的关键字抓取PDF数据</h1><p id="edcc" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">另一种提取数据的方法是找到相邻关键字的坐标。更直观的方法是寻找我们感兴趣的关键词，然后提取与关键词相关的数据。</p><p id="4faa" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">在PDFQuery中，我们可以使用“pdf . pq(' lttextline horizontal:contains(" { } ")。format("keyword "))"来定位关键字。然后用“keyword.get('x0|y0|x1|y1 '，0)”提取关键字的“左、下、右、上”坐标。一旦我们有了关键字<strong class="ls iu">的坐标，我们就可以通过增加或减少坐标</strong>中的值来移动文本框。例如，在PDF页面中，“987–654–3210”在关键字“社会安全号码”下，我们可以将y0和y1减去某个值，表示10，以将文本框下移。在实践中，你将通过反复试验来学习使用什么值。最后，我们可以使用“pdf . pq(' lttextline horizontal:overlaps _ bbox(" #，#，#，# ")”。text()"来提取与关键字相关联的数据。</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="5e59" class="mn kz it no b gy ns nt l nu nv">keyword =  pdf.pq('LTTextLineHorizontal:contains("{}")'.format("social security number"))[0] <br/>x0 = float(keyword.get('x0',0)) <br/>y0 = float(keyword.get('y0',0)) - 10<br/>x1 = float(keyword.get('x1',0)) <br/>y1 = float(keyword.get('y1',0)) - 10<br/>ssn = pdf.pq('LTTextLineHorizontal:overlaps_bbox("%s, %s, %s, %s")' % (x0, y0, x1, y1)).text()</span></pre><h1 id="7d3b" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">光学字符识别</h1><p id="5a1c" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">OCR(光学字符识别)是一种将图像转换为机器编码文本的过程，它允许计算机解释文件的文本，以便可以搜索、复制和擦除文本。</p><p id="27e4" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">有时，如果您打开PDF并且无法选择文本，可能是因为PDF没有经过ocr。如果一个PDF不是OCRed，我们将需要在Adobe Acrobat中做一些额外的步骤来为PDF抓取做准备。</p><p id="e512" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">在Adobe Acrobat中，转到工具-&gt;文本识别-&gt;在此文件中。Adobe Acrobat应该开始对PDF文件进行OCR。如果您有多个PDF文件，我们可以设置一个“操作向导”来自动处理和OCR所有的PDF文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/f1fc5adac034528343819d4b70e4dce7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xc1c6_kjUlgGuLeBAcYdow.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a676" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">如果你想继续探索PDF抓取，请查看我的其他文章:</p><ul class=""><li id="d7d2" class="mz na it ls b lt nx lw ny lz oi md oj mh ok ml ne nf ng nh bi translated"><a class="ae mm" rel="noopener" target="_blank" href="/scrape-data-from-pdf-files-using-python-and-pdfquery-d033721c3b28"> <strong class="ls iu">使用Python和PDFQuery从PDF文件中抓取数据</strong> </a></li><li id="3a3a" class="mz na it ls b lt ni lw nj lz nk md nl mh nm ml ne nf ng nh bi translated"><a class="ae mm" rel="noopener" target="_blank" href="/scrape-data-from-pdf-files-using-python-fe2dc96b1e68"> <strong class="ls iu">使用Python和tabula-py从PDF文件中抓取数据</strong> </a></li><li id="c08b" class="mz na it ls b lt ni lw nj lz nk md nl mh nm ml ne nf ng nh bi translated"><a class="ae mm" href="https://python.plainenglish.io/convert-scanned-files-to-searchable-pdf-using-python-and-pytesseract-3ee31ee6f01f" rel="noopener ugc nofollow" target="_blank"> <strong class="ls iu">如何使用Python和Pytesseract将扫描文件转换为可搜索的PDF</strong></a></li><li id="09b3" class="mz na it ls b lt ni lw nj lz nk md nl mh nm ml ne nf ng nh bi translated"><a class="ae mm" rel="noopener" target="_blank" href="/pdf-text-extraction-while-preserving-whitespaces-using-python-and-pytesseract-ec142743e805"> <strong class="ls iu">使用Python和Pytesseract </strong> </a>提取PDF文本，同时保留空白</li></ul><h1 id="8bfe" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">感谢您的阅读！！！</h1><p id="2830" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">如果你喜欢这篇文章，并且想<strong class="ls iu">请我喝杯咖啡，</strong>请<a class="ae mm" href="https://ko-fi.com/aaronzhu" rel="noopener ugc nofollow" target="_blank">点击这里</a>。</p><p id="f298" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">您可以注册一个<a class="ae mm" href="https://aaron-zhu.medium.com/membership" rel="noopener"> <strong class="ls iu">会员</strong> </a>来解锁我的文章的全部访问权限，并且可以无限制地访问介质上的所有内容。如果你想在我发表新文章时收到电子邮件通知，请订阅。</p></div></div>    
</body>
</html>