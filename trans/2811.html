<html>
<head>
<title>The Battle of Choropleths — Part 2 — Altair</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">乔洛普勒斯之战——第二部分——牛郎星</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-battle-of-choropleths-part-2-altair-accaa4b46fb4#2022-06-18">https://towardsdatascience.com/the-battle-of-choropleths-part-2-altair-accaa4b46fb4#2022-06-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="1f8b" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">PYTHON。数据科学。地理可视化</h2><div class=""/><div class=""><h2 id="575b" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用牛郎星创造惊人的合唱团</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/43342374195c13acff9d060a7fedf295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RrSFNujGiMH88NVRNCm4jw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片由作者提供:初始Choropleth</p></figure><h1 id="29a0" class="lh li it bd lj lk ll lm ln lo lp lq lr ki ls kj lt kl lu km lv ko lw kp lx ly bi translated">牵牛星</h1><p id="cd2a" class="pw-post-body-paragraph lz ma it mb b mc md kd me mf mg kg mh mi mj mk ml mm mn mo mp mq mr ms mt mu im bi translated">我们在本文中首次使用了Altair包:<a class="ae mv" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-4-altair-5b67e3e5e29e">交互式地理可视化之战第4部分— Altair </a>。</p><p id="effe" class="pw-post-body-paragraph lz ma it mb b mc mw kd me mf mx kg mh mi my mk ml mm mz mo mp mq na ms mt mu im bi translated">对于那些开始阅读本文的人来说，Altair被比作Plotly，因为它是一种高级声明性语言。这意味着Altair将更容易使用，但在某些部分更难控制。</p><p id="94b1" class="pw-post-body-paragraph lz ma it mb b mc mw kd me mf mx kg mh mi my mk ml mm mz mo mp mq na ms mt mu im bi translated">Altair也有我们称之为“交互语法”的东西，可以很容易地在部件和情节之间，以及情节本身之间创建交互。稍后，我们将为shapefile和数据本身创建不同的绘图，并将它们组合在一起，我们将会看到这一点。</p><p id="dd5c" class="pw-post-body-paragraph lz ma it mb b mc mw kd me mf mx kg mh mi my mk ml mm mz mo mp mq na ms mt mu im bi translated">在Geopandas上使用Altair的一个快速好处是，您可以将鼠标悬停在几何图形上，并使用它来识别数据。</p><p id="7ae8" class="pw-post-body-paragraph lz ma it mb b mc mw kd me mf mx kg mh mi my mk ml mm mz mo mp mq na ms mt mu im bi translated">不再赘述，让我们开始编码吧。</p><h1 id="60e5" class="lh li it bd lj lk ll lm ln lo lp lq lr ki ls kj lt kl lu km lv ko lw kp lx ly bi translated">编码</h1><p id="7c58" class="pw-post-body-paragraph lz ma it mb b mc md kd me mf mg kg mh mi mj mk ml mm mn mo mp mq mr ms mt mu im bi translated">由于数据和shapefile是相同的，代码和输出将类似于第一部分中的内容。</p><h2 id="4be5" class="nb li it bd lj nc nd dn ln ne nf dp lr mi ng nh lt mm ni nj lv mq nk nl lx iz bi translated">预赛</h2><pre class="ks kt ku kv gt nm nn no np aw nq bi"><span id="42d6" class="nb li it nn b gy nr ns l nt nu">import pandas as pd<br/>import numpy as np</span><span id="2606" class="nb li it nn b gy nv ns l nt nu">import geopandas as gpd</span><span id="cfe6" class="nb li it nn b gy nv ns l nt nu">import altair as alt</span></pre><h2 id="5838" class="nb li it bd lj nc nd dn ln ne nf dp lr mi ng nh lt mm ni nj lv mq nk nl lx iz bi translated">加载人均GDP数据</h2><pre class="ks kt ku kv gt nm nn no np aw nq bi"><span id="dac7" class="nb li it nn b gy nr ns l nt nu">df = pd.read_csv('data/gdp_per_capita.csv', <br/>            skiprows=4)<br/>df = df.loc[:,['Country Name','Country Code', '2020']] #Choose only 2020<br/>df.head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/ada876e84ba03668eecb14f2f9fba9f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:870/format:webp/1*LajokJem4DAFQ_k1PTvNQw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片:数据集的前五次观察</p></figure><h2 id="8707" class="nb li it bd lj nc nd dn ln ne nf dp lr mi ng nh lt mm ni nj lv mq nk nl lx iz bi translated">加载形状文件</h2><pre class="ks kt ku kv gt nm nn no np aw nq bi"><span id="9807" class="nb li it nn b gy nr ns l nt nu">gdf = gpd.read_file('shapefiles/world-administrative-boundaries/world-administrative-boundaries.shp')<br/>gdf.head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nx"><img src="../Images/984cfcea1887fd13f2f5e0d16569c0bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F0XmJG3uYh3dhLtAWmckjQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片:Shapefile的前五个数据</p></figure><h2 id="6eb8" class="nb li it bd lj nc nd dn ln ne nf dp lr mi ng nh lt mm ni nj lv mq nk nl lx iz bi translated">合并数据</h2><pre class="ks kt ku kv gt nm nn no np aw nq bi"><span id="bb87" class="nb li it nn b gy nr ns l nt nu">merged = gdf.merge(df, left_on='name', right_on='Country Name' )<br/>merged.fillna(0, inplace=True)<br/>merged.head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ny"><img src="../Images/b829a9a4a7be08add72a09689c9adfc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lvaWoPXmYwaYnGBO6KZDgw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">按作者分类的图像:合并数据集的前五个数据</p></figure><p id="4515" class="pw-post-body-paragraph lz ma it mb b mc mw kd me mf mx kg mh mi my mk ml mm mz mo mp mq na ms mt mu im bi translated">注意，在这部分代码中，合并的数据被归类为<code class="fe nz oa ob nn b">Geopandas GeoDataFrame</code>是很重要的。</p><h1 id="b6f1" class="lh li it bd lj lk ll lm ln lo lp lq lr ki ls kj lt kl lu km lv ko lw kp lx ly bi translated">测绘</h1><p id="45ac" class="pw-post-body-paragraph lz ma it mb b mc md kd me mf mg kg mh mi mj mk ml mm mn mo mp mq mr ms mt mu im bi translated">在可视化的这一部分，我们可以分别绘制shapefile和数据，然后将它们组合起来。</p><h2 id="39c1" class="nb li it bd lj nc nd dn ln ne nf dp lr mi ng nh lt mm ni nj lv mq nk nl lx iz bi translated">绘制形状文件</h2><pre class="ks kt ku kv gt nm nn no np aw nq bi"><span id="95ae" class="nb li it nn b gy nr ns l nt nu">world = alt.Chart(merged).mark_geoshape(stroke='white',<br/>                            fill='lightgray').properties(width=800,<br/>                                                                 height=400)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oc"><img src="../Images/a27071ca1ecc5c744cd3abe960c4c08d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DP8mQnNaHDJtJNmEgqvCCg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片:Shapefile可视化</p></figure><p id="519c" class="pw-post-body-paragraph lz ma it mb b mc mw kd me mf mx kg mh mi my mk ml mm mz mo mp mq na ms mt mu im bi translated">让我们分解以下代码:</p><ul class=""><li id="9b09" class="od oe it mb b mc mw mf mx mi of mm og mq oh mu oi oj ok ol bi translated"><code class="fe nz oa ob nn b">alt.Chart </code> —初始化牛郎星图表。</li><li id="ee7b" class="od oe it mb b mc om mf on mi oo mm op mq oq mu oi oj ok ol bi translated"><code class="fe nz oa ob nn b">.mark_geoshape </code> —决定了我们想要的图表类型，在我们的例子中是一个地理形状。这同样包括特定于图表的参数，在我们的例子中还包括地图的笔画和填充属性。</li><li id="c107" class="od oe it mb b mc om mf on mi oo mm op mq oq mu oi oj ok ol bi translated"><code class="fe nz oa ob nn b">.properties —</code>这用于控制地图的整体布局，而不是特定的(图表特定参数)</li></ul><h2 id="f9d1" class="nb li it bd lj nc nd dn ln ne nf dp lr mi ng nh lt mm ni nj lv mq nk nl lx iz bi translated">绘制CHOROPLETH</h2><pre class="ks kt ku kv gt nm nn no np aw nq bi"><span id="e01f" class="nb li it nn b gy nr ns l nt nu">choro = alt.Chart(merged).mark_geoshape().encode(alt.Color('2020', <br/>                  type='quantitative', <br/>                  scale=alt.Scale(scheme='redyellowgreen'),<br/>                  title = "GDP per Capita (constant 2015 USD)"),<br/>                                                    tooltip=['name', '2020:Q'])</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi or"><img src="../Images/ccb4cfddd4f18da370b39ea09c303fda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*KOcdmoexqzSD1GRPkaLUFg.gif"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">GIF作者:初始Choropleth</p></figure><p id="20c6" class="pw-post-body-paragraph lz ma it mb b mc mw kd me mf mx kg mh mi my mk ml mm mz mo mp mq na ms mt mu im bi translated">上面代码的一点上下文:</p><ul class=""><li id="c7e4" class="od oe it mb b mc mw mf mx mi of mm og mq oh mu oi oj ok ol bi translated"><code class="fe nz oa ob nn b">.encode </code> —将数据的特征编码到图形的不同视觉特征中。这更容易理解，我认为这是将数据转化为可视化表示的代码。</li><li id="4dba" class="od oe it mb b mc om mf on mi oo mm op mq oq mu oi oj ok ol bi translated"><code class="fe nz oa ob nn b">alt.Color</code> —对Choropleths很重要的颜色模式包装。</li><li id="d4fb" class="od oe it mb b mc om mf on mi oo mm op mq oq mu oi oj ok ol bi translated"><code class="fe nz oa ob nn b">tooltip</code> —对于工具提示，重要的是包括以下格式的数据类型<code class="fe nz oa ob nn b">column_name:data_type</code>；<em class="os">这里Q代表定量。— </em>(例如用于<code class="fe nz oa ob nn b">2020:Q</code>)</li></ul><p id="a583" class="pw-post-body-paragraph lz ma it mb b mc mw kd me mf mx kg mh mi my mk ml mm mz mo mp mq na ms mt mu im bi translated">这里有一些注意事项:与我们的第一篇geopandas文章相比，我们可以清楚地看到大多数国家更接近红色，因为某些国家是异常值。在地图上很难看到它们，因为从几何角度来看它们也很小。</p><blockquote class="ot ou ov"><p id="a041" class="lz ma os mb b mc mw kd me mf mx kg mh ow my mk ml ox mz mo mp oy na ms mt mu im bi translated"><strong class="mb jd">数据可视化专家应该额外注意这个重要的方面:通过分位数来表示它们，我们能够消除离群值，从而消除不平等。在某些情况下，这是可取的，但并不总是如此。</strong></p></blockquote><p id="b4cf" class="pw-post-body-paragraph lz ma it mb b mc mw kd me mf mx kg mh mi my mk ml mm mz mo mp mq na ms mt mu im bi translated">让我们通过自定义我们的地图来尝试实现我们在第一系列中拥有的相同的地图。</p><h2 id="5f12" class="nb li it bd lj nc nd dn ln ne nf dp lr mi ng nh lt mm ni nj lv mq nk nl lx iz bi translated">用户化</h2><pre class="ks kt ku kv gt nm nn no np aw nq bi"><span id="be5b" class="nb li it nn b gy nr ns l nt nu">choro = alt.Chart(merged).mark_geoshape().encode(alt.Color('2020', <br/>                  type='quantitative', <br/>                  scale=alt.Scale(scheme='redyellowgreen', type='quantile'),<br/>                  title = "GDP per Capita (constant 2015 USD)"),<br/>                                                    tooltip=['name', '2020:Q'])</span></pre><p id="85ef" class="pw-post-body-paragraph lz ma it mb b mc mw kd me mf mx kg mh mi my mk ml mm mz mo mp mq na ms mt mu im bi translated">要继承我们在<code class="fe nz oa ob nn b">world</code> shapefile中添加的定制:</p><pre class="ks kt ku kv gt nm nn no np aw nq bi"><span id="358a" class="nb li it nn b gy nr ns l nt nu">world + choro</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oz"><img src="../Images/235c48f407c7c40ef772589d26bca097.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*sZU3jGoygS5N45_OIbOEDA.gif"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者GIF:从该系列的第一篇文章中重新创建Choropleth</p></figure><p id="d366" class="pw-post-body-paragraph lz ma it mb b mc mw kd me mf mx kg mh mi my mk ml mm mz mo mp mq na ms mt mu im bi translated">如你所见，我们的地图上有一个自动色带。这对Altair来说是一个巨大的利好。</p><blockquote class="ot ou ov"><p id="76b3" class="lz ma os mb b mc mw kd me mf mx kg mh ow my mk ml ox mz mo mp oy na ms mt mu im bi translated">此外，它很容易结合两个对象，我们已经设计。我们简单地用符号<code class="fe nz oa ob nn b">+</code>将它们组合起来。</p></blockquote><h1 id="310d" class="lh li it bd lj lk ll lm ln lo lp lq lr ki ls kj lt kl lu km lv ko lw kp lx ly bi translated">结束语</h1><p id="f0c7" class="pw-post-body-paragraph lz ma it mb b mc md kd me mf mg kg mh mi mj mk ml mm mn mo mp mq mr ms mt mu im bi translated">可以说，Altair创建类似choropleth的语法比Geopandas简单得多。</p><p id="65ca" class="pw-post-body-paragraph lz ma it mb b mc mw kd me mf mx kg mh mi my mk ml mm mz mo mp mq na ms mt mu im bi translated">这种便利不是没有代价的。截至本文撰写之时，Altair软件包，至少对于地图来说，还不具备放大和缩小以及平移和缩放的功能。它目前正在开发中，但现在，这可能是可视化的一个很大的缺点，比如这个国家的面积可能比其他国家小。</p><p id="196e" class="pw-post-body-paragraph lz ma it mb b mc mw kd me mf mx kg mh mi my mk ml mm mz mo mp mq na ms mt mu im bi translated">我的<a class="ae mv" href="https://github.com/francisadrianviernes/GeoVisualization/blob/master/The%20Battle%20of%20Choropleths%20-%20Part%202%20-%20Altair.ipynb" rel="noopener ugc nofollow" target="_blank"> Github页面</a>上的全部代码。</p><h1 id="921c" class="lh li it bd lj lk ll lm ln lo lp lq lr ki ls kj lt kl lu km lv ko lw kp lx ly bi translated">其他相关文章</h1><h2 id="a293" class="nb li it bd lj nc nd dn ln ne nf dp lr mi ng nh lt mm ni nj lv mq nk nl lx iz bi translated">Choropleths之战——第一部分</h2><h2 id="1f7b" class="nb li it bd lj nc nd dn ln ne nf dp lr mi ng nh lt mm ni nj lv mq nk nl lx iz bi translated"><a class="ae mv" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-1-interactive-geoplot-using-one-line-of-8214e9ed1bb4?source=your_stories_page-------------------------------------">交互式地理可视化之战第一部分——使用一行……的交互式地理地图</a></h2><h2 id="bd41" class="nb li it bd lj nc nd dn ln ne nf dp lr mi ng nh lt mm ni nj lv mq nk nl lx iz bi translated"><a class="ae mv" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-2-interactive-geoplot-using-one-line-of-2118af59a77c?source=your_stories_page-------------------------------------">交互式地理可视化之战第二部分——使用一行……的交互式geo plot</a></h2><h2 id="a4ca" class="nb li it bd lj nc nd dn ln ne nf dp lr mi ng nh lt mm ni nj lv mq nk nl lx iz bi translated"><a class="ae mv" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-3-plotly-graph-objects-go-c3d3f2a00132?source=your_stories_page-------------------------------------">交互式地理可视化之战第三部分——Plotly图形对象(Go) </a></h2><h2 id="b0ba" class="nb li it bd lj nc nd dn ln ne nf dp lr mi ng nh lt mm ni nj lv mq nk nl lx iz bi translated"><a class="ae mv" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-4-altair-5b67e3e5e29e?source=your_stories_page-------------------------------------">交互式地理可视化之战第四部——牛郎星</a></h2><h2 id="8e3e" class="nb li it bd lj nc nd dn ln ne nf dp lr mi ng nh lt mm ni nj lv mq nk nl lx iz bi translated"><a class="ae mv" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-5-folium-cc2213d29a7?source=your_stories_page-------------------------------------">交互式地理可视化之战第五集——叶子</a></h2><h2 id="4822" class="nb li it bd lj nc nd dn ln ne nf dp lr mi ng nh lt mm ni nj lv mq nk nl lx iz bi translated"><a class="ae mv" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-6-greppo-4f615a1dae43?source=your_stories_page-------------------------------------">交互式地理可视化之战第六集——格雷波</a></h2><h2 id="11df" class="nb li it bd lj nc nd dn ln ne nf dp lr mi ng nh lt mm ni nj lv mq nk nl lx iz bi translated"><a class="ae mv" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-7-bokeh-57e40e159354?source=your_stories_page-------------------------------------">交互式地理可视化之战第七部分——散景</a></h2></div></div>    
</body>
</html>