<html>
<head>
<title>Understanding GroupBy in Polars DataFrame by Examples</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">举例理解极坐标数据帧中的分组方式</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/understanding-groupby-in-polars-dataframe-by-examples-1e910e4095b3#2022-08-05">https://towardsdatascience.com/understanding-groupby-in-polars-dataframe-by-examples-1e910e4095b3#2022-08-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6d51" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何在Polars中使用groupby()方法来聚合数据和应用函数</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8d9b300b2d709da06ccbc4af5e3b40ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8ku3hGXuCGHRO8xv"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@hannahbusing?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Hannah Busing </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="4f39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，在我关于Polars的前几篇文章中，我已经向您介绍了Polars数据框架的基础知识，为什么它是比Pandas更好的数据框架库，以及它的惰性评估特性如何允许它优化您的查询。在探索Polars时，您会遇到一个非常常见的问题——如何在Polars数据帧上执行<em class="lv"> groupby </em>?大多数Pandas用户都熟悉<code class="fe lw lx ly lz b">groupby()</code>函数，您可以根据类别对数据进行分组，然后对类别应用函数。在Polars里你是怎么做到的？</p><p id="76f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将带您了解如何在Polars数据帧上使用<code class="fe lw lx ly lz b">groupby()</code>功能。特别是，我将用几个不同的例子来说明它们。准备好了吗？我们走吧！</p><h1 id="8e98" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">示例1</h1><p id="47ba" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">对于第一个示例，我将手动创建Polars数据帧:</p><pre class="kj kk kl km gt mx lz my mz aw na bi"><span id="f79a" class="nb mb it lz b gy nc nd l ne nf">import polars as pl</span><span id="4bd6" class="nb mb it lz b gy ng nd l ne nf">scores = {'Zone': ['North', 'North', 'South', 'South',<br/>                   'East', 'East', 'West', 'West'], <br/>          'School': ['Rushmore', 'Rushmore','Bayside','Rydell',<br/>                     'Shermer','Shermer','Ridgemont','Hogwarts'],<br/>          'Name': ['Jonny', 'Mary', 'Joe', 'Jakob', <br/>                   'Jimmy', 'Erik', 'Lam', 'Yip'], <br/>          'Math': [78, 39, 76, 56, 67, 89, 100, 55],<br/>          'Science': [70, 45, 68, 90, 45, 66, 89, 32]}</span><span id="91b7" class="nb mb it lz b gy ng nd l ne nf">df = pl.DataFrame(scores, columns = <br/>                  ['Zone', 'School', 'Name', <br/>                   'Science', 'Math'])          <br/>df</span></pre><p id="aaa8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您在输出中看到的，dataframe具有8行5列的形状:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/54e4231fd91443ab6b6a4e1a6b001acb.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/1*J70-ER5fNGqwhH_SpMKEXQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="8182" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">dataframe包含一组来自不同学校的学生的科学和数学成绩。</p><h2 id="a43d" class="nb mb it bd mc ni nj dn mg nk nl dp mk li nm nn mm lm no np mo lq nq nr mq ns bi translated">按区域分组</h2><p id="4de5" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">现在让我们通过使用<code class="fe lw lx ly lz b">groupby()</code>和<code class="fe lw lx ly lz b">agg()</code>方法来查看每个区域中的所有学校:</p><pre class="kj kk kl km gt mx lz my mz aw na bi"><span id="b740" class="nb mb it lz b gy nc nd l ne nf">q = (<br/>    df<br/>    .lazy()<br/>    .groupby(by='Zone')<br/>    .agg(<br/>        'School'<br/>    )<br/>)<br/>q.collect()</span></pre><blockquote class="nt nu nv"><p id="d40b" class="kz la lv lb b lc ld ju le lf lg jx lh nw lj lk ll nx ln lo lp ny lr ls lt lu im bi translated">您使用<code class="fe lw lx ly lz b">lazy()</code>方法来确保Polars对后面的所有查询使用惰性评估。</p></blockquote><p id="5835" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将看到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/4782a829ef3c2cef4e9b45d5cdd263c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*CrCqT49z5k31VVDlodTdBQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7f24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，每个区域的学校现在作为列表存储在<code class="fe lw lx ly lz b">School</code>列下。要查看特定区域的所有学校，您可以使用<code class="fe lw lx ly lz b">filter()</code>方法:</p><pre class="kj kk kl km gt mx lz my mz aw na bi"><span id="f8dd" class="nb mb it lz b gy nc nd l ne nf">q = (<br/>    df<br/>    .lazy()<br/>    .groupby(by='Zone')<br/>    .agg(<br/>        'School'<br/>    )<br/><strong class="lz iu">    .filter(<br/>        pl.col('Zone')=='East'        <br/>    )<br/></strong>)<br/>q.collect()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/39905557cd8193f1a5bbc7d2f485ae8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:394/format:webp/1*5JddmEi9zUkO21I27Urhiw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="1049" class="nb mb it bd mc ni nj dn mg nk nl dp mk li nm nn mm lm no np mo lq nq nr mq ns bi translated">查看每个区域的最高分数</h2><p id="bf6a" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">如果你想知道每个区域的最高<strong class="lb iu">科学</strong>分数，使用<strong class="lb iu">科学</strong>栏上的<code class="fe lw lx ly lz b">max()</code>方法:</p><pre class="kj kk kl km gt mx lz my mz aw na bi"><span id="d495" class="nb mb it lz b gy nc nd l ne nf">q = (<br/>    df<br/>    .lazy()<br/>    .groupby(by='Zone')<br/>    .agg(        <br/>        pl.col('Science').<strong class="lz iu">max()</strong>.alias('Science(Max)')<br/>    )    <br/>)<br/>q.collect()</span></pre><blockquote class="nt nu nv"><p id="7212" class="kz la lv lb b lc ld ju le lf lg jx lh nw lj lk ll nx ln lo lp ny lr ls lt lu im bi translated"><code class="fe lw lx ly lz b">alias()</code>方法重命名输出列。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/c1b36eadda03aef4e96cde3ad59bacd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:326/format:webp/1*Zsb0qa_E2fvE2HG7KHkg-w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="cfa2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也可以像这样直接使用<strong class="lb iu">科普</strong>栏目上的<code class="fe lw lx ly lz b">pl.max()</code>方法:</p><pre class="kj kk kl km gt mx lz my mz aw na bi"><span id="4498" class="nb mb it lz b gy nc nd l ne nf">        # pl.col('Science').max().alias('Science(Max)') <strong class="lz iu"><br/>        pl.max('Science').alias('Science(Max)')</strong></span></pre><p id="97bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您还想计算每个区域中学校的数量，您可以在<code class="fe lw lx ly lz b">agg()</code>方法中添加另一个表达式:</p><pre class="kj kk kl km gt mx lz my mz aw na bi"><span id="e19c" class="nb mb it lz b gy nc nd l ne nf">q = (<br/>    df    <br/>    .lazy()<br/>    .groupby(by='Zone')<br/>    .agg(<br/>        [<br/><strong class="lz iu">            pl.col('Science').count().alias('Number of Schools'),</strong><br/>            pl.col('Science').max().alias('Science(Max)')<br/>        ]<br/>    )    <br/>)<br/>q.collect()</span></pre><p id="7032" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/cfd0c7c8d632f736bf8db1a9b5fd0cfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:564/format:webp/1*pHW0sXFo7W5HnCD7LagOlw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4495" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以添加不同的表达式来获得聚合组的结果:</p><pre class="kj kk kl km gt mx lz my mz aw na bi"><span id="493d" class="nb mb it lz b gy nc nd l ne nf">q = (<br/>    df<br/>    .lazy()<br/>    .groupby(by='Zone')<br/>    .agg(        <br/> <strong class="lz iu">       [<br/></strong>            pl.col('Science').count().alias('Number of Schools'),<strong class="lz iu"><br/>            </strong>pl.col('Science').max().alias('Science(Max)')<strong class="lz iu">,</strong><br/>         <strong class="lz iu">   pl.col('Science').min().alias('Science(Min)'),<br/>            pl.col('Science').mean().alias('Science(Mean)'),<br/>            pl.col('Math').max().alias('Math(Max)'),<br/>            pl.col('Math').min().alias('Math(Min)'),    <br/>            pl.col('Math').mean().alias('Math(Mean)'),    <br/>        ]<br/></strong>    )    <br/>)<br/>q.collect()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/be3b443e0adac20eec3493d59089f2f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*8T9Mu27UAq53IuRw3itVmQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="2089" class="nb mb it bd mc ni nj dn mg nk nl dp mk li nm nn mm lm no np mo lq nq nr mq ns bi translated">修改排序顺序</h2><p id="fb14" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">由<code class="fe lw lx ly lz b">groupby()</code>方法返回的结果的顺序是随机的，所以每次运行上述代码片段时，您可能会看到<strong class="lb iu">区域</strong>的顺序不同。你可以使用<code class="fe lw lx ly lz b">sort()</code>方法给它一个命令:</p><pre class="kj kk kl km gt mx lz my mz aw na bi"><span id="217b" class="nb mb it lz b gy nc nd l ne nf">q = (<br/>    df<br/>    .lazy()<br/>    .groupby(by='Zone')<br/>    .agg(<br/>        [<br/>            pl.max('Science').alias('Science(Max)')<br/>        ]<br/>    )<br/> <strong class="lz iu">   .sort(by='Zone')</strong><br/>)<br/>q.collect()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/543794e89e58d03b394acc9df73353f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:322/format:webp/1*fr56dmKFx0IwshEQcpppFw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a815" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意到<strong class="lb iu">区域</strong>是按字母顺序排序的，而不是基于<em class="lv">主方向</em>(即北、南、东、西)。那么，如何根据基本方向对<strong class="lb iu">区域</strong>进行排序呢？以下代码片段显示了如何做到这一点:</p><pre class="kj kk kl km gt mx lz my mz aw na bi"><span id="0d91" class="nb mb it lz b gy nc nd l ne nf"><strong class="lz iu">df_sortorder = pl.DataFrame({<br/>   'Zone' : ['North','South','East','West'],<br/>   'Zone_order' : [0,1,2,3]<br/>}).lazy()</strong></span><span id="ee85" class="nb mb it lz b gy ng nd l ne nf">q = (<br/>    df<br/>    .lazy()<br/>    <strong class="lz iu">.join(df_sortorder, on='Zone', how='left')</strong><br/><strong class="lz iu">    .groupby(by=['Zone','Zone_order'])</strong><br/>    .agg(<br/>        [<br/>            pl.max('Science').alias('Science(Max)')<br/>        ]<br/>    )<br/><strong class="lz iu">    .sort('Zone_order')<br/>    .select(<br/>        pl.exclude('Zone_order')<br/>    )<br/></strong>)<br/>q.collect()</span></pre><p id="3897" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码片段中，我:</p><ul class=""><li id="cc28" class="of og it lb b lc ld lf lg li oh lm oi lq oj lu ok ol om on bi translated">创建了另一个dataframe ( <code class="fe lw lx ly lz b">df_sortorder</code>)来指定我想要的区域排序顺序</li><li id="206f" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated">用<code class="fe lw lx ly lz b">df_sortorder</code>连接原始数据框架，这样我的数据框架现在有了一个名为<code class="fe lw lx ly lz b">Zone_order</code>的新列</li><li id="dde5" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated">根据新的<code class="fe lw lx ly lz b">Zone_order</code>列对组进行排序</li><li id="1f53" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated">在最终结果中排除了<code class="fe lw lx ly lz b">Zone_order</code>列</li></ul><p id="46b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/6a09320ffeba63fcb4e0d9fa89a27f11.png" data-original-src="https://miro.medium.com/v2/resize:fit:326/format:webp/1*IM9GWSqVgWcOP_TRicJaCg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="4252" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">示例2</h1><p id="c2b1" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">下一个例子使用数据集"<a class="ae ky" href="https://github.com/arthurkao/vehicle-make-model-data" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">"车辆制造模型数据</strong> </a> <strong class="lb iu">"。</strong>从<a class="ae ky" href="https://github.com/arthurkao/vehicle-make-model-data" rel="noopener ugc nofollow" target="_blank">这个页面</a>下载<strong class="lb iu"> csv_data.csv </strong>文件。</p><blockquote class="nt nu nv"><p id="d1ed" class="kz la lv lb b lc ld ju le lf lg jx lh nw lj lk ll nx ln lo lp ny lr ls lt lu im bi translated"><strong class="lb iu">许可证</strong> —麻省理工学院许可证</p><p id="3a07" class="kz la lv lb b lc ld ju le lf lg jx lh nw lj lk ll nx ln lo lp ny lr ls lt lu im bi translated"><strong class="lb iu">描述</strong> —准确的机动车制造&amp;自2001年起的车型数据。该数据集包括汽车、摩托车、卡车和UTV制造商及其相应的型号。数据是数据库不可知的，并且是用户友好的，因为<em class="it">相同的</em>数据集被移植到mysql、json和csv格式。Json和csv数据集被扁平化，而mysql数据集被规范化为3个表。目前有19，722种型号，并且还在增加。</p></blockquote><p id="f4df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，将CSV文件加载到Polars数据框架中:</p><pre class="kj kk kl km gt mx lz my mz aw na bi"><span id="dc1d" class="nb mb it lz b gy nc nd l ne nf">q = (<br/>    pl.scan_csv('csv_data.csv')<br/>)<br/>q.collect()</span></pre><p id="b22e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该看到以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/048b7495ee2886202e7e6d8e501dd3d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*m5ZxypoljDrXScg5ycTQNg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="bc39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据框包含2001年至2016年的制造商(<strong class="lb iu">制造商</strong>)及其<strong class="lb iu">型号</strong>的列表。</p><h2 id="5084" class="nb mb it bd mc ni nj dn mg nk nl dp mk li nm nn mm lm no np mo lq nq nr mq ns bi translated">按年份和品牌分组</h2><p id="17b5" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">先将数据框按<strong class="lb iu">年份</strong>和<strong class="lb iu">品牌</strong>分组，然后统计每个<strong class="lb iu">年份</strong>按<strong class="lb iu">品牌</strong>的<strong class="lb iu">型号数量:</strong></p><pre class="kj kk kl km gt mx lz my mz aw na bi"><span id="ffc4" class="nb mb it lz b gy nc nd l ne nf">q = (<br/>    pl.scan_csv('csv_data.csv')<br/>    .groupby(by=['year','make'])<br/>    .agg(<br/>        pl.col(['make']).count().alias('count')        <br/>    )<br/>    .sort(by=['year','make'])<br/>)</span><span id="15c1" class="nb mb it lz b gy ng nd l ne nf">q.collect()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/87afe39df741f2675c969bed45a81cfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:460/format:webp/1*K2X69Jp9C4GdSw9cfeVLLw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a84f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe lw lx ly lz b">pl.count()</code>方法可以简化上述操作:</p><pre class="kj kk kl km gt mx lz my mz aw na bi"><span id="9135" class="nb mb it lz b gy nc nd l ne nf">q = (<br/>    pl.scan_csv('csv_data.csv')<br/>    .groupby(by=['year','make'])<br/>    .agg(        <br/><strong class="lz iu">        pl.count()</strong><br/>    )<br/>    .sort(by=['year','make'])<br/>)</span><span id="0cf8" class="nb mb it lz b gy ng nd l ne nf">q.collect()</span></pre><p id="ab1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想查看每个汽车制造商的所有型号，您可以指定<strong class="lb iu">型号</strong>列:</p><pre class="kj kk kl km gt mx lz my mz aw na bi"><span id="cda2" class="nb mb it lz b gy nc nd l ne nf">q = (<br/>    pl.scan_csv('csv_data.csv')<br/>    .groupby(by=['year','make'])<br/>    .agg(        <br/><strong class="lz iu">        'model'</strong><br/>    )<br/>    .sort(by=['year','make'])<br/>)</span><span id="7213" class="nb mb it lz b gy ng nd l ne nf">q.collect()</span></pre><p id="2645" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将把所有的<strong class="lb iu">车型</strong>名称分组为每个<strong class="lb iu">年份</strong>和<strong class="lb iu">品牌</strong>的列表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/7ce4c5fbf9fea51bcda1e9942fb9884a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*7AmH13R_H0Vyf-64uL8-dw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="c9e7" class="nb mb it bd mc ni nj dn mg nk nl dp mk li nm nn mm lm no np mo lq nq nr mq ns bi translated">显示每个汽车品牌的第一个和最后一个型号</h2><p id="5067" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">如果要显示每辆<strong class="lb iu">制造</strong>的第一个和最后一个<strong class="lb iu">型号</strong>，分别使用<code class="fe lw lx ly lz b">first()</code>和<code class="fe lw lx ly lz b">last()</code>方法:</p><pre class="kj kk kl km gt mx lz my mz aw na bi"><span id="db08" class="nb mb it lz b gy nc nd l ne nf">q = (<br/>    pl.scan_csv('csv_data.csv')<br/>    .groupby(by=['year','make'])<br/>    .agg(<br/><strong class="lz iu">        [</strong><br/>            'model',<br/><strong class="lz iu">            pl.first('model').alias('first'),<br/>            pl.last('model').alias('last'),<br/>        ]    <br/></strong>    )<br/>    .sort(by=['year','make'])<br/>)</span><span id="4c48" class="nb mb it lz b gy ng nd l ne nf">q.collect()</span></pre><p id="f59a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个和最后一个模型现在将显示在各自独立的列中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/184233c980e14e89ead29dd6e8773b83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FfHvlk6F5oHDUdfbh3ilmA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="488b" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">示例3</h1><p id="5ff6" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">对于这个例子，我们将使用<a class="ae ky" href="https://www.kaggle.com/datasets/teertha/ushealthinsurancedataset?resource=download" rel="noopener ugc nofollow" target="_blank">这个数据集</a>。</p><blockquote class="nt nu nv"><p id="e866" class="kz la lv lb b lc ld ju le lf lg jx lh nw lj lk ll nx ln lo lp ny lr ls lt lu im bi translated"><strong class="lb iu">许可</strong> : <a class="ae ky" href="https://creativecommons.org/publicdomain/zero/1.0/" rel="noopener ugc nofollow" target="_blank"> CC0:公共领域</a></p><p id="d8eb" class="kz la lv lb b lc ld ju le lf lg jx lh nw lj lk ll nx ln lo lp ny lr ls lt lu im bi translated"><strong class="lb iu">描述</strong> —该数据集包含1338行被保险人数据，其中根据被保险人的以下属性给出保险费用:年龄、性别、身体质量指数、子女数、吸烟者和地区。属性是数字和分类变量的混合。</p></blockquote><p id="b02a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，将CSV文件作为Polars数据帧加载:</p><pre class="kj kk kl km gt mx lz my mz aw na bi"><span id="eafb" class="nb mb it lz b gy nc nd l ne nf">q = (<br/>    pl.scan_csv('insurance.csv')<br/>)<br/>q.collect()</span></pre><p id="7652" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据框架包含各种客户资料:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/5a1664198638590c950c3371e23410a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*BsyrUsclxtnaujHMAzsRlg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="8a5e" class="nb mb it bd mc ni nj dn mg nk nl dp mk li nm nn mm lm no np mo lq nq nr mq ns bi translated">计算雄性和雌性的数量</h2><p id="505b" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">要计算每个地区的男性和女性人数，请在汇总时使用<code class="fe lw lx ly lz b">sum()</code>方法:</p><pre class="kj kk kl km gt mx lz my mz aw na bi"><span id="fd2a" class="nb mb it lz b gy nc nd l ne nf">q = (<br/>    pl.scan_csv('insurance.csv')<br/>    .groupby(by='region')<br/>    .agg(<br/><strong class="lz iu">        [<br/>            (pl.col('sex') == 'male').sum().alias('male'),<br/>            (pl.col('sex') == 'female').sum().alias('female'),<br/>        ]    <br/></strong>    )<br/>    .sort(by='region')<br/>)<br/>q.collect()</span></pre><p id="abe4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个地区的男性和女性人数现在将显示在两列中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/c5a36b19d86151566d0f6ad111f878df.png" data-original-src="https://miro.medium.com/v2/resize:fit:362/format:webp/1*tKQqb0QNQCMSw1msLG4o-g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="98c5" class="nb mb it bd mc ni nj dn mg nk nl dp mk li nm nn mm lm no np mo lq nq nr mq ns bi translated">计算每个性别的平均费用</h2><p id="c45d" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">要计算每个地区每个性别的平均费用，您必须:</p><ul class=""><li id="1943" class="of og it lb b lc ld lf lg li oh lm oi lq oj lu ok ol om on bi translated">首先选择<code class="fe lw lx ly lz b">charges</code>列</li><li id="0bd9" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated">每个性别的过滤器</li><li id="27db" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated">计算平均费用</li><li id="c725" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated">重命名该列</li></ul><p id="0705" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是执行上述步骤的代码片段:</p><pre class="kj kk kl km gt mx lz my mz aw na bi"><span id="c99f" class="nb mb it lz b gy nc nd l ne nf">q = (<br/>    pl.scan_csv('insurance.csv')<br/>    .groupby(by='region')<br/>    .agg(<br/>        [<br/><strong class="lz iu">            (pl.col('charges')<br/>             .filter(pl.col('sex')== 'male'))<br/>            .mean()<br/>            .alias('male_mean_charges'),<br/>            <br/>            (pl.col('charges')<br/>             .filter(pl.col('sex')== 'female'))<br/>            .mean()<br/>            .alias('female_mean_charges'),<br/></strong>        ]    <br/>    )<br/>    .sort(by='region')<br/>)<br/>q.collect()</span></pre><p id="bbb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是上述代码片段的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/c06274ce746abf068274a9bc2f6f8fde.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*D1_IhvjY-eOjldel2WdoFg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="8e0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了验证上述结果是否正确，我们可以编写以下代码片段来手动检索所有包含来自东北地区的男性的行，然后计算他们的平均费用:</p><pre class="kj kk kl km gt mx lz my mz aw na bi"><span id="d88a" class="nb mb it lz b gy nc nd l ne nf">q = (<br/>    pl.scan_csv('insurance.csv')<br/>    .filter(<br/>        (pl.col('region')=='northeast') &amp; (pl.col('sex') == 'male')    <br/>    )<br/>    .select(<br/>        pl.col('charges')<br/>    )<br/>    .mean()    <br/>)<br/>q.collect()</span></pre><p id="e47e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下结果显示了东北地区所有男性的平均费用:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/82411b9d65d2c8a98b0ac5daedca05a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:204/format:webp/1*rdKPCvrglmKCKbUNiTnw4Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="98dd" class="nb mb it bd mc ni nj dn mg nk nl dp mk li nm nn mm lm no np mo lq nq nr mq ns bi translated">计算每个地区吸烟者的比例</h2><p id="5119" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">要计算每个地区吸烟者的比例，您需要:</p><ul class=""><li id="784c" class="of og it lb b lc ld lf lg li oh lm oi lq oj lu ok ol om on bi translated">总结所有吸烟者</li><li id="770f" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated">计算吸烟者列中的总行数</li></ul><p id="4343" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是执行上述步骤的代码片段:</p><pre class="kj kk kl km gt mx lz my mz aw na bi"><span id="d0a8" class="nb mb it lz b gy nc nd l ne nf">q = (<br/>    pl.scan_csv('insurance.csv')<br/>    .groupby(by='region')<br/>    .agg(<br/>        [<br/><strong class="lz iu">            ((pl.col('smoker')=='yes').sum() / <br/>             (pl.col('smoker')).count() * 100).alias('Smoker %')<br/></strong>        ]    <br/>    )<br/>    .sort(by='region')<br/>)<br/>q.collect()</span></pre><p id="2256" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的结果显示了每个地区吸烟者的百分比:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/0a8dff9bc9c3b73e66b5e1adeebb573e.png" data-original-src="https://miro.medium.com/v2/resize:fit:330/format:webp/1*pEKSEKn5Dw7SNv8YRhSAtA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><div class="pc pd gp gr pe pf"><a href="https://weimenglee.medium.com/membership" rel="noopener follow" target="_blank"><div class="pg ab fo"><div class="ph ab pi cl cj pj"><h2 class="bd iu gy z fp pk fr fs pl fu fw is bi translated">加入媒介与我的介绍链接-李伟孟</h2><div class="pm l"><h3 class="bd b gy z fp pk fr fs pl fu fw dk translated">阅读李维孟(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="pn l"><p class="bd b dl z fp pk fr fs pl fu fw dk translated">weimenglee.medium.com</p></div></div><div class="po l"><div class="pp l pq pr ps po pt ks pf"/></div></div></a></div><blockquote class="nt nu nv"><p id="9009" class="kz la lv lb b lc ld ju le lf lg jx lh nw lj lk ll nx ln lo lp ny lr ls lt lu im bi translated">我将在即将到来的新加坡ML会议(2022年11月22-24日)上主持一个关于Polars的研讨会。如果你想在Polars数据框架上快速起步，请在<a class="ae ky" href="https://mlconference.ai/machine-learning-advanced-development/using-polars-for-data-analytics-workshop/" rel="noopener ugc nofollow" target="_blank">https://ml conference . ai/machine-learning-advanced-development/using-Polars-for-data-analytics-workshop/</a>注册我的研讨会。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pu"><img src="../Images/b1bb1beb7127f109628516f77a2b9338.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*3mrWppY0VhWWEoBm5A4qHA.png"/></div></figure><h1 id="7f30" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">摘要</h1><p id="2fdb" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">我希望上面的代码示例能为您提供足够的素材来了解<code class="fe lw lx ly lz b">groupby()</code>方法的用法。正如您从代码中注意到的那样，<code class="fe lw lx ly lz b">groupby()</code>方法通常与<code class="fe lw lx ly lz b">agg()</code>方法结合使用。使用Polars时需要记住的一点是，应该避免使用<code class="fe lw lx ly lz b">apply()</code>函数，因为它会影响查询的性能。</p><p id="f402" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是我以前关于Polars数据框架的文章，供您参考:</p><div class="pc pd gp gr pe pf"><a rel="noopener follow" target="_blank" href="/getting-started-with-the-polars-dataframe-library-6f9e1c014c5c"><div class="pg ab fo"><div class="ph ab pi cl cj pj"><h2 class="bd iu gy z fp pk fr fs pl fu fw is bi translated">Polars数据帧库入门</h2><div class="pm l"><h3 class="bd b gy z fp pk fr fs pl fu fw dk translated">了解如何使用Polars dataframe库操作表格数据(并替换Pandas)</h3></div><div class="pn l"><p class="bd b dl z fp pk fr fs pl fu fw dk translated">towardsdatascience.com</p></div></div><div class="po l"><div class="pv l pq pr ps po pt ks pf"/></div></div></a></div><div class="pc pd gp gr pe pf"><a rel="noopener follow" target="_blank" href="/understanding-lazy-evaluation-in-polars-b85ccb864d0c"><div class="pg ab fo"><div class="ph ab pi cl cj pj"><h2 class="bd iu gy z fp pk fr fs pl fu fw is bi translated">理解Polars中的惰性求值</h2><div class="pm l"><h3 class="bd b gy z fp pk fr fs pl fu fw dk translated">了解什么是急切执行和延迟执行，以及如何使用延迟执行来优化查询</h3></div><div class="pn l"><p class="bd b dl z fp pk fr fs pl fu fw dk translated">towardsdatascience.com</p></div></div><div class="po l"><div class="pw l pq pr ps po pt ks pf"/></div></div></a></div><div class="pc pd gp gr pe pf"><a rel="noopener follow" target="_blank" href="/visualizing-polars-dataframes-using-plotly-express-8da4357d2ee0"><div class="pg ab fo"><div class="ph ab pi cl cj pj"><h2 class="bd iu gy z fp pk fr fs pl fu fw is bi translated">使用Plotly Express可视化Polars数据帧</h2><div class="pm l"><h3 class="bd b gy z fp pk fr fs pl fu fw dk translated">了解如何绘制极坐标数据帧</h3></div><div class="pn l"><p class="bd b dl z fp pk fr fs pl fu fw dk translated">towardsdatascience.com</p></div></div><div class="po l"><div class="px l pq pr ps po pt ks pf"/></div></div></a></div><div class="pc pd gp gr pe pf"><a rel="noopener follow" target="_blank" href="/manipulating-values-in-polars-dataframes-1087d88dd436"><div class="pg ab fo"><div class="ph ab pi cl cj pj"><h2 class="bd iu gy z fp pk fr fs pl fu fw is bi translated">处理极坐标数据框中的值</h2><div class="pm l"><h3 class="bd b gy z fp pk fr fs pl fu fw dk translated">学习如何使用Polars中的各种方法来操作数据框</h3></div><div class="pn l"><p class="bd b dl z fp pk fr fs pl fu fw dk translated">towardsdatascience.com</p></div></div><div class="po l"><div class="py l pq pr ps po pt ks pf"/></div></div></a></div></div></div>    
</body>
</html>