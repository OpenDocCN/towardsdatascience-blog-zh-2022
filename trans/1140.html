<html>
<head>
<title>Multithreading and Multiprocessing in 10 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">10 分钟内完成多线程和多处理</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/multithreading-and-multiprocessing-in-10-minutes-20d9b3c6a867#2022-03-24">https://towardsdatascience.com/multithreading-and-multiprocessing-in-10-minutes-20d9b3c6a867#2022-03-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5cbc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Python 示例简化了多任务处理</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/52955591f7bc94fbc11746c8e9a74978.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dA3OefeoPUPeI35u"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">默里·坎贝尔在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="bf7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">多线程和多处理是实现多任务的两种方式(想想分布式计算！)在 Python 中。<strong class="lb iu"> <em class="lv">多任务</em> </strong>在并行运行函数和代码时很有用，比如将数学计算分解成多个更小的部分，或者在一个 for 循环中拆分彼此独立的项。本文将介绍和比较多线程和多处理之间的区别，何时使用每种方法，以及如何在 Python 中实现它们。</p><p id="e599" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">更新</em> </strong> <em class="lv">:本文是系列文章的一部分。查看其他“10 分钟内”话题</em> <a class="ae ky" href="https://medium.com/@kayjanwong/list/in-10-minutes-eeaa9aa67055" rel="noopener"> <em class="lv">此处</em> </a> <em class="lv">！</em></p><h1 id="ffdd" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">目录</h1><ol class=""><li id="c0a9" class="mo mp it lb b lc mq lf mr li ms lm mt lq mu lu mv mw mx my bi translated"><a class="ae ky" href="https://medium.com/p/20d9b3c6a867/#6517" rel="noopener">多线程与多处理</a></li><li id="09d2" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><a class="ae ky" href="https://medium.com/p/20d9b3c6a867/#99ae" rel="noopener">多线程作为 Python 函数</a></li><li id="95d9" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><a class="ae ky" href="https://medium.com/p/20d9b3c6a867/#7fda" rel="noopener">作为 Python 类的多线程</a></li><li id="f20f" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><a class="ae ky" href="https://medium.com/p/20d9b3c6a867/#4123" rel="noopener">作为 Python 函数的多重处理</a></li></ol><h1 id="6517" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">多线程与多处理</h1><p id="aee3" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">根据正式定义，<strong class="lb iu"> <em class="lv">多线程</em> </strong>是指处理器并发执行多个线程的能力，其中每个线程运行一个进程。而<strong class="lb iu"> <em class="lv">多处理</em> </strong>指的是系统并发运行多个处理器的能力，其中每个处理器可以运行一个或多个线程。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/b3555909417ed076851a576aa24695dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hZ3guTdmDMXevFiT5Z3VrA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 1:多线程与多处理的对比——作者图片</p></figure><p id="b7e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从上图中，我们可以看到在多线程中(中间的图)，多个线程共享相同的代码、数据和文件，但运行在不同的寄存器和堆栈上。多重处理(右图)使单个处理器倍增，复制代码、数据和文件，这会产生更多开销。</p><p id="71f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">多线程对于<strong class="lb iu"> <em class="lv"> IO 绑定进程</em> </strong>很有用，比如从网络或数据库读取文件，因为每个线程可以并发运行 IO 绑定进程。多重处理对于 CPU 受限的进程 很有用，例如计算量大的任务，因为它将受益于拥有多个处理器；类似于多核计算机比单核计算机工作得更快。</p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><p id="c8ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，对 CPU 受限的进程使用多线程可能会降低性能，因为竞争资源确保一次只能执行一个线程，并且在处理多个线程时会产生开销。</p><p id="ea0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，多重处理可以用于 IO 绑定的进程。然而，如上所述，管理多个进程的开销高于管理多个线程的开销。您可能会注意到，由于程序使用多个 CPU 内核，多处理可能会导致更高的 CPU 利用率，这是意料之中的。</p><h1 id="99ae" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">作为 Python 函数的多线程</h1><p id="f1e6" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">多线程可以使用 Python 内置库<code class="fe np nq nr ns b">threading</code>实现，并按以下顺序完成:</p><ol class=""><li id="cde6" class="mo mp it lb b lc ld lf lg li nt lm nu lq nv lu mv mw mx my bi translated">创建线程:每个线程都用它的参数标记到一个 Python 函数</li><li id="39ba" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">开始任务执行</li><li id="187f" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">等待线程完成执行:有助于确保完成或“检查点”</li></ol><p id="ff01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的代码片段中，实现了上面的步骤，以及一个线程锁(第 22 行)来处理竞争资源，这在我们的例子中是可选的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="c998" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有一些值得注意的观察</p><ul class=""><li id="225c" class="mo mp it lb b lc ld lf lg li nt lm nu lq nv lu ny mw mx my bi translated">第 12–15 行:进程在不同的线程(线程 ID)上运行，但是使用相同的处理器(进程 ID)</li><li id="f55f" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu ny mw mx my bi translated">第 8 行:如果在获取和释放锁之间实现<code class="fe np nq nr ns b">time.sleep(sleep_duration)</code>,线程将按顺序运行，不会节省任何时间——您可以试试！</li></ul><h1 id="7fda" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">作为 Python 类的多线程</h1><p id="ce9a" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">对于喜欢面向对象编程的用户来说，多线程可以作为一个继承自<code class="fe np nq nr ns b">threading.Thread</code>超类的 Python 类来实现。使用类而不是函数的一个好处是能够通过类对象共享变量。</p><p id="2018" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将多线程实现为函数和类的区别在于第 1 步(创建线程)，因为线程现在被标记为类方法而不是函数。调用<code class="fe np nq nr ns b">t1.start()</code>和<code class="fe np nq nr ns b">t1.join()</code>的后续步骤保持不变。</p><pre class="kj kk kl km gt nz ns oa bn ob oc bi"><span id="b15f" class="od lx it ns b be oe of l og oh">import time<br/><br/>class Sleep(threading.Thread):<br/>    def __init__(self, sleep_duration):<br/>        self.sleep_duration = sleep_duration<br/><br/>    def sleep(self):<br/>        time.sleep(self.sleep_duration)<br/><br/>if __name__ == "__main__":<br/>    # Create thread<br/>    sleep_class = Sleep(2)<br/>    t1 = threading.Thread(target=sleep_class.sleep)</span></pre><h1 id="4123" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">作为 Python 函数的多重处理</h1><p id="69b8" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">多重处理可以通过 Python 内置库<code class="fe np nq nr ns b">multiprocessing</code>使用两种不同的方法实现——进程和池。</p><p id="960f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">进程</em> </strong>方法类似于上面的多线程方法，其中每个进程都用其参数标记为一个函数。在下面的代码片段中，我们可以看到多处理比多线程花费的时间更长，因为运行多个处理器的开销更大。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="8888" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv"> Pool </em> </strong>方法允许用户定义工作进程的数量，以先进先出的调度方式将所有进程分配给可用的处理器，自动处理进程调度。池方法用于使用<code class="fe np nq nr ns b">map</code>或<code class="fe np nq nr ns b">starmap</code>(第 19 行)将一个函数分成多个小部分——用不同的输入参数运行同一个函数。而 Process 方法用于运行不同的功能。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><p id="3da3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望本文介绍了多线程和多重处理的概念，以及何时使用每种方法。Python 示例是可以用您的函数替换的框架代码片段，您已经准备好了！</p><p id="f604" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">感谢您的阅读！如果你喜欢这篇文章，请随意分享。</strong></p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h1 id="c8e7" class="lw lx it bd ly lz oi mb mc md oj mf mg jz ok ka mi kc ol kd mk kf om kg mm mn bi translated">相关链接</h1><p id="1118" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">【https://docs.python.org/3/library/threading.html】Python 文档:<a class="ae ky" href="https://docs.python.org/3/library/threading.html" rel="noopener ugc nofollow" target="_blank">T2</a></p><p id="40ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe np nq nr ns b">multiprocessing</code> Python 文档:<a class="ae ky" href="https://docs.python.org/3/library/multiprocessing.html" rel="noopener ugc nofollow" target="_blank">https://docs.python.org/3/library/multiprocessing.html</a></p></div></div>    
</body>
</html>