<html>
<head>
<title>Broadcasting Operations in Pandas Explained</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫广播业务解释</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/broadcasting-operations-in-pandas-explained-f8e00af73963#2022-09-07">https://towardsdatascience.com/broadcasting-operations-in-pandas-explained-f8e00af73963#2022-09-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8b61" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解Pandas中的应用、应用映射和聚合函数的作用</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/ebeb6febcdb4e897546a3e673d0726e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*0GhGD3v1gpUubH3e"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">来自<a class="ae ku" href="https://www.pexels.com/ko-kr/photo/6120182/" rel="noopener ugc nofollow" target="_blank">像素</a>的免费使用照片</p></figure><h1 id="4e62" class="kv kw it bd kx ky kz la lb lc ld le lf jz lg ka lh kc li kd lj kf lk kg ll lm bi translated">介绍</h1><p id="c6d4" class="pw-post-body-paragraph ln lo it lp b lq lr ju ls lt lu jx lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">Apply、Applymap和Aggregate函数经常用于以用户期望的方式转换变量或整个数据。我个人将这些函数称为“广播函数”，因为它们允许我们向变量或数据中的所有数据点广播某种逻辑，比如说自定义函数。在本文中，我将向您解释这三个函数的不同之处，并通过一些例子来说明这些观点。我们使用标志性的<a class="ae ku" href="https://www.kaggle.com/c/titanic" rel="noopener ugc nofollow" target="_blank">泰坦尼克号灾难数据集</a>作为例子。具体来说，我使用了拥有公共许可证的<a class="ae ku" href="https://www.openml.org/search?type=data&amp;sort=runs&amp;id=40945&amp;status=active" rel="noopener ugc nofollow" target="_blank"> OpenML </a>中的数据集。</p><p id="3598" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">我们首先导入pandas包，并将titanic训练数据存储在一个名为“df”的变量中。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="1a58" class="mt kw it mp b gy mu mv l mw mx"><strong class="mp iu"># Dataset Source: </strong><a class="ae ku" href="https://www.openml.org/search?type=data&amp;sort=runs&amp;id=40945&amp;status=active" rel="noopener ugc nofollow" target="_blank"><strong class="mp iu">OpenML</strong></a><strong class="mp iu">; License(CC): Public</strong></span><span id="dea2" class="mt kw it mp b gy my mv l mw mx"><strong class="mp iu">import </strong>pandas <strong class="mp iu">as </strong>pd<br/>df = pd.read_csv("../input/titanic/train.csv")</span></pre><h1 id="4fab" class="kv kw it bd kx ky kz la lb lc ld le lf jz lg ka lh kc li kd lj kf lk kg ll lm bi translated">应用</h1><p id="ce6c" class="pw-post-body-paragraph ln lo it lp b lq lr ju ls lt lu jx lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">简单地说，pandas中的apply函数是一个变量级函数，您可以应用各种转换来转换一个变量。在这里，您可以利用lambda函数或自定义函数来创建您想要应用的转换逻辑。例如，如果出于某种原因，您希望将“Fare”变量乘以100，您可以运行以下代码:</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="5844" class="mt kw it mp b gy mu mv l mw mx">df['Fare'] = df['Fare'].apply(lambda x: x * 100)</span></pre><p id="5cf1" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">有了这个想法，你就可以执行各种很酷的转换，只要你能够明智地按照你想要的方式精确地设计lambda或自定义函数。下面是一个代码示例，它从一些xxxx/mm/dd格式的字符串日期中提取月和日信息。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="67da" class="mt kw it mp b gy mu mv l mw mx">data['last_review_month'] = data['last_review'].apply(lambda x: datetime.datetime.strptime(x, "%Y-%m-%d").month)</span><span id="4dae" class="mt kw it mp b gy my mv l mw mx">data['last_review_day'] = data['last_review'].apply(lambda x: datetime.datetime.strptime(x, "%Y-%m-%d").day)</span></pre><h1 id="d3d1" class="kv kw it bd kx ky kz la lb lc ld le lf jz lg ka lh kc li kd lj kf lk kg ll lm bi translated">应用地图</h1><p id="e015" class="pw-post-body-paragraph ln lo it lp b lq lr ju ls lt lu jx lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">Applymap函数是apply的所有数据版本，其中转换逻辑应用于数据中的每个数据点(例如，数据视图中的每个单元格)。</p><p id="dffa" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">假设我们想把所有乘客的名字都改成小写。出于演示目的，让我们创建一个单独的数据帧，它是原始数据帧的子集，其中只有“Name”变量。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="28b6" class="mt kw it mp b gy mu mv l mw mx">df_name = df.copy()[['Name']]</span><span id="27f0" class="mt kw it mp b gy my mv l mw mx">df_name.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/f47164b54c2a4c5fbf4d9c482adde6e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/format:webp/1*of6Bttvm56sEqTFdSfpGqw.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">来源:作者</p></figure><p id="fddd" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">现在，我们使用Applymap函数来完成我们想要的。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="0616" class="mt kw it mp b gy mu mv l mw mx">df_name = df_name.applymap(lambda x: x.lower() if type(x) == str else x)</span></pre><p id="0370" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">注意，if-else语句可以像上面一样在lambda函数中编写。你可以在下面看到所有的名字现在都是小写！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/4c700771e1c0ad9b44eec4f77d2e0897.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*LQusl_OaG9WHl7mLO_WA_Q.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">来源:作者</p></figure><p id="4a39" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">假设我们想将类别(字符串格式)替换成相应的整数。我们可以使用Applymap函数来实现这一点吗？尽管Apply函数可能与此更相关，但我们仍然可以使用Applymap函数来实现相同的结果。</p><p id="7392" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">我们有一本字典，把性别，男性和女性分别映射到0和1。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="1368" class="mt kw it mp b gy mu mv l mw mx">mapping = {"male":0, "female":1}</span><span id="b7f5" class="mt kw it mp b gy my mv l mw mx">df.applymap(mapping.get)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nb"><img src="../Images/888b2db8642679f3161031b6cce98c68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*geIEQ6ZT67TG6UPg1xhObA.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">来源:作者</p></figure><p id="0541" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">从上面的输出可以看出，如上所述，Applymap函数将转换逻辑应用于每个变量中的每个数据点。因此，我们看到所有其他与“性别”变量无关的细胞都被替换为无。我们不希望这样。为了实现我们想要的，我们可以设计lambda函数，仅当单元格中的值是映射键之一时才替换这些值，在本例中，映射键是字符串“男性”和“女性”。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="44f0" class="mt kw it mp b gy mu mv l mw mx">df.applymap(lambda x: mapping[x] if x in mapping.keys() else x)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi ng"><img src="../Images/3a0ccd9726798032f66670490d2550ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rcT6oFlalm0ywvpVXKM00Q.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">来源:作者</p></figure><p id="560e" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">现在我们看到，只有“性别”变量发生了变化，而其他变量保持不变。</p><h2 id="6ae4" class="mt kw it bd kx nh ni dn lb nj nk dp lf lw nl nm lh ma nn no lj me np nq ll nr bi translated">聚合</h2><p id="b5d3" class="pw-post-body-paragraph ln lo it lp b lq lr ju ls lt lu jx lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">最后但同样重要的是，与Apply和Applymap函数不同，Aggregation函数返回一个新的dataframe，其中包含用户指定的汇总统计信息。汇总汇总统计是指包括最大值、最小值、均值、中值和众数的统计。在这里，我们计算乘客的平均年龄、最大年龄和存活率。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="9f4c" class="mt kw it mp b gy mu mv l mw mx">df.groupby("Pclass").agg(avg_age = ("Age", "mean"),<br/>                        max_age = ("Age", "max"), <br/>                        survival_rate = ("Survived", "mean"))</span></pre><p id="ee32" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">从上面的代码片段中可以看出，将aggregation函数与Groupby函数结合使用，可以成为计算不同数据点组的聚合的强大工具。</p><h1 id="7cb8" class="kv kw it bd kx ky kz la lb lc ld le lf jz lg ka lh kc li kd lj kf lk kg ll lm bi translated">结论</h1><p id="c16b" class="pw-post-body-paragraph ln lo it lp b lq lr ju ls lt lu jx lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">在本文中，我使用了Titanic Disaster数据集来说明三个最常用的转换/广播函数的作用以及它们之间的区别。请继续关注我关于数据清理、机器学习、深度学习、自然语言处理等方面的更多文章。</p><p id="c794" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">如果你觉得这篇文章有帮助，请考虑通过以下链接注册medium来支持我: )</p><p id="c9ea" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated"><a class="ae ku" href="https://joshnjuny.medium.com/membership" rel="noopener">joshnjuny.medium.com</a></p><p id="c778" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">你不仅可以看到我，还可以看到其他作者写的这么多有用和有趣的文章和帖子！</p><h1 id="2ffd" class="kv kw it bd kx ky kz la lb lc ld le lf jz lg ka lh kc li kd lj kf lk kg ll lm bi translated">关于作者</h1><p id="85a0" class="pw-post-body-paragraph ln lo it lp b lq lr ju ls lt lu jx lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated"><em class="ns">数据科学家。加州大学欧文分校信息学专业一年级博士生。</em></p><p id="4509" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated"><em class="ns">密歇根大学刑事司法行政记录系统(CJARS)经济学实验室的前研究领域专家，致力于统计报告生成、自动化数据质量审查、构建数据管道和数据标准化&amp;协调。Spotify前数据科学实习生。Inc .(纽约市)。</em></p><p id="bc51" class="pw-post-body-paragraph ln lo it lp b lq mj ju ls lt mk jx lv lw ml ly lz ma mm mc md me mn mg mh mi im bi translated">他喜欢运动、健身、烹饪美味的亚洲食物、看kdramas和制作/表演音乐，最重要的是崇拜我们的主耶稣基督。结帐他的 <a class="ae ku" href="http://seungjun-data-science.github.io" rel="noopener ugc nofollow" target="_blank"> <em class="ns">网站</em> </a> <em class="ns">！</em></p></div></div>    
</body>
</html>