<html>
<head>
<title>Build a Docker Image for Jupyter Notebooks and run on Cloud’s VertexAI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为 Jupyter 笔记本构建 Docker 映像，并在 Cloud 的 VertexAI 上运行</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-docker-image-for-jupyter-notebook-and-run-on-clouds-vertexai-9bd97c48c52d#2022-12-12">https://towardsdatascience.com/build-docker-image-for-jupyter-notebook-and-run-on-clouds-vertexai-9bd97c48c52d#2022-12-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d243" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 Docker、Bash、Scheduler、Pub/Sub 和 Function 在 Google 云平台中自动运行任何 Python 脚本</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2ce809d710e6fa4453390f531a337aa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_nXRRLlpRQAWPkFz45-4zg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用码头集装箱装运你的应用程序</p></figure><p id="134f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您是否已经成功地在本地编写了一个 Python 应用程序，现在想要将其带到云中？这是一个简单易懂的详尽的一步一步的教程，讲述了如何将 Python 脚本转换成 Docker 映像并将其推送到 Google Cloud Registry。在 Google 云平台中，可以通过 Pub/Sub 在 VertexAI 中自动调用这个 Docker 镜像。本教程是在 Windows 计算机上创建的，但是对于 Linux 或 Mac，基本步骤是相同的。在本文的最后，您将能够在您的操作系统上创建自己的 Docker 映像，并在 VertexAI 中自动触发 Python 脚本。</p><p id="69d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你将经历什么:</p><ul class=""><li id="c0c8" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">安装“Docker 桌面”</li><li id="c1f3" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">Docker 映像和容器:构建、标记、运行和推送到 GCloud</li><li id="9dfd" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">通过 Bash、Scheduler、Pub/Sub 和 Function 自动运行 GCloud 的 VertexAI 中的任何 Python 脚本</li></ul><h1 id="20c1" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">初期状况</h1><p id="64ad" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">此目录结构中有以下文件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/6db7d6ef3c2f21717d4d8ac07e247e6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:452/format:webp/1*cUDUnTcI35npYlWdVmgTUg.png"/></div></figure><p id="b610" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Sourcecode 文件夹包含 Jupyter 笔记本“dockerVertexai”和“input.csv”文件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/9c50904b29a071e78690969269f2e224.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/1*t3gns-NVWwQCUrCE9eGOsg.png"/></div></figure><p id="10f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Jupyter 笔记本本身只是一个很小的 Python 应用程序:</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="fd47" class="nn mk it nj b be no np l nq nr">import pandas as pd<br/>df=pd.read_csv('input.csv')<br/>df['Output'] ='Now With Output added'<br/>df.to_csv('output.csv')</span></pre><p id="acef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个脚本所做的只是导入一个名为“input”的 csv 文件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/2edeb364587d913cf6397010aff4657e.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*xkEu_ngf1gyM1EKHZSaCZQ.png"/></div></figure><p id="5009" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">..向该数据帧添加新列“Output”，并将结果导出为新文件“output.csv”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/d680908b98948bff0bdba7aea2671755.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*JfRPw-7RMr0Z7BA1qSLByA.png"/></div></figure><p id="15a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管这可能不是世界上最令人印象深刻的脚本，但它对您以后在 VertexAI 中轻松确认功能非常有用。此外，希望这个脚本为常见的“hello world Flask Docker”示例提供一个有用的扩展。尽管这个脚本非常简单，但它向您展示了如何不仅使用源代码文件，而且还使用 cloud 的 notebook 实例中的其他输入输出文件。有了这些知识，在云中使用 Python 就没有任何限制。</p><h1 id="7ee5" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">准备<strong class="ak"> : </strong></h1><p id="86cd" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">如果还没有，您需要在开始构建 Docker 映像之前下载 Docker Desktop:</p><div class="nu nv gp gr nw nx"><a href="https://www.docker.com/products/docker-desktop/" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd iu gy z fp oc fr fs od fu fw is bi translated">Docker 桌面</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">安装 Docker 桌面-最快的容器化应用程序的方式。Docker 订阅服务协议有…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">www.docker.com</p></div></div><div class="og l"><div class="oh l oi oj ok og ol ks nx"/></div></div></a></div><p id="9c04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦下载了(在本例中是 Windows)版本，您只需打开应用程序即可启动 Docker Desktop:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/8fd5ada0782ed448434a34bceb54c1d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lrdEQ8RpQrsbWTdK903WdQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">等待 Docker 桌面启动(图片由作者提供)</p></figure><p id="a55b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于我们的目的，我们不需要做任何事情，只是启动 Docker 桌面。</p><p id="fb37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一个准备步骤是 Dockerfile 文件。</p><h1 id="a8bf" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">Dockerfile 文件</h1><p id="e887" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">先看看 docker 文件:</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="99ad" class="nn mk it nj b be no np l nq nr">FROM gcr.io/deeplearning-platform-release/base-cpu:latest<br/><br/># RUN pip install torch # you can pip install any needed package like this<br/><br/>RUN mkdir -p /Sourcecode <br/><br/>COPY /Sourcecode /Sourcecode </span></pre><p id="0573" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Dockerfile 定义稍后运行实例时将使用哪个 vm(虚拟机)映像。在这种情况下，你可以选择深度学习-平台-发布。</p><p id="0d67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果需要任何额外的 Python 包，也可以在这里安装 pip(例如，运行 pip install python-dotenv)。因为您将只使用 Pandas(它已经随 deeplearning-platform-release 一起提供)，所以没有必要 pip 安装它。</p><p id="5bdf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦实例稍后启动并运行，命令“run mkdir -p /Sourcecode”将创建一个新文件夹“Sourcecode”。</p><p id="a56e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">dockerfile 中的最后一个命令将把所有文件从 Sourcecode 文件夹(这是您本地机器上的路径中的文件夹，稍后您将从这里构建 docker 映像)复制到正在运行的实例中新创建的 Sourcecode 文件夹中(您将在几个步骤中再次看到这一点)。</p><h1 id="bf33" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">Dockerignore</h1><p id="7972" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">此外，您还可以选择存储一个 Dockerignore 文件。这是为了排除执行 Python 代码不需要的包。这样做的目的是使图像尽可能小，而不是构建不必要的包。</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="97fe" class="nn mk it nj b be no np l nq nr">__pycache__<br/>Sourcecode/temp</span></pre><p id="d77a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Dockerignore 与本教程的后续步骤无关。</p><p id="8c27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要构建 Docker 映像，您还可以使用 Requirement.txt 文件。在本文中，您不会使用这种方法，但是如果您感兴趣的话，您可能想阅读这篇文章(链接)。</p><p id="c436" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为最后的准备(在开始 Docker 构建之前)，您需要在 Google 云平台中部署一个项目。</p><h1 id="3453" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">谷歌云项目</h1><p id="bdd9" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我想你已经是这样了。如果你不知道怎么做，你可能会发现这是一个有用的<a class="ae ky" href="https://cloud.google.com/appengine/docs/standard/nodejs/building-app/deploying-web-service" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><p id="4e23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="on">在这一点上，我的建议是复制 ProjectId，因为在本教程中你会多次用到它。本例中 GCP 的项目 ID 是:social sensition-XYZ</em></p><h1 id="dea0" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">命令行界面(CLI)</h1><p id="497a" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">gcloud (Google Cloud)命令行界面是创建和管理 Google Cloud 资源的主要 CLI 工具。CLI 工具从命令行以及脚本和其他自动化中执行许多常见的平台任务。如果你还没有下载 CLI，你可以在这里找到说明<a class="ae ky" href="https://cloud.google.com/sdk/docs/install" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="ceeb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将首先初始化一个配置，以便能够在命令行中使用您的 Google Cloud 项目:</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="3b02" class="nn mk it nj b be no np l nq nr">gcloud init</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/13dee0470cf7773c38286c2be56f31a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q6ijPDOSk5bQzoJdM1xgag.png"/></div></div></figure><p id="bf47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用您现有的帐户登记:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/f69367fae2e2da7d9b483b357a31f023.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OaPvUplFH0lDMmRw-r9VSg.png"/></div></div></figure><p id="1058" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">..最后选择合适的项目编号(如果有的话)。</p><h1 id="a902" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">为项目启用工件注册</h1><p id="f0df" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">默认情况下，工件注册对于新项目是不可用的。所以必须先启用它(否则无法发布到 GCloud Artifact Registry)。</p><p id="04ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要启用工件注册，请执行以下命令:</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="d93a" class="nn mk it nj b be no np l nq nr">gcloud services enable artifactregistry.googleapis.com</span></pre><p id="5edc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并添加一个存储库主机名列表，如 europe-west3-docker.pkg.dev:</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="980b" class="nn mk it nj b be no np l nq nr">gcloud auth configure-docker europe-west3-docker.pkg.dev</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/7e2f9377a285e1334bd6bc2ab2370ccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8wsFrSPO_VCkegamUfnpwA.png"/></div></div></figure><p id="ae9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很好，您已经完成了所有准备工作，所以您终于可以开始构建 Docker 了。</p><h1 id="b80c" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">Docker 映像构建</h1><p id="519a" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在您的终端中，移动到存储本地文件的文件夹，并输入:</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="4562" class="nn mk it nj b be no np l nq nr">docker build --tag python-docker .</span></pre><p id="c5a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意圆点前的空格。</p><p id="1ddf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你收到一个错误信息，如“Docker 守护进程没有运行”，这可能是因为你忘记启动 Docker 桌面应用程序。只需启动 Docker-Desktop(就像开头提到的那样)，然后重新运行 docker build 命令。</p><p id="1b4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大楼后..：</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/71cdbaa98a6d3f98d35f37bfa11c87b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qqmmumsgrtwMgxnu_gRmeQ.png"/></div></div></figure><p id="045e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">..已完成:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/ca272c96255ca74657520bc72edeac97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w9vwNzKAnMFErwdVXapZdw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/59f199746e85471f653734ef86f97b4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZQLYsw1NH9s0rZTUZWILFQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如果您没有在 docker 文件中添加命令，将不会有“运行 pip 安装”命令</p></figure><p id="d6ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">..Docker 映像已经启动并运行。您还可以通过查看 Docker 桌面应用程序获得额外的保证:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/fd6a418a8677302a72a02894beaaf85c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4dR_DB2B9qwVkActErMmEw.png"/></div></div></figure><p id="735c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者您也可以在您的终端中交叉检查:</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="b477" class="nn mk it nj b be no np l nq nr">docker images</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/a36375a75af21f2cdcd0c04944fa2ea7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DTkJfTZynYtf1MH7f1-8rA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">您将需要在下一步中标记 ImageID(按作者标记图像)</p></figure><h1 id="0326" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">Docker 图像标签</h1><p id="49c9" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">从上面的 Docker images 命令中复制并粘贴 ImageID，并将其用作 Docker 标签。其次，您需要为您的 Google Cloud 项目复制路径。这包括 Google Cloud 的项目 ID(<em class="on">social senement-XYZ</em>)和存储库(工件设置中的名称):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/36027905df7f4f963c639dbc2eced91e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fHZ6zK1qcx8mxjzjwLj_KA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用你的项目 id(图片由作者提供)替换<em class="ox">社会感知空白(社会感知-XYZ)</em></p></figure><h1 id="a04b" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">码头运行</h1><p id="1311" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">尽管这一步与我们没有进一步的关联，但为了完整起见，还是简单地提一下。</p><p id="d064" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只需使用 run 将您的映像作为容器运行:</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="e4fd" class="nn mk it nj b be no np l nq nr">docker run python-docker</span></pre><h1 id="0ffe" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">工件储存库</h1><p id="556b" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">很抱歉，在这一点上还有另一个交叉引用。但到目前为止，我们还没有在 GCloud 平台中创建工件库。但是在你推广 Docker 形象之前，这是非常重要的。幸好这是儿戏:</p><p id="4c5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您必须创建一个存储库来上传工件。在您的案例 Docker 中，每个存储库可以包含受支持格式的工件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/a83ff4bf25404a9a7e875a7120eefa9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nT0u866h_78PsiCMY4qeaw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我将这个存储库称为“tweetimentrep”(图片由作者提供)</p></figure><p id="6744" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择一个适合自己的地区。对我来说，那就是法兰克福:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/935a5994e5bbba213c50f6a3c340c37b.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*ajC_VApEeckH2xSAfU0lyg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">谷歌推荐工件而不是容器注册表，这就是我们选择它们的原因</p></figure><p id="83f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:在继续之前，请确保您确实已经在您的 GCloud 工件中创建了一个存储库名称:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/a819509e7863d747a407e0049f8307fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yJWilRzh8gP5hMAXfNVbXA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如果存储库存在，您只能标记 python-docker 图像(按作者分类的图像)</p></figure><p id="84a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="on">很抱歉出现不一致:当下面提到 tweetiment-xyz 时，指的是同一个项目 social sensition-XYZ。</em></p><h1 id="2d64" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">Docker 图像标签</h1><p id="d23a" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">现在继续并相应地标记您的设置:</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="1881" class="nn mk it nj b be no np l nq nr">docker tag 4f0eac4b3b65 europe-west3-docker.pkg.dev/tweetiment-xyz/tweetimentrep/python-docker</span></pre><p id="79f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是你标记 Docker 图像的简单方式。</p><p id="5092" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您已经标记了 Docker 图像，您可以将它推入 GCP 的注册表中:</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="23ae" class="nn mk it nj b be no np l nq nr">docker push europe-west3-docker.pkg.dev/tweetiment-xyz/tweetimentrep/python-docker</span></pre><p id="b282" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您收到类似以下内容的消息:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/f5fbd7c0243509febaad9ebc498c940a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tOL95PnrJygfXypGItrMzw.png"/></div></div></figure><p id="e229" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">..这仅仅意味着您必须激活工件注册 API(并且不要忘记给它一个存储库名称，否则您将不能正确地标记和推送您的 Docker 映像)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/7be7e548620b7a762798cd092ad99298.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*Z3Nhi7BAHUn9vtqwqiJkSw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">以可伸缩和集成的方式存储和管理工件(作者图片)</p></figure><p id="c99b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以重新运行 push 命令。如果 API 仍然没有激活，只需等待几分钟，直到它激活。</p><p id="fcfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">推送准备就绪后:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/29652da5ff5e2a4704a9531511655a4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5_vjQYvpnNEhMQ31oxZU5A.png"/></div></div></figure><p id="b91c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将能够在您的工件注册表中看到它:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/8b455710ed5e6d1e818e118295c1aba1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ik4Ra9QAhtb2qhhNua9HCw.png"/></div></div></figure><p id="f833" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很好，您已经将 Python 代码及其文件夹结构和内容作为 Docker 映像传输到 Google Cloud 了！这意味着你可以在谷歌云中创建一个笔记本，在那里你可以手动运行 Jupyter 笔记本(或者 Python。py 代码)。</p><h1 id="d2c1" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">韦尔泰赛</h1><p id="d753" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">了解如何手动创建笔记本实例是很有帮助的。如果不知道如何，这个链接应该是<a class="ae ky" href="https://cloud.google.com/vertex-ai/docs/tutorials/jupyter-notebooks" rel="noopener ugc nofollow" target="_blank">支持</a>。但是学习如何自动运行这样的实例更令人兴奋。要做到这一点，首先看一下一旦创建了实例，如何在 VertexAI 实例中自动运行 Python 脚本。为此，使用一个 bash 脚本(一个. sh 文件)。</p><h1 id="17cf" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">Bash 脚本</h1><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="9d8f" class="nn mk it nj b be no np l nq nr">#!/bin/bash<br/># copy sourcode files from docker container to vm directory<br/>sudo docker cp -a payload-container:/Sourcecode/ /home/jupyter<br/>sudo -i<br/>cd /home/jupyter/Sourcecode<br/># Execute notebook<br/>ipython -c “%run dockerVertexai.ipynb”</span></pre><p id="640e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在将 startup script.sh 上传到您的云存储桶中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/1a438068d547cd6a392c0529f7df0669.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XpPawV_EADPh8LjJq5ukfg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">云存储是一种托管服务，用于存储(非)结构化数据(图片由作者提供)</p></figure><p id="5687" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转到 VertexAI 并激活 VertexAI API 和笔记本 API(如果还没有激活的话)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/e126841bbd1aa23ba6bff51d885a770d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WS2vLLnN_O2QcJiKjeSxcg.png"/></div></div></figure><p id="d083" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在工作台中，单击“新笔记本”，并从顶部选择“定制”作为第一个选项:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/0b77dfdf1f3b72b18f1b204833557069.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oDIgz-uYq_tgKKBH5S1ZWQ.png"/></div></div></figure><p id="876e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一个表单中，从工件注册表中选择您的容器映像。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/c53028d52751bd73a1d17c16b2c20407.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*qxLDq_uM10dD9YfP4fPNCg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">通常你会选择最常用的版本(图片由作者提供)</p></figure><p id="c613" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外，不要忘记选择一个脚本在创建后运行。这将是你。sh 文件，这是您几分钟前刚刚保存在存储桶中的文件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/b5c7f3389c9c573c504a3864ae966493.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/format:webp/1*HgztSJZo9p7PA7xoE-HDJA.png"/></div></figure><p id="be6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你可以走了:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/54a1a2dc4ae9d56b26726f7faf3b2044.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*VXte3dd122yvZelKBh38PA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">现在，您已经准备好创建 Jupyter 实验室，它还支持 Jupyter 笔记本(图片由作者提供)</p></figure><p id="d109" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">多亏了启动脚本，Jupyter 笔记本在 Jupyter 实验室实例启动时被自动执行。因为存在 output.csv(以前不存在)，所以您可以确保脚本运行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/fec33f4eafb0080be544035c07dada4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yCjr5UNJnLMWefgRln6Oew.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">瞧，output.csv 已经自动生成(图片由作者提供)</p></figure><p id="977b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很好，脚本被自动执行并创建了一个输出文件。但是不幸的是，这个输出文件没有被持久化。所以最好把这个文件保存在云存储中。也就是在我们之前创造的桶里。</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="9355" class="nn mk it nj b be no np l nq nr">from google.cloud import storage # Imports the Google Cloud client library<br/>storage_client = storage.Client() # Instantiates a client<br/>BUCKET_NAME =’socialsenti’<br/>blob_name=’output.csv’<br/>storage_client = storage.Client()<br/>bucket = storage_client.bucket(BUCKET_NAME)<br/>blob = bucket.blob(blob_name)<br/>with blob.open(“w”) as f:<br/> f.write(“Output file has been saved into your bucket”)<br/>with blob.open(“r”) as f:<br/> print(f.read())</span></pre><p id="7452" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将此文件添加到 Jupyter 笔记本的一个新单元中，您将看到输出文件随后会保存在您的存储桶中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pm"><img src="../Images/3a3020d9232c817aaf16e0b62621c746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iVnw4T8U7HM11PrmeiE0Ew.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如果您想保存结果，请将其保存到存储器中(图片由作者提供)</p></figure><p id="cdf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那更好。但是仍然有一个可能的优化。因为直到现在，实例一直在运行，即使结果(输出文件)已经创建。因此，您需要一种方法在脚本结束时关闭虚拟机(最终 VertexAI 只使用 Google 计算引擎 GCE ),这样您就不会产生更多的备用成本。</p><p id="b1cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们进入自动化的下一步。现在，您将从终端通过命令创建实例，而不是手动启动实例:</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="d264" class="nn mk it nj b be no np l nq nr">gcloud notebooks instances create instancetweetiment - container-repository=europe-west3-docker.pkg.dev/tweetiment-xyz/tweetimentrep/python-docker - container-tag=latest - machine-type=n1-standard-4 - location=us-central1-b - post-startup-script="gs://socialsenti/default-startup-script.sh"</span></pre><p id="5159" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，如果您愿意，您可以直接从 Jupyter 笔记本上运行它。</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="0a0d" class="nn mk it nj b be no np l nq nr">from google.cloud.notebooks_v1.types import Instance, VmImage, ContainerImage<br/>from google.cloud import notebooks_v1<br/>client = notebooks_v1.NotebookServiceClient()<br/>notebook_instance = Instance(container_image=ContainerImage(repository="europe-west3-docker.pkg.dev/tweetiment-xyz/tweetimentrep/python-docker",),machine_type="n1-standard-8",post_startup_script="gs://socialsenti/default-startup-script.sh")<br/>parent = "projects/tweetiment-xyz/locations/us-central1-a"<br/>request = notebooks_v1.CreateInstanceRequest(parent=parent,instance_id="notetweeti",instance=notebook_instance,)<br/>op = client.create_instance(request=request)<br/>op.result()</span></pre><p id="a72e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了防止第一次运行时由于缺少身份验证而出现错误，请运行以下命令。这将创建凭据文件:</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="8df4" class="nn mk it nj b be no np l nq nr">gcloud auth application-default login</span></pre><p id="72ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该凭据文件通常存储在以下路径下:</p><p id="6156" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">% APPDATA % \ g cloud \ application _ default _ credentials . JSON</p><p id="ba00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以通过编程方式访问 GCP。如果您已经创建了一个笔记本(无论是手动的还是编程的)，那么您可以使用这个 Python 代码来读取它。Instance_Name 是笔记本本身的名称。这段摘录来自<a class="ae ky" href="https://cloud.google.com/python/docs/reference/notebooks/latest/google.cloud.notebooks_v1.services.notebook_service.NotebookServiceClient" rel="noopener ugc nofollow" target="_blank"> GCP 文档</a>:</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="2709" class="nn mk it nj b be no np l nq nr">from google.cloud import notebooks_v1<br/><br/>def sample_get_instance():<br/>    # Create a client<br/>    client = notebooks_v1.NotebookServiceClient()<br/>    # Initialize request argument(s)<br/>    request = notebooks_v1.GetInstanceRequest(<br/>        name="projects/tweetiment-xyz/locations/us-central1-a/instances/test", <br/>    )<br/>    # Make the request<br/>    response = client.get_instance(request=request)<br/>    # Handle the response<br/>    print(response)<br/>sample_get_instance()</span></pre><p id="4cc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想安排一个重复的 Python 脚本，你可以使用谷歌的云调度器，结合云功能和发布/订阅。</p><h1 id="932f" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">云调度程序</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/dfb6c078227f7ef4c83f5b25dd0ee3dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g_x7cSfvkHI_26L3JOwM5Q.png"/></div></div></figure><p id="1933" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择发布/订阅作为目标类型和适当的发布/订阅主题:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi po"><img src="../Images/0557823fc9735b5c5df2cea786a7fb4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*blpTeDb-aT1CbLKXX2ITCg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">您不需要输入邮件正文(作者图片)</p></figure><p id="f560" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以等待，直到调度程序变为活动状态。您也可以随时手动启动它进行测试。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/1e03028ebc9d3247a73808bc73436c81.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*p2xeuBaihzTr-XRDp8dmug.png"/></div></figure><p id="6f37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">计划者很好。但是有时您也希望在网页上执行一个动作后立即执行 Python 脚本。为此，云函数是一个不错的选择。</p><h1 id="c40e" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">云函数</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pq"><img src="../Images/48cc5498294c2993e6c6a476ac088dd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*ijtfAhnlUZcAgI4kQ-dEFA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">选择发布/订阅作为函数的触发器(图片由作者提供)</p></figure><p id="bac3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择 Python 作为运行时，并输入“TweetiNoteStartTopic”作为入口点。那个入口点也将是你的函数名。所以最终云函数看起来是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pr"><img src="../Images/fb3990b661eb0c5265ef695b6f135ac6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L5zuiSm9uHOy6NXF5vyTEg.png"/></div></div></figure><p id="e035" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在 requirements.txt 中，您可以根据需要放置所有依赖项:</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="fe06" class="nn mk it nj b be no np l nq nr"># Function dependencies, for example:<br/>google-cloud-notebooks&gt;=1.4.4<br/>google-cloud&gt;=0.34.0</span></pre><p id="8144" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的 main.py 可能类似于:</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="535f" class="nn mk it nj b be no np l nq nr">import base64<br/>from google.cloud.notebooks_v1.types import Instance,  ContainerImage<br/>from google.cloud import notebooks_v1<br/><br/>def TweetiNoteStartTopic(event, context):<br/>  client = notebooks_v1.NotebookServiceClient()<br/>  notebook_instance = Instance(container_image=ContainerImage(repository="europe-west3-docker.pkg.dev/tweetiment-xyz/tweetimentrep/python-docker",),machine_type="n1-standard-8",post_startup_script="gs://socialsenti/default-startup-script.sh")<br/>  parent = "projects/tweetiment-xyz/locations/us-central1-a"<br/>  request = notebooks_v1.CreateInstanceRequest(parent=parent,instance_id="notetweeti",instance=notebook_instance,)<br/>  op = client.create_instance(request=request)<br/>  op.result()<br/>  print("finished")</span></pre><h1 id="4cb3" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">发布/订阅</h1><p id="40de" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">请注意，您也可以随时触发您的云功能。只需转到 test 选项卡并输入以下 json:</p><p id="627a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">{ " data ":" TweetiNoteStartTopic " }</p><h1 id="df37" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">恭喜</h1><p id="45a1" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">您现在可以在云中以编程方式运行任何 Python 脚本了！要么直接通过云函数作为纯 Python 脚本，要么作为虚拟机上的 Docker 容器。是 VertexAI 让你在 Jupyter 实验室环境中运行 Jupyter 笔记本，而 Jupyter 实验室环境本身运行在谷歌云引擎(GCE)上的虚拟机上。感谢谷歌硬件——你可以在 VertexAI 上编程设置——几乎没有限制。或者你以前用过 96vCPU 和 360GB Ram 吗？我认为现在自豪地穿上你的<a class="ae ky" href="https://www.googlemerchandisestore.com/" rel="noopener ugc nofollow" target="_blank">谷歌云衬衫</a>是合理的:-)</p><p id="b40f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">非常感谢您的阅读！希望这篇文章对你有帮助。请随时在<a class="ae ky" href="https://de.linkedin.com/in/jesko-rehberg-40653883" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>、<a class="ae ky" href="https://twitter.com/DAR_Analytics" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或<a class="ae ky" href="https://jesko-rehberg.medium.com/virtual-reality-vr-for-education-a532aa5b6272" rel="noopener">工作室</a>与我联系。</p></div></div>    
</body>
</html>