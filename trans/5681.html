<html>
<head>
<title>Improve Your SQL Skills Using Pure Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用纯 Python 提高您的 SQL 技能</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/improve-your-sql-skills-using-pure-python-9e50736b3d9c#2022-12-23">https://towardsdatascience.com/improve-your-sql-skills-using-pure-python-9e50736b3d9c#2022-12-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8c30" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">而不需要安装任何东西。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/aa397b312540aa4845e0066f175282bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*073u9r-VCUJdM5Xka3fOmw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com/photos/hhUx08PuYpc?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@imkirk?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Iewek Gnos </a>拍摄的照片</p></figure><p id="c0b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你从事数据科学领域的工作，无论职位高低，SQL 都是你需要具备的最重要的技能之一。我会把它和 Python 一起放在前 3 名。</p><p id="5138" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我刚开始学习数据科学时，我发现建立一个练习 SQL 的环境有点困难。我需要安装一个数据库引擎和一个 IDE 来编写查询，如 MySQL Workbench 或 pgAdmin。</p><p id="9d51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">进行这种设置并不复杂，当你在数据科学领域找到一份工作时，你可能会使用这样的环境。然而，当你刚开始学习时，有一个更简单的练习方法。</p><p id="56b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个选项是 sqlite3，它是一个内置的 Python 模块。它提供了一个易于使用的 SQL 接口。sqlite3 模块基于 sqlite，这是一个 C 语言库，提供了一个轻量级的基于磁盘的数据库。</p><p id="8995" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然我们大多数人都是从安装 Python 开始数据科学之旅的，为什么不利用它来学习 SQL 呢？</p><p id="c213" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将通过几个示例来学习如何:</p><ul class=""><li id="27bb" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">创建数据库</li><li id="1481" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">创建表格</li><li id="c1e8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">填充表格</li><li id="1586" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">查询表格</li></ul><p id="2965" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用 sqlite3 模块。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="95c5" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">创建数据库</h1><p id="ee25" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">第一步是创建一个数据库。我们可以使用连接功能来完成这项任务。它用于连接数据库，如果数据库不存在，connect 函数也会创建它。</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="c091" class="ns mr it no b be nt nu l nv nw">import sqlite3<br/>con = sqlite3.connect("sample.db")</span></pre><p id="4918" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是创建数据库游标，这是执行 SQL 语句和获取结果所必需的。</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="cd54" class="ns mr it no b be nt nu l nv nw">cursor = con.cursor()</span></pre><p id="535b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用下面的查询和 fetchall 函数来查看这个数据库中的表。我们基本上是在查询内置的 sqlite_master 表。</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="6a7b" class="ns mr it no b be nt nu l nv nw">check_tables = """SELECT name FROM sqlite_master WHERE type='table';"""<br/>cursor.execute(check_tables)<br/>cursor.fetchall()<br/><br/># output<br/>[]</span></pre><p id="da17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为数据库不包含任何表，所以 fetchall 函数返回一个空列表。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="9d10" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">创建表格</h1><p id="548e" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">让我们创建一个表。我们将编写查询来创建一个表，然后使用游标来执行它。</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="0d63" class="ns mr it no b be nt nu l nv nw">create_products_table = """CREATE TABLE IF NOT EXISTS products (<br/>                                    id integer PRIMARY KEY,<br/>                                    category text NOT NULL,<br/>                                    price real,<br/>                                    cost real<br/>                                );"""<br/><br/>cursor.execute(create_products_table)</span></pre><p id="f9ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们再次检查示例数据库中的表。</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="f89b" class="ns mr it no b be nt nu l nv nw">check_tables = """SELECT name FROM sqlite_master WHERE type='table';"""<br/>cursor.execute(check_tables)<br/>cursor.fetchall()<br/><br/># output<br/>[('products',)]</span></pre><p id="b940" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在看到数据库中存在 products 表。</p><p id="8edf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用光标执行任何查询。例如，下面的代码片段执行查询来选择 products 表中的所有行，并将结果赋给一个名为 result 的变量。然后，对结果变量调用 fetchall 函数，以查看它包含的内容。</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="41ab" class="ns mr it no b be nt nu l nv nw">result = cursor.execute("SELECT * FROM products")<br/>result.fetchall()<br/><br/># output<br/></span></pre><p id="fd0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为 products 表是空的，所以它不返回任何内容。让我们使用 insert into 语句填充它。</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="9ba2" class="ns mr it no b be nt nu l nv nw">populate_products_table = """INSERT INTO products VALUES<br/>                                    (1001, 'A', 15.9, 12.9),<br/>                                    (1002, 'B', 24.9, 20.5),<br/>                                    (1003, 'A', 13.5, 10.6),<br/>                                    (1004, 'A', 17.5, 13.5),<br/>                                    (1005, 'B', 28.9, 23.5)<br/>                                ;"""<br/><br/>cursor.execute(populate_products_table)</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="bff7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意</strong>:insert 语句隐式打开一个事务，需要在修改保存到数据库之前提交。</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="0ab6" class="ns mr it no b be nt nu l nv nw">con.commit()</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="1681" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">products 表现在应该有 5 行。让我们通过执行上面的 select 语句来确认。</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="95a3" class="ns mr it no b be nt nu l nv nw">result = cursor.execute("SELECT * FROM products")<br/>result.fetchall()<br/><br/># output<br/>[(1001, 'A', 15.9, 12.9),<br/> (1002, 'B', 24.9, 20.5),<br/> (1003, 'A', 13.5, 10.6),<br/> (1004, 'A', 17.5, 13.5),<br/> (1005, 'B', 28.9, 23.5)]</span></pre><p id="6727" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，我们可以编写更高级的查询。例如，以下查询返回属于类别 a 的行。</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="2d2f" class="ns mr it no b be nt nu l nv nw">result = cursor.execute("SELECT * FROM products WHERE category='A'")<br/>result.fetchall()<br/><br/># output<br/>[(1001, 'A', 15.9, 12.9),<br/> (1003, 'A', 13.5, 10.6),<br/> (1004, 'A', 17.5, 13.5)]</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="ad07" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">创建熊猫数据框架的一行代码</h1><p id="ac9e" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">sqlite3 模块的一个好处是它兼容熊猫。因此，我们可以很容易地将查询结果写入 Pandas 数据帧。</p><p id="e715" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以用查询和连接对象调用熊猫的 read_sql_query 函数。</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="7c39" class="ns mr it no b be nt nu l nv nw">products = pd.read_sql_query("SELECT * FROM products", con)<br/><br/>products</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/edac5b96ffd3f22e8f67ebaba169dc4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WL-Dp1TJ6ll3Z2FTsTP_PQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">产品数据框架(图片由作者提供)</p></figure><p id="fa5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建另一个表并填充它。</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="06d6" class="ns mr it no b be nt nu l nv nw">create_customers_table = """CREATE TABLE IF NOT EXISTS customers (<br/>                                    id integer PRIMARY KEY,<br/>                                    customer id integer NOT NULL,<br/>                                    is_member integer NOT NULL,<br/>                                    purchase_date text,<br/>                                    purchased_product integer,<br/>                                    purchase_quantity integer<br/>                                );"""<br/><br/>populate_customer_table = """INSERT INTO customers VALUES<br/>                                    (1, 110, 0, "2022-12-23", 1002, 5),<br/>                                    (2, 112, 0, "2022-12-14", 1001, 4),<br/>                                    (3, 113, 1, "2022-12-08", 1003, 6),<br/>                                    (4, 113, 1, "2022-12-14", 1002, 4),<br/>                                    (5, 114, 0, "2022-12-21", 1004, 10)<br/>                                ;"""<br/><br/>cursor.execute(create_customers_table)<br/>cursor.execute(populate_customer_table)<br/><br/>con.commit()</span></pre><p id="0d15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以用 customers 表创建一个数据框架，如下所示:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="e37b" class="ns mr it no b be nt nu l nv nw">customers = pd.read_sql_query("SELECT * FROM customers", con)<br/><br/>customers</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/4b9ccb4cced73022847f5de460ad3a80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m84DNG79OHPiCuUgDfnsyQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">客户数据框架(图片由作者提供)</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="28c2" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">更复杂的查询</h1><p id="0281" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">让我们编写一个查询，从 products 和 customers 表中检索数据。它将包括一个连接语句。</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="2417" class="ns mr it no b be nt nu l nv nw">query = '''<br/>        SELECT<br/>            customer_id,<br/>            purchased_product,<br/>            purchase_quantity,<br/>            price<br/>        FROM customers c<br/>        LEFT JOIN products p ON c.purchased_product = p.id<br/>        '''<br/>cursor.execute(query)<br/>cursor.fetchall()<br/><br/># output<br/>[(110, 1002, 5, 24.9),<br/> (112, 1001, 4, 15.9),<br/> (113, 1003, 6, 13.5),<br/> (113, 1002, 4, 24.9),<br/> (114, 1004, 10, 17.5)]</span></pre><p id="cb8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用 description 属性查看查询输出中的列名:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="05d9" class="ns mr it no b be nt nu l nv nw">cursor.description<br/><br/># output<br/>(('customer_id', None, None, None, None, None, None),<br/> ('purchased_product', None, None, None, None, None, None),<br/> ('purchase_quantity', None, None, None, None, None, None),<br/> ('price', None, None, None, None, None, None))<br/><br/># save the names in a Python list using list comprehension<br/>col_names = [description[0] for description in cursor.description]<br/><br/>col_names<br/><br/># output<br/>['customer_id', 'purchased_product', 'purchase_quantity', 'price']</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="98f4" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">关闭连接</h1><p id="c31a" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我们可以使用 close 方法来关闭当前到数据库的连接。</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="c0c1" class="ns mr it no b be nt nu l nv nw">con.close()</span></pre><p id="3ae3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了验证更改是否保存在数据库中，我们可以创建一个新的连接并编写一个查询来进行检查。</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="5f62" class="ns mr it no b be nt nu l nv nw">con = sqlite3.connect("sample.db")<br/>cursor = con.cursor()<br/>result = cursor.execute("SELECT * FROM products")<br/>result.fetchall()<br/><br/># output<br/>[(1001, 'A', 15.9, 12.9),<br/> (1002, 'B', 24.9, 20.5),<br/> (1003, 'A', 13.5, 10.6),<br/> (1004, 'A', 17.5, 13.5),<br/> (1005, 'B', 28.9, 23.5)]</span></pre><p id="9df6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，更改保存在 sample.db 数据库中。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="90be" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">结论</h1><p id="f1dc" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">sqlite3 模块为实践 SQL 提供了一个易于使用的环境，这对于在数据科学生态系统中工作的几乎所有人来说都至关重要。</p><p id="3644" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不必安装任何额外的工具或数据库引擎，这使得使用 sqlite3 更加令人鼓舞。此外，将查询结果保存到 Pandas 数据框架中只需要一行代码。我认为这是一个很棒的特性，因为 Pandas 是使用最广泛的数据操作和分析工具。</p><p id="6542" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nz">你可以成为</em> <a class="ae ky" href="https://sonery.medium.com/membership" rel="noopener"> <em class="nz">媒介会员</em> </a> <em class="nz">解锁我的全部写作权限，外加其余媒介。如果你已经是了，别忘了订阅</em><a class="ae ky" href="https://sonery.medium.com/subscribe" rel="noopener"><em class="nz"/></a><em class="nz">如果你想在我发表新文章时收到电子邮件。</em></p><p id="9c39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>