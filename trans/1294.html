<html>
<head>
<title>Tricks for DataPane Embedding with Medium</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用介质嵌入数据面板的技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tricks-for-datapane-embedding-with-medium-9b47d1d319e0#2022-03-31">https://towardsdatascience.com/tricks-for-datapane-embedding-with-medium-9b47d1d319e0#2022-03-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4a70" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">MTA 乘客可视化</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f495819f4e71888c6cd3fdf79f5ae2bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*yVN1fHDrJjGvTyd_NgX6xg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Meagan V .的数据面板图表示例</p></figure><p id="9338" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">大约两年前，<a class="lu lv ep" href="https://medium.com/u/84a02493194a?source=post_page-----9b47d1d319e0--------------------------------" rel="noopener" target="_blank"> Khuyen Tran </a>发表了一篇关于在 Python 中使用<a class="ae lw" rel="noopener" target="_blank" href="/introduction-to-datapane-a-python-library-to-build-interactive-reports-4593fd3cb9c8"> Datapane 的文章。基于她的教程，我继续做了一个我自己的小项目，用一个</a><a class="ae lw" href="https://data.ny.gov/Transportation/MTA-Daily-Ridership-Data-Beginning-2020/vxuj-8kew" rel="noopener ugc nofollow" target="_blank">开源数据集</a>包含了自 2020 年以来 MTA 每天的乘客数据。</p><p id="4ac9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">今天，我将向您介绍我的项目教程，希望其他人能够发现这个免费工具的价值。</p><p id="cf68" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，Datapane 是一个 Python 库，可以用来构建交互式报告。我发现它类似于 Plotly Chart Studio。不幸的是，当要将这些图形嵌入到中等大小的文章中时，Datapane 不能很好地适应中等大小的更宽的图形，这很像 Chart Studio 的缺点。</p><p id="c8e2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，就 UX 而言，我发现使用 Datapane 的过程比 Chart Studio 容易得多。例如，Datapane 使得开始执行基本代码变得非常简单。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lx"><img src="../Images/da1be9490b9dea578fa07162023ccffc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*weHG0aHjzk6PnttiypA6qA.png"/></div></div></figure><p id="6968" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">基本上，您只需要几行代码就可以开始制作您的第一个交互式图形。首先，您必须使用 pip 或 conda 安装 datapan，但之后只需导入适当的库:</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="b155" class="md me it lz b gy mf mg l mh mi">import pandas as pd</span><span id="f7be" class="md me it lz b gy mj mg l mh mi">import altair as alt</span><span id="3729" class="md me it lz b gy mj mg l mh mi">import datapane as dp</span></pre><p id="439c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，您真的可以将任何您想要的数字包装到一个数据面板报告中。语法遵循一个基本模板:</p><p id="8191" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">dp。报告(<br/> dp。剧情(Plot)，<br/> dp。数据表(df) <br/>)。上传(name=NAME，open=True)</p><p id="bba4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您所要做的就是创建一个您想要显示的图形/绘图/图表，并用您的图形名称替换上面代码中的(绘图)。添加数据表是可选的。在我的报告中，我决定不在我的图下面显示数据表。如果你选择了那条路，就走吧</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="5163" class="md me it lz b gy mf mg l mh mi">dp.DataTable(df)</span></pre><p id="1ad7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">既然我们已经介绍了基础知识，让我们进入我的项目——可视化从 2020 年至今的 MTA 日客流量。</p><p id="f83e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我需要做的第一件事是在 google colab 中加载我的数据，并适当地格式化它。</p><p id="7fd5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我知道我想按天绘制数据图表，但我也想对每天的数据重新取样。为此，首先我必须将索引设置为 datetime。</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="d1c7" class="md me it lz b gy mf mg l mh mi">df['Date2']=pd.to_datetime(df['Date'])<br/>df=df.set_index(df['Date2'])</span></pre><p id="7593" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，由于我的数据跨越了过去两年的每一天，我知道用图表表示每一个数据点是不可行的。因此，我用下面的代码按月重新采样。</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="a4d8" class="md me it lz b gy mf mg l mh mi">df.resample('M').mean()</span></pre><p id="3af7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我选择了均值重采样，因为我的数据既包括原始乘客数，也包括与典型的疫情前一天的百分比比较。因此，如果我使用一个总和来重新取样，我的百分比就会有偏差。</p><p id="4357" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我知道我想使用 plotly 来创建我的交互式图表，所以我必须导入正确的库。</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="bf2a" class="md me it lz b gy mf mg l mh mi">import plotly.graph_objects as go</span><span id="fea0" class="md me it lz b gy mj mg l mh mi">from plotly.subplots import make_subplots</span></pre><p id="24f4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">具体来说，我需要制作支线剧情，因为我的数据被分成不同的类别。我有地铁数据、公交数据和桥梁/隧道数据。我决定要在 3 行 1 列中显示我的数据，定义如下。</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="e236" class="md me it lz b gy mf mg l mh mi">fig = make_subplots(specs=[[{'secondary_y': True}], [{'secondary_y': True}],</span><span id="81b6" class="md me it lz b gy mj mg l mh mi">[ {'secondary_y': True}]], rows=3, cols=1, subplot_titles=('Subways',  'Buses', 'Bridges and Tunnels'))</span></pre><p id="60e3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如您所见，我还必须指定我想要创建一个辅助 y 轴。这是因为与疫情之前的百分比相比，乘客数量将处于不同的规模。</p><p id="21eb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我有 6 组数据要绘制:</p><ol class=""><li id="46fc" class="mk ml it la b lb lc le lf lh mm ll mn lp mo lt mp mq mr ms bi translated">地铁乘客量</li><li id="8d21" class="mk ml it la b lb mt le mu lh mv ll mw lp mx lt mp mq mr ms bi translated">2.地铁百分比比较</li><li id="0e1e" class="mk ml it la b lb mt le mu lh mv ll mw lp mx lt mp mq mr ms bi translated">公共汽车乘客量</li><li id="5894" class="mk ml it la b lb mt le mu lh mv ll mw lp mx lt mp mq mr ms bi translated">总线百分比比较</li><li id="6413" class="mk ml it la b lb mt le mu lh mv ll mw lp mx lt mp mq mr ms bi translated">桥梁/隧道交通</li><li id="9ce3" class="mk ml it la b lb mt le mu lh mv ll mw lp mx lt mp mq mr ms bi translated">桥梁/隧道百分比比较</li></ol><p id="7ae0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是我用来为我的图形创建每个轨迹的基本模板:</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="80f8" class="md me it lz b gy mf mg l mh mi">fig.add_trace(go.Scatter(x=df['Date'], y=df['Subways: Total Estimated Ridership'], name = 'Subways: Total Estimated Ridership',</span><span id="df2a" class="md me it lz b gy mj mg l mh mi">line=dict(color='black', width=1, dash='solid')), secondary_y=False, row=1, col=1)</span></pre><p id="771d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如您所见，我通过 X 和 y 值、系列名称、线条样式、是否使用辅助 y 轴以及行/列号来指定。</p><p id="5e64" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">每个额外的轨迹都是相似的，但我只是更新了 y 值、名称、线条颜色和破折号、辅助 y 轴和行/列。例如，下一个轨迹是用于地铁百分比比较的，所以我必须更改一些东西，如下所示:</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="fa6c" class="md me it lz b gy mf mg l mh mi">fig.add_trace(go.Scatter(x=df['Date'], y=df[ 'Subways: % of Comparable Pre-Pandemic Day'], name =  'Subways: % of Comparable Pre-Pandemic Day',</span><span id="8eb2" class="md me it lz b gy mj mg l mh mi">line=dict(color='blue', width=1, dash='dash')), secondary_y=True, row=1, col=1)</span></pre><p id="74b0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了继续其他 4 个跟踪，我遵循相同的格式。一旦我添加完六个轨迹，我就为我的图表设置了最终的格式。</p><p id="796f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我设置标题和轴标签:</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="0b3a" class="md me it lz b gy mf mg l mh mi">fig.update_layout(title_text='MTA Daily Ridership', title_x=0.4,</span><span id="e1f2" class="md me it lz b gy mj mg l mh mi">xaxis_title='Date')</span><span id="4301" class="md me it lz b gy mj mg l mh mi">fig.update_yaxes(title_text="Daily Ridership", secondary_y=False)</span><span id="e645" class="md me it lz b gy mj mg l mh mi">fig.update_yaxes(title_text="% of Comparable Pre-Pandemic Day", secondary_y=True)</span></pre><p id="993d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">之后，只是设置我的尺寸，填充和显示图形。</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="d3fc" class="md me it lz b gy mf mg l mh mi">fig.update_layout(</span><span id="c1f7" class="md me it lz b gy mj mg l mh mi">autosize=False,</span><span id="28d0" class="md me it lz b gy mj mg l mh mi">width=1800,</span><span id="1cd6" class="md me it lz b gy mj mg l mh mi">height=1200,</span><span id="38f6" class="md me it lz b gy mj mg l mh mi">margin=dict(</span><span id="a22a" class="md me it lz b gy mj mg l mh mi">l=50,</span><span id="1478" class="md me it lz b gy mj mg l mh mi">r=50,</span><span id="ba4b" class="md me it lz b gy mj mg l mh mi">b=100,</span><span id="ef8d" class="md me it lz b gy mj mg l mh mi">t=100,</span><span id="bf69" class="md me it lz b gy mj mg l mh mi">pad=0</span><span id="4614" class="md me it lz b gy mj mg l mh mi">),)</span><span id="5e42" class="md me it lz b gy mj mg l mh mi">fig.show()</span></pre><p id="a74c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为我使用了 plotly，所以我能够轻松地将我的静态绘图导出为 png，如下所示。然而，下一步是将它包装在一个 datapane 对象中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/74f99e03895d81fa357eb35ae0f86fc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3sTNPtsV51Lvzk2yMI5Duw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">梅根 V 的静态图</p></figure><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="14ef" class="md me it lz b gy mf mg l mh mi">dp.Report(</span><span id="a87b" class="md me it lz b gy mj mg l mh mi">dp.Plot(fig)</span><span id="706f" class="md me it lz b gy mj mg l mh mi">).upload(name="MTA Ridership")</span></pre><p id="4673" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就这样——只有三行代码和我的图表就可以发布到 datapane 了。不幸的是，正如我前面所说的，默认大小不适用于 Medium 格式。原始的嵌入图表看起来很糟糕。你看不到整个图表，你不能滚动，缩放被关闭，等等。</p><p id="6b42" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，我进入数据面板编辑模式，并通过改变响应和规模设置硬编码。</p><p id="897d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">默认情况下，responsive 被设置为 true，但是在一个更宽的图表的情况下，您可能需要将它更改为 false，并更新您的比例以获得您的支线剧情的正确大小。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/09b8b83811236b9a094583e496b7d39a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*8Pl9wmW1YRdhlnqN4NDDYA.png"/></div></figure><p id="1fec" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这改进了绘图，但是我发现在 python 代码中将 responsive 设置为 False 允许在嵌入时从左向右滚动。</p><p id="c061" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这需要一些策略，但最终我得到了下面的情节:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="5cbd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在线报道的链接在这里:<a class="ae lw" href="https://datapane.com/u/meagan/reports/O7vEn13/mta-ridership/" rel="noopener ugc nofollow" target="_blank">https://data pane . com/u/meagan/reports/o7ven 13/MTA-rider ship/</a></p><p id="35b1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，datapane 允许您将图表保存为 html 文件。你要做的就是替换。上传(…)</p><p id="6d28" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用下面的代码</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="7cd8" class="md me it lz b gy mf mg l mh mi">.save(path='report.html', open=True)</span></pre><p id="4fd3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这就是我关于 datapane 和 python 入门的简单教程。尽管嵌入在 Medium 上没有成功，但我喜欢与 datapane 的其他集成，比如 LinkedIn posting、Twitter posting 和 Github。</p><p id="6846" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">点击此处查看 datapane 提供的所有功能:</p><p id="3428" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae lw" href="https://datapane.com/home/" rel="noopener ugc nofollow" target="_blank">https://datapane.com/home/</a></p></div></div>    
</body>
</html>