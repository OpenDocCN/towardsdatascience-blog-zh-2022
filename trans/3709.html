<html>
<head>
<title>Introduction to SQL Window Functions: Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL窗口函数简介:第1部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/fundato-sql-window-functions-part-1-ab61df519973#2022-08-17">https://towardsdatascience.com/fundato-sql-window-functions-part-1-ab61df519973#2022-08-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="695c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为数据科学面试做好准备</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/f7594ac30ace5c0bd0658d3d17d80887.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*oE9F0hMmmaydXw8w-NFZ2w.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">SQL窗口函数(图片由作者提供)</p></figure><h2 id="b971" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">背景</h2><p id="40c1" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">窗口函数对于用几行代码有效地执行数据操作是非常有用的，这也是为什么你会在几乎每个数据科学访谈中发现一个关于窗口函数的问题。</p><p id="e1fc" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">这是SQL窗口函数系列的第1部分。在这篇博客中，我们将学习SQL窗口函数的基本原理及其应用。</p><h2 id="6c73" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated"><strong class="ak">为什么需要窗口功能？</strong></h2><p id="b19e" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">假设我们有一个组织内员工的工资数据。下表显示了数据:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/cff5d22d10c91de91232d3f0ef22e96a.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*8iDW-TtVjAliR9J0mnaQDQ.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">员工表(作者图片)</p></figure><p id="fa74" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">现在，假设我们要向该数据表添加2列:</p><ol class=""><li id="0600" class="mp mq it ls b lt mj lw mk ld mr lh ms ll mt mi mu mv mw mx bi translated">TOTAL:该列包含所有员工的工资总额。这等于薪水栏的总和。</li><li id="07b4" class="mp mq it ls b lt my lw mz ld na lh nb ll nc mi mu mv mw mx bi translated">TOTAL_JOB:该列包含与某一行相对应的工作角色(数据科学家、数据分析师、数据工程师)中所有雇员的工资总额。例如，对于“JOB”为数据科学家的行，TOTAL_JOB列等于12，000(数据科学家的工资总和:3800+4900+3300)。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/eb0e44410945628fa6b1cf866c4e9349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*WCdJ2cCCPrw3xol0_T9RQg.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">向雇员表中添加列(按作者排序的图像)</p></figure><p id="daa0" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">我们可以在不执行分组和自连接的情况下添加这些列吗？</p><p id="4c30" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated"><strong class="ls iu">是的，</strong>我们使用<strong class="ls iu">窗口函数很容易做到这一点。</strong></p><h2 id="133b" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated"><strong class="ak">SQL中的窗口函数是什么？</strong></h2><p id="950f" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">window函数对数据表中的一行或多行执行计算，并将值返回给表中的所有行。与聚合函数(使用GROUP BY子句)不同，在聚合函数中，单个行会“丢失”，而窗口函数不会将多行的结果组合成一行，并且每一行都保留其原始身份。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ne"><img src="../Images/632ebdcd41f5ed16087dcba51e98350c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vDGtsxNY82kUFbjFPV-OrQ.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">聚合函数与窗口函数(图片由作者提供)</p></figure><h2 id="d1e9" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">窗口函数的语法</h2><p id="fb66" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">以下是窗口函数的语法:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="627e" class="ku kv it nk b gy no np l nq nr">SELECT<br/>&lt;column_1&gt;, &lt;column_2&gt;,<br/><strong class="nk iu">&lt;window_function&gt;(expression)OVER<br/>(PARTITION BY&lt;partition_list&gt; <br/>ORDER BY&lt;order_list&gt;)</strong><br/>FROM<br/>&lt;table_name&gt;</span></pre><p id="1965" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">让我们详细了解一下每个关键词:</p><ul class=""><li id="b0f1" class="mp mq it ls b lt mj lw mk ld mr lh ms ll mt mi ns mv mw mx bi translated"><strong class="ls iu">窗口函数</strong>是我们希望应用的窗口函数的名称，如sum、mean、行号等。</li><li id="2060" class="mp mq it ls b lt my lw mz ld na lh nb ll nc mi ns mv mw mx bi translated"><strong class="ls iu">表达式</strong>是应用窗口函数的列名。根据我们使用的窗口功能，这可能是必需的，也可能不是必需的。例如，行号窗口函数不需要表达式。</li><li id="cee8" class="mp mq it ls b lt my lw mz ld na lh nb ll nc mi ns mv mw mx bi translated"><strong class="ls iu"> OVER </strong>简单表示该函数是窗口函数。</li><li id="4ede" class="mp mq it ls b lt my lw mz ld na lh nb ll nc mi ns mv mw mx bi translated"><strong class="ls iu"> PARTITION BY </strong>对数据表的行进行分区，允许我们定义利用哪些行来计算窗口函数。</li><li id="b1fe" class="mp mq it ls b lt my lw mz ld na lh nb ll nc mi ns mv mw mx bi translated"><strong class="ls iu">分区列表</strong>是我们想要进行分区的列的名称。对于PARTITION BY子句，这是必需的。</li><li id="0d96" class="mp mq it ls b lt my lw mz ld na lh nb ll nc mi ns mv mw mx bi translated"><strong class="ls iu"> ORDER BY </strong>用于对每个分区内的行进行排序。这是一个可选条款。</li><li id="3fa9" class="mp mq it ls b lt my lw mz ld na lh nb ll nc mi ns mv mw mx bi translated"><strong class="ls iu"> Order list </strong>是要排序的列的名称，对于ORDER BY子句是必需的。</li></ul><h2 id="26dc" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">一些例子</h2><p id="e6ed" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">要查看窗口函数的运行情况，让我们看几个例子:</p><ol class=""><li id="8bff" class="mp mq it ls b lt mj lw mk ld mr lh ms ll mt mi mu mv mw mx bi translated"><strong class="ls iu"> OVER子句没有被</strong>分割</li></ol><p id="e0b9" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">要添加一个包含employee表中所有雇员薪金总和的列(TOTAL ),我们将使用sum函数作为窗口函数，使用salary列作为表达式，并使用OVER()子句。</p><p id="6d79" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">因为我们正在查找所有雇员(行)的薪金总和，所以不需要对数据进行分区。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nt"><img src="../Images/f8727a3619a981bbaf3ebffd0b2e1b82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dkYe7Rp2RF8AQMnym_w7KA.png"/></div></div></figure><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="1213" class="ku kv it nk b gy no np l nq nr">## SQL Query<br/>select EMPID, NAME, JOB, SALARY, <br/><strong class="nk iu">sum(SALARY) over() as TOTAL<br/></strong>FROM<br/>employee_table</span></pre><p id="d1db" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">2.<strong class="ls iu"> OVER子句用</strong>进行划分</p><p id="02fa" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">现在，要添加一个列，其中包含与某行相对应的工作角色(数据科学家、数据分析师、数据工程师)中所有员工的总工资，我们需要按列job对数据进行分区。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/fd0de619ae8b139416b6d1d00b142ffb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*DxFAhkX1nTkZLqFna8ykjg.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">Job列上的数据分区(图片由作者提供)</p></figure><p id="8675" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">为了获得输出，我们将使用sum函数作为窗口函数，salary列作为表达式，在OVER()子句中，我们将按JOB列对数据表进行分区。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nv"><img src="../Images/15ab4bb976fdb45d3121da3626a16502.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q3whDOTOdoKtS3eP1nMAYQ.png"/></div></div></figure><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="9bc3" class="ku kv it nk b gy no np l nq nr">## SQL Query<br/>select EMPID, NAME, JOB, SALARY, <br/><strong class="nk iu">sum(SALARY) over(partition by</strong> <strong class="nk iu">JOB)<br/>as TOTAL_JOB<br/></strong>FROM<br/>employee_table</span></pre><h2 id="3994" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">结论</h2><p id="a4f5" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">因此，我们研究了如何使用SQL中的window函数轻松地将聚合值添加到表的所有行中。</p><p id="0107" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">我们可以创建跨所有行以及跨行分区的汇总列，而不会丢失表中的原始行。</p></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><h2 id="0e3e" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">谢谢大家！</h2><p id="cafa" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">你可以在收件箱里看到我所有的帖子。 <a class="ae oe" href="https://anmol3015.medium.com/subscribe" rel="noopener"> <strong class="ls iu"> <em class="od">在这里做</em> </strong> <em class="od">！</em> </a> <em class="od"> <br/>如果你喜欢体验媒介的自己，可以考虑通过</em> <a class="ae oe" href="https://anmol3015.medium.com/membership" rel="noopener"> <strong class="ls iu"> <em class="od">报名会员来支持我和其他成千上万的作家。它每个月只需要5美元，它极大地支持了我们，作家，而且你也有机会通过你的写作赚钱。</em></strong></a></p></div></div>    
</body>
</html>