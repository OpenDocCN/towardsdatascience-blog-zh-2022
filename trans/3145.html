<html>
<head>
<title>An Open-Source Tool to Change Data Validation As You Know It</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">众所周知，这是一个改变数据验证的开源工具</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/an-open-source-tool-to-change-data-validation-as-you-know-it-7d6fcb5e9301#2022-07-11">https://towardsdatascience.com/an-open-source-tool-to-change-data-validation-as-you-know-it-7d6fcb5e9301#2022-07-11</a></blockquote><div><div class="fc ij ik il im in"/><div class="io ip iq ir is"><div class=""/><div class=""><h2 id="5460" class="pw-subtitle-paragraph js iu iv bd b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj dk translated">data-diff如何节省您验证数据模型的时间</h2></div><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/9bc003dacb1ce1215b6052a4a2f6fa4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W9wFQqfZ_eKHVA0372gaIQ.jpeg"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">莱娜·科勒在<a class="ae la" href="https://unsplash.com/s/photos/barrier?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="6f0c" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">如果您曾经不得不将您的数据仓库迁移到一个新的平台或帐户，那么您就会知道这是多么耗时和痛苦。最近，我不得不将我的数据从一个雪花帐户迁移到另一个帐户，重新配置所有的数据接收管道和编排。您很快就会意识到一个小小的变化可能(并且将会)破坏您的数据管道中的一切。</p><p id="db23" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">随着整个管道的迁移，需要检查迁移是否正确。</p><ul class=""><li id="9a5d" class="lx ly iv ld b le lf lh li lk lz lo ma ls mb lw mc md me mf bi translated">您如何知道所有的源数据都作为原始数据被接收到您的数据仓库中呢？</li><li id="dc50" class="lx ly iv ld b le mg lh mh lk mi lo mj ls mk lw mc md me mf bi translated">您如何知道您的数据模型配置正确？</li><li id="fdfc" class="lx ly iv ld b le mg lh mh lk mi lo mj ls mk lw mc md me mf bi translated">你的表格中的数据看起来和其他仓库中的一样吗？</li></ul><p id="c746" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">问题层出不穷。回答这些问题的唯一方法是通过数据验证。</p><p id="da55" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">如果你曾经验证过任何东西，那么你应该很清楚要花多少时间。这是乏味的，不用动脑筋的，而且相当烦人。作为分析工程师，验证是我们最不想做的事情。我们希望把时间花在解决棘手的问题、构建有洞察力的数据模型以及优化我们的数据管道上。没有验证一切看起来像预期的那样。</p><p id="d50c" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">验证数据通常看起来像编写一堆计算行数和某些值的基本查询。有时它甚至意味着用相同的主键比较特定的行。我不知道你怎么样，但我只能坚持几个小时，然后我的眼睛就会疲劳，数字也会变得模糊。那么，如果有更好的方法呢？一个既能节省您宝贵时间，又能完成您需要的验证的解决方案？终于有了！而且，完全免费。</p><h1 id="3d2d" class="ml mm iv bd mn mo mp mq mr ms mt mu mv kb mw kc mx ke my kf mz kh na ki nb nc bi translated">Datafold的开源data-diff是什么？</h1><p id="bc37" class="pw-post-body-paragraph lb lc iv ld b le nd jw lg lh ne jz lj lk nf lm ln lo ng lq lr ls nh lu lv lw io bi translated">作为比较数据模型中代码变化的Datafold的超级粉丝，我非常兴奋地了解到这个团队正在创建的开源工具。data-diff是一个开源命令行工具和Python库，用于比较两个不同数据库中的行。它允许您在同一个数据仓库平台内或跨两个不同平台比较数据库，使其成为用于任何类型迁移的理想工具。</p><p id="6490" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">以下是您可以比较的几个数据库:</p><ul class=""><li id="e793" class="lx ly iv ld b le lf lh li lk lz lo ma ls mb lw mc md me mf bi translated">一种数据库系统</li><li id="f2a3" class="lx ly iv ld b le mg lh mh lk mi lo mj ls mk lw mc md me mf bi translated">关系型数据库</li><li id="7a73" class="lx ly iv ld b le mg lh mh lk mi lo mj ls mk lw mc md me mf bi translated">雪花</li><li id="b21c" class="lx ly iv ld b le mg lh mh lk mi lo mj ls mk lw mc md me mf bi translated">神谕</li><li id="39b7" class="lx ly iv ld b le mg lh mh lk mi lo mj ls mk lw mc md me mf bi translated">BigQuery</li><li id="b7ee" class="lx ly iv ld b le mg lh mh lk mi lo mj ls mk lw mc md me mf bi translated">红移</li><li id="5cf1" class="lx ly iv ld b le mg lh mh lk mi lo mj ls mk lw mc md me mf bi translated">数据砖</li></ul><p id="b6d7" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">如果你想看完整的名单，你可以在这里查看<a class="ae la" href="https://github.com/datafold/data-diff" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="c864" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">这个工具的工作原理是将表分成更小的块，然后对正在比较的两个数据库中的每个块进行校验和检查。它在表级别工作，允许您比较相同或不同数据库中的两个表。校验和检查会继续，直到工具找到不同的行。然后，它将输出两个数据库之间不同的行，节省您手动查找它们的时间。</p><p id="d629" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">该工具不仅可以用于在数据迁移过程中比较数据库，还可以用于几乎所有的数据验证场景。在使用Airbyte和Fivetran等工具时，您可以使用它来比较从关系数据库和数据仓库(如Snowflake)获取的数据。当数据丢失时，您可以使用它来创建数据质量检查。您甚至可以使用它来帮助跟踪使用硬删除删除的数据行。</p><h1 id="20ae" class="ml mm iv bd mn mo mp mq mr ms mt mu mv kb mw kc mx ke my kf mz kh na ki nb nc bi translated">如何使用数据差异</h1><p id="f948" class="pw-post-body-paragraph lb lc iv ld b le nd jw lg lh ne jz lj lk nf lm ln lo ng lq lr ls nh lu lv lw io bi translated">Datafold有一个Github <a class="ae la" href="https://github.com/datafold/data-diff" rel="noopener ugc nofollow" target="_blank"> repo </a>，里面有如何使用这个命令行工具的所有说明。我将向您介绍我做了什么，在这个过程中我遇到了一些问题，以及我是如何解决这些问题的。请记住，我是在比较两个不同雪花账户的表格。幸运的是，我在每个帐户中都设置了相同的用户、角色和仓库，这使得配置变得更加容易。</p><h2 id="eb0a" class="ni mm iv bd mn nj nk dn mr nl nm dp mv lk nn no mx lo np nq mz ls nr ns nb nt bi translated">创造URI</h2><p id="aa83" class="pw-post-body-paragraph lb lc iv ld b le nd jw lg lh ne jz lj lk nf lm ln lo ng lq lr ls nh lu lv lw io bi translated">最大的障碍是编写在命令行工具中使用的连接字符串。这些连接字符串包含关键信息，如数据库用户、密码、帐户、数据库、模式、仓库和角色。在Snowflake以外的数据库中，您只需要您的用户名、密码和主机名。</p><p id="2db5" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">雪花URI看起来像这样:</p><p id="0bc3" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><code class="fe nu nv nw nx b">snowflake://user:password@account/database/SCHEMA?warehouse=WAREHOUSE&amp;role=role</code></p><p id="a470" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">您将运行的命令是:</p><p id="4d83" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><code class="fe nu nv nw nx b">data-diff DB1_URI TABLE1_NAME DB2_URI TABLE2_NAME [OPTIONS]</code></p><p id="a129" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">如您所见，这非常简单。您只需要安装data-diff包以及适用于您的数据库类型的相应驱动程序。</p><p id="6691" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><code class="fe nu nv nw nx b">pip install ‘data-diff[snowflake]’</code></p><p id="0eac" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">完成后，您就可以为每个数据库编写URI了。</p><p id="455b" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">以下是我用在自己身上的:</p><p id="a97a" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><strong class="ld iw">用户名和密码</strong></p><p id="2a5d" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">我使用我的dbt用户和密码进行测试，但是我强烈建议只为data-diff包或任何类型的开源工具创建一个用户。</p><p id="7007" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><strong class="ld iw">账户名称</strong></p><p id="d7ed" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">当你点击雪花账户右上角的用户名时，账户应该是下拉列表中粗体显示的id或昵称。确保包含您所在的地区和提供商。我没有包括这一点，我调试URI的时间太长了。因此，如果您的帐户是madisonprod.central-us.azure，您可以使用<strong class="ld iw">madisonprod . central-us . azure</strong>作为您的帐户。</p><p id="2329" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><strong class="ld iw">数据库和模式</strong></p><p id="bd1a" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">这只是您要比较的表所在的数据库和模式的名称。请记住，这些可能会因帐户或数据库而异。在我的例子中，我的两个表都位于数据库base和模式WEB_DBO中。</p><p id="17ec" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><strong class="ld iw">仓库和角色</strong></p><p id="0650" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">最后，您需要指定希望Datafold使用的仓库和角色。请记住，必须将角色分配给用于连接的用户。我还建议选择该用户和角色的默认仓库。在我的例子中，我使用的是TRANSFORMER_WH和TRANSFORMER角色，我也用它来运行我的dbt模型。</p><p id="5900" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">当我把这些放在一起时，我的URI看起来会像这样，但有两个不同的帐户:</p><p id="ba84" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><code class="fe nu nv nw nx b">snowflake://dbt_user:password@madisonprod-central-us.azure/BASE/MADISON_DBO?warehouse=TRANSFORMER_WH&amp;role=TRANSFORMER</code></p><h1 id="6c6e" class="ml mm iv bd mn mo mp mq mr ms mt mu mv kb mw kc mx ke my kf mz kh na ki nb nc bi translated">策划整个命令</h1><p id="43b3" class="pw-post-body-paragraph lb lc iv ld b le nd jw lg lh ne jz lj lk nf lm ln lo ng lq lr ls nh lu lv lw io bi translated">一旦你创建了你的URI，你就快完成了！您只需要指定想要比较的两个表的名称。</p><p id="d313" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">如前所述，data-diff使用以下命令格式:</p><p id="0d1a" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><code class="fe nu nv nw nx b">data-diff DB1_URI TABLE1_NAME DB2_URI TABLE2_NAME</code></p><p id="3ea2" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">用你上面写的URIs代替URI DB1和URI DB2。在我的例子中，我想比较来自两个不同雪花帐户的订单表。我将这样写命令:</p><p id="22f5" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><code class="fe nu nv nw nx b">data-diff “snowflake://dbt_user:password@madisonprod-central-us.azure/BASE/MADISON_DBO?warehouse=TRANSFORMER_WH&amp;role=TRANSFORMER” ORDERS “snowflake://dbt_user:password@madisondev-central-us.azure/BASE/MADISON_DBO?warehouse=TRANSFORMER_WH&amp;role=TRANSFORMER” ORDERS</code></p><p id="e725" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">需要注意两件事:</p><ul class=""><li id="6e18" class="lx ly iv ld b le lf lh li lk lz lo ma ls mb lw mc md me mf bi translated">请务必大写您的表名</li><li id="eb4b" class="lx ly iv ld b le mg lh mh lk mi lo mj ls mk lw mc md me mf bi translated">包括你的两个URIs的引用</li></ul><p id="0f6a" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">当我没有做这些事情时，我得到了一个帐户错误，然后是一个表错误。一定要注意小细节！</p><p id="1701" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><strong class="ld iw">指定主键</strong></p><p id="b747" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">如果您正在比较的表的主键与<code class="fe nu nv nw nx b">id</code>的名称不同，那么您需要指定一个“键列”。这将告诉data-diff哪个列充当表的主键，并允许它准确地比较两个表。我的表的主键是<code class="fe nu nv nw nx b">order_id</code>，所以我这样指定:</p><p id="d523" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><code class="fe nu nv nw nx b">data-diff “snowflake://dbt_user:password@madisonprod-central-us.azure/BASE/MADISON_DBO?warehouse=TRANSFORMER_WH&amp;role=TRANSFORMER” ORDERS “snowflake://dbt_user:password@madisondev-central-us.azure/BASE/MADISON_DBO?warehouse=TRANSFORMER_WH&amp;role=TRANSFORMER” ORDERS — key-column ORDER_ID</code></p><p id="4449" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><strong class="ld iw">其他选项</strong></p><p id="53b2" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">还有一些类似于<code class="fe nu nv nw nx b">key-column</code>标志的选项，您可以添加到data-diff命令中以优化它。下面是一些我觉得有用的例子:</p><p id="c574" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">—列(允许您指定要比较的特定列，从而加快查询速度)</p><p id="ee9c" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">—交互式(向您展示幕后发生的每一步)</p><p id="9252" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">—二等分因子(增加数据集分割成的线段数)</p><p id="b2e7" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">尝试这些不同的选项，看看什么最适合你！根据您要比较的内容和数据表的大小，您可能需要使用更多的选项。</p><p id="6387" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">运行该命令后，data-diff将打印出两个不同数据库中的主键。它应该是这样的:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi ny"><img src="../Images/8aac6f668cc4d0f8cae820bf425514b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Jw9CXrpd1JhkoIC8"/></div></div></figure><p id="9645" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">这里data-diff打印存在于一个表中但不存在于另一个表中的主键。当键前面有一个+时，这表示这些行存在于第二个表中，而不存在于第一个表中。如果有-符号，则表示该行存在于第一个表中，而不存在于第二个表中。这里，正在打印的订单id出现在我的URI的第二个表中，而不是第一个表中。</p><h1 id="b9c7" class="ml mm iv bd mn mo mp mq mr ms mt mu mv kb mw kc mx ke my kf mz kh na ki nb nc bi translated">调试您的URIs</h1><p id="d13c" class="pw-post-body-paragraph lb lc iv ld b le nd jw lg lh ne jz lj lk nf lm ln lo ng lq lr ls nh lu lv lw io bi translated">如果您收到与您的帐户相关的错误，建议您使用诗歌运行data-diff。这将允许您打印您正在向data-diff提供的凭据，确保凭据输入正确。</p><p id="6ea9" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">为了做到这一点，您首先要克隆数据差异报告。</p><p id="3553" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">接下来，您可以安装诗歌及其依赖项:</p><p id="e563" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><code class="fe nu nv nw nx b">pip install poetry</code></p><p id="6c36" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><code class="fe nu nv nw nx b">poetry install</code></p><p id="e5de" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">在您克隆了repo并安装了poem之后，导航到<a class="ae la" href="https://github.com/datafold/data-diff/blob/master/data_diff/databases/snowflake.py#L40" rel="noopener ugc nofollow" target="_blank"> snowflake.py </a>文件并打印您的凭证。您的init函数应该如下所示:</p><pre class="kl km kn ko gt nz nx oa ob aw oc bi"><span id="d4b7" class="ni mm iv nx b gy od oe l of og">def __init__(</span><span id="c3cf" class="ni mm iv nx b gy oh oe l of og">self,</span><span id="0c37" class="ni mm iv nx b gy oh oe l of og">account: str,</span><span id="a62e" class="ni mm iv nx b gy oh oe l of og">_port: int,</span><span id="8d74" class="ni mm iv nx b gy oh oe l of og">user: str,</span><span id="96b5" class="ni mm iv nx b gy oh oe l of og">password: str,</span><span id="63e6" class="ni mm iv nx b gy oh oe l of og">*,</span><span id="8293" class="ni mm iv nx b gy oh oe l of og">warehouse: str,</span><span id="d413" class="ni mm iv nx b gy oh oe l of og">schema: str,</span><span id="54c7" class="ni mm iv nx b gy oh oe l of og">database: str,</span><span id="619e" class="ni mm iv nx b gy oh oe l of og">role: str = None,</span><span id="5d5e" class="ni mm iv nx b gy oh oe l of og">**kw,</span><span id="1952" class="ni mm iv nx b gy oh oe l of og">):</span><span id="c420" class="ni mm iv nx b gy oh oe l of og">snowflake = import_snowflake()</span><span id="c74b" class="ni mm iv nx b gy oh oe l of og">logging.getLogger(“snowflake.connector”).setLevel(logging.WARNING)</span><span id="f62e" class="ni mm iv nx b gy oh oe l of og">print(account)</span><span id="1149" class="ni mm iv nx b gy oh oe l of og">print(user)</span><span id="fb70" class="ni mm iv nx b gy oh oe l of og">print(password)</span><span id="16ef" class="ni mm iv nx b gy oh oe l of og">print(warehouse)</span><span id="d2dc" class="ni mm iv nx b gy oh oe l of og">print(schema)</span><span id="3a0e" class="ni mm iv nx b gy oh oe l of og">print(database)</span><span id="7f76" class="ni mm iv nx b gy oh oe l of og">print(role)</span><span id="7e5f" class="ni mm iv nx b gy oh oe l of og">logging.getLogger(“snowflake.connector.network”).disabled = True</span><span id="6d0a" class="ni mm iv nx b gy oh oe l of og">assert ‘“‘ not in schema, “Schema name should not contain quotes!”</span><span id="5b08" class="ni mm iv nx b gy oh oe l of og">self._conn = snowflake.connector.connect(</span><span id="2e30" class="ni mm iv nx b gy oh oe l of og">user=user,</span><span id="ce78" class="ni mm iv nx b gy oh oe l of og">password=password,</span><span id="b342" class="ni mm iv nx b gy oh oe l of og">account=account,</span><span id="b306" class="ni mm iv nx b gy oh oe l of og">role=role,</span><span id="fedc" class="ni mm iv nx b gy oh oe l of og">database=database,</span><span id="daea" class="ni mm iv nx b gy oh oe l of og">warehouse=warehouse,</span><span id="a273" class="ni mm iv nx b gy oh oe l of og">schema=f’”{schema}”’,</span><span id="3cdd" class="ni mm iv nx b gy oh oe l of og">**kw,</span><span id="48a0" class="ni mm iv nx b gy oh oe l of og">)</span><span id="5399" class="ni mm iv nx b gy oh oe l of og">self.default_schema = schema</span></pre><p id="d698" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">现在，您可以像前面一样运行相同的data-diff命令，但要以<code class="fe nu nv nw nx b">poetry run python3 -m</code>开始。这将打印出data-diff在产生错误之前从您的URI注册的值。</p><p id="1c07" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">让我们将其与典型的验证过程进行比较。</p><p id="a929" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">以前，当比较两个数据集时，您需要做这样的事情:</p><ul class=""><li id="1a88" class="lx ly iv ld b le lf lh li lk lz lo ma ls mb lw mc md me mf bi translated">求2021年订单数:</li></ul><p id="a87b" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><code class="fe nu nv nw nx b">select count( distinct order_id) from orders where year(created_at)=2021;</code></p><ul class=""><li id="1047" class="lx ly iv ld b le lf lh li lk lz lo ma ls mb lw mc md me mf bi translated">求2021年5月订单数:</li></ul><p id="fbdf" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><code class="fe nu nv nw nx b">select count( distinct order_id) from orders where year(created_at)=2021 and month(created_at)=5;</code></p><p id="533f" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">将订单差异缩小到5月份后，您可能需要下载数据集并在Excel中比较这两个数据集(除非您碰巧在同一个雪花帐户中有这两个数据集)。Excel加载时间很长，如果导入大量数据，速度会明显变慢。在这里，您可以使用函数来比较哪些order _ ids在一个数据集中不存在，而在另一个数据集中不存在。</p><p id="750d" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">我这样做了太多次，这是一种痛苦。分析工程师有更好的事情要做！我们不想花时间去大海捞针。data-diff消除了寻找数据集之间差异的整个手动过程。现在，您有了额外的时间来研究<em class="oi">为什么</em>订单id在一个表中，而不在另一个表中。这是我们喜欢做的调查工作，实际上有<em class="oi">的影响</em>。</p><h1 id="fac9" class="ml mm iv bd mn mo mp mq mr ms mt mu mv kb mw kc mx ke my kf mz kh na ki nb nc bi translated">结论</h1><p id="0937" class="pw-post-body-paragraph lb lc iv ld b le nd jw lg lh ne jz lj lk nf lm ln lo ng lq lr ls nh lu lv lw io bi translated">data-diff是一个强大的验证数据的开源解决方案。它消除了一部分可能需要几个小时的手动验证。无论您是像我一样在帐户迁移后使用它来比较帐户间的表，还是使用它来验证您的编排管道，它都将为您腾出时间来完成真正重要的任务。data-diff使我能够成功地验证我的帐户迁移，所用的时间只是比较每个模式中每个表所需时间的一小部分。</p><p id="40ac" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">开源工具是现代数据栈的未来。但是，如果你想使用复杂的用户界面比较数据模型，一定要看看datafold的付费<a class="ae la" href="https://www.datafold.com/" rel="noopener ugc nofollow" target="_blank">工具</a>。</p><p id="a824" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">更多关于分析工程和现代数据堆栈的信息，<a class="ae la" href="https://madisonmae.substack.com/" rel="noopener ugc nofollow" target="_blank">订阅</a>我的免费每周时事通讯。</p></div></div>    
</body>
</html>