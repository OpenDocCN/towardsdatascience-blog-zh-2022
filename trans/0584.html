<html>
<head>
<title>Data Mesh on the Google Cloud — A Technical Architecture Sketch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云上的数据网格——一个技术架构草图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-mesh-on-the-google-cloud-a-technical-architecture-sketch-c28fb0a6a4d9#2022-02-23">https://towardsdatascience.com/data-mesh-on-the-google-cloud-a-technical-architecture-sketch-c28fb0a6a4d9#2022-02-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f5c7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使数据网格在谷歌云中技术上工作，以及如何将这些组件转移到其他云提供商</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cd1a1ae273fab354ecc6a618ec2e4bdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7CQgZJeqluP46syQ43YnSw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。谷歌云数据网格架构。</p></figure><p id="acc0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">数据网格不仅是技术的转变，也是组织、流程和人员的转变。我相信技术方面其实没那么重要。然而，由于我们还没有合适的工具，出于某种原因，为数据网格本身建立一个好的技术架构还是相当困难的。所以提供更多的工作示例似乎才是合理的！</p><p id="cfe7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这篇文章展示了Google Cloud上的数据网格架构，其灵感来自ThoughtWorks的Samia Rahman 在2020年和2021年举办的“女性编码”的两部分研讨会，以及DeliverHero团队关于其数据网格灵感设置的演讲。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="c227" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="mc">这篇文章基本上是我与人合著的《MEAP曼宁</em> <a class="ae lu" href="http://Data Mesh in Action MEAP" rel="noopener ugc nofollow" target="_blank"> <em class="mc">【数据网格在行动】</em> </a> <em class="mc">一书中一章的部分内容的草稿。就当这是一次窥探吧。当然，我喜欢反馈，因为这将使这本书更好！</em></p><p id="199d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好了，广告说够了，让我们开始吧！我们会…</p><ol class=""><li id="cc99" class="md me it la b lb lc le lf lh mf ll mg lp mh lt mi mj mk ml bi translated">使用几个假想的参与者提供一个高层次的架构草图</li><li id="f949" class="md me it la b lb mm le mn lh mo ll mp lp mq lt mi mj mk ml bi translated">确定该平台的关键组件</li><li id="71ad" class="md me it la b lb mm le mn lh mo ll mp lp mq lt mi mj mk ml bi translated">确定数据产品的关键组成部分(这通常很难掌握)</li><li id="d4e2" class="md me it la b lb mm le mn lh mo ll mp lp mq lt mi mj mk ml bi translated">浏览数据生产者和消费者的典型工作流程</li><li id="84da" class="md me it la b lb mm le mn lh mo ll mp lp mq lt mi mj mk ml bi translated">然后讨论该体系结构的变体/附件</li></ol><h2 id="fd27" class="mr ms it bd mt mu mv dn mw mx my dp mz lh na nb nc ll nd ne nf lp ng nh ni nj bi translated"><strong class="ak"> <em class="nk">自助式数据平台架构</em> </strong></h2><p id="059c" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">我们的数据网格有几个参与者。</p><ul class=""><li id="ee05" class="md me it la b lb lc le lf lh mf ll mg lp mh lt nq mj mk ml bi translated">团队<strong class="la iu">黑色</strong>是一个开发团队，也负责创建&amp;维护数据产品。</li><li id="dcb9" class="md me it la b lb mm le mn lh mo ll mp lp mq lt nq mj mk ml bi translated">团队<strong class="la iu"> White </strong>是一个数据科学团队，既创造又消费数据产品。</li><li id="7309" class="md me it la b lb mm le mn lh mo ll mp lp mq lt nq mj mk ml bi translated">团队<strong class="la iu"> Grey </strong>拥有自助数据平台。在这种情况下，Grey团队提供了一个可配置的terraform模板。</li><li id="c0cb" class="md me it la b lb mm le mn lh mo ll mp lp mq lt nq mj mk ml bi translated">最后<strong class="la iu">消费者</strong>:我们有一些商业分析师和一个推荐系统，它们都主要消费数据。</li></ul><p id="bcfa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下图描述了第一个版本中的架构。我们将在下一节考虑一些补充。看看谷歌云平台产品的技术设置是如何工作的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/7fca9c4db06922d118b9033ebab749a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7mT7QSq4XHHhw0Fi"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。GCP数据网技术组成部分的详细结构</p></figure><p id="1a93" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们来识别一个数据网格通常具有的不同组成部分。我们分两步来做，首先是平台的组件，然后是详细的数据产品组件。然后我们将尝试理解不同角色的用户流，最后考虑这个平台的一些变化。</p><h2 id="c357" class="mr ms it bd mt mu mv dn mw mx my dp mz lh na nb nc ll nd ne nf lp ng nh ni nj bi translated"><strong class="ak">识别平台的组件</strong></h2><p id="78fe" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">平台的关键组件包括:</p><ul class=""><li id="86ef" class="md me it la b lb lc le lf lh mf ll mg lp mh lt nq mj mk ml bi translated">一个平台内核，它应该经常改变以获取额外的价值</li><li id="95ac" class="md me it la b lb mm le mn lh mo ll mp lp mq lt nq mj mk ml bi translated">一个平台接口，这个部分应该是尽可能固定的，以使平台工作。</li><li id="b991" class="md me it la b lb mm le mn lh mo ll mp lp mq lt nq mj mk ml bi translated">和补充或参与者。</li></ul><p id="5a1b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">前两个是技术组件。</p><p id="c7c0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我们的架构中，平台team Grey提供了一个可配置的terraform模板。他们选择将最新的模板放在Git存储库中。在这种情况下，git存储库和它的README文件成为了<strong class="la iu">平台接口</strong>。模板变成了<strong class="la iu">平台内核</strong>。</p><p id="b63b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有了这样一个最小的平台，就没有必要让一个完整的团队在这个平台上工作。平台内核可以通过提供新版本的terraform模板并让团队升级他们的堆栈来升级。这个平台目前的抽象程度非常低。</p><p id="d0ec" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，由于数据产品的架构，模板已经为数据生产者和消费者提供了很多好处。</p><h2 id="c1ac" class="mr ms it bd mt mu mv dn mw mx my dp mz lh na nb nc ll nd ne nf lp ng nh ni nj bi translated"><strong class="ak">确定数据产品的组成部分</strong></h2><p id="d905" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">这些数据产品都共享基于云数据流及其相关临时存储的公共工具。这使得团队能够轻松地创建数据产品。云数据流允许团队创建以Java、Python或SQL输出数据产品的管道。</p><p id="9641" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在团队Black拥有的数据产品中，团队选择直接连接到数据源，无论是PubSub还是一些BigQuery数据集。在这种情况下，<strong class="la iu">数据输入端口</strong>，即获取数据到数据产品的接口，成为云数据流管道。它的<strong class="la iu">上游数据源</strong>是PubSub和BigQuery数据集。</p><p id="ecfa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">数据流管道产生一个BigQuery数据集。这个平台使用数据集作为数据产品的容器。一个数据产品只有一个BigQuery数据集。BigQuery数据集可以保存多个表和视图，但是可以在数据集级别轻松处理访问权限。一个数据产品中有多个表是完全正常的。该数据集成为第一个<strong class="la iu">数据输出端口</strong>。</p><p id="1d86" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于该平台使用共享服务BigQuery，因此在每个数据产品中包含一个特定的Google服务帐户非常重要。这允许管理数据产品级别的权限</p><p id="9fbb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">白队的第一个数据产品使用了一个Google云存储桶作为<strong class="la iu">输入端口</strong>。这个存储桶允许用户以预定义的模式上传文件。上传时，数据流管道开始工作，将数据转换成BigQuery中的新数据产品。</p><p id="0051" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以看到，数据端口是一个非常模糊的概念。我们这里有一个GCS桶形式的推送输入端口，一个数据流和上游数据集形式的拉取输入端口。最后，在白队的第二个数据产品中，我们将这两个数据产品结合起来，并再次将数据流与首先创建的两个上游数据产品一起作为输入端口。</p><p id="f0a8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对所有三种数据产品的访问都是通过服务帐户来管理的。每个都是单独配置的，以允许例如业务分析师访问某些重要的数据产品，或者让推荐系统完成其工作。</p><h2 id="680a" class="mr ms it bd mt mu mv dn mw mx my dp mz lh na nb nc ll nd ne nf lp ng nh ni nj bi translated"><strong class="ak">工作流程</strong></h2><p id="725f" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">希望创造新的数据产品的数据生产者将前往平台接口GitHub repository。他们阅读自述文件，引入最新的terraform模板，并应用它为他们的新数据产品创建新的堆栈。为此，他们例如配置他们是否想要使用输入存储。</p><p id="8a29" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，他们配置他们的数据流管道，连接到可能的上游数据源，并配置他们的服务帐户，以允许访问必要的消费者集合。</p><p id="4211" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">另一方面，数据消费者使用BigQuery SQL接口来浏览数据产品。如果他需要访问一个新的数据产品，他会向拥有它的团队提出请求。</p><p id="7041" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如前所述，这仍然是一个非常小的平台。</p><h2 id="e775" class="mr ms it bd mt mu mv dn mw mx my dp mz lh na nb nc ll nd ne nf lp ng nh ni nj bi translated"><strong class="ak">这种建筑的变体</strong></h2><p id="32e7" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">一个简单的变化是将一组数据产品及其所有者包含到平台存储库中。这样，数据消费者将直接知道向谁请求访问。</p><p id="9c33" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">另一组变化描绘在下面的图片。此图仅显示了可能的附加组件的平台环境，这些附加组件可以不按特定顺序使用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/9fa1b5a1aee83428feb23688b4c9fdec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oY9WI6BwzNxabi3L"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。附加平台组件的详细架构</p></figure><p id="3239" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，可以使用名为<strong class="la iu"> DataHub </strong>的工具，并将其直接连接到BigQuery，作为分布式数据产品集的中央数据目录。该组件可以独立工作，无需添加任何附加组件。这将有助于消费者快速发现数据产品。</p><p id="2266" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">其次，通过访问BigQuery日志，可以通过“流行数据集”或“最频繁的数据用户”<strong class="la iu">统计数据</strong>来丰富平台。这可以通过使用GCP日志记录和配置日志路由器以及GCS桶形式的日志接收器来实现。从GCS bucket中，一个定制组件可以计算这些统计数据，并将它们推送到数据中心。</p><p id="b051" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第三，可以访问所有数据产品的另一个定制组件可以对组件运行<strong class="la iu">定制数据质量检查</strong>，计算nan或运行由数据产品所属团队注册的定制检查。例如，一个对“客户”数据产品可靠的团队可以确保产品中的客户号总是以正确的格式出现。这个测试和结果也将暴露在DataHub中。</p><p id="a327" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第四也是最后一点，裸露的terraform模板可以被包装成一个细长的<strong class="la iu">图形用户界面</strong>。通过这样做，这个GUI可以用来通过需要手动设置的重要字段来丰富从BigQuery中提取的元数据。</p><h2 id="2f28" class="mr ms it bd mt mu mv dn mw mx my dp mz lh na nb nc ll nd ne nf lp ng nh ni nj bi translated"><strong class="ak"> <em class="nk">关系到数据网格思想</em> </strong></h2><p id="88c2" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">尽管本文只是关于平台&amp;技术实现，但是技术确实会影响数据网格的其他原则。</p><p id="0245" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">平台思维</strong>的原则是让所有平台参与者的生活更轻松，同时不限制他们的自由。这种架构在减轻其他团队的负担时也能帮助他们。例如，如果一家公司内的所有开发团队都在GCP，并且都是像PubSub &amp; BigQuery这样的共享服务的大量用户，就会出现这种情况。在这种情况下，模板将帮助团队通过数据流快速访问这些来源，并将它们转化为数据产品的数据集。</p><p id="872e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上面概述的变体中，数据生成团队可能会将新的数据质量测试签入到中央存储库中，然后让中央质量组件运行它们。这可能会变成一个瓶颈，因为它可能会导致需要批准的PR请求和失败。如果出现这种情况，质量检查应该成为数据产品本身的一部分。然后，只有检查的结果会被暴露到GCS位置，并由中央组件获取，以推入数据中心。</p><p id="47cb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">联合计算治理</strong>仅在该架构中简要讨论，但有了中央数据中心，特别是用于注册数据产品的GUI，以及对数据集本身运行检查的中央组件，就有很多空间将可自动执行的策略注入该平台。</p><p id="ca10" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">在这个架构中，数据作为产品</strong>在很大程度上依赖于每个团队都有非常简单的方法来操作他们的数据。我们相信在这个例子中数据流服务于这个目的。</p><p id="fc6a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">具有讽刺意味的是，该体系结构中的Data Domain所有权</strong>取决于服务帐户和访问控制，因为该体系结构使用大型共享服务。拥有访问的技术边界是至关重要的，否则，所有权不会真正落入数据生成团队的手中。</p><h2 id="9827" class="mr ms it bd mt mu mv dn mw mx my dp mz lh na nb nc ll nd ne nf lp ng nh ni nj bi translated"><strong class="ak">GCP设置概要</strong></h2><p id="1e76" class="pw-post-body-paragraph ky kz it la b lb nl ju ld le nm jx lg lh nn lj lk ll no ln lo lp np lr ls lt im bi translated">这个平台架构利用了共享云服务，这些服务大多来自GCP环境。它使用了一些非GCP特有的组件，Git和Terraform，以及变体定制代码和数据中心。</p><p id="adf4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它为数据生产者提供了一套转换数据的工具，但只有一个标准化的数据端口。然而，数据端口可以很容易地扩展到使用Google Cloud PubSub和Google Cloud Storage，为您提供大量的目标格式，满足大多数消费者的需求。</p><p id="dee4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">该设置也可以通过微小的差异移植到其他大型云提供商AWS和Azure。因为它们看起来非常相似，所以我们选择不在这里将它们显示为1-1映射。</p><p id="c266" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="mc">如果你喜欢这篇文章，继续评论吧！</em></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="e1a0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="mc">对如何建立伟大的数据公司、伟大的数据密集型产品、成为伟大的数据团队感兴趣，还是对如何利用开源构建伟大的东西感兴趣？然后考虑加入我的</em> <a class="ae lu" href="http://thdpth.com/" rel="noopener ugc nofollow" target="_blank"> <em class="mc">免费简讯《三个数据点周四》</em> </a> <em class="mc">。它已经成为数据初创企业、风投和数据领导者值得信赖的资源。</em></p></div></div>    
</body>
</html>