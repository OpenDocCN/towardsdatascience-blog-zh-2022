<html>
<head>
<title>Keep Your Friends Close, Keep Your Entities Closer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">亲近你的朋友，亲近你的实体</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/keep-your-friends-close-keep-your-entities-closer-ae216b02da1e#2022-10-05">https://towardsdatascience.com/keep-your-friends-close-keep-your-entities-closer-ae216b02da1e#2022-10-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="aa5e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">实体关系图:不酷，不现代，但仍然非常有价值</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8262119ec62c689136174661e7fe1726.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zuTtu0F-lDbRUVjqkCojkg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">苹果、橘子和香蕉(由DALL-E生成)</p></figure><p id="a211" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最纯粹的数据仓库是一面镜子。如果做得好，这个镜像反映了来自您的业务或领域的真实世界的实体和事件，并以少量的表格、指标和维度来表达它们。做得非常正确——你的内部利益相关者和其他分析师可以在这个生态系统中导航，而不用担心细微差别或错误——实现这一点从最底层的实体关系图开始(ERD)。</p><h1 id="0a44" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">考虑一下贾夫勒商店</h1><p id="aa56" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">dbt的<a class="ae mo" href="https://github.com/dbt-labs/jaffle_shop/tree/main/models" rel="noopener ugc nofollow" target="_blank"> Jaffle Shop </a>演示项目是一个虚构的电子商务业务，有两个核心实体:<code class="fe mp mq mr ms b">customers</code>和<code class="fe mp mq mr ms b">orders</code>。每一个<code class="fe mp mq mr ms b">customer</code>都是一个独特的个体(一个人)，每一个<code class="fe mp mq mr ms b">order</code>都反映了其中一个客户的交易。因此，我们可以说<code class="fe mp mq mr ms b">Customers</code> : <code class="fe mp mq mr ms b">Orders</code>是一:多，并且每个<code class="fe mp mq mr ms b">order</code>都继承了那些进行交易的上游<code class="fe mp mq mr ms b">customers</code>的属性。这样，我们可以很容易地回答诸如“姓<code class="fe mp mq mr ms b">Smith</code>的客户的交易金额是多少？”</p><p id="add3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">ERD看起来如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/dc1ed437370e9bb65a53dd5297a0718f.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*oUHGKgt65oMEhz8YIc3xmA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">dbt的谢夫尔商店的示范ERD；作者图片</p></figure><p id="adc4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是一个有意简化的模型，有助于启动和运行dbt——它太简单了，以至于不值得制作一个ERD。然而，真实世界的例子会产生指数级的更高的复杂性，这也是实体关系图开始赢得市场的地方。</p><h1 id="de64" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">信息民主化和减少认知开销</h1><p id="49ad" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">在我在YouTube从事数据工作的这些年里，我的一位同事经常提到正确使用我们内部数据仓库所需的<strong class="kx ir">认知开销</strong>。这种认知开销——为了理解或理解你正在看的东西，你的大脑必须进行多少逻辑连接或跳跃——是由它试图反映的业务、实体和事件的复杂性驱动的。</p><p id="2a7c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在工作过程中，分析师需要浏览各种实体，如<code class="fe mp mq mr ms b">channels</code>、<code class="fe mp mq mr ms b">content owners</code>、<code class="fe mp mq mr ms b">videos</code>、<code class="fe mp mq mr ms b">digital assets</code>、<code class="fe mp mq mr ms b">copyright claims</code>、<code class="fe mp mq mr ms b">partners</code>、<code class="fe mp mq mr ms b">viewers</code>、<code class="fe mp mq mr ms b">users</code>等……看似简单的问题，如“我们上个月在德国的值班时间是多少？”如果没有连接到正确的实体，可能是不显眼的地雷(例如，我们关心<code class="fe mp mq mr ms b">viewer</code>的国家吗？<code class="fe mp mq mr ms b">channel</code>的申报国？<code class="fe mp mq mr ms b">content owner</code>的国家？).这些实体之间的多对多关系和不可加总的指标使得分析更加棘手。</p><p id="f262" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有少数分析师知道所有这些部分是如何协同工作的，并且能够提出正确的问题(以SQL查询的形式)——其他人的查询要承担风险。</p><p id="9c2d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">回想起来，如果有一个清晰的语义层来帮助我们的分析师在这个生态系统中导航，而不用担心没有意义，我们会受益匪浅。但是我们缺少一个更简单的解决方案:一个清晰的实体关系图。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9ffef4e03e3f056a9cb85fd2b13654c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7b4akC9m0SbRcRpA6q3Z4Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">拼图块(DALL-E)</p></figure><p id="cfc0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">即使您有一个语义层，您也需要弄清楚如何将这些部分组合在一起——这就是为什么这种低技术，特别是非现代的数据建模方法在今天仍然如此重要。它充当创作者的<strong class="kx ir">强制功能，要求他们批判性地思考他们试图建模的现实世界事件和实体(以及它们之间的关系)。<strong class="kx ir">对于</strong> <strong class="kx ir">数据消费者来说，ERD是一个强大的使能器，可以立即使知识民主化</strong>，否则这些知识在许多成熟的组织中是封闭的。</strong></p><h1 id="b118" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">ERD奖给你的烦恼</h1><p id="a2aa" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">当我在2021年第一次加入Mux时，我们从零开始构建我们的数据仓库。这意味着我们需要找出哪些核心实体和事件需要在数据仓库中表示。我花了几个小时在我们的数据湖和我们的公共API参考和文档中处理原始数据，试图让我的头脑了解这个生态系统——这些时间是我在这里任职期间投资回报率最高的时间。当时的结果是下面的原始文档:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mu"><img src="../Images/b801306c0cfc0ffaa45eede4b0913324.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7TklIlax_xg-fOuRV9UTLg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Mux核心产品实体(示范)，图片由作者提供</p></figure><p id="5710" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个演示视图捕捉了我们生态系统不到一半的复杂性(即，它没有考虑更新的产品、发票、观众会话、GTM系统等。)—仍然将这些都写在纸上帮助我们快速了解我们的最终状态数据仓库将会是什么样子，以便反映现实，以及如何在我们的语义层中连接这些点。</p><p id="373a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有了ERD，我们开始构建我们的dbt模型和LookML，并且已经有了一组稳定的表来反映我们的核心实体和事件，同时我们继续构建更新的边界。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/f73b81a72ebdb624c5c43ca811d3b338.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6QXvi0zlmaHtALG29dBf9w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Mux DWH围绕核心实体组织，图片由作者提供</p></figure><h1 id="c621" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">结束语</h1><p id="b904" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">总之，如果你的数据团队还没有，花时间做一个完整的实体关系图(ERD)。虽然这可能比编写SQL或dash-boarding效率低，但在这里花费的时间将是您最宝贵的时间。</p></div></div>    
</body>
</html>