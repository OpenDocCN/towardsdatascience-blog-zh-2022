<html>
<head>
<title>NLP MLops Project With DagsHub — Deploy Your Streamlit App On AWS EC2 Instance — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用DagsHub的NLP MLops项目—在AWS EC2实例上部署您的Streamlit应用程序—第2部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/nlp-mlops-project-with-dagshub-deploy-your-streamlit-app-on-aws-ec2-instance-part-2-eb7dcb17b8ba#2022-04-12">https://towardsdatascience.com/nlp-mlops-project-with-dagshub-deploy-your-streamlit-app-on-aws-ec2-instance-part-2-eb7dcb17b8ba#2022-04-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="08cf" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让您的机器学习应用程序对世界开放，而不会让您头疼！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5df90aa2cbec2baac80366c73f1998ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s9QKZ3GIcmvJ951-"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@spacex" rel="noopener ugc nofollow" target="_blank"> SpaceX </a>在<a class="ae ky" href="https://unsplash.com/photos/Ptd-iTdrCJM" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="2e18" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="14b4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">除了开发机器学习模型，能够让外部世界访问它们也是一项非常有价值的技能。试图帮助你获得这样的技能是这篇文章的主要目标。它关注于使用<code class="fe mn mo mp mq b"><strong class="lt iu">DagsHub</strong></code>、<code class="fe mn mo mp mq b"><strong class="lt iu">DVC</strong></code>和<code class="fe mn mo mp mq b"><strong class="lt iu">EC2</strong></code>实例来使你的机器学习应用顺利产业化。</p><p id="5b3f" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">首先，您将能够构建您的<code class="fe mn mo mp mq b"><strong class="lt iu">Streamlit</strong></code>应用程序，然后了解将其部署到生产中的逐步方法。</p><h1 id="523b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">机器学习任务—提醒</h1><p id="7e3c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们将要部署的应用程序来自于多语言分类项目。目标是预测以下5种语言之一的给定文本的潜在极性:<em class="mw">英语</em>，<em class="mw">法语</em>，<em class="mw">德语</em>，<em class="mw">俄语</em>，以及<em class="mw">西班牙语</em>。请参考以上链接了解更多详情。</p><h1 id="2ae8" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">简化it应用构建流程</h1><p id="6e1c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">本节的目标是重点构建streamlit应用程序的两个主要特性，并在我们的本地机器上运行它。</p><p id="31a3" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><strong class="lt iu">注</strong>:你也可以在文末找到app的完整源代码。</p><h2 id="f097" class="mx la it bd lb my mz dn lf na nb dp lj ma nc nd ll me ne nf ln mi ng nh lp ni bi translated"><strong class="ak">第一个主要特性——应用程序的第一部分</strong></h2><p id="e0cf" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">第一部分与显示5种语言中每一种语言的模型全球指标(F1得分和准确度)相关。但在此之前，我们还将介绍徽标和描述部分的实现。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/853dfe998bdf601c30669bac54d580d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ECMBoLO6cMd11SaPOdIg2w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">应用程序的第一部分——徽标、描述和指标部分(图片由作者提供)</p></figure><ul class=""><li id="4927" class="nk nl it lt b lu mr lx ms ma nm me nn mi no mm np nq nr ns bi translated"><strong class="lt iu">徽标、描述和指标部分</strong></li></ul><p id="0443" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">使用streamlit <code class="fe mn mo mp mq b"><a class="ae ky" href="https://docs.streamlit.io/library/api-reference/media/st.image" rel="noopener ugc nofollow" target="_blank">st.image</a></code>可以直接显示图像。此外,<code class="fe mn mo mp mq b"><a class="ae ky" href="https://docs.streamlit.io/library/api-reference/text/st.markdown" rel="noopener ugc nofollow" target="_blank">st.markdown</a></code>可以显示降价格式的文本。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">st _ logo _描述. py</p></figure><p id="841d" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">通过使用<code class="fe mn mo mp mq b"><a class="ae ky" href="https://docs.streamlit.io/library/api-reference/widgets/st.selectbox" rel="noopener ugc nofollow" target="_blank">st.selectbox</a></code>，我们能够在<strong class="lt iu"> F1-分数</strong>和准确性之间进行选择。默认情况下，自动显示该型号的<strong class="lt iu"> F1分数</strong>。但是用户可以将其更改为<strong class="lt iu">精度</strong>。</p><h2 id="1664" class="mx la it bd lb my mz dn lf na nb dp lj ma nc nd ll me ne nf ln mi ng nh lp ni bi translated">用户输入和模型预测——应用程序的第二部分</h2><p id="14e5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这个部分更多的是应用程序的智能部分。它预测用户提供的句子的潜在情感极性。为此，提供了两个选项，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/25e9da691db63fbb9a71628d34143011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vMVCXUzWjw7-36XnriCp1g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">应用程序的第二部分——描述、下拉列表和自由文本部分(图片由作者提供)</p></figure><ul class=""><li id="d585" class="nk nl it lt b lu mr lx ms ma nm me nn mi no mm np nq nr ns bi translated"><strong class="lt iu">描述部分</strong></li></ul><p id="d6ce" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">此部分执行两个操作:显示🚀<strong class="lt iu">描述</strong>和用户可用的交互选项(选项1 &amp; 2)。每个动作都用一个简单的<code class="fe mn mo mp mq b"><a class="ae ky" href="https://docs.streamlit.io/library/api-reference/text/st.markdown" rel="noopener ugc nofollow" target="_blank">st.markdown</a></code>来执行</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">st _ part2 _描述. py</p></figure><ul class=""><li id="74d2" class="nk nl it lt b lu mr lx ms ma nm me nn mi no mm np nq nr ns bi translated"><strong class="lt iu">下拉菜单和自由文本部分</strong></li></ul><p id="d294" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">用户可以从下拉列表中选择5个句子中的一个，每个句子都使用不同的语言。另一方面，他/她可以在自由文本区域提供他/她自己的文本进行预测。在这两种情况下，我们使用streamlit <code class="fe mn mo mp mq b"><a class="ae ky" href="https://docs.streamlit.io/library/api-reference/control-flow/st.form" rel="noopener ugc nofollow" target="_blank">st.form</a></code>函数来获取用户的输入，然后最终加载模型并运行预测。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">st _用户_输入. py</p></figure><p id="e6a7" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">在自由文本区域，首先执行检查，以确保用户提供的句子是模型考虑的5种语言之一。如果不是这种情况，就会显示一条好消息通知用户。</p><h2 id="72aa" class="mx la it bd lb my mz dn lf na nb dp lj ma nc nd ll me ne nf ln mi ng nh lp ni bi translated">运行您的streamlit应用程序</h2><p id="77d9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">构建好app后，就可以用<code class="fe mn mo mp mq b">streamlit run</code>命令运行了。</p><pre class="kj kk kl km gt nw mq nx ny aw nz bi"><span id="9979" class="mx la it mq b gy oa ob l oc od">streamlit run app.py</span></pre><p id="7f9f" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">前面的命令生成以下消息，以从两个URL访问应用程序。</p><ul class=""><li id="94da" class="nk nl it lt b lu mr lx ms ma nm me nn mi no mm np nq nr ns bi translated"><code class="fe mn mo mp mq b">Local URL</code>是我的本地主机，只有我能在我的机器上访问它。</li><li id="adb2" class="nk nl it lt b lu oe lx of ma og me oh mi oi mm np nq nr ns bi translated"><code class="fe mn mo mp mq b">Network URL</code>与我相同子网内的任何人都可以访问的URL。然而，这两个网络之外的任何人都不能访问我的应用程序。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/fb26ce5ecf51c96d106d3b27755ff507.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IKTLt0zDsp8h4YR2hlv3cQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在本地运行的Streamlit应用程序(图片由作者提供)</p></figure><p id="57a9" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">目标是让这个星球上的任何人都可以访问它！🪐，这是我们将在下一节做的。</p><h1 id="bf9a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">AWS上的应用部署流程</h1><p id="97ac" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">更自然的步骤是将应用程序部署到生产中；具体操作如下:配置EC2实例，使用DVC将模型和度量数据推送到Dagshub，并在EC2上运行应用程序。</p><h2 id="b105" class="mx la it bd lb my mz dn lf na nb dp lj ma nc nd ll me ne nf ln mi ng nh lp ni bi translated">选择、创建和配置EC2实例</h2><p id="06dd" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">EC2代表弹性计算云。它是一个虚拟服务器，用于在Amazon Web服务基础设施上运行应用程序。在本节中，我们将了解如何创建一个实例并执行配置。</p><p id="bac1" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><strong class="lt iu">选择EC2实例</strong></p><p id="9b60" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">登录<a class="ae ky" href="https://portal.aws.amazon.com/billing/signup#/start/email" rel="noopener ugc nofollow" target="_blank"> AWS管理控制台</a>后，可以从<strong class="lt iu">服务</strong>标签中搜索EC2。它自动显示第二页来选择实际的EC2服务。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/fd26fbfe4b8e622bce000aa7ff7d7dc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u0Uf4DohLpXHC3kJJsUbgA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从服务选项卡中选择EC2(图片由作者提供)</p></figure><p id="bbdb" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">接下来，选择<strong class="lt iu">实例</strong>选项正下方的<strong class="lt iu"> <em class="mw">实例</em> </strong>。您可以看到，我有一个t2.xlarge实例来托管我当前的streamlit应用程序😉。如果您尚未运行任何实例，此页面可能为空。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/ecf18e62aa4959a4dbab81d6370a3953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FwH8w3oWTA4mIK7RzzKatw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">启动EC2实例(作者图片)</p></figure><p id="c168" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><strong class="lt iu">创建EC2实例— 6个主要步骤</strong></p><p id="0cdf" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">在选择了<strong class="lt iu"> Launch instances </strong>选项卡之后，您会看到下面的页面，其中包含了从选择Amazon机器映像(AMI)到配置安全组的所有步骤。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/e30a1831db1bad62583c14ecb8345078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XK_RAjKyoFlZdmxZ4vlISA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建EC2实例的6个主要步骤(图片由作者提供)</p></figure><ol class=""><li id="2c56" class="nk nl it lt b lu mr lx ms ma nm me nn mi no mm on nq nr ns bi translated"><strong class="lt iu"> <em class="mw">选择AMI </em> </strong>:包含操作系统、app server、apps等软件配置的模板。它可用于在云中启动一个或多个实例。让我们通过点击<strong class="lt iu">选择</strong>按钮来选择第一个实例。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/3eaccecf88ed7a1c92229f1b861ff823.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AHvFoBMBBE-UtVs0pXbLQQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">选择AMI实例:Amazon Linux 2 AMI —内核5.10，SSD卷类型(图片由作者提供)</p></figure><p id="c927" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><strong class="lt iu">T23】2。选择实例类型: </strong>实例类型提供特定的计算、内存和存储功能。根据我的应用程序要求，使用2.5 Go的大型号，我决定使用t2.xlarge。如果你的应用程序不需要足够的存储空间，你可以使用t2.micro，因为它是免费的。选择后，点击下一步的<strong class="lt iu">进入第三步。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/55fc05474f0ed2b961b57d6aa0537fd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l3D7gC1U0ElVzh17AJLDIA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">选择t2.xlarge实例类型—ECU、4vCPUs、2.3 GHz、16GiB内存、仅EBS(图片由作者提供)</p></figure><p id="a450" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><strong class="lt iu"> <em class="mw"> 3。配置实例细节:</em> </strong>从这里，我们可以选择我们的用例所需的实例数量、网络类型等。正如我们所看到的，名字是不言自明的。我决定保留默认模式的配置。选择下一个的<strong class="lt iu">继续</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/4f6977f3d7ae1887488dbabf567461d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EDanxWkwpU_rPhG_R_As3Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">实例详细信息的配置—默认模式下的所有内容(图片由作者提供)</p></figure><p id="5dfc" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><strong class="lt iu"> <em class="mw"> 4。添加存储:</em> </strong>默认的存储值是8gb，但是因为我app的要求，我决定增加到16。点击<strong class="lt iu">下一步</strong>继续。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/395b1ff4edd1dab9b08aa13a6f5b34b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*noPONWl3bKg8AVguW0xDog.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">添加16 GiB存储(图片由作者提供)</p></figure><p id="4e40" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><strong class="lt iu"> <em class="mw"> 5。添加标签:</em> </strong>根据描述，标签由区分大小写的键值对组成。最多可以添加50个标签。为了简单起见，我跳过了这一步。选择下一个的<strong class="lt iu">进入第6步，即最后一步。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/54e758ed689800beb0b24c63c234816e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sJjbhTJ6eNfI7ugTYAxaOQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">标签部分—跳过(按作者分类的图像)</p></figure><p id="6bef" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><strong class="lt iu"> <em class="mw"> 6。配置安全组:</em> </strong>这是一组防火墙规则，旨在控制EC2实例的传入和传出信息。选择“添加”两次会在表格中创建两个新行。下面分别是第一个和第二个规则的配置。</p><ul class=""><li id="7e92" class="nk nl it lt b lu mr lx ms ma nm me nn mi no mm np nq nr ns bi translated">类型:自定义TCP端口</li><li id="2ab6" class="nk nl it lt b lu oe lx of ma og me oh mi oi mm np nq nr ns bi translated">协议:TCP</li><li id="6a5a" class="nk nl it lt b lu oe lx of ma og me oh mi oi mm np nq nr ns bi translated">端口范围:8501对应streamlit端口。</li><li id="0307" class="nk nl it lt b lu oe lx of ma og me oh mi oi mm np nq nr ns bi translated">Source: Anywhere，允许端口连接到任何地方。以这种方式更改会自动将地址设置为0.0.0.0，:/0</li></ul><p id="1298" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">对于第二个规则，我们得到了一个类似的配置，但是您只需要将端口范围更改为8502，以便考虑streamlit的第二个端口。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/c17952ab08828e84f0b3c9c4eb76d157.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OFgOXkPiGyD4HNHL8DehvA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">streamlit端口8501和8502的安全组配置(图片由作者提供)</p></figure><p id="f645" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">我们最终可以单击<strong class="lt iu">查看并启动</strong>来检查配置。当你对一切都满意时，点击<strong class="lt iu">启动</strong>。这样做时，您将被要求创建或提供一个密钥对，这是尝试SSH连接到EC2实例时所必需的。</p><ul class=""><li id="0eca" class="nk nl it lt b lu mr lx ms ma nm me nn mi no mm np nq nr ns bi translated">从第一个下拉列表中，选择“创建新的密钥对”选项。</li><li id="62e3" class="nk nl it lt b lu oe lx of ma og me oh mi oi mm np nq nr ns bi translated">我决定将密钥对类型留给RSA。</li><li id="09cf" class="nk nl it lt b lu oe lx of ma og me oh mi oi mm np nq nr ns bi translated">在密钥对名称部分提供一个有意义的名称。对我来说是。</li></ul><p id="3d82" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">单击下载密钥对以下载密钥对。只有这样，您才能通过选择“启动实例”来启动您的实例。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/6d9555a15ff0a8b9d0408d08233887f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*CQw_x5IpRALno-keptpJ4w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">密钥对配置和实例启动(图片由作者提供)</p></figure><p id="e50f" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">您将获得成功启动消息“您的实例现在正在运行”。在该页面中，您可以通过单击<strong class="lt iu">查看实例</strong>按钮来访问您的实例。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/4aacfa647687806bee50bcb0050275bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cts8R79dV_dwg6osPTAidA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">成功发布消息(图片由作者提供)</p></figure><p id="eda9" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">正如您在下图中看到的，我有了新创建的实例，它处于<strong class="lt iu">运行状态</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/4dfc5771cff2b35f466a504e8c62ce70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gkh4ttk94ZkinLaF-kmuIw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我正在运行的EC2实例(图片由作者提供)</p></figure><p id="a4f7" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">瞧，你可以为自己能走到这一步而感到骄傲！！！好极了👏🏼👏🏼👏🏼</p><p id="5089" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><strong class="lt iu">接下来是什么？？？<br/> </strong>我们确实想在EC2上运行应用程序，但是我们首先必须能够SSH连接到我们的EC2实例。</p><p id="bd23" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">现在，我决定继续使用我之前创建的第一个实例，以避免被超额收费。😀</p><h2 id="25b8" class="mx la it bd lb my mz dn lf na nb dp lj ma nc nd ll me ne nf ln mi ng nh lp ni bi translated">到EC2实例的SSH连接</h2><p id="81ed" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu">获取连接变量</strong></p><p id="52bd" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">使用以下信息连接到我们的实例:</p><ul class=""><li id="795a" class="nk nl it lt b lu mr lx ms ma nm me nn mi no mm np nq nr ns bi translated">生成的密钥对文件</li><li id="db04" class="nk nl it lt b lu oe lx of ma og me oh mi oi mm np nq nr ns bi translated">EC2实例的公共IP地址</li><li id="14ba" class="nk nl it lt b lu oe lx of ma og me oh mi oi mm np nq nr ns bi translated">公共IPv4 DNS</li></ul><p id="4488" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">通过执行步骤1和2，您可以获得公共地址和公共DNS。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/842c7f9052992839578c492e952a3dba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d0RbqfnXZmGU2UHSTPHmgQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">获取SSH连接信息的步骤(图片由作者提供)</p></figure><p id="2ed3" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><strong class="lt iu">配置~/。ssh/config文件</strong></p><p id="2dc8" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">将以下信息添加到配置文件中。这个文件的目标是使用一个<code class="fe mn mo mp mq b">ssh</code>命令连接到EC2实例成为可能。</p><pre class="kj kk kl km gt nw mq nx ny aw nz bi"><span id="0e57" class="mx la it mq b gy oa ob l oc od">Host <strong class="mq iu">streamlit-dagshub<br/>     </strong>HostName <strong class="mq iu">18.117.129.66</strong><br/>     User <strong class="mq iu">ec2-user</strong><br/>     IdentityFile &lt;PATH TO YOUR KEY PAIR FILE&gt;/&lt;KEY PAIR.pem&gt;</span></pre><ul class=""><li id="d7b7" class="nk nl it lt b lu mr lx ms ma nm me nn mi no mm np nq nr ns bi translated"><code class="fe mn mo mp mq b">Host</code>可以是任何名字。在我的例子中，我选择了<strong class="lt iu"> streamlit-dagshub </strong>。</li><li id="9eb9" class="nk nl it lt b lu oe lx of ma og me oh mi oi mm np nq nr ns bi translated"><code class="fe mn mo mp mq b">Hostname</code>是公共IPv4地址。</li><li id="223f" class="nk nl it lt b lu oe lx of ma og me oh mi oi mm np nq nr ns bi translated"><code class="fe mn mo mp mq b">User</code>不可修改，仍为<strong class="lt iu">ec2-用户</strong>。</li><li id="ccb1" class="nk nl it lt b lu oe lx of ma og me oh mi oi mm np nq nr ns bi translated"><code class="fe mn mo mp mq b">IdentityFile</code>是您的密钥对<strong class="lt iu">的完整路径。您下载的pem </strong>文件。</li></ul><p id="d5cf" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">接下来，授予用户read权限，并使用下面的命令删除所有其他权限。</p><pre class="kj kk kl km gt nw mq nx ny aw nz bi"><span id="16b8" class="mx la it mq b gy oa ob l oc od">chmod 400 &lt;PATH TO YOUR KEY PAIR FILE&gt;/&lt;KEY PAIR.pem&gt;</span></pre><p id="fe44" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">之后，您可以连接到EC2实例，如下所示:</p><pre class="kj kk kl km gt nw mq nx ny aw nz bi"><span id="d506" class="mx la it mq b gy oa ob l oc od">ssh <strong class="mq iu">streamlit-dagshub</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/85d32378af7f2129551f56e2b4c62cdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jYUcDqh154zjUdZfX7BWOg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">SSH成功连接到我的EC2实例</p></figure><h2 id="aa1a" class="mx la it bd lb my mz dn lf na nb dp lj ma nc nd ll me ne nf ln mi ng nh lp ni bi translated">DagsHub、DVC和EC2实例之间的交互</h2><p id="60e6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您可以在下面找到从推送源代码、模型和数据到在EC2实例中运行应用程序的一般工作流程。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/4b01f477ff8a8f3a9f8ab184bb783ac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yspe56Gu2Hdwj-BHvGhqwQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一般工业化工作流程—从本地机器到EC2实例(图片由作者提供)</p></figure><ul class=""><li id="5e28" class="nk nl it lt b lu mr lx ms ma nm me nn mi no mm np nq nr ns bi translated"><strong class="lt iu">任务1 </strong>:使用DVC将源代码、模型和数据推送到DagsHub。</li><li id="47be" class="nk nl it lt b lu oe lx of ma og me oh mi oi mm np nq nr ns bi translated"><strong class="lt iu">任务2 </strong>:克隆源代码，提取模型，然后提取数据，将应用程序运行到EC2中。</li></ul><p id="86c6" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><strong class="lt iu">任务1: </strong> <em class="mw">从您的本地项目存储库</em>执行</p><p id="39e2" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">为了能够执行此任务，您首先需要配置您的DVC遥控器，然后将模型和数据推送到DagsHub存储。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上传_模型_数据. py</p></figure><p id="c16d" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">下面是前面脚本中使用的<strong class="lt iu"> <em class="mw"> params.yaml </em> </strong>文件的格式。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">params.streamlit.yaml</p></figure><p id="7c86" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><strong class="lt iu">任务2: </strong> <em class="mw">从本地EC2实例</em>执行</p><p id="e282" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">在运行应用程序之前，我们需要获得应用程序源代码和依赖项，然后从DagsHub存储中提取模型和数据。从EC2实例中:</p><ul class=""><li id="e5c7" class="nk nl it lt b lu mr lx ms ma nm me nn mi no mm np nq nr ns bi translated">git克隆源代码</li><li id="e911" class="nk nl it lt b lu oe lx of ma og me oh mi oi mm np nq nr ns bi translated">提取模式和数据</li><li id="cb03" class="nk nl it lt b lu oe lx of ma og me oh mi oi mm np nq nr ns bi translated">安装依赖项</li><li id="b412" class="nk nl it lt b lu oe lx of ma og me oh mi oi mm np nq nr ns bi translated">运行streamlit应用</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">准备_ec2.py</p></figure><p id="ef65" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">将以下几行添加到您的<strong class="lt iu"> params.yaml. </strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">params _ streamlit _ additional . YAML</p></figure><p id="2b44" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">我们最终可以从EC2实例运行prepare_instance脚本，然后使用<code class="fe mn mo mp mq b">streamlit run</code>命令运行应用程序。</p><pre class="kj kk kl km gt nw mq nx ny aw nz bi"><span id="84be" class="mx la it mq b gy oa ob l oc od"># Run the script to prepare EC2 instance<br/>python prepare_ec2.py</span><span id="441d" class="mx la it mq b gy pa ob l oc od"># Run the streamlit app<br/>streamlit run app.py</span></pre><p id="08e8" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">在这个过程的最后，我们从EC2终端获得以下URL信息。然后将外部URL复制粘贴到您喜欢的浏览器中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/9cf89193cd667460f319b14ba2857cff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hQ7cbRRW2y-JRtC-ALhykw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">简化从EC2实例运行的it</p></figure><p id="cb06" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">太好了！！！🎉🎉🎉我们的应用程序运行在EC2实例上。但是有一个问题。当我们退出控制台时，应用程序停止运行。这个问题可以用<code class="fe mn mo mp mq b"><a class="ae ky" href="https://doc.ubuntu-fr.org/tmux" rel="noopener ugc nofollow" target="_blank">tmux</a></code>来解决。</p><h2 id="6d6b" class="mx la it bd lb my mz dn lf na nb dp lj ma nc nd ll me ne nf ln mi ng nh lp ni bi translated">简化应用程序—让它持续运行</h2><p id="c9b3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">首先，从EC2实例安装tmux库</p><pre class="kj kk kl km gt nw mq nx ny aw nz bi"><span id="82e7" class="mx la it mq b gy oa ob l oc od">sudo yum install tmux</span></pre><p id="f51c" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">接下来，使用以下命令创建一个tmux会话</p><pre class="kj kk kl km gt nw mq nx ny aw nz bi"><span id="47fd" class="mx la it mq b gy oa ob l oc od">tmux new -s MultiLanguageSentimentStreamlitAppInstance</span></pre><p id="f86f" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">您可以用您想要的任何名称替换multilanguagesentimentstreamlitapinstance，只要它有意义。然后在运行该命令后，我得到以下结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/308cd0d200839e9103145dd01c14e822.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zNg7UggM5mlcISsKMlgJqA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我在tmux会话下运行的streamlit应用程序(图片由作者提供)</p></figure><p id="b433" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">与第一次在没有<strong class="lt iu"> tmux </strong>的情况下运行相反，这一次，我们在终端的底部有一条绿色水平线，这意味着<strong class="lt iu"> tmux </strong>会话是一个。你可以使用Ctrl+C退出终端，应用程序将继续运行，你可以将链接发送给居住在不同大陆的人，他或她将访问相同的应用程序。</p><p id="d137" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">下一步是什么？？？将公共地址映射到域名服务器，以便我们可以使用my_app.com，而不是从公共IP地址访问。</p><h1 id="df5a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="7aa5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">恭喜你！🎉 🍾您刚刚学习了如何使用DagsHub将您的streamlit应用程序部署到AWS EC2实例。如果您仍然对使用DagsHub犹豫不决，现在是时候让您和您的队友利用DagsHub的力量了。</p><p id="be73" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">如果你喜欢阅读我的故事，并希望支持我的写作，考虑<a class="ae ky" href="https://zoumanakeita.medium.com/membership" rel="noopener">成为一个媒体成员</a>。这样做，我会得到一点佣金。</p><p id="39a0" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">此外，您可以随时在<a class="ae ky" href="https://www.linkedin.com/in/zoumana-keita/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae ky" href="https://www.youtube.com/channel/UC9xKdy8cz6ZuJU5FTNtM_pQ" rel="noopener ugc nofollow" target="_blank"> YouTube </a>上添加我，或者在<a class="ae ky" href="https://twitter.com/zoumana_keita_" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我。讨论人工智能、人工智能、数据科学和自然语言处理的东西总是令人愉快的！</p><h1 id="b384" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">额外资源</h1><p id="4e42" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><a class="ae ky" href="https://docs.aws.amazon.com/ec2/index.html?nc2=h_ql_doc_ec2" rel="noopener ugc nofollow" target="_blank"> AWS EC2文档</a></p><p id="1ce9" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><a class="ae ky" href="https://dagshub.com/" rel="noopener ugc nofollow" target="_blank"> DagsHub网站</a></p><p id="ba5e" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/nlp-mlops-project-with-dagshub-multi-language-sentiment-classification-using-transformers-fcbe6164b171">文章第一部分</a></p><p id="0dfc" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><a class="ae ky" href="https://dagshub.com/zoumana.keita/MultiLanguageSentimentStreamlitApp" rel="noopener ugc nofollow" target="_blank">Dag shub上的源代码</a></p><p id="1f7b" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><a class="ae ky" href="http://18.191.74.237:8501" rel="noopener ugc nofollow" target="_blank">链接到AWS EC2上的应用程序</a></p><p id="1ae8" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">再见🏃🏾‍♂️</p></div></div>    
</body>
</html>