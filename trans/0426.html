<html>
<head>
<title>How to Manage Multiple Python Versions on an Apple Silicon M1 Mac</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在苹果硅M1 Mac上管理多个Python版本</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-use-manage-multiple-python-versions-on-an-apple-silicon-m1-mac-d69ee6ed0250#2022-02-17">https://towardsdatascience.com/how-to-use-manage-multiple-python-versions-on-an-apple-silicon-m1-mac-d69ee6ed0250#2022-02-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6ff2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">安装ARM64和x86 Python版本，并使用pyenv在它们之间无缝切换</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6b67c20d43ee6ed13ff3521e57c92b14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c3LyH3RS0o38ET2s"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">尼克·里克特在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="5c14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">本文介绍如何使用pyenv管理ARM64和x86 Python环境。如果你更喜欢环境管理的康达，请看</em> <a class="ae ky" href="https://medium.com/p/1e29cb3bad12" rel="noopener"> <em class="lv">我的另一篇文章</em> </a> <em class="lv">。</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="481f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能永远不会在你的所有项目中使用同一个版本的Python。一方面，Python是一种活跃的语言，你会想要利用最新的特性(<a class="ae ky" href="https://docs.python.org/3/whatsnew/3.10.html" rel="noopener ugc nofollow" target="_blank"> Python 3.10 </a>最近发布了！).另一方面，当您升级已安装的Python版本时，您不希望破坏所有的旧代码。作为一名数据科学家，我经常遇到这种情况——我经常需要重新运行旧的分析或项目，因此我需要一种方法在我的机器上支持多个Python版本。</p><p id="db34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是版本管理的用武之地，我的首选工具是<a class="ae ky" href="https://github.com/pyenv/pyenv" rel="noopener ugc nofollow" target="_blank"> pyenv </a>。使用pyenv，您可以在您的机器上安装多个Python版本<strong class="lb iu">并在它们之间轻松切换。</strong></p><p id="6225" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">注:本文面向Mac用户，尤其是Apple Silicon Mac用户。Linux用户可能会从pyenv教程中受益，但是Windows用户就没那么幸运了——pyenv没有正式支持Windows。</em></p><h1 id="0236" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">使用pyenv安装Python版本</h1><p id="6704" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">使用pyenv安装和管理多个版本的Python真的很容易。参见<a class="ae ky" href="https://github.com/pyenv/pyenv" rel="noopener ugc nofollow" target="_blank">文档</a>了解全部细节，但这里有安装任何版本Python的简单说明:</p><h2 id="2d1b" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">1.安装自制软件</h2><p id="259b" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">家酿是一个MacOS的软件包管理器。它允许你安装各种有用的工具。要安装它，请遵循这里的简单说明<a class="ae ky" href="https://brew.sh" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="03e6" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">2.安装和配置pyenv</h2><p id="9a17" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">pyenv是一个Python版本管理工具。它允许您安装多个版本的Python，并在它们之间轻松切换。</p><p id="319e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要安装，请遵循以下说明(或参见官方GitHub库上的完整安装说明):</p><ol class=""><li id="aa4d" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">使用brew安装:<code class="fe nv nw nx ny b">brew install pyenv</code></li><li id="2d79" class="nm nn it lb b lc nz lf oa li ob lm oc lq od lu nr ns nt nu bi translated">将下面几行添加到~/中。zprofile和~/。zshrc(或者~/。bash_profile和~/。bashrc如果你还在用bash):</li></ol><pre class="kj kk kl km gt oe ny of og aw oh bi"><span id="fec1" class="na me it ny b gy oi oj l ok ol">##### ~/.zprofile #####<br/>eval "$(pyenv init --path)"</span><span id="aa77" class="na me it ny b gy om oj l ok ol"><br/>##### ~/.zshrc #####<br/>if command -v pyenv 1&gt;/dev/null 2&gt;&amp;1; then<br/>    eval "$(pyenv init -)"<br/>fi</span></pre><p id="5de9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后退出shell会话，并启动一个新的会话以使更改生效。您已经成功安装了pyenv！</p><h2 id="3e94" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">3.安装Python版本</h2><p id="6b07" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">用pyenv安装Python很容易。例如，要安装Python 3.9.7，您可以运行<code class="fe nv nw nx ny b">pyenv install 3.9.7</code>(使用<code class="fe nv nw nx ny b">pyenv install -l</code>显示可安装的版本列表)。要激活环境，运行<code class="fe nv nw nx ny b">pyenv global 3.9.7</code>(使其成为所有地方的默认版本)或<code class="fe nv nw nx ny b">pyenv local 3.9.7</code>(使<em class="lv">仅</em>当前目录使用该版本)。</p><h1 id="f764" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">苹果硅苹果电脑的其他挑战</h1><p id="ef50" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">上述步骤几乎总是足够了。然而，在较新的苹果电脑上(就我个人而言，<a class="ae ky" href="https://medium.com/towards-data-science/why-i-chose-the-macbook-air-over-the-macbook-pro-as-a-data-scientist-9207f309db0c" rel="noopener">我用的是M1 MacBook Air </a>)，你可能会在安装某些软件包时遇到问题。当苹果从英特尔芯片转到他们内部的苹果硅芯片时，他们从x86架构变成了ARM64架构。这在很大程度上是一件好事——你在日常使用中会注意到的唯一区别是，新芯片比旧芯片更快、更高效。</p><p id="fde0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，您可能偶尔会遇到包兼容性问题。苹果的ARM64架构尚不支持一些Python包——例如，我在使用ortools包时就遇到了这个问题。您将在安装期间得到错误，并且您将不能在您的代码中使用这个包。最终，当开发人员为他们的包添加ARM64支持时，这个问题应该会消失，但与此同时，您必须找到另一个解决方案。</p><p id="cafb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，有一个短期的解决方案:<strong class="lb iu">你可以在Apple Silicon Mac上安装x86架构的Python。更好的是，您仍然可以使用pyenv来管理您的环境。</strong></p><h1 id="f8e9" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">使用Rosetta和pyenv的x86环境</h1><p id="60cf" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">如果你需要使用只在x86架构上工作的包，只需要遵循这些步骤。首先尝试前面的步骤，只有在遇到软件包安装问题时才到这里来。否则，您会牺牲性能而没有任何好处。</em>T13】</strong></p><h2 id="acdf" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">1.安装Rosetta</h2><p id="e3a2" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">Rosetta是一种软件，允许苹果硅MAC运行为基于英特尔的MAC设计的应用程序。如果你需要使用一个版本的Python用于x86架构，你将需要Rosetta。</p><p id="fd97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要安装Rosetta，请在您的终端中运行以下命令:</p><pre class="kj kk kl km gt oe ny of og aw oh bi"><span id="247c" class="na me it ny b gy oi oj l ok ol">softwareupdate --install-rosetta</span></pre><p id="9078" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后按照提示同意许可协议并运行安装。</p><h2 id="57ae" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">2.创建一个Rosetta终端</h2><p id="12cd" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">现在我们需要一种使用Rosetta运行命令的方法。首先，复制终端app。导航到/应用程序/实用工具并复制终端:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/77ff04c35e7e3f8ebfa0ae35ed1d1125.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IZp0DvmkykuEP517_JYNmA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图。</p></figure><p id="71ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后将新副本重命名为类似“罗塞塔终端”的名称。接下来，右键单击新终端，单击“获取信息”并选中“使用Rosetta打开”框:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/d1bb4d25673ff7a26f313e546cefa96f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TSlEZ6kWbGCTCim91huWYA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图。</p></figure><p id="09e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以使用这个新的终端来执行使用Rosetta和x86架构的命令。将它用于剩余的步骤。</p><h2 id="f7f9" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">3.安装自制软件</h2><p id="452f" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">遵循这里的简单说明<a class="ae ky" href="https://brew.sh" rel="noopener ugc nofollow" target="_blank"/>。和在ARM64架构上安装Homebrew完全一样，只是会自动安装到不同的位置。</p><h2 id="e4c3" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">4.安装pyenv</h2><p id="1650" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如果你已经在上面安装了它，那就万事俱备了。否则，请遵循“使用pyenv安装Python版本”说明中的步骤2。</p><h2 id="ed2b" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">5.修改。zshrc</h2><p id="45e8" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们已经安装了我们需要的一切。现在我们需要一种方法来告诉我们的机器使用brew和pyenv的x86版本。我的首选方法是将下面几行代码添加到。zshrc(或者。bashrc)文件:</p><pre class="kj kk kl km gt oe ny of og aw oh bi"><span id="168e" class="na me it ny b gy oi oj l ok ol">##### ~/.zshrc #####</span><span id="26d3" class="na me it ny b gy om oj l ok ol"># rosetta terminal setup<br/>if [ $(arch) = "i386" ]; then<br/>    alias brew86="/usr/local/bin/brew"<br/>    alias pyenv86="arch -x86_64 pyenv"<br/>fi</span></pre><p id="2d98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">命令识别我们是否正在运行一个Rosetta终端。<code class="fe nv nw nx ny b">brew86</code>别名调用x86位置的brew版本(ARM64位置为<code class="fe nv nw nx ny b">/opt/homebrew/bin</code>)。<code class="fe nv nw nx ny b">pyenv86</code>别名在x86架构下执行pyenv。</p><p id="e2fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，你现在可以从你的罗塞塔终端呼叫<code class="fe nv nw nx ny b">brew86 install ...</code>或<code class="fe nv nw nx ny b">pyenv86 install ...</code>。</p><h2 id="3972" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">5.安装pyenv-alias插件(可选)</h2><p id="d4f7" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">默认情况下，pyenv不允许您为Python版本提供自定义名称。如果您希望在ARM64和x86架构下安装相同的Python版本，这可能是一个问题。pyenv-alias插件解决了这个问题。遵循此处的安装说明<a class="ae ky" href="https://github.com/s1341/pyenv-alias" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="302c" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">6.使用pyenv创建您的x86环境</h2><p id="15d6" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">您终于可以安装x86 Python版本了！在您的Rosetta终端中，只需运行<code class="fe nv nw nx ny b">pyenv86 install x.x.x</code>(用真实的Python版本代替<code class="fe nv nw nx ny b">x.x.x</code>)。如果您在上一步中安装了pyenv-alias插件，我建议您在x86环境中添加一个别名。比如<code class="fe nv nw nx ny b">VERSION_ALIAS="x.x.x_x86" pyenv86 install x.x.x</code>。</p><p id="289f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当您运行<code class="fe nv nw nx ny b">pyenv versions</code>时，您将看到所有的ARM64和x86 Python版本。当您在项目中遇到包兼容性问题时，您可以很容易地切换到x86环境。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="7885" class="md me it bd mf mg op mi mj mk oq mm mn jz or ka mp kc os kd mr kf ot kg mt mu bi translated">结论</h1><p id="d485" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如果你有一台Apple Silicon Mac，有一天你可能会遇到软件包安装问题，但是本文中的步骤提供了一个无缝的解决方法(嗯，就像你将要得到的一样接近无缝)。最终，在开发人员有足够的时间将ARM64支持添加到他们的包中后，这些步骤可能会过时，但对于一些利基包来说，这可能需要几年时间。同时，我希望这篇文章能为您节省一些故障排除时间！</p><p id="f7e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python版本管理可能很棘手。就个人而言，我喜欢pyenv的简单。还有其他解决方案(<a class="ae ky" href="https://medium.com/p/1e29cb3bad12" rel="noopener">如conda </a>)，但在我看来pyenv是最容易使用的。如果你有另一个你更喜欢的工具，我很乐意听听它！</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="75b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://medium.com/@djcunningham0/membership" rel="noopener">成为媒体会员</a>访问成千上万作家的故事！</p></div></div>    
</body>
</html>