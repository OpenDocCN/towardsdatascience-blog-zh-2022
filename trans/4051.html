<html>
<head>
<title>Using Panel and hvPlot to Visualize Decades of Wildfires</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Panel和hvPlot可视化几十年的野火</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-panel-and-hvplot-to-visualize-decades-of-wildfires-2ac8d6f5db25#2022-09-08">https://towardsdatascience.com/using-panel-and-hvplot-to-visualize-decades-of-wildfires-2ac8d6f5db25#2022-09-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d856" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们建立一个仪表板，使用Holoviz工具了解更多关于1992年至2015年期间发生的数百万起野火的信息</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4516c762c5ada6493b55d0b07e9fb94b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i9Lioua3ZtXfHZ7ZaF1A3g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@mattpalmer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">马特·帕尔默</a>在<a class="ae ky" href="https://unsplash.com/s/photos/fires?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="e9d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最近写了一篇关于使用Python库Panel制作数据仪表板的文章。我们创建了一个简单的仪表板，允许我们可视化数据集每年的各种汇总图。在这篇文章中，我想在这些技能的基础上，使用Panel制作一个仪表板来查看美国野火记录的时间序列。</p><p id="feff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的数据集包括1992年至2015年间发生在美国的超过180万起野火。我们的目标是构建一个数据仪表板，帮助我们更好地了解这些野火的原因、发生地点等。</p><h1 id="e309" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">数据准备</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/4842e7e7d24e45dbf3eb0198ee47d5c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pUaWWwYvN2nOt-6GZ6qzpg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者创建</p></figure><p id="7f10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导入我们的数据非常简单。我们可以使用<code class="fe mq mr ms mt b">sqlite3</code>连接到我们的SQLite数据库，并查询我们想要处理的信息。这些信息被存储在一个熊猫数据框中，这样我们就可以删除阿拉斯加和夏威夷，使绘图更容易。最后，我们可以通过从火灾数据中减去发现火灾的日期来计算燃烧时间。</p><h1 id="9d30" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">绘制野火地图</h1><p id="144b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们从绘制所有火灾的地图开始，这样我们就可以看到空间分布。我们可以使用hvPlot轻松做到这一点，因为它利用了Datashader来光栅化我们的180万个点，这使得它们更易于渲染。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/75d1274899f276192c397c892c817da8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*m46RxWvtjA3RC7xMnDFg1w.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者创建</p></figure><p id="f9c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以使用<a class="ae ky" href="https://nbviewer.org/github/wino6687/Medium_Notebooks/blob/main/wildfires_panel_examples.ipynb" rel="noopener ugc nofollow" target="_blank">贴在这里</a>的互动笔记本与这些情节互动。令人印象深刻的是，使用hvPlot创建高质量的空间可视化是多么容易。由于它利用了其他Holoviz库——holo views、Geoviews、Datashader和Colorcet——它简化了创建交互式地图所需的许多常规步骤，该地图仍然可以响应大型数据集。</p><h1 id="738b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">带有时间滑块的简单仪表板</h1><p id="c78d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">用静态图来可视化时间序列数据可能会很烦人，然而，Panel的小部件让我们可以使用各种方法来操作和子集化我们的数据，比如选择年份的滑块。</p><p id="7c5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">制作带面板的仪表板有三个步骤:</p><ol class=""><li id="239a" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">定义一个小部件，比如选择年份的整数滑块或下拉列表。</li><li id="bebc" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">定义一个绘图函数，将滑块中的年份值作为输入。</li><li id="686b" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">布局和渲染我们的仪表板。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/f176a53d01c5b4f5b7a7ce535a8162d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*IAup1tp0K3KIJXiAnfevbA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者创建</p></figure><h2 id="af06" class="no lw it bd lx np nq dn mb nr ns dp mf li nt nu mh lm nv nw mj lq nx ny ml nz bi translated">制作简单仪表板的快速方法</h2><p id="bce7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当我们只有一个图和一个小部件要显示时，布置仪表板似乎需要很多额外的代码。对于这样一个简单的仪表板，我们可以使用<code class="fe mq mr ms mt b">.interactive</code>来制作数据帧和/或数据管道的交互式副本。</p><p id="2bdf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要了解这是如何工作的，让我们看看是否可以制作一个小部件，让我们选择火灾的原因，并让地图只显示这些火灾。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/ff4e95c56e64110ee6a1492644e9664b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*-cZ7pAAelcqh8QohNRR47g.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者创建</p></figure><p id="cc1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">令人高兴的是，我们不必担心我们的仪表板的布局，而是可以定义我们的小部件和附带的绘图。在这篇文章中，我们不会关注交互式数据框架，但是，我认为在创建这些不太复杂的仪表板时提到它们是有好处的。</p><h1 id="d1d4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">构建我们的仪表板</h1><p id="eece" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们有了基本的地图，但仪表板最强大的部分之一是能够一次看到我们数据的多个方面。让我们创建一些地块来配合我们的地图，然后使用面板将它们连接在一起。</p><p id="3ab9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">火灾规模</strong></p><p id="43eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以从绘制每个尺寸等级发生的火灾数量开始；野火按燃烧面积大小分类，A级最小，G级最大。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/7be4e563560db1592063d5e41fe51ad7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7y0siZ6tGWpeZAxD6Ru4XA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者创建</p></figure><p id="59f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们所有的绘图函数都将年份作为参数，这样当滑块值改变时，它们可以对数据进行子集化。这里，我们可以使用子集化的数据按照大小分类对数据帧进行分组，并使用<code class="fe mq mr ms mt b">.size()</code>来计算每组中的火灾数量。</p><p id="66a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">按原因划分的燃烧时间</strong></p><p id="cd56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们接下来的两个图都将着眼于野火的原因；野火有许多原因，其发生频率和潜在危险有很大差异。让我们先来看看2003年每场野火的平均燃烧时间。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/f4a6ca6e0beb104b3f2609fe036d690f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dh65OPaXFiE7cnacrzBEVw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者创建</p></figure><p id="59d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">按原因划分的火灾数量</strong></p><p id="72e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，不考虑燃烧时间，让我们简单地看看2003年各组引起的火灾数量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/3952e4019432f4eca399def38d6e4736.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rf4k0TWc4mjG9gnT3Y3P5g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者创建</p></figure><p id="6228" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到两个图之间的一些有趣的差异，比如吸烟是如何导致第二长的野火，而它在引起的野火总数中排名第九。除了闪电，燃烧时间最长的火灾并不是最频繁发生的。</p><p id="1a63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们思考是什么让野火难以扑灭时，这是有意义的；如果火灾发生在更偏远的地方，那么很难在早期控制住火势。闪电、吸烟和营火都有可能在这类地区引发火灾，这些地区有大量的木材可以燃烧，周围很少有人报告烟雾的最初迹象。</p><p id="ee93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也有一些年份可能看起来很不一样，比如2006年，少量的输电线故障导致了平均持续几天的大火灾。让我们来看看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/8db10ae44abc3577f9ab75ba1e1eedf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7sPNFaf4L6XmgzMvq7URXQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者创建</p></figure><p id="a395" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里需要注意的是Panel和hvPlot如何识别这两个图共享相同的y轴，并重新组织第二个图以匹配第一个图。尽管我对两个数据帧都进行了排序，所有这一切还是发生了，所以如果你想避免这种情况，就在你的图中添加<code class="fe mq mr ms mt b">.opts(axiswise=True)</code>。</p><h2 id="278d" class="no lw it bd lx np nq dn mb nr ns dp mf li nt nu mh lm nv nw mj lq nx ny ml nz bi translated">把它放在一起</h2><p id="1f5b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在，我们已经有了小部件和一些要在我们的时间序列中探索的图，我们可以继续创建我们的仪表板了！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/33c593dfba5beb0c5abd13d721e82a1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*GCOWeY2WweuptwVPdm0g0g.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者创建</p></figure><p id="5255" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这样，我们有了一个工作仪表板！我知道gif并不理想，所以一定要检查一下<a class="ae ky" href="https://nbviewer.org/github/wino6687/Medium_Notebooks/blob/main/wildfires_panel_examples.ipynb" rel="noopener ugc nofollow" target="_blank">互动笔记本</a>，这样你就可以自己摆弄这些情节了。撇开gif不谈，考虑到我们这么快就把它组合在一起，这是一个相当不错的仪表盘。</p><h2 id="19bc" class="no lw it bd lx np nq dn mb nr ns dp mf li nt nu mh lm nv nw mj lq nx ny ml nz bi translated">改进的余地</h2><p id="b4f5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我确信我们可以通过简化绘图函数中运行的代码来提高响应速度。对于那些我不想解释每一行代码是做什么的文章，我会尽量让代码片段可读性更好。</p><p id="af7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，当通过<code class="fe mq mr ms mt b">year</code>对数据帧进行子集化时，会有很多重复；我们可能会在每次<code class="fe mq mr ms mt b">year</code>值改变时对数据帧进行一次子集化，然后将子集化后的数据传递给每个绘图函数。</p><h1 id="b5bd" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">包扎</h1><p id="245d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">除了制作实际的情节之外，我们几乎不需要付出任何努力，当谈到将我们的情节“链接”在一起时，hvPlot和Panel可以为我们做的事情非常酷。</p><p id="5a64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Holoviz工具有时会让人感到有些畏惧，因为它们已经创建了一个庞大且相互关联的生态系统，有许多方法可以产生类似的可视化效果。在Python中使用数据可视化时，需要记住的一件关键事情是，总有许多工具和方法可以实现您的目标。有些可能比其他人有优势，但重要的是开始尝试它们。</p><h1 id="b4d4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">资源:</h1><ul class=""><li id="8cd3" class="na nb it lb b lc mu lf mv li od lm oe lq of lu og ng nh ni bi translated"><a class="ae ky" href="https://nbviewer.org/github/wino6687/Medium_Notebooks/blob/main/wildfires_panel_examples.ipynb" rel="noopener ugc nofollow" target="_blank">剧情互动笔记本</a></li><li id="c1b4" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu og ng nh ni bi translated"><a class="ae ky" href="https://holoviews.org/reference_manual/holoviews.util.html#holoviews.util.transform.lon_lat_to_easting_northing" rel="noopener ugc nofollow" target="_blank">将纬度/经度转换为纬度/经度</a> (Holoview文档)</li><li id="fb6f" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu og ng nh ni bi translated"><a class="ae ky" href="https://holoviz.org/tutorial/Composing_Plots.html#overlay-with-a-tiled-map" rel="noopener ugc nofollow" target="_blank">在平铺地图上覆盖数据</a> (hvPlot文档)</li></ul><p id="32cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="oh">注:</em> </strong> <em class="oh">如果您喜欢在Medium上阅读我和其他人的内容，请考虑使用下面的链接订阅，以支持这样的内容创建，并解锁无限的故事！</em></p><div class="oi oj gp gr ok ol"><a href="https://medium.com/@willmnorris/membership" rel="noopener follow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd iu gy z fp oq fr fs or fu fw is bi translated">用我的推荐链接加入媒体-威尔·诺里斯</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">阅读威尔·诺里斯(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">medium.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz ks ol"/></div></div></a></div><h1 id="807a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">引文</h1><p id="9675" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">数据集:<a class="ae ky" href="https://www.kaggle.com/datasets/rtatman/188-million-us-wildfires?datasetId=2478&amp;searchQuery=wildfire" rel="noopener ugc nofollow" target="_blank">野火</a>(公共领域CC0)</p><p id="bf68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">短，凯伦C. 2017。美国1992–2015年的空间野火发生数据[FPA <em class="oh"> FOD </em> 20170508]。第四版。柯林斯堡，CO:林务局研究数据档案。【https://doi.org/10.2737/RDS-2013-0009.4 T4】</p></div></div>    
</body>
</html>