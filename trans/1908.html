<html>
<head>
<title>Analysing web visitors</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">分析网络访问者</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/analysing-web-visitors-38be175f35c9#2022-05-02">https://towardsdatascience.com/analysing-web-visitors-38be175f35c9#2022-05-02</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="d77a" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">使用代码和低代码米托方法进行探索性数据分析</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/a1e327b27c7d66609b1d6c8c8a918116.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*a5CnrE_R9cLOw3sm"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Alexander Schimmeck 在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="fbdd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">混合方法的美妙之处在于根据具体情况提供不同的方法。蟒蛇熊猫可以被视为汽油或柴油发动机；电动汽车可以被视为一个完全无代码的解决方案。我们知道熊猫的编码限制，但是我们对无编码方法的交换感到舒服吗，比如<a class="ae kz" href="https://www.trymito.io/plans" rel="noopener ugc nofollow" target="_blank">米托</a>？代码方法中有太多的操作，用用户界面构建可能会很耗时。继续读下去，让我们进入混合动力的世界，看看我们是如何发展的？</p><h2 id="87fa" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">概述</h2><p id="a7e5" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">我的任务是向求职者揭露NLP程序，安全是我的首要任务。如果你是第一次收听，那么需要注意的是<a class="ae kz" href="https://medium.com/towards-data-science/from-nlp-prototype-to-production-c2b555488dc5" rel="noopener">我已经使用FastAPI和vue.js </a>构建了一个应用程序，并且<a class="ae kz" href="https://www.justresumes.net/" rel="noopener ugc nofollow" target="_blank">在AWS </a>上托管了它。应用程序基础结构已经就绪，我已经对安全性进行了分类；我相信是合理的！前一段时间我已经制定出了NLP战略。几个月过去了，因为我最初创建服务器和托管网站，所以我想检查和看看什么样的交通模式已经发展。由于这是一个数据分析的挑战，我致力于在我的工作中使用米托作为试验。</p><h2 id="8f90" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">检索服务器日志、解析和创建数据框</h2><p id="7709" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">在我的<a class="ae kz" rel="noopener" target="_blank" href="/monitoring-to-protect-data-890b21a186c1">上一篇文章</a>中，我安装了AWS命令行并设计了一个命令，该命令将日志文件从服务器复制到一个<a class="ae kz" href="https://www.techtarget.com/searchaws/definition/AWS-bucket" rel="noopener ugc nofollow" target="_blank"> S3桶</a>。这是第一步——将日志从虚拟服务器检索到S3存储桶。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj mu"><img src="../Images/2275046ccd047dd6a66cff21af7b45e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VFeL_jsqXAkdRe4mMM6fjw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">登录到虚拟服务器并发出拷贝到S3命令—图片由作者从一个活动的SSH会话创建。</p></figure><p id="19ed" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">通过从/var/log目录发出命令，我复制了文件名中包含“log”的所有文件，这种方法既快又脏，但在混合环境中已经足够了。一个简单的命令行调用可以节省大量的点击和拖放操作。如果你不熟悉S3水桶，这里有一个快速截图。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj mv"><img src="../Images/73e4d0bf682e4cde06e5b0a132fafff3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gjGXGTeL15tgwWeU5hLg5A.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">此项目的相关S3存储桶的屏幕截图—图片由作者在活动登录会话中提供。</p></figure><p id="a01d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在文件已经在S3存储桶上了，我可以运行我的脚本将文件传输到我的Mac Mini M1。自从上一篇文章以来，我确实对我的脚本做了一些改进。</p><pre class="kk kl km kn gu mw mx my mz aw na bi"><span id="e583" class="lw lx iu mx b gz nb nc l nd ne">import os<br/>import boto3<br/>from s3, import AmazonS3 as AmazonS3<br/>s3worker = AmazonS3()<br/>s3worker.show_contents_s3_bucket()<br/>s3worker.download_contents_s3_buckeet()<br/>s3worker.empty_bucket()</span></pre><p id="50a8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因为将文件从S3转移到本地机器的所有机制都很无聊，所以我使用了一个类，将这些无聊的东西抽象出来。创建一个AmazonS3的实例作为s3worker并调用这些方法:-</p><ul class=""><li id="5eb3" class="nf ng iu lc b ld le lg lh lj nh ln ni lr nj lv nk nl nm nn bi translated">下载内容s3存储桶()</li><li id="aa15" class="nf ng iu lc b ld no lg np lj nq ln nr lr ns lv nk nl nm nn bi translated">empty_bucket()</li></ul><p id="44b6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">将日志文件提取到本地机器并清除存储桶。那么，为什么要为你不需要的存储付费呢？日志解析策略和代码没有变化，但是我做了一些整理。</p><pre class="kk kl km kn gu mw mx my mz aw na bi"><span id="9321" class="lw lx iu mx b gz nb nc l nd ne">import pandas as pd</span><span id="f90c" class="lw lx iu mx b gz nt nc l nd ne">df = pd.DataFrame(records)<br/>out = store+"data.csv"<br/>df.to_csv(out)</span><span id="58a6" class="lw lx iu mx b gz nt nc l nd ne">for log in logs:<br/>    fullpath=store+log<br/>    if ('data.csv' not in log or 'pickle' not in log):<br/>        os.remove(fullpath)</span></pre><p id="0fe9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">一旦日志解析完成，我仍然构建数据帧，但是我将数据存储为CSV格式，并删除复制到本地机器上的所有文件。始终保持环境清洁是安全和隐私的核心。我的本地环境中现在有一个CSV文件，我可以用它来探索米托。我们现在就去那里吧！</p><h2 id="0565" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">和米托一起探索</h2><p id="2cb4" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">米托有一个合适的主页，并且有该工具的开源、专业和企业版本。请随意点击查看网站<a class="ae kz" href="https://www.trymito.io" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="d3b5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://docs.trymito.io/getting-started/installing-mito" rel="noopener ugc nofollow" target="_blank">安装</a>是通过传统的PIP方法，但是有一个额外的步骤。</p><pre class="kk kl km kn gu mw mx my mz aw na bi"><span id="bba7" class="lw lx iu mx b gz nb nc l nd ne">python -m pip install mitoinstaller<br/>python -m mitoinstaller install</span></pre><p id="5fc1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在Mac上，我无法使用Jupyter笔记本，但在Jupyter Lab上却能流畅运行！我使用Anaconda，Jupyter Lab只需点击Anaconda Navigator。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nu"><img src="../Images/1d99c52ef1b605a36c9102886a0acf18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*01gPES6ZwidBsCLL18ZgBA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">朱庇特实验室的一些早期细胞——作者图片</p></figure><p id="198a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">7号和8号牢房处理一些内务。使用mito需要加载mitosheet包。<a class="ae kz" href="https://pypi.org/project/ip2geotools/" rel="noopener ugc nofollow" target="_blank"> ip2geotools包</a>允许将ip地址翻译成城市。Nginx日志只给了我一个IP地址，这在EDA中并不容易。</p><p id="00af" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">单元格8设置了一组变量，指向上一节中的CSV文件。下面的单元格9将CSV读入一个名为df的数据帧。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nv"><img src="../Images/f9c9a930e71470dec5ce4cee38337dfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZID1nOIG-MB5h8Ihhl-QRw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Jupyter实验室的9号细胞——图片由作者提供。将CSV文件加载到数据框</p></figure><p id="8355" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">移动到类似电子表格的界面就像调用传递数据框对象的sheet方法一样简单。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nv"><img src="../Images/919f9c95cf87edbd257add862ae273fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GthrnD3djls4B4MR6zAIZw.png"/></div></div></figure><p id="805f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">像Excel一样，我们可以在屏幕底部使用不同的工作表。点击加号按钮打开文件导入向导。我已经展示了加载的df和df_pivot表。创建视觉效果很简单。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nv"><img src="../Images/4e643298f5ba799da1a6eb263d706567.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RMglPDrtdVuiwLDe6i865w.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">使用米托创建直方图很容易。图片由作者提供。</p></figure><p id="ff36" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我可以很容易地看到，我的大部分网络流量或访客来自美国注册的IP地址。在美国设置一个过滤器，我可以深入到该地区，注意到加州的流量，也许硅谷想要购买我的网站；嗯，我们可以祈祷！</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nv"><img src="../Images/e089bb9fa0619dda95c3e08954e99dda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j97cNZq-EWL5YNjZC7Sy9g.png"/></div></div></figure><p id="9c1d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在加州过滤让我看看有没有机会！</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nv"><img src="../Images/516d099e055ac03653a7d9ff020bbaac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A5FOBMRASM6pvVOL98PRZQ.png"/></div></div></figure><p id="299e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">事实上，来自旧金山的人一直在访问我的网站。万岁！创建这些视觉效果非常方便，我喜欢无代码的方法。</p><p id="1788" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是等一下！这一切似乎太容易了。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nw"><img src="../Images/f0db3f084823c2e7c383d9b5bb63e63a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nqTXEudWIMccBBwp"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><a class="ae kz" href="https://unsplash.com/@kaip?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">凯·皮尔格</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="1fcd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在开源版本中，操作是最少的。下面是显示类似于Microsoft Excel功能区的功能的工具栏</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nx"><img src="../Images/8282e3e62293043703798c0b50f24ea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*soMFpHRnNqUAXpOoJPU6nQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">类似Excel功能区的美图工具栏</p></figure><p id="9a9e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">由于电子表格界面不支持，我不得不通过代码完成大多数传统的清理和丰富工作。以下代码中的一些示例</p><ul class=""><li id="849c" class="nf ng iu lc b ld le lg lh lj nh ln ni lr nj lv nk nl nm nn bi translated">将包含日期的字符串转换为日期和时间列</li><li id="bc40" class="nf ng iu lc b ld no lg np lj nq ln nr lr ns lv nk nl nm nn bi translated">调用函数从IP地址中检索国家、地区、城市</li><li id="ab3b" class="nf ng iu lc b ld no lg np lj nq ln nr lr ns lv nk nl nm nn bi translated">处理缺失值</li><li id="2a3f" class="nf ng iu lc b ld no lg np lj nq ln nr lr ns lv nk nl nm nn bi translated">将字段拆分成组件以提取HTTP方法</li></ul><pre class="kk kl km kn gu mw mx my mz aw na bi"><span id="8419" class="lw lx iu mx b gz nb nc l nd ne">df = df[['remote_addr', 'remote_user', 'time_local', 'request',<br/>       'status', 'bytesSent', 'referrer', 'agent']]<br/>#05/Mar/2022:00:06:55 +0000<br/>df['date_time'] = pd.to_datetime(df['time_local'], format='%d/%b/%Y:%H:%M:%S %z')<br/>del df['time_local']<br/>df['date'] = df.date_time.dt.date<br/>df['time'] = df.date_time.dt.time<br/>df['request'] = df['request'].fillna(" ")<br/>df = df.fillna(" ")<br/>df['action'] = df.request.apply(lambda x: x.split(" ")[0])<br/>#Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36<br/>df['browser'] = df.agent.apply(lambda x: x.split(" "))<br/>#df['os'] = df.agent.apply(lambda x: x.split(" ")[1])<br/>df['elems'] = df.agent.apply(lambda x: splitter(x))<br/>df['count'] = 1</span><span id="2711" class="lw lx iu mx b gz nt nc l nd ne">ips = df['remote_addr'].unique()<br/>#print(len(ips))<br/>#res = iped(ips[0:10],ip_country, ipsed)<br/>#df = df[(df['date'] &gt; pd.to_datetime('2021-03-01'))]<br/>ips = df['remote_addr'].unique()<br/>print(len(ips))<br/>res = iped(ips,ip_country)<br/>df['country'] = df.remote_addr.apply(lambda x: country(x, res, 'country'))<br/>df['region'] = df.remote_addr.apply(lambda x: country(x, res, 'region'))<br/>df['city'] = df.remote_addr.apply(lambda x: country(x, res, 'city'))</span></pre><p id="94f3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因此，使用Python、Jupyter Labs、Pandas和米托是一种真正的混合方法。数据集的清理和准备似乎适合代码方法，而干净数据的探索和可视化似乎非常适合米托。</p><p id="45d7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">尽管如此，我知道来自旧金山的人们正在访问我的网站，所以也许是时候我把我的电梯推介放在一起，在旧金山的一些电梯里闲逛了。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ny"><img src="../Images/9ab99c2095f7df4d30aba1c680bb203a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kLa7OLDzj8Cz2_La"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@flaken?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">弗雷德·克勒贝尔</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="51f8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果你花时间远离编码，记忆会变得很困难，因此这些混合工具很方便。我喜欢这些混合方法！</p><div class="nz oa gq gs ob oc"><a href="https://cognitivedave.medium.com/membership" rel="noopener follow" target="_blank"><div class="od ab fp"><div class="oe ab of cl cj og"><h2 class="bd iv gz z fq oh fs ft oi fv fx it bi translated">通过我的推荐链接-大卫·摩尔加入媒体</h2><div class="oj l"><h3 class="bd b gz z fq oh fs ft oi fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ok l"><p class="bd b dl z fq oh fs ft oi fv fx dk translated">cognitivedave.medium.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq kt oc"/></div></div></a></div></div></div>    
</body>
</html>