<html>
<head>
<title>A Small Python Library For Marketing Mix Modeling: MaMiMo</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个用于营销组合建模的小型Python库:MaMiMo</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-small-python-library-for-marketing-mix-modeling-mamimo-100f31666e18#2022-05-17">https://towardsdatascience.com/a-small-python-library-for-marketing-mix-modeling-mamimo-100f31666e18#2022-05-17</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><h2 id="923e" class="is it iu bd b dl iv iw ix iy iz ja dk jb translated" aria-label="kicker paragraph"><a class="ae ep" href="https://medium.com/tag/marketing-analytics" rel="noopener">营销分析</a></h2><div class=""/><div class=""><h2 id="61eb" class="pw-subtitle-paragraph ka jd iu bd b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dk translated">以scikit-learn方式创建营销组合模型</h2></div><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ks"><img src="../Images/f6c9422c4917f309325e1e4df9ddd5e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ir45fi4fydln7m8W"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">克里斯·劳顿在<a class="ae li" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="f893" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">你好！我注意到人们对我关于营销组合建模的文章非常感兴趣，这就是为什么我为您创建了一个小礼物:一个帮助您自己创建简单营销组合模型的小库！在本文中，我将向您展示如何使用它。</p><blockquote class="mf mg mh"><p id="e932" class="lj lk mi ll b lm ln ke lo lp lq kh lr mj lt lu lv mk lx ly lz ml mb mc md me in bi translated"><strong class="ll je"> <em class="iu"> ⚠义不容辞的警告⚠: </em> </strong> <em class="iu">我尽了最大的努力让这个库尽可能的扎实无错。然而，仍然可能有错误，所以在向利益相关者报告任何事情之前，请总是做一些理智检查。如果你发现了一个错误或者请求了一个特性，就给我发一条消息，或者——更好的是——在Github </em>  <em class="iu">上创建一个</em> <a class="ae li" href="https://github.com/Garve/mamimo" rel="noopener ugc nofollow" target="_blank"> <em class="iu">拉取请求！😉</em></a></p></blockquote></div><div class="ab cl mm mn hy mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="in io ip iq ir"><p id="97a3" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">如果你不知道什么是营销组合建模:想象你在一家销售东西的公司。为了卖更多的东西，你做广告。在某些时候，你想知道你的广告在每个渠道的表现有多好，如电视、广播、网页横幅广告……并回答这样的问题:“那周我在电视广告中投入的1000 €，增加了我多少收入？”。营销组合建模是做到这一点的简单方法。你可以在我的文章中找到更多相关信息:</p><div class="mt mu gq gs mv mw"><a rel="noopener follow" target="_blank" href="/introduction-to-marketing-mix-modeling-in-python-d0dd81f4e794"><div class="mx ab fp"><div class="my ab mz cl cj na"><h2 class="bd je gz z fq nb fs ft nc fv fx jd bi translated">Python市场营销组合建模简介</h2><div class="nd l"><h3 class="bd b gz z fq nb fs ft nc fv fx dk translated">哪些广告支出真正推动了你的销售？</h3></div><div class="ne l"><p class="bd b dl z fq nb fs ft nc fv fx dk translated">towardsdatascience.com</p></div></div><div class="nf l"><div class="ng l nh ni nj nf nk lc mw"/></div></div></a></div><div class="mt mu gq gs mv mw"><a rel="noopener follow" target="_blank" href="/an-upgraded-marketing-mix-modeling-in-python-5ebb3bddc1b6"><div class="mx ab fp"><div class="my ab mz cl cj na"><h2 class="bd je gz z fq nb fs ft nc fv fx jd bi translated">Python中升级的营销组合建模</h2><div class="nd l"><h3 class="bd b gz z fq nb fs ft nc fv fx dk translated">让我平庸的营销组合模式更加强大</h3></div><div class="ne l"><p class="bd b dl z fq nb fs ft nc fv fx dk translated">towardsdatascience.com</p></div></div><div class="nf l"><div class="nl l nh ni nj nf nk lc mw"/></div></div></a></div><p id="79de" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">我创建的库被创造性地命名为<a class="ae li" href="https://github.com/Garve/mamimo" rel="noopener ugc nofollow" target="_blank"> <strong class="ll je">马米莫</strong> </a>，如果你知道如何使用scikit-learn，你也可以使用这个库。让乐趣从简单的</p><blockquote class="nm"><p id="09b5" class="nn no iu bd np nq nr ns nt nu nv me dk translated"><code class="fe nw nx ny nz b">pip install mamimo</code></p></blockquote><h1 id="7903" class="oa ob iu bd oc od oe of og oh oi oj ok kj ol kk om km on kn oo kp op kq oq or bi translated">一个小例子</h1><p id="4863" class="pw-post-body-paragraph lj lk iu ll b lm os ke lo lp ot kh lr ls ou lu lv lw ov ly lz ma ow mc md me in bi translated">如果你已经阅读了这两篇顶级文章——我想从现在开始——你可能记得我们在那里使用了一个人工数据集。然后，我们定义了一些饱和度和结转转换来进行营销组合建模。我将一个类似但稍微复杂一点的示例数据集放入mamimo中，以帮助您入门:</p><pre class="kt ku kv kw gu ox nz oy bn oz pa bi"><span id="f3dc" class="pb ob iu nz b be pc pd l pe pf">from mamimo.datasets import load_fake_mmm<br/><br/>data = load_fake_mmm()<br/><br/>X = data.drop(columns=['Sales'])<br/>y = data['Sales']</span></pre><p id="f041" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">这为我们提供了一个数据集，它包含每周的日期索引、三个媒体渠道和一个我们想要解释的销售列。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj pg"><img src="../Images/774b884101bfe4637292b285d05c4a84.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*p2aRwvZIK6n90U2gETCcnw.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">图片由作者提供。</p></figure><p id="a9df" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">让我们绘制销售图，看看发生了什么:</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ph"><img src="../Images/95bad61d2f9b721c17a83c485bfbbcb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZPOHYeAOTAxYNQ78EqeVlg.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">图片由作者提供。</p></figure><p id="73cc" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">在这里，我们可以看到一个总体上升的趋势。也可能有季节性，但光看很难判断。让我们也来看看房间里的大象:2020年1月第一周的这个大峰值。我们会假设这是对我们的产品非常重要的一天，而<strong class="ll je">不是</strong>只是一个例外。</p><p id="664f" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">然而，让我们暂时保持简单，只是尝试使用电视、广播和横幅广告来解释销售。<a class="ae li" rel="noopener" target="_blank" href="/an-upgraded-marketing-mix-modeling-in-python-5ebb3bddc1b6">与第二篇文章</a>一样，我们想要构建以下模型:</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj pi"><img src="../Images/33ae1e01c2e2c1f4d3755ebdab9744cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1RrC_InQrDCzH8CVbpXwNA.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">图片由作者提供。</p></figure><h2 id="1dd0" class="pj ob iu bd oc pk pl dn og pm pn dp ok ls po pp om lw pq pr oo ma ps pt oq ja bi translated">开始</h2><p id="3361" class="pw-post-body-paragraph lj lk iu ll b lm os ke lo lp ot kh lr ls ou lu lv lw ov ly lz ma ow mc md me in bi translated">我们可以使用mamimo的结转和饱和子模块，以及比scikit-learn版本更灵活的<code class="fe nw nx ny nz b">LinearRegression</code>以一种简单的方式实现这条管道。我们需要scikit-learn的是流水线功能。</p><blockquote class="mf mg mh"><p id="79ef" class="lj lk mi ll b lm ln ke lo lp lq kh lr mj lt lu lv mk lx ly lz ml mb mc md me in bi translated"><strong class="ll je"> <em class="iu">提醒:</em> </strong> <em class="iu"> </em> <code class="fe nw nx ny nz b"><em class="iu">ColumnTransformer</em></code> <em class="iu">对不同的列应用不同的管道。我们需要它对不同的通道有不同的超参数。</em></p></blockquote><pre class="kt ku kv kw gu ox nz oy bn oz pa bi"><span id="f7d3" class="pb ob iu nz b be pc pd l pe pf">from mamimo.carryover import ExponentialCarryover<br/>from mamimo.saturation import ExponentialSaturation<br/>from mamimo.linear_model import LinearRegression<br/>from sklearn.compose import ColumnTransformer<br/>from sklearn.pipeline import Pipeline<br/><br/>adstock = ColumnTransformer(<br/>    [<br/>     ('tv_pipe', Pipeline([<br/>            ('carryover', ExponentialCarryover()),<br/>            ('saturation', ExponentialSaturation())<br/>     ]), ['TV']),<br/>     ('radio_pipe', Pipeline([<br/>            ('carryover', ExponentialCarryover()),<br/>            ('saturation', ExponentialSaturation())<br/>     ]), ['Radio']),<br/>     ('banners_pipe', Pipeline([<br/>            ('carryover', ExponentialCarryover()),<br/>            ('saturation', ExponentialSaturation())<br/>     ]), ['Banners']),<br/>    ]<br/>)<br/><br/>model = Pipeline([<br/>    ('adstock', adstock),<br/>    ('regression', LinearRegression(positive=True))<br/>])</span></pre><p id="3180" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">这样产生的模型本身并不是很好，因为它仍然需要超参数调整。</p><pre class="kt ku kv kw gu ox nz oy bn oz pa bi"><span id="da75" class="pb ob iu nz b be pc pd l pe pf">print(model.fit(X, y).score(X, y))<br/><br/># Output:<br/># 0.10985072579909416</span></pre><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ph"><img src="../Images/2b2c0eccf76ecc34d4d09f4960bcf88c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3HdCf58ZXMnuGlsX6egOgg.png"/></div></div></figure><p id="35ab" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">甚至在同一套设备上进行培训和评估<strong class="ll je">(从不👏做👏那👏在👏生产👏)</strong>产生了一个相当糟糕的结果——我们<strong class="ll je">欠配</strong>。因此，让我们调整一些超参数。</p><h2 id="ba77" class="pj ob iu bd oc pk pl dn og pm pn dp ok ls po pp om lw pq pr oo ma ps pt oq ja bi translated">超参数调谐</h2><p id="a33f" class="pw-post-body-paragraph lj lk iu ll b lm os ke lo lp ot kh lr ls ou lu lv lw ov ly lz ma ow mc md me in bi translated">今天就让我们用sklearn的<code class="fe nw nx ny nz b">RandomSearchCV</code>来调一下超参数。我们将分别调整所有通道的饱和指数以及残留强度和长度。例如，您可以通过<code class="fe nw nx ny nz b">adstock__radio_pipe__carryover__window</code>设置<strong class="ll je">无线电传输长度</strong>。</p><pre class="kt ku kv kw gu ox nz oy bn oz pa bi"><span id="55f3" class="pb ob iu nz b be pc pd l pe pf">from scipy.stats import uniform, randint<br/>from sklearn.model_selection import RandomizedSearchCV, TimeSeriesSplit<br/><br/>tuned_model = RandomizedSearchCV(<br/>    model,<br/>    param_distributions={<br/>        'adstock__tv_pipe__carryover__window': randint(1, 10),<br/>        'adstock__tv_pipe__carryover__strength': uniform(0, 1),<br/>        'adstock__tv_pipe__saturation__exponent': uniform(0, 1),<br/>        'adstock__radio_pipe__carryover__window': randint(1, 10),<br/>        'adstock__radio_pipe__carryover__strength': uniform(0, 1),<br/>        'adstock__radio_pipe__saturation__exponent': uniform(0, 1),<br/>        'adstock__banners_pipe__carryover__window': randint(1, 10),<br/>        'adstock__banners_pipe__carryover__strength': uniform(0, 1),<br/>        'adstock__banners_pipe__saturation__exponent': uniform(0,1),<br/>    },<br/>    cv=TimeSeriesSplit(),<br/>    random_state=0,<br/>    n_iter=100<br/>)</span></pre><p id="ad67" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">这基本上是试图找到0到1范围内携带污染强度和饱和指数的最佳超参数，以及1到10(周)范围内携带污染长度的整数。该算法尝试<code class="fe nw nx ny nz b">n_iter=100</code>不同的随机超参数组合，并使用sklearn的<code class="fe nw nx ny nz b">TimeSeriesSplit()</code>使用<strong class="ll je"> 5倍扩展窗口时间序列分割</strong>来评估<strong class="ll je"> <em class="mi"> r </em> </strong>。如果我们喜欢，我们也可以使用<a class="ae li" href="https://en.wikipedia.org/wiki/Mean_absolute_percentage_error" rel="noopener ugc nofollow" target="_blank"> MAPE </a>，因为业务人员喜欢这个指标，使用<code class="fe nw nx ny nz b">scoring='neg_mean_absolute_percentage_error'</code>关键字。</p></div><div class="ab cl mm mn hy mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="in io ip iq ir"><p id="0539" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">训练后，我们可以检查最佳超参数:</p><pre class="kt ku kv kw gu ox nz oy bn oz pa bi"><span id="708f" class="pb ob iu nz b be pc pd l pe pf">print(tuned_model.best_params_)<br/><br/># Output:<br/># 'adstock__banners_pipe__carryover__strength': 0.6817399450693612,<br/># 'adstock__banners_pipe__carryover__window': 1,<br/># 'adstock__banners_pipe__saturation__exponent': 0.097493384215085,<br/># 'adstock__radio_pipe__carryover__strength': 0.8518536993666015,<br/># 'adstock__radio_pipe__carryover__window': 1,<br/># 'adstock__radio_pipe__saturation__exponent': 0.1598452868541913,<br/># &gt;&gt;&gt; 'adstock__tv_pipe__carryover__strength': 0.04680635471218875,<br/># &gt;&gt;&gt; 'adstock__tv_pipe__carryover__window': 4,<br/># 'adstock__tv_pipe__saturation__exponent': 0.0038603515102610952</span></pre><p id="b8ed" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">因此，该模型认为，例如，电视结转效应持续4周，约4.68%的效应结转到下周。像这样的声明是商业的黄金。</p><blockquote class="nm"><p id="5dd6" class="nn no iu bd np nq nr ns nt nu nv me dk translated">这个输出让您以简单易懂的方式向涉众解释您的模型。</p></blockquote><p id="cd39" class="pw-post-body-paragraph lj lk iu ll b lm pu ke lo lp pv kh lr ls pw lu lv lw px ly lz ma py mc md me in bi translated">尽管如此，这个模型还是很糟糕，所以我不会相信目前为止发现的超参数。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ph"><img src="../Images/2afc8d93e5a8d8a8da1215184575d3ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LikTxXjcv2sa3_oH_LqNVg.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">图片由作者提供。</p></figure><p id="063d" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">输出和以前有同样的问题:没有趋势，峰值也无法解释。</p><blockquote class="nm"><p id="582c" class="nn no iu bd np nq nr ns nt nu nv me dk translated">在这种时候，我们应该加入更多可以解释销售的特征。这可以是产品的价格，时间特征，谷歌趋势，天气，假期，以及任何你想要的东西。</p></blockquote><p id="cfd7" class="pw-post-body-paragraph lj lk iu ll b lm pu ke lo lp pv kh lr ls pw lu lv lw px ly lz ma py mc md me in bi translated">我们现在将通过给它一个趋势，一个热点编码月份以及2020年1月第一周发生的事情的信息来增强该模型。</p><h2 id="3319" class="pj ob iu bd oc pk pl dn og pm pn dp ok ls po pp om lw pq pr oo ma ps pt oq ja bi translated">融入时间特征</h2><p id="3542" class="pw-post-body-paragraph lj lk iu ll b lm os ke lo lp ot kh lr ls ou lu lv lw ov ly lz ma ow mc md me in bi translated">我还添加了一些方便的功能来增加更多的功能。看看这个:</p><pre class="kt ku kv kw gu ox nz oy bn oz pa bi"><span id="f692" class="pb ob iu nz b be pc pd l pe pf">from mamimo.time_utils import add_time_features, add_date_indicators<br/><br/>X = (X<br/>     .pipe(add_time_features, month=True)<br/>     .pipe(add_date_indicators, special_date=["2020-01-05"])<br/>     .assign(trend=range(200))<br/>)</span></pre><p id="8350" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">这增加了</p><ul class=""><li id="6abb" class="pz qa iu ll b lm ln lp lq ls qb lw qc ma qd me qe qf qg qh bi translated">月份列(1到12之间的整数)，</li><li id="e0ca" class="pz qa iu ll b lm qi lp qj ls qk lw ql ma qm me qe qf qg qh bi translated">一个名为<code class="fe nw nx ny nz b">special_date</code>的二进制列，在2020年1月5日为1，在其他地方为0，并且</li><li id="0715" class="pz qa iu ll b lm qi lp qj ls qk lw ql ma qm me qe qf qg qh bi translated">一个(到目前为止是线性的)趋势，只从0到199递增。</li></ul><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div class="gi gj qn"><img src="../Images/3bcd40c34f06eafd6cac03601db5051f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*iPkUH70amWOZijv6LVhM3A.png"/></div><p class="le lf gk gi gj lg lh bd b be z dk translated">图片由作者提供。</p></figure><p id="96da" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">当我们构建下一个模型时，所有这些特性都将得到完善。除了媒体频道，我们将对新功能进行以下预处理:</p><ul class=""><li id="cade" class="pz qa iu ll b lm ln lp lq ls qb lw qc ma qd me qe qf qg qh bi translated">月份被一次性编码</li><li id="e463" class="pz qa iu ll b lm qi lp qj ls qk lw ql ma qm me qe qf qg qh bi translated">线性趋势可以被提升到某个幂，例如二次增长趋势的趋势(商业将是快乐的)</li><li id="87c2" class="pz qa iu ll b lm qi lp qj ls qk lw ql ma qm me qe qf qg qh bi translated">这个特殊的日期也会产生延期效应，也就是说，我们认为不仅2020年1月5日这一周很重要，之后的几周也很重要，这与媒体渠道延期的逻辑相同</li></ul><pre class="kt ku kv kw gu ox nz oy bn oz pa bi"><span id="5cc5" class="pb ob iu nz b be pc pd l pe pf">from mamimo.time_utils import PowerTrend<br/>from mamimo.carryover import ExponentialCarryover<br/>from mamimo.saturation import ExponentialSaturation<br/>from sklearn.linear_model import LinearRegression<br/>from sklearn.preprocessing import OneHotEncoder<br/>from sklearn.compose import ColumnTransformer<br/>from sklearn.pipeline import Pipeline<br/><br/>cats =  [list(range(1, 13))] # different months, known beforehand<br/><br/>preprocess = ColumnTransformer(<br/>    [<br/>     ('tv_pipe', Pipeline([<br/>            ('carryover', ExponentialCarryover()),<br/>            ('saturation', ExponentialSaturation())<br/>     ]), ['TV']),<br/>     ('radio_pipe', Pipeline([<br/>            ('carryover', ExponentialCarryover()),<br/>            ('saturation', ExponentialSaturation())<br/>     ]), ['Radio']),<br/>     ('banners_pipe', Pipeline([<br/>            ('carryover', ExponentialCarryover()),<br/>            ('saturation', ExponentialSaturation())<br/>     ]), ['Banners']),<br/>    ('month', OneHotEncoder(sparse=False, categories=cats), ['month']),<br/>    ('trend', PowerTrend(), ['trend']),<br/>    ('special_date', ExponentialCarryover(), ['special_date'])<br/>    ]<br/>)<br/><br/>new_model = Pipeline([<br/>    ('preprocess', preprocess),<br/>    ('regression', LinearRegression(<br/>        positive=True,<br/>        fit_intercept=False) # no intercept because of the months<br/>    )<br/>])</span></pre><p id="94b8" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">拟合这个仍未调整的模型显示了更好的性能:</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ph"><img src="../Images/df7c55dc997ea255cc2ef19e4072649d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nPRs7VU3YoKQUeQ64W0Emw.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">图片由作者提供。</p></figure><p id="942b" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">哇！这是<strong class="ll je">已经近乎完美的合体</strong>。想象一下我们调整超参数后会发生什么。似乎在2020年1月5日添加趋势和指标已经很有帮助了。</p><h2 id="8595" class="pj ob iu bd oc pk pl dn og pm pn dp ok ls po pp om lw pq pr oo ma ps pt oq ja bi translated">最后一首曲子</h2><p id="f68a" class="pw-post-body-paragraph lj lk iu ll b lm os ke lo lp ot kh lr ls ou lu lv lw ov ly lz ma ow mc md me in bi translated">让我们也调整新的超参数。也许线性趋势不是我们能做到的最好的。此外，到目前为止，所有的结转都不存在，因为如果不提供超参数，这是<code class="fe nw nx ny nz b">ExponentialCarryover</code>的默认行为。我们现在将再创建一个超参数优化作业:</p><pre class="kt ku kv kw gu ox nz oy bn oz pa bi"><span id="8ac4" class="pb ob iu nz b be pc pd l pe pf">from scipy.stats import randint, uniform<br/>from sklearn.model_selection import RandomizedSearchCV, TimeSeriesSplit<br/><br/>tuned_new_model = RandomizedSearchCV(<br/>  new_model,<br/>  param_distributions={<br/>    'preprocess__tv_pipe__carryover__window': randint(1, 10),<br/>    'preprocess__tv_pipe__carryover__strength': uniform(0, 1),<br/>    'preprocess__tv_pipe__saturation__exponent': uniform(0, 1),<br/>    'preprocess__radio_pipe__carryover__window': randint(1, 10),<br/>    'preprocess__radio_pipe__carryover__strength': uniform(0,1),<br/>    'preprocess__radio_pipe__saturation__exponent': uniform(0, 1),<br/>    'preprocess__banners_pipe__carryover__window': randint(1, 10),<br/>    'preprocess__banners_pipe__carryover__strength': uniform(0, 1),<br/>    'preprocess__banners_pipe__saturation__exponent': uniform(0, 1),<br/>    'preprocess__trend__power': uniform(0, 2),           # new<br/>    'preprocess__special_date__window': randint(1, 10),  # new<br/>    'preprocess__special_date__strength': uniform(0, 1), # new<br/>  },<br/>  cv=TimeSeriesSplit(),<br/>  random_state=0,<br/>  n_iter=1000, # some more iterations, takes more time<br/>)<br/><br/>tuned_model.fit(X, y)</span></pre><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ph"><img src="../Images/d61bfd4377f58732c3782251c006eb94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bf4NKiUPNVVH87-7PNNZGw.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">图片由作者提供。</p></figure><p id="eb1b" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">尖峰信号的建模变得更糟，但我认为其余部分现在看起来好多了。也许我们可以通过尝试更多的超参数组合来更好地模拟尖峰信号，但让我们假设我们现在对结果感到满意。让我们得到超参数:</p><pre class="kt ku kv kw gu ox nz oy bn oz pa bi"><span id="bbbe" class="pb ob iu nz b be pc pd l pe pf">print(tuned_new_model.best_params_)<br/><br/># Output:<br/># 'preprocess__banners_pipe__carryover__strength': 0.98037507922965,<br/># 'preprocess__banners_pipe__carryover__window': 1,<br/># 'preprocess__banners_pipe__saturation__exponent': 0.1763329074644,<br/># 'preprocess__radio_pipe__carryover__strength': 0.9417421432655166,<br/># 'preprocess__radio_pipe__carryover__window': 1,<br/># 'preprocess__radio_pipe__saturation__exponent': 0.069184804692642,<br/># 'preprocess__special_date__strength': 0.8667029791268241,<br/># 'preprocess__special_date__window': 6,<br/># &gt; 'preprocess__trend__power': 1.463860555363072,<br/># 'preprocess__tv_pipe__carryover__strength': 0.3422263312509606,<br/># 'preprocess__tv_pipe__carryover__window': 1,<br/># 'preprocess__tv_pipe__saturation__exponent': 0.3591065076533001</span></pre><p id="28df" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">太好了，所以趋势不是线性的，而是t^1.464的形式，这意味着甚至<strong class="ll je">比线性的</strong>更强。</p><p id="c415" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">如果您也对线性回归系数感兴趣，可以通过</p><pre class="kt ku kv kw gu ox nz oy bn oz pa bi"><span id="f514" class="pb ob iu nz b be pc pd l pe pf">import pandas as pd<br/><br/>best_model = tuned_new_model.best_estimator_<br/>pd.Series(<br/>    best_model.named_steps['regression'].coef_,<br/>    index=best_model[:-1].get_feature_names_out()<br/>)<br/><br/># Output:<br/># tv_pipe__TV                    3389.936227<br/># radio_pipe__Radio              2278.722723<br/># banners_pipe__Banners          2455.014524<br/># month__month_1                 2724.333162<br/># month__month_2                 2991.294009<br/># month__month_3                 4080.414741<br/># month__month_4                 4542.696378<br/># month__month_5                 3484.384654<br/># month__month_6                 3785.648376<br/># month__month_7                 2497.006415<br/># month__month_8                 2068.016338<br/># month__month_9                 1883.746572<br/># month__month_10                2179.914547<br/># month__month_11                2135.526582<br/># month__month_12                2233.341158<br/># trend__trend                      9.801207<br/># special_date__special_date    96822.051131</span></pre><h1 id="c34f" class="oa ob iu bd oc od oe of og oh oi oj ok kj qo kk om km qp kn oo kp qq kq oq or bi translated">计算渠道贡献</h1><p id="0de0" class="pw-post-body-paragraph lj lk iu ll b lm os ke lo lp ot kh lr ls ou lu lv lw ov ly lz ma ow mc md me in bi translated">现在我们有了一个训练有素的模型，我们想知道每个渠道每周对销售额的贡献。为了方便起见，我创建了一个<code class="fe nw nx ny nz b">breakdown</code>函数来做这件事。</p><pre class="kt ku kv kw gu ox nz oy bn oz pa bi"><span id="313d" class="pb ob iu nz b be pc pd l pe pf">from mamimo.analysis import breakdown<br/><br/>contributions = breakdown(tuned_new_model.best_estimator_, X, y)<br/>ax = contributions.plot.area(<br/>    figsize=(16, 10),<br/>    linewidth=1,<br/>    title="Predicted Sales and Breakdown",<br/>    ylabel="Sales",<br/>    xlabel="Date",<br/>)<br/><br/>handles, labels = ax.get_legend_handles_labels()<br/>ax.legend(<br/>    handles[::-1],<br/>    labels[::-1],<br/>    title="Channels",<br/>    loc="center left",<br/>    bbox_to_anchor=(1.01, 0.5),<br/>)</span></pre><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj qr"><img src="../Images/705a43e12988d0cb570864c16bf7f854.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SIlnsYXxRjhSZf-1jE4aDQ.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">图片由作者提供。</p></figure><p id="5e22" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">唷，那是一堆颜色——非常难以理解。这是因为分组过于精细，没有必要，例如，我们每个月都有一种颜色。</p><p id="5ab8" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">根据模型，我们可以将所有的<code class="fe nw nx ny nz b">month__</code>变量和<code class="fe nw nx ny nz b">trend__trend</code>变量放入<strong class="ll je">基线</strong>，即不考虑媒体支出的情况下我们的销售额。我们可以通过分解函数来总结这些细粒度的贡献，如下所示:</p><pre class="kt ku kv kw gu ox nz oy bn oz pa bi"><span id="280c" class="pb ob iu nz b be pc pd l pe pf">group_channels = {<br/>    'Baseline': [f'month__month_{i}' for i in range(1, 13)] + ['Base', 'trend__trend']<br/>} # read: 'Baseline consists of the months, base and trend.'<br/>  # You can add more groups!<br/><br/>contributions = breakdown(<br/>    tuned_new_model.best_estimator_,<br/>    X,<br/>    y,<br/>    group_channels<br/>)</span></pre><p id="0d26" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">这将产生一个较小的数据帧</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj qs"><img src="../Images/cca5695b487f6c1fce814da1628e1401.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Haxb1-TkMZ38Pl6xseg5cw.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">图片由作者提供。</p></figure><p id="d181" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">让我们再次给这个数据框起一个更好的名字</p><pre class="kt ku kv kw gu ox nz oy bn oz pa bi"><span id="08ab" class="pb ob iu nz b be pc pd l pe pf">contributions.columns = [<br/>    'TV', 'Radio', 'Banners',<br/>    'Special Date', 'Baseline'<br/>]</span></pre><p id="a0f0" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">然后绘图</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj qt"><img src="../Images/a1b5c1765abf418360e0ff56dcd6d59c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xHzrUMMTKGxo7dvKpebjNg.png"/></div></div></figure><p id="a2a2" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">太棒了。内容现在相当容易理解:</p><ul class=""><li id="41d4" class="pz qa iu ll b lm ln lp lq ls qb lw qc ma qd me qe qf qg qh bi translated">基线随着时间的推移而增加，似乎也有季节性</li><li id="01ba" class="pz qa iu ll b lm qi lp qj ls qk lw ql ma qm me qe qf qg qh bi translated">电视、广播和标语都有一定的贡献</li><li id="3a8a" class="pz qa iu ll b lm qi lp qj ls qk lw ql ma qm me qe qf qg qh bi translated">我们可以看到<em class="mi">特殊日期</em>的效果</li></ul><h2 id="47e3" class="pj ob iu bd oc pk pl dn og pm pn dp ok ls po pp om lw pq pr oo ma ps pt oq ja bi translated"><strong class="ak">计算投资回报</strong></h2><p id="f723" class="pw-post-body-paragraph lj lk iu ll b lm os ke lo lp ot kh lr ls ou lu lv lw ov ly lz ma ow mc md me in bi translated">我没有为此创建一个方便的函数(还没有？)但您也可以计算每个通道的ROI，如下所示:</p><pre class="kt ku kv kw gu ox nz oy bn oz pa bi"><span id="655c" class="pb ob iu nz b be pc pd l pe pf">for channel in ['TV', 'Radio', 'Banners']:<br/>    roi = contributions[channel].sum() / X[channel].sum()<br/>    print(f'{channel}: {roi:.2f}')<br/><br/># Output: <br/># TV: 0.33<br/># Radio: 0.47<br/># Banners: 1.23</span></pre><p id="96c9" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">从这里看，电视和广播似乎表现不佳，因为投资回报率低于1，也就是说，我们在过去200周内在电视(广播)上花费的每欧元平均只产生0.33 € (0.47 €)的回报<strong class="ll je"/>。</p><p id="4501" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">横幅广告的平均表现很好，我们在那里花的每一欧元都变成了1.23 €。</p><blockquote class="mf mg mh"><p id="f84a" class="lj lk mi ll b lm ln ke lo lp lq kh lr mj lt lu lv mk lx ly lz ml mb mc md me in bi translated"><strong class="ll je"> <em class="iu">注:</em> </strong> <em class="iu">如果我们考虑其他时间段，即仅2019年或仅2020年，这些陈述可能会改变。例如，对于2019年，我们可以这样计算</em></p></blockquote><pre class="kt ku kv kw gu ox nz oy bn oz pa bi"><span id="bfd1" class="pb ob iu nz b be pc pd l pe pf">for channel in ['TV', 'Radio', 'Banners']:<br/>    roi = contributions.loc['2019-01-01':'2019-12-31', channel].sum() / X.loc['2019-01-01':'2019-12-31', channel].sum()<br/>    print(f'{channel}: {roi:.2f}')<br/><br/># Output:<br/># TV: 0.36<br/># Radio: 0.50<br/># Banners: 1.22</span></pre><p id="6a26" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">那都是乡亲们！</p><h1 id="1872" class="oa ob iu bd oc od oe of og oh oi oj ok kj qo kk om km qp kn oo kp qq kq oq or bi translated">结论</h1><p id="ec72" class="pw-post-body-paragraph lj lk iu ll b lm os ke lo lp ot kh lr ls ou lu lv lw ov ly lz ma ow mc md me in bi translated">我向你展示了我的新库MaMiMo，让你的营销组合建模生活更容易。它与scikit-learn和类似的库集成得很好，它允许您做以下事情(到目前为止！):</p><ul class=""><li id="2bb0" class="pz qa iu ll b lm ln lp lq ls qb lw qc ma qd me qe qf qg qh bi translated">定义饱和度(指数、希尔、Adbudg、BoxCox)</li><li id="ed47" class="pz qa iu ll b lm qi lp qj ls qk lw ql ma qm me qe qf qg qh bi translated">定义结转(指数、高斯)</li><li id="2bc8" class="pz qa iu ll b lm qi lp qj ls qk lw ql ma qm me qe qf qg qh bi translated">添加时间功能(日、月、月中的周、…、趋势)</li><li id="d817" class="pz qa iu ll b lm qi lp qj ls qk lw ql ma qm me qe qf qg qh bi translated">改变趋势</li><li id="f084" class="pz qa iu ll b lm qi lp qj ls qk lw ql ma qm me qe qf qg qh bi translated">通过检查渠道贡献来分析模型</li></ul><p id="c04f" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">通过<code class="fe nw nx ny nz b">pip install mamimo</code>安装！</p></div><div class="ab cl mm mn hy mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="in io ip iq ir"><p id="dcf2" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">我希望你今天学到了新的、有趣的、有用的东西。感谢阅读！</p><p id="9575" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated"><strong class="ll je">作为最后一点，如果你</strong></p><ol class=""><li id="be2b" class="pz qa iu ll b lm ln lp lq ls qb lw qc ma qd me qu qf qg qh bi translated"><strong class="ll je">想支持我多写点机器学习和</strong></li><li id="7baf" class="pz qa iu ll b lm qi lp qj ls qk lw ql ma qm me qu qf qg qh bi translated"><strong class="ll je">无论如何，计划获得一个中等订阅，</strong></li></ol><p id="a1f8" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated"><strong class="ll je">为什么不做</strong> <a class="ae li" href="https://dr-robert-kuebler.medium.com/membership" rel="noopener"> <strong class="ll je">通过这个环节</strong> </a> <strong class="ll je">？这将对我帮助很大！😊</strong></p><p id="6d4c" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">透明地说，给你的价格不变，但大约一半的订阅费直接归我。</p><p id="790e" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated"><strong class="ll je">非常感谢，如果你考虑支持我！</strong></p><blockquote class="nm"><p id="9820" class="nn no iu bd np nq nr ns nt nu nv me dk translated"><em class="qv">如有问题，在</em><a class="ae li" href="https://www.linkedin.com/in/dr-robert-k%C3%BCbler-983859150/" rel="noopener ugc nofollow" target="_blank"><em class="qv">LinkedIn</em></a><em class="qv">上写我！</em></p></blockquote></div></div>    
</body>
</html>