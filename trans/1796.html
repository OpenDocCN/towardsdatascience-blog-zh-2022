<html>
<head>
<title>Implementing FastAPI in 10 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在10分钟内实现FastAPI</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/implementing-fastapi-in-10-minutes-d161cdd7c075#2022-04-27">https://towardsdatascience.com/implementing-fastapi-in-10-minutes-d161cdd7c075#2022-04-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a28f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">开发、测试和使用您的自定义API</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2af44fd41a0e3acd03ee4b9d9487977d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nChBa4OhxleV6m62"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Levi Elizaga 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="077e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv"> API(应用编程接口)</em> </strong>是计算机程序之间的连接。通俗地说，我们可以把API想象成一个Python函数，用户“调用一个API”就可以执行一个任务或者得到一定的结果。一个流行的例子是把API比作一个服务员，你告诉服务员你从菜单中选择的订单，服务员将把它传达给厨房(一个“系统”)，厨房准备你的订单，服务员将把你完成的订单返回给你。</p><p id="9766" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">API是有价值的，可以货币化——现在几乎所有东西都是API！想知道天气预报，网站界面调用一个<a class="ae ky" href="https://openweathermap.org/api" rel="noopener ugc nofollow" target="_blank">天气API </a>。如果你想知道从一个地方到另一个地方的最短路线，谷歌地图网站/移动应用程序调用<a class="ae ky" href="https://developers.google.com/maps/documentation/javascript/directions" rel="noopener ugc nofollow" target="_blank">谷歌方向服务API </a>。你明白了。</p><p id="35d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以使用多种框架在Python中实现API，其中一些框架包括Django、Flask或FastAPI。本文是关于如何使用FastAPI框架开发、测试和使用自定义API的分步指南。如果您已经对API有所了解，可以跳过前两节。</p><p id="f294" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">更新</em> </strong> <em class="lv">:本文是系列文章的一部分。查看其他“10分钟内”话题</em> <a class="ae ky" href="https://medium.com/@kayjanwong/list/in-10-minutes-eeaa9aa67055" rel="noopener"> <em class="lv">此处</em> </a> <em class="lv">！</em></p><h1 id="a698" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">目录</h1><ol class=""><li id="8562" class="mo mp it lb b lc mq lf mr li ms lm mt lq mu lu mv mw mx my bi translated"><a class="ae ky" href="https://medium.com/p/d161cdd7c075/#5f2e" rel="noopener"> HTTP方法和状态代码</a></li><li id="e174" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><a class="ae ky" href="https://medium.com/p/d161cdd7c075/#8cb2" rel="noopener">为什么是FastAPI？</a></li><li id="a02b" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><a class="ae ky" href="https://medium.com/p/d161cdd7c075/#6086" rel="noopener"> FastAPI设置</a></li><li id="c745" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><a class="ae ky" href="https://medium.com/p/d161cdd7c075/#5232" rel="noopener">用FastAPI编写API </a></li><li id="860c" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><a class="ae ky" href="https://medium.com/p/d161cdd7c075/#1966" rel="noopener">测试API </a></li><li id="8efa" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><a class="ae ky" href="https://medium.com/p/d161cdd7c075/#df38" rel="noopener">使用API </a></li></ol><h1 id="5f2e" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">HTTP方法和状态代码</h1><p id="522b" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">重要的是要知道API可以执行什么样的任务，并为正确的任务选择正确的HTTP方法。回到服务员的例子，HTTP方法将菜单上的项目比作“开胃菜”、“主菜”和“甜点”是菜单的一部分，但是像“Bedsheet”这样的东西不属于菜单，也不能订购。</p><p id="0146" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有5种流行的HTTP方法，即<code class="fe nh ni nj nk b">GET</code>、<code class="fe nh ni nj nk b">POST</code>、<code class="fe nh ni nj nk b">PUT</code>、<code class="fe nh ni nj nk b">PATCH</code>和<code class="fe nh ni nj nk b">DELETE</code>，可以用来管理资源的状态。</p><ul class=""><li id="fffd" class="mo mp it lb b lc ld lf lg li nl lm nm lq nn lu no mw mx my bi translated"><code class="fe nh ni nj nk b">GET</code>:检索现有资源(只读)</li><li id="0fc6" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu no mw mx my bi translated"><code class="fe nh ni nj nk b">POST</code>:创建新资源</li><li id="5e26" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu no mw mx my bi translated"><code class="fe nh ni nj nk b">PUT</code>:更新现有资源</li><li id="7c00" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu no mw mx my bi translated"><code class="fe nh ni nj nk b">PATCH</code>:部分更新现有资源</li><li id="b4ce" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu no mw mx my bi translated"><code class="fe nh ni nj nk b">DELETE</code>:删除资源</li></ul><p id="4d2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用<strong class="lb iu"> <em class="lv"> HTTP方法</em> </strong>处理一个请求后，响应中会包含一个<strong class="lb iu"> <em class="lv"> HTTP状态码</em> </strong>。一般来说，状态代码的含义是这样的，</p><ul class=""><li id="18ad" class="mo mp it lb b lc ld lf lg li nl lm nm lq nn lu no mw mx my bi translated"><code class="fe nh ni nj nk b">2xx</code>:操作成功</li><li id="ac3b" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu no mw mx my bi translated"><code class="fe nh ni nj nk b">3xx</code>:重定向</li><li id="6560" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu no mw mx my bi translated"><code class="fe nh ni nj nk b">4xx</code>:客户端错误</li><li id="6b7c" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu no mw mx my bi translated"><code class="fe nh ni nj nk b">5xx</code>:服务器错误</li></ul><p id="e3c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">状态代码的完整列表可在处找到<a class="ae ky" href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes" rel="noopener ugc nofollow" target="_blank">。查看状态代码以确保操作成功执行是很重要的，如果有错误，则进行调试，并将适当的结果返回给用户。</a></p><h1 id="8cb2" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">为什么选择FastAPI？</h1><p id="b901" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">FastAPI于2019年推出，晚于Django (2006)和Flask (2011)等流行框架，并因其快速和高性能而受到欢迎。与Flask框架相比，FastAPI有以下优点:</p><ul class=""><li id="fc3a" class="mo mp it lb b lc ld lf lg li nl lm nm lq nn lu no mw mx my bi translated">Asyncio for concurrency:用关键字<code class="fe nh ni nj nk b">async</code>和<code class="fe nh ni nj nk b">await</code>调用</li><li id="c259" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu no mw mx my bi translated">用于数据验证的Pydantic:在运行时实施模式并检测数据类型</li><li id="0bdc" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu no mw mx my bi translated">用于自动化文档生成的Swagger UI:支持使用扩展名<strong class="lb iu"> <em class="lv"> /docs </em> </strong>测试API端点。文档也有助于理解。Swagger UI的一个替代品是Redoc，可以用扩展<strong class="lb iu"> <em class="lv"> /redoc </em> </strong>访问。</li><li id="6696" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu no mw mx my bi translated">安全和认证功能</li></ul><h1 id="6086" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">FastAPI设置</h1><p id="c66c" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">FastAPI很容易设置，只需在终端上运行以下命令。</p><pre class="kj kk kl km gt np nk nq nr aw ns bi"><span id="b2c7" class="nt lx it nk b gy nu nv l nw nx"><strong class="nk iu">$</strong> pip install fastapi<br/><strong class="nk iu">$</strong> pip install uvicorn[standard]</span></pre><p id="1911" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事不宜迟，让我们开始编写一些API吧！</p><h1 id="5232" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">用FastAPI编写API</h1><p id="7d11" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">实现API遵循相同的整体结构，</p><ol class=""><li id="c1ff" class="mo mp it lb b lc ld lf lg li nl lm nm lq nn lu mv mw mx my bi translated">定义一个API对象，如<code class="fe nh ni nj nk b">app = FastAPI()</code></li><li id="5621" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">使用Pydantic定义数据类型</li><li id="5527" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">将HTTP方法和路径映射到相关的Python函数。前面提到的不同的HTTP方法可以用<code class="fe nh ni nj nk b">@app.get()</code>、<code class="fe nh ni nj nk b">@app.post()</code>、<code class="fe nh ni nj nk b">@app.put()</code>等来调用。分别与可插入的路径耦合为<code class="fe nh ni nj nk b">@app.get("/path")</code></li><li id="f768" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">启动API应用程序，在命令行上运行<code class="fe nh ni nj nk b">uvicorn main:app --reload</code>，其中<code class="fe nh ni nj nk b">main</code>指的是Python文件名，<code class="fe nh ni nj nk b">app</code>指的是在步骤1中创建的API对象</li></ol><p id="6197" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是FastAPI实现演示的代码片段，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="d1a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下部分将引用上面的代码片段，请确保您理解该代码片段！</p><h1 id="1966" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">测试API</h1><p id="bcf7" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">成功启动API应用程序后，控制台日志将打印托管API的URL。通常在<code class="fe nh ni nj nk b">http://127.0.0.1:8000</code>举办。主页遵循主<code class="fe nh ni nj nk b">"/"</code>路径中定义的内容(第14–16行)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/ee83fd4050fae7120ce82c8757c4a3dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/1*qEhOGsTpDIpYL-NIkpAQIQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图API主页——作者图片</p></figure><p id="b2cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以用定义的路径测试各种端点。在本例中，我正在测试<code class="fe nh ni nj nk b">/path</code>扩展(第19–21行)。注意，输入路径扩展名会执行一个<code class="fe nh ni nj nk b">GET</code>请求。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/4be2ef72b6d1eeebb26c23c94e814074.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*ilnyl-HKGd7Amjx2AwAZPw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图API的扩展/路径——作者图片</p></figure><p id="c54b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">类似地，我创建了一个<code class="fe nh ni nj nk b">/path/{path_id}</code>扩展(第29–31行),其中<code class="fe nh ni nj nk b">path_id</code>是一个<code class="fe nh ni nj nk b">int</code>值。如果我输入一个非整数值，将会返回一条错误消息，指出我的类型无效。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/96a9e3055a07d73dbe963b70dc8ea8dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ViTCV3idcKM2fuIJCgneMg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图API端点的类型检查——作者图片</p></figure></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><p id="e299" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的例子都是在执行一个<code class="fe nh ni nj nk b">GET</code>请求，要执行一个<code class="fe nh ni nj nk b">POST</code>请求，我们可以通过进入<strong class="lb iu"> <em class="lv"> /docs </em> </strong>路径扩展并测试一个示例<code class="fe nh ni nj nk b">POST</code>请求来使用Swagger UI。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/c3e4415beca416a957420f6db281b66c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*v-t1KeV8bXCCxdx6oL85GA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图Swagger UI主页——作者图片</p></figure><p id="1b8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，我们可以使用一个<code class="fe nh ni nj nk b">curl</code>命令来执行一个<code class="fe nh ni nj nk b">POST</code>请求。Swagger UI提供了确切的<code class="fe nh ni nj nk b">curl</code>命令来运行，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/0a9487a68f21659e45f4fc730657cbdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*9b1iHGiGf180KwD6dW0-Jw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图5:在Swagger UI上测试POST请求——作者图片</p></figure><p id="1ad7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">恭喜您，您现在已经开发并测试了您自己的自定义API！我们现在来看看如何在Python脚本中实现它，因为API的最终用户可能并不总是使用curl命令或Swagger UI。</p><h1 id="df38" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">使用API</h1><p id="240f" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">要在Python脚本中访问和使用您的API，请使用<code class="fe nh ni nj nk b">requests</code>库，即<code class="fe nh ni nj nk b">requests.get()</code>或<code class="fe nh ni nj nk b">requests.post()</code>分别用于<code class="fe nh ni nj nk b">GET</code>和<code class="fe nh ni nj nk b">POST</code>方法。输入参数包括表示API端点的<code class="fe nh ni nj nk b">url</code>和表示输入字典的<code class="fe nh ni nj nk b">json</code>。</p><p id="e89e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果存储在<code class="fe nh ni nj nk b">res</code>对象中，包含<code class="fe nh ni nj nk b">res.json()</code>中的输出和<code class="fe nh ni nj nk b">res.status_code</code>中的HTTP状态代码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/eac5435af63333eda05ad0e7c37fc0ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0b4MY0oPkZK3o9fTDca6Dw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图6:在Python脚本中使用API作者图片</p></figure></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><p id="463f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望本文介绍了什么是API，以及如何开发、测试和使用FastAPI框架。展望未来，探索如何将您的API与后端数据库连接起来，或者甚至在线托管您的API，以便更多用户可以使用它(不仅仅是在您的本地笔记本电脑上！).</p><p id="fd52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">感谢您的阅读！如果你喜欢这篇文章，请随意分享。</strong></p></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><h1 id="9cfe" class="lw lx it bd ly lz on mb mc md oo mf mg jz op ka mi kc oq kd mk kf or kg mm mn bi translated">相关链接</h1><p id="adbc" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated"><code class="fe nh ni nj nk b">fastapi</code>文档:<a class="ae ky" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank">https://fastapi.tiangolo.com/</a></p><p id="53f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nh ni nj nk b">fastapi</code>官方GitHub:<a class="ae ky" href="https://github.com/tiangolo/fastapi" rel="noopener ugc nofollow" target="_blank">https://github.com/tiangolo/fastapi</a></p></div></div>    
</body>
</html>