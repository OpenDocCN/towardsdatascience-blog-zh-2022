<html>
<head>
<title>Deploying Apache Superset on Google Cloud Run</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Google Cloud Run上部署Apache超集</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploying-apache-superset-on-google-cloud-run-4e8f9b85a78a#2022-05-27">https://towardsdatascience.com/deploying-apache-superset-on-google-cloud-run-4e8f9b85a78a#2022-05-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/78b048e83bbebfcb6f41db2a61efb6cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZHeGL77DQTm28__scHGT1w.jpeg"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">照片由<a class="ae jd" href="https://unsplash.com/@peacelily234?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">伊萨贝尔·🇺🇦</a>在<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h2 id="d7f6" class="je jf jg bd b dl jh ji jj jk jl jm dk jn translated" aria-label="kicker paragraph">数据科学</h2><div class=""/><div class=""><h2 id="7c77" class="pw-subtitle-paragraph km jp jg bd b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dk translated">在几分钟内完成概念验证</h2></div><p id="514e" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">Apache Superset是一个强大的开源仪表板工具。但是，设置可能很麻烦。我将一步一步地带你通过它。</p><h2 id="0dba" class="ma mb jg bd mc md me dn mf mg mh dp mi ln mj mk ml lr mm mn mo lv mp mq mr jm bi translated">介绍</h2><p id="8bcf" class="pw-post-body-paragraph le lf jg lg b lh ms kq lj lk mt kt lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">本指南依赖于附带的GitHub库，可以在这里找到<a class="ae jd" href="https://github.com/bengen343/superset-on-gcp-cloud-run" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="183b" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">概括地说，我们将使用这个存储库来:</p><ul class=""><li id="1147" class="mx my jg lg b lh li lk ll ln mz lr na lv nb lz nc nd ne nf bi translated">在本地VS代码开发容器中设置超集。</li><li id="0cc7" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nc nd ne nf bi translated">我们不会在本地创建超集配置数据库，而是将开发容器指向Google Cloud Platform中的SQL数据库，我们将使用它来支持最终的部署。</li><li id="a85e" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nc nd ne nf bi translated">使用我们的本地部署来配置GCP SQL数据库。</li><li id="c24f" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nc nd ne nf bi translated">一旦谷歌云数据库配置完毕，我们将在谷歌工件注册中存放一个容器映像。</li><li id="2fd1" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nc nd ne nf bi translated">从工件注册容器创建Google Cloud Run服务。</li></ul><p id="6446" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">该存储库包含:</p><ul class=""><li id="11ce" class="mx my jg lg b lh li lk ll ln mz lr na lv nb lz nc nd ne nf bi translated"><code class="fe nl nm nn no b">.devcontainer</code>:包含将创建VS代码开发容器的文件的文件夹。</li><li id="09ea" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nc nd ne nf bi translated"><code class="fe nl nm nn no b">setup-scripts</code>:包含shell脚本集合的文件夹，用于设置和配置谷歌云平台(GCP)服务。这些脚本可以根据您的需要定制，但是它们不需要任何定制，因为它们依赖于您将在<code class="fe nl nm nn no b">.env.template</code>中设置的VS代码开发容器中的环境变量。</li><li id="13eb" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nc nd ne nf bi translated"><code class="fe nl nm nn no b">src</code>:包含构建Google Cloud Run服务的文件的文件夹。</li><li id="3d2f" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nc nd ne nf bi translated"><code class="fe nl nm nn no b">.env.template</code>允许您为您的部署设置环境变量的值。</li></ul><blockquote class="np nq nr"><p id="7446" class="le lf ns lg b lh li kq lj lk ll kt lm nt lo lp lq nu ls lt lu nv lw lx ly lz ij bi translated">如果您觉得本指南有用和/或您对更详细的入门指南感兴趣，请<a class="ae jd" href="https://medium.com/@bengen" rel="noopener"> <strong class="lg jq">在Medium </strong> </a>上跟随我。</p></blockquote><h2 id="452d" class="ma mb jg bd mc md me dn mf mg mh dp mi ln mj mk ml lr mm mn mo lv mp mq mr jm bi translated"><strong class="ak">先决条件</strong></h2><p id="c860" class="pw-post-body-paragraph le lf jg lg b lh ms kq lj lk mt kt lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">执行上述步骤需要:</p><ol class=""><li id="3f7a" class="mx my jg lg b lh li lk ll ln mz lr na lv nb lz nw nd ne nf bi translated"><a class="ae jd" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker桌面</a></li><li id="4a2e" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated"><a class="ae jd" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a></li></ol><ul class=""><li id="48dd" class="mx my jg lg b lh li lk ll ln mz lr na lv nb lz nc nd ne nf bi translated"><a class="ae jd" href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers" rel="noopener ugc nofollow" target="_blank">远程容器</a>扩展</li></ul><p id="b632" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">3.<a class="ae jd" href="https://cloud.google.com/sdk/docs/install" rel="noopener ugc nofollow" target="_blank">谷歌云CLI </a></p><p id="2799" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">下面列出的所有shell命令/脚本都要从VS代码开发容器中的终端<em class="ns">执行，这一点非常重要。</em></p><p id="2a97" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">按照显示的顺序安装上述每个必备组件。Visual Studio代码、远程容器扩展和Google Cloud CLI都很容易安装。明确遵循Docker安装说明！ Docker本身有许多先决步骤。如果你还没有安装Docker，请注意安装步骤。</p><p id="cf46" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><strong class="lg jq">如果您在以下步骤中遇到错误，很可能是因为您没有正确执行必要的安装步骤。</strong></p><h2 id="2016" class="ma mb jg bd mc md me dn mf mg mh dp mi ln mj mk ml lr mm mn mo lv mp mq mr jm bi translated"><strong class="ak">入门</strong></h2><p id="e157" class="pw-post-body-paragraph le lf jg lg b lh ms kq lj lk mt kt lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">1.一旦你完成了先决条件的安装，将库克隆到你的机器上。不要从<code class="fe nl nm nn no b">superset-on-gcp-cloud-run</code>重命名存储库根文件夹。</p><p id="31c6" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">2.将文件<code class="fe nl nm nn no b">./.env.template</code>重命名为<code class="fe nl nm nn no b">./.env</code>，并在记事本或其他文本编辑器中打开该文件。让它保持打开，直到指示保存并关闭它。我们将在下一节填充一些需要的值。</p><h2 id="5e1f" class="ma mb jg bd mc md me dn mf mg mh dp mi ln mj mk ml lr mm mn mo lv mp mq mr jm bi translated"><strong class="ak">配置谷歌云</strong></h2><h2 id="f902" class="ma mb jg bd mc md me dn mf mg mh dp mi ln mj mk ml lr mm mn mo lv mp mq mr jm bi translated"><strong class="ak">项目创建</strong></h2><p id="52b8" class="pw-post-body-paragraph le lf jg lg b lh ms kq lj lk mt kt lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">如果你还没有为此建立一个谷歌云项目，你需要创建一个。所以，来看看谷歌云平台的网络界面— <a class="ae jd" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云控制台</a>。</p><p id="0ecb" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">从“Google Cloud Platform”文本左上方的下拉列表中，可以轻松选择或创建项目。创建项目后，请确保您正在其中工作，方法是确保正确的项目名称出现在您刚刚选择的下拉列表旁边。</p><figure class="nx ny nz oa gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/216f2de2ce4b7f48b4397007807e3cc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hwbi8LbCBWl2vueYFJZLUQ.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">谷歌云控制台——项目选择和创建</p></figure><p id="9a30" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">确保对您创建的项目启用计费。</p><ol class=""><li id="0b09" class="mx my jg lg b lh li lk ll ln mz lr na lv nb lz nw nd ne nf bi translated">在顶部搜索栏中键入'<em class="ns"> Billing </em>'并选择该选项。</li><li id="f13a" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">您应该会收到一个通知，告知您该项目没有计费帐户。选择<strong class="lg jq">链接一个计费账户</strong>。</li><li id="d260" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">选择(或创建)您的付费帐户。</li></ol><p id="b1f9" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">确保<code class="fe nl nm nn no b">./.env</code>中的<code class="fe nl nm nn no b">GOOGLE_CLOUD_PROJECT</code>变量被设置为匹配您为项目名称选择的任何内容。注意，这个值也需要用在<code class="fe nl nm nn no b">SUPERSET_CONNECTION_NAME</code>和<code class="fe nl nm nn no b">SUPERSET_CONECTION_SECRET</code>变量中，所以现在也要替换那些字符串的那部分。</p><h2 id="28fb" class="ma mb jg bd mc md me dn mf mg mh dp mi ln mj mk ml lr mm mn mo lv mp mq mr jm bi translated"><strong class="ak">配置谷歌同意屏幕</strong></h2><p id="9412" class="pw-post-body-paragraph le lf jg lg b lh ms kq lj lk mt kt lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">我们的部署旨在允许来自基于Google的组织的任何用户访问超集。换句话说，如果他们的电子邮件包含“@yourorganization.com”，他们就可以登录。为此，在继续之前，我们需要在Google Cloud控制台中配置一些东西。</p><ol class=""><li id="bc5a" class="mx my jg lg b lh li lk ll ln mz lr na lv nb lz nw nd ne nf bi translated">从谷歌控制台主页键入“APIs &amp;服务”并选择该部分。</li><li id="3456" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">从左侧菜单中选择“<strong class="lg jq"> OAuth同意屏幕</strong>”。</li><li id="b972" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">选择“内部”并点击<strong class="lg jq">创建</strong>。</li><li id="87f6" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">设置以下字段。所有这些都可以由您自行决定，但请注意'<em class="ns">授权域</em>'将决定访问权限，因此请确保这是您组织的正确顶级域。</li></ol><ul class=""><li id="aef0" class="mx my jg lg b lh li lk ll ln mz lr na lv nb lz nc nd ne nf bi translated">应用名称</li><li id="4ee3" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nc nd ne nf bi translated">用户支持电子邮件</li><li id="5430" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nc nd ne nf bi translated">授权域</li><li id="a252" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nc nd ne nf bi translated">开发者联系信息</li></ul><p id="f968" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">5.点击<strong class="lg jq">保存并继续</strong>。</p><p id="d627" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">6.点击<strong class="lg jq">添加或删除范围</strong>按钮。</p><p id="7cdb" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">7.选择'<em class="ns"> openid' </em>范围，点击<strong class="lg jq">更新</strong>。</p><p id="383c" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">8.点击<strong class="lg jq">保存并继续</strong>。</p><p id="fe68" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">9.点击<strong class="lg jq">返回仪表板</strong>按钮。</p><h2 id="a55c" class="ma mb jg bd mc md me dn mf mg mh dp mi ln mj mk ml lr mm mn mo lv mp mq mr jm bi translated"><strong class="ak">创建凭证</strong></h2><ol class=""><li id="390e" class="mx my jg lg b lh ms lk mt ln ob lr oc lv od lz nw nd ne nf bi translated">从“<em class="ns">API&amp;服务</em>”屏幕的左侧菜单中选择<strong class="lg jq">凭证</strong>。</li><li id="4b44" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">点击<strong class="lg jq">+创建凭证</strong> &gt; <strong class="lg jq"> OAuth客户端ID </strong>。</li><li id="b387" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">将<strong class="lg jq">应用类型</strong>下拉框设置为“<em class="ns"> Web应用</em>，并选择您喜欢的“<em class="ns">名称</em>”。</li><li id="dce4" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">点击<strong class="lg jq">创建</strong>。</li><li id="6896" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated"><em class="ns">您的客户ID </em>和<em class="ns">您的客户机密</em>将在弹出窗口中显示。记下这些值，并将它们复制到<code class="fe nl nm nn no b">./.env</code>文件中各自的变量:<code class="fe nl nm nn no b">GOOGLE_CLIENT_ID</code>和<code class="fe nl nm nn no b">GOOGLE_CLIENT_SECRET</code>。注意前导/尾随空格。明智的做法是<strong class="lg jq">也下载JSON </strong>。你应该不需要，但以防万一。</li></ol><h2 id="3fb0" class="ma mb jg bd mc md me dn mf mg mh dp mi ln mj mk ml lr mm mn mo lv mp mq mr jm bi translated"><strong class="ak">环境变量</strong></h2><p id="db0c" class="pw-post-body-paragraph le lf jg lg b lh ms kq lj lk mt kt lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">确保这个库附带的<code class="fe nl nm nn no b">./.env</code>文件中的所有变量现在都有赋值。保存并关闭<code class="fe nl nm nn no b">./.env</code>文件。</p><h2 id="54d5" class="ma mb jg bd mc md me dn mf mg mh dp mi ln mj mk ml lr mm mn mo lv mp mq mr jm bi translated"><strong class="ak">打开本地开发容器</strong></h2><ol class=""><li id="0482" class="mx my jg lg b lh ms lk mt ln ob lr oc lv od lz nw nd ne nf bi translated">确保Docker正在运行并在您的机器上打开，然后打开VS代码。</li><li id="6e64" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">在VS代码中，从左侧导航栏中选择<strong class="lg jq">远程浏览器</strong>图标，打开“<em class="ns">远程容器</em>扩展。</li><li id="4dce" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">选择<strong class="lg jq">打开容器</strong>中的文件夹按钮，选择包含整个<a class="ae jd" href="https://github.com/bengen343/superset-on-gcp-cloud-run" rel="noopener ugc nofollow" target="_blank">资源库</a> : <code class="fe nl nm nn no b">superset-on-gcp-cloud-run</code>的文件夹。在下载依赖项和构建容器的过程中，此步骤可能需要5-10分钟。当容器完全构建后，文件树应该显示在左窗格中。</li><li id="749d" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">从顶部VS代码菜单中选择<strong class="lg jq">端子</strong> &gt; <strong class="lg jq">新建端子</strong>打开端子面板。</li><li id="8784" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">在终端中输入命令<code class="fe nl nm nn no b">printenv</code>并按回车键。这将打印出容器中所有环境变量的列表。浏览以确保那些在<code class="fe nl nm nn no b">./.env</code>中定义的变量显示正确的值。如果他们没有仔细检查文件，保存它，并重新构建容器。如果有不准确的地方，你将无法继续。</li></ol><figure class="nx ny nz oa gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/579f783fdc34b5bf69fe6c9467ca247e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SxLBoZTiM6_ulzrAnXE4WA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">VS代码—集装箱和码头控制</p></figure><h2 id="2d02" class="ma mb jg bd mc md me dn mf mg mh dp mi ln mj mk ml lr mm mn mo lv mp mq mr jm bi translated"><strong class="ak">配置谷歌云平台基础设施</strong></h2><ol class=""><li id="fa6b" class="mx my jg lg b lh ms lk mt ln ob lr oc lv od lz nw nd ne nf bi translated">通过终端输入命令<code class="fe nl nm nn no b">gcloud auth login</code>登录Google cloud。因为容器没有与外界连接，所以它会生成一个命令，您需要将这个命令复制到在容器外运行的Google Cloud SDK中。所以，在你的机器上打开Google Cloud SDK Shell，从VS代码终端粘贴命令。这将打开一个浏览器窗口，请求您授权继续。使用部署超集的同一个域的Google帐户授予它访问权限。</li><li id="1253" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">将Google Cloud SDK的结果复制并粘贴回VS代码终端。如果成功，您应该会收到一条消息，提示“<em class="ns">您现在以… </em>的身份登录”</li><li id="56da" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">通过输入命令<code class="fe nl nm nn no b">gcloud config set project $GOOGLE_CLOUD_PROJECT</code>切换到您之前设置的Google Cloud项目，这将利用定义您之前应该设置的Google Cloud项目名称的环境变量。如果成功，终端应该返回'<em class="ns">更新的属性[核心/项目]。</em>’</li><li id="89d5" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">通过在VS代码终端中键入<code class="fe nl nm nn no b">setup-scripts/enable_gcp_services.sh</code>来启用项目中我们需要的各种Google云服务。</li></ol><blockquote class="np nq nr"><p id="3b3a" class="le lf ns lg b lh li kq lj lk ll kt lm nt lo lp lq nu ls lt lu nv lw lx ly lz ij bi translated">一些用户报告了在尝试运行这些shell脚本时出现“权限被拒绝”的错误。如果您遇到这种情况，只需通过键入<code class="fe nl nm nn no b">chmod u+x setup-scripts/enable_gcp_services.sh</code>来允许自己执行该脚本。这将授予您对指定脚本的执行权限。</p></blockquote><h2 id="d8b7" class="ma mb jg bd mc md me dn mf mg mh dp mi ln mj mk ml lr mm mn mo lv mp mq mr jm bi translated"><strong class="ak">创建超集配置SQL数据库</strong></h2><ol class=""><li id="7cf5" class="mx my jg lg b lh ms lk mt ln ob lr oc lv od lz nw nd ne nf bi translated">通过在VS代码终端中键入<code class="fe nl nm nn no b">setup-scripts/setup_sql.sh</code>，从这个存储库中运行<code class="fe nl nm nn no b">setup_sql.sh</code>脚本，在Google Cloud中创建超集SQL数据库。</li></ol><h2 id="de23" class="ma mb jg bd mc md me dn mf mg mh dp mi ln mj mk ml lr mm mn mo lv mp mq mr jm bi translated"><strong class="ak">设置机密&amp;服务账户</strong></h2><p id="b7ed" class="pw-post-body-paragraph le lf jg lg b lh ms kq lj lk mt kt lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">你的云运行服务将从GCP <a class="ae jd" href="https://console.cloud.google.com/security/secret-manager" rel="noopener ugc nofollow" target="_blank">秘密管理器</a>获取秘密。这些秘密都将根据您在<code class="fe nl nm nn no b">./.env</code>文件中设置的值来创建。</p><ol class=""><li id="8473" class="mx my jg lg b lh li lk ll ln mz lr na lv nb lz nw nd ne nf bi translated">通过<code class="fe nl nm nn no b">entering setup-scripts/create_gcp_secrets.sh</code>在VS代码终端运行<code class="fe nl nm nn no b">create_gcp_secrets.sh</code>脚本。</li><li id="4ff3" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">我们还需要为Superset创建一个服务帐户，并授予它访问我们刚刚创建的秘密以及我们将依赖的各种服务的权限。在VS代码终端中运行<code class="fe nl nm nn no b">setup-scripts/create_gcp_service_account.sh</code>，在您的项目中创建一个名为“<em class="ns"> superset </em>”的服务帐户，它可以完成这项工作。</li></ol><h2 id="92bc" class="ma mb jg bd mc md me dn mf mg mh dp mi ln mj mk ml lr mm mn mo lv mp mq mr jm bi translated"><strong class="ak">构建超集配置SQL数据库</strong></h2><ol class=""><li id="55e1" class="mx my jg lg b lh ms lk mt ln ob lr oc lv od lz nw nd ne nf bi translated">通过在终端运行这个命令，将VS代码开发容器连接到我们创建的GCP数据库:<code class="fe nl nm nn no b">/cloud_sql_proxy -instances=$SUPERSET_CONNECTION_NAME=tcp:5432</code>。如果成功，您应该会看到终端顶部的“<em class="ns">端口</em>”标题旁边的数字增加1，并且可能会显示一个弹出窗口，通知您“<em class="ns">您的应用程序现在正在端口5432 </em>上运行。</li><li id="6508" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">这个代理连接将独占您刚才工作的终端窗口。点击您刚刚使用的终端窗口右上角的<strong class="lg jq"> + </strong>，打开一个新的终端窗口。</li><li id="d75f" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">在你刚刚打开的新终端窗口中，键入<code class="fe nl nm nn no b">superset db upgrade</code>。这可能需要一些时间来执行，但是这个命令非常重要，因为它会用运行超集所需的所有表来填充Google Cloud托管的SQL数据库。</li></ol><h2 id="aa3a" class="ma mb jg bd mc md me dn mf mg mh dp mi ln mj mk ml lr mm mn mo lv mp mq mr jm bi translated"><strong class="ak">构建&amp;部署Apache超集容器</strong></h2><p id="cb4c" class="pw-post-body-paragraph le lf jg lg b lh ms kq lj lk mt kt lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">接下来，我们将把Docker图像推送到Google Cloud项目中的Google工件注册中心。然后将创建一个云运行服务来部署该映像。</p><ol class=""><li id="afaa" class="mx my jg lg b lh li lk ll ln mz lr na lv nb lz nw nd ne nf bi translated">通过在VS代码终端中键入命令<code class="fe nl nm nn no b">setup-scripts/create_gcp_artifact.sh</code>来创建一个Google工件注册容器。</li><li id="f1ab" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">通过在VS代码终端中键入<code class="fe nl nm nn no b">setup-scripts/create_gcp_image.sh</code>，将存储库的<code class="fe nl nm nn no b">src</code>文件夹的内容上传到您刚刚创建的存储库，作为Docker映像。</li><li id="ee04" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">通过在VS代码终端中键入命令<code class="fe nl nm nn no b">setup-scripts/create_gcp_cloud_run.sh</code>,将你上传的图片转换成一个活动的Google Cloud Run服务</li></ol><h2 id="92da" class="ma mb jg bd mc md me dn mf mg mh dp mi ln mj mk ml lr mm mn mo lv mp mq mr jm bi translated"><strong class="ak">更新服务凭证</strong></h2><p id="14e7" class="pw-post-body-paragraph le lf jg lg b lh ms kq lj lk mt kt lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">运行上面的脚本后，您将收到一个Google Cloud Run服务URL。</p><ol class=""><li id="7dfe" class="mx my jg lg b lh li lk ll ln mz lr na lv nb lz nw nd ne nf bi translated">返回<a class="ae jd" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云控制台</a>。</li><li id="5951" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">在顶部搜索栏中搜索并选择<strong class="lg jq">API&amp;服务</strong>。</li><li id="6603" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">从左侧导航栏中选择<strong class="lg jq">凭证</strong>。</li><li id="e4c9" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">选择<strong class="lg jq">铅笔图标</strong>编辑您的OAuth凭证，并将<em class="ns">授权重定向URIs </em>更新为<code class="fe nl nm nn no b">&lt;CLOUD-RUN-URL&gt;/oauth-authorized/google</code>，用VS代码终端返回的值替换<code class="fe nl nm nn no b">&lt;CLOUD-RUN-URL&gt;</code>。<strong class="lg jq">等待几分钟后再继续。</strong></li><li id="0aa6" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">导航到VS终端显示的云运行服务URL(<em class="ns">*，不包含您在步骤4中添加的额外文本。</em>)。这将验证您是超集部署的管理员。</li></ol><p id="d5ed" class="pw-post-body-paragraph le lf jg lg b lh li kq lj lk ll kt lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">完成后，您将需要运行下面的步骤，以确保未来的用户不会被授予管理员访问权限。</p><h2 id="6793" class="ma mb jg bd mc md me dn mf mg mh dp mi ln mj mk ml lr mm mn mo lv mp mq mr jm bi translated"><strong class="ak">刷新超集角色</strong></h2><ol class=""><li id="4c41" class="mx my jg lg b lh ms lk mt ln ob lr oc lv od lz nw nd ne nf bi translated">将<code class="fe nl nm nn no b">superset_config.py</code>中的<code class="fe nl nm nn no b">AUTH_USER_REGISTRATION_ROLE</code>更新为<em class="ns">公共</em>。保存并关闭该文件。所有新帐户将默认为公共帐户，而不再是管理员帐户。</li><li id="563a" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">通过在VS代码终端再次键入<code class="fe nl nm nn no b">setup-scripts/create_gcp_image.sh</code>来更新容器图像。</li><li id="8fa4" class="mx my jg lg b lh ng lk nh ln ni lr nj lv nk lz nw nd ne nf bi translated">通过再次在VS代码终端中键入<code class="fe nl nm nn no b">setup-scripts/create_gcp_cloud_run.sh</code>来部署您的新容器版本。</li></ol><h2 id="dd2b" class="ma mb jg bd mc md me dn mf mg mh dp mi ln mj mk ml lr mm mn mo lv mp mq mr jm bi translated"><strong class="ak">初始化超集</strong></h2><ol class=""><li id="4b67" class="mx my jg lg b lh ms lk mt ln ob lr oc lv od lz nw nd ne nf bi translated">确保您仍然通过Google cloud sql代理连接，并在VS代码终端中键入<code class="fe nl nm nn no b">superset init</code>。这将需要几分钟才能完成。</li></ol><h2 id="616c" class="ma mb jg bd mc md me dn mf mg mh dp mi ln mj mk ml lr mm mn mo lv mp mq mr jm bi translated"><strong class="ak">恭喜</strong></h2><p id="627f" class="pw-post-body-paragraph le lf jg lg b lh ms kq lj lk mt kt lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">现在一切都应该运行成功，您应该能够通过访问运行<code class="fe nl nm nn no b">setup-scripts/create_gcp_cloud_run.sh</code>时返回的URL来访问您的部署。</p></div></div>    
</body>
</html>