<html>
<head>
<title>Finding clusters in an image</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在图像中查找聚类</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/finding-clusters-in-an-image-96fe5eefc784#2022-11-28">https://towardsdatascience.com/finding-clusters-in-an-image-96fe5eefc784#2022-11-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2de9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">不仅仅是在表格数据中查找聚类</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/61dd93fdd8663de052bbb9fe8aae982a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EDcx67aoT1QvStdd7bEolw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Alex Shuper 在<a class="ae ky" href="https://unsplash.com/s/photos/IMAGE?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2874" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也很容易在数据的行和列中找到聚类。但是如何在图像中找到集群呢？让我用最近在卡塔尔举办的 2022 年世界杯的一张图片来说明这个问题。</p><p id="5fd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里展示的是我在巴西对塞尔维亚的比赛中拍摄的照片。这张照片是在理查森的惊人进球之前拍摄的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/90016e63f2972330eb3b5342d1f60c60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A7I-ShLqLUn7iM8Ip9c0RA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">自己拍的 2022 世界杯足球赛巴西 vs 塞尔维亚的照片(图片由作者提供)</p></figure><p id="6d76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你能在照片中观察到任何集群吗？视觉上，您可以找到一群人，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lw"><img src="../Images/7e0e6563711de324c5f960b7a659d249.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0FZtrGE-yKiI36w7Zi4Ejw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">2022 年世界杯足球赛巴西对塞尔维亚的照片，显示了集群，由本人拍摄(图片由作者提供)</p></figure><p id="a171" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我告诉你如何自动识别集群的技术步骤。</p><h1 id="5d08" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">1.检测图像中的对象</h1><p id="f674" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">第一步是检测图像中的所有对象。检测什么对象将基于聚类的目的。这里我们的目标是检测人群。检测照片中的人物可以在 YOLOv5 上完成。使用 YOLOv5 进行物体检测的结果如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/17295f0c9fe5d263c73a5d84329d6750.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O4POQZlfuD6quDPLIkq_iw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用 YOLOv5 进行物体检测(图片由作者提供)</p></figure><p id="2761" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">YOLOv5 还提供了额外的统计数据，如对象检测的数量。在这张照片中，有 17 个物体(人)。下面是一段代码</p><pre class="kj kk kl km gt mu mv mw bn mx my bi"><span id="d670" class="mz ly it mv b be na nb l nc nd">import yolov5<br/>from sklearn.cluster import DBSCAN<br/>from sklearn.preprocessing import StandardScaler<br/>import numpy as np<br/>import pandas as pd<br/><br/># load pretrained model<br/>model = yolov5.load('yolov5s.pt')<br/><br/># set model parameters<br/>model.conf = 0.25  # NMS confidence threshold<br/>model.iou = 0.45  # NMS IoU threshold<br/>model.agnostic = False  # NMS class-agnostic<br/>model.multi_label = False  # NMS multiple labels per box<br/>model.max_det = 1000  # maximum number of detections per image<br/><br/># set image<br/>img = 'brazil_vs_serbian.png'<br/><br/># inference with test time augmentation<br/>results = model(img, augment=True)<br/><br/># parse results<br/>predictions = results.pred[0]<br/>boxes = predictions[:, :4] # x1, y1, x2, y2<br/>scores = predictions[:, 4]<br/>categories = predictions[:, 5]</span></pre><h1 id="cfeb" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">2.识别物体的 X 和 Y 位置</h1><p id="a934" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">下一步是识别物体的 X 和 Y 位置。YOLOv5 结果存储图像中每个对象的位置。位置存储为 xmin、ymin、xmax、ymax。我们可以取 xmin 和 xmax，以及 ymin 和 ymax 的平均值，求出物体的 x，y 位置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/0637d35ad10f8f732c867158d01b9319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4LOwHIhMesX4uHWUk7zuog.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">对象的坐标(图片由作者提供)</p></figure><p id="e1c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以将坐标转换为数据框。有一个调整很重要，它与反转 Y 位置有关。通常，图像以 Y 轴反转的方式存储。这意味着 Y=0 在图像的顶部。在计算过程中，我们可以通过减去图像的高度(这里是 2253)来还原位置。高度也可以自动确定，但是为了简化代码片段，我直接输入了高度。</p><pre class="kj kk kl km gt mu mv mw bn mx my bi"><span id="0cc3" class="mz ly it mv b be na nb l nc nd">df = results.pandas().xyxy[0]<br/>df['x'] = (df['xmin'] + df['xmax'])/2.0 <br/>df['y'] = (2253-(df['ymin'] + df['ymax'])/2.0) #2253 is image height</span></pre><p id="1114" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果在这里显示为数据帧。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/346990830c6e2b227794d71f3def4e32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-RU40o4OMpOGF_SL0PbmWg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">位置为 x，y 的数据框(图片由作者提供)</p></figure><h1 id="e3a4" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">3.使用基于密度的聚类来查找聚类。</h1><p id="f87e" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">现在我们已经准备好寻找星团了。找到图像中的聚类意味着找到与图像的其他部分相比有更多对象的区域。本质上，这意味着根据图像中对象的密度来寻找聚类。一种有效的算法是基于密度的聚类(DBSCAN)。下面显示的是散点图中绘制的结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/3be8bc4d25c95467999eabeebf677e39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2KSJtk2B2cRXLjBjTSJq9g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">DSBSCAN 结果(图片由作者提供)</p></figure><p id="3cc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">DBSCAN 算法将绿点识别为密集区域的一部分。下面是 DBSCAN 算法的代码片段。</p><pre class="kj kk kl km gt mu mv mw bn mx my bi"><span id="3260" class="mz ly it mv b be na nb l nc nd">#Density clustering<br/>X = StandardScaler().fit_transform(df[['x','y']])<br/>clustering = DBSCAN(eps=0.5, min_samples=5).fit(X)<br/>df['c'] = clustering.labels_</span></pre><h1 id="16b0" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">4.分析结果</h1><p id="6428" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">现在让我们对比照片分析散点图上的结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/a877e04a5c78b7b1b178bda6571079d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qiEfMt62pm6KkSuXvghoTA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">分析结果(图片由作者提供)</p></figure><p id="19e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧啊。散点图看起来像是足球比赛的可视化数字表示！</p><h1 id="4d2b" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">结论</h1><p id="8a55" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">在图像中寻找聚类是一项有趣的技术，也有许多用例。在博客中，您看到了体育分析的一个用例。此外，还有各种其他用例，如识别公共空间中的过度拥挤或识别购物者在购物中心花费更多时间的区域。</p><p id="88e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望你喜欢这个博客！</p><p id="d35e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请<strong class="lb iu">用我的推荐链接加入 Medium </strong>。</p><div class="ni nj gp gr nk nl"><a href="https://pranay-dave9.medium.com/membership" rel="noopener follow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">加入我的介绍链接-普拉内戴夫媒体</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">阅读 Pranay Dave(以及 Medium 上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">pranay-dave9.medium.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz ks nl"/></div></div></a></div><p id="b882" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请<strong class="lb iu">订阅</strong>每当我发布一个新的故事时，请及时通知我。</p><div class="ni nj gp gr nk nl"><a href="https://pranay-dave9.medium.com/subscribe" rel="noopener follow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">每当 Pranay Dave 发表文章时，您都会收到电子邮件。</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">每当 Pranay Dave 发表文章时，您都会收到电子邮件。注册后，如果您还没有，您将创建一个中型帐户…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">pranay-dave9.medium.com</p></div></div><div class="nu l"><div class="oa l nw nx ny nu nz ks nl"/></div></div></a></div><h1 id="d602" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">额外资源</h1><h2 id="5a0c" class="ob ly it bd lz oc od dn md oe of dp mh li og oh mj lm oi oj ml lq ok ol mn om bi translated">网站(全球资讯网的主机站)</h2><p id="f49a" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">你可以访问我的网站，这是一个学习数据科学的无代码平台。【https://experiencedatascience.com】T5<a class="ae ky" href="https://experiencedatascience.com/" rel="noopener ugc nofollow" target="_blank">T6</a></p><h2 id="1f7d" class="ob ly it bd lz oc od dn md oe of dp mh li og oh mj lm oi oj ml lq ok ol mn om bi translated">Youtube 频道</h2><p id="9dcb" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">这是我的 YouTube 频道<br/><a class="ae ky" href="https://www.youtube.com/c/DataScienceDemonstrated" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/c/DataScienceDemonstrated</a>的链接</p></div></div>    
</body>
</html>