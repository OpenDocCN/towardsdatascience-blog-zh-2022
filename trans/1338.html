<html>
<head>
<title>Stop Hardcoding Values in Python Apps — Use JSON Configuration Files Instead</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">停止在Python应用程序中硬编码值-改为使用JSON配置文件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/stop-hardcoding-values-in-python-apps-use-json-configuration-files-instead-cce8f15f647a#2022-04-04">https://towardsdatascience.com/stop-hardcoding-values-in-python-apps-use-json-configuration-files-instead-cce8f15f647a#2022-04-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d23d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">硬编码Python应用程序配置从来都不是一个好主意。请尝试这种替代方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8f98ff4b5525ee127745f6224a45ab72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*etvTxmPH62tiL1dA"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@sigmund?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">西格蒙德</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="dbb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应用程序配置更改。后端数据库可以迁移，也可以完全改变。在这种情况下，您的Python应用程序会发生什么变化？嗯，它坏了。您必须更新多个Python文件中的值，才能让它再次工作。</p><p id="8ee6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">配置文件提供了一个简单的修复方法。Python中有多种处理配置文件的方式，JSON就是其中之一。它可能不是最好的，至少与<code class="fe lv lw lx ly b">ini</code>和<code class="fe lv lw lx ly b">yaml</code>文件相比不是。尽管如此，这仍然是一个可行的方法，很容易建立，你今天将了解它的全部内容。</p><p id="a46f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不想看书？请观看我的视频:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="75b7" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">如何为Python应用程序编写JSON配置文件</h1><p id="133d" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">我创建了一个包含两个文件的新文件夹:</p><ul class=""><li id="2def" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated"><code class="fe lv lw lx ly b">app.py</code> -包含今天文章的Python代码。</li><li id="20a3" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><code class="fe lv lw lx ly b">config.json</code> -包含我们不想用Python硬编码的配置数据。</li></ul><p id="7143" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们今天将与远程<a class="ae ky" href="https://gorest.co.in/" rel="noopener ugc nofollow" target="_blank"> REST API </a>进行通信，因此对于<code class="fe lv lw lx ly b">config.json</code>来说，包含API端点和保存API响应的本地路径是有意义的:</p><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="8a85" class="nx mj it ly b gy ny nz l oa ob">{<br/>    "api": {<br/>        "url": "https://gorest.co.in/public/v2/users"<br/>    },<br/>    "save": {<br/>        "dir": "/Users/dradecic/Desktop/users_data",<br/>        "file": "users.json"<br/>    }<br/>}</span></pre><p id="2b53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只要格式正确，你可以在<code class="fe lv lw lx ly b">config.json</code>中放入任何东西。从一个对象开始，声明几个包含值对象的键。</p><p id="08a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，就是这么简单。接下来让我们看看如何用Python加载这个JSON配置文件。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="acad" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">如何在Python应用程序中使用JSON配置文件</h1><p id="16db" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">用Python读取JSON文件最好使用Python的上下文管理器语法。要将JSON文件的内容解析到Python字典，使用<code class="fe lv lw lx ly b">json.load()</code>方法:</p><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="6e2d" class="nx mj it ly b gy ny nz l oa ob">import json<br/>import pathlib<br/>import requests<br/><br/><br/>with open("config.json", "r") as f:<br/>    config = json.load(f)<br/>    <br/>    <br/>if __name__ == "__main__":<br/>    print(config)</span></pre><p id="f09b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">整个配置文件现已加载到内存中。我们可以通过运行<code class="fe lv lw lx ly b">app.py</code>来验证它:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/cea3d7965439b7fa3c5d69c5bd4bb1ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yNBvvHDifC9G2D-b1B0_HA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1-打印的Python JSON配置文件(图片由作者提供)</p></figure><p id="788b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">变量<code class="fe lv lw lx ly b">config</code>现在是一个普通的Python字典对象。您可以用括号符号或者用<code class="fe lv lw lx ly b">get()</code>方法来访问它的元素。我们今天将使用prior，但这只是个人偏好。</p><p id="ddeb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在将向API发出GET请求，并提供配置文件中的URL作为参数:</p><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="8ceb" class="nx mj it ly b gy ny nz l oa ob">import json<br/>import pathlib<br/>import requests<br/><br/><br/>with open("config.json", "r") as f:<br/>    config = json.load(f)<br/>    <br/>    <br/>def get_users() -&gt; dict:<br/>    r = requests.get(config["api"]["url"])<br/>    return r.text<br/>    <br/>    <br/>if __name__ == "__main__":<br/>    print(get_users())</span></pre><p id="f155" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该函数返回响应的内容，在本例中是用户:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/34b2dd37c2fa92285b1d5c3c7d6f392e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L-nXAacddTiZS8arbGBHZw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2 —从REST API获取的用户(作者图片)</p></figure><p id="d211" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们迷你数据管道的最后一部分是在本地保存用户。我们在配置文件中已经有了目录名和文件名——唯一剩下的就是在Python中使用它们。</p><p id="aa01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果目录不存在，Python的<code class="fe lv lw lx ly b">pathlib</code>模块首先创建目录。之后，我们再次使用上下文管理器语法将用户转储到一个JSON文件:</p><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="c015" class="nx mj it ly b gy ny nz l oa ob">import json<br/>import pathlib<br/>import requests<br/><br/><br/>with open("config.json", "r") as f:<br/>    config = json.load(f)<br/><br/><br/>def get_users() -&gt; dict:<br/>    r = requests.get(config["api"]["url"])<br/>    return r.text<br/><br/><br/>def save_users(users: dict) -&gt; None:<br/>    path = pathlib.Path(config["save"]["dir"])<br/>    if not path.exists():<br/>        path.mkdir()<br/><br/>    with open(f"{config['save']['dir']}/{config['save']['file']}", "w") as f:<br/>        json.dump(users, f)<br/><br/><br/>if __name__ == "__main__":<br/>    users = get_users()<br/>    save_users(users=users)</span></pre><p id="313f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行脚本后，您将看到<code class="fe lv lw lx ly b">users.json</code>文件保存在本地先前指定的位置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/a519728e14f85bc5c219e4bc9f7d11d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o_WzRCCgZGAJA_aj-XV9Hw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3 —保存的JSON文件(作者提供的图片)</p></figure></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="803c" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">Python中JSON配置文件的概要</h1><p id="1baf" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">硬编码值从来都不是一个好主意。当然，上面的例子非常简单，但是想象一下，您有数百个Python文件分布在多个文件夹中。手动更新URL和配置将是巨大的时间浪费。</p><p id="2dd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天，您已经学习了如何在Python应用程序中使用JSON配置文件。初始设置很容易，但也有一些缺点。例如，没有好的方法将注释放在JSON文件中。还有，不能用编程逻辑来确定变量值。所有这些都是缺点，将在以后的文章中解决，敬请关注。</p><h2 id="338b" class="nx mj it bd mk of og dn mo oh oi dp ms li oj ok mu lm ol om mw lq on oo my op bi translated">推荐阅读</h2><ul class=""><li id="539e" class="nf ng it lb b lc na lf nb li oq lm or lq os lu nk nl nm nn bi translated"><a class="ae ky" href="https://betterdatascience.com/best-data-science-prerequisite-books/" rel="noopener ugc nofollow" target="_blank">学习数据科学先决条件(数学、统计和编程)的5本最佳书籍</a></li><li id="f09a" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><a class="ae ky" href="https://betterdatascience.com/top-books-to-learn-data-science/" rel="noopener ugc nofollow" target="_blank">2022年学习数据科学的前5本书</a></li><li id="03fe" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><a class="ae ky" href="https://betterdatascience.com/python-list-print/" rel="noopener ugc nofollow" target="_blank">用Python打印列表的7种方法</a></li></ul><h2 id="7e20" class="nx mj it bd mk of og dn mo oh oi dp ms li oj ok mu lm ol om mw lq on oo my op bi translated">保持联系</h2><ul class=""><li id="4c89" class="nf ng it lb b lc na lf nb li oq lm or lq os lu nk nl nm nn bi translated">雇用我作为一名技术作家</li><li id="d65f" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">在YouTube<a class="ae ky" href="https://www.youtube.com/c/BetterDataScience" rel="noopener ugc nofollow" target="_blank">上订阅</a></li><li id="2c1d" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">在<a class="ae ky" href="https://www.linkedin.com/in/darioradecic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上连接</li></ul></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><p id="d49d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ot">原载于2022年4月4日https://betterdatascience.com</em><a class="ae ky" href="https://betterdatascience.com/python-json-configuration-file/" rel="noopener ugc nofollow" target="_blank"><em class="ot"/></a><em class="ot">。</em></p></div></div>    
</body>
</html>