<html>
<head>
<title>Spatial Data Science: Network Analysis for Transportation Planning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">空间数据科学:交通规划的网络分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/spatial-data-science-network-analysis-for-transportation-planning-7be048b8f37#2022-05-27">https://towardsdatascience.com/spatial-data-science-network-analysis-for-transportation-planning-7be048b8f37#2022-05-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/972068ae31738a45a6adb0c65c5db802.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fnKtyUeCWhqUhYcCShimDQ.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:原创内容来自作者和里尼A. (2022)</p></figure><div class=""/><div class=""><h2 id="484d" class="pw-subtitle-paragraph kf jh ji bd b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dk translated">面向交通规划者的高级图论工具介绍(使用Python)</h2></div><h1 id="0721" class="kx ky ji bd kz la lb lc ld le lf lg lh ko li kp lj kr lk ks ll ku lm kv ln lo bi translated">介绍</h1><p id="1aff" class="pw-post-body-paragraph lp lq ji lr b ls lt kj lu lv lw km lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">交通/城市规划者进行交通分析。我想讨论这个分析，特别是在城市范围内。这条路线可行吗？最有效的公共交通路线是什么？这个地区交通便利吗？路线重叠吗？这类问题属于网络分析的范畴；在图论下。虽然图论本身对任何现实世界的现象都是不可知的，但我们可以用它来建模所有与网络相关的事物，包括城市交通分析。</p><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/a4f953ccdecf9512ee9fa632d9379781.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*e1gBlZqsSxK5dRzRfGm5Ew.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">社会学中的图论，马丁·格兰让—自己的作品，CC BY-SA 4.0，<a class="ae mq" href="https://commons.wikimedia.org/w/index.php?curid=39967994" rel="noopener ugc nofollow" target="_blank">https://commons.wikimedia.org/w/index.php?curid=39967994</a></p></figure><p id="15b0" class="pw-post-body-paragraph lp lq ji lr b ls mr kj lu lv ms km lx ly mt ma mb mc mu me mf mg mv mi mj mk im bi translated">我从2018年(到现在4年)开始和网络分析打交道，用过一些工具。在本文中，我想与大家分享一下交通规划者如何开始使用Python工具进行网络分析。我希望读者都知道基本的图论知识，比如什么是节点和边，什么是图。</p><blockquote class="mw mx my"><p id="a2b0" class="lp lq mz lr b ls mr kj lu lv ms km lx na mt ma mb nb mu me mf nc mv mi mj mk im bi translated"><strong class="lr jj">注意:</strong>这篇文章是苏坦穆夫提的空间数据科学系列的一部分，请查看<a class="ae mq" href="https://perkotaan.medium.com/spatial-data-science-the-series-81344a3ead29" rel="noopener">这篇元文章</a>以获得更多类似的文章！</p></blockquote><h2 id="7ff4" class="nd ky ji bd kz ne nf dn ld ng nh dp lh ly ni nj lj mc nk nl ll mg nm nn ln no bi translated">计算机编程语言</h2><p id="26ab" class="pw-post-body-paragraph lp lq ji lr b ls lt kj lu lv lw km lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">对于像我这样没有编程背景的人来说，对于不需要非常低级编程技术的作品来说，Python是一种非常棒的高级编程语言。在这种情况下，交通分析是我发现可以通过利用Python的功能进行优化的领域之一。这种优化需要工作流程的自动化，并使文件更符合字面意思；因此确保了再现性。它的语法哲学是人类友好和可读的；我们来对比一些语法。</p><p id="669a" class="pw-post-body-paragraph lp lq ji lr b ls mr kj lu lv ms km lx ly mt ma mb mc mu me mf mg mv mi mj mk im bi translated">在Java中，初学者的hello world程序如下:</p><pre class="mm mn mo mp gt np nq nr ns aw nt bi"><span id="3ea1" class="nd ky ji nq b gy nu nv l nw nx">public class Main {<br/>  public static void main(String[] args) {<br/>    System.out.println("Hello World");<br/>  }<br/>}</span></pre><p id="f2df" class="pw-post-body-paragraph lp lq ji lr b ls mr kj lu lv ms km lx ly mt ma mb mc mu me mf mg mv mi mj mk im bi translated">而在Python中，它如下</p><pre class="mm mn mo mp gt np nq nr ns aw nt bi"><span id="1f10" class="nd ky ji nq b gy nu nv l nw nx">print('hello world')</span></pre><p id="396b" class="pw-post-body-paragraph lp lq ji lr b ls mr kj lu lv ms km lx ly mt ma mb mc mu me mf mg mv mi mj mk im bi translated">对于像我这样不热衷于编程的人来说，Python已经足够了。尽管计算机科学社区认为它很慢，但对于像我这样的交通/城市规划者来说，我觉得速度引发问题的可能性很低。</p><h1 id="6de6" class="kx ky ji bd kz la lb lc ld le lf lg lh ko li kp lj kr lk ks ll ku lm kv ln lo bi translated"><strong class="ak">网络x </strong></h1><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ny"><img src="../Images/0944e81a6b9b0a8da1d077b3cdc39a61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*31wbzKvKiAyy_uibJcfiKg.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae mq" href="https://networkx.org/documentation/stable/" rel="noopener ugc nofollow" target="_blank">网络x </a></p></figure><p id="92e8" class="pw-post-body-paragraph lp lq ji lr b ls mr kj lu lv ms km lx ly mt ma mb mc mu me mf mg mv mi mj mk im bi translated">我不能强调这个软件包有多棒。这是一个用于图形/网络分析和构建的轻量级python包。它是用C++编写的算法的接口，以其性能速度而闻名。再加上Python的人语法，我感觉在网络分析方面，Networkx在语法和性能之间，两全其美。</p><p id="5008" class="pw-post-body-paragraph lp lq ji lr b ls mr kj lu lv ms km lx ly mt ma mb mc mu me mf mg mv mi mj mk im bi translated">我们直接一头扎进去吧！</p><blockquote class="mw mx my"><p id="07b9" class="lp lq mz lr b ls mr kj lu lv ms km lx na mt ma mb nb mu me mf nc mv mi mj mk im bi translated">(注:<strong class="lr jj">本文中我没有使用<strong class="lr jj"> QGIS </strong>和<strong class="lr jj"> ArcGIS </strong>等</strong>图形用户界面GIS软件！让我们用Python来实现自动化，显式地，&amp;缩放目的)</p></blockquote><h1 id="93e9" class="kx ky ji bd kz la lb lc ld le lf lg lh ko li kp lj kr lk ks ll ku lm kv ln lo bi translated">示范</h1><p id="3f68" class="pw-post-body-paragraph lp lq ji lr b ls lt kj lu lv lw km lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">一个用例:我下载了一个<a class="ae mq" href="https://export.hotosm.org/en/v3/" rel="noopener ugc nofollow" target="_blank"> OSM网络数据</a>并运行了一个<code class="fe nz oa ob nq b">geopandas</code>绘图脚本。</p><pre class="mm mn mo mp gt np nq nr ns aw nt bi"><span id="f5bc" class="nd ky ji nq b gy nu nv l nw nx">import matplotlib.pyplot as plt;<br/>import contextily as cx;<br/>import geopandas as gpd;</span><span id="82ee" class="nd ky ji nq b gy oc nv l nw nx">network_gdf = gpd.read_file('osm_network.shp');</span><span id="f4bc" class="nd ky ji nq b gy oc nv l nw nx">fig, ax = plt.subplots(figsize=(10,10));</span><span id="6108" class="nd ky ji nq b gy oc nv l nw nx">network_gdf.to_crs('epsg:3857').plot(ax=ax);<br/>cx.add_basemap(ax,<br/>               source=cx.providers.OpenStreetMap.HOT<br/>              );</span></pre><p id="f8bc" class="pw-post-body-paragraph lp lq ji lr b ls mr kj lu lv ms km lx ly mt ma mb mc mu me mf mg mv mi mj mk im bi translated">代码将导出如下所示的地图。</p><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi od"><img src="../Images/8ddbd9468dc266e8b2690c9475a6d0b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*YlOxZk_LSvexFhBE5K7ivQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作者(2022)</p></figure><p id="7df6" class="pw-post-body-paragraph lp lq ji lr b ls mr kj lu lv ms km lx ly mt ma mb mc mu me mf mg mv mi mj mk im bi translated">嗯，这个案子很复杂。让我们把它简化为主次干道。</p><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi od"><img src="../Images/3965e75496b765aa4a51774c49e2d8e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*WbzKR1hr3k8QqNO5JjfCog.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作者(2022)</p></figure><p id="53f4" class="pw-post-body-paragraph lp lq ji lr b ls mr kj lu lv ms km lx ly mt ma mb mc mu me mf mg mv mi mj mk im bi translated">完美！我们下一步应该做的只是清理工作，我认为这对于本文来说是微不足道的；我用草'<code class="fe nz oa ob nq b">v.clean</code>搭配<code class="fe nz oa ob nq b">pyqgis</code>。<a class="ae mq" href="https://gis.stackexchange.com/questions/279902/unable-to-run-v-clean-in-qgis-3-0-1-in-python-console" rel="noopener ugc nofollow" target="_blank">检查该螺纹</a>。这是一种质量控制措施，可确保网络拓扑结构的稳定性。</p><p id="b38c" class="pw-post-body-paragraph lp lq ji lr b ls mr kj lu lv ms km lx ly mt ma mb mc mu me mf mg mv mi mj mk im bi translated">我们现在有了道路形状文件。</p><h1 id="0923" class="kx ky ji bd kz la lb lc ld le lf lg lh ko li kp lj kr lk ks ll ku lm kv ln lo bi translated">图形模型</h1><p id="0959" class="pw-post-body-paragraph lp lq ji lr b ls lt kj lu lv lw km lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">我们现在有的只是一个普通的“shapefile”。为了对连通性和运输进行建模，需要将这些数据转换成图形模型。这就是<code class="fe nz oa ob nq b">networkx</code>进入游戏的地方。</p><h2 id="41cd" class="nd ky ji bd kz ne nf dn ld ng nh dp lh ly ni nj lj mc nk nl ll mg nm nn ln no bi translated">识别边缘</h2><p id="9ae7" class="pw-post-body-paragraph lp lq ji lr b ls lt kj lu lv lw km lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">首先，确定每条道路的端点，并创建由这些端点组成的数据框。我使用<code class="fe nz oa ob nq b">pandas</code>来管理表格数据框。下表是数据框片段。每一行反映了shapefile中的一条道路。使用来自<code class="fe nz oa ob nq b">id</code>列的简单SQL连接，我可以识别shapefile中的几何图形。</p><pre class="mm mn mo mp gt np nq nr ns aw nt bi"><span id="c3e9" class="nd ky ji nq b gy nu nv l nw nx">+----+----------------------+----------------------+<br/>| id |        start         |         stop         |<br/>+----+----------------------+----------------------+<br/>|  0 | (-0.13492, 51.5246)  | (-0.13499, 51.52457) |<br/>|  1 | (-0.11953, 51.52866) | (-0.11956, 51.52871) |<br/>|  2 | (-0.14517, 51.52391) | (-0.14513, 51.52375) |<br/>|  3 | (-0.14423, 51.52399) | (-0.14473, 51.52398) |<br/>|  4 | (-0.14398, 51.52287) | (-0.14415, 51.52325) |<br/>+----+----------------------+----------------------+<br/>note: the decimal place is reduced for presentation purposes</span></pre><p id="658f" class="pw-post-body-paragraph lp lq ji lr b ls mr kj lu lv ms km lx ly mt ma mb mc mu me mf mg mv mi mj mk im bi translated">构建边的方法是我们以数据帧的形式拥有的2个节点。每一排都是一条边！使用简单的Python构建了一个<code class="fe nz oa ob nq b">networkx</code>图形对象。生成的图形如下图所示。</p><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/3bf71587c59277dc63e834290629cd2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*_l7t_Uciz6_Aaao5ZFmyWQ.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">道路网络的图形模型来源:作者(2022)</p></figure><p id="b7e8" class="pw-post-body-paragraph lp lq ji lr b ls mr kj lu lv ms km lx ly mt ma mb mc mu me mf mg mv mi mj mk im bi translated">这是反映道路连通性的图形模型。我们可以对它进行各种图形分析算法，并获得关于我们的道路网络的见解。让我们通过执行两点之间的最短路径分析来演示它；</p><h1 id="a5ad" class="kx ky ji bd kz la lb lc ld le lf lg lh ko li kp lj kr lk ks ll ku lm kv ln lo bi translated">运输分析</h1><p id="b485" class="pw-post-body-paragraph lp lq ji lr b ls lt kj lu lv lw km lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">本节演示了<code class="fe nz oa ob nq b">networkx</code>在运输建模中的应用。</p><p id="b7c0" class="pw-post-body-paragraph lp lq ji lr b ls mr kj lu lv ms km lx ly mt ma mb mc mu me mf mg mv mi mj mk im bi translated">好吧，让我们做些有趣的事情！(:</p><h2 id="6fc9" class="nd ky ji bd kz ne nf dn ld ng nh dp lh ly ni nj lj mc nk nl ll mg nm nn ln no bi translated">最短路径</h2><p id="410e" class="pw-post-body-paragraph lp lq ji lr b ls lt kj lu lv lw km lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">让我们试着找出最短的路径。假设我想确定(-0.13894，51.53115)和(-0.12162，51.53054)之间的路线，如下图所示。</p><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi od"><img src="../Images/94077833a42b7822c9283388a18e488b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*Ptyg504yn3H1ClEaqaMHfw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作者(2022)</p></figure><p id="6cd2" class="pw-post-body-paragraph lp lq ji lr b ls mr kj lu lv ms km lx ly mt ma mb mc mu me mf mg mv mi mj mk im bi translated">然后，使用Dijkstra的算法，最短路径路线将如下图所示。</p><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi od"><img src="../Images/5287d49386d889e2f5d862a709a959a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*eSsjhLrqtxgwB1uKr-ImpQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来源:作者(2022)</p></figure><p id="aedc" class="pw-post-body-paragraph lp lq ji lr b ls mr kj lu lv ms km lx ly mt ma mb mc mu me mf mg mv mi mj mk im bi translated">那么，它在图形模型中看起来如何？拓扑如下图所示。</p><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/84e8bd696c62c25e4dfe850c152fad81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*HvswCJFdkIuxURO44bbRfw.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图模型中的最短路径来源:作者(2022)</p></figure><h2 id="5173" class="nd ky ji bd kz ne nf dn ld ng nh dp lh ly ni nj lj mc nk nl ll mg nm nn ln no bi translated">按比例放大</h2><p id="d205" class="pw-post-body-paragraph lp lq ji lr b ls lt kj lu lv lw km lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">现在假设有1，000，000条记录或源和目标文件，给定一个网络数据集，如OpenStreetMap的。我们可以在算法中加入for循环，并遍历记录来确定最短路径。如果重量是一个变量，那么我们可以将其设置为算法中的成本变量。这都是因为Python才有的能力。</p><h2 id="d0b6" class="nd ky ji bd kz ne nf dn ld ng nh dp lh ly ni nj lj mc nk nl ll mg nm nn ln no bi translated">其他应用—等时线</h2><p id="f99b" class="pw-post-body-paragraph lp lq ji lr b ls lt kj lu lv lw km lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">我的一个个人应用是分析公共交通可达性。例如，从一个点出发，仅用30分钟步行+使用公共交通工具，你能到达多远的城市？我们可以从一个点创建一个等时线。幸运的是，有一个networkx <a class="ae mq" href="https://networkx.org/documentation/stable/reference/algorithms/generated/networkx.algorithms.shortest_paths.unweighted.single_source_shortest_path_length.html#networkx.algorithms.shortest_paths.unweighted.single_source_shortest_path_length" rel="noopener ugc nofollow" target="_blank">算法</a>可以解决这个问题！</p><h2 id="8aaa" class="nd ky ji bd kz ne nf dn ld ng nh dp lh ly ni nj lj mc nk nl ll mg nm nn ln no bi translated"><strong class="ak">公共交通</strong></h2><p id="302e" class="pw-post-body-paragraph lp lq ji lr b ls lt kj lu lv lw km lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">这对于评估公共交通网络和创建模拟非常有用。例如，下图显示了伦敦地铁网络。<strong class="lr jj">我们可以插入一个额外的网络来模拟它将如何影响整个网络！</strong></p><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi of"><img src="../Images/c7a6a884d5ef8de7fc32277c7ad2f685.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*usDkFdrtJfgdx0Jt5QUQdg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">伦敦地铁网络图来源:作者(2022)</p></figure><h1 id="53a5" class="kx ky ji bd kz la lb lc ld le lf lg lh ko li kp lj kr lk ks ll ku lm kv ln lo bi translated">结论</h1><p id="bbe9" class="pw-post-body-paragraph lp lq ji lr b ls lt kj lu lv lw km lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">图论是城市交通分析的基础理论。Networkx是一个利用Python编程执行图形分析的工具。它是一个用于扩展交通/网络分析的快速API一个让非硬核程序员(我认为对于城市/交通规划者来说刚好够用)执行交通分析的shell。我个人认为这是进行运输分析的最佳和最容易使用的工具。你所需要的就是学习Python语法，理解GIS，学习图论。这需要时间，但我觉得很有收获！</p><h2 id="7835" class="nd ky ji bd kz ne nf dn ld ng nh dp lh ly ni nj lj mc nk nl ll mg nm nn ln no bi translated">个人笔记</h2><p id="8082" class="pw-post-body-paragraph lp lq ji lr b ls lt kj lu lv lw km lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">在空间和网络数据分析中，我经常尝试不使用QGIS或ArcGIS，而是使用Python脚本将工作转移到<code class="fe nz oa ob nq b">pyqgis</code>和<code class="fe nz oa ob nq b">arcpy</code>。这是为了扩大规模，并使项目可追踪。有了Python脚本，我总能明确地说出我做了什么。正如本文所展示的，我认为我已经非常清楚地表达了我的想法；本文所做的所有工作都是使用Ms Visual Studio代码和Jupyter扩展开发的！当然，探索数据的工具是QGIS和ArcGIS，但是对于分析过程，我发现Visual Studio代码是完美的工具。</p><p id="a695" class="pw-post-body-paragraph lp lq ji lr b ls mr kj lu lv ms km lx ly mt ma mb mc mu me mf mg mv mi mj mk im bi translated">目前…(:</p></div></div>    
</body>
</html>