<html>
<head>
<title>Parallel Programming with CUDA in C++ (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">C++中的CUDA并行编程(第一部分)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/parallel-programming-with-cuda-in-c-part-1-d935e93a9e87#2022-07-25">https://towardsdatascience.com/parallel-programming-with-cuda-in-c-part-1-d935e93a9e87#2022-07-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/c8c84a27287ae02ee6425b539b263b23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hNox6MTIG9YxNGaC"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">照片由<a class="ae jd" href="https://unsplash.com/es/@aaron_boris?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> aaron boris </a>在<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><div class=""/><div class=""><h2 id="f454" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">了解如何利用现代GPU的强大功能加速计算密集型应用</h2></div><p id="e761" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最常见的深度学习框架，如<a class="ae jd" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"> Tensorflow </a>和<a class="ae jd" href="https://pytorch.org/" rel="noopener ugc nofollow" target="_blank"> PyThorch </a>通常依赖于内核调用，以便使用GPU进行并行计算，并加速神经网络的计算。允许开发人员使用GPU编程的最著名的接口是<a class="ae jd" href="https://it.wikipedia.org/wiki/CUDA" rel="noopener ugc nofollow" target="_blank"> CUDA </a>，由<a class="ae jd" href="https://www.nvidia.com/it-it/" rel="noopener ugc nofollow" target="_blank"> NVIDIA </a>创建。</p><p id="66ec" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">并行计算需要与普通编程完全不同的观点，但是在您开始动手之前，有一些术语和概念需要学习。</p><h2 id="f9b7" class="lr ls jg bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">背景</h2><p id="cf7f" class="pw-post-body-paragraph kv kw jg kx b ky mk kh la lb ml kk ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">在下图中，您可以看到一个经典的设置，其中CPU一次处理一条指令来生成一个输出。但是我们如何同时处理多个指令呢？这就是我们将在本文中试图理解的。</p><figure class="mp mq mr ms gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ca"><img src="../Images/153e2ff8a9660c57d4b310286ab60c5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*seHdNobQkTkyvDS39sFQcg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">作者图片</p></figure><h2 id="e1f1" class="lr ls jg bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">术语</h2><ul class=""><li id="94ae" class="mt mu jg kx b ky mk lb ml le mv li mw lm mx lq my mz na nb bi translated"><strong class="kx jh">进程:</strong>是正在执行的计算机程序的实例。一个进程在CPU上运行，并在RAM中创建一个分配。</li></ul><figure class="mp mq mr ms gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nc"><img src="../Images/b110f3fdd95bb4f8397cd06fd4a74ba1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FQ-aMl30P240XrrPSC83zg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">过程(图片由作者提供)</p></figure><ul class=""><li id="db7e" class="mt mu jg kx b ky kz lb lc le nd li ne lm nf lq my mz na nb bi translated"><strong class="kx jh">上下文:</strong>一个进程的数据集合(内存地址，程序状态)。它允许处理器挂起或暂停一个进程的执行，并在以后重新启动它。</li><li id="bb48" class="mt mu jg kx b ky ng lb nh le ni li nj lm nk lq my mz na nb bi translated"><strong class="kx jh">线程</strong>:是流程的一个组件。每个进程至少有一个被称为主线程的线程，它是程序的入口点。一个线程可以执行一些指令。在一个进程中，多个线程可以共存并共享分配给该特定进程的内存。进程之间没有内存共享。</li><li id="9d56" class="mt mu jg kx b ky ng lb nh le ni li nj lm nk lq my mz na nb bi translated"><strong class="kx jh">循环调度:</strong>如果我们有一个单核处理器，进程将按照循环调度执行，执行优先级最高的第一个进程。当你从一个过程的执行切换到另一个过程时叫做<strong class="kx jh">上下文切换。</strong></li></ul><h2 id="2347" class="lr ls jg bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">平行</h2><p id="5e5e" class="pw-post-body-paragraph kv kw jg kx b ky mk kh la lb ml kk ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">在现代计算中，不需要上下文切换，我们可以在不同的内核上运行不同的线程(现在可以把一个内核想象成一个小处理器)，这就是我们拥有多核设备的原因！</p><figure class="mp mq mr ms gt is gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/78736c30ca6db4ce700c34c872286738.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*Em8JH_ANAXbsDeiVV1rLzw.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">多核(图片由作者提供)</p></figure><p id="6bce" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是请记住，几乎在每个进程中都有一些应该顺序执行的指令和一些可以同时并行计算的指令。</p><p id="b871" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当您谈论并行时，您应该记住有两种类型的并行:</p><ul class=""><li id="3bdc" class="mt mu jg kx b ky kz lb lc le nd li ne lm nf lq my mz na nb bi translated"><strong class="kx jh">任务级别:</strong>相同或不同数据上的不同任务</li><li id="3f5d" class="mt mu jg kx b ky ng lb nh le ni li nj lm nk lq my mz na nb bi translated"><strong class="kx jh">数据级别:</strong>同一任务不同数据</li></ul><p id="7d4c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">此时，注意不要将并行性与并发性混淆。</p><ul class=""><li id="003e" class="mt mu jg kx b ky kz lb lc le nd li ne lm nf lq my mz na nb bi translated"><strong class="kx jh">并发:</strong>我们有一个处理器，它顺序执行进程，我们只是有并行的错觉，因为处理器真的很快。</li><li id="ca4e" class="mt mu jg kx b ky ng lb nh le ni li nj lm nk lq my mz na nb bi translated"><strong class="kx jh">并行:</strong>多个处理器的真正并行。</li></ul><h2 id="5088" class="lr ls jg bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">CPU、GPU和GPGPU</h2><p id="a7e2" class="pw-post-body-paragraph kv kw jg kx b ky mk kh la lb ml kk ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">图形处理单元(GPU)可以在短时间内执行复杂的操作。复杂性取决于同时执行的操作数量<br/>，但前提是它们保持简单且基本相似。游戏行业一直是GPU实现的启动市场，后来Nvidia公司通过平台CUDA实现了这一市场。GPU的恶名甚至增加了更多，特别是对于开发人员来说，他们现在能够使用几行代码运行多个计算操作。</p><p id="2c8e" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">CUDA允许我们在图形处理单元 ( <strong class="kx jh"> GPGPU </strong>)上使用并行计算进行所谓的<strong class="kx jh">通用计算，即使用GPU进行除3D图形之外的更多通用计算</strong></p><p id="ee5d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们来总结一下CPU和GPU的一些基本区别。</p><p id="062b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh">图形处理器:</strong></p><ul class=""><li id="ebe9" class="mt mu jg kx b ky kz lb lc le nd li ne lm nf lq my mz na nb bi translated">低时钟速度</li><li id="26ca" class="mt mu jg kx b ky ng lb nh le ni li nj lm nk lq my mz na nb bi translated">成千上万的核心</li><li id="0bdb" class="mt mu jg kx b ky ng lb nh le ni li nj lm nk lq my mz na nb bi translated">上下文切换由硬件完成(非常快)</li><li id="676b" class="mt mu jg kx b ky ng lb nh le ni li nj lm nk lq my mz na nb bi translated">如果一个线程停止，可以在线程之间切换</li></ul><p id="a577" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh"> CPU: </strong></p><ul class=""><li id="8cc7" class="mt mu jg kx b ky kz lb lc le nd li ne lm nf lq my mz na nb bi translated">高时钟速度</li><li id="b1d0" class="mt mu jg kx b ky ng lb nh le ni li nj lm nk lq my mz na nb bi translated">几个核心</li><li id="ba0b" class="mt mu jg kx b ky ng lb nh le ni li nj lm nk lq my mz na nb bi translated">上下文切换由软件完成(慢)</li><li id="b7c5" class="mt mu jg kx b ky ng lb nh le ni li nj lm nk lq my mz na nb bi translated">在线程之间切换并不容易</li></ul><h2 id="37e1" class="lr ls jg bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated">Cuda编程的基本步骤</h2><p id="58bd" class="pw-post-body-paragraph kv kw jg kx b ky mk kh la lb ml kk ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">在接下来的文章中，我们将编写使用并行编程的代码。然而，我们必须首先知道基于cuda的代码的结构是什么，有几个简单的步骤可以遵循。</p><ul class=""><li id="3fee" class="mt mu jg kx b ky kz lb lc le nd li ne lm nf lq my mz na nb bi translated">CPU上数据的初始化</li><li id="fb11" class="mt mu jg kx b ky ng lb nh le ni li nj lm nk lq my mz na nb bi translated">将数据从CPU传输到GPU</li><li id="8dc4" class="mt mu jg kx b ky ng lb nh le ni li nj lm nk lq my mz na nb bi translated">内核启动(GPU上的指令)</li><li id="3a7b" class="mt mu jg kx b ky ng lb nh le ni li nj lm nk lq my mz na nb bi translated">将结果从GPU传输回CPU</li><li id="ac47" class="mt mu jg kx b ky ng lb nh le ni li nj lm nk lq my mz na nb bi translated">从CPU和GPU回收内存</li></ul><p id="d9d7" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这样的环境中，我们将把<strong class="kx jh">主机代码</strong>称为将要在CPU上运行的代码，把<strong class="kx jh">设备代码</strong>称为将要在og GPU上运行的代码。</p><h1 id="fba4" class="nm ls jg bd lt nn no np lw nq nr ns lz km nt kn mc kp nu kq mf ks nv kt mi nw bi translated">最后的想法</h1><p id="49c3" class="pw-post-body-paragraph kv kw jg kx b ky mk kh la lb ml kk ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">还有更多的东西要看，但我不喜欢把它们都写在一篇文章里，因为我认为这比其他任何东西都更令人困惑。</p><p id="63f0" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">并行编程是当今一切的基础，它是我们必须加快非常长的计算时间的方式，只是更多的处理器或更多的核心一起工作，团结就是力量！</p><p id="5d93" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您有兴趣了解GPU如何工作，并且喜欢与硬件密切相关的编程，请继续阅读我将发表的这一系列文章。就我个人而言，我发现对CUDA的研究非常有趣，每一行代码都像是一个有待解决的难题。</p><h1 id="9d21" class="nm ls jg bd lt nn no np lw nq nr ns lz km nt kn mc kp nu kq mf ks nv kt mi nw bi translated">结束了</h1><p id="c4d3" class="pw-post-body-paragraph kv kw jg kx b ky mk kh la lb ml kk ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated"><em class="nx">马赛洛·波利蒂</em></p><p id="986f" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae jd" href="https://www.linkedin.com/in/marcello-politi/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>，<a class="ae jd" href="https://twitter.com/_March08_" rel="noopener ugc nofollow" target="_blank"> Twitter </a>，<a class="ae jd" href="https://march-08.github.io/digital-cv/" rel="noopener ugc nofollow" target="_blank"> CV </a></p></div></div>    
</body>
</html>