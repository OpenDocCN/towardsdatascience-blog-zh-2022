<html>
<head>
<title>Beginner’s Guide to Diffusion Models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">扩散模型入门指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/beginners-guide-to-diffusion-models-8c3435ccb4ae#2022-12-05">https://towardsdatascience.com/beginners-guide-to-diffusion-models-8c3435ccb4ae#2022-12-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f157" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">对人工智能生成的艺术如何通过稳定扩散、中途或 DALL-E 制作的直观理解</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/10da4b88cc3af5320c09b529b41b0417.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*xQrGG_weuH-N2kynjThfwg.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">用稳定扩散生成的莎菲朋克吧。图片由我提供。</p></figure><p id="220b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最近，人们对 OpenAI 的 DALL-E、Stable Diffusion(DALL-E 的免费替代品)和 Midjourney(托管在 Discord 服务器上)的兴趣越来越大。虽然人工智能生成的艺术非常酷，但更吸引人的是它最初是如何工作的。在最后一部分，我将包括一些资源，供任何人在这个人工智能艺术空间开始。</p><p id="ba28" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">那么这些技术是如何工作的呢？它使用了一种叫做潜在扩散模型的东西，其背后的想法其实很巧妙。</p><h1 id="a4a9" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">什么是扩散模型？</h1><blockquote class="mi"><p id="ecc5" class="mj mk it bd ml mm mn mo mp mq mr lp dk translated">本质上，这是一个两阶段的过程。</p><p id="d868" class="mj mk it bd ml mm mn mo mp mq mr lp dk translated">首先，它破坏输入，直到只剩下噪声。</p><p id="2773" class="mj mk it bd ml mm mn mo mp mq mr lp dk translated">其次，我们使用神经网络从噪声中恢复输入，以产生新生成的图像。</p></blockquote><p id="e9d6" class="pw-post-body-paragraph ku kv it kw b kx ms ju kz la mt jx lc ld mu lf lg lh mv lj lk ll mw ln lo lp im bi translated">记住前面提到的核心思想，让我们看看架构(参考这个<a class="ae mx" href="https://arxiv.org/pdf/2112.10752.pdf" rel="noopener ugc nofollow" target="_blank">链接</a>获得全文)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi my"><img src="../Images/3cc5cc1ab2fb18b572e14d9629ede1a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*amvFfxGHuzDcrj141oZR_A.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">用潜在扩散模型合成高分辨率图像:【https://arxiv.org/pdf/2112.10752.pdf】T2。我做的附加注释。</p></figure><p id="b935" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">了解该体系结构中的某些部分非常重要。有相当多的符号，所以让我从分解它们开始。</p><p id="216e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们从 x 开始，这是原始图像。我们把它输入到网络中的编码器，在那里它将被编码到一个叫做 z 的信息密集空间。</p><p id="ba19" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，我们将经历一个前进的过程，在这个过程中，我们对文本进行扩散和调节。该机制将文本嵌入与我们已经处理的图像相结合，并且合并的输入是扩散过程的初始噪声的一部分。</p><p id="94ff" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在此之后，它将通过一个神经网络，主要是预测图像中噪声的 UNet(卷积神经网络的一种形式)。</p><p id="21d1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，通过解码器重构噪声，产生你想要的图像。</p><p id="4bb7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这里，我想强调一下我认为该架构最重要的三个部分:</p><ol class=""><li id="ab32" class="nd ne it kw b kx ky la lb ld nf lh ng ll nh lp ni nj nk nl bi translated">扩散的正向过程</li><li id="2e47" class="nd ne it kw b kx nm la nn ld no lh np ll nq lp ni nj nk nl bi translated">神经网络本身</li><li id="7b66" class="nd ne it kw b kx nm la nn ld no lh np ll nq lp ni nj nk nl bi translated">调节方面</li></ol><h1 id="dbc1" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">正向过程</h1><p id="4ad8" class="pw-post-body-paragraph ku kv it kw b kx nr ju kz la ns jx lc ld nt lf lg lh nu lj lk ll nv ln lo lp im bi translated">概括地说，扩散模型通过逐渐增加噪声来破坏一些输入。这个转发过程可以使用<a class="ae mx" href="https://en.wikipedia.org/wiki/Markov_chain" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">马尔可夫链</strong> </a>来完成。</p><h2 id="4a4a" class="nw lr it bd ls nx ny dn lw nz oa dp ma ld ob oc mc lh od oe me ll of og mg oh bi translated">马尔可夫链表示</h2><p id="8fe7" class="pw-post-body-paragraph ku kv it kw b kx nr ju kz la ns jx lc ld nt lf lg lh nu lj lk ll nv ln lo lp im bi translated">由于添加噪声的过程是一系列事件，其中每个时间步都依赖于前一个时间步，因此我们可以使用马尔可夫链。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi my"><img src="../Images/27ee56f64d0a3b7f9d35cb5fc840a205.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dfR7kHrl-yvhLm3-tJnhqw.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">图一。向图像添加噪声的公式。我的插图。</p></figure><p id="5a49" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于一个特定的图像，x₀，我们可以通过添加一系列噪声，特别是高斯噪声来创建一个有噪声的图像。</p><h2 id="1a6e" class="nw lr it bd ls nx ny dn lw nz oa dp ma ld ob oc mc lh od oe me ll of og mg oh bi translated">高斯噪声</h2><p id="dc41" class="pw-post-body-paragraph ku kv it kw b kx nr ju kz la ns jx lc ld nt lf lg lh nu lj lk ll nv ln lo lp im bi translated">噪声采样方式实际上可以用以下公式描述:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi my"><img src="../Images/a09a3af0be587670f0ef88b886d97cdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dDzt974LAkixMdXQCG1d3w.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">图二。噪声方程。我的插图。</p></figure><p id="807c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是一个有条件的高斯分布，取决于前一个图像和一个特定的方差。这里描述了分布的均值和方差。</p><p id="2356" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们更仔细地看看这个等式。贝塔序列被称为<strong class="kw iu">方差表</strong>，它描述了我们想要在每个时间步长添加多少噪声。把它想象成一张关键是时间的地图，值基本上就是你想产生多少失真。</p><p id="397f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请注意，平均值总是基于之前的图像，因此每次添加噪声时，基本上都是对之前的图像进行细微的调整。这使得小的修改进一步扭曲了图像。</p><h2 id="c6d5" class="nw lr it bd ls nx ny dn lw nz oa dp ma ld ob oc mc lh od oe me ll of og mg oh bi translated">贝塔</h2><p id="9b6f" class="pw-post-body-paragraph ku kv it kw b kx nr ju kz la ns jx lc ld nt lf lg lh nu lj lk ll nv ln lo lp im bi translated">那么贝塔到底是什么？为了理解 Beta，让我们首先快速回顾一下图像是如何工作的。我们知道图像是由像素组成的，每个像素有 3 个通道——(R)ed，(G)green，(B)lue。</p><p id="6e4f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">假设我们有一个纯绿色的像素(-1，1，-1) [R，G，B]。我们采用特定的通道(绿色)并应用图 2 中<em class="oi">的等式。</em></p><p id="f499" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">回顾过去，我们观察到，选择更大的β意味着像素分布更宽，因为方差更大。然而，这也意味着正态曲线进一步向 0 移动，因为均值项受到影响。</p><p id="8fac" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，当图像偏离原始图像越来越远时，图像会变得越来越糟糕。</p><h2 id="2a12" class="nw lr it bd ls nx ny dn lw nz oa dp ma ld ob oc mc lh od oe me ll of og mg oh bi translated">噪声调度</h2><p id="a2dc" class="pw-post-body-paragraph ku kv it kw b kx nr ju kz la ns jx lc ld nt lf lg lh nu lj lk ll nv ln lo lp im bi translated">在每个特定的时间步长 t，将会应用特定的β值。这个贝塔序列被称为噪声时间表。</p><p id="e693" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">目的是添加适量的噪声，这样我们可以得到均值为 0 且在所有方向上方差固定的各向同性高斯分布。这使得去噪过程运行良好。</p><p id="ffb4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有许多策略来执行噪声调度，包括但不限于:</p><ul class=""><li id="9e12" class="nd ne it kw b kx ky la lb ld nf lh ng ll nh lp oj nj nk nl bi translated">线性的</li><li id="5075" class="nd ne it kw b kx nm la nn ld no lh np ll nq lp oj nj nk nl bi translated">s 形的</li><li id="b496" class="nd ne it kw b kx nm la nn ld no lh np ll nq lp oj nj nk nl bi translated">二次的</li></ul><h1 id="03ad" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">神经网络</h1><p id="7bf0" class="pw-post-body-paragraph ku kv it kw b kx nr ju kz la ns jx lc ld nt lf lg lh nu lj lk ll nv ln lo lp im bi translated">现在我们已经讨论了正向过程，让我们来讨论如何“反转”整个序列并预测只有噪声的图像。</p><p id="a4e0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是神经网络派上用场的地方。把它想象成去噪，一步一步地去除图像的“杂质”，直到它恢复或产生非常好的图像。神经网络在取自 LAION-5B 的成对图像和标题上进行训练，LAION-5B 是一个公开可用的数据集，来自于从网络上搜集的常见爬行数据。</p><p id="7c8f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们预测噪声而不是整个图像本身的原因是它在计算上更可行。这是因为一幅图像有大量的复杂性，而噪声只是噪声。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi my"><img src="../Images/12b9f75bc4eb117578c607caf94de34f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A95K1dP7c74LtfRJzRrYUg.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">图三。去噪示例。我的插图。</p></figure><p id="a176" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">考虑图 3 中<em class="oi">所示的例子。在这里，我们有一个非常嘈杂的图像在时间步骤 200，这应该揭示一个坚持的人，如果你完全降噪的图像。神经网络预测我们在(1)处看到的图像上的噪声，并产生噪声作为(2)中所示的输出。</em></p><p id="3393" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">之后，我们从有噪声的图像中减去噪声，得到一个棍子人的模糊的图像。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi my"><img src="../Images/97d2c6bdd2423700aebd34779a0c0d18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EyGrBVMHcXmtHyINKbrASw.jpeg"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">图 4。迭代循环。我的插图。</p></figure><p id="f503" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们在 for 循环中一直这样做，直到最终到达原始图像。</p><p id="4101" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">拼图的最后一块是实际生成带有文本的特定图像。这可以通过最后一种机制——调节来实现。</p><h1 id="e317" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">调节</h1><p id="00d3" class="pw-post-body-paragraph ku kv it kw b kx nr ju kz la ns jx lc ld nt lf lg lh nu lj lk ll nv ln lo lp im bi translated">让我们以嘈杂的图像为例，但这次我们也添加了“一个笑脸”的文本提示，如图<em class="oi">图 5 </em>所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi my"><img src="../Images/52f62ad1a8031e6298e310dff71450d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fd_1LlFiaU46blIFrG-eJg.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">图五。带文本提示的噪声图像。我的插图。</p></figure><p id="0085" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">它通过神经网络，将再次预测噪声，但它将使用通过训练获得的笑脸的相关潜在空间表示来预测噪声。</p><p id="2f9f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本质上，它对笑脸产生的噪音有一个粗略的概念，并将其纳入预测。</p><p id="958f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们再次减去噪声，从时间步长 200 到 199。我们像以前一样，反复重复这个过程，但是这次再次输入文本提示，聚焦并放大我们想要的对象——一个笑脸。</p><h2 id="d59c" class="nw lr it bd ls nx ny dn lw nz oa dp ma ld ob oc mc lh od oe me ll of og mg oh bi translated">附加技巧</h2><p id="c27b" class="pw-post-body-paragraph ku kv it kw b kx nr ju kz la ns jx lc ld nt lf lg lh nu lj lk ll nv ln lo lp im bi translated">为了更好地得到我们想要的，我们可以使用一些额外的技巧。我们可以利用无分类器指导(CFG)来使输出更加依赖于提示。</p><p id="4862" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当你自己玩稳定扩散时，你可能会看到一个叫做 CFG 的滑块，这个值越高，就越接近你的描述。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi my"><img src="../Images/81598caee044867e2822516c4606ffc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tlxoqujf_MSz-Ooa4gCxtw.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">图六。输入两次。我的插图。</p></figure><p id="9235" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们通过向神经网络发送两次输入来做到这一点，一次是带有文本嵌入的的<strong class="kw iu">，一次是没有文本嵌入的</strong>的<strong class="kw iu">，如图 6 中的<em class="oi">所示。</em></strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi my"><img src="../Images/b2c56369454f2f3525582b3000b4aeba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Duu7WNjIvh6Cbq1Z6YxGBA.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">图 7。求差以得到笑脸的更好表示。我的插图。</p></figure><p id="2a23" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这会产生两组噪声图像，我们可以取其差值并将其馈入网络以放大该信号，如图<em class="oi">图 7 </em>所示。</p><h1 id="66ea" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">将一切拼凑在一起</h1><p id="a586" class="pw-post-body-paragraph ku kv it kw b kx nr ju kz la ns jx lc ld nt lf lg lh nu lj lk ll nv ln lo lp im bi translated">作为用户，我们希望为模型提供文本提示，以生成我们想要的图像。这种方法被称为<strong class="kw iu"> txt2img。</strong></p><p id="d462" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">典型的提示结构如下:</p><blockquote class="mi"><p id="c16a" class="mj mk it bd ml mm mn mo mp mq mr lp dk translated">"[主要主题的[图片类型]，[样式提示]"</p></blockquote><p id="12f1" class="pw-post-body-paragraph ku kv it kw b kx ms ju kz la mt jx lc ld mu lf lg lh mv lj lk ll mw ln lo lp im bi translated">通过给模型输入提示，我们实际上是在使用模型的条件和神经网络部分来产生我们想要的图像。使图像有噪声的前向过程仅用于训练，而不是我们在此阶段所关心的。</p></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><p id="ea1e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">至此，我们对这项技术的工作原理有了更好的理解。如果您想亲自尝试，请查看以下资源:</p><ul class=""><li id="1bde" class="nd ne it kw b kx ky la lb ld nf lh ng ll nh lp oj nj nk nl bi translated"><a class="ae mx" href="https://openai.com/dall-e-2/" rel="noopener ugc nofollow" target="_blank"> DALL-E </a></li><li id="66a5" class="nd ne it kw b kx nm la nn ld no lh np ll nq lp oj nj nk nl bi translated"><a class="ae mx" href="https://huggingface.co/spaces/stabilityai/stable-diffusion" rel="noopener ugc nofollow" target="_blank">稳定扩散</a></li><li id="d624" class="nd ne it kw b kx nm la nn ld no lh np ll nq lp oj nj nk nl bi translated"><a class="ae mx" href="https://midjourney.com/" rel="noopener ugc nofollow" target="_blank">中途</a></li></ul></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><p id="ab7e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢您阅读另一本<strong class="kw iu">初学者指南。例如，如果你对卷积网络的工作方式感兴趣，一定要看看我写的另一篇文章<a class="ae mx" href="https://medium.com/towards-data-science/beginners-crash-course-to-deep-learning-and-cnns-a32f35234038" rel="noopener">这里</a>简单地解释了一切。</strong></p></div></div>    
</body>
</html>