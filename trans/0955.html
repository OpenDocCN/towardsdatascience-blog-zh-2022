<html>
<head>
<title>How To Access Relational Databases In Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Python 访问关系数据库</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-access-relational-databases-in-python-f711cb38e235#2022-03-14">https://towardsdatascience.com/how-to-access-relational-databases-in-python-f711cb38e235#2022-03-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c025" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用数据库适配器的简单指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f50d023761dedc34230ed9e3b53d3d68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KvzhqCgMKnDFqZtsCmg5ag.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由来自<a class="ae ky" href="https://www.pexels.com/photo/photo-of-turned-on-laptop-computer-943096/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">佩克斯</a>的<a class="ae ky" href="https://www.pexels.com/@danny-meneses-340146?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">丹尼·梅内塞斯</a>拍摄</p></figure><p id="8d9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关系数据库管理系统(RDBMS)无处不在。</p><p id="9d40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它们提供了一种储存大量信息的简单方法。此外，在 SQL 的帮助下，访问、维护和修改存储在其中的数据变得非常容易。</p><p id="28b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也就是说，这样的安排带有一定的警告。如果您希望从存储在数据库中的信息中获得洞察力，您会受到 SQL 提供的命令的限制。</p><p id="ee22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然 SQL 允许您执行连接或利用聚合函数，但它不提供执行更高级技术的方法，如执行统计测试或构建预测模型。如果你希望执行这样的操作，你将需要 Python 的帮助。</p><p id="94e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就引出了一个问题:如何在响应 SQL 查询的数据库上实现 Python 代码？</p><h2 id="9d34" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">数据库适配器</h2><p id="01af" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">要访问 Python 中的数据库，您需要使用一个<em class="mt">数据库适配器</em>。</p><p id="f700" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python 通过其模块提供数据库适配器，允许访问主要数据库，如 MySQL、PostgreSQL、SQL Server 和 SQLite。</p><p id="9c06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，所有这些模块都依赖 Python 的数据库 API (DB-API)来管理数据库。因此，用于管理数据库的代码在所有数据库适配器中都是一致的。</p><p id="6768" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦您能够成功地与一个关系数据库通信，您就应该能够与所有关系数据库通信。</p><p id="ea04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">利用数据库适配器需要理解关键对象和方法，这些对象和方法将用于促进与相关数据库的交互。</p><h2 id="2086" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">个案研究</h2><p id="dc47" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">一个简单的演示可以展示数据库适配器的特性。</p><p id="1e74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我使用 PostgreSQL，所以我需要依赖于<a class="ae ky" href="https://pypi.org/project/psycopg2/" rel="noopener ugc nofollow" target="_blank"> psycopg2 </a>模块。</p><p id="7a71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这项研究将使用一个名为“test_db”的数据库。这个数据库包含一个名为“Person”的表，其中包含用<a class="ae ky" href="https://www.mockaroo.com/" rel="noopener ugc nofollow" target="_blank"> Mockaroo </a>生成的假数据。</p><p id="a306" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是数据预览:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/3bbda030a75e454f5212ac988227b509.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tWJsu3tEVy4tId9PgEVeEA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出预览(由作者创建)</p></figure><ol class=""><li id="cc3a" class="mx my it lb b lc ld lf lg li mz lm na lq nb lu nc nd ne nf bi translated"><strong class="lb iu">连接到数据库</strong></li></ol><p id="7e85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要建立到数据库的连接，这样我们就可以使用 Python 与它通信。我们可以通过创建一个<em class="mt">连接</em>对象来实现。</p><p id="9ca7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建连接对象时，您需要为其提供定位和访问数据库所需的信息。这包括主机、用户名、密码和数据库名称。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><h2 id="65d0" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">2.从 Python 向数据库写入查询</h2><p id="a878" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">既然我们已经连接到数据库，我们应该能够直接从 Python 编写对数据库的查询。</p><p id="c183" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管我们现在使用的是 Python，但我们将需要继续使用 SQL 查询来检索任何信息。</p><p id="9bfa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在编写任何查询之前，我们需要创建一个<em class="mt">光标</em>对象。</p><p id="dba2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">光标对象使用<em class="mt">执行</em>方法来执行给定的查询。可以用<em class="mt"> fetchall </em>方法检索查询的结果输出。</p><p id="79fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们使用这个过程来选择 Person 表中的前 5 行。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/ec34b59e22a474144198c36b7d48a160.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4eOsbndkznaicQccyhjWnQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="359d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如输出所示，每一行都表示为一个元组。</p><p id="74d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要获得表的列名，可以使用 cursor 对象上的<em class="mt"> description </em>属性。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/28140287eb998d2465bff32819a3c6de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i2nJvWBUeJiJ2xw3E1zipw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="d3c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 3。使用数据库执行高级分析</strong></p><p id="58cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然我们可以用 Python 编写对数据库的 SQL 查询，但是如果我们只能做这些，那么使用适配器就没有什么意义了。</p><p id="fc38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们对“Person”表中的数据执行一个操作，这是我们单独使用 SQL 查询无法完成的。</p><p id="b8f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们应该首先在 Python 中将表存储为 pandas 数据框。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/8a5b1ea4522eb17ffd22b9ad86611eb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*4YtkvyF37i3_PLwsPNB6_g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="dd15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以全权处理这些数据了。</p><p id="1927" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">举个例子，让我们来看看这个数据集中男性和女性的平均收入。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/63f68abde7e9c3e51945d7c7829b47d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:696/format:webp/1*UEi5eqrdQ2ka8T71FuIvig.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="3f52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到，女性的平均收入高于男性。然而，没有迹象表明这种差异具有统计学意义。</p><p id="43cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以利用 Python 的<a class="ae ky" href="https://docs.scipy.org/doc/scipy/" rel="noopener ugc nofollow" target="_blank"> SciPy </a>模块来进行 t 检验，看看是否有证据表明男女收入不一样。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/8117b5f29f0f21115547eb8cfe6e606c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z6J0WerX3Ej1mAs3nfyo3A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="68b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于 Python 的实用性，我们能够从我们的数据中学到更多！我们现在知道，从统计数据来看，男女之间的收入差距很大。</p><p id="c325" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，由于数据是假的，我们进行的任何分析就像在沙漠中洗桑拿一样有用，但你会明白的。</p><p id="cf6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 4。直接从 Python 修改数据库</strong></p><p id="f541" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在研究过程中，可能需要创建、删除或修改数据库中的表。这样的操作也可以从 Python 中完成。</p><p id="139b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的例子中，假设不是有两个分别包含名字和姓氏的列，而是只需要一个存储全名的列。</p><p id="1fd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过以下步骤实现这一点:</p><ol class=""><li id="8938" class="mx my it lb b lc ld lf lg li mz lm na lq nb lu nc nd ne nf bi translated">创建一个名为“名称”的新列</li><li id="8085" class="mx my it lb b lc nl lf nm li nn lm no lq np lu nc nd ne nf bi translated">通过串联“名字”和“姓氏”列中的值，向“姓名”列添加值</li><li id="36ea" class="mx my it lb b lc nl lf nm li nn lm no lq np lu nc nd ne nf bi translated">删除“名字”和“姓氏”列</li></ol><p id="82b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以用下面的代码来执行这些步骤:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="343d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:代码中一个非常重要的内容是第 12 行中的<em class="mt">提交</em>方法。在 Python 中对数据库进行的任何修改都不会自动提交到数据库中。因此，必须调用此方法才能使更改生效。</p><p id="3aba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您返回数据库时，可以看到应用的更改。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/41a165253202690d732a085f9f4031bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-KBx5hg3S6yqP_Ku460TbQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="9891" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据库适配器的一个非常有用的特性是，它们允许您撤销任何不需要的修改(只要它们没有被提交)。</p><p id="a7a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<em class="mt">回滚</em>方法，您可以将数据库恢复到上次提交时的状态。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="3082" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 5。终止与数据库的连接</strong></p><p id="459d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦完成了与数据库的通信，就可以用<em class="mt"> close </em>方法结束与数据库的连接。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><h2 id="a9ab" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">结论</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e479957605983e530b95f4af46e9ffc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m_4OiHIK5yiLrfL0"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@prateekkatyal?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Prateek Katyal </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="fd07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL 和 Python 有各自独特的优点和缺点。</p><p id="28cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">令人欣慰的是，有了数据库适配器，您可以在研究中利用这两种工具，并获得两个世界的最佳效果。</p><p id="9930" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了更全面地了解您可以使用特定的数据库适配器做什么，我建议您花一些时间阅读它的文档，以了解更多关于您可以使用的工具的信息。</p><p id="495c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我祝你在数据科学的努力中好运！</p></div></div>    
</body>
</html>