<html>
<head>
<title>How to Make a Database Connection in Python for Absolute Beginners</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">绝对初学者如何用Python做数据库连接</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-make-a-database-connection-in-python-for-absolute-beginners-e2bfd8e4e52#2022-07-04">https://towardsdatascience.com/how-to-make-a-database-connection-in-python-for-absolute-beginners-e2bfd8e4e52#2022-07-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8ef6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">连接MS SQL Server、MySQL、Oracle和许多其他数据库的3个步骤(+示例)</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f991da2c0f0de51c40ecc65a66736818.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZJyIk81m2AqfnBoU"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">连接时间(图片由<a class="ae ky" href="https://unsplash.com/@marcusurbenz" rel="noopener ugc nofollow" target="_blank">马库斯·乌尔本斯</a>在<a class="ae ky" href="https://unsplash.com/photos/qY6ikaS8L38" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄)</p></figure><p id="480a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用Python，我们可以自动编写和执行SQL。但是要做到这一点，我们需要Python能够与数据库通信。在本文中，我们将重点关注使用名为<code class="fe lv lw lx ly b">pyodbc</code>的包，通过ODBC协议与关系数据库进行通信。阅读完本文后，你将能够在你的Python应用程序中编写和执行SQL。我们来编码吧！</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="6b30" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">在开始之前..</h1><p id="1d7a" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">让我们定义一下这篇文章的范围。</p><h2 id="9463" class="nd mh it bd mi ne nf dn mm ng nh dp mq li ni nj ms lm nk nl mu lq nm nn mw no bi translated">Postgres用户？</h2><p id="0450" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">有许多数据库符合ODBC和pyodbc，在本文中我们将使用MS SQL。如果您正在使用PostgreSQL，那么请查看下面的文章，了解更优化的方法。</p><div class="np nq gp gr nr ns"><a href="https://mikehuls.medium.com/creating-a-python-postgresql-connection-for-absolute-beginners-501b97f73de1" rel="noopener follow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">为绝对初学者创建Python PostgreSQL连接</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">Python脚本如何与Postgres数据库通信</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">mikehuls.medium.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og ks ns"/></div></div></a></div></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="85f3" class="nd mh it bd mi ne nf dn mm ng nh dp mq li ni nj ms lm nk nl mu lq nm nn mw no bi translated">生成SQL查询</h2><p id="abfe" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">本文重点介绍如何使用pyodbc创建与数据库的连接。然后可以使用这个连接来执行SQL。有些数据库使用不同的语法:</p><ul class=""><li id="7a8b" class="oh oi it lb b lc ld lf lg li oj lm ok lq ol lu om on oo op bi translated"><strong class="lb iu"> MS SQL Server </strong> <br/> <code class="fe lv lw lx ly b">SELECT TOP 1 colname FROM tablename LIMIT 10</code></li><li id="5801" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu om on oo op bi translated"><strong class="lb iu">PostgreSQL</strong>T2<br/>。</li></ul><p id="268c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着您必须为特定的数据库编写SQL语句。</p><p id="18e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有一种<strong class="lb iu">与数据库无关的</strong>方法，可以用更Pythonic化的方式定义查询，然后针对某个数据库进行编译。这将<strong class="lb iu">为那个数据库</strong>生成特定的SQL，这样您就不会受限于您当前使用的数据库的特定内容。这意味着，如果你将来决定从MySQL转换到Postgres，你不必修改你的代码。</p><p id="2598" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我正在写这篇文章，所以请务必<a class="ae ky" href="https://mikehuls.medium.com/membership" rel="noopener">关注我</a>！</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="bf9d" class="nd mh it bd mi ne nf dn mm ng nh dp mq li ni nj ms lm nk nl mu lq nm nn mw no bi translated">关于pyodbc和odbc协议</h2><p id="44a7" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">关于我们正在使用的软件包及其工作原理的一些背景知识。Pyodbc是一个允许您与(关系)数据库通信的包。它使用<strong class="lb iu">的<em class="ov">开放式数据库通信</em>的</strong>协议。这个协议定义了客户端(就像您的Python脚本)和数据库如何通信。</p><p id="4047" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以将这种通信协议与HTTP协议进行比较，HTTP协议有助于计算机之间通过internet进行通信:客户端知道如何请求资源，服务器知道如何响应，客户端知道响应是什么样的，因此它们可以使用这些信息。同样，<strong class="lb iu">客户端可以使用<em class="ov"> ODBC协议</em>与数据库</strong>通信。</p><div class="np nq gp gr nr ns"><a rel="noopener follow" target="_blank" href="/docker-for-absolute-beginners-the-difference-between-an-image-and-a-container-7e07d4c0c01d"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">面向绝对初学者的Docker:图像和容器的区别</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">了解Docker图像和容器的区别容器和图像是不同的+实用代码示例</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="ow l od oe of ob og ks ns"/></div></div></a></div><h1 id="8fb8" class="mg mh it bd mi mj ox ml mm mn oy mp mq jz oz ka ms kc pa kd mu kf pb kg mw mx bi translated">连接到数据库—代码部分</h1><p id="3a2d" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">我们将经历几个简单的步骤。我们需要使用我们的凭证来创建一个连接字符串。用那根线我们可以建立联系。在连接上，您可以创建一个我们将用来执行查询的游标。首先做一些准备:</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="1d1a" class="nd mh it bd mi ne nf dn mm ng nh dp mq li ni nj ms lm nk nl mu lq nm nn mw no bi translated">准备:依赖性</h2><p id="d82d" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">首先，让我们创建一个虚拟环境，并安装我们唯一的依赖项。</p><pre class="kj kk kl km gt pc ly pd pe aw pf bi"><span id="db26" class="nd mh it ly b gy pg ph l pi pj">pip install pyodbc</span></pre><div class="np nq gp gr nr ns"><a rel="noopener follow" target="_blank" href="/virtual-environments-for-absolute-beginners-what-is-it-and-how-to-create-one-examples-a48da8982d4b"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">绝对初学者的虚拟环境——什么是虚拟环境，如何创建虚拟环境(+例子)</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">深入探究Python虚拟环境、pip和避免纠缠依赖</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="pk l od oe of ob og ks ns"/></div></div></a></div></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="f79b" class="nd mh it bd mi ne nf dn mm ng nh dp mq li ni nj ms lm nk nl mu lq nm nn mw no bi translated">第一步。收集我们的凭证</h2><p id="a126" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">这是我们检索数据库凭证的地方。在下面的例子中，我们尽可能以最安全的方式处理我们的凭证:我们从环境中加载它们，这样我们的应用程序就可以访问它们，而无需将它们硬编码到我们的脚本中。</p><pre class="kj kk kl km gt pc ly pd pe aw pf bi"><span id="9ae9" class="nd mh it ly b gy pg ph l pi pj">import pyodbc<br/><br/>driver: str = 'ODBC Driver 17 for SQL Server'<br/>username = os.environ.get("SQLSERVER_USER")<br/>password = os.environ.get("SQLSERVER_PASS")<br/>host = os.environ.get("SQLSERVER_HOST")<br/>port = os.environ.get("SQLSERVER_PORT")<br/>database = os.environ.get("SQLSERVER_DB")</span></pre><p id="e7b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过学习如何应用下面文章中的<code class="fe lv lw lx ly b">env files</code>来防止您的密码泄露:</p><div class="np nq gp gr nr ns"><a rel="noopener follow" target="_blank" href="/keep-your-code-secure-by-using-environment-variables-and-env-files-4688a70ea286"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">通过使用环境变量和env文件来保证代码的安全</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">安全地加载一个文件，其中包含我们的应用程序所需的所有机密数据，如密码、令牌等</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="pl l od oe of ob og ks ns"/></div></div></a></div></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="2dca" class="nd mh it bd mi ne nf dn mm ng nh dp mq li ni nj ms lm nk nl mu lq nm nn mw no bi translated">第二步。创建连接字符串</h2><p id="9936" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">Pyodbc需要一个包含我们的凭据的格式化字符串来连接到数据库。在下面的例子中，我们使用f字符串来创建连接字符串，同时保持代码的整洁。</p><pre class="kj kk kl km gt pc ly pd pe aw pf bi"><span id="204d" class="nd mh it ly b gy pg ph l pi pj">password = "}}".join(password.split("}"))<br/><br/>constring = f"DRIVER={driver};" \<br/>            f"SERVER={host};" \<br/>            f"DATABASE={database};" \<br/>            f"UID={username};" \<br/>            f"PWD={{{password}}};" \<br/>            f"port={port};"</span></pre><p id="30ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">修复密码..</strong><br/><code class="fe lv lw lx ly b">password</code>发生了一些诡异的事情。首先，我们将密码中的所有<code class="fe lv lw lx ly b">}</code>花括号折叠起来，然后我们再次用花括号将它括起来。这是因为密码可能包含一些奇怪的字符，例如<code class="fe lv lw lx ly b">/\{};</code>。用花括号把它们括起来可以避免所有的错误。我们不希望我们的密码中的任何花括号被转义，所以我们将它们加倍，以便“避免转义”。</p><p id="d3b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有点奇怪，但这显然是它的工作方式。还要注意，这不仅适用于密码，也适用于任何参数，所以如果您的用户名包含特殊字符，您也可以使用这种技术。</p><p id="4d52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">产生的连接字符串如下所示(注意，<code class="fe lv lw lx ly b">my_}password</code>现在被正确地翻译成了<code class="fe lv lw lx ly b">{my_}}password}</code>)。</p><pre class="kj kk kl km gt pc ly pd pe aw pf bi"><span id="4787" class="nd mh it ly b gy pg ph l pi pj">DRIVER=ODBC Driver 17 for SQL Server;SERVER=my_host;DATABASE=my_database;UID=my_username;PWD={my_}}password};port=my_port;</span></pre><div class="np nq gp gr nr ns"><a rel="noopener follow" target="_blank" href="/getting-started-with-cython-how-to-perform-1-7-billion-calculations-per-second-in-python-b83374cfcf77"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">Cython入门:如何在Python中每秒执行超过17亿次计算</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">结合Python的易用性和C的速度</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="pm l od oe of ob og ks ns"/></div></div></a></div></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="3160" class="nd mh it bd mi ne nf dn mm ng nh dp mq li ni nj ms lm nk nl mu lq nm nn mw no bi translated">第三步。连接</h2><p id="732a" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">这是最简单的部分，我们将创建一个连接(通常每个应用程序有一个连接)。然后我们在连接上创建一个光标。游标用于迭代查询产生的结果集。处理完结果集后，关闭光标。</p><pre class="kj kk kl km gt pc ly pd pe aw pf bi"><span id="a11d" class="nd mh it ly b gy pg ph l pi pj">cnxn:pyodbc.Connection = pyodbc.connect(constring)</span><span id="634d" class="nd mh it ly b gy pn ph l pi pj">cursor:pyodbc.Cursor = cnxn.cursor()<br/>try:<br/>    cursor.execute("SELECT @@VERSION")<br/>    print(cursor.fetchone())<br/>except Exception as e:<br/>    print(f"Connection could not be established: {e}")<br/>finally:<br/>    cursor.close()</span></pre><p id="027e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们可以使用光标执行一些SQL，在本例中，我们打印出SQL Server数据库的版本。如果有任何失败，我们打印出错误，并且在任何情况下，我们关闭我们的光标。</p><p id="9d4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有一种更短、更好的方法可以做到这一点:</p><pre class="kj kk kl km gt pc ly pd pe aw pf bi"><span id="6e94" class="nd mh it ly b gy pg ph l pi pj">with cnxn.cursor() as cursor:<br/>    try:<br/>        cursor.execute("SELECT @@VERSION")<br/>        print(cursor.fetchone())<br/>    except Exception as e:<br/>        print(f"Connection could not be established: {e}")</span></pre><p id="830a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用上下文管理器(<code class="fe lv lw lx ly b">with</code>部分)会使光标自动关闭。此外，它将提交(您必须<code class="fe lv lw lx ly b">commit</code>插入；看下面的例子)你在<code class="fe lv lw lx ly b">try</code>块中执行的任何东西。如果它检测到错误，它将回滚所有查询。请注意，这仅适用于使用<code class="fe lv lw lx ly b">autocommit=False</code>(默认设置)创建连接的情况。</p><div class="np nq gp gr nr ns"><a href="https://medium.com/geekculture/understanding-python-context-managers-for-absolute-beginners-4873b6249f16" rel="noopener follow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">绝对初学者理解Python上下文管理器</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">理解关于光剑的WITH语句</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">medium.com</p></div></div><div class="ob l"><div class="po l od oe of ob og ks ns"/></div></div></a></div></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="b612" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">额外收获:示例查询</h1><p id="b287" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">这里有一些示例查询可以帮助您。</p><h2 id="738a" class="nd mh it bd mi ne nf dn mm ng nh dp mq li ni nj ms lm nk nl mu lq nm nn mw no bi translated"><strong class="ak">查询1:选择记录</strong></h2><p id="52e0" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">使用<code class="fe lv lw lx ly b">cursor.fetchone()</code>检索单个行。</p><pre class="kj kk kl km gt pc ly pd pe aw pf bi"><span id="691f" class="nd mh it ly b gy pg ph l pi pj">with cnxn.cursor() as cursor:<br/>    cursor.execute("SELECT * FROM INFORMATION_SCHEMA.TABLES")<br/>    for row in cursor.fetchall():<br/>        print(row)</span></pre><div class="np nq gp gr nr ns"><a rel="noopener follow" target="_blank" href="/sql-understand-how-indices-work-under-the-hood-to-speed-up-your-queries-a7f07eef4080"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">SQL——理解索引如何在幕后加速查询。</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">不再需要等待缓慢的查询完成</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="pp l od oe of ob og ks ns"/></div></div></a></div></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="1c29" class="nd mh it bd mi ne nf dn mm ng nh dp mq li ni nj ms lm nk nl mu lq nm nn mw no bi translated"><strong class="ak">查询2:选择记录；转换为字典列表，其中每个字典为一行</strong></h2><pre class="kj kk kl km gt pc ly pd pe aw pf bi"><span id="fa65" class="nd mh it ly b gy pg ph l pi pj">with cnxn.cursor() as cursor:<br/>    cursor.execute("SELECT * FROM INFORMATION_SCHEMA.TABLES")<br/>    colnames = [col[0] for col in cursor.description]<br/>    coltypes = [col[1] for col in cursor.description]<br/>    for rowvalues in cursor.fetchall():<br/>        # convert types<br/>        rowvalues = [coltypes[i](rowvalues[i]) for i in range(len(coltypes))]<br/>        # make dicts from the colnames and rowvalues<br/>        row = dict(zip(colnames, rowvalues))<br/>        print(row)</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="e441" class="nd mh it bd mi ne nf dn mm ng nh dp mq li ni nj ms lm nk nl mu lq nm nn mw no bi translated">查询3:常规插入</h2><p id="63dd" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">因为我们在上下文管理器块中(即<code class="fe lv lw lx ly b">with</code>)，所以如果没有错误发生，执行将被提交。光标也会自动关闭。</p><pre class="kj kk kl km gt pc ly pd pe aw pf bi"><span id="e9f9" class="nd mh it ly b gy pg ph l pi pj">with cnxn.cursor() as cursor:<br/>    cursor.execute("INSERT INTO med.mytable (name, age)  VALUES (?,?)", "mike", 32)</span></pre><div class="np nq gp gr nr ns"><a rel="noopener follow" target="_blank" href="/sql-insert-delete-and-update-in-one-statement-sync-your-tables-with-merge-14814215d32c"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">SQL —在一条语句中插入、删除和更新:用MERGE同步表</h2><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="pq l od oe of ob og ks ns"/></div></div></a></div></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="2166" class="nd mh it bd mi ne nf dn mm ng nh dp mq li ni nj ms lm nk nl mu lq nm nn mw no bi translated">查询4:回滚插入</h2><p id="f02a" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">前两个被插入，然后#3失败，所以#1和# 2再次回滚。数据库里不会有a先生，b先生，c先生的踪迹。</p><pre class="kj kk kl km gt pc ly pd pe aw pf bi"><span id="6b48" class="nd mh it ly b gy pg ph l pi pj">with cnxn.cursor() as cursor:<br/>    cursor.execute("INSERT INTO med.mytable (name, age)  VALUES (?,?)", "mr. a", 44)<br/>    cursor.execute("INSERT INTO med.mytable (name, age)  VALUES (?,?)", "mr. b", 33)<br/>    cursor.execute("INSERT INTO med.mytable (name, age)  VALUES (?,?)", "mr. c", 55, "toomany")</span></pre><div class="np nq gp gr nr ns"><a rel="noopener follow" target="_blank" href="/sql-rolling-back-statements-with-transactions-81937811e7a7"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">SQL —了解如何回滚事务中的查询</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">要么执行所有查询，要么一个都不执行</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="pr l od oe of ob og ks ns"/></div></div></a></div></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="cf94" class="nd mh it bd mi ne nf dn mm ng nh dp mq li ni nj ms lm nk nl mu lq nm nn mw no bi translated">查询5:超快速插入</h2><p id="f402" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">上面的插入将一次插入一行。使用下面的选项，我们可以为多行创建一条语句，从而大大提高插入速度。</p><pre class="kj kk kl km gt pc ly pd pe aw pf bi"><span id="c239" class="nd mh it ly b gy pg ph l pi pj">with cnxn.cursor() as cursor:<br/>    cursor.fast_executemany = True<br/>    SQL = "INSERT INTO med.mytable (name, age)  VALUES (?,?)"<br/>    values = [<br/>        ('mr. y', 21),<br/>        ('mr. x', 98)<br/>    ]<br/>    cursor.executemany(SQL, values)</span></pre><p id="8115" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">阅读下面的文章，了解<code class="fe lv lw lx ly b">fast_executemany</code>的内部工作原理。</p><div class="np nq gp gr nr ns"><a rel="noopener follow" target="_blank" href="/dramatically-improve-your-database-inserts-with-a-simple-upgrade-6dfa672f1424"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">通过简单的升级，显著提高数据库插入速度</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">用Python创建速度惊人的数据库连接的4个层次</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="ps l od oe of ob og ks ns"/></div></div></a></div></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="9eac" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">重要的</h1><p id="68c3" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">为了防止SQL注入攻击，一定要清理放入SQL语句中的变量，尤其是在允许用户输入语句的情况下。这一点被<a class="ae ky" href="https://www.explainxkcd.com/wiki/images/5/5f/exploits_of_a_mom.png" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">这部XKCD著名漫画</strong> </a> <strong class="lb iu">诠释得很漂亮。</strong></p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="bb7b" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">后续步骤</h1><p id="742a" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">现在您的脚本可以连接到数据库了，您可以开始编写SQL了。比如你可以用5行代码 做一个<a class="ae ky" href="https://mikehuls.medium.com/create-a-fast-auto-documented-maintainable-and-easy-to-use-python-api-in-5-lines-of-code-with-4e574c00f70e" rel="noopener"> <strong class="lb iu"> API。通过这种方式，您可以为用户提供对数据库的受控访问，定义用户可以请求哪些信息。</strong></a></p><p id="5d12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请务必查看<a class="ae ky" href="https://mikehuls.com/articles?tags=sql" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">此链接</strong> </a>以获得许多有用查询的详细概述。最后，下面的文章详细介绍了如何实现数据库迁移。这使得以编程方式设计和版本控制数据库成为可能。</p><div class="np nq gp gr nr ns"><a rel="noopener follow" target="_blank" href="/python-database-migrations-for-beginners-getting-started-with-alembic-84e4a73a2cca"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">安全地测试并应用对数据库的更改:Alembic入门</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">使用这个简单的Python工具对数据库进行版本控制</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="pt l od oe of ob og ks ns"/></div></div></a></div></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="bf6d" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="9c1d" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">我希望已经阐明了如何用pyodbc连接到您的数据库，并使用它来执行一些SQL。我希望一切都像我希望的那样清楚，但如果不是这样，请让我知道我能做些什么来进一步澄清。与此同时，请查看我的关于各种编程相关主题的其他文章:</p><ul class=""><li id="04be" class="oh oi it lb b lc ld lf lg li oj lm ok lq ol lu om on oo op bi translated"><a class="ae ky" href="https://mikehuls.medium.com/cython-for-absolute-beginners-30x-faster-code-in-two-simple-steps-bbb6c10d06ad" rel="noopener">面向绝对初学者的cy thon——通过简单的两步将代码速度提高30倍</a></li><li id="6bdb" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu om on oo op bi translated"><a class="ae ky" href="https://mikehuls.medium.com/why-is-python-so-slow-and-how-to-speed-it-up-485b5a84154e" rel="noopener">Python为什么这么慢，如何加速</a></li><li id="912b" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu om on oo op bi translated"><a class="ae ky" href="https://mikehuls.medium.com/git-for-absolute-beginners-understanding-git-with-the-help-of-a-video-game-88826054459a" rel="noopener"> Git绝对初学者:借助视频游戏理解Git</a></li><li id="9acd" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu om on oo op bi translated"><a class="ae ky" href="https://mikehuls.medium.com/docker-for-absolute-beginners-what-is-docker-and-how-to-use-it-examples-3d3b11efd830" rel="noopener"> Docker对于绝对初学者——Docker是什么以及如何使用它(+例子)</a></li><li id="422a" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu om on oo op bi translated">绝对初学者的虚拟环境——什么是虚拟环境，如何创建虚拟环境(+示例</li><li id="9bb2" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu om on oo op bi translated"><a class="ae ky" href="https://mikehuls.medium.com/create-and-publish-your-own-python-package-ea45bee41cdc" rel="noopener">创建并发布你自己的Python包</a></li><li id="8a48" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu om on oo op bi translated"><a class="ae ky" href="https://mikehuls.medium.com/create-a-fast-auto-documented-maintainable-and-easy-to-use-python-api-in-5-lines-of-code-with-4e574c00f70e" rel="noopener">用FastAPI用5行代码创建一个快速自动记录、可维护且易于使用的Python API</a></li></ul><p id="8318" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！</p><p id="e1eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">—迈克</p><p id="8c62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">附注:喜欢我正在做的事吗？ <a class="ae ky" href="https://mikehuls.medium.com/membership" rel="noopener"> <em class="ov">跟我来！</em>T11】</a></p><div class="np nq gp gr nr ns"><a href="https://mikehuls.medium.com/membership" rel="noopener follow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">通过我的推荐链接加入Medium—Mike Huls</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">mikehuls.medium.com</p></div></div><div class="ob l"><div class="pu l od oe of ob og ks ns"/></div></div></a></div></div></div>    
</body>
</html>