<html>
<head>
<title>Demo Your Model With Streamlit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Streamlit 演示您的模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/demo-your-model-with-streamlit-a76011467dfb#2022-02-20">https://towardsdatascience.com/demo-your-model-with-streamlit-a76011467dfb#2022-02-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="12c2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何在没有任何后端或前端知识的情况下快速部署您的计算机视觉模型</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9871599f673d2c63e86a77d41b86bf37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-VtCjzjJ3IdodPJ4"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">蒂姆·高在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="a6ab" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">任务</h1><p id="4476" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">假设你需要展示你在开发一个很酷的计算机视觉模型上取得的进展。您正在处理的模型还没有准备好，因此将它部署到适当的开发或生产环境中需要时间和大量的工作。另一方面，开发一个特定的 web 界面来与您的模型进行交互可能是一项单调乏味的任务，并且需要一套对于数据科学家来说并不常见的技能。</p><h1 id="d981" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">营救</h1><p id="e3e7" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><a class="ae kv" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>，是一个开源的 Python 库，它使得创建和共享用于机器学习和数据科学的 web 应用变得容易。在向你的团队展示项目进展、获得并与你的经理分享见解，甚至从客户那里获得反馈时，它会非常有用。</p><p id="6a3b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">它不能取代需要监控、日志记录等的适当的生产部署。然而，它能让你在几个小时内创建“有用的东西”,而不需要任何 web 开发的先验知识，甚至不知道如何使用<a class="ae kv" href="https://flask.palletsprojects.com/en/2.0.x/" rel="noopener ugc nofollow" target="_blank"> flask </a>或<a class="ae kv" href="https://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> Django </a>作为后端。</p><p id="931c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们看看这个魔术是如何运作的。</p><h1 id="e5a4" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">装置</h1><p id="4d59" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">要安装 Streamlit run:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="3d15" class="mu kx iq mq b gy mv mw l mx my">pip install streamlit</span></pre><p id="51f4" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果你使用的是<a class="ae kv" href="https://python-poetry.org/" rel="noopener ugc nofollow" target="_blank">诗歌</a>那么改为运行:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="c522" class="mu kx iq mq b gy mv mw l mx my">poetry add streamlit</span></pre><p id="f740" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">要验证所有的工作是否正常，您可以运行这一行并查看一些解释和演示:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="b7d7" class="mu kx iq mq b gy mv mw l mx my">streamlit hello</span></pre><h1 id="49eb" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">您的第一款应用——上传图片</h1><p id="d6d8" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">让我们从从本地存储加载一个图像并显示它开始:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="2a54" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">要运行该应用程序，只需输入:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="d8dd" class="mu kx iq mq b gy mv mw l mx my">streamlit run image_upload.py</span></pre><p id="7130" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">然后它会在你的浏览器中打开应用程序。它应该是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/c77a5eec6765dd0f584fb006caa9f4ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qqddCLmSQiVbIydLY1jCwQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片上传演示应用，图片作者</p></figure><p id="4dac" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">你可以浏览你的电脑，上传任何你喜欢的图片。我选择上传一些可爱企鹅的图片。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/2c1c7b4d84e38617d12ec857e642c96c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PkW4wJLUEPDrnbBCYz_-ww.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片上传演示应用。作者提供的应用程序图片，<a class="ae kv" href="https://unsplash.com/@mudmanuk?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Paul Carroll </a>在<a class="ae kv" href="https://unsplash.com/s/photos/king-penguin?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上传的照片</p></figure><h1 id="773c" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">部署预先训练的模型</h1><p id="95ea" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">有时，为了有一个好的基线，查看预训练模型如何工作是有用的。现在，您将在一个 Streamlit 应用程序中部署其中一个模型，在本例中为 ResNet18。</p><p id="f659" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">要使用 PyTorch 做到这一点，您需要加载模型并下载 ImageNet 标签:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="947f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为了在图像上运行模型，应该修改您之前使用的 load_image 函数来返回图像。您需要将 image_data 转换为 PIL 图像对象，以便将其输入到模型中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="f0d2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面的代码是对<a class="ae kv" href="https://pytorch.org/hub/pytorch_vision_resnet/" rel="noopener ugc nofollow" target="_blank"> PyTorch ResNet 教程</a>的修改版本，它运行一个模型预测并呈现图像的前 5 个类别:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="2ece" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">当然，这也需要相应地修改主函数:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="3a8a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">首先需要改的是标题。然后，您将加载模型、标签和图像。您还应该添加一个按钮，在加载的图像上触发模型推理。</p><p id="9c49" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这是应用程序在我之前加载的图像上运行时的样子:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/3bb35d742a1a4e193574332c280fe279.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OjKCF-_OuT9rNkZW-W-qNA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">带有示例输出的预训练 ResNet18 模型应用程序。作者提供的应用程序图片，<a class="ae kv" href="https://unsplash.com/@mudmanuk?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">保罗·卡罗尔</a>在<a class="ae kv" href="https://unsplash.com/s/photos/king-penguin?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上传的照片</p></figure><p id="aab3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">该模型以 1.0 的概率将图像分类为“国王企鹅”。其他 4 个顶级类的概率可以忽略不计。</p><p id="256b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这个例子的完整代码在<a class="ae kv" href="https://github.com/asyaf/fun_mini_projects/blob/master/streamlit_examples/resnet_pretrained.py" rel="noopener ugc nofollow" target="_blank"> Github </a>中。</p><h1 id="5e51" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">部署自定义影像分类模型</h1><p id="9dae" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在您已经准备好部署一个定制模型了。您将使用 PyTorch 模型，该模型根据企鹅类型对图像进行分类。创建使用自定义模型的 web 应用程序的过程与涉及预训练模型的过程非常相似，只是有一些修改。代码可以在<a class="ae kv" href="https://github.com/asyaf/fun_mini_projects/blob/master/streamlit_examples/custom_model.py" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h2 id="48fb" class="mu kx iq bd ky ne nf dn lc ng nh dp lg lx ni nj li mb nk nl lk mf nm nn lm no bi translated">关于模型</h2><p id="0176" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">通常，预先训练的模型不足以满足我们的需求，因为手头的任务更加具体，并且不在此类模型的覆盖范围内。例如，ImageNet 有一个“国王企鹅”类，但实际上还有更多企鹅类型。因此，为了根据企鹅类型对图像进行分类，我必须训练自己的模型。我用<a class="ae kv" href="https://github.com/asyaf/fun_mini_projects/blob/master/penguin_classification/transfer_learning_penguin.ipynb" rel="noopener ugc nofollow" target="_blank">这个笔记本</a>进行训练。</p><p id="6019" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果你想了解更多关于这个模型是如何建立的，你可以在我之前的文章中阅读。</p><h2 id="1cac" class="mu kx iq bd ky ne nf dn lc ng nh dp lg lx ni nj li mb nk nl lk mf nm nn lm no bi translated">获取模型</h2><p id="4cd2" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">为模型相关文件创建一个目录:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="5009" class="mu kx iq mq b gy mv mw l mx my">mkdir custom_model</span></pre><p id="53e1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">要直接下载模型文件，您可以使用<a class="ae kv" href="https://drive.google.com/file/d/1yTxSAWNnq4az36-FHGqeR-HBdwDnHRvH/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">链接</a>。将其复制到新目录。</p><p id="0870" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">将此常量定义添加到代码中:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="b617" class="mu kx iq mq b gy mv mw l mx my">MODEL_PATH = 'custom_model/model.pt'</span></pre><h2 id="c2ba" class="mu kx iq bd ky ne nf dn lc ng nh dp lg lx ni nj li mb nk nl lk mf nm nn lm no bi translated">创建标签文件</h2><p id="6987" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">用分类类别的名称创建一个文本文件，每个类别一行。确保课程的顺序与培训中使用的顺序相匹配。</p><p id="4d39" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">例如，要发现 penguin 数据集的顺序，您可以在培训笔记本中查找以下行，并在其后添加一张图片:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="28b5" class="mu kx iq mq b gy mv mw l mx my">class_names = image_datasets['train'].classes</span><span id="02ff" class="mu kx iq mq b gy np mw l mx my">print(class_names)</span></pre><p id="f510" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这将为您提供输出:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="d287" class="mu kx iq mq b gy mv mw l mx my">[‘Adelie Penguin’, ‘Chinstrap Penguin’, ‘Emperor Penguin’, ‘Gentoo Penguin’]</span></pre><p id="95c1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">因此，您应该将以下类名复制到名为 model_classes.txt 的文件中，并将其放在 custom_model 目录中:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="3c56" class="mu kx iq mq b gy mv mw l mx my">Adelie Penguin<br/>Chinstrap Penguin<br/>Emperor Penguin<br/>Gentoo Penguin</span></pre><p id="149a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">将新标签文件作为常量添加到代码中:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="ee52" class="mu kx iq mq b gy mv mw l mx my">LABELS_PATH = 'custom_model/model_classes.txt</span></pre><h2 id="77ce" class="mu kx iq bd ky ne nf dn lc ng nh dp lg lx ni nj li mb nk nl lk mf nm nn lm no bi translated">加载模型和标签</h2><p id="9875" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">模型和标签加载变得更简单，因为它们现在是本地的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><h2 id="b3b3" class="mu kx iq bd ky ne nf dn lc ng nh dp lg lx ni nj li mb nk nl lk mf nm nn lm no bi translated">更多的修复</h2><p id="5405" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">与具有许多标签的 ResNet18 不同，该定制模型只有 4 个标签。因此，您应该修改预测代码以输出所有现有类的概率:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="d811" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">更改主函数，使应用程序具有不同的标题，并传递模型和标签的本地路径:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="961b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">最后，应用程序应该是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/377235a7be4941564967ca427462b1de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ClS2mtQ5Wj6gOkD5JRdkig.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">自定义影像分类模型结果。作者上传的应用程序图片和照片</p></figure><p id="c5e1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为了测试这款应用，我上传了一张巴布亚企鹅的图片。该模型以 0.91 的概率将该图像分类为巴布亚企鹅的图像。其他企鹅类型的概率要低得多。随着应用程序运行良好的确认，我得到了模型正确性的另一个证明。很可爱，对吧？</p><h1 id="70b2" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">结论</h1><p id="3c19" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">开发一个运行良好的计算机视觉模型需要花费大量的时间和精力。在这个过程中，您可能需要部署您的模型，并向您的经理、队友和客户展示它的能力。Streamlit 是一个强大且易于使用的工具，即使您没有适当的内部工具或前端知识，也可以让您实现这一目标。</p><p id="8d6d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我展示了 Streamlit 在图像分类中的潜在用途。然而，它可以用于其他类型的计算机视觉任务，以及可视化，数据分析等等。我鼓励你浏览一下<a class="ae kv" href="https://streamlit.io/gallery" rel="noopener ugc nofollow" target="_blank"> Streamlit 网站</a>上的例子，亲自试用一下这个工具，看看它是如何融入你的日常工作的。</p></div></div>    
</body>
</html>