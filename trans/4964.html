<html>
<head>
<title>Great Expectations: Automated Testing for Data Science and Engineering Teams</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">远大前程:数据科学和工程团队的自动化测试</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/great-expectations-automated-testing-for-data-science-and-engineering-teams-1e7c78f1d2d5#2022-11-04">https://towardsdatascience.com/great-expectations-automated-testing-for-data-science-and-engineering-teams-1e7c78f1d2d5#2022-11-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5f7e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">验证、描述和记录您的数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/62476ae03c1c72c5e279bed542b82fa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QVrEXWCD_fRyPpBY.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">约翰尼斯·安德森在<a class="ae ky" href="https://unsplash.com/s/photos/master?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="3e3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我曾经在一家零售分析公司工作，我们提供分析解决方案来帮助零售商改善他们的业务，如库存和分配优化、需求预测和动态定价。</p><p id="2131" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">典型的工作流程始于客户的日常反馈，即用作我们解决方案输入的原始数据。在一系列数据清理、操作、分析和建模步骤之后，结果被创建并发送给客户。</p><p id="9633" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此类流程中的一个主要挑战是来自客户的数据的验证。如果它包含一些意想不到的或荒谬的值，结果将是无用的。事实上，它们可能弊大于利。</p><p id="84f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果在结果步骤中检测到这些问题，影响只会加速。您可能需要重新运行管道，这意味着额外的成本和时间的浪费。更糟糕的情况是将结果发送给客户，然后客户在他们的操作中使用它们。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a362" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">解决方案</h1><p id="1b5f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">幸运的是，我们有很多工具来防止这样的灾难发生。<a class="ae ky" href="https://greatexpectations.io/" rel="noopener ugc nofollow" target="_blank">远大前程</a>就是其中之一。这是一个Python库，用于验证、记录和分析您的数据，以保持质量并改善团队之间的交流。</p><p id="7a6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">高期望值允许断言您对数据的期望，这有助于在早期阶段快速发现数据问题。</p><p id="52d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该库的主要组件是expect，它是一个可以由计算机评估的声明性语句。期望基本上是对你的数据的单元测试。</p><p id="9366" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">期望被赋予直观的名称，清楚地告诉我们它们是关于什么的。这里有一个例子:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="28c3" class="ne md it na b gy nf ng l nh ni">expect_column_values_to_be_between(<br/>    column="price", min_value=1, max_value=10000<br/>)</span></pre><p id="5eca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个期望的作用是检查列中的值是否在指定的最小值和最大值之间。</p><p id="112f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">核心库中定义了很多期望。然而，我们不仅限于或依赖于这些。</p><p id="2dc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">远大前程图书馆有更多来自社区的期望。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f91b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如何使用它</h1><p id="6aa4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们可以通过pip安装它，如下所示:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="69cd" class="ne md it na b gy nf ng l nh ni">pip install great_expectations</span></pre><p id="eef5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以导入它:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="f97b" class="ne md it na b gy nf ng l nh ni">import great_expectations as ge</span></pre><p id="fe96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用我用模拟数据准备的销售数据集来做一些例子。你可以从我的GitHub页面上的<a class="ae ky" href="https://github.com/SonerYldrm/datasets" rel="noopener ugc nofollow" target="_blank">数据集</a>库中下载。叫做“销售_数据_与_商店”。</p><p id="b4cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使用期望，我们需要一个巨大的期望数据集。我们有两种不同的方法来创建它:</p><ul class=""><li id="db8b" class="nj nk it lb b lc ld lf lg li nl lm nm lq nn lu no np nq nr bi translated">使用from_pandas函数从Pandas数据帧中</li><li id="8576" class="nj nk it lb b lc ns lf nt li nu lm nv lq nw lu no np nq nr bi translated">使用远大前程的read_csv函数从CSV文件中</li></ul><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="04c9" class="ne md it na b gy nf ng l nh ni">import great_expectations as ge</span><span id="4562" class="ne md it na b gy nx ng l nh ni">df = ge.read_csv("datasets/sales_data_with_stores.csv")</span><span id="6e2e" class="ne md it na b gy nx ng l nh ni">type(df)<br/>great_expectations.dataset.pandas_dataset.PandasDataset</span><span id="91bd" class="ne md it na b gy nx ng l nh ni">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/e9cf715017cce8703fd7cb2f22f58f84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RshtJbqpVSsUu7weT7rxHg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df的前5行(图片由作者提供)</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="58b7" class="ne md it bd me nz oa dn mi ob oc dp mm li od oe mo lm of og mq lq oh oi ms oj bi translated">期望1</h2><p id="d23f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了捕捉具有不同值的列中的意外值，我们可以使用expect _ column _ distinct _ values _ to _ be _ in _ set期望。它检查列中的所有值是否都在给定的集合中。</p><p id="57f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们在商店列上使用它。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="4c68" class="ne md it na b gy nf ng l nh ni">df.expect_column_distinct_values_to_be_in_set(<br/>    "store",<br/>    ["Violet", "Rose"]    <br/>)</span><span id="8182" class="ne md it na b gy nx ng l nh ni"><strong class="na iu"># output</strong><br/>{<br/>  "result": {<br/>    "observed_value": [<br/>      "Daisy",<br/>      "Rose",<br/>      "Violet"<br/>    ],<br/>    "element_count": 1000,<br/>    "missing_count": null,<br/>    "missing_percent": null<br/>  },<br/>  "exception_info": {<br/>    "raised_exception": false,<br/>    "exception_traceback": null,<br/>    "exception_message": null<br/>  },<br/>  "meta": {},<br/>  "success": false<br/>}</span></pre><p id="e399" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">预期失败(即success: false ),因为store列中有一个值(Daisy)不在给定的列表中。</p><p id="750e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了指示成功和失败之外，期望值的输出还包含一些其他信息，例如观察值、值的数量以及列中缺少的值。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="8055" class="ne md it bd me nz oa dn mi ob oc dp mm li od oe mo lm of og mq lq oh oi ms oj bi translated">期望2</h2><p id="c62d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们可以检查列的最大值是否在特定范围内:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="25cb" class="ne md it na b gy nf ng l nh ni">df.expect_column_max_to_be_between(<br/>    "price",<br/>    min_value=0.1,<br/>    max_value=2000<br/>)</span><span id="d316" class="ne md it na b gy nx ng l nh ni"><strong class="na iu"># output</strong><br/>{<br/>  "result": {<br/>    "observed_value": 1500.05,<br/>    "element_count": 1000,<br/>    "missing_count": null,<br/>    "missing_percent": null<br/>  },<br/>  "exception_info": {<br/>    "raised_exception": false,<br/>    "exception_traceback": null,<br/>    "exception_message": null<br/>  },<br/>  "meta": {},<br/>  "success": true<br/>}</span></pre><p id="5619" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出是字典格式的，所以我们可以很容易地使用它的特定部分，并在我们的管道中使用它。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="2575" class="ne md it na b gy nf ng l nh ni">max_check = df.expect_column_max_to_be_between(<br/>    "price",<br/>    min_value=0.1,<br/>    max_value=2000<br/>)</span><span id="55ac" class="ne md it na b gy nx ng l nh ni">max_check["success"]</span><span id="18d5" class="ne md it na b gy nx ng l nh ni"><strong class="na iu"># output</strong><br/>True</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="3e4d" class="ne md it bd me nz oa dn mi ob oc dp mm li od oe mo lm of og mq lq oh oi ms oj bi translated">期望3</h2><p id="24d4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">值的唯一性对于某些功能(如id列)非常重要。我们可以检查一列中的所有值是否都是唯一的。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="7b10" class="ne md it na b gy nf ng l nh ni"># for a single column<br/>df.expect_column_values_to_be_unique("product_code")</span><span id="835c" class="ne md it na b gy nx ng l nh ni"># for multiple columns<br/>df.expect_compound_columns_to_be_unique(<br/>    column_list=["product_code","product_group"]<br/>)</span></pre><p id="8057" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些期望值的输出很长，所以我没有在这里展示，但是它们包含了有价值的见解，比如意外值的数量和部分意外值列表。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="3227" class="ne md it bd me nz oa dn mi ob oc dp mm li od oe mo lm of og mq lq oh oi ms oj bi translated">期望4</h2><p id="1798" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">一个简单而有用的期望是检查数据集中是否存在特定的列。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="0aa2" class="ne md it na b gy nf ng l nh ni">df.expect_column_to_exist("cost")</span><span id="0879" class="ne md it na b gy nx ng l nh ni"><strong class="na iu"># output</strong><br/>{<br/>  "result": {},<br/>  "exception_info": {<br/>    "raised_exception": false,<br/>    "exception_traceback": null,<br/>    "exception_message": null<br/>  },<br/>  "meta": {},<br/>  "success": true<br/>}</span></pre><p id="b587" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您希望确保每日数据馈送包含所有必要的列时，这很方便。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="8a25" class="ne md it bd me nz oa dn mi ob oc dp mm li od oe mo lm of og mq lq oh oi ms oj bi translated">结论</h2><p id="cef5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们只做了3个例子，但是目前库中有<a class="ae ky" href="https://greatexpectations.io/expectations/" rel="noopener ugc nofollow" target="_blank"> 297个期望</a>，并且这个数字还在增加。</p><p id="2cfe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我非常喜欢这些期望的一点是它们的名字是不言自明的，因此很容易理解它们的作用。</p><p id="f15e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能会争辩说，这些期望可以使用纯Python代码或其他一些包来检查。你是对的，但是使用远大前程库有一些好处:</p><ul class=""><li id="6877" class="nj nk it lb b lc ld lf lg li nl lm nm lq nn lu no np nq nr bi translated">易于实施</li><li id="9701" class="nj nk it lb b lc ns lf nt li nu lm nv lq nw lu no np nq nr bi translated">拥有标准且高度直观的语法</li><li id="46db" class="nj nk it lb b lc ns lf nt li nu lm nv lq nw lu no np nq nr bi translated">有些期望不是很简单，如果你喜欢自己做，需要写很多行代码</li><li id="2266" class="nj nk it lb b lc ns lf nt li nu lm nv lq nw lu no np nq nr bi translated">最后但同样重要的是,《远大前程》还根据这些期望创建了数据文档和数据质量报告。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="35a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ok">你可以成为</em> <a class="ae ky" href="https://sonery.medium.com/membership" rel="noopener"> <em class="ok">媒介会员</em> </a> <em class="ok">解锁我的全部写作权限，外加其余媒介。如果你已经是了，别忘了订阅<em class="ok"/><em class="ok">如果你想在我发表新文章时收到电子邮件。</em></em></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="a42c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>