<html>
<head>
<title>Three ways to parse arguments in your Python code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解析Python代码中参数的三种方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/three-ways-to-parse-arguments-in-your-python-code-aba092e8ad73#2022-06-29">https://towardsdatascience.com/three-ways-to-parse-arguments-in-your-python-code-aba092e8ad73#2022-06-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ddb6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过使用Python中的命令行和配置文件来提高代码的效率</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0c80a90f9563c8de1618e33478c30ca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ILIg9g8dHxC_oLuv"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">里卡多·安南达尔在<a class="ae ky" href="https://unsplash.com/photos/7e2pe9wjL9M" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="a1a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你在机器学习和深度学习模型方面做了很多工作，你可能会在Jupyter笔记本或python脚本上尝试改变超参数一百万次，以提高数据集的性能。如果每次编辑时都要检查代码，这可能会很耗时。</p><p id="8781" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在从事数据科学项目时，我发现了不同的方法来加速这种持续的变化。第一个选项是使用<code class="fe lv lw lx ly b">argparse</code>，这是一个流行的Python模块，专门用于命令行解析。另一种方法是读取JSON文件，在那里可以放置所有的超参数。第三种也是不太为人所知的方法是使用YAML文件！你好奇吗？开始教程吧！</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="0248" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">先决条件</h1><p id="1bc1" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在本教程中，我将使用Visual Studio代码，这是一个非常高效的Python集成开发环境。这个程序的美妙之处在于，它通过安装扩展支持每一种编程语言，集成了终端，并允许同时处理大量的python脚本和Jupyter笔记本。如果您从未使用过它，请查看本指南<a class="ae ky" href="https://code.visualstudio.com/docs/languages/python" rel="noopener ugc nofollow" target="_blank">这里的</a>开始使用</p><p id="26bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了展示这些命令行策略的效率，<strong class="lb iu">自行车共享数据集</strong> [1]正被用于根据温度、风速和湿度等特征来预测每小时租赁自行车的数量。这个数据集可以在<a class="ae ky" href="https://archive.ics.uci.edu/ml/datasets/bike+sharing+dataset" rel="noopener ugc nofollow" target="_blank"> UCI的机器学习库</a>和<a class="ae ky" href="https://www.kaggle.com/datasets/lakshmi25npathi/bike-sharing-dataset" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上找到。</p><p id="62b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目录:</p><ol class=""><li id="4caf" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated"><strong class="lb iu">使用argparse </strong></li><li id="e593" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated"><strong class="lb iu">使用JSON文件</strong></li><li id="533a" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated"><strong class="lb iu">使用YAML文件</strong></li></ol></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="2647" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">1.使用argparse</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi gj"><img src="../Images/d4cfec53e7b708ceb9e9b9af6864b927.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vv72d_PISVf2exnhtPiUNQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用argparse的项目结构。作者插图</p></figure><p id="df75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的迷你项目中，我们有一个标准的结构来组织我们的工作:</p><ul class=""><li id="2eae" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu nr nj nk nl bi translated">名为<code class="fe lv lw lx ly b">data</code>的文件夹包含我们的数据集</li><li id="1b9e" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu nr nj nk nl bi translated"><code class="fe lv lw lx ly b">train.py</code>文件</li><li id="d3d9" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu nr nj nk nl bi translated">用于指定超参数的<code class="fe lv lw lx ly b">options.py</code>文件</li></ul><p id="4957" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们可以创建一个文件<code class="fe lv lw lx ly b">train.py</code>，其中包含导入数据、根据训练数据训练模型以及在测试集上评估模型的基本过程:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="ff34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在代码中，我们还导入了train_options函数，它包含在<code class="fe lv lw lx ly b">options.py</code>文件中。后一个文件是一个python文件，从中我们可以更改train.py中考虑的超参数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="71b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个例子中，我们使用了<code class="fe lv lw lx ly b">argparse</code>库，这是一个非常流行的解析命令行参数的库。首先，我们初始化解析器，然后，我们可以添加我们想要访问的参数。</p><p id="c9d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个运行代码的示例:</p><pre class="kj kk kl km gt nu ly nv nw aw nx bi"><span id="7f35" class="ny mh it ly b gy nz oa l ob oc">python train.py</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/c8f93d579f98f696df135c72bba508ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IDlfFqMB_x5zsoxrULtpkA.png"/></div></div></figure><p id="a938" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要更改超参数的默认值，有两种方法。第一个选项是在<code class="fe lv lw lx ly b">options.py</code>文件中设置不同的默认值。另一种方法是从命令行传递超参数值:</p><pre class="kj kk kl km gt nu ly nv nw aw nx bi"><span id="ef79" class="ny mh it ly b gy nz oa l ob oc">python train.py --n_estimators 200</span></pre><p id="102a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要指定想要更改的超参数的名称以及相应的值。</p><pre class="kj kk kl km gt nu ly nv nw aw nx bi"><span id="b28d" class="ny mh it ly b gy nz oa l ob oc">python train.py --n_estimators 200 --max_depth 7</span></pre><h1 id="bd15" class="mg mh it bd mi mj oe ml mm mn of mp mq jz og ka ms kc oh kd mu kf oi kg mw mx bi translated">2.使用JSON文件</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/90abee32ac68944824a2924783373418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*R69Wsg1Gh7YWrKdiDtfqvQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用JSON文件的项目结构。作者插图</p></figure><p id="ff74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像以前一样，我们可以维护一个类似的文件结构。在本例中，我们用一个<strong class="lb iu"> JSON </strong>文件替换了<code class="fe lv lw lx ly b">options.py</code>文件。换句话说，我们希望在JSON文件中指定超参数的值，并将它们传递给<code class="fe lv lw lx ly b">train.py</code>文件。与argparse库相比，<strong class="lb iu"> JSON </strong>文件可能是一个快速而直观的替代方案。它利用键值对来存储数据。下面，我们创建了一个<code class="fe lv lw lx ly b">options.json</code>文件，其中包含了我们稍后需要传递给其他代码的数据。</p><pre class="kj kk kl km gt nu ly nv nw aw nx bi"><span id="0eb9" class="ny mh it ly b gy nz oa l ob oc">{<br/>"normalize":true,<br/>"n_estimators":100,<br/>"max_features":6,<br/>"max_depth":5 <br/>}</span></pre><p id="e2e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，它非常类似于python字典。与字典不同，它包含文本/字符串格式的数据。此外，还有一些语法略有不同的常见数据类型。比如一个布尔值是<strong class="lb iu">假</strong> / <strong class="lb iu">真</strong>，而python识别的是<strong class="lb iu">假</strong> / <strong class="lb iu">真</strong>。JSON中其他可能的值是数组，用方括号表示为python列表。如果您想深入理解JSON文件所要求的语法，请在这里查看其他案例<a class="ae ky" href="https://www.w3schools.com/js/js_json_intro.asp" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="5693" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在python中使用JSON数据的好处在于，它可以通过<code class="fe lv lw lx ly b">load</code>方法转换成python字典:</p><pre class="kj kk kl km gt nu ly nv nw aw nx bi"><span id="d704" class="ny mh it ly b gy nz oa l ob oc">f = open("options.json", "rb")<br/>parameters = json.load(f)</span></pre><p id="89b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要访问一个特定的项目，我们只需要引用它在方括号中的键名:</p><pre class="kj kk kl km gt nu ly nv nw aw nx bi"><span id="418b" class="ny mh it ly b gy nz oa l ob oc">if parameters["normalize"] == True:<br/>    scaler = StandardScaler()<br/>    X = scaler.fit_transform(X)</span><span id="8edf" class="ny mh it ly b gy ok oa l ob oc">rf=RandomForestRegressor(n_estimators=parameters["n_estimators"],max_features=parameters["max_features"],max_depth=parameters["max_depth"],random_state=42)<br/>model = rf.fit(X_train,y_train)<br/>y_pred = model.predict(X_test)</span></pre><h1 id="e315" class="mg mh it bd mi mj oe ml mm mn of mp mq jz og ka ms kc oh kd mu kf oi kg mw mx bi translated">3.使用YAML文件</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/b247a8fcd2963c6f34109ca411195343.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xtNbLa33JqrrJeXaKBwNAw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用YAML文件的项目结构。作者插图</p></figure><p id="d4f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一个选择是挖掘YAML的潜力。像JSON文件一样，我们将python代码中的YAML文件作为字典来读取，以访问超参数的值。YAML是一种人类可读的数据表示语言，其中层次结构用双空格字符表示，而不是像JSON文件中那样用括号表示。下面我们展示了<code class="fe lv lw lx ly b">options.yaml</code>文件将包含的内容:</p><pre class="kj kk kl km gt nu ly nv nw aw nx bi"><span id="6cd8" class="ny mh it ly b gy nz oa l ob oc">normalize: True <br/>n_estimators: 100<br/>max_features: 6<br/>max_depth: 5</span></pre><p id="895f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lv lw lx ly b">train.py</code>中，我们打开<code class="fe lv lw lx ly b">options.yaml</code>文件，该文件将始终使用<code class="fe lv lw lx ly b">load</code>方法转换成Python字典，这次是从yaml库导入的:</p><pre class="kj kk kl km gt nu ly nv nw aw nx bi"><span id="b9d4" class="ny mh it ly b gy nz oa l ob oc">import yaml<br/>f = open('options.yaml','rb')<br/>parameters = yaml.load(f, Loader=yaml.FullLoader)</span></pre><p id="5923" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和以前一样，我们可以使用字典所需的语法来访问超参数的值。</p><h1 id="4770" class="mg mh it bd mi mj oe ml mm mn of mp mq jz og ka ms kc oh kd mu kf oi kg mw mx bi translated">最后的想法</h1><p id="b44e" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">如果你在这里，你终于到了文章的结尾。恭喜你！本文的目标是展示三种优雅而有效的方法来解析python代码中的参数。</p><ul class=""><li id="e5ce" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu nr nj nk nl bi translated">配置文件编译起来非常快，而argparse需要为每个想要添加的参数编写一行代码。</li><li id="c363" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu nr nj nk nl bi translated">根据您的目的，这些方法中的一种可能是您的正确选择。</li><li id="8e70" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu nr nj nk nl bi translated">例如，如果您需要为参数添加注释，JSON并不合适，因为它不允许注释，而YAML和argparse可能是一个很好的选择。</li></ul><p id="34ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。祝您愉快！</p><h2 id="52ff" class="ny mh it bd mi om on dn mm oo op dp mq li oq or ms lm os ot mu lq ou ov mw ow bi translated">参考资料:</h2><p id="9aa1" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">[1]https://www.capitalbikeshare.com/data-license-agreement<a class="ae ky" href="https://www.capitalbikeshare.com/data-license-agreement" rel="noopener ugc nofollow" target="_blank"/></p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="d592" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你喜欢我的文章吗？<a class="ae ky" href="https://eugenia-anello.medium.com/membership" rel="noopener"> <em class="ox">成为会员</em> </a> <em class="ox">每天无限获取数据科学新帖！这是一种间接的支持我的方式，不会给你带来任何额外的费用。如果您已经是会员，</em> <a class="ae ky" href="https://eugenia-anello.medium.com/subscribe" rel="noopener"> <em class="ox">订阅</em> </a> <em class="ox">每当我发布新的数据科学和python指南时，您都会收到电子邮件！</em></p></div></div>    
</body>
</html>