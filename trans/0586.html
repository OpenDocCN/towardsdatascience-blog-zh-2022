<html>
<head>
<title>How to Use Python to Obtain the Temperature of Any Place on Earth</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Python 获取地球上任何地方的温度</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-use-python-to-obtain-the-temperature-of-any-place-on-earth-b92aae44b831#2022-02-23">https://towardsdatascience.com/how-to-use-python-to-obtain-the-temperature-of-any-place-on-earth-b92aae44b831#2022-02-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9976" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">解释使用 Python 中的 shapefiles 裁剪网格化 NetCDF 数据的过程的教程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1469bf9ac8a88095d227844718d069f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N13M5JelclGhmTNaurfNMQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">美国宇航局在<a class="ae ky" href="https://unsplash.com/s/photos/earth?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="5c75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di">答</span>假设您对 NetCDF 数据格式有基本的了解(如果没有，您可以在这里查看我关于 NetCDF 的介绍文章<a class="ae ky" rel="noopener" target="_blank" href="/what-is-netcdf-data-and-why-is-it-interesting-ec26bcece19d"/>)，在这篇文章中，我将展示计算和可视化地区温度的不同方法。为此，我们将使用 shapefile。<a class="ae ky" href="https://en.wikipedia.org/wiki/Shapefile" rel="noopener ugc nofollow" target="_blank"> Shapefile </a>是一种数据格式，利用点、线和多边形等矢量特征来表示地球上的不同区域(如国家、城市、湖泊等)。</p><h1 id="2a66" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">等高线和等高线</h1><p id="0d06" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">我用的是哥白尼免费下载的 NetCDF 数据(这个<a class="ae ky" href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels?tab=form" rel="noopener ugc nofollow" target="_blank">链接</a>上的‘2m 温度’)。<a class="ae ky" href="https://en.wikipedia.org/wiki/Copernicus_Programme" rel="noopener ugc nofollow" target="_blank">哥白尼</a>是一个由欧盟及其机构管理的地球监测项目。他们提供了一个名为<a class="ae ky" href="https://cds.climate.copernicus.eu/#!/home" rel="noopener ugc nofollow" target="_blank">气候数据存储</a>的 API 来下载与任何气候变量相关的任何数据。</p><p id="975c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用 NetCDF 数据，我们可以简单地绘制如下所示的等值线图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/213d58da14e26351ffdf7a2837dc0264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*yBCvsB26oqhEvdC8YEU9Kg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">等高线图(作者 GIF)</p></figure><p id="b126" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我用所有 12 个月的等高线图制作了这张 GIF 图，并固定了彩条的范围。我们可以计算每个国家的平均温度，然后将其可视化为<a class="ae ky" href="https://en.wikipedia.org/wiki/Choropleth_map#:~:text=A%20choropleth%20map%20(from%20Greek,each%20area%2C%20such%20as%20population" rel="noopener ugc nofollow" target="_blank"> choropleth </a>地图，而不是将其可视化为等高线。</p><p id="0ec9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">choropleth 地图可视化如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/0558f3e9701825faa5b023f453ec47af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Vbfk_GwdGTdJjBOEK8Jt6w.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Choropleth 地图(GIF 由作者提供)</p></figure><p id="35a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这两种情况下，较冷的地方和较热的地方可以用蓝色和红色清楚地区分。choropleth 地图使用整个国家的平均值，因此，其表示与等值线地图略有不同。不同地图的使用取决于不同的用例。</p><p id="98ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用 NetCDF 数据和 shapefiles 导出 choropleth 图的想法很有趣，因为它可以在任何级别和任何分辨率下完成。例如，我们可以制作一张地图来比较不同的国家，一个国家中不同的州，甚至是不同的城市。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/2a9069030d3e7b8caeaf507ef70e132a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-KUVpdO5_Xux1M5rNRYfJg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Shapefile 上的网格点(作者提供照片)</p></figure><p id="11e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上图显示了放置在一个地区(美国及其邻国)的一堆网格点。为了计算平均温度，我们收集了位于美国境内的所有点(例如),然后简单地取所有点的平均值。</p><p id="4fbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下 python 库用于此目的:</p><ol class=""><li id="3cdf" class="ne nf it lb b lc ld lf lg li ng lm nh lq ni lu nj nk nl nm bi translated">Xarray —读取和操作 NetCDF 文件。</li><li id="c151" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">Geopandas 读取 shapefiles</li><li id="a90c" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">Rioxarray 和 Shapely 裁剪/收集多边形内部的网格点。</li><li id="c76c" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">底图，Plotly 进行可视化。</li></ol><p id="88a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使这一切成为可能的关键是 NetCDF 数据中温度值的插值。</p><h1 id="9f0e" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">插入文字</h1><p id="59b9" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">这也称为空间或地理空间插值。插值是使用采样值估计未采样区域的值的过程。</p><p id="c251" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">NetCDF 数据在纬度和经度之间等间距网格化。我用来绘制等高线图的数据在网格的两个方向上的分辨率都是 0.25。一度大约是 100 公里，所以我们可以说我们的分辨率是 25 公里。换句话说，我们在 X 和 Y 方向上每隔 25 公里有一个温度值。</p><p id="62b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们有一个足够大的区域，我们会看到一个或多个温度值位于该区域的边界内。在我使用的 NetCDF 数据的情况下，我们希望该区域大于 25 km，至少在一个轴上，在该区域内有一个温度值。</p><p id="5471" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果该地区是一个大国，如印度、美国、中国等，这就简单了。如果国家很小，比如梵蒂冈、摩纳哥和太平洋岛屿，那就很棘手了。在绘制等高线图时，我不得不忽略一些较小的国家，因为不可能计算这些国家的平均温度。</p><p id="ef08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用插值，我们可以改变这个分辨率(增加或减少)。一种流行的方法是使用线性插值。Xarray 有一个叫做<code class="fe ns nt nu nv b">.interp_like()</code>的方法，使得插值更容易。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="202b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，我使用线性插值技术将 NetCDF 数据的分辨率从 0.25 转换为 0.05。与示例不同，您还可以使用全边界(纬度为-90 至 90，经度为-180 至 180)对整个数据集进行插值。</p><h1 id="649b" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">在 shapefile 上剪辑</h1><p id="e542" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">为了裁剪或收集国家边界内的网格点，我们可以使用下面的代码。</p><p id="9e95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">世界行政边界形状文件可以在这里<a class="ae ky" href="https://public.opendatasoft.com/explore/dataset/world-administrative-boundaries/export/" rel="noopener ugc nofollow" target="_blank">下载。</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="d5c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ns nt nu nv b">t2m.rio.clip(data.geometry.apply(mapping), data.crs)</code>是我们裁剪网格点的代码部分。代码的扩展只是对所有温度值进行平均。如此复杂的过程只用几行代码就完成了。</p><p id="39e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每当国家边界对于网格来说太短时，就会出现错误。这些国家将被添加到列表中，并从 shapefile 数据框中移除。它们不会被用于可视化。如果您想包含所有内容，那么您可以使用更高的分辨率，例如 0.01(网格点相距 1 km)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/3b727324d557f3221e57c296df5dce91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BmlDILq0Qz54F8K91_s6Ew.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示每月平均国家温度的数据框(df_temp)</p></figure><h1 id="e889" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">等值区域图</h1><p id="b021" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">由于我们有每个国家 12 个月的温度值，我们可以创建 12 个 choropleth 图，并轻松地将它们组合成 GIF。</p><p id="a2e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要将形状文件和温度数据框合并成一个。然后，我们创建一个循环并保存所有 12 个 choropleth 图像，这些图像稍后将用于制作 GIF。</p><p id="08da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是创建 choropleth 地图和 GIF 的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="db7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ns nt nu nv b">geo</code>数据帧是这样的。我只保留了必要的列，并从 shapefile 中删除了其余的列。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/5c14907c2de81a8bff40ce9bb4f6a35d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TKC0kDU3_kAuB8kSADUJHw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">追加和熔化 DFs 后的数据帧(geo)</p></figure><p id="cb7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用相同的代码，这是我为法国制作的 choropleth 地图 GIF:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/bec447e6fc12f88df11d5aa363daee89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*J8xWF5OJK3P0c94G5uKsng.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">法国 Choropleth 地图(作者 GIF)</p></figure><p id="0cd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很酷，不是吗？</p><h1 id="de73" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">结论</h1><p id="da06" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">NetCDF 数据足够强大，可以处理气候数据科学，并生成一些看起来很酷的 choropleth 图或等高线图。这个想法也可以扩展到其他气候变量。地图和用例会根据您考虑的变量而变化。</p></div><div class="ab cl oa ob hx oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="im in io ip iq"><p id="41f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读，干杯！</p><pre class="kj kk kl km gt oh nv oi oj aw ok bi"><span id="e333" class="ol mf it nv b gy om on l oo op"><strong class="nv iu">Want to Connect? </strong></span><span id="935f" class="ol mf it nv b gy oq on l oo op">You can reach me on <a class="ae ky" href="https://www.linkedin.com/in/rohithteja/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>, <a class="ae ky" href="https://twitter.com/rohithtejam" rel="noopener ugc nofollow" target="_blank">Twitter</a>, <a class="ae ky" href="https://github.com/rohithteja" rel="noopener ugc nofollow" target="_blank">GitHub</a> or my <a class="ae ky" href="https://rohithteja.github.io/" rel="noopener ugc nofollow" target="_blank">Website</a>.</span></pre></div></div>    
</body>
</html>