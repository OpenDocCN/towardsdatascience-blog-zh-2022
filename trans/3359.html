<html>
<head>
<title>Detect Anomalies in Telemetry Data using Principal Component Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用主成分分析检测遥测数据中的异常</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/detect-anomalies-in-telemetry-data-using-principal-component-analysis-98d6dc4bf843#2022-07-26">https://towardsdatascience.com/detect-anomalies-in-telemetry-data-using-principal-component-analysis-98d6dc4bf843#2022-07-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/834dc39ae7a489b54786991c3cea950b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lT7tiufyDngv7GZi"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">鲁珀特·布里顿在<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><div class=""/><div class=""><h2 id="bf02" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">使用简单的方法主动识别遥测数据中的问题</h2></div><p id="4772" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">异常检测在许多领域都扮演着重要角色，尤其是在金融和医疗保健领域。主动识别金融交易中的异常有助于避免巨额损失。同样，在医疗保健中，它有助于在诊断早期识别健康风险。这篇博客主要关注使用主成分分析(PCA)的异常检测(AD)的简单形式。我们将把该算法应用到一个众所周知的领域——应用遥测。我们将学习在更高的环境中识别罕见事件。这篇文章的要点是:</p><ul class=""><li id="8d54" class="lr ls jg kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">理解使用PCA的异常检测。</li><li id="c23c" class="lr ls jg kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">基于PCA的AD在云应用中的应用。</li><li id="8281" class="lr ls jg kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">寻找异常的示例设计和代码。</li></ul><p id="fdef" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在文章的最后，我们还学习了一些高级的异常检测方法。让我们开始吧。</p><h1 id="6989" class="mf mg jg bd mh mi mj mk ml mm mn mo mp km mq kn mr kp ms kq mt ks mu kt mv mw bi translated">什么是异常？</h1><p id="730c" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">异常是指不规则的、意外的、罕见的数据，这些数据在很大程度上偏离了数据集中的其余记录。例如，如果有一个应用程序被100个用户访问，假设用户发出的每个唯一请求都会创建一个事件，该事件会向下游发送更多消息，从而消耗资源。在这种情况下，如果您注意到在很短的时间间隔内来自一个用户的数百万个请求，它可以被标记为罕见事件中最罕见的一个，一个异常。如果我是一名网站可靠性工程师，我希望有一个自动化系统，能够<strong class="kx jh">检测-警告并阻止</strong>此类事件不必要地消耗更多资源并导致其他地方的服务降级。理解异常并不总是坏事是至关重要的，某些罕见的事件，如采购订单的突然增加，对业务是有益的。没有适当的业务上下文，很难将数据项定性为异常。尽管如此，在管道的早期识别和检测它们通常是重要的。</p><h1 id="bfb3" class="mf mg jg bd mh mi mj mk ml mm mn mo mp km mq kn mr kp ms kq mt ks mu kt mv mw bi translated">用于异常检测的PCA。</h1><p id="8881" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">主成分分析主要是一种降维技术。它通过识别主要成分来工作。主成分是独立的特征向量，也称为给定数据的特征向量，其解释了数据中的最大方差。每个PC是现有相关特征的线性组合，并且与其他特征向量正交。使用主成分分析可以在不损失信息价值的情况下减少特征向量的数量。让我们看看如何为IRIS数据集找到PC。</p><figure class="nc nd ne nf gt is"><div class="bz fp l di"><div class="ng nh l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">识别虹膜数据集的主成分</p></figure><p id="b575" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上面这段代码将一个数组输出为array([0.92461872，0.05306648，0.01710261，0.00521218])。这意味着92%的数据可以用第一个PC来解释，97% (92%+5%)的数据可以用第一个和第二个主成分来解释。因此，通过将特征维度从4个减少到2个，我仍然可以解释97%的数据。这里的降维称为主分量。</p><p id="0cba" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">异常检测依赖于重建误差。一旦PC被识别，通过选择所有的主成分，我们可以在没有数据丢失的情况下从变换的数据重建原始数据。类似地，通过只选择解释大部分方差的PC，我们应该能够重建原始数据的近似值。生成原始数据时在重建期间产生的误差称为重建误差。对于数据中的异常，重建误差为<strong class="kx jh">高</strong>。</p><h1 id="f6b2" class="mf mg jg bd mh mi mj mk ml mm mn mo mp km mq kn mr kp ms kq mt ks mu kt mv mw bi translated">遥测数据中的异常检测。</h1><p id="7bbc" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">Azure允许您为云基础架构配置诊断，使用它我们可以详细捕获资源使用情况。除了资源使用情况，我们还可以将应用程序使用情况记录到一个名为Log Analytics的公共数据存储中。日志分析中的数据代表用户如何使用应用程序和基础架构。在下面的步骤中，我建议使用以下机制来使用日志分析数据识别异常。</p><figure class="nc nd ne nf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ni"><img src="../Images/7c0520a6f03ce3db9a0b62e224496d32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y-1NAsHrpM_yCdhqlJL1Bw.jpeg"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">使用遥测数据进行异常检测的逐步方法(图片由作者提供)</p></figure><h1 id="4ff6" class="mf mg jg bd mh mi mj mk ml mm mn mo mp km mq kn mr kp ms kq mt ks mu kt mv mw bi translated">步骤1:收集数据</h1><p id="0760" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">使用诊断设置配置关键资源，并选择日志分析帐户目标。您可以设置连续导出或使用自定义查询下载所需的数据进行培训。例如，示例数据集<a class="ae jd" href="https://github.com/sriksmachi/sriksml/blob/main/data/pca_data.csv" rel="noopener ugc nofollow" target="_blank">这里的</a>包含每1分钟收集的Azure Keyvault指标。我只考虑了几个指标，但是您可以根据需要扩展它们。</p><h1 id="6223" class="mf mg jg bd mh mi mj mk ml mm mn mo mp km mq kn mr kp ms kq mt ks mu kt mv mw bi translated">第二步:PCA培训</h1><p id="a33c" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">由于PCA是一个静态过程，在下面的步骤中，我们使用PCA对数据和训练进行归一化。在这里，我将特征尺寸从4个减少到1个。第一主成分足以解释96%的数据方差。</p><figure class="nc nd ne nf gt is gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/e140ab225d4583185d1822be2de6a99f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*f-xDdwf8jf_u6PtPS3KtIA.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">PCA培训(图片由作者提供)</p></figure><h1 id="e6e9" class="mf mg jg bd mh mi mj mk ml mm mn mo mp km mq kn mr kp ms kq mt ks mu kt mv mw bi translated">步骤3:重建错误</h1><p id="0179" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">在该步骤中，我们确定重建误差阈值，该阈值将在将来用于识别异常。在这种情况下，我选择1作为重建误差的阈值。任何大于1的重建误差都被视为异常(下图中的红色垂直线)</p><figure class="nc nd ne nf gt is gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/005ef0b618b4d9433549640dc17aec2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*JGw28raKZytcdzbJp9G43g.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">重建错误(图片由作者提供)</p></figure><p id="7a8f" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可以轻松地将这段代码转换为cron作业，该作业获取最新的Azure指标，使用PCs进行重构，如果任何数据点重构超过错误阈值，就会发出警报。helper方法的源代码和完整的笔记本可以在<a class="ae jd" href="https://github.com/sriksmachi/sriksml/blob/main/pca.ipynb" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="e5d5" class="mf mg jg bd mh mi mj mk ml mm mn mo mp km mq kn mr kp ms kq mt ks mu kt mv mw bi translated">摘要</h1><p id="698f" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">我们已经看到了使用主成分分析来自动检测和警告遥测数据中的异常的实用方法。我想提醒你，主成分分析并不是唯一用于异常检测的最大似然方法，其他方法有孤立树、一类SVM和局部异常SVM。PCA也有一些限制，主要是特征向量或主成分只能是现有特征的线性组合。如果数据不能用线性组合来解释，主成分分析就没那么有用了。在这些情况下，可以使用t-SNE等非线性方法。PCA还降低了可解释性，因为实际特征被简化为线性组合，我们不再能够指出与目标向量高度相关的特定特征。</p></div></div>    
</body>
</html>