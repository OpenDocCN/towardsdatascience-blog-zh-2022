<html>
<head>
<title>How to Download Uber’s Hexagonal Grid with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Python下载优步的六角网格</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-download-ubers-hexagonal-grid-with-python-3140fe95e19a#2022-06-06">https://towardsdatascience.com/how-to-download-ubers-hexagonal-grid-with-python-3140fe95e19a#2022-06-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="368f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一篇关于使用python API访问优步H3六边形索引的实践短文</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2630e4ab302a34f3c97aa16793e4e26c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MLH6LLN4-41M-X-t.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><p id="24c1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">优步开放其H3电网已经四年了。该公司最初开发了用于乘坐优化的索引系统，但事实证明它对所有涉及可视化和探索空间数据的任务都很有用。</p><p id="6634" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然优步不得不提出这些六边形层次索引来设置动态价格，但地理空间领域的研究人员和从业人员很长时间以来一直在使用网格系统将事件存储到单元中。六边形在模型中最广为人知的用途之一是克里斯塔勒的中心位置理论，这是一种在<a class="ae lu" href="https://www.thoughtco.com/overview-of-urban-geography-1435803" rel="noopener ugc nofollow" target="_blank">城市地理学</a>中的理论，试图解释世界各地城市和城镇的分布模式、规模和数量背后的原因。该理论提供了一个六边形网格框架，通过该框架可以研究区域的位置模式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/bf06cefbc65e7eeaa051bb038916066a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*H5QqC0G6I_wRoBtl.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">克里斯塔勒的中心位置理论。改编自克里斯塔勒。来源:<a class="ae lu" href="https://www.researchgate.net/publication/262666158_Microeconomics_Approaches_in_the_Christaller%27s_Central_Places_Theory" rel="noopener ugc nofollow" target="_blank">韦塞拉，2015年</a></p></figure><p id="703a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">六边形形状在这里是理想的，因为它允许由中心位置顶点形成的三角形连接，并允许每个单元以相同的方式与其他六个单元接触(例如，潜在地连接并建立流)。</p><p id="47d8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然六边形的变形不太明显，但它们不能完全细分，也不能与街道对齐。所有这些限制都可以通过聚类的偏向性来解决，聚类的细胞反过来模拟对分析更有用的形状。</p><h1 id="d87f" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">全球标准化电网的潜力</h1><p id="7721" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">H3系统在全世界范围内提供了具有可比较形状和大小的细胞。这为建立一个标准提供了可能性，通过该标准可以将任何空间数据集设置为。这意味着越多的空间研究使用这种网格，数据集就越容易互换和相互比较。</p><p id="1083" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以蒙特利尔的<a class="ae lu" href="https://anagraph.io/" rel="noopener ugc nofollow" target="_blank"> Anagraph </a>的加拿大人口数据集为例，该数据集使用了不同的来源——其中包括加拿大2021年人口普查——来模拟使用H3指数的<a class="ae lu" href="https://geometric-data-viewer.anagraph.io/?zoom=8.40&amp;lat=45.6239&amp;long=-73.8094&amp;layer=LocalPop-2016" rel="noopener ugc nofollow" target="_blank">人口六边形网格数据集</a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/50c1216f1ce729f2b5d902315a490efc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vuNBjU97fTri37OH.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">人口网格图。来源:<a class="ae lu" href="https://geometric-data-viewer.anagraph.io/?zoom=8.40&amp;lat=45.6239&amp;long=-73.8094&amp;layer=LocalPop-2016" rel="noopener ugc nofollow" target="_blank"> Anagraph几何查看器</a>。作者截屏。</p></figure><p id="acbb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有影响力的流动性研究员<a class="ae lu" href="https://twitter.com/UrbanDemog" rel="noopener ugc nofollow" target="_blank"> Rafael Pereira </a>也是如此，他的<a class="ae lu" href="https://www.ipea.gov.br/acessooportunidades/en/" rel="noopener ugc nofollow" target="_blank">关于在巴西获得机会的研究</a>很好地利用了H3指数，以更好地捕捉涉及移动路径或连通性的现象的空间动态。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/01f44fbc9af58d488a06e26d718fe509.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Tqan-dY24MuEt15W.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">IPEA获得机会项目。改编自IPEA。图片作者。</p></figure><h1 id="88b7" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">那你是怎么得到它的呢？</h1><p id="2d55" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">如果您使用空间数据，您可能希望能够获得一个链接来下载某处的shapefile。在这里不会是这样的。</p><p id="5041" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了得到它，我们需要使用<a class="ae lu" href="https://uber.github.io/h3-py/api_reference.html" rel="noopener ugc nofollow" target="_blank"> H3 API </a>。如果你想知道，一个<strong class="la iu">应用程序编程接口</strong> ( <strong class="la iu"> API </strong>)设置了可以用来调用(即访问)保存我们需要的数据的服务器的工具。基本上，这意味着我们可以通过向系统发送某些消息，使用一组预定义的规则来与该应用程序及其数据进行交互。</p><p id="8a57" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">记住这一点，让我们使用<a class="ae lu" href="https://uber.github.io/h3-py/api_reference.html" rel="noopener ugc nofollow" target="_blank"> H3 API文档</a>中描述的方法提取与感兴趣区域相交的所有多边形。第一步是利用geopandas吸收上述区域。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/9685c4f52863c548fe96e1b01e62c89d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/0*HgR0s-ABFVesn34x.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><p id="53d4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">既然我们已经获得了一个包含要提取六边形的区域的地理数据框架，让我们开始使用实际的H3图书馆。我们将从使用h3的polyfill方法开始，该函数将从地理数据框架和比例中获取第一个也是唯一一个要素的几何-因为H3系统是多比例的，所以我们可以提取多种大小的六边形-这里将是8，最细的级别。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="1c58" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">hexs变量将返回一个非常简单的列表，其中包含与所提供区域相交的第8层所有六边形的id。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e719c7499c30f92be9c861ddcaa40222.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GRX_5gepA7FEucFz.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><p id="1d3c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们将使用该列表向H3 API请求与它们对应的实际几何图形。为此，我们将创建一个<a class="ae lu" href="https://www.w3schools.com/python/python_lambda.asp" rel="noopener ugc nofollow" target="_blank"> lambda函数</a>，它将一个输入(十六进制ID)传递给<em class="my"> h3_to_geo_boundary </em>方法，并将响应转换为shapely的多边形。</p><p id="ad5f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，我们将使用python的map方法将id列表(hexs变量)传递给polygonise函数。这又被转换成将填充geoseries的多边形列表(或geopanda的空间类型列表)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/0cd7c2e8dbb24d40cdc7c1190f1929c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/0*qdndo81Vjzkx7XEd.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><p id="2660" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这看起来与我们要找的一模一样，所以剩下的工作就是创建一个包含结果的地理数据框架，并将其导出到地理包(或者shapefile，如果您是守旧派的话)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><h1 id="1cf8" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">那是一个包裹</h1><p id="b0df" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">就是这个！我们仅用几行代码就成功地提取了我们感兴趣区域的h3六边形。</p><p id="67f7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你有问题或建议，不要犹豫，随时给我写信。如果你喜欢这篇文章，考虑给我买一杯咖啡，这样我就可以继续写更多的文章了！</p><p id="0548" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="my">如果你还不是一个媒体成员，并且想支持像我这样的作家，请随时通过我的推荐链接注册:</em></p><div class="na nb gp gr nc nd"><a href="https://guilhermeiablonovski.medium.com/membership" rel="noopener follow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd iu gy z fp ni fr fs nj fu fw is bi translated">通过我的推荐链接加入媒体——古伊列梅·m·亚布洛诺夫斯基</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">guilhermeiablonovski.medium.com</p></div></div><div class="nm l"><div class="nn l no np nq nm nr ks nd"/></div></div></a></div></div></div>    
</body>
</html>