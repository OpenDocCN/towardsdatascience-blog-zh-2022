<html>
<head>
<title>Merging HERE Road Speeds with OSMnx Urban Networks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将道路速度与OSMnx城市网络融合在一起</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/merging-here-road-speeds-with-osmnx-urban-networks-960bcddd011c#2022-04-08">https://towardsdatascience.com/merging-here-road-speeds-with-osmnx-urban-networks-960bcddd011c#2022-04-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f2e1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">OSMnx是一个用于道路网络的强大Python包，但不包含当前的交通状况-让我们使用HERE traffic API来估算OSMnx中的实时交通信息</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0876c71dd866679184369dc2e4d099c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2xpTR9qG8DiFu3-x.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">华盛顿DC公路网速度从这里API和OSMnx |塞犍陀维韦克</p></figure><p id="0584" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">OSMnx是一个强大的Python包，用于处理取自OpenStreetMap(一个免费的可编辑的世界地理数据库)的静态道路网络信息。下面是一个简短的代码片段，展示了如何使用OSMnx来获取华盛顿州DC的道路网络:</p><pre class="kj kk kl km gt lu lv lw lx aw ly bi"><span id="9b85" class="lz ma it lv b gy mb mc l md me">place_name="Washington DC, USA" G = ox.graph_from_place(place_name,network_type='drive', simplify=True) fig, ax = ox.plot_graph(G,node_size=0)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mf"><img src="../Images/a741093974589fbd335c3ab4ac5fc4af.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/0*Dl2KPrgyd1yhglj9.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自奥斯蒙斯的华盛顿DC公路网|塞犍陀·维韦克</p></figure><p id="91ca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是，OSMnx缺乏动态信息。特别是，OSMnx目前根据速度限制，从单个道路穿越时间计算最短时间路径。这可能不具有代表性，尤其是在高峰时间，一些常用的道路可能会因拥堵或事故而完全堵塞。如果有一种方法可以根据当前的交通状况计算出最短的路径，那就太好了。那么我们如何获取OSMnx边缘的实时交通信息呢？</p><p id="d957" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">HERE API使得从某个边界框内的路段获取速度成为可能。我写过一篇关于如何使用HERE API获得道路速度的文章:</p><div class="mg mh gp gr mi mj"><a rel="noopener follow" target="_blank" href="/visualizing-real-time-traffic-patterns-using-here-traffic-api-5f61528d563"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd iu gy z fp mo fr fs mp fu fw is bi translated">使用HERE traffic api可视化实时交通模式</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">虽然谷歌地图显示的是实时交通状况，但却无法访问底层的交通数据。这里的技术提供了…</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">towardsdatascience.com</p></div></div><div class="ms l"><div class="mt l mu mv mw ms mx ks mj"/></div></div></a></div><p id="4f24" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">很容易设置一个HERE API帐户。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi my"><img src="../Images/20bb25502fe974746ea54721c541d7e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/0*c8DmSz7rEhGAzTKP.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/46347ccc5aa960f7db48aec535e126d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_iDMXNkw5QmybQmM.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在此获取REST API密钥|塞犍陀·维韦克</p></figure><p id="5ffa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">给定一个来自OSMnx的城市道路网络G，您可以将该道路网络输入到一个自定义函数中，该函数会计算出适当的边界框来从中提取速度。get_speeds.py模块中的函数speeds就是这样做的:</p><pre class="kj kk kl km gt lu lv lw lx aw ly bi"><span id="8cc1" class="lz ma it lv b gy mb mc l md me">from get_speeds import * <br/>speeds(G,API_KEY)</span></pre><p id="800f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为HERE API给出了交通速度和速度限制的信息，所以我绘制了一个图表来可视化道路上的相对速度。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/55f6d583b5f18e3cdf2796ac7e061a9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yM015gcELDOc7aXr.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">速度从这里API |塞犍陀维韦克</p></figure><p id="d147" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，有一个问题。这里提供了边界框中的速度。但是请注意，OSMnx只提供来自华盛顿DC地区的道路网络，这对应于边界框的右半部分。我们可以通过将从HERE路段数据获得的速度与OSMnx边缘相结合来解决这个问题。为此，我们需要为OSMnx中的每条边分配来自HERE路段数据的最近路段的速度。计算最近的OSMnx边和与单点的相应距离需要几秒钟的时间。由于here数据中有40，000+路段和速度，预计这需要一段时间！</p><pre class="kj kk kl km gt lu lv lw lx aw ly bi"><span id="6d2f" class="lz ma it lv b gy mb mc l md me">API_KEY='BLAH' <br/>get_edge_speeds(G,API_KEY)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/dad053a13a9637eb193aca0c91826556.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tooBLlK8gwOOYyAJ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从这里获取交通位置的最近OSMnx边缘API |塞犍陀维韦克</p></figure><p id="db6d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我使用joblib利用了所有16个CPU内核，这花了10多个小时才完成！过滤距离OSMnx边缘的阈值距离内的所有路段，得到以下图像:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/a59354e20f510b19b33ca2a944e50fea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0ajrCCjrF8mepFqx.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">通过接近奥斯门克斯边缘过滤交通速度段|塞犍陀·维韦克</p></figure><p id="d018" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如您所看到的，它看起来好多了——而且比原来的OSMnx图形更有可比性！</p><p id="6e86" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，基于截止值(这里是0.01)，你可以得到网络的边和速度！</p><pre class="kj kk kl km gt lu lv lw lx aw ly bi"><span id="d38e" class="lz ma it lv b gy mb mc l md me">df_es=pd.read_csv('df_es.csv') <br/>edges1=add_edge_speeds(G,df_es,0.01) #change cutoff as necessary</span></pre><p id="a01e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就是这样-现在您可以执行各种网络算法，如最短时间路径，考虑交通模式！不过有一点需要注意的是，HERE API不提供某些较小道路上的速度信息，而OSMnx提供了更细粒度的道路网络信息。这将导致在较小的道路上对速度的不正确估计。根据您的使用情况，这可能是一个大问题，也可能根本不是什么大问题。</p><p id="a55e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">代码可以在GitHub repo中找到:</p><div class="mg mh gp gr mi mj"><a href="https://github.com/skandavivek/osmnx-edge-speeds" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd iu gy z fp mo fr fs mp fu fw is bi translated">GitHub-skandavivek/osmnx-edge-speeds:获取OS mnx城市道路对应的道路速度…</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">从HERE traffic API place _ name = " Washington DC…</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">github.com</p></div></div><div class="ms l"><div class="nc l mu mv mw ms mx ks mj"/></div></div></a></div></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><p id="5de0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="nk">如果你还不是中会员，想支持我这样的作家，可以通过我的推荐链接随意报名:</em><a class="ae nl" href="https://skanda-vivek.medium.com/membership" rel="noopener"><em class="nk">【https://skanda-vivek.medium.com/membership】</em></a></p><p id="6f64" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae nl" href="https://medium.com/@skanda.vivek" rel="noopener"> <em class="nk">关注我</em> </a> <em class="nk">如果你喜欢这篇文章——我经常在数据科学、物理和社会的界面上写作。</em></p><p id="f016" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="nk">原载于2022年4月8日https://chaoscontrol.net</em><a class="ae nl" href="https://chaoscontrol.net/real-time-traffic-speeds-in-osmnx-urban-road-networks/" rel="noopener ugc nofollow" target="_blank"><em class="nk"/></a><em class="nk">。</em></p></div></div>    
</body>
</html>