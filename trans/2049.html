<html>
<head>
<title>Secure Your Streamlit App With Django</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Django保护您的Streamlit应用</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/secure-your-streamlit-app-with-django-bb0bee2a6519#2022-05-09">https://towardsdatascience.com/secure-your-streamlit-app-with-django-bb0bee2a6519#2022-05-09</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="2979" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">围绕你的机器学习web应用建立一个灵活的认证系统</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/8dd2a1a9f1b1891e3c21ecd8e62d7db0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jxIoZD6GprcKpEiLN0OM5g.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">使用Django认证系统保护Streamlit应用程序。——照片由来自<a class="ae kz" href="https://www.pexels.com" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的蒂姆<a class="ae kz" href="https://www.pexels.com/photo/black-and-white-wooden-sign-behind-white-concrete-3690735/" rel="noopener ugc nofollow" target="_blank">莫斯霍尔德</a>拍摄</p></figure><p id="298d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对于数据科学家来说，Streamlit 是一个将他们的工作转化为网络应用的优秀工具。</p><p id="6891" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在之前的一篇文章中，我讨论了围绕<a class="ae kz" rel="noopener" target="_blank" href="/running-election-campaigns-with-k-means-clustering-ecc40a91135a"> K-Means </a>聚类创建应用的基础。用户可以更改参数，如集群的数量，并可视化组的变化。</p><p id="1b55" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你可以阅读下面的帖子，并访问这个<a class="ae kz" href="https://github.com/ThuwarakeshM/Streamlit-Intro" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>的源代码。</p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/how-to-create-stunning-web-apps-for-your-data-science-projects-c7791102134e"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">如何为您的数据科学项目创建出色的Web应用程序</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">数据科学家不必学习HTML、CSS和JavaScript来构建网页。</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn kt lz"/></div></div></a></div><p id="220f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这篇文章和以后的几篇文章中，我想分享一些令人兴奋的方法，我已经解决了一些关于Stramlit的挑战性问题。这篇文章解释了如何围绕你的Stramlit应用建立一个认证系统。</p><h1 id="2a81" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">Streamlit的认证系统有什么问题？</h1><p id="db67" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">在使用<a class="ae kz" href="https://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> Django </a>之前，让我先说说Streamlit的内置认证选项。</p><p id="e614" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Streamlit还年轻，还在进步。它有一个使用<code class="fe nl nm nn no b">secrets.toml</code>文件认证应用的<a class="ae kz" href="https://docs.streamlit.io/knowledge-base/deploy/authentication-without-sso" rel="noopener ugc nofollow" target="_blank">建议方法。</a></p><p id="2111" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您在一个<a class="ae kz" href="https://toml.io/en/" rel="noopener ugc nofollow" target="_blank"> TOML </a>文件中指定应用程序的用户及其密码，并将其上传到部署环境。然后在应用程序中，放入代码片段进行查找，并匹配密码进行身份验证。</p><p id="811b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我认为这种方法有三个主要缺点。</p><p id="0688" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">首先，<strong class="lc iv">在文件中存储密码是不安全的</strong>。任何有权访问部署环境的人也可以访问密码。</p><p id="028a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">二是有<strong class="lc iv">无</strong><a class="ae kz" href="https://auth0.com/blog/hashing-passwords-one-way-road-to-security/" rel="noopener ugc nofollow" target="_blank">T5】密码哈希 </a>。存储散列密码是一个好习惯。如果经过哈希处理，即使有人能够读取密码，它也将是原始密码的加密版本。入侵者应该知道使用的散列算法和另一个密钥来解码它。另一个密钥通常很难突破<a class="ae kz" href="https://www.kaspersky.com/resource-center/definitions/brute-force-attack" rel="noopener ugc nofollow" target="_blank">强力方法</a>，因为它是一个很长的字符串——通常大约64个字符。</p><p id="9372" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最后，我们需要一个<strong class="lc iv">接口来管理用户</strong>到平台。在Streamlit建议的方法中，如果新用户需要访问系统，开发人员应该将他的凭证添加到TOML文件中。</p><p id="587c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">除了这三个原因，无法管理访问控制是我们需要复杂的认证系统的另一个原因。</p><p id="b442" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Django有一个默认的管理界面来管理用户。它有一个<a class="ae kz" href="https://docs.djangoproject.com/en/4.0/topics/auth/" rel="noopener ugc nofollow" target="_blank">认证机制</a>，通过密码哈希将用户存储在数据库中。所以，让我们利用它。</p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/plotly-dashboards-in-python-28a3bb83702c"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">这就是我如何纯粹用Python创建令人眼花缭乱的仪表盘。</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">Plotly dash应用程序是用python构建生产级仪表板的最快方式。</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="np l mk ml mm mi mn kt lz"/></div></div></a></div><h1 id="4516" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">让我们为Streamlit构建一个Django验证器。</h1><p id="215b" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">在本教程中，我将遵循我在上一篇文章中使用的相同项目。您可以使用下面的代码从GitHub存储库中克隆它。</p><pre class="kk kl km kn gu nq no nr ns aw nt bi"><span id="46f6" class="nu mp iu no b gz nv nw l nx ny">git clone <a class="ae kz" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:thuwarakeshm/Streamlit-Intro.git streamdj<br/>cd streamdj</span><span id="d7b8" class="nu mp iu no b gz nz nw l nx ny"># This will create the following project files<br/>.<br/>├── quickstart.py<br/>├── README.md<br/>└── requirements.txt</span></pre><p id="f763" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">同样，让我们创建一个虚拟env并安装需求。</p><pre class="kk kl km kn gu nq no nr ns aw nt bi"><span id="d9a7" class="nu mp iu no b gz nv nw l nx ny"><strong class="no iv">$</strong> virtualenv env</span><span id="6689" class="nu mp iu no b gz nz nw l nx ny"><strong class="no iv">$</strong> source env/bin/activate # On Linux<br/><strong class="no iv">$</strong> source env\Scripts\activate # on Windows</span><span id="b6d4" class="nu mp iu no b gz nz nw l nx ny">pip install -r requirements</span></pre><p id="2818" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在让我们在文件夹中创建一个Django应用程序。文件夹结构将如下所示。</p><pre class="kk kl km kn gu nq no nr ns aw nt bi"><span id="5254" class="nu mp iu no b gz nv nw l nx ny"><strong class="no iv">$</strong> django-admin startproject config .</span><span id="5eba" class="nu mp iu no b gz nz nw l nx ny"># The project structure will look like this now<br/>.<br/>├── config<br/>│   ├── asgi.py<br/>│   ├── __init__.py<br/>│   ├── settings.py<br/>│   ├── urls.py<br/>│   └── wsgi.py<br/>├── manage.py<br/>├── quickstart.py<br/>├── README.md<br/>└── requirements.txt</span></pre><p id="669e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们继续创建一个超级用户来管理所有其他用户。</p><pre class="kk kl km kn gu nq no nr ns aw nt bi"><span id="54c9" class="nu mp iu no b gz nv nw l nx ny"><strong class="no iv">$</strong> python manage.py migrate<br/><strong class="no iv">$</strong> python manage.py createsuperuser</span><span id="92af" class="nu mp iu no b gz nz nw l nx ny"># Follow the on-screen instructions to create the user</span></pre><p id="4394" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们用<code class="fe nl nm nn no b"><strong class="lc iv">python manage.py runserver</strong></code>启动服务器，并通过<code class="fe nl nm nn no b"><a class="ae kz" href="http://localhost:8000/admin/" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/admin/</a></code>登录到管理门户。</p><p id="e2cd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们也创建几个用户来测试我们的应用程序。点击用户旁边的小+按钮，添加几个。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oa"><img src="../Images/7189e7c389fb525b86f067e11ff02f37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lPqr2kq_FJcDx0tod09rQw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">通过Django管理界面添加新用户来访问我们的Streamlit应用程序。—<a class="ae kz" href="http://thuwarakesh.medium.com" rel="noopener">作者</a>截图。</p></figure><p id="70d1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，我们的用户已经准备好了。下一步是使用Django认证框架，让用户访问Steramlit应用程序的私人页面。</p><h1 id="c185" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">向Django认证Streamlit应用程序。</h1><p id="11f1" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">Django的WSGI应用程序实例应该在我们的Stramlit应用程序中运行，这样才能工作。这是Django建立数据库连接和认证所必需的。</p><p id="5089" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在我们需要另一个函数来显示用户名和密码输入字段。我们可以通过将内容<code class="fe nl nm nn no b">wsgi.py</code>复制到运行Streamlit的quickstart文件中来实现。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ob oc l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">由<a class="ae kz" href="https://thuwarakesh.medium.com" rel="noopener">作者编写的代码片段。</a></p></figure><p id="8d4c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这个函数还将调用Django的authenticate函数。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ob oc l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">由<a class="ae kz" href="https://thuwarakesh.medium.com" rel="noopener">作者编写的代码片段。</a></p></figure><p id="6730" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们现在需要调用这个函数，并且只有当它返回True时才继续执行Streamlit应用程序的其余部分。</p><pre class="kk kl km kn gu nq no nr ns aw nt bi"><span id="92bc" class="nu mp iu no b gz nv nw l nx ny">if if check_password():</span><span id="c112" class="nu mp iu no b gz nz nw l nx ny">   # Our regular Streamlit app.</span></pre><p id="6e16" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这里是<code class="fe nl nm nn no b">quickstart.py</code>文件的完整版本。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ob oc l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">由<a class="ae kz" href="https://thuwarakesh.medium.com" rel="noopener">作者编写的代码片段。</a></p></figure><h1 id="c322" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">测试身份验证流程</h1><p id="8e9c" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">我们的应用现在是安全的。我们需要启动streamlit应用程序。让我们试一试。</p><pre class="kk kl km kn gu nq no nr ns aw nt bi"><span id="19e7" class="nu mp iu no b gz nv nw l nx ny"><strong class="no iv">$ </strong>streamlit run quickstart.py</span></pre><p id="8aed" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">上述命令应该会启动服务器，并在默认浏览器中打开应用程序。现在，您将看到以下登录页面，而不是您的Streamlit应用程序。</p><div class="kk kl km kn gu ab cb"><figure class="od ko oe of og oh oi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><img src="../Images/f9b4c29ba571a6f10b281ecf98fc548c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*zP5q9HfVbbAok8A2yOHxsw.png"/></div></figure><figure class="od ko oe of og oh oi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><img src="../Images/3ec618eb341856209bc0532c9766024b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*tHE1zFN6Ps6BMBm2B3Wlog.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk oj di ok ol translated">基于Django认证后端的Streamlit登录屏幕——截图由<a class="ae kz" href="https://thuwarakesh.medium.com" rel="noopener">作者提供。</a></p></figure></div><p id="dd3d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您还可能会看到密码不正确或为空的错误消息。您必须输入正确的用户名和密码组合才能登录并查看您的streamlit应用程序。</p><h1 id="1f1c" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">最后的想法</h1><p id="d26f" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">Streamlit是数据科学家的绝佳解决方案。它允许围绕他们的机器学习模型创建web应用程序，而不用担心HTML、CSS、JavaScript和其他web开发复杂性。</p><p id="7865" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是工具还很年轻。因此它的认证特性需要改进。我相信该工具背后令人惊叹的开发团队将很快构建它。</p><p id="6531" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是目前，为了安全地部署我们的Streamlit应用程序，我们可以从一个成熟的web开发框架中借用身份验证功能。</p><p id="71c4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这篇文章中，我们使用Django认证来保护Streamlit应用。它解决了Streamlit建议的方法中缺少的一些关键特性。Django将密码散列存储在数据库中。此外，我们有一个网络界面来管理用户。</p><p id="0472" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">没有访问控制这还不完整。但那是为了以后的帖子。</p></div><div class="ab cl om on hy oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="in io ip iq ir"><blockquote class="ot ou ov"><p id="9d94" class="la lb ow lc b ld le jv lf lg lh jy li ox lk ll lm oy lo lp lq oz ls lt lu lv in bi translated">感谢阅读，朋友！在<a class="ae kz" href="https://www.linkedin.com/in/thuwarakesh/" rel="noopener ugc nofollow" target="_blank"><strong class="lc iv">LinkedIn</strong></a><a class="ae kz" href="https://twitter.com/Thuwarakesh" rel="noopener ugc nofollow" target="_blank"><strong class="lc iv">Twitter</strong></a><a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener"><strong class="lc iv">Medium</strong></a>上跟我打招呼。看来你和我有许多共同的兴趣。</p></blockquote><p id="0bab" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">还不是中等会员？请使用此链接<a class="ae kz" href="https://thuwarakesh.medium.com/membership" rel="noopener"> <strong class="lc iv">成为会员</strong> </a>因为，在没有额外费用的情况下，我为你引荐赚取一小笔佣金。</p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/advanced-pandas-plots-e2347a33d576"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">在一行代码中创建令人惊叹的可视化熊猫数据框架</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">一个简单的技巧，使您的图表具有交互性和视觉吸引力</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="pa l mk ml mm mi mn kt lz"/></div></div></a></div></div></div>    
</body>
</html>