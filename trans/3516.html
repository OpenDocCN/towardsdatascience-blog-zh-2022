<html>
<head>
<title>The deferred acceptance (DA) algorithm utilised in school choice with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python在学校选择中使用的延迟接受(DA)算法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-deferred-acceptance-da-algorithm-utilised-in-school-choice-with-python-afc0fe892921#2022-08-04">https://towardsdatascience.com/the-deferred-acceptance-da-algorithm-utilised-in-school-choice-with-python-afc0fe892921#2022-08-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2b0b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我们如何让学生和学校稳定匹配？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7985df6e6dfa62cc45556e05042bce36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vB53OUZiagmuRlui"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安诺尔·查菲克在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="a445" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">匹配研究调查人、机构和商品之间的稳定匹配。从Gale和Shapley (1962)的延迟接受(DA)算法开始，这项研究已经成功地应用于现实世界，尤其是21世纪初以来的学校选择。在这篇博文中，我将简要解释匹配/学校选择理论的背景及其理论发展，并展示算法的python实现。</p><p id="5aff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python的实现可以在<a class="ae ky" href="https://github.com/kyosek/deferred_acceptance_school_choice" rel="noopener ugc nofollow" target="_blank">这个回购</a>中找到。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="452a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">目录</h1><ol class=""><li id="6592" class="mu mv it lb b lc mw lf mx li my lm mz lq na lu nb nc nd ne bi translated">介绍</li><li id="ec0b" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">延期录取算法与学校选择</li><li id="e3c6" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">Python实现</li><li id="f0ea" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">结论和未来工作</li></ol></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6f89" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak"> 1。简介</strong></h1><p id="35f5" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">传统上，人们会被自动分配到美国最近的学校。然而，在1980年代，政府开始了学校选择制度，以便让学生更灵活地选择他们喜欢的学校。从此，人们开始思考如何策略性地获得自己的首选学校。事实证明，博弈论的方法是有帮助的。作为一个现实世界的例子，纽约市高中录取在2003年使用了d a算法的一个变种。这篇博文研究了延期录取算法的特性及其在学校选择机制中的应用。还演示了算法的python实现。</p><h1 id="4b80" class="mc md it bd me mf nn mh mi mj no ml mm jz np ka mo kc nq kd mq kf nr kg ms mt bi translated"><strong class="ak"> 2。延期录取(DA)算法与学校选择</strong></h1><p id="9a83" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">本节简要介绍几个属性，并举例说明该算法如何工作。所有的证明和详细的解释都可以在文献中找到，这里只演示了最基本的部分。</p><p id="f6b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 2.1框架/属性</strong></p><p id="4285" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">进一步讨论这个话题，有几个重要的性质，即<strong class="lb iu">稳定性</strong>、<strong class="lb iu">效率、防策略</strong>。本节解释这些概念。</p><p id="4428" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">稳定性</strong></p><p id="553a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">DA算法是找到代理和主体的稳定匹配的算法。但是这里的“稳定匹配”是什么意思呢？</p><p id="e94d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了有一个<strong class="lb iu">稳定匹配</strong>，我们必须满足以下条件(盖尔和沙普利，1962):</p><p id="1696" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(I)代理人是个体理性的</p><p id="7c5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(ii)如果代理人与委托人匹配，这种匹配不能被任何联盟阻止。</p><p id="a9a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">效率</strong></p><p id="138d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由DA算法产生的每个匹配<strong class="lb iu">弱Pareto支配由任何其他机制产生的匹配</strong>(Gale和Shapley，1962)。如果没有其他匹配，其中至少有一个学生过得更好，没有学生过得更差，那么这个匹配就是(帕累托)有效的。在这种情况下，由于没有代理人有动机偏离这个分配到其他分配，或者没有代理人可以通过误报而变得更好，这就是<strong class="lb iu">纳什均衡</strong>。</p><p id="0fb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">防战略</strong></p><p id="4464" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种算法使得<strong class="lb iu">真实的偏好披露成为每个代理人的主导策略</strong>，杜宾斯和弗里德曼(1981)证明了这一点；罗斯(1982) <strong class="lb iu">。</strong></p><p id="ee1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">DA算法满足稳定性和防策略性，但不满足效率。事实上，任何机制都不可能既高效又稳定(Roth 1982)。</p><p id="5a7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 2.2算法</strong></p><p id="1764" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么DA算法是如何工作的呢？该算法处理以下迭代:</p><p id="371a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">迭代1: </strong>每个代理根据她的偏好等级选择委托人。每个得到报价的委托人拒绝最不喜欢的代理人，否则，把他放在“保留名单”上。</p><p id="3a84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">迭代2: </strong>在前一轮被拒绝的代理提供了他的第二个选择，委托人再次拒绝了最不喜欢的代理。</p><p id="8621" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">迭代k: </strong>在第k轮被拒绝的代理提供他的第k个选择，委托人拒绝最不优选的代理。</p><p id="c957" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重复上述阶段，直到每个代理都在委托人的“保持列表”上。一旦最后一个委托人与最后一个代理人匹配，每个委托人都需要接受他们自己的“保留列表”中的提议。</p><p id="c192" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">这证明了DA算法总能找到稳定的匹配(Gale和Shapley，1962)。</strong></p><p id="c5ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.3学校选择</p><p id="b05d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在择校的设置上，DA算法需要一点点修改。在原来的DA算法设定中，一对一匹配是假设之一，但在学校选择中，这需要放宽到一对多匹配。所以学校有一定的学生配额，只要学生人数少于配额，学校就可以录取学生。下面是一个例子。</p><p id="e688" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">示例</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/b82cce804394fbac9d8e2d71e01fba85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dpNxEkvd6Axm-2qNFbh5PA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">表1:学生/学校偏好表</p></figure><p id="6ac5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设存在N = 4名学生和3所学校，X，y，z ∈ X，如表1所示。学校x和z有1个名额，y有2个名额。下表1显示了每个学校/学生的偏好排名。为了找到稳定的匹配，实现d a算法。一、学生申请学校，他们最偏爱。在第一轮中，1和2都最喜欢z，z更喜欢1而不是2，因此z拒绝了2。3个申请x，4个申请y，放在各个学校的“保留名单”里。在第二轮中，2应用她的第二选择x。在x的“保留列表”中，有来自第一阶段的3，但是x更喜欢2而不是3，因此它拒绝了3，并将2保留在其“保留列表”中。然后重复这些程序，直到每个人都被大学录取，最终可以找到稳定的配对。这些迭代显示在下面的动画中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">DA算法迭代</p></figure><p id="3155" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，在现实世界中，学校通常不会对一群学生有严格的偏好。通常，他们的偏好包括4个优先组:(I)同胞和步行区，(ii)同胞，(iii)步行区和(iv)其他。为了解决这个问题并仍然应用DA算法，我们需要打破那些无关紧要的偏好，并使它们的偏好变得严格。为了打破平局，可以使用“随机抽签”。在同一个优先组的学生中，使用随机抽签人为地创建组中的排名，并在其他组中重复这一过程，以严格优先于所有学生。然而，不幸的是，使用这种方法会导致效率损失。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/cc7ab2ef77140f547f412254748f0d08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yufwtaWkHNAC-_Dn"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@osmanrana?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">奥斯曼·拉纳</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="658c" class="mc md it bd me mf nn mh mi mj no ml mm jz np ka mo kc nq kd mq kf nr kg ms mt bi translated"><strong class="ak"> 3。Python实现</strong></h1><p id="f10c" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">本节展示了算法的python实现。我已经创建了<a class="ae ky" href="https://github.com/kyosek/deferred_acceptance_school_choice" rel="noopener ugc nofollow" target="_blank">回购</a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="79d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">主DA算法功能</strong></p><p id="78b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里展示了该算法的python实现的一部分。首先，下面是它的主要部分。在这个函数中，deferred_acceptance接受student_df、schools_df、schools_quota和verbose输入。这些student_df和schools_df包含学生和学校对学校和学生的偏好。这些数据帧的细节将在下面进一步解释。schools_quota表示每个学校的学生配额。如果verbose不为0，它将打印迭代次数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nu l"/></div></figure><p id="cf3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该函数将执行以下操作:</p><ol class=""><li id="5f1f" class="mu mv it lb b lc ld lf lg li nx lm ny lq nz lu nb nc nd ne bi translated">创建匹配的初始环境</li><li id="4228" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">遍历学生，开始将他们放在学校的“保留列表”中</li><li id="a550" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">确保学校的学生人数少于学校的配额</li></ol></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="e25a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">效用函数</strong></p><p id="89fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里显示了几个实用函数。首先，一个叫做<em class="oa">严格_偏好_检查</em>。这个名字是不言自明的，但将确保学生对学校有严格的偏好，因为它对算法正常工作很重要。</p><p id="0e80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二个叫做<em class="oa"> create_dataframes。</em>它有助于从学生和学校偏好的列表和字典中创建一个pandas数据框架，以便在主要DA算法函数中使用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nu l"/></div></figure><p id="fcb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第三个是随机打破一个学校的平局偏好的函数。正如上文提到的，现实世界中的学校通常对学生群体有不同的偏好。然而，为了让算法起作用，我们需要通过使用随机“抽签”来严格限定他们的偏好。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nu l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="c693" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">例子</strong></p><p id="de61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一个例子，说明了带有随机平局决胜的整个DA算法是如何工作的。这个例子创建了一个任意的集合，其中4个学生的偏好高于学校，3个学校的偏好不严格高于学生。学校的配额是学校a，学校b，学校c = 1，2，1。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">示例:带随机平局决胜的DA算法</p></figure><p id="24b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个函数的输出是:</p><p id="b388" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">{('a '，' A'): (1，0)，(' C '，' C'): (1，0)，(' d '，' B'): (1，1)，(' B '，' B'): (3，2)}。</p><p id="5557" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以学校" A "收了学生" A "，学校" B "收了学生" B "和" d "，学校" C "收了学生" C "，这看起来像是我们所期望的。</p><h1 id="338a" class="mc md it bd me mf nn mh mi mj no ml mm jz np ka mo kc nq kd mq kf nr kg ms mt bi translated">4.结论和未来工作</h1><p id="44d0" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">本文简要介绍了DA算法的概念及其在择校中的应用，以及它的Python实现。这里介绍的算法是基本算法，也有一些算法的变体，例如，Erdil和Ergin (2008)提出的稳定改进周期(sic)。这种算法交换分配后的学生随机平局打破。尽管它不再是策略证明的，但该算法显著提高了其效率(Abdulkadiroglu等人，2009)。因此，作为未来的工作，这将是一个伟大的下一步实现这一点。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d5db" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">参考</h1><p id="3b0d" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">Abdulkadiroglu，a .和Sonmez，T. (2003年)。一种机制设计方法。美国经济评论，93(3):729–747。</p><p id="7033" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Abdulkadiroglu，a .和Pathak，P. A .和Roth，A. E,《策略的严密性与匹配差异的效率:重新设计纽约市高中比赛》。美国经济评论，99(5):1954-1978。</p><p id="42dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">杜宾斯，L. E .和弗里德曼，D. A. (1981年)。马基雅维利和盖尔-沙普利算法。美国数学月刊，88(7):485–494。</p><p id="67f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">盖尔和沙普利(1962)。大学录取和婚姻的稳定性。美国数学月刊，69(1):9–15。</p><p id="444b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">罗斯(1982年)。匹配经济学:稳定性和激励。运筹学数学，7(4):617–628。</p></div></div>    
</body>
</html>