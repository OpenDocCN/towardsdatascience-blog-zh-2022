<html>
<head>
<title>Using MLflow To Track Machine Learning Experiments</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 MLflow 跟踪机器学习实验</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-mlflow-to-track-machine-learning-experiments-adbf27e9d36c#2022-03-22">https://towardsdatascience.com/using-mlflow-to-track-machine-learning-experiments-adbf27e9d36c#2022-03-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="306e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">物流跟踪简介</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d01cd96bd8ebb1b9c254ba4c5129a98c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T69MzDADVxfcePc0"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://unsplash.com/photos/6TKVyi11oCM" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="42e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">机器学习生命周期有各种各样的步骤，需要在生产的道路上加以考虑。简而言之，这绝不像训练您的模型一次，然后直接投入部署那么简单。<strong class="lb iu"> ML 是一个迭代的过程</strong>，你将需要许多周期的训练和所有的组件来获得你的用例的最佳模型。</p><p id="d82b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://mlflow.org/" rel="noopener ugc nofollow" target="_blank"> MLflow </a>是一个开源平台，通过四个主要组件帮助端到端地管理这个 ML 生命周期:<a class="ae ky" href="https://mlflow.org/docs/latest/tracking.html" rel="noopener ugc nofollow" target="_blank"> MLflow 跟踪</a>、<a class="ae ky" href="https://mlflow.org/docs/latest/projects.html" rel="noopener ugc nofollow" target="_blank"> MLflow 项目</a>、<a class="ae ky" href="https://mlflow.org/docs/latest/models.html" rel="noopener ugc nofollow" target="_blank"> MLflow 模型</a>和<a class="ae ky" href="https://mlflow.org/docs/latest/model-registry.html" rel="noopener ugc nofollow" target="_blank">模型注册</a>。<strong class="lb iu">在本文</strong>中，我们将具体了解如何使用<strong class="lb iu"> MLflow Tracking </strong>管理/监控<strong class="lb iu">模型训练</strong>的不同迭代。我们将通过一个简单的 Sklearn 线性回归示例来了解波士顿住房数据集。如果你想直接跳到代码，这里是<a class="ae ky" href="https://github.com/RamVegiraju/mlflow-tracking" rel="noopener ugc nofollow" target="_blank"> Github 库</a>。</p><h1 id="438c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">目录</h1><ol class=""><li id="0c10" class="mn mo it lb b lc mp lf mq li mr lm ms lq mt lu mu mv mw mx bi translated">安装/设置</li><li id="ff47" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">MLflow 跟踪示例</li><li id="ce47" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">其他资源和结论</li></ol><h1 id="dd1c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">安装/设置</h1><p id="c3a7" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">这里的设置非常简单，因为 MLflow 是一个开源包，您可以使用它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安装 MLflow</p></figure><p id="951b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想获得 MLflow <a class="ae ky" href="https://www.mlflow.org/docs/latest/quickstart.html" rel="noopener ugc nofollow" target="_blank">文档</a>的完整访问权限，请从他们的<a class="ae ky" href="https://github.com/mlflow/mlflow" rel="noopener ugc nofollow" target="_blank">库</a>开始，其中还附带了一大组<a class="ae ky" href="https://github.com/mlflow/mlflow/tree/master/examples" rel="noopener ugc nofollow" target="_blank">示例</a>，涵盖了我们讨论过的所有主要组件。</p><p id="51b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要开始使用我们的模型，请创建一个示例 Python 文件，并在您的环境中添加以下包(如果没有安装的话)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">例如包装</p></figure><h1 id="ee5d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">MLflow 跟踪示例</h1><p id="8641" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我们现在可以开始构建将由 MLflow 跟踪的模型。在开始我们的模型构建之前，我们将创建一个主函数来捕获我们的模型和 MLflow 跟踪。在这个函数中，我们需要首先创建一个将被跟踪的 MLflow 实验。这可以通过对 MLflow 库使用<a class="ae ky" href="https://www.mlflow.org/docs/latest/python_api/mlflow.html#mlflow.set_experiment" rel="noopener ugc nofollow" target="_blank"> set_experiment </a>调用来完成。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建 MLflow 实验</p></figure><p id="e977" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们设置一个活动的实验来跟踪，如果这个实验不存在它是为我们创建的。现在，我们可以构建我们的模型，我们将使用 MLflow 进行跟踪。对于 Boston Housing 数据集，我们将使用 Sklearn 构建一个简单的<a class="ae ky" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html" rel="noopener ugc nofollow" target="_blank">线性回归</a>模型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">模特培训</p></figure><p id="e07f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在模型训练之后，我们可以捕获一个样本度量，例如<a class="ae ky" href="https://www.statisticshowto.com/probability-and-statistics/regression-analysis/rmse-root-mean-square-error/#:~:text=Root%20Mean%20Square%20Error%20(RMSE)%20is%20the%20standard%20deviation%20of,the%20line%20of%20best%20fit." rel="noopener ugc nofollow" target="_blank"> RMSE </a>，我们可能希望根据我们脚本的不同迭代来监控/跟踪它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">RMSE 公制</p></figure><p id="5c2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以通过使用<a class="ae ky" href="https://www.mlflow.org/docs/latest/python_api/mlflow.html#mlflow.log_metric" rel="noopener ugc nofollow" target="_blank"> log_metric </a> API 调用，使用特定的 MLflow 来跟踪这个指标。这里，我们将 RMSE 指定给 log_metric 调用，以便 MLflow 在模型的迭代中进行跟踪。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用 MLflow 跟踪指标</p></figure><p id="afce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里没有涉及的另一个关键特性是，您<strong class="lb iu">可以指定您希望 MLflow 跨实验跟踪的超参数</strong>。这可以通过在<a class="ae ky" href="https://www.mlflow.org/docs/latest/python_api/mlflow.html#mlflow.log_param" rel="noopener ugc nofollow" target="_blank"> log_param </a>中的类似调用来完成。这对于更复杂的算法尤其有用，当您在实验中对不同的超参数进行基准测试/比较时也是如此。</p><p id="7414" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以使用模型注册中心来记录我们的模型。MLflow 附带了一个专门为 Sklearn 模型制作的 API <a class="ae ky" href="https://mlflow.org/docs/latest/model-registry.html#adding-an-mlflow-model-to-the-model-registry" rel="noopener ugc nofollow" target="_blank">调用</a>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将模型记录到模型注册表中</p></figure><p id="2e5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果我们运行这个 Python 文件几次，我们应该会看到一个 RMSE 显示。与此同时，运行将被捕获到一个名为<strong class="lb iu"> mlruns </strong>的目录中，该目录将在执行 Python 文件时创建。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/6ed3ff3ab84e279236142beb79535e9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/format:webp/1*Q1_ckjEswcnNYZq7fNMhAA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">mlruns 目录已创建(作者截图)</p></figure><p id="0ead" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">MLflow 的真正力量来自简单的 UI 界面，您可以利用它来可视化这些不同的实验。<strong class="lb iu">在与 Python 文件相同的目录中，在终端中运行下面的命令</strong>,您应该能够访问 UI。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="8f10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开 UI 后，您应该能够在侧面板上看到我们创建的实验。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/dc31ab02ebd0e24f25a97f51aad85cce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*Ba88570OMxN952Js4-HNfQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">实验已创建(作者截图)</p></figure><p id="484b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们点击这个实验，我们应该看到我们执行模型训练的不同运行/次数。我们还应该看到我们在 RMSE 记录的指标。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/62eb3409c454a76cde6d6d83ce53b472.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PwqJJFxCfhOGuecw8MVKoA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">实验运行(作者截图)</p></figure><p id="cb0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着实验变得越来越复杂，您可以添加更多的指标、参数，并轻松过滤这些运行，以获得最佳性能的模型。为了进行进一步的查询或可视化，您还可以下载一个 CSV 文件，使用 Pandas、Matplotlib 等库进行比较。</p><h1 id="4f11" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">其他资源和结论</h1><p id="9db0" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">MLflow 是一个非常强大的工具，可以轻松跟踪您的大规模 ML 实验。当试图将你的 ML 生命周期推向生产时，考虑这样的工具是必要的。每一步都需要监控和维护，MLflow 使这一过程非常直观和易于使用。</p><p id="d70c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这是对 MLflow 和 MLOps 入门的有用介绍。在以后的文章中，我们将探索更复杂的例子和 MLflow 的其他特性，比如模型托管。</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="a5e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ns">如果你喜欢这篇文章，请在</em> <a class="ae ky" href="https://www.linkedin.com/in/ram-vegiraju-81272b162/" rel="noopener ugc nofollow" target="_blank"> <em class="ns"> LinkedIn </em> </a> <em class="ns">上与我联系，并订阅我的媒体</em> <a class="ae ky" href="https://ram-vegiraju.medium.com/subscribe" rel="noopener"> <em class="ns">简讯</em> </a> <em class="ns">。如果你是新手，使用我的</em> <a class="ae ky" href="https://ram-vegiraju.medium.com/membership" rel="noopener"> <em class="ns">会员推荐</em> </a> <em class="ns">报名。</em></p></div></div>    
</body>
</html>