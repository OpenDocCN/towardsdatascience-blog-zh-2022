<html>
<head>
<title>Introduction to PandaSQL: The Downsides No One Talks About</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PandaSQL简介:没人谈论的缺点</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-downsides-of-pandasql-that-no-one-talks-about-9b63c664bef4#2022-07-25">https://towardsdatascience.com/the-downsides-of-pandasql-that-no-one-talks-about-9b63c664bef4#2022-07-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a60e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">熊猫+ SQL = PandaSQL =一塌糊涂</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/104cb1d57cb2c6c553c91143370d2e20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hATY1a-JFrrhgbFO"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@mrthetrain?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">约书亚·赫内</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="1f43" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结构化查询语言(SQL)和Pandas无疑是数据科学家管理、处理和分析表格数据的首选工具。</p><p id="6ce8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然Pandas是数据科学家使用的用于数据分析的流行Python库，但SQL是其自身的完整编程语言，用于与跨越计算机科学各个领域的数据库进行交互。它们之间有一个突出的共同点，那就是它们都是处理表格数据的不可思议的工具。</p><p id="0a8b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">PandaSQL 是一个流行的python包，它融合了Pandas和SQL，允许您在python环境中利用SQL语法的强大功能。因此，PandaSQL使您能够使用SQL语法查询pandas数据帧——对于不熟悉或不习惯Pandas语法的人来说，这是一个巨大的胜利。</p><p id="1449" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这篇文章是对PandaSQL的介绍。我将演示如何在示例查询中使用PandaSQL。最后，我将比较Pandas和PandaSQL的运行时差异。简要概述如下:</p><p id="2964" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="#1289" rel="noopener ugc nofollow"><strong class="ky ir">panda SQL</strong></a><strong class="ky ir"><br/></strong><a class="ae kv" href="#ab40" rel="noopener ugc nofollow"><strong class="ky ir">panda SQL</strong></a>的注意事项</p><p id="7de1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这里找到这篇文章<a class="ae kv" href="https://deepnote.com/workspace/avi-chawla-695b-aee6f4ef-2d50-4fb6-9ef2-20ee1022995a/project/PandaSQL-a196556e-7a37-433d-bd8f-beb19b838913/%2Fnotebook.ipynb" rel="noopener ugc nofollow" target="_blank">的笔记本。</a></p><p id="e4d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们开始吧🚀！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="1289" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">PandaSQL入门</h1><p id="0f14" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">如上所述，PandaSQL是一个python库，它为您提供了在Pandas数据帧上执行SQL查询的灵活性。下面详细演示了实现这一点的逐步过程。</p><h2 id="b5d6" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">步骤1:安装PandaSQL</h2><p id="aa6b" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">首先，使用<code class="fe ni nj nk nl b">pip</code>安装PandaSQL库。你可以在这里找到说明<a class="ae kv" href="https://pypi.org/project/pandasql/" rel="noopener ugc nofollow" target="_blank">或者使用下面的命令来安装它:</a></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><h2 id="e977" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">第二步:进口要求</h2><p id="7527" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">接下来，我们导入上面安装的库和这个项目中需要的其他预安装的库。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no nn l"/></div></figure><h2 id="f9e4" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">步骤3:创建虚拟数据集</h2><p id="2ea8" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">为了理解如何在使用PandaSQL的pythonic环境中使用SQL，我们将创建一个包含一万名雇员的虚拟数据集。以下代码后面的图像显示了数据集的一瞥。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nn l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/d1c2866f312c0c1c5e4d4b3f58687889.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eonXOMNVRZVEmS_8.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数据帧的前五行(图片由作者提供)。</p></figure><h2 id="1a6b" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">步骤4: <strong class="ak">创建PandaSQL环境</strong></h2><p id="13b8" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">下一步是设置SQL环境，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="99b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们创建一个lambda函数，它接受一个查询<code class="fe ni nj nk nl b">q</code>和程序范围内的变量，使用<code class="fe ni nj nk nl b">globals()</code>返回一个python字典。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr nn l"/></div></figure><p id="6681" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本质上，SQL查询在Python中被写成字符串。为了让PandaSQL解释字符串中指定的表名及其列名，我们使用<code class="fe ni nj nk nl b">globals()</code>方法检索所有全局变量，并将其传递给定义的lambda函数。步骤3中定义的<code class="fe ni nj nk nl b">data</code>数据帧可以使用<code class="fe ni nj nk nl b">globals()</code>引用，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nn l"/></div></figure><h2 id="f8f5" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">步骤5:在Pandas数据帧上运行SQL查询</h2><p id="051e" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">一旦建立了SQL环境，就可以继续执行SQL查询。PandaSQL使用的SQL语法与传统的SQL语法完全相同。</p><h2 id="0651" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">查询1:</h2><p id="2893" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">例如，让我们编写一个查询来计算数据帧中的记录数。下面演示了这一点:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nn l"/></div></figure><h2 id="7463" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">问题2:</h2><p id="ab97" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">接下来，如果您想基于某个条件查询数据帧，可以使用SQL中的<code class="fe ni nj nk nl b">where</code>子句，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nn l"/></div></figure><h2 id="4be4" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">问题3:</h2><p id="f879" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">最后，如果您想获得给定数据中每个组织对应的记录数，您可以使用<code class="fe ni nj nk nl b">groupby</code>子句:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nn l"/></div></figure><p id="250b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与我在上面三个示例查询中演示的类似，您可以编写自己选择的任何SQL查询，并使用PandaSQL库在Pandas DataFrame上执行它。</p><h1 id="ab40" class="lz ma iq bd mb mc nw me mf mg nx mi mj jw ny jx ml jz nz ka mn kc oa kd mp mq bi translated">PandaSQL的警告</h1><p id="f67c" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">对于不熟悉Pandas要求的pythonic语法的SQL背景的人来说，PandaSQL无疑是一个很好的选择。例如，在聚合多个列时，过滤数据帧或在特定列上对它们进行分组可能会让人感到有些不知所措或困惑。但是这些东西在SQL中很容易实现和解释。</p><p id="2241" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，这种在Pandas中轻松利用SQL的方式带来了巨大的额外运行时成本。为了更好地理解这一点，我们来比较一下PandaSQL和Pandas的运行时。我们将用SQL编写一个查询，然后将运行时与其在Pandas中的相应实现进行比较。如果你不熟悉基本SQL查询到Pandas操作的翻译，我推荐你阅读我下面的帖子:</p><div class="ob oc gp gr od oe"><a rel="noopener follow" target="_blank" href="/translating-sql-queries-to-pandas-operations-2d27c354b8a2"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">将SQL查询转换为Pandas操作</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">Pandas中的SQL查询及其对应方法</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">towardsdatascience.com</p></div></div><div class="on l"><div class="oo l op oq or on os kp oe"/></div></div></a></div><h2 id="09a0" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">语法警告:</h2><p id="a5d8" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">Python已经有很多名字被保留为关键字，比如<code class="fe ni nj nk nl b">for</code>、<code class="fe ni nj nk nl b">while</code>、<code class="fe ni nj nk nl b">in</code>、<code class="fe ni nj nk nl b">if</code>、<code class="fe ni nj nk nl b">else</code>、<code class="fe ni nj nk nl b">elif</code>、<code class="fe ni nj nk nl b">import</code>、<code class="fe ni nj nk nl b">as</code>等。SQL的引入引入了围绕变量命名的进一步限制，如更多的关键字，如<code class="fe ni nj nk nl b">create</code>、<code class="fe ni nj nk nl b">like</code>、<code class="fe ni nj nk nl b">where</code>、<code class="fe ni nj nk nl b">having</code>等。，不能再用作变量名。我在下面实现了这样一个场景:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ot nn l"/></div></figure><h2 id="d82f" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">执行运行时警告</h2><p id="9a50" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">虽然可以通过修改变量名来一次性处理语法警告，但运行时引入的开销却非常令人担忧。请考虑下面的问题，以便更好地理解。</p><h2 id="7e51" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">查询1:</h2><p id="67eb" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">首先，让我们比较一下计算数据帧中记录数量的运行时间。下面用PandaSQL和Pandas演示了这一点:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ou nn l"/></div></figure><p id="3fe3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了计算行数，PandaSQL使用的运行时间比pandas<code class="fe ni nj nk nl b">shape</code>属性多近t13倍t14倍的10⁵时间。</p><h2 id="24c4" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated"><strong class="ak">查询2: </strong></h2><p id="31ba" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">接下来，让我们比较运行时间，找出给定数据帧中对应于每个组织的记录数。这在下面实现:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ou nn l"/></div></figure><p id="1e20" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">熊猫又一次以相当大的优势超过了PandaSQL。在这种情况下，Pandas比PandaSQL快70倍。</p><h2 id="6e25" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">问题3:</h2><p id="deab" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">现在，我将演示基于使用PandaSQL和Pandas的条件过滤数据帧的运行时差异。SQL查询及其对应的Pandas方法实现如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ou nn l"/></div></figure><p id="520b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与基于Pandas的方法相比，PandaSQL在过滤操作上花费了多160倍的时间。</p><h2 id="5b13" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">问题4:</h2><p id="0938" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">最后，让我们考虑一下连接的运行时差异。我们将在给定的数据帧上实现自连接。下面演示了这一点:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov nn l"/></div></figure><p id="866e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，熊猫又一次成为了明显的赢家，它以27倍于T21的成绩超过了PandaSQL。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="8cba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">总之，我同意PandaSQL是一个完美的工具，如果你对熊猫感到不舒服的话。然而，毫无疑问，这是<strong class="ky ir">而不是</strong>一个人应该期待在其数据管道中利用的长期解决方案。相反，花有意义的时间了解熊猫和它们相应的方法是一个人可以采取的最佳方式。</p><p id="2e16" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是学习整个熊猫图书馆可能是具有挑战性的，不是吗？别担心。阅读我下面的博客开始吧。</p><div class="ob oc gp gr od oe"><a rel="noopener follow" target="_blank" href="/20-of-pandas-functions-that-data-scientists-use-80-of-the-time-a4ff1b694707"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">数据科学家80%的时间使用熊猫20%的功能</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">将帕累托法则运用于熊猫图书馆</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">towardsdatascience.com</p></div></div><div class="on l"><div class="ow l op oq or on os kp oe"/></div></div></a></div><p id="83fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/64553645da9b885744de375b744b5d23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*VHRUkAQK8A6AQ6zYUFwkIQ.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者在<a class="ae kv" href="https://imgflip.com/" rel="noopener ugc nofollow" target="_blank">imgflip.com</a>创造的模因</p></figure></div></div>    
</body>
</html>