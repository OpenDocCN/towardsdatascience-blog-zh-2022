<html>
<head>
<title>Predicting conversion events from Google Analytics dataset for Google Merchandise store in BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在BigQuery中从Google商品商店的Google分析数据集预测转换事件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-conversion-events-from-google-analytics-dataset-for-google-merchandise-store-in-bigquery-1673f7b074fc#2022-05-02">https://towardsdatascience.com/predicting-conversion-events-from-google-analytics-dataset-for-google-merchandise-store-in-bigquery-1673f7b074fc#2022-05-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fbed" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">步骤2—大查询ML逻辑回归</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/923015d56f138e431dc72ea7a8e25369.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KEjVjhMP-PYS-O1na2tArw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">通过BigQuery ML使用GA数据预测Google商品商店转化率。图片作者。</p></figure><p id="1491" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di">在</span>我们的<a class="ae me" href="https://bit.ly/3F3g1hI" rel="noopener ugc nofollow" target="_blank">上一篇</a>文章中，我们介绍了使用谷歌商品商店的谷歌分析数据集在BigQuery和DataStudio中进行探索性数据分析的基础知识。作为该流程的一部分，我们考察了各种维度——营销渠道、州、操作系统、浏览器、设备类型、星期几、小时、月份等等。正在考虑的指标包括页面浏览量、访问量、订单、销售额、现场时间。此外，我们采取了一些数据清理步骤来删除错误标记为美国的地区，通过选择感兴趣的维度和指标来执行基本的数据准备，并计算其他指标，如转换率、跳出率、每位访问者的销售额、每次访问的销售额、平均订单价值，并根据上述参与度和维度进一步总结我们的数据。我们现在已经准备好开始预测我们的哪些web会话将会看到访问者更有可能进行购买。幸运的是，<a class="ae me" href="https://bit.ly/3Evbzbd" rel="noopener ugc nofollow" target="_blank"> BigQuery ML </a>提供了一个自动化的机器学习解决方案，使用逻辑回归实现了这样的预测。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/8e42dcc26d7c8ad3d8abe5cdb7b13fb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*v_FmmIRVpdxUlSNSYK2o0A.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ky">工作中的BigQuery ML示例</strong></p></figure><p id="0b1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">步骤1 —数据分析</strong></p><p id="c933" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了比我们已经完成的更彻底的EDA之外，我们可以使用下面的查询对数据集运行一些基本的描述性统计数据:</p><p id="0067" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="mg">描述性统计</em> </strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="9bc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们试图通过显示感兴趣的指标来总结我们的数据——订单数[11，420]、会话数[364，210]、访客数[251，257]、页面浏览量[&gt; 200万]、网站停留时间[2.2年！]我们还可以计算衍生指标，如转换率[3.14%]、每个用户的会话数[1.45]、每个访问者的页面浏览量[8.06]、每个访问者在网站上的平均时间[4.61分钟。]下一步是计算参与度和转化率指标的最小/最大/范围/平均/标准偏差和方差的值。现场时间标准差【7.36分钟】两个以上(！)倍于平均会话持续时间[3.18分钟。]同样，页面浏览量[8.89]的标准差是1.6(！)比5.57的平均页面浏览量高一倍，表明这些指标的实际值分布得相当广泛，而不是集中在平均值周围。注意，除了<em class="mg">范围</em>(它只是最小值和最大值之间的差)，所有其他计算都内置在BigQuery的SQL风格中。除此之外，我们还能够估计BigQuery中的一些<a class="ae me" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/statistical_aggregate_functions" rel="noopener ugc nofollow" target="_blank">统计聚合函数</a>:</p><p id="9f28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">方差</em>。</p><p id="89aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">相关性</em> —皮尔森相关系数——似乎网站时间与订单的相关性较弱[0.34]，而页面浏览量的相关性则更为适中，为0.45。请记住，我们首先需要指定我们的因变量[订单]。]</p><p id="b565" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">协方差[Pop] —显示两个随机变量的<em class="mg">联合</em>可变性。如果该值大于0，则一个变量的较大值对应于另一个变量的较大值。在我们的例子中，页面浏览量对订单的协方差[0.76]比网站时间0.47大得多:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/05fd5cb48dc636b02554b5fdc973bd4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*CnaMvaOaYLD5CSJ54xJ8fg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ky">描述性统计汇总表。图片作者。</strong></p></figure><p id="4fcc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有两个要点:参与度指标似乎确实与订单有相关性和协方差关系；其中这些关系在页面视图中比在网站上的时间更明显。我们现在准备开始构建模型以进行进一步评估。</p><p id="2698" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">步骤2——模型创建</strong></p><p id="26cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">“厨房水槽”型号。</em></p><p id="ad4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">BigQuery ML的神奇之处在于，我们能够用几行简单的SQL语句运行相当强大的算法，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="85cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们解开这段代码。我们从创建(或者替换已经存在的模型)开始，然后通过BigQuery ML指定一些可用的选项:对于model_type参数，我们选择<em class="mg">逻辑回归</em>作为参数，告诉BigQuery我们想要运行哪种类型的模型。我们为我们的编码方法选择了<em class="mg">哑元编码</em>，它使用了<strong class="lb iu"> N-1个</strong>哑元变量vs <strong class="lb iu"> N个</strong>哑元变量，这些哑元变量在<em class="mg"> One_Hot_Encoding </em>方法下会被使用。举例来说，对于<em class="mg">设备</em>类型的桌面、移动和平板电脑，假设平板电脑是网站访问者最不喜欢的设备，我们的功能栏如下所示。请注意，当桌面和移动设备都设置为false时，意味着平板设备:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/1196e2b0cb1c6b83d4728da45cb2ad53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*XwUZ6vrv90c-YpjiCQmzUg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ky">类别编码的类型。图片作者。</strong></p></figure><p id="53fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是启用CALCULATE_P_VALUES选项，我们将在稍后使用ML_ADVANCED_WEIGHTS命令时感谢它。我们要激活的最后一个选项是ENABLE_GLOBAL_EXPLAIN，如果我们想在以后汇总评估数据的解释，这个选项会很有用。</p><p id="26f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，BigQuery ML语法要求指定Google称之为“标签”的内容，这个概念您可能已经看到过，也被称为独立/预测/结果/响应变量。我们的目标是预测订单放置转换事件；换句话说，我们正在寻找已下单的会话，而不管是否有人下了1个或25个(数据发布)订单。因此，我们将使用<strong class="lb iu"> Orders≥ 1 </strong>条件来定义下订单的TRUE/1事件，如果没有下订单，则为False/0。</p><p id="84b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将把这个模型— <strong class="lb iu"> v1 </strong>称为“厨房水槽”类型的模型，因为我们将在我们的算法中使用一个全面的、尽管数量有些过多的不同维度和度量:<em class="mg">设备、操作系统、浏览器、频道、持续时间分钟、小时24、星期几、星期几、月份、状态、访问量、页面浏览量、来源、</em>和<em class="mg">媒介。</em>在我们之前的帖子中，我们再次证明了这些维度和指标在EDA阶段确实显示了值得注意的结果。</p><p id="d9f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们建模过程的最后一步是我试图保持事情的真实性，而不是仅仅根据历史数据假设性地评估我们的结果，选择使用一部分数据作为我们的<em class="mg">训练</em>数据集，剩余部分作为<em class="mg">测试</em>数据。为了帮助我们预测的准确性，我们希望向模型提供尽可能多的数据，因此让我们使用前11个月的数据来训练我们的模型。然后，让我们使用过去32天的GA数据(对我们的目的来说足够有代表性)来确认该模型是有效的(预测有序和无序事件)还是无效的(不运行有意义的预测)。)</p><p id="57de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">BigQuery ML的另一个好处是，我们可以有效地大规模迭代，并运行各种版本的模型来确定“获胜”的模型。此外，现实世界中经常出现一些警告，使得继续使用性能最佳的模型变得不切实际，因此可能需要不同的备用选项。毕竟，我们真的要通过一个广泛的清单来运行我们的访问者，以确定更高的交易可能性，或者有一个足够好的最佳点，让我们接近最佳结果，而不会使我们的任务过于复杂。我建议多运行10个模型:</p><p id="87b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">v2</strong>T6用于频道，时长分钟，小时24，星期几，访问量，浏览量</p><p id="751b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> v3 </strong> <em class="mg">用于</em>频道、时长分钟、星期几、访问量、浏览量</p><p id="7ebd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> v4 </strong></p><p id="1e92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> v5 </strong></p><p id="014f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">V6</strong>T22时长分钟，浏览量</p><p id="316e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">V7</strong>T26时长分钟</p><p id="f442" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">V8</strong>T30浏览量</p><p id="915e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">v9</strong>T34持续时间_Bucket，浏览量_Bucket</p><p id="d7c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">v10</strong>T38】为持续时间_铲斗</p><p id="5384" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">v11</strong>T42浏览量_斗</p><p id="b1ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">第三步——评估我们的模型</strong></p><p id="f8c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就我个人而言，我支持v6版本，因为根据我阅读的一些研究、我们EDA实践的结果以及个人轶事信念，我相信参与度指标让我们更接近可靠的预测，而不会因为考虑其他指标或维度而使我们的生活变得过于困难。好消息是，我们不必仅仅依靠我的直觉，因为BigQuery包括<strong class="lb iu"> ML。评估</strong>命令就是这样做的— <em class="mg">评估</em>我们模型的性能。</p><p id="cf58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在继续下一步之前，让我们确保理解我们将在后面提到的重要术语:</p><p id="3ccf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">真阳性</em>—模型正确预测条件成立时的结果。对我们来说，这描述了一个订单被预测和订单实际发生的情况。</p><p id="6b09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">真阴性</em>—模型正确预测条件不成立的结果。在我们的例子中，这指的是一个订单没有被预测的情况，一个订单实际上没有发生。</p><p id="6380" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">假阳性</em>又名。<em class="mg">类型1错误】</em>——显示事件存在的(不正确)测试结果，而这种情况并不存在。在这里，我们会看到一个预测的秩序，但秩序实际上并没有发生。</p><p id="686e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">假阴性</em>又名。<em class="mg">类型2错误</em>或<em class="mg">遗漏错误】</em> —错误指示条件不成立的测试结果。对我们来说，这意味着秩序不是预测出来的，而是实际发生的。</p><p id="a28b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在BigQuery ML的快速帮助下，我们可以检索以下内容:</p><p id="de0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">精度</em> —预测阳性与实际阳性的比例<strong class="lb iu"> =真阳性/(真阳性+假阳性)</strong>。让我们将这种测量放在上下文中:虽然在识别真阳性与所有阳性的比率方面肯定有用，但如果我们有过多的假阴性，这种度量本身并不能提供足够的分析，因此可能会影响对我们能够分类的一些事件的准确识别，但会错过我们未能识别的大部分事件。</p><p id="107e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">回忆</em> —预测阳性的实际阳性比例<strong class="lb iu"> =真阳性/(真阳性+假阴性)</strong>。这项措施解决了我们对<em class="mg">精确度的担忧，</em>却忽略了误报，这可能会影响我们的整体<em class="mg">精确度</em>。请注意，该指标也被称为<em class="mg">敏感度</em>或<em class="mg"> TPR </em>(真实阳性率。)</p><p id="f0fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">准确度</em> —给定正确标签的预测分数<strong class="lb iu"> =(真阳性+真阴性)/(假阳性+假阴性)。</strong>当然，这是迄今为止我们在这一点上考虑的最有希望的指标，但是，我们需要注意我们的真实和虚假事件的不均衡分布，这可能是典型的电子商务网站的情况——我们的web会话中只有一小部分(准确地说是Google商品商店的3%)有订单事件，留给我们的是非事件的巨大份额[每次网站访问的100次中有97次。]因此，具有o 订单的会话<em class="mg">的准确性与没有</em>订单的会话<em class="mg">的准确性明显不同，但这一重要的细微差别在汇总期间丢失了[97%的非事件准确性将使3%的“多事”会话的准确性相形见绌。]</em></p><p id="3630" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg"> F1得分</em> —精度和召回率的调和平均值<strong class="lb iu">= 2 *精度*召回率/(精度+召回率)</strong>这是一个数学“胶水”，帮助我们看精度和召回率的综合效果。</p><p id="0437" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">对数损失</em>—0(完美)到1之间的模型性能的度量。对数损失越大，预测概率与实际标签的偏差就越大。</p><p id="a00a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg"> ROC AUC </em> —受试者操作特征曲线下面积。<em class="mg"> ROC曲线</em> —受试者工作特征(ROC)曲线显示了真阳性率和假阳性率之间的权衡。较低的阈值导致较高的真阳性率(和较高的假阳性率)，而较高的阈值导致较低的真阳性率(和较低的假阳性率)</p><p id="f70b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">…下面是一次对所有11个模型运行评估的SQL代码，没有树受损/ <em class="mg">字节用于运行它:</em></p><p id="5960" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="mg">评估车型</em> </strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="09ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了简单地查看结果，我还会推荐<em class="mg">按顺序排列</em>。这应该有助于我们更容易地识别最佳性能模型。请注意，与所有其他指标不同，Log_Loss应该按照<em class="mg">升序</em>排序，因为最低值代表最佳结果。排名的其他计算包括计算<em class="mg">总</em>【排名】分数——较低的结果表示表现更好的模型；和<em class="mg">平均</em>排名。</p><p id="3e4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">看下面的结果，很不幸，我们不得不忽略模型v9、v10和v11的Precision、Recall和F1_Score结果，因为这些模型只包含分类值，并且无法计算非标准化截距的回归统计。</em></p><p id="d75c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">毫不奇怪，我们的“厨房水槽”模型/v1表现相当好，尽管它没有占据模型v8的第一名，模型V8只关注<em class="mg">浏览量</em>。[虽然v1在精确度、召回率和F1_Score方面击败了v8，但它在精确度、对数损失和ROC_AUC方面有所欠缺。有趣的是，我最喜欢的v6模式[页面浏览量和网站停留时间]有点落后，排在第四位，与v8模式相比表现不佳，略落后于V5[页面浏览量、网站停留时间和访问次数。]</p><p id="8a79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，考虑到上述因素，我们可以根据指标的作用选择不同的权重——例如，在我们的用例中，精度可能没有召回重要。但是这是一个单独讨论的主题，集中在我们以后可能承担的特征工程任务上。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ml"><img src="../Images/d3ff9b686747f65fa44e625567720d9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_XgPVB_9jND-ctLRHlln9w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ky">模型评估结果。图片作者。</strong></p></figure><p id="c665" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之前已经设置了阶段并在创建模型阶段选中了适当的框，我们准备使用高级权重计算来检索大量有趣的摘要。为了更全面地了解功能，让我们使用一个具有分类维度的模型，例如模型<strong class="lb iu"> v11 </strong>中的<em class="mg"> PageViews_Bucket </em>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="a8ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">毫升。advanced _ WEIGHTS</strong>检索与<strong class="lb iu"> ML相同的字段。重量</strong>还有一些:</p><p id="a3a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg"> Processed_Input — </em>模型特征输入的名称。<em class="mg"> ( </em>如果特性为非数字，那么将有多个具有相同字符串的行，每个特性类别一行。)</p><p id="c7a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">类别</em> —输入列为非数字时的类别名称(对于数字列为空。)</p><p id="bde9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">权重</em> —每个特征的<a class="ae me" href="https://developers.google.com/machine-learning/glossary/#weight" rel="noopener ugc nofollow" target="_blank">权重</a>/系数。训练线性模型的目标是确定每个特征的理想权重。如果权重为0，则它对应的特征对模型没有贡献。对于数字列，weight包含一个值，并且<em class="mg"> category_weights </em>列为空。</p><p id="2dcd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">标准误差</em>—重量的标准误差(抽样分布的标准偏差。)</p><p id="ab5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">p值——针对零假设的测试，表明观察到的结果并非偶然，事实上具有统计学意义(p值≤0.05)</p><p id="96d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于模型<strong class="lb iu"> v11 </strong>，我们显示“退回”的会话(浏览量= 1)具有负权重，或者显示这样的会话不太可能产生订单事件。同时，浏览超过25页的会话、21-25页和16-20页的会话更有可能与转换相关联:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mm"><img src="../Images/f27f832ef85578e2b4844b0b20741d83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4HSXtSXh2LZgZFkedou17w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ky">高级权重检索。图片作者。</strong></p></figure><p id="6109" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在为我们的BigQuery模型设置选项时做好充分准备的另一个好处是我们能够运行<strong class="lb iu"> GLOBAL_EXPLAIN </strong>命令，该命令使用Google专有的<em class="mg">explable AI</em>生成结果。使用<strong class="lb iu"> v5 </strong>型号示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="35c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">特征</em>简单地列出我们特征的名称，而<em class="mg">属性</em>显示相应特征对模型整体的重要性。对于模型<strong class="lb iu"> v5 </strong>我们可以清楚地证明，在考虑的三个特性中，<em class="mg">页面浏览量</em>的权重最大，它对模型的重要性是<em class="mg">在站点上的时间</em>和46.3(！)次比<em class="mg">更重要的访问编号</em>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/733f97563ed74df0f16d205ff581855f.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*KwAHRFiY7zKQS3Bc5JhaZA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ky">为考虑的特征建模权重。图片作者。</strong></p></figure><p id="8089" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">BigQuery ML还支持基于GUI的模型性能可视化摘要。我们可以探索培训、评估和可解释性选项卡，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/50a9061898bc33b363dd299cfab66385.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wyPLdVUr9xjM7Oydso-6KA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用于模型评估/可解释性的GUI界面。图片作者。</p></figure><p id="6ec8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="mg">训练</em> </strong>选项卡显示损失、每次迭代持续时间和学习率的图形表示。<em class="mg">可解释性</em>有效地让我们无需运行一行代码就能运行GLOBAL_EXPLAIN:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/7d6ccebbe080c832d69a7de0557b2c1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JaFceRpHfd8fE7lBt1Qdaw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ky">模型性能GUI下的培训和可解释性标签。图片作者。</strong></p></figure><p id="5828" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"><em class="mg">聚合指标</em>保持不变，显示我们模型的所有评估指标，无需运行任何SQL。</strong></p><p id="65f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">Precision-recall by threshold</em>—显示您的模型在整个置信度阈值范围内的最高得分标签上的表现。较高的置信度阈值会产生较少的假阳性，从而提高精确度。较低的置信度阈值会产生较少的假阴性，从而提高召回率。</p><p id="90cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">精确-召回曲线</em>——显示了在不同置信阈值下精确和召回之间的权衡。较低的阈值导致较高的召回率但通常较低的精确度，而较高的阈值导致较低的召回率但通常较高的精确度。</p><p id="b915" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg"> ROC曲线</em> —受试者工作特征(ROC)曲线显示了真阳性率和假阳性率之间的权衡。较低的阈值导致较高的真阳性率(和较高的假阳性率)，而较高的阈值导致较低的真阳性率(和较低的假阳性率)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/616bc9c1806c2068135658944d7bd047.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NSEKBXsCjAjJm9bPCkhyNw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ky">模型评估GUI(已扩展。)图片由作者提供。</strong></p></figure><p id="240e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">第4步——运行我们的预测</strong></p><p id="0c9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们没有那么幸运地将数据分成训练集和测试集；我们可以比较<em class="mg">订单</em> <em class="mg">预测</em>与实际<em class="mg">订单</em>的结果。为此，我们需要调用<strong class="lb iu"> ML。预测</strong>命令并传递所有必需的参数以满足我们模型的参数。[如果模型v6是使用<em class="mg"> Duration_Minutes </em>和<em class="mg"> PageViews </em>指标构建的，那么我们必须确保我们的预测调用包含这两个指标。]此外，期望的粒度级别使用会话级汇总，因此我们的代码模拟了这一需求。</p><p id="cad3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">提醒一下，我们所有的11个模型都是使用从2016年8月1日<em class="mg"/>开始到2017年6月30日<em class="mg"/>结束这段时间的数据构建的。因此，我们的模型还没有遇到包含2017年7月1日<em class="mg">到2017年8月1日</em>的<em class="mg">测试</em>，我们将使用它来运行我们的算法。除了执行我们的预测，我们还可以使用源表中的剩余数据将预测结果与实际事件状态进行比较。在下面的代码中，我试图清楚地描述我们的<em class="mg">预测器</em>标签与通过SELECT语句检索的实际订单之间的区别。让我们使用创建的三个模型来预测我们的订单:v1(“厨房水槽”)、v8(使用评估测量和我们的总结的组合排名最佳)和v6(我最喜欢的，它仅稍微落后于v5，并且需要少一个指标。):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="ca6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在分析我们的计算结果之前，让我们回忆一下定义，并尝试清楚地说明包含真阳性、真阴性、假阳性和假阴性的记录。我们将使用模型<strong class="lb iu"> v1: </strong>的第一个查询结果</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mr"><img src="../Images/2367b704dfcc6348a8760de3e56d3f7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DY-76xgOhikIhurso5owAQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ky">TP、TN、FP、FN图解。图片作者。</strong></p></figure><p id="a096" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">步骤5—分析结果</strong></p><p id="f70a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们知道有些会话似乎有多个订单，而且我们之前的目标是预测有订单的会话，而不是订单总数，因此我们将订单事件标准化为1，029，而不是总数1，072。使用本文前面列出的精确度/召回率/准确度/F1分数的公式，我们现在可以并排计算我们的模型的真实性能结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/10f30bb933761687e30a05ee0489a9cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*brsoRcifbF-O9fKsYqy5sw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ky">模型结果——观察与评估。图片作者。</strong></p></figure><p id="4cea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">准确性在这里是一个相当重要的衡量标准，尽管注意它在所有三个被分析的模型中几乎是一样的。尽管有之前的模型评估和我们的分析，但在现实条件下，模型<em class="mg"> v1 </em>确实比<em class="mg"> v8 </em>表现得更好。与准确性同样重要的是，有序会话和非有序会话的分布不成比例，这不是我们需要关注的唯一因素。总体而言，<em class="mg"> v1 </em>在所有感兴趣的指标中明显胜出。尽管模型<em class="mg">估计</em>显示其在<em class="mg">精确度</em>【96.63%对96.83%】方面比<em class="mg"> v8 </em>稍差，但使用我们的测试数据，我们能够获得97.01%对96.96%的结果。</p><p id="1a2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">精度</em>不太一致，但在所考虑的车型中仍具有可比性。鉴于相同的数据集模型<em class="mg"> v1 </em>检索到172个真阳性(准确的订单预测)，而模型<em class="mg"> v6 </em>检索到98个真阳性，即使当精度结果分别从52.28%交换到47.12%时，模型<em class="mg"> v1 </em>仍然是实际的赢家。即使<em class="mg"> Precision </em>对模型<em class="mg"> v6、</em>有一个完美的分数，我们将检索到208个真阳性，这仅比模型<em class="mg"> v6 </em>的172个真阳性高一点，精度为52%……显然，总阳性预测的数量也很重要，模型<em class="mg"> v6 </em>根本没有检测到足够多的阳性病例。我甚至认为，假设我们有模型的<em class="mg">召回</em>测量，我们可能想要完全跳过<em class="mg">精度</em>以避免在我们的分析中引入噪声。</p><p id="8cfc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">召回</em>显示车型<em class="mg"> v1 </em>的价值为16.72%，这比我们预测的赢家——V8车型的11.47%的性能高出很多。当然，不到17%的订单事件发生的会话被我们的算法正确识别，这听起来不像是值得大书特书的事情，但是考虑到随机预测订单事件的概率为3%，我们的预测是5.5(！)比靠运气有效几倍。即使有了模型v3，我们的机会也增加了三倍。</p><p id="ed9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg"> F1_Score </em>显示了<em class="mg"> Precision </em>和<em class="mg"> Recall </em>度量的代数组合行为，验证了我们到目前为止所见证的最佳性能模型的相同等级。</p><p id="4bb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用公式计算的其他指标是<em class="mg">特异性/TNR </em>和<em class="mg"> FPR </em>:</p><p id="2478" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">特异性</em>，又称<em class="mg"> TNR </em>(真阴性率)计算为<strong class="lb iu">真阴性/(真阴性+假阳性)。)</strong>这两种模型都将我们预测无序事件的几率提高了3%【1.03%对随机选择——在模型<em class="mg"> v6 </em>下，99.67%对97%的几率。]请注意，在此参数下，型号<em class="mg"> v6 </em>的性能优于<em class="mg"> v8 </em>和<em class="mg"> v1 </em>。这可能是因为它低于订单事件的数量。</p><p id="0a56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg"> FPR </em>，或假阳性率通过以下公式计算:<strong class="lb iu">假阳性/(假阳性+真阴性)</strong>或<strong class="lb iu"> 1 — <em class="mg">特异性</em> </strong>。</p><p id="9b9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">鉴于<em class="mg">页面浏览量</em>的重要性，我们可以运行额外的分析来显示购买与非购买会话的页面浏览量的差异，以及这些会话之间描述性统计的差异。请注意，虽然十分之四的购买会议的访问者浏览了超过25页的页面，但只有五十分之一的非购买会议看到了这种参与度:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/334f668a4c7872158ee0c9de11abec67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i6Zzdf6rvkYiQsTzXOuTYQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ky">购买与非购买会话的浏览量。图片作者。</strong></p></figure><p id="fd03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">请随意分享您对所讨论的分析和建模的想法。您希望我们考虑哪些其他因素？什么样的特征工程步骤可以提高我们的性能？</em></p></div></div>    
</body>
</html>