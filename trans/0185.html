<html>
<head>
<title>An Intuitive Guide to Track Your ML Experiments with MLflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用MLflow跟踪您的ML实验的直观指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/an-intuitive-guide-to-track-your-ml-experiments-with-mlflow-7ac50e63b09#2022-02-08">https://towardsdatascience.com/an-intuitive-guide-to-track-your-ml-experiments-with-mlflow-7ac50e63b09#2022-02-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9ce3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">帮助您改进Sklearn模型的重现性、管理和实验跟踪</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3152fdd94cb57a845490477bb20ac1e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*huLe5LTuNmpwNnSz"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Artem Maltsev 在<a class="ae ky" href="https://unsplash.com/photos/3n7DdlkMfEg" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="a8a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经浪费了很多时间来运行我的Jupiter笔记本，以建立一个具有最佳性能的机器学习模型。最佳解决方案主要取决于超参数的特定组合，在走到隧道尽头之前，很难记住我尝试过的所有实验。</p><p id="ef47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最近，我发现了MLflow，这是一个非常有效的开源平台，用于完整管理机器学习生命周期，其中的主要阶段是收集数据、数据准备、创建模型、模型训练和模型部署。它有非常好的功能，我将在下一节解释。</p><p id="4c2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我将重点关注MLflow跟踪训练跑步指标和每次跑步实验的模型超参数的能力<strong class="lb iu">。我将通过一个用Sklearn训练回归器的简单例子向您展示如何利用这个强大的工具。这些步骤如下:</strong></p><ol class=""><li id="be74" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">简介</strong></li><li id="fb15" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">先决条件</strong></li><li id="4fa2" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">在train.py上训练一个MLflow模型</strong></li><li id="d7a3" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">在本地主机上可视化结果</strong></li></ol></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="0592" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">介绍</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/c5c10aba4d98ceab2d33eb0a8e2953d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zrGyk6kdaiGUXxY8MXOQ9A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者插图</p></figure><p id="c5ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如前所述，MLflow是一个管理机器学习生命周期的平台。它提供了四个组件，可以一起工作，也可以单独工作，这取决于应用程序。</p><ul class=""><li id="0a93" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nj mb mc md bi translated"><strong class="lb iu"> MLflow Tracking </strong>用于跟踪/记录实验。首先，在运行代码时存储日志记录参数、指标和输出文件，然后可以在本地主机上可视化所有实验的结果。在本文中，我们将重点关注使用Python的日志记录和查询实验。</li><li id="e7f7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nj mb mc md bi translated"><strong class="lb iu"> MLflow项目</strong>是一个组件，用于以可重用和可复制的方式打包数据科学代码。</li><li id="9c11" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nj mb mc md bi translated"><strong class="lb iu"> MLflow Models </strong>用于封装机器学习模型。有多种方法可以保存和加载MLflow模型。例如，我们训练一个Sklearn模型，然后使用函数<code class="fe nk nl nm nn b">log_model</code>将其记录为当前运行的MLflow人工制品</li><li id="8bde" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nj mb mc md bi translated"><strong class="lb iu"> Model Registry </strong>是专门用于将模型添加到模型注册表中的工具。它允许提供从试生产到生产的模型的年表。它还允许在每次运行时向模型添加描述。</li></ul><h1 id="e981" class="mq mr it bd ms mt no mv mw mx np mz na jz nq ka nc kc nr kd ne kf ns kg ng nh bi translated">先决条件</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/fd0caa7c475eb6aac76a9d4b976f02d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9AOGZjQepaBVEAIM_42eJw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者插图</p></figure><p id="a106" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我使用Visual Studio代码作为IDE。它是免费开源的，支持多种语言，每种语言都需要安装扩展。此外，它能够处理Jupyter笔记本，这对于操纵和分析代码中的数据是不可或缺的。它还集成了一个终端，需要这个终端来编写一些命令行来使用MLflow。除了这些优点之外，它还可以管理项目文件夹中的文件和文件夹。我建议你查看这个简单的<a class="ae ky" href="https://code.visualstudio.com/docs/languages/python" rel="noopener ugc nofollow" target="_blank">教程</a>，开始使用VSCode和Python。主要步骤是:</p><ul class=""><li id="6a45" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nj mb mc md bi translated">如果您的本地机器上没有来自python.org的Python，请安装它</li><li id="08ed" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nj mb mc md bi translated">在VSCode中添加扩展名“Python”</li><li id="1847" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nj mb mc md bi translated">创建新的Python环境</li></ul><p id="2abf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">配置完Python环境后，就该安装MLflow了:</p><pre class="kj kk kl km gt nu nn nv nw aw nx bi"><span id="6fb7" class="ny mr it nn b gy nz oa l ob oc">pip install mlflow</span></pre><p id="e189" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了确保安装运行良好，您应该检查是否在项目的文件夹中找到了名为“mlruns”的文件夹。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/c426ae91b08de080938a4cefeb0bfcf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*Eptyr0zf2UaGKktcMDn25w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者插图</p></figure><p id="0235" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论何时运行用Python编写的程序，MLflow Python API日志都会运行到mlruns目录中的文件中。</p><h1 id="7240" class="mq mr it bd ms mt no mv mw mx np mz na jz nq ka nc kc nr kd ne kf ns kg ng nh bi translated">在train.py上训练MLflow模型</h1><p id="c164" class="pw-post-body-paragraph kz la it lb b lc oe ju le lf of jx lh li og lk ll lm oh lo lp lq oi ls lt lu im bi translated">在本例中，我们使用自行车共享数据集，根据温度、风速和湿度等特征来预测每小时租赁自行车的数量。数据集存储在<a class="ae ky" href="https://archive.ics.uci.edu/ml/datasets/bike+sharing+dataset" rel="noopener ugc nofollow" target="_blank"> UCI的机器学习知识库</a>【2】。此外，我们将训练一个随机森林回归器，它采用三个超参数，n估计量，最大特征和最大深度。所有代码都保存在一个带有格式的文件中。py，名为train.py，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="2b7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您右键单击代码选项“在终端中运行Python文件”时，您应该得到类似的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/8c66a62ab216ae0e1e42af1daeb153da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZXQegKrNND7Il2Xdb5Movw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者插图</p></figure><p id="d615" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们应该关注的最基本的部分是从<code class="fe nk nl nm nn b">with mlflow.start_run()</code>行开始，它允许在程序块结束时自动结束运行。方法<code class="fe nk nl nm nn b">mlflow.log_param</code>和<code class="fe nk nl nm nn b">mlflow.log_metric</code>提供了在当前运行下记录参数和度量的方法。</p><p id="d9cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了试验超参数的其他值，我们可以在下面的命令中将它们作为参数传递:</p><pre class="kj kk kl km gt nu nn nv nw aw nx bi"><span id="7632" class="ny mr it nn b gy nz oa l ob oc">python train.py 200 8 6</span></pre><p id="30e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我建议你试探一下其他价值观，对MLflow的效率有更好的认识。</p><h1 id="ae8f" class="mq mr it bd ms mt no mv mw mx np mz na jz nq ka nc kc nr kd ne kf ns kg ng nh bi translated">在<strong class="ak">本地主机</strong>上可视化结果</h1><p id="e9cc" class="pw-post-body-paragraph kz la it lb b lc oe ju le lf of jx lh li og lk ll lm oh lo lp lq oi ls lt lu im bi translated">为了比较超参数和模型的不同组合，我们可以在终端上运行命令:</p><pre class="kj kk kl km gt nu nn nv nw aw nx bi"><span id="7d30" class="ny mr it nn b gy nz oa l ob oc">mlflow ui</span></pre><p id="17e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它返回一个URL，您可以在其中找到一个记录所有超参数和相应的结果指标的表(<a class="ae ky" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000 </a>)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/16a08f62bed9b591621154102dc31f89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*96UBKM9ZrqjHg1X8MNovOA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者插图</p></figure><p id="bda4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以注意到，您所有的实验现在都存储在这个表中。如果您有相同试验的副本，您也可以删除其中一个。此外，您可以将所有结果下载到一个CSV文件中，以便快速分析模型的性能。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="bbdd" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">最终想法:</h1><p id="b7d1" class="pw-post-body-paragraph kz la it lb b lc oe ju le lf of jx lh li og lk ll lm oh lo lp lq oi ls lt lu im bi translated">在这篇文章中，我们看到了MLFlow是什么，以及如何利用它来跟踪和存储我们的试验。我希望这篇教程对你开始使用它有所帮助。如果你有兴趣发现其他平台来跟踪实验，请查看<a class="ae ky" rel="noopener" target="_blank" href="/a-quick-guide-for-tracking-pytorch-experiments-using-neptune-ai-6321e4b6040f?sk=73805058dde5264ff4631ef1568efa6c">本指南</a>，其中介绍了Neptune.ai，感谢阅读。祝您愉快！</p><p id="34fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">参考文献:</strong></p><p id="517a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[1]<a class="ae ky" href="https://www.mlflow.org/" rel="noopener ugc nofollow" target="_blank">https://www.mlflow.org/</a></p><p id="b2de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://www.capitalbikeshare.com/data-license-agreement" rel="noopener ugc nofollow" target="_blank">https://www.capitalbikeshare.com/data-license-agreement</a></p><p id="3ebb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[3] <a class="ae ky" href="https://www.mlflow.org/docs/latest/tutorials-and-examples/tutorial.html" rel="noopener ugc nofollow" target="_blank">训练、服务和评分线性回归模型</a></p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="e38b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你喜欢我的文章吗？<a class="ae ky" href="https://eugenia-anello.medium.com/membership" rel="noopener"> <em class="on">成为会员</em> </a> <em class="on">每天无限获取数据科学新帖！这是一种间接的支持我的方式，不会给你带来任何额外的费用。如果您已经是会员，</em> <a class="ae ky" href="https://eugenia-anello.medium.com/subscribe" rel="noopener"> <em class="on">订阅</em> </a> <em class="on">每当我发布新的数据科学和python指南时，您都可以收到电子邮件！</em></p></div></div>    
</body>
</html>