<html>
<head>
<title>Never Forget .copy() in Your Python Codes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">永远不要忘记。在Python代码中复制()</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/never-forget-copy-in-your-python-codes-9826bba31f78#2022-02-28">https://towardsdatascience.com/never-forget-copy-in-your-python-codes-9826bba31f78#2022-02-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6e2c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如果您记得使用，它将为您节省大量调试时间。始终在python代码中复制()</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/59f6296c506743e4a9029ad36c9d6bff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*clbh8hjwH7qh5xjn"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">布鲁斯·马斯在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="b0c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">周六下午，我本应该开车带孩子去购物中心，但我却被困在了我的家庭办公室的办公桌前，调试着一段简单的代码，这段代码从上周五开始就一直困扰着我。</p><p id="2da7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">严格地说，这不是“调试”，而是为了解决我的代码的一些奇怪的性能。我正在以迭代的方式实现一个简单的无监督模型，并试图根据我设计的特定性能指标记录“最佳”模型。</p><p id="f856" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我惊讶的是，我保存的“最佳模型”并不是最好的，并且一直记录着我迭代中的最后一个模型。下面是我的实现的sudo代码的简化版本:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="e415" class="ma mb it lw b gy mc md l me mf">iter = 0<br/>while iter &lt; 10:</span><span id="a81d" class="ma mb it lw b gy mg md l me mf">    iter += 1    <br/>    # initiate the performance and empty data for recording<br/>    best_model = None<br/>    best_performance = 0<br/>    best_data = None<br/>    </span><span id="6f1f" class="ma mb it lw b gy mg md l me mf"># modeling<br/>    M = sklearn.unsupervised(random_seed= seed_dict[iter])<br/>    M.fit(X)<br/>    X2.predict = M.predict(X2)<br/>    current_performance = sum(X2.predict == 1)<br/>    print("my current performance is %i" %(current_performance))</span><span id="1691" class="ma mb it lw b gy mg md l me mf">    # compare to the recorded best model<br/>    if current_performance &gt; best_performance:<br/>        best_model = M<br/>        best_data = X2<br/>        best_performance = current_performance<br/>        print("Ah ha!! My best model is updated with performance %i !" %(best_performance))</span></pre><p id="1831" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你是一个有经验的程序员，你可能已经发现了代码的问题。如果您还没有，请跟随我学习下面的示例输出代码，</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1866" class="ma mb it lw b gy mc md l me mf"># Python<br/>print("My best performance is %i based on best_data!" %(sum(best_data.predict == 1)))<br/>print("My best performance is %i based on best_performance!" %(best_performance))</span><span id="3069" class="ma mb it lw b gy mg md l me mf">my current performance is 300<br/>Ah ha!! My best model is updated with performance 300 !<br/>my current performance is 400<br/>Ah ha!! My best model is updated with performance 400 !<br/>my current performance is 200<br/>my current performance is 270<br/>my current performance is 360<br/>my current performance is 870<br/>Ah ha!! My best model is updated with performance 870 !<br/>my current performance is 1224<br/>Ah ha!! My best model is updated with performance 1224 !<br/>my current performance is 1687<br/>Ah ha!! My best model is updated with performance 1687 !<br/>my current performance is 350<br/>my current performance is 128</span><span id="c537" class="ma mb it lw b gy mg md l me mf">My best performance is 128 based on best_data!<br/>My best performance is 1687 based on best_performance!</span></pre><p id="d9fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看到问题了吗？我根据记录的“最佳数据”报告的“最佳性能”是来自上一次迭代。然而，基于变量“最佳性能”，真正的“最佳性能”应该是1，687。</p><p id="49e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的原始代码在建模部分更复杂，所以我在建模部分花了很多时间，甚至没有考虑记录最佳模型和数据的代码。</p><p id="3093" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">经过几轮编辑(那花费了我一个周五晚上外加一个周六下午！)，我终于注意到下面这行代码，</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d4a7" class="ma mb it lw b gy mc md l me mf">best_data = X2</span></pre><p id="9f32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应该是，</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ce8e" class="ma mb it lw b gy mc md l me mf">best_data = X2.copy()</span></pre><p id="fa4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">原因是Python中的赋值语句不复制对象，它们在目标和对象之间创建绑定。因此，当我键入best_data = X2时，我实际上在两个变量之间建立了一个链接，每次X2发生变化，best_data也会发生变化！</p><p id="bdea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据Python的文档，“对于可变的或包含可变项的集合，有时需要一个副本，这样可以在不改变另一个副本的情况下改变一个副本。”</p><p id="26b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在编码中很容易忽略这一点，尤其是当你把主要精力放在建模部分的时候。</p><p id="a784" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我不想让你像我一样在这个愚蠢的错误上浪费宝贵的周六下午，所以我把它写成了一个简短的帖子。希望有帮助！</p><p id="c67a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我要回到我的家人身边！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/29c0aa035a596662f5628eb862574768.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1g6j-AmplG9oSFZP"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@jmvillejo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杰德·维尔霍</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div></div>    
</body>
</html>