<html>
<head>
<title>Don’t Start Your SQL Queries with the ‘Select’ Statement</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不要以“Select”语句开始 SQL 查询</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/dont-start-your-sql-queries-with-select-clause-d30fa1b701f6#2022-12-05">https://towardsdatascience.com/dont-start-your-sql-queries-with-select-clause-d30fa1b701f6#2022-12-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="985b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">遵循这种正确的方法来编写 SQL 查询</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4b40ea0f0eb8d5415ec9881ec750cd1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ok4j2wjoNtVrYKhpENbgGw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:Unsplash</p></figure><h2 id="510c" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">问题是</h2><p id="e42b" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">大多数开发人员开始用' SELECT '子句编写他们的 SQL 查询，然后编写' FROM '，' WHERE '，' HAVING'…诸如此类。但这不是编写 SQL 查询的“正确”方式，因为这很容易出现语法错误，尤其是如果您是 SQL 初学者。</p><h2 id="207a" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">解决方案</h2><p id="c2c0" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">“理想的”查询编写顺序应该与 SQL executor 执行查询的方式一致。这将确保您不会犯任何语法错误，并编写高效的 SQL 查询。您将知道如何在执行连接之前过滤数据，何时使用“HAVING”或“WHERE”子句等等。</p><p id="4b6f" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">在这篇博文中，我们将探讨编写 SQL 查询的“理想”方式，这将帮助您成为一名高效的 SQL 开发人员。</p><p id="5943" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">我们将使用客户和订单表(如下)来查找来自美国/英国的总消费超过 300 美元的前 2 名客户。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/b0124aaf9a55f59f95987416dc0aee4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PV2MGWQ-dXP06XGwxoajFg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">客户表(图片由作者提供)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/b40f1820ee73dafaf96a88ce17f7d042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MmSLeuYzmNDmEvx7mTm01w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">订单表(作者图片)</p></figure><p id="0440" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">让我们深入探讨编写 SQL 查询的正确方法。</p><h2 id="0a99" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">1.总是以 FROM/JOIN 开头</h2><p id="3b79" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">直观地说，第一步是使用 FROM 子句读取表并执行 JOIN(如果需要的话)。因此，您应该始终以“FROM”/“JOIN”语句开始查询。</p><pre class="kj kk kl km gt mt mu mv bn mw mx bi"><span id="013e" class="my kz it mu b be mz na l nb nc"><br/>FROM Customers<br/>INNER JOIN Orders<br/>ON Customers.customer_id = Orders.customer_id</span></pre><p id="e6e9" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">甚至在执行连接之前，我们也可以从输入表中过滤行。我们可以通过在连接的“ON”子句后添加“AND”子句来做到这一点。</p><pre class="kj kk kl km gt mt mu mv bn mw mx bi"><span id="45d4" class="my kz it mu b be mz na l nb nc">-- Filter happens before Join<br/><br/>FROM Customers<br/>INNER JOIN Orders<br/>ON Customers.customer_id = Orders.customer_id<br/>AND country in ('USA','UK')</span></pre><h2 id="a981" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">2.那搬到哪里去</h2><p id="4ec6" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">执行顺序中的第二个子句是 WHERE 子句。它用于在应用连接后过滤数据表。</p><p id="1c26" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">WHERE 子句非常有助于减少行数，尤其是当我们处理具有数百万行的大型数据集时。</p><pre class="kj kk kl km gt mt mu mv bn mw mx bi"><span id="b41e" class="my kz it mu b be mz na l nb nc">FROM Customers<br/>INNER JOIN Orders<br/>ON Customers.customer_id = Orders.customer_id<br/>WHERE country in ('USA','UK')</span></pre><h2 id="71b9" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">3.然后使用分组依据</h2><p id="fb01" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">Group By 子句应写在 Where 子句之后。它用于根据选定的一列或多列对行进行分组。</p><p id="743b" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">在下面的查询中，我们根据客户 id 对行进行分组。分组后，每个客户 id 在输出中都有一行。我们一般使用聚合(sum，min，max 等。)当我们把数据分组的时候。在本例中，我们将找到 Orders 表中 amount 列的总和。</p><pre class="kj kk kl km gt mt mu mv bn mw mx bi"><span id="1cbd" class="my kz it mu b be mz na l nb nc">FROM Customers<br/>INNER JOIN Orders<br/>ON Customers.customer_id = Orders.customer_id<br/>WHERE country in ('USA','UK')<br/>GROUP BY Customers.customer_id</span></pre><h2 id="efa0" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">4.在分组依据之后</h2><p id="e176" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">HAVING 子句在 group by 之后执行，它用于筛选 GROUP BY 操作中生成的聚合行。</p><p id="d3b6" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">在我们的例子中，我们将过滤每个客户花费的金额总和大于 300。</p><pre class="kj kk kl km gt mt mu mv bn mw mx bi"><span id="7639" class="my kz it mu b be mz na l nb nc">FROM Customers<br/>INNER JOIN Orders<br/>ON Customers.customer_id = Orders.customer_id<br/>WHERE country in ('USA','UK')<br/>GROUP BY Customers.customer_id<br/>HAVING sum(amount) &gt;300</span></pre><blockquote class="nd ne nf"><p id="9b0d" class="lu lv ng lw b lx mn ju lz ma mo jx mc nh mp me mf ni mq mh mi nj mr mk ml mm im bi translated">WHERE 子句在 GROUP BY 之前执行，而 HAVING 子句在 GROUP BY 之后执行。因此，WHERE 子句不能筛选聚合数据。</p></blockquote><h2 id="503a" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">5.然后编写 SELECT 子句</h2><p id="0208" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">我们希望在输出中显示的列是使用 SELECT 子句选择的。</p><p id="09ae" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">如果我们使用 GROUP BY 子句对数据进行分组，我们需要使用 select 语句选择分组后的列。</p><p id="a45a" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">在我们的示例中，我们将选择客户 id 和 sum(金额)来显示对应于每个客户的支出。</p><pre class="kj kk kl km gt mt mu mv bn mw mx bi"><span id="282f" class="my kz it mu b be mz na l nb nc">select Customers.customer_id, sum(amount) as total_amount<br/>FROM Customers<br/>INNER JOIN Orders<br/>ON Customers.customer_id = Orders.customer_id<br/>WHERE country in ('USA','UK')<br/>GROUP BY Customers.customer_id<br/>HAVING sum(amount) &gt;300</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/ce3164e669c4cfbe225c6b4dafbf0bbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eTUobNtcijmnwTzSqLAeBg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">输出(图片由作者提供)</p></figure><h2 id="1b06" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">6.在 SELECT 子句后使用 ORDER BY</h2><p id="deaf" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">选择列之后，下一步是提供我们希望输出行的顺序。</p><p id="4bb0" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">在我们的示例中，我们可以使用 ORDER BY 子句按照总支出的降序对行进行排序。</p><pre class="kj kk kl km gt mt mu mv bn mw mx bi"><span id="9479" class="my kz it mu b be mz na l nb nc">SELECT Customers.customer_id, sum(amount) as total_amount<br/>FROM Customers<br/>INNER JOIN Orders<br/>ON Customers.customer_id = Orders.customer_id<br/>WHERE country in ('USA','UK')<br/>GROUP BY Customers.customer_id<br/>HAVING sum(amount) &gt;=300<br/>ORDER BY total_amount desc</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/133262987f44fb33fc417f09b6936fd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M4d0HIqMCugI-v8xTAFjIw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">输出(图片由作者提供)</p></figure><h2 id="3fbe" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">7.最后写限制条款！</h2><p id="9332" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">写入序列的最后一步是限制我们希望在输出中看到的行数。</p><p id="62aa" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">在我们的例子中，我们可以将输出行的总数限制为 2。</p><pre class="kj kk kl km gt mt mu mv bn mw mx bi"><span id="eb34" class="my kz it mu b be mz na l nb nc">SELECT Customers.customer_id, sum(amount) as total_amount<br/>FROM Customers<br/>INNER JOIN Orders<br/>ON Customers.customer_id = Orders.customer_id<br/>WHERE country in ('USA','UK')<br/>GROUP BY Customers.customer_id<br/>HAVING sum(amount) &gt;=300<br/>ORDER BY total_amount desc<br/>LIMIT 2</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/e835ffdd6d8304b331b54b29f754ac93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m254tbCCG_58tp-l_YnaAg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">输出(图片由作者提供)</p></figure><h2 id="1616" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">结论</h2><p id="7f9b" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">我们看到了编写 SQL 查询的理想方式，它与 SQL 查询的执行方式一致。</p><p id="dbb9" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">如果您还没有这样做，我希望您将按照下面的顺序编写您的 SQL 查询。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/0f0d855e2ea405aa06fb4deebe3e70af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H9VCg_23-NwVD8ZxurWbVQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="16d8" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">感谢您的阅读！</h2><p id="66b4" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">你可以在收件箱里看到我所有的帖子。 <a class="ae nt" href="https://anmol3015.medium.com/subscribe" rel="noopener"> <strong class="lw iu"> <em class="ng">做到这里</em> </strong> <em class="ng">！</em>T9】</a></p><p id="6f7f" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated"><em class="ng">如果你自己喜欢体验媒介，可以考虑通过</em> <a class="ae nt" href="https://anmol3015.medium.com/membership" rel="noopener"> <strong class="lw iu"> <em class="ng">注册会员</em> </strong> </a> <em class="ng">来支持我和其他几千位作家。它每个月只需要 5 美元，它极大地支持了我们，作家，你可以在媒体上看到所有精彩的故事。</em></p><p id="92b5" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated"><strong class="lw iu"> <em class="ng">关注我</em> </strong> <em class="ng">查看我在你的订阅中的数据科学帖子。</em></p></div></div>    
</body>
</html>