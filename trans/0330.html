<html>
<head>
<title>Mapping the World’s Flight Paths with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 绘制世界飞行路线</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/mapping-the-worlds-flight-paths-with-python-232b9f7271e5#2022-02-14">https://towardsdatascience.com/mapping-the-worlds-flight-paths-with-python-232b9f7271e5#2022-02-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7837" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用 Python 可视化连接世界各大洲的飞行路线</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1f4474b1bdbdbdb65defd563affafa00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O-TedzcNVLx_sWLjxM-PVQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><p id="23e8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于 covid 航空旅行在过去两年中明显减少，但它正显示出恢复昔日辉煌的迹象。2019 年，据估计，飞机运送的乘客总数达到 45 亿，创下历史新高。尽管如此，这些飞机的航线可能与大多数人的想法相去甚远，但想象和了解热门航线在哪里、涉及哪些国家以及国际旅游枢纽在哪里是很有趣的。在本教程中，我将解释如何使用开源数据和 Python 生成显示世界航线的醒目地图。这是一个数据操作和数据可视化的练习，你应该对像<code class="fe lu lv lw lx b">Pandas</code>、<code class="fe lu lv lw lx b">GeoPandas</code>、<code class="fe lu lv lw lx b">Matplotlib </code>和<code class="fe lu lv lw lx b">Shapely</code>这样的库有更好的理解。</p><h2 id="0c51" class="ly lz it bd ma mb mc dn md me mf dp mg lh mh mi mj ll mk ml mm lp mn mo mp mq bi translated">数据探索</h2><p id="ae76" class="pw-post-body-paragraph ky kz it la b lb mr ju ld le ms jx lg lh mt lj lk ll mu ln lo lp mv lr ls lt im bi translated">数据来自于<a class="ae mw" href="https://openflights.org/data.html" rel="noopener ugc nofollow" target="_blank"> openflights </a>数据库，并且可以在<a class="ae mw" href="https://opendatacommons.org/licenses/dbcl/1-0/" rel="noopener ugc nofollow" target="_blank">数据库内容许可</a>下获得。简而言之，这意味着欢迎你按照自己的意愿使用这些数据，当且仅当你<em class="mx">和</em>都承认来源<em class="mx">和</em>并以免费许可的方式许可任何可供公众使用的衍生作品。</p><p id="a7f6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这种观想是一种数据操作的练习。openflights 数据库(这个数据库可能有点牵强)在一个文件中提供了一个机场列表，在另一个文件中提供了每个机场之间的航线数量明细。因此，数据集不包含每条路线的具体坐标，这是我们需要自己推导的。在一个理想的世界中，我们将拥有由一年中飞行的每架飞机的位置更新组成的飞行数据，并且我们可以构建该数据的 2D 直方图来展示飞行路径。不幸的是，这个数据很难得到，所以我们不得不凑合着用一个机场列表和每个机场之间的航线数量。我们的目标是创建一个描述每条路线的线串地理数据框架。我们据此做出的假设是，飞机直接从一个机场飞到另一个机场。</p><p id="eb85" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第一个数据集是机场数据。该数据包含机场及其位置的列表以及一些其他信息。总共有 7608 个独特的机场。重要的是要注意机场<code class="fe lu lv lw lx b">iata</code>，它是每个机场的唯一标识符，以后将用于在路线中链接机场。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="1963" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">可以将数据绘制成散点图，以显示世界上机场的位置，或者至少是包含在该数据集中的机场的位置。像往常一样，在全球范围内，这张地图很大程度上只是成为了人口密度的一个代理，但看到世界机场的分布仍然很有趣。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/11df92c514138b03298b4ad486baed7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xtq1KneZIRqpPofIRDGW0w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">根据 openflights 数据库的世界机场位置。图片作者。</p></figure><p id="9d60" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第二个数据集是包含路由列表的 csv。这些航线采用<code class="fe lu lv lw lx b">iata</code>对的形式，连接源机场和目的地机场。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><h2 id="4c69" class="ly lz it bd ma mb mc dn md me mf dp mg lh mh mi mj ll mk ml mm lp mn mo mp mq bi translated">数据操作</h2><p id="3f3c" class="pw-post-body-paragraph ky kz it la b lb mr ju ld le ms jx lg lh mt lj lk ll mu ln lo lp mv lr ls lt im bi translated">我们想要操作我们的数据，以便我们有一个<code class="fe lu lv lw lx b">Linestrings</code>的<code class="fe lu lv lw lx b">DataFrame</code>来连接每条路线的源机场和目的地机场。我们将采用的为每条路线创建<code class="fe lu lv lw lx b">LineStrings</code>的方法如下。</p><ol class=""><li id="4016" class="na nb it la b lb lc le lf lh nc ll nd lp ne lt nf ng nh ni bi translated">创建一个重复的机场<code class="fe lu lv lw lx b">DataFrame</code>，将一个标记为来源，一个标记为目的地。</li><li id="14e9" class="na nb it la b lb nj le nk lh nl ll nm lp nn lt nf ng nh ni bi translated">使用路线来源<code class="fe lu lv lw lx b">iata</code>代码将来源<code class="fe lu lv lw lx b">DataFrame</code>与路线合并。</li><li id="691e" class="na nb it la b lb nj le nk lh nl ll nm lp nn lt nf ng nh ni bi translated">使用路线目的地<code class="fe lu lv lw lx b">iata</code>代码将目的地<code class="fe lu lv lw lx b">DataFrame</code>与路线合并。</li><li id="6c76" class="na nb it la b lb nj le nk lh nl ll nm lp nn lt nf ng nh ni bi translated">使用现在合并到路线<code class="fe lu lv lw lx b">DataFrame</code>中的源机场和目的地机场的纬度和经度值创建一个代表该路线的<code class="fe lu lv lw lx b">LineString</code>。</li></ol><p id="07f8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面我们复制了最初的机场<code class="fe lu lv lw lx b">DataFrame</code>，并给其中一个机场的列标上了<code class="fe lu lv lw lx b">_source</code>和<code class="fe lu lv lw lx b">_destination</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="e9f6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这两个<code class="fe lu lv lw lx b">DataFrames</code>然后与路线<code class="fe lu lv lw lx b">DataFrame</code>合并，以给出具有目的地和源机场的纬度/经度值的<code class="fe lu lv lw lx b">DataFrame</code>。注意下面显示的列，每条路线有四列，<code class="fe lu lv lw lx b">lat_source</code>、<code class="fe lu lv lw lx b">long_source</code>、<code class="fe lu lv lw lx b">lat_destination</code>和<code class="fe lu lv lw lx b">long_destination</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="c660" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后使用<code class="fe lu lv lw lx b">shapely.geometry.LineString</code>方法，用这些值为每条路线生成一个带有<code class="fe lu lv lw lx b">LineStrings</code>的<code class="fe lu lv lw lx b">GeoDataFrame</code>。这需要一个纬度和经度对的列表，并创建一条连接这些点的线。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><h2 id="dd85" class="ly lz it bd ma mb mc dn md me mf dp mg lh mh mi mj ll mk ml mm lp mn mo mp mq bi translated">数据可视化</h2><p id="696c" class="pw-post-body-paragraph ky kz it la b lb mr ju ld le ms jx lg lh mt lj lk ll mu ln lo lp mv lr ls lt im bi translated">这些数据现在可以绘制成航线图。不幸的是，不可能简单地按原样绘制数据，因为在绘制线条时需要考虑地球的曲率。下面的地图显示了每个机场之间的直线，这是不正确的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/145f7cf894ef264ec1ad180670713f34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*13zf5MTCfJHYly0UfQB8tQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">不考虑地球曲率的世界飞行路线。图片作者。</p></figure><p id="1990" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lu lv lw lx b">Cartopy</code>可用于操纵线条的绘制方式。<code class="fe lu lv lw lx b">transform=ccrs.Geodetic()</code>方法转换<code class="fe lu lv lw lx b">LineStrings</code>来解释地球的曲率。我还将投影更改为罗宾逊投影，因为这是绘制全球数据集的更现实的方法之一，说明了地球不是平的这一事实。我还把<code class="fe lu lv lw lx b">alpha</code>的值降低到 0.1，让它看起来更清晰一点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/faa4efa8e7d5daaf41154dcd398c9fb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wixwYX0yG1tknBICwdmYYA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">瞧。世界飞行路线。图片作者。</p></figure><h1 id="7e1a" class="np lz it bd ma nq nr ns md nt nu nv mg jz nw ka mj kc nx kd mm kf ny kg mp nz bi translated">结论</h1><p id="4729" class="pw-post-body-paragraph ky kz it la b lb mr ju ld le ms jx lg lh mt lj lk ll mu ln lo lp mv lr ls lt im bi translated">我们有它，一个美丽的地图显示了如何产生引人注目的数据可视化显示世界航线。这是计划展示如何使用 Python 使地理空间数据看起来令人惊叹的许多文章中的第一篇，请订阅以便您不会错过它们。我也喜欢反馈，所以请让我知道你会如何做不同或建议改变，使它看起来更棒。我每周都会在我的推特账户上发布数据可视化，看看地理空间数据可视化是不是你的菜【https://twitter.com/PythonMaps T4】</p><p id="72a7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">medium 提供的额外收入确实有助于这个项目继续进行，所以如果你是一个粉丝，想取消你的帐户，然后用我的推荐重新注册，那就太好了。<a class="ae mw" href="https://pythonmaps.medium.com/membership" rel="noopener">https://pythonmaps.medium.com/membership</a></p></div></div>    
</body>
</html>