<html>
<head>
<title>Cloud Basics: Auto-Scaling Servers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">云基础:自动扩展服务器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/cloud-basics-auto-scaling-servers-71aa9945178a#2022-09-20">https://towardsdatascience.com/cloud-basics-auto-scaling-servers-71aa9945178a#2022-09-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="90c0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">AWS中基于负载自动扩展服务器的教程</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0aaf913bf06357a77eb49de4a1c46514.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BLmruJzpWkv_iK1o"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Jorge Ramirez 在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="b979" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">云的优势之一是不必提前为生产中的工作负载准确预测和调配资源。在内部模型中，您需要通过纵向扩展(增加现有服务器的cpu、内存等)来过度配置硬件资源。)或水平(添加更多同等资源的服务器)来尝试满足预期的峰值工作负载。这导致大部分时间服务器资源利用不足和浪费。</p><p id="716b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">云允许我们根据各种参数自动扩展和缩减资源(服务器)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/796ccf3291c121b393f4b118906f371b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4_ucSacB5NtbAea4QzvjOA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图1:云中的自动扩展选项</p></figure><p id="9b6d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本教程中，我们将根据上面列出的选项#1和#2测试自动缩放，步骤如下:</p><ol class=""><li id="7b54" class="lt lu iq ky b kz la lc ld lf lv lj lw ln lx lr ly lz ma mb bi translated">在负载平衡器后面的自动扩展组中启动一组2个EC2 web服务器。</li><li id="04e4" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">基于测试工作负载的自动扩展<br/> -手动触发CPU峰值超过90%持续2.5分钟<br/> -观察额外的服务器被自动创建<br/> -观察服务器在CPU低于70%的2分钟后被移除</li><li id="b480" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">测试基于可用性的自动伸缩<br/> -手动删除1台服务器&amp;观察新服务器的创建</li></ol></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="006e" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">先决条件</h1><p id="ca84" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">从下面链接的帖子中完成以下部分。</p><ol class=""><li id="edf9" class="lt lu iq ky b kz la lc ld lf lv lj lw ln lx lr ly lz ma mb bi translated">AWS设置</li><li id="2692" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">GitHub帐户设置和安装</li></ol><div class="nl nm gp gr nn no"><a rel="noopener follow" target="_blank" href="/cloud-basics-interacting-with-aws-da179d3f5829"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">云基础知识:与AWS交互</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">关于使用各种接口创建云资源的教程</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">towardsdatascience.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc kp no"/></div></div></a></div></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h2 id="8b4e" class="od mp iq bd mq oe of dn mu og oh dp my lf oi oj na lj ok ol nc ln om on ne oo bi translated">1.启动自动扩展堆栈</h2><p id="3571" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">目标:使用CloudFormation模板在负载平衡器后面的自动扩展组中启动一组web服务器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/79aa62cf7068025eaf659ba5b3e8ffde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OFAOwP97nTGWkbV8KJ-YNA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图2:虚拟私有云中负载平衡器后面的自动扩展服务器组的架构</p></figure><ol class=""><li id="7202" class="lt lu iq ky b kz la lc ld lf lv lj lw ln lx lr ly lz ma mb bi translated">转到<a class="ae kv" href="https://github.com/shrestha-ajay/cloud-basics2.git" rel="noopener ugc nofollow" target="_blank">https://github.com/shrestha-ajay/cloud-basics2.git</a></li><li id="6762" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">遵循"<strong class="ky ir">自述文件中的步骤。MD </strong>文件中的回购或遵循以下步骤</li><li id="7f2c" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">通过点击GitHub UI中的“Fork”来分叉这个库</li><li id="1a05" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">通过运行以下命令，将此存储库克隆到您的本地计算机上:</li></ol><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="1856" class="od mp iq or b gy ov ow l ox oy">$ git clone <a class="ae kv" href="http://git@github.com:YOUR-USERNAME/YOUR-REPOSITORY.git" rel="noopener ugc nofollow" target="_blank">git@github.com:YOUR-USERNAME/YOUR-REPOSITORY.git</a><br/>$ cd YOUR-Repository-Folder</span></pre><p id="5225" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">6.确保按照先决条件在您的计算机中配置了AWS CLI</p><p id="3a7f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">7.运行以下命令创建自动扩展解决方案堆栈</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="b49c" class="od mp iq or b gy ov ow l ox oy">aws cloudformation deploy \<br/>  --stack-name my-cloudbasic-autoscaling \<br/>  --template-file AutoScalingMultiAZWithNotifications.template \<br/>  --parameter-overrides KeyName="EC2Keypair" OperatorEMail="Email"</span></pre><blockquote class="oz pa pb"><p id="230a" class="kw kx pc ky b kz la jr lb lc ld ju le pd lg lh li pe lk ll lm pf lo lp lq lr ij bi translated"><em class="iq">注:用您的值替换</em>ec2 key pair<em class="iq">&amp;</em>Email<em class="iq">。</em></p></blockquote><p id="4772" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">8.转到AWS控制台&gt; CloudFormation和AWS控制台&gt; EC2以确认资源已创建。</p><p id="4e32" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">9.从云信息堆栈的<em class="pc">输出</em>选项卡中打开<em class="pc"> URL </em></p><p id="92a3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">10.堆栈启动后，检查您的电子邮件并确认订阅通知</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/b419fe00387216a6af466aefc2de809c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n1wxMOBrr-P2cXWnse17yw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图3:从CloudFormation堆栈创建的负载平衡器的URL</p></figure></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h2 id="69a8" class="od mp iq bd mq oe of dn mu og oh dp my lf oi oj na lj ok ol nc ln om on ne oo bi translated">2.基于工作负载的自动扩展</h2><p id="4887" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">目标:连接堆栈中的两台服务器，在2.5分钟内将服务器的CPU提高到90%以上。这将触发组中新服务器的创建。这可能需要5-7分钟。当服务器上的负载在2.5分钟内降至70%以下时，第三台服务器将自动终止。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ph pi l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">代码1:如果CPU负载在2分钟内&gt; 90%,则自动添加新服务器的CloudFormation代码片段</p></figure><p id="cfea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">步骤</strong></p><ol class=""><li id="3929" class="lt lu iq ky b kz la lc ld lf lv lj lw ln lx lr ly lz ma mb bi translated">从AWS管理控制台&gt; EC2列出当前作为自动伸缩组的一部分运行的2个服务器实例</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/6d3991f2329e8d33838a92407a5d0690.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N_7QeIvvFAVe1WsS_Zv1ew.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图4:自动缩放组的EC2实例列表</p></figure><p id="c97d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.SSH到服务器的公共IP，并运行以下命令</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="4e29" class="od mp iq or b gy ov ow l ox oy">$ <strong class="or ir">sudo ssh -i "yourEC2key.pem" ec2-user@54.146.219.38</strong></span><span id="a06b" class="od mp iq or b gy pj ow l ox oy">[ec2-user@ip-10-0-1-116 ~]$ <strong class="or ir">yes &gt; /dev/null &amp;</strong></span><span id="6741" class="od mp iq or b gy pj ow l ox oy">[1] 12777</span><span id="1c13" class="od mp iq or b gy pj ow l ox oy">[ec2-user@ip-10-0-1-116 ~]$ <strong class="or ir">top</strong></span><span id="736b" class="od mp iq or b gy pj ow l ox oy">[ec2-user@ip-10-0-1-116 ~]$ <strong class="or ir">kill -9 12777</strong></span><span id="fa4a" class="od mp iq or b gy pj ow l ox oy">[ec2-user@ip-10-0-1-116 ~]$ <strong class="or ir">top</strong></span></pre><blockquote class="oz pa pb"><p id="b8a9" class="kw kx pc ky b kz la jr lb lc ld ju le pd lg lh li pe lk ll lm pf lo lp lq lr ij bi translated">注意:<br/> a. ssh <em class="iq">命令</em>:<em class="iq">Replace "</em>yourec 2 key . PEM<em class="iq">"和</em> IP <em class="iq">来匹配你的值<br/> </em> b. top <em class="iq">命令</em> : <em class="iq">显示CPU和资源利用率<br/> c. </em> kill <em class="iq">命令:只有在第3台服务器启动后才运行</em> kill <em class="iq">。用你的进程ID替换</em> 12777 <em class="iq">。<br/> </em> <strong class="ky ir"> <em class="iq">警告</em> </strong> <em class="iq">:请勿在您的电脑中运行“</em><strong class="ky ir">yes&gt;/dev/null&amp;”</strong><em class="iq">。这可能会导致您的计算机过热。</em></p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/aa29512cdfa5d94b03604c71ae6dbd3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jz30xMDCAYu3MYzBvSw-Tg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图5:显示执行命令序列的屏幕截图</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pk"><img src="../Images/946b7cfc7378bbbe2b958a84c0e7b8e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*18Bcj2CZTST-ILkRsXH8bw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图6:增加CPU后运行top命令的输出</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/ce4c73ca687eb8f09721308f5c7f61f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hTzuH2OZ4614z7VICPw3AQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图7:显示创建第三个EC2实例的屏幕截图</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/c97da82c36e0951d9a1e560207029986.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nrYxXv1zXBp9ZhLOyN0OQg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图8:显示服务器高CPU的屏幕截图</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/a85d557b71908bc9d8b58759cb225a70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*frgEaxjGtUbYnNTAEluVvA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图9:显示低CPU和移除(自动终止)第三个服务器的屏幕截图</p></figure></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h2 id="2b91" class="od mp iq bd mq oe of dn mu og oh dp my lf oi oj na lj ok ol nc ln om on ne oo bi translated">3.基于可用性的自动扩展</h2><p id="a727" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">目标:终止两个正在运行的服务器中的一个，并看到一个新的服务器被自动创建，因为CloudFormation模板表明我们需要至少两个服务器一直运行。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ph pi l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">代码2:定义自动扩展组中最小和最大服务器数量的云信息资源</p></figure><p id="287a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">步骤:</strong></p><ol class=""><li id="ea54" class="lt lu iq ky b kz la lc ld lf lv lj lw ln lx lr ly lz ma mb bi translated">从AWS管理控制台&gt; EC2终止服务器</li><li id="955f" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">等待几分钟，让新服务器自动配置。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/c3f79c9c744ea3578d8b7a6ed940c63d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*auS0ry7h9OGqkr6zilwvmg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图10:终止正在运行的实例，并看到自动创建的新实例</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/58db3fa6999ebbeac3eeb81b68be6c2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OWxXycrs-Y3xYAgQkfrKEQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图11:自动创建的实例的初始化</p></figure></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="5b84" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">摘要</h1><p id="f606" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">在本教程中，我们演示了自动伸缩如何适用于基于负载和可用性的场景。请注意，在整个实验中，负载平衡器的URL应该是打开的，而服务器根据负载和最低可用性进行伸缩。自动伸缩实现了web服务的高可用性和可靠性。有关实现的更多信息，请查看GitHub资源库中的CloudFormation基础设施代码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/b419fe00387216a6af466aefc2de809c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n1wxMOBrr-P2cXWnse17yw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图12:从CloudFormation堆栈创建的负载平衡器的URL</p></figure></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h2 id="62a4" class="od mp iq bd mq oe of dn mu og oh dp my lf oi oj na lj ok ol nc ln om on ne oo bi translated">清除</h2><p id="d58a" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">温和的提醒删除云形成堆栈，以避免在你的实验后被收费。删除云形成堆栈后，应终止EC2服务器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/45949a06175b16755c6b7bab9b1ecbd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z5-dSf2jrZherC0Ab34qIQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图13:显示堆栈终止的屏幕截图</p></figure></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h2 id="4f71" class="od mp iq bd mq oe of dn mu og oh dp my lf oi oj na lj ok ol nc ln om on ne oo bi translated">资源</h2><ol class=""><li id="b0d3" class="lt lu iq ky b kz ng lc nh lf pl lj pm ln pn lr ly lz ma mb bi translated"><a class="ae kv" href="https://aws.amazon.com/autoscaling/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/autoscaling/</a></li><li id="62e7" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">https://aws.amazon.com/cloudformation/<a class="ae kv" href="https://aws.amazon.com/cloudformation/" rel="noopener ugc nofollow" target="_blank"/></li><li id="2475" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">【https://github.com/shrestha-ajay/cloud-basics2 T4】</li><li id="09ee" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated"><a class="ae kv" href="https://en.wikipedia.org/wiki/Yes_(Unix)" rel="noopener ugc nofollow" target="_blank">https://en . Wikipedia . org/wiki/Yes _(Unix)</a></li></ol></div></div>    
</body>
</html>