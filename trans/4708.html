<html>
<head>
<title>Quick and Easy Way to Debug SageMaker Pipelines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">调试SageMaker管道的快速简便方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/quick-and-easy-way-to-debug-sagemaker-pipelines-473b9c56f015#2022-10-19">https://towardsdatascience.com/quick-and-easy-way-to-debug-sagemaker-pipelines-473b9c56f015#2022-10-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4e3a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">AWS SageMaker本地模式简介</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/334a6ff3892f1b3856d31faabf578692.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Zqbg_sSgLGJtawh3"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@xoforoct?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">EJ·斯特拉特</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h2 id="613f" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">介绍</h2><p id="84e9" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">您可能已经体验过，在云环境中调试管道非常耗时。因为我们的程序与云托管的服务交互，所以与本地环境相比，我们有许多需要考虑的地方。例如，假设您的管道由于管道最后一步的版本问题而失败。可能它已经运行了2个小时才出现故障。在这种情况下，你在特定云资源上的钱就浪费了。这就是数据科学家/ML工程师应该知道的调试和测试管道的经济有效的方法。在本文中，我将指导您如何使用本地模式特性调试AWS SageMaker管道。</p><p id="2b05" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">本文涵盖的主题。</p><ul class=""><li id="8151" class="mq mr iq lu b lv ml ly mm lf ms lj mt ln mu mk mv mw mx my bi translated">什么是SageMaker管道</li><li id="0837" class="mq mr iq lu b lv mz ly na lf nb lj nc ln nd mk mv mw mx my bi translated">什么是SageMaker本地模式</li><li id="00b0" class="mq mr iq lu b lv mz ly na lf nb lj nc ln nd mk mv mw mx my bi translated">使用SageMaker本地模式的好处</li><li id="0c83" class="mq mr iq lu b lv mz ly na lf nb lj nc ln nd mk mv mw mx my bi translated">如何使用SageMaker本地模式进行测试和调试？</li></ul><p id="88f7" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">我们开始吧。</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h2 id="e8e5" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">什么是Sagamaker管道？</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/af976e199779f0f51f25004097737cbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-v2qbN2yLJHfp5J5tYddCQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">示例管道-插图-作者提供的图片</p></figure><p id="2875" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">简而言之，SageMaker管道是一个有向无环图(DAG ),它让我们能够根据自己的需求定义指令集。DAG中的每个气泡对应于用户指定的指令。由于这些气泡是相互关联的，我们可以映射它们之间的依赖关系，这有助于我们将复杂的指令分成单个部分。此外，它为这些管道提供了更多的可维护性。</p><div class="nm nn gp gr no np"><a href="https://docs.aws.amazon.com/sagemaker/latest/dg/pipelines-sdk.html" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd ir gy z fp nu fr fs nv fu fw ip bi translated">SageMaker管道概述</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">Amazon SageMaker模型构建管道管道是一系列相互关联的步骤，这些步骤是使用…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">docs.aws.amazon.com</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od kp np"/></div></div></a></div><h2 id="60a2" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">什么是SageMaker本地模式，我们为什么要关心它</h2><p id="89a0" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">在解释本地模式之前，我们应该知道SageMaker管道是如何工作的。</p><blockquote class="oe"><p id="0b2a" class="of og iq bd oh oi oj ok ol om on mk dk translated"><strong class="ak"> <em class="oo">当我们执行SageMaker管道时会发生什么？</em> </strong></p></blockquote><p id="5ce1" class="pw-post-body-paragraph ls lt iq lu b lv op jr lx ly oq ju ma lf or mc md lj os mf mg ln ot mi mj mk ij bi translated">为了解释这一点，让我以下面的步骤为例。</p><ul class=""><li id="a479" class="mq mr iq lu b lv ml ly mm lf ms lj mt ln mu mk mv mw mx my bi translated">数据摄取</li><li id="f66c" class="mq mr iq lu b lv mz ly na lf nb lj nc ln nd mk mv mw mx my bi translated">预处理</li><li id="c78c" class="mq mr iq lu b lv mz ly na lf nb lj nc ln nd mk mv mw mx my bi translated">模型结构</li><li id="063e" class="mq mr iq lu b lv mz ly na lf nb lj nc ln nd mk mv mw mx my bi translated">推理</li><li id="28ae" class="mq mr iq lu b lv mz ly na lf nb lj nc ln nd mk mv mw mx my bi translated">后加工</li></ul><p id="443e" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">当我们执行上述管道时，SageMaker将自动为每个步骤旋转一个EC2实例，并运行用户定义的脚本。事先，整个管道将使用5个EC2实例。记住，云中的所有资源都是有成本的。那就是成本因素了。时间因素怎么样？更惨。除了脚本执行时间，我们必须等待几分钟来旋转EC2实例。假设您正在构建一个管道或调试一个管道，这意味着您不得不在EC2实例上浪费不必要的金钱和时间。如果我们可以避免旋转EC2实例，并在本地运行整个管道作为试运行，会怎么样？这就是SageMaker本地模式派上用场的地方。</p><blockquote class="ou ov ow"><p id="5f0e" class="ls lt ox lu b lv ml jr lx ly mm ju ma oy mn mc md oz mo mf mg pa mp mi mj mk ij bi translated">启用SageMaker本地模式后，我们可以在本地机器上尝试我们的管道。这意味着当我们调试或测试管道时，不会在EC2实例上浪费更多的时间和金钱。</p></blockquote><p id="2a62" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">让我们用预处理和训练步骤构建一个简单的管道。这里我将使用一个自定义容器。但是本地模式既适用于内置容器，也适用于自定义容器。你可以在下面看到我的文件夹结构。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pb"><img src="../Images/cc7183736e575f3a36ad6813543b9a84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l1p9wb3DJ32BiPwwGTQFrQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我的文件夹结构—按作者分类的图像</p></figure><h2 id="cdfa" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">构建预处理步骤</h2><p id="6150" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">在这一步中，我将使用数据目录中的训练数据集，并将它们上传到预处理容器中。然后执行位于预处理目录中的python脚本。处理作业完成后，预处理文件应保存到配置的S3位置。</p><p id="25cf" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">首先，我们需要设置下面的会话配置。只有当您与本地文件系统而不是S3进行交互时，才有必要这样做。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pc pd l"/></div></figure><p id="5ea8" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">现在是定义处理步骤的时候了。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pc pd l"/></div></figure><h2 id="d7c0" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">建立培训步骤</h2><p id="7100" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">此步骤将执行以下操作。</p><ul class=""><li id="18a8" class="mq mr iq lu b lv ml ly mm lf ms lj mt ln mu mk mv mw mx my bi translated">获取预处理步骤输出，并用它们训练模型。</li><li id="f081" class="mq mr iq lu b lv mz ly na lf nb lj nc ln nd mk mv mw mx my bi translated">将模型工件保存到名为<code class="fe pe pf pg ph b">model</code>的本地目录中</li></ul><p id="55c4" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">所以问题是如何将估算器<code class="fe pe pf pg ph b">output_path</code>设置为本地目录。我们可以通过给本地路径添加一个<code class="fe pe pf pg ph b">file://</code>前缀来设置本地路径。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pc pd l"/></div></figure><h2 id="5094" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">建造管道</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pc pd l"/></div></figure><p id="7c5e" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">让我们测试我们的管道。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pc pd l"/></div></figure><p id="0bf0" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">当您成功执行管道时，您会注意到在模型目录中创建的model.tar.gz文件。您可以使用它进行推理和模型诊断等。</p><h2 id="cb6b" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">最后的话</h2><p id="ef44" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">如果使用SageMaker进行开发，可能会遇到不同的bug和错误。这就是SageMaker本地模式可以成为你的救命稻草的地方。这会让你把更多的时间集中在你的问题上。在本地成功运行之后，您可以将模型管道投入生产。将本地模式转换为AWS托管管道时，必须用SageMaker会话替换本地会话，并使用具有必要权限的SageMaker IAM角色。</p><p id="22cb" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">完整的代码可以在我的<a class="ae kv" href="https://github.com/Ransaka/Sagemaker-Local-Mode-Example" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中找到。</p><p id="263e" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">快乐学习！！</p><blockquote class="ou ov ow"><p id="05b9" class="ls lt ox lu b lv ml jr lx ly mm ju ma oy mn mc md oz mo mf mg pa mp mi mj mk ij bi translated"><em class="iq">参考文献:</em></p></blockquote><ul class=""><li id="f48b" class="mq mr iq lu b lv ml ly mm lf ms lj mt ln mu mk mv mw mx my bi translated">AWS回购样本—<a class="ae kv" href="https://github.com/aws-samples/amazon-sagemaker-local-mode" rel="noopener ugc nofollow" target="_blank">https://github.com/aws-samples/amazon-sagemaker-local-mode</a></li><li id="0b68" class="mq mr iq lu b lv mz ly na lf nb lj nc ln nd mk mv mw mx my bi translated">Sagemaker文档—【https://sagemaker.readthedocs.io/en/stable/overview.html? T2】highlight = local % 20mode #本地模式</li></ul></div></div>    
</body>
</html>