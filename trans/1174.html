<html>
<head>
<title>A Guide To The Apply-Family In R — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R 中的应用系列指南—第 2 部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-guide-to-the-apply-family-in-r-part-2-227da1c1bc92#2022-03-25">https://towardsdatascience.com/a-guide-to-the-apply-family-in-r-part-2-227da1c1bc92#2022-03-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9c83" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用应用功能的实例</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4b3ea272bbd3295aee56a7691c792e28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BaMDX1que-c0_9nO"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@mikofilm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">迈克·科诺诺夫</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="9575" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我的 r 中 apply 系列指南的第二部分。请查看<a class="ae ky" href="https://medium.com/@andreagustafsen/a-guide-to-the-apply-family-in-r-part-1-a4073c0dad3e" rel="noopener">第 1 部分</a>了解每个 apply 函数的演练。在本文中，我给出了两个在一些常见的数据工作流中使用 apply-function 的实例。</p><div class="lv lw gp gr lx ly"><a href="https://medium.com/@andreagustafsen/a-guide-to-the-apply-family-in-r-part-1-a4073c0dad3e" rel="noopener follow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">R 系列应用指南第 1 部分</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">lapply、sapply、apply 和 tapply 函数。</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">medium.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><p id="1b18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本指南还以 jupyter 笔记本和 pdf 文件的形式出现在本<a class="ae ky" href="https://github.com/TalkingDataScience/apply-family" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="7054" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">示例:计算单样本 t 检验的功效</h1><p id="9a24" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">单样本 t 检验确定未知总体均值是否不同于特定值。</p><p id="0c26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">进行假设检验时，功效是拒绝错误的零假设的概率。换句话说，它给出了检验将检测到均值真正差异的概率。</p><p id="159d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用模拟，我们实际上可以评估测试的功效，因为我们将知道参数的真实值，在这种情况下，是平均值。</p><p id="e236" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面我们从正态分布中生成 1000 个样本，平均值为 1.75，标准差为 sqrt(5/3)。我们测试了均值为 1 且显著性水平为 95%的零假设。我们通过使用<code class="fe nr ns nt nu b">apply</code>函数对 1000 个样本中的每一个都这样做，并计算我们拒绝零假设的次数的比例。我们可以看到，测试在 71%的情况下发现了差异。</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="be1b" class="nz mv it nu b gy oa ob l oc od"><em class="oe"># Function to generate data from the normal distribution</em><br/><em class="oe"># S = number of samples</em><br/><em class="oe"># n = sample size</em><br/><em class="oe"># mu = mean</em><br/><em class="oe"># sigma = standard deviation</em></span><span id="ea04" class="nz mv it nu b gy of ob l oc od">generate.normal <strong class="nu iu">&lt;-</strong> function(S,n,mu,sigma){<br/>  <em class="oe"># generate one data set, each row is one sample</em><br/>  data <strong class="nu iu">&lt;-</strong> matrix(rnorm(n<strong class="nu iu">*</strong>S,mu,sigma), ncol <strong class="nu iu">=</strong> n, byrow <strong class="nu iu">=</strong> T) <br/>}<br/><br/><em class="oe"># Set seed and parameter values</em><br/><em class="oe"># Generate 1000 samples from the normal distribution</em><br/>set.seed(28)<br/>S <strong class="nu iu">&lt;-</strong> 1000<br/>n <strong class="nu iu">&lt;-</strong> 20<br/>sigma <strong class="nu iu">&lt;-</strong> sqrt(5<strong class="nu iu">/</strong>3)<br/>mu <strong class="nu iu">&lt;-</strong> 1.75<br/>mu0 <strong class="nu iu">&lt;-</strong> 1 <em class="oe">#test generated data against this mean</em><br/><br/><em class="oe"># Generate data from normal</em><br/>data <strong class="nu iu">&lt;-</strong> generate.normal(S, n, mu, sigma)<br/><br/><em class="oe"># Calculate test statistic for each sample</em><br/><em class="oe"># Using apply here to gets the mean and variance for each sample in the generated data</em><br/>ttest_statistic <strong class="nu iu">&lt;-</strong> (apply(data, 1, mean) <strong class="nu iu">-</strong> mu0) <strong class="nu iu">/</strong> sqrt(apply(data, 1, var) <strong class="nu iu">/</strong> n)<br/><br/><em class="oe"># rejection area in the t-distribution</em><br/><em class="oe"># two sided test, alpha 0.05, n-1 degrees of freedom</em><br/>t05 <strong class="nu iu">&lt;-</strong> qt(0.975, n-1)<br/><br/><em class="oe"># calculate power of test (proportion of rejections)</em><br/>power <strong class="nu iu">&lt;-</strong> sum(abs(ttest_statistic)<strong class="nu iu">&gt;</strong>t05)<strong class="nu iu">/</strong>S<br/>power</span><span id="aa0d" class="nz mv it nu b gy of ob l oc od">Output:</span><span id="f157" class="nz mv it nu b gy of ob l oc od">0.707</span></pre><p id="ddb9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于该参数(平均值为 1.75，标准偏差为 sqrt(5/3))，使用 20 的样本量并测试平均值为 1，我们将在 71%的情况下检测到差异。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="d70a" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">示例:测试需要多大的样本量？(对一个参数的多个值运行函数)</h1><p id="054d" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">如果我们想知道需要多大的样本量才能获得至少 80%的期望功效，我们可以利用<code class="fe nr ns nt nu b">sapply</code>函数在一次调用中测试样本量的几个值，并比较结果。</p><p id="cc61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将上面的代码放在一个名为<code class="fe nr ns nt nu b">ttest_power()</code>的函数中，这样我们就可以将它传递给<code class="fe nr ns nt nu b">sapply</code>函数。</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="2a00" class="nz mv it nu b gy oa ob l oc od"><em class="oe"># Put into a function</em><br/>ttest_power <strong class="nu iu">&lt;-</strong> function(seed <strong class="nu iu">=</strong> 28, S<strong class="nu iu">=</strong>1000, n <strong class="nu iu">=</strong> 20, mu <strong class="nu iu">=</strong> 0, sigma <strong class="nu iu">=</strong> 1, mu0 <strong class="nu iu">=</strong> 0.1){<br/>    set.seed(seed)<br/>    <em class="oe"># function to generate data from the normal distribution</em><br/>    generate.normal <strong class="nu iu">&lt;-</strong> function(S,n,mu,sigma){<br/>      <br/>      data <strong class="nu iu">&lt;-</strong> matrix(rnorm(n<strong class="nu iu">*</strong>S,mu,sigma), ncol <strong class="nu iu">=</strong> n, byrow <strong class="nu iu">=</strong> T) <br/>      return(data)<br/>    }<br/>    <br/>    <em class="oe"># Generate data from normal</em><br/>    data <strong class="nu iu">&lt;-</strong> generate.normal(S, n, mu, sigma)<br/>    <br/>    <em class="oe"># Calculate test statistic </em><br/>    ttest_statistic <strong class="nu iu">&lt;-</strong> (apply(data, 1, mean) <strong class="nu iu">-</strong> mu0) <strong class="nu iu">/</strong>        sqrt(apply(data, 1, var) <strong class="nu iu">/</strong> n)<br/>    <br/>    <em class="oe"># Rejection area in the t-distribution</em><br/>    t05 <strong class="nu iu">&lt;-</strong> qt(0.975, n-1)<br/>    <br/>    <em class="oe"># Calculate power of test</em><br/>    power <strong class="nu iu">&lt;-</strong> sum(abs(ttest_statistic)<strong class="nu iu">&gt;</strong>t05)<strong class="nu iu">/</strong>S<br/>    <br/>    return(power)<br/>}</span></pre><p id="ccb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们创建一个不同样本大小的向量，我们将在函数中测试它。根据我们想要测试的内容，我们可以操作<code class="fe nr ns nt nu b">ttest_function()</code>中的任何参数。在这种情况下，我们使用不同的样本大小值<code class="fe nr ns nt nu b">n</code>运行函数。</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="8d19" class="nz mv it nu b gy oa ob l oc od"><em class="oe"># Vector with sample sizes we wish to evaluate</em><br/>sample_size <strong class="nu iu">&lt;-</strong> c(10, 15, 20, 25, 30, 35, 40)<br/><br/><em class="oe"># Use sapply to test different sample sizes in the ttest_power function</em><br/>power <strong class="nu iu">&lt;-</strong> sapply(sample_size, function(x)ttest_power(S <strong class="nu iu">=</strong> 1000, n <strong class="nu iu">=</strong> x, mu <strong class="nu iu">=</strong> 0, sigma <strong class="nu iu">=</strong> 1, mu0 <strong class="nu iu">=</strong> 0.5))<br/><br/><em class="oe"># Add sample sizes as names to the result</em><br/>names(power) <strong class="nu iu">&lt;-</strong> sample_size<br/>power</span><span id="96af" class="nz mv it nu b gy of ob l oc od">Output:<br/>   10    15    20    25    30    35    40 <br/>0.311 0.448 0.563 0.676 0.748 0.820 0.868</span></pre><p id="b93d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们有均值为 0、标准差为 1 的数据，并针对均值为 0.5 的零假设进行测试，我们必须至少有 35 个样本才能获得高于 80%的功效。我们可以看到，如果我们的样本量为 20，检测到真正差异的概率只有 56%。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="a0eb" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">示例:生成几个图</h1><p id="32b3" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated"><code class="fe nr ns nt nu b">apply</code>也可用于一次调用产生几个情节。如果我们想查看一些生成数据的分布，我们可以使用 apply。</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="4328" class="nz mv it nu b gy oa ob l oc od"><em class="oe"># generate four samples of 1000 random variable from the normal distribution</em><br/>random_normal <strong class="nu iu">&lt;-</strong> generate.normal(S <strong class="nu iu">=</strong> 4, n <strong class="nu iu">=</strong> 1000, mu <strong class="nu iu">=</strong> 0, sigma <strong class="nu iu">=</strong> 1)<br/><br/><em class="oe"># display plots 2 by 2</em><br/>par(mfrow<strong class="nu iu">=</strong>c(2,2))<br/><br/><em class="oe"># samples are stored row wise, so we call margin = 1</em><br/>plots <strong class="nu iu">&lt;-</strong> apply(random_normal, 1, hist)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/f2337497008d2253ce89975bdb0d21ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*05wDUt4ZNlNxOX_bSX0nbQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="20d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些只是应用函数如何帮助你用几行代码进行大量计算的几个例子！我真的觉得 apply-family 非常有用，希望这个指南也能帮助你开始使用这些功能。</p></div></div>    
</body>
</html>