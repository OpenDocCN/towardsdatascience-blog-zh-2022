<html>
<head>
<title>SageMaker Serverless Inference Is Now Generally Available</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SageMaker无服务器推理现在已经普遍可用</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/sagemaker-serverless-inference-is-now-generally-available-e42550a146fe#2022-04-21">https://towardsdatascience.com/sagemaker-serverless-inference-is-now-generally-available-e42550a146fe#2022-04-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="beda" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">探索最新的SageMaker推理选项</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a3de3de0eef5c24eb66c2ffad3024ac5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*esshnfqYm-EpAulF"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@tvick" rel="noopener ugc nofollow" target="_blank">泰勒维克</a>从<a class="ae ky" href="https://unsplash.com/photos/M5tzZtFCOfs" rel="noopener ugc nofollow" target="_blank">取消</a>的图片</p></figure><p id="8be2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">写这篇文章让我超级兴奋。ML推理本身就超级有趣。添加无服务器，它会变得更加有趣！当我们谈到无服务器推理之前，我们不得不考虑可能使用的服务，如AWS <a class="ae ky" href="https://github.com/aws-samples/aws-lambda-docker-serverless-inference" rel="noopener ugc nofollow" target="_blank"> Lambda </a>。Lambda等服务的问题在于，它们没有现成的托管ML基础设施工具。你必须自己建立、管理和维护所有的容器、ML基础设施。</p><p id="4016" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SageMaker无服务器推理将所有这些抽象出来。它允许你专注于模型构建过程，不需要像Lambda那样维护你自己的容器。无服务器推理从其他SageMaker推理选项中获得了相同的核心基础。它仍然支持<a class="ae ky" href="https://github.com/aws/deep-learning-containers/blob/master/available_images.md" rel="noopener ugc nofollow" target="_blank"> AWS深度学习图像</a>/框架和<a class="ae ky" rel="noopener" target="_blank" href="/bring-your-own-container-with-amazon-sagemaker-37211d8412f4">自带容器(BYOC) </a>方法的灵活性。如果您在SageMaker上已经有实时推理工作负载，那么您可以保留大部分相同的代码，并添加包含无服务器配置的代码片段。在本文中，我们将探索一个将Sklearn模型部署到SageMaker无服务器端点的示例。</p><p id="6718" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意:</strong>对于刚接触AWS的人来说，如果你想继续学习，请确保在下面的<a class="ae ky" href="https://aws.amazon.com/console/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">链接</strong> </a>中注册账户。部署过程中会产生成本，尤其是如果您让端点保持运行。本文还将假设您对SageMaker和AWS有一定的了解。</p><h2 id="d8fc" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">目录</h2><ol class=""><li id="9585" class="mo mp it lb b lc mq lf mr li ms lm mt lq mu lu mv mw mx my bi translated">何时使用无服务器推理</li><li id="e116" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">无服务器推理支持什么？</li><li id="0c55" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">无服务器推理示例</li><li id="ec59" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">其他资源和结论</li></ol><h2 id="b77a" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">何时使用无服务器推理</h2><p id="0bbd" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">目前SageMaker推理有四个主要选项:<a class="ae ky" href="https://docs.aws.amazon.com/sagemaker/latest/dg/realtime-endpoints.html" rel="noopener ugc nofollow" target="_blank">实时推理</a>、<a class="ae ky" href="https://docs.aws.amazon.com/sagemaker/latest/dg/batch-transform.html" rel="noopener ugc nofollow" target="_blank">批量推理</a>、<a class="ae ky" href="https://docs.aws.amazon.com/sagemaker/latest/dg/async-inference.html" rel="noopener ugc nofollow" target="_blank">异步推理</a>，以及现在的无服务器推理。在过去的<a class="ae ky" href="https://aws.plainenglish.io/what-sagemaker-inference-option-should-you-use-2e88c8fc70bf" rel="noopener ugc nofollow" target="_blank">文章</a>中，我解释了前三个选项的用例。那么什么时候使用无服务器推理呢？</p><p id="80ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">当你有<strong class="lb iu">间歇性</strong>和<strong class="lb iu">不可预测的工作负载</strong>时，无服务器推理</strong>是一个很好的选择。理想情况下，您的工作负载应该能够承受任何无服务器解决方案的冷启动。使用无服务器推理的另一个主要原因是没有基础设施管理。如果你不想处理自动缩放或实例管理/设置，那么无服务器推理是一个很好的选择。无服务器推理的另一个主要价值主张是节约成本。你通过<a class="ae ky" href="https://aws.amazon.com/sagemaker/pricing/" rel="noopener ugc nofollow" target="_blank">调用</a>为无服务器推理付费，而不是通过实时推理按小时计费。如果您的团队正在SageMaker上构建一个<strong class="lb iu"> POC </strong>并且不想在此过程中产生大量费用，这是一个很好的选择。</p><h2 id="068c" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">无服务器推理支持什么？</h2><p id="aa64" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在Reinvent 2021中推出无服务器推理预览版后，增加了一些关键功能。启用了SageMaker Python SDK 支持，这使得使用Amazon SageMaker进行无服务器推理来训练和部署受支持的<a class="ae ky" href="https://aws.plainenglish.io/how-to-retrieve-amazon-sagemaker-deep-learning-images-ff4a5866299e" rel="noopener ugc nofollow" target="_blank">容器/框架</a>变得前所未有的容易。您还可以使用<a class="ae ky" href="https://docs.aws.amazon.com/sagemaker/latest/dg/model-registry.html" rel="noopener ugc nofollow" target="_blank">模型注册表</a>进行无服务器推断，这将为您的MLOps工作流添加无服务器端点提供灵活性。最后，每个端点的<strong class="lb iu">最大并发调用</strong>已经增加到<strong class="lb iu"> 200 </strong> <strong class="lb iu">(预览时为50)。</strong></p><h2 id="abd5" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">无服务器推理示例</h2><p id="41bc" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">对于我们的无服务器推理示例，我们将使用California Housing数据集训练和部署Sklearn模型。该数据集在SageMaker示例数据集存储库中公开提供，我们将展示您可以在笔记本中检索它。</p><p id="cfde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于设置，我们将使用<strong class="lb iu"> SageMaker Studio </strong>和<strong class="lb iu"> Python3数据科学内核</strong>。您还可以使用<strong class="lb iu">经典笔记本实例</strong>并使用<strong class="lb iu"> ml.m5.xlarge笔记本实例</strong>和<strong class="lb iu"> conda_python3内核</strong>。一旦你在你的笔记本上，我们将设置我们的S3桶和培训实例。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">S3和培训设置</p></figure><p id="370f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将从公共SageMaker样本中检索加利福尼亚住房数据集。这是一个<strong class="lb iu">回归问题</strong>，我们将使用<strong class="lb iu"> Sklearn框架</strong>来解决它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">检索数据集</p></figure><p id="dbe3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以使用Pandas读取数据集，以确保我们已经正确地创建了数据帧。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">读取数据集</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/e181c3bffdd97445f9d5678bdaadf842.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZMHRGu-tsaGGif3kqPQrHg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据集头(作者截图)</p></figure><p id="a97f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们将这个数据集上传到S3，SageMaker将在那里访问训练数据并转储模型工件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上传数据到S3</p></figure><p id="d03b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://sagemaker.readthedocs.io/en/stable/frameworks/sklearn/sagemaker.sklearn.html" rel="noopener ugc nofollow" target="_blank"> Sklearn </a>是SageMaker提供的支持深度学习的容器之一，因此我们可以直接使用SageMaker Python SDK抓取图像，而无需处理任何Docker相关的工作。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Sklearn估计量</p></figure><p id="3b93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们传入一个包含模型和推理函数的入口点脚本。我们不会深入讨论这个例子中的<a class="ae ky" href="https://github.com/aws-samples/amazon-sagemaker-script-mode" rel="noopener ugc nofollow" target="_blank">脚本模式</a>，而是看一看这篇<a class="ae ky" href="https://ram-vegiraju.medium.com/training-and-deploying-custom-scikit-learn-models-on-aws-sagemaker-3de6a2f669f4" rel="noopener">文章</a>来了解如何在亚马逊SageMaker上训练Sklearn模型。</p><p id="12f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们快速浏览一下训练脚本，我们可以看到我们正在使用一个<a class="ae ky" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html" rel="noopener ugc nofollow" target="_blank">随机森林模型</a>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">培训脚本中的模型</p></figure><p id="a999" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意处理输入的函数。<strong class="lb iu"> input_fn </strong>决定了<strong class="lb iu">数据格式</strong>的类型，您可以为您的<strong class="lb iu">模型推断</strong>传递该数据格式。要了解更多关于推理处理器的信息，请查看这篇文章。</p><p id="3dfa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以使用我们的Sklearn估计器执行模型训练。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">火车模型</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/a698bc88410a38a1c57928889243a302.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*blnRp-5Xu-KtuEPnQuPQAw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">培训完成(作者截图)</p></figure><p id="99e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">训练完成后，我们现在可以进行推理了。到目前为止，一切都与实时推理或任何其他SageMaker推理选项完全相同。在这里，我们可以通过<a class="ae ky" href="https://sagemaker.readthedocs.io/en/v2.77.1/api/inference/serverless.html" rel="noopener ugc nofollow" target="_blank"> SageMaker Python SDK </a>添加一个ServerlessConfig，并将其附加到我们的端点。</p><p id="d9fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的两个参数是<strong class="lb iu"> MemorySize </strong>和MaxConcurrency。内存大小一般应该是最小的<strong class="lb iu"/><strong class="lb iu">和你的<strong class="lb iu">型号</strong>一样大的</strong>。您可以将内存设置为以下值:<strong class="lb iu"> 1024 MB、2048 MB、3072 MB、4096 MB、5120 MB或6144 MB </strong>。<strong class="lb iu"> MaxConcurrency </strong>是单个端点的<strong class="lb iu">最大并发调用数</strong>，现在已经增加到GA的<strong class="lb iu"> 200 </strong>。这是您必须为无服务器端点指定的唯一两个参数，所有基础设施工作和管理都在幕后进行。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">无服务器配置对象</p></figure><p id="b9b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以像往常一样部署端点并附加这个对象。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">无服务器端点部署</p></figure><p id="efd1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以看到这个端点的一个简单推论。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">示例调用</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/91f7d72c2291ecbf9f5a9d0a63b1eb12.png" data-original-src="https://miro.medium.com/v2/resize:fit:244/format:webp/1*g5q2RLv2iesD9Ocgns1tQA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">推论(作者截图)</p></figure><h2 id="d528" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">其他资源和结论</h2><div class="nm nn gp gr no np"><a href="https://github.com/RamVegiraju/SageMaker-Deployment/blob/master/Serverless/Sklearn/sklearn-serverless.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd iu gy z fp nu fr fs nv fu fw is bi translated">主RamVegiraju/sage maker-Deployment上的sage maker-Deployment/sk learn-server less . ipynb</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">SageMaker推理选项和其他功能的例子汇编。…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">github.com</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od ks np"/></div></div></a></div><p id="30ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关示例的完整代码，请访问上面的链接。关于使用无服务器推理的模型注册的例子，请看这个<a class="ae ky" href="https://github.com/aws/amazon-sagemaker-examples/blob/main/serverless-inference/serverless-model-registry.ipynb" rel="noopener ugc nofollow" target="_blank">例子</a>。关于无服务器推理的拥抱脸的例子，看看这个<a class="ae ky" href="https://www.philschmid.de/sagemaker-serverless-huggingface-distilbert" rel="noopener ugc nofollow" target="_blank">博客</a>和<a class="ae ky" href="https://github.com/huggingface/notebooks/blob/main/sagemaker/19_serverless_inference/sagemaker-notebook.ipynb" rel="noopener ugc nofollow" target="_blank">例子</a>。对于AWS官方博客发布的无服务器推理，请查看下面的文章<a class="ae ky" href="https://aws.amazon.com/blogs/aws/amazon-sagemaker-serverless-inference-machine-learning-inference-without-worrying-about-servers/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="ed05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一如既往，我希望这是一篇关于SageMaker推论的好文章，欢迎在评论中留下任何反馈或问题。如果你对更多AWS/SageMaker相关内容感兴趣，请查看我为你编辑的这个<a class="ae ky" href="https://ram-vegiraju.medium.com/list/aws-42b81fcfe143" rel="noopener">列表</a>。</p></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><p id="d9ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ol">如果你喜欢这篇文章，请在</em><a class="ae ky" href="https://www.linkedin.com/in/ram-vegiraju-81272b162/" rel="noopener ugc nofollow" target="_blank"><em class="ol">LinkedIn</em></a><em class="ol">上与我联系，并订阅我的媒体</em> <a class="ae ky" href="https://ram-vegiraju.medium.com/subscribe" rel="noopener"> <em class="ol">简讯</em> </a> <em class="ol">。如果你是新手，使用我的</em> <a class="ae ky" href="https://ram-vegiraju.medium.com/membership" rel="noopener"> <em class="ol">会员推荐</em> </a> <em class="ol">报名。</em></p></div></div>    
</body>
</html>