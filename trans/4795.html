<html>
<head>
<title>Facebook SQL Interview Question Walkthrough — Popular Posts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">脸书SQL面试问题演练—热门帖子</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/facebook-sql-interview-question-walkthrough-popular-posts-614b34ec3861#2022-10-25">https://towardsdatascience.com/facebook-sql-interview-question-walkthrough-popular-posts-614b34ec3861#2022-10-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5bdb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我们的一系列面试问题演练继续进行！今天我们将处理高级元/脸书SQL面试问题。</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/ac0cfc149a4ccc5ef15eae4a1449004c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Y79WCvw6kT7t4IYKI0YLA.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">作者在<a class="ae kw" href="https://www.canva.com/" rel="noopener ugc nofollow" target="_blank"> Canva </a>上创建的图片</p></figure><p id="aa0f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">元/脸书都是关于数据的，而这些数据是你创造的。你作为用户喜欢什么，评论什么，发帖什么，都会定期收集分析。</p><p id="7361" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这一分析体现在我们今天向您展示的面试问题中。为了让解释更加简单，我们制作了一个视频:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="lt lu l"/></div></figure><h1 id="1223" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">meta/脸书SQL面试问题</h1><p id="2125" class="pw-post-body-paragraph kx ky iq kz b la mn jr lc ld mo ju lf lg mp li lj lk mq lm ln lo mr lq lr ls ij bi translated">这个问题会问你以下问题。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ms"><img src="../Images/b47585500b97c55005cb876fb61e4060.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IhsdB_Vl66OjTkJc"/></div></div></figure><p id="746f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这是问题的<a class="ae kw" href="https://platform.stratascratch.com/coding/2073-popular-posts?code_type=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank">链接</a>，如果你想跟我一起去的话。</p><p id="4ac0" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">你的任务是找出热门帖子，即那些被浏览超过5秒钟的帖子。对于所有热门的帖子，你需要找到帖子ID和以秒为单位的总观看时间，才能通过这个面试问题。</p><p id="0997" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这个要求看起来很简单，但是这个问题被归类为困难是有原因的。我们建议你通过应用这个简单而有效的框架来解决这个问题，以及所有其他的编码面试问题。</p><p id="5316" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果你这样做了，你就不会在解决问题的过程中看到所有等待你的陷阱，从而避免做出轻率的——而且大多是错误的——决定。</p><h1 id="713c" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">解决元/脸书(和所有其他)SQL面试问题的解决方案框架</h1><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/6a65af3bcf47cf6092b494c67e5c6c29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rxWd-QOQbZdc9meGT0DHWg.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">作者在<a class="ae kw" href="https://www.canva.com/" rel="noopener ugc nofollow" target="_blank"> Canva </a>创建的图像</p></figure><p id="f595" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">该框架由三个步骤组成。我们在许多文章中使用了这个框架，并对其进行了一些修改。</p><p id="9690" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这些是我们在解决面试问题时要用到的步骤。</p><ol class=""><li id="a490" class="mt mu iq kz b la lb ld le lg mv lk mw lo mx ls my mz na nb bi translated">探索数据集</li><li id="f693" class="mt mu iq kz b la nc ld nd lg ne lk nf lo ng ls my mz na nb bi translated">写出方法</li><li id="b792" class="mt mu iq kz b la nc ld nd lg ne lk nf lo ng ls my mz na nb bi translated">解决方案编码</li></ol><p id="c891" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">首先，了解数据集。给你什么桌子，你需要所有的桌子吗？如何连接这些表？表格的列和数据类型是什么，数据显示什么，在表格中是如何表示的？这些都是这一步会帮你回答的问题。</p><p id="a7d6" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">然后考虑你将如何进行编码，你的代码的逻辑构建块，以及你将使用什么函数。如果你还没有，这是吸引面试官的必经步骤。与他们交谈，创造一个对话来验证你的逻辑是否正确。</p><p id="9ae2" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">最后，您可以开始编写您的解决方案了！</p><h1 id="c428" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">1.探索数据集</h1><p id="6665" class="pw-post-body-paragraph kx ky iq kz b la mn jr lc ld mo ju lf lg mp li lj lk mq lm ln lo mr lq lr ls ij bi translated">问题给出了表<strong class="kz ir">用户会话</strong>和<strong class="kz ir">帖子视图</strong>。</p><p id="4934" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"> user_sessions </strong>表包含以下数据类型的列。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/60ade14f9721f7671332acf42c7ea39a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T6nUqGgozkupSqrC"/></div></div></figure><p id="9eeb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">您可以假设列session_id是表的主键。所有其他列为您提供关于特定会话的支持信息。</p><p id="e2aa" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">当分析数据集时，考虑如何创建列和表的叙述。这样，你会更好地理解你面前的数据集。这也给了你一个极好的机会与面试官交流，问问题，澄清你的假设。我们总是建议你在面试中大胆思考。一开始可能会觉得有点尴尬，但是当你看到它是如此的高效时，你很快就会习惯了。</p><p id="8252" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这个表的叙述可以这样构成。每个会话ID都是连续的，并且对于用户和平台组合是唯一的。如果用户注销并重新登录，将会创建一个新的会话ID。如果用户从笔记本电脑切换到移动设备会怎样？这将被记录为两个单独的会话。</p><p id="c57d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">由此，您可能会看到重复的用户id和user_id/platform组合。</p><p id="c2a3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">第二个表具有以下模式。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/75dcdd3a98426296f6e9a06c3222b60e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*j1E0ScBbj8GMaztA"/></div></div></figure><p id="0340" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">session_id列与第一个表中的相同，因此可以假定它是这个表的外键。可以使用这个公共列来连接这些表。</p><p id="bfad" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">需要知道的一件重要事情是perc_viewed列中的数据是如何表示的。10%显示为10.0还是0.1？你可以做一个假设，或者问面试官。</p><p id="39df" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">预览确认百分比是如何显示的。</p><p id="338a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">表格:</strong>帖子_浏览量</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nh"><img src="../Images/481d7f90e3d710e3aa5676ae913791d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9jtfGSpDtIX3GWQYwVInuQ.png"/></div></div></figure><p id="b8e2" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了继续叙述，可以在单个会话中查看几个帖子。因此，上表中应该有多个会话id。</p><p id="1677" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">此外，将有多个帖子id，因为帖子可以在不同的会话中被多次查看。</p><h1 id="d05e" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">2.写出方法</h1><p id="a18c" class="pw-post-body-paragraph kx ky iq kz b la mn jr lc ld mo ju lf lg mp li lj lk mq lm ln lo mr lq lr ls ij bi translated">在考虑方法时，考虑输出应该是什么样子。然后，确定您需要什么数据，以及您需要如何操作它来获得所需的输出。</p><p id="b0e7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">对于这个问题，输出将有两列:post_id和total_viewtime。</p><p id="57a9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"> 1。计算会话持续时间</strong></p><p id="09db" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">持续时间是会话结束时间和开始时间之间的差值，可以在表<strong class="kz ir"> user_sessions </strong>中找到。</p><p id="4b19" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">EXTRACT()和EPOCH函数是获取会话持续时间(以秒为单位)的绝佳组合。</p><p id="5dfb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"> 2。计算帖子在每个时段的浏览次数</strong></p><p id="8b09" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">可以使用以下公式计算观看后时间。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nh"><img src="../Images/673bca75a6b11b118a1c8d4a5836445a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Qgv8mIf2b451-_Bcy6AJw.png"/></div></div></figure><p id="e9fa" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">PercentViewed是查看帖子所花费的会话百分比。这由表<strong class="kz ir"> post_views </strong>中的perc _ viewed列表示。</p><p id="e2b4" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">另外，前面的计算必须转换成一个子查询，并与这个子查询连接。</p><p id="55e4" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"> 3。计算每个帖子在所有会话中的总浏览时间</strong></p><p id="f340" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">此计算需要使用SUM()聚合函数对PostViewingTime求和。</p><p id="a1f7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">要获得文章级别的值，需要按照post_id列对数据进行分组。</p><p id="ee0e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"> 4。仅过滤热门帖子</strong></p><p id="1e31" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">请记住，该问题将热门帖子定义为观看时间高于5秒的帖子。</p><p id="3552" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">因为您将在聚合后过滤数据，所以使用HAVING而不是WHERE。</p><h1 id="7181" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">3.解决方案编码</h1><p id="a608" class="pw-post-body-paragraph kx ky iq kz b la mn jr lc ld mo ju lf lg mp li lj lk mq lm ln lo mr lq lr ls ij bi translated">现在让我们使用概述的步骤来编写一个SQL解决方案。</p><p id="2f67" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"> 1。计算会话持续时间</strong></p><pre class="kh ki kj kk gt ni nj nk nl aw nm bi"><span id="6a18" class="nn lw iq nj b gy no np l nq nr">SELECT session_id,<br/> EXTRACT(EPOCH FROM session_endtime) - EXTRACT(EPOCH FROM session_starttime) AS duration<br/>FROM user_sessions;</span></pre><p id="a988" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">命令EXTRACT(EPOCH FROM column_name)返回Unix时间戳或Unix Epoch时间。它是自协调世界时(UTC)1970年1月1日星期四00:00:00以来经过的秒数。</p><p id="5ff7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">就其本身而言，这个命令对这个分析没有太大帮助。然而，一旦演绎进入游戏，事情就不一样了。以秒为单位减去两个这样的值相当于以秒为单位获得两个日期时间值之间的时间差。你猜怎么着？这正是你解决这个问题所需要的。</p><p id="de8b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">运行上述代码会返回以下输出。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ns"><img src="../Images/4de4dff6174762962ca1e6da5d6f6e79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iFsyapBy7iP9IS8-"/></div></div></figure><p id="2364" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">你可能认为有更直接的方法来做同样的事情。例如，通过直接减去结束和开始时间。</p><pre class="kh ki kj kk gt ni nj nk nl aw nm bi"><span id="f689" class="nn lw iq nj b gy no np l nq nr">SELECT session_id,<br/>       (session_endtime - session_starttime) AS duration<br/>FROM user_sessions;</span></pre><p id="7fb3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">是的，是真的；它会给你带来同样的价值和产出——尽管只是表面上的。当直接减去两个日期时，结果是创建一个interval数据类型，而不是float或integer。</p><p id="6412" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们还将向您展示如何使用这种方法来获得解决方案。</p><p id="4733" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"> 2。计算帖子在每个时段的浏览次数</strong></p><p id="8d21" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在这一步中，添加计算文章查看时间的SELECT语句，并将其与前面的查询连接起来。</p><pre class="kh ki kj kk gt ni nj nk nl aw nm bi"><span id="9274" class="nn lw iq nj b gy no np l nq nr">SELECT post_id,<br/>       duration * (perc_viewed/100)::float AS seconds_viewed<br/>FROM post_views p<br/>JOIN<br/>  (SELECT session_id,<br/>          EXTRACT(EPOCH FROM session_endtime) - EXTRACT(EPOCH FROM session_starttime) AS duration<br/>   FROM user_sessions) s ON s.session_id = p.session_id;</span></pre><p id="9511" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">该查询将输出这些数据。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/991ed5a6d11224ebdcdea8a8cd410f58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_1ozG3lFroFRCLZv"/></div></div></figure><p id="659c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们对数据的假设在这里被证明是正确的。每个帖子有多个条目，每个条目代表一个单独会话的一个视图。</p><p id="3e2a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"> 3。计算每个帖子在所有会话中的总浏览时间</strong></p><p id="47d8" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">要获得所有会话中每个帖子的总查看时间，您需要在post_id级别聚合结果，并对总查看时间求和()。</p><pre class="kh ki kj kk gt ni nj nk nl aw nm bi"><span id="ae7d" class="nn lw iq nj b gy no np l nq nr">SELECT post_id,<br/>       SUM(duration * (perc_viewed/100)::float) AS total_viewtime<br/>FROM post_views p<br/>JOIN<br/>  (SELECT session_id,<br/>   EXTRACT(EPOCH FROM session_endtime) - EXTRACT(EPOCH FROM session_starttime) AS duration<br/>   FROM user_sessions) s ON p.session_id = s.session_id<br/>GROUP BY post_id;</span></pre><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/e212e999beb691c0b216c6ad54fe9ff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yfxbYUmf5oVJI6dK"/></div></div></figure><p id="4e24" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在这个结果中，您获得了独特的职位和他们的总观看时间。在最后一步，你必须过滤数据，只显示热门的文章。</p><p id="1ab4" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"> 4。仅过滤热门帖子</strong></p><p id="1b3a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">要获得最终输出，需要使用HAVING子句。您不能使用WHERE，因为您需要在聚合后应用过滤器。您可能已经知道了这一点，但是有必要提醒自己:WHERE之前过滤数据，而have在聚合之后过滤数据。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/c09c78ead3b6b5882ee7fd90d752fb0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4x1Lc84EeKdSM-Q_"/></div></div></figure><p id="9463" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">输出显示了两个热门帖子及其各自的总查看时间。</p><h1 id="3b17" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">可选择的解决方案</h1><p id="59cc" class="pw-post-body-paragraph kx ky iq kz b la mn jr lc ld mo ju lf lg mp li lj lk mq lm ln lo mr lq lr ls ij bi translated">还记得我们说过日期可以直接减去吗？让我们试试看这种方法能否给出这个问题的正确答案。</p><pre class="kh ki kj kk gt ni nj nk nl aw nm bi"><span id="0c5f" class="nn lw iq nj b gy no np l nq nr">SELECT post_id,<br/>       SUM(duration * (perc_viewed/100)::float) AS total_viewtime<br/>FROM post_views p<br/>JOIN<br/>  (SELECT session_id,<br/>          (session_endtime - session_starttime) AS duration<br/>   FROM user_sessions) s ON p.session_id = s.session_id<br/>GROUP BY post_id<br/>HAVING SUM(duration * (perc_viewed/100)::float) &gt; 5;</span></pre><p id="7e67" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">不，它返回一个错误！</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ms"><img src="../Images/e52e0d6dabd8dd48eb26e797f76a5634.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*g_Bj-ysGlyopgzUW"/></div></div></figure><p id="1182" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">出现错误是因为SUM(duration *(PERC _ viewed/100)::float)输出一个区间，我们将它与一个整数进行比较。</p><p id="4a02" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">然而，这并不意味着我们不能让这种方法工作！解决方法相当简单；你得把整数转换成区间，就像这样。</p><pre class="kh ki kj kk gt ni nj nk nl aw nm bi"><span id="56cc" class="nn lw iq nj b gy no np l nq nr">SELECT post_id,<br/>       SUM(duration * (perc_viewed/100)::float) AS total_viewtime<br/>FROM post_views p<br/>JOIN<br/>  (SELECT session_id,<br/>          (session_endtime - session_starttime) AS duration<br/>   FROM user_sessions) s ON p.session_id = s.session_id<br/>GROUP BY 1<br/>HAVING SUM(duration * (perc_viewed/100)::float) &gt; 5 * '1 sec'::interval;</span></pre><p id="7063" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这个对代码的微小修改给了你问题的答案。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/1527150f0b87bf189406eab02211a7c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ec1Cz4SC-O58-dlA"/></div></div></figure><h1 id="2246" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">最佳化</h1><p id="6076" class="pw-post-body-paragraph kx ky iq kz b la mn jr lc ld mo ju lf lg mp li lj lk mq lm ln lo mr lq lr ls ij bi translated">在大多数面试中，你会被问到的一个问题就是优化你的代码。看看解决方案，想想有什么可以优化的。</p><p id="b6f8" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我想到的是通过使用公共表表达式或CTE使代码更具可读性。</p><p id="283a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这是优化后的解决方案。</p><pre class="kh ki kj kk gt ni nj nk nl aw nm bi"><span id="4c5c" class="nn lw iq nj b gy no np l nq nr">WITH temp AS <br/>(SELECT session_id,<br/>  EXTRACT(EPOCH FROM session_endtime) - EXTRACT(EPOCH FROM session_starttime) AS duration<br/>FROM user_sessions)</span><span id="0104" class="nn lw iq nj b gy nt np l nq nr">SELECT post_id,<br/>       SUM(duration * (perc_viewed/100)::float) AS total_viewtime<br/>FROM post_views p<br/>JOIN temp ON p.session_id = temp.session_id<br/>GROUP BY post_id<br/>HAVING SUM(duration * (perc_viewed/100)::float) &gt; 5;</span></pre><h1 id="edc2" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">结论</h1><p id="2b52" class="pw-post-body-paragraph kx ky iq kz b la mn jr lc ld mo ju lf lg mp li lj lk mq lm ln lo mr lq lr ls ij bi translated">没那么难吧。</p><p id="d03c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们将这个问题归类为硬级别问题，因为它需要各种技术概念的知识，比如连接、聚合、过滤器、日期时间数据和子查询。</p><p id="7d9f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果你对这些概念很熟悉，你应该很容易找到解决方案。同样重要的是了解您的数据，并预测可能会改变您的代码并使其工作或不工作的不同数据格式。</p><p id="41e6" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">你现在需要的只是一些练习。查看类似“<a class="ae kw" href="https://www.stratascratch.com/blog/facebook-meta-sql-interview-questions/?utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank">脸书SQL面试问题</a>”和“<a class="ae kw" href="https://www.stratascratch.com/blog/facebook-data-scientist-interview-questions/?utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank">脸书数据科学家面试问题</a>”的帖子，练习更多真实世界的面试问题。</p></div></div>    
</body>
</html>