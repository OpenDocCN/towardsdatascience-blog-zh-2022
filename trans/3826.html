<html>
<head>
<title>Applying Python multiprocessing in 2 lines of code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在两行代码中应用Python多重处理</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/applying-python-multiprocessing-in-2-lines-of-code-3ced521bac8f#2022-08-25">https://towardsdatascience.com/applying-python-multiprocessing-in-2-lines-of-code-3ced521bac8f#2022-08-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="952c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">何时以及如何使用多个内核来加快执行速度</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/da1b03133ea4a96e6e54f3b97541ca33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dwwmDd1I8IyeQ2Jj"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">多个引擎同时执行(图片由<a class="ae ky" href="https://unsplash.com/@meteorphoto" rel="noopener ugc nofollow" target="_blank">彼得·普里哈尔斯基</a>在<a class="ae ky" href="https://unsplash.com/photos/oapXDz7x_YE" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄)</p></figure><p id="e60c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将在<strong class="lb iu">中多进程处理一个函数，只有两行代码</strong>。在我们的例子中，这将导致代码的<strong class="lb iu">显著加速</strong>。首先，我们将了解何时多处理是一个好主意，然后我们将了解如何应用3种类型的多处理，并讨论何时应用哪一种。我们来编码吧！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="015d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">但是首先..</h1><p id="e880" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在我们深入探讨如何应用多处理之前，我们需要准备一些东西。首先，我们将讨论一些术语，并确定何时应该采用多重处理。</p><p id="23c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们将创建一个示例函数，我们可以在本文中将其用作演示。</p><h2 id="745d" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">并发与并行——线程与多处理</h2><p id="0ce7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Python中有两种“同时做事情”的方式:线程化和多处理。在本文中，我们将关注后者。一个简短的区别:</p><ul class=""><li id="750b" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated"><strong class="lb iu">线程</strong>并发运行代码<strong class="lb iu"/>:我们有<strong class="lb iu">一个活动的CPU </strong>，它可以在多个线程之间快速切换(查看下面的文章)</li><li id="27c2" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated"><strong class="lb iu">多重处理</strong>以<strong class="lb iu">并行</strong>方式运行代码:我们有<strong class="lb iu">多个活动的CPU</strong>，它们各自运行自己的代码</li></ul><div class="nz oa gp gr ob oc"><a rel="noopener follow" target="_blank" href="/thread-your-python-program-with-two-lines-of-code-3b474407dbb8"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">用两行代码线程化您的Python程序</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">通过同时做多件事来加速你的程序</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq ks oc"/></div></div></a></div><p id="97cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，在本文中，我们将演示如何并行运行代码。如果您对线程和多处理之间的区别以及何时应用哪个感兴趣；查看下面的文章，获得更深入的解释。</p><p id="2918" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一般来说，如果你的代码涉及大量的计算，并且每个进程或多或少都是独立的(因此进程不必互相等待/需要另一个进程的输出),那么多处理是正确的想法。</p><div class="nz oa gp gr ob oc"><a rel="noopener follow" target="_blank" href="/multi-tasking-in-python-speed-up-your-program-10x-by-executing-things-simultaneously-4b4fc7ee71e"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">Python中的多任务处理:通过同时执行，将程序速度提高10倍</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">应用线程和进程加速代码的分步指南</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="or l on oo op ol oq ks oc"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a96d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为本文创建一个示例</h1><p id="b576" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在这篇文章中，我们将假设有一家公司做图像分析。客户可以给我们发送一个或多个图像，我们分析后发回。</p><p id="8fd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前我们只有一个功能:<code class="fe os ot ou ov b">get_most_popular_color()</code>；它接收图像路径，加载图像并计算最常见的颜色。它返回图像的路径、颜色的rgb值以及具有该颜色的像素的百分比。点击 查看源代码<a class="ae ky" href="https://gist.github.com/mike-huls/896ab6bb00c390d1038c0c1220ac0bab" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">。</strong></a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/2b338077cf806e3f595ae54efff601e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i_HauWQ76UkuOshRXJMR0g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的目标函数(图片由作者提供)</p></figure><p id="2aba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个函数适合MP，因为它要计算很多；它必须遍历图像中的每个像素。</p><div class="nz oa gp gr ob oc"><a rel="noopener follow" target="_blank" href="/image-analysis-for-beginners-destroying-duck-hunt-with-opencv-e19a27fd8b6"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">用OpenCV破坏猎鸭——初学者的图像分析</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">编写代码，将击败每一个鸭子狩猎高分</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="ox l on oo op ol oq ks oc"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e269" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">代码部分:正常应用我们的函数并使用MP</h1><p id="ffb5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们从客户那里收到了12张图片；都在0.2到2 MB之间。我将所有图片的路径存储在一个字符串数组中，如下所示。在我们将多重处理应用到我们的函数之前，我们将正常运行<code class="fe os ot ou ov b">get_most_popular_color()</code>函数，这样我们就有东西可以比较了。</p><pre class="kj kk kl km gt oy ov oz pa aw pb bi"><span id="8f3e" class="mz md it ov b gy pc pd l pe pf">image_paths = [<br/>    'images/puppy_1.png',<br/>    'images/puppy_2.png',<br/>    'images/puppy_3.png',<br/>    'images/puppy_4_small.png',<br/>    'images/puppy_5.png',<br/>    'images/puppy_6.png',<br/>    'images/puppy_7.png',<br/>    'images/puppy_8.png',<br/>    'images/puppy_9.png',<br/>    'images/puppy_10.png',<br/>    'images/puppy_11.png',<br/>    'images/puppy_12.png',<br/>]</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="705e" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">1.正常方式:连续运行</h2><p id="e4a7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">处理这12幅图像最明显的方法是循环遍历它们，一幅接一幅地处理它们:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pg ph l"/></div></figure><p id="be3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里没什么特别的。我们只是为image_paths数组中的每个图像调用函数。在添加一些打印内容来告诉我们更多关于执行时间的信息后，我们得到以下输出:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pg ph l"/></div></figure><p id="4399" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你所看到的，我们一个接一个地处理并打印出每个图像的结果。总的来说，这个过程需要<strong class="lb iu">比</strong>多一点的时间。</p><p id="a7f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">什么时候用这个？如果你的时间不重要，并且你想让你的结果一个接一个地按顺序排列，这种方法是合适的。一旦image1准备就绪，我们就可以将结果发送回客户端。</strong></p><div class="nz oa gp gr ob oc"><a rel="noopener follow" target="_blank" href="/why-is-python-so-slow-and-how-to-speed-it-up-485b5a84154e"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">Python为什么这么慢，如何加速</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">看看Python的瓶颈在哪里</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="pi l on oo op ol oq ks oc"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="54a4" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">2.正常方式:使用地图</h2><p id="dce3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">运行该函数的另一种方式是应用Python的<code class="fe os ot ou ov b">map</code>函数。主要区别在于，它会一直阻塞到所有函数都执行完，这意味着我们只能在图像12被处理后才能访问结果。这看起来像是降级，但它有助于我们更好地理解本文的下一部分:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pg ph l"/></div></figure><p id="3efe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的输出中，您将看到我们只能在每个函数完成后访问结果，换句话说:在函数上使用<code class="fe os ot ou ov b">map</code>会阻塞结果。您可以在输出中看到其结果:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pg ph l"/></div></figure><p id="984d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">8.324秒打印所有行；与整批花费的时间相同。这证明在我们可以访问结果之前，所有的函数都必须完成。</p><p id="fd1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">什么时候用这个？<br/> </strong>当单个客户发送一批图像时，我们希望对它们进行处理，并发回一条包含所有结果的消息。我们不会针对每个结果向客户发送电子邮件。</p><div class="nz oa gp gr ob oc"><a rel="noopener follow" target="_blank" href="/cython-for-absolute-beginners-30x-faster-code-in-two-simple-steps-bbb6c10d06ad"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">面向绝对初学者的Cython:通过简单的两步将代码速度提高30倍</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">为速度惊人的应用程序轻松编译Python代码</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="pj l on oo op ol oq ks oc"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="0729" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">3.多重处理:映射</h2><p id="0db2" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们不想等8秒钟，那太久了！在这一部分，我们将从<code class="fe os ot ou ov b">multiprocessing</code>库中应用一个<code class="fe os ot ou ov b">Pool</code>对象。这个简单而安全的解决方案非常容易应用，只需增加<strong class="lb iu"> 2行代码</strong>:</p><p id="e523" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将采用前一部分的代码，添加一个进程池，并使用进程池的<code class="fe os ot ou ov b">map</code>函数，而不是像前一部分那样使用Python的默认函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pg ph l"/></div></figure><p id="a6dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅仅用两行额外的代码就可以并行运行我们的函数，这难道不令人惊奇吗？查看以下结果:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pg ph l"/></div></figure><p id="f1cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe os ot ou ov b">Pool.map</code>函数做的事情与Python的默认map函数完全相同:它执行所有函数，只有这样您才能访问结果。你可以从所有结果都打印在1.873秒的事实中看出这一点。最大的不同是它并行运行函数:它同时执行12个函数调用，<strong class="lb iu">将执行时间从4倍减少到2秒以下！</strong></p><p id="4b51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">什么时候用这个？<br/> </strong>与方法2一样，结果被锁定(不可访问)，直到所有功能完成。由于它们都是并行运行的，现在我们只需等待2秒钟，而不是8秒钟。我们仍然不能像#1那样真正地循环结果，所以这种方法适合处理像#2那样的批处理。</p><div class="nz oa gp gr ob oc"><a rel="noopener follow" target="_blank" href="/virtual-environments-for-absolute-beginners-what-is-it-and-how-to-create-one-examples-a48da8982d4b"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">绝对初学者的虚拟环境——什么是虚拟环境，如何创建虚拟环境(+例子)</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">深入探究Python虚拟环境、pip和避免纠缠依赖</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="pk l on oo op ol oq ks oc"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="ec24" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">4.用迭代器进行多重处理</h2><p id="de56" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在前一部分中，我们使用了<code class="fe os ot ou ov b">map</code>函数，但是还有其他的选择。在这一部分，我们将检查<code class="fe os ot ou ov b">imap</code>。这个函数的功能大致相同，但它不是在所有函数调用完成之前一直阻塞，而是返回一个迭代器，一个调用完成就可以访问这个迭代器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pg ph l"/></div></figure><p id="6bd2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你所看到的，代码与前一部分几乎完全相同，除了我们将<code class="fe os ot ou ov b">map</code>改为<code class="fe os ot ou ov b">imap</code>。然而，添加这一个字母对结果有一些影响:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pg ph l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">请注意，现在有些函数比其他函数完成得早。</p></figure><p id="bb99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">差别很小，但是很明显:像上一部分一样，每个函数调用完成的时间是不一样的。<code class="fe os ot ou ov b">imap </code>函数并行启动每个调用；为每一个人设计一个程序。然后，一旦准备好，它就按顺序返回每个结果<strong class="lb iu"><em class="pl"/></strong>。这就是为什么一些电话一个接一个地结束，而另一些电话需要更长时间的原因。从这个意义上说，<code class="fe os ot ou ov b">imap</code>类似于执行函数的“正常”Python方式，如#1。</p><p id="6689" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">什么时候用这个？<br/> </strong>当多个客户端各自发送一张我们需要处理的图片时，我们现在可以使用<code class="fe os ot ou ov b">imap</code>功能并行处理。把这个函数想象成#1的平行版本；这是一个普通的循环，但是要快得多。</p><div class="nz oa gp gr ob oc"><a rel="noopener follow" target="_blank" href="/docker-for-absolute-beginners-what-is-docker-and-how-to-use-it-examples-3d3b11efd830"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">面向绝对初学者的Docker——什么是Docker以及如何使用它(+示例)</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">像管理应用程序一样管理您的基础架构</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="pm l on oo op ol oq ks oc"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="e0bc" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">5.用忽略输入顺序的迭代器进行多重处理</h2><p id="bdd5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">最后一种方法是<code class="fe os ot ou ov b">imap_unordered</code>。叫声几乎一模一样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pg ph l"/></div></figure><p id="f161" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个调用与前一部分非常相似；唯一的区别是，它一准备好就返回每个结果:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pg ph l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">注意到图像的顺序已经改变了吗？有些图像已经在0.6秒后返回！</p></figure><p id="18bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们仍然在2秒内完成，但是完成的顺序有很大的不同。请注意，<code class="fe os ot ou ov b">images/puppy_4_small.png</code>首先被返回。这并不奇怪，因为这个图像要小得多。它不必等待其他碰巧较慢的函数调用。分析这个输出，你可能会注意到我偷懒复制了我们的输入图像。</p><p id="f785" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">什么时候用这个？<br/> </strong>这个函数是#1和#4的升级版:它类似于普通的for循环，但是它以并行方式执行所有的函数，并且一旦任何函数准备就绪，就可以访问结果。有了这个功能，拥有小图像的客户端不必等到大图像完成后才能收到结果。</p><div class="nz oa gp gr ob oc"><a rel="noopener follow" target="_blank" href="/image-analysis-for-beginners-creating-a-motion-detector-with-opencv-4ca6faba4b42"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">用OpenCV检测运动——适合初学者的图像分析</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">如何用OpenCV检测和分析运动物体</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="pn l on oo op ol oq ks oc"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e0f3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">限制进程/内核的数量</h1><p id="60ec" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">限制池在任何给定时间允许的最大进程/核心/CPU数量非常容易:只需在实例化池时添加processes参数，如下所示:</p><pre class="kj kk kl km gt oy ov oz pa aw pb bi"><span id="d950" class="mz md it ov b gy pc pd l pe pf">with Pool(processes=2) as mp_pool:<br/>    ... rest of the code</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="514d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="6c5c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">添加多个进程使我们的代码并行运行并不困难；挑战在于知道何时应用哪种技术。总之:多处理库的池对象提供了三个函数。<code class="fe os ot ou ov b">map</code>`是Python内置<code class="fe os ot ou ov b">map</code>的并行版本。<code class="fe os ot ou ov b">imap</code>函数返回一个有序迭代器，访问结果被阻塞。<code class="fe os ot ou ov b">imap_unordered</code>函数返回一个无序迭代器；使它可以在完成后立即访问每一个结果，而不需要等待另一个函数的开始。</p><p id="ea36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇文章像我希望的那样清楚，但如果不是这样，请让我知道我能做些什么来进一步澄清。同时，看看我的<a class="ae ky" href="https://mikehuls.com/articles?tags=python" rel="noopener ugc nofollow" target="_blank">关于各种编程相关话题的其他文章</a>，比如:</p><ul class=""><li id="e93b" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated">绝对初学者的Git:借助视频游戏理解Git</li><li id="990f" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated"><a class="ae ky" href="https://mikehuls.medium.com/create-and-publish-your-own-python-package-ea45bee41cdc" rel="noopener">创建并发布自己的Python包</a></li><li id="6d86" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated"><a class="ae ky" href="https://mikehuls.medium.com/create-a-fast-auto-documented-maintainable-and-easy-to-use-python-api-in-5-lines-of-code-with-4e574c00f70e" rel="noopener">用FastAPI用5行代码创建一个快速自动记录、可维护且易于使用的Python API</a></li></ul><p id="7ab1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！</p><p id="a824" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">—迈克</p><p id="fedc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">附注:喜欢我正在做的事吗？ <a class="ae ky" href="https://mikehuls.medium.com/membership" rel="noopener"> <em class="pl">跟我来！</em> </a></p><div class="nz oa gp gr ob oc"><a href="https://mikehuls.medium.com/membership" rel="noopener follow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">通过我的推荐链接加入媒体-迈克·赫斯</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">阅读迈克·赫斯(以及媒体上成千上万的其他作家)的每一个故事。你的会员费直接支持麦克…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">mikehuls.medium.com</p></div></div><div class="ol l"><div class="po l on oo op ol oq ks oc"/></div></div></a></div></div></div>    
</body>
</html>