<html>
<head>
<title>Translating SQL into Python -Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将 SQL 翻译成 Python-第 1 部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/translating-sql-into-python-part-1-92bf385d08f1#2022-02-03">https://towardsdatascience.com/translating-sql-into-python-part-1-92bf385d08f1#2022-02-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f7d1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">有点像谷歌翻译，但对于̶l̶o̶v̶e̶语言的数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4f4c39ed4c9c8e44cf02424e6051c629.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g_8MDmkUs8oMYwKkM-lcTQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="ae38" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您对 Python 中 SQL 的相应语法感到厌倦，那么您就找对地方了。用两种语言写作的能力不仅能让你对客户或雇主更有吸引力，还能让你写出更高效、更精简的数据流程，从而节省你的大量时间。</p><p id="680a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在 python 中，您可以创建一个直接查询 SQL 数据库的脚本(使用您的 SQL 语言)，然后在同一个脚本中编写后续的数据流程(使用您的 python 语言)。我现在就不说舌头了，继续举几个例子。使用下面的内容跳到感兴趣的部分。</p><p id="a815" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果这里没有涉及到您想要的内容，那么可能会在下面的第 2 部分中讨论，包括 groupbys、datetimes、cast whens 和其他杂项功能。</p><div class="lv lw gp gr lx ly"><a rel="noopener follow" target="_blank" href="/translating-sql-into-python-part-2-5b69c571ddc3"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">将 SQL 翻译成 Python —第 2 部分</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">有点像谷歌翻译，但对于̶l̶o̶v̶e̶语言的数据</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">towardsdatascience.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="b951" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">目录:</strong></p><ol class=""><li id="b9d2" class="mu mv it la b lb lc le lf lh mw ll mx lp my lt mz na nb nc bi translated"><a class="ae nd" href="#80ca" rel="noopener ugc nofollow"><strong class="la iu"/></a></li><li id="9803" class="mu mv it la b lb ne le nf lh ng ll nh lp ni lt mz na nb nc bi translated"><a class="ae nd" href="#ca3b" rel="noopener ugc nofollow"><strong class="la iu"/></a></li><li id="7701" class="mu mv it la b lb ne le nf lh ng ll nh lp ni lt mz na nb nc bi translated"><a class="ae nd" href="#05ca" rel="noopener ugc nofollow"><strong class="la iu"/></a>的‘更新’</li><li id="8be7" class="mu mv it la b lb ne le nf lh ng ll nh lp ni lt mz na nb nc bi translated"><a class="ae nd" href="#bc42" rel="noopener ugc nofollow"><strong class="la iu"/></a></li><li id="e729" class="mu mv it la b lb ne le nf lh ng ll nh lp ni lt mz na nb nc bi translated"><a class="ae nd" href="#f9a7" rel="noopener ugc nofollow"><strong class="la iu"/></a></li></ol></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="05e6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，确保您已经安装了 pandas 库(这是 Anaconda 包的默认设置),并使用以下命令将其导入到您的脚本中:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="78e1" class="no np it nk b gy nq nr l ns nt">import pandas as pd</span></pre><h1 id="80ca" class="nu np it bd nv nw nx ny nz oa ob oc od jz oe ka of kc og kd oh kf oi kg oj ok bi translated"><strong class="ak"> 1。</strong>中的“选择”</h1><p id="491d" class="pw-post-body-paragraph ky kz it la b lb ol ju ld le om jx lg lh on lj lk ll oo ln lo lp op lr ls lt im bi translated">a.全选</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="0403" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>select * from table<br/><strong class="nk iu"># python</strong><br/>table</span></pre><p id="d7a9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">b.选定列</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="7c3f" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>select col1 from table<br/><strong class="nk iu"># python</strong><br/>table.col1</span></pre><p id="a7c4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">c.选择所有唯一记录</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="8ca8" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>select distinct * from table<br/><strong class="nk iu"># python</strong><br/>table1.drop_duplicates()</span></pre><p id="b0cf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">d.从特定列中选择所有唯一记录</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="734f" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>select distinct col1, col2, col3 from table1 <br/><strong class="nk iu"># python</strong><br/>table1.drop_duplicates(subset = [col1, col2, col3])</span></pre></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="ca3b" class="nu np it bd nv nw oq ny nz oa or oc od jz os ka of kc ot kd oh kf ou kg oj ok bi translated"><strong class="ak"> 2。</strong>在哪里</h1><p id="0a59" class="pw-post-body-paragraph ky kz it la b lb ol ju ld le om jx lg lh on lj lk ll oo ln lo lp op lr ls lt im bi translated">a.其中列等于 x</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="f9ba" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>select * from table1 where col1 = 5<br/><strong class="nk iu"># python</strong><br/>table.loc[table['column_name'] == <!-- -->5<!-- -->]</span></pre><p id="3d15" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">b.其中列不等于 x</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="623d" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>select * from table1 where col1 &lt;&gt; 5<br/><strong class="nk iu"># python</strong><br/>table.loc[table['column_name'] != 5]</span></pre><p id="7da2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">c.其中列大于 x</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="8526" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>select * from table1 where col1 &gt; 5<br/><strong class="nk iu"># python</strong><br/>table1[col1 &gt; 5]</span></pre><p id="1537" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">d.其中列包含“字符串”</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="540a" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>select * from table1 where col1 like '%string%'<br/><strong class="nk iu"># python</strong><br/>table.loc[(table['col1'].str.contains('string'))]</span></pre><p id="66c3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">e.其中列以“字符串”开头</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="3b99" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>select * from table1 where col1 like 'string%'<br/><strong class="nk iu"># python</strong><br/>table.loc[(table['col1'].str.startswith('string'))]</span></pre><p id="c094" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">f.其中列以“字符串”结尾</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="7dec" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>select * from table1 where col1 like '%string'<br/><strong class="nk iu"># python</strong><br/>table.loc[(table['col1'].str.endsswith('string'))]</span></pre><p id="7719" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">g.其中列不为空</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="58d9" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>select * from table1 where col1 is not null<br/><strong class="nk iu"># python</strong><br/>table[‘col1’].notna()</span></pre><p id="5309" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">h.其中列为空</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="82ba" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>select * from table1 where col1 is not null<br/><strong class="nk iu"># python</strong><br/>table[‘col1’].isna()</span></pre><p id="92da" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">I .当列满足多个标准时</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="ef67" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>select * from table1 where col1 &gt; 50 or (col2 &gt; 50 and col1 is null)<br/><strong class="nk iu"># python</strong><br/>table.loc[(table['col1'] &gt; 50) | ((table['col2'] &gt; 50) &amp; table['col1'].isna())]</span></pre></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="05ca" class="nu np it bd nv nw oq ny nz oa or oc od jz os ka of kc ot kd oh kf ou kg oj ok bi translated">3.“更新”</h1><p id="e405" class="pw-post-body-paragraph ky kz it la b lb ol ju ld le om jx lg lh on lj lk ll oo ln lo lp op lr ls lt im bi translated">a.基于单一条件更新列</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="6ef9" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>update table set col2 = 'Y' where col1 &gt; 10<br/><strong class="nk iu"># python</strong><br/>table.loc[table.col1 &gt; 10, ‘col2’] = ‘Y’</span></pre><p id="c9a2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">b.基于多个条件更新列</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="1be4" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>update table set col3 = 'Y' where col1 &gt; 10 and col2 = 'x'<br/><strong class="nk iu"># python</strong><br/>table.loc[(table.col1 &gt; 10) &amp; (table.col2 == ‘x’), ‘col3’] = ‘Y’</span></pre><p id="499b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">c.将为空的列更新为零</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="944a" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>update table set col1 = 0 where col1 is null<br/><strong class="nk iu"># python</strong><br/>table.loc[table[‘col1’].isnull(), ‘col1’] = 0</span></pre><p id="24cc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">d.将列值更新为另一列的倍数</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="c698" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>update table set col2 = col1*100 where col1 &gt; 10<br/><strong class="nk iu"># python</strong><br/>table.loc[table.col1 &gt; 10, ‘col2’] = table.col*100</span></pre></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="bc42" class="nu np it bd nv nw oq ny nz oa or oc od jz os ka of kc ot kd oh kf ou kg oj ok bi translated"><strong class="ak"> 4。</strong>的‘联接’</h1><p id="3b0f" class="pw-post-body-paragraph ky kz it la b lb ol ju ld le om jx lg lh on lj lk ll oo ln lo lp op lr ls lt im bi translated">a.基于单个 id 匹配左连接两个表</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="bbfd" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>select * from table1 a left join table2 b <br/>on a.name = b.name</span><span id="9129" class="no np it nk b gy ov nr l ns nt"><strong class="nk iu"># python</strong><br/>table = pd.merge(table1, table2, left_on = ['name'], right_on = ['name'], how = 'left')</span></pre><p id="6789" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">b.基于多个 id 匹配右连接两个表</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="d59f" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>select * from table1 a right join table2 b <br/>on a.name = b.name and a.id = b.id</span><span id="0c9a" class="no np it nk b gy ov nr l ns nt"><strong class="nk iu"># python</strong><br/>table = pd.merge(table1, table2, left_on = ['name', 'id' ], right_on = ['name', 'id'], how = 'right')</span></pre><p id="da94" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">c.基于多重 id 匹配的三个表的内部连接</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="6148" class="no np it nk b gy nq nr l ns nt">select * from table1 a inner join table2 b <br/>on a.name = b.name<br/>inner join table3 c <br/>on a.name = c.name</span><span id="01e2" class="no np it nk b gy ov nr l ns nt"><strong class="nk iu"># python</strong><br/>table = pd.merge(table1, table2, left_on = ['name'], right_on = ['name'], how = 'inner')</span><span id="3eba" class="no np it nk b gy ov nr l ns nt">table = pd.merge(table, table3, left_on = ['name'], right_on = ['name'], how = 'inner')</span></pre></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="f9a7" class="nu np it bd nv nw oq ny nz oa or oc od jz os ka of kc ot kd oh kf ou kg oj ok bi translated">5.“排序”</h1><p id="46d7" class="pw-post-body-paragraph ky kz it la b lb ol ju ld le om jx lg lh on lj lk ll oo ln lo lp op lr ls lt im bi translated">a.基于一列按升序对表格进行排序</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="58a0" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>select * from table sort by id asc</span><span id="187d" class="no np it nk b gy ov nr l ns nt"><strong class="nk iu"># python</strong><br/>table.sort_values(by=[‘id’], inplace=True, ascending = True)</span></pre><p id="166b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">b.基于多列按降序对表格进行排序</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="0c27" class="no np it nk b gy nq nr l ns nt"><strong class="nk iu">-- SQL</strong><br/>select * from table sort by id, name</span><span id="0c5d" class="no np it nk b gy ov nr l ns nt"><strong class="nk iu"># python</strong><br/>table.sort_values(by=[‘id’, ‘name’], inplace=True, ascending = False)</span></pre></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="6ffd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些是一些简单的例子，并不能涵盖所有的用例。为此，请参考<a class="ae nd" href="https://pandas.pydata.org/docs/" rel="noopener ugc nofollow" target="_blank"> pandas 文档</a>，它有助于解释输入参数的大量选项，并提供了一些有用的示例。我还推荐去看看<a class="ae nd" href="https://www.w3schools.com/sql/default.asp" rel="noopener ugc nofollow" target="_blank"> W3 学校</a>，那里教会了我几乎所有关于 SQL 的知识。</p><p id="cec7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请留意第二部分(以及第三、第四和第五部分……)。</p></div></div>    
</body>
</html>