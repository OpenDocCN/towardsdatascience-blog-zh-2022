<html>
<head>
<title>How to Write Your Own GitHub Action</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何编写自己的GitHub动作</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-write-your-own-github-action-59cc4746a57a#2022-10-31">https://towardsdatascience.com/how-to-write-your-own-github-action-59cc4746a57a#2022-10-31</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="ff48" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">使用GitHub工作流完善您的CI/CD工具箱</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/24a2a2ebf819d764177fa7afd95904af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EShCSekB7wvrxmKl6azr4Q.jpeg"/></div></div><p class="ks kt gk gi gj ku kv bd b be z dk translated">照片由pix abay:<a class="ae kw" href="https://www.pexels.com/photo/aroma-aromatic-assortment-bottles-531446/" rel="noopener ugc nofollow" target="_blank">https://www . pexels . com/photo/aroma-aromatic-distriction-bottles-531446/</a></p></figure><h1 id="406d" class="kx ky ir bd kz la lb lc ld le lf lg lh jx li jy lj ka lk kb ll kd lm ke ln lo bi translated">GitHub简要介绍时间表</h1><p id="77d9" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">自从微软接手以来，GitHub已经发生了很大的变化，在大公司的集团性质中，或者说尽管如此。在GitHub中，CI/CD管道得到了极大的改进。<a class="ae kw" href="https://github.com/actions" rel="noopener ugc nofollow" target="_blank"> GitHub提供了许多好的工作流程</a>和<a class="ae kw" href="https://github.com/marketplace?category=&amp;query=&amp;type=actions" rel="noopener ugc nofollow" target="_blank">其他由开源社区</a>在最近几年开发的工作流程，随着技术的发展，还会有更多的工作流程出现。</p><p id="8f55" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">这为许多机会打开了大门，因为许多公司已经将他们的源代码保存在GitHub中，GitHub是市场上的第一批玩家之一[<a class="ae kw" href="https://en.wikipedia.org/wiki/GitHub" rel="noopener ugc nofollow" target="_blank">source</a>]！</p><p id="4469" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">虽然这听起来很可怕，但让一家公司比其他公司更强大也可以带来许多可能性和创新，因为社区的牵引力将推动创造越来越多的价值，最终将使每个人受益。</p><h1 id="8a7a" class="kx ky ir bd kz la lb lc ld le lf lg lh jx li jy lj ka lk kb ll kd lm ke ln lo bi translated">什么是GitHub动作？</h1><p id="eca8" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">尽管对许多工程师来说这很琐碎，但对初学者来说，定义这个术语是至关重要的。GitHub Action是您在GitHub中拥有一个或多个存储库的帐户后获得的CI/CD管道，每个存储库都有其管道工作流。</p><p id="ff40" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">它使您能够定义您希望在一组指定的<a class="ae kw" href="https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows" rel="noopener ugc nofollow" target="_blank">触发器</a>上发生的所有步骤。以下是这种“行动”的一些例子:</p><ul class=""><li id="da78" class="mq mr ir lr b ls ml lv mm ly ms mc mt mg mu mk mv mw mx my bi translated">当一个拉请求进来时，在你的存储库上运行测试。</li><li id="5e53" class="mq mr ir lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated">在每次推送时，在您的项目上运行特定于语言的linters。</li><li id="52ac" class="mq mr ir lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated">发布新版本时部署到开发/生产。</li></ul><p id="6a56" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">这些只是GitHub Action的几个例子，根据项目的需求，您还可以想到更多的例子。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj ne"><img src="../Images/198b752e22dd4dff4c3705d97d284f13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IR7k0Jp7YyTmf6hd57X7BA.jpeg"/></div></div><p class="ks kt gk gi gj ku kv bd b be z dk translated">照片由nappy:<a class="ae kw" href="https://www.pexels.com/photo/man-wearing-white-sweater-and-black-shorts-about-to-run-936094/" rel="noopener ugc nofollow" target="_blank">https://www . pexels . com/photo/man-weaking-white-sweet-and-black-shorts-about-to-run-936094/</a></p></figure><h1 id="c50d" class="kx ky ir bd kz la lb lc ld le lf lg lh jx li jy lj ka lk kb ll kd lm ke ln lo bi translated">为什么要编写定制的GitHub动作？</h1><p id="fd6a" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">我们生活在21世纪，几乎每个软件问题都已经解决了；您只需要足够努力地寻找问题领域，将材料结合在一起，并最终以符合您需求的方式配置整个平台。</p><p id="02c5" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">对于GitHub动作来说都是一样的，因为已经有许多工作流定义可以放入项目的CI/CD定义中，传入正确的值并得到您期望的结果。</p><p id="6e55" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">这将我们带到一个点，你可能不需要从头开始重写东西。</p><p id="60f7" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">但即使如此，也可能有这样的情况:</p><ul class=""><li id="bca2" class="mq mr ir lr b ls ml lv mm ly ms mc mt mg mu mk mv mw mx my bi translated">可用的解决方案不适合你的问题</li><li id="e897" class="mq mr ir lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated">问题的复杂性和可用的解决方案不一致</li><li id="f9c5" class="mq mr ir lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated">该解决方案在配置方面不够灵活</li></ul><p id="a80d" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">所有这些以及更多的理由都足以让你编写自己的定制GitHub动作，这也是本文的主旨。</p><p id="09d3" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">我们将深入研究编写自定义GitHub动作的不同方法，并提供每种方法的实际例子。</p><h1 id="1354" class="kx ky ir bd kz la lb lc ld le lf lg lh jx li jy lj ka lk kb ll kd lm ke ln lo bi translated">如何编写自定义GitHub动作？</h1><p id="a750" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">撰写本文时，有三种方法可以编写GitHub Action。下面的方法可以用来创建和发布GitHub动作，可以是开源的，对社区公开，也可以是你自己的。</p><p id="da5a" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">可用的GitHub操作类型有:</p><ol class=""><li id="3029" class="mq mr ir lr b ls ml lv mm ly ms mc mt mg mu mk nf mw mx my bi translated">JavaScript:如果你是1750万JS开发者中的一员，或者如果你是7万Stackoverflow调查对象中的65%中的一员，你很可能会喜欢这种方法，因为你可以用你喜欢的语言编写你的逻辑。</li><li id="1f11" class="mq mr ir lr b ls mz lv na ly nb mc nc mg nd mk nf mw mx my bi translated">Docker:如果你和我一样不是JavaScript开发人员，你会发现这个非常有趣，因为任何可以被容器化的东西都可以作为GitHub Action发布；如今，由于许多伟大工程师的努力，这意味着任何应用。</li><li id="3615" class="mq mr ir lr b ls mz lv na ly nb mc nc mg nd mk nf mw mx my bi translated">复合:最后但并非最不重要的，我非常喜欢的一个，允许你将多个GitHub动作合并成一个，也是作为“可重用工作流”出售给公众的<a class="ae kw" href="https://github.blog/changelog/2021-08-25-github-actions-reduce-duplication-with-action-composition/" rel="noopener ugc nofollow" target="_blank"/>。</li></ol><p id="59cb" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">由于我不是JavaScript开发人员，不仅仅是能够阅读并在一定程度上理解它的功能，我不会把更多的注意力放在那里，而是放大我感觉最强的地方:Docker &amp; Composite。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj ng"><img src="../Images/e6349a4db35b407c63077fda862f3f86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-3_AHxuBblJ6w9VRsZuoOg.jpeg"/></div></div><p class="ks kt gk gi gj ku kv bd b be z dk translated">Victoria Akvarel的照片:<a class="ae kw" href="https://www.pexels.com/photo/two-boys-playing-soccer-ball-beside-cars-1564868/" rel="noopener ugc nofollow" target="_blank">https://www . pexels . com/photo/two-boys-playing-soccer-ball-side-cars-1564868/</a></p></figure><h1 id="3ff8" class="kx ky ir bd kz la lb lc ld le lf lg lh jx li jy lj ka lk kb ll kd lm ke ln lo bi translated">GitHub动作通用定义</h1><p id="ac80" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">选择任何一种编写GitHub动作的方法，你都需要一个关键的文件作为GitHub动作的<strong class="lr is">定义</strong>。</p><p id="f683" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">该文件的名称必须精确到<code class="fe nh ni nj nk b">action.yml</code>，并且它应该位于您的项目的根目录下。除了许多其他事情之外，下面是您在该定义文件中指定的内容:</p><ul class=""><li id="38a9" class="mq mr ir lr b ls ml lv mm ly ms mc mt mg mu mk mv mw mx my bi translated">输入是什么</li><li id="cac2" class="mq mr ir lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated">如何调用操作，即执行什么文件或二进制文件</li><li id="7517" class="mq mr ir lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated">人们可以期望得到什么样的输出</li></ul><p id="5c81" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">像许多其他伟大的定义文件一样，这个定义是YAML格式的，是最有争议的格式之一。这里有一个取自GitHub文档的样本<code class="fe nh ni nj nk b">action.yml</code>。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nl nm l"/></div></figure><p id="4494" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">该文件有三个主要部分:所有其他选项都是可选的。</p><ul class=""><li id="1c03" class="mq mr ir lr b ls ml lv mm ly ms mc mt mg mu mk mv mw mx my bi translated"><code class="fe nh ni nj nk b">name</code>:这是分配给动作的唯一名称。这个名字作为ID，要求是唯一的，因为会给它一个URL <code class="fe nh ni nj nk b">github.com/marketplace/actions/MY_GITHUB_ACTION</code>，不能重复；这只适用于打算发布到GitHub Marketplace的公共操作，否则不需要是唯一的。</li><li id="49aa" class="mq mr ir lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated"><code class="fe nh ni nj nk b">inputs</code>:动作将接收的一组名称作为其参数。想想<code class="fe nh ni nj nk b">kubectl get pod --output=yaml</code>，在这种情况下,“输出”是<code class="fe nh ni nj nk b">kubectl</code>二进制的一个参数。</li><li id="dfd7" class="mq mr ir lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated">任何动作的基本部分是你定义动作的“类型”，上面描述的三种类型之一。该“类型”在键<code class="fe nh ni nj nk b">using</code>下指定，并告诉“跑步者”如何跑你的动作。使用<code class="fe nh ni nj nk b">docker</code>时，需要用属性<code class="fe nh ni nj nk b">image</code>指定docker文件的路径。<code class="fe nh ni nj nk b">args</code>是不言自明的，因为它将把<code class="fe nh ni nj nk b">inputs</code>传递给底层实现。</li></ul><p id="772e" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">这个定义，当正确指定时，将告诉<a class="ae kw" href="https://github.com/actions/runner" rel="noopener ugc nofollow" target="_blank"> GitHub Runner </a>如何运行您的动作。它充当入口点；没有它，存储库中定义的逻辑将不会被执行，因为运行者不知道如何执行。</p><p id="d920" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">现在我们已经定义了GitHub动作的轮廓，让我们通过一些实际的例子来完成这个论证。</p></div><div class="ab cl nn no hv np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ik il im in io"><h1 id="a420" class="kx ky ir bd kz la nu lc ld le nv lg lh jx nw jy lj ka nx kb ll kd ny ke ln lo bi translated">第1幕:使用Docker编写您的第一个GitHub动作</h1><p id="c283" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">容器化的应用程序在最近几年获得了很大的发展，这是有原因的。它们允许你用你选择的编程语言编写你的应用程序，把它放在自己的“胶囊”里，并把它运送到任何地方，<a class="ae kw" href="https://docs.docker.com/build/building/multi-platform/" rel="noopener ugc nofollow" target="_blank">至少<em class="nz">几乎</em> </a>。</p><p id="b78c" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">即使有特定于平台的映像构建的限制，您仍然能够创建内容并提供给更广泛的受众；与裸机是唯一选择的时代相比，例如，需要保持安装在所有机器上的JVM版本的同步！</p><p id="8939" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">现在让我们进入实际的代码，在这里我们将开发一个实际的GitHub动作。</p><h2 id="b39d" class="oa ky ir bd kz ob oc dn ld od oe dp lh ly of og lj mc oh oi ll mg oj ok ln ol bi translated">要求:在每次GitHub发布时发送电子邮件通知</h2><p id="5bfa" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">随着介绍、历史和定义的结束，是时候写一些代码了。在这段代码中，我们将向每一次<a class="ae kw" href="https://docs.github.com/en/repositories/releasing-projects-on-github/managing-releases-in-a-repository" rel="noopener ugc nofollow" target="_blank"> GitHub发布</a>的人员列表发送一封电子邮件。</p><p id="c5ec" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">实现逻辑是语言不可知的，但实现不是。这里我们将编写一个Python应用程序，使用<a class="ae kw" href="https://pypi.org/project/sendgrid/" rel="noopener ugc nofollow" target="_blank"> SendGrid的SDK </a>来完成这项工作。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nl nm l"/></div></figure><p id="9429" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">如您所见，代码并不复杂；它将接收所需的输入，准备电子邮件，并相应地发送它。几个调试行帮助用户理解我们所处的阶段，一个异常处理除了在<a class="ae kw" href="https://linux.die.net/man/3/stderr" rel="noopener ugc nofollow" target="_blank">标准错误</a>上打印出来之外什么也不做。</p><p id="a091" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">使用<a class="ae kw" href="https://pypi.org/project/Markdown/" rel="noopener ugc nofollow" target="_blank"> Markdown库</a>是因为我们将获取发布说明并以Markdown格式将其传递给GitHub动作。</p><h2 id="fffd" class="oa ky ir bd kz ob oc dn ld od oe dp lh ly of og lj mc oh oi ll mg oj ok ln ol bi translated">容器化应用程序</h2><p id="6962" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">编写一个<code class="fe nh ni nj nk b">Dockerfile</code>是让我们能够在一个隔离的环境中，随时随地，在任何操作系统上运行应用程序的关键。</p><p id="b722" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">如果你对如何写一个合适的docker文件的提示和技巧感兴趣，看看下面的链接。</p><div class="om on gq gs oo op"><a href="https://medium.com/skilluped/10-tips-on-writing-a-proper-dockerfile-13956ceb435f" rel="noopener follow" target="_blank"><div class="oq ab fp"><div class="or ab os cl cj ot"><h2 class="bd is gz z fq ou fs ft ov fv fx iq bi translated">写一份合适的文档的10个技巧</h2><div class="ow l"><h3 class="bd b gz z fq ou fs ft ov fv fx dk translated">编写一个合适的docker文件并不太难</h3></div><div class="ox l"><p class="bd b dl z fq ou fs ft ov fv fx dk translated">medium.com</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd kq op"/></div></div></a></div><p id="508a" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">如上所述，应用程序的定义可能如下所示:</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nl nm l"/></div></figure><p id="5c55" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">当然，<code class="fe nh ni nj nk b">send-email-with-sendgrid.py</code>必须用正确的<a class="ae kw" href="https://en.wikipedia.org/wiki/Shebang_(Unix)" rel="noopener ugc nofollow" target="_blank">命令</a>来执行。要使它可执行，您将运行<code class="fe nh ni nj nk b">chmod +x FILENAME</code>。</p><h2 id="63b2" class="oa ky ir bd kz ob oc dn ld od oe dp lh ly of og lj mc oh oi ll mg oj ok ln ol bi translated">定义GitHub动作</h2><p id="4f88" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">到目前为止，我们只编写了我们的逻辑，但是如果没有一个很好的和适当的定义<code class="fe nh ni nj nk b">action.yml</code>，它就不能用于GitHub动作，这就是下一步要做的事情。</p><p id="a42b" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">我们将需要一个YAML格式的文件，它将定义动作的名称，输入，以及如何运行它，即如何传递参数。</p><p id="d44d" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">这是这样一个文件的样子。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nl nm l"/></div></figure><p id="15dc" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">在<code class="fe nh ni nj nk b">action.yml</code>中定义的<code class="fe nh ni nj nk b">args</code>是作为 <code class="fe nh ni nj nk b"><a class="ae kw" href="https://stackoverflow.com/a/21564990" rel="noopener ugc nofollow" target="_blank">cmd</a></code> <a class="ae kw" href="https://stackoverflow.com/a/21564990" rel="noopener ugc nofollow" target="_blank">传递给docker容器</a>的<a class="ae kw" href="https://stackoverflow.com/a/21564990" rel="noopener ugc nofollow" target="_blank">。这些参数与上面Python应用程序中用<code class="fe nh ni nj nk b">argparse</code>定义的参数相同。</a></p><h2 id="5727" class="oa ky ir bd kz ob oc dn ld od oe dp lh ly of og lj mc oh oi ll mg oj ok ln ol bi translated">发布到GitHub市场</h2><p id="7f4e" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">我们已经编写了将应用程序作为GitHub动作运行所需的所有逻辑实现代码。然而，作为最后一步，如果我们想在<a class="ae kw" href="https://github.com/marketplace" rel="noopener ugc nofollow" target="_blank">market place</a>中发布我们的应用并使其可被搜索，我们将需要创建一个新版本，这可能是最容易的一步。</p><p id="dfcd" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">作为演示，下面提供了截图。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj pe"><img src="../Images/c71a9b3d24843836b8343141f99a8646.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OyM9fQdDUc5_-10CxH1F6w.png"/></div></div></figure><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj pe"><img src="../Images/9ed6d64208acc0247323070f3b4a5440.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qmZHeUhNcnUoLSVIBGbdgQ.png"/></div></div></figure><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj pf"><img src="../Images/00eb18e1ee9007e4da5070f32729b3f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-K1wHU092Y0UOxIvgxoOdQ.png"/></div></div></figure><p id="1261" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">最后一个复选框非常重要，因为它表示您希望在市场上发布您的GitHub操作，有效地允许其他人使用它。最终，你会在市场上看到你的GitHub行为，类似于下图。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj pg"><img src="../Images/1a4639202666ed7d1164f4664303ae85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iDic_U_VfGMLIjdxbVttQA.png"/></div></div></figure><p id="6f23" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">GitHub发布后，您和其他人将能够使用GitHub操作，使用下面的YAML格式的工作流，该工作流位于存储库的<code class="fe nh ni nj nk b">.github/workflows/</code>目录下。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nl nm l"/></div></figure><p id="01df" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">这是最简单不过的了。当然，你可以变得更有创意，做更多新奇的东西！</p><h2 id="6054" class="oa ky ir bd kz ob oc dn ld od oe dp lh ly of og lj mc oh oi ll mg oj ok ln ol bi translated">源代码</h2><p id="2093" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">所有文件都可以通过下面的链接获得。</p><div class="om on gq gs oo op"><a href="https://github.com/licenseware/send-email-notification/" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab fp"><div class="or ab os cl cj ot"><h2 class="bd is gz z fq ou fs ft ov fv fx iq bi translated">GitHub-licenseware/send-email-notification:GitHub动作将使用…</h2><div class="ow l"><h3 class="bd b gz z fq ou fs ft ov fv fx dk translated">将使用SendGrid电子邮件API发送电子邮件通知的Github操作…</h3></div><div class="ox l"><p class="bd b dl z fq ou fs ft ov fv fx dk translated">github.com</p></div></div><div class="oy l"><div class="ph l pa pb pc oy pd kq op"/></div></div></a></div><h1 id="92d7" class="kx ky ir bd kz la lb lc ld le lf lg lh jx li jy lj ka lk kb ll kd lm ke ln lo bi translated">第2幕:使用Shell编写第二个GitHub动作</h1><p id="2f9c" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">理解GitHub Runners在每次被触发时都包含在一个新的虚拟机中是至关重要的&amp;它们将在完成时被处理掉[ <a class="ae kw" href="https://docs.github.com/en/enterprise-server@3.4/actions/using-github-hosted-runners/about-github-hosted-runners" rel="noopener ugc nofollow" target="_blank"> source </a> ]。这意味着您在之前的运行中所做的工作将不可用，除非您保存了结果，例如<a class="ae kw" href="https://github.com/marketplace/actions/upload-a-build-artifact" rel="noopener ugc nofollow" target="_blank"> GitHub工件</a>或<a class="ae kw" href="https://github.com/marketplace/actions/cache" rel="noopener ugc nofollow" target="_blank"> GitHub缓存</a>。</p><p id="5264" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">也就是说，您可以组合工作流文件的多个阶段，并将其发布为单个GitHub操作，允许您作为一个统一的整体“重用”它，因此得名“<a class="ae kw" href="https://docs.github.com/en/actions/using-workflows/reusing-workflows" rel="noopener ugc nofollow" target="_blank">可重用工作流</a>”</p><p id="82c3" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">这种类型的GitHub动作被称为“复合”顾名思义，它由其他步骤组成。对于多个存储库需要不同的CI/CD步骤的场景，这是非常理想的。您不希望到处重复相同的步骤，而是希望维护一个存储库并相应地更新。</p><h2 id="fe44" class="oa ky ir bd kz ob oc dn ld od oe dp lh ly of og lj mc oh oi ll mg oj ok ln ol bi translated">需求:将Helm版本部署到Kubernetes集群</h2><p id="9276" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">我们希望在每次对默认分支进行新的推送时，将带有一组可配置标志的Helm Chart部署到特定的Kubernetes集群。这需要以下步骤:</p><ol class=""><li id="2765" class="mq mr ir lr b ls ml lv mm ly ms mc mt mg mu mk nf mw mx my bi translated">安装一个特定的头盔版本，最好是可配置的。</li><li id="8851" class="mq mr ir lr b ls mz lv na ly nb mc nc mg nd mk nf mw mx my bi translated">获取Kubeconfig和Helm值文件，作为YAML编码的字符串或作为底层操作系统中的文件路径，例如，从AWS S3获取。</li><li id="00a1" class="mq mr ir lr b ls mz lv na ly nb mc nc mg nd mk nf mw mx my bi translated">根据用户请求更改Kubeconfig &amp; Helm值文件的文件权限。</li><li id="4186" class="mq mr ir lr b ls mz lv na ly nb mc nc mg nd mk nf mw mx my bi translated">使用可配置的发布名称部署实际图表。</li><li id="1097" class="mq mr ir lr b ls mz lv na ly nb mc nc mg nd mk nf mw mx my bi translated">出于安全原因，清理用户请求，即删除Kubeconfig和Helm值文件！</li></ol><p id="be95" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">下面是GitHub动作定义文件中这样一个需求的样子:</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nl nm l"/></div></figure><p id="1779" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">注意<code class="fe nh ni nj nk b">.runs.using</code>下的值是<code class="fe nh ni nj nk b">composite</code>，这意味着我们将在同一个<code class="fe nh ni nj nk b">action.yml</code>文件中定义可运行的步骤。</p><p id="2db8" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">这些“步骤”与您放在<code class="fe nh ni nj nk b">.github/workflows/</code>下的任何文件中的步骤是一样的，唯一的区别是<code class="fe nh ni nj nk b">shell</code>属性，它是每个步骤的必需键。它告诉跑步者命令应该如何运行。此处记录了可用外壳的列表<a class="ae kw" href="https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstepsshell" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="985c" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">该文件的语法是不言自明的，也是人类可读的。您在每个步骤的<code class="fe nh ni nj nk b">run</code>属性下看到的一切都是一组bash可执行的命令。</p><p id="b3f9" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">您还可以将任何Python或JavaScript文件放在同一个存储库中，并从同一个<code class="fe nh ni nj nk b">action.yml</code>文件中调用该文件，使您的GitHub操作更加强大和灵活。</p><h2 id="de21" class="oa ky ir bd kz ob oc dn ld od oe dp lh ly of og lj mc oh oi ll mg oj ok ln ol bi translated">这个怎么用？</h2><p id="4e0a" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">使用上面的GitHub动作，您将有效地拥有一个类似于下面的工作流定义。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nl nm l"/></div></figure><h2 id="54b7" class="oa ky ir bd kz ob oc dn ld od oe dp lh ly of og lj mc oh oi ll mg oj ok ln ol bi translated">源代码</h2><p id="c951" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">所有文件都可以通过下面的链接获得。</p><div class="om on gq gs oo op"><a href="https://github.com/licenseware/helm" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab fp"><div class="or ab os cl cj ot"><h2 class="bd is gz z fq ou fs ft ov fv fx iq bi translated">GitHub - licenseware/helm:在GitHub动作中部署头盔图表</h2><div class="ow l"><h3 class="bd b gz z fq ou fs ft ov fv fx dk translated">在GitHub行动中部署头盔图。在GitHub上创建一个帐户，为licenseware/helm开发做贡献。</h3></div><div class="ox l"><p class="bd b dl z fq ou fs ft ov fv fx dk translated">github.com</p></div></div><div class="oy l"><div class="pi l pa pb pc oy pd kq op"/></div></div></a></div></div><div class="ab cl nn no hv np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ik il im in io"><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj pj"><img src="../Images/1e0bc440a9a28c018d70261c48598c1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wc8gJ9RjyoTFwSOCWI52nA.jpeg"/></div></div><p class="ks kt gk gi gj ku kv bd b be z dk translated">照片由Nout Gons拍摄:<a class="ae kw" href="https://www.pexels.com/photo/road-in-city-during-sunset-248159/" rel="noopener ugc nofollow" target="_blank">https://www . pexels . com/photo/road-in-city-during-sunset-248159/</a></p></figure><h1 id="2e19" class="kx ky ir bd kz la lb lc ld le lf lg lh jx li jy lj ka lk kb ll kd lm ke ln lo bi translated">结论</h1><p id="2fc3" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">CI/CD使我们的运营变得更加轻松，使我们能够灵活地进行开发，并消除了手动和可重复部署的负担。在21世纪，随着许多旨在自动化可重复工作的工具和技术的兴起，CI/CD已经成为最成功的工具之一，是当今每个公司不可或缺的一部分，使它们不再是一种奢侈品，而是将可维护性保持在最大水平的要求。</p><p id="c06f" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">GitHub Actions，最著名的CI/CD工具箱之一，提供了很多功能。为了与当前的CI/CD解决方案竞争，GitHub Actions在提供可扩展性方面取得了长足的进步，这样人们就可以为特定的需求创建和发布他们的解决方案。您将能够找到许多现成的工作流程，为您的生产之战做好准备。</p><p id="1f09" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">在本文中，我们给出了实际的例子，说明当您找不到现成的动作时，如何编写一个实际的定制GitHub动作。有了这些知识，你将会不可阻挡地为自己、公司和社区创造价值。</p><p id="438e" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">祝你今天休息愉快。<a class="ae kw" href="https://meysam.io" rel="noopener ugc nofollow" target="_blank">敬请期待</a>，保重！</p></div><div class="ab cl nn no hv np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ik il im in io"><h1 id="e271" class="kx ky ir bd kz la nu lc ld le nv lg lh jx nw jy lj ka nx kb ll kd ny ke ln lo bi translated">参考</h1><ul class=""><li id="1135" class="mq mr ir lr b ls lt lv lw ly pk mc pl mg pm mk mv mw mx my bi translated">【https://docs.github.com/ T4】</li></ul></div><div class="ab cl nn no hv np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ik il im in io"><p id="2d06" class="pw-post-body-paragraph lp lq ir lr b ls ml js lu lv mm jv lx ly mn ma mb mc mo me mf mg mp mi mj mk ik bi translated">如果你喜欢这篇文章，看看我的其他内容，你可能也会觉得有帮助。</p><div class="om on gq gs oo op"><a href="https://medium.com/skilluped/what-is-iptables-and-how-to-use-it-781818422e52" rel="noopener follow" target="_blank"><div class="oq ab fp"><div class="or ab os cl cj ot"><h2 class="bd is gz z fq ou fs ft ov fv fx iq bi translated">什么是iptables，如何使用？</h2><div class="ow l"><h3 class="bd b gz z fq ou fs ft ov fv fx dk translated">管理系统端口的防火墙界面</h3></div><div class="ox l"><p class="bd b dl z fq ou fs ft ov fv fx dk translated">medium.com</p></div></div><div class="oy l"><div class="pn l pa pb pc oy pd kq op"/></div></div></a></div><div class="om on gq gs oo op"><a href="https://medium.com/amerandish/clean-architecture-simplified-223f45e1a10" rel="noopener follow" target="_blank"><div class="oq ab fp"><div class="or ab os cl cj ot"><h2 class="bd is gz z fq ou fs ft ov fv fx iq bi translated">简化的简洁架构</h2><div class="ow l"><h3 class="bd b gz z fq ou fs ft ov fv fx dk translated">以友好的方式解释清洁建筑是如何工作的</h3></div><div class="ox l"><p class="bd b dl z fq ou fs ft ov fv fx dk translated">medium.com</p></div></div><div class="oy l"><div class="po l pa pb pc oy pd kq op"/></div></div></a></div><div class="om on gq gs oo op"><a rel="noopener follow" target="_blank" href="/how-to-set-up-ingress-controller-in-aws-eks-d745d9107307"><div class="oq ab fp"><div class="or ab os cl cj ot"><h2 class="bd is gz z fq ou fs ft ov fv fx iq bi translated">如何在自动气象站EKS设置入口控制器</h2><div class="ow l"><h3 class="bd b gz z fq ou fs ft ov fv fx dk translated">以正确的方式在AWS EKS上部署入口控制器</h3></div><div class="ox l"><p class="bd b dl z fq ou fs ft ov fv fx dk translated">towardsdatascience.com</p></div></div><div class="oy l"><div class="pp l pa pb pc oy pd kq op"/></div></div></a></div><div class="om on gq gs oo op"><a href="https://medium.com/amerandish/a-tmux-a-beginners-guide-7c129733148" rel="noopener follow" target="_blank"><div class="oq ab fp"><div class="or ab os cl cj ot"><h2 class="bd is gz z fq ou fs ft ov fv fx iq bi translated">Tmux:初学者指南</h2><div class="ow l"><h3 class="bd b gz z fq ou fs ft ov fv fx dk translated">将您的单个终端变成多个终端。</h3></div><div class="ox l"><p class="bd b dl z fq ou fs ft ov fv fx dk translated">medium.com</p></div></div><div class="oy l"><div class="pq l pa pb pc oy pd kq op"/></div></div></a></div><div class="om on gq gs oo op"><a href="https://medium.com/geekculture/patch-your-dependencies-like-a-boss-de757367010f" rel="noopener follow" target="_blank"><div class="oq ab fp"><div class="or ab os cl cj ot"><h2 class="bd is gz z fq ou fs ft ov fv fx iq bi translated">像老板一样修补你的依赖</h2><div class="ow l"><h3 class="bd b gz z fq ou fs ft ov fv fx dk translated">我保证，单元测试从来没有这么简单过🤞</h3></div><div class="ox l"><p class="bd b dl z fq ou fs ft ov fv fx dk translated">medium.com</p></div></div><div class="oy l"><div class="pr l pa pb pc oy pd kq op"/></div></div></a></div><div class="om on gq gs oo op"><a href="https://medium.com/skilluped/stop-writing-mediocre-docker-compose-files-26b7b4c9bd14" rel="noopener follow" target="_blank"><div class="oq ab fp"><div class="or ab os cl cj ot"><h2 class="bd is gz z fq ou fs ft ov fv fx iq bi translated">停止编写平庸的Docker-Compose文件</h2><div class="ow l"><h3 class="bd b gz z fq ou fs ft ov fv fx dk translated">带有可操作提示的备忘单</h3></div><div class="ox l"><p class="bd b dl z fq ou fs ft ov fv fx dk translated">medium.com</p></div></div><div class="oy l"><div class="ps l pa pb pc oy pd kq op"/></div></div></a></div></div></div>    
</body>
</html>