<html>
<head>
<title>7 Functions You Can Use to Create New Columns in a Pandas DataFrame</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">您可以使用7个函数在Pandas数据框架中创建新列</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/7-functions-you-can-use-to-create-new-columns-in-a-pandas-dataframe-a6b480cf8b30#2022-10-19">https://towardsdatascience.com/7-functions-you-can-use-to-create-new-columns-in-a-pandas-dataframe-a6b480cf8b30#2022-10-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c210" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">数据分析、数据清理和特征工程中的典型任务</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9541600ab6a33ec13043334411203167.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HUr0Gzk76IImDsRuUIo6Mg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">莱尔·哈斯蒂在<a class="ae ky" href="https://unsplash.com/s/photos/seven?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="044b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas DataFrame是一个二维数据结构，带有标记的行和列。一行代表一个观察值(即一个数据点)，列是描述观察值的特征。</p><p id="505d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有时需要创建一个新列来添加一条关于数据点的信息。这些列可以从现有列派生，也可以从外部数据源派生新列。</p><p id="7a30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将了解7个可用于创建新列的函数。</p><p id="fec6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从创建一个样本数据帧开始。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2165" class="ma mb it lw b gy mc md l me mf">import numpy as np<br/>import pandas as pd</span><span id="76bd" class="ma mb it lw b gy mg md l me mf">df = pd.DataFrame({</span><span id="c486" class="ma mb it lw b gy mg md l me mf">    "division": ["A", "B", "A", "C", "B"],<br/>    "category": ["101-A", "14-C", "1020-D", "112-A", "11-A"],<br/>    "mes1": np.random.randint(10, 40, size=5),<br/>    "mes2": np.random.randint(10, 60, size=5),<br/>    "mes3": np.random.randint(10, 100, size=5)<br/>    <br/>})</span><span id="5a30" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/e4d38b6eac79be20f2c5247c60706bd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JtPhAh1z59A3pM8XKNchIw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="4302" class="mp mb it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">1.熊猫在哪里</h1><p id="345d" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">Pandas的where函数可用于根据其他列中的值创建一个列。</p><p id="f940" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们定义一个条件或一组条件，然后取一列。对于符合条件的行，此列中的值保持不变。其他值将替换为指定的值。</p><p id="a804" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用一个例子更容易理解。假设我们希望根据mes2列上的条件更新mes1列中的值。</p><p id="cb73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果mes2中的值大于50，我们要在mes1中的值上加10。否则，我们希望保持值不变。下面是我们如何使用where函数来执行这个操作。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="41bb" class="ma mb it lw b gy mc md l me mf">df["mes_updated"] = df["mes1"].where(<br/>    <br/>    df["mes2"] &lt;= 50, <br/>    df["mes1"] + 10</span><span id="eaf9" class="ma mb it lw b gy mg md l me mf">)</span><span id="9370" class="ma mb it lw b gy mg md l me mf">df[["mes1", "mes2", "mes_updated"]]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/b69933ca831c25bcd4e70113389a71ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XTxVMRZO_vSsdqbgFvIIMQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="6eb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们在上面的输出中看到的，符合条件(mes2 ≤ 50)的值保持不变。其他值通过加10来更新。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="4f5f" class="mp mb it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">2.哪里的数字</h1><p id="5e37" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">NumPy的where功能比熊猫灵活。我们能够为符合给定条件的行赋值。这对于熊猫的where函数是不可能的，因为符合条件的值保持不变。</p><p id="ca24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们做同样的例子。如果mes2中的值大于50，我们要在mes1中的值上加10。否则，我们要减去10。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="bd88" class="ma mb it lw b gy mc md l me mf">df["mes_updated_2"] = np.where(<br/>    <br/>    df["mes2"] &lt;= 50, <br/>    df["mes1"] - 10,<br/>    df["mes1"] + 10</span><span id="42bd" class="ma mb it lw b gy mg md l me mf">)</span><span id="63d7" class="ma mb it lw b gy mg md l me mf">df[["mes1", "mes2", "mes_updated_2"]]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/4d0e39b68d3b225ae94be1edb20178bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EiA0IxJPSiF0p33JoRXAgw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="76a1" class="mp mb it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">3.数字选择</h1><p id="3806" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">where函数根据一组条件赋值。select函数更进一步。它接受多组条件，并且能够为每组条件分配不同的值。</p><p id="7309" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们基于以下条件创建一个新列:</p><ul class=""><li id="d28d" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">如果除法是A并且mes1大于10，则值为1</li><li id="1deb" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">如果除法是B且mes1大于10，则值为2</li><li id="707e" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">否则，该值为0</li></ul><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="bdb9" class="ma mb it lw b gy mc md l me mf">conditions = [<br/>    <br/>  (df["division"] == "A") &amp; (df["mes1"] &gt; 10),<br/>  (df["division"] == "B") &amp; (df["mes1"] &gt; 10)<br/>    <br/>]</span><span id="7427" class="ma mb it lw b gy mg md l me mf">values = [1, 2]</span><span id="a755" class="ma mb it lw b gy mg md l me mf">df["select_col"] = np.select(conditions, values, default=0)</span><span id="5d75" class="ma mb it lw b gy mg md l me mf">df[["division", "mes1", "select_col"]]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/d1cb35bc766c43d9208fc2188a8d1a29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FPENVL39LkDM3wpDYiUVfw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="1837" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">条件和相关值写在单独的Python列表中。默认参数指定不符合任何列出条件的行的值。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="97e2" class="mp mb it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated"><strong class="ak"> 4。熊猫分配</strong></h1><p id="ee40" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">Pandas的分配功能可用于在一次操作中创建多个列。我们可以基于现有的列派生列，或者从头开始创建。如果我们采用后者，我们需要确保变量的长度与数据帧中的行数相同。</p><p id="dd86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们来做一个例子。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="be89" class="ma mb it lw b gy mc md l me mf">df = df.assign(<br/>    <br/>    cat1 = df["category"].str.split("-", expand=True)[0],<br/>    mes_all = lambda x: x.mes1 ** 2 + x.mes2 * 10 + x.mes3,<br/>    id = [1, 2, 3, 4, 5]</span><span id="3cf9" class="ma mb it lw b gy mg md l me mf">)</span></pre><p id="2e96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们创建了3个新列:</p><ul class=""><li id="6e17" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">第一个是类别列中字符串的第一部分，通过字符串拆分得到。</li><li id="726b" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">第二个是使用涉及mes1、mes2和mes3列的计算创建的。</li><li id="0dd0" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">第三个只是一个整数列表。</li></ul><p id="8a16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是新列:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/3a886bf3ddd3f1e5fe0138e3382b5c52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9zNIOfpbnuoZh0U2sw6QBQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="1cc7" class="mp mb it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">5.熊猫插页</h1><p id="d859" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">当我们为数据帧创建一个新列时，它被添加到末尾，因此它成为最后一列。insert函数允许根据列索引指定新列的位置。</p><p id="a36d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建一个id列，并将其作为数据帧中的第一列。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="dfc2" class="ma mb it lw b gy mc md l me mf">df.insert(0, "id", [1, 2, 3, 4, 5])</span><span id="2565" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/5530e0e06d4fe6eab9aca8079f940220.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5-aJLYeOkIlFWGhhygmvmQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="c32f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">insert函数有3个参数:</p><ul class=""><li id="95c5" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">第一个是新列的索引(0表示第一个)。</li><li id="86de" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">第二个是新列的名称。</li><li id="37f8" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">第三个是新列的值。</li></ul></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="5d98" class="mp mb it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">6.熊猫分裂了</h1><p id="805d" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">在处理文本数据时，split函数非常有用。假设我们有一个包含多条信息的文本列。我们可以拆分它，为每个部分创建一个单独的列。</p><blockquote class="ob oc od"><p id="9e99" class="kz la oe lb b lc ld ju le lf lg jx lh of lj lk ll og ln lo lp oh lr ls lt lu im bi translated"><strong class="lb iu">注意</strong>:在str访问器下可以使用split函数。</p></blockquote><p id="059b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们通过拆分category列来创建cat1和cat2列。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="eda7" class="ma mb it lw b gy mc md l me mf">df[["cat1","cat2"]] = df["category"].str.split("-", expand=True)</span><span id="e2ae" class="ma mb it lw b gy mg md l me mf">df[["category","cat1","cat2"]]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/07b88e2438a0d3485f63093821924f32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F_F2OtpmBwYzsZ7oCZMbKA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="e55e" class="mp mb it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">7.熊猫猫</h1><p id="12e7" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">cat功能与split功能相反。它可用于通过组合字符串列来创建新列。在str访问器下也可以使用cat函数。</p><p id="ae39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我们如何通过合并cat1和cat2列来创建category列。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="103e" class="ma mb it lw b gy mc md l me mf">df["category"] = df["cat1"].str.cat(df["cat2"], sep="-")</span></pre></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="a087" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在用于机器学习的数据分析、数据清理和特征工程的典型任务中创建新列。幸运的是，Pandas通过提供几个函数和方法使它变得非常容易。在本文中，我们介绍了加速和简化这些操作的7个功能。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="b720" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="oe">你可以成为</em> <a class="ae ky" href="https://sonery.medium.com/membership" rel="noopener"> <em class="oe">媒介会员</em> </a> <em class="oe">解锁我的全部写作权限，外加其余媒介。如果你已经是了，别忘了订阅<em class="oe"/><em class="oe">如果你想在我发表新文章时收到电子邮件。</em></em></p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="c517" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>