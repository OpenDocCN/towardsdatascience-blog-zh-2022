<html>
<head>
<title>3 SQL Interview Questions On Computing Running Totals</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">3 个关于计算累计总数的 SQL 面试问题</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-sql-coding-questions-on-computing-running-totals-bf657cca8d89#2022-02-23">https://towardsdatascience.com/3-sql-coding-questions-on-computing-running-totals-bf657cca8d89#2022-02-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3a13" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">采访倒计时 P2:在这篇文章中，我提出了关于用窗口函数计算运行总数的三个常见编码问题的解决方案。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/723f4cc3564e3305894390dcc1113cde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SPS1MPZ4jvCfYOdNsslJ_Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">比安卡·加斯帕罗托摄于<a class="ae ky" href="https://www.pexels.com/photo/person-showing-white-mug-in-focus-photography-1752806/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">佩克斯</a></p></figure><h2 id="bf9a" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak"> <em class="lv">推荐给我的读者</em> </strong></h2><p id="cfdd" class="pw-post-body-paragraph lw lx it ly b lz ma ju mb mc md jx me li mf mg mh lm mi mj mk lq ml mm mn mo im bi translated"><em class="mp">你是在</em> <strong class="ly iu"> <em class="mp">学习 SQL </em> </strong> <em class="mp">还是在为下一次</em> <strong class="ly iu"> <em class="mp">技术面试</em> </strong> <em class="mp">而你喜欢这篇文章的提问风格？</em></p><p id="e61d" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated"><em class="mp">那么，你应该看看由</em><strong class="ly iu"><em class="mp"/></strong><strong class="ly iu"><strong class="ly iu"><em class="mp">StrataScratch</em></strong><em class="mp">提供的</em><strong class="ly iu"><em class="mp"/></strong><a class="ae ky" href="https://platform.stratascratch.com/coding?via=antonello" rel="noopener ugc nofollow" target="_blank"><strong class="ly iu"><em class="mp">SQL 编码挑战</em></strong><strong class="ly iu"><em class="mp"/></strong><em class="mp"/></a><a class="ae ky" href="https://platform.stratascratch.com/coding?via=antonello" rel="noopener ugc nofollow" target="_blank"/></strong><a class="ae ky" href="https://platform.stratascratch.com/coding?via=antonello" rel="noopener ugc nofollow" target="_blank"/><a class="ae ky" href="https://platform.stratascratch.com/coding?via=antonello" rel="noopener ugc nofollow" target="_blank"/><a class="ae ky" href="https://platform.stratascratch.com/coding?via=antonello" rel="noopener ugc nofollow" target="_blank">【T4</a></p><p id="3ad6" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">在他们的平台上，你可以找到 FAANG 和其他主要科技公司提出的最新和最现实的面试问题，并决定你是否希望使用 SQL 或 Python 来解决这些问题。T83】</p><h1 id="97e9" class="mv la it bd lb mw mx my le mz na nb lh jz nc ka ll kc nd kd lp kf ne kg lt nf bi translated">介绍</h1><p id="87fb" class="pw-post-body-paragraph lw lx it ly b lz ma ju mb mc md jx me li mf mg mh lm mi mj mk lq ml mm mn mo im bi translated">窗口函数是可应用于数据集的分析函数，无需改变其粒度。</p><p id="9f87" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">它们对记录窗口进行操作，为每一行返回一个值，而不是像<code class="fe ng nh ni nj b">GROUP BY</code>那样折叠结果。</p><p id="6db4" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">现在，让我直截了当地问你一个问题:<strong class="ly iu"> <em class="mp">你真的想得到那份有趣又高薪的数据工作吗</em>？</strong></p><p id="1eb9" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">好吧，如果你是，在你的下一次 SQL 技术面试中，准备好回答关于窗口函数的问题。他们经常会被问到。</p><blockquote class="nk"><p id="b5e8" class="nl nm it bd nn no np nq nr ns nt mo dk translated">“在你的下一次 SQL 技术面试中，准备好回答关于窗口功能的问题。更多的时候，他们会被问到。”</p></blockquote><p id="2a0d" class="pw-post-body-paragraph lw lx it ly b lz nu ju mb mc nv jx me li nw mg mh lm nx mj mk lq ny mm mn mo im bi translated">作为一名候选人，我不记得有哪一次 SQL 编码没有要求我编写某种涉及窗口函数的查询。</p><p id="5226" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">另一方面，作为一名技术面试者，我仍然会遇到申请数据领域中级职位的候选人，他们以前甚至从未听说过窗口函数！</p><p id="1d1a" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">对我来说，这是一个危险信号:如果您每天都要处理报表或 KPI，那么在某些时候，您一定需要按日期对维度进行排序，或者计算特定时间间隔内的累计总和。不要声称你总是用连接来做，我不会买它…</p><p id="02b0" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">在之前的帖子中，我已经提到了一些关于排名的面试编码问题:</p><div class="nz oa gp gr ob oc"><a rel="noopener follow" target="_blank" href="/6-sql-window-functions-coding-problems-on-ranking-interview-countdown-p1-9be0ccf66453"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">排名上的 6 个 SQL 窗口函数编码问题——采访倒计时 P1</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">SQL 面试即将来临，您正在寻找一些具有挑战性的练习来测试您的准备情况？你是…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq ks oc"/></div></div></a></div><p id="e50d" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">在本文中，我将与您分享一些关于用窗口函数计算运行总数<strong class="ly iu">的常见编码挑战。</strong></p><h1 id="faf8" class="mv la it bd lb mw mx my le mz na nb lh jz nc ka ll kc nd kd lp kf ne kg lt nf bi translated">SQL 运行总计语法</h1><p id="da0a" class="pw-post-body-paragraph lw lx it ly b lz ma ju mb mc md jx me li mf mg mh lm mi mj mk lq ml mm mn mo im bi translated">要计算累计，应使用以下语法:</p><pre class="kj kk kl km gt or nj os ot aw ou bi"><span id="2fd0" class="kz la it nj b gy ov ow l ox oy"><strong class="nj iu">SUM(col) OVER ( partition_clause<br/>                order_clause<br/>                frame_clause )</strong></span></pre><p id="0df9" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">长话短说，当一个<code class="fe ng nh ni nj b">OVER()</code>子句出现时，你在一个窗口函数前面。事实上，该子句用于定义将要执行<code class="fe ng nh ni nj b">SUM()</code>操作的行组(<em class="mp">又称分区</em>)。</p><p id="a68b" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated"><code class="fe ng nh ni nj b">OVER()</code>中的子句是可选的，因此当缺少这些子句时，将对整个结果集应用累加和，而不考虑特定的行组或顺序。</p><p id="f781" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">相反，指定一个<code class="fe ng nh ni nj b">partition_clause</code>允许定义将应用累计的分区:</p><pre class="kj kk kl km gt or nj os ot aw ou bi"><span id="27af" class="kz la it nj b gy ov ow l ox oy"><strong class="nj iu">SUM(col) OVER ( PARTITION BY col1, col2...)</strong></span></pre><p id="6a97" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">而<code class="fe ng nh ni nj b">order_clause</code>也允许定义累计应用于分区的顺序:</p><pre class="kj kk kl km gt or nj os ot aw ou bi"><span id="bb16" class="kz la it nj b gy ov ow l ox oy"><strong class="nj iu">SUM(col) OVER ( PARTITION BY col1, col2... ORDER BY col1 ASC|DESC)</strong></span></pre><p id="3515" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">最后，<code class="fe ng nh ni nj b">frame_clause</code>可以用来选择每个分区中的行子集，以应用运行总和。它本身由一个<code class="fe ng nh ni nj b">frame_start</code>和一个<code class="fe ng nh ni nj b">frame_end</code>组成，在一个分区内为用户提供了极大的灵活性:</p><pre class="kj kk kl km gt or nj os ot aw ou bi"><span id="84e0" class="kz la it nj b gy ov ow l ox oy"><strong class="nj iu">SUM(col) OVER ( PARTITION BY col1, col2... ORDER BY col1 ASC|DESC RANGE|ROWS BETWEEN frame_start AND frame_end)</strong></span></pre><p id="9013" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">其中<code class="fe ng nh ni nj b">frame_start</code>取下列值之一:</p><pre class="kj kk kl km gt or nj os ot aw ou bi"><span id="afeb" class="kz la it nj b gy ov ow l ox oy"><strong class="nj iu">N PRECEDING</strong> -&gt; (for instance 2 PRECEDING)<br/><strong class="nj iu">UNBOUNDED PRECEDING </strong><br/><strong class="nj iu">CURRENT ROW</strong></span></pre><p id="981b" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">并且<code class="fe ng nh ni nj b">frame_end</code>取以下值之一:</p><pre class="kj kk kl km gt or nj os ot aw ou bi"><span id="429f" class="kz la it nj b gy ov ow l ox oy"><strong class="nj iu">CURRENT ROW </strong><br/><strong class="nj iu">UNBOUNDED FOLLOWING </strong><br/><strong class="nj iu">N FOLLOWING </strong>-&gt; (for instance 7 FOLLOWING)</span></pre><p id="b723" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">你能看到无穷无尽的组合，以及如果有效使用的话<code class="fe ng nh ni nj b">frame_clause</code>将会给你带来的力量吗？</p><p id="c229" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">我认为，许多分析师仍然在计算窗口函数，而没有完全意识到框架如何支持他们的事业。</p><h1 id="e7ff" class="mv la it bd lb mw mx my le mz na nb lh jz nc ka ll kc nd kd lp kf ne kg lt nf bi translated">数据集+编码挑战</h1><p id="b71c" class="pw-post-body-paragraph lw lx it ly b lz ma ju mb mc md jx me li mf mg mh lm mi mj mk lq ml mm mn mo im bi translated">对于下面介绍的三个编码挑战，您将使用来自<a class="ae ky" href="https://mode.com/sql-tutorial/" rel="noopener ugc nofollow" target="_blank">模式的公共仓库</a>的<code class="fe ng nh ni nj b">orders</code>表，您可以通过他们的<a class="ae ky" href="https://mode.com/online-sql-editor/" rel="noopener ugc nofollow" target="_blank"> SQL 编辑器</a>直接查询该表，以及许多其他数据集。</p><p id="8c10" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated"><code class="fe ng nh ni nj b">orders</code>表的前 10 行显示如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/c9dbe089fea6d48ec8b8676c7125c54d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vZiZM7MBwfeHhi8GP3QrtQ.png"/></div></div></figure><p id="6b54" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">在您开始编码之前，请看一下这些规范:</p><ul class=""><li id="d0da" class="pa pb it ly b lz mq mc mr li pc lm pd lq pe mo pf pg ph pi bi translated">该表的主键是<code class="fe ng nh ni nj b">id</code>字段。</li><li id="6ea9" class="pa pb it ly b lz pj mc pk li pl lm pm lq pn mo pf pg ph pi bi translated">有多个<code class="fe ng nh ni nj b">accounts_ids</code>，每个都可以关联一个或多个订单 id(<code class="fe ng nh ni nj b">id</code>)。</li><li id="9f0e" class="pa pb it ly b lz pj mc pk li pl lm pm lq pn mo pf pg ph pi bi translated">表格的粒度由<code class="fe ng nh ni nj b">timestamp</code>决定，记录在<code class="fe ng nh ni nj b">occurred_at</code>字段中。</li></ul><h2 id="3b2a" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">问题 1 |难度:简单</h2><p id="0fe0" class="pw-post-body-paragraph lw lx it ly b lz ma ju mb mc md jx me li mf mg mh lm mi mj mk lq ml mm mn mo im bi translated"><strong class="ly iu">面试官:</strong> <em class="mp">“我想让你先写一个查询，生成一个按月分组的新数据集，而不是时间戳。该数据集应包括三个字段:</em> <code class="fe ng nh ni nj b">account_id</code>、<code class="fe ng nh ni nj b">occurred_month</code>和<code class="fe ng nh ni nj b">total_amount_usd</code> <em class="mp">，并且应仅针对以下账户进行计算:</em>、<code class="fe ng nh ni nj b">1041</code>、<code class="fe ng nh ni nj b">1051</code>、<code class="fe ng nh ni nj b">1061</code>、<code class="fe ng nh ni nj b">10141</code>。</p><p id="cd4b" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated"><em class="mp">然后，使用新的数据集，请计算一个按</em> <code class="fe ng nh ni nj b"><em class="mp">occurred_month</em></code> <em class="mp">排序的</em> <strong class="ly iu"> <em class="mp">运行总数</em> </strong> <em class="mp">，不折叠结果集</em>中的行。<em class="mp">只显示两列</em> <code class="fe ng nh ni nj b">occurred_month</code> <em class="mp">和</em> <code class="fe ng nh ni nj b">cum_amnt_usd_by_month</code>。</p><p id="cbd5" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated"><strong class="ly iu">预期输出:</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi po"><img src="../Images/a7ef45b8c23cf3150ce9e2f4f59a76da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KcELs2mkbYN3XKk0Gzk-jg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在输出中只显示 15 行中的 10 行。</p></figure><p id="140f" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated"><strong class="ly iu">面试官提示:</strong> <em class="mp">“查询分两步。我建议首先创建一个新的数据集作为 CTE 的一部分，然后在其上计算累计”。</em></p><p id="e311" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated"><strong class="ly iu">解决方案:</strong>在这个案例中，面试官正在测试一些技能。他们希望了解您是否可以使用<code class="fe ng nh ni nj b">CTEs</code>，是否可以使用<code class="fe ng nh ni nj b">GROUP BY</code>改变数据集的粒度，以及最终是否能够得到一个简单的运行总数:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/0a1b1aa66e29deb59fe79670248a9863.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2u7h_5kxKinnn15C7VGmiw.png"/></div></div></figure><p id="9090" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">因为没有指定分区，所以运行总计应用于整个数据集，并按(升序)<code class="fe ng nh ni nj b">occurred_month</code>排序。</p><p id="122d" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">例如，对于 2016 年 9 月，运行总计等于<code class="fe ng nh ni nj b">6932.43</code>，因为它是在<code class="fe ng nh ni nj b">CTE</code>中计算的 8 月和 9 月部分合计的累积和:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pq"><img src="../Images/8289d7b6309e01aa507473fa96b762d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Myky00HjotxYDv26DZHysQ.png"/></div></div></figure><h2 id="08ac" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">问题 2 |难度:简单</h2><p id="9eff" class="pw-post-body-paragraph lw lx it ly b lz ma ju mb mc md jx me li mf mg mh lm mi mj mk lq ml mm mn mo im bi translated"><strong class="ly iu">面试官:</strong> <em class="mp">“现在，使用与前面查询相同的 cte，请计算一个</em> <strong class="ly iu"> <em class="mp">运行总计</em> </strong> <em class="mp">按</em> <code class="fe ng nh ni nj b"><em class="mp">account_id</em></code> <em class="mp">，按</em> <code class="fe ng nh ni nj b"><em class="mp">occurred_month</em></code> <em class="mp">排序。结果集应改为按</em> <code class="fe ng nh ni nj b"><em class="mp">account_id</em></code>排序，并包括三列，即:<code class="fe ng nh ni nj b">account_id</code>、<code class="fe ng nh ni nj b">occurred_month</code>和<code class="fe ng nh ni nj b">cum_mon_amnt_usd_by_account</code>。</p><p id="5a0b" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated"><strong class="ly iu">预期产出:</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pr"><img src="../Images/2307e9276432501db70a776c840c17c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Axkp3Gp-fk5iWysxLJXklg.png"/></div></div></figure><p id="35ea" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated"><strong class="ly iu">解决方案:</strong>面试官只是要求你在<code class="fe ng nh ni nj b">OVER()</code>子句中引入一个由<code class="fe ng nh ni nj b">account_id</code>划分的部分，并保持与上一个练习中相同的顺序。然而，这一次，将为每个<code class="fe ng nh ni nj b">account_id</code>运行单独的运行总计。</p><p id="562b" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">在这种情况下，还将测试您区分窗口中的排序结果和主查询中的排序结果的能力:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ps"><img src="../Images/7cfa23bbda61ecf87fe59474e723b589.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0jfZNXzNQ0jVT_bIW_KpCw.png"/></div></div></figure><h2 id="7720" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">问题# 3 |难度:中等</h2><p id="b66f" class="pw-post-body-paragraph lw lx it ly b lz ma ju mb mc md jx me li mf mg mh lm mi mj mk lq ml mm mn mo im bi translated"><strong class="ly iu">面试官:</strong> <em class="mp">“最后让我们来关注一下</em> <code class="fe ng nh ni nj b"><em class="mp">quantity</em></code> <em class="mp">领域。像你以前做的那样，先创建一个</em> <code class="fe ng nh ni nj b"><em class="mp">CTE</em></code> <em class="mp">来返回</em> <code class="fe ng nh ni nj b"><em class="mp">quantity</em></code> <em class="mp">并按</em> <code class="fe ng nh ni nj b"><em class="mp">occurred_month</em></code> <em class="mp">排序。</em></p><p id="4556" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated"><em class="mp">然后，使用</em> <code class="fe ng nh ni nj b"><em class="mp">CTE</em></code> <em class="mp">的输出，计算一个</em> <strong class="ly iu"> <em class="mp"> 3 个月的滚动运行总数</em> </strong> <em class="mp">使用一个包含当前月份的窗口。将字段命名为</em> <code class="fe ng nh ni nj b"><em class="mp">cum_sum_3_months_right_rolling</em></code> <em class="mp">。</em></p><p id="6f4b" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated"><em class="mp">也计算一个</em> <strong class="ly iu"> <em class="mp"> 7 个月的累计运行总数</em> </strong> <em class="mp">使用一个当前月份始终是中间月份的窗口。将字段命名为</em> <code class="fe ng nh ni nj b"><em class="mp">cum_sum_7_months_center_rolling</em></code> <em class="mp">。”</em></p><p id="dbc7" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated"><strong class="ly iu">预期产出:</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pt"><img src="../Images/1776841b52abb626553fb86f6de7f3fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lbxUJId6dY1fJHz44A1RKQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在输出中显示 38 行中的 10 行。</p></figure><p id="0f45" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated"><strong class="ly iu">面试官的提示:</strong> <em class="mp">“要解决这个问题，你需要使用一个</em> <code class="fe ng nh ni nj b"><em class="mp">frame_clause</em></code> <em class="mp">。在计算滚动累积和时，考虑</em> <code class="fe ng nh ni nj b"><em class="mp">current_row</em></code> <em class="mp">相对于您试图创建的帧的位置。</em></p><p id="d9a0" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated"><strong class="ly iu">解决方案:</strong>要创建一个滚动的<strong class="ly iu"> </strong>运行总数你需要使用<code class="fe ng nh ni nj b">ROWS BETWEEN</code>语法。</p><p id="1f54" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">在第一种情况下，您将包括<code class="fe ng nh ni nj b">2 PRECEDING</code>行，而<code class="fe ng nh ni nj b">CURRENT_ROW</code>将位于框架的右边缘。在第二种情况下，您将包括<code class="fe ng nh ni nj b">3 PRECEDING</code>行和<code class="fe ng nh ni nj b">3 FOLLOWING</code>行，并且<code class="fe ng nh ni nj b">CURRENT_ROW</code>将位于框架的中间:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pu"><img src="../Images/9816c0bb5b8a6094526493b7d7ca94a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UXXt7TGvkdFFqm-opBx1mg.png"/></div></div></figure><p id="0c0c" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">当没有足够的行来匹配帧所要求的数量时(在<code class="fe ng nh ni nj b">CURRENT ROW</code>之前或之后)，将只使用可用的行来计算滚动和。</p><p id="6f7f" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">为了理解这个概念，让我们看看<code class="fe ng nh ni nj b">CTE</code>输出的幕后发生了什么:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pv"><img src="../Images/9e3f25e1721233609a9e526ef16c663d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LKlxUDfarfYdpAqDq4jL5w.png"/></div></div></figure><p id="7f53" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">例如，当试图计算<code class="fe ng nh ni nj b">cum_sum_7_months_center_rolling</code>字段时，<code class="fe ng nh ni nj b">CURRENT ROW</code>需要位于间隔的中心，这意味着当指针位于行<code class="fe ng nh ni nj b">1</code> ( <em class="mp">蓝色框</em>)时，在中心 之后将只有行<strong class="ly iu"> <em class="mp">，而在中心</em> </strong>之前没有行<strong class="ly iu"> <em class="mp">，因此滚动求和将只在 4 行上执行(<em class="mp"> 213，863 【T63</em></em></strong></p><p id="aed6" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">但是，当指针在第<code class="fe ng nh ni nj b">4</code> ( <em class="mp">红框</em>)行时，在 之前将有 3 条记录<strong class="ly iu"> <em class="mp">，在</em></strong><code class="fe ng nh ni nj b">CURRENT ROW</code>之后将有 3 条记录<strong class="ly iu"> <em class="mp">，这样在计算滚动和(<em class="mp"> 367，695 </em>)时<strong class="ly iu"> 7 天框</strong>将完全匹配。</em></strong></p><h1 id="d33f" class="mv la it bd lb mw mx my le mz na nb lh jz nc ka ll kc nd kd lp kf ne kg lt nf bi translated"><strong class="ak">结论</strong></h1><p id="b3c2" class="pw-post-body-paragraph lw lx it ly b lz ma ju mb mc md jx me li mf mg mh lm mi mj mk lq ml mm mn mo im bi translated">如果您的 SQL 技术面试倒计时已经开始，请确保准备好回答有关分析功能的问题。</p><p id="3670" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">为了支持您的旅程，在本文中，我讨论了如何使用窗口函数在 SQL 中计算累计值。</p><p id="b7e2" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">此外，您的知识已经过测试，解决了 SQL 编码中常见的 3 个编码难题。</p><p id="a695" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">祝你面试顺利，学习顺利！</p></div><div class="ab cl pw px hx py" role="separator"><span class="pz bw bk qa qb qc"/><span class="pz bw bk qa qb qc"/><span class="pz bw bk qa qb"/></div><div class="im in io ip iq"><h1 id="7b31" class="mv la it bd lb mw qd my le mz qe nb lh jz qf ka ll kc qg kd lp kf qh kg lt nf bi translated"><strong class="ak">来源</strong></h1><div class="nz oa gp gr ob oc"><a href="https://mode.com/sql-tutorial/sql-window-functions/" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">SQL 窗口函数|高级 SQL 模式</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">从这里开始？本课是使用 SQL 进行数据分析的完整教程的一部分。看看开头…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">mode.com</p></div></div><div class="ol l"><div class="qi l on oo op ol oq ks oc"/></div></div></a></div><div class="nz oa gp gr ob oc"><a href="https://www.sqltutorial.org/sql-window-functions/" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">SQL 窗口函数</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">摘要:在本教程中，您将了解以简单方式解决复杂查询挑战的 SQL 窗口函数…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">www.sqltutorial.org</p></div></div><div class="ol l"><div class="qj l on oo op ol oq ks oc"/></div></div></a></div><p id="5e02" class="pw-post-body-paragraph lw lx it ly b lz mq ju mb mc mr jx me li ms mg mh lm mt mj mk lq mu mm mn mo im bi translated">这篇文章包括附属链接，如果你购买的话，我可以在不增加你额外费用的情况下赚取一小笔佣金。</p></div></div>    
</body>
</html>