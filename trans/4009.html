<html>
<head>
<title>Comprehensive Guide to Deploying Any ML Model as APIs With Python And AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python和AWS Lambda将任何ML模型部署为API的综合指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/comprehensive-guide-to-deploying-any-ml-model-as-apis-with-python-and-aws-lambda-b441d257f1ec#2022-09-07">https://towardsdatascience.com/comprehensive-guide-to-deploying-any-ml-model-as-apis-with-python-and-aws-lambda-b441d257f1ec#2022-09-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d2f5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">把那个模型放到网上</h2></div><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/09cca6035291bdce22fc5312f298b3f9.png" data-original-src="https://miro.medium.com/v2/format:webp/1*jB44kjC_w04bpAyhMBFsDA.jpeg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated"><strong class="bd ku">照片由</strong> <a class="ae kv" href="https://www.pexels.com/photo/blue-and-red-galaxy-artwork-1629236/" rel="noopener ugc nofollow" target="_blank"> <strong class="bd ku">苏西</strong> </a>拍摄</p></figure><h2 id="bbe0" class="kw kx it bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">介绍</h2><p id="3968" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma lf mb mc md lj me mf mg ln mh mi mj mk im bi translated">人们说Python最好的一点是它丰富的开源库。恕我不能苟同。</p><p id="6c43" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">在完成一项任务时有多种选择可能会给你带来很大的灵活性，但它们最终可能会造成巨大的混乱，让程序员感到困惑和愤怒。</p><p id="19da" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">现在，这是关于机器学习操作(MLOps)的情况。近年来，它已经成为一个如此重要的领域，以至于Python社区已经出色地应对了这种情况——通过创建尽可能多的工具和库来执行MLOps规程。</p><p id="ef7f" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">现在，对于一个普通用户来说，筛选所有的信息，比较并提出一套最终的工具来解决他们的业务问题是一个挑战。</p><p id="cbef" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">即使他们做到了，把他们放在一起，让他们交流，并达成一个现成的，像样的机器学习解决方案也是一个完全独立的问题。</p><p id="613e" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">以将模型部署为API为例(本文的主题)。你会选择哪一套工具来完成这项工作？</p><p id="3649" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">暂时，让我们忘记所有开始时的忙乱，比如数据版本化、模型选择和特征工程，并且说你已经有了一个现成的模型。</p><p id="46d5" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">如何将模型转换成HTTPS地址，以便用户可以发送请求？有这么多的选择，像Flask，Django，FastAPI等等。</p><p id="329a" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">即使选择了框架，让它上线也不容易。你使用AWS，Heroku，GCP，或其他几十个几乎声称他们提供了“唯一最好的方法”来做到这一点吗？</p><p id="9c90" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">为了省去您回答所有这些问题的麻烦，在本文中，我将介绍一个解决方案，与其他替代方案相比，它应该非常简单明了，没有任何麻烦。你只需要知道<code class="fe mq mr ms mt b">scikit-learn</code>和<code class="fe mq mr ms mt b">xgboost</code>；其余的我会教。</p><p id="637e" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">最后，我们将构建<a class="ae kv" href="https://mbzblb2ude.execute-api.us-west-1.amazonaws.com/" rel="noopener ugc nofollow" target="_blank">这个API </a>:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/0f768a719c93661e05a04f02b8139d3e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Fx7euEV_evrPmRD7X6BblQ.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="05fe" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">用户可以向它的<code class="fe mq mr ms mt b">classify</code>端点发送请求以获得预测，并通过一个链接在任何地方嵌入这个API。</p><div class="mu mv gp gr mw mx"><a href="https://ibexorigin.medium.com/membership" rel="noopener follow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">通过我的推荐链接加入Medium-BEXGBoost</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">获得独家访问我的所有⚡premium⚡内容和所有媒体没有限制。支持我的工作，给我买一个…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">ibexorigin.medium.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl ko mx"/></div></div></a></div><p id="a206" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">获得由强大的AI-Alpha信号选择和总结的最佳和最新的ML和AI论文:</p><div class="mu mv gp gr mw mx"><a href="https://alphasignal.ai/?referrer=Bex" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">阿尔法信号|机器学习的极品。艾总结的。</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">留在循环中，不用花无数时间浏览下一个突破；我们的算法识别…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">alphasignal.ai</p></div></div><div class="ng l"><div class="nm l ni nj nk ng nl ko mx"/></div></div></a></div></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h2 id="1e82" class="kw kx it bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">我们将使用的堆栈</h2><p id="4272" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma lf mb mc md lj me mf mg ln mh mi mj mk im bi translated">在我们开始之前，让我概述一下我们将使用的技术列表，并解释我选择它们的原因。</p><ul class=""><li id="3379" class="nu nv it lu b lv ml ly mm lf nw lj nx ln ny mk nz oa ob oc bi translated">熊猫，<a class="ae kv" href="https://numpy.org/" rel="noopener ugc nofollow" target="_blank">熊猫</a>——无需解释。</li><li id="9f24" class="nu nv it lu b lv od ly oe lf of lj og ln oh mk nz oa ob oc bi translated"><a class="ae kv" href="https://scikit-learn.org/" rel="noopener ugc nofollow" target="_blank"> Sklearn </a>和<a class="ae kv" href="https://xgboost.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> XGBoost </a> —模型训练。它们只是为了说明的目的而被选择的，并且这些指令将在来自任何其他框架的模型上工作</li><li id="2b02" class="nu nv it lu b lv od ly oe lf of lj og ln oh mk nz oa ob oc bi translated"><a class="ae kv" href="https://docs.bentoml.org/en/latest/" rel="noopener ugc nofollow" target="_blank">BentoML</a>——将训练好的模型打包到本地API中(后面会详细解释)</li><li id="8490" class="nu nv it lu b lv od ly oe lf of lj og ln oh mk nz oa ob oc bi translated"><a class="ae kv" href="https://github.com/bentoml/bentoctl" rel="noopener ugc nofollow" target="_blank"> bentoctl </a> —一个CLI工具，允许您构建Docker映像，并使用一个命令将它们保存为云兼容格式</li><li id="b6fc" class="nu nv it lu b lv od ly oe lf of lj og ln oh mk nz oa ob oc bi translated"><a class="ae kv" href="https://www.terraform.io/" rel="noopener ugc nofollow" target="_blank"> Terraform </a> —另一款用于管理云基础设施的CLI工具。它负责创建资源和函数，并将容器推送给它们，而不需要访问50万个页面。</li><li id="9246" class="nu nv it lu b lv od ly oe lf of lj og ln oh mk nz oa ob oc bi translated"><a class="ae kv" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS </a> —最受欢迎、最可靠、最灵活的云平台(你可以通过<a class="ae kv" href="https://trends.google.com/trends/explore?q=aws,google%20cloud" rel="noopener ugc nofollow" target="_blank"> Google Trends </a>确认)。</li><li id="2e2e" class="nu nv it lu b lv od ly oe lf of lj og ln oh mk nz oa ob oc bi translated"><a class="ae kv" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a> —在无服务器云上运行代码——高度可扩展且舒适。</li></ul><p id="bd8b" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">所以，事不宜迟，让我们开始吧。</p></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h2 id="efb2" class="kw kx it bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">BentoML是什么，它的目的是什么？</h2><p id="3956" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma lf mb mc md lj me mf mg ln mh mi mj mk im bi translated">为了最大化机器学习的商业影响，数据科学家和工程师之间从模型训练到部署的交接应该是快速和迭代的。</p><p id="47c8" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">然而，数据科学家通常不具备打包训练好的模型并将其推给工程师的技能，而工程师发现很难处理来自几十个不同ML框架的模型。</p><p id="398a" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">BentoML的创建就是为了解决这些问题，并尽可能容易/快速地交付到生产部署。在接下来的几节中，您将看到BentoML如何使执行繁琐的MLOps操作变得容易。这些例子是:</p><ul class=""><li id="f7d5" class="nu nv it lu b lv ml ly mm lf nw lj nx ln ny mk nz oa ob oc bi translated">将任何框架的任何模型保存为统一格式，以简化协作。</li><li id="caec" class="nu nv it lu b lv od ly oe lf of lj og ln oh mk nz oa ob oc bi translated">使用单个Python函数创建HTTP API端点，以加快迭代速度。</li><li id="a70d" class="nu nv it lu b lv od ly oe lf of lj og ln oh mk nz oa ob oc bi translated">使用Docker和一个CLI命令将模型需要的所有东西打包。</li></ul><p id="6a21" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">阅读文档<a class="ae kv" href="https://docs.bentoml.org/en/latest/#https://docs.bentoml.org/en/latest/#" rel="noopener ugc nofollow" target="_blank">这里</a>了解更多信息，或者继续阅读。</p></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h2 id="74fd" class="kw kx it bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">数据集准备和模型训练</h2><p id="d245" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma lf mb mc md lj me mf mg ln mh mi mj mk im bi translated">这篇文章的核心是关于模型部署的，所以我想把您的全部注意力集中在这个领域。</p><p id="3049" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">为此，我假设您在阅读本文时已经有了训练有素的模型，并且希望尽快部署它。</p><p id="97fa" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">为了在这里进行模拟，我们将创建一个合成数据集，训练一个XGBoost模型，并继续前进，就好像您已经完成了MLOps生命周期的所有先前步骤，如数据清理、探索、特征工程、模型实验、超参数调整，并找到了在您的数据集上表现最佳的模型。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="3e51" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">我们创建了一个简单的数据集，包含七个特征和10k个样本，目标是二进制分类。</p><p id="4602" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">我们将它加载回来，训练一个普通的XGBoost分类器，并假设它是我们调优的模型。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><h2 id="dd6b" class="kw kx it bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">将训练好的模型保存为BentoML格式</h2><p id="cf57" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma lf mb mc md lj me mf mg ln mh mi mj mk im bi translated">通过调用特定于框架的<code class="fe mq mr ms mt b">save</code>命令，可以将训练好的模型保存为BentoML兼容的格式:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="18fc" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">返回的对象是BentoML <code class="fe mq mr ms mt b">Model</code>类的一个实例，带有一个名为<em class="ok">标签</em>的标签。</p><p id="19dd" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">标签由两部分组成——用户给出的名称和版本字符串，以区分不同时间保存的模型。即使保存了相同的模型，BentoML也会创建一个新的目录和一个版本字符串。</p><p id="2489" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">BentoML支持几乎所有基本的ML框架:</p><ul class=""><li id="7518" class="nu nv it lu b lv ml ly mm lf nw lj nx ln ny mk nz oa ob oc bi translated">经典:Sklearn、XGBoost、CatBoost、LightGBM</li><li id="85c8" class="nu nv it lu b lv od ly oe lf of lj og ln oh mk nz oa ob oc bi translated">深度学习:TensorFlow，PyTorch，PyTorch Lightning，Keras，Transformers</li><li id="beb3" class="nu nv it lu b lv od ly oe lf of lj og ln oh mk nz oa ob oc bi translated">其他:ONNX，MLFlow，fast.ai，statsmodels，spaCy，h2o，Gluon等。</li></ul><p id="4e4f" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">每个框架都有一个相应的<code class="fe mq mr ms mt b">bentoml.framework.save_model</code>命令。</p><p id="9931" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">当一个模型被保存时，它进入一个名为BentoML model store的本地目录。从最后一个输出(<code class="fe mq mr ms mt b">path</code>参数)中，我们看到我的模型商店位于<code class="fe mq mr ms mt b">/home/bexgboost/bentoml/models</code>。您可以通过在终端中调用<code class="fe mq mr ms mt b">bentoml models list</code>命令来查看您所有型号的列表:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="8bfa" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">你也可以看到我其他项目的模型。</p><blockquote class="ol om on"><p id="dd71" class="ls lt ok lu b lv ml ju lx ly mm jx ma oo mn mc md op mo mf mg oq mp mi mj mk im bi translated">注意:在BentoML文档和本文中，名称“model”和“tag”可以互换使用，以指代模型存储中保存的模型。</p></blockquote><p id="3b81" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated"><code class="fe mq mr ms mt b">save_model</code>具有其他参数，用于传递关于模型的额外信息，从元数据到其他用户定义的对象(例如，作为单独对象的模型的特征重要性):</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="3251" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">上面，我们保存了我们的XGBoost模型和其他数据，比如作者(我)，特性重要性分数，您可以用<code class="fe mq mr ms mt b">booster.get_score</code>和一个虚拟指标来检索。</p></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h2 id="16db" class="kw kx it bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">共享模型</h2><p id="0e50" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma lf mb mc md lj me mf mg ln mh mi mj mk im bi translated">使用<code class="fe mq mr ms mt b">bentoml models export</code>命令，BentoML模型存储中的模型可以作为独立的档案共享:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="9f1e" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">当您不知道标签的确切版本字符串时，可以使用“:latest”后缀来选择最新的版本。使用上面的命令，我们将分类器导出到<code class="fe mq mr ms mt b">models</code>目录下的<code class="fe mq mr ms mt b">.bentomodel</code>档案中。当队友发送给你一个<code class="fe mq mr ms mt b">.bentomodel</code>存档时，你可以使用<code class="fe mq mr ms mt b">import</code>命令将其发送到你当地的BentoML模型商店:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h2 id="f445" class="kw kx it bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">检索保存的模型</h2><p id="902c" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma lf mb mc md lj me mf mg ln mh mi mj mk im bi translated">有几种方法可以将保存的模型从模型库中加载到您的环境中。最简单的就是<code class="fe mq mr ms mt b">load_model</code>功能。和<code class="fe mq mr ms mt b">save_model</code>一样，<code class="fe mq mr ms mt b">load_model</code>也是特定于框架的:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="e451" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">该函数将以保存前的相同格式加载模型，这意味着您可以使用其本机方法，如<code class="fe mq mr ms mt b">predict</code>:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="e668" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">要将模型作为BentoML <code class="fe mq mr ms mt b">Model</code>对象加载，您可以使用<code class="fe mq mr ms mt b">models.get</code>命令，它不是特定于框架的:</p><pre class="ki kj kk kl gt or mt os ot aw ou bi"><span id="b465" class="kw kx it mt b gy ov ow l ox oy">tag = bentoml.models.get("xgb_custom:latest")</span></pre><p id="ee0d" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">您可能希望以这种格式加载模型的原因是，现在您可以访问它的附加组件，如元数据和标签:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="572d" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">检索模型的最后也是最重要的方法是将它们作为跑步者加载:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="4601" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">Runners是BentoML的特殊对象，根据它们的框架进行优化，以最有效的方式使用系统资源。运行器是我们将在下一节构建的API的核心组件。</p><p id="5961" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">现在，我们已经准备好开始构建API了！</p><div class="mu mv gp gr mw mx"><a href="https://ibexorigin.medium.com/membership" rel="noopener follow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">通过我的推荐链接加入Medium。</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">获得独家访问我的所有⚡premium⚡内容和所有媒体没有限制。你可以给我买一个coffee☕，用你的…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">ibexorigin.medium.com</p></div></div><div class="ng l"><div class="oz l ni nj nk ng nl ko mx"/></div></div></a></div></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h2 id="f518" class="kw kx it bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">组织成脚本</h2><p id="ccf3" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma lf mb mc md lj me mf mg ln mh mi mj mk im bi translated">到目前为止，我们一直使用笔记本。我们需要切换到Python脚本来构建API服务。我们来整理一下前面几节的代码。在<code class="fe mq mr ms mt b">generate_data.py</code>文件中，创建一个保存来自“数据集准备”部分的合成数据的函数:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><blockquote class="ol om on"><p id="4a95" class="ls lt ok lu b lv ml ju lx ly mm jx ma oo mn mc md op mo mf mg oq mp mi mj mk im bi translated">完整的<code class="fe mq mr ms mt b">generate_data.py</code>脚本可以在<a class="ae kv" href="https://github.com/BexTuychiev/bentoml_sample_project/blob/main/src/generate_data.py" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></blockquote><p id="c9fd" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">在一个<code class="fe mq mr ms mt b">train.py</code>文件中，创建一个函数来训练我们的XGBoost分类器，并将其保存到BentoML模型存储中:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><blockquote class="ol om on"><p id="57af" class="ls lt ok lu b lv ml ju lx ly mm jx ma oo mn mc md op mo mf mg oq mp mi mj mk im bi translated">完整的<code class="fe mq mr ms mt b">train.py</code>脚本可以在<a class="ae kv" href="https://github.com/BexTuychiev/bentoml_sample_project/blob/main/src/train.py" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></blockquote><p id="eff1" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">为了完整起见，请以正确的顺序运行这两个脚本，以生成数据集并将一个新模型保存到模型存储中。</p><h2 id="0451" class="kw kx it bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">创建API服务脚本</h2><p id="fef5" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma lf mb mc md lj me mf mg ln mh mi mj mk im bi translated">现在，是时候创建本地API了。为此，我们只需要一个简单的脚本，如下所示:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="e15a" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">在加载了以<code class="fe mq mr ms mt b">models.get</code>作为跑步者的模型后，我们创建了一个名为<code class="fe mq mr ms mt b">svc</code>的对象。这将是一个BentoML <code class="fe mq mr ms mt b">Service</code>对象的实例。<code class="fe mq mr ms mt b">Service</code>是抽象表示我们的API的高级类。</p><p id="8182" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">我们通过创建一个同名的函数向服务对象添加一个名为<code class="fe mq mr ms mt b">classify</code>的端点:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="601c" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">让我们一行一行地理解上面的片段。</p><p id="dfb6" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">首先，我们从<code class="fe mq mr ms mt b">bentoml.io</code>导入一个新的类<code class="fe mq mr ms mt b">NumpyNdarray</code>——输入/输出模块。为了标准化输入和输出，BentoML提供了几个类似于<code class="fe mq mr ms mt b">NumpyNdarray</code>的类，如<code class="fe mq mr ms mt b">Text</code>、<code class="fe mq mr ms mt b">File</code>、<code class="fe mq mr ms mt b">Image</code>、<code class="fe mq mr ms mt b">PandasDataFrame</code>等。</p><p id="9f0c" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">将这些类添加到<code class="fe mq mr ms mt b">svc.api</code>装饰器的<code class="fe mq mr ms mt b">input</code>和<code class="fe mq mr ms mt b">output</code>参数中可以确保正确的数据类型被传递到我们的API端点。在我们的例子中，我们确保传递给我们的<code class="fe mq mr ms mt b">classify</code>函数的数据总是一个NumPy数组。</p><p id="1068" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">如果我们正在处理图像模型，我们的输入类可能是一个<code class="fe mq mr ms mt b">File</code>或<code class="fe mq mr ms mt b">Image</code>类，而输出将再次是<code class="fe mq mr ms mt b">NumpyNdarray</code>。</p><p id="eaa0" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">在函数内部，我们使用runner的<code class="fe mq mr ms mt b">predict.run</code>方法来获得对输入的预测。该方法调用了XGBoost booster对象的<code class="fe mq mr ms mt b">predict</code>方法。</p><p id="f2e4" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">下面是脚本最终的样子:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="08ae" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">就是这样！通过使用<code class="fe mq mr ms mt b">bentoml serve</code>，我们可以创建一个本地调试服务器:</p><pre class="ki kj kk kl gt or mt os ot aw ou bi"><span id="4c62" class="kw kx it mt b gy ov ow l ox oy">$ bentoml serve service.py:svc --reload</span></pre><blockquote class="ol om on"><p id="88bc" class="ls lt ok lu b lv ml ju lx ly mm jx ma oo mn mc md op mo mf mg oq mp mi mj mk im bi translated">重要提示:上述命令中的<code class="fe mq mr ms mt b">service.py</code>和<code class="fe mq mr ms mt b">svc</code>变量根据您的脚本名和服务对象名而变化。如果在一个名为<code class="fe mq mr ms mt b">api.py</code>的脚本中有一个名为<code class="fe mq mr ms mt b">api</code>的服务对象，那么命令应该是<code class="fe mq mr ms mt b">bentoml serve api.py:api --reload</code>。标签确保BentoML无需重启服务器就能检测到对脚本的修改。</p></blockquote><p id="3a31" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">以下是该命令的输出示例:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="pb pc di pd bf pe"><div class="gh gi pa"><img src="../Images/6dcba5b98f9d797265d1b0f8ca64c66c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*H_T2RMrNTdbDN4m3-APcCA.gif"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="1831" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">GIF显示该API在本地运行于<a class="ae kv" href="http://127.0.0.1:3000:" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:3000: </a></p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="pb pc di pd bf pe"><div class="gh gi pf"><img src="../Images/dd1b7b688ab553590c9ad4f345552f61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*4RRYaAtEApuFVuY6wm8haQ.gif"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者GIF</p></figure><p id="d900" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">通过使用Swagger UI，BentoML向您展示了我们API的交互式文档。我们已经可以向它发送请求来获得预测:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="d28a" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">耶！我们的API起作用了——它将给定的样本分类为第一类。</p></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h2 id="e0f2" class="kw kx it bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">做便当</h2><p id="1f33" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma lf mb mc md lj me mf mg ln mh mi mj mk im bi translated">现在，我们将API打包成一个便当。</p><p id="945e" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">Bento是由BentoML引入的一个术语，指的是一个包含使我们的API工作所需的所有东西的档案——以一种统一的格式。在便当中，将会有关于构建Docker映像和我们的API模型的依赖关系的说明。</p><p id="1ad3" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">我们通过在与脚本相同的目录级别中创建一个<code class="fe mq mr ms mt b">bentofile.yaml</code>文件(名称应该相同)来开始构建便当。它将如下所示:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="24f5" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated"><code class="fe mq mr ms mt b">include</code>字段用于列出运行我们的便当所需的所有脚本。在我们的例子中，我们只是添加了所有的Python脚本。接下来是<code class="fe mq mr ms mt b">packages</code>字段，它应该列出依赖项及其版本。</p><p id="4407" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">在大型项目中，很难跟踪所有的依赖项及其版本，所以您可以使用<code class="fe mq mr ms mt b">pipreqs</code>库为您的项目创建一个<code class="fe mq mr ms mt b">requirements.txt</code>文件:</p><pre class="ki kj kk kl gt or mt os ot aw ou bi"><span id="42c9" class="kw kx it mt b gy ov ow l ox oy">$ pip install pipreqs<br/>$ pipreqs --force .  # --force overrides existing req file</span></pre><p id="3f4c" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">然后，您可以将依赖项复制到<code class="fe mq mr ms mt b">bentofile.yaml</code>。</p><p id="fbad" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">在您准备好<code class="fe mq mr ms mt b">bentofile.yaml</code>之后，我们调用<code class="fe mq mr ms mt b">build</code>命令并指定到<code class="fe mq mr ms mt b">bentofile.yaml</code>的路径，在我们的例子中是项目根(<code class="fe mq mr ms mt b">.</code>):</p><pre class="ki kj kk kl gt or mt os ot aw ou bi"><span id="2c3e" class="kw kx it mt b gy ov ow l ox oy">$ bentoml build .</span></pre><p id="57f9" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">如果成功，您将看到如下输出:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/705cc835c84ad00ebdf6ad557908eb66.png" data-original-src="https://miro.medium.com/v2/format:webp/1*IWf9Rsv1O5KD_TINbVkb6A.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="521e" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">您也可以在CLI中运行<code class="fe mq mr ms mt b">bentoml list</code>来检查便当:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="5ccf" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">如您所见，我的系统上有三个便当，其中两个属于当前项目。有现成的便当意味着我们可以在线部署它。</p><h2 id="ea6a" class="kw kx it bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">设置AWS凭据</h2><p id="914c" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma lf mb mc md lj me mf mg ln mh mi mj mk im bi translated">因为我们将API部署为AWS Lambda函数，所以我们必须设置我们的AWS凭证。最好的方法是通过CLI。</p><p id="e5b0" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">首先，转到您的<a class="ae kv" href="https://console.aws.amazon.com/console/home" rel="noopener ugc nofollow" target="_blank"> AWS IAM控制台</a>并找到您的凭证。通常可通过按钮“管理访问密钥按钮”获得:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/cfb8e0d33e91f2e0a4998113f7aebf58.png" data-original-src="https://miro.medium.com/v2/format:webp/1*4gzP9rpjIBKYXMiOa2oiwA.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="9446" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">点击它，你将到达这里:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/05b227ba07aa0b069651074dac09ebc0.png" data-original-src="https://miro.medium.com/v2/format:webp/1*tKtRFcZ575n4SlXxp7I4mA.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="eeec" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">创建一组新密钥或下载现有密钥。然后，转到您的终端并运行以下命令:</p><p id="e947" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">对于Linux或osX:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="2f4f" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">对于Windows:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="d12e" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">这将仅为当前虚拟环境设置您的AWS凭据。</p><h2 id="4d02" class="kw kx it bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">将便当部署到AWS Lambda</h2><p id="416b" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma lf mb mc md lj me mf mg ln mh mi mj mk im bi translated">为了部署我们的Bento，我们将使用BentoML的名为<code class="fe mq mr ms mt b">bentoctl</code>的本地CLI包。用<code class="fe mq mr ms mt b">boto3</code>包安装它(对于AWS依赖项)并安装<code class="fe mq mr ms mt b">aws-lambda</code>操作符。然后，调用<code class="fe mq mr ms mt b">bentoctl init</code>:</p><pre class="ki kj kk kl gt or mt os ot aw ou bi"><span id="d522" class="kw kx it mt b gy ov ow l ox oy">$ pip install bentoctl boto3<br/>$ bentoctl operator install aws-lambda<br/>$ bentoctl init</span></pre><p id="5151" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">该命令将询问您几个问题。您只需要为部署提供一个名称— <code class="fe mq mr ms mt b">xgb_classifier</code>。您可以将其余部分保留为默认值。</p><blockquote class="ol om on"><p id="f856" class="ls lt ok lu b lv ml ju lx ly mm jx ma oo mn mc md op mo mf mg oq mp mi mj mk im bi translated">部署说明取自<code class="fe mq mr ms mt b">bentoctl</code>文件上的<a class="ae kv" href="https://github.com/bentoml/aws-lambda-deploy" rel="noopener ugc nofollow" target="_blank">这里的</a>。</p></blockquote><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="pb pc di pd bf pe"><div class="gh gi pg"><img src="../Images/c2af62ce85e02bb2d37f6ca9fafdf3ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*8ZJHhIiSd_58HHdfLCP5-w.gif"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者GIF</p></figure><p id="8e47" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">将创建三个文件— <code class="fe mq mr ms mt b">deployment_config.yaml</code>、<code class="fe mq mr ms mt b">bentoctl.tfvars</code>和<code class="fe mq mr ms mt b">main.tf</code>。他们会喜欢下面的:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/fe59de2cf0841a99c64bf15f82e03266.png" data-original-src="https://miro.medium.com/v2/format:webp/1*owTc2gFT7D42xe502usIuQ.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="pb pc di pd bf pe"><div class="gh gi ph"><img src="../Images/741bc05065df0e0d742030339e1ca0b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*aYKdVs11VUiMTfe1Am0mXA.gif"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者GIF</p></figure><p id="ed45" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">现在，我们将安装另一个名为<code class="fe mq mr ms mt b">terraform</code>的工具。Terraform简化了直接从CLI创建和管理云资源。它将使用上述三个文件，主要是<code class="fe mq mr ms mt b">main.tf</code>文件，该文件列出了我们即将推出的AWS Lambda函数的所有细节。</p><p id="e298" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">你可以在<a class="ae kv" href="https://www.terraform.io/cli/install/apt" rel="noopener ugc nofollow" target="_blank">找到Terraform的安装说明，这里是Linux的</a>。对于其他系统，遵循此处的说明<a class="ae kv" href="https://learn.hashicorp.com/tutorials/terraform/install-cli" rel="noopener ugc nofollow" target="_blank">。要检查安装是否成功，请使用:</a></p><pre class="ki kj kk kl gt or mt os ot aw ou bi"><span id="1b3e" class="kw kx it mt b gy ov ow l ox oy">$ terraform -h</span></pre><p id="1882" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">如果它打印出命令列表，则安装成功。</p><p id="d425" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">之后，我们用<code class="fe mq mr ms mt b">bentoctl build</code>命令构建一个AWS Lambda兼容的Docker映像:</p><pre class="ki kj kk kl gt or mt os ot aw ou bi"><span id="759e" class="kw kx it mt b gy ov ow l ox oy">$ bentoctl build -b xgb_classifier:latest -f deployment_config.yaml</span></pre><p id="51c5" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">我们添加我们的便当的名称和版本，并通过<code class="fe mq mr ms mt b">deployment_config.yaml</code>文件指定构建规范。该过程应该如下所示:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="pb pc di pd bf pe"><div class="gh gi ph"><img src="../Images/ffd60a85e701a7903063557278414561.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*hcDYZgfIco_Xn3DI6BMyxg.gif"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者GIF</p></figure><blockquote class="ol om on"><p id="5b6e" class="ls lt ok lu b lv ml ju lx ly mm jx ma oo mn mc md op mo mf mg oq mp mi mj mk im bi translated">如果您收到<code class="fe mq mr ms mt b">botocore.exceptions.ClientError</code>，那么AWS凭证没有正确设置。再回到那一步。</p></blockquote><p id="95bd" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">如果映像构建成功，您应该会看到如下所示的输出:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/efd128ebb8d9438607a52c5fc06811e2.png" data-original-src="https://miro.medium.com/v2/format:webp/1*XNMQq8nfuRDBpxys6dEj4Q.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="4116" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">最后，我们使用Terraform将图像推送到AWS Lambda函数。使用以下命令:</p><pre class="ki kj kk kl gt or mt os ot aw ou bi"><span id="8ef3" class="kw kx it mt b gy ov ow l ox oy">$ terraform init<br/>$ terraform apply -var-file=bentoctl.tfvars -auto-approve</span></pre><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="pb pc di pd bf pe"><div class="gh gi ph"><img src="../Images/b0fed9fe9f5649df6f4d2cc68297fd84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ztq2jkoeiJWe3N6VmXPbCA.gif"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者GIF</p></figure><p id="1e66" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">最后，您将看到下面的消息，它显示了我们部署的Lambda API的URL:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/150c95fc2a8e78a8bb51c61042c51aaf.png" data-original-src="https://miro.medium.com/v2/format:webp/1*L_12LlblRD3BWPFAX7VA1A.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="25c6" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">显示UI需要一段时间，但完成后，当您单击链接时，将会看到API文档:</p><blockquote class="ol om on"><p id="3e5f" class="ls lt ok lu b lv ml ju lx ly mm jx ma oo mn mc md op mo mf mg oq mp mi mj mk im bi translated">第一次启动时，链接会显示一条内部服务器错误消息。忽略它。</p></blockquote><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/0f768a719c93661e05a04f02b8139d3e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Fx7euEV_evrPmRD7X6BblQ.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="e8f4" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">但是它将立即可用于发送请求和获得预测:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oi oj l"/></div></figure><h2 id="084d" class="kw kx it bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">结论</h2><p id="34ad" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma lf mb mc md lj me mf mg ln mh mi mj mk im bi translated">唷！考虑到我在开始时说过文章会很简单，这需要很多步骤。但是，由于我们手头有现成的ML解决方案，这一切都是值得的。</p><p id="0cf4" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">将模型部署为API是让用户与模型交互的最佳方式之一。以Dalle-E或GPT-3等著名服务为例。两者都是暴露在一个简单的API下的大规模模型，并放在一个网站内。使用本文中的技术，您可以创建相同的产品，尽管一开始它们可能不是十亿参数模型。</p><p id="c450" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">感谢您的阅读！</p><div class="mu mv gp gr mw mx"><a href="https://ibexorigin.medium.com/membership" rel="noopener follow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">通过我的推荐链接加入Medium。</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">获得独家访问我的所有⚡premium⚡内容和所有媒体没有限制。你可以给我买一个coffee☕，用你的…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">ibexorigin.medium.com</p></div></div><div class="ng l"><div class="oz l ni nj nk ng nl ko mx"/></div></div></a></div><div class="mu mv gp gr mw mx"><a href="https://ibexorigin.medium.com/subscribe" rel="noopener follow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">每当Bex T .发布时收到电子邮件。</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">每当Bex T .发布时收到电子邮件。注册后，如果您还没有中型帐户，您将创建一个…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">ibexorigin.medium.com</p></div></div><div class="ng l"><div class="pi l ni nj nk ng nl ko mx"/></div></div></a></div></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><p id="b42c" class="pw-post-body-paragraph ls lt it lu b lv ml ju lx ly mm jx ma lf mn mc md lj mo mf mg ln mp mi mj mk im bi translated">更多来自我的故事…</p><div class="mu mv gp gr mw mx"><a rel="noopener follow" target="_blank" href="/25-advanced-pandas-functions-people-are-using-without-telling-you-b65fa442f0f4"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">人们在不告诉你的情况下使用的25种先进的熊猫功能</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">ExcelWriter，因式分解，分解，挤压，T，遮罩，idxmax，剪辑，…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">towardsdatascience.com</p></div></div><div class="ng l"><div class="pj l ni nj nk ng nl ko mx"/></div></div></a></div><div class="mu mv gp gr mw mx"><a rel="noopener follow" target="_blank" href="/25-numpy-treasures-buried-in-the-docs-waiting-to-be-found-60d8e17931cd"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">埋藏在文件中等待被发现的25件宝贝</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">成为一名忍者</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">towardsdatascience.com</p></div></div><div class="ng l"><div class="pk l ni nj nk ng nl ko mx"/></div></div></a></div><div class="mu mv gp gr mw mx"><a rel="noopener follow" target="_blank" href="/advanced-tutorial-how-to-master-matplotlib-like-an-absolute-boss-aae2d4936734"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">进阶教程:如何像绝对Boss一样掌握Matplotlib</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">以前所未有的方式使用Matplotlib</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">towardsdatascience.com</p></div></div><div class="ng l"><div class="pl l ni nj nk ng nl ko mx"/></div></div></a></div><div class="mu mv gp gr mw mx"><a href="https://ibexorigin.medium.com/28-weekly-machine-learning-tricks-and-resources-that-are-pure-gems-1-8e5259a93c94" rel="noopener follow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">28个每周机器学习技巧和资源，它们是纯粹的珍宝#1</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">一次学习一个片段的机器学习</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">ibexorigin.medium.com</p></div></div><div class="ng l"><div class="pm l ni nj nk ng nl ko mx"/></div></div></a></div><div class="mu mv gp gr mw mx"><a rel="noopener follow" target="_blank" href="/the-easiest-way-to-deploy-your-ml-dl-models-in-2022-streamlit-bentoml-dagshub-ccf29c901dac"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">2022年部署你的机器学习模型最简单的方法:Streamlit + BentoML + DagsHub</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">将模型部署为具有用户友好界面的轻量级API</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">towardsdatascience.com</p></div></div><div class="ng l"><div class="pn l ni nj nk ng nl ko mx"/></div></div></a></div></div></div>    
</body>
</html>