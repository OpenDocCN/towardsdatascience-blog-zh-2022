<html>
<head>
<title>Pandasql — Interesting Way To Run SQL Queries In Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">panda sql——用 Python 运行 SQL 查询的有趣方式</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pandasql-interesting-way-to-run-sql-queries-in-python-18a4fc36406a#2022-03-07">https://towardsdatascience.com/pandasql-interesting-way-to-run-sql-queries-in-python-18a4fc36406a#2022-03-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="5359" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">熊猫</h2><div class=""/><div class=""><h2 id="0318" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用 Python Pandas 中的 SQL 查询对数据进行提取、分组、排序和连接数据集！！</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/e6b548b06d5a17582c2691b21e40e69f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OpLOKhAX76xUQNVI"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>由<a class="ae lh" href="https://unsplash.com/@freewalkingtoursalzburg?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">萨尔茨堡</a>自由行旅行团拍摄的照片</p></figure><p id="cfe1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> pandas </strong>是一款快速、强大、灵活且易于使用的开源数据分析和操作工具，构建于 Python 编程语言之上。</p><p id="4a72" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这就是为什么 Pandas 是 Python 的一个广泛使用的数据分析和操作库。🏆</p><p id="dd17" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">尽管如此，有时<strong class="lk jd"> SQL </strong>查询看起来非常简单易懂。另外，如果你学习 SQL，用 SQL 提取、操作和分析数据似乎非常容易。对于所有这样的用户(<em class="me">包括我</em>)，<strong class="lk jd"> pandasql </strong>绝对是一个惊艳的库。</p><p id="05fd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe mf mg mh mi b"><strong class="lk jd">pandasql</strong></code>允许您使用 SQL 语法查询 pandas 数据帧。这也不需要安装或连接任何 SQL server。💡</p><blockquote class="mj mk ml"><p id="f443" class="li lj me lk b ll lm kd ln lo lp kg lq mm ls lt lu mn lw lx ly mo ma mb mc md im bi translated">这可能是使用 Pandas 学习 SQL 的一个小小的动机和简单的开始。</p></blockquote><p id="e5d8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我在上一个项目中使用了<em class="me"> pandasql </em>，它简化了整个数据提取和分析的方式让我感到惊讶。它提供了一种更熟悉的操作和清理数据的方式。</p><p id="34c0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本文中，我用几个经典的例子解释了<em class="me"> pandasql </em>在数据分析中的真正潜力。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><p id="b7b2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要开始，我们需要做的就是用 Python 安装<code class="fe mf mg mh mi b">pandasql</code>库，</p><pre class="ks kt ku kv gt mw mi mx my aw mz bi"><span id="bc17" class="na nb it mi b gy nc nd l ne nf"><strong class="mi jd">pip install pandasql</strong></span></pre><p id="9b28" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一边用笔记本打字一边在线下的一个单元格中点击<code class="fe mf mg mh mi b">Shift</code> + <code class="fe mf mg mh mi b">Enter</code>。</p><pre class="ks kt ku kv gt mw mi mx my aw mz bi"><span id="5e2c" class="na nb it mi b gy nc nd l ne nf"><strong class="mi jd">!pip install pandasql</strong></span></pre><p id="54c3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe mf mg mh mi b">pandasql</code>中的主要功能是<code class="fe mf mg mh mi b"><strong class="lk jd">sqldf</strong></code> <strong class="lk jd"> </strong>。因此，可以使用，</p><pre class="ks kt ku kv gt mw mi mx my aw mz bi"><span id="9ec5" class="na nb it mi b gy nc nd l ne nf"><strong class="mi jd">from pandasql import sqldf</strong></span></pre><p id="6b2a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe mf mg mh mi b"><strong class="lk jd">sqldf </strong></code>有两个参数，其中一个是完全可选的(<em class="me">事实上我从未使用过</em>)。所以，重要且唯一的参数是一个<strong class="lk jd"> <em class="me"> SQL 查询字符串</em> </strong>。</p><p id="f11d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">sqldf 使用它的语法<code class="fe mf mg mh mi b"><strong class="lk jd">sqldf(sql_query)</strong></code>给出一个 pandas 数据帧作为输出。我们可以使用 SQL 查询任何 pandas 数据帧，就像我们使用 SQL 从任何表中提取数据一样。</p><p id="16bb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe mf mg mh mi b"><strong class="lk jd"><em class="me">pandasql</em></strong></code>使用<a class="ae lh" href="https://www.sqlite.org/lang.html" rel="noopener ugc nofollow" target="_blank"> SQLite 语法</a>！</p><p id="0f6f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">就是这样！！我们都准备好去探索了！🚀</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><p id="543e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了使文章有趣并易于理解，我想使用<code class="fe mf mg mh mi b">pandas.read_csv()</code>在 pandas DataFrame 中导入一个<a class="ae lh" href="https://github.com/17rsuraj/data-curious/blob/master/TowardsDataScience/Dummy_Sales_Data_v1.csv" rel="noopener ugc nofollow" target="_blank">虚拟销售数据</a>(自己创建的数据集)。</p><pre class="ks kt ku kv gt mw mi mx my aw mz bi"><span id="7d10" class="na nb it mi b gy nc nd l ne nf">import pandas as pd<br/>from pandasql import sqldf</span><span id="b810" class="na nb it mi b gy ng nd l ne nf">df = pd.read_csv("Dummy_Sales_Data_v1.csv", sep=",")<br/>df.head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nh"><img src="../Images/80fa47b3d5c6a39b6083f97c127e8350.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_0OwrzIThx6ulJetWV5Bsg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">虚拟销售数据|作者图片</p></figure><p id="442d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">它是一个 10000 x 12 的数据集，仅包含虚拟数据，可用于所有目的的数据分析。你可以免费下载并用来练习数据分析。</p><p id="ba6b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了便于访问数据，我将重命名这些列。</p><pre class="ks kt ku kv gt mw mi mx my aw mz bi"><span id="6e18" class="na nb it mi b gy nc nd l ne nf">df.rename(columns={"Shipping_Cost(USD)":"ShippingCost_USD",<br/>                   "UnitPrice(USD)":"UnitPrice_USD",<br/>                   "Delivery_Time(Days)":"Delivery_Time_Days"},<br/>          inplace=True)<br/>df.info()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/896cb09e89996f7a162045d8458397b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/format:webp/1*Yk88sQgC-IkLacJr2OVViA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">按作者更改列名|图像</p></figure><p id="b4bd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，让我们先从简单的事情开始。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="78a1" class="nj nb it bd nk nl nm nn no np nq nr ns ki nt kj nu kl nv km nw ko nx kp ny nz bi translated">数据析取</h1><p id="9892" class="pw-post-body-paragraph li lj it lk b ll oa kd ln lo ob kg lq lr oc lt lu lv od lx ly lz oe mb mc md im bi translated">从简单的例子开始，让我们从上面的数据框架<code class="fe mf mg mh mi b">df</code>中提取一些数据，并制作两个小表— <code class="fe mf mg mh mi b">df_orders</code>和<code class="fe mf mg mh mi b">df_products</code>。</p><p id="75f8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这可以是<code class="fe mf mg mh mi b">sqldf</code>最简单的例子。</p><p id="617c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此任务的 SQL 查询将是，</p><pre class="ks kt ku kv gt mw mi mx my aw mz bi"><span id="5b23" class="na nb it mi b gy nc nd l ne nf">SELECT OrderID, Quantity, Sales_Manager, Status, Shipping_Address, ShippingCost_USD FROM df</span></pre><p id="370c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要使它成为一个字符串，必须用<code class="fe mf mg mh mi b">“ ”</code>括起来。作为一个好的实践，我将把这个字符串赋给一个变量<code class="fe mf mg mh mi b"><em class="me">query</em></code>。</p><pre class="ks kt ku kv gt mw mi mx my aw mz bi"><span id="96ac" class="na nb it mi b gy nc nd l ne nf">query = "SELECT OrderID, Quantity, Sales_Manager, Status, Shipping_Address, ShippingCost_USD FROM df"</span></pre><p id="3f0b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，是时候使用<code class="fe mf mg mh mi b">sqldf</code>功能了！</p><pre class="ks kt ku kv gt mw mi mx my aw mz bi"><span id="a9ba" class="na nb it mi b gy nc nd l ne nf">df_orders = sqldf(query)<br/>df_orders.head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi of"><img src="../Images/a7dc1bcf3ce0e73f4a04312988fb7a2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*EgBqx7HGfMxwpsub1mojBA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者使用 sqldf | Image 提取的 df_orders</p></figure><p id="7c22" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">类似地，另一个数据帧<code class="fe mf mg mh mi b">df_products</code>也可以使用下面的<code class="fe mf mg mh mi b">sqldf</code>生成。</p><pre class="ks kt ku kv gt mw mi mx my aw mz bi"><span id="5ed1" class="na nb it mi b gy nc nd l ne nf">query = "SELECT OrderID,\<br/>        Quantity, \<br/>        Product_Code, \<br/>        Product_Category, \<br/>        UnitPrice_USD \<br/>        FROM df"<br/>df_products = sqldf(query)<br/>df_products.head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi og"><img src="../Images/8877c04f77d2eadea8283bab2e6b7143.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*BzdSkR_m-_qOHUs4A5jVsw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">df _ 产品使用 sqldf |图片作者</p></figure><p id="1dd4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">用一行代码编写一个 SQL 查询可能会很繁琐和令人困惑，尤其是当我们想要查询多个列时。</p><p id="3b56" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">由于我们将 SQL 查询作为一个<em class="me">字符串</em>传递给<code class="fe mf mg mh mi b">sqldf</code>，我们可以使用多行字符串，就像我在上面创建<code class="fe mf mg mh mi b">df_products</code>表时使用的一样。</p><blockquote class="oh"><p id="ade4" class="oi oj it bd ok ol om on oo op oq md dk translated">它使代码变得干净，易于编写、阅读和修改！</p></blockquote><p id="c8f0" class="pw-post-body-paragraph li lj it lk b ll or kd ln lo os kg lq lr ot lt lu lv ou lx ly lz ov mb mc md im bi translated">这里是 Python 中关于<strong class="lk jd"> <em class="me">的一行程序</em> </strong>的趋势之一。</p><div class="ow ox gp gr oy oz"><a rel="noopener follow" target="_blank" href="/5-most-powerful-one-liners-you-should-know-in-python-programming-c9d49a89b7f3"><div class="pa ab fo"><div class="pb ab pc cl cj pd"><h2 class="bd jd gy z fp pe fr fs pf fu fw jc bi translated">Python 编程中您应该知道的 5 个最强大的一行程序</h2><div class="pg l"><h3 class="bd b gy z fp pe fr fs pf fu fw dk translated">一行程序保持你的代码干净、清晰、简短和易于理解。</h3></div><div class="ph l"><p class="bd b dl z fp pe fr fs pf fu fw dk translated">towardsdatascience.com</p></div></div><div class="pi l"><div class="pj l pk pl pm pi pn lb oz"/></div></div></a></div><p id="f4bd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，<code class="fe mf mg mh mi b">sqldf</code>也可以用于有条件地提取或选择数据。</p><h1 id="0564" class="nj nb it bd nk nl po nn no np pp nr ns ki pq kj nu kl pr km nw ko ps kp ny nz bi translated">基于条件选择数据</h1><p id="f836" class="pw-post-body-paragraph li lj it lk b ll oa kd ln lo ob kg lq lr oc lt lu lv od lx ly lz oe mb mc md im bi translated">可以根据一列或多列上的条件提取数据。在<code class="fe mf mg mh mi b">sqldf</code>中，这可以通过使用 WHERE 语句来实现。</p><p id="949e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，从<code class="fe mf mg mh mi b"><em class="me">df_orders</em></code>中选择所有订单，其中<em class="me">发货地址</em>为<em class="me">肯尼亚</em>。</p><p id="7f04" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们首先编写如下的 SQL 查询，</p><pre class="ks kt ku kv gt mw mi mx my aw mz bi"><span id="707c" class="na nb it mi b gy nc nd l ne nf">SELECT * FROM df_orders WHERE Shipping_Address = 'Kenya'</span></pre><p id="b861" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">将其转换为字符串并传递给<code class="fe mf mg mh mi b">sqldf</code>函数，我们可以提取所需的数据，如下所示。</p><pre class="ks kt ku kv gt mw mi mx my aw mz bi"><span id="c1c3" class="na nb it mi b gy nc nd l ne nf">query = "SELECT * \<br/>        FROM df_orders \<br/>        WHERE Shipping_Address = 'Kenya'"<br/>df_kenya = sqldf(query)<br/>df_kenya.head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pt"><img src="../Images/6c988484b51060b1bf74ed834873a1ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*ouJT0_TyEWQDpN8teQMyfw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">在 SQL | Image by Author 中使用 WHERE 语句</p></figure><p id="140f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让事情变得复杂一点，让我们试着把所有发货到<em class="me">的订单，</em>的<em class="me">数量</em>少于<em class="me"> 40 </em>并且<em class="me">状态</em>为已发货或已交付。</p><pre class="ks kt ku kv gt mw mi mx my aw mz bi"><span id="b288" class="na nb it mi b gy nc nd l ne nf">query = "SELECT * \<br/>        FROM df_orders \<br/>        WHERE Shipping_Address = 'Kenya' \<br/>        AND Quantity &lt; 40 \<br/>        AND Status IN ('Shipped', 'Delivered')"</span></pre><p id="46a4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们将这个查询字符串传递给<code class="fe mf mg mh mi b">sqldf</code>以获得输出。</p><pre class="ks kt ku kv gt mw mi mx my aw mz bi"><span id="3f2c" class="na nb it mi b gy nc nd l ne nf">df_kenya = sqldf(query)<br/>df_kenya.head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pu"><img src="../Images/e9d7cb75a6d59be7ac9507b505ed8d31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*X51h0f7ggdMZIkb9ZR4eWw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">在 WHERE 语句|作者图片中使用 AND 关键字</p></figure><p id="054d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这表明，我们可以在<code class="fe mf mg mh mi b">sqldf </code>中使用来自 SQL 的所有关键字，例如<code class="fe mf mg mh mi b">Status IN (‘Shipped’, ‘Delivered’)</code>和在 WHERE 语句中使用<code class="fe mf mg mh mi b">AND</code>关键字。</p><p id="137b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">故事并没有到此结束！我们还可以将数据分成不同的组，并执行计算以供进一步分析。</p><h1 id="b5b6" class="nj nb it bd nk nl po nn no np pp nr ns ki pq kj nu kl pr km nw ko ps kp ny nz bi translated">分组依据</h1><p id="2854" class="pw-post-body-paragraph li lj it lk b ll oa kd ln lo ob kg lq lr oc lt lu lv od lx ly lz oe mb mc md im bi translated">在 Python 中，pandas <code class="fe mf mg mh mi b">groupby</code>用于将数据分类，并有效地聚合数据。在 SQL 中，类似的功能由<code class="fe mf mg mh mi b">GROUP BY</code>语句提供。</p><p id="b8e9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe mf mg mh mi b">GROUP BY</code>语句或 pandas <code class="fe mf mg mh mi b">groupby</code>函数通常与<code class="fe mf mg mh mi b">COUNT()</code>、<code class="fe mf mg mh mi b">MAX()</code>、<code class="fe mf mg mh mi b">MIN()</code>、<code class="fe mf mg mh mi b">SUM()</code>、<code class="fe mf mg mh mi b">AVG()</code>等聚合函数一起使用，按一列或多列对结果集进行分组</p><blockquote class="mj mk ml"><p id="1430" class="li lj me lk b ll lm kd ln lo lp kg lq mm ls lt lu mn lw lx ly mo ma mb mc md im bi translated">pandasql 使我们能够使用 sql 查询在 Pandas 数据帧上应用<code class="fe mf mg mh mi b">groupby</code>功能。<em class="it">🏆</em></p></blockquote><p id="4846" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，让我们看看有多少订单被发送到每个送货地址。从逻辑上讲，这是通过按不同的送货地址对数据进行分组，然后计算订单数量来实现的。</p><p id="8ef2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，SQL 查询是，</p><pre class="ks kt ku kv gt mw mi mx my aw mz bi"><span id="26f5" class="na nb it mi b gy nc nd l ne nf">SELECT Shipping_Address, COUNT(OrderID) AS Orders FROM df_orders GROUP BY Shipping_Address</span></pre><p id="957f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">将该查询转换成字符串并传递给<code class="fe mf mg mh mi b">sqldf </code>函数，我们将得到如下预期结果:</p><pre class="ks kt ku kv gt mw mi mx my aw mz bi"><span id="0be5" class="na nb it mi b gy nc nd l ne nf">query = "SELECT Shipping_Address, \<br/>        COUNT(OrderID) AS Orders \<br/>        FROM df_orders \<br/>        GROUP BY Shipping_Address"</span><span id="fab2" class="na nb it mi b gy ng nd l ne nf">df_group = sqldf(query)<br/>df_group.head(10)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pv"><img src="../Images/38241e54db4ce06d8384ffab7bb91c4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:484/format:webp/1*DLAUHIs34h1KBPh8TZWrRw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">熊猫分组使用 sqldf |图片作者</p></figure><p id="054e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，这个输出与熊猫组的输出略有不同。</p><blockquote class="mj mk ml"><p id="36fa" class="li lj me lk b ll lm kd ln lo lp kg lq mm ls lt lu mn lw lx ly mo ma mb mc md im bi translated"><code class="fe mf mg mh mi b">sqldf</code>给出熊猫数据帧作为输出<em class="it">🏆</em>而熊猫<code class="fe mf mg mh mi b">groupby</code>返回<em class="it">数据帧对象</em>作为输出。</p></blockquote><p id="a09f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果是 pandas groupby，<code class="fe mf mg mh mi b"><em class="me">Shipping_Address</em></code>列将是索引列，pandas <code class="fe mf mg mh mi b">groupby</code>的输出也不会是数据帧。因此，为了进一步使用分组和聚合的数据，我们需要将<code class="fe mf mg mh mi b">groupby</code>对象转换为 pandas DataFrame 并重置其索引。</p><p id="d34d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面是获得相同输出的 pandas <code class="fe mf mg mh mi b">groupby</code>代码。</p><pre class="ks kt ku kv gt mw mi mx my aw mz bi"><span id="dec4" class="na nb it mi b gy nc nd l ne nf">df_grouped = df_orders.groupby("Shipping_Address")<br/>df_grouped = df_grouped["OrderID"].count()<br/>df_grouped = pd.DataFrame(df_grouped)<br/>df_grouped.reset_index(inplace=True)<br/>df_grouped.rename(columns={"OrderID":"Orders"}, inplace=True)</span></pre><p id="51dd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">显然，<em class="me"> pandasql </em>简化了数据分组及其聚合。</p><p id="113c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此外，可以使用 SQL <code class="fe mf mg mh mi b"><strong class="lk jd">ORDER BY</strong></code>语句基于一列或多列对数据进行升序或降序排序。</p><p id="cfa3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们继续使用相同的数据分组示例，并根据订单数量对送货地址进行排序。</p><pre class="ks kt ku kv gt mw mi mx my aw mz bi"><span id="0b00" class="na nb it mi b gy nc nd l ne nf">query = "SELECT Shipping_Address, \<br/>        COUNT(OrderID) AS Orders \<br/>        FROM df_orders \<br/>        GROUP BY Shipping_Address \<br/>        ORDER BY Orders"</span><span id="aa8b" class="na nb it mi b gy ng nd l ne nf">df_group = sqldf(query)<br/>df_group</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pw"><img src="../Images/b3b402053695cf1113f71a0c62306c13.png" data-original-src="https://miro.medium.com/v2/resize:fit:486/format:webp/1*BMkDCg1whkoyc3dG90I0Yw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">使用 sqldf |图片按作者排序熊猫数据帧</p></figure><p id="b3be" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">简单地说，只需在现有查询的末尾添加 3 个单词，我们就可以快速地按升序排列结果。</p><p id="c8a6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里有一篇关于熊猫<code class="fe mf mg mh mi b">groupby</code>的精彩文章。</p><div class="ow ox gp gr oy oz"><a rel="noopener follow" target="_blank" href="/4-awesome-pandas-methods-to-quickly-analyze-any-dataset-65d2252af6e8"><div class="pa ab fo"><div class="pb ab pc cl cj pd"><h2 class="bd jd gy z fp pe fr fs pf fu fw jc bi translated">快速分析任何数据集的 4 种令人惊叹的熊猫方法</h2><div class="pg l"><h3 class="bd b gy z fp pe fr fs pf fu fw dk translated">..了解如何惊人地加速探索性数据分析(EDA)！</h3></div><div class="ph l"><p class="bd b dl z fp pe fr fs pf fu fw dk translated">towardsdatascience.com</p></div></div><div class="pi l"><div class="px l pk pl pm pi pn lb oz"/></div></div></a></div><p id="8e25" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你认为这些都是很简单的查询，那么<code class="fe mf mg mh mi b">sqldf</code>会给你一个惊喜。</p><blockquote class="mj mk ml"><p id="ba5b" class="li lj me lk b ll lm kd ln lo lp kg lq mm ls lt lu mn lw lx ly mo ma mb mc md im bi translated"><code class="fe mf mg mh mi b">sqldf</code>可以执行高级 SQL 查询，如连接。<em class="it">🏆</em></p></blockquote><p id="ac08" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">SQL 中的 JOINs 或 pandas 中的 merge 是用于根据两个或多个数据集之间的相关列来组合它们的工具。</p><p id="5f3e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">到目前为止，在我的项目中，我使用了所有类型的使用<code class="fe mf mg mh mi b">sqldf</code>的 SQL 连接，看起来超级方便。</p><p id="2dab" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们看看如何！</p><h1 id="1cbd" class="nj nb it bd nk nl po nn no np pp nr ns ki pq kj nu kl pr km nw ko ps kp ny nz bi translated">合并数据集</h1><p id="2502" class="pw-post-body-paragraph li lj it lk b ll oa kd ln lo ob kg lq lr oc lt lu lv od lx ly lz oe mb mc md im bi translated">如果我们使用 pandas，有两个函数来组合数据集— <code class="fe mf mg mh mi b">merge</code>和<code class="fe mf mg mh mi b">concat</code>。并且有时会弄不清何时使用哪一个。</p><p id="d278" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">SQL 通过使用<code class="fe mf mg mh mi b">JOIN</code>语句简化了事情。并且<code class="fe mf mg mh mi b">sqldf</code>也可以处理<code class="fe mf mg mh mi b">JOIN</code>语句。</p><p id="a2a9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，让我们将所有订单、送货地址和产品类别放在一起。为此，我们将使用本文开头创建的<code class="fe mf mg mh mi b">df_orders</code>和<code class="fe mf mg mh mi b">df_products</code>。</p><pre class="ks kt ku kv gt mw mi mx my aw mz bi"><span id="6eef" class="na nb it mi b gy nc nd l ne nf">query = "SELECT T1.OrderID, \<br/>        T1.Shipping_Address, \<br/>        T2.Product_Category \<br/>        FROM df_orders T1\<br/>        INNER JOIN df_products T2\<br/>        ON T1.OrderID = T2.OrderID"</span><span id="4873" class="na nb it mi b gy ng nd l ne nf">df_combined = sqldf(query)<br/>df_combined.head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi py"><img src="../Images/03e5fc8bb8302b214d9fa11c55746b21.png" data-original-src="https://miro.medium.com/v2/resize:fit:966/format:webp/1*zpFIk6XsSu2JlypbRnyxnw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">使用 sqldf | Image by Author 的内部联接</p></figure><p id="1c0b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这样，<code class="fe mf mg mh mi b"> df_orders</code>和<code class="fe mf mg mh mi b">df_products</code>都连接在<em class="me"> OrderID </em>列上。由于是一个<code class="fe mf mg mh mi b">INNER JOIN</code>，<em class="me"> OrderID </em> s，两个数据帧中都存在的将被返回。</p><p id="c75e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">同样，<code class="fe mf mg mh mi b">sqldf</code>也可以执行<em class="me">左</em>和<em class="me">右</em>和<code class="fe mf mg mh mi b">JOIN</code> s。</p><p id="b3db" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">以下是理解如何在 Python pandas 中组合数据集的推荐读物。</p><div class="ow ox gp gr oy oz"><a rel="noopener follow" target="_blank" href="/join-the-tables-ab7fd4fac26b"><div class="pa ab fo"><div class="pb ab pc cl cj pd"><h2 class="bd jd gy z fp pe fr fs pf fu fw jc bi translated">加入表格</h2><div class="pg l"><h3 class="bd b gy z fp pe fr fs pf fu fw dk translated">了解 Python pandas 中的 merge()和 concat()</h3></div><div class="ph l"><p class="bd b dl z fp pe fr fs pf fu fw dk translated">towardsdatascience.com</p></div></div><div class="pi l"><div class="pz l pk pl pm pi pn lb oz"/></div></div></a></div></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><p id="9446" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">总结一下，</p><p id="c612" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我个人经常使用<code class="fe mf mg mh mi b">sqldf</code>,因为它保持代码干净、简单、易于理解和修改。因此，我展示了我们可以用它做什么。</p><p id="cda8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是关于<code class="fe mf mg mh mi b">pandasql</code>最全面的指南之一，这里是一个完整的<a class="ae lh" href="https://github.com/17rsuraj/data-curious/blob/998616e5c2196597c24224f5e44c0bff1e5f65cc/TowardsDataScience/Examples_of_pandasql.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd">笔记本</strong> </a> <strong class="lk jd"> </strong>以及所有代码。如果我错过了什么，请在评论中告诉我。</p><p id="1d1d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在你可以通过<a class="ae lh" href="https://medium.com/@17.rsuraj/membership" rel="noopener"> <strong class="lk jd"> <em class="me">在这里报名成为中会员</em> </strong> </a>阅读我&amp;其他作家发表的所有故事。当你这样做，我会得到你的费用的一小部分。欢迎加入我的<a class="ae lh" href="https://medium.com/subscribe/@17.rsuraj" rel="noopener"> <strong class="lk jd"> <em class="me">电子邮件列表</em> </strong> </a>也可以随时更新我的写作。</p><p id="7cf0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">🚩不要忘记将您的 SQL 查询放在<code class="fe mf mg mh mi b">“ ”</code>中，以便在将其传递给<code class="fe mf mg mh mi b">sqldf</code>之前将其转换为字符串。</p><p id="5824" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">🚩在一行中编写代码时，你应该记住<a class="ae lh" href="https://www.python.org/dev/peps/pep-0008/#maximum-line-length" rel="noopener ugc nofollow" target="_blank"><strong class="lk jd"><em class="me">PEP-8</em></strong></a>关于一行中最大字符数的准则，即 79 个字符。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h2 id="ac15" class="na nb it bd nk qa qb dn no qc qd dp ns lr qe qf nu lv qg qh nw lz qi qj ny iz bi translated">感谢您的阅读！！</h2></div></div>    
</body>
</html>