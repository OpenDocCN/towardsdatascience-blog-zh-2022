<html>
<head>
<title>Time Series Decomposition</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列分解</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-decomposition-8f39432f78f9#2022-10-31">https://towardsdatascience.com/time-series-decomposition-8f39432f78f9#2022-10-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="533a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将时间序列分解成基本的构建块</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/16c662816f557c4871fdf5ec2daa0b06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2uUzAQG__CQN9Ohw"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">奥斯曼·拉纳在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="48ba" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="95a9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">当试图获得洞察力并找到产生未来预测的最佳模型时，理解你的<a class="ae ky" href="https://en.wikipedia.org/wiki/Time_series" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">时间序列</strong> </a>是最基本的。大多数时间序列可以被分解成不同的<a class="ae ky" href="https://en.wikipedia.org/wiki/Decomposition_of_time_series" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">成分</strong> </a> <strong class="lt iu"> </strong>来帮助以结构化的方式对其进行诊断，提供了一个强大的分析工具。</p><p id="1ee6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这篇文章中，我想讨论这些不同的组件是什么，如何获得它们，以及我们如何使用Python进行时间序列分解。</p><h1 id="3e85" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">时间序列组件</h1><p id="bc83" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">时间序列是(主要)三个部分的组合:<em class="ms">趋势</em>、<em class="ms">季节性</em>和<em class="ms">残差/余数</em>。让我们逐一分析。</p><p id="b33d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><a class="ae ky" href="https://en.wikipedia.org/wiki/Linear_trend_estimation" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">趋势</strong> </a> <strong class="lt iu"> : </strong>这是系列的整体运动。它可能持续增加加班时间、减少加班时间或两者兼而有之。</p><p id="b60d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><a class="ae ky" href="https://en.wikipedia.org/wiki/Seasonality" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">季节性</strong> </a> <strong class="lt iu"> : </strong>序列中任何有规律的季节性模式。例如，冰淇淋的销量在夏季通常高于冬季。要了解更多关于季节性的知识，请查看我的上一篇文章:</p><div class="mt mu gp gr mv mw"><a rel="noopener follow" target="_blank" href="/seasonality-of-time-series-5b45b4809acd"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd iu gy z fp nb fr fs nc fu fw is bi translated">时间序列的季节性</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">对季节性如何影响时间序列分析的直觉</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">towardsdatascience.com</p></div></div><div class="nf l"><div class="ng l nh ni nj nf nk ks mw"/></div></div></a></div><p id="ed7e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><a class="ae ky" href="https://otexts.com/fpp3/residuals.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">残差/余数</strong> </a> <strong class="lt iu"> : </strong>这是我们考虑了趋势和季节性之后剩下的那一点。也可以认为只是<a class="ae ky" href="https://www.statisticshowto.com/statistical-noise/" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">统计噪声</strong> </a>。</p><blockquote class="nl nm nn"><p id="49e2" class="lr ls ms lt b lu mn ju lw lx mo jx lz no mp mc md np mq mg mh nq mr mk ml mm im bi translated">有时也有一个单独的<a class="ae ky" href="https://otexts.com/fpp2/tspatterns.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">周期</strong> </a>成分，但它经常被归入趋势成分。</p></blockquote><h1 id="603f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">加法与乘法模型</h1><p id="c83a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这些组件的组合方式取决于您的系列的性质。对于一个<a class="ae ky" href="https://en.wikipedia.org/wiki/Additive_model" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> <em class="ms">加法</em> </strong> </a>模型我们有:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/fa40164a6413c280177fc7fb31788c6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:390/format:webp/1*uNK0W4XvoPmO4A8c-UQ0Gg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者用LaTeX写的方程式。</p></figure><p id="e00f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">而对于一个<strong class="lt iu"> <em class="ms">乘性</em> </strong>系列:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/2c4f8d7d70dfe02ad962482f1e6da6d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:390/format:webp/1*Kp8ptF7_VDYye3Z91OuAeA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者用LaTeX写的方程式。</p></figure><p id="7d53" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">其中<strong class="lt iu"> <em class="ms"> Y </em> </strong>为数列，<strong class="lt iu"> <em class="ms"> T </em> </strong>为趋势，<strong class="lt iu"> <em class="ms"> S </em> </strong>为季节性，<strong class="lt iu"> <em class="ms"> R </em> </strong>为残差分量。</p><p id="df25" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当序列变化的大小在一致的绝对数值范围内时，加法模型是最合适的。另一方面，乘法模型是当系列的波动是在一个相对的和成比例的规模。</p><p id="d15d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">例如，如果每年夏天的冰淇淋销售额高出1000，那么该模型就是可加性的。如果每年夏天销售额持续增长20%,但是绝对销售额在变化，那么这个模型就是乘法模型。我们将在后面讨论一个例子，这个例子将使这个理论更加具体。</p><p id="526c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">可以通过简单的对数变换或<a class="ae ky" href="https://en.wikipedia.org/wiki/Power_transform" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> Box-Cox变换</strong> </a>将乘法模型转换为加法模型:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/926283e20488818b7d4f0710394474d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*VX4Ar15I6Uh8lpALbqczBg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者用LaTeX写的方程式。</p></figure><p id="04de" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要了解关于Box-Cox变换的更多信息，您可以阅读我以前的一篇文章:</p><div class="mt mu gp gr mv mw"><a rel="noopener follow" target="_blank" href="/box-cox-transform-for-time-series-cc45f26082c6"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd iu gy z fp nb fr fs nc fu fw is bi translated">时间序列的Box-Cox变换</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">如何使用Box-Cox变换创建平稳时间序列？</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">towardsdatascience.com</p></div></div><div class="nf l"><div class="nt l nh ni nj nf nk ks mw"/></div></div></a></div><h1 id="67e9" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">分解是怎么做的？</h1><p id="eac5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">有多种算法和方法可以将时间序列分解为三个部分。我想回顾一下经典的<a class="ae ky" href="https://www.openforecast.org/adam/classical-seasonal-decomposition.html" rel="noopener ugc nofollow" target="_blank"><strong class="lt iu"/></a>方法，因为这种方法经常使用并且非常直观。</p><ul class=""><li id="5662" class="nu nv it lt b lu mn lx mo ma nw me nx mi ny mm nz oa ob oc bi translated">使用<a class="ae ky" href="https://www.investopedia.com/terms/m/movingaverage.asp" rel="noopener ugc nofollow" target="_blank">移动/滚动平均值</a>计算趋势分量<strong class="lt iu">、<em class="ms"> T、</em>、</strong>。</li><li id="0e6c" class="nu nv it lt b lu od lx oe ma of me og mi oh mm nz oa ob oc bi translated">去趋势系列，<strong class="lt iu"> <em class="ms"> Y-T </em> </strong>为加法模型，<strong class="lt iu"> <em class="ms"> Y/T </em> </strong>为乘法模型。</li><li id="d7bf" class="nu nv it lt b lu od lx oe ma of me og mi oh mm nz oa ob oc bi translated">计算季节性成分<strong class="lt iu"> <em class="ms"> S </em> </strong>，取每个季节去趋势序列的平均值。</li><li id="35cf" class="nu nv it lt b lu od lx oe ma of me og mi oh mm nz oa ob oc bi translated">剩余分量<strong class="lt iu"> <em class="ms"> R </em> </strong>计算如下:<strong class="lt iu"> <em class="ms"> R = Y-T-R </em> </strong>对于加法模型，<strong class="lt iu"> <em class="ms"> R = Y/(TR) </em> </strong>对于乘法模型。</li></ul><p id="5c0a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">还有其他几种分解方法，如<a class="ae ky" rel="noopener" target="_blank" href="/stl-decomposition-how-to-do-it-from-scratch-b686711986ec"> <strong class="lt iu"> STL </strong> </a>，<a class="ae ky" href="https://otexts.com/fpp3/x11.html" rel="noopener ugc nofollow" target="_blank"><strong class="lt iu">X11</strong></a><strong class="lt iu"/>和<a class="ae ky" href="https://otexts.com/fpp3/seats.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">席位</strong> </a>。这些都是先进的方法，补充了传统方法的基本方法，并改进了其缺点。</p><h1 id="d7ca" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">Python中的分解</h1><p id="d187" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们再次回顾一下1948年至1961年间美国航空公司的经典客运量数据:</p><blockquote class="nl nm nn"><p id="a994" class="lr ls ms lt b lu mn ju lw lx mo jx lz no mp mc md np mq mg mh nq mr mk ml mm im bi translated">数据<a class="ae ky" href="https://www.kaggle.com/datasets/ashfakyeafi/air-passenger-data-for-time-series-analysis" rel="noopener ugc nofollow" target="_blank">来自拥有CC0许可证的Kaggle </a>。</p></blockquote><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者代码要点。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/3af53709f3c5cce46b20cce879d99ab0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*Vr3KcsZVqZcVUVGpZBUb8g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者用Python制作的情节。</p></figure><p id="e0f5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">从该图中，我们观察到一个增长趋势和一个年度季节性。请注意，波动的大小随着时间的推移而增加，因此我们有一个乘法模型。</p><p id="94d7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们可以使用statsmodels函数<a class="ae ky" href="https://www.statsmodels.org/dev/generated/statsmodels.tsa.seasonal.seasonal_decompose.html" rel="noopener ugc nofollow" target="_blank"><em class="ms">seasonal _ decompose</em></a><strong class="lt iu"><em class="ms"/></strong>分解时间序列，并在调用该函数时指定我们有一个“乘法”模型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者代码要点。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/5c300a1ee07a30e97eb3474f5695d57f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ea868Em7v9G0RdsjDkeKtA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者用Python制作的情节。</p></figure><p id="8c21" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">从上面的图中我们可以看到，该函数确实成功地捕获了三个组件。</p><p id="2a26" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们可以通过应用<a class="ae ky" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.boxcox.html" rel="noopener ugc nofollow" target="_blank"> <em class="ms"> boxcox </em> </a> Scipy函数，使用Box-Cox变换来稳定方差，从而将我们的序列转换为加法模型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者代码要点。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/c1834ec03c556e82d69acb35f5207137.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1fEfhfVPBhlMUlVLdUS4JA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者用Python制作的情节。</p></figure><p id="8ad1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">同样，该函数似乎很好地捕捉到了这三个组件。有趣的是，我们看到残差在早些年和晚些年有更高的波动性。在为此系列构建预测模型时，这可能是需要考虑的因素。</p><h1 id="c4ad" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="1bbb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这篇文章中，我们展示了如何将一个时间序列分解成三个基本部分:趋势、季节性和残差。这三个部分的组合产生了你观察到的时间序列，根据它的性质，它可以是加法的，也可以是乘法的。有几种技术来进行分解，如STL，海豹突击队和X11，但是我更喜欢经典的方法，因为它非常直观。能够分解时间序列有助于加深对数据的理解，从而更容易做出未来预测。</p><p id="c819" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这篇文章中使用的完整代码可以在我的GitHub中找到:</p><div class="mt mu gp gr mv mw"><a href="https://github.com/egorhowell/Medium-Articles/blob/main/Time%20Series/Time%20Series%20Tools/decomposition.py" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd iu gy z fp nb fr fs nc fu fw is bi translated">Medium-Articles/decomposition . py at main egorhowell/Medium-Articles</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">github.com</p></div></div><div class="nf l"><div class="on l nh ni nj nf nk ks mw"/></div></div></a></div><h1 id="f655" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">参考资料和进一步阅读</h1><ul class=""><li id="b761" class="nu nv it lt b lu lv lx ly ma oo me op mi oq mm nz oa ob oc bi translated"><em class="ms">预测:原理与实践:</em>【https://otexts.com/fpp2/ T2】</li></ul><h1 id="acc7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">和我联系！</h1><ul class=""><li id="ca40" class="nu nv it lt b lu lv lx ly ma oo me op mi oq mm nz oa ob oc bi translated"><a class="ae ky" href="/@egorhowell/membership" rel="noopener ugc nofollow" target="_blank"> <em class="ms">要想在媒体上阅读无限的故事，请务必在这里注册！</em> </a> <em class="ms"> </em>💜</li><li id="9786" class="nu nv it lt b lu od lx oe ma of me og mi oh mm nz oa ob oc bi translated"><a class="ae ky" href="/subscribe/@egorhowell" rel="noopener ugc nofollow" target="_blank"> <em class="ms">在我发布注册邮件通知时获得更新！</em>T13<em class="ms">T15】😀</em></a></li><li id="b8dc" class="nu nv it lt b lu od lx oe ma of me og mi oh mm nz oa ob oc bi translated"><a class="ae ky" href="https://www.linkedin.com/in/egor-howell-092a721b3/" rel="noopener ugc nofollow" target="_blank"> <em class="ms">领英</em> </a> <em class="ms"> </em>👔</li><li id="a7a0" class="nu nv it lt b lu od lx oe ma of me og mi oh mm nz oa ob oc bi translated"><a class="ae ky" href="https://twitter.com/EgorHowell" rel="noopener ugc nofollow" target="_blank"> <em class="ms">碎碎念</em> </a> <em class="ms"> </em> 🖊</li><li id="fb18" class="nu nv it lt b lu od lx oe ma of me og mi oh mm nz oa ob oc bi translated"><a class="ae ky" href="https://github.com/egorhowell" rel="noopener ugc nofollow" target="_blank"><em class="ms">github</em></a><em class="ms"/>🖥</li><li id="87b0" class="nu nv it lt b lu od lx oe ma of me og mi oh mm nz oa ob oc bi translated"><a class="ae ky" href="https://www.kaggle.com/egorphysics" rel="noopener ugc nofollow" target="_blank"><em class="ms"/></a><em class="ms"/>🏅</li></ul><blockquote class="nl nm nn"><p id="72f1" class="lr ls ms lt b lu mn ju lw lx mo jx lz no mp mc md np mq mg mh nq mr mk ml mm im bi translated">(所有表情符号由<a class="ae ky" href="https://openmoji.org/" rel="noopener ugc nofollow" target="_blank"> OpenMoji </a>设计——开源表情符号和图标项目。许可证:<a class="ae ky" href="https://creativecommons.org/licenses/by-sa/4.0/#" rel="noopener ugc nofollow" target="_blank"> CC BY-SA 4.0 </a></p></blockquote></div></div>    
</body>
</html>