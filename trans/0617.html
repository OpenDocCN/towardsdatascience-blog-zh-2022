<html>
<head>
<title>Recognize Volleyball Game Stages with Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用机器学习识别排球比赛阶段</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/recognize-volleyball-game-stages-with-machine-learning-f7af06c414b2#2022-02-24">https://towardsdatascience.com/recognize-volleyball-game-stages-with-machine-learning-f7af06c414b2#2022-02-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b255" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用人物探测器对玩家位置进行分类</h2></div><h2 id="4b24" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">排球比赛阶段</h2><p id="469a" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">用人工智能分析排球比赛有多种方法。我曾经<a class="ae lu" rel="noopener" target="_blank" href="/ball-tracking-in-volleyball-with-opencv-and-tensorflow-3d6e857bd2e7">跟踪球</a>是为了把游戏时间从整个视频中分离出来。</p><p id="486f" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">另一种方法是确定游戏阶段，并根据阶段流程做出决策。</p><p id="7ffa" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">让我们假设排球比赛包括 4 个阶段:</p><ul class=""><li id="124e" class="ma mb iq ld b le lv lh lw ko mc ks md kw me lt mf mg mh mi bi translated">没有游戏。没有人或几个人在院子里闲逛。</li><li id="e6fc" class="ma mb iq ld b le mj lh mk ko ml ks mm kw mn lt mf mg mh mi bi translated">静止位置。上菜前人们都是站着不动的。</li><li id="a757" class="ma mb iq ld b le mj lh mk ko ml ks mm kw mn lt mf mg mh mi bi translated">游戏。</li><li id="71ea" class="ma mb iq ld b le mj lh mk ko ml ks mm kw mn lt mf mg mh mi bi translated">欢呼。即使拉力赛输了，聚在一起互相加油也是很常见的。</li></ul><p id="fc71" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">所有这些阶段都因人们相对于法庭的位置和彼此的位置而不同。这意味着我们首先要做的是找到照片中的人。</p><h2 id="4813" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">人物检测</h2><p id="d4b2" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">我在以前的文章中对<a class="ae lu" rel="noopener" target="_blank" href="/picking-fast-people-detector-working-with-opencv-on-cpu-in-2021-ff8d752088af">的最佳探测器做了一些研究，因此我将使用</a><a class="ae lu" href="https://www.tensorflow.org/lite/examples/object_detection/overview" rel="noopener ugc nofollow" target="_blank"> MobileSSD </a>来实现这个目的。</p><p id="e1a4" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">人物探测器生成带有玩家坐标的盒子。该信息将是阶段分类模型的输入。</p><p id="0e2d" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">有时探测器会漏掉人，这给数据增加了一些噪声。</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mo"><img src="../Images/50c74f32c1146b7010e2edaf43194b6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XbRbsSs_PvQjc1dYCPAFRg.jpeg"/></div></div></figure><h2 id="46c7" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">数据准备</h2><p id="bed0" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">出于训练目的，需要手动对图片进行分类，将它们移动到 4 个不同的文件夹中。</p><p id="5ecf" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">然后是一个很好的问题，关于如何表示机器学习的输入数据。有两个主要选项:</p><ul class=""><li id="ba2f" class="ma mb iq ld b le lv lh lw ko mc ks md kw me lt mf mg mh mi bi translated">使用检测到的框的数字表示</li><li id="c6d5" class="ma mb iq ld b le mj lh mk ko ml ks mm kw mn lt mf mg mh mi bi translated">使用图片</li></ul><p id="8f96" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">我决定使用图片选项，因为:</p><ul class=""><li id="3242" class="ma mb iq ld b le lv lh lw ko mc ks md kw me lt mf mg mh mi bi translated">输入大小应该是稳定的，但是我们事先不知道检测的次数。球场上可能有多达 12 名球员，但球迷、裁判和替补队员可能会增加这个数字。图片大小是固定的。</li><li id="5fd4" class="ma mb iq ld b le mj lh mk ko ml ks mm kw mn lt mf mg mh mi bi translated">检测是无序的。为了将它们用作数组输入，我们需要以某种方式对它们进行排序，例如，从左到右、按大小排序等等，但哪种选择更好并不明显。对于图片，我们按原样使用检测。</li><li id="aa51" class="ma mb iq ld b le mj lh mk ko ml ks mm kw mn lt mf mg mh mi bi translated">人性化。看着箱子上的数字，很难说现在是什么阶段。一张图片提供了很好的线索。</li></ul><p id="cdb0" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">为了将检测结果表示为输入图片，我将它们绘制为黑色背景上的白色实心矩形，大小调整为 64x64。</p><pre class="mp mq mr ms gt na nb nc nd aw ne bi"><span id="38aa" class="kf kg iq nb b gy nf ng l nh ni">def get_mask(boxes):  <br/>  pic = np.zeros((H,W,1), np.uint8)  <br/>  clr = 255   <br/>  for r in boxes:     <br/>    cv.rectangle(pic, (r[0], r[1]), (r[0] + r[2], r[1] + r[3]), clr, thickness=-1)   <br/>  pic = cv.resize(pic, (64, 64))  <br/>  return pic</span></pre><p id="0862" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">然后我为每个阶段准备了面具:</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nj"><img src="../Images/0561d83b8fb1e244a713f5b7464c0580.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KjVynL2TyXbf0s12SAml6A.jpeg"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">欢呼</p></figure><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi no"><img src="../Images/85c1a626cda4fc805d863a0295b0b4d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KmBmqIKFYjBNZpBz9Xb13g.jpeg"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">不休息</p></figure><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nj"><img src="../Images/50dceab4d7ed1ea1225751a7601466e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NwM8MfoHjEGWc1fgd92IEQ.jpeg"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">玩</p></figure><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi np"><img src="../Images/3f0468a757b5dc93fc3a8cb2815c7d33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F5gmkcIvHbr6AlWZS-wngA.jpeg"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">静止位置</p></figure><h2 id="b3d1" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">选择分类方法</h2><p id="f5cd" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated"><a class="ae lu" href="https://machinelearningmastery.com/multi-label-classification-with-deep-learning/" rel="noopener ugc nofollow" target="_blank">多标签分类</a>有多种方式，所以选择并不容易。最后，我选择了两个最基本也是最流行的方法:</p><ul class=""><li id="4fe9" class="ma mb iq ld b le lv lh lw ko mc ks md kw me lt mf mg mh mi bi translated">从 sklearn 最近的邻居(又名 KNN)</li><li id="0768" class="ma mb iq ld b le mj lh mk ko ml ks mm kw mn lt mf mg mh mi bi translated"><a class="ae lu" href="https://www.tensorflow.org/tutorials/keras/classification" rel="noopener ugc nofollow" target="_blank">带 Tensorflow-Keras 的简单神经网络</a>(又名 TFK)</li></ul><p id="4822" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated"><a class="ae lu" href="https://github.com/tprlab/vball/blob/master/detect/train_knn.py" rel="noopener ugc nofollow" target="_blank"> KNN </a>在相同数据上显示 81%的准确率，在随机样本上显示 66%的准确率。</p><p id="fd25" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated"><a class="ae lu" href="https://github.com/tprlab/vball/blob/master/detect/train_keras.py" rel="noopener ugc nofollow" target="_blank"> TFK </a>也稳定在 80%左右。</p><h2 id="16f6" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">测试分类</h2><p id="8f6c" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">我们来挑选一个测试排球的视频。我使用了由格拉茨计算机视觉研究所提供的奥地利业余联盟的公开视频集。</p><ol class=""><li id="3be1" class="ma mb iq ld b le lv lh lw ko mc ks md kw me lt nq mg mh mi bi translated">从游戏中提取帧。人们移动得不是很快，所以每秒 2 帧可能就足够了:</li></ol><pre class="mp mq mr ms gt na nb nc nd aw ne bi"><span id="5e4d" class="kf kg iq nb b gy nf ng l nh ni">ffmpeg -i video.mp4 -r 2 frames/%05d.jpg</span></pre><p id="13db" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">2.对帧运行 MobileSSD 检测器并生成 json 文件。</p><pre class="mp mq mr ms gt na nb nc nd aw ne bi"><span id="c8b5" class="kf kg iq nb b gy nf ng l nh ni">def detect_pic(ssd, img, thr = 0.3):<br/>  rows = img.shape[0]<br/>  cols = img.shape[1]</span><span id="7b7a" class="kf kg iq nb b gy nr ng l nh ni">  ssd.setInput(cv.dnn.blobFromImage(img, 1.0/127.5, (600, 600), (127.5, 127.5, 127.5), swapRB=True, crop=False))<br/>  out = ssd.forward()<br/>  r = np.array([cols, rows, cols, rows])</span><span id="7cf6" class="kf kg iq nb b gy nr ng l nh ni">  boxes = []<br/>  scores = []<br/>  for d in out[0,0,:,:]:<br/>    score = float(d[2])<br/>    cls = int(d[1])<br/>    if cls != 1:<br/>      continue<br/>    if score &lt; thr:<br/>      continue</span><span id="5db7" class="kf kg iq nb b gy nr ng l nh ni">  box = d[3:7] * r<br/>    box[2] -= box[0]<br/>    box[3] -= box[1]<br/>    boxes.append(box.astype("int"))<br/>    scores.append(score)</span><span id="9458" class="kf kg iq nb b gy nr ng l nh ni">  if len(boxes) &lt; 1:<br/>    return []</span><span id="7330" class="kf kg iq nb b gy nr ng l nh ni">  dxs = cv.dnn.NMSBoxes(boxes, scores, thr, 0.1)<br/>  return [boxes[i].tolist() for i in dxs.flatten()]</span></pre><p id="4a5f" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">3.<a class="ae lu" href="https://github.com/tprlab/vball/blob/master/detect/test_utils.py#L47" rel="noopener ugc nofollow" target="_blank">将</a>检测转换成输入掩码。</p><p id="45f3" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">4.<a class="ae lu" href="https://github.com/tprlab/vball/blob/master/detect/test_results.py#L16" rel="noopener ugc nofollow" target="_blank">对输入掩码进行分类</a></p><p id="5025" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">这两种方法的表现都比训练时差:</p><ul class=""><li id="3371" class="ma mb iq ld b le lv lh lw ko mc ks md kw me lt mf mg mh mi bi translated">KNN——72%</li><li id="88b6" class="ma mb iq ld b le mj lh mk ko ml ks mm kw mn lt mf mg mh mi bi translated">TFK——70%</li></ul><p id="f1d3" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">5.从阶段预测中建立拉力</p><p id="51d2" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">令人惊讶的是，就反弹的可靠性而言，即使是 KNN 也略胜 TFK，TFK 表现得更好:</p><ul class=""><li id="82d1" class="ma mb iq ld b le lv lh lw ko mc ks md kw me lt mf mg mh mi bi translated">KNN 认可了 29 次集会中的 8 次</li><li id="803b" class="ma mb iq ld b le mj lh mk ko ml ks mm kw mn lt mf mg mh mi bi translated">TFK 承认了 20 次集会</li></ul><h2 id="79c3" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结论</h2><p id="7239" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">拉力赛削减是这项工作的最终目标，结果是有希望的。即使不够精确，TFK·卡特也能为视频编辑和观众节省一些时间。</p><p id="ec81" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">削减反弹有多种原因:</p><ul class=""><li id="7a4b" class="ma mb iq ld b le lv lh lw ko mc ks md kw me lt mf mg mh mi bi translated">密集的整场比赛录音。它使视频更小(约为原始的 30%)，存储更便宜，加载更快，对观众来说更迷人。</li><li id="e0a3" class="ma mb iq ld b le mj lh mk ko ml ks mm kw mn lt mf mg mh mi bi translated">将漫长的游戏分割成有意义的部分。这对球员、他们的父母和粉丝来说很重要——小的拉力赛片段可以很容易地分享或保存在个人照片中。</li></ul><p id="fd23" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">到目前为止，自动对倒可能比目前更精确，第一批结果是有希望的，能够产生一些有用的结果。</p><h2 id="331a" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">链接</h2><ul class=""><li id="cbf1" class="ma mb iq ld b le lf lh li ko ns ks nt kw nu lt mf mg mh mi bi translated"><a class="ae lu" href="https://www.tensorflow.org/lite/examples/object_detection/overview" rel="noopener ugc nofollow" target="_blank">移动探测器</a></li><li id="db58" class="ma mb iq ld b le mj lh mk ko ml ks mm kw mn lt mf mg mh mi bi translated"><a class="ae lu" href="https://scikit-learn.org/stable/modules/generated/sklearn.neighbors.KNeighborsClassifier.html" rel="noopener ugc nofollow" target="_blank">最近邻分类器</a></li><li id="a149" class="ma mb iq ld b le mj lh mk ko ml ks mm kw mn lt mf mg mh mi bi translated"><a class="ae lu" href="https://www.tensorflow.org/tutorials/keras/classification" rel="noopener ugc nofollow" target="_blank"> Tensorflow-Keras 分类器</a></li><li id="e7f9" class="ma mb iq ld b le mj lh mk ko ml ks mm kw mn lt mf mg mh mi bi translated"><a class="ae lu" href="https://github.com/tprlab/vball/tree/master/detect" rel="noopener ugc nofollow" target="_blank">代号为</a>的 Github 回购</li><li id="6fd5" class="ma mb iq ld b le mj lh mk ko ml ks mm kw mn lt mf mg mh mi bi translated"><a class="ae lu" href="https://www.tugraz.at/institute/icg/research/team-bischof/lrs/downloads/vb14/" rel="noopener ugc nofollow" target="_blank">视频数据集</a></li></ul><h2 id="92b4" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">参考资料:</h2><p id="be71" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">(<a class="ae lu" href="https://www.tugraz.at/institute/icg/research/team-bischof/lrs/downloads/vb14/" rel="noopener ugc nofollow" target="_blank">视频数据集所有者要求</a></p><p id="8e8e" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated"><a class="ae lu" href="https://files.icg.tugraz.at/f/d5668bbb4a/?raw=1" rel="noopener ugc nofollow" target="_blank"> <strong class="ld ir">利用时空上下文改进体育活动识别</strong> </a> <br/>乔治·瓦尔特纳、托马斯·毛特纳和霍斯特·比朔夫<br/>在<em class="nv"> Proc。DVS-体育领域计算机科学会议(DVS/GSSS)，2014 年</em></p><p id="cd8d" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated"><a class="ae lu" href="https://files.icg.tugraz.at/f/43f43cbc00/?raw=1" rel="noopener ugc nofollow" target="_blank"> <strong class="ld ir">自动化体育游戏分析的室内活动检测与识别</strong> </a> <br/>乔治·瓦尔特纳、托马斯·毛特纳和霍斯特·比朔夫<br/>在<em class="nv"> Proc。奥地利模式识别协会(AAPR/OAGM)研讨会，2014 年</em></p></div></div>    
</body>
</html>