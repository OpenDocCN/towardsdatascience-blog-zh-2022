<html>
<head>
<title>Detecting and fixing data drift in Computer Vision</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">计算机视觉中数据漂移的检测和修复</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/detecting-and-fixing-data-drift-in-computer-vision-8d0853af1246#2022-12-06">https://towardsdatascience.com/detecting-and-fixing-data-drift-in-computer-vision-8d0853af1246#2022-12-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2e00" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">带有可运行代码的实际案例研究</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/62cd819e8dfdc17d14c2e4152139d49a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6oygA9oLhsLxmJKK"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由来自<a class="ae ky" href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2396992" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae ky" href="https://pixabay.com/users/dimitrisvetsikas1969-1857980/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2396992" rel="noopener ugc nofollow" target="_blank"> Dimitris Vetsikas </a>拍摄</p></figure><p id="1b0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">简介</strong></p><p id="2526" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您已经在数据科学和 ML 领域工作了一段时间，您会知道您所训练的模型在生产环境中的表现可能会出乎意料。这是因为生产数据往往不同于用于创建模型的封闭训练数据集。此外，生产数据会随着时间不断变化，因此即使最初表现良好的模型也会随着时间的推移而退化。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/daea6efdd869f6d628fcff3e984f5f39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bz8EHEdHz-nYGipq"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b0cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面所描述的就是所谓的数据漂移，它在 ML 中非常普遍。</p><p id="7b96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有很多文章深入解释了这个概念，但在本教程中，我们将重点放在数据漂移检测的实际部分，并在一个计算机视觉示例中解决它。</p><p id="079f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在这里向您全面解释我们创建的数据漂移监控系统，有关更多细节和完整代码，您可以查看这个<a class="ae ky" href="https://colab.research.google.com/drive/1BnugKMNIChFugMafvgI0fE9SlAQ5EZ72?usp=sharing#scrollTo=n_84orsmBAYl" rel="noopener ugc nofollow" target="_blank"> colab 笔记本</a>。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="7920" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">问题陈述</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi md"><img src="../Images/bfe24331a43293182728245c3c33ae59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XOaM4PGT-O216OMi"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">猫还是狗？—作者图片</p></figure><p id="edba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个案例研究中，我们将监控一个经过训练可以区分猫和狗的计算机视觉分类器。我们使用的实际模型已经使用 Keras 进行了训练，它只是一个简单的 CNN。</p><p id="3d8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将要监控的数据将模拟一周的生产性能，因此我们将图像分成几天一批(第 1 天、第 2 天、…、第 7 天)。</p><p id="2d99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们在以后的日子里模拟了数据漂移，所以在第一批中，您将看到正常的猫和狗的图像…</p><p id="4309" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而后来的几天出现了一些相机问题，一些像素被破坏，图像看起来更像这样…</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7fd266f8e9653d232787d706f336745c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xgaltlrqUMKbZ1ru"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">相机问题—图片由作者提供</p></figure><p id="a161" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看能否用漂移监测系统检测到它。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="e7cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">如何检测数据漂移并获得早期警报</strong></p><p id="6373" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用开源库<a class="ae ky" href="https://github.com/whylabs/whylogs" rel="noopener ugc nofollow" target="_blank"> whylogs </a>来分析我们的数据，并将分析结果发送到<a class="ae ky" href="https://whylabs.ai/" rel="noopener ugc nofollow" target="_blank"> WhyLabs </a>进行数据漂移和 ML 性能监控。</p><p id="9925" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用 whylogs 创建的配置文件是高效的、可合并的，并且只包含必要的摘要统计信息。这使得它们可以用于几乎任何应用，无论是需要批量或流处理数据，还是医疗保健和金融等敏感行业。在 GitHub 上阅读更多关于 whylogs 的内容。</p><p id="c863" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">WhyLabs 可以轻松存储和监控 whylogs 创建的配置文件，以检测机器学习管道中的异常，如数据漂移、数据质量问题和模型偏差。</p><p id="abfa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们在<a class="ae ky" href="https://colab.research.google.com/drive/1BnugKMNIChFugMafvgI0fE9SlAQ5EZ72" rel="noopener ugc nofollow" target="_blank"> Colab 笔记本</a>中介绍了监控我们的计算机视觉数据和模型的细节，但在下面，您可以看到 WhyLabs 仪表板的预览。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c65a79b95abdfcb51cebe93f84fb2fb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aPb8oERD74jka7VI"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">检测 WhyLabs 中的数据漂移—图片由作者提供</p></figure><p id="f219" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在它的左侧，您可以看到正在监控的不同特性(亮度、像素高度、像素宽度、饱和度等)。其中几个旁边有一个红色的感叹号。这表明我们的数据已经在这些维度上漂移了。您可以详细探索每个功能(仪表板的中心)。上面的屏幕截图显示了亮度值，您可以看到亮度值在漂移监测的第 4 天开始漂移，并在第 5、第 6 和第 7 天继续漂移。</p><p id="3e0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将是有意义的，记住，我们已经应用了一些像素的图像发送到以后的日子。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="b05e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">带人工注释的模型漂移检测</strong></p><p id="7b5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经被告知，后面几天的一些数据看起来与我们的模型被训练的数据有些不同。但是模型的性能受到影响了吗？</p><p id="c22a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了检查它，需要人工注释。我们可以自己做，但这是非常不切实际和不可扩展的，所以我们将使用<a class="ae ky" href="https://toloka.ai/" rel="noopener ugc nofollow" target="_blank"> Toloka </a>众包平台。</p><p id="2396" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了做到这一点，我们首先需要建立一个贴标项目，在那里我们为贴标机指定说明，并设计一个界面。后者可以使用 Toloka 中的 Template Builder 工具来完成，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0b00a9ec8f2d8859088aa3aad9adf6f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*V5EJcDXMGqm1t5mu"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">分类项目任务界面—作者图片</p></figure><p id="b014" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们建立了一个项目，我们可以上传所有需要注释的照片。我们可以使用 python 和 Toloka-Ki 库以编程的方式来实现。请记住，在本<a class="ae ky" href="https://colab.research.google.com/drive/1BnugKMNIChFugMafvgI0fE9SlAQ5EZ72?usp=sharing#scrollTo=n_84orsmBAYl" rel="noopener ugc nofollow" target="_blank">笔记本</a>中，您有设置该系统所需的全部代码。</p><p id="1184" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你的每日批次被上传，你应该让他们按照如下所示的日常方式进行组织。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/44fc28da64206e54f39a56bd0d267caf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GsqGTl79h4OlYIFz"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a03a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在标记开始之前，我们需要选择将参与项目的表演者。因为这是一个简单的任务，我们不需要做复杂的过滤技术。我们将允许说英语(因为这是编写说明的语言)的注释者参与进来。</p><p id="9cdb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们还设置了一些质量控制规则，如验证码和控制任务。这很重要，因为众包要成为有效的工具，需要严格的质量控制规则。我们还将相同的图像发送给三个不同的标注者进行标注，以便对每个标注有更多的信心。</p><p id="0218" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当所有注释者完成工作后，我们可以将这些数据(我们的黄金标准)与模型预测一起发送，并使用 WhyLabs 对它们进行进一步分析。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="e064" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">将模型预测与人工注释进行比较</strong></p><p id="e5cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以使用 WhyLabs，通过比较模型预测值和基本事实来监控机器学习性能指标。还可以配置监视器来检测这些指标是否发生变化。</p><p id="80c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面你可以看到一个仪表盘，上面有我们案例研究的准确度、精确度、回忆、f 分数和混淆矩阵。请注意，模型的准确性在后来的日子里从大约 80%下降到 40%。看起来我们在本案例研究开始时从输入要素获得的初始警报是正确的，并且现在得到了地面事实的证实。我们的模型漂移了！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi me"><img src="../Images/9103f918dbf2f563d01795991af6c7d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sCGXzOVsG_k-EYg8"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在 WhyLabs 中监控机器学习性能指标—图片由作者提供</p></figure><p id="5a5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们发现模型漂移，通常的程序是根据新的例子重新训练模型，以说明环境的变化。因为我们已经用 Toloka 注释了新数据，所以我们现在可以用它来重新训练模型。或者，如果我们认为新样本太小，我们将触发更大的数据标注管道来收集更多的训练样本。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="cda5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">总结</strong></p><p id="81f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程教你如何为一个计算机视觉项目建立一个 ML 模型漂移监控系统。我们使用了一个简单的猫和狗的分类例子，但这个案例研究可以很容易地扩展到更复杂的项目。</p><p id="aea0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记住你可以在这个<a class="ae ky" href="https://colab.research.google.com/drive/1BnugKMNIChFugMafvgI0fE9SlAQ5EZ72?usp=sharing#scrollTo=ocxaBmVBRQsM" rel="noopener ugc nofollow" target="_blank">笔记本</a>里查看完整的代码。此外，我们还举办了一个现场研讨会，一步一步地解释这个流程的每个阶段都发生了什么。这是一个很长的<a class="ae ky" href="https://www.youtube.com/watch?v=hLXTaIO7Q8o" rel="noopener ugc nofollow" target="_blank">录音</a>，但如果你对更详细的解释感兴趣，值得一看。</p><p id="de96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还要感谢本文的合著者塞奇·艾略特(Sage Elliott)和与我们合著了最初的<a class="ae ky" href="https://colab.research.google.com/drive/1BnugKMNIChFugMafvgI0fE9SlAQ5EZ72?usp=sharing#scrollTo=ocxaBmVBRQsM" rel="noopener ugc nofollow" target="_blank">笔记本</a>的<a class="ae ky" href="https://www.linkedin.com/in/daniil-fedulov-17949479/" rel="noopener ugc nofollow" target="_blank">丹尼尔·费杜洛夫(Daniil Fedulov)</a>。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="0853" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mf"> PS:我正在 Medium 和</em><a class="ae ky" href="https://www.aboutdatablog.com/" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="mf">aboutdatablog.com</em></strong></a><em class="mf">上撰写以简单易懂的方式解释基本数据科学概念的文章。你可以订阅我的</em> <a class="ae ky" href="https://medium.com/subscribe/@konkiewicz.m" rel="noopener"> <strong class="lb iu"> <em class="mf">邮件列表</em> </strong> </a> <em class="mf">在我每次写新文章的时候得到通知。如果你还不是中等会员，你可以在这里加入</em><a class="ae ky" href="https://medium.com/@konkiewicz.m/membership" rel="noopener"><strong class="lb iu"><em class="mf"/></strong></a><em class="mf">。</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="901b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面还有一些你可能喜欢的帖子</p><div class="mg mh gp gr mi mj"><a rel="noopener follow" target="_blank" href="/visual-question-answering-challenge-51c4623ddfa5"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd iu gy z fp mo fr fs mp fu fw is bi translated">视觉问答挑战</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">一个稍微不同的 ML 竞赛和你为什么应该参加</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">towardsdatascience.com</p></div></div><div class="ms l"><div class="mt l mu mv mw ms mx ks mj"/></div></div></a></div><div class="mg mh gp gr mi mj"><a rel="noopener follow" target="_blank" href="/top-8-magic-commands-in-jupyter-notebook-c1582e813560"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd iu gy z fp mo fr fs mp fu fw is bi translated">Jupyter 笔记本中的 8 大魔法命令</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">通过学习最有用的命令来提高您的生产力</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">towardsdatascience.com</p></div></div><div class="ms l"><div class="my l mu mv mw ms mx ks mj"/></div></div></a></div><div class="mg mh gp gr mi mj"><a rel="noopener follow" target="_blank" href="/how-to-do-data-labeling-versioning-and-management-for-ml-ba0345e7988"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd iu gy z fp mo fr fs mp fu fw is bi translated">如何为 ML 做数据标记、版本控制和管理</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">丰富食品数据集的案例研究</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">towardsdatascience.com</p></div></div><div class="ms l"><div class="mz l mu mv mw ms mx ks mj"/></div></div></a></div><div class="mg mh gp gr mi mj"><a rel="noopener follow" target="_blank" href="/jupyter-notebook-autocompletion-f291008c66c"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd iu gy z fp mo fr fs mp fu fw is bi translated">Jupyter 笔记本自动完成</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">数据科学家的最佳生产力工具，如果您还没有使用它，您应该使用它…</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">towardsdatascience.com</p></div></div><div class="ms l"><div class="na l mu mv mw ms mx ks mj"/></div></div></a></div></div></div>    
</body>
</html>