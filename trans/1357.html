<html>
<head>
<title>How I Use DateTime Features in Python in Data Science Interviews</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何在数据科学访谈中使用Python中的日期时间特性</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-i-use-datetime-features-in-python-in-data-science-interviews-5b17e68405fa#2022-04-04">https://towardsdatascience.com/how-i-use-datetime-features-in-python-in-data-science-interviews-5b17e68405fa#2022-04-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9683" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><em class="kf">使用Python Pandas的日期时间功能概述</em></h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/1b3632bb4a14e6d0135a3ea75eb22d6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GtPCKvJDSESku-2h"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">作者在<a class="ae kw" href="https://canva.com/" rel="noopener ugc nofollow" target="_blank"> Canva </a>上创建的图片</p></figure><p id="b105" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在本文中，我们将研究Python Pandas中DateTime库的一些不同应用。就上下文而言，每当您必须在Python中操作表格数据时，您通常可以使用Pandas库来完成。就像您可以使用Excel或Google Sheets一样，Pandas为您提供了更多处理结构化数据的能力。你可以在这里找到更多关于<a class="ae kw" href="https://pandas.pydata.org/docs/ecosystem.html" rel="noopener ugc nofollow" target="_blank">熊猫生态系统的信息，也可以在这里</a>阅读它的大量<a class="ae kw" href="https://pandas.pydata.org/pandas-docs/stable/index.html" rel="noopener ugc nofollow" target="_blank">文档。强大的熊猫技能是Python数据科学面试中最常见的期望之一。</a></p><h1 id="7d9c" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">Python Pandas中的日期时间特性</h1><p id="1368" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">日期时间操作是最常被问到的<a class="ae kw" href="https://www.stratascratch.com/blog/40-data-science-interview-questions-from-top-companies/?utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank">数据科学面试问题</a>之一。DateTime数据集的普遍性和人们可以用看起来简单的数据实现的一系列复杂性使它成为一个流行的数据科学测试领域。Pandas有许多DateTime函数，涵盖了广泛的DateTime用例，你可以在这里阅读关于它们的官方文档。</p><p id="e0a4" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">DateTime函数最常见的一个用例是在清理数据时获取正确的日期格式。在许多情况下，您的日期时间数据太复杂，需要简化到一周中的某一天或一天中的某个小时。在其他情况下，您的数据没有日期或时间，您需要使用DateTime库为您的计算添加合理的日期。</p><p id="ecb5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了实现这种格式化和丰富，Pandas中的DateTime函数允许您将字符串或列解析为DateTime格式，生成定期的DateTime信息，从DateTime对象中提取日期或时间信息的子集，等等。</p><p id="00de" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">展示这些Panda DateTime函数如何工作的最佳方式是通过示例，因此我们将涵盖一些需要使用DateTime函数的<a class="ae kw" href="https://www.stratascratch.com/blog/top-30-python-interview-questions-and-answers/?utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> Python面试问题</a>。</p><h1 id="12ca" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">需要Python Pandas DateTime函数的访谈示例</h1><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/f7e2244443268832aa37684be3757ad0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*orCc5GmJz0kpET-HduALuA.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">作者在<a class="ae kw" href="https://canva.com/" rel="noopener ugc nofollow" target="_blank"> Canva </a>上创建的图像</p></figure><p id="7af0" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">如何使用today()方法丰富日期时间数据</strong></p><p id="2355" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们要看的第一个例子有助于解决优步数据科学采访中的一个问题。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi mq"><img src="../Images/fdc96c7e5c5aafd5a7a96963763c7cd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aHMg-YV5-BiPSybS61Xh_A.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/2046-maximum-number-of-employees-reached?python=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><p id="c07b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">问题链接:<a class="ae kw" href="https://platform.stratascratch.com/coding/2046-maximum-number-of-employees-reached?python=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank">https://platform . stratascratch . com/coding/2046-已达到最大员工数</a></p><p id="fd76" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这个问题要求我们查看在优步工作的每一位员工，并确定优步员工在任职期间的最大数量以及这个最大数量出现的第一个日期。</p><p id="42e8" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">当谈到理解我们为什么必须使用日期时间函数时，我们通常必须首先分析数据集。在这个问题中，我们只有一个表<em class="mr"> uber_employees </em>可供查看。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ms"><img src="../Images/25160fdeab73c7218d1e90edc069ed8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ya6-XHo24yl8hIs0csKV8Q.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/2046-maximum-number-of-employees-reached?python=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><p id="ddb8" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">以下是一些示例数据:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi mt"><img src="../Images/36be458c4ee8aea0f75e25b042e407ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c4-Xm51kcUqeXri2X5YLHw.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/2046-maximum-number-of-employees-reached?python=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><p id="c351" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">拥有像雇佣日期和终止日期这样的日期时间列是不够的，我们需要调用日期时间库。相反，由于该数据包括仍在优步的雇员的termination_date列，我们不得不假设当前雇员的该列为空。这很重要，因为我们需要插入他们结束日期的实际数据，以计算雇佣范围并得出我们的解决方案。</p><p id="ce3c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了丰富内容，我们将遍历表，如果存在终止日期，则将结束日期指定为终止日期，如果不存在终止日期，则将终止日期指定为今天。</p><pre class="kh ki kj kk gt mu mv mw mx aw my bi"><span id="7b8d" class="mz lu iq mv b gy na nb l nc nd">import pandas as pd<br/>import datetime as dt<br/>for i in range(uber_employees.shape[0]):<br/>    if uber_employees.at[i, 'termination_date'] is pd.NaT:<br/>        end_date = dt.datetime.today()<br/>    else: <br/>        end_date = uber_employees.at[i, 'termination_date']</span></pre><p id="4c4c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">注意datetime库最初是如何用别名dt导入的。我们使用这个库的模块datetime以及它的today()方法将任何当前雇员的结束日期指定为今天的日期。</p><p id="832c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">由于该解决方案有些复杂，我们不打算详细介绍它的其余部分，但是，它看起来是这样的:</p><pre class="kh ki kj kk gt mu mv mw mx aw my bi"><span id="88e8" class="mz lu iq mv b gy na nb l nc nd">import pandas as pd<br/>import datetime as dt<br/> <br/>hired_dates = pd.DataFrame(uber_employees['hire_date'].rename('date'))<br/>hired_dates['value'] = 1<br/> <br/>terminated_dates = pd.DataFrame(uber_employees['termination_date'].<br/>rename('date'))<br/>terminated_dates['value'] = -1<br/>terminated_dates = terminated_dates.dropna()<br/> <br/>all_dates = pd.concat([hired_dates, terminated_dates], ignore_index=True)<br/>all_dates = all_dates.groupby('date').sum().reset_index()<br/>all_dates = all_dates.sort_values('date')<br/>all_dates['emp_count'] = all_dates['value'].cumsum()<br/> <br/> <br/>for i in range(uber_employees.shape[0]):<br/>    if uber_employees.at[i, 'termination_date'] is pd.NaT:<br/>        end_date = dt.datetime.today()<br/>    else: <br/>        end_date = uber_employees.at[i, 'termination_date']<br/>        <br/>    start_date = uber_employees.at[i, 'hire_date']<br/>    <br/>    max_emp_count = all_dates[all_dates['date'].between(start_date, end_date)]<br/>['emp_count'].max()<br/>    <br/>    uber_employees.at[i, 'max_emp'] = max_emp_count<br/>    <br/>    earliest_date = all_dates[(all_dates['emp_count'] == max_emp_count)<br/>&amp; (all_dates['date'].between(start_date, end_date))]['date'].min()<br/>    <br/>    uber_employees.at[i, 'min_date'] = earliest_date<br/>    <br/>result = uber_employees[['id', 'max_emp', 'min_date']]</span></pre><p id="c728" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果你对详细的演练感兴趣，请参考本文→ <a class="ae kw" href="https://www.stratascratch.com/blog/uber-data-scientist-interview-question-walkthrough/?utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank">优步数据科学家面试问题演练</a>。</p><p id="9aef" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">如何使用工作日和小时访问器解析日期时间数据</strong></p><p id="628a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们要分析的第二个例子有助于回答关于送货司机平均收入的Doordash问题。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ne"><img src="../Images/9d1b97d90bafd1b09b2ae843403d303b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UIDfNy-NHXWK4yv6-WO4hA.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/2034-avg-earnings-per-weekday-and-hour?python=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><p id="41a1" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">问题链接:<a class="ae kw" href="https://platform.stratascratch.com/coding/2034-avg-earnings-per-weekday-and-hour?python=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank">https://platform . stratascratch . com/coding/2034-平均每工作日每小时收入</a></p><p id="48e9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们看到问题要求我们返回基于一周中的小时和天的平均收入，所以我们已经有一些迹象表明我们将必须进行某种形式的日期时间操作。</p><p id="0c3f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">该问题仅使用了具有以下字段的<em class="mr"> doordash_delivery </em>数据集:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ms"><img src="../Images/8168f468034b0fb44c1c5b0186934daa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UBp4LnArYfrK2Q5OBMW3WA.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/2034-avg-earnings-per-weekday-and-hour?python=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><p id="465a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">示例数据如下所示:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nf"><img src="../Images/746aff26d17f3981583fcb3d9cfda0e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zJsUYz0DOV89yxRKVCeNOg.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/2034-avg-earnings-per-weekday-and-hour?python=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><p id="8372" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">同样，仅仅在我们的数据集中有日期时间列还不足以得出我们需要调用日期时间库的结论。相反，这里的关键信息是必须基于小时和天进行计算，我们可以看到没有一个列只隔离小时或天。</p><p id="c62f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们首先需要从customer_placed_order_datetime字段中提取星期几和小时。首先，我们使用. dt.weekday属性获取星期几。查看<a class="ae kw" href="https://pandas.pydata.org/docs/reference/api/pandas.Series.dt.weekday.html" rel="noopener ugc nofollow" target="_blank">文档</a>，得出星期一为0，因此，由于问题提示我们从星期一的1开始，我们在提取的日期的结果上加1。</p><pre class="kh ki kj kk gt mu mv mw mx aw my bi"><span id="fac0" class="mz lu iq mv b gy na nb l nc nd"><em class="mr"># Import your libraries</em><br/>import pandas as pd<br/> <br/><em class="mr"># Keep relevant fields</em><br/>dd_df = doordash_delivery[['customer_placed_order_datetime', 'order_total']]<br/>dd_df['weekday'] = dd_df['customer_placed_order_datetime'].dt.weekday + 1</span></pre><p id="04b1" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">提取一天中的小时与. dt.hour属性类似。</p><pre class="kh ki kj kk gt mu mv mw mx aw my bi"><span id="eac3" class="mz lu iq mv b gy na nb l nc nd">dd_df['hour'] = dd_df['customer_placed_order_datetime'].dt.hour</span></pre><p id="94b0" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">最后，你所要做的就是根据一周中的每一天和一天中的每一个小时进行合计。解决方案最终看起来是这样的:</p><pre class="kh ki kj kk gt mu mv mw mx aw my bi"><span id="ce9e" class="mz lu iq mv b gy na nb l nc nd"><em class="mr"># Import your libraries</em><br/>import pandas as pd<br/> <br/><em class="mr"># Keep relevant fields</em><br/>dd_df = doordash_delivery[['customer_placed_order_datetime', 'order_total']]<br/><em class="mr"># Get the day of the week (add 1 to keep have Monday = 1)</em><br/>dd_df['weekday'] = dd_df['customer_placed_order_datetime'].dt.weekday + 1<br/><em class="mr"># Hour of the day</em><br/>dd_df['hour'] = dd_df['customer_placed_order_datetime'].dt.hour<br/>dd_df.groupby(by = ['weekday', 'hour'], as_index = False).agg({'order_total': 'mean'})</span></pre><p id="bb90" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">查看上面的代码，我们的聚合函数需要根据提取的工作日和小时数据进行分组，以便计算每个工作日和小时的平均收入。</p><p id="04fd" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">如何将格式化字符串转换成特定的日期时间数据</strong></p><p id="3f2e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">第三个例子来自一个关于用户增长率的Salesforce面试问题。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ng"><img src="../Images/cc5eca4fc41574269939476df0e6920a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sI-L-7TU5j-Nerz27FhaYw.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/2052-user-growth-rate?python=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><p id="9878" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">问题链接:<a class="ae kw" href="https://platform.stratascratch.com/coding/2052-user-growth-rate?python=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank">https://platform . stratascratch . com/coding/2052-user-growth-rate</a></p><p id="e241" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">此问题要求我们计算Salesforce中每个帐户从2020年12月到2021年1月的活跃用户增长率，并列出它们。</p><p id="d69b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们只有一个单一的<em class="mr"> sf_events </em>数据集，看起来相当简单。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ms"><img src="../Images/cb7b85b1d14b8f4819db02868fc4a8cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tQ7xFTJisF1tyOWubue9SA.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/2052-user-growth-rate?python=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><p id="36be" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">数据看起来像这样:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nh"><img src="../Images/c09b0c12a9e478034ea753de3773fa3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jlO8Ij5JZDKf6SJpouXsQA.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/2052-user-growth-rate?python=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><p id="e28d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">查看我们的示例数据，我们可以看到，当我们真正需要将其缩小到月份和年份时，我们得到了诸如日期和时间之类的信息。我们可以使用日期时间库中的唯一方法。strftime()，它根据所需的格式将日期时间数据转换为字符串。</p><pre class="kh ki kj kk gt mu mv mw mx aw my bi"><span id="18c4" class="mz lu iq mv b gy na nb l nc nd"><em class="mr"># Import your libraries</em><br/>import pandas as pd<br/> <br/><em class="mr"># Create the Year - Month indicator</em><br/>sf_events['month'] = sf_events['date'].dt.strftime('%Y-%m')</span></pre><p id="aa8a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">注意我们是如何在？strftime()方法只提取年份和日期。接下来，我们将月份限制在2020年12月和2021年1月。请记住，字符串过滤器需要匹配strftime()方法中指定的格式。</p><pre class="kh ki kj kk gt mu mv mw mx aw my bi"><span id="9396" class="mz lu iq mv b gy na nb l nc nd">summ_df = sf_events[sf_events['month'].isin(['2020-12', '2021-01'])]</span></pre><p id="5a9e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">现在，我们使用数据透视表汇总这几个月的数据，计算增长率，并将输出限制在相关的列中。这是最终的解决方案:</p><pre class="kh ki kj kk gt mu mv mw mx aw my bi"><span id="0612" class="mz lu iq mv b gy na nb l nc nd"><em class="mr"># Import your libraries</em><br/>import pandas as pd<br/> <br/><em class="mr"># Create the Year - Month indicator</em><br/>sf_events['month'] = sf_events['date'].dt.strftime('%Y-%m')<br/>summ_df = sf_events[sf_events['month'].isin(['2020-12', '2021-01'])].pivot_table(<br/>    index = 'account_id', columns = 'month', values = 'user_id', aggfunc = <br/>    'nunique').reset_index()<br/><em class="mr"># Calculate growth rate and output relevant columns</em><br/>summ_df['growth_rate'] = summ_df['2021-01'] / summ_df['2020-12']<br/>summ_df[['account_id', 'growth_rate']]</span></pre><p id="7f6f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">同样，在增长率计算中对月份和年份的任何引用都必须与我们之前调用的strftime()方法保持格式一致。</p><p id="3304" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">如何使用访问器和字符串到日期时间的方法来比较和过滤日期时间数据</strong></p><p id="a869" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">最后一个例子同样来自Salesforce数据科学访谈。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ng"><img src="../Images/78ce0c4b6cbf6490ccab12a75998751d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_CXlghR9jTQ-ZT947tSEVg.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/2053-retention-rate?python=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><p id="b01f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">问题链接:<a class="ae kw" href="https://platform.stratascratch.com/coding/2053-retention-rate?python=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank">https://platform . stratascratch . com/coding/2053-留存率</a></p><p id="bbce" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">它要求我们比较两个月内的保持率，而不是增长率。虽然我们只需要比较两个月的数据，但很明显，我们必须查看12月和1月之后的月份的保留数据。</p><p id="f748" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">该问题再次使用了具有以下字段的<em class="mr"> sf_events </em>数据集:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ne"><img src="../Images/ebadb6a580ac001ce25e4f4e99068cc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FUPmyl3Hq7Sjy7u7QnYjgA.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/2053-retention-rate?python=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><p id="38fa" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这里有一些数据示例:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ni"><img src="../Images/f39bbe3089d84cc874e559b588a120dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GZ11UbGClNiJKecipDZzbQ.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/2053-retention-rate?python=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><p id="09c7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这个问题需要的日期时间函数与我们之前的问题完全不同，因为我们必须找到保持而不是增长。我们可以首先在12月和1月激活账户。在这两种情况下，我们都可以使用dt.year和dt.month属性来指定我们需要引用哪一年2020或2021或12月或1月。请记住，对于月份，我们将1月作为1，将12月作为12进行筛选。</p><pre class="kh ki kj kk gt mu mv mw mx aw my bi"><span id="b2c8" class="mz lu iq mv b gy na nb l nc nd"><em class="mr"># Import your libraries</em><br/>import pandas as pd<br/> <br/><em class="mr"># Get Accounts active in Dec 2020</em><br/>dec2020 = sf_events[(sf_events['date'].dt.year == 2020) &amp; (sf_events<br/>['date'].dt.month == 12)].drop_duplicates(subset = ['account_id', 'user_id'])<br/>dec2020['in_dec'] = 1<br/><em class="mr"># Get Accounts active in Jan 2021</em><br/>jan2021 = sf_events[(sf_events['date'].dt.year == 2021) &amp; (sf_events<br/>['date'].dt.month == 1)].drop_duplicates(subset = ['account_id', 'user_id'])<br/>jan2021['in_jan'] = 1</span></pre><p id="22fb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">接下来，我们必须计算每个月之后的活跃客户。在这两种情况下，我们都必须对日期进行比较。我们首先调用. dt.date属性只获取日期，排除时间。接下来我们调用。to_datetime()函数将相应月份的最后一天的字符串转换为datetime对象，然后与日期进行比较。</p><pre class="kh ki kj kk gt mu mv mw mx aw my bi"><span id="6027" class="mz lu iq mv b gy na nb l nc nd"><em class="mr"># Get accounts active after December and January</em><br/>aft_dec2020 = sf_events[sf_events['date'].dt.date &gt; pd.to_datetime<br/>('2020-12-31')].drop_duplicates(subset = ['account_id', 'user_id'])<br/>aft_dec2020['aft_dec'] = 1<br/>aft_jan2021 = sf_events[sf_events['date'].dt.date &gt; pd.to_datetime<br/>('2021-01-31')].drop_duplicates(subset = ['account_id', 'user_id'])<br/>aft_jan2021['aft_jan'] = 1</span></pre><p id="f801" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在这些日期时间操作之后，我们可以继续合并数据集，并使用标准Python和Pandas代码计算保留率，因此解决方案如下所示:</p><pre class="kh ki kj kk gt mu mv mw mx aw my bi"><span id="d5fe" class="mz lu iq mv b gy na nb l nc nd"><em class="mr"># Import your libraries</em><br/>import pandas as pd<br/> <br/><em class="mr"># Get Accounts active in Dec 2020</em><br/>dec2020 = sf_events[(sf_events['date'].dt.year == 2020) &amp; (sf_events<br/>['date'].dt.month == 12)].drop_duplicates(subset = ['account_id', 'user_id'])<br/>dec2020['in_dec'] = 1<br/><em class="mr"># Get Accounts active in Jan 2021</em><br/>jan2021 = sf_events[(sf_events['date'].dt.year == 2021) &amp; (sf_events<br/>['date'].dt.month == 1)].drop_duplicates(subset = ['account_id', 'user_id'])<br/>jan2021['in_jan'] = 1<br/><em class="mr"># Get accounts active after December and January</em><br/>aft_dec2020 = sf_events[sf_events['date'].dt.date &gt; pd.to_datetime<br/>('2020-12-31')].drop_duplicates(subset = ['account_id', 'user_id'])<br/>aft_dec2020['aft_dec'] = 1<br/>aft_jan2021 = sf_events[sf_events['date'].dt.date &gt; pd.to_datetime<br/>('2021-01-31')].drop_duplicates(subset = ['account_id', 'user_id'])<br/>aft_jan2021['aft_jan'] = 1<br/><em class="mr"># Merge the datasets to get December and January retention numbers</em><br/>dec_merged = pd.merge(dec2020, aft_dec2020, on = <br/>['account_id', 'user_id'], how = 'left')<br/>dec_summ = dec_merged.groupby(by = ['account_id'], as_index = False).sum()<br/>dec_summ['dec_retention'] = dec_summ['aft_dec'] / dec_summ['in_dec']<br/> <br/>jan_merged = pd.merge(jan2021, aft_jan2021, on = <br/>['account_id', 'user_id'], how = 'left')<br/>jan_summ = jan_merged.groupby(by = ['account_id'], as_index = False).sum()<br/>jan_summ['jan_retention'] = jan_summ['aft_jan'] / jan_summ['in_jan']<br/> <br/><em class="mr"># Merge the Dec20 and Jan21 datasets, calculate the relative retention rate </em><br/><em class="mr"># and output.</em><br/>final_merge = pd.merge(dec_summ, jan_summ, on = 'account_id', how = 'left')<br/>final_merge['retention'] = final_merge['jan_retention'] / final_merge['dec_retention']<br/>final_merge[['account_id', 'retention']]</span></pre><p id="6c19" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们在这个解决方案中看到了日期时间属性的重要性，因为我们必须将日期时间对象的年、月和日期数据从日期时间对象中分离出来。在这之后，我们有了一个很好的机会用。to_datetime()函数</p><h2 id="0fe7" class="mz lu iq bd lv nj nk dn lz nl nm dp md lg nn no mf lk np nq mh lo nr ns mj nt bi translated">结论</h2><p id="56dc" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">在本文中，我们能够探索Python Pandas DateTime库的几种用法。大多数时候，您将利用其中一个访问器来隔离日期、时间或日期时间数据的其他组成部分。但是，在其他时候，您可能需要利用这个库来填充一些日期时间数据，所以您将利用它提供的函数。</p><p id="b5a9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果你真的想在你的数据科学职业生涯中使用Python，拥有良好的熊猫技能是一个非常必要的条件。幸运的是，我们能够在这里展示一些实际的例子，这些例子反映了优步、Salesforce和Doordash等顶级公司的实际数据科学面试问题。在我们的平台上，你可以练习回答更多的<a class="ae kw" href="https://www.stratascratch.com/blog/python-pandas-interview-questions-for-data-science/?utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank">熊猫面试问题</a>,通过自己或在我们文章的帮助下交互式地构建这些问题的解决方案。您还可以访问其他用户的大型社区，他们可以在您查看他们的解决方案以获取灵感时对您的解决方案进行评论。</p></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="0276" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><em class="mr">最初发表于</em><a class="ae kw" href="https://www.stratascratch.com/blog/how-i-use-datetime-features-in-python-in-data-science-interviews/?utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank">T5【https://www.stratascratch.com】</a><em class="mr">。</em></p></div></div>    
</body>
</html>