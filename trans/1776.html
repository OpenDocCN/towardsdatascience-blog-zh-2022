<html>
<head>
<title>Sparse Matrices: Why They Matter for Machine Learning and Data Science</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">稀疏矩阵:为什么它们对机器学习和数据科学很重要</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/sparse-matrices-why-they-matter-for-machine-learning-and-data-science-55d704d936b2#2022-04-26">https://towardsdatascience.com/sparse-matrices-why-they-matter-for-machine-learning-and-data-science-55d704d936b2#2022-04-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2010" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">以及为什么你应该关心</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/76b5a076913c7e7f4a41d82b15a78c61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CaggAi8cFuMRXd883vGkfw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://unsplash.com/photos/UxDU0Gg5pqQ" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><h1 id="45a5" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><h2 id="3c8e" class="lr la it bd lb ls lt dn lf lu lv dp lj lw lx ly ll lz ma mb ln mc md me lp mf bi translated">什么是稀疏数据？</h2><p id="d8fa" class="pw-post-body-paragraph mg mh it mi b mj mk ju ml mm mn jx mo lw mp mq mr lz ms mt mu mc mv mw mx my im bi translated">当使用矩阵表示数据时，我们可以量化它包含的空值的数量。这被称为稀疏性。主要包含零的矩阵(或数据集)称为稀疏矩阵。</p><h2 id="70cc" class="lr la it bd lb ls lt dn lf lu lv dp lj lw lx ly ll lz ma mb ln mc md me lp mf bi translated">简单的例子</h2><p id="f6e3" class="pw-post-body-paragraph mg mh it mi b mj mk ju ml mm mn jx mo lw mp mq mr lz ms mt mu mc mv mw mx my im bi translated">假设你让你的4个朋友给你4部不同的电影打分，从1分到5分(如果他们没看过，给0分)。现在，假设你得到了以下评价:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/659f7350308d2a151b4610685db30c8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lqHmmV_01iNl6AU4RjUwsQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">矩阵示例(图片由作者提供)</p></figure><p id="b35c" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">这意味着约翰没有看过电影1、2和4，但给了第三部电影2的评级。</p><p id="a28a" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">这个矩阵的稀疏度很低——准确地说是38 %( 16个值中的6个零= 3/8稀疏度),我们实际上称它为“密集”矩阵。现在，想象你有更多的电影。假设你有15000部电影(相当于网飞目录的大小)。</p><p id="ed2d" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">你可以猜到，大多数人并没有看过网飞的全部15，000部电影。因此，假设每部未看过的电影的评分为零，你可以想象这个矩阵会有多稀疏:它大部分由零组成。</p><h1 id="0821" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">我为什么要在乎？</h1><p id="e2d4" class="pw-post-body-paragraph mg mh it mi b mj mk ju ml mm mn jx mo lw mp mq mr lz ms mt mu mc mv mw mx my im bi translated">两个原因:计算复杂度和存储。</p><h2 id="5b09" class="lr la it bd lb ls lt dn lf lu lv dp lj lw lx ly ll lz ma mb ln mc md me lp mf bi translated">稀疏矩阵的存储</h2><p id="c213" class="pw-post-body-paragraph mg mh it mi b mj mk ju ml mm mn jx mo lw mp mq mr lz ms mt mu mc mv mw mx my im bi translated">理想情况下，我们希望只存储非零值，而不是整个数据集——为什么要存储大量总是具有相同值的元素呢？相反，我们只能存储非零元素的值。在下面的例子中，我们将只存储[1，2，4，2，1，5，1，2，3，1]的值以及它们在矩阵中各自的位置。然后，我们知道矩阵中的所有其他值都是零，我们不需要存储它们。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/6f2bc89151c58042854e590a100bc8ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tgTacbDvrMxaK8sS9FHKAw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">稀疏矩阵的示例(图片由作者提供)</p></figure><p id="4b9b" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">但是我们在实践中如何做到这一点呢？</p><h2 id="7e84" class="lr la it bd lb ls lt dn lf lu lv dp lj lw lx ly ll lz ma mb ln mc md me lp mf bi translated">首席运营官格式</h2><p id="84e2" class="pw-post-body-paragraph mg mh it mi b mj mk ju ml mm mn jx mo lw mp mq mr lz ms mt mu mc mv mw mx my im bi translated">简单:存储3个数组，一个存储值，一个存储每个值的行位置，一个存储每个值的列位置。这被称为坐标列表(首席运营官)格式。这是前一个示例中3个阵列的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/e12e14d2a3e9fd611e46ff2040acd9e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lq1wPUXZXZbF_kBNyAgUEg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">之前的首席运营官格式矩阵(图片由作者提供)</p></figure><p id="2ed1" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">等等，但是要知道，我们存储的是3个11个值的数组，总共33个，而矩阵包含30个值。那有什么意义呢？</p><p id="da6b" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">假设您的数组包含50列和10，000行，因此有500，000个值。此外，它只包含10，000个非零值(即98%稀疏)。您是愿意存储3个包含10，000个值的数组，从而存储30，000个值还是500，000个值？</p><p id="411d" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">这几乎减少了20倍的存储量。</p><p id="e60e" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">因此，在处理具有高度稀疏性的大型数据集时，使用稀疏矩阵是很有趣的。</p><h2 id="5501" class="lr la it bd lb ls lt dn lf lu lv dp lj lw lx ly ll lz ma mb ln mc md me lp mf bi translated">计算的复杂性</h2><p id="2eda" class="pw-post-body-paragraph mg mh it mi b mj mk ju ml mm mn jx mo lw mp mq mr lz ms mt mu mc mv mw mx my im bi translated">稀疏矩阵的第二点是在执行计算时。让我们以一个向量乘以一个矩阵为例:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/9fd4dd627c143c62c16c19aaaa75cdb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JbIoliZ7YAxclPgZf9I-rQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带有稀疏矩阵的矩阵向量乘积(图片由作者提供)</p></figure><p id="4fc1" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">在这里，您可以看到，对最终结果有影响的唯一操作是将两个非零值相乘。然而，我们仍然在执行9个浮点运算，而只有3个是重要的。</p><p id="7ba7" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">理想情况下，我们希望跳过有零的计算，得到一个矩阵向量乘积，其计算复杂度只取决于矩阵非零元素的数量，而不取决于值的总数。这在实践中会有更好的伸缩性。幸运的是，大多数ML库都有稀疏矩阵的实现。</p><h1 id="3882" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">网飞奖</h1><p id="86d7" class="pw-post-body-paragraph mg mh it mi b mj mk ju ml mm mn jx mo lw mp mq mr lz ms mt mu mc mv mw mx my im bi translated">现在让我们看一个例子，看看稀疏矩阵在实践中是如何有用的。</p><p id="51bb" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">从2006年到2009年，网飞赞助了一个竞赛来改进它的电影推荐系统。他们提供了一个100，480，507个评级的训练数据集，480，189个用户给了17，770部电影。</p><p id="c159" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">对于每一行，您都有一个用户id、他们看过的电影以及他们对该电影的评价。我们的目标是预测用户对某部电影的评价(使用1-5星系统)。</p><p id="29aa" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">在这个例子中，我运行了下面的代码。它指定了我感兴趣加载的列及其数据类型，以便以最有效的方式存储它们。</p><p id="601c" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">然后，它加载数据集，重命名它的列，并打印出前5行以及内存使用情况。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/2a67c55b01ab7e05ecef82a4bc2554d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Znfe0k4_wDLs0lVMgQz9A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">加载Netflix奖品数据集(图片由作者提供)</p></figure><p id="3042" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">这里的问题是我们想知道用户看过什么电影来预测他们是否会喜欢一部电影。下面是我们希望如何格式化我们的数据(类似于我们看到的第一个例子):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/03f6a3f5dceb9cf6e883d730f9d402ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TLERR2ugPUn8xwzCenjGSg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一键编码我们的数据矩阵(图片由作者提供)</p></figure><p id="d559" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">这样，我们将能够知道用户看过的所有电影，并使用它来预测他们将给予他们没有看过的新电影什么评级。</p><p id="09c5" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">然而，正如本文开头所讨论的，你可以想象大多数人并没有看完网飞的全部17，770部电影。假设人们在网飞上平均观看了150部电影(网飞用户平均每周观看3.4部电影)，在一次热编码后，数据集将稀疏约99%。</p><p id="6e24" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">参考前面的示例，想象一下，您向数据集添加了大约17，000列，乘以大约100万行就可以得到您添加的值的总数。你真的想存储所有这些值，而知道它们99%都是零吗？</p><p id="8bb2" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">相反，当调用独热编码函数(这里是pd.get_dummies)时，我们为参数sparse传递一个true值。这告诉pandas将我们的新数据存储为稀疏数组。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/e4bf694eeac42be025de7a640f03d8a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dajGdt7pu7GciCaJ7Bz8OQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">熊猫代码一键编码你的数据矩阵(图片由作者提供)</p></figure><p id="3f72" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">现在的内存使用量约为990MB，而在一次性编码之前为700MB。考虑到我们添加到数据集中的值的数量，这是相对较小的。</p><p id="28c5" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">作为参考，我用<em class="nl"> sparse=False </em>运行了同一行代码，然后……我的电脑崩溃了。</p><h2 id="2f44" class="lr la it bd lb ls lt dn lf lu lv dp lj lw lx ly ll lz ma mb ln mc md me lp mf bi translated">用稀疏数据改进scikit-learn代码</h2><p id="340d" class="pw-post-body-paragraph mg mh it mi b mj mk ju ml mm mn jx mo lw mp mq mr lz ms mt mu mc mv mw mx my im bi translated">正如我之前提到的，在执行计算时，稀疏矩阵对于降低计算复杂度也很有用。Sklearn的大多数算法都有稀疏实现。以下是随机森林分类器文档中的一个示例:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/713c518044f0f7dd46f287b6c8c4ddc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R82GaSgst-g7FidwWRuQvQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">随机森林分类器的Sklearn文档(<a class="ae ky" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html" rel="noopener ugc nofollow" target="_blank">https://sci kit-learn . org/stable/modules/generated/sk learn . ensemble . randomforestclassifier . html</a>)</p></figure><p id="062a" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">这里使用的<a class="ae ky" href="https://en.wikipedia.org/wiki/Sparse_matrix" rel="noopener ugc nofollow" target="_blank"> CSR格式</a>是实践中最常用的，接近首席运营官格式。我解释了首席运营官的，因为它对初学者更友好。</p><p id="4dff" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated">确保在运行机器学习模型时使用稀疏矩阵可以大大加快运行时间。事实证明，这在运行网格或随机搜索时更加有用，因为这可能非常昂贵。</p><h1 id="ff33" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="ba70" class="pw-post-body-paragraph mg mh it mi b mj mk ju ml mm mn jx mo lw mp mq mr lz ms mt mu mc mv mw mx my im bi translated">在本教程中，我们看到了为什么稀疏矩阵与机器学习相关，以及它们如何帮助减少数据集的存储以及运行ML算法的计算成本。我们还研究了这如何应用于网飞奖数据集。</p></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><p id="b8e2" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated"><em class="nl">我希望你喜欢这个教程！让我知道你对它的看法。</em></p><p id="71a4" class="pw-post-body-paragraph mg mh it mi b mj na ju ml mm nb jx mo lw nc mq mr lz nd mt mu mc ne mw mx my im bi translated"><em class="nl">随时连接上</em><a class="ae ky" href="https://www.linkedin.com/in/thomas-le-menestrel/" rel="noopener ugc nofollow" target="_blank"><em class="nl">LinkedIn</em></a><em class="nl">和</em><a class="ae ky" href="https://github.com/tlemenestrel" rel="noopener ugc nofollow" target="_blank"><em class="nl">GitHub</em></a><em class="nl">多聊聊数据科学和机器学习！</em></p></div></div>    
</body>
</html>