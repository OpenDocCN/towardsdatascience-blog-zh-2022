<html>
<head>
<title>Understanding Python Context-Managers for Absolute Beginners</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">绝对初学者理解Python上下文管理器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/understanding-python-context-managers-for-absolute-beginners-4873b6249f16#2022-06-27">https://towardsdatascience.com/understanding-python-context-managers-for-absolute-beginners-4873b6249f16#2022-06-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="deb7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">理解关于光剑的WITH语句</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f75f346c6d8091a34ec226c1836b3cf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BVRNxGWurIuJCvfP"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们将编写自己的光剑(图片由<a class="ae ky" href="https://unsplash.com/@ventiviews" rel="noopener ugc nofollow" target="_blank"> Venti Views </a>在<a class="ae ky" href="https://unsplash.com/photos/35uZM_4wjYg" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上提供)</p></figure><p id="8df9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您肯定熟悉上下文管理器——他们使用<code class="fe lv lw lx ly b">with</code>语句:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="3566" class="md me it ly b gy mf mg l mh mi">with open('somefile.text', 'r') as file:<br/>   data = file.read()</span></pre><p id="aed8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将关注调用上下文管理器时会发生什么:</p><ul class=""><li id="02c0" class="mj mk it lb b lc ld lf lg li ml lm mm lq mn lu mo mp mq mr bi translated">什么是上下文管理器？</li><li id="a1b9" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated">它是如何工作的？</li><li id="8f5c" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated">它的优点是什么？</li><li id="5370" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated">创建您自己的上下文管理器</li></ul><p id="cf06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们来编码吧！</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><p id="bcd1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们使用上下文管理器进行一些真实的代码示例之前，我们将通过一个清晰的示例来理解其内部工作原理:想象我们正在编写一把光剑。</p><div class="ne nf gp gr ng nh"><a rel="noopener follow" target="_blank" href="/six-levels-of-python-decorators-1f12c9067b23"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd iu gy z fp nm fr fs nn fu fw is bi translated">理解Python装饰者:从初学者到专家的六个层次的装饰者</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">装饰者如何工作，何时使用它们，以及6个越来越复杂的例子</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">towardsdatascience.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv ks nh"/></div></div></a></div></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h2 id="a5f1" class="md me it bd nw nx ny dn nz oa ob dp oc li od oe of lm og oh oi lq oj ok ol om bi translated">设置:编写光剑代码</h2><p id="cf7c" class="pw-post-body-paragraph kz la it lb b lc on ju le lf oo jx lh li op lk ll lm oq lo lp lq or ls lt lu im bi translated">我敢肯定每个人都很熟悉这些:超级危险的，赤热的等离子刀片，它可以切开它碰到的一切。在我们用它们刺或砍之前，我们需要激活它，在我们用完后，我们应该总是关闭这个危险的设备。在代码中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="6def" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没什么特别的:我们跟踪两个属性:<code class="fe lv lw lx ly b">color</code>和<code class="fe lv lw lx ly b">active</code>。在这个例子中<code class="fe lv lw lx ly b">color</code>是非常装饰性的，<code class="fe lv lw lx ly b">active</code>是非常重要的，因为如果我们激活了军刀，我们只能使用<code class="fe lv lw lx ly b">slash()</code>和<code class="fe lv lw lx ly b">stab()</code>方法。我们有两个控制状态的函数:<code class="fe lv lw lx ly b">turn_on()</code>和<code class="fe lv lw lx ly b">turn_off()</code>。</p><p id="530f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您使用这段代码的方式如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="5791" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码的维护成本相当高；我们不能忘记打开我们的光剑，否则它会抛出一个异常。而且我们每次都需要调用<code class="fe lv lw lx ly b">turn_off()</code>方法。我们怎样才能让这段代码更容易使用呢？</p><div class="ne nf gp gr ng nh"><a rel="noopener follow" target="_blank" href="/multi-tasking-in-python-speed-up-your-program-10x-by-executing-things-simultaneously-4b4fc7ee71e"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd iu gy z fp nm fr fs nn fu fw is bi translated">Python中的多任务处理:通过同时执行，将程序速度提高10倍</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">应用线程和进程加速代码的分步指南</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">towardsdatascience.com</p></div></div><div class="nq l"><div class="ou l ns nt nu nq nv ks nh"/></div></div></a></div></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h2 id="eef9" class="md me it bd nw nx ny dn nz oa ob dp oc li od oe of lm og oh oi lq oj ok ol om bi translated">何时使用上下文管理器？</h2><p id="5b39" class="pw-post-body-paragraph kz la it lb b lc on ju le lf oo jx lh li op lk ll lm oq lo lp lq or ls lt lu im bi translated">以我们的光剑为例，我们总是需要打开光剑，然后才能用它做任何事情。另外，我们<strong class="lb iu"> <em class="ov">总是</em> </strong>需要关掉它，因为否则我们就不能用它，而且现在能源价格相当高。</p><p id="05d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记住，为了打开和关闭saber，我们需要调用<code class="fe lv lw lx ly b">turn_on()</code>和<code class="fe lv lw lx ly b">turn_off()</code>方法。对于上下文管理器来说，光剑是一个理想的用例，因为我们需要在每次使用它之前和/或之后执行一个动作。T12】</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h2 id="ceab" class="md me it bd nw nx ny dn nz oa ob dp oc li od oe of lm og oh oi lq oj ok ol om bi translated">用上下文管理器更新光剑</h2><p id="57c6" class="pw-post-body-paragraph kz la it lb b lc on ju le lf oo jx lh li op lk ll lm oq lo lp lq or ls lt lu im bi translated">我们将在我们的光剑类中增加两个特殊的“dunder-methods”。Dunder-methods(双下划线-methods)覆盖定制类的内置函数的功能。你可能已经知道一种方法:T2方法！</p><p id="5af7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将添加一个<code class="fe lv lw lx ly b">__enter__</code>和<code class="fe lv lw lx ly b">__exit__</code>方法，所以我们的光剑类现在看起来像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="8d1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你将看到的，打开和关闭saber的函数在这些enter和exit方法中被调用。我们现在可以这样使用这个类:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="6d1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们点击<code class="fe lv lw lx ly b">with</code>语句，我们就进入<code class="fe lv lw lx ly b">__enter__</code>方法，这将打开我们的光剑。然后我们就可以尽情挥刀捅人了。一旦我们退出代码块，就会调用<code class="fe lv lw lx ly b">__exit__</code>方法关闭我们的光剑。</p><p id="7059" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">优势显而易见:</p><ul class=""><li id="4e54" class="mj mk it lb b lc ld lf lg li ml lm mm lq mn lu mo mp mq mr bi translated">我们的代码更加简洁。</li><li id="d172" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated">我们的代码更容易阅读。</li><li id="e443" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated">当我们想开始砍和刺的时候它会自动开启。</li><li id="9b2c" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated">当我们完成谋杀时，它会自动关闭，防止许多人试图将它藏起来而受伤。</li></ul><div class="ne nf gp gr ng nh"><a rel="noopener follow" target="_blank" href="/simple-trick-to-work-with-relative-paths-in-python-c072cdc9acb9"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd iu gy z fp nm fr fs nn fu fw is bi translated">在Python中使用相对路径的简单技巧</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">轻松计算运行时的文件路径</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">towardsdatascience.com</p></div></div><div class="nq l"><div class="ow l ns nt nu nq nv ks nh"/></div></div></a></div></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h2 id="d48f" class="md me it bd nw nx ny dn nz oa ob dp oc li od oe of lm og oh oi lq oj ok ol om bi translated">野外的上下文管理器</h2><p id="d82a" class="pw-post-body-paragraph kz la it lb b lc on ju le lf oo jx lh li op lk ll lm oq lo lp lq or ls lt lu im bi translated">光剑有点像玩具，但是在很多情况下会用到上下文管理器。下面的例子详细说明了Python读取文件的内置函数。默认方式如下所示:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="d51b" class="md me it ly b gy mf mg l mh mi">file = open('somefile.txt')<br/>content = file.read()<br/>file.close()</span></pre><p id="b374" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们在上面的例子中不调用<code class="fe lv lw lx ly b">file.close()</code>，那么我们的文件将被我们的脚本占用。这意味着没有其他进程可以访问它。让我们使用上下文管理器:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="1f33" class="md me it ly b gy mf mg l mh mi">with open('somefile.txt') as file:<br/>    content = file.read()</span></pre><p id="95cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码会自动关闭文件。它也更容易阅读。</p><p id="e9ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一个例子是数据库连接。在我们创建了到数据库的连接并使用它来读取/写入数据到数据库之后，我们不能忘记提交数据并关闭连接。常规实施:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="b526" class="md me it ly b gy mf mg l mh mi">cursor = conn.cursor()<br/>cursor.execute("SELECT * FROM sometable")<br/>cursor.close()</span></pre><p id="f5aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，许多包都实现了这样的上下文管理器:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="bcf9" class="md me it ly b gy mf mg l mh mi">with dbconnection.connect() as con:<br/>    result = con.execute("SELECT * FROM sometable")</span></pre><p id="d02c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码确保连接在我们完成后立即关闭。目前，我正在创建一个将Python连接到数据库的指南；有兴趣就跟着我吧！</p><div class="ne nf gp gr ng nh"><a rel="noopener follow" target="_blank" href="/create-a-fast-auto-documented-maintainable-and-easy-to-use-python-api-in-5-lines-of-code-with-4e574c00f70e"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd iu gy z fp nm fr fs nn fu fw is bi translated">用5行代码创建一个快速、自动记录、可维护且易于使用的Python API</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">非常适合只需要一个完整、有效、快速和安全的API的(没有经验的)开发人员</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">towardsdatascience.com</p></div></div><div class="nq l"><div class="ox l ns nt nu nq nv ks nh"/></div></div></a></div></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="b6e8" class="oy me it bd nw oz pa pb nz pc pd pe oc jz pf ka of kc pg kd oi kf ph kg ol pi bi translated">结论</h1><p id="eef1" class="pw-post-body-paragraph kz la it lb b lc on ju le lf oo jx lh li op lk ll lm oq lo lp lq or ls lt lu im bi translated">在本文中，我们已经介绍了Python中日志记录的基础知识，我希望向您展示日志记录相对于打印的所有优势。下一步是添加文件处理程序，这样我们就可以将日志保存到文件中，通过电子邮件或API发送。请查看这篇文章。</p><p id="b020" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有任何改进这篇文章的建议；请评论！与此同时，请查看我的其他关于各种编程相关主题的文章，比如:</p><ul class=""><li id="04be" class="mj mk it lb b lc ld lf lg li ml lm mm lq mn lu mo mp mq mr bi translated"><a class="ae ky" href="https://mikehuls.medium.com/cython-for-absolute-beginners-30x-faster-code-in-two-simple-steps-bbb6c10d06ad" rel="noopener">面向绝对初学者的cyt hon——两步代码速度提高30倍</a></li><li id="6bdb" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated"><a class="ae ky" href="https://mikehuls.medium.com/why-is-python-so-slow-and-how-to-speed-it-up-485b5a84154e" rel="noopener">Python为什么这么慢，如何加速</a></li><li id="912b" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated">绝对初学者的Git:借助视频游戏理解Git</li><li id="926b" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated"><a class="ae ky" href="https://mikehuls.medium.com/dramatically-improve-your-database-inserts-with-a-simple-upgrade-6dfa672f1424" rel="noopener">在一行代码中显著提高数据库插入速度</a></li><li id="6e8b" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated"><a class="ae ky" href="https://mikehuls.medium.com/docker-for-absolute-beginners-the-difference-between-an-image-and-a-container-7e07d4c0c01d" rel="noopener"> Docker:图像和容器的区别</a></li><li id="9acd" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated"><a class="ae ky" href="https://mikehuls.medium.com/docker-for-absolute-beginners-what-is-docker-and-how-to-use-it-examples-3d3b11efd830" rel="noopener"> Docker对于绝对初学者——什么是Docker以及如何使用它(+示例)</a></li><li id="422a" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated"><a class="ae ky" href="https://mikehuls.medium.com/virtual-environments-for-absolute-beginners-what-is-it-and-how-to-create-one-examples-a48da8982d4b" rel="noopener">绝对初学者的虚拟环境——什么是虚拟环境，如何创建虚拟环境(+示例</a>)</li><li id="9bb2" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated"><a class="ae ky" href="https://mikehuls.medium.com/create-and-publish-your-own-python-package-ea45bee41cdc" rel="noopener">创建并发布你自己的Python包</a></li><li id="8a48" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated"><a class="ae ky" href="https://mikehuls.medium.com/cython-for-data-science-6-steps-to-make-this-pandas-dataframe-operation-over-100x-faster-1dadd905a00b" rel="noopener"> 6个步骤让熊猫数据帧运算速度提高100倍</a></li></ul><p id="3755" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！</p><p id="84d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">—迈克</p><p id="db8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">附注:喜欢我正在做的事吗？ <a class="ae ky" href="https://mikehuls.medium.com/membership" rel="noopener"> <em class="ov">跟我来！</em>T25】</a></p><div class="ne nf gp gr ng nh"><a href="https://mikehuls.medium.com/membership" rel="noopener follow" target="_blank"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd iu gy z fp nm fr fs nn fu fw is bi translated">通过我的推荐链接加入Medium—Mike Huls</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">mikehuls.medium.com</p></div></div><div class="nq l"><div class="pj l ns nt nu nq nv ks nh"/></div></div></a></div></div></div>    
</body>
</html>