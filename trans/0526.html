<html>
<head>
<title>Professional Treemaps in Python: The Better Alternative to a Pie Chart</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的专业树形图:饼图的更好替代方案</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/professional-treemaps-in-python-how-to-customize-matplotlib-squarify-efd5dc4c8755#2022-02-21">https://towardsdatascience.com/professional-treemaps-in-python-how-to-customize-matplotlib-squarify-efd5dc4c8755#2022-02-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="614b" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">数据可视化</h2><div class=""/><div class=""><h2 id="866e" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">理解rcParams &amp; Matplotlib色彩映射表</h2></div><p id="fef6" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">作为一个狂热的python爱好者，我最近想用python生成一个可供发布的treemap。树映射通常用于使用嵌套矩形显示分层的分类数据。树形图的每一片叶子都是一个时尚的矩形饼状图，它将分类数据可视化。然而，关于如何生成树图，尤其是如何生成好看的树图的可用文档很少…</p><p id="9257" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">本文的目的是分享使用<a class="ae ln" href="https://github.com/laserson/squarify" rel="noopener ugc nofollow" target="_blank"> Squarify </a>包定制树形图的技巧和诀窍。这篇文章关注的是叶子级的树图，而不是嵌套……(如果对一个关于嵌套的帖子感兴趣，在下面评论！).然而，类似于<a class="ae ln" rel="noopener" target="_blank" href="/professional-venn-diagrams-in-python-638abfff39cc">维恩图教程</a>，这些技巧中的许多适用于<strong class="kt jd">任何基于Matplotlib构建的</strong>包(例如Seaborn、plotnine等。).希望本教程能帮助您有效地定制树形图，以生成可用于发布、仪表板或报告的图形。完整的笔记本托管在<a class="ae ln" href="https://github.com/katewall/medium_tutorials/blob/main/210219_Medium_Squarify_Matplotlib.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上。</p></div><div class="ab cl lo lp hx lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="im in io ip iq"><p id="53a8" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">以下数据集是一个玩具数据集，用于演示如何在树形图中快速利用熊猫数据框中的数据。需要注意的是，您不需要使用数据帧。事实上，使用列表会更快。然而，我选择了广泛使用的结构，以便在更大规模的应用中高效使用。使用下面的代码，我生成了一个简单的案例:三组项目A、B、c。</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="83d1" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在这种情况下，组成员(如人员1、人员2、…)不是唯一的。例如，person1是所有三个组[A、B和C]的成员，并且被多次计数。对于数据可视化练习来说，这是不相关的，但是在应用到您的数据时，请记住这一点。</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="mc mb l"/></div><p class="md me gj gh gi mf mg bd b be z dk translated">由我使用<a class="ae ln" href="http://app.datawrapper.de" rel="noopener ugc nofollow" target="_blank">数据包装器</a>创建</p></figure><p id="9d48" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">以下代码将数据从上述格式转换为压缩的分组格式。</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="ma mb l"/></div></figure><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="mh mb l"/></div></figure><h1 id="e975" class="mi mj it bd mk ml mm mn mo mp mq mr ms ki mt kj mu kl mv km mw ko mx kp my mz bi translated">形象化</h1><p id="7200" class="pw-post-body-paragraph kr ks it kt b ku na kd kw kx nb kg kz la nc lc ld le nd lg lh li ne lk ll lm im bi translated">现在，我们开始将可视化应用于一个非常简单的3矩形案例。</p><p id="9994" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">使用prep_df表，我们使用Squarify对一个正方形3x3图形(dx x dy图形)的计数数据进行归一化。然后，我们绘制标准化的值和标签，使用完全饱和的颜色(alpha=1)，并在矩形之间应用填充(padding=True)。</p><p id="e2ca" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我们最终得到了一些位置很好的方块，但是没有一个头脑正常的人会把这个图给他们的老板看。</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="ma mb l"/></div></figure><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/cb950cc6ab14188e078ba7bb877b82e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*-xXpOUX9nWM1jo2naN26Dw.png"/></div><p class="md me gj gh gi mf mg bd b be z dk translated">默认值，由作者生成</p></figure><p id="bcd4" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">接下来，我们移除轴。做完那件事后，我身体上感觉平静多了。我们可以通过修改底层Matplotlib呈现中的rcParams字典来定制标签的文本颜色和文本大小。在这里，我调用matplotlib作为mpl，并调整font.size和font.color <strong class="kt jd">键的<strong class="kt jd">值</strong>。</strong>我还手动指定了我希望Squarify用来绘图的颜色列表。这个情节看起来干净多了！</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="ma mb l"/></div></figure><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/7d50d5c5d7104dad376ac866da17eb8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*ATvFt5ql9wXUXR2QU5HLZA.png"/></div><p class="md me gj gh gi mf mg bd b be z dk translated">手动颜色和字体，由作者生成</p></figure><p id="ea65" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">现在，我们可能赶时间。如果我们不想手动选择颜色，我们可以从Matplotlib颜色图中随机选择一组颜色。然而，这些数字有些看起来很好，有些看起来真的很差。幸运的是，你可以尝试不同的随机种子，直到你得到你喜欢的颜色。这个还可以。</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="ma mb l"/></div></figure><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/e5ac6382c295aed9aef3505e64c3f633.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*lUvpYG4pPhjzXbJRKd3hqQ.png"/></div><p class="md me gj gh gi mf mg bd b be z dk translated">随机颜色，由作者生成</p></figure><h1 id="8536" class="mi mj it bd mk ml mm mn mo mp mq mr ms ki mt kj mu kl mv km mw ko mx kp my mz bi translated"><strong class="ak">Matplotlib彩色地图究竟是如何工作的？</strong></h1><p id="3ce7" class="pw-post-body-paragraph kr ks it kt b ku na kd kw kx nb kg kz la nc lc ld le nd lg lh li ne lk ll lm im bi translated">要了解底层色彩映射表是如何使用的，请参见下文。对于每个方块，我们可以使用0到1之间的任意数字来代替随机值。唯一的问题是列表中的数字应该是不同的。</p><p id="d517" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">使用len(counts)=3的组数，我们可以继续创建一个介于0和1之间的值的顺序列表，使用1/3的间距来保持每个值的不同。在Out[9]的下面，显示出你得到一个3元素列表:0，0.33，0.66。</p><p id="6b7b" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">接下来，我们可以使用色图调色板将I的每个值映射到RGBA颜色值(红色、绿色、蓝色、不透明度)。Matplotlib有许多<a class="ae ln" href="https://matplotlib.org/stable/gallery/color/colormap_reference.html" rel="noopener ugc nofollow" target="_blank">色彩映射表</a>可供选择。我使用了“等离子体”色图，这是cmap功能的一个参数。cmap函数的作用是获取[0，1]之间的输入，并将其转换为RGBA。红色、绿色、蓝色值的范围是[0，1],而不是您可能熟悉的[0，255]。这个结果产生了嵌套列表，我们称之为mapped_list，它仍然包含3个顶级元素。每个元素都是一个RGBA元组。</p><p id="0300" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">最后，我们使用mapped_list作为Squarify函数中的颜色参数进行绘图。这表明我们可以使用色彩映射表，并且仍然可以对它们进行一定程度的控制。使用色彩映射表不需要猜测和检查的努力！</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nj"><img src="../Images/fb957527f169f95e4c45efc202832cc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MZ1yCBgCeynO-P90n5S_wg.png"/></div></div></figure><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/2fc556eaa8e0aac2aa29f4ef9e2e918f.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*MPMNGc8xcRLqof88A2mVoA.png"/></div><p class="md me gj gh gi mf mg bd b be z dk translated">等离子色彩图，由作者生成</p></figure><p id="b76e" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">现在，对于任何适当的报告，我们需要添加一个标题。但是如果我们坚持使用默认选项，我们将会以这个不令人满意的占位符结束，因为图形的文本字体是白色的。如果我们改变字体颜色，我们最终会得到难看的标签文本。第二十二条军规！但是不要害怕，凯特在这里！</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="ma mb l"/></div></figure><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div class="gh gi no"><img src="../Images/0bbf08586bb98ae9d2c66ee7c4a7a1bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/format:webp/1*VyRvAMCDOGsDB_1AMur4lg.png"/></div><p class="md me gj gh gi mf mg bd b be z dk translated">标题占位符，由作者生成</p></figure><p id="f363" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在我们在子图形中使用标题技术之前，我发现给一个单独的图形添加标题的最简单的方法是添加一个额外的文本框。我们可以定制对齐方式以使图形居中，并定制绘图顺序(zorder ),以确保它绘制在下方白色标题文本的顶部。</p><p id="d056" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">注意坐标。我们在位置(50，100)绘制标题框。坐标(0，0)映射到图的左下区域。(100，0)映射到图的右下区域。</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="ma mb l"/></div></figure><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/f90a2576e5543f2ee16e4e547e7ee0a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*D0zpWqfgh9LkzVVfbTpUIQ.png"/></div><p class="md me gj gh gi mf mg bd b be z dk translated">标题作为自定义文本添加，由作者生成</p></figure><p id="7cd2" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在我们继续进行子绘制之前，我想提醒大家注意一个事实，即有更多的定制选项可用。rcParams在教程中不常用到，但是很容易访问！要找出可以定制的内容，只需调用rcParams字典的键:</p><pre class="lv lw lx ly gt np nq nr ns aw nt bi"><span id="88e6" class="nu mj it nq b gy nv nw l nx ny">mpl.rcParams.keys()</span></pre><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nz"><img src="../Images/cc602019c8a0cd359ef34c6df455721d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6iBVmPnazO49jNdangES-w.png"/></div></div><p class="md me gj gh gi mf mg bd b be z dk translated">rcParams中一些可用的自定义选项，由作者打印</p></figure><h1 id="b2b1" class="mi mj it bd mk ml mm mn mo mp mq mr ms ki mt kj mu kl mv km mw ko mx kp my mz bi translated">用支线剧情升级</h1><p id="7fcd" class="pw-post-body-paragraph kr ks it kt b ku na kd kw kx nb kg kz la nc lc ld le nd lg lh li ne lk ll lm im bi translated">最后，使用Squarify最有用的方法是制作复杂的树形图。为了增加复杂性，通常需要将多个底层地图拼凑在一起。可以使用前面讨论的所有技术定制每个底层图形。我们将使用随机生成的8个矩形序列绘制6个单独的图。有多种方法可以自定义每个支线剧情。对于代码，点击<a class="ae ln" href="https://gist.githubusercontent.com/katewall/df1d98801a44fb738d153eb4e23c7ea6/raw/bb3f50844ba53e877ef1dd9229404486b453839f/subplots1.py" rel="noopener ugc nofollow" target="_blank">这里</a>只是这个数字，或<a class="ae ln" href="https://github.com/katewall/medium_tutorials/blob/main/210219_Medium_Squarify_Matplotlib.ipynb" rel="noopener ugc nofollow" target="_blank">这里</a>为整个笔记本。</p><h2 id="e2b4" class="nu mj it bd mk oa ob dn mo oc od dp ms la oe of mu le og oh mw li oi oj my iz bi translated">图像支线剧情</h2><ol class=""><li id="c330" class="ok ol it kt b ku na kx nb la om le on li oo lm op oq or os bi translated">默认设置。</li><li id="a9db" class="ok ol it kt b ku ot kx ou la ov le ow li ox lm op oq or os bi translated">手动指定颜色。这导致整个图形重复两种颜色。这对于艺术目的来说是有趣的，但是对于解释的目的来说可能是误导的。</li><li id="45b8" class="ok ol it kt b ku ot kx ou la ov le ow li ox lm op oq or os bi translated">使用之前相同的技术指定颜色。</li><li id="c59c" class="ok ol it kt b ku ot kx ou la ov le ow li ox lm op oq or os bi translated">按顺序添加标签。</li><li id="3c0d" class="ok ol it kt b ku ot kx ou la ov le ow li ox lm op oq or os bi translated">添加非标准化值。</li><li id="f778" class="ok ol it kt b ku ot kx ou la ov le ow li ox lm op oq or os bi translated">添加标签和值并更改字体大小。</li></ol><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi oy"><img src="../Images/a4f72968779cf17a6dce5bf8e9a8a046.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*THw9c-8_FzaKp7ao88V7qQ.png"/></div></div><p class="md me gj gh gi mf mg bd b be z dk translated">多个支线剧情使用Squarify，由我生成</p></figure><p id="f2d0" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">最后，你可以删除支线剧情和标题之间的空白来制作一个复合树形图！</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="ma mb l"/></div></figure><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi oz"><img src="../Images/21944f47a1522632b108548a996045af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LY67A9Ho5NCrPTky1D1Rjg.png"/></div></div><p class="md me gj gh gi mf mg bd b be z dk translated">浓缩支线剧情，由我生成</p></figure><p id="3756" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">作为我的最后一个技巧，女士们先生们，我使用了<a class="ae ln" href="https://seaborn.pydata.org/generated/seaborn.color_palette.html" rel="noopener ugc nofollow" target="_blank"> Seaborn color_palette </a>而不是<a class="ae ln" href="https://matplotlib.org/stable/gallery/color/colormap_reference.html" rel="noopener ugc nofollow" target="_blank"> Matplotlib colormap </a>来自动生成配色方案。Seaborn通常包含比Matplotlib更专业的配色方案集合，我们可以使用Squarify轻松地使用它们！此外，我们可以通过调用颜色映射列表中的np.flip()函数来更改颜色顺序的顺序(见第18行)。</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="ma mb l"/></div></figure><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/76692622d0865eec76d43261ca426411.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*3SiZWyb7A5BcZbvRtYggrw.png"/></div><p class="md me gj gh gi mf mg bd b be z dk translated">作者用Seaborn调色板生成的摘要图</p></figure><p id="9fa8" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">本教程是一个练习(1)学习一个新的可视化工具和(2)使matplotlib不那么笨拙。如果您希望看到特定的定制，请在下面发表评论！Medium的社区教程非常精彩，我的教程受到了像<a class="ae ln" href="https://betterprogramming.pub/how-to-use-colormaps-with-matplotlib-to-create-colorful-plots-in-python-969b5a892f0c" rel="noopener ugc nofollow" target="_blank">这个</a>这样的好例子的启发。</p><p id="bfb4" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">是时候绘制一张树状图了！</p><h2 id="9fd1" class="nu mj it bd mk oa ob dn mo oc od dp ms la oe of mu le og oh mw li oi oj my iz bi translated">参考</h2><ol class=""><li id="7745" class="ok ol it kt b ku na kx nb la om le on li oo lm op oq or os bi translated">创作者<a class="ae ln" href="https://github.com/laserson" rel="noopener ugc nofollow" target="_blank">尤里·拉森</a>写了这个Squarify包。</li></ol><p id="f25e" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">喜欢这篇文章吗？下面更喜欢！</p><div class="pb pc gp gr pd pe"><a href="https://www.linkedin.com/in/kate-wall/" rel="noopener  ugc nofollow" target="_blank"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd jd gy z fp pj fr fs pk fu fw jc bi translated">凯特·沃尔-休斯敦德克萨斯大学健康科学中心研究生助理…</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">在全球最大的职业社区LinkedIn上查看凯特·沃尔的个人资料。凯特有一份工作列在他们的…</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">www.linkedin.com</p></div></div><div class="pn l"><div class="po l pp pq pr pn ps ng pe"/></div></div></a></div><div class="pb pc gp gr pd pe"><a rel="noopener follow" target="_blank" href="/professional-venn-diagrams-in-python-638abfff39cc"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd jd gy z fp pj fr fs pk fu fw jc bi translated">python中的专业维恩图</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">从熊猫数据帧生成带有定制标签和图例的3向Venns</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">towardsdatascience.com</p></div></div><div class="pn l"><div class="pt l pp pq pr pn ps ng pe"/></div></div></a></div><div class="pb pc gp gr pd pe"><a rel="noopener follow" target="_blank" href="/access-google-drive-using-google-colab-running-an-r-kernel-3736db7835"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd jd gy z fp pj fr fs pk fu fw jc bi translated">使用运行R内核的Google Colab访问Google Drive</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">从Google Drive文件或直接从web URLs导入数据</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">towardsdatascience.com</p></div></div><div class="pn l"><div class="pu l pp pq pr pn ps ng pe"/></div></div></a></div><div class="pb pc gp gr pd pe"><a rel="noopener follow" target="_blank" href="/probability-distributions-for-beginners-d14f59aba2cb"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd jd gy z fp pj fr fs pk fu fw jc bi translated">初学者的概率分布</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">初级统计，基本概念，伯努利分布</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">towardsdatascience.com</p></div></div><div class="pn l"><div class="pv l pp pq pr pn ps ng pe"/></div></div></a></div></div></div>    
</body>
</html>