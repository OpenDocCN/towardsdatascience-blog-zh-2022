<html>
<head>
<title>Analyze CAZy with dbt, Snowflake, and Preset</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用dbt、雪花和预设分析CAZy</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/analyze-cazy-with-dbt-snowflake-and-preset-2eae46856e10#2022-05-10">https://towardsdatascience.com/analyze-cazy-with-dbt-snowflake-and-preset-2eae46856e10#2022-05-10</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="2c03" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">如何用现代数据栈做生物信息学</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/4b305c552a6a0f848987d755f7759a25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dJ_wB--kyJIJUnB5R3BUOg.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">在<a class="ae kz" href="https://unsplash.com/s/photos/snowflake?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kz" href="https://unsplash.com/@zmachacek?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">zdenk macha ek</a>拍摄的照片</p></figure><p id="90da" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="http://www.cazy.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="lc iv"> C </strong>碳水化合物-<strong class="lc iv">A</strong>active en<strong class="lc iv">ZY</strong>mes(CAZy)</a>数据库是一个门户网站，提供有关合成、修饰或降解碳水化合物的酶(CAZymes)的信息。对于基因组科学家来说，这是一个非常有价值的资源。他们使用CAZy数据库来识别新的CAZymes，预测它们的功能并研究新的基因组。在我之前的文章<a class="ae kz" href="https://medium.com/p/dba8500b45cf" rel="noopener"> <em class="lw">图数据库、GraphQL和碳水化合物活性酶的机器学习</em> </a>中，我已经将CAZy放入Neo4j图中，对它们进行分析，并使用图机器学习来获得一些新的见解。</p><p id="94b3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然而，从CAZy下载数据一直相当困难。它的前身是一个纯文本网站。虽然最新的更新在其网页界面上添加了下载按钮，但可下载的内容仍然只是我们在网站上看到的一个片段。此外，CAZy团队准备了很好的克朗图，但没有告诉我们如何复制它们。</p><p id="aa47" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们把这变成一个很好的生物信息学练习。在本文中，我将从CAZy下载数据，将其导入<a class="ae kz" href="https://www.snowflake.com/" rel="noopener ugc nofollow" target="_blank">雪花</a>，通过<strong class="lc iv">数据构建工具</strong> ( <a class="ae kz" href="https://www.getdbt.com/" rel="noopener ugc nofollow" target="_blank"> dbt </a>)提取一些CAZy家族的taxids，并在雪花和预设中生成克朗图和仪表板。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj lx"><img src="../Images/6aab6fe0a019a812738ac045a4cfbd6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NRpBdFotWQtsYhA2u0qIOw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">图一。该项目的工作流。图片作者。</p></figure><p id="abf1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">是的，对于这样一个小任务来说，dbt+雪花看起来有点大材小用了。我们完全可以用Jupyter笔记本或SQLite项目完成同样的事情，甚至只需要几个Bash命令。但是我忍不住让自己进入了数据仓库和现代数据堆栈的热门话题。当我在Udemy完成了Toth等人的优秀的dbt课程后。我想探索一下数据仓库到底是什么，以及我是否可以在未来的项目中使用它。此外，完全在云上处理大量数据也有一定的吸引力。CAZy的数据是一个很好的入门资料。你可以在我的GitHub仓库中找到这个项目的代码。</p><div class="ly lz gq gs ma mb"><a href="https://github.com/dgg32/cazy_dbt_public" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fp"><div class="md ab me cl cj mf"><h2 class="bd iv gz z fq mg fs ft mh fv fx it bi translated">GitHub - dgg32/cazy_dbt_public</h2><div class="mi l"><h3 class="bd b gz z fq mg fs ft mh fv fx dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mj l"><p class="bd b dl z fq mg fs ft mh fv fx dk translated">github.com</p></div></div><div class="mk l"><div class="ml l mm mn mo mk mp kt mb"/></div></div></a></div><h1 id="3806" class="mq mr iu bd ms mt mu mv mw mx my mz na ka nb kb nc kd nd ke ne kg nf kh ng nh bi translated">1.雪花</h1><p id="9b7c" class="pw-post-body-paragraph la lb iu lc b ld ni jv lf lg nj jy li lj nk ll lm ln nl lp lq lr nm lt lu lv in bi translated">首先，你需要一个雪花账户。你可以在这里报名试用<a class="ae kz" href="https://signup.snowflake.com/" rel="noopener ugc nofollow" target="_blank">。选择<code class="fe nn no np nq b">Standard</code>版本和<code class="fe nn no np nq b">AWS</code>作为您的云提供商。通过电子邮件激活您的帐户，并创建您自己的用户名和密码。雪花会再次给你发邮件。在这两封电子邮件中，您会发现您的帐户URL采用以下格式:</a></p><pre class="kk kl km kn gu nr nq ns nt aw nu bi"><span id="9e8e" class="nv mr iu nq b gz nw nx l ny nz">https://[random_string.region].snowflakecomputing.com</span></pre><p id="4e3f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">请注意，[random_string.region]是您的帐户名称</strong>。所以把你的账户名复制并粘贴到一个笔记本上，因为你以后会用到它。</p><p id="1b70" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">一旦你进入雪花的界面，点击<code class="fe nn no np nq b">+ Worksheet</code>。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oa"><img src="../Images/7250d7fd8bc2f2423d696d829ec2be8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hptEPEdjNadwsANbbFusdQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">图二。在雪花中添加您的第一个工作表。图片作者。</p></figure><p id="00ab" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在工作表中，您现在可以执行SQL查询。让我们首先用下面的SQL查询为雪花数据库创建一个用户及其角色。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ob oc l"/></div></figure><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj od"><img src="../Images/c45504ff67930db988781d8776284ff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KOCvHddiXFPf0EZCV-v3ew.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">图3。在工作表中执行SQL查询以初始化数据库。图片作者。</p></figure><p id="5871" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">上面的查询创建了一个用户<strong class="lc iv"/><code class="fe nn no np nq b"><strong class="lc iv">dbt</strong></code><strong class="lc iv">，密码为</strong> <code class="fe nn no np nq b"><strong class="lc iv">dbtPassword123</strong></code> <strong class="lc iv">。它有</strong> <code class="fe nn no np nq b"><strong class="lc iv">transform</strong></code> <strong class="lc iv">的作用，数据仓库叫做</strong> <code class="fe nn no np nq b"><strong class="lc iv">COMPUTE_WH</strong></code> <strong class="lc iv">。然后查询创建一个名为</strong> <code class="fe nn no np nq b"><strong class="lc iv">CAZY</strong></code>的数据库和一个模式<code class="fe nn no np nq b">RAW</code>。</p><p id="c4d7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">保持在同一个工作表中，粘贴并执行以下查询，将数据导入数据库。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ob oc l"/></div></figure><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oe"><img src="../Images/7bade8694bd3e15e2d4a3f23702dd07b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WnLMtp8BqdWD7ONDnyzoVQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">图4。在工作表中执行SQL查询，将数据导入数据库。图片作者。</p></figure><p id="4c33" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这些查询创建了两个表<code class="fe nn no np nq b">RAW_CAZY_DATA</code>和<code class="fe nn no np nq b">RAW_CAZY_GENOME</code>。然后，他们从我的S3 (public)获取两个CSV文件，并将它们导入到表中。您可以在雪花中预览这两个表格。第一个文件是从CAZy下载的。在第二个文件中，我在pyphy的帮助下将taxid扩展为NCBI分类法，pyphy的云版本在我的第一篇文章中有描述。</p><h1 id="e536" class="mq mr iu bd ms mt mu mv mw mx my mz na ka nb kb nc kd nd ke ne kg nf kh ng nh bi translated">2.dbt</h1><p id="95f1" class="pw-post-body-paragraph la lb iu lc b ld ni jv lf lg nj jy li lj nk ll lm ln nl lp lq lr nm lt lu lv in bi translated">dbt是一个数据转换器。您首先像雪花一样将dbt与您的数据仓库连接起来。然后，通过在模型文件中编写SQL SELECT查询，开始提取、组合和转换数据。在一个称为物化的过程中，每个模型通常会变成数据仓库中的一个视图或一个表(还有另外两种物化形式，称为“增量”和“短暂”)。虽然开发人员在本地编写dbt代码，但是计算完全是在云上完成的。最后，您可以使用仪表板可视化转换后的数据。</p><p id="15fd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这个项目中，我们想研究糖苷水解酶家族17 (GH17)的分类组成。也就是说，我们想要计算每个分类群中GH17基因的数量。因为我们将在克朗图和仪表板中可视化结果，所以我们将在dbt中编写两个模型:<code class="fe nn no np nq b">family_taxid</code>和<code class="fe nn no np nq b">family_taxon</code>。</p><p id="4f7c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在你的本地电脑上安装<a class="ae kz" href="https://anaconda.org/conda-forge/dbt" rel="noopener ugc nofollow" target="_blank">dbt-雪花</a>。运行以下命令启动dbt项目:</p><pre class="kk kl km kn gu nr nq ns nt aw nu bi"><span id="9fb2" class="nv mr iu nq b gz nw nx l ny nz">dbt init cazy</span></pre><p id="8727" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">按照提示完成注册。您将需要您的帐户名称。然后你可以填写你的用户名<code class="fe nn no np nq b">dbt</code>，密码<code class="fe nn no np nq b">dbtPassword123</code>，角色<code class="fe nn no np nq b">transform</code>，仓库<code class="fe nn no np nq b">COMPUTE_WH</code>，数据库<code class="fe nn no np nq b">cazy</code>，模式<code class="fe nn no np nq b">dev</code>。我用了4根线。当它完成时，dbt将创建两个文件夹:<code class="fe nn no np nq b">cazy</code>和<code class="fe nn no np nq b">log</code>。删除<code class="fe nn no np nq b">models</code>文件夹下的<code class="fe nn no np nq b">example</code>文件夹。还要删除dbt_project.yml中的最后两行(示例:+materialized: view)。</p><p id="28c8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">此外，我想为表<code class="fe nn no np nq b">RAW_CAZY_DATA</code>定义一个别名“基因”,为<code class="fe nn no np nq b">RAW_CAZY_GENOME</code>定义一个别名“基因组”。将以下内容复制粘贴到一个名为<code class="fe nn no np nq b">source.yml</code>的文件中，放在<code class="fe nn no np nq b">models</code>文件夹下。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ob oc l"/></div></figure><h2 id="c8e3" class="nv mr iu bd ms of og dn mw oh oi dp na lj oj ok nc ln ol om ne lr on oo ng op bi translated">2.1克朗的family_taxid模型</h2><p id="40aa" class="pw-post-body-paragraph la lb iu lc b ld ni jv lf lg nj jy li lj nk ll lm ln nl lp lq lr nm lt lu lv in bi translated">现在在<code class="fe nn no np nq b">models</code>文件夹下创建一个名为<code class="fe nn no np nq b">family_taxid.sql</code>的文件。它应该有以下内容。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="cb58" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">该模型在调用时需要用户提供CAZy家族名称。然后，它将在雪花的DEV模式中创建一个名为[CAZy_family]_taxid(第1行)的视图。SQL查询以两个“with”子句开始。他们从两个表中选择必要的列:<code class="fe nn no np nq b">gene</code>和<code class="fe nn no np nq b">genome</code>(第3到12行)。这两个表通过名称匹配在“WHERE”子句中连接。WHERE子句只保留用户指定的CAZy系列中的数据。它还确保taxid不为空(第17行)。因为Krona可以单独使用taxid，所以我的SELECT子句只选择taxid和accessions作为输出(第14和15行)。</p><h2 id="e5ab" class="nv mr iu bd ms of og dn mw oh oi dp na lj oj ok nc ln ol om ne lr on oo ng op bi translated">2.2科_分类单元模型</h2><p id="4984" class="pw-post-body-paragraph la lb iu lc b ld ni jv lf lg nj jy li lj nk ll lm ln nl lp lq lr nm lt lu lv in bi translated">类似的，<code class="fe nn no np nq b">taxid_taxon.sql</code>模型看起来是这样的。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="2897" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">与<code class="fe nn no np nq b">family_taxid</code>模型相比，<code class="fe nn no np nq b">family_taxon</code>模型需要超界、门、类和属的数据来代替taxid。雪花和预设都将使用这些列来生成图表。</p><h2 id="14aa" class="nv mr iu bd ms of og dn mw oh oi dp na lj oj ok nc ln ol om ne lr on oo ng op bi translated">2.3运行dbt</h2><p id="79ca" class="pw-post-body-paragraph la lb iu lc b ld ni jv lf lg nj jy li lj nk ll lm ln nl lp lq lr nm lt lu lv in bi translated">现在是运行dbt并创建视图的时候了。在<code class="fe nn no np nq b">cazy</code>文件夹中运行以下命令。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="bb4f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当一切顺利运行时，您应该会看到如下所示的控制台输出。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oq"><img src="../Images/731d5728de46c3bebf74977ef20d9d6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7xgdFOQvzVzvPfPgzpsC_Q.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">图5。dbt运行。图片作者。</p></figure><p id="1aca" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在去你的雪花刷新。您应该在<code class="fe nn no np nq b">DEV</code>模式下看到两个视图。您也可以预览数据(图6)。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj or"><img src="../Images/08a1b888417fe5b3efc9044ca3c6cce1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hmT6p8_7u0cBUFErW9w84A.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">图6。dbt运行后的雪花。图片作者。</p></figure><h1 id="0b56" class="mq mr iu bd ms mt mu mv mw mx my mz na ka nb kb nc kd nd ke ne kg nf kh ng nh bi translated">3.克朗图</h1><p id="3b9f" class="pw-post-body-paragraph la lb iu lc b ld ni jv lf lg nj jy li lj nk ll lm ln nl lp lq lr nm lt lu lv in bi translated">现在从<a class="ae kz" href="https://github.com/marbl/Krona/releases" rel="noopener ugc nofollow" target="_blank">这里</a>下载最新的KronaTools版本。您需要运行其updateTaxonomy.sh。它将从NCBI下载taxdump.tar.gz并对其进行预处理。但是，我建议您自己在这里下载文件，并将其放在KronaTools的<code class="fe nn no np nq b">taxonomy</code>文件夹下，因为脚本每次都无法下载。</p><p id="1b02" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们现在需要从雪花下载我们的GH17_TAXID视图到我们的本地计算机。据我所知，从Snowflake下载数据的唯一方法是运行像这样的Python脚本。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="dd16" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你可以这样运行它。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="90b7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这次运行在当前文件夹下生成一个名为<code class="fe nn no np nq b">GH17.tsv</code>的TSV文件。</p><p id="5225" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在我们用下面的命令生成克朗图。“-q 2”表示我们的查询标识符在第二列，而“-t 1”表示taxids在我们的<code class="fe nn no np nq b">GH17.tsv</code>文件的第一列。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="ae9e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你可以在你的<code class="fe nn no np nq b">KronaTools</code>文件夹下的<code class="fe nn no np nq b">scripts</code>文件夹下找到<code class="fe nn no np nq b">ImportTaxonomy.pl</code>。这个命令将生成一个HTML文件。打开HTML文件，您可以看到GH17的克朗图。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj os"><img src="../Images/26ea8285e5c49cb077ac9e3b8729beeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lK_RfUOqWaWm5r9TTXjB4A.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">图7。GH17的克朗图。图片作者。</p></figure><p id="7fc5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">从图表中，你可以看到大约一半的GH17酶来自真核生物，另一半来自细菌。变形菌，尤其是γ变形菌，占了绝大部分。值得一提的是，我们的克朗图和CAZy官方的不一样。我们的图表统计了每个分类群下不同的酶，而官方的图表只统计了不同的分类群。当然，我们也可以在dbt模型中使用DISTINCT关键字来复制官方的。</p><h1 id="c0bb" class="mq mr iu bd ms mt mu mv mw mx my mz na ka nb kb nc kd nd ke ne kg nf kh ng nh bi translated">4.仪表盘</h1><p id="f4cf" class="pw-post-body-paragraph la lb iu lc b ld ni jv lf lg nj jy li lj nk ll lm ln nl lp lq lr nm lt lu lv in bi translated">或者，我们可以在云上完全可视化我们的数据。雪花本身有一个仪表板选项卡，我们可以在那里快速生成一些图表。</p><h2 id="bbe3" class="nv mr iu bd ms of og dn mw oh oi dp na lj oj ok nc ln ol om ne lr on oo ng op bi translated">4.1雪花状仪表板</h2><p id="fbc2" class="pw-post-body-paragraph la lb iu lc b ld ni jv lf lg nj jy li lj nk ll lm ln nl lp lq lr nm lt lu lv in bi translated">在雪花中点击打开<code class="fe nn no np nq b">Dashboards</code>选项卡，添加一个名为“cazy”的仪表盘。然后添加新的倾斜。在查询编辑器中，输入并执行一个SQL查询，例如:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="de97" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">选择<code class="fe nn no np nq b">Chart</code>并确认<code class="fe nn no np nq b">Chart type</code>为<code class="fe nn no np nq b">Bar</code>。您应该会看到一个条形图，显示了类级别的分类细目分类。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ot"><img src="../Images/1570463dd5b72e841bb09a456ce5e439.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XUwljll4darUDH1qFND5Dg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">图8。雪花中GH17的条形图。图片作者。</p></figure><p id="8bf8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然而，雪花的图表对我来说有点简陋。因此，让我们转到预设的一些更多的选项。</p><h2 id="e9c6" class="nv mr iu bd ms of og dn mw oh oi dp na lj oj ok nc ln ol om ne lr on oo ng op bi translated">4.2预设</h2><p id="0a64" class="pw-post-body-paragraph la lb iu lc b ld ni jv lf lg nj jy li lj nk ll lm ln nl lp lq lr nm lt lu lv in bi translated">登录或注册您的<a class="ae kz" href="https://www.google.com.hk/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwjhi5Tlg9X3AhWdK0QIHVbZCNoQFnoECAoQAQ&amp;url=https%3A%2F%2Fpreset.io%2F&amp;usg=AOvVaw13Ve1_RQDfgieHvYYb9Mn-" rel="noopener ugc nofollow" target="_blank">预设账户</a>。进入之后，创建一个名为<code class="fe nn no np nq b">GH17</code>的空仪表板。然后创建一个工作区并将您的雪花数据库添加到其中。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ou"><img src="../Images/f82b28d4b5d1913ec274d2fe2d820f57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TgIdaaowf8n73DKPygNdAQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">图9。连接预设与您的雪花数据库。图片作者。</p></figure><p id="78c8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然后点击<code class="fe nn no np nq b">Data</code> / <code class="fe nn no np nq b">Datasets</code>下的<code class="fe nn no np nq b">+DATASET</code>添加数据集。在<code class="fe nn no np nq b">DATABASE</code>、<code class="fe nn no np nq b">SCHEMA</code>和<code class="fe nn no np nq b">TABLE</code>下输入正确的值。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ov"><img src="../Images/c54884cfc902cae380c966e469df0a89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QsG2ftEf5s2LVk90lkky4Q.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">图10。使用雪花视图创建数据集。图片作者。</p></figure><p id="a920" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">选择新创建的数据集，创建旭日图。拖拽<code class="fe nn no np nq b">HIERARCHY</code>下的<code class="fe nn no np nq b">superkingdom</code>、<code class="fe nn no np nq b">phylum</code>、<code class="fe nn no np nq b">class</code>、<code class="fe nn no np nq b">genus</code>、<code class="fe nn no np nq b">PRIMARY METRIC</code>下的<code class="fe nn no np nq b">COUNT(*)</code>。更新图表，保存并将其添加到您的仪表板。你可以看到，在仪表板模式下，当他们试图将长名称压缩到面包屑中时，预设仍然有一些视觉错误需要修复。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ow"><img src="../Images/76154996c3d9993ade5c2db62ebc2c9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-zO9IVHZDfveAqOOxS587w.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">图10。在预设中创建GH17的旭日图。图片作者。</p></figure><p id="beea" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">为什么停在那里？您可以在GH17仪表板中添加更多图表，以显示数据的不同方面。您甚至可以启用树形图中的<code class="fe nn no np nq b">dashboard cross filters</code>。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ox"><img src="../Images/bc2c12cff1d8f3a27c88fbdddb2369ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P-sB2BbczIm6Iz2WO43VXg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">图11。我的GH17仪表板预设。图片作者。</p></figure></div><div class="ab cl oy oz hy pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="in io ip iq ir"><h1 id="874c" class="mq mr iu bd ms mt pf mv mw mx pg mz na ka ph kb nc kd pi ke ne kg pj kh ng nh bi translated">结论</h1><p id="60bf" class="pw-post-body-paragraph la lb iu lc b ld ni jv lf lg nj jy li lj nk ll lm ln nl lp lq lr nm lt lu lv in bi translated">这篇文章只是触及了dbt、雪花和预设的一点皮毛。dbt将软件工程的最佳实践，如模块化、可移植性、CI/CD和文档引入数据工程。这个项目有很多地方可以改进。例如，我们应该为数据转换和数据可视化创建单独的角色。我们也可以在dbt中创建一个仪表板。我们可以通过曝光将预设仪表板插入dbt仪表板。我们可以用“dbt docs”命令为我们的项目创建一个文档页面。如果您没有预设帐户，但有Tableau，您也可以使用Tableau和雪花驱动程序来分析雪花数据。</p><p id="de2d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">所以请尝试这个项目，并分享你的经验。</p><div class="ly lz gq gs ma mb"><a href="https://dgg32.medium.com/membership" rel="noopener follow" target="_blank"><div class="mc ab fp"><div class="md ab me cl cj mf"><h2 class="bd iv gz z fq mg fs ft mh fv fx it bi translated">加入媒介与我的介绍链接-黄思兴</h2><div class="mi l"><h3 class="bd b gz z fq mg fs ft mh fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="mj l"><p class="bd b dl z fq mg fs ft mh fv fx dk translated">dgg32.medium.com</p></div></div><div class="mk l"><div class="pk l mm mn mo mk mp kt mb"/></div></div></a></div></div></div>    
</body>
</html>