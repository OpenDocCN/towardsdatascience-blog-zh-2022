<html>
<head>
<title>Focal Loss: A better alternative for Cross-Entropy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">焦点损失:交叉熵的更好选择</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/focal-loss-a-better-alternative-for-cross-entropy-1d073d92d075#2022-04-26">https://towardsdatascience.com/focal-loss-a-better-alternative-for-cross-entropy-1d073d92d075#2022-04-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="cad3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">据说焦点损失在许多情况下比交叉熵损失表现得更好。但是为什么交叉熵损失会失败，焦点损失如何解决这些问题，让我们在这篇文章中找到答案</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ad5fd37fc7893cdc56e849f4e2747828.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QN3xznUDhgWeTihU"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">梯度下降，由<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae kv" href="https://unsplash.com/@ross_savchyn?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Rostyslav Savchyn </a>拍摄</p></figure><p id="9bd9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">损失函数</strong>是计算预测值与实际值偏离程度的数学方程。较高的损失值表明模型存在重大误差，而较低的损失值表明预测相当准确。目标是尽可能减少损失函数。模型使用损失函数来学习可训练的参数，例如权重和偏差。因为参数的权重更新方程具有损失函数相对于权重或偏差的一阶导数，所以该函数的行为将对梯度下降过程产生显著影响。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/4e66c4da1b643e9c2e400bc1c625bc0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f_mbKUol-luq3LiBAZueAw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">权重更新公式，图片来源:作者</p></figure><p id="3eb2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在有很多损失函数可用。他们每个人都有不同的数学公式和不同的惩罚模型错误的方法。每种方法都有优点和缺点，在决定使用哪种功能之前，我们必须权衡利弊。</p><p id="1b89" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经定义了损失函数，让我们来看一下分类交叉熵损失引起的问题以及焦点损失如何解决它们。</p><h1 id="3011" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">分类交叉熵损失</h1><p id="ee23" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">分类交叉熵损失传统上用于分类任务。顾名思义，这个的基础就是熵。在统计学中，熵是指系统的无序性。它量化了变量的模型预测值的不确定程度。所有概率估计的熵之和就是交叉熵。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/a17da4a06096a7d0fc012b77c622f1f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*qmPkvBxyn-Wo7f29er5QAA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">交叉熵的表达式，图片来源:作者</p></figure><p id="26a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其中Y是真实标签，p是预测概率。</p><p id="0df5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意</strong>:上面显示的公式是针对离散变量的。在连续变量的情况下，求和应该用积分代替。</p><p id="84a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">对数图</strong>清楚地表明总和将是负的，因为概率范围从0到1。因此，我们添加一个减号来反转求和项的符号。log(x)和-log(x)的图形如下图(x)所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/3e00d57800f080f38ea7a95f1dfba011.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*ncYHP4vAeNadwytalsrYvQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">红色为log(x ),蓝色为-log(x ),图片来源:作者。使用Desmos绘制的图表。</p></figure><h2 id="ea13" class="ms lu iq bd lv mt mu dn lz mv mw dp md lf mx my mf lj mz na mh ln nb nc mj nd bi translated">交叉熵损失表现不佳的情况</h2><ul class=""><li id="b9c6" class="ne nf iq ky b kz ml lc mm lf ng lj nh ln ni lr nj nk nl nm bi translated"><strong class="ky ir">阶级不平衡</strong>继承过程中的偏见。多数类示例将主导损失函数和梯度下降，导致权重在模型的方向上更新，在预测多数类时变得更有信心，同时不太强调少数类。<strong class="ky ir">平衡交叉熵</strong>损耗处理这个问题。</li><li id="0216" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">分不清<strong class="ky ir">难</strong>和<strong class="ky ir">易</strong>的例子。困难的例子是那些模型反复出现巨大错误的例子，而简单的例子是那些容易分类的例子。因此，交叉熵损失未能更多地关注硬例子。</li></ul><h1 id="8130" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">平衡交叉熵损失</h1><p id="1521" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">平衡交叉熵损失为每个类别添加一个加权因子，用希腊字母alpha，[0，1]表示。α可以是逆类频率或由交叉验证确定的超参数。alpha参数取代了交叉熵方程中的实际标签项。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/0a6bdadc3303bb2446ab260adba7d844.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*PKqXDLYUoCEr9H6xO8_JDA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">平衡交叉熵的表达式，图片来源:作者</p></figure><p id="bd48" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尽管这个损失函数解决了类不平衡的问题，但是它不能区分难的和容易的例子。通过焦点丢失解决了问题。</p><h1 id="cd12" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">焦点损失</h1><p id="5d6f" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">焦点损失侧重于模型出错的例子，而不是它可以自信地预测的例子，确保对困难例子的预测随着时间的推移而提高，而不是对简单例子过于自信。</p><p id="9c03" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">这到底是怎么做到的？</strong>焦损失通过所谓的<strong class="ky ir">向下加权</strong>来实现。向下加权是一种减少简单示例对损失函数的影响的技术，导致对困难示例的更多关注。这种技术可以通过向交叉熵损失添加调制因子来实现。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/7f906ddf78c1fb062f83a03079267008.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*0iU1aPrrEydcIxyeqHLobg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">表情为焦损，图片来源:作者</p></figure><p id="5c6d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其中，γ (Gamma)是使用交叉验证调整的<strong class="ky ir">聚焦参数</strong>。下图显示了不同γ值下焦损失的表现。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/2a21be4c487eab649837f72ad0aaa1c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*zkWsCJPPtCKzkG1VdZ4atA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">向下加权随着γ的增加而增加，图片来源:焦损失研究论文</p></figure><h2 id="7ed4" class="ms lu iq bd lv mt mu dn lz mv mw dp md lf mx my mf lj mz na mh ln nb nc mj nd bi translated">伽玛参数是如何工作的？</h2><ul class=""><li id="bf83" class="ne nf iq ky b kz ml lc mm lf ng lj nh ln ni lr nj nk nl nm bi translated">在错误分类样本的情况下，pi很小，使得调制因子近似或非常接近1。这使得损失函数不受影响。因此，它表现为交叉熵损失。</li><li id="b46b" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">随着模型的置信度增加，即pi → 1，调制因子将趋向于0，从而降低了分类良好的示例的损失值。聚焦参数γ ≥ 1将重新调整调制因子，使得简单的例子比困难的例子权重更低，减少它们对损失函数的影响。例如，假设预测概率为0.9和0.6。考虑到γ = 2，为0.9计算的损耗值为4.5e-4，向下加权系数为100，为0.6计算的损耗值为3.5e-2，向下加权系数为6.25。从实验来看，γ = 2对于焦损失论文的作者来说效果最好。</li><li id="1254" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">当γ = 0时，焦损相当于交叉熵。</li></ul><p id="88e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在实践中，我们使用聚焦损失的α平衡变体<strong class="ky ir">，其继承了<strong class="ky ir">加权因子</strong> α和<strong class="ky ir">聚焦参数</strong> γ的特征，产生比非平衡形式稍好的精度。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/f71f3bf69c0e6996f8917fad9d63bb01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*0SkPCd2Y2IGCh8z-9BWL7Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">α平衡焦损失的表达式，图片来源:作者</p></figure><p id="eaf2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">震源损失自然地解决了类别不平衡的问题，因为来自多数类别的样本通常容易预测，而来自少数类别的样本则很难预测，这是因为缺少来自支配损失和梯度过程的多数类别的数据或样本。由于这种相似性，焦点损失可能能够解决这两个问题。</p><p id="f6cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您阅读这篇文章😃。祝你有愉快的一天。</p></div></div>    
</body>
</html>