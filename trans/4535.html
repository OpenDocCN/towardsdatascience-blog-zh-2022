<html>
<head>
<title>Deploying a Data Science Platform on AWS: Setting Up AWS Batch (Part I)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在AWS上部署数据科学平台:设置AWS批处理(第一部分)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploying-a-data-science-platform-on-aws-setting-up-aws-batch-part-i-da4a7566db7e#2022-10-07">https://towardsdatascience.com/deploying-a-data-science-platform-on-aws-setting-up-aws-batch-part-i-da4a7566db7e#2022-10-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="e1be" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">数据科学云基础架构</h2><div class=""/><div class=""><h2 id="5825" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">使用开源软件在AWS上部署数据科学平台的分步指南</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/f1c47eaae478ac18aee03582640fdc9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4UoX6133oj_lWsTU"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">你的笔记本电脑不够用，我们用云吧。由<a class="ae le" href="https://unsplash.com/@chuttersnap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> CHUTTERSNAP </a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="a4aa" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在这一系列教程中，我们将向您展示如何使用AWS和开源软件部署数据科学平台。到本系列结束时，您将能够通过一个命令<strong class="lh ja">向AWS可伸缩基础设施提交计算任务。</strong></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mb"><img src="../Images/fd2e64cca50524b9ae5345f70aab3293.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wpquduWTP9QQeG4PiR1xyg.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">我们将部署的数据科学平台的体系结构。图片作者。</p></figure><h1 id="8c9f" class="mc md iq bd me mf mg mh mi mj mk ml mm kf mn kg mo ki mp kj mq kl mr km ms mt bi translated"><strong class="ak">什么是AWS批次？</strong></h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mu"><img src="../Images/bf98e631ca426dc14776a7958fd962d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R1cm1Nt7Tigqsaz8Lxsebw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">AWS批处理控制台的屏幕截图，显示了我们最近的作业。图片作者。</p></figure><p id="e2f5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">为了实现我们的平台，我们将使用几个AWS服务。但是，中心的是AWS Batch。</p><p id="f45a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">AWS Batch是针对计算作业的托管服务。它负责维护作业队列、启动EC2实例、运行我们的代码和关闭实例。它根据我们提交的作业数量而上下调整。这是一个非常方便的服务，允许我们以可扩展的方式执行代码，并为计算密集型作业(例如，具有许多CPU和大内存的实例)请求定制资源，而不需要我们维护集群(不需要使用Kubernetes！).</p><p id="ff6c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们开始吧！</p><h1 id="08a2" class="mc md iq bd me mf mg mh mi mj mk ml mm kf mn kg mo ki mp kj mq kl mr km ms mt bi translated">安装<code class="fe mv mw mx my b">aws</code>命令行界面</h1><p id="cb9f" class="pw-post-body-paragraph lf lg iq lh b li mz ka lk ll na kd ln lo nb lq lr ls nc lu lv lw nd ly lz ma ij bi translated">本教程的唯一要求是安装AWS命令行界面(以及有足够权限使用该工具的<a class="ae le" href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-prereqs.html" rel="noopener ugc nofollow" target="_blank">访问键</a>)。遵循<a class="ae le" href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html" rel="noopener ugc nofollow" target="_blank">安装说明</a>。如果您有问题，请在我们的<a class="ae le" href="https://ploomber.io/community" rel="noopener ugc nofollow" target="_blank">空闲时间</a>寻求帮助。</p><p id="fa6b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">验证您的安装(确保您运行的是版本2):</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="80e2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="0b73" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">然后使用您的访问密钥进行身份验证:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h1 id="c9a3" class="mc md iq bd me mf mg mh mi mj mk ml mm kf mn kg mo ki mp kj mq kl mr km ms mt bi translated">网络配置</h1><p id="b404" class="pw-post-body-paragraph lf lg iq lh b li mz ka lk ll na kd ln lo nb lq lr ls nc lu lv lw nd ly lz ma ij bi translated">我们需要为运行我们任务的EC2实例创建一个VPC(虚拟私有云),这一部分包含了配置VPC所需的所有命令。</p><p id="00de" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">请注意，所有AWS帐户都有一个默认的VPC。如果您想使用它，请确保您有想要使用的子网id和安全组id，并跳过这一部分。</p><p id="d71b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果你需要帮助，请随时向我们询问关于Slack的任何事情。</p><p id="843b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们创建一个新的VPC，并检索VPC ID:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="c956" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="2b13" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们将ID分配给一个变量，这样我们就可以重用它(用您的ID替换它):</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="5df7" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在，让我们创建一个子网并获取子网ID:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="c35b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="dd78" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">并将ID赋给一个变量(用您的ID替换):</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="4d2f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们需要修改子网的配置，以便每个实例获得一个公共IP:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="d7b9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在，让我们配置互联网接入:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="6c18" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="80ed" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">将网关ID分配给以下变量(用您的ID替换):</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="0f5e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们将互联网网关连接到我们的VPC:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="573b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">该<a class="ae le" href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-subnets-commands-example.html" rel="noopener ugc nofollow" target="_blank">文档</a>更详细地解释了上述命令。</p><p id="fcb5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">请注意，允许实例访问互联网简化了网络设置。但是，如果您不希望EC2实例拥有公共IP，您可以配置NAT网关。</p><p id="cc94" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在，我们通过添加路由表来完成子网的配置:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="7dd6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="eb4a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">分配路由表ID(用您的ID替换):</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="d2f4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们添加一个与我们的互联网网关相关联的路由:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="d47e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="0947" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">并将该表与子网相关联:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="d981" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="285e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">最后，在我们的VPC中创建一个安全组:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="0c09" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="6507" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">并分配安全ID(用您的ID替换):</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h1 id="b61c" class="mc md iq bd me mf mg mh mi mj mk ml mm kf mn kg mo ki mp kj mq kl mr km ms mt bi translated">配置权限</h1><p id="1c59" class="pw-post-body-paragraph lf lg iq lh b li mz ka lk ll na kd ln lo nb lq lr ls nc lu lv lw nd ly lz ma ij bi translated">我们现在需要创建一个角色来允许AWS Batch调用ECS(另一个AWS服务)。</p><p id="9a26" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">下载配置文件:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="ed12" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="6230" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">创建角色:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="bc25" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="a7a0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">创建实例配置文件:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="d1e1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="4401" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">将角色添加到实例配置文件:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="fe72" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">附加角色策略:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h1 id="13ae" class="mc md iq bd me mf mg mh mi mj mk ml mm kf mn kg mo ki mp kj mq kl mr km ms mt bi translated">配置计算环境</h1><p id="3b05" class="pw-post-body-paragraph lf lg iq lh b li mz ka lk ll na kd ln lo nb lq lr ls nc lu lv lw nd ly lz ma ij bi translated">配置好网络和权限后，我们现在就可以配置计算环境了！</p><p id="a6de" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在AWS Batch中，计算环境决定了为我们的作业使用哪些实例类型。</p><p id="0151" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们创建了一个简单的脚本来生成您的配置文件:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="a8ff" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="d010" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">运行脚本并传递子网和安全组id:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="0656" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="2142" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">您也可以编辑<code class="fe mv mw mx my b">my-compute-env.json</code>文件，将您的子网id放入<code class="fe mv mw mx my b">subnets</code>列表，将您的安全组id放入<code class="fe mv mw mx my b">securityGroupIds</code>列表。如果您需要针对您的计算环境进行更多定制，请加入我们的<a class="ae le" href="https://ploomber.io/community" rel="noopener ugc nofollow" target="_blank"> Slack </a>，我们将为您提供帮助。</p><p id="4798" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">创建计算环境:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="50a2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="b301" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">为了提交作业，我们需要创建一个作业队列。该队列将接收作业请求，并将它们路由到相关的计算环境。</p><p id="79a4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><em class="ng">注意:在运行下一个命令之前等待几秒钟，因为创建计算环境可能需要一点时间。</em></p><p id="4d71" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">下载文件:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="b380" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="8a14" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">创建作业队列:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="4f36" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="9902" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们测试一下一切是否正常！</p><p id="82fb" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们定义了一个等待几秒钟并完成的示例作业:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="c165" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="cfef" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们向队列提交一个作业:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="1916" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="8250" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们确保工作成功执行。复制执行命令时打印的<code class="fe mv mw mx my b">jobId</code>,并将其传递给下一条命令:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="00ea" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="12f8" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">第一次运行上述命令时，您很可能会看到:<code class="fe mv mw mx my b">RUNNABLE</code>，这是正常的。</p><p id="42b0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">AWS Batch会启动新的EC2机器，并在您的工作完成后关闭它们。这很好，因为它可以防止机器空转，继续计费。然而，由于新机器每次都在旋转，这引入了一些启动时间开销。等待一分钟左右，再次运行该命令，您应该很快就会看到<code class="fe mv mw mx my b">STARTING</code>、<code class="fe mv mw mx my b">RUNNING</code>和<code class="fe mv mw mx my b">SUCCEEDED</code>。</p><p id="ba7d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果超过几分钟后作业仍停留在<code class="fe mv mw mx my b">RUNNABLE</code>状态，请在我们的<a class="ae le" href="https://ploomber.io/community" rel="noopener ugc nofollow" target="_blank">社区寻求帮助。</a></p><h1 id="25a7" class="mc md iq bd me mf mg mh mi mj mk ml mm kf mn kg mo ki mp kj mq kl mr km ms mt bi translated"><strong class="ak">收尾</strong></h1><p id="8031" class="pw-post-body-paragraph lf lg iq lh b li mz ka lk ll na kd ln lo nb lq lr ls nc lu lv lw nd ly lz ma ij bi translated">在这篇博文中，我们配置了AWS Batch，这样我们就可以按需提交计算任务。不需要维护集群或者手动启动和关闭EC2实例。您只需为您提交的作业付费。此外，AWS Batch是高度可伸缩的，因此您可以提交任意多的作业！</p><p id="c20c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在下一篇文章中，我们将向您展示如何向AWS Batch提交一个自定义容器作业，并配置一个S3桶来读取输入数据和写入结果。</p><p id="d6d7" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果你想第一个知道第二部什么时候出来；在<a class="ae le" href="https://twitter.com/ploomber" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae le" href="https://www.linkedin.com/company/ploomber/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或<a class="ae le" href="https://www.getrevue.co/profile/ploomber" rel="noopener ugc nofollow" target="_blank">上关注我们，订阅我们的简讯</a>！</p><h1 id="5f44" class="mc md iq bd me mf mg mh mi mj mk ml mm kf mn kg mo ki mp kj mq kl mr km ms mt bi translated">尾声:清理基础设施</h1><p id="2f94" class="pw-post-body-paragraph lf lg iq lh b li mz ka lk ll na kd ln lo nb lq lr ls nc lu lv lw nd ly lz ma ij bi translated">除EC2使用外，使用AWS批处理不收费。但是，如果您想要清理您的环境，请遵循以下步骤。</p><p id="e2af" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">禁用AWS批处理队列和计算环境:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="b43c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="6e36" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">更新计算环境:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="7b2f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">输出:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="cc65" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">您需要等待1-2分钟，让队列和计算环境显示为<code class="fe mv mw mx my b">DISABLED</code>。</p><p id="49d6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">删除队列和计算环境:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="6c17" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">删除VPC及其组成部分:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="0f44" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">删除IAM角色:</p><pre class="kp kq kr ks gt nh my ni nj aw nk bi"><span id="f3b3" class="nl md iq my b gy nm nn l no np">aws iam remove-role-from-instance-profile --instance-profile-name \</span><span id="e0b9" class="nl md iq my b gy nq nn l no np">    ploomber-ecs-instance-role \</span><span id="5be8" class="nl md iq my b gy nq nn l no np">    --role-name ploomber-ecs-instance-role</span><span id="ffbd" class="nl md iq my b gy nq nn l no np"><br/>aws iam delete-instance-profile --instance-profile-name ploomber-ecs-instance-role</span><span id="526e" class="nl md iq my b gy nq nn l no np">aws iam detach-role-policy --role-name ploomber-ecs-instance-role \<br/>    --policy-arn arn:aws:iam::aws:policy/service-role/AmazonEC2ContainerServiceforEC2Role</span><span id="2124" class="nl md iq my b gy nq nn l no np">aws iam delete-role --role-name ploomber-ecs-instance-role</span></pre><h1 id="f6e3" class="mc md iq bd me mf mg mh mi mj mk ml mm kf mn kg mo ki mp kj mq kl mr km ms mt bi translated">关于作者</h1><p id="42c5" class="pw-post-body-paragraph lf lg iq lh b li mz ka lk ll na kd ln lo nb lq lr ls nc lu lv lw nd ly lz ma ij bi translated">嗨！我叫爱德华多，我喜欢写关于数据科学的所有东西。如果您想了解我的最新内容。在<a class="ae le" href="https://medium.com/@edublancas" rel="noopener">媒体</a>或<a class="ae le" href="https://twitter.com/edublancas" rel="noopener ugc nofollow" target="_blank">推特</a>上关注我。感谢阅读！</p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><p id="8315" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><em class="ng">最初发表于</em> <a class="ae le" href="https://ploomber.io/blog/ds-platform-part-i/" rel="noopener ugc nofollow" target="_blank"> <em class="ng"> ploomber.io </em> </a></p></div></div>    
</body>
</html>