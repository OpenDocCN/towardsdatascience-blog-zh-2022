<html>
<head>
<title>Execution Times in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的执行时间</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/execution-times-in-python-ed45ecc1bb4d#2022-06-22">https://towardsdatascience.com/execution-times-in-python-ed45ecc1bb4d#2022-06-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6844" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用正确的方法测量Python代码的执行时间</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3d8b949b77e05d537b9cb1abd7a5746c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6p5MCB7VTtMRJipqv8_Jdw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><p id="1384" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">测量代码执行时间是一项至关重要的工作，无论是数据科学项目中的算法选择还是软件开发中的速度优化。不管是哪种情况，在Python中测量时间有其微妙之处，我们最好把它做好。</p><p id="a582" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这个故事中，我们将通过许多方法来测量Python中的时间。我们的目标是，计算代码块的执行时间。</p><p id="c0b4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可能会和我一样感到困惑，因为没有多少pythonic式的方法来测量执行时间。希望在读完这个故事后，你能实现更有效的方法来计时你的代码。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><p id="932a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将在整个故事中使用这两个函数来测试我们的计时器。第一个函数“do_complex_stuff”休眠1秒钟(实际上是休眠Python线程)，以模拟一些长时间的计算。第二个函数，“do_simple_stuff”不休眠。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mb mc l"/></div></figure><h2 id="7c76" class="md me it bd mf mg mh dn mi mj mk dp ml lh mm mn mo ll mp mq mr lp ms mt mu mv bi translated">为什么你应该避免时间。时间</h2><p id="6bfd" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh my lj lk ll mz ln lo lp na lr ls lt im bi translated">测量时间时，首先要避免使用<em class="nb"> time.time </em>。典型的例子是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mb mc l"/></div></figure><blockquote class="nc nd ne"><p id="723c" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="0371" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi">1.0006861686706543</p></blockquote><p id="70f8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您应该避免它的两个主要原因是:</p><ul class=""><li id="a862" class="ni nj it la b lb lc le lf lh nk ll nl lp nm lt nn no np nq bi translated">即使系统时间分辨率为1秒，时间也会以浮点形式返回，表示自epoch以来的秒数。在某些系统中，这种行为会导致舍入误差。</li><li id="030a" class="ni nj it la b lb nr le ns lh nt ll nu lp nv lt nn no np nq bi translated">它不像时间模块中的其他时钟一样精确。一些系统会产生奇怪的行为，特别是对于小时间的测量。</li></ul><h2 id="710a" class="md me it bd mf mg mh dn mi mj mk dp ml lh mm mn mo ll mp mq mr lp ms mt mu mv bi translated">使用纳秒来避免舍入误差</h2><p id="2c2f" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh my lj lk ll mz ln lo lp na lr ls lt im bi translated">你可以使用<em class="nb"> time.time_ns </em>来避免舍入误差，<em class="nb"> time_ns </em>给出从纪元开始的整数纳秒。我们可以这样做:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mb mc l"/></div></figure><blockquote class="nc nd ne"><p id="aa33" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="9d1d" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi">1002516000</p></blockquote><p id="8707" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它不是最精确的钟，但比时间好。</p><p id="e4fd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">关于纳秒的一个简单说明。从Python 3.7开始，时间模块中很多带后缀“_ns”的函数都返回整数纳秒。它们的原始浮点(秒)版本可以使用不带“_ns”后缀的同名函数来调用。例<em class="nb">时间</em>。<em class="nb">时间</em>和<em class="nb"> time.time_ns </em>。</p><h2 id="b5ab" class="md me it bd mf mg mh dn mi mj mk dp ml lh mm mn mo ll mp mq mr lp ms mt mu mv bi translated">使用perf_counter获得精度</h2><p id="875a" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh my lj lk ll mz ln lo lp na lr ls lt im bi translated">如果精度是你想要的，使用<em class="nb"> time.perf_counter </em>代替，或者更确切地说是它的纳秒版本<em class="nb"> time.perf_counter_ns。这是目前最精确的时钟。时钟的绝对值是没有意义的；只有时间的减法才有意义。</em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mb mc l"/></div></figure><blockquote class="nc nd ne"><p id="ecf5" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="c532" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi">1005195401</p></blockquote><p id="e2be" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是计时执行的首选方式。</p><h2 id="42b6" class="md me it bd mf mg mh dn mi mj mk dp ml lh mm mn mo ll mp mq mr lp ms mt mu mv bi translated">使用process_time表示CPU时间</h2><p id="4d51" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh my lj lk ll mz ln lo lp na lr ls lt im bi translated">在Python中执行代码时，CPU不会将其所有时间让给执行进程。在操作系统级别，还有其他进程也在争夺这些时间。在Python中，我们可以通过使用<em class="nb"> time.sleep </em>显式地告诉CPU让进程线程休眠。因此，允许操作系统级别的其他进程运行。</p><p id="58fb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有时候我们想测量进程的CPU时间，不考虑线程睡眠(其他进程做其他事情)。在这种情况下，我们应该使用<em class="nb"> time.process_time_ns </em>。与<em class="nb"> perf_counter </em>一样，只有两次相减才有意义。</p><p id="11e0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这方面的一个例子是:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mb mc l"/></div></figure><blockquote class="nc nd ne"><p id="4853" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="4d8c" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi">3872000</p></blockquote><p id="ce54" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在让我们也为“do_simple_stuff”函数计时。与“do_complex_stuff”函数的唯一区别是它休眠1秒钟:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mb mc l"/></div></figure><blockquote class="nc nd ne"><p id="a7f8" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做简单的事情…</p><p id="a73b" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi">3128000</p></blockquote><p id="43e2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们在这里看到的是睡眠时间没有考虑在内。这正是我们想要的行为。</p><p id="3ee1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有时候，这种方式对时间编码是有帮助的，特别是当有很多I/O绑定的任务并且线程休眠不受我们控制的时候。</p><h2 id="7e84" class="md me it bd mf mg mh dn mi mj mk dp ml lh mm mn mo ll mp mq mr lp ms mt mu mv bi translated">对长流程使用单调时钟</h2><p id="829e" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh my lj lk ll mz ln lo lp na lr ls lt im bi translated">当对较长的流程进行计时时，有一个不容忽视的时间问题。如果系统时间在进程的生命周期中改变了会发生什么？系统时间的改变比你想象的更常见；它们可能是由于NTP同步服务或夏令时而发生的。</p><p id="854d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这种情况下，我们需要一个即使系统时间改变也不会改变的时钟。输入<em class="nb"> time.monotonic_ns </em>该时钟适用于计时较长的流程:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mb mc l"/></div></figure><blockquote class="nc nd ne"><p id="6abd" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="7329" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi">1004428370</p></blockquote><h2 id="0b45" class="md me it bd mf mg mh dn mi mj mk dp ml lh mm mn mo ll mp mq mr lp ms mt mu mv bi translated">禁用垃圾收集器以获得准确的计时</h2><p id="e762" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh my lj lk ll mz ln lo lp na lr ls lt im bi translated">Python的一个特性是自动垃圾收集。不涉及太多细节，这是一个通过自动化内存管理(即，为未使用的对象释放内存)使您的生活变得更加轻松的过程。</p><p id="5f2c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">垃圾收集会影响执行时间，因为它可能发生在代码块计时期间。这需要的时间是不可忽略的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mb mc l"/></div></figure><blockquote class="nc nd ne"><p id="f244" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi">68679577</p></blockquote><p id="3192" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，最好在测量时间时暂时禁用它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mb mc l"/></div></figure><blockquote class="nc nd ne"><p id="99e2" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做简单的事情…</p><p id="15f1" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi">486133</p></blockquote><h2 id="0227" class="md me it bd mf mg mh dn mi mj mk dp ml lh mm mn mo ll mp mq mr lp ms mt mu mv bi translated">timeit模块</h2><p id="e096" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh my lj lk ll mz ln lo lp na lr ls lt im bi translated">我对timeit模块持观望态度，但我喜欢Jupyter笔记本magic command的界面:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mb mc l"/></div></figure><blockquote class="nc nd ne"><p id="0bb3" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="6aa2" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="e0cf" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="58be" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="bde8" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="0af3" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="9183" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="ac02" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="e9e4" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">每次循环1秒1.85毫秒(平均标准时间戴夫。7次运行，每次1个循环)</p></blockquote><p id="b660" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我不喜欢Python界面。但是，时间编码很方便。</p><p id="6d7b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">代码的单次执行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mb mc l"/></div></figure><blockquote class="nc nd ne"><p id="812b" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="f97d" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="a574" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="0035" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="bcba" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="0bb0" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi">5.012320117995841</p></blockquote><p id="e8c9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">或者重复测量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mb mc l"/></div></figure><blockquote class="nc nd ne"><p id="f3a2" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="cc32" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="1d4a" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="c8d5" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="bc90" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="342f" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="52cd" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi">[2.0122088000002805, 2.0041232610001316, 2.0006091740001466]</p></blockquote><p id="3383" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">需要注意的是，timeit官方文档建议使用多次测量中的最小时间，因为这可能比平均值更有代表性。</p><p id="fbc1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在timeit接口中，我们可以使用函数计时，也可以使用字符串计时。使用一根弦对我来说并不像是pythonic。不管有多方便，我都不能不皱眉头。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mb mc l"/></div></figure><blockquote class="nc nd ne"><p id="d2fc" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做事…</p><p id="4dfe" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做事…</p><p id="57b1" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做事…</p><p id="5c7a" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做事…</p><p id="794a" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做事…</p><p id="02dc" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做事…</p><p id="7480" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做事…</p><p id="d312" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做事…</p><p id="a5a8" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做事…</p><p id="207b" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做事…</p><p id="852f" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi">0.000834739999845624</p></blockquote><h2 id="0b94" class="md me it bd mf mg mh dn mi mj mk dp ml lh mm mn mo ll mp mq mr lp ms mt mu mv bi translated">构建自定义计时器类</h2><p id="d6b2" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh my lj lk ll mz ln lo lp na lr ls lt im bi translated">让我们通过使用我们现在所知道的关于垃圾收集器、我们可以使用的不同时钟以及对更Pythonic化的定时器的需求来创建一个定制的定时器类。</p><p id="87da" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们想从这个计时器得到的是:</p><ul class=""><li id="2317" class="ni nj it la b lb lc le lf lh nk ll nl lp nm lt nn no np nq bi translated">关闭垃圾收集的可能性</li><li id="a887" class="ni nj it la b lb nr le ns lh nt ll nu lp nv lt nn no np nq bi translated">选择我们想要的时钟类型</li><li id="a547" class="ni nj it la b lb nr le ns lh nt ll nu lp nv lt nn no np nq bi translated">除非特别转换为秒，否则使用纳秒时间</li></ul><p id="cea3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个类完成这项工作:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="f7fd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用它非常简单，启动、停止并获得纳秒或秒的时间；就是这样。</p><p id="f5db" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要实例化该类，我们需要指定timer_type，即我们将使用性能时钟、进程时钟还是长期运行时钟(单调)；我们还可以确定是否禁用垃圾收集。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mb mc l"/></div></figure><blockquote class="nc nd ne"><p id="da46" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="89f3" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi">1001954642, 1.001954642</p></blockquote><p id="faaf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是一个进步，但对我来说还不是很pythonic化。我们可以做得比显式启动和停止计时器更好。</p><h2 id="2c13" class="md me it bd mf mg mh dn mi mj mk dp ml lh mm mn mo ll mp mq mr lp ms mt mu mv bi translated">计时上下文管理器</h2><p id="d1b0" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh my lj lk ll mz ln lo lp na lr ls lt im bi translated">进入上下文管理器，这是Python的顶级语法糖特性之一。当我们阅读带有关键字“with”的代码时，有一种优雅的感觉。对于那些不熟悉上下文管理器的人来说，简单的上下文管理器并不难创建，尤其是在使用标准模块<em class="nb"> contextlib </em>时。</p><p id="e252" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以我们可以创建一个上下文管理器，它使用我们的<em class="nb">定时器</em>类，并负责启动和停止它，就像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="8f96" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后我们可以用它来计时一段代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mb mc l"/></div></figure><blockquote class="nc nd ne"><p id="49f4" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi translated">做复杂的事情…</p><p id="b13d" class="ky kz nb la b lb lc ju ld le lf jx lg nf li lj lk ng lm ln lo nh lq lr ls lt im bi">1.005408027</p></blockquote><p id="13ce" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里的<em class="nb">计时器</em>变量是上一节中的<em class="nb">计时器</em>类的一个实例，因此它具有相同的属性。</p><h2 id="057f" class="md me it bd mf mg mh dn mi mj mk dp ml lh mm mn mo ll mp mq mr lp ms mt mu mv bi translated">最后的话</h2><p id="30be" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh my lj lk ll mz ln lo lp na lr ls lt im bi translated">到目前为止，您已经了解了如何为代码计时的基本知识。希望从现在开始，你会避免大多数常见的错误。您还了解了如何定制定时器，并将其封装在一个干净的pythonic上下文管理器中。</p><p id="1b4d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">关于timeit模块，我不怎么用它，除了它的Jupyter魔法命令界面。然而，它是一个方便的模块，尤其是<em class="nb">重复</em>和<em class="nb">自动量程</em>功能。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><p id="3c53" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望这个故事对你有用。如果你想知道更多类似的故事，请订阅。</p><div class="nw nx gp gr ny nz"><a href="https://medium.com/subscribe/@diego-barba" rel="noopener follow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd iu gy z fp oe fr fs of fu fw is bi translated">每当迭戈·巴尔巴出版时，就收到一封电子邮件。</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">每当迭戈·巴尔巴出版时，就收到一封电子邮件。通过注册，您将创建一个中型帐户，如果您还没有…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">medium.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on ks nz"/></div></div></a></div></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><p id="8842" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">喜欢这个故事吗？通过我下面的推荐链接成为一个媒体成员来支持我的写作。无限制地访问我的故事和许多其他内容。</p><div class="nw nx gp gr ny nz"><a href="https://medium.com/@diego-barba/membership" rel="noopener follow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd iu gy z fp oe fr fs of fu fw is bi translated">通过我的推荐链接加入Medium-Diego Barba</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">medium.com</p></div></div><div class="oi l"><div class="oo l ok ol om oi on ks nz"/></div></div></a></div></div></div>    
</body>
</html>