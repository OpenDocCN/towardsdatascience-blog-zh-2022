<html>
<head>
<title>Choropleth Maps with Pandas and Flourish</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Choropleth地图与熊猫和繁荣</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/choropleth-maps-with-pandas-and-flourish-aea2ad9ec5e3#2022-09-01">https://towardsdatascience.com/choropleth-maps-with-pandas-and-flourish-aea2ad9ec5e3#2022-09-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4e09" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Python、pandas和fluore制作美国脊髓灰质炎疫苗接种率地图的教程</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/bc8a00323935cbe84f886e6c30b49094.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QBRSyecVCw8dVkoZeWnjTw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由作者提供，使用Flourish.studio</p></figure><h1 id="a89e" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">背景</h1><p id="3c86" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在之前的一篇文章中，我简要介绍了如何制作与废水追踪相关的美国县数据的choropleth <a class="ae mj" href="https://public.flourish.studio/visualisation/9120368/" rel="noopener ugc nofollow" target="_blank">地图</a>。当然，这里使用的方法可以应用于其他数据，并且有许多映射选项没有在那些指令中显示。</p><p id="5d07" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">本教程包含更多关于使用fluore制作地图的详细信息——使用美国各州脊髓灰质炎疫苗接种率的示例数据，并创建如上所示的<a class="ae mj" href="https://public.flourish.studio/visualisation/10938243/" rel="noopener ugc nofollow" target="_blank">地图</a>。</p><p id="92cf" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">首先，几个定义…</p><ul class=""><li id="09ca" class="mp mq iq lp b lq mk lt ml lw mr ma ms me mt mi mu mv mw mx bi translated"><strong class="lp ir"> choropleth map </strong>是一种地理地图(如县或州),通过对地理区域进行颜色编码来显示数据值。</li><li id="703c" class="mp mq iq lp b lq my lt mz lw na ma nb me nc mi mu mv mw mx bi translated"><strong class="lp ir">fruit</strong>是<a class="ae mj" href="https://flourish.studio" rel="noopener ugc nofollow" target="_blank">fruit . studio</a>的简写，这是一家总部位于伦敦的软件公司，提供非编程数据可视化。地理地图是一种数据可视化。</li></ul><p id="1320" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">美国儿童脊髓灰质炎疫苗接种的标准时间表是总共四剂，其中三剂在儿童三岁生日之前给药。在本教程中，我们做了一个简化的假设，一个在三岁生日前接种了全部三针的孩子被称为“接种疫苗”，一个没有接种的孩子被称为“未接种疫苗”。</p><h1 id="7155" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">准备数据</h1><p id="b8b6" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">关于美国各种疾病和年龄组的儿童早期疫苗接种率的数据包含在CDC 的<a class="ae mj" href="https://data.cdc.gov/Child-Vaccinations/Vaccination-Coverage-among-Young-Children-0-35-Mon/fhky-rtsk" rel="noopener ugc nofollow" target="_blank">单一数据集中。简单的Python/pandas </a><a class="ae mj" href="https://github.com/ChuckConnell/articles/blob/master/make_polio_vax_map.py" rel="noopener ugc nofollow" target="_blank">数据准备</a>将原始数据集翻译成<a class="ae mj" href="https://github.com/ChuckConnell/articles/blob/master/polio_coverage_map.tsv" rel="noopener ugc nofollow" target="_blank">地图输入文件</a>。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="e9ec" class="ni kw iq ne b gy nj nk l nl nm">import pandas as pd <br/>from sodapy import Socrata</span><span id="87d3" class="ni kw iq ne b gy nn nk l nl nm">POLIO_MAP_DATA = "polio_coverage_map.tsv"<br/>VAX_DATASET = "fhky-rtsk"   # CDC code for this dataset</span><span id="ef47" class="ni kw iq ne b gy nn nk l nl nm"># Get the data, which covers many vaccines and age groups.</span><span id="8596" class="ni kw iq ne b gy nn nk l nl nm">cdc_client = Socrata("data.cdc.gov", None)<br/>VaxDF = pd.DataFrame.from_records(cdc_client.get(VAX_DATASET, limit=1000000))</span><span id="9cea" class="ni kw iq ne b gy nn nk l nl nm"># Select rows about 3 doses of polio vax.</span><span id="8c49" class="ni kw iq ne b gy nn nk l nl nm">PolioDF = VaxDF.query("vaccine == 'Polio'")<br/>PolioDF = PolioDF.query("dose == '≥3 Doses'")</span><span id="6e2a" class="ni kw iq ne b gy nn nk l nl nm"># Select rows for the 50 US states.</span><span id="de5b" class="ni kw iq ne b gy nn nk l nl nm">PolioDF = PolioDF.query("geography_type == 'States/Local Areas'")<br/>PolioDF = PolioDF.query("geography != 'Puerto Rico'")  </span><span id="929f" class="ni kw iq ne b gy nn nk l nl nm"># Use the latest year in the dataset.</span><span id="d054" class="ni kw iq ne b gy nn nk l nl nm">PolioDF = PolioDF.query("year_season == '2018'")  </span><span id="ff68" class="ni kw iq ne b gy nn nk l nl nm"># Get rows for almost-3-year olds.</span><span id="4127" class="ni kw iq ne b gy nn nk l nl nm">PolioDF = PolioDF.query("dimension_type == 'Age'")<br/>PolioDF = PolioDF.query("dimension == '35 Months'")</span><span id="603f" class="ni kw iq ne b gy nn nk l nl nm"># Select the columns we need for mapping.</span><span id="3564" class="ni kw iq ne b gy nn nk l nl nm">PolioDF = PolioDF[["geography", "coverage_estimate", "population_sample_size"]]</span><span id="ddb5" class="ni kw iq ne b gy nn nk l nl nm"># Make the data file that becomes the input to the map.</span><span id="6707" class="ni kw iq ne b gy nn nk l nl nm">print ("\nWriting map data to " + POLIO_MAP_DATA)<br/>PolioDF.to_csv(POLIO_MAP_DATA, encoding='utf-8', sep='\t', index=False)</span></pre><p id="a177" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">生成的地图文件如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/ede8cc1b655d2ac04d5772cc36b15967.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GTGk-3jxe5bL7jd9VNnbUQ.png"/></div></div></figure><h1 id="0762" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">开始繁荣</h1><p id="e345" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">个人使用免费，商业和企业用户有付费选项。我所有的作品都是免费版的。</p><p id="9d49" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">创建一个繁荣的帐户，并点击新的可视化。你用“繁荣”制作的一切都是“可视化”，包括条形图，折线图，散点图，层次图，2D和三维地图。</p><h1 id="f292" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">选择并清理地图模板</h1><p id="b72b" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">内置模板是启动任何项目的最佳方式，但是在使用自己的数据和设计之前，您需要清除示例数据和设置。</p><p id="46ec" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">向下滚动到投影地图/美国各州，并选择它作为您的起点。在左上角给你的地图命名。</p><p id="c110" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">此示例将仅使用区域，而不使用地图点，因此移除点数据:</p><ul class=""><li id="fbfb" class="mp mq iq lp b lq mk lt ml lw mr ma ms me mt mi mu mv mw mx bi translated">转到预览窗格，并设置点层=禁用。</li><li id="efb7" class="mp mq iq lp b lq my lt mz lw na ma nb me nc mi mu mv mw mx bi translated">确保不使用任何点数据。转到数据窗格/数据点，删除你在最右边看到的A，B，C，D。</li><li id="a0da" class="mp mq iq lp b lq my lt mz lw na ma nb me nc mi mu mv mw mx bi translated">删除所有的点数据。点按A列的标题，然后按住SHIFT键点按D列的标题，以便选择所有列。下拉D列标题中的小部件，并选择Remove Columns。</li></ul><p id="b60f" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">清除您将替换的区域数据:</p><ul class=""><li id="d3c2" class="mp mq iq lp b lq mk lt ml lw mr ma ms me mt mi mu mv mw mx bi translated">转到“数据/区域”并删除最右侧列出的任何列，除了“几何图形= A”和“名称= B”</li><li id="ef3c" class="mp mq iq lp b lq my lt mz lw na ma nb me nc mi mu mv mw mx bi translated">完全移除C、D和E列。</li></ul><p id="ffbf" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">转到预览窗格。你应该会看到一张空白的美国地图。当您将鼠标悬停在一个州上时，它的轮廓会高亮显示，其名称会弹出。您的地图现在已准备好接收有关脊髓灰质炎疫苗接种的数据。</p><h1 id="9924" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">导入和合并数据</h1><p id="f51e" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">转到数据/区域。更改右侧的上传选项，上传数据并合并。按下那个按钮。</p><p id="77fb" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">当前数据(flower模板中的地图地理)与传入数据(Python中的脊髓灰质炎疫苗文件)正确对齐非常重要。fruit善于猜测哪些列应该相互连接。在这种情况下，模板中的<strong class="lp ir">名称</strong>列应该连接到传入数据中的<strong class="lp ir">地理位置</strong>列。您通常可以保留其他选项的默认设置。因此，上传/合并操作如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/a3065daec6b73c433e692d6c17882da5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8phB8znHfm4TukjpI8Sz_g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="e7f0" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">继续进行合并，然后选择Next。</p><h1 id="1e45" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">设置Choropleth值和颜色</h1><p id="bb74" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">choropleth映射的目标是将数据值(数字或关键字)显示为颜色。对于如何给地图上色，您有许多选择，因此您应该尝试各种方案，看看哪种方案最能表达您想要讲述的数据故事。有内置的配色方案，你可以定义自己的。颜色可以是分级的(一组固定的颜色，每个颜色代表一个值范围)或连续的(根据数值字段改变阴影)。任何配色方案都可以轻松反转，因此低/高颜色可以互换。</p><p id="0141" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">制作同样的<a class="ae mj" href="https://public.flourish.studio/visualisation/10938243/" rel="noopener ugc nofollow" target="_blank">脊髓灰质炎疫苗接种图</a>如本文顶部所示:</p><ul class=""><li id="b5cc" class="mp mq iq lp b lq mk lt ml lw mr ma ms me mt mi mu mv mw mx bi translated">转到数据/区域。</li><li id="5825" class="mp mq iq lp b lq my lt mz lw na ma nb me nc mi mu mv mw mx bi translated">设置值= C。(该值决定哪个变量控制着色。)</li><li id="6d64" class="mp mq iq lp b lq my lt mz lw na ma nb me nc mi mu mv mw mx bi translated">转到预览/区域/填充。</li><li id="0a7c" class="mp mq iq lp b lq my lt mz lw na ma nb me nc mi mu mv mw mx bi translated">设置刻度类型=数字、顺序、线性。</li><li id="d15a" class="mp mq iq lp b lq my lt mz lw na ma nb me nc mi mu mv mw mx bi translated">设置调色板=绿色，不反转。</li></ul><p id="4cc0" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">您应该看到这个:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/1149fd93b7e8155927c7a8ac752c4355.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xW9SUJcjRWROd7_F8H33qw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由作者提供，使用Flourish.studio</p></figure><p id="557e" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">以下是具有相同数据的完全相同的配色方案，但颜色相反:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/1cc8e43dbc8f91075828d3d5eba69fc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AYgluVoVyTPHlBxwwlgZZg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由作者提供，使用Flourish.studio</p></figure><p id="d2bb" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">以下是使用等离子调色板的相同数据:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/0ac40acd872e67789e4eda36be62e046.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vCoFhcMTalRmrKukksMb3A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由作者提供，使用Flourish.studio</p></figure><p id="886e" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">标度类型=数值型、发散型、分仓型怎么样；调色板=红色/蓝色？顺序/发散指的是颜色轴。连续通常是同一颜色的阴影，而发散是两种不同的颜色。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/d1bcea8256651cc87b9820e51542b418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C3icr24OrrCvcyabpXmGcw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由作者提供，使用Flourish.studio</p></figure><p id="b1ae" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">哪个地图比较好？哪个更清楚的说出了你想要传达的故事？这些都是主观问题，是你做的每一张地图的选择。</p><p id="b67d" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">此外，还有如何处理缺失值区域的选项，为准3D效果添加阴影，以及许多其他可能性。请注意，你可能会把自己逼疯，试图找到最好的总体结果。</p><h1 id="3c30" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">设置区域弹出窗口</h1><p id="6dc8" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">choropleth地图上的颜色编码有助于突出显示您希望查看者关注的地理区域。但是查看感兴趣区域的更多详细信息也很有帮助。为此，您需要弹出窗口:</p><ul class=""><li id="861a" class="mp mq iq lp b lq mk lt ml lw mr ma ms me mt mi mu mv mw mx bi translated">转到弹出窗口的数据/区域/元数据(在右侧控件的底部)。</li><li id="d9fc" class="mp mq iq lp b lq my lt mz lw na ma nb me nc mi mu mv mw mx bi translated">将弹出菜单设置为C，d。</li><li id="2203" class="mp mq iq lp b lq my lt mz lw na ma nb me nc mi mu mv mw mx bi translated">转到预览。当您将鼠标悬停在每个区域上时，您应该会看到该区域的疫苗接种百分比和数据样本量。</li></ul><h1 id="79ab" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">设置页眉、页脚和致谢名单</h1><p id="1412" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">由于大多数地图都需要标题和数据配额:</p><ul class=""><li id="52fc" class="mp mq iq lp b lq mk lt ml lw mr ma ms me mt mi mu mv mw mx bi translated">转到预览/页眉/标题(和副标题)。想怎么设置就怎么设置。</li><li id="49c9" class="mp mq iq lp b lq my lt mz lw na ma nb me nc mi mu mv mw mx bi translated">转到预览/页脚/源名称(和URL)。根据需要设置。我建议保持名称简短，因为几个学分很快就会填满地图页脚。您可以添加多个信号源。</li><li id="9b0c" class="mp mq iq lp b lq my lt mz lw na ma nb me nc mi mu mv mw mx bi translated">您输入的任何要注意的内容都会出现在源演职员表之后。</li></ul><h1 id="e635" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">发布地图</h1><p id="3bab" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">要使您的地图对其他人可见:</p><ul class=""><li id="01b9" class="mp mq iq lp b lq mk lt ml lw mr ma ms me mt mi mu mv mw mx bi translated">单击导出和发布/发布以共享和嵌入/发布。</li><li id="4920" class="mp mq iq lp b lq my lt mz lw na ma nb me nc mi mu mv mw mx bi translated">将向您显示公共URL和嵌入地图的代码。</li></ul><p id="62f0" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">如果您稍后对地图进行了更改，您可以在相同的URL上重新发布，以便读者可以立即看到更新。</p><h1 id="deeb" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">了解更多信息</h1><p id="54dc" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated"><a class="ae mj" href="https://en.wikipedia.org/wiki/Choropleth_map" rel="noopener ugc nofollow" target="_blank">en.wikipedia.org/wiki/Choropleth_map</a>(关于choropleth地图的一般信息)</p><p id="fd29" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated"><a class="ae mj" href="https://help.flourish.studio" rel="noopener ugc nofollow" target="_blank">help . friedy . studio</a>(兴旺帮话题)</p><p id="2ad0" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">【www.cdc.gov/vaccines/ T4】(更多疾控中心疫苗数据)</p></div></div>    
</body>
</html>