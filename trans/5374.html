<html>
<head>
<title>Staging vs Intermediate vs Mart Models in dbt</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">dbt 中的分期模式、中间模式和集市模式</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/staging-intermediate-mart-models-dbt-2a759ecc1db1#2022-12-02">https://towardsdatascience.com/staging-intermediate-mart-models-dbt-2a759ecc1db1#2022-12-02</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="0077" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">在数据构建工具(dbt)的上下文中理解登台、中间和集市模型的目的</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/b86fcbb3fc5cd9e65c588e3deed0698e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HeFz5z3SSpO-Pa7QVZVrSg.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@mjessier?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">米利安·耶西耶</a>在<a class="ae kz" href="https://unsplash.com/s/photos/data-model?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="b73b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在我最近的一篇文章中，我讨论了如何正确地<a class="ae kz" rel="noopener" target="_blank" href="/dbt-models-structure-c31c8977b5fc">构建 dbt 项目和数据模型</a>。当没有特定的规则和设计原则时，创建新的数据模型和维护现有的数据模型可能是乏味的任务。对于大多数组织来说，数据模型库可能会快速增长，因此如果管理不当，它可能会变成一片混乱。</p><p id="1490" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">正如我们在上一篇文章中讨论的，使用数据构建工具(dbt)构建数据模型的过程包括将模型分成三个主要层，即<strong class="lc iv"> staging </strong>、<strong class="lc iv"> intermediate </strong>和<strong class="lc iv"> marts。</strong>在接下来的几节中，我们将深入探讨每一层，并浏览一些有助于区分它们的基本概念。在这个小教程结束的时候，你应该能够告诉你应该在这些层中的哪一层放置新创建的模型(或者可能应该在哪一层插入重构的模型)。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="3344" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">分期模型</h2><p id="181d" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated"><strong class="lc iv"> staging 层</strong>包含项目的所有独立组件，其他层将使用这些组件来创建更复杂的数据模型。过渡模型应该有一个<strong class="lc iv">一对一的关系</strong>(或映射)到<strong class="lc iv">源</strong> <strong class="lc iv">表</strong>。</p><p id="4761" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因此，重要的是保持它们的简单性，并尽量减少转换。在 staging 层的上下文中可以接受的一些转换类型包括<em class="nb">类型转换</em>、<em class="nb">列重命名</em>、<em class="nb">基本计算</em>(例如 KBs 到 MBs 或 GBs)、<em class="nb">分类</em>(例如使用<code class="fe nc nd ne nf b">CASE WHEN</code>语句)。</p><p id="d2e7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">假设阶段模型对应于我们最终数据模型的初始构建块，我们通常<strong class="lc iv">将它们具体化为视图</strong>。这种策略允许引用 staging 层的任何中间或集市模型访问<strong class="lc iv">新数据</strong>，同时它<strong class="lc iv">节省了我们的空间</strong>并降低了成本。</p><p id="4c54" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">此外，应该避免<strong class="lc iv">连接</strong>，因为它们可能导致<strong class="lc iv">冗余</strong>或<strong class="lc iv">重复</strong>计算。这样的操作应该在随后的层中执行。</p><p id="4113" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最后，还应该避免<strong class="lc iv">聚合</strong>，因为这种操作会对我们的数据进行分组。这一层的目的是为后续和更复杂的数据模型构建基本的构建模块，因此，我们不希望<strong class="lc iv">限制自己</strong>并可能<strong class="lc iv">失去对有价值的源数据</strong>的访问。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="043b" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">中间模型</h2><p id="7cfb" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated"><strong class="lc iv">中间层</strong>将驻留在 staging 层上的原子构建块集合在一起，以便构建更复杂和更有意义的模型。即使中间模型用于表示对业务方面更有意义的结构，它们<strong class="lc iv">也不应该通过仪表板或应用<strong class="lc iv">直接暴露给最终用户</strong>。</strong></p><p id="022c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">由于这样的模型对最终用户来说是不可见的，在大多数情况下，<strong class="lc iv">暂时存储</strong> <strong class="lc iv">它们</strong><strong class="lc iv"/>更有意义。临时模型不是直接在数据库/数据集上创建的，而是将它们的代码插入到模型中，作为<a class="ae kz" href="https://medium.com/towards-data-science/cte-sql-945e4b461de3" rel="noopener">公共表表达式</a>引用它们。但是，请注意，在某些情况下，将它们作为视图素材是有意义的。鉴于它们是短暂的，这意味着它们不能被直接选择，因此故障排除变得有点痛苦。此外，通过<code class="fe nc nd ne nf b">run-operation</code>调用的宏不能引用(即<code class="fe nc nd ne nf b">ref()</code>短暂模型)。所以由你来决定一个特定的中间模型是应该短暂地物化还是作为一个视图，但是我的建议是从短暂的物化开始，除非这对特定的用例不再起作用。</p><p id="ace9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">每当您决定将它们具体化为视图时，在<a class="ae kz" href="https://docs.getdbt.com/docs/build/custom-schemas" rel="noopener ugc nofollow" target="_blank">自定义模式</a>中这样做可能更容易，自定义模式是在您的 dbt 概要文件中定义的主模式之外的模式。</p><p id="527d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在来看看这种模型的实际用途，如果您仍然不确定是否需要创建一个中间模型，那么请记住，中间层由将不同实体集合在一起的模型组成，以便<strong class="lc iv">吸收来自最终市场模型的</strong> <strong class="lc iv">复杂性</strong>。此外，应该以一种维护甚至促进组件可读性和灵活性的方式使用它们。</p><p id="1dd4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最后，一个好的经验法则是你在其他模型中引用一个中间模型的频率。如果同一个模型被多个模型引用，那么这意味着我们的设计可能出错了。这种现象通常表明，我们可能不得不考虑将我们的中间模型变成一个宏观模型。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="658c" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">集市模型</h2><p id="cf89" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated"><strong class="lc iv">顶层</strong>应该包括所谓的<strong class="lc iv">集市模型。</strong>换句话说，这是一个所有东西都聚集在一起的地方，业务定义的实体被构建，并通过仪表板或应用程序随时可供最终用户使用。</p><p id="44a2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">由于这一层包含最终用户正在访问的模型，这意味着性能很重要。因此，<strong class="lc iv">将它们具体化为表格</strong>是有意义的。如果创建一个表需要太多时间(或者可能花费太多)，那么您可能还需要考虑将其配置为一个<strong class="lc iv">增量模型</strong>。</p><p id="1bc2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">注意，集市模型应该相对简单，因此，<strong class="lc iv">应该避免太多的连接</strong>。如果您发现了这种不规则性，那么一个好的做法是后退一步，重新考虑您的设计——在大多数情况下，这种设计缺陷可以在中间层得到纠正。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="78f3" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">最后的想法</h2><p id="f311" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">在 dbt 中创建结构良好的项目是非常重要的，因为可靠的设计将帮助您快速增长和维护您的数据模型库，更重要的是，不会一直碰壁。</p><p id="96bb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这个过程的一个重要方面是三层设计的定义和实施 dbt 文档中也提出了这一点——包括阶段模型、中间模型和集市模型。概括一下，</p><p id="c32f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">分期</strong> <strong class="lc iv">车型</strong>应该:</p><ul class=""><li id="597d" class="ng nh iu lc b ld le lg lh lj ni ln nj lr nk lv nl nm nn no bi translated">被具体化为<strong class="lc iv">视图</strong></li><li id="cb29" class="ng nh iu lc b ld np lg nq lj nr ln ns lr nt lv nl nm nn no bi translated">仅使用基本转换，如类型转换、列重命名、基本计算和分类</li><li id="7d22" class="ng nh iu lc b ld np lg nq lj nr ln ns lr nt lv nl nm nn no bi translated"><strong class="lc iv">避免</strong> <strong class="lc iv">连接</strong>和/或<strong class="lc iv">聚合</strong></li></ul><p id="e85c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">中级车型</strong>应该:</p><ul class=""><li id="54f8" class="ng nh iu lc b ld le lg lh lj ni ln nj lr nk lv nl nm nn no bi translated">短暂地具体化<strong class="lc iv"/>(或者作为自定义模式中的视图)</li><li id="27ed" class="ng nh iu lc b ld np lg nq lj nr ln ns lr nt lv nl nm nn no bi translated"><strong class="lc iv">不向最终用户公开</strong>(通过应用或仪表板)</li><li id="2ac9" class="ng nh iu lc b ld np lg nq lj nr ln ns lr nt lv nl nm nn no bi translated">用于隔离复杂的操作</li><li id="5a54" class="ng nh iu lc b ld np lg nq lj nr ln ns lr nt lv nl nm nn no bi translated">不要在一个以上的模型中被重复引用(如果是这种情况，考虑将中间模型变成一个宏)</li></ul><p id="3ed9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">商场型号</strong>应:</p><ul class=""><li id="6d8d" class="ng nh iu lc b ld le lg lh lj ni ln nj lr nk lv nl nm nn no bi translated">具体化为<strong class="lc iv">表</strong>或<strong class="lc iv">增量</strong> <strong class="lc iv">模型</strong></li><li id="85f0" class="ng nh iu lc b ld np lg nq lj nr ln ns lr nt lv nl nm nn no bi translated"><strong class="lc iv">在单个集市模型中避免过多的连接</strong></li></ul></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><p id="1b77" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://gmyrianthous.medium.com/membership" rel="noopener"> <strong class="lc iv">成为会员</strong> </a> <strong class="lc iv">阅读介质上的每一个故事。你的会员费直接支持我和你看的其他作家。你也可以在媒体上看到所有的故事。</strong></p><div class="nu nv gq gs nw nx"><a href="https://gmyrianthous.medium.com/membership" rel="noopener follow" target="_blank"><div class="ny ab fp"><div class="nz ab oa cl cj ob"><h2 class="bd iv gz z fq oc fs ft od fv fx it bi translated">通过我的推荐链接加入 Medium-Giorgos Myrianthous</h2><div class="oe l"><h3 class="bd b gz z fq oc fs ft od fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="of l"><p class="bd b dl z fq oc fs ft od fv fx dk translated">gmyrianthous.medium.com</p></div></div><div class="og l"><div class="oh l oi oj ok og ol kt nx"/></div></div></a></div></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><p id="676e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">相关文章你可能也喜欢</strong></p><div class="nu nv gq gs nw nx"><a rel="noopener follow" target="_blank" href="/dbt-models-structure-c31c8977b5fc"><div class="ny ab fp"><div class="nz ab oa cl cj ob"><h2 class="bd iv gz z fq oc fs ft od fv fx it bi translated">如何构建您的 dbt 项目和数据模型</h2><div class="oe l"><h3 class="bd b gz z fq oc fs ft od fv fx dk translated">对 dbt 数据模型实施有意义的结构</h3></div><div class="of l"><p class="bd b dl z fq oc fs ft od fv fx dk translated">towardsdatascience.com</p></div></div><div class="og l"><div class="om l oi oj ok og ol kt nx"/></div></div></a></div></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu nx"><a rel="noopener follow" target="_blank" href="/install-dbt-1bd6a4259a14"><div class="ny ab fp"><div class="nz ab oa cl cj ob"><h2 class="bd iv gz z fq oc fs ft od fv fx it bi translated">如何安装 dbt(数据构建工具)</h2><div class="oe l"><h3 class="bd b gz z fq oc fs ft od fv fx dk translated">为您的特定数据仓库安装数据构建工具</h3></div><div class="of l"><p class="bd b dl z fq oc fs ft od fv fx dk translated">towardsdatascience.com</p></div></div><div class="og l"><div class="on l oi oj ok og ol kt nx"/></div></div></a></div></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu nx"><a rel="noopener follow" target="_blank" href="/visual-sql-joins-4e3899d9d46c"><div class="ny ab fp"><div class="nz ab oa cl cj ob"><h2 class="bd iv gz z fq oc fs ft od fv fx it bi translated">SQL 连接的直观解释</h2><div class="oe l"><h3 class="bd b gz z fq oc fs ft od fv fx dk translated">用维恩图和实际例子理解 SQL 连接</h3></div><div class="of l"><p class="bd b dl z fq oc fs ft od fv fx dk translated">towardsdatascience.com</p></div></div><div class="og l"><div class="oo l oi oj ok og ol kt nx"/></div></div></a></div></div></div>    
</body>
</html>