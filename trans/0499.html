<html>
<head>
<title>Adding a Third Y-axis to Python Combo Chart</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向Python组合图添加第三个Y轴</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/adding-a-third-y-axis-to-python-combo-chart-39f60fb66708#2022-02-20">https://towardsdatascience.com/adding-a-third-y-axis-to-python-combo-chart-39f60fb66708#2022-02-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="916e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Matplotlib、Seaborn和Pandas plot()创建多Y轴组合图的实践教程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/77e8788dfe2dfb11ce937ca568c48c52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uw3IaV-wHnYkMUrLBVTfpg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@isaacmsmith?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">艾萨克·史密斯</a>在<a class="ae ky" href="https://unsplash.com/s/photos/data-visualization?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><blockquote class="kz la lb"><p id="9250" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><em class="it">可视化数据对于分析数据至关重要。如果你看不到你的数据——从多方面看，你将很难分析这些数据。</em></p><p id="d5b5" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><em class="it">来源于Python数据【1】</em></p></blockquote><p id="c828" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">Python中有许多不同的图形来可视化数据，幸好有Matplotlib、Seaborn、Pandas、Plotly等。在数据分析过程中，你可以做一些非常强大的可视化。其中<strong class="lf iu">组合图</strong>是在同一个图形上两种图表类型(如条形图和折线图)的组合。这是Excel最受欢迎的内置图表之一，广泛用于显示不同类型的信息。</p><p id="d25a" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">在之前的<a class="ae ky" rel="noopener" target="_blank" href="/creating-a-dual-axis-combo-chart-in-python-52624b187834">文章</a>中，我们已经讨论了如何创建双轴组合图。在某些情况下，添加第三个或更多的y轴非常有用，可以直观地突出不同数据集之间的差异。在本文中，我们将探索如何用Matplotlib、Seaborn和Pandas <code class="fe mc md me mf b">plot()</code>添加第三个y轴。这篇文章的结构如下:</p><ol class=""><li id="d17d" class="mg mh it lf b lg lh lj lk lz mi ma mj mb mk ly ml mm mn mo bi translated">Matplotlib</li><li id="6521" class="mg mh it lf b lg mp lj mq lz mr ma ms mb mt ly ml mm mn mo bi translated">海生的</li><li id="a71b" class="mg mh it lf b lg mp lj mq lz mr ma ms mb mt ly ml mm mn mo bi translated">熊猫<code class="fe mc md me mf b">plot()</code></li></ol><blockquote class="mu"><p id="c3cf" class="mv mw it bd mx my mz na nb nc nd ly dk translated">请查看<a class="ae ky" href="https://github.com/BindiChen/machine-learning/blob/main/data-visualization/0010-multiple-y-axis/multiple-y-axis-combo-chart.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>获取源代码。更多教程可从<a class="ae ky" href="https://github.com/BindiChen/machine-learning" rel="noopener ugc nofollow" target="_blank"> Github Repo </a>获得。</p></blockquote><p id="dfe2" class="pw-post-body-paragraph lc ld it lf b lg ne ju li lj nf jx ll lz ng lo lp ma nh ls lt mb ni lw lx ly im bi translated">为了演示，我们将使用来自维基百科的<a class="ae ky" href="https://en.wikipedia.org/wiki/London" rel="noopener ugc nofollow" target="_blank">伦敦气候数据</a>:</p><pre class="kj kk kl km gt nj mf nk nl aw nm bi"><span id="8dbc" class="nn no it mf b gy np nq l nr ns"><strong class="mf iu">x</strong> = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']<br/><strong class="mf iu">average_temp</strong> = [5.2, 5.3,7.6,9.9,13.3,16.5,18.7, 18.5, 15.7, 12.0, 8.0, 5.5]<br/><strong class="mf iu">average_percipitation_mm</strong> = [55.2, 40.9, 41.6, 43.7, 49.4, 45.1, 44.5, 49.5, 49.1, 68.5, 59.0, 55.2]<br/><strong class="mf iu">average_uv_index</strong> = [1,1,2,4,5,6,6,5,4,2,1,0]</span><span id="bafe" class="nn no it mf b gy nt nq l nr ns">london_climate = pd.DataFrame(<br/>  {<br/>    'average_temp': average_temp,<br/>    'average_percipitation_mm': average_percipitation_mm,<br/>    'average_uv_index': average_uv_index<br/>  }, <br/>  index=x<br/>)</span></pre><p id="34c8" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">在同一个图表上绘制多个图表非常容易。例如，使用Matplotlib，我们可以简单地一个接一个地调用图表函数。</p><pre class="kj kk kl km gt nj mf nk nl aw nm bi"><span id="7a85" class="nn no it mf b gy np nq l nr ns">plt.<strong class="mf iu">plot</strong>(x, average_temp, "-r", label="average temp")<br/>plt.<strong class="mf iu">plot</strong>(x, average_percipitation_mm, "-b", label="average percipitation mm", )<br/>plt.<strong class="mf iu">plot</strong>(x, average_uv_index, "-g", label="average temp")</span><span id="d15a" class="nn no it mf b gy nt nq l nr ns">plt.legend(loc="upper left")<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/4cbd54a95c60d588c72213ac495eb108.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TSKKua3gvkeT4X-Q7_zFRg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">单轴组合图(图片由作者提供)</p></figure><p id="9560" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">这当然会创建一个组合图，但是所有的线条都使用相同的Y轴。查看和解释可能非常困难，尤其是当数据在不同的范围内时。我们可以使用多个Y轴来改进它。但是一开始使用多个Y轴可能会有点混乱。让我们继续探索如何向Python组合图添加第三个Y轴。</p><h1 id="7b90" class="nv no it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">1.Matplotlib添加第三个Y轴</h1><p id="ddc8" class="pw-post-body-paragraph lc ld it lf b lg om ju li lj on jx ll lz oo lo lp ma op ls lt mb oq lw lx ly im bi translated">在上一篇文章中，我们已经学习了通过调用<code class="fe mc md me mf b">twin()</code>生成共享同一X轴的两个独立的Y轴来制作双轴组合图的技巧。通过创建另一个<code class="fe mc md me mf b">twinx()</code>轴并使用<code class="fe mc md me mf b">set_postion()</code>偏移第三个轴的右脊椎位置，可以类似地创建第三个y轴:</p><pre class="kj kk kl km gt nj mf nk nl aw nm bi"><span id="99a6" class="nn no it mf b gy np nq l nr ns"># Create figure and axis #1<br/>fig, ax1 = plt.subplots()</span><span id="6c2e" class="nn no it mf b gy nt nq l nr ns"># plot line chart on axis #1<br/>p1, = ax1.plot(x, average_temp) <br/>ax1.set_ylabel('average temp')<br/>ax1.set_ylim(0, 25)<br/>ax1.legend(['average_temp'], loc="upper left")<br/>ax1.yaxis.label.set_color(p1.get_color())<br/>ax1.yaxis.label.set_fontsize(14)<br/>ax1.tick_params(axis='y', colors=p1.get_color(), labelsize=14)</span><span id="e83b" class="nn no it mf b gy nt nq l nr ns"># set up the 2nd axis<br/><strong class="mf iu">ax2 = ax1.twinx() </strong><br/># plot bar chart on axis #2<br/>p2, = ax2.plot(x, average_percipitation_mm, color='orange')<br/>ax2.grid(False) # turn off grid #2<br/>ax2.set_ylabel('average percipitation mm')<br/>ax2.set_ylim(0, 90)<br/>ax2.legend(['average_percipitation_mm'], loc="upper center")<br/>ax2.yaxis.label.set_color(p2.get_color())<br/>ax2.yaxis.label.set_fontsize(14)<br/>ax2.tick_params(axis='y', colors=p2.get_color(), labelsize=14)</span><span id="07c8" class="nn no it mf b gy nt nq l nr ns"># set up the 3rd axis<br/><strong class="mf iu">ax3 = ax1.twinx()</strong><br/># Offset the right spine of ax3.  The ticks and label have already been placed on the right by twinx above.<br/><strong class="mf iu">ax3.spines.right.set_position(("axes", 1.15))</strong><br/># Plot line chart on axis #3<br/>p3, = ax3.plot(x, average_uv_index, color='red')<br/>ax3.grid(False) # turn off grid #3<br/>ax3.set_ylabel('average UV index')<br/>ax3.set_ylim(0, 8)<br/>ax3.legend(['average_uv_index'], loc="upper right")<br/>ax3.yaxis.label.set_color(p3.get_color())<br/>ax3.yaxis.label.set_fontsize(14)<br/>ax3.tick_params(axis='y', colors=p3.get_color(), labelsize=14)</span><span id="8184" class="nn no it mf b gy nt nq l nr ns">plt.show()</span></pre><p id="ae8d" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">像我们通常做的那样，在<code class="fe mc md me mf b">ax1</code>上绘制第一条线图。我们调用<code class="fe mc md me mf b">ax2 = ax1.twinx()</code>来设置第二轴并绘制第二线图。之后，我们再次调用<code class="fe mc md me mf b">ax3 = ax1.twinx()</code>来设置第三轴并绘制第三线图。窍门是调用<code class="fe mc md me mf b">ax3.spines.right.set_position(("axes", 1.15))</code>偏移<code class="fe mc md me mf b">ax3</code>的右脊线。请注意，调用<code class="fe mc md me mf b">ax2.grid(False)</code>和<code class="fe mc md me mf b">ax3.grid(False)</code>是为了避免网格显示问题。通过执行代码，您应该得到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/a712d20aed2bfcfdc76f57295140b5f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wxweb4NhnQV_XXwBzGlxxw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用Matplotlib的第三个y轴组合图(图片由作者提供)</p></figure><h1 id="f83d" class="nv no it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">3.Seaborn添加第三个Y轴</h1><p id="bebb" class="pw-post-body-paragraph lc ld it lf b lg om ju li lj on jx ll lz oo lo lp ma op ls lt mb oq lw lx ly im bi translated">Seaborn是一个构建在<strong class="lf iu"> <em class="le"> Matplotlib </em> </strong>之上的高级数据可视化库。在幕后，它使用<strong class="lf iu"> <em class="le"> Matplotlib </em> </strong>来绘制它的情节。对于底层配置和设置，我们总是可以调用<strong class="lf iu"> <em class="le"> Matplotlib </em> </strong>的API，这就是在<strong class="lf iu"> <em class="le"> Seaborn </em> </strong>中制作多Y轴组合图的诀窍:</p><pre class="kj kk kl km gt nj mf nk nl aw nm bi"><span id="8cc6" class="nn no it mf b gy np nq l nr ns"># plot line chart on axis #1<br/>ax1 = sns.lineplot(<br/>    x=london_climate.index, <br/>    y='average_temp', <br/>    data=london_climate, <br/>    sort=False, <br/>    color='blue'<br/>)<br/>ax1.set_ylabel('average temp')<br/>ax1.set_ylim(0, 25)<br/>ax1.legend(['average_temp'], loc="upper left")<br/>ax1.yaxis.label.set_color('blue')<br/>ax1.yaxis.label.set_fontsize(14)<br/>ax1.tick_params(axis='y', colors='blue', labelsize=14)</span><span id="3c40" class="nn no it mf b gy nt nq l nr ns"># set up the 2nd axis<br/><strong class="mf iu">ax2 = ax1.twinx()</strong><br/># plot bar chart on axis #2<br/>sns.lineplot(<br/>    x=london_climate.index, <br/>    y='average_percipitation_mm', <br/>    data=london_climate, <br/>    sort=False, <br/>    color='orange', <br/>    <strong class="mf iu">ax = ax2</strong>       # Pre-existing axes for the plot<br/>)<br/>ax2.grid(False) # turn off grid #2<br/>ax2.set_ylabel('average percipitation mm')<br/>ax2.set_ylim(0, 90)<br/>ax2.legend(['average_percipitation_mm'], loc="upper center")<br/>ax2.yaxis.label.set_color('orange')<br/>ax2.yaxis.label.set_fontsize(14)<br/>ax2.tick_params(axis='y', colors='orange', labelsize=14)</span><span id="810a" class="nn no it mf b gy nt nq l nr ns"># set up the 3rd axis<br/><strong class="mf iu">ax3 = ax1.twinx()</strong><br/># Offset the right spine of ax3. The ticks and label have already been placed on the right by twinx above.<br/><strong class="mf iu">ax3.spines.right.set_position(("axes", 1.15))</strong><br/># Plot line chart on axis #3<br/>p3 = sns.lineplot(<br/>    x=london_climate.index, <br/>    y='average_uv_index', <br/>    data=london_climate, <br/>    sort=False, <br/>    color='red', <br/>    <strong class="mf iu">ax = ax3</strong>       # Pre-existing axes for the plot<br/>)<br/>ax3.grid(False) # turn off grid #3<br/>ax3.set_ylabel('average UV index')<br/>ax3.set_ylim(0, 8)<br/>ax3.legend(['average_uv_index'], loc="upper right")<br/>ax3.yaxis.label.set_color('red')<br/>ax3.yaxis.label.set_fontsize(14)<br/>ax3.tick_params(axis='y', colors='red', labelsize=14)</span><span id="1d7b" class="nn no it mf b gy nt nq l nr ns">plt.show()</span></pre><p id="a428" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><code class="fe mc md me mf b">sns.lineplot()</code>返回一个Matplotlib轴对象<code class="fe mc md me mf b">ax1</code>。然后，类似于Matplotlib解决方案，我们调用<code class="fe mc md me mf b">ax2 = ax1.twinx()</code>来设置第二个轴。之后，使用参数<code class="fe mc md me mf b">ax = ax2</code>调用<code class="fe mc md me mf b">sns.lineplot()</code>在现有轴<code class="fe mc md me mf b">ax2</code>上绘图。对于第3行，我们再次调用<code class="fe mc md me mf b">ax3 = ax1.twinx()</code>来设置第3轴，并使用参数<code class="fe mc md me mf b">ax=ax3</code>调用<code class="fe mc md me mf b">sns.lineplot()</code>在现有轴<code class="fe mc md me mf b">ax3</code>上绘图。我们应用同样的技巧<code class="fe mc md me mf b">ax3.spines.right.set_position(("axes", 1.15))</code>来偏移<code class="fe mc md me mf b">ax3</code>的右脊椎。通过执行代码，您应该得到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/6676d5b6fa99c63add73dea37ae42d6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6zAlSBwiGDo3MFiSMEifzw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用Seaborn的第三个y轴组合图(图片由作者提供)</p></figure><h1 id="cbd2" class="nv no it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">4.熊猫图()-添加第三个Y轴</h1><p id="a1d0" class="pw-post-body-paragraph lc ld it lf b lg om ju li lj on jx ll lz oo lo lp ma op ls lt mb oq lw lx ly im bi translated">熊猫用<code class="fe mc md me mf b">plot()</code>法制作图表。默认情况下，它调用Matplotlib的API。我们可以将参数<code class="fe mc md me mf b">secondary_y</code>设置为<code class="fe mc md me mf b">True</code>，以允许在辅助Y轴上绘制第二个图表。要添加带有第三个Y轴的第三个图表，我们可以应用与之前相同的技巧。</p><pre class="kj kk kl km gt nj mf nk nl aw nm bi"><span id="5012" class="nn no it mf b gy np nq l nr ns"># Create the figure and axes object<br/>fig, ax = plt.subplots()</span><span id="55f3" class="nn no it mf b gy nt nq l nr ns"># Plot the first x and y axes:<br/>london_climate.plot(<br/>    use_index=True, <br/>    y='average_percipitation_mm', <br/>    <strong class="mf iu">ax=ax, </strong><br/>    color='orange'<br/>)<br/>ax.set_ylabel('average_percipitation_mm')</span><span id="63ae" class="nn no it mf b gy nt nq l nr ns"># Plot the second x and y axes. <br/># By secondary_y = True a second y-axis is requested<br/>ax2 = london_climate.plot(<br/>    use_index=True, <br/>    y='average_temp', <br/>    <strong class="mf iu">ax=ax,</strong> <br/>    <strong class="mf iu">secondary_y=True,</strong> <br/>    color='blue'<br/>)<br/>ax.legend().set_visible(False)<br/>ax2.set_ylabel('average_temp')</span><span id="8fcf" class="nn no it mf b gy nt nq l nr ns"># Plot the third x and y axes<br/><strong class="mf iu">ax3 = ax.twinx()<br/>ax3.spines.right.set_position(("axes", 1.15))</strong><br/>london_climate.plot(<br/>    use_index=True, <br/>    y='average_uv_index', <br/>    <strong class="mf iu">ax=ax3,</strong> <br/>    color='red'<br/>)<br/>ax3.grid(False)<br/>ax3.set_ylabel('average_uv_index')</span><span id="9972" class="nn no it mf b gy nt nq l nr ns"># Set up legends<br/>ax3.legend(<br/>    [ax.get_lines()[0], ax2.get_lines()[0], ax3.get_lines()[0]], <br/>    ['average_percipitation_mm','average_temp','average_uv_index'], <br/>    loc="upper left"<br/>)</span><span id="6c57" class="nn no it mf b gy nt nq l nr ns">plt.show()</span></pre><p id="0407" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">注意，我们设置<code class="fe mc md me mf b">use_index=True</code>使用索引作为x轴的刻度。通过执行代码，您应该得到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/6025d88571d5f1395cc324f59f4d9e28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eadgvcvc8Dv_Fhvr1x4U8A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用熊猫图()的第三个y轴组合图(图片由作者提供)</p></figure><h1 id="91fb" class="nv no it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">结论</h1><p id="48e4" class="pw-post-body-paragraph lc ld it lf b lg om ju li lj on jx ll lz oo lo lp ma op ls lt mb oq lw lx ly im bi translated">在本文中，我们学习了如何用<strong class="lf iu"><em class="le"/></strong><strong class="lf iu"><em class="le">Seaborn</em></strong>和<strong class="lf iu"> <em class="le"> Pandas </em> </strong> <code class="fe mc md me mf b">plot()</code>创建一个多Y轴组合图。组合图是数据可视化中最流行的图表之一，知道如何创建多Y轴组合图对分析数据非常有帮助。</p><p id="cefa" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">感谢阅读。请查看<a class="ae ky" href="https://github.com/BindiChen/machine-learning/blob/main/data-visualization/0010-multiple-y-axis/multiple-y-axis-combo-chart.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>获取源代码，如果您对机器学习的实用方面感兴趣，请继续关注。更多教程可从<a class="ae ky" href="https://github.com/BindiChen/machine-learning" rel="noopener ugc nofollow" target="_blank"> Github Repo </a>获得。</p><h1 id="446a" class="nv no it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">参考</h1><ul class=""><li id="8240" class="mg mh it lf b lg om lj on lz ou ma ov mb ow ly ox mm mn mo bi translated">[1] Python数据— <a class="ae ky" href="https://pythondata.com/visualizing-data-overlaying-charts/" rel="noopener ugc nofollow" target="_blank">可视化数据—用Python叠加图表</a></li></ul></div></div>    
</body>
</html>