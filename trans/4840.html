<html>
<head>
<title>Hyperparameter Tuning and Sampling Strategy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">超参数调整和采样策略</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/hyperparameter-tuning-and-sampling-strategy-1014e05f6c14#2022-10-27">https://towardsdatascience.com/hyperparameter-tuning-and-sampling-strategy-1014e05f6c14#2022-10-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9a28" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><strong class="ak"> <em class="kf">利用流水线和超参数调优寻找最佳采样策略</em> </strong></h2></div><p id="0a10" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">处理不平衡机器学习问题的关键步骤之一是对数据进行重新采样。我们可以对多数类进行欠采样和/或对少数类进行过采样。然而，有一个问题需要解决:我们应该将多数阶级减少到多少，和/或增加少数阶级？一种简单但耗时的方法是逐个改变多数类和少数类的重采样值，以找到最佳匹配。得益于<a class="ae lc" href="https://imbalanced-learn.org/stable/" rel="noopener ugc nofollow" target="_blank">不平衡学习</a>库和超参数调整，我们可以设计出一种高效且相对简单的方法来确定最佳重采样策略。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ld"><img src="../Images/8dba52ca59e3726fefbf697df418e262.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wwO2N48onXKwEgmn"/></div></div><p class="lp lq gj gh gi lr ls bd b be z dk translated">迪伦·麦克劳德在<a class="ae lc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="9f83" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">建造管道</strong></p><p id="6dcf" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">选择<a class="ae lc" href="https://www.openml.org/search?type=data&amp;sort=runs&amp;id=1597&amp;status=active" rel="noopener ugc nofollow" target="_blank">欺诈检测数据集</a>进行实验，该数据集<a class="ae lc" href="https://creativecommons.org/licenses/by/4.0/" rel="noopener ugc nofollow" target="_blank"> CC许可</a>并可从<a class="ae lc" href="https://www.openml.org/" rel="noopener ugc nofollow" target="_blank"> OpenML平台</a>访问。数据集有31个特征:其中28个特征(V1到V28)是数字特征，使用PCA进行转换以保持机密性；“时间”描述了每个事务经过的秒数；“金额”表示交易金额；“类别”表示交易是否是欺诈性的。数据非常不平衡，因为所有交易中只有0.172%是欺诈性的。</p><div class="ma mb gp gr mc md"><a href="https://www.openml.org/search?type=data&amp;sort=runs&amp;id=1597&amp;status=active" rel="noopener  ugc nofollow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd ir gy z fp mi fr fs mj fu fw ip bi translated">OpenML</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">OpenML是一个共享数据集、算法和实验的开放平台——一起学习如何更好地学习。</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">www.openml.org</p></div></div></div></a></div><p id="0087" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">为了确定最佳采样率，我们需要建立一个机器学习管道。许多数据爱好者更喜欢scikit-learn的管道，因为它提供了一种建立机器学习管道的简单方法。然而，欠采样和过采样不能使用常规sklearn流水线来完成，因为采样将在<em class="mm">拟合</em>和<em class="mm">变换</em>方法期间发生。这可以通过不平衡学习(imblearn)库实现的<a class="ae lc" href="https://imbalanced-learn.org/stable/references/generated/imblearn.pipeline.Pipeline.html" rel="noopener ugc nofollow" target="_blank">管道类来弥补。imblearn的流水线确保重采样只发生在<em class="mm">拟合</em>方法期间。</a></p><div class="ma mb gp gr mc md"><a href="https://imbalanced-learn.org/stable/references/generated/imblearn.pipeline.Pipeline.html" rel="noopener  ugc nofollow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd ir gy z fp mi fr fs mj fu fw ip bi translated">管道-版本0.9.1</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">编辑描述</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">imbalanced-learn.org</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms ln md"/></div></div></a></div><p id="a838" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">首先，我们将加载数据。然后，从数据中获取特征和标签，并创建训练测试分割，因此测试分割可用于评估使用训练分割训练的模型的性能。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="cb86" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">一旦创建了训练集和测试集，就可以实例化管道。流水线由一系列步骤组成:转换数据、重采样和以模型结束。为了简单起见，我们将使用一个数值缩放器(来自sklearn 的<a class="ae lc" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.RobustScaler.html?highlight=robustscaler#sklearn.preprocessing.RobustScaler" rel="noopener ugc nofollow" target="_blank"> RobustScaler)来缩放数值字段(数据集中的所有特征都是数值)；然后是欠采样方法(</a><a class="ae lc" href="https://imbalanced-learn.org/stable/references/generated/imblearn.under_sampling.RandomUnderSampler.html" rel="noopener ugc nofollow" target="_blank"> RandomUnderSampler类</a>)、过采样方法(<a class="ae lc" href="https://imbalanced-learn.org/stable/references/generated/imblearn.over_sampling.SMOTE.html" rel="noopener ugc nofollow" target="_blank"> SMOTE算法</a>)，最后是机器学习模型(我们使用的是<a class="ae lc" href="https://lightgbm.readthedocs.io/en/latest/pythonapi/lightgbm.LGBMClassifier.html" rel="noopener ugc nofollow" target="_blank"> LightGBM </a>，一个实现梯度提升算法的框架)。作为初始基准，多数类欠采样到10，000，少数类过采样到10，000。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mt mu l"/></div></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="e397" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">初始建模</strong></p><p id="ff67" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在进行超参数调整之前，先训练一个初始模型。上一节中构建的管道在列车分裂上进行训练，然后在测试分裂上进行测试。由于我们选择的数据是高度不平衡的(在重采样之前)，只测量精度是无效的。因此，通过使用<a class="ae lc" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.classification_report.html" rel="noopener ugc nofollow" target="_blank"> sklearn的分类报告</a>，我们将监控两个类的精确度、召回率和f1分数。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mt mu l"/></div></figure><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi mv"><img src="../Images/55b3235e87e4b4154fce9404705c30e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uBsCHDA_RQ-6BLhkTFXPIg.png"/></div></div><p class="lp lq gj gh gi lr ls bd b be z dk translated">评估基础管道的分类报告。图片由作者提供。</p></figure><p id="6701" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">测试结果表明，虽然该模型在对非欺诈性交易进行分类方面工作得很好，但在检测欺诈方面却很差，因为精确度和f1分数都非常低。有了这个基准，我们将看到超参数调优如何帮助我们找到更好的采样率。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="a4bb" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">调优寻找最佳采样率</strong></p><p id="afdd" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在本文中，我们将只关注欠采样和过采样技术的采样策略。最初，创建两个列表，其包括用于欠采样和过采样方法的不同采样策略。这些列表将用于从给定的采样策略中找到最佳的采样策略。</p><p id="e870" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><a class="ae lc" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV.html?highlight=gridsearchcv#sklearn.model_selection.GridSearchCV" rel="noopener ugc nofollow" target="_blank"> GridSearchCV </a>和<a class="ae lc" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.RandomizedSearchCV.html?highlight=randomizedsearchcv#sklearn.model_selection.RandomizedSearchCV" rel="noopener ugc nofollow" target="_blank"> RandomizedSearchCV </a>是sklearn的两个超参数调优类，前者遍历提供的所有参数值以找到最佳值集，后者随机选择超参数值并运行，直到达到用户指定的迭代次数。在这个实验中，我们将使用GridSearchCV进行超参数调优。GridSearchCV需要两个参数:<em class="mm">估计器</em>和<em class="mm"> param_grid </em>。<em class="mm">估计器</em>是模型(在我们的例子中是管道)，而<em class="mm"> param_grid </em>是一个字典，其中的键代表需要调整的参数，值代表参数的值集。</p><p id="de50" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">使用管道重新采样和构建模型可以更容易地执行超参数调整，并找到最佳采样策略。由于我们已经在管道中指定了欠采样和过采样技术的名称(如“欠采样器”和“过采样器”)，我们可以使用“__”来访问它们的参数，以使用该参数进行超参数调整(例如，“欠采样器_ _采样策略”)。</p><p id="3ed4" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">一旦超参数调优完成，我们就可以从指定列表中获得欠采样和过采样的最佳采样策略集，然后用它们来训练流水线，评估其性能。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="mt mu l"/></div></figure><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi mw"><img src="../Images/ed9f4e106b54c01bd769183e3f1f151c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rpoPGGOyWmgaGlenxjQ28A.png"/></div></div><p class="lp lq gj gh gi lr ls bd b be z dk translated">评估hp调整管道的分类报告。图片由作者提供。</p></figure><p id="85c5" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">使用超参数调整来寻找最佳采样策略是有效的，因为管道在检测欺诈交易方面有了显著的改进。</p><p id="f8c1" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这篇文章的工作原理可以在这里找到。</p><div class="ma mb gp gr mc md"><a href="https://github.com/Vaseekaran-V/HP_Tuning_Sampling_Strategy" rel="noopener  ugc nofollow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd ir gy z fp mi fr fs mj fu fw ip bi translated">GitHub-Vaseekaran-V/HP _ Tuning _ Sampling _ Strategy:Repo使用超参数调优来查找…</h2><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">github.com</p></div></div><div class="mn l"><div class="mx l mp mq mr mn ms ln md"/></div></div></a></div></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="e47c" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">最后的话</strong></p><p id="49c3" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在重采样时找到采样率的最佳点是耗时且复杂的，但机器学习管道和超参数调整可以提供一种简单的解决方案来缓解该问题。</p><p id="8218" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">本文研究了超参数调整对欠采样和过采样技术确定最佳采样比的影响，该解决方案相对容易实现。</p><p id="95ac" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我希望这篇文章对你有用，我<a class="ae lc" href="https://www.linkedin.com/in/vvaseekaran/" rel="noopener ugc nofollow" target="_blank">希望听到你对这篇文章的反馈/批评</a>，因为它将帮助我提高写作和编码技能。</p><p id="47b9" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">干杯！</p></div></div>    
</body>
</html>