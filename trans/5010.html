<html>
<head>
<title>Heterogeneous Treatment Effect Using Double Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于双机学习的异构处理效果</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/heterogeneous-treatment-effect-using-double-machine-learning-65ab41f9a5dc#2022-11-08">https://towardsdatascience.com/heterogeneous-treatment-effect-using-double-machine-learning-65ab41f9a5dc#2022-11-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="04cd" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用双机器学习的因果推理</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/bc57c0971069d21c8778da92c15c074f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s410N5WoGDQXGR2_"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">马库斯·温克勒在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="6339" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文是下面链接的因果推理系列的延续。如果你是因果推理空间的新手，我强烈建议你先浏览下面的文章。</p><p id="5de6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">1 .<a class="ae kv" rel="noopener" target="_blank" href="/getting-started-with-causal-inference-5cb61b707740">因果推理入门</a></p><p id="aa39" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.<a class="ae kv" rel="noopener" target="_blank" href="/methods-for-inferring-causality-52e4144f6865">推断因果关系的方法</a></p><p id="7aaa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">3.<a class="ae kv" href="https://medium.com/towards-data-science/heterogeneous-treatment-effect-and-meta-learners-38fbc3ecc9d3" rel="noopener">使用元学习者的异质治疗效果</a></p><p id="b7e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">双机器学习(DML) </strong>是估计异质治疗效果的方法，尤其是当我们有大量混杂因素时。与我们在上一篇文章中讨论的<a class="ae kv" href="https://medium.com/towards-data-science/heterogeneous-treatment-effect-and-meta-learners-38fbc3ecc9d3" rel="noopener">元学习者</a>不同，它也适用于<strong class="ky ir">连续治疗</strong>。该方法在获得2020年诺贝尔经济学奖的论文<a class="ae kv" href="https://arxiv.org/pdf/1608.00060v1.pdf" rel="noopener ugc nofollow" target="_blank">中介绍了治疗和因果参数</a>。</p><blockquote class="ls lt lu"><p id="b5b3" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">DML基于这种很酷的回归概念，即如果您有两组特征X₁和X₂，您使用线性回归估计模型参数β₁和β₂<strong class="ky ir">y =β₁x₁+β₂x₂，</strong>然后<strong class="ky ir"> </strong>通过以下步骤可以获得相同的参数集β₁can</p></blockquote><ol class=""><li id="ba7b" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr me mf mg mh bi translated">回归y的第二组特征Y₁ᵣ= γ₁X₂</li><li id="cbb8" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">在第二组要素上回归第一组要素X₁ᵣ = γ₂ X₂</li><li id="2c35" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">获取残差Yᵣ = Y- Y₁ᵣ，xᵣ=x₁-x₁ᵣ</li><li id="70bb" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">回归特征残差的结果残差Yᵣ = α+ β₁Xᵣ</li></ol><p id="208d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将通过一起回归所有要素来获得相同的β₁as。很酷吧。第一组特征(上面的X₁)可以是我们的治疗方法，第二组特征可以是混杂因素，其对结果的影响可以单独估计。</p><h2 id="56a3" class="mn mo iq bd mp mq mr dn ms mt mu dp mv lf mw mx my lj mz na nb ln nc nd ne nf bi translated">双/去偏置机器学习</h2><p id="0374" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">DML使用上面解释的这个非常简单的想法，但是它使用ML模型而不是线性回归，因此我们可以在估计结果和治疗残差时处理非线性和相互作用。</p><p id="451f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">yᵢ-mᵧ(xᵢ)=τ(tᵢ-mₜ(xᵢ))+εᵢ</strong></p><p id="7250" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Mᵧ(Xᵢ)是通过对x回归y获得的结果，而Mₜ(Xᵢ)是通过对x回归t获得的结果。<strong class="ky ir"> τ </strong>是在控制混杂因素后治疗对结果的影响，但它是一个常数，而不是任何协变量的函数，也就是说，它代表<strong class="ky ir">吃了</strong>(平均治疗效果在以前的文章中详细讨论过<a class="ae kv" rel="noopener" target="_blank" href="/getting-started-with-causal-inference-5cb61b707740"> <strong class="ky ir"> <em class="lv">因果推断入门</em> </strong> </a>和<strong class="ky ir"> </strong> <a class="ae kv" rel="noopener" target="_blank" href="/methods-for-inferring-causality-52e4144f6865/"> <strong class="ky ir"> <em class="lv">推断方法</em></strong></a></p><p id="3cd0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还可以估计CATE，其中允许<strong class="ky ir"> τ </strong>随单位的协变量而变化</p><p id="762c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">yᵢ-mᵧ(xᵢ)=τ(xᵢ)(tᵢ-mₜ(xᵢ))+εᵢ</strong></p><p id="0a02" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了使用DML估计CATE，我们将使用治疗和结果的残差，但现在我们将使用其他协变量来处理残差。</p><p id="c9d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> Yᵣ = β₁ + β₂XᵢTᵢᵣ </strong></p><p id="d06c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">DML可能遇到的一个问题是过度拟合。如果Mᵧ模型过度拟合，剩余Yᵣ将比它应该的要小，捕捉到的不仅仅是x和y之间的关系，还有t和y之间的关系，这将使因果估计(剩余回归)偏向于零。如果Mₜ过度拟合，治疗残差的方差将小于它应有的方差。似乎每个人的治疗都是一样的，这使得很难估计在不同的治疗方案下会发生什么。因此，建议在结果和治疗模型中使用<strong class="ky ir">交叉验证</strong></p><p id="d0b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们编写代码，通过一个例子来理解这一点。我们将使用一个果汁品牌的合成销售数据。我们的目标是预测价格对温度的弹性。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/45e530c9fa117d31865add8ab44b60f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*99MoiBzwysPYz_pUHoGxXQ.png"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/323ccf87e572d18a82461fe59dcb4cd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*BTuHn21yph_1aPXfVccHDQ.png"/></div></figure><p id="01e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们现在使用微软开发的EconML库中的DML函数，而不是开发我们自己的DML函数。我强烈建议浏览一下关于DML的  <a class="ae kv" href="https://econml.azurewebsites.net/spec/estimation/dml.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="lv"> EconML文档</em> </strong> </a> <strong class="ky ir"> <em class="lv">，因为他们的库中有不同版本的DML。</em> </strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/19055e737498090fb9dd6401ec04c2d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*gpfbUoTf8x_9-jZiopM48w.png"/></div></figure><h2 id="1d03" class="mn mo iq bd mp mq mr dn ms mt mu dp mv lf mw mx my lj mz na nb ln nc nd ne nf bi translated">非参数DML</h2><p id="8c14" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">在上述设置中，我们对残差使用线性模型，这意味着我们假设治疗对结果的影响是线性的，这种假设可能不总是成立的。</p><p id="70fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们已经看到了这个等式</p><p id="dc9e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">yᵢ-mᵧ(xᵢ)=τ(xᵢ)(tᵢ-mₜ(xᵢ)+εᵢ</strong></p><p id="0757" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们重新排列，我们得到的误差项为</p><p id="62b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">εᵢ=(yᵢ-mᵧ(xᵢ))—τ(xᵢ)(tᵢ-mₜ(xᵢ)</strong></p><blockquote class="ls lt lu"><p id="b782" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">这就是我们所说的<strong class="ky ir">因果损失函数</strong>，我们可以将其最小化以获得τ(Xᵢ)，我们的美食。</p></blockquote><p id="075f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">lₙ(τ(x))= 1/nσ((yᵢ-mᵧ(xᵢ))—τ(xᵢ)(tᵢ-mₜ(xᵢ))</strong></p><p id="a3ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">利用剩余项，我们得到这个</p><p id="985a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">lₙ(τ(x))= 1/nσ(yᵢᵣ—τ(xᵢ)tᵢᵣ)</strong></p><p id="d32d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除掉Tᵢᵣ，孤立τ(Xᵢ)</p><p id="dadb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">lₙ(τ(x))= 1/nσtᵢᵣ(yᵢᵣ/tᵢᵣ——τ(xᵢ)</strong></p><p id="abe8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以通过最小化括号内的内容并使用Tᵢᵣ作为权重来最小化上述损失。以下是步骤</p><ol class=""><li id="be62" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr me mf mg mh bi translated">创造Tᵢᵣ</li><li id="0cdb" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">创造Yᵢᵣ/Tᵢᵣ</li><li id="04de" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">使用任何最大似然模型预测Yᵢᵣ/Tᵢᵣ，使用Tᵢᵣ作为权重。</li></ol><p id="79fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们使用非参数DML来预测上述示例的cate。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/0e1373dacd30988f80f262ae8f422395.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*YvUNJyER2bZAGTS2vzahwQ.png"/></div></figure><p id="a5c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">DML通常用于解决行业中的价格弹性问题，因为它可以很好地处理连续处理。下面是一些双机器学习被用来解决行业相关问题的案例研究</p><h1 id="e405" class="nr mo iq bd mp ns nt nu ms nv nw nx mv jw ny jx my jz nz ka nb kc oa kd ne ob bi translated">个案研究</h1><p id="a809" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated"><a class="ae kv" href="https://github.com/microsoft/EconML/blob/main/notebooks/CustomerScenarios/Case%20Study%20-%20Customer%20Segmentation%20at%20An%20Online%20Media%20Company.ipynb" rel="noopener ugc nofollow" target="_blank">在线媒体公司使用DML进行客户细分</a></p><p id="7431" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://slideplayer.com/slide/12643674/" rel="noopener ugc nofollow" target="_blank">采用DML方法进行因果推断的定价</a></p><p id="5ddd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://econml.azurewebsites.net/spec/motivation.html#" rel="noopener ugc nofollow" target="_blank">基于机器学习的异构治疗效果的其他客户场景</a></p></div><div class="ab cl oc od hu oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="ij ik il im in"><h1 id="b235" class="nr mo iq bd mp ns oj nu ms nv ok nx mv jw ol jx my jz om ka nb kc on kd ne ob bi translated">参考</h1><ul class=""><li id="e106" class="lz ma iq ky b kz ng lc nh lf oo lj op ln oq lr or mf mg mh bi translated"><a class="ae kv" href="https://matheusfacure.github.io/python-causality-handbook/landing-page.html" rel="noopener ugc nofollow" target="_blank">https://matheusfacure.github.io/python-causality-handbook/</a></li><li id="8f29" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr or mf mg mh bi translated"><a class="ae kv" href="https://econml.azurewebsites.net/spec/estimation/dml.html" rel="noopener ugc nofollow" target="_blank">https://econml.azurewebsites.net/spec/estimation/dml.html</a></li><li id="a78d" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr or mf mg mh bi translated"><a class="ae kv" href="https://arxiv.org/pdf/1608.00060v1.pdf" rel="noopener ugc nofollow" target="_blank">双机治疗及因果参数</a></li></ul></div></div>    
</body>
</html>