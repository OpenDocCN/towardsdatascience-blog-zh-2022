<html>
<head>
<title>When Change Data Capture Wins</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当变更数据捕获成功时</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/when-change-data-capture-wins-271875e3df1a#2022-10-07">https://towardsdatascience.com/when-change-data-capture-wins-271875e3df1a#2022-10-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="4e20" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">意见</h2><div class=""/><div class=""><h2 id="e44a" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">关于实时数据管道何时是保持生产数据库和仓库同步的最可靠方式的指南</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/571cd8c73407757d90b2c15a128c03d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QeW23pKTHZhF-q9ePvPlMg.jpeg"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">美国公共电力协会在<a class="ae le" href="https://unsplash.com/s/photos/outage?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="ec2a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><em class="mb">与Striim的约翰·库泰合著</em></p><p id="22ae" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在分析团队多次降低生产数据库的速度后，数据仓库应运而生。分析性工作负载不适合事务性数据库，事务性数据库针对高延迟读取、写入和数据完整性进行了优化。同样，生产应用程序在事务数据库上运行也是有原因的。</p><p id="efab" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">定义:</strong>事务性(OLTP)数据存储是在事务中保持ACID(原子性、一致性、隔离性和持久性)属性的数据库。例子包括PostgreSQL和MySQL，它们可以扩展到每秒2万个<a class="ae le" href="https://info.enterprisedb.com/rs/069-ALB-339/images/PostgreSQL_MongoDB_Benchmark-WhitepaperFinal.pdf" rel="noopener ugc nofollow" target="_blank">事务</a>。</p><p id="9351" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">分析团队并不太关心在一秒钟内插入2万行—相反，他们希望连接、过滤和转换表，以便从数据中获得洞察力。数据仓库正是为此使用OLAP进行了优化。</p><p id="9cba" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">定义:</strong> <a class="ae le" href="https://www.ibm.com/cloud/learn/olap" rel="noopener ugc nofollow" target="_blank"> OLAP </a>(在线分析处理)数据库针对大量数据的多维分析进行了优化。例子包括流行的数据仓库，如Snowflake、Redshift和BigQuery。</p><p id="7a8c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">不同的团队，不同的需求，不同的数据库。问题仍然是:如果分析团队使用OLAP数据仓库，它们是如何被填充的？</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mc"><img src="../Images/79b355cf99af930c1475ee347db22550.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BiFngP-0_p9lgblyLFHDJg.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><h1 id="535d" class="md me iq bd mf mg mh mi mj mk ml mm mn kf mo kg mp ki mq kj mr kl ms km mt mu bi translated">使用CDC提高数据服务级别协议</h1><p id="2ad6" class="pw-post-body-paragraph lf lg iq lh b li mv ka lk ll mw kd ln lo mx lq lr ls my lu lv lw mz ly lz ma ij bi translated">让我们后退一步。分析团队拥有的几个领域示例:</p><ul class=""><li id="2ff2" class="na nb iq lh b li lj ll lm lo nc ls nd lw ne ma nf ng nh ni bi translated">客户细分数据，发送到第三方工具以优化营销和客户支持等业务功能</li><li id="64df" class="na nb iq lh b li nj ll nk lo nl ls nm lw nn ma nf ng nh ni bi translated">欺诈检测，对产品上的可疑行为发出警报</li></ul><p id="b956" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果这些分析是在数据仓库之上运行的，那么数据仓库中所需的基线数据量就来自生产数据库。来自第三方工具的补充数据非常有用，但通常不是分析团队开始的地方。将数据从数据库移动到数据仓库时，通常考虑的第一种方法是基于批处理的。</p><p id="8869" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">定义:</strong>批处理数据管道涉及定期检查源数据库，并运行管道来更新目标(通常是仓库)中的数据。</p><p id="769b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这种方法存在技术上的困难，最明显的是需要知道源中发生了什么变化以及目标中需要更新什么的逻辑。批量ELT工具确实减轻了数据专业人员的负担。然而，没有一个批处理ELT工具能够解决其中最大的问题:数据SLA。考虑每三小时运行一次的数据管道。任何独立运行在该数据之上的管道，即使也是每三个小时运行一次，在最坏的情况下也会过时六个小时。对于许多分析来说，六个小时的延迟不会改变指针。这就引出了一个问题:团队什么时候应该关心数据新鲜度和SLA？</p><p id="ebcb" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">定义</strong>:<a class="ae le" href="https://www.cio.com/article/274740/outsourcing-sla-definitions-and-solutions.html" rel="noopener ugc nofollow" target="_blank">SLA</a>(服务水平协议)是供应商和客户之间的一份合同，涉及到应用程序可用性和停机时间时，客户可以从供应商那里得到什么。数据SLA是分析团队及其利益相关方之间就数据的预期新鲜程度达成的协议。</p><p id="449f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">当新数据对业务产生有意义的影响时，这就是团队应该关心的时候。回到分析团队项目的例子，如果发生欺诈事件(如数百个欺诈订单)，时间是至关重要的。3小时的数据SLA可能导致企业损失数千美元，而不是不到100美元。</p><p id="eb2e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">当新鲜感迫不及待时—提示CDC，或<a class="ae le" href="https://www.striim.com/blog/change-data-capture-cdc-what-it-is-and-how-it-works/" rel="noopener ugc nofollow" target="_blank">改变数据捕捉</a>。CDC工具读取数据库上的更改日志，并在目标数据中模拟这些更改。如果数据管道遇到错误，这可以很容易地重新运行。</p><p id="534d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">借助实时变更日志，CDC工具可以近乎实时地保持两个数据存储(生产数据库和分析仓库)完全相同。然后，分析团队对新鲜的数据进行分析。</p><h1 id="dcf8" class="md me iq bd mf mg mh mi mj mk ml mm mn kf mo kg mp ki mq kj mr kl ms km mt mu bi translated">CDC入门</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi no"><img src="../Images/43270b0e90c243a4e386011052a3fce6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ysbJQGxxmKToTsr0-wk-2A.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><p id="993e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">最常见的生产事务数据库是PostgreSQL和MySQL，它们都已经存在了几十年。作为目标而不是来源，仓库通常不会以同样的方式支持CDC(尽管这也在发生变化)。</p><p id="3fad" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">要为CDC设置源数据库，您需要:</p><ul class=""><li id="d7e4" class="na nb iq lh b li lj ll lm lo nc ls nd lw ne ma nf ng nh ni bi translated">确保WAL(预写)日志已启用，并且WAL超时足够长。这直接发生在数据库设置中。</li><li id="0f37" class="na nb iq lh b li nj ll nk lo nl ls nm lw nn ma nf ng nh ni bi translated">确保基于CDC工具的当前规范将归档日志存储在源上。</li><li id="c209" class="na nb iq lh b li nj ll nk lo nl ls nm lw nn ma nf ng nh ni bi translated">创建一个复制槽，CDC工具可以在其中订阅更改日志。</li><li id="0420" class="na nb iq lh b li nj ll nk lo nl ls nm lw nn ma nf ng nh ni bi translated">监控源和目标数据库基础架构，确保两者都不会过载。</li></ul><p id="524c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在源数据库上，如果一行数据更改为A，然后更改为值B，再更改为A，那么这种行为会在目标仓库上重演。重放确保了数据的完整性和一致性。</p><p id="912e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">虽然存在像Debezium这样的开源CDC解决方案，但托管CDC解决方案允许用户更少地担心基础设施，而更多地担心管道的业务规范，这是他们的业务所特有的。</p><p id="10b5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">作为开发工具的分析和上市顾问，我以前在Perpay领导数据工程职能，并建立了一个变更数据捕获堆栈。在我看来，变更数据捕获不仅仅是实时分析。这是将数据从运营数据库复制到分析系统的最可靠、最可扩展的方式，尤其是在下游延迟要求很高的情况下。</p></div></div>    
</body>
</html>