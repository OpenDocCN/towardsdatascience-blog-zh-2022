<html>
<head>
<title>What is Average Precision in Object Detection &amp; Localization Algorithms and how to calculate it?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">目标检测和定位算法的平均精度是多少，如何计算？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/what-is-average-precision-in-object-detection-localization-algorithms-and-how-to-calculate-it-3f330efe697b#2022-05-13">https://towardsdatascience.com/what-is-average-precision-in-object-detection-localization-algorithms-and-how-to-calculate-it-3f330efe697b#2022-05-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4e71" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">理解目标检测和定位算法的平均精度的一步一步的可视化指南</h2></div><h1 id="3104" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">什么是物体检测和定位？</h1><p id="6b6f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">物体检测和定位是机器学习中发展最快的领域之一。这种算法是标准分类算法的扩展。对于给定的输入图像，分类算法将输出感兴趣类别的概率分布。旨在不仅检测图像中感兴趣类别的存在，而且使用包围盒来定位它们。此外，它还可以处理同一图像中多个类的存在。</p><p id="3b95" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">考虑下图，该图将分类算法与对象检测和定位进行了比较。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi ly"><img src="../Images/d8330ec050b28380755d1117b3a2b8cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-X9GKjsJIROfKaa6NpMJyA.jpeg"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">分类与检测定位算法的区别——图片由作者修改自<a class="ae mo" href="https://unsplash.com/@stevetsang?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Steve Tsang </a>在<a class="ae mo" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片、<a class="ae mo" href="https://unsplash.com/@priscilladupreez?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Priscilla Du Preez </a>在<a class="ae mo" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="c47e" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">因此，它不仅预测了类标签，还告诉我们预测的类在图片中的位置。因此，为了评估对象检测和定位算法的性能，我们需要评估预测的类是否是实际的类，以及预测的边界框有多接近地面事实。</p><h1 id="aff8" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">评估指标</h1><p id="6c50" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">目标检测和定位算法的性能通过称为平均精度(AP)(和平均平均精度)的度量来评估。在我们进入AP是什么的细节之前，让我们先弄清楚它不是什么。</p><blockquote class="mp"><p id="8a23" class="mq mr iq bd ms mt mu mv mw mx my ls dk translated">AP不是不同类的平均精度。</p></blockquote><p id="2d17" class="pw-post-body-paragraph kx ky iq kz b la mz jr lc ld na ju lf lg nb li lj lk nc lm ln lo nd lq lr ls ij bi translated">AP是在IoU、混淆矩阵(TP、FP、FN)、精度和召回率等其他几个指标的帮助下计算出来的，如下图所示。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi ne"><img src="../Images/a47782adf26d182da8759b69bae2852d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S0P4uuuK_w4JVcNeE1O-bg.jpeg"/></div></div></figure><p id="895e" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">要理解AP，我们首先需要理解这些指标。</p><h2 id="94ae" class="nf kg iq bd kh ng nh dn kl ni nj dp kp lg nk nl kr lk nm nn kt lo no np kv nq bi translated">1.并集交集(IoU):</h2><p id="401c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">IoU量化了两个边界框(地面真实和预测)的接近程度。它是一个介于0和1之间的值。如果两个边界框完全重叠，则预测是完美的，因此IoU为1。另一方面，如果两个边界框不重叠，则IoU为0。IoU的计算方法是取两个键合框的相交面积与并集面积之比，如下所示。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nr"><img src="../Images/2bd804e6cb7d2a458312eea50e0670c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WiCYCyyTih6dfmZeoroj1A.jpeg"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">并集上的交集—作者图片</p></figure><h2 id="69a0" class="nf kg iq bd kh ng nh dn kl ni nj dp kp lg nk nl kr lk nm nn kt lo no np kv nq bi translated">2.真阳性、假阳性、假阴性:</h2><p id="ef32" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果预测边界框和基本真实边界框的类别标签相同，并且它们之间的IoU大于阈值，则预测被认为是正确的。</p><p id="12c8" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">基于IoU、阈值和基本事实的类别标签以及预测的边界框，我们计算以下三个度量</p><ul class=""><li id="8358" class="ns nt iq kz b la lt ld lu lg nu lk nv lo nw ls nx ny nz oa bi translated"><strong class="kz ir">真阳性:</strong>模型预测某个位置存在边界框(阳性)，并且是正确的(真)</li><li id="1027" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls nx ny nz oa bi translated"><strong class="kz ir">假阳性:</strong>模型预测一个边界框存在于一个特定的位置(阳性)，但它是错误的(假)</li><li id="84ec" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls nx ny nz oa bi translated"><strong class="kz ir">假阴性:</strong>该模型没有预测到某一位置的边界框(阴性)，并且它是错误的(假的)，即在该位置存在地面真实边界框。</li><li id="6fa1" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls nx ny nz oa bi translated"><strong class="kz ir">真否定:</strong>模型没有预测到一个边界框(否定)，它是正确的(真)。这对应于背景，没有边界框的区域，并且不用于计算最终度量。</li></ul><p id="1059" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">下面的例子将有助于澄清TP、FP和FN。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi og"><img src="../Images/8f2b3169795fd3a00ac81cbf6dd39db5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mdqpx5V7TYhXRz046tm6zQ.jpeg"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">IoU、TP、FP、FN —作者图片</p></figure><h2 id="d2e8" class="nf kg iq bd kh ng nh dn kl ni nj dp kp lg nk nl kr lk nm nn kt lo no np kv nq bi translated">3.精确度，回忆</h2><p id="ba67" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">基于TP、FP和FN，<em class="oh">对于每个标记的类</em>，我们计算两个参数:精度和召回率。</p><ul class=""><li id="f985" class="ns nt iq kz b la lt ld lu lg nu lk nv lo nw ls nx ny nz oa bi translated"><strong class="kz ir"> Precision: </strong>告诉我们我们的模型有多精确，即在检测到的所有猫中，有多少是真正的猫。因此，它是真阳性与由模型做出的cat预测总数(相当于真阳性和假阳性之和)之间的比率，如下所示。</li><li id="6cab" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls nx ny nz oa bi translated"><strong class="kz ir">回忆:</strong>告诉我们模型从图像中回忆类别的能力，即在输入图像中的所有猫中，模型能够检测到多少只。因此，它是由如下所示的模型产生的真阳性和地面真实猫的总数(相当于真阳性和假阴性的总和)之间的比率。</li></ul><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi oi"><img src="../Images/74140c01a6456b902a9faee75c6b5d02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B1_2_DwQBZGpwrEVnU2SxA.jpeg"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">机器学习中的精确度和召回率—作者图片</p></figure><p id="4123" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">从上图可以看出，分类器在预测时是<strong class="kz ir"> <em class="oh">精确</em> </strong>。当它说它是猫(狗)的时候，它80%的时候都是正确的。然而，如果图像中有一只猫(狗)，分类器只能在50% (80%)的时候检测到它。于是模特有了不好过的<strong class="kz ir"> <em class="oh">回忆</em> </strong>猫。</p><h2 id="c0e3" class="nf kg iq bd kh ng nh dn kl ni nj dp kp lg nk nl kr lk nm nn kt lo no np kv nq bi translated">4.精确回忆曲线</h2><p id="b701" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">理想情况下，我们希望精确度和召回率都很高，即无论检测到什么都是正确的，并且模型可以检测到一个类的所有出现。精确度和召回率的值取决于模型检测到多少真阳性。指定边界框TP、FP和FN取决于以下两点</p><ul class=""><li id="3336" class="ns nt iq kz b la lt ld lu lg nu lk nv lo nw ls nx ny nz oa bi translated">预测标签与基本事实标签的比较</li><li id="1bd4" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls nx ny nz oa bi translated">两个盒子之间的借据</li></ul><p id="e663" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">对于多类分类问题，模型输出包围盒属于某一类的条件概率。类的概率越大，边界框包含该类的机会就越大。概率分布连同用户定义的阈值(在0到1之间)用于分类边界框。</p><p id="3844" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">这个概率置信阈值越小<strong class="kz ir">，模型做出的检测的数量就越多，错过真实标签的机会就越低，因此<strong class="kz ir">的召回率就越高</strong> <em class="oh">(通常，但不总是)</em>。另一方面，<strong class="kz ir">置信度阈值</strong>越高，模型对其预测越有信心，因此<strong class="kz ir">精确度</strong> <em class="oh">(通常，但不总是)</em>。我们希望精确度和召回率都尽可能高，因此，基于置信度阈值的值，在精确度和召回率之间存在折衷。</strong></p><blockquote class="mp"><p id="6b80" class="mq mr iq bd ms mt mu mv mw mx my ls dk translated"><strong class="ak">精确度-召回率曲线绘制了不同置信度阈值的精确度值与召回率的关系。</strong></p></blockquote><p id="fe82" class="pw-post-body-paragraph kx ky iq kz b la mz jr lc ld na ju lf lg nb li lj lk nc lm ln lo nd lq lr ls ij bi translated">有了精确召回曲线，我们可以直观地看到什么样的置信度阈值对我们是最好的(对于我们给定的应用程序)。下面是PR曲线的一个过于简化的例子</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi oj"><img src="../Images/93046d1586eb52235f7c71efda4ba9a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GC4nLLTDq1eOP9njT6_INA.jpeg"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">精确召回曲线—作者图片</p></figure><h2 id="d915" class="nf kg iq bd kh ng nh dn kl ni nj dp kp lg nk nl kr lk nm nn kt lo no np kv nq bi translated">5.平均精度</h2><p id="0276" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为您的应用程序选择一个置信度值可能很难，而且很主观。平均精度是一个关键的性能指标，它试图消除对选择一个置信度阈值的依赖性，其定义如下</p><blockquote class="mp"><p id="901e" class="mq mr iq bd ms mt mu mv mw mx my ls dk translated">平均精度是PR曲线下的面积。</p></blockquote><p id="4f59" class="pw-post-body-paragraph kx ky iq kz b la mz jr lc ld na ju lf lg nb li lj lk nc lm ln lo nd lq lr ls ij bi translated">AP将PR曲线总结为一个标量值。当精确度和召回率都很高时，平均精确度就很高，而当精确度和召回率中的任何一个在置信阈值范围内很低时，平均精确度就很低。AP的范围在0到1之间。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi ok"><img src="../Images/0f88d417224f30bafef2b82e04d501b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hrAKFEs2sHC6W6jLTuexYA.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">平均精确度是精确度-召回曲线下的面积-作者提供的图像</p></figure><p id="c809" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">以下两种方法通常用于求PR曲线下的面积。</p><h2 id="fc53" class="nf kg iq bd kh ng nh dn kl ni nj dp kp lg nk nl kr lk nm nn kt lo no np kv nq bi translated">方法1 —用矩形近似PR曲线:</h2><ul class=""><li id="a6c2" class="ns nt iq kz b la lb ld le lg ol lk om lo on ls nx ny nz oa bi translated">对于每个精确召回对(j=0，…，n-1)，PR曲线下的面积可以通过使用矩形近似曲线来找到。</li><li id="0f18" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls nx ny nz oa bi translated">这种矩形的宽度可以通过取两个连续召回值(r(k)，r(k-1))的差来找到，而高度可以通过取所选召回值的精度的最大值来找到，即w = r(k)-r(k-1)，h = max(p(k)，p(k-1))</li><li id="e49e" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls nx ny nz oa bi translated">AP可以通过这些矩形的面积之和来计算，如下所示</li></ul><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi oj"><img src="../Images/6a499d8d40c751e07f0bd7e6dceaae63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*udAtIXEQyxZ3Rq07fbk-Ag.jpeg"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">从PR曲线计算平均精度—作者提供的图像</p></figure><h2 id="3737" class="nf kg iq bd kh ng nh dn kl ni nj dp kp lg nk nl kr lk nm nn kt lo no np kv nq bi translated">方法2 —插值法和11点平均法</h2><ul class=""><li id="0c9b" class="ns nt iq kz b la lb ld le lg ol lk om lo on ls nx ny nz oa bi translated">计算从0.0到1.0的11个召回值的精度值，增量为0.1</li><li id="b705" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls nx ny nz oa bi translated">在右图中，这11个点可以被视为橙色样本</li><li id="ca8e" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls nx ny nz oa bi translated">AP可以通过取这11个精度值的平均值来计算，如下所示</li></ul><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi oj"><img src="../Images/2a5e64734854b0fd7c61f3665632938a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o2ZGqy02-IaoY-D-rVfIeQ.jpeg"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">从PR曲线计算平均精度—作者提供的图像</p></figure><h2 id="b826" class="nf kg iq bd kh ng nh dn kl ni nj dp kp lg nk nl kr lk nm nn kt lo no np kv nq bi translated">6.平均精度:</h2><p id="3364" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">可以为每个类计算AP值。平均精度是通过对所有考虑的类取AP的平均值来计算的。即</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi oo"><img src="../Images/e91b456792a3ffb1a535818a269ec620.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ASmx6nktC2KzE5uSMe2Baw.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated">平均平均精度-所有k类的平均精度(AP)的平均值-按作者分类的图像</p></figure><h1 id="d0d5" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">摘要</h1><p id="6256" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">平均精度(mAP)量化了目标检测和定位算法的性能。为了理解mAP，我们需要理解IoU、真阳性、真阳性、假阳性、假阴性、回忆、精度和精度-回忆曲线是什么。在本文中，我们详细介绍了这些概念，以及它们如何帮助我们计算地图。</p></div><div class="ab cl op oq hu or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="ij ik il im in"><p id="ee57" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated"><strong class="kz ir">如果这篇文章对你有帮助，或者你想了解更多关于机器学习和数据科学的知识，请关注</strong><a class="ae mo" href="https://medium.com/u/a7cc4f201fb5?source=post_page-----51587a95f847-----------------------------------" rel="noopener"><strong class="kz ir">Aqeel an war</strong></a><strong class="kz ir">，或者在</strong><a class="ae mo" href="https://www.linkedin.com/in/aqeelanwarmalik/" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir"><em class="oh">LinkedIn</em></strong></a><strong class="kz ir"><em class="oh">或</em></strong><a class="ae mo" href="https://twitter.com/_aqeelanwar" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir"><em class="oh">Twitter</em></strong></a><strong class="kz ir"><em class="oh">上联系我。你也可以订阅我的邮件列表。</em></strong></p></div></div>    
</body>
</html>