<html>
<head>
<title>Controlling for “X”?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">控制X吗？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/controlling-for-x-9cb51652f7ad#2022-05-26">https://towardsdatascience.com/controlling-for-x-9cb51652f7ad#2022-05-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/023864d8a90769d3834a69f4010b9974.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yN-njckDcLj9Uki4oj11Pw.png"/></div></div></figure><div class=""/><div class=""><h2 id="caaa" class="pw-subtitle-paragraph jy ja jb bd b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dk translated">通过弗里希-沃-洛弗尔定理理解线性回归力学</h2></div><h1 id="b05c" class="kq kr jb bd ks kt ku kv kw kx ky kz la kh lb ki lc kk ld kl le kn lf ko lg lh bi translated"><strong class="ak">简介</strong></h1><p id="b2f3" class="pw-post-body-paragraph li lj jb lk b ll lm kc ln lo lp kf lq lr ls lt lu lv lw lx ly lz ma mb mc md ij bi translated">应用计量经济学通常对建立因果关系感兴趣。即<em class="me"> T </em>对某个结果y <em class="me">的“治疗”效果是什么。</em>在一个简单的双变量案例中，我们可以想象<em class="me">随机</em>将治疗<em class="me"> T </em> =1分配给一些个体，将<em class="me"> T=0 </em>分配给其他个体。这可以用下面的线性回归模型来表示:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/2f9626418c00300c7d41cc46e9c2a9cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LzeLmrSusSPfNW9nSo4tzg.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk">(1)</p></figure><p id="9b6c" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">如果我们假设处理是真正随机分配的，那么T与误差项正交，或者用经济学家的行话来说，<em class="me">外生</em>。因此，我们可以估算eq。(1)使用普通最小二乘法(OLS)并用因果解释解释<em class="me"> T </em>上的系数估计值——平均治疗效果(ate):</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mt"><img src="../Images/213cbd04b9c2a4f3c5ffa3c312ca5a9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g1QRnOUQSa1-alcIBRIfRQ.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk">(2)</p></figure><p id="ba4a" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">然而，当我们处理非实验性数据时，几乎总是这样，对感兴趣项的处理<em class="me">不</em>与误差项正交，或者，用经济学家的行话来说，<em class="me">内生</em>。例如，假设我们感兴趣的是确定小时候读书时间对个人未来教育成就的治疗效果。没有任何随机分配的时间花在阅读作为一个孩子，估计一个简单的线性回归，如方程。(1)将无法捕捉可能驱动个人花费在阅读书籍上的时间<em class="me">和</em>教育程度(即，社会经济地位、父母教育、潜在能力、其他爱好等)的大量附加因素。).因此，在处理非实验性数据时，我们必须依赖于对额外协变量的控制，然后论证治疗现在“与随机分配一样好”，以建立因果关系。这就是所谓的条件独立性假设(CIA)。在上面的教育例子中，我们可以重新定义情商。(1)作为:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mu"><img src="../Images/711d96d2db803f136da788f77dd5349d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N1m9ut9GJMPr5SCWNvbQRA.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk">(3)</p></figure><p id="a1ac" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">我们现在控制一组观察到的协变量<em class="me"> X </em>。当且仅当中央情报局成立时，对<em class="me">读数</em>的关键兴趣估计采用因果解释<em class="me">。也就是说，花费在读取上的时间与误差项<em class="me">正交，条件</em>在<em class="me"> X </em>上。相当于，</em></p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mv"><img src="../Images/b3caa7157d09a1b0d33e92bc216d8d6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tlujm6BC2fIZp6Rv23_KjQ.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk">(4)</p></figure><p id="593d" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">没有中央情报局，我们的系数估计是有偏差的，我们在因果关系方面的话是有限的。现实地说，为中央情报局辩护通常是相当困难的，而且不幸的是，这种假设是不可直接检验的。事实上，我上面所讨论的是整个计量经济学领域的基本动力，该领域致力于建立、发展和实施准实验研究设计，以建立因果关系，包括但绝对不限于差异中的差异、综合控制和工具变量设计。这些准实验设计旨在利用感兴趣的治疗中的外源性(“几乎是随机的”)变异源<em class="me"> T </em>来研究<em class="me"> T </em>对某些结果y的因果影响。有一些优秀的计量经济学文本可供那些几乎没有或根本没有计量经济学背景的人阅读，包括尼克·亨廷顿-克莱因的《<a class="ae mw" href="https://www.theeffectbook.net/" rel="noopener ugc nofollow" target="_blank">效应</a>》、斯科特·坎宁安的《<a class="ae mw" href="https://mixtape.scunning.com/" rel="noopener ugc nofollow" target="_blank">因果推理:混音带</a>》或《<a class="ae mw" href="https://matheusfacure.github.io/python-causality-handbook/landing-page.html" rel="noopener ugc nofollow" target="_blank">勇敢而真实的因果推理</a>[1][2][3]约书亚·安格里斯特(Joshua Angrist)和约恩·斯特芬·皮施克(jrn-Steffen Pischke)为感兴趣的人提供了“基本无害的计量经济学”的更深入探讨。[4]</p><p id="5135" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">尽管通过单独控制协变量来建立CIA特别困难，但计量经济学中有一个重要的定理，它为“控制”额外协变量的真正含义提供了一些非常强大的直觉。最终，这不仅提供了对线性回归潜在机制的更深入理解，还提供了如何概念化关键利益关系(即<em class="me"> T </em>对<em class="me"> Y </em>的影响)。</p><h1 id="2692" class="kq kr jb bd ks kt ku kv kw kx ky kz la kh lb ki lc kk ld kl le kn lf ko lg lh bi translated"><strong class="ak">弗里希-沃-洛弗尔定理</strong></h1><p id="5b31" class="pw-post-body-paragraph li lj jb lk b ll lm kc ln lo lp kf lq lr ls lt lu lv lw lx ly lz ma mb mc md ij bi translated">在19世纪，计量经济学家拉格纳·弗里希和弗雷德里克·v·沃发展了一个超级酷的定理(FWL定理)，该定理允许估计线性回归中的任何关键参数，其中首先“部分消除”附加协变量的影响，该定理后来被迈克尔·c·洛弗尔推广。[5][6]首先，快速复习一下线性回归会有所帮助。</p><p id="9423" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">给定一组独立变量<strong class="lk jc"> </strong> X，线性回归求解结果y的最佳线性预测值，其中y的拟合值被投影到由<em class="me"/>X跨越的空间上。在矩阵符号中，我们感兴趣的线性回归模型的特征在于:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/3c05870d01846bd05021618334b09284.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g5aXdaM2V11YI_hSXJ5Vxg.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk">(5)</p></figure><p id="4b0a" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">线性回归的目标是最小化残差平方和(RSS)，因此可以通过以下优化问题来解决:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi my"><img src="../Images/4730b2630a0bb7f698fb79e0ec2e9bf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wIPeFu_yTPoXIlGKZmgsHg.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk">(8)</p></figure><p id="346f" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">取导数并设等于零，<strong class="lk jc"> (6) </strong>的最优解为:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mz"><img src="../Images/2607123d13cb47ece08cb4374e96aa7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aJZ6UaSlLLA_i5etWFm-nQ.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk">(9)</p></figure><p id="8afe" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">这是普通的最小二乘(OLS)估计器，当我们运行线性回归以获得参数估计时，它是幕后的主力。现在，让我们回顾一下是什么让FWL如此伟大。</p><p id="89d5" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">让我们回到我们估算儿童时期阅读的教育回报的例子。假设我们只想获得方程中感兴趣的关键参数。(3);也就是说，儿童时期每月阅读天数对受教育程度的影响。回想一下，为了对我们的估计做出一个因果陈述，我们必须让CIA满意。因此，我们可以控制一组额外的协变量X，然后使用在<strong class="lk jc"> (7) </strong>中导出的OLS估计器直接估计<strong class="lk jc"> (3) </strong>。然而，FWL定理允许我们在以下3步程序中，在<em class="me">读取</em>时获得完全相同的关键参数估计值:</p><ol class=""><li id="fe24" class="na nb jb lk b ll mo lo mp lr nc lv nd lz ne md nf ng nh ni bi translated">回归<em class="me">将</em>读为仅协变量集<em class="me"> X </em>，同样，将<em class="me">教育</em>读为仅协变量集<em class="me"> X </em></li></ol><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nj"><img src="../Images/685cabfd6e3924dd317fc027757bdb2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zp7x7aGoDLkg4YNtosEOlQ.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk">(8)+(9)</p></figure><p id="1fbd" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">2.存储估计(8)+(9)后的残差，表示为<em class="me">读作* </em>和<em class="me">教育* </em></p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nk"><img src="../Images/43145333c36dbf5349d2b6e63718e09b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UoJzLN_fHTDIvpjUrddiNA.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk">(10)+(11)</p></figure><p id="fbe4" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">3.将<em class="me">教育* </em>倒退到<em class="me">改为* </em></p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/c7ca43a81cef14f3a442072e70387ba7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kuZ6rI9buQplVIlB4AGBnA.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk">(12)</p></figure><p id="9fe6" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">就是这样！</p><p id="6b34" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">直观地说，FWL定理分离出由附加协变量解释的<em class="me">阅读(</em>治疗/利益变量)和<em class="me">教育(</em>利益结果<em class="me"> ) </em>中的变异，然后使用剩余的变异来解释利益的关键关系。这一过程可以推广到任何数量的感兴趣的关键变量。关于这个定理的更正式的证明，参考文献[7]。FWL定理最近作为去偏置/正交机器学习的理论基础而备受关注，其中步骤1和2使用机器学习算法而不是OLS来进行。有一些非常酷的发展正在弥合计量经济学和机器学习之间的差距，我希望将来有一些关于这些新方法的酷应用的帖子。然而，Matheus Facure Alves的第2部分“<a class="ae mw" href="https://matheusfacure.github.io/python-causality-handbook/landing-page.html" rel="noopener ugc nofollow" target="_blank">勇敢和真实的因果推理</a>”是一个很好的起点。</p><p id="967c" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">现在你可能想知道为什么你要经历这个过程来获得完全相同的关键估计值。首先，它为线性回归的机制提供了大量的直觉。第二，它允许你想象你治疗中的剩余变化(<em class="me">读作</em>)，这被用来解释你结果中的剩余变化(<em class="me">教育</em>)。让我们来看看实际情况！</p><h1 id="b943" class="kq kr jb bd ks kt ku kv kw kx ky kz la kh lb ki lc kk ld kl le kn lf ko lg lh bi translated"><strong class="ak"> FWL定理应用</strong></h1><p id="72de" class="pw-post-body-paragraph li lj jb lk b ll lm kc ln lo lp kf lq lr ls lt lu lv lw lx ly lz ma mb mc md ij bi translated">在本节中，我们将模拟一个高度程式化的数据集，以提供一个应用FWL定理的简化数值示例，来回答我们关于儿童阅读教育回报的经验问题。</p><p id="8aaa" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">假设我们假设了一组人口统计学变量，我们确定这些变量是满足等式1中CIA所必需的相关混杂因素。(3)，从而让我们获得对童年阅读教育回报的因果解释。也就是说，假设我们将关键混杂因素确定为父母双方的平均教育水平(年)(<em class="me"> pareduc </em>)、以数万美元计的家庭收入(<em class="me"> HHinc </em>)和智商得分(<em class="me"> IQ </em>)。我们将为混杂因素人工生成数据集和以下数据生成过程(DGP ),如下所示:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mv"><img src="../Images/102736ec76a4bf99a386e2960d2e2772.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6FJk8p8Gp63aBL61vm-fVQ.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk">(13)</p></figure><p id="865b" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">此外，估计方程。(3)我们必须有关键治疗的措施，他们小时候一个月的平均阅读天数(<em class="me">读作</em>)，以及主要结果，他们多年的总教育程度(<em class="me"> educ </em>)。我们用高斯误差项和教育误差项中的异方差人工生成这些关键变量，如下所示:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nm"><img src="../Images/aedf6926d6957c7321a2e156072e5a76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f1-VdxK9hl95u-7RQSHS9A.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk">(14)</p></figure><p id="53f0" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">因为我们知道真实的DGP，所以感兴趣的参数的真实值是0.2。<em class="me"> </em>让我们把这个DGP拿到Python上模拟数据:</p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><blockquote class="nu nv nw"><p id="bbef" class="li lj me lk b ll mo kc ln lo mp kf lq nx mq lt lu ny mr lx ly nz ms mb mc md ij bi translated">请注意，通常情况下，DGP中的所有值都是任意选择的，因此数据很适合用于演示目的。然而，在这个模拟的范围内，我们可以将“阅读”的系数解释如下:平均而言，一个人小时候每月多读一天书，其受教育程度就增加0.2年。</p></blockquote></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><pre class="mg mh mi mj gt oa ob oc bn od oe bi"><span id="7d75" class="of kr jb ob b be og oh l oi oj"><br/>## Import Relevant Packages<br/>import pandas as pd<br/>import numpy as np<br/>from scipy.stats import skewnorm<br/>import seaborn as sns<br/>import matplotlib.pyplot as plt<br/><br/>## Data Generating Process<br/>df = pd.DataFrame()<br/>n = 10000<br/><br/># Covariates<br/>df['pareduc'] = np.random.normal(loc=14,scale=3,size=n).round()<br/>df['HHinc'] = skewnorm.rvs(5,loc=3,scale=4,size=n).round()<br/>df['IQ'] = np.random.normal(loc=100,scale=10,size=n).round()<br/><br/># Childhood Monthly Reading<br/>df['read'] = (-25+<br/>              0.3*df['pareduc']+<br/>              2*df['HHinc']+<br/>              0.2*df['IQ']+<br/>              np.random.normal(0,2,size=n)).round()<br/><br/>df = df[(df['read']&gt;0) &amp; (df['read']&lt;31)] # Drop unrealistic outliers<br/>                           <br/># Education Attainment<br/>df['educ'] = (-15+<br/>              0.2*df['read']+<br/>              0.1*df['pareduc']+<br/>              1*df['HHinc']+<br/>              0.2*df['IQ']+<br/>              df['read']/15*np.random.normal(0,2,size=len(df)).round())<br/><br/><br/>## Plot Simulated Data<br/>fig, ax = plt.subplots(3,2,figsize=(12,12))<br/>sns.histplot(df.HHinc,color='b',ax=ax[0,0],bins=15,stat='proportion',kde=True)<br/>sns.histplot(df.IQ,color='m',ax=ax[0,1],bins=20,stat='proportion',kde=True)<br/>sns.histplot(df.pareduc,color='black',ax=ax[1,0],bins=20,stat='proportion',kde=True)<br/>sns.histplot(df.read,color='r',ax=ax[1,1],bins=30,stat='proportion',kde=True)<br/>sns.histplot(df.educ,color='g',ax=ax[2,0],bins=30,stat='proportion',kde=True)<br/>sns.regplot(data=df,x='read',y='educ',color='y',truncate=False,ax=ax[2,1])<br/>plt.show()</span></pre><p id="9127" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">数据看起来有点像:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ok"><img src="../Images/99b53cce89f289f8a29114d5df5ee486.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZzJ50GtL4k6KFzqQMmTu6g.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated"><strong class="bd ol">图1 </strong></p></figure><p id="6275" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">右下角的图表提供了<em class="me"> educ </em>对<em class="me"> read </em>的散点图和原始回归线。从表面上看，这种关系表明，小时候每月阅读的天数和教育程度之间存在非常强的正相关关系。然而，我们知道，通过构造，这并不是<em class="me"> educ </em>和<em class="me"> read </em>之间的真实关系，因为存在共同的混杂协变量。我们可以通过回归分析更正式地量化这个结果和偏差。现在，让我们继续估计简单的回归(例如，等式)。(3)减去<em class="me"> X </em>)，所有相关协变量的多元回归(即等式。(3))和FWL三步过程(即，方程。(8)-(12)):</p><pre class="mg mh mi mj gt oa ob oc bn od oe bi"><span id="994c" class="of kr jb ob b be og oh l oi oj">import statsmodels.formula.api as sm<br/><br/>## Regression Analysis<br/><br/># Naive Regression<br/>naive = sm.ols('educ~read',data=df).fit(cov_type="HC3")<br/><br/># Multiple Regression<br/>multiple = sm.ols('educ~read+pareduc+HHinc+IQ',data=df).fit(cov_type='HC3')<br/><br/># FWL Theorem<br/>read = sm.ols('read~pareduc+HHinc+IQ',data=df).fit(cov_type='HC3')<br/>df['read_star']=read.resid<br/><br/>educ = sm.ols('educ~pareduc+HHinc+IQ',data=df).fit(cov_type='HC3')<br/>df['educ_star']=educ.resid<br/><br/>FWL = sm.ols("educ_star ~ read_star",data=df).fit(cov_type='HC3')<br/><br/>## Save Nice Looking Table<br/>from stargazer.stargazer import Stargazer<br/><br/>file = open('table.html','w')<br/><br/>order = ['read','read_star','HHinc','pareduc','IQ','Intercept']<br/>columns = ['Naive OLS','Multiple OLS','FWL']<br/>rename = {'read':'Read (Days/Month)','read_star':'Read*','hhincome':'HH Income',<br/>          'pareduc':"Avg. Parents Education (Yrs)"}<br/><br/>regtable = Stargazer([naive, multiple, FWL])<br/>regtable.covariate_order(order)<br/>regtable.custom_columns(columns,[1,1,1])<br/>regtable.rename_covariates(rename)<br/>regtable.show_degrees_of_freedom(False)<br/>regtable.title('The Simulated Effect of Childhood Reading on Educational Attainment')<br/><br/>file.write(regtable.render_html())<br/>file.close()</span></pre><p id="3775" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">回归结果是:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi om"><img src="../Images/c07642ae883196e5bf6785893c105e94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xEBVL01ATgJgGl9uvSx98w.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated"><strong class="bd ol">表1 </strong></p></figure><p id="5362" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">上面的表1给出了回归输出结果。我们可以立即观察到，由于与教育程度和童年阅读呈正相关的混杂变量，对<em class="me">阅读</em>的简单回归估计值是向上偏的。当我们包括列(2)中的额外协变量时，我们得到的估计值接近DGP中构建的真实值0.2。正如所料，FWL三步法得出了完全相同的估计值！</p><blockquote class="nu nv nw"><p id="e8d7" class="li lj me lk b ll mo kc ln lo mp kf lq nx mq lt lu ny mr lx ly nz ms mb mc md ij bi translated">回归中符号偏差的一般经验法则是cov(结果，X)的符号乘以cov(治疗，X)的符号。通过构造，我们得到cov(educ，X)&gt;0和cov(read，X)&gt;0，因此是正偏置。</p></blockquote><p id="517c" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">因此，我们现在已经展示了FWL被用于获得相同的估计，但是FWL的真正力量在于绘制真实关系的能力。下图2显示了未考虑协变量的原始回归的初始关系，以及FWL过程的残差关系，其中噪声来自DGP的随机误差项。在这种情况下，FWL坡才是真正的关系！我们可以看到斜率的估计是多么的不同。这就是FWL定理的真正力量所在！它允许我们在剔除已经被额外协变量解释的变异后，可视化治疗和结果之间的关系。</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi on"><img src="../Images/9d3f19847c4f9317129579a04ab8b5dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kh8tCI0muaQEWMiciEaoNQ.png"/></div></div><p class="mk ml gj gh gi mm mn bd b be z dk translated"><strong class="bd ol">图2 </strong></p></figure><h1 id="e851" class="kq kr jb bd ks kt ku kv kw kx ky kz la kh lb ki lc kk ld kl le kn lf ko lg lh bi translated"><strong class="ak">讨论</strong></h1><p id="2838" class="pw-post-body-paragraph li lj jb lk b ll lm kc ln lo lp kf lq lr ls lt lu lv lw lx ly lz ma mb mc md ij bi translated">我们已经深入讨论了弗里希-沃-洛弗尔定理，并提供了一种直观的方法来理解当人们对治疗参数感兴趣时，对回归模型中的协变量进行“控制”意味着什么。这是一个强有力的定理，并为多年来发展的许多计量经济学结果提供了强有力的基础。</p><p id="b510" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">FWL提供了一个强有力的机制，通过这个机制，在剔除了额外协变量的影响后，可以可视化结果和治疗之间的关系。事实上，FWL可以用来研究任何两个变量之间的关系，以及协变量在解释它们之间的潜在关系时所起的作用。我建议在您对两个变量之间的关系以及附加协变量在混淆这种关系中的作用感兴趣的数据集上进行尝试！</p><p id="2bdd" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">希望你从这篇帖子中获得了一些新的知识！</p><h2 id="e789" class="oo kr jb bd ks op oq dn kw or os dp la lr ot ou lc lv ov ow le lz ox oy lg oz bi translated">参考</h2><p id="3c77" class="pw-post-body-paragraph li lj jb lk b ll lm kc ln lo lp kf lq lr ls lt lu lv lw lx ly lz ma mb mc md ij bi translated">[1] N .亨廷顿-克莱因，<a class="ae mw" href="https://theeffectbook.net/" rel="noopener ugc nofollow" target="_blank">效果:研究设计和因果关系介绍</a> (2022)。</p><p id="e52d" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">[2] S .坎宁安，<a class="ae mw" href="https://mixtape.scunning.com/" rel="noopener ugc nofollow" target="_blank">《因果推断:大杂烩》</a> (2021)。</p><p id="3f61" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">[3] M. F .阿尔维斯，<a class="ae mw" href="https://matheusfacure.github.io/python-causality-handbook/landing-page.html" rel="noopener ugc nofollow" target="_blank"/>(2021)勇敢而真实的因果推论。</p><p id="4159" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">[4] J. Angrist &amp; J.S. Pischke，<a class="ae mw" href="https://www.mostlyharmlesseconometrics.com/" rel="noopener ugc nofollow" target="_blank">大部分无害的计量经济学:一个经验主义者的伴侣</a> (2009)。普林斯顿大学出版社。</p><p id="e6f6" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">[5]弗里希，拉格纳和沃。与个体趋势相比的部分时间回归(1933)。计量经济学:计量经济学学会杂志，387–401页。</p><p id="7b65" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">[6]洛弗尔。经济时间序列的季节调整和多元回归分析(1963)。<em class="me">美国统计协会杂志</em>58(304):993–1010。</p><p id="05ec" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">[7]洛弗尔。FWL定理的一个简单证明(2008)。<em class="me">经济教育杂志</em>。39 (1): 88–91.</p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><p id="6730" class="pw-post-body-paragraph li lj jb lk b ll mo kc ln lo mp kf lq lr mq lt lu lv mr lx ly lz ms mb mc md ij bi translated">感谢您阅读我的帖子！我在Medium上的帖子试图利用 <strong class="lk jc"> <em class="me">计量经济学</em> </strong> <em class="me">和</em> <strong class="lk jc"> <em class="me">统计/机器学习</em> </strong> <em class="me">技术来探索现实世界和理论应用。此外，我试图通过理论和模拟提供某些方法论的理论基础。最重要的是，我写作是为了学习！我希望把复杂的话题变得更容易理解。如果你喜欢这个帖子，请考虑</em> <a class="ae mw" href="https://medium.com/@jakepenzak" rel="noopener"> <strong class="lk jc"> <em class="me">跟随我上中</em> </strong> </a> <em class="me">！</em></p></div></div>    
</body>
</html>