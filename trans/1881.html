<html>
<head>
<title>Experiments, Peeking, and Optimal Stopping</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实验、窥视和最佳停止</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/experiments-peeking-and-optimal-stopping-954506cec665#2022-05-02">https://towardsdatascience.com/experiments-peeking-and-optimal-stopping-954506cec665#2022-05-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="6e92" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/causal-data-science" rel="noopener" target="_blank">因果数据科学</a></h2><div class=""/><div class=""><h2 id="8819" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">如何用序贯概率比检验进行较小样本量的有效实验</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/72ec05199969cde5cb46eae667af2b42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OFwKkB4L2dkv3GbTJjcf9w.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">封面，作者图片</p></figure><p id="93c1" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在第二次世界大战前的十年里，战争物资的工业生产大量增加，因此有必要确保产品，特别是弹药的可靠性。战争物资的<strong class="lg ja">测试</strong>不仅<strong class="lg ja">昂贵</strong>而且<strong class="lg ja">破坏性</strong>因为，例如，子弹需要发射才能被测试。</p><p id="4d27" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">因此，美国政府面临着如下的困境:在宣布一批子弹可靠之前，一个人应该从一批子弹中射出多少颗子弹？显然，如果我们要发射所有的子弹，我们就会知道一个板条箱中有效子弹的确切数量。然而，没有子弹了。</p><p id="480f" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">由于这些统计问题越来越重要，1939年，一群杰出的统计学家和经济学家在哥伦比亚大学的<a class="ae ma" href="https://en.wikipedia.org/wiki/The_Statistical_Research_Group_of_World_War_II" rel="noopener ugc nofollow" target="_blank"> <strong class="lg ja">统计研究小组(SGR) </strong> </a>联合起来。这个小组包括，除了其他人之外，w·艾伦·沃利斯、雅各布·沃尔福威茨和亚伯拉罕·瓦尔德。根据Wallis自己的说法，SGR小组是由“从数量和质量两方面考虑，肯定是有史以来最非凡的统计学家组成的小组”。</p><p id="408c" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">他们的工作非常重要，被列为机密，沃利斯报道说:</p><blockquote class="mc md me"><p id="d7a5" class="le lf mb lg b lh li ka lj lk ll kd lm mf lo lp lq mg ls lt lu mh lw lx ly lz ij bi translated">据说，当沃尔德进行顺序分析时，他的文件被拿走并被列为机密。作为一名“敌国人”，他没有安全许可，因此，据说，他不被允许知道他的结果。 [ <a class="ae ma" href="https://www.jstor.org/stable/2287451" rel="noopener ugc nofollow" target="_blank">沃利斯(1980) </a> ]</p></blockquote><p id="b36e" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">事实上，该小组在美国陆军的压力下工作，以交付可随时部署在战场上的快速实用解决方案。例如，沃利斯报告说</p><blockquote class="mc md me"><p id="6fa5" class="le lf mb lg b lh li ka lj lk ll kd lm mf lo lp lq mg ls lt lu mh lw lx ly lz ij bi translated">在1944年12月的 <a class="ae ma" href="https://en.wikipedia.org/wiki/Battle_of_the_Bulge" rel="noopener ugc nofollow" target="_blank"> <em class="iq">突出部战役</em> </a> <em class="iq">中，几名高级军官从战场飞到华盛顿，花了一天的时间讨论对地面部队进行空中轰炸的近炸引信的最佳设置，然后飞回战场，将来自其他人的建议付诸实施</em> <a class="ae ma" href="https://en.wikipedia.org/wiki/Milton_Friedman" rel="noopener ugc nofollow" target="_blank"> <em class="iq">米尔顿·弗里德曼</em> </a> <em class="iq">，他早期对引信的研究使他对引信的实际性能有了广泛而准确的了解</em><a class="ae ma" href="https://www.jstor.org/stable/2287451" rel="noopener ugc nofollow" target="_blank">沃利斯(1980) </a></p></blockquote><p id="5cba" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">来自SGR经验的最突出的结果无疑是顺序概率比测试。沃利斯和弗里德曼首先意识到</p><blockquote class="mc md me"><p id="bd6d" class="le lf mb lg b lh li ka lj lk ll kd lm mf lo lp lq mg ls lt lu mh lw lx ly lz ij bi translated">使用一种测试可能是值得的，如果取N个样本，这种测试可能不如传统测试有效，但当顺序使用时，它提供了一个很好的提前终止的机会，从而大大抵消了这一缺点<a class="ae ma" href="https://www.jstor.org/stable/2287451" rel="noopener ugc nofollow" target="_blank">沃利斯(1980) </a></p></blockquote><p id="3339" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">这两位经济学家向统计学家雅各布·沃尔福威茨提出了这个想法</p><blockquote class="mc md me"><p id="9c4c" class="le lf mb lg b lh li ka lj lk ll kd lm mf lo lp lq mg ls lt lu mh lw lx ly lz ij bi translated">“对于像米尔顿和我这样对数学如此无知的人，竟然冒险干涉最强大的统计学等神圣的概念，这似乎有些令人反感。毫无疑问，这种反感因我们称新测试为‘超级色狼’而加强，理由是它们比‘最强大’的测试更强大。” [ <a class="ae ma" href="https://www.jstor.org/stable/2287451" rel="noopener ugc nofollow" target="_blank">沃利斯(1980) </a> ]</p></blockquote><p id="24dd" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">最终，这两位经济学家设法引起了沃尔福威茨和沃尔德的注意，开始正式研究这个想法。这些结果一直是最高机密，直到战争结束，沃尔德发表了他的《统计假设的序列测试》一文。</p><p id="9232" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在这篇文章中，在简单介绍了假设检验之后，我们将探索序列概率比检验，并在Python中实现它。</p><h1 id="4acf" class="mi mj iq bd mk ml mm mn mo mp mq mr ms kf mt kg mu ki mv kj mw kl mx km my mz bi translated">假设检验</h1><p id="89dc" class="pw-post-body-paragraph le lf iq lg b lh na ka lj lk nb kd lm ln nc lp lq lr nd lt lu lv ne lx ly lz ij bi translated">当我们设计一个A/B测试，或者更一般地说，一个实验时，标准步骤如下</p><ol class=""><li id="84cd" class="nf ng iq lg b lh li lk ll ln nh lr ni lv nj lz nk nl nm nn bi translated">定义一个<strong class="lg ja">零假设</strong> <em class="mb"> H₀ </em>，通常是实验对感兴趣的指标没有影响</li><li id="cc55" class="nf ng iq lg b lh no lk np ln nq lr nr lv ns lz nk nl nm nn bi translated">定义一个<strong class="lg ja">显著性水平</strong> <em class="mb"> α </em>，通常等于<em class="mb"> 0.05 </em>，代表当其为真时拒绝零假设的最大概率</li><li id="f5f4" class="nf ng iq lg b lh no lk np ln nq lr nr lv ns lz nk nl nm nn bi translated">定义一个<strong class="lg ja">替代假设</strong> <em class="mb"> H₁ </em>，通常是我们想要检测的最小效应大小</li><li id="91c5" class="nf ng iq lg b lh no lk np ln nq lr nr lv ns lz nk nl nm nn bi translated">定义一个<strong class="lg ja">功率水平</strong> <em class="mb"> 1-β </em>，通常等于<em class="mb"> 0.8 </em>(即<em class="mb"> β=0.2 </em>)，代表当备选项<em class="mb"> H₁ </em>为真时，拒绝零假设H₀的最小概率</li><li id="c1bf" class="nf ng iq lg b lh no lk np ln nq lr nr lv ns lz nk nl nm nn bi translated">选择一个<strong class="lg ja">测试统计量</strong>，其分布在两种假设下都是已知的，通常是感兴趣的度量的样本平均值</li><li id="0a0c" class="nf ng iq lg b lh no lk np ln nq lr nr lv ns lz nk nl nm nn bi translated">在给定所有测试参数的情况下，计算最小<strong class="lg ja">样本大小</strong>，以达到期望的功率水平<em class="mb"> 1-β </em></li></ol><p id="c689" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">然后，我们<strong class="lg ja">运行测试</strong>，根据测试统计的实际值，我们决定<strong class="lg ja">是否拒绝</strong>零假设。特别是，如果<strong class="lg ja"> p值</strong>，即在零假设下观察到的统计量等于或大于样本统计量的概率，低于显著性水平<em class="mb"> α </em>，我们拒绝零假设。</p><p id="3a37" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">请记住，拒绝零假设并不意味着接受替代假设。</p><h1 id="2776" class="mi mj iq bd mk ml mm mn mo mp mq mr ms kf mt kg mu ki mv kj mw kl mx km my mz bi translated">偷看</h1><p id="bfc4" class="pw-post-body-paragraph le lf iq lg b lh na ka lj lk nb kd lm ln nc lp lq lr nd lt lu lv ne lx ly lz ij bi translated">假设在实验进行到一半时，我们要<strong class="lg ja">偷看数据</strong>并注意到，对于检验统计量的中间值，我们会拒绝零假设。我们应该停止实验吗？如果我们做了，会发生什么？</p><p id="234e" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">答案是我们<strong class="lg ja">不应该停止</strong>实验。如果我们这样做，测试将不会达到预期的显著性水平，或者，换句话说，我们的置信区间将会有<strong class="lg ja">错误覆盖</strong>。</p><h2 id="9dd0" class="nt mj iq bd mk nu nv dn mo nw nx dp ms ln ny nz mu lr oa ob mw lv oc od my iw bi translated"><strong class="ak">示例</strong></h2><p id="f824" class="pw-post-body-paragraph le lf iq lg b lh na ka lj lk nb kd lm ln nc lp lq lr nd lt lu lv ne lx ly lz ij bi translated">让我们用一个例子来看看我的意思。假设我们的<strong class="lg ja">数据生成过程</strong>是一个均值<em class="mb"> μ </em>未知，方差<em class="mb">σ= 1</em>:<em class="mb">X∾N(μ，1) </em>的<a class="ae ma" href="https://en.wikipedia.org/wiki/Normal_distribution" rel="noopener ugc nofollow" target="_blank">标准正态分布。</a></p><p id="d72b" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">让我们挑选以下(任意的)<strong class="lg ja">假设</strong>来测试:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oe"><img src="../Images/2948347a6c3892d5b3f982cd89f6836d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C-8O8z0T-oPnCJuZN0dc4Q.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">测试假设，作者图片</p></figure><p id="ba4d" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">每次观察<em class="mb"> n </em>后，我们计算<a class="ae ma" href="https://en.wikipedia.org/wiki/Z-test" rel="noopener ugc nofollow" target="_blank"> <strong class="lg ja"> z检验统计量</strong> </a></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi of"><img src="../Images/d3bc3bd7236397c269efd7f824b42562.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DIZItSQaM6elYYcsu61beA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">z检验统计，按作者分类的图像</p></figure><p id="86fd" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">其中<em class="mb"> X̅ₙ </em>是来自大小为<em class="mb"> n </em>的样本<em class="mb"> X₁、X₂、…、Xₙ、</em>的<a class="ae ma" href="https://en.wikipedia.org/wiki/Sample_mean_and_covariance" rel="noopener ugc nofollow" target="_blank">样本均值</a>，<em class="mb"> σ </em>是总体的标准差，<em class="mb"> μ₀ </em>是在零假设下的总体均值。分母中的项是样本均值的方差。在零均值的零假设下，检验统计量分布为具有零均值和单位方差的<strong class="lg ja">标准正态分布</strong>，<em class="mb"> N(0，1) </em>。</p><p id="53ff" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">让我们用Python编写测试代码。我从<a class="ae ma" href="https://github.com/matteocourthoud/Blog-Posts/blob/main/src/utils.py" rel="noopener ugc nofollow" target="_blank">实用程序</a>中导入了一些代码，让情节更漂亮。</p><pre class="kp kq kr ks gt og oh oi oj aw ok bi"><span id="ee2e" class="nt mj iq oh b gy ol om l on oo">import numpy as np<br/>from src.utils import *<br/><br/>zstat = lambda x: np.mean(x) * np.sqrt(len(x))<br/>zstat.__name__ = 'z-statistic'</span></pre><p id="4ffe" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">假设我们想要一个显著性水平<em class="mb"> α=0.05 </em>和功效<em class="mb"> 1-β=0.8 </em>的测试。我们需要多大的样本量？</p><p id="3bca" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们需要一个<strong class="lg ja">样本大小</strong></p><ol class=""><li id="12ff" class="nf ng iq lg b lh li lk ll ln nh lr ni lv nj lz nk nl nm nn bi translated">当<em class="mb"> H₀ </em>为<em class="mb">真</em>时，拒绝零假设<em class="mb"> H₀ </em>的概率最多为<em class="mb"> α=0.05 </em></li><li id="139c" class="nf ng iq lg b lh no lk np ln nq lr nr lv ns lz nk nl nm nn bi translated">当<em class="mb"> H₀ </em>为<em class="mb">假</em>(即<em class="mb"> H₁ </em>为真)时，<em class="mb">不</em>拒绝零假设<em class="mb"> H₀ </em>的概率，最多为<em class="mb"> β=0.2 </em></li></ol><p id="11d0" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">即我们需要找到一个<strong class="lg ja">临界值</strong> <em class="mb"> c </em>使得</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi op"><img src="../Images/97fa04f1b5139d24848259d5f81659f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MR76GvqHY9oyRxo8VuzZiw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">临界值方程，作者图片</p></figure><p id="ac0b" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">其中<em class="mb"> zₚ </em>是在<em class="mb"> p </em>处的CDF倒数(或<a class="ae ma" href="https://en.wikipedia.org/wiki/Quantile_function" rel="noopener ugc nofollow" target="_blank">百分点函数</a>),而<em class="mb"> μᵢ </em>是不同假设下的平均值。</p><p id="1730" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">如果我们不知道未知平均值<em class="mb"> μ </em>的<strong class="lg ja">符号</strong>，我们必须运行一个<strong class="lg ja">双边测试</strong>。这意味着，在分布的每一侧，类型1错误的最大概率必须是<em class="mb"> α/2 = 0.025 </em>，这意味着<em class="mb"> z </em> ₀.₉₇₅.</p><p id="5c32" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">将这两个表达式结合在一起，我们可以求解出<strong class="lg ja">所需的最小样本量</strong>。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oq"><img src="../Images/958461dd376d0dc2fb54532eeb6c66b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qTywMtx0lJCL-Pvc_00FZw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">最小样本量公式，作者图片</p></figure><p id="7182" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">以便</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi or"><img src="../Images/de3014f56ff6c570728e6c3ca5ab3af5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u11F3nAbAyH5YEgTt1ozDg.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">最小样本量方程求解，图片由作者提供</p></figure><p id="c57b" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们至少需要785次观察。</p><p id="1b82" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们可以通过图形化绘制带有临界值的两个分布来获得更好的直觉。我写了一个函数<code class="fe os ot ou oh b"><a class="ae ma" href="https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/src/figures.py" rel="noopener ugc nofollow" target="_blank">plot_test</a></code>来画一个标准的假设检验设置。</p><pre class="kp kq kr ks gt og oh oi oj aw ok bi"><span id="db9f" class="nt mj iq oh b gy ol om l on oo">from src.figures import plot_test<br/><br/>plot_test(mu0=0, mu1=0.1, alpha=0.05, n=n)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ov"><img src="../Images/53faeec9a3e94af5c8847888308ee1fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*clBJgdw2n_y-rpHhZnSuhg.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">假设检验，作者图片</p></figure><p id="3254" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">临界值是这样的，给定两种假设下的分布，红色的<strong class="lg ja">拒绝面积</strong>等于<em class="mb"> α </em>。样本大小<em class="mb"> n </em>缩小了两个分布的方差，因此绿色区域等于<em class="mb"> β </em>。</p><p id="6279" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">现在让我们<strong class="lg ja">模拟一个实验</strong>，在这个实验中，我们绘制一个有序的观察序列，在每次观察之后，我们计算检验统计的值。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="120b" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">让我们看看样品是什么样的。</p><pre class="kp kq kr ks gt og oh oi oj aw ok bi"><span id="2639" class="nt mj iq oh b gy ol om l on oo">df = experiment(zstat)<br/>df.head()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oy"><img src="../Images/372f01faf561494a23a6b22971561902.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NWyb7qOsJoQDwSOaNw3ytw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">数据快照，图片由作者提供</p></figure><p id="647b" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">现在，随着我们在采样过程中积累观察值，我们可以绘制检验统计量的时间趋势图。我还用横线标记了在<em class="mb"> α=0.05 </em>的测试中拒绝零假设的值。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ow ox l"/></div></figure><pre class="kp kq kr ks gt og oh oi oj aw ok bi"><span id="bd5c" class="nt mj iq oh b gy ol om l on oo">plot_experiment(df, ybounds=[-1.96, 1.96])</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oz"><img src="../Images/e7b716a8864a1dd902b427dc1f697c22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GupCrvEGtn2PscHNbEKz7A.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">使用顺序抽样的测试统计，按作者分类的图像</p></figure><p id="aa35" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在这种情况下，测试不会越过临界值。所以偷看是没有效果的。我们不会过早地停止实验。</p><p id="f70f" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">如果我们多次重复这个实验，会发生什么？由于数据是在零假设下生成的，<em class="mb"> H₀: μ=0 </em>，我们预计只在<em class="mb"> α=5% </em>的时候拒绝它。</p><p id="b99f" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">让我们模拟数据生成过程<em class="mb"> K=100 </em>次。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="2677" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们绘制了样本的z统计分布图。</p><pre class="kp kq kr ks gt og oh oi oj aw ok bi"><span id="2d1f" class="nt mj iq oh b gy ol om l on oo">simulate_experiments(zstat, ybounds=[-1.96, 1.96], early_stop=False);</span><span id="c598" class="nt mj iq oh b gy pa om l on oo">Bounds crossed: 3 (67% upper, 33% lower)<br/>Average experiment duration: 785</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oz"><img src="../Images/6eb54007c20bb86853ee0a29edf75547.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tcXdGYrdEKy-TTMDxaTTmA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">超过100个模拟的连续抽样的测试统计，图片由作者提供</p></figure><p id="48dd" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在上图中，我突出显示了我们拒绝零假设<strong class="lg ja">而不偷看</strong>的实验，即在采样过程结束时给出z检验统计量<strong class="lg ja">的值。只有在3个实验中，最终值位于临界值之外，因此我们拒绝零假设。这意味着3%的<strong class="lg ja">拒绝率</strong>非常接近预期拒绝率<em class="mb"> α=0.05 </em>(在零假设下)。</strong></p><p id="881f" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">相反，如果我们<strong class="lg ja">不耐烦</strong>并且在收集了第一个<em class="mb"> 100个</em>观察值之后，一旦我们看到z统计量越过边界，我们就停止<strong class="lg ja">会怎么样？</strong></p><pre class="kp kq kr ks gt og oh oi oj aw ok bi"><span id="9fbe" class="nt mj iq oh b gy ol om l on oo">stops_zstat_h0 = simulate_experiments(zstsat, xmin=99, ybounds=[-1.96, 1.96], early_stop=True, lw=2);<br/>plt.vlines(100, ymin=plt.ylim()[0], ymax=plt.ylim()[1], color='k', lw=1, ls='--');</span><span id="70c0" class="nt mj iq oh b gy pa om l on oo">Bounds crossed: 25 (48% upper, 52% lower)<br/>Average experiment duration: 523</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oz"><img src="../Images/365954250886b659ae72fd166ba816a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F1DoDseVR2cbsBsQrlPexA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">测试统计超过100个模拟，图片由作者提供</p></figure><p id="4692" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在上图中，我突出显示了从第100次观察开始z统计值跨越其中一个边界的实验。这发生在<em class="mb"> 100 </em>的<em class="mb"> 25 </em>模拟中，这意味着<strong class="lg ja">的拒绝率</strong>为<em class="mb"> 25% </em>，这与<em class="mb"> α=0.05 </em>的预期拒绝率(在零假设下)相差甚远。偷看<strong class="lg ja">会扭曲</strong>测试的显著性水平。</p><p id="9290" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">一个潜在的解决方案是序贯概率比检验。但是，为了理解它，我们首先需要介绍一下<strong class="lg ja">似然比检验</strong>。</p><h1 id="ae5f" class="mi mj iq bd mk ml mm mn mo mp mq mr ms kf mt kg mu ki mv kj mw kl mx km my mz bi translated">似然比检测</h1><p id="9415" class="pw-post-body-paragraph le lf iq lg b lh na ka lj lk nb kd lm ln nc lp lq lr nd lt lu lv ne lx ly lz ij bi translated"><strong class="lg ja">似然比检验</strong>是一种试图评估观察数据由两个竞争统计模型之一生成的概率(或似然性)的检验。</p><p id="be50" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">为了执行假设检验的似然比检验，我们需要在两种假设下完全指定数据生成过程。例如，以下假设就是这种情况:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oe"><img src="../Images/2948347a6c3892d5b3f982cd89f6836d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C-8O8z0T-oPnCJuZN0dc4Q.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">测试假设，作者图片</p></figure><p id="2669" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在这种情况下，我们说统计检验是完全指定的。如果替代假设是<em class="mb"> H₁: μ ≠ 0 </em>，那么数据生成过程将不会在替代假设下指定。</p><p id="33f8" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">当一个统计检验被完全指定时，我们可以将似然比计算为两个假设下<a class="ae ma" href="https://en.wikipedia.org/wiki/Likelihood_function" rel="noopener ugc nofollow" target="_blank">似然函数</a>的比值。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pb"><img src="../Images/a089f9ed6499f28fc610acd20d96aeb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XoNBMpo3Ib9FdTUNES40Eg.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">似然比，按作者分类的图像</p></figure><p id="a700" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">似然比检验提供了如下决策规则:</p><ul class=""><li id="db8c" class="nf ng iq lg b lh li lk ll ln nh lr ni lv nj lz pc nl nm nn bi translated">如果<em class="mb">λ&gt;c</em>，则拒绝<em class="mb">h₀</em>；</li><li id="11ba" class="nf ng iq lg b lh no lk np ln nq lr nr lv ns lz pc nl nm nn bi translated">如果<em class="mb">λ&lt;c</em>，不要拒绝<em class="mb">h₀</em>；</li><li id="8f47" class="nf ng iq lg b lh no lk np ln nq lr nr lv ns lz pc nl nm nn bi translated">如果<em class="mb">λ= c</em>，以概率<em class="mb"> q </em>拒绝</li></ul><p id="3605" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">选择值<em class="mb"> c </em>和<em class="mb"> q </em>以获得指定的显著性水平<em class="mb"> α </em>。</p><p id="f323" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><a class="ae ma" href="https://en.wikipedia.org/wiki/Neyman%E2%80%93Pearson_lemma" rel="noopener ugc nofollow" target="_blank"><strong class="lg ja">ney man–Pearson引理</strong> </a>指出，在这种情况下，这种似然比检验是所有水平<em class="mb"> α </em>检验中最有效的。</p><h2 id="01e4" class="nt mj iq bd mk nu nv dn mo nw nx dp ms ln ny nz mu lr oa ob mw lv oc od my iw bi translated">特例:正态分布均值检验</h2><p id="513e" class="pw-post-body-paragraph le lf iq lg b lh na ka lj lk nb kd lm ln nc lp lq lr nd lt lu lv ne lx ly lz ij bi translated">让我们回到我们的<strong class="lg ja">示例</strong>，其中数据来自具有未知均值<em class="mb"> μ </em>和已知方差<em class="mb"> σ </em>的正态分布，我们希望执行以下测试</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oe"><img src="../Images/2948347a6c3892d5b3f982cd89f6836d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C-8O8z0T-oPnCJuZN0dc4Q.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">测试假设，作者图片</p></figure><p id="f79f" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">具有未知均值<em class="mb"> μ </em>和已知方差<em class="mb"> σ </em>的正态分布的可能性为</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pd"><img src="../Images/67bd9be29e1e322e7ff1cfadd61b2af6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wVTuLQxhwEQMn58tOUfaVA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">可能性，按作者分类的图像</p></figure><p id="c6f8" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">因此，两种假设下的似然比是</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pe"><img src="../Images/00c303b4fec7209566937a4a4ffce5b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iTUCGhvAwwWvknm3NBxFoA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">可能性比率，按作者分类的图像</p></figure><p id="4ab8" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们现在已经具备了进入这篇博文的最后阶段的所有要素:顺序概率比测试。</p><h1 id="a20d" class="mi mj iq bd mk ml mm mn mo mp mq mr ms kf mt kg mu ki mv kj mw kl mx km my mz bi translated">序贯概率比检验</h1><p id="11f2" class="pw-post-body-paragraph le lf iq lg b lh na ka lj lk nb kd lm ln nc lp lq lr nd lt lu lv ne lx ly lz ij bi translated">给定一对完全指定的假设，比如说<em class="mb"> H₀ </em>和<em class="mb"> H₁ </em>，序贯概率比检验的<strong class="lg ja">第一步</strong>是计算对数似然比检验<em class="mb">log(λᵢ</em>，随着新数据的到来:用<em class="mb"> S₀=0 </em>，那么，对于<em class="mb"> i=1，2，…，n </em>。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pf"><img src="../Images/c7832128db0d48982441b4b53e80cd3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ykzwdBeN31y_6PjrUwP9sQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">公式，作者图片</p></figure><p id="729b" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们现在可以使用<em class="mb"> Sᵢ </em>来生成一个简单的阈值方案:</p><ul class=""><li id="8757" class="nf ng iq lg b lh li lk ll ln nh lr ni lv nj lz pc nl nm nn bi translated"><em class="mb"> Sᵢ≥ b </em>:接受H₁</li><li id="4da0" class="nf ng iq lg b lh no lk np ln nq lr nr lv ns lz pc nl nm nn bi translated"><em class="mb"> Sᵢ≤答</em>:接受H₀</li><li id="fabe" class="nf ng iq lg b lh no lk np ln nq lr nr lv ns lz pc nl nm nn bi translated"><em class="mb"> a &lt; Sᵢ &lt; b </em>:继续监控(临界不等式)</li></ul><p id="06a8" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">其中阈值<em class="mb"> a </em>和<em class="mb">b</em>(<em class="mb">-∞&lt;a&lt;0&lt;b&lt;∞</em>)应取决于期望的<a class="ae ma" href="https://en.wikipedia.org/wiki/Type_I_and_type_II_errors" rel="noopener ugc nofollow" target="_blank">I型和II型误差</a>、<em class="mb"> α </em>和<em class="mb"> β </em>。我们应该如何挑选<em class="mb"> a </em>和<em class="mb"> b </em>？</p><p id="1e2f" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><a class="ae ma" href="https://www.jstor.org/stable/2235829" rel="noopener ugc nofollow" target="_blank"> Wald (1945) </a>表明，选择以下边界进行测试时，第1类和第2类错误的预期概率分别不大于<em class="mb"> α </em>和<em class="mb"> β </em>。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pe"><img src="../Images/9f96012619fdbabf02c660ab3722e7b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XX0We69YUkqzrvktApivGA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">最佳alpha和beta，作者图片</p></figure><p id="24f3" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">由于数据生成过程的离散性，这些方程是近似的。</p><p id="bbbe" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><a class="ae ma" href="https://www.jstor.org/stable/2235638" rel="noopener ugc nofollow" target="_blank"> Wald和Wolfowitz (1948) </a>已经证明，具有这些边界的检验是<strong class="lg ja">最有效的</strong>序贯概率比检验，即具有相同功效<em class="mb"> 1-β </em>和显著性<em class="mb"> α </em>的所有SPR检验至少需要相同数量的观察值。</p><h2 id="b391" class="nt mj iq bd mk nu nv dn mo nw nx dp ms ln ny nz mu lr oa ob mw lv oc od my iw bi translated">特例:测试无效效果</h2><p id="6f07" class="pw-post-body-paragraph le lf iq lg b lh na ka lj lk nb kd lm ln nc lp lq lr nd lt lu lv ne lx ly lz ij bi translated">让我们回到我们的例子，数据来自正态分布，具有未知的均值<em class="mb"> μ </em>和已知的方差<em class="mb"> σ </em>以及假设<em class="mb"> H₀: μ=0 </em>和<em class="mb"> H₁: μ=0.1 </em>。</p><p id="c1e9" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们已经看到大小为n的样本的似然比是</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pe"><img src="../Images/00c303b4fec7209566937a4a4ffce5b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iTUCGhvAwwWvknm3NBxFoA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">似然比，按作者分类的图像</p></figure><p id="d5f5" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">因此，对数似然(更容易计算)为</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pg"><img src="../Images/18a686f16df26fc86c914f023ec85c58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8bCZbTFXcnU2ayo5IFiXbQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">对数似然比，作者图片</p></figure><h2 id="ec06" class="nt mj iq bd mk nu nv dn mo nw nx dp ms ln ny nz mu lr oa ob mw lv oc od my iw bi translated">模拟</h2><p id="ad51" class="pw-post-body-paragraph le lf iq lg b lh na ka lj lk nb kd lm ln nc lp lq lr nd lt lu lv ne lx ly lz ij bi translated">我们现在准备执行一些模拟。首先，让我们对刚刚计算的<strong class="lg ja">对数似然比检验统计量</strong>进行编码。</p><pre class="kp kq kr ks gt og oh oi oj aw ok bi"><span id="44a3" class="nt mj iq oh b gy ol om l on oo">log_lr = lambda x: (np.sum((x)**2) - np.sum((x-0.1)**2) ) / 2<br/>log_lr.__name__ = 'log likelihood-ratio'</span></pre><p id="fcf9" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们重复开始时做的相同实验，只有一点不同:我们将计算对数似然比作为一个统计量。数据生成过程有<em class="mb"> μ=0 </em>，如在零假设下。</p><pre class="kp kq kr ks gt og oh oi oj aw ok bi"><span id="e6f2" class="nt mj iq oh b gy ol om l on oo">df = experiment(log_lr)<br/>df.head()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ph"><img src="../Images/de829b17cc043855f562fa21db71cefc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pLjKg85rHphyT1_3tcjhdA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">数据快照，图片由作者提供</p></figure><p id="3849" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">给定显著性水平<em class="mb"> α=0.05 </em>和幂<em class="mb"> 1-β=0.8 </em>，现在让我们计算最佳界限。</p><pre class="kp kq kr ks gt og oh oi oj aw ok bi"><span id="909d" class="nt mj iq oh b gy ol om l on oo">alpha = 0.05<br/>beta = 0.2</span><span id="d8be" class="nt mj iq oh b gy pa om l on oo">a = np.log( beta / (1-alpha) )<br/>b = np.log( (1-beta) / alpha )<br/>print(f'Optimal bounds : [{a:.3f}, {b:.3f}]')</span><span id="b4d9" class="nt mj iq oh b gy pa om l on oo">Optimal bounds : [-1.558, 2.773]</span></pre><p id="3d61" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">由于显著性和(一减)功效不同，零假设的界限比替代假设的界限更接近。这意味着，在中间效应为<em class="mb"> μ=0.05 </em>的情况下，我们将更有可能接受零假设<em class="mb"> H₀: μ=0 </em>而不是备选方案<em class="mb"> H₁: μ=0.1 </em>。</p><p id="19f4" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们可以绘制在零假设<em class="mb"> H₀: μ=0 </em>下抽取的样本的似然比分布。</p><pre class="kp kq kr ks gt og oh oi oj aw ok bi"><span id="4572" class="nt mj iq oh b gy ol om l on oo">plot_experiment(df, ybounds=[a,b])</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pi"><img src="../Images/9e2012b251934a0a64b8f1e23106720e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jKQWJC8UCwA-sgifBgDlNA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">序贯抽样的对数似然比，图片由作者提供</p></figure><p id="ffa7" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在这种特殊情况下，测试在我们的抽样框架内是不确定的。为了做出决定，我们需要<strong class="lg ja">收集更多的数据</strong>。</p><pre class="kp kq kr ks gt og oh oi oj aw ok bi"><span id="777c" class="nt mj iq oh b gy ol om l on oo">plot_experiment(experiment(log_lr, n=789), ybounds=[a,b]);</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pi"><img src="../Images/d82b5970985c8a0c271e15867287c326.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DNAjnLxHjrlYDQ9qbf0Kcg.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">序贯抽样的对数似然比，图片由作者提供</p></figure><p id="9464" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">需要789次观察才能得出结论，而之前的样本量是785。该测试程序可能需要一个比前一个更大的<strong class="lg ja">样本量</strong>。平均来说是真的吗？</p><p id="0392" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">如果我们重复实验<em class="mb"> K=100 </em>次会发生什么？</p><pre class="kp kq kr ks gt og oh oi oj aw ok bi"><span id="896c" class="nt mj iq oh b gy ol om l on oo">simulate_experiments(log_lr, ybounds=[a, b], early_stop=True, lw=1.5);</span><span id="e467" class="nt mj iq oh b gy pa om l on oo">Bounds crossed: 96 (4% upper, 96% lower)<br/>Average experiment duration: 264</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pi"><img src="../Images/53eb74d35ff960f1637ddf78a1db2b4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*omVj5sD-kPwOkaXQ3s5r4A.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">对数似然比，超过100次模拟的顺序采样，图片由作者提供</p></figure><p id="617c" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们对100个模拟中的96个做出了决定，其中96%是正确的决定。所以我们的<strong class="lg ja">拒绝率</strong>非常接近预期的<em class="mb"> α=0.05 </em>(在零假设下)。</p><p id="b20a" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">但是，对于<em class="mb"> 4 </em>的实验，测试是没有定论的。如果我们在每个实验中取样直到得出结论，会发生什么？</p><pre class="kp kq kr ks gt og oh oi oj aw ok bi"><span id="3251" class="nt mj iq oh b gy ol om l on oo">simulate_experiments(log_lr, ybounds=[a,b], early_stop=True, lw=1.5, n=1900);</span><span id="c126" class="nt mj iq oh b gy pa om l on oo">Bounds crossed: 100 (4% upper, 96% lower)<br/>Average experiment duration: 275</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pi"><img src="../Images/a1c582c50e24274daa52f306e2b033e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2kQTLRKNDTqiBlV3I0qYrw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">对数似然比，超过100次模拟的顺序采样，图片由作者提供</p></figure><p id="f07e" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">从图中我们可以看出，在一个特别不走运的实验中，我们需要收集<em class="mb"> 1900 </em>次观测结果才能得出结论。然而，尽管有这个异常值，平均实验持续时间是惊人的275个T21样本，几乎是785个样本的三分之一！</p><p id="b6c2" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">如果另一个假设<em class="mb"> H₁: μ= 0.1 </em>是真的，会发生什么？</p><pre class="kp kq kr ks gt og oh oi oj aw ok bi"><span id="7d46" class="nt mj iq oh b gy ol om l on oo">simulate_experiments(log_lr, ybounds=[a,b], early_stop=True, mu=0.1, lw=1, n=2100);</span><span id="e02d" class="nt mj iq oh b gy pa om l on oo">Bounds crossed: 100 (84% upper, 16% lower)<br/>Average experiment duration: 443</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pj"><img src="../Images/7cf7fd9dbcb82ec83496f773f34940f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m3O2KL7JbQ8XUtiO-o207Q.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">对数似然比，超过100次模拟的顺序采样，图片由作者提供</p></figure><p id="db01" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在这种情况下，我们只在<em class="mb"> 84% </em>的模拟中做出了正确的决策，这与<em class="mb"> 80% </em>(替代假设下)的期望值，即实验的功效<em class="mb"> 1-β </em>非常接近。</p><p id="1ce9" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">此外，同样在这种情况下，我们需要一个小得多的样本量:平均来说，只有<em class="mb"> 443 </em>个观察值。</p></div><div class="ab cl pk pl hu pm" role="separator"><span class="pn bw bk po pp pq"/><span class="pn bw bk po pp pq"/><span class="pn bw bk po pp"/></div><div class="ij ik il im in"><h1 id="e6c9" class="mi mj iq bd mk ml pr mn mo mp ps mr ms kf pt kg mu ki pu kj mw kl pv km my mz bi translated">结论</h1><p id="ad3e" class="pw-post-body-paragraph le lf iq lg b lh na ka lj lk nb kd lm ln nc lp lq lr nd lt lu lv ne lx ly lz ij bi translated">在这篇文章中，我们已经看到了在随机实验中<strong class="lg ja">偷看</strong>的危险。过早停止测试可能是危险的，因为它会扭曲推断，使置信区间的覆盖范围发生偏差。</p><p id="45b4" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">这是否意味着我们总是需要用预先指定的样本量进行测试？不要！存在允许最佳停止的程序。这些程序是为了一个特定的目的而诞生的:在不牺牲准确性的情况下，尽可能地减少样本量。第一个也是最著名的是序贯概率比检验，Wallis将其定义为“<em class="mb">过去三分之一世纪</em>中最强大和最具开创性的统计思想”(1980年)。</p><p id="d1d7" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">SPRT不仅是80年前测试弹药箱的强大工具，而且今天仍被用于非常实际的目的(例如，它是如何在网飞<a class="ae ma" href="https://netflixtechblog.com/improving-experimentation-efficiency-at-netflix-with-meta-analysis-and-optimal-stopping-d8ec290ae5be" rel="noopener ugc nofollow" target="_blank">或T2【优步】T3使用的)。</a></p><h2 id="93c3" class="nt mj iq bd mk nu nv dn mo nw nx dp ms ln ny nz mu lr oa ob mw lv oc od my iw bi translated">参考</h2><p id="6b9d" class="pw-post-body-paragraph le lf iq lg b lh na ka lj lk nb kd lm ln nc lp lq lr nd lt lu lv ne lx ly lz ij bi translated">[1] A .沃尔德，<a class="ae ma" href="https://www.jstor.org/stable/2235829" rel="noopener ugc nofollow" target="_blank"/>(1945)，<em class="mb">《数理统计年鉴》</em>。</p><p id="b4f1" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">[2] A .沃尔德和J .沃尔福威茨，<a class="ae ma" href="https://www.jstor.org/stable/2235638" rel="noopener ugc nofollow" target="_blank">序贯概率比检验的最优特征</a> (1948年)，<em class="mb">《数理统计年鉴》</em>。</p><p id="264c" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">[3] W. A .沃利斯，<a class="ae ma" href="https://www.tandfonline.com/doi/abs/10.1080/01621459.1980.10477469" rel="noopener ugc nofollow" target="_blank">统计研究小组，1942–1945</a>(1980)，<em class="mb">美国统计协会杂志</em>。</p><h2 id="1350" class="nt mj iq bd mk nu nv dn mo nw nx dp ms ln ny nz mu lr oa ob mw lv oc od my iw bi translated">密码</h2><p id="fa05" class="pw-post-body-paragraph le lf iq lg b lh na ka lj lk nb kd lm ln nc lp lq lr nd lt lu lv ne lx ly lz ij bi translated">你可以在这里找到Jupyter的原版笔记本。</p><div class="pw px gp gr py pz"><a href="https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/optimal_stopping.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="qa ab fo"><div class="qb ab qc cl cj qd"><h2 class="bd ja gy z fp qe fr fs qf fu fw iz bi translated">Blog-Posts/optimal _ stopping . ipynb at main matter courthoud/Blog-Posts</h2><div class="qg l"><h3 class="bd b gy z fp qe fr fs qf fu fw dk translated">我博客文章的代码和笔记本。通过在…上创建帐户，为matteocourthoud/Blog-Posts的发展做出贡献</h3></div><div class="qh l"><p class="bd b dl z fp qe fr fs qf fu fw dk translated">github.com</p></div></div><div class="qi l"><div class="qj l qk ql qm qi qn ky pz"/></div></div></a></div></div><div class="ab cl pk pl hu pm" role="separator"><span class="pn bw bk po pp pq"/><span class="pn bw bk po pp pq"/><span class="pn bw bk po pp"/></div><div class="ij ik il im in"><h2 id="1f1f" class="nt mj iq bd mk nu nv dn mo nw nx dp ms ln ny nz mu lr oa ob mw lv oc od my iw bi translated">感谢您的阅读！</h2><p id="a168" class="pw-post-body-paragraph le lf iq lg b lh na ka lj lk nb kd lm ln nc lp lq lr nd lt lu lv ne lx ly lz ij bi translated"><em class="mb">真的很感谢！</em>🤗<em class="mb">如果你喜欢这个帖子并且想看更多，可以考虑</em> <a class="ae ma" href="https://medium.com/@matteo.courthoud" rel="noopener"> <strong class="lg ja"> <em class="mb">关注我</em> </strong> </a> <em class="mb">。我每周发布一次与因果推断和数据分析相关的主题。我尽量让我的帖子简单而精确，总是提供代码、例子和模拟。</em></p><p id="9638" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><em class="mb">还有，一个小小的</em> <strong class="lg ja"> <em class="mb">免责声明</em> </strong> <em class="mb">:我写作是为了学习所以错误是家常便饭，尽管我尽了最大努力。当你发现他们的时候，请告诉我。也很欣赏新话题的建议！</em></p></div></div>    
</body>
</html>