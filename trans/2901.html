<html>
<head>
<title>5 Advanced SQL Concepts You Should Know in 2022</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">2022年你应该知道的5个高级SQL概念</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/5-advanced-sql-concepts-you-should-know-in-2022-b50efe6c99#2022-06-24">https://towardsdatascience.com/5-advanced-sql-concepts-you-should-know-in-2022-b50efe6c99#2022-06-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="2457" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">数据科学</h2><div class=""/><div class=""><h2 id="ef50" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">立即掌握这些节省时间的高级SQL查询</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/30b616c422f5e83a6c8ca99ffefcc640.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8f399rq3ZHetn1tA_YHBiw.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">乔恩·泰森在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="3993" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">做SQL高手！</strong>🏆</p><p id="f9fc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">SQL或结构化查询语言是任何处理数据的人的必备工具。</p><p id="1535" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">随着数据量的增加，对熟练数据专业人员的需求也在增加。仅有高级SQL概念的知识是不够的，但是您应该能够在工作中高效地实施它们<em class="me">,这也是数据科学职位的求职面试所需要的！</em></p><p id="61f9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，我在这里列出了2022年你应该知道的5个高级SQL概念及其解释和查询示例。</p><p id="b34c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我把这篇文章写得很短，这样你就可以很快地完成它，掌握那些必须知道的、赢得面试的SQL技巧。🏆</p><p id="0b74" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可以使用此索引快速导航到您最喜欢的部分。</p><pre class="ks kt ku kv gt mf mg mh mi aw mj bi"><span id="273c" class="mk ml it mg b gy mm mn l mo mp"><strong class="mg jd">· </strong><a class="ae lh" href="#e85d" rel="noopener ugc nofollow"><strong class="mg jd">Common Table Expressions (CTEs)</strong></a><strong class="mg jd"><br/>· </strong><a class="ae lh" href="#9f01" rel="noopener ugc nofollow"><strong class="mg jd">ROW_NUMBER() vs RANK() vs DENSE_RANK()</strong></a><strong class="mg jd"><br/>· </strong><a class="ae lh" href="#2f01" rel="noopener ugc nofollow"><strong class="mg jd">CASE WHEN Statement</strong></a><strong class="mg jd"><br/>· </strong><a class="ae lh" href="#1c8a" rel="noopener ugc nofollow"><strong class="mg jd">Extract Data From Date — Time Columns</strong></a><strong class="mg jd"><br/>· </strong><a class="ae lh" href="#3ad5" rel="noopener ugc nofollow"><strong class="mg jd">SELF JOIN</strong></a></span></pre><blockquote class="mq mr ms"><p id="1bb3" class="li lj me lk b ll lm kd ln lo lp kg lq mt ls lt lu mu lw lx ly mv ma mb mc md im bi translated">📍注意:我使用的是SQLite DB浏览器和一个使用<a class="ae lh" rel="noopener" target="_blank" href="/faker-an-amazing-and-insanely-useful-python-library-b313a60bdabf"> Faker </a>创建的自己创建的<a class="ae lh" href="https://github.com/17rsuraj/data-curious/blob/master/TowardsDataScience/Dummy_Sales_Data_v1.csv" rel="noopener ugc nofollow" target="_blank"> Dummy_Sales_Data </a>，你可以在我的<a class="ae lh" href="https://github.com/17rsuraj/data-curious/blob/master/TowardsDataScience/Dummy_Sales_Data_v1.csv" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd"> Github </strong> </a> repo上免费获得！</p></blockquote><p id="69e7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">好了，我们开始吧…🚀</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="e85d" class="nd ml it bd ne nf ng nh ni nj nk nl nm ki nn kj no kl np km nq ko nr kp ns nt bi translated">公共表表达式(cte)</h1><p id="af27" class="pw-post-body-paragraph li lj it lk b ll nu kd ln lo nv kg lq lr nw lt lu lv nx lx ly lz ny mb mc md im bi translated">在处理真实世界的数据时，有时您需要查询另一个查询的结果。实现这一点的简单方法是使用子查询。</p><p id="7e80" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，随着复杂性的增加，计算子查询变得难以阅读和调试。</p><p id="e9ee" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这时，cte开始出现，让你的生活更轻松。cte使得编写和维护复杂的查询变得容易。✅</p><p id="3458" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，考虑以下使用子查询的数据提取</p><pre class="ks kt ku kv gt mf mg mh mi aw mj bi"><span id="150a" class="mk ml it mg b gy mm mn l mo mp">SELECT Sales_Manager, Product_Category, UnitPrice<br/>FROM Dummy_Sales_Data_v1<br/>WHERE Sales_Manager IN (<strong class="mg jd">SELECT DISTINCT Sales_Manager<br/>                        FROM Dummy_Sales_Data_v1<br/>                        WHERE Shipping_Address = 'Germany'<br/>                        AND UnitPrice &gt; 150</strong>)<br/>AND Product_Category IN (<strong class="mg jd">SELECT DISTINCT Product_Category<br/>                         FROM Dummy_Sales_Data_v1<br/>                         WHERE Product_Category = 'Healthcare'<br/>                         AND UnitPrice &gt; 150</strong>)<br/>ORDER BY UnitPrice DESC</span></pre><p id="d6f7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里我只使用了两个子查询，代码简单易懂。</p><p id="1bb0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这仍然很难理解，当您在子查询中添加更多的计算或者甚至添加更少的子查询时会怎么样— <strong class="lk jd"> <em class="me">复杂性增加</em> </strong>使得代码可读性更差并且难以维护。</p><p id="767a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，让我们看看上面带有CTE的子查询的简化版本，如下所示。</p><pre class="ks kt ku kv gt mf mg mh mi aw mj bi"><span id="70e4" class="mk ml it mg b gy mm mn l mo mp">WITH SM AS<br/><strong class="mg jd">(<br/>SELECT DISTINCT Sales_Manager<br/>FROM Dummy_Sales_Data_v1<br/>WHERE Shipping_Address = 'Germany'<br/>AND UnitPrice &gt; 150<br/>)</strong>,</span><span id="b2f1" class="mk ml it mg b gy nz mn l mo mp">PC AS<br/><strong class="mg jd">(<br/>SELECT DISTINCT Product_Category<br/>FROM Dummy_Sales_Data_v1<br/>WHERE Product_Category = 'Healthcare'<br/>AND UnitPrice &gt; 150<br/>)</strong></span><span id="c8f5" class="mk ml it mg b gy nz mn l mo mp">SELECT Sales_Manager, Product_Category, UnitPrice<br/>FROM Dummy_Sales_Data_v1<br/>WHERE Product_Category IN (<strong class="mg jd">SELECT Product_Category FROM PC</strong>)<br/>AND Sales_Manager IN (<strong class="mg jd">SELECT Sales_Manager FROM SM</strong>)<br/>ORDER BY UnitPrice DESC</span></pre><p id="ce6b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">复杂的子查询被分解成要使用的更简单的代码块。</p><p id="0c24" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这样，复杂的子查询被重写为两个更容易理解和修改的cte<code class="fe oa ob oc mg b">SM</code>和<code class="fe oa ob oc mg b">PC</code>。🎯</p><p id="9f5c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">上面的两个查询，用了相同的时间执行，产生了如下相同的输出。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi od"><img src="../Images/b09e2f75a5205f2c36e2ed17e2ec72c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*QgADvOPYrkxV7F6YzYp1kw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">CTE vs子查询|作者图片</p></figure><p id="108e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">cte本质上允许您从查询结果中创建一个临时表。这提高了代码的可读性和可维护性。✅</p><p id="0db3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">真实世界的数据集可能有数百万或数十亿行，占据数千GB的存储空间。使用这些表中的数据进行计算，特别是将它们与其他表直接连接，将会非常昂贵。</p><p id="1115" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这类任务的最终解决方案是使用cte。💯</p><p id="8ae9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，让我们看看如何使用窗口函数给数据集中的每一行分配一个整数“等级”。</p><h1 id="9f01" class="nd ml it bd ne nf oe nh ni nj of nl nm ki og kj no kl oh km nq ko oi kp ns nt bi translated">ROW _ NUMBER()vs RANK()vs DENSE _ RANK()</h1><p id="5be6" class="pw-post-body-paragraph li lj it lk b ll nu kd ln lo nv kg lq lr nw lt lu lv nx lx ly lz ny mb mc md im bi translated">在处理真实数据集时，另一个常用的概念是记录的排序。公司在不同的场景中使用它，例如—</p><ol class=""><li id="10ff" class="oj ok it lk b ll lm lo lp lr ol lv om lz on md oo op oq or bi translated">根据销量对畅销品牌进行排名</li><li id="e651" class="oj ok it lk b ll os lo ot lr ou lv ov lz ow md oo op oq or bi translated">根据订单数量或产生的收入对顶级垂直产品进行排名</li><li id="5c14" class="oj ok it lk b ll os lo ot lr ou lv ov lz ow md oo op oq or bi translated">获得观看次数最高的每种类型的电影名称</li></ol><p id="6b0b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe oa ob oc mg b">ROW_NUMBER</code>、<code class="fe oa ob oc mg b">RANK()</code>和<code class="fe oa ob oc mg b">DENSE_RANK()</code>主要用于在结果集的上述分区内给每个记录分配连续的整数。</p><blockquote class="ox"><p id="fe98" class="oy oz it bd pa pb pc pd pe pf pg md dk translated">当你在某些记录上有联系时，它们之间的差别是显而易见的。</p></blockquote><p id="add5" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">当结果表中存在重复行时，整数被分配给每条记录的行为和方式会发生变化。✅</p><p id="5c94" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们来看一个<a class="ae lh" href="https://github.com/17rsuraj/data-curious/blob/master/TowardsDataScience/Dummy_Sales_Data_v1.csv" rel="noopener ugc nofollow" target="_blank"> <em class="me">虚拟销售数据集</em> </a>的快速示例，按运费降序列出所有产品类别、送货地址。</p><pre class="ks kt ku kv gt mf mg mh mi aw mj bi"><span id="d7db" class="mk ml it mg b gy mm mn l mo mp">SELECT Product_Category,<br/>  Shipping_Address,<br/>  Shipping_Cost,<br/>  <strong class="mg jd">ROW_NUMBER()</strong> OVER<br/>              (PARTITION BY Product_Category,<br/>                            Shipping_Address<br/>               ORDER BY Shipping_Cost DESC) as RowNumber,<br/>  <strong class="mg jd">RANK()</strong> OVER <br/>        (PARTITION BY Product_Category,<br/>                      Shipping_Address<br/>         ORDER BY Shipping_Cost DESC) as RankValues,<br/>  <strong class="mg jd">DENSE_RANK()</strong> OVER <br/>              (PARTITION BY Product_Category,<br/>                            Shipping_Address <br/>               ORDER BY Shipping_Cost DESC) as DenseRankValues<br/>FROM Dummy_Sales_Data_v1<br/>WHERE Product_Category IS NOT NULL<br/>AND Shipping_Address IN ('Germany','India')<br/>AND Status IN ('Delivered')</span></pre><p id="d9c5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">正如您所看到的，三者的语法是相同的，但是，它会产生如下不同的输出:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pm"><img src="../Images/56eace6f1ad6c274dc641dc8109683ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*THFX_HiMwKzNKBUy2BRbmg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">ROW_NUMBER()、RANK()和DENSE_RANK()之间的差异</p></figure><p id="b1f4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe oa ob oc mg b"><strong class="lk jd">RANK()</strong></code>是根据<code class="fe oa ob oc mg b">ORDER BY</code>子句的条件检索已排序的行。如您所见，前两行之间有一个平局，即前两行在<em class="me"> Shipping_Cost </em>列中有相同的值(<em class="me">在</em> <code class="fe oa ob oc mg b"><em class="me">ORDER BY</em></code> <em class="me">条款</em>中提到)。</p><p id="540c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe oa ob oc mg b">RANK</code>给两行分配相同的整数。但是，它会将重复的行数添加到重复的排名中，以获得下一行的排名。这就是为什么，第三行(<em class="me">用红色标记</em>)，<code class="fe oa ob oc mg b">RANK</code>分配等级<code class="fe oa ob oc mg b"><strong class="lk jd">3</strong></code> ( <em class="me"> 2个重复行+ 1个重复等级</em>)</p><p id="65d5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe oa ob oc mg b"><strong class="lk jd">DENSE_RANK</strong></code>类似于<code class="fe oa ob oc mg b">RANK</code>，但是它不会跳过任何数字，即使两行之间有平局。这可以在上图的<em class="me">蓝框</em>中看到。</p><p id="633e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">与上面两个不同，<code class="fe oa ob oc mg b"><strong class="lk jd">ROW_NUMBER</strong></code>只是从1开始给分区中的每个记录分配序列号。如果它在同一个分区中检测到两个相同的值，它会为这两个值分配不同的等级号。</p><p id="2219" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">对于产品类别的下一个分区</strong>—发货地址→ <em class="me">娱乐—印度</em>,<strong class="lk jd">通过所有三个函数<strong class="lk jd">对</strong>进行排序，从1 </strong>重新开始，如下图所示。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pn"><img src="../Images/ac43cc8d8316aab5a04246defa54eb7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*khZ-7NatHY7eRJ_t0qCT7Q.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">不同分区中的行号、等级、密度等级|按作者分类的图像</p></figure><p id="cc4b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最终，如果在<code class="fe oa ob oc mg b">ORDER BY</code>子句中使用的列中没有重复的值，这些函数将返回相同的输出。💯</p><p id="76ee" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，下一个概念将讲述更多关于如何实现条件语句和使用它透视数据。</p><h1 id="2f01" class="nd ml it bd ne nf oe nh ni nj of nl nm ki og kj no kl oh km nq ko oi kp ns nt bi translated">CASE WHEN语句</h1><p id="ed88" class="pw-post-body-paragraph li lj it lk b ll nu kd ln lo nv kg lq lr nw lt lu lv nx lx ly lz ny mb mc md im bi translated">CASE语句将允许您在SQL中实现<code class="fe oa ob oc mg b">if-else</code>，因此您可以使用它来有条件地运行查询。</p><p id="b5c8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe oa ob oc mg b"><strong class="lk jd">CASE</strong></code>语句主要测试<code class="fe oa ob oc mg b"><strong class="lk jd">WHEN</strong></code>子句中提到的条件，并返回<code class="fe oa ob oc mg b"><strong class="lk jd">THEN</strong></code>子句中提到的值。当不满足任何条件时，它将返回<code class="fe oa ob oc mg b"><strong class="lk jd">ELSE</strong></code>子句中提到的值。✅</p><p id="a5b8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在处理真实数据项目时，CASE语句通常用于根据其他列中的值对数据进行分类。它也可以与聚合函数一起使用。</p><p id="52f9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，让我们再次使用<a class="ae lh" href="https://github.com/17rsuraj/data-curious/blob/master/TowardsDataScience/Dummy_Sales_Data_v1.csv" rel="noopener ugc nofollow" target="_blank"> <em class="me">虚拟销售数据</em> </a>根据数量将销售订单分为高、中、低三种数量。</p><pre class="ks kt ku kv gt mf mg mh mi aw mj bi"><span id="cc29" class="mk ml it mg b gy mm mn l mo mp">SELECT OrderID,<br/>       OrderDate,<br/>       Sales_Manager,<br/>       Quantity,<br/>       <strong class="mg jd">CASE WHEN Quantity &gt; 51 THEN 'High'<br/>            WHEN Quantity &lt; 51 THEN 'Low'<br/>            ELSE 'Medium' <br/>       END AS OrderVolume</strong><br/>FROM Dummy_Sales_Data_v1</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi po"><img src="../Images/87f5e680d167ec0ea9e404bd39a5659e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*UB-kJ26S5C9NSte-wBnVVg.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">CASE WHEN语句按作者对SQL | Image中的记录进行分类</p></figure><p id="172a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">简单地说，它创建了一个新的列<em class="me"> OrderVolume </em>，并根据列<em class="me"> Quantity </em>中的值添加了值“高”、“低”、“中”。</p><p id="70e6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">📌您可以包含多个WHEN..THEN子句并跳过ELSE子句，因为它是可选的。</p><p id="cf53" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">📌如果您没有提到ELSE子句，并且没有满足任何条件，查询将为该特定记录返回<code class="fe oa ob oc mg b"><strong class="lk jd">NULL</strong></code>。</p><p id="4120" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">case语句的另一个常用但鲜为人知的用例是— <strong class="lk jd">数据透视</strong>。</p><blockquote class="ox"><p id="57cb" class="oy oz it bd pa pb pc pd pe pf pg md dk translated">数据透视是重新排列结果集中的列和行的过程，以便您可以从不同的角度查看数据。</p></blockquote><p id="dfee" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">有时您处理的数据是长格式的(行数&gt;列数)，您需要得到宽格式的数据(列数&gt;行数)。</p><p id="50a2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这种情况下，CASE语句非常有用。💯</p><p id="0261" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，让我们找出新加坡、英国、肯尼亚和印度的每个销售经理处理了多少订单。</p><pre class="ks kt ku kv gt mf mg mh mi aw mj bi"><span id="5491" class="mk ml it mg b gy mm mn l mo mp">SELECT Sales_Manager,<br/>       <strong class="mg jd">COUNT(CASE WHEN Shipping_Address = 'Singapore' THEN OrderID<br/>             END) AS Singapore_Orders,<br/>  <br/>       COUNT(CASE WHEN Shipping_Address = 'UK' THEN OrderID<br/>             END) AS UK_Orders,<br/>     <br/>       COUNT(CASE WHEN Shipping_Address = 'Kenya' THEN OrderID<br/>             END) AS Kenya_Orders,<br/>  <br/>       COUNT(CASE WHEN Shipping_Address = 'India' THEN OrderID<br/>             END) AS India_Orders</strong><br/>FROM Dummy_Sales_Data_v1<br/>GROUP BY Sales_Manager</span></pre><p id="653c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用案例..当...的时候..然后，我们为每个送货地址创建单独的列，以获得预期的输出，如下所示。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/931dc227ea32b462cb707723b3ad3a2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*AwxJqFh453KgwISEBuayIQ.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">使用SQL中的CASE语句按作者透视数据|图像</p></figure><p id="809c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">根据您的用例，您还可以在case语句中使用不同的聚合，如SUM、AVG、MAX、MIN。</p><p id="1c80" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，在处理真实世界的数据时，它通常包含日期时间值。因此，了解如何提取日期时间值的不同部分(如月、周、年)非常重要。</p><h1 id="1c8a" class="nd ml it bd ne nf oe nh ni nj of nl nm ki og kj no kl oh km nq ko oi kp ns nt bi translated">从日期-时间列中提取数据</h1><p id="3082" class="pw-post-body-paragraph li lj it lk b ll nu kd ln lo nv kg lq lr nw lt lu lv nx lx ly lz ny mb mc md im bi translated">在大多数访谈中，您会被要求按月汇总数据或计算特定月份的特定指标。</p><p id="383f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当数据集中没有单独的月份列时，您需要从数据中的日期时间变量中提取所需的日期部分。</p><p id="4ed6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">不同的SQL环境有不同的函数来提取日期的各个部分。总的来说，在MySQL中你应该知道—</p><pre class="ks kt ku kv gt mf mg mh mi aw mj bi"><span id="9d20" class="mk ml it mg b gy mm mn l mo mp"><strong class="mg jd">EXTRACT</strong>(part_of_date FROM date_time_column_name)</span><span id="234f" class="mk ml it mg b gy nz mn l mo mp"><strong class="mg jd">YEAR</strong>(date_time_column_name)</span><span id="5f37" class="mk ml it mg b gy nz mn l mo mp"><strong class="mg jd">MONTH</strong>(date_time_column_name)</span><span id="b702" class="mk ml it mg b gy nz mn l mo mp"><strong class="mg jd">MONTHNAME</strong>(date_time_column_name)</span><span id="3a50" class="mk ml it mg b gy nz mn l mo mp"><strong class="mg jd">DATE_FORMAT</strong>(date_time_column_name)</span></pre><p id="3489" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，让我们从<a class="ae lh" href="https://github.com/17rsuraj/data-curious/blob/master/TowardsDataScience/Dummy_Sales_Data_v1.csv" rel="noopener ugc nofollow" target="_blank"> <em class="me">虚拟销售数据集</em> </a>中找出每个月的订单总量。</p><pre class="ks kt ku kv gt mf mg mh mi aw mj bi"><span id="1612" class="mk ml it mg b gy mm mn l mo mp">SELECT <strong class="mg jd">strftime('%m', OrderDate)</strong> as Month,<br/>       SUM(Quantity) as Total_Quantity<br/>from Dummy_Sales_Data_v1<br/>GROUP BY strftime('%m', OrderDate)</span></pre><p id="6328" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你也像我一样使用SQLite DB浏览器，你必须使用函数<code class="fe oa ob oc mg b"><strong class="lk jd">strftime()</strong></code>来提取日期部分，如下所示。您需要使用<code class="fe oa ob oc mg b">strftime()</code>中的<code class="fe oa ob oc mg b"><strong class="lk jd">‘%m’</strong></code> <strong class="lk jd"> </strong>来提取月份。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pq"><img src="../Images/7f09363dc7b61331b6a0d7be00b9349d.png" data-original-src="https://miro.medium.com/v2/resize:fit:420/format:webp/1*U4r0y2GYyleuVuCTPrcn3w.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">按作者从SQL | Image中的日期提取月份</p></figure><p id="af55" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下图显示了大多数通常提取的日期部分，以及你应该在<code class="fe oa ob oc mg b"><strong class="lk jd">EXTRACT</strong></code>函数中使用的关键字。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pr"><img src="../Images/04fb5a99637f0850e2becfb00d61afe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RjCBAgdc0zMu3GxW.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">按作者提取PostgreSQL、MySQL和SQLite |图片中的部分日期</p></figure><p id="2b60" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这篇快速阅读中，我解释了几乎所有类型的日期部分提取。看一看它就能对它有一个完整的了解。</p><div class="ps pt gp gr pu pv"><a href="https://python.plainenglish.io/5-must-know-sql-functions-for-data-analysis-1f1a6ca53974" rel="noopener  ugc nofollow" target="_blank"><div class="pw ab fo"><div class="px ab py cl cj pz"><h2 class="bd jd gy z fp qa fr fs qb fu fw jc bi translated">用于数据分析的5个必备SQL函数</h2><div class="qc l"><h3 class="bd b gy z fp qa fr fs qb fu fw dk translated">关于SQL函数最全面的指南，最大限度地利用数据！</h3></div><div class="qd l"><p class="bd b dl z fp qa fr fs qb fu fw dk translated">python .平原英语. io</p></div></div><div class="qe l"><div class="qf l qg qh qi qe qj lb pv"/></div></div></a></div><p id="1179" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后但同样重要的是，</p><p id="1e4f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在现实世界中，您会经常看到数据存储在一个大表中，而不是多个小表中。这时，在处理这些数据集时，自连接就可以解决一些有趣的问题了。</p><h1 id="3ad5" class="nd ml it bd ne nf oe nh ni nj of nl nm ki og kj no kl oh km nq ko oi kp ns nt bi translated">自连接</h1><p id="9037" class="pw-post-body-paragraph li lj it lk b ll nu kd ln lo nv kg lq lr nw lt lu lv nx lx ly lz ny mb mc md im bi translated">这些与SQL中的其他连接完全相同，唯一的区别是——在<code class="fe oa ob oc mg b">SELF JOIN</code>中，您将一个表与其自身连接起来。</p><p id="9cc6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">记住，这里没有<code class="fe oa ob oc mg b">SELF JOIN</code>关键字，所以在连接中涉及的两个表是同一个表的情况下，只需使用<code class="fe oa ob oc mg b"><strong class="lk jd">JOIN</strong></code>。因为两个表名相同，所以在自连接的情况下使用表别名是很重要的。✅</p><blockquote class="mq mr ms"><p id="ae00" class="li lj me lk b ll lm kd ln lo lp kg lq mt ls lt lu mu lw lx ly mv ma mb mc md im bi translated">编写一个SQL查询，找出收入高于其经理的雇员<br/><em class="it">——这是</em> <code class="fe oa ob oc mg b"><em class="it">SELF JOIN</em></code>中最常被问到的面试问题之一</p></blockquote><p id="3a4e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们以此为例，创建如下所示的Dummy_Employees数据集。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi qk"><img src="../Images/0dd7b35cf32cb997a7d2e68eb4bc4e3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*Gi-KpZ96PD_MR1zm-onGXw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">虚拟员工数据集|作者图片</p></figure><p id="60d4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">并尝试使用该查询找出哪些员工处理的订单比他们的经理多，</p><pre class="ks kt ku kv gt mf mg mh mi aw mj bi"><span id="35b5" class="mk ml it mg b gy mm mn l mo mp">SELECT t1.EmployeeName, t1.TotalOrders<br/><strong class="mg jd">FROM Dummy_Employees AS t1<br/>JOIN Dummy_Employees AS t2<br/>ON t1.ManagerID = t2.EmployeeID</strong><br/>WHERE t1.TotalOrders &gt; t2.TotalOrders</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ql"><img src="../Images/f23d94f1b6f52188a6eb873774175335.png" data-original-src="https://miro.medium.com/v2/resize:fit:522/format:webp/1*UVXd7izwQ6cKKjX4y3BA3g.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">结果集|作者图片</p></figure><p id="5e88" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">不出所料，员工Abdul和Maria比他们的经理Pablo处理了更多的订单。</p><p id="fb29" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我面对的几乎80%的面试中，我都会遇到这个问题。所以，这是<code class="fe oa ob oc mg b">SELF JOIN</code>的经典用例。</p><p id="747f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">仅此而已！</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><p id="032f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我希望你很快完成这篇文章，并发现它对提高SQL技能很有用。</p><p id="2c92" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我在过去3年里一直在使用SQL，我发现这些概念经常成为数据分析师和数据科学家职位的面试问题。这些概念在实际项目中非常有用。</p><blockquote class="ox"><p id="95c5" class="oy oz it bd pa pb pc pd pe pf pg md dk translated"><em class="qm">对阅读介质上的无限故事感兴趣？？</em></p></blockquote><p id="4953" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">💡考虑<a class="ae lh" href="https://medium.com/@17.rsuraj/membership" rel="noopener"> <strong class="lk jd">成为媒体会员</strong></a><strong class="lk jd">访问媒体上无限的</strong>故事和每日有趣的媒体文摘。我会得到你的费用的一小部分，没有额外的费用给你。</p><p id="1838" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">💡请务必<a class="ae lh" href="https://medium.com/subscribe/@17.rsuraj" rel="noopener"> <strong class="lk jd">注册我的电子邮件列表</strong> </a>以免错过另一篇关于数据科学指南、技巧和提示、SQL和Python的文章。</p><p id="16e8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">感谢您的阅读！</strong></p></div></div>    
</body>
</html>