<html>
<head>
<title>Reshaping a Pandas Dataframe: Long-to-Wide and Vice Versa</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">重塑熊猫数据框架:从长到宽，反之亦然</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/reshaping-a-pandas-dataframe-long-to-wide-and-vice-versa-517c7f0995ad#2022-05-25">https://towardsdatascience.com/reshaping-a-pandas-dataframe-long-to-wide-and-vice-versa-517c7f0995ad#2022-05-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fb65" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用这两个简单的方法透视/反透视熊猫数据帧</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/8f3ed3d65bcbb2bcfca5052617c6e0bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*QUzbX6Mpswv2_O0rDJty4w.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">图片由<a class="ae ku" href="https://pixabay.com/illustrations/panda-animal-texture-unique-art-5364820/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>(作者修改)</p></figure><p id="e900" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">重塑<code class="fe lr ls lt lu b">pandas</code>数据框架是数据分析领域最常见的数据争论任务之一。它也称为将表格从长格式转置或旋转/取消旋转为宽格式或从宽格式转置或旋转为长格式。那么什么是长数据格式，什么是宽数据格式，我们如何将数据帧从长到宽进行整形，反之亦然？</p><p id="1818" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">下面我们来看一个简单的例子。该示例显示了从2020年1月到2022年4月美国所有城市5种食品类别的平均食品价格。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lv"><img src="../Images/0cb543cfe35029c82990c0cb78fc8a7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xDTjratE0h-JdkXt0h7MxA.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="c19c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">左边的数据帧具有长格式。“系列ID”和“项目”列代表食品类别。“Year Month”是一个单列，包含从2020年1月到2022年4月的所有月份。“价格($)”在“年月”列中有一个对应于每个月的值。</p><p id="d4a3" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">请注意左边的数据框架是如何以长格式构建的:每个食品类别(“项目”)都有多个重复的行，每一行都代表一个特定的年/月以及对应于该年/月的平均食品价格。虽然我们只有5个食物类别(“项目”)，但我们总共有139行，这使得数据帧成为一个“长”形。</p><p id="7f80" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">相比之下，右侧的数据框具有宽格式，更像电子表格样式的格式。在这种格式中，每行代表一个独特的食物类别。我们旋转左边数据框中的“年/月”列，这样每个月都在一个单独的列中——使右边的数据框成为一个“宽”形。左表中“年/月”列的值现在变成了右表中的列名，我们得到了“平均”。每个月/年列的价格。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><p id="6df4" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在我们已经了解了什么是长数据格式和宽数据格式，让我们看看如何在Pandas中轻松地在这两种格式之间切换。我们将使用上面显示的样本数据集作为示例。你可以点击下载样本数据集<a class="ae ku" href="https://beta.bls.gov/dataQuery/find?fq=survey:[ap]&amp;s=popularity:D" rel="noopener ugc nofollow" target="_blank">。让我们首先将原始CSV文件读入Pandas数据帧，并对数据做一些轻微的处理:</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mh mi l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mj"><img src="../Images/294ed6ad701c22d15f13dc4582e28f17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*39FNtIXcGm5oZ6Hn3LkKgQ.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h2 id="aee2" class="mk ml it bd mm mn mo dn mp mq mr dp ms le mt mu mv li mw mx my lm mz na nb nc bi translated">从长到宽重塑:</h2><p id="31a4" class="pw-post-body-paragraph kv kw it kx b ky nd ju la lb ne jx ld le nf lg lh li ng lk ll lm nh lo lp lq im bi translated">如前一节所述，该数据帧具有长格式。为了将Pandas中的数据帧由长变宽，我们可以使用Pandas的<code class="fe lr ls lt lu b">pd.pivot()</code>方法。</p><pre class="kj kk kl km gt ni lu nj nk aw nl bi"><span id="c1d8" class="mk ml it lu b gy nm nn l no np"><strong class="lu iu">pd.pivot(df, index=, columns=, values=)</strong></span></pre><p id="9016" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><code class="fe lr ls lt lu b">columns</code>:用于制作新框架列的列(如“年/月”)。</p><p id="0a82" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><code class="fe lr ls lt lu b">values</code>:用于填充新帧值的列(如Avg。价格($))。</p><p id="425e" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><code class="fe lr ls lt lu b">index</code>:用于制作新框架索引的列(如“系列ID”和“项目”)。如果没有，则使用现有索引。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mh mi l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nq"><img src="../Images/7a7f1b2fcbe427cf295f538807033502.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eOrVgjvWKrzufDNWm0lQLw.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h2 id="a740" class="mk ml it bd mm mn mo dn mp mq mr dp ms le mt mu mv li mw mx my lm mz na nb nc bi translated">从宽到长重塑:</h2><p id="b2b6" class="pw-post-body-paragraph kv kw it kx b ky nd ju la lb ne jx ld le nf lg lh li ng lk ll lm nh lo lp lq im bi translated">现在，我们如何将宽格式数据转换回长格式呢？为了将一个数据帧由宽变长，我们可以使用Pandas的<code class="fe lr ls lt lu b">pd.melt()</code>方法。</p><pre class="kj kk kl km gt ni lu nj nk aw nl bi"><span id="cbe4" class="mk ml it lu b gy nm nn l no np"><strong class="lu iu">pd.melt(df, id_vars=, value_vars=, var_name=, value_name=, ignore_index=)</strong></span></pre><p id="f6d8" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><code class="fe lr ls lt lu b">id_vars</code>:用作标识符变量的列</p><p id="27bf" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><code class="fe lr ls lt lu b">value_vars</code>:要取消透视的列。在我们的示例中，它将是年/月列的列表(“2020年1月”、“2020年2月”、“2020年3月”等)。)</p><p id="ae21" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><code class="fe lr ls lt lu b">var_name</code>:用于“变量”列的名称</p><p id="c95d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><code class="fe lr ls lt lu b">value_name</code>:用于“值”列的名称</p><p id="13ce" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><code class="fe lr ls lt lu b">ignore_index</code>:如果为‘真’，则忽略原始索引。如果为“False”，则保留原始索引</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mh mi l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nr"><img src="../Images/8c96c13d3749e9687751d2e281aa7455.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iJSi28IpxLXsIWAtM82s1Q.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="7dc7" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">总而言之，如果你需要将熊猫的数据帧从长变宽，使用<code class="fe lr ls lt lu b">pd.pivot()</code>。如果你需要将一个熊猫数据帧从宽变长，使用<code class="fe lr ls lt lu b">pd.melt()</code>。感谢阅读，希望这篇简短的<code class="fe lr ls lt lu b">pandas</code>教程对你有所帮助！</p><h2 id="b59e" class="mk ml it bd mm mn mo dn mp mq mr dp ms le mt mu mv li mw mx my lm mz na nb nc bi translated">数据源:</h2><p id="0d1d" class="pw-post-body-paragraph kv kw it kx b ky nd ju la lb ne jx ld le nf lg lh li ng lk ll lm nh lo lp lq im bi translated">美国劳工统计局:<strong class="kx iu"> </strong> <a class="ae ku" href="https://beta.bls.gov/dataQuery/find?fq=survey:[ap]&amp;s=popularity:D" rel="noopener ugc nofollow" target="_blank">调查:消费者价格指数——平均价格数据</a>(<a class="ae ku" href="https://www.bls.gov/data/" rel="noopener ugc nofollow" target="_blank">https://www.bls.gov/data/</a>)。这是一个公共的、开放的数据集，可以使用BLS公共数据API进行检索。BLS公共数据API允许公众访问所有BLS项目的原始经济数据。不需要许可证。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><p id="90a8" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">你可以通过这个<a class="ae ku" href="https://medium.com/@insightsbees/membership" rel="noopener">推荐链接</a>注册Medium会员(每月5美元)来获得我的作品和Medium的其他内容。通过这个链接注册，我将收到你的会员费的一部分，不需要你额外付费。谢谢大家！</p></div></div>    
</body>
</html>