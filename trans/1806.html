<html>
<head>
<title>Crosstab Or Pivot Table (In Pandas) Deciding When to Use Which</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">交叉表或数据透视表(在Pandas中)决定何时使用哪个</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/crosstab-or-pivot-table-in-pandas-deciding-when-to-use-which-a8ee3a9adfd0#2022-04-27">https://towardsdatascience.com/crosstab-or-pivot-table-in-pandas-deciding-when-to-use-which-a8ee3a9adfd0#2022-04-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e95d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">交叉制表和数据透视表之间的选择可能会令人困惑</h2></div><h1 id="4e6e" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">概观</h1><p id="d811" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">熊猫的许多特征可以产生类似的结果。对于初学者和有经验的用户来说，这种明显的模糊性可能会令人困惑和沮丧。本文对<code class="fe lw lx ly lz b">pd.crosstab</code>和<code class="fe lw lx ly lz b">pd.pivot_table</code>进行了比较，以帮助您了解两者的不同表现。</p><p id="fe03" class="pw-post-body-paragraph la lb it lc b ld ma ju lf lg mb jx li lj mc ll lm ln md lp lq lr me lt lu lv im bi translated">在这个演示中，我将引用一个个人数据源:我在LinkedIn上的发帖活动。这篇相关文章展示了如何自己查找和访问这些数据。</p><div class="mf mg gp gr mh mi"><a rel="noopener follow" target="_blank" href="/linkedin-the-best-example-data-source-you-never-knew-737d624f24b7"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd iu gy z fp mn fr fs mo fu fw is bi translated">LinkedIn:你从来不知道的最好的示例数据源</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">使用本指南了解和浏览LinkedIn允许您从个人资料中下载的数据</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">towardsdatascience.com</p></div></div><div class="mr l"><div class="ms l mt mu mv mr mw mx mi"/></div></div></a></div><h1 id="deb1" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">数据</h1><p id="c272" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果您是来寻求热图建议的:请浏览文章末尾的代码摘录，它可以生成如下所示的最佳热图。</p><p id="4d28" class="pw-post-body-paragraph la lb it lc b ld ma ju lf lg mb jx li lj mc ll lm ln md lp lq lr me lt lu lv im bi translated">以下是我的<code class="fe lw lx ly lz b">shares.csv</code>文件<a class="ae my" href="https://www.linkedin.com/psettings/member-data" rel="noopener ugc nofollow" target="_blank">中的前五条记录，你可以从LinkedIn </a>下载。</p><figure class="na nb nc nd gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi mz"><img src="../Images/a5979d83781eb52886e3b2ec5ccbc9cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9sKZJnBDKw6b4j4o0yl7Ig.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">图片鸣谢:作者资料节选。显示了我在LinkedIn上的前五篇文章，在文章中有进一步的描述。</p></figure><p id="a094" class="pw-post-body-paragraph la lb it lc b ld ma ju lf lg mb jx li lj mc ll lm ln md lp lq lr me lt lu lv im bi translated">我在2010年(或者更早)开始了在LinkedIn上的生活。我的第一篇文章是“工作时吹口哨”。让它发生！”我不知道我在想什么。另外，显然我对Audible.com有着长久的兴趣。</p><p id="14b4" class="pw-post-body-paragraph la lb it lc b ld ma ju lf lg mb jx li lj mc ll lm ln md lp lq lr me lt lu lv im bi translated">根据这些信息，我将准备一个新的数据框，让我按年、月、日、周和小时来统计帖子。</p><pre class="na nb nc nd gt no lz np nq aw nr bi"><span id="70f9" class="ns kj it lz b gy nt nu l nv nw"># Prepare An Empty Year Of Data To Avoid Index Errors<br/>next_year = int(str(date.today())[:4]) + 1<br/>next_year = pd.date_range(start=f'1/1/{next_year}', <br/>                          end=f'12/31/{next_year}')<br/>next_year = pd.DataFrame({'Count':[0] * len(next_year)}, <br/>                         index=next_year)</span><span id="69e9" class="ns kj it lz b gy nx nu l nv nw"># Extract The Columns Of Interest From Shares DataFrame<br/>shares_viz = pd.DataFrame(shares.index)<br/>shares_viz['Count'] = 1<br/>shares_viz = shares_viz.set_index('Date')</span><span id="1063" class="ns kj it lz b gy nx nu l nv nw"># Concatenate Shares With The Empty Year<br/>shares_viz = pd.concat([shares_viz, next_year])</span><span id="5e67" class="ns kj it lz b gy nx nu l nv nw">shares_viz['Year'] = pd.DatetimeIndex(shares_viz.index).year<br/>shares_viz['Month'] = pd.DatetimeIndex(shares_viz.index).month<br/>shares_viz['DOfMonth'] = pd.DatetimeIndex(shares_viz.index).day<br/>shares_viz['DOfWeek'] = pd.DatetimeIndex(shares_viz.index).dayofweek<br/>svshares_viz['HourOfDay'] = pd.DatetimeIndex(shares_viz.index).hour</span></pre><p id="2f61" class="pw-post-body-paragraph la lb it lc b ld ma ju lf lg mb jx li lj mc ll lm ln md lp lq lr me lt lu lv im bi translated">完成后，新数据将类似于:</p><figure class="na nb nc nd gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ny"><img src="../Images/b4d4c8fba9f1e937e25b3c064ece3796.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RmicXgmUg9oGwsQ37zKrfg.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">图片鸣谢:作者资料节选。显示我的前五条记录，在文章中有进一步的描述。</p></figure><h1 id="499e" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">熊猫杂交列表</h1><p id="e573" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">根据文档<code class="fe lw lx ly lz b">pd.crosstab()</code>将“计算两个(或更多)因素的简单交叉列表”以上述数据为例，我们可以使用<code class="fe lw lx ly lz b">pd.crosstab(shares_viz['Year'], shares_viz['Month'])</code>快速总结历年来每月的发布模式:</p><figure class="na nb nc nd gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nz"><img src="../Images/a6dd2fbad932b69fde4a7f717c099229.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*90SQ6uUXmo3NAHvtzJYiAA.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">图片鸣谢:作者资料节选。显示文章中描述的交叉列表。</p></figure><p id="74f8" class="pw-post-body-paragraph la lb it lc b ld ma ju lf lg mb jx li lj mc ll lm ln md lp lq lr me lt lu lv im bi translated">要解释上面的(摘录)输出，请查看标记为2020的行。2020年1月，我在LinkedIn上发了39次帖子。然而在2020年6月的晚些时候，我根本没有发帖。</p><h1 id="c409" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">熊猫旋转餐桌</h1><p id="9511" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">数据透视表产生类似的结果，但不完全相同。<code class="fe lw lx ly lz b">pd.pivot_table()</code>的文档解释说它将“创建一个电子表格风格的数据透视表作为数据框架”使用<code class="fe lw lx ly lz b">pd.pivot_table(shares_viz, values='Count', index='Year', columns='Month' aggfunc='sum')</code>,我们看到以下版本:</p><figure class="na nb nc nd gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi oa"><img src="../Images/c811eac1d6075d8bea6ca0f904c65eb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yx_v0Cr4Hu2F6EcHHFpcAQ.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">图片鸣谢:作者资料节选。显示文章中描述的数据透视表。</p></figure><p id="0a8c" class="pw-post-body-paragraph la lb it lc b ld ma ju lf lg mb jx li lj mc ll lm ln md lp lq lr me lt lu lv im bi translated">结果<em class="ob">与</em>相似。例如，在2020年，我们再次看到2020年1月有39个帖子，2020年6月没有。</p><p id="8ba4" class="pw-post-body-paragraph la lb it lc b ld ma ju lf lg mb jx li lj mc ll lm ln md lp lq lr me lt lu lv im bi translated">您还可以在两个表格中看到，2022年5月或5月之后没有帖子，本文的数据贯穿于2022年4月。</p><h1 id="f7d0" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">差异</h1><p id="8c8e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">注意<code class="fe lw lx ly lz b">pd.crosstab()</code>如何返回没有计数的<code class="fe lw lx ly lz b">0</code>，而<code class="fe lw lx ly lz b">pd.pivot_table()</code>如何返回没有计数的<code class="fe lw lx ly lz b">NaN</code>。</p><p id="7699" class="pw-post-body-paragraph la lb it lc b ld ma ju lf lg mb jx li lj mc ll lm ln md lp lq lr me lt lu lv im bi translated">一些调整可以使输出更加匹配。例如，通过添加<code class="fe lw lx ly lz b">fillna(0)</code>对<code class="fe lw lx ly lz b">pd.pivot_table()</code>的简单修改将会用<code class="fe lw lx ly lz b">0</code>替换那些<code class="fe lw lx ly lz b">NaN</code>值。</p><h1 id="57c4" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">为什么这很重要</h1><p id="3e39" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这在很多情况下都很重要。例如，考虑数据可视化。<code class="fe lw lx ly lz b">pd.crosstab()</code>和<code class="fe lw lx ly lz b">pd.pivot_table()</code>的一个常见用例是将输出传递给<code class="fe lw lx ly lz b">sns.heatmap()</code>。</p><p id="5925" class="pw-post-body-paragraph la lb it lc b ld ma ju lf lg mb jx li lj mc ll lm ln md lp lq lr me lt lu lv im bi translated">一个常见的热图用例是将月份放在行中，将月份中的日期放在列中。这样的热图概括了一年中的日常活动。在下图中，每个单元格(或方块)计算该行当月相应日期(列)的帖子数。</p><h2 id="d81e" class="ns kj it bd kk oc od dn ko oe of dp ks lj og oh ku ln oi oj kw lr ok ol ky om bi translated">交叉列表热图</h2><figure class="na nb nc nd gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi on"><img src="../Images/00fd0e6a08906683e7684a1a61498726.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TOJ2LX7uiiA-B24IY8ui2A.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">作者的形象化。显示文章中描述的热图。</p></figure><p id="7fa1" class="pw-post-body-paragraph la lb it lc b ld ma ju lf lg mb jx li lj mc ll lm ln md lp lq lr me lt lu lv im bi translated">在上面的许多问题中，这里是其中的一个:注意2月29日、30日和31日有零，4月、6月、9月和11月31日也有零。那些日子是不存在的。难道我们不应该把它们渲染成某种形式的空的吗？</p><h2 id="e979" class="ns kj it bd kk oc od dn ko oe of dp ks lj og oh ku ln oi oj kw lr ok ol ky om bi translated">数据透视表热图</h2><figure class="na nb nc nd gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi on"><img src="../Images/b4de62af4e6c76cd2c72620b9e1eaa3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oDKxigjjEgMkA1V7JEWdNw.png"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">作者的形象化。显示文章中描述的热图。</p></figure><p id="8d27" class="pw-post-body-paragraph la lb it lc b ld ma ju lf lg mb jx li lj mc ll lm ln md lp lq lr me lt lu lv im bi translated">首先注意不存在的日子与此输出有何不同。在这里，数据透视表输出似乎以一种更有助于数据可视化的方式执行。</p><p id="ed6a" class="pw-post-body-paragraph la lb it lc b ld ma ju lf lg mb jx li lj mc ll lm ln md lp lq lr me lt lu lv im bi translated">数据透视表优于交叉制表还有另一个重要原因(在这种特定情况下)。为了避免数据可视化和分析过程中的索引错误，上面的代码添加了一个“空”年份。上图交叉列表中，空的一年错误地将“计数”增加了一。</p><h1 id="df85" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">结论</h1><p id="0399" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在数据分析中，通常有许多方法来完成相同的任务。Pandas是众多工具中的一个，它提供了多种方法和技术，可以产生相似但不完全相同的结果。</p><p id="a58b" class="pw-post-body-paragraph la lb it lc b ld ma ju lf lg mb jx li lj mc ll lm ln md lp lq lr me lt lu lv im bi translated">本文展示了<code class="fe lw lx ly lz b">pd.crosstab()</code>和<code class="fe lw lx ly lz b">pd.pivot_table()</code>如何执行相似的功能——有时会产生相似的输出。输出结果可能非常相似，如果不仔细检查，分析师可能会无意中误报结果。</p><p id="b7d6" class="pw-post-body-paragraph la lb it lc b ld ma ju lf lg mb jx li lj mc ll lm ln md lp lq lr me lt lu lv im bi translated">在上面给出的用例中，<code class="fe lw lx ly lz b">pd.pivot_table()</code>是产生期望结果的最好和最快的选项。<code class="fe lw lx ly lz b">pd.crosstab()</code>也是一种选择吗？是的，<code class="fe lw lx ly lz b">pd.crosstab()</code>也是一个选择——但这需要额外的工作来确保输出完全符合预期。</p><p id="dfdb" class="pw-post-body-paragraph la lb it lc b ld ma ju lf lg mb jx li lj mc ll lm ln md lp lq lr me lt lu lv im bi translated">这个故事的寓意是:一遍又一遍地检查你的代码和结果。</p><h1 id="8337" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">感谢阅读</h1><p id="046b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">你准备好了解更多关于数据科学职业的信息了吗？我进行一对一的职业辅导，并有一份每周电子邮件列表，帮助专业求职者获取数据。联系我了解更多信息。</p><p id="dd98" class="pw-post-body-paragraph la lb it lc b ld ma ju lf lg mb jx li lj mc ll lm ln md lp lq lr me lt lu lv im bi translated">感谢阅读。把你的想法和主意发给我。你可以写信只是为了说声嗨。如果你真的需要告诉我是怎么错的，我期待着尽快和你聊天。推特:<a class="ae my" href="https://twitter.com/adamrossnelson" rel="noopener ugc nofollow" target="_blank">@ adamrossnelson</a>LinkedIn:<a class="ae my" href="https://www.linkedin.com/in/arnelson/" rel="noopener ugc nofollow" target="_blank">亚当罗斯尼尔森</a>。</p><h1 id="e092" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">热图代码</h1><pre class="na nb nc nd gt no lz np nq aw nr bi"><span id="2fcb" class="ns kj it lz b gy nt nu l nv nw">import pandas as pd<br/>import seaborn as sns<br/>import matplotlib.pyplot as plt<br/>from datetime import date</span><span id="325b" class="ns kj it lz b gy nx nu l nv nw">shares = pd.read_csv('shares.csv').set_index(['Date']).sort_index()</span><span id="c05e" class="ns kj it lz b gy nx nu l nv nw"># Prepare An Empty Year Of Data To Avoid Index Errors<br/>next_year = int(str(date.today())[:4]) + 1<br/>next_year = pd.date_range(start=f'1/1/{next_year}', <br/>                          end=f'12/31/{next_year}')<br/>next_year = pd.DataFrame({'Count':[0] * len(next_year)}, <br/>                         index=next_year)</span><span id="84f4" class="ns kj it lz b gy nx nu l nv nw"># Extract The Columns Of Interest From Shares DataFrame<br/>shares_viz = pd.DataFrame(shares.index)<br/>shares_viz['Count'] = 1<br/>shares_viz = shares_viz.set_index('Date')</span><span id="0d82" class="ns kj it lz b gy nx nu l nv nw"># Concatenate Shares With The Empty Year<br/>shares_viz = pd.concat([shares_viz, next_year])</span><span id="283c" class="ns kj it lz b gy nx nu l nv nw">shares_viz['Year'] = pd.DatetimeIndex(shares_viz.index).year<br/>shares_viz['Month'] = pd.DatetimeIndex(shares_viz.index).month<br/>shares_viz['DOfMonth'] = pd.DatetimeIndex(shares_viz.index).day<br/>shares_viz['DOfWeek'] = pd.DatetimeIndex(shares_viz.index).dayofweek<br/>shares_viz['HourOfDay'] = pd.DatetimeIndex(shares_viz.index).hour</span><span id="55b7" class="ns kj it lz b gy nx nu l nv nw"># Month &amp; Day Posting Patterns<br/>plt.figure(figsize = (12,4))<br/>sns.heatmap(pd.pivot_table(shares_viz, <br/>                           values='Count', <br/>                           index='Month', <br/>                           columns='DayOfMonth',<br/>                           aggfunc='sum'),<br/>            cmap=my_blues,<br/>            annot=True)<br/>plt.suptitle(f'Daily Monthly Activity Since {shares_viz["Year"].min()}', <br/>             horizontalalignment='right')<br/>plt.title(f'{total_posts} Posts Over {shares_viz["Year"].max() - shares_viz["Year"].min()} Years',<br/>          horizontalalignment='right')</span></pre></div></div>    
</body>
</html>