<html>
<head>
<title>How To Transcribe Streams of Audio Data in Real-Time with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Python 实时转录音频数据流</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-transcribe-streams-of-audio-data-in-real-time-with-python-and-assemblyai-322da8b5b7c9#2022-02-28">https://towardsdatascience.com/how-to-transcribe-streams-of-audio-data-in-real-time-with-python-and-assemblyai-322da8b5b7c9#2022-02-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="514e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个开启全新应用世界的功能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5cfe76bfcd3b5fe5ebcfac5734f927a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ms7ZEExed87CnEvS"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@soundtrap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Soundtrap </a>拍摄的照片</p></figure><p id="f1e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我以前的博客文章中，我使用了 AssemblyAI 语音转文本 API。</p><p id="16c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我尝试了它的核心<a class="ae ky" rel="noopener" target="_blank" href="/how-to-transcribe-and-analyze-audio-files-with-python-and-assemblyai-22660dbf8e66">转录</a>服务，并玩了一些很酷的人工智能功能:发现敏感话题的<a class="ae ky" rel="noopener" target="_blank" href="/how-to-moderate-audio-data-using-python-and-assemblyai-a5eab9910730">内容审核</a>功能和提取每个音频片段中谈论的主题的<a class="ae ky" rel="noopener" target="_blank" href="/how-to-build-a-streamlit-app-to-extract-topics-from-youtube-videos-9c7aebbfab8e">话题检测</a>功能。(我构建了一个 Streamlit 应用程序来展示最后一个功能如何应用于分析 Youtube 视频。你可以在这里查看<a class="ae ky" href="https://share.streamlit.io/ahmedbesbes/assemblyai/main/app.py" rel="noopener ugc nofollow" target="_blank">。该代码也可在</a><a class="ae ky" href="https://github.com/ahmedbesbes/assemblyai" rel="noopener ugc nofollow" target="_blank"> Github </a>上获得。)</p><p id="0cbc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些实验都是离线执行的，需要一些时间来生成输出。事实上，一旦您将音频文件发送到 AssemblyAI，转录作业就会提交到一个队列，一旦队列完成处理，您就可以检索转录本。就像那样，你必须等待。</p><p id="6a11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果你能在 AssemblyAI 摄取你的音频数据<strong class="lb iu">的同时转录它，会怎么样呢？</strong></p><p id="e0dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我们所说的<strong class="lb iu">实时转录。</strong></p><blockquote class="lv lw lx"><p id="d7cb" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">T <strong class="lb iu"> <em class="it">他的帖子将带你了解使用 AssemblyAI 进行实时转录的过程。我们将首先用正确的依赖项设置环境，然后我们将在 Python 中创建异步函数来与 AssemblyAI 的 WebSocket 服务器通信。</em> </strong></p></blockquote><p id="faae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好的，让我们看看👀</p><h1 id="dc02" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">👉设置您的帐户</h1><p id="0e77" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">实时转录是一项付费功能。为了能够使用它，你必须在 AssemblyAI 上创建一个账户并输入你的信用卡信息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/433a85d0ab5375366b4f872ddc8a7506.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kDRmGntqUPa1JY5C.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><p id="17ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里了解更多关于定价的信息。</p><p id="1f77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你的帐户配置完毕，拿起你的 API 密匙，进入下一部分。</p><h1 id="73da" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">👉安装一些依赖项</h1><p id="9591" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">因为我们要进行实时转录，所以我们需要从麦克风捕捉现场音频流，并立即将它们传递给 API。</p><p id="c46b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要安装 PortAudio，这是一个跨平台、开源的音频 I/O 库，它为录制和/或播放声音提供了一个非常简单的 API。</p><p id="26a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你在 Mac OS 上，你可以使用<a class="ae ky" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">家酿</a>软件包管理器来安装它</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="b8e6" class="nf md it nb b gy ng nh l ni nj"><strong class="nb iu">brew install portaudio</strong></span></pre><p id="74a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你使用的是不同的操作系统，你可能需要检查这个<a class="ae ky" href="http://files.portaudio.com/download.html" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><p id="a73c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您需要安装为 PortAudio 提供绑定的<a class="ae ky" href="http://people.csail.mit.edu/hubert/pyaudio/" rel="noopener ugc nofollow" target="_blank"> PyAudio </a> Python 库。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="0f85" class="nf md it nb b gy ng nh l ni nj"><strong class="nb iu">pip install pyaudio</strong></span></pre><p id="7963" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，您需要安装允许构建 websockets 服务器和客户端的 web sockets 库:这将帮助我们将音频流式传输到 AssemblyAI 并捕获实时转录。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="6cfd" class="nf md it nb b gy ng nh l ni nj"><strong class="nb iu">pip install websockets</strong></span></pre><h1 id="5c37" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">👉用 PyAudio 打开音频流</h1><p id="e387" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了能够将音频流式传输到 AssemblyAI，我们首先需要用 PyAudio 打开一个音频流。</p><p id="5b3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建流需要一些参数:</p><ul class=""><li id="c3ed" class="nk nl it lb b lc ld lf lg li nm lm nn lq no lu np nq nr ns bi translated">每个缓冲区的帧数<strong class="lb iu"> (3200) </strong>。缓冲区是任意数量的帧的块，用于将原始信号分成更小的片段。</li><li id="478c" class="nk nl it lb b lc nt lf nu li nv lm nw lq nx lu np nq nr ns bi translated">音频格式:<strong class="lb iu"> (16 位)。</strong>这代表每个样本的大小，即每个帧的大小。2 字节= 16 位，因此这大致说明了每个样本是如何编码的。</li><li id="8bd9" class="nk nl it lb b lc nt lf nu li nv lm nw lq nx lu np nq nr ns bi translated">通道数:<strong class="lb iu"> (1)。</strong>这是指要使用的音频流的数量。例如，现代计算机使用两个声道进行立体声输出:一个用于左扬声器，一个用于右扬声器。</li><li id="b6a7" class="nk nl it lb b lc nt lf nu li nv lm nw lq nx lu np nq nr ns bi translated">采样率:<strong class="lb iu"> (16000) </strong>。这是每秒钟(或每单位时间)从连续信号中提取的帧数，以形成离散信号。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="76d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦流打开，它就能够捕获我们从麦克风记录的音频数据。</p><p id="e41c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们需要将这个流连接到 AssemblyAI 的实时转录。服务。</p><p id="b192" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们将打开一个 WebSocket 连接，以便能够同时发送和接收数据。我们需要这种特定类型的网络连接，因为这是 AssemblyAI 使用的。</p><p id="ac8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">两个函数将使用开放的 WebSocket 连接。</p><ul class=""><li id="118a" class="nk nl it lb b lc ld lf lg li nm lm nn lq no lu np nq nr ns bi translated">第一个函数以我们在创建 PyAudio 流时定义的速率发送输入音频数据。然后，它将数据转换为 base64，将其解码为字符串格式，并将其发送到 AssebmlyAI WebSocket 端点。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><ul class=""><li id="ad4b" class="nk nl it lb b lc ld lf lg li nm lm nn lq no lu np nq nr ns bi translated">第二个函数不断地从 AssemblyAI 获取转录，并将其打印到屏幕上。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="e412" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ly"> — PS:如果你想知道</em> <code class="fe oa ob oc nb b"><em class="ly">_ws</em></code> <em class="ly">是什么，可以在最后查看完整的剧本。</em></p><p id="d94f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两个功能同时运行。</p><p id="70ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了等待它们执行，包装函数使用了<code class="fe oa ob oc nb b">asyncio.gather</code>函数。</p><p id="53af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是包装函数的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="8bed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，为了让这个包装器函数异步运行，我们需要调用以下命令:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="ccde" class="nf md it nb b gy ng nh l ni nj"><strong class="nb iu">asyncio.run(send_receive())</strong></span></pre><h1 id="8ae1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">👉完整脚本</h1><p id="e2b2" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">总结一切，这是完整的脚本。注意，我已经使用 python-dotenv(像在以前的文章中一样)来读取 API 密钥。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><h1 id="1ac4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">👉演示！</h1><p id="302d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这是实时转录的录音演示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od nz l"/></div></figure><h1 id="8e13" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">👉参考资料:</h1><ul class=""><li id="506e" class="nk nl it lb b lc mu lf mv li oe lm of lq og lu np nq nr ns bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/how-to-transcribe-and-analyze-audio-files-with-python-and-assemblyai-22660dbf8e66">https://towards data science . com/how-to-transcripte-and-analyze-audio-files-with-python-and-assembly ai-22660 dbf8e 66</a></li><li id="5216" class="nk nl it lb b lc nt lf nu li nv lm nw lq nx lu np nq nr ns bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/how-to-moderate-audio-data-using-python-and-assemblyai-a5eab9910730">https://towards data science . com/how-to-moderate-audio-data-using-python-and-assembly ai-a5eab 9910730</a></li><li id="c0fb" class="nk nl it lb b lc nt lf nu li nv lm nw lq nx lu np nq nr ns bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/how-to-build-a-streamlit-app-to-extract-topics-from-youtube-videos-9c7aebbfab8e">https://towards data science . com/how-to-build-a-streamlit-app-to-extract-topics-from-YouTube-videos-9c 7 aebbfab 8 e</a></li><li id="ad18" class="nk nl it lb b lc nt lf nu li nv lm nw lq nx lu np nq nr ns bi translated"><a class="ae ky" href="https://websockets.readthedocs.io/en/stable/intro/tutorial1.html" rel="noopener ugc nofollow" target="_blank">https://web sockets . readthedocs . io/en/stable/intro/tutorial 1 . html</a></li><li id="fdcb" class="nk nl it lb b lc nt lf nu li nv lm nw lq nx lu np nq nr ns bi translated"><a class="ae ky" href="https://www.assemblyai.com/" rel="noopener ugc nofollow" target="_blank">https://www.assemblyai.com/</a></li><li id="3156" class="nk nl it lb b lc nt lf nu li nv lm nw lq nx lu np nq nr ns bi translated"><a class="ae ky" href="https://docs.assemblyai.com/walkthroughs#realtime-streaming-transcription" rel="noopener ugc nofollow" target="_blank">https://docs . assembly ai . com/walk throughs # real time-streaming-transcription</a></li></ul><h1 id="7b0e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">感谢阅读🙏</h1><p id="14ff" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这标志着 AssemblyAI 博客系列的结束。我希望它给了你一个很好的 API 和人工智能特性的概述，有助于理解脚本。</p><p id="b502" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有兴趣了解更多关于这个 API 的知识，你可以查看我以前的帖子和官方文档，或者使用我制作的 Streamlit 应用程序。</p><p id="8021" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天就这些了。以后的帖子再见！👋</p></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><h1 id="415d" class="mc md it bd me mf oo mh mi mj op ml mm jz oq ka mo kc or kd mq kf os kg ms mt bi translated">新到中？您可以每月订阅 5 美元，并解锁各种主题的无限文章(技术、设计、创业……)您可以通过点击我的推荐<a class="ae ky" href="https://ahmedbesbes.medium.com/membership" rel="noopener">链接</a>支持我</h1><div class="ot ou gp gr ov ow"><a href="https://ahmedbesbes.medium.com/membership" rel="noopener follow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd iu gy z fp pb fr fs pc fu fw is bi translated">加入我的介绍链接媒体-艾哈迈德贝斯</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">ahmedbesbes.medium.com</p></div></div><div class="pf l"><div class="pg l ph pi pj pf pk ks ow"/></div></div></a></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/5e27dfdecce7676bcb5605146b0012f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pkqmoE5OAVIHG42o"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Joshua Fernandez 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div></div>    
</body>
</html>