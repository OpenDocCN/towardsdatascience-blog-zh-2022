<html>
<head>
<title>Introducing Pandarallel: Never Use The Apply Method In Pandas Again</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">介绍Pandarallel:再也不要在熊猫身上使用Apply方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introducing-pandarallel-never-use-the-apply-method-in-pandas-again-7f3ff74fbe8e#2022-10-26">https://towardsdatascience.com/introducing-pandarallel-never-use-the-apply-method-in-pandas-again-7f3ff74fbe8e#2022-10-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1f91" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">为什么我在Pandas中停止使用Apply()，为什么你也应该这样做。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/991412cb73e6d69e3126887eba126de9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bR4akeZyYmtpC98C"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@alain_pham?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Alain Pham </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="86da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Pandas库具有直观、优雅、初学者友好的API，是Python中最好的表格数据处理库之一。</p><p id="f5a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如今，几乎所有处理表格数据集的数据科学家都求助于熊猫来完成各种数据科学任务。</p><p id="35b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然API提供了圆滑的设计和广泛的功能，但是有许多限制使得Pandas在一些数据驱动的情况下不适用(或者效率低)。</p><p id="3b04" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我在下面的博客中谈到了五个令人担忧的局限性:</p><div class="ls lt gp gr lu lv"><a rel="noopener follow" target="_blank" href="/5-things-i-wish-the-pandas-library-could-do-e9017c127779"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">我希望熊猫图书馆能做的5件事</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">讨论熊猫的五个微妙局限</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">towardsdatascience.com</p></div></div><div class="me l"><div class="mf l mg mh mi me mj kp lv"/></div></div></a></div><p id="bacf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">综上所述，<strong class="ky ir">Pandas几乎所有的限制都源于其单核计算框架</strong>。</p><p id="fd11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">换句话说，即使您的CPU有多个可用(或空闲)的内核，Pandas也总是依赖于单个内核，这抑制了它的性能。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mk"><img src="../Images/9c8f9e2dc3d8aa7fc82067281fc55a78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pUBad1tjb8EQoG9fYyTeaA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">熊猫的单核计算框架(图片由作者提供)</p></figure><p id="fe09" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有人可能想知道我们什么时候能在熊猫身上看到这些更新。但老实说，我们没有任何线索，因为没有任何来自熊猫的官方更新。</p><p id="8965" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">目前，严酷的现实是大多数用户照原样使用熊猫，即效率低下。</p><p id="7e97" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">令人欣慰的是，在过去几年中，熊猫以外的许多开发者已经开始着手这个问题。</p><p id="a94e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们今天有一些工具可供我们使用，让我们利用熊猫的多核，使它更有效。</p><p id="3a8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将在这篇文章中讨论的一个工具就是<strong class="ky ir">panda parallel</strong>！</p><p id="eeb6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们开始吧🚀！</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="3b32" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">介绍Pandarallel(熊猫+水货)</h1><p id="24ea" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated"><a class="ae kv" href="https://nalepae.github.io/pandarallel/" rel="noopener ugc nofollow" target="_blank"> Pandarallel </a>是一个开源的python库，允许你将Pandas的操作并行化到所有可用的CPU内核上。这可以通过修改一行代码来实现。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/78191932f5ee181890b48aa62bd9f77f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tH5rir9hNgZKQdDg3jeGNw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Pandarallel的多核计算框架(图片由作者提供)</p></figure><p id="3320" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，<code class="fe nq nr ns nt b">pandarallel</code>还提供了很酷的进度条(就像我们用<a class="ae kv" href="https://github.com/tqdm/tqdm" rel="noopener ugc nofollow" target="_blank"> tqdm </a>得到的一样)来估计剩余的计算量。</p><p id="f9b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">目前支持的方法有<code class="fe nq nr ns nt b">apply()</code>、<code class="fe nq nr ns nt b">applymap()</code>、<code class="fe nq nr ns nt b">groupby()</code>、<code class="fe nq nr ns nt b">map()</code>和<code class="fe nq nr ns nt b">rolling()</code>。</p><h2 id="6210" class="nu mt iq bd mu nv nw dn my nx ny dp nc lf nz oa ne lj ob oc ng ln od oe ni of bi translated">安装Pandarallel</h2><p id="b177" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">您可以使用以下命令通过<code class="fe nq nr ns nt b">pip</code>安装Pandarallel:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="d2cd" class="nu mt iq bd mu nv nw dn my nx ny dp nc lf nz oa ne lj ob oc ng ln od oe ni of bi translated">导入Pandarallel</h2><p id="852f" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">下一步是导入库并初始化它:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oh l"/></div></figure><p id="ac7e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如在输出中看到的，<code class="fe nq nr ns nt b">initialize()</code>设置了执行我们的作业的工人数量，在本例中是<code class="fe nq nr ns nt b">4</code>。</p><p id="8668" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这里阅读更多关于初始化<a class="ae kv" href="https://nalepae.github.io/pandarallel/user_guide/" rel="noopener ugc nofollow" target="_blank">的内容。</a></p><p id="d71c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，你还应该导入熊猫图书馆。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><h1 id="f996" class="ms mt iq bd mu mv oj mx my mz ok nb nc jw ol jx ne jz om ka ng kc on kd ni nj bi translated">熊猫到熊猫</h1><p id="0153" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">如上所述，从Pandas到Pandarallel的转换非常简单，只需要修改一行代码。</p><p id="0898" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其中一些如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/d2a466741d35e8d6a462be628cec000f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B4SJsj6XGuNN6PmI739Ijw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">熊猫行动到潘达拉尔(图片由作者提供)。更多阅读:<a class="ae kv" href="https://nalepae.github.io/pandarallel/" rel="noopener ugc nofollow" target="_blank">https://nalepae.github.io/pandarallel/</a></p></figure><p id="0168" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关键是把<code class="fe nq nr ns nt b">apply</code>换成<code class="fe nq nr ns nt b">parallel_apply</code>，把<code class="fe nq nr ns nt b">map</code>换成<code class="fe nq nr ns nt b">parallel_map</code>。</p><h1 id="53b7" class="ms mt iq bd mu mv oj mx my mz ok nb nc jw ol jx ne jz om ka ng kc on kd ni nj bi translated">实验</h1><p id="8595" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">接下来我们来对比一下熊猫的<code class="fe nq nr ns nt b">apply()</code>和Pandarallel的<code class="fe nq nr ns nt b">parallel_apply()</code>的表现。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi op"><img src="../Images/db8f169b42298add5adcd3f41918c789.png" data-original-src="https://miro.medium.com/v2/resize:fit:522/format:webp/1*j7mF0Vry_IQomoTB6GC2kg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Apply() vs Parallel_apply()(图片由作者提供)</p></figure><p id="a90f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于Pandarallel利用了所有可用的内核，理想情况下，我们应该期望后者的性能优于前者。</p><p id="0701" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看这是不是真的。</p><h2 id="190f" class="nu mt iq bd mu nv nw dn my nx ny dp nc lf nz oa ne lj ob oc ng ln od oe ni of bi translated">实验装置</h2><p id="27ae" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">在这个实验中，我创建了一个包含可变行和五列的虚拟数据帧。</p><p id="6cbe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更具体地说，我改变了从<code class="fe nq nr ns nt b">1 Million</code>到<code class="fe nq nr ns nt b">10 Million</code>的行数，并绘制了<code class="fe nq nr ns nt b">apply()</code>和<code class="fe nq nr ns nt b">parallel_apply()</code>的性能图。</p><p id="c784" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个实验中的函数定义如下，它返回一行的和:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oq oh l"/></div></figure><p id="6509" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了消除随机性，我用特定的行数<strong class="ky ir">重复了十次</strong>的实验。</p><p id="ae73" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个实验的代码如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="or oh l"/></div></figure><h2 id="21d4" class="nu mt iq bd mu nv nw dn my nx ny dp nc lf nz oa ne lj ob oc ng ln od oe ni of bi translated">结果</h2><p id="745e" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">接下来，我们来看结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/6aa7f004246b7fc4ebbdc7d53942f485.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CoAex7NigBvALydEYIOh0g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Apply() vs Parallel_apply()的实验结果(图片由作者提供)</p></figure><ul class=""><li id="539f" class="ot ou iq ky b kz la lc ld lf ov lj ow ln ox lr oy oz pa pb bi translated">蓝色线图描述了<code class="fe nq nr ns nt b">apply()</code>方法的运行时间，黄色线图代表了<code class="fe nq nr ns nt b">parallel_apply()</code>方法的运行时间。</li><li id="7ab4" class="ot ou iq ky b kz pc lc pd lf pe lj pf ln pg lr oy oz pa pb bi translated">我们将行数从100万改变到1000万，并注意到两种方法的运行时间与行数成正相关。</li><li id="5997" class="ot ou iq ky b kz pc lc pd lf pe lj pf ln pg lr oy oz pa pb bi translated">然而，<code class="fe nq nr ns nt b">parallel_apply()</code>方法在运行时间上比传统的<code class="fe nq nr ns nt b">apply()</code>方法有了显著的改进。</li><li id="73d5" class="ot ou iq ky b kz pc lc pd lf pe lj pf ln pg lr oy oz pa pb bi translated">随着行数的增加，两种方法的运行时间之间的差异也会增加。这表明您应该始终使用<code class="fe nq nr ns nt b">parallel_apply()</code>将函数应用于数据帧，尤其是在较大数据集的情况下。</li></ul></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="73d8" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">结论</h1><p id="a6bf" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">总之，在这篇文章中，我们在一组虚拟数据帧上比较了熊猫的<code class="fe nq nr ns nt b">apply()</code>和Pandarallel的<code class="fe nq nr ns nt b">parallel_apply()</code>方法的性能。</p><p id="efe0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">实验结果表明，就运行时间而言，使用<code class="fe nq nr ns nt b">parallel_apply()</code>方法比<code class="fe nq nr ns nt b">apply()</code>方法更有效——提供高达<strong class="ky ir"> 4到5 </strong>倍的性能提升。</p><p id="9752" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这里找到这篇文章的代码。</p><p id="b0ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读！</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><p id="2c07" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://avichawla.substack.com/" rel="noopener ugc nofollow" target="_blank">🚀<strong class="ky ir">订阅数据科学每日剂量。在这里，我分享关于数据科学的优雅技巧和诀窍，一天一个技巧。每天在你的收件箱里收到这些提示。</strong>T12】</a></p><p id="cabd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://subscribepage.io/450q" rel="noopener ugc nofollow" target="_blank"> 🧑‍💻<strong class="ky ir">成为数据科学专家！获取包含450多个熊猫、NumPy和SQL问题的免费数据科学掌握工具包。</strong> </a></p><p id="1e7e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">✉️ <a class="ae kv" href="https://medium.com/subscribe/@avi_chawla" rel="noopener"> <strong class="ky ir">注册我的电子邮件列表</strong> </a>不要错过另一篇关于数据科学指南、技巧和提示、机器学习、SQL、Python等的文章。Medium会将我的下一篇文章直接发送到你的收件箱。</p><p id="f907" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我喜欢探索、试验和撰写关于数据科学概念和工具的文章。你可以在<a class="ae kv" href="https://www.linkedin.com/in/avi-chawla/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上和我联系。</p></div></div>    
</body>
</html>