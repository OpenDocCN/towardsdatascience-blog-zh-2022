<html>
<head>
<title>Automate Your Mundane Excel Reporting with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python自动生成普通的Excel报表</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automate-your-mundane-excel-reporting-with-python-f3a29e6e3a0a#2022-05-20">https://towardsdatascience.com/automate-your-mundane-excel-reporting-with-python-f3a29e6e3a0a#2022-05-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0fd3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用Excel自动生成Excel报表</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ef01b57074bd1a538dc35a9ee9b85fe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*S7ugZ8moBlYRU3hO"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@campaign_creators?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">活动创作者</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="c94c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Excel功能强大，无处不在。但是也是重复的，手动的。当然，您可以使用像VBA这样的工具来自动化报告，但是使用像Python这样的通用语言允许您自动化报告过程的更广泛的方面(比如移动和用电子邮件发送文件)。</p><p id="1008" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章结束时，你将学会如何:</p><ol class=""><li id="9e31" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">如何将多个Excel文件合并成一个文件</li><li id="9db0" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">用熊猫数据透视表汇总Excel数据</li><li id="26f0" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在Excel报表中添加标题行</li><li id="910f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">使用Python将动态图表添加到Excel文件中</li><li id="8f56" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">用Python设计Excel文件的样式</li></ol><p id="0c0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们开始吧！</p><p id="12dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想把这个当视频教程看？查看我下面的完整视频教程:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><h1 id="cf5f" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">设置您的环境</h1><p id="7623" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">为了跟随本教程，我们将使用三个库:<code class="fe ni nj nk nl b">os</code>、<code class="fe ni nj nk nl b">pandas</code>和<code class="fe ni nj nk nl b">openpyxl</code>。其中的第一个<code class="fe ni nj nk nl b">os</code>与Python捆绑在一起，因此您不需要安装它。然而，另外两个需要使用<code class="fe ni nj nk nl b">pip</code>或<code class="fe ni nj nk nl b">conda</code>来安装。</p><p id="e7f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看如何在Python中安装这些库:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm mk l"/></div></figure><p id="13d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您的终端中使用上述任何一种方法都会安装所需的库。现在，让我们来看看您可以用来跟随本教程的数据。</p><p id="8b5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经安装了库，我们可以导入将要使用的库和类:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm mk l"/></div></figure><p id="b23e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以<a class="ae ky" href="https://github.com/datagy/mediumdata/raw/master/Excel%20Files.zip" rel="noopener ugc nofollow" target="_blank">在这里</a>下载文件。zip文件包含3个不同的Excel文件，每个文件包含不同月份的销售信息。虽然像这样存储数据是有意义的，但它会使分析数据变得相当困难。</p><p id="8ee0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">正因为如此，我们需要先把所有这些文件组合起来</strong>。这是您将在下一节学到的内容！</p><h1 id="fbe6" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">用Python组合多个Excel文件</h1><p id="2239" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">Pandas库将数据存储在DataFrame对象中，这可以被认为是一个Excel表(尽管这有点简化)。让我们来分解一下我们想要做什么，然后我们来看看如何使用Python来做这件事:</p><ol class=""><li id="8521" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">将我们所有的文件收集到一个Python列表中</li><li id="98a5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">循环遍历每个文件，并将其附加到熊猫数据帧中</li></ol><p id="4cea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们写一些代码，看看如何在Python中实现这一点！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm mk l"/></div></figure><p id="6f3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来分析一下我们在这里做了什么:</p><ol class=""><li id="04b8" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">在第1节中，我们首先加载保存文件的路径，并使用<code class="fe ni nj nk nl b">os.list()</code>函数获取该文件夹中包含的所有文件的列表</li><li id="fa97" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在第2节中，我们首先创建了一个空的数据帧，然后遍历每个文件，将它加载到一个数据帧中，并将其附加到我们的<code class="fe ni nj nk nl b">combined</code>数据帧中</li><li id="107c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">最后，我们将文件保存到它自己的Excel文件中</li></ol><p id="2b0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那很容易，不是吗？有许多不同的方法来完成这项任务，这就是Python的魅力所在！</p><p id="1bcf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们的数据已经加载完毕，让我们学习如何用熊猫来总结我们的数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/83d1f72d300311f6c4fcbfe6b1d1f059.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*88oDh_8voBnuHAT6"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@homajob?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">斯科特·格雷厄姆</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="fce4" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">用熊猫汇总Excel数据</h1><p id="596c" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">在本节中，您将学习如何使用Pandas创建一个汇总表！为此，我们将使用名副其实的熊猫<code class="fe ni nj nk nl b">.pivot_table()</code>函数。</p><p id="94f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该函数旨在熟悉Excel中的数据透视表。有了这个，我们就可以知道如何总结我们的数据。假设我们想计算出每个销售人员的总销售额。我们可以这样写:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm mk l"/></div></figure><p id="e6da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，我们使用Pandas <code class="fe ni nj nk nl b">.pivot_table()</code>函数创建了一个数据透视表。其中大部分应该感觉类似于Excel数据透视表。然而，默认情况下，Pandas将使用一个聚合函数<code class="fe ni nj nk nl b">'mean'</code>，所以我们需要将其设置为<code class="fe ni nj nk nl b">'sum'</code>。</p><h1 id="ed6c" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">使用OpenPyxl向Excel报表添加标题行</h1><p id="ef31" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">在本节中，您将学习如何向Excel报表添加描述性标题行，以使它们更易于打印。为此，我们将开始使用Openpyxl库。</p><p id="3db0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Openpyxl的工作原理是将工作簿加载到内存中。从那里，您可以访问其中的不同属性和对象，例如工作表和这些工作表中的单元格。</p><p id="9199" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的关键区别在于，您是直接使用<em class="no">工作簿。对于Pandas，我们只需将工作簿的<em class="no">保存到</em>。(我承认还有更多，但这是一个很好的思考方式。)</em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm mk l"/></div></figure><p id="459f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中:</p><ol class=""><li id="bba5" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">我们加载了一个工作簿对象<code class="fe ni nj nk nl b">wb</code>。从那里，我们访问工作表。</li><li id="a371" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">我们能够通过使用<code class="fe ni nj nk nl b">.insert_rows()</code>方法插入三行来操作工作表。</li><li id="721f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">这些行是在索引0(第一行)处添加的，包括三行。我们给两个单元格分配了有用的值。</li><li id="4281" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">最后，我们使用Openpyxl <code class="fe ni nj nk nl b">.save()</code>方法保存工作簿。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/aaf57b7e8abd455bae56142e539dc923.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XDRAcxQpal0JL1rP"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@towfiqu999999?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Towfiqu barbhuiya </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="130f" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">使用Python向Excel添加动态图表</h1><p id="fe17" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">在这一节中，我们将了解如何向Excel文件添加图表。Openpyxl库的一大优点是我们可以创建基于Excel的图表，这些图表对数据保持动态。</p><p id="a08f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使我们的图表动态化，我们需要创建<code class="fe ni nj nk nl b">Reference()</code>对象，顾名思义，这些对象保存对工作簿中位置的引用。</p><p id="3f14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将创建一个条形图，并将数据和类别粘贴到工作簿中。让我们来看看如何做到这一点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm mk l"/></div></figure><p id="c23c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来分解一下上面的代码是做什么的:</p><ol class=""><li id="329a" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">我们设置了两个<code class="fe ni nj nk nl b">Reference</code>对象:一个用于我们的数据，一个用于我们的类别。这些引用对象将把我们的图表与特定的单元格联系起来，使它们保持动态。</li><li id="e6bb" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">我们添加一个<code class="fe ni nj nk nl b">BarChart</code>对象。对于图表，我们使用<code class="fe ni nj nk nl b">.add_data()</code>和<code class="fe ni nj nk nl b">.set_categories()</code>方法来传递我们的引用对象。</li><li id="3069" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">最后，我们将图表添加到工作表上的特定锚点。</li></ol><h1 id="e347" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">用Python设计Excel报表的样式</h1><p id="a8c3" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">在这最后一节，我们将看看如何使用OpenPyxl来设计工作簿的样式。OpenPyxl可以基于Excel中存在的样式向Excel工作簿中的单元格添加样式。</p><p id="eb56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着我们可以添加像<code class="fe ni nj nk nl b">Title</code>和<code class="fe ni nj nk nl b">currency</code>这样的样式。让我们使用<code class="fe ni nj nk nl b">.style</code>属性来看看这是如何工作的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm mk l"/></div></figure><p id="b168" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的例子中，我们使用了<code class="fe ni nj nk nl b">.style</code>属性为不同的单元格分配不同的样式。我们在单元格5–6中使用for循环的原因是OpenPyxl不允许您为范围分配样式，所以我们一次分配一个样式。</p><h1 id="5f46" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">下一步做什么？</h1><p id="9e4c" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">太好了！您已经自动完成了枯燥的Excel报告！现在，你接下来应该看什么？我建议考虑您可能需要自动化的其他元素。例如:</p><ul class=""><li id="1b1a" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nq mb mc md bi translated">如何向工作表中添加姓名？</li><li id="40fa" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nq mb mc md bi translated">你如何能自动地用电子邮件发送你的结果文件？</li><li id="fdbd" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nq mb mc md bi translated">如何将值样式化为表格？</li></ul><h1 id="5668" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">结论</h1><p id="d540" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">感谢您一路阅读教程！我希望你喜欢它，并且你学到了一些东西。使用Python来自动化您的工作是一件非常值得学习的事情。如果你想了解更多，请点击<a class="ae ky" href="http://www.youtube.com/channel/UCm7fT9_IdCDbeBXjAwL9IIg?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank">这里</a>订阅我的YouTube频道。</p></div></div>    
</body>
</html>