<html>
<head>
<title>Better Churn Prediction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">更好的流失预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/better-churn-prediction-f88b20c923f3#2022-06-08">https://towardsdatascience.com/better-churn-prediction-f88b20c923f3#2022-06-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3aa8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">流失还是不流失——这不是真正的问题！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/619b2ca3483e375d12bc6a9858bd7a0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uTQP2ay7OpBNB5cM9342GQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来自<a class="ae kv" href="https://pixabay.com/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=1147597" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae kv" href="https://pixabay.com/users/inspiredimages-57296/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=1147597" rel="noopener ugc nofollow" target="_blank">灵感</a></p></figure><p id="6d62" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些年来，我一直在研究的一个主要课题是客户流失。减少客户流失是许多公司的首要任务，正确识别其根本原因可以大大提高他们的底线。</p><p id="c2ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">考虑到客户流失问题是多么广为人知和受重视，我经常被它在实践中的糟糕建模所困扰。</p><p id="ef4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">客户流失通常被表述为“谁最有可能流失？”。这个问题自然适合于分类建模。</p><p id="fedf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，我认为客户流失并不是“谁”会流失的问题，而是“什么时候”流失的问题。</p><p id="fbb6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个重要的区别，原因有二:</p><ol class=""><li id="2859" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">问“谁”会流失会导致有偏见的建模，如下所示。</li><li id="dc91" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">在很多情况下，用户的价值很大程度上取决于他的订阅时间。这只能通过问“什么时候”而不是“谁”来回答。</li></ol><h1 id="ed95" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">手机用户示例</h1><p id="d067" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">以手机用户的经典案例为例。他们每月支付一笔费用，直到某个时间点，他们决定终止合同(又名流失)。</p><p id="f157" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最终它们都会发生变化:30年后，它们要么会死去，要么会用全息图而不是手机来交流。</p><p id="673f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们想象一下典型订阅的样子:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/340c1858dcb9e7d63f223919f196a0a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OoxrRb9jWMzeldoU.png"/></div></div></figure><p id="ce38" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">顶层的第一个订户于2021年6月开始购买A计划，并于2022年4月开始购买。斜线代表“今天”(分析运行的时间)，即2022年6月8日。</p><p id="8982" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在“谁”问题中，过去(在“今天”之前)搅动过的用户被标记为“搅动的”(y=1)，而未来搅动过的用户被标记为“未搅动的”(y=0)，因为当我们“今天”观察他们时，他们仍然是订阅的。</p><p id="fcd8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到，计划A的用户倾向于花费更长的时间来流失(他们的队伍更长)。但是由于他们比B计划的订阅者更早加入，他们有更多的时间流失，也更容易被贴上“流失”的标签(A计划的50%对B计划的25%)。</p><p id="6c07" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们会错误地得出这样的结论:A计划用户的流失率高于B计划用户。</p><p id="9abd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上述偏见是非常典型的，因为手机计划通常是相继推出的。在上面的例子中可以看到，在2022年1月，计划A被切换到计划b。</p><h1 id="47da" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">一项小型模拟研究</h1><p id="c105" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">为了说明这一点，我将在r。</p><p id="e76c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们有一个从0开始的时间表。我们观察数据和拟合模型的时间(“今天”)是22。</p><p id="d0d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果用户使用计划A，则他开始订阅的时间来自均匀分布\(U~[0，20]\ ),如果用户使用计划b，则来自均匀分布\(U~[20，22]\)。</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="1f2f" class="nj mh iq nf b gy nk nl l nm nn">today &lt;- 22 <br/>Na &lt;- 700 <br/>Nb &lt;- 300 <br/>plan &lt;- rep(c("A", "B"), time = c(Na, Nb)) <br/>set.seed(1) <br/>join_time &lt;- c(runif(Na, 0, 20), runif(Nb, 20, today))</span></pre><p id="db8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面我们可以看到平均加入时间:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="1029" class="nj mh iq nf b gy nk nl l nm nn">tapply(join_time, plan, mean)</span><span id="cf85" class="nj mh iq nf b gy no nl l nm nn">##        A        B <br/>## 10.08968 20.97702</span></pre><p id="9184" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用户在交易前的订阅时间分布为泊松分布，如果他使用计划A，则λ= 4，如果他使用计划b，则λ= 3。</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="bf29" class="nj mh iq nf b gy nk nl l nm nn">set.seed(1) <br/>time_to_churn &lt;- c(rpois(Na, 4), rpois(Nb, 3))</span></pre><p id="98f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面我们可以看到客户流失的平均时间:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="f3f6" class="nj mh iq nf b gy nk nl l nm nn">tapply(time_to_churn, plan, mean)</span><span id="da31" class="nj mh iq nf b gy no nl l nm nn">##        A        B <br/>## 4.045714 2.993333</span></pre><p id="0ce8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用户搅动的时间是他加入的时间+直到他搅动的时间:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="9d3d" class="nj mh iq nf b gy nk nl l nm nn">churn_time &lt;- join_time + time_to_churn</span></pre><p id="a132" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果搅动时间大于22(从“今天”算起的未来)，我们说他没有被搅动(y=0)。如果那个时间比我们今天短一天，他就做了搅动(y=1)。</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="74c2" class="nj mh iq nf b gy nk nl l nm nn">churned &lt;- churn_time &lt; today</span></pre><p id="e13f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从原始流失率来看，我们可以看到计划A的用户流失率似乎更高:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="5cd3" class="nj mh iq nf b gy nk nl l nm nn">tapply(churned, plan, mean)</span><span id="3f1b" class="nj mh iq nf b gy no nl l nm nn">##         A         B <br/>## 0.8042857 0.2233333</span></pre><p id="54ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是我们知道B计划的用户是最近加入的，所以我们可能会尝试通过拟合用户流失与计划的逻辑回归以及用户加入后的时间来考虑这一点。</p><p id="7917" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，从下面我们可以看到，这种偏差如此之大，以至于模型仍然告诉我们，采用B计划可以降低客户流失的可能性:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="bfbf" class="nj mh iq nf b gy nk nl l nm nn">time_since_join &lt;- today - join_time glm(churned ~ plan + time_since_join)</span><span id="5e7e" class="nj mh iq nf b gy no nl l nm nn">## <br/>## Call:  glm(formula = churned ~ plan + time_since_join)<br/>## <br/>## Coefficients:<br/>##     (Intercept)            planB  time_since_join  <br/>##         0.19101         -0.02035          0.05149  <br/>## <br/>## Degrees of Freedom: 999 Total (i.e. Null);  997 Residual<br/>## Null Deviance:       233.1 <br/>## Residual Deviance: 102.9     AIC: 572.3</span></pre><h1 id="2340" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">我们该怎么办？</h1><p id="9401" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">用生存分析！</p><p id="685e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了避免这篇文章太长，我将跳过介绍什么是生存分析，而是展示它是如何处理上述偏见的。</p><p id="a0aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">生存分析武库中的一个常见模型是“加速故障时间”模型。它产生的系数很像逻辑回归:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="286f" class="nj mh iq nf b gy nk nl l nm nn">library(survival) <br/>observed_time &lt;- ifelse(churned, time_to_churn, today - join_time) <br/># add a tiny amount (0.01) to observed_time to avoid observed_time = 0 <br/>survregExp &lt;- survreg(Surv(observed_time + 0.01, churned) ~ plan, dist = "exponential" ) </span><span id="2845" class="nj mh iq nf b gy no nl l nm nn">coef(survregExp)</span><span id="b485" class="nj mh iq nf b gy no nl l nm nn">## (Intercept)       planB <br/>##   1.4558659  -0.2154432</span></pre><p id="3690" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们对系数的解释如下:与总体平均值相比，采用B计划可以减少20%的流失时间(1-exp(-0.2154432)= 0.2)。流失的平均人口时间是:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="75f0" class="nj mh iq nf b gy nk nl l nm nn">mean(time_to_churn)</span><span id="7358" class="nj mh iq nf b gy no nl l nm nn">## [1] 3.73</span></pre><p id="f2a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">B计划的平均流失时间是3，比3.7低20%。</p><h1 id="cba3" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">结论</h1><p id="eff2" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">问“什么时候”而不是“谁”的问题不仅能给我们公正的结果，还能让我们更深入地了解我们真正感兴趣的是什么:用户流失需要多长时间。</p><p id="b6f0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在接下来的几篇文章中，我将更深入地讨论生存分析，并展示流失预测中的高级用例，生存分析对于更好的流失建模至关重要。</p></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><p id="3c25" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nw">原载于2022年6月8日</em><a class="ae kv" href="https://iyarlin.github.io/2022/06/08/better_churn_modeling/" rel="noopener ugc nofollow" target="_blank"><em class="nw">https://iyarlin . github . io</em></a><em class="nw">。</em></p></div></div>    
</body>
</html>