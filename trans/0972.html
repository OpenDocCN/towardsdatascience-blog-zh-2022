<html>
<head>
<title>How to Use SQL Anti-Joins in Your Data Science Career</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在您的数据科学职业生涯中使用 SQL 反连接</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/why-is-nobody-talking-about-sql-anti-joins-f970a5f6cb54#2022-03-15">https://towardsdatascience.com/why-is-nobody-talking-about-sql-anti-joins-f970a5f6cb54#2022-03-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="66cd" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">数据科学</h2><div class=""/><div class=""><h2 id="c94f" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">以及为什么你应该知道它们</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/708935a904e269e61362a3499afa95da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oa7zyBcVDPPMufAryK3dEw.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</p></figure><p id="f35f" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我经常在社交媒体上看到类似上面的图片。它们包括一条简短的消息，说明这些是“常用的 SQL 连接”。问题是这些帖子通常会忽略反连接。我相信反联接在你职业生涯的早期学习是很重要的，这样你就能意识到它们，以备不时之需。在这篇文章中，我想向您展示如何有效地使用反连接来快速获得您需要的数据洞察力。</p><p id="fc0e" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我将使用这个 SQLite 沙盒数据库作为我的代码示例:【https://www.sql-practice.com/<a class="ae md" href="https://www.sql-practice.com/" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="0a92" class="me mf it bd mg mh mi dn mj mk ml dp mm lq mn mo mp lu mq mr ms ly mt mu mv iz bi translated">什么是反联接？</h2><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/f15e24fde53a086ee9cbbc6c179320c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*czqgln7uArxtXOqnw1THbA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</p></figure><p id="af04" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在上图中，您可以看到一个反连接的可视化表示。反连接是指您希望保留原始表中的所有记录，但那些与另一个表匹配的记录除外。我在工作中从未使用过右反连接，左反连接通常适用于您的用例。事实上，我通常根本不使用右连接，因为只需切换表的顺序，就可以完成与左连接相同的事情。</p><h2 id="41ef" class="me mf it bd mg mh mi dn mj mk ml dp mm lq mn mo mp lu mq mr ms ly mt mu mv iz bi translated">使用代码的反联接示例</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="f852" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这是一个左反联接的例子。除了<code class="fe my mz na nb b">WHERE</code>子句之外，它与左连接完全相同。这就是它与典型的左连接的区别。</p><p id="dee2" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">上面的查询查找在 physicians 表中没有匹配的 physician_id 的所有入院。通过将上面示例中的 physician_id 列设置为 null，可以找到左侧表中所有在右侧表中没有匹配记录(null 值)的行。</p><p id="f18d" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在这个特殊的例子中，这将返回 0 行，因为表中有相同的医生。</p><h2 id="7743" class="me mf it bd mg mh mi dn mj mk ml dp mm lq mn mo mp lu mq mr ms ly mt mu mv iz bi translated">什么时候应该使用反联接？</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="8025" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">描述上面的查询示例应该会使用例变得清晰。在上面的代码中，您可以看到第一个 CTE(通用表表达式)将内科医生表过滤为普通外科医生。</p><p id="a5bf" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">然后将该表连接(使用反连接)到入院表，以查找所有不涉及普通外科医生的入院。从这个例子中，您可以看到，当您想要查找两个连接表之间所有不匹配的记录时，这种类型的连接非常有用。</p><p id="4891" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">为了亲自查看这些不匹配项，我们可以将上面的查询修改为一个左连接并显示所有列。您将看到，对于右边的表，不匹配的列将全部为空值。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="90c3" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">快速注意:您可以在<code class="fe my mz na nb b">WHERE</code>子句中引用任何列，它不必与您用来进行连接的列相同。</p><p id="7784" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">例如，您可以将 first_name 列替换为 physician_id，并获得与 antijoin_example2.sql 中显示的查询相同的结果。</p><p id="f8d5" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">也就是说，最佳实践是使用与连接中的列相同的列——我只是想指出这一点来帮助您理解连接在做什么。</p><h2 id="7402" class="me mf it bd mg mh mi dn mj mk ml dp mm lq mn mo mp lu mq mr ms ly mt mu mv iz bi translated">当您应该使用 EXCEPT 运算符时</h2><p id="f42f" class="pw-post-body-paragraph lh li it lj b lk nc kd lm ln nd kg lp lq ne ls lt lu nf lw lx ly ng ma mb mc im bi translated"><em class="nh">如果您使用 Oracle SQL，本节仍然适用，只需将所有对</em> <code class="fe my mz na nb b"><em class="nh">EXCEPT</em></code> <em class="nh">运算符的引用替换为</em> <code class="fe my mz na nb b"><em class="nh">MINUS</em></code> <em class="nh">运算符即可。</em></p><p id="bead" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我可以听到一些人已经在问，“但是等等，<code class="fe my mz na nb b">EXCEPT</code>操作符已经做了同样的事情。为什么我不应该直接使用那个运算符呢？”</p><p id="51d5" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果您不确定<code class="fe my mz na nb b"><a class="ae md" href="https://www.postgresqltutorial.com/postgresql-except/" rel="noopener ugc nofollow" target="_blank">EXCEPT</a></code> <a class="ae md" href="https://www.postgresqltutorial.com/postgresql-except/" rel="noopener ugc nofollow" target="_blank">操作符</a>是什么，基本上它会获取一个表，并查找第一个表中不在第二个表中的所有记录。这与反联接的目的完全相同，但它们用于不同的场景:</p><ul class=""><li id="1ad3" class="ni nj it lj b lk ll ln lo lq nk lu nl ly nm mc nn no np nq bi translated">当您只需要在两个表之间比较的列时，可以使用<code class="fe my mz na nb b">EXCEPT</code></li><li id="e2b6" class="ni nj it lj b lk nr ln ns lq nt lu nu ly nv mc nn no np nq bi translated">当需要的列比使用<code class="fe my mz na nb b">EXCEPT</code>操作符比较的列多时，使用反连接</li></ul><p id="7993" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果我们在这个例子中使用了<code class="fe my mz na nb b">EXCEPT</code>操作符，我们将不得不把这个表连接回它自己，这样就可以得到与原来的录取表相同的列数。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="302a" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">正如您所看到的，这只是导致了一个额外的步骤，代码更难理解，效率更低。您几乎总是希望避免将表连接回自身。</p><p id="ff99" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">也就是说，<code class="fe my mz na nb b">EXCEPT</code>操作符仍然有用，只是在使用<code class="fe my mz na nb b">EXCEPT</code>操作符时，除了要比较的列之外，还需要获得额外的列。</p><p id="7bcb" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj jd">更新:</strong>我在下面的文章中介绍了第三种反连接方法。如果您已经理解了如何使用<code class="fe my mz na nb b">EXISTS</code>子子句，请跳到本文中的“如何将<code class="fe my mz na nb b">EXISTS</code>子句用于反连接”一节。</p><div class="nw nx gp gr ny nz"><a href="https://medium.com/learning-sql/understanding-the-sql-exist-clause-f3eaa3c2c34b" rel="noopener follow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd jd gy z fp oe fr fs of fu fw jc bi translated">了解 SQL EXISTS 子句</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">以及何时应该考虑使用它</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">medium.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on lb nz"/></div></div></a></div><h2 id="ddb3" class="me mf it bd mg mh mi dn mj mk ml dp mm lq mn mo mp lu mq mr ms ly mt mu mv iz bi translated">结论</h2><p id="4133" class="pw-post-body-paragraph lh li it lj b lk nc kd lm ln nd kg lp lq ne ls lt lu nf lw lx ly ng ma mb mc im bi translated">现在您知道了如何以及何时使用反联接。这就像在左或右连接中添加一个<code class="fe my mz na nb b">WHERE</code>子句一样简单😎</p><p id="89b3" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">感谢阅读！</p></div><div class="ab cl oo op hx oq" role="separator"><span class="or bw bk os ot ou"/><span class="or bw bk os ot ou"/><span class="or bw bk os ot"/></div><div class="im in io ip iq"><div class="ks kt ku kv gt nz"><a href="https://medium.com/@andreasmartinson/membership" rel="noopener follow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd jd gy z fp oe fr fs of fu fw jc bi translated">加入 Medium 并通过我的推荐链接支持我</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">medium.com</p></div></div><div class="oi l"><div class="ov l ok ol om oi on lb nz"/></div></div></a></div><p id="477f" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果你喜欢这篇文章，请通过 LinkedIn 与我联系，或者看看我的另一个故事:</p><div class="nw nx gp gr ny nz"><a rel="noopener follow" target="_blank" href="/10-quick-sql-tips-after-writing-daily-in-sql-for-3-years-37bdba0637d0"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd jd gy z fp oe fr fs of fu fw jc bi translated">三年来每天用 SQL 写作的 10 个快速 SQL 技巧</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">这些技巧解决了您作为数据专业人员将会遇到的常见 SQL 问题</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">towardsdatascience.com</p></div></div><div class="oi l"><div class="ow l ok ol om oi on lb nz"/></div></div></a></div><div class="nw nx gp gr ny nz"><a rel="noopener follow" target="_blank" href="/5-window-function-examples-to-take-your-sql-skills-to-the-next-level-2b3306650bb6"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd jd gy z fp oe fr fs of fu fw jc bi translated">5 个窗口函数示例，让您的 SQL 技能更上一层楼</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">如果你想掌握 SQL 中的数据操作，你需要理解窗口函数</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">towardsdatascience.com</p></div></div><div class="oi l"><div class="ox l ok ol om oi on lb nz"/></div></div></a></div><p id="84d6" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj jd">参考文献</strong></p><ol class=""><li id="8de7" class="ni nj it lj b lk ll ln lo lq nk lu nl ly nm mc oy no np nq bi translated">sql-practice.com(2022)，SQL Practice.com<a class="ae md" href="https://www.sql-practice.com/" rel="noopener ugc nofollow" target="_blank"/></li><li id="af21" class="ni nj it lj b lk nr ln ns lq nt lu nu ly nv mc oy no np nq bi translated"><a class="ae md" href="https://www.postgresqltutorial.com/postgresql-except/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL 除运算符</a> (2022)，PostgreSQL 教程</li></ol></div></div>    
</body>
</html>