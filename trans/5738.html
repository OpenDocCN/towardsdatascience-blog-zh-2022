<html>
<head>
<title>How to Visualize Monthly Expenses in a Comprehensive Way: Develop a Sankey Diagram in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何以一种全面的方式可视化每月开支:用 R 开发一个 Sankey 图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-visualize-monthly-expenses-in-a-comprehensive-way-develop-a-sankey-diagram-in-r-789df4902cea#2022-12-31">https://towardsdatascience.com/how-to-visualize-monthly-expenses-in-a-comprehensive-way-develop-a-sankey-diagram-in-r-789df4902cea#2022-12-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8858" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><strong class="ak">绘制桑基图</strong>,对你的财务状况有更深入的了解</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/983f31da7cd69fdcc2a76fad75554133.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XVQrIbPsqQ02mgSrkHXlGA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@dengxiangs?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">钟登祥</a>在<a class="ae ky" href="https://unsplash.com/photos/-WXQm_NTK0U?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="f9b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你使用像 Mint/Personal Capital/Clarity 这样的个人预算/财务工具，可视化每月现金流并不新鲜。所有这些工具主要提供三种类型的图表:饼图、条形图和折线图。然而，你有没有想过图表是否足够好，可以让你更好地了解你的月收入和支出？有什么方法可以全面的可视化每月的开销？在这篇文章中，我将与你分享如何在 R 中创建一个<strong class="lb iu">桑基图</strong>，以帮助你更好地了解你的财务状况。</p><h1 id="ff04" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">什么是桑基图</h1><p id="54da" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">来自维基百科:<strong class="lb iu">桑基图</strong>是<a class="ae ky" href="https://en.wikipedia.org/wiki/Flow_diagram" rel="noopener ugc nofollow" target="_blank">流程图</a>，其中箭头的宽度与流速成正比。著名的桑基图之一是<a class="ae ky" href="https://en.wikipedia.org/wiki/Napoleon" rel="noopener ugc nofollow" target="_blank">拿破仑</a>对俄罗斯<a class="ae ky" href="https://en.wikipedia.org/wiki/French_invasion_of_Russia" rel="noopener ugc nofollow" target="_blank">的入侵</a>。下图清楚地显示了部队离开的时间和数量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/486ca82c5e598a40fa4047332700c406.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7GvNPNAdk8JcsQhV.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">密纳德关于拿破仑入侵俄罗斯的经典图表——维基</p></figure><p id="a909" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回到个人财务每月现金流，采用桑基图来展示现金流以及资金来自或流向哪个账户是一个完美的用例。</p><p id="b376" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Mint 应用程序中的饼状图和条形图不会显示现金流如何，而是显示一个类别中花费/赚得的钱数，这是通过现金流深度挖掘个人财务的限制之一。</p><p id="152a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是 Reddit 上的一张漂亮的<a class="ae ky" href="https://www.reddit.com/r/dataisbeautiful/comments/sbwqkv/oc_2021_spending_and_income_34_yr_old_divorced_3/" rel="noopener ugc nofollow" target="_blank">桑基图。我们在本文中的目标是从 Mint 这样的个人金融应用程序中使用数据转储重新创建一个类似的应用程序。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/74a00aad8f170e2adbe68c1e80f441ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*foj444n_Y2yUZp_B.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">桑基图— <a class="ae ky" href="https://www.reddit.com/r/dataisbeautiful/comments/sbwqkv/oc_2021_spending_and_income_34_yr_old_divorced_3/" rel="noopener ugc nofollow" target="_blank">来自 Reddit 的收入</a></p></figure><h1 id="7d7e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">先决条件</h1><p id="0686" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">虽然它要求您安装 R 来获得更好的定制结果，但是您可以自己添加很少的代码，并且不要求您对 R 有很深的理解。你可以复制粘贴这篇文章中的代码。</p><p id="cdc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你需要<a class="ae ky" href="https://www.r-project.org/" rel="noopener ugc nofollow" target="_blank">安装 R </a>和<a class="ae ky" href="https://www.rstudio.com/" rel="noopener ugc nofollow" target="_blank"> RStudio </a>来获得最好的体验</p><h1 id="454f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">如何从 Mint 下载您的每月交易</h1><p id="8d8e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们将以 Mint.com<a class="ae ky" href="http://mint.com/" rel="noopener ugc nofollow" target="_blank">的</a>为例下载交易。从 web 应用来说很直接，手机 APP 没有这个选项。登录 Mint 后，转到<a class="ae ky" href="https://mint.intuit.com/transaction.event" rel="noopener ugc nofollow" target="_blank">事务</a>，滚动到按钮，您应该会看到一个选项“<strong class="lb iu">导出所有 xxx 事务</strong>”当您点击该选项时，将会下载一个 CSV 文件。</p><p id="2cc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下载的 CSV 文件包含以下字段:日期、描述、原始描述、金额、交易类型、类别、帐户名、标签和注释。我们将使用<strong class="lb iu">金额、交易类型、类别和账户名称</strong>来构建桑基图。</p><h1 id="26af" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">在 R 和 ggplot2 中创建 Sankey 图</h1><p id="d248" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们将用来构建桑基图的一个库是<a class="ae ky" href="https://cran.r-project.org/web/packages/ggalluvial/vignettes/ggalluvial.html#:~:text=The%20ggalluvial%20package%20is%20a,the%20feedback%20of%20many%20users." rel="noopener ugc nofollow" target="_blank">gg 冲积</a>。设计和功能最初受到了<a class="ae ky" href="https://github.com/mbojan/alluvial" rel="noopener ugc nofollow" target="_blank">冲积</a>包装的启发。gg 冲积的一个优点是它建立在 ggplot2 之上，你可以从图形的<a class="ae ky" href="https://williamv30.sg-host.com/why-is-ggplot2-so-good-for-data-visualization/" rel="noopener ugc nofollow" target="_blank">语法中获益</a></p><p id="4e6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我也写过一篇关于<em class="mt">为什么 ggplot2 对数据可视化这么好</em>的文章？</p><div class="mu mv gp gr mw mx"><a rel="noopener follow" target="_blank" href="/why-is-ggplot2-so-good-for-data-visualization-b38705f43f85"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">为什么 ggplot2 对数据可视化这么好？</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">探索 ggplot2 中的图形语法</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">towardsdatascience.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl ks mx"/></div></div></a></div><p id="ee4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是从 mint 下载的 CSV 中提取数据、执行一些基本转换并使用 ggplot 可视化为 Sankey 图的代码。</p><pre class="kj kk kl km gt nm nn no bn np nq bi"><span id="e634" class="nr lw it nn b be ns nt l nu nv">library(ggplot2)<br/>library(dplyr)<br/>library(ggthemes)<br/>library(ggalluvial)<br/><br/>df = read.csv("~/Downloads/transactions.csv")<br/>df &lt;- df %&gt;%<br/>  select(Date, Amount, Category, Transaction.Type, Account.Name) %&gt;%<br/>  mutate(Date=as.Date(Date, format="%m/%d/%Y")) %&gt;%<br/>  filter(Date &gt; as.Date('12/01/2022', format="%m/%d/%Y")) %&gt;%<br/>  group_by(Category, Transaction.Type, Account.Name) %&gt;%<br/>  summarise(Expense = sum(Amount)) %&gt;%<br/>  filter(Expense &gt; 100, Transaction.Type == "debit", !Category %in% c("Transfer", "Paycheck", "Credit Card Payment", "Mortgage &amp; Rent", "Investments"))<br/>ggplot(df, aes(axis1 = Transaction.Type, axis2 = Account.Name, axis3 = Category, y = Expense)) +<br/>  scale_x_discrete(limits = c("Transaction.Type", "Account.Name", "Category"), expand = c(.2, .05)) +<br/>  geom_alluvium() +<br/>  geom_stratum() +<br/>  geom_text(stat = "stratum", aes(label = after_stat(stratum))) +<br/>  theme_economist() +<br/>  scale_colour_economist()</span></pre><p id="7319" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码可以分为三类:</p><ol class=""><li id="14a8" class="nw nx it lb b lc ld lf lg li ny lm nz lq oa lu ob oc od oe bi translated"><strong class="lb iu">导入</strong>库并读取下载的 CSV 文件</li><li id="8a62" class="nw nx it lb b lc of lf og li oh lm oi lq oj lu ob oc od oe bi translated"><strong class="lb iu">转换:</strong>我们只选择需要的字段；已将时间戳从字符串转换为日期；按交易类型、帐户名称和类别对美元金额组求和。根据条件，该小组将帮助建立桑基图阶段。</li><li id="6ee4" class="nw nx it lb b lc of lf og li oh lm oi lq oj lu ob oc od oe bi translated"><strong class="lb iu">构建数据可视化</strong>:我们所要做的就是将分组条件放入轴中，然后在<code class="fe ok ol om nn b">scale_x_discrete</code>中命名我们希望看到流程的字段，然后调用<code class="fe ok ol om nn b">ggalluvial</code>开始构建图表。</li></ol><p id="d0a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以将图表形象化如下，它清楚地显示了每个类别的现金流来自哪个账户以及每个类别是如何分配的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/1ed31e1bebe53fae21eb4322508fc920.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/0*yOUfG1ZpETlVq-gu.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">桑基图薄荷由 R |图片由作者</p></figure><h1 id="2749" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">无需编码即可创建桑基图</h1><p id="d305" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">还有一个叫做 sankeymatic.com<a class="ae ky" href="http://sankeymatic.com/" rel="noopener ugc nofollow" target="_blank">的网站</a>，它提供了一个不用编码就能画出漂亮桑基图的选项。它要求用户以某种方式格式化输入，然后你应该得到和上面 Reddit 帖子一样的结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/8bbf92722bead38f8e6d586a58ac015b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sL3idTv77fQUrLsd.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">桑基图|图片来自<a class="ae ky" href="https://sankeymatic.com/" rel="noopener ugc nofollow" target="_blank">https://sankeymatic.com/</a></p></figure><h1 id="40c9" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">最后的想法</h1><p id="944e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">个人财务应用程序提供了快速、简单的数据可视化，但它仅限于高级的综合用途，如现金流分析。我希望这篇文章能对你的个人理财分析有所补充。请在下面留下评论，让我知道你对桑基图和使用 R 构建这样一个优秀图表的看法。</p></div><div class="ab cl oo op hx oq" role="separator"><span class="or bw bk os ot ou"/><span class="or bw bk os ot ou"/><span class="or bw bk os ot"/></div><div class="im in io ip iq"><p id="bc66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望这个故事对你有帮助。本文是我的工程&amp;数据科学系列的<strong class="lb iu">部分，目前包括以下内容:</strong></p><div class="mu mv gp gr mw"><div role="button" tabindex="0" class="ab bv gv cb fp ov ow bn ox ks ex"><div class="oy l"><div class="ab q"><div class="l di"><img alt="Chengzhi Zhao" class="l de bw oz pa fe" src="../Images/51b8d26809e870b4733e4e5b6d982a9f.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/2*SGCkys53sdZUZKnpRQoq_A.jpeg"/><div class="fb bw l oz pa fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://chengzhizhao.medium.com/?source=post_page-----789df4902cea--------------------------------" rel="noopener follow" target="_top">赵承志</a></p></div></div><div class="pd pe gw l"><h2 class="bd iu uk nw fp ul fr fs nd fu fw is bi translated">数据工程和数据科学故事</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi um au un uo up qx uq an eh ei ur us ut el em eo de bk ep" href="https://chengzhizhao.medium.com/list/data-engineering-data-science-stories-ddab37f718e7?source=post_page-----789df4902cea--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="uu l fo"><span class="bd b dl z dk">47 stories</span></div></div></div><div class="pq dh pr fp ab ps fo di"><div class="di pi bv pj pk"><div class="dh l"><img alt="" class="dh" src="../Images/4ba0357365403d685da42e6cb90b2b7e.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/da:true/resize:fill:388:388/1*b4EVtemQ1EQEup3o1ewz1w.gif"/></div></div><div class="di pi bv pl pm pn"><div class="dh l"><img alt="" class="dh" src="../Images/89f9120acd7a8b3a37b09537198b34ca.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*xj-YsbUEN_pMA4IS7hE6hw.jpeg"/></div></div><div class="di bv po pp pn"><div class="dh l"><img alt="" class="dh" src="../Images/1f0d78b4e466ea21d6a5bd7a9f97c526.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*zF1_SxRakCIMJ2sgKtyP1w.jpeg"/></div></div></div></div></div><p id="7870" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你也可以<a class="ae ky" href="https://chengzhizhao.medium.com/subscribe" rel="noopener"> <strong class="lb iu">订阅我的新文章</strong> </a>或者成为<a class="ae ky" href="https://chengzhizhao.medium.com/membership" rel="noopener"> <strong class="lb iu">推荐媒介会员</strong> </a> <strong class="lb iu"> </strong>可以无限制访问媒介上的所有故事。</p><p id="771b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果有问题/评论，<strong class="lb iu">请不要犹豫，写下这个故事的评论</strong>或通过<a class="ae ky" href="https://www.linkedin.com/in/chengzhizhao/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>或<a class="ae ky" href="https://twitter.com/ChengzhiZhao" rel="noopener ugc nofollow" target="_blank"> Twitter </a>直接<strong class="lb iu">联系我。</strong></p></div></div>    
</body>
</html>