<html>
<head>
<title>How to easily install private Python packages in Google Colab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Google Colab中轻松安装私有Python包</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-easily-install-private-python-packages-in-google-colab-98a43c8f8976#2022-04-27">https://towardsdatascience.com/how-to-easily-install-private-python-packages-in-google-colab-98a43c8f8976#2022-04-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="583f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">压缩项目的优雅替代方案</h2></div><blockquote class="kf kg kh"><p id="3a7c" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated"><strong class="kl ir"> TLDR: </strong>确保了。json文件包含关键字“用户名”→存储库帐户持有人的姓名，“访问令牌”→您的GitHub访问令牌。请注意，该软件包是一个早期版本，将来可能会有所改进。我会尽量保持更新，但如果不是，请访问这里的<a class="ae lf" href="https://github.com/namiyousef/colab-utils" rel="noopener ugc nofollow" target="_blank">库</a>。</p></blockquote><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="8bdd" class="lp lq iq ll b gy lr ls l lt lu">!pip install colab-dev-tools<br/>import os<br/>from colabtools.utils import mount_drive, install_private_library<br/>drive_path = mount_drive()<br/>git_access_token_json_path = os.path.join(drive_path, PATH_TO_JSON)<br/>install_private_library(git_access_token_json_path, PROJECT_NAME)</span></pre><p id="5b15" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lv kt ku kv lw kx ky kz lx lb lc ld le ij bi translated">Colab是一个使用免费GPU快速测试深度学习模型的伟大工具。不过它和Jupyter笔记本相比最大的缺点之一就是不能安装自定义内核。这意味着你每次都需要安装所有你需要的软件包。在大多数情况下，这不是一个特殊的问题，只是一个小麻烦。你所需要做的就是在笔记本内使用<code class="fe ly lz ma ll b">pip install</code>。</p><p id="632d" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lv kt ku kv lw kx ky kz lx lb lc ld le ij bi translated">但是，如果您使用的是私有包，所有这些都将失败。也就是说，您正在一个版本化服务(例如GitHub)上托管的私有存储库上开发的包。这是因为<code class="fe ly lz ma ll b">pip</code>不再工作，因为你需要认证，这是更难实现的，因为GitHub决定对Git操作取消<a class="ae lf" href="https://github.blog/2020-12-15-token-authentication-requirements-for-git-operations/" rel="noopener ugc nofollow" target="_blank">密码认证</a>。</p><p id="2da4" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lv kt ku kv lw kx ky kz lx lb lc ld le ij bi translated">本文详细介绍了一种使用我开发的包<a class="ae lf" href="https://github.com/namiyousef/colab-utils" rel="noopener ugc nofollow" target="_blank"> colab-dev-tools </a>安装私有包的可靠而快速的方法。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="0816" class="mi lq iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">使用私有包</h1><p id="4b0a" class="pw-post-body-paragraph ki kj iq kl b km mz jr ko kp na ju kr lv nb ku kv lw nc ky kz lx nd lc ld le ij bi translated">以前我有两种方法在Colab上使用私有代码:</p><ol class=""><li id="efce" class="ne nf iq kl b km kn kp kq lv ng lw nh lx ni le nj nk nl nm bi translated"><strong class="kl ir">将所有代码复制粘贴到Colab: </strong>这仅适用于小项目(例如1或2个小文件)。不推荐，因为这样会让笔记本又长又乱；这使得版本控制变得非常困难；几乎任何改变都需要对基础代码进行彻底的重构。</li><li id="8c21" class="ne nf iq kl b km nn kp no lv np lw nq lx nr le nj nk nl nm bi translated"><strong class="kl ir">压缩包并在Colab上解压缩:</strong>虽然这对于单个用户来说非常有效，但是在团队中维护起来就变得非常困难。zip文件很容易被放错位置、命名错误，而且版本控制几乎是不可能的。这使得在出现问题时很难重现结果和调试代码。</li></ol><p id="ed2b" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lv kt ku kv lw kx ky kz lx lb lc ld le ij bi translated">因为这两种方法都不够，所以必须考虑对GitHub进行认证。然而，只有两种方法可以做到这一点:ssh或使用访问令牌。</p><p id="d8da" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lv kt ku kv lw kx ky kz lx lb lc ld le ij bi translated">当您有固定设备(例如您的计算机)时，ssh方法非常有用，因为您不需要每次都生成密钥。然而，由于Colab是基于会话的，使用ssh是一件痛苦的事情，因为每次都需要生成密钥。auth-token方法更好，但这需要复制粘贴，因为很难记住令牌…</p><p id="e69b" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lv kt ku kv lw kx ky kz lx lb lc ld le ij bi translated">然而，这是有问题的，因为:</p><ol class=""><li id="1e42" class="ne nf iq kl b km kn kp kq lv ng lw nh lx ni le nj nk nl nm bi translated">每次复制粘贴时都有暴露密钥的风险</li><li id="3e2c" class="ne nf iq kl b km nn kp no lv np lw nq lx nr le nj nk nl nm bi translated">您可能会将它留在笔记本中，从而在笔记本推送时暴露它</li><li id="2981" class="ne nf iq kl b km nn kp no lv np lw nq lx nr le nj nk nl nm bi translated">只是很烦…</li></ol><p id="b075" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lv kt ku kv lw kx ky kz lx lb lc ld le ij bi translated">因此，我建议的解决方案是将访问令牌存储在您的个人驱动器上，然后每次都从那里读取它，但是要确保读取的内容被一些代码提取出来。这样，您就不会显式地阅读它，从而消除了风险2)。你也不需要复制粘贴任何东西，因此删除1)。最后，这个过程非常简单，所以你可以确定你不会因为3)而感到沮丧。如下图所示。</p><figure class="lg lh li lj gt nt gh gi paragraph-image"><div role="button" tabindex="0" class="nu nv di nw bf nx"><div class="gh gi ns"><img src="../Images/ab294bdcc764d94857879362632b49dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QnkKODa_LdQdanNy-KmsLQ.png"/></div></div></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="cf16" class="mi lq iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">解决办法</h1><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="9445" class="lp lq iq ll b gy lr ls l lt lu"># install the package<br/>!pip install colab-dev-tools</span><span id="550d" class="lp lq iq ll b gy oa ls l lt lu"># imports<br/>import os<br/>from colabtools.utils import mount_drive, install_private_library</span><span id="3a99" class="lp lq iq ll b gy oa ls l lt lu"># get path to Drive root, e.g. drive/MyDrive/<br/>drive_path = mount_drive()</span><span id="9615" class="lp lq iq ll b gy oa ls l lt lu"># get path to the access token<br/>git_access_token_json_path = os.path.join(drive_path, PATH_TO_JSON)</span><span id="712f" class="lp lq iq ll b gy oa ls l lt lu"># install using pip install:<br/># git+https://{access_token}@github.com/{username}/{repo_name}.git</span><span id="e350" class="lp lq iq ll b gy oa ls l lt lu">install_private_library(git_access_token_json_path, PROJECT_NAME)</span></pre></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="9e9c" class="mi lq iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">结束语</h1><ul class=""><li id="78a5" class="ne nf iq kl b km mz kp na lv ob lw oc lx od le oe nk nl nm bi translated">确保您的驱动器只能由您访问；这降低了您的访问令牌泄露的可能性。</li><li id="d2ad" class="ne nf iq kl b km nn kp no lv np lw nq lx nr le oe nk nl nm bi translated">注意，包中的函数只是抽象出代码。他们不会以任何方式加密您的访问令牌密钥。</li><li id="ce5b" class="ne nf iq kl b km nn kp no lv np lw nq lx nr le oe nk nl nm bi translated">这种方法的一个缺点是访问令牌的路径在笔记本中是可见的。这意味着，如果攻击者能够访问您的驱动器，他们将能够很容易地找到您的访问令牌json。因此，每次将笔记本推送到Github时，删除路径可能是个好主意。</li><li id="624d" class="ne nf iq kl b km nn kp no lv np lw nq lx nr le oe nk nl nm bi translated">这个包还有其他工具在使用Colab时很有用，比如测量GPU利用率，向GPU发送对象等…</li></ul><div class="of og gp gr oh oi"><a href="https://github.com/namiyousef/colab-utils" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">GitHub - namiyousef/colab-utils:使用colab和drive的辅助函数</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">github.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow ny oi"/></div></div></a></div><p id="e216" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lv kt ku kv lw kx ky kz lx lb lc ld le ij bi translated"><em class="kk">所有图片均由作者提供，除非另有说明</em></p></div></div>    
</body>
</html>