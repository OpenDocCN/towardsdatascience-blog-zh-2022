<html>
<head>
<title>Predicting The FIFA World Cup 2022 With a Simple Model using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用一个简单的 Python 模型预测 2022 年世界杯</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-the-fifa-world-cup-2022-with-a-simple-model-using-python-6b34bdd4f2a5#2022-11-18">https://towardsdatascience.com/predicting-the-fifa-world-cup-2022-with-a-simple-model-using-python-6b34bdd4f2a5#2022-11-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c9e3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">获胜者是…</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a9aa5d5a30f465447792fc590dfb1f30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-0T6gsOd4XaTegeyak0rdQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自 Shutterstock，授权给 Frank Andrade(由 Canva 编辑)</p></figure><p id="c136" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">很多人(包括我)称足球为“不可预测的比赛”，因为一场足球比赛有不同的因素可以改变最终的比分。</p><p id="06f2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">那是真的…在某种程度上。</p><p id="739b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">很难预测一场比赛的最终比分或获胜者，但在预测一场比赛的获胜者时就不是这样了。在过去的 5 年里，拜仁慕尼黑赢得了所有德甲冠军，而曼城赢得了 4 个英超联赛冠军。</p><p id="645d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">巧合吗？我不这么认为。</p><p id="e935" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">事实上，在 20-21 赛季中期，<a class="ae lu" href="https://medium.datadriveninvestor.com/can-we-beat-the-bookies-predicting-football-games-with-a-simple-model-43fe020fb384" rel="noopener ugc nofollow" target="_blank">我创建了一个模型来预测英超、西甲、意甲和德甲的冠军</a>，它成功地预测了所有冠军。</p><p id="bf27" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个预测并不难做出，因为那时已经打了 19 场比赛。现在我运行同样的模型来预测 2022 年世界杯。</p><p id="e4f5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是我如何使用 Python 预测世界杯的(关于代码的更多细节<a class="ae lu" href="https://youtu.be/anEoBZkZRHA" rel="noopener ugc nofollow" target="_blank">查看我的 1 小时视频教程</a></p><h2 id="9f33" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">我们如何预测比赛？</h2><p id="13d9" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">做预测有不同的方法。我可以建立一个奇特的机器学习模型，并输入多个变量，但在阅读了一些论文后，我决定给泊松分布一个机会。</p><p id="4c5f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为什么？让我们来看看泊松分布的定义。</p><blockquote class="mt"><p id="f63e" class="mu mv it bd mw mx my mz na nb nc lt dk translated">泊松分布是一种离散的概率分布，描述在固定的时间间隔或机会区域内发生的事件数量。</p></blockquote><p id="101a" class="pw-post-body-paragraph ky kz it la b lb nd ju ld le ne jx lg lh nf lj lk ll ng ln lo lp nh lr ls lt im bi translated">如果我们把一个进球想象成一场足球比赛 90 分钟内可能发生的事件，我们可以计算出 A 队和 b 队在一场比赛中可能进球的概率。</p><p id="bbeb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但这还不够。我们仍然需要满足泊松分布的假设。</p><ol class=""><li id="c3f5" class="ni nj it la b lb lc le lf lh nk ll nl lp nm lt nn no np nq bi translated">可以计算比赛项目的数量(一场比赛可以有 1、2、3 个或更多目标)</li><li id="4cc4" class="ni nj it la b lb nr le ns lh nt ll nu lp nv lt nn no np nq bi translated">事件的发生是独立的(一个目标的发生不应影响另一个目标的概率)</li><li id="69e7" class="ni nj it la b lb nr le ns lh nt ll nu lp nv lt nn no np nq bi translated">事件发生的速率是恒定的(在某个时间间隔内目标发生的概率应该与相同长度的其他时间间隔完全相同)</li><li id="ff57" class="ni nj it la b lb nr le ns lh nt ll nu lp nv lt nn no np nq bi translated">两件事不可能在同一时刻发生(两个目标不可能同时发生)</li></ol><p id="7318" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">毫无疑问，假设 1 和 4 得到满足，但假设 2 和 3 部分成立。也就是说，让我们假设假设 2 和 3 总是正确的。</p><p id="d091" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当我预测欧洲顶级联赛的冠军时，我绘制了过去 5 年中 4 大联赛每场比赛进球数的直方图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/84d89119910176676117219d235ca20c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*O7t9vlLea-QHZ62W.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">4 个联赛的进球数直方图</p></figure><p id="0f20" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你看看任何联盟的拟合曲线，它看起来像泊松分布。</p><p id="f51a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们可以说，可以使用泊松分布来计算一场比赛中可能进球的概率。</p><p id="d84c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是泊松分布的公式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/d4b0fbbae01aba7ccab8b23b6007b775.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/0*mS13hITSE58ZoWrx.png"/></div></figure><p id="2ba8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了做出预测，我考虑了:</p><p id="090d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">lambda</strong>:90 分钟进球数中值(A 队和 B 队)<br/><strong class="la iu">x</strong>:A 队和 B 队在一场比赛中可以进的球数</p><p id="141b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了计算 lambda，我们需要每个国家队的平均进球/失球数。这就引出了下一点。</p><h2 id="e0c7" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">每个国家队的进球/失球</h2><p id="5963" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">在收集了从 1930 年到 2018 年所有世界杯比赛的数据后，我可以计算出每个国家队的平均进球和失球。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/b910ca7aa33351e0a0f50267e3f3577a.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*uVcHohY32JavLpz1eyp9GQ.png"/></div></figure><p id="19d6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我对欧洲四大联赛的预测中，我考虑了主客场因素，但由于世界杯几乎所有球队都在中立的球场比赛，所以我在这次分析中没有考虑这个因素。</p><p id="6927" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦我有了每个国家队的得分/失球，我就创建了一个函数来预测每个队在小组赛中的得分。</p><h1 id="1522" class="nz lw it bd lx oa ob oc ma od oe of md jz og ka mg kc oh kd mj kf oi kg mm oj bi translated">预测小组赛阶段</h1><p id="d6e6" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">下面是我用来预测每个国家队在小组赛中能拿到多少分的代码。它看起来令人生畏，但它只有我提到的许多东西，直到这一点转化为代码。</p><pre class="kj kk kl km gt ok ol om bn on oo bi"><span id="0de1" class="op lw it ol b be oq or l os ot">def predict_points(home, away):<br/>    if home in df_team_strength.index and away in df_team_strength.index:<br/>        lamb_home = df_team_strength.at[home,'GoalsScored'] * df_team_strength.at[away,'GoalsConceded']<br/>        lamb_away = df_team_strength.at[away,'GoalsScored'] * df_team_strength.at[home,'GoalsConceded']<br/>        prob_home, prob_away, prob_draw = 0, 0, 0<br/>        for x in range(0,11): #number of goals home team<br/>            for y in range(0, 11): #number of goals away team<br/>                p = poisson.pmf(x, lamb_home) * poisson.pmf(y, lamb_away)<br/>                if x == y:<br/>                    prob_draw += p<br/>                elif x &gt; y:<br/>                    prob_home += p<br/>                else:<br/>                    prob_away += p<br/>        <br/>        points_home = 3 * prob_home + prob_draw<br/>        points_away = 3 * prob_away + prob_draw<br/>        return (points_home, points_away)<br/>    else:<br/>        return (0, 0)</span></pre><p id="dd77" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">简单地说，<code class="fe ou ov ow ol b">predict_points</code>计算主队和客队能得多少分。为此，我使用公式<code class="fe ou ov ow ol b">average_goals_scored * average_goals_conceded</code>计算了每个团队的 lambda。</p><p id="6d28" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，我模拟了一场比赛从 0–0 到 10–10 的所有可能得分(最后一个得分只是我目标范围的极限)。一旦我有了λ和 x，我就用泊松分布的公式来计算<code class="fe ou ov ow ol b">p</code>。</p><p id="7151" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">比方说，如果比赛分别以 1-0(主场获胜)、1-1(平局)或 0-1(客场获胜)结束，<code class="fe ou ov ow ol b">prob_home</code>、<code class="fe ou ov ow ol b">prob_draw</code>和<code class="fe ou ov ow ol b">prob_away</code>累加<code class="fe ou ov ow ol b">p</code>的值。最后，用下面的公式计算分数。</p><pre class="kj kk kl km gt ok ol om bn on oo bi"><span id="8982" class="op lw it ol b be oq or l ox ot">points_home = 3 * prob_home + prob_draw<br/>points_away = 3 * prob_away + prob_draw</span></pre><p id="2be8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们用<code class="fe ou ov ow ol b">predict_points</code>来预测英格兰对美国的比赛，我们会得到这个。</p><pre class="kj kk kl km gt ok ol om bn on oo bi"><span id="a045" class="op lw it ol b be oq or l ox ot">&gt;&gt;&gt; predict_points('England', 'United States')<br/>(2.2356147635326007, 0.5922397535606193)</span></pre><p id="af0a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这意味着英国将得到 2.23 分，而美国将得到 0.59 分。我得到小数是因为我在用概率。</p><p id="ce40" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们将此<code class="fe ou ov ow ol b">predict_points</code>函数应用于小组赛的所有比赛，我们将获得每个小组的第一和第二名，从而获得接下来的淘汰赛。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/0ce9e341786db1b44dedb7e3afbb33ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zYzjn5eySaFrciH45KI1_g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者用 Canva 编辑</p></figure><h1 id="b412" class="nz lw it bd lx oa ob oc ma od oe of md jz og ka mg kc oh kd mj kf oi kg mm oj bi translated">预测击倒</h1><p id="169c" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">对于淘汰赛，我不需要预测积分，而是每个括号中的获胜者。这就是为什么我在之前的<code class="fe ou ov ow ol b">predict_points</code>函数的基础上创建了一个新的<code class="fe ou ov ow ol b">get_winner</code>函数。</p><pre class="kj kk kl km gt ok ol om bn on oo bi"><span id="d46d" class="op lw it ol b be oq or l os ot">def get_winner(df_fixture_updated):<br/>    for index, row in df_fixture_updated.iterrows():<br/>        home, away = row['home'], row['away']<br/>        points_home, points_away = predict_points(home, away)<br/>        if points_home &gt; points_away:<br/>            winner = home<br/>        else:<br/>            winner = away<br/>        df_fixture_updated.loc[index, 'winner'] = winner<br/>    return df_fixture_updated</span></pre><p id="4286" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">简单来说，如果<code class="fe ou ov ow ol b">points_home</code>大于<code class="fe ou ov ow ol b">points_away</code>则胜者为主队，否则，胜者为客队。</p><p id="1089" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢<code class="fe ou ov ow ol b">get_winner</code>函数，我可以得到前面括号中的结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/1aacc0ceaefa461e9cdb7c7cfb2c865d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VEUXEIL5KZKQGrPa4tK8Bw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者用 Canva 编辑</p></figure><h1 id="001d" class="nz lw it bd lx oa ob oc ma od oe of md jz og ka mg kc oh kd mj kf oi kg mm oj bi translated">预测四分之一决赛、半决赛和决赛</h1><p id="876f" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">如果我再用一次<code class="fe ou ov ow ol b">get_winner</code>，我就能预测出世界杯的冠军。下面是最终结果！！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/02c227f0b9dd09027b32bad5ea583923.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cYAPDdAr7Rg1flwB94EAFA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者用 Canva 编辑</p></figure><p id="5142" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过再次运行这个函数，我得到获胜者是…</p><blockquote class="mt"><p id="10e6" class="mu mv it bd mw mx my mz na nb nc lt dk translated">巴西！</p></blockquote><p id="b8d9" class="pw-post-body-paragraph ky kz it la b lb nd ju ld le ne jx lg lh nf lj lk ll ng ln lo lp nh lr ls lt im bi translated">就是这样！我就是这样用 Python 和泊松分布预测 2022 年世界杯的。要查看完整的代码，请查看我的<a class="ae lu" href="https://github.com/ifrankandrade?tab=repositories" rel="noopener ugc nofollow" target="_blank"> GitHub </a>。你也可以查看我的<a class="ae lu" href="https://frank-andrade.medium.com/list/python-project-fifa-world-cup-2022-prediction-85426e7c421c" rel="noopener">介质列表</a>，查看与这个 Python 项目相关的所有文章。</p></div><div class="ab cl oz pa hx pb" role="separator"><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe"/></div><div class="im in io ip iq"><p id="4d2a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">用 Python 学习数据科学？<a class="ae lu" href="https://frankandrade.ck.page/26b76e9130" rel="noopener ugc nofollow" target="_blank"> <strong class="la iu">通过加入我的 20k+人电子邮件列表，获得我的免费 Python for Data Science 备忘单。</strong>T13】</a></p><p id="489b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你喜欢阅读这样的故事，并想支持我成为一名作家，可以考虑报名成为一名媒体成员。每月 5 美元，让您可以无限制地访问数以千计的 Python 指南和数据科学文章。如果你用<a class="ae lu" href="https://frank-andrade.medium.com/membership" rel="noopener">我的链接</a>注册，我会赚一小笔佣金，不需要你额外付费。</p><div class="pg ph gp gr pi pj"><a href="https://frank-andrade.medium.com/membership" rel="noopener follow" target="_blank"><div class="pk ab fo"><div class="pl ab pm cl cj pn"><h2 class="bd iu gy z fp po fr fs pp fu fw is bi translated">通过我的推荐链接加入媒体——弗兰克·安德拉德</h2><div class="pq l"><h3 class="bd b gy z fp po fr fs pp fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pr l"><p class="bd b dl z fp po fr fs pp fu fw dk translated">frank-andrade.medium.com</p></div></div><div class="ps l"><div class="pt l pu pv pw ps px ks pj"/></div></div></a></div></div></div>    
</body>
</html>