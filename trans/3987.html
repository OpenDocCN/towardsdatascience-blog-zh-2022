<html>
<head>
<title>Improve Time Series Forecasting performance with the Facebook Prophet model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用脸书预言家模型提高时间序列预测性能</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/improve-time-series-forecasting-performance-with-facebook-prophet-model-f7e83ffab6a3#2022-09-05">https://towardsdatascience.com/improve-time-series-forecasting-performance-with-facebook-prophet-model-f7e83ffab6a3#2022-09-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8471" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">时间序列特征工程和预测基本指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/04da58474e06fc8f9fd1c5266013e619.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eCL_76mu-TISOO3cW1SQCg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">科林·伯伦斯来自<a class="ae ky" href="https://pixabay.com//?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=3068300" rel="noopener ugc nofollow" target="_blank">的图片</a></p></figure><p id="49f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">时间序列预测涉及基于历史时间戳数据值和外部因素构建模型，以做出科学预测，推动未来的战略决策。鉴于其对相关决策的直接影响，为准确可靠的预测训练稳健的时间序列预测模型是最具挑战性的任务之一。时间序列预测模型的稳健性完全取决于建模前进行的特征工程和数据分析。</p><blockquote class="lv lw lx"><p id="8f46" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">在之前的一篇文章中，我讨论了一个开源包tsfresh，它可以为您的时间序列用例生成数百个相关特性。</p></blockquote><div class="mc md gp gr me mf"><a rel="noopener follow" target="_blank" href="/automate-time-series-feature-engineering-in-a-few-lines-of-python-code-f28fe52e4704"><div class="mg ab fo"><div class="mh ab mi cl cj mj"><h2 class="bd iu gy z fp mk fr fs ml fu fw is bi translated">用几行Python代码实现时间序列特征工程的自动化</h2><div class="mm l"><h3 class="bd b gy z fp mk fr fs ml fu fw dk translated">为您的时间序列用例提取数百个相关特征</h3></div><div class="mn l"><p class="bd b dl z fp mk fr fs ml fu fw dk translated">towardsdatascience.com</p></div></div><div class="mo l"><div class="mp l mq mr ms mo mt ks mf"/></div></div></a></div><p id="acb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">即使在包括tsfresh ad外部特征之后，时间序列模型有时也不会预测到与业务预期相匹配。在本文中，我们将讨论和实现如何使用脸书先知模型的特征来提高监督时间序列模型的性能。</p><h2 id="7fe1" class="mu mv it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">开始使用:</h2><p id="b514" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">我们将使用自定义生成的基于时间的样本数据集，该数据集具有8个独立特征和一个连续的从属特征“目标”。我们将为不同的特征工程策略训练一个轻型GBM模型:</p><ul class=""><li id="73db" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu nx ny nz oa bi translated">具有外部特征的轻型GBM</li><li id="126c" class="ns nt it lb b lc ob lf oc li od lm oe lq of lu nx ny nz oa bi translated">轻型GBM，带外部特征+滞后</li><li id="6bf4" class="ns nt it lb b lc ob lf oc li od lm oe lq of lu nx ny nz oa bi translated">Light-GBM带外部功能+ lags + facebook prophet功能</li></ul><p id="9a1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将实现并比较上述每个特征工程策略的性能，并得出脸书先知特征在训练稳健模型中是否有效的结论。</p><h2 id="7271" class="mu mv it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">数据:</h2><p id="329a" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">基于时间的原始数据是基于时间的，并且具有8个独立特征和作为从属特征的“目标”。我已经创建了小时、日和月特性来捕获数据中的时间因素。在下面找到一个数据示例:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/643a4cb927ac6457fd87ff1b3ad32c33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3SNHn5nx8C9lcIeMzkNtTw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)，样本数据快照</p></figure><h1 id="491c" class="oh mv it bd mw oi oj ok mz ol om on nc jz oo ka nf kc op kd ni kf oq kg nl or bi translated">训练轻型GBM模型:</h1><p id="d95d" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">我们将在上述原始样本数据上训练一个light-GBM模型，并计算其最佳性能特征，以及用于基准测试的MAE(平均绝对误差)。</p><div class="kj kk kl km gt ab cb"><figure class="os kn ot ou ov ow ox paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/f92708287fba58aa4183d2c95f8a67f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*HxpQB01eEc2jknrV7DMJ3w.png"/></div></figure><figure class="os kn oy ou ov ow ox paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/81c8067433530a036454a887ee451dad.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*nCIjVD9t6CqPDBOiTNCTvw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk oz di pa pb translated">(图片由作者提供)，<strong class="bd pc">左:</strong>绘制可视化推理数据的真实值和预测值，<strong class="bd pc">右:</strong>轻型GBM模型的最佳性能特征</p></figure></div><p id="8890" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于推断数据，我们得到了的<strong class="lb iu">MAE<strong class="lb iu">53.79</strong>，表现最好的特征是小时、日、湿度等。</strong></p><h1 id="23d8" class="oh mv it bd mw oi oj ok mz ol om on nc jz oo ka nf kc op kd ni kf oq kg nl or bi translated">带滞后的轻型GBM:</h1><p id="7033" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">先前的模型仅根据外部因素/数据进行训练，不涉及从属特征“目标”的滞后。为了计算要包含的滞后数，我们可以观察自相关。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/845315718eb74fc9993b0f5cad3ab8cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/1*Q3iLG_hr248WCzoIJ0RiCw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)，相关特征“目标”的自相关图</p></figure><p id="a2d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从上面的关联图中，我们可以观察到“目标”功能在1小时、24小时、48小时等时间内都具有很高的相关性。因此，我们可以创建计算滞后要素的要素:</p><ul class=""><li id="4586" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu nx ny nz oa bi translated">通过将目标值移动1小时，获得1小时滞后变量</li><li id="049c" class="ns nt it lb b lc ob lf oc li od lm oe lq of lu nx ny nz oa bi translated">通过将目标值移动1天，获得1天的滞后变量</li><li id="4516" class="ns nt it lb b lc ob lf oc li od lm oe lq of lu nx ny nz oa bi translated">通过将目标值移动2天，获得2天滞后变量</li><li id="f84f" class="ns nt it lb b lc ob lf oc li od lm oe lq of lu nx ny nz oa bi translated">通过将目标值移动1周，获得1周的滞后变量</li></ul><p id="11ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将包括先前的静态特性和滞后特性。</p><div class="kj kk kl km gt ab cb"><figure class="os kn pe ou ov ow ox paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/fe74cb5b6d5df06b6876af0f3de7f53f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*8X9UWRkHlBvlBx4-JoXodg.png"/></div></figure><figure class="os kn pf ou ov ow ox paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/6b761143e0741958373cb8157e5b8982.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*_jhpVkVPUTEAM_CkD6nvIg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk pg di ph pb translated">(图片由作者提供)，<strong class="bd pc">左:</strong>绘制可视化推理数据的真实值和预测值，<strong class="bd pc">右:</strong>轻型GBM模型的最佳性能特征</p></figure></div><p id="695b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于推断数据，我们得到了21.37 的<strong class="lb iu"> MAE，性能最好的特性是小时、前一小时滞后、前一天滞后等。</strong></p><h1 id="3424" class="oh mv it bd mw oi oj ok mz ol om on nc jz oo ka nf kc op kd ni kf oq kg nl or bi translated">带lags + FB Prophet功能的轻型GBM:</h1><p id="1b34" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">我们现在将包括脸书先知包的功能。想法是在训练数据上训练FB Prophet模型，并利用来自<code class="fe pi pj pk pl b"><strong class="lb iu">prophet.predict()</strong></code> API的训练和推理特征来生成22维统计特征。</p><div class="kj kk kl km gt ab cb"><figure class="os kn pm ou ov ow ox paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/3a1865cf489b2690185eff82ae26fec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*4bztsgfMR1N5dEa4xUlGrw.png"/></div></figure><figure class="os kn pn ou ov ow ox paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/12f4fcea271eda8f0a1a6cbd120b55f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*BnGQFJBasLi97nCCpe6jdA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk po di pp pb translated">(图片由作者提供)，<strong class="bd pc">左:</strong>绘制可视化推理数据的真实值和预测值，<strong class="bd pc">右:</strong>轻型GBM模型的最佳性能特征</p></figure></div><p id="caba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于推断数据，我们得到了20.81 的<strong class="lb iu"> MAE，性能最好的特性是前一小时滞后、当前小时、每周、前一天滞后、附加特性等。</strong></p><h1 id="5730" class="oh mv it bd mw oi oj ok mz ol om on nc jz oo ka nf kc op kd ni kf oq kg nl or bi translated">结论:</h1><p id="e7c3" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">在本文中，我们已经讨论了一些时序用例的特性工程策略。根据我们对数据样本的实验，原始数据集给出的MAE为<strong class="lb iu"> 53.78，</strong>在包括滞后之后，MAE提高到<strong class="lb iu"> 21.37 </strong>。在引入脸书先知API的统计特征后，MAE进一步提高到<strong class="lb iu"> 20.81 </strong>。</p><p id="d77d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然在包含FB Prophet特性后MAE的改进还不够，但它仍然可以在其他用例或真实世界数据集的更大样本中表现良好。</p><h1 id="ef6b" class="oh mv it bd mw oi oj ok mz ol om on nc jz oo ka nf kc op kd ni kf oq kg nl or bi translated">参考资料:</h1><p id="723b" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">[1]https://facebook.github.io/prophet/脸书先知文献:<a class="ae ky" href="https://facebook.github.io/prophet/" rel="noopener ugc nofollow" target="_blank"/></p><blockquote class="pq"><p id="328c" class="pr ps it bd pt pu pv pw px py pz lu dk translated">感谢您的阅读</p></blockquote></div></div>    
</body>
</html>