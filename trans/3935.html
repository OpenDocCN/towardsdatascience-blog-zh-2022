<html>
<head>
<title>How to Perform SQL-flavored Left | Right | Inner | Outer Join in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Pandas中执行SQL风格的左|右|内|外连接</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-perform-sql-flavored-left-right-inner-outer-join-in-pandas-8cc1ea2f622c#2022-08-31">https://towardsdatascience.com/how-to-perform-sql-flavored-left-right-inner-outer-join-in-pandas-8cc1ea2f622c#2022-08-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d119" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">SQL到Pandas翻译初学者指南:连接</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/466cb992f034af6a406fff1f77467e41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0sbxyg-8LKjEGI4ER6xfYQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2777620" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae ky" href="https://pixabay.com/users/alexas_fotos-686414/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2777620" rel="noopener ugc nofollow" target="_blank"> Alexa </a></p></figure><p id="a8cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在数据分析领域，我们很少遇到幸运的情况，我们需要的所有数据都驻留在一个表中，并且是现成的格式。相反，我们经常需要从多个表中获取数据，并将它们放入一个数据集中进行分析。这种数据管理过程通常被称为数据合并/连接/串联。</p><p id="d083" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您来自SQL领域，您可能已经熟悉处理数据合并的SQL概念。具体来说，SQL将两个或多个表<strong class="lb iu">横向</strong>合并为‘join’，纵向<strong class="lb iu">合并为‘union’的过程。在这篇文章中，我们将专门讨论如何使用pandas的<code class="fe lv lw lx ly b">pandas.DataFrame.merge</code>方法在python中执行SQL风格的‘join’。我们将在另一篇文章中讨论如何在pandas中执行SQL的' union '查询。</strong></p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="4065" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用公共键水平合并/连接两个数据集有四种基本方法:左连接、右连接、内连接和外连接。让我们使用以下两个样本数据集进行演示。</p><pre class="kj kk kl km gt mg ly mh mi aw mj bi"><span id="f679" class="mk ml it ly b gy mm mn l mo mp">import pandas as pd<br/>import numpy as np</span><span id="2dad" class="mk ml it ly b gy mq mn l mo mp">df_left = pd.DataFrame({'Student_ID': ['001', '002', '003', '004','005'],<br/>        'Gender': ['F', 'M','F', 'F','M'],<br/>        'race/ethnicity': ['Group A', 'Group B','Group D', 'Group E','Group E']})</span><span id="4a9a" class="mk ml it ly b gy mq mn l mo mp">df_right = pd.DataFrame({'Student_ID': ['002', '003', '005', '006','007'],<br/>        'Math': [77, 46,83, 53,65],<br/>        'Reading': [91, 62,88, 56,72],<br/>        'Writing': [49, 90 ,67, 66,59]})</span></pre><p id="8d62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们有两个数据帧，分别称为“df_left”和“df_right”。“df_left”数据帧有一个Student_ID列和每个学生的性别和种族/民族信息。“df_right”数据框架还有一个“Student_ID”列，以及每个学生的数学、阅读和写作成绩。我们希望合并这两个表(水平方向),这样我们就可以在一个数据集中拥有关于一个学生的所有信息，以便进行后续分析。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/445922eb2475b2cf329debfdaa849caf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*MBiD-ofLd65B-dCFdWXWtw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="07f6" class="ms ml it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">左连接</h1><p id="2ae9" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated"><strong class="lb iu"> left join </strong>操作保留左表(df_left)中的所有记录，并且只引入右表中与公共关键字(‘Student _ ID’)匹配的记录。对于右表中没有公共关键字匹配的记录，合并后的表中这些记录的值为“NaN”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/9fd7238fefecc5fae7e54e163a42ec01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-tlS4r-WuCP8NApklKIBlw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="5b89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了在python中执行左连接，我们可以使用Pandas的<code class="fe lv lw lx ly b">dataframe.merge()</code>方法。<code class="fe lv lw lx ly b">on</code>参数接受键列，<code class="fe lv lw lx ly b">how</code>参数接受连接的类型(左、右等。)</p><p id="bb1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">df_left.merge(df_right, on='Student_ID', how='left')</code></p><h1 id="4a98" class="ms ml it bd mt mu np mw mx my nq na nb jz nr ka nd kc ns kd nf kf nt kg nh ni bi translated">右连接</h1><p id="5145" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">与左连接相反，<strong class="lb iu">右连接</strong>操作保留右表(df_right)中的所有记录，并且只引入左表中通过公共键匹配的记录。对于左表中没有与公共关键字匹配的记录，合并后的表中这些记录的值将为“NaN”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/1b9239f31de71cda63d321ac3335b393.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*96HKHS3S146ffkg2yml7LA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4be9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过将<code class="fe lv lw lx ly b">how</code>参数指定为<code class="fe lv lw lx ly b">how='right'</code>，使用下面的代码在python中执行右连接:</p><p id="99da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">df_left.merge(df_right, on='Student_ID', how='right')</code></p><h1 id="aede" class="ms ml it bd mt mu np mw mx my nq na nb jz nr ka nd kc ns kd nf kf nt kg nh ni bi translated">内部连接</h1><p id="f532" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">与left join和right join不同，<strong class="lb iu"> inner join </strong>仅通过公共键(Student_ID)获取两个表的交集。任何没有公共Student _ IDs的记录都将从合并的表中删除，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/25da326f913863d4afbf918091f488de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*mChoGOQ3dEhAmDqg0Ro_xQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="c2c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用下面的代码在python中执行内部连接:</p><p id="8420" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">df_left.merge(df_right, on='Student_ID', how='inner')</code></p><h1 id="c257" class="ms ml it bd mt mu np mw mx my nq na nb jz nr ka nd kc ns kd nf kf nt kg nh ni bi translated">外部连接</h1><p id="268b" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated"><strong class="lb iu">外部连接</strong>(也称为完全外部连接)，从两个表中获取所有的Student _ IDs，并为没有公共关键字匹配的字段插入NaN(缺失值)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/51d86fd0c80e4a35c752d334a3a67f82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*wtHTCWPKS_b1Xk6EzvOGHA.png"/></div></figure><p id="a557" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用下面的代码在python中执行完整的外部连接:</p><p id="f10a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">df_left.merge(df_right, on='Student_ID', how='outer')</code></p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="7ab0" class="ms ml it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">仅在列的子集中合并</h1><p id="3b4c" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">默认情况下，上面显示的代码片段将通过您选择的任何类型的连接合并左表和右表，并包括两个表中的所有列。如果您只想在合并时包含右表中的“阅读”列，该怎么办？</p><p id="8c0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嗯，在合并之前，您总是可以对表的列进行子集化。例如，如果我们想用一个左连接从右表中引入“Reading”列，我们可以这样做。很简单，不是吗？</p><pre class="kj kk kl km gt mg ly mh mi aw mj bi"><span id="7193" class="mk ml it ly b gy mm mn l mo mp">df_left.merge(df_right[['Student_ID','Reading']], on='Student_ID', how='left')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/d6a66a81ae15ca21d9c621e4c0967e49.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*zLf2D333SbTyPMTktiSHcQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="e037" class="ms ml it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">用不同的“键列”名称联接</h1><p id="c225" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">在前面的例子中，您可能已经注意到，两个表中的公共键列具有完全相同的列名“Student_ID”。如果两个表中的键列有不同的名称会怎样？</p><p id="7f55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，您可以选择重命名其中一个表的键列，使其与另一个表同名，并使用上面所示的相同代码片段。用不同的键列名执行连接的另一种方法是使用<code class="fe lv lw lx ly b">left_on</code>和<code class="fe lv lw lx ly b">right_on</code>作为参数而不是<code class="fe lv lw lx ly b">on</code>来显式指定键列的名称。</p><p id="9d1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，假设左边表的键列名是“Student_ID ”,而右边表的键列名是“ID”。若要执行内部联接，可以使用以下代码:</p><pre class="kj kk kl km gt mg ly mh mi aw mj bi"><span id="d3f0" class="mk ml it ly b gy mm mn l mo mp">df_left.merge(df_right, left_on='Student_ID', right_on='ID', how='inner')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/960fb200369986e390fdd81f50a820c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xGp0LLY2EKAEmRY4xCD3EQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="db1b" class="ms ml it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">在多个键上合并</h1><p id="164a" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">有时您可能需要在多个键上连接两个表。您可以简单地在<code class="fe lv lw lx ly b">on</code>参数中指定一个您想要用来连接两个表的键列表:</p><pre class="kj kk kl km gt mg ly mh mi aw mj bi"><span id="48f2" class="mk ml it ly b gy mm mn l mo mp">df_left.merge(df_right, on=['key1', 'key2'...],how='left')</span></pre><p id="26d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，如果键列有不同的名称，可以使用<code class="fe lv lw lx ly b">left_on</code>和<code class="fe lv lw lx ly b">right_on</code>参数:</p><pre class="kj kk kl km gt mg ly mh mi aw mj bi"><span id="f34f" class="mk ml it ly b gy mm mn l mo mp">df_left.merge(df_right, left_on=['leftkey1', 'leftkey2'], right_on=['rightkey1', 'rightkey2'],how='left')</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="5b11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">合并表格是数据分析领域中最常见的数据管理任务之一。我希望本教程有助于理解SQL风格的连接的基本类型以及如何使用<code class="fe lv lw lx ly b">Pandas</code>来实现它们。如前所述，本教程只教你如何基于一个或多个公共键水平合并两个表。为了垂直合并/堆叠表(相当于SQL中的‘UNION’操作)，我们需要使用不同的<code class="fe lv lw lx ly b">pandas</code>函数，我们将在另一篇文章中讨论这个主题。感谢阅读，我希望你喜欢这个简短的教程。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="2284" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">数据源</strong>:本教程中使用的样本数据集是作者创建的。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="1774" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以通过这个<a class="ae ky" href="https://medium.com/@insightsbees/membership" rel="noopener">推荐链接</a>注册Medium会员(每月5美元)来获得我的作品和Medium的其他内容。通过这个链接注册，我将收到你的一部分会员费，不需要你额外付费。谢谢大家！</p></div></div>    
</body>
</html>