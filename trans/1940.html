<html>
<head>
<title>Data Imputation with MAGIC</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">魔法数据插补</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-imputation-with-magic-85263d09a43f#2022-05-03">https://towardsdatascience.com/data-imputation-with-magic-85263d09a43f#2022-05-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="99ab" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">凯西-卡达布拉-阿拉卡赞！像变魔术一样消除数据中的噪音！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fb2184f0388fac4c228db96848917284.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HAtqfi7yorY5ISAzhITG0g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">佩吉·科迪在<a class="ae ky" href="https://unsplash.com/s/photos/magic?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="0478" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在单细胞RNA测序数据(scRNA-seq)中，记录了单个细胞基因组中mRNA分子的数量，我们经常遇到这些分子的低计数或零计数。这是因为测序机器对更稀疏表达的基因的检测效率较低，导致它们被错误地标记为0。这给scRNA-seq数据增加了许多噪声，这可能使下游分析如维度减少、差异基因表达和轨迹推断潜在可疑。具体来说，这种噪音可以掩盖感兴趣的基因的已知生物关系。</p><p id="2176" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">消除这些数据的噪声并绕过这个障碍不是很好吗？这就是归罪的由来。插补是一种填充或估算缺失数据(即零计数)的方法，通过对这些缺失数据条目的真实值进行有根据的猜测。去噪是一种插补模式，在这种模式下，您可以估计噪声并相应地移除噪声。实现这一点的一个简单而有效的方法是来自Krishnaswamy实验室的算法(该实验室开发了<a class="ae ky" href="https://www.nature.com/articles/s41587-019-0336-3" rel="noopener ugc nofollow" target="_blank"> PHATE </a>，一种与更常用的UMAP具有竞争力的降维算法)，称为<a class="ae ky" href="https://www.cell.com/cell/fulltext/S0092-8674(18)30724-4?_returnURL=https%3A%2F%2Flinkinghub.elsevier.com%2Fretrieve%2Fpii%2FS0092867418307244%3Fshowall%3Dtrue" rel="noopener ugc nofollow" target="_blank"> MAGIC </a>。MAGIC代表<strong class="lb iu">M</strong>arkov<strong class="lb iu">A</strong>f基于<strong class="lb iu"> G </strong>图<strong class="lb iu"> I </strong>计算的<strong class="lb iu"> C </strong>单元。这种方法在单个单元格数据的图形表示上使用数据扩散来消除噪声。</p><p id="18d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您已经阅读了我的文章，下面的步骤将会非常熟悉，但简单地说，该算法从一个单细胞数据的矩阵开始(但您可以很容易地在您自己的数据集中替换这种矩阵格式)，并计算细胞之间的欧几里德距离，创建一个细胞到细胞的距离矩阵(根据数据的维度，我们通常在PCA空间中用大约10-100个主成分来确定这些距离)。这个矩阵然后从距离转换成亲和力。这度量相似性并且与距离成反比，例如两个细胞在欧几里得空间中越接近(即，它们的距离越小)，它们的亲和力越大。该计算使用指数内核实现:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/718b5cba3ecebf94eec2a7ae706a5e13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*rkH6Hs_TPaFohcZyJDuwxA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="e159" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中<em class="lw"> x </em>和<em class="lw"> y </em>各自对应于PCA空间中的细胞坐标，<em class="lw"> d(x，y) </em>是<em class="lw"> x </em>和<em class="lw"> y </em>之间的欧几里德距离，<em class="lw"> σ </em>是带宽参数，并且测量由该核捕获的邻域的“扩散”或半径。这是捕捉邻域单元内局部变化的关键。<em class="lw"> σ </em>的选择因每组单元格而异，以校正单个单元格图中的密度差异。例如，一些细胞可能占据具有很少相邻细胞的稀疏区域，而其他细胞则挤满了一堆细胞。因此，我们希望稀疏区域的带宽“更宽”,而密集区域的带宽更短，以校正这种邻域变化。因此，我们将<em class="lw"> σ </em>设为x与其第<em class="lw"> k </em>个最近邻居之间的距离:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/2b179c9cd694ebec09591b1f8c73ac6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*vV3IUXmGnsqgMB9M_i5WOw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="ccdf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中<em class="lw"> xₖ </em>是单元<em class="lw"> x </em>的第<em class="lw"> k </em>个最近邻。MAGIC的作者建议这个k应该很小，以确保整个图的连通性。然而，因为<em class="lw"> σ </em>是细胞特定的，我们的亲和矩阵不再是对称的(即，可能存在一对<em class="lw"> x，y </em>使得<em class="lw"> A(x，y) </em> <em class="lw"> ≠ A(y，x) </em>)。这可以很容易地通过将我们的亲和矩阵的转置添加到原始矩阵<strong class="lb iu"> A </strong>中来纠正。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/ac6370f81143f953f51f1d1f92595a27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*Moi0r5vG1pSLwtgqkEQjyw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="574b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们计算了我们的亲和矩阵之后，我们通过行标准化将这些值转换成概率，在一个步骤中为所有单元获得从单元<em class="lw"> x </em>到单元<em class="lw"> y </em>的马尔可夫转移概率。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/3570e4b5df5370b4f977408a629439b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*ITlv2O9VYLcdomvTGr5V-A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="41e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为退出效应呈现出一种形式的技术变异，这种变异通常与生物变异难以区分，随机采样特征(在这种情况下，每个基因的mRNA分子计数)可能导致已知<em class="lw">先验</em>相同的细胞(例如，干细胞或红细胞)之间的可疑变异。但是，将这些数据想象成一个图，其中节点表示单元，边表示相似单元之间的连接，您可以假设相似单元共享许多邻居，而不同单元具有较少的共同邻居。有没有一种方法可以让我们利用这些信息，让计数稀少的细胞可以从它们噪音较小的朋友那里学习？这就是数据扩散的用武之地，它为我们的马尔可夫概率矩阵求幂<em class="lw"> t </em>。这可以直观地认为是在随机行走的<em class="lw"> t </em>步内从单元格<em class="lw"> x </em>转换到单元格<em class="lw"> y </em>的概率。这个<em class="lw"> t </em>被称为扩散时间。因此，在确定其基因表达谱时，细胞有更多的邻居可以遍历和学习。矩阵的这种动力增加了相似细胞的亲和力，同时消除了更嘈杂的连接。在图形信号的上下文中，您可以将它视为一个低通滤波器，当我们增加t时，我们不仅通过亲和力加强相关单元之间的连接，还通过降低稀疏性中出现的错误连接的权重来消除噪声。</p><p id="f8c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个乘方矩阵然后直接乘以scRNA-seq数据的原始矩阵，以获得滤除噪声的估算矩阵。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/e8eba9cc13a711db3831a425495ef6b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*hvbrjPMWlNyR7RKn85w1_A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0598" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中<strong class="lb iu"> M </strong> <em class="lw"> ᵗ </em>为扩散时间驱动的概率矩阵，<em class="lw"> t </em>，<strong class="lb iu"> X </strong>为<em class="lw"> m </em>细胞和<em class="lw"> n </em>基因的原始单细胞矩阵，<strong class="lb iu"> X </strong> <em class="lw"> _impute </em>为估算的基因表达矩阵。</p><p id="96d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">概括地说，我们首先从预处理的原始数据计算细胞到细胞的距离矩阵，将距离转换为亲和力，将亲和力归一化为概率，然后对得到的概率矩阵求幂并乘以原始数据矩阵。很简单，对吧？我非常欣赏这个算法的一点是，从数学的角度来看，它是多么的简单和优雅。但是足够的数学，让我们看看这个算法在行动！</p><p id="3396" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了测试MAGIC，我们将使用pip安装Python版本:</p><p id="cf58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ma mb mc md b">pip install --user magic-impute</code></p><p id="fd56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还将安装一些用于预处理数据的单细胞分析包，以及用于可视化的PHATE:</p><p id="1a2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ma mb mc md b">conda install -c bioconda scvelo</code></p><p id="430b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ma mb mc md b">conda install -c conda-forge scanpy</code></p><p id="455e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ma mb mc md b">pip install scprep phate</code></p><p id="d9b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用<a class="ae ky" href="https://www.nature.com/articles/s41586-018-0414-6" rel="noopener ugc nofollow" target="_blank">神经元分化</a>的scRNA-seq数据集来说明神奇之处。如果你感兴趣的话，你可以阅读我的<a class="ae ky" rel="noopener" target="_blank" href="/rna-velocity-the-cells-internal-compass-cf8d75bb2f89"> RNA velocity文章</a>，了解更多关于生物学的细节。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="me mf l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mg"><img src="../Images/4c447de4303bb5eeba59e7ccdff92dcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FHqjjU2GpWPR20-JIk3QIQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">原始数据的摘录，其中列对应于基因，行是单个细胞；注意零的大量存在。作者图片</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="me mf l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/5d399f0a107316149e657197205bbea4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jHtd_hLEix-PIr3xwMtpsQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将MAGIC应用于神经元分化的scRNA-seq数据集的结果。(左)插补前的像元散点图。(右)用魔法插补后的细胞散点图。作者图片</p></figure><p id="3f59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看一下这些图，x轴是神经元中表达的基因的mRNA丰度，称为VSNL1y轴是一个叫做RUNX1T1的基因的mRNA丰度，它出现在前体细胞类型中。每个点都是一个单独的细胞，由另一种叫做RBFOX1的神经元标记的表达来着色。我们预计随着细胞沿x轴转化为神经元，RUNX1T1的表达会有明显的下降趋势，RBFOX1的表达证实了这一点。左图太吵了，无法欣赏这一趋势，但右图用魔法插补成功地再现了这一生物现象。</p><p id="6f17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以使用PHATE可视化原始数据和估算数据，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="me mf l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mi"><img src="../Images/4563b3f8e82a1163ade595fa2b6961e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2O1z3hKTwY3w_yJoes7A8A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">原始(左)和估算(右)数据集之间的PHATE比较。作者图片</p></figure><p id="8934" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，细胞根据RBFOX1 mRNA的表达被着色，我们可以在右边的图中看到一个清晰的梯度，因为细胞变成了神经元。</p><h1 id="2ba0" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">结论</h1><p id="4570" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在本文中，我们学习了MAGIC，这是一种简单而有效的去噪方法。虽然在设计时考虑了生物数据，但这种方法也可以应用于其他类型的数据，其中缺失值和噪声也可能是常见的。值得注意的是，在选择幂马尔可夫矩阵的指数<em class="lw"> t </em>时应该小心。指数过高会导致过度平滑，这会消除现有的生物变异，导致下游分析得出错误的结论。为此，对它的常见批评强调了它如何不区分真正的生物零和假阳性，而是转换整个矩阵，而不仅仅是丢失的值。然而，我欣赏这个算法的一点是，从数学的角度来看，它是多么的简单和优雅。单细胞生物学中的插补领域是一个非常受欢迎的分支学科，在过去的几年里，它催生了大量的算法(下面的参考文献中列出了一些例子)，MAGIC是开创性的方法之一，至今仍被<a class="ae ky" href="https://scholar.google.com/scholar?cites=17010796872179619829&amp;as_sdt=5,34&amp;sciodt=0,34&amp;hl=en" rel="noopener ugc nofollow" target="_blank">广泛应用于该领域</a>。</p></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><p id="bbd2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您阅读这篇文章。如果您还不是中级会员，请考虑在此注册，以便充分使用该平台提供的所有功能:</p><div class="nn no gp gr np nq"><a href="https://medium.com/@jashahir?source=entity_driven_subscription-56690d914eaf------------------------------------" rel="noopener follow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd iu gy z fp nv fr fs nw fu fw is bi translated">贾姆沙伊德·沙希尔-培养基</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">阅读Jamshaid Shahir在媒体上的文章。计算生物学博士生。享受通过数据探索世界…</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">medium.com</p></div></div><div class="nz l"><div class="oa l ob oc od nz oe ks nq"/></div></div></a></div><h2 id="dd1c" class="of mk it bd ml og oh dn mp oi oj dp mt li ok ol mv lm om on mx lq oo op mz oq bi translated">参考资料:</h2><p id="2701" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">[1] D. van Dijk，R. Sharma，j . nay ns，K. Yim，P. Kathail，A. J. Carr，C. Burdziak，K. R. Moon，C. L. Chaffer，D. Pattabiraman，B. Bierie，L. Mazutis，G. Wolf，S. Krishnaswamy，D. Pe'er，<a class="ae ky" href="https://www.cell.com/cell/fulltext/S0092-8674(18)30724-4" rel="noopener ugc nofollow" target="_blank">利用数据扩散从单细胞数据中恢复基因相互作用</a> (2018)，<em class="lw">细胞</em> <br/> [2] 以及S. Krishnaswamy，<a class="ae ky" href="https://www.nature.com/articles/s41587-019-0336-3" rel="noopener ugc nofollow" target="_blank">将高维生物数据中的结构和跃迁可视化</a> (2019)，<em class="lw">Nature Biotechnology</em><br/>【3】m . Huang，J. Wang，E. Torre，H. Dueck，S. Shaffer，R. Bonasio，J. I. Murray，A. Raj，M. Li和N. R. Zhang，<a class="ae ky" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6030502/" rel="noopener ugc nofollow" target="_blank"> SAVER:用于单细胞RNA测序的基因表达恢复(2018) </a>，<em class="lw"> Nature <a class="ae ky" href="https://www.nature.com/articles/s41467-018-03405-7" rel="noopener ugc nofollow" target="_blank">单细胞RNA-seq数据的精确稳健插补方法sci compute</a>(2018)<em class="lw">Nature communication s</em><br/>【5】g . La Manno、R. Soldatov、A. Zeisel、E. Braun、H. Hochgerner、V. Petukhov、K. Lidschreiber、M. E. Kastriti、p . lnnerberg、a .、J. Fan、L. E. Borm、Z. Liu</em></p></div></div>    
</body>
</html>