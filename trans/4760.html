<html>
<head>
<title>Dependency Management with Poetry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">诗歌的依赖性管理</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/dependency-management-with-poetry-f1d598591161#2022-10-22">https://towardsdatascience.com/dependency-management-with-poetry-f1d598591161#2022-10-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="27c1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用pyenv和诗歌组织Python</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d7e5ee9582f6461fcb0fff1288c1e447.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nFYnIAiisxIhfAMnBWUyuA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@clemhlrdt?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Clément Hélardot </a>在<a class="ae ky" href="https://unsplash.com/s/photos/python?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="9ea5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python的一个重要特点是管理它的版本、环境和依赖性——从而将项目交付给其他人。在本帖中，我们将看看打包和依赖管理器<a class="ae ky" href="https://python-poetry.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">诗歌</strong></a><strong class="lb iu"/>——在作者看来，这是做这些事情的最佳方式。</p><p id="161a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在开始之前，让我们定义一些术语并澄清一些困惑，这也是我最初的受害者:除了诗歌，我们将使用<a class="ae ky" href="https://github.com/pyenv/pyenv" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">pyenv</strong></a><strong class="lb iu"/>——一个Python安装管理器。pyenv允许我们在我们的系统s.t .上管理不同的Python版本。例如，我们可以在项目A中使用Python 2.7，在项目B中使用Python 3.10——此外，如果我们只是通过<code class="fe lv lw lx ly b">pip install ...</code>将所有需要的包安装到我们的系统Python中，还可以防止我们的Python安装受到污染。</p><p id="4bdf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除此之外，还有不同的打包和依赖管理器——比如poem，但也有pipenv、venv或conda。在这篇文章中，我们将强调诗歌，正如我之前提到的，我个人认为这是最好的解决方案。</p><h1 id="c3ab" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">安装Pyenv</h1><p id="9e1b" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">我们首先安装pyenv(假设您在Linux机器上，对于所有其他操作系统，请遵循<a class="ae ky" href="https://github.com/pyenv/pyenv" rel="noopener ugc nofollow" target="_blank">安装指南</a>):</p><pre class="kj kk kl km gt mw ly mx my aw mz bi"><span id="b02c" class="na ma it ly b gy nb nc l nd ne">curl <a class="ae ky" href="https://pyenv.run" rel="noopener ugc nofollow" target="_blank">https://pyenv.run</a> | bash</span></pre><p id="5670" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，在pyenv中，我们安装我们希望用于项目的Python版本，例如:</p><pre class="kj kk kl km gt mw ly mx my aw mz bi"><span id="09dc" class="na ma it ly b gy nb nc l nd ne">pyenv install -v 3.10.0</span></pre><h1 id="0af3" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">设置诗歌</h1><p id="cde0" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">按照描述安装Python后，我们将注意力转移到诗歌上。</p><p id="17aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过以下方式安装:</p><pre class="kj kk kl km gt mw ly mx my aw mz bi"><span id="f2db" class="na ma it ly b gy nb nc l nd ne">curl -sSL <a class="ae ky" href="https://install.python-poetry.org" rel="noopener ugc nofollow" target="_blank">https://install.python-poetry.org</a> | python3 -</span></pre><p id="a413" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，切换到您的Python项目文件夹，将诗歌指向您想要使用的Python版本——在我们的示例中，这是通过(您可能需要一个<code class="fe lv lw lx ly b">pyproject.toml</code>文件，见下文)完成的:</p><pre class="kj kk kl km gt mw ly mx my aw mz bi"><span id="8540" class="na ma it ly b gy nb nc l nd ne">pyenv local 3.10.0</span><span id="55db" class="na ma it ly b gy nf nc l nd ne">poetry env use $(which python)</span></pre><h1 id="5d4d" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">用诗歌工作</h1><p id="413b" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">使用两个文件的诗歌功能:<code class="fe lv lw lx ly b">pyproject.toml</code>和<code class="fe lv lw lx ly b">poetry.lock</code>。</p><p id="e0d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lv lw lx ly b">pyproject.toml</code>中，我们描述所需的依赖/包，例如<code class="fe lv lw lx ly b">torch</code>。开发人员在添加了所有需要的依赖项之后，运行<code class="fe lv lw lx ly b">poetry update</code>。</p><p id="a950" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这触发了<code class="fe lv lw lx ly b">poetry.lock</code>文件的创建，该文件“捕获”并描述了由来自<code class="fe lv lw lx ly b">pyproject.toml</code>的所有数据包组成的确切环境。现在，当用户或其他开发人员下载repo /代码时，他们只需运行<code class="fe lv lw lx ly b">poetry install</code>，这将安装所有的依赖项——导致他们获得与第一个开发人员预期的完全相同的Python环境。</p><p id="30c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个巨大的优势，也是必须的——与每个人只安装自己的依赖项相反——不这样做只会带来太多的麻烦。</p><p id="42c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用您的环境(运行脚本，…)，运行<code class="fe lv lw lx ly b">poetry shell</code>。这将激活您的环境，在其中您可以照常工作——例如通过<code class="fe lv lw lx ly b">python file.py</code>运行Python程序。</p><h1 id="3135" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">示例项目</h1><p id="8cac" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">最后，让我们将所有这些放在一个示例项目中——并且第一次公开一个示例<code class="fe lv lw lx ly b">pyproject.toml</code>文件的内容。</p><p id="6a4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的项目将由三个文件组成:<code class="fe lv lw lx ly b">main.py</code>、<code class="fe lv lw lx ly b">pyproject.toml</code>和自动生成的<code class="fe lv lw lx ly b">poetry.lock</code>文件。</p><p id="f9eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">main.py</code>有以下内容:</p><pre class="kj kk kl km gt mw ly ng bn nh ni bi"><span id="5c0d" class="nj ma it ly b be nk nl l nm ne">import matplotlib.pyplot as plt<br/>import numpy as np<br/><br/><br/>def plot():<br/>    x = np.linspace(0, 10, 50)<br/>    y = np.sin(x)<br/>    plt.plot(x, y)<br/>    plt.savefig("plot.png")<br/><br/><br/>if __name__ == "__main__":<br/>    plot()</span></pre><p id="0096" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们所看到的，我们使用<code class="fe lv lw lx ly b">numpy</code>和<code class="fe lv lw lx ly b">matplotlib</code>生成一条正弦曲线并绘制出来。因此需要安装这些模块，我们对诗歌就是这么做的。</p><p id="e63a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看<code class="fe lv lw lx ly b">pyproject.toml</code>的内容:</p><p id="d129" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一部分包含一些关于项目的元数据:</p><pre class="kj kk kl km gt mw ly ng bn nh ni bi"><span id="8e94" class="nj ma it ly b be nk nl l nm ne">[tool.poetry]<br/>name = "myproject"<br/>version = "0.1.0"<br/>description = "…"<br/>authors = ["hermanmichaels &lt;hrmnmichaels@gmail.com&gt;"]</span></pre><p id="8cd3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在此之后，是时候定义所需的依赖关系了。您也可以(建议)为每个包定义一个特定的版本，使<code class="fe lv lw lx ly b">poetry update</code>过程具有确定性。此外，这里我们还定义了预期的Python版本。下面的代码片段安装了<code class="fe lv lw lx ly b">matplotlib</code>和<code class="fe lv lw lx ly b">numpy</code>，以及其他一些我为了方便而喜欢使用的包(在以后的帖子中会有更多的介绍！):</p><pre class="kj kk kl km gt mw ly ng bn nh ni bi"><span id="d66f" class="nj ma it ly b be nk nl l nm ne">[tool.poetry.dependencies]<br/>python = "3.10"<br/>matplotlib = "3.5.1"<br/>mypy = "0.910"<br/>numpy = "1.22.3"<br/>black = "22.3.0"</span></pre><p id="45ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">综合起来看:</p><pre class="kj kk kl km gt mw ly ng bn nh ni bi"><span id="ec78" class="nj ma it ly b be nk nl l nm ne">[tool.poetry]<br/>name = "myproject"<br/>version = "0.1.0"<br/>description = "…"<br/>authors = ["hermanmichaels &lt;hrmnmichaels@gmail.com&gt;"]<br/><br/>[tool.poetry.dependencies]<br/>python = "3.10"<br/>matplotlib = "3.5.1"<br/>mypy = "0.910"<br/>numpy = "1.22.3"<br/>black = "22.3.0"</span></pre><p id="152c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上所述，为了生成<code class="fe lv lw lx ly b">poetry.lock</code>文件，我们运行<code class="fe lv lw lx ly b">poetry update</code>。然后，另一个使用这个项目的人，可以简单地运行<code class="fe lv lw lx ly b">poetry install</code>来获得我们所有的依赖项。然后，您或他们可以通过运行以下命令来执行该程序:</p><p id="8fce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">poetry shell</code></p><p id="35b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">python main.py</code></p><h1 id="7a6b" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">摘要</h1><p id="1009" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">让我们快速总结一下:诗歌是一个(在我看来是最好的)打包和依赖管理器。它建立在一个工作的Python安装之上，我建议通过Python安装管理器pyenv来管理它。</p><p id="8dfd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">按照上面的安装和设置步骤，创建一个新项目，并添加一个<code class="fe lv lw lx ly b">pyproject.toml file</code>。在此，定义所有需要的依赖项。</p><p id="0662" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，运行:</p><ul class=""><li id="f607" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated"><code class="fe lv lw lx ly b">poetry update</code>生成锁文件(或在添加了新的依赖项时更新它)，其他人将使用该文件来获取相同的数据包集</li><li id="4542" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated"><code class="fe lv lw lx ly b">poetry install</code>安装来自锁文件的所有包(例如，当你下载了一个新的诗歌项目并想安装依赖项时——或者你的同事推了一个包含新包的新版本)</li><li id="7281" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated"><code class="fe lv lw lx ly b">poetry shell</code>进入环境并运行任何Python脚本</li></ul><p id="b30c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就结束了对诗歌的介绍。希望这对您未来的工作有所帮助——欢迎随时回来获取更多信息！</p></div></div>    
</body>
</html>