<html>
<head>
<title>Functions That Return Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">返回函数的函数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/functions-that-return-functions-higher-order-functions-and-decorators-in-python-with-examples-4282742cdd3e#2022-05-04">https://towardsdatascience.com/functions-that-return-functions-higher-order-functions-and-decorators-in-python-with-examples-4282742cdd3e#2022-05-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5c3c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Python中的高阶函数和装饰器及其示例</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/440724e0815d0e4b1d6c5b347ebfe4d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1tlT0-0C0h4zrXtB"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">茱莉亚·卡德尔在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="0983" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">高阶函数</strong>是一个重要的主题，我相信你应该很好地掌握它们是如何工作的，以充分受益于Python的能力并充分利用你的代码。</p><p id="816e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将用一个例子来说明<strong class="lb iu">高阶函数，这样您可以获得它们的工作知识，然后我们将使用这些知识来<strong class="lb iu">实现一个装饰器</strong>，这是Python中高阶函数最典型的用例之一。</strong></p><p id="cf6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们开始吧！</p><blockquote class="lv lw lx"><p id="a33f" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">本帖包含部分转载自我的书内容:<strong class="lb iu"/><a class="ae ky" href="https://pytorchstepbystep.com" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">深度学习用PyTorch循序渐进:初学者指南</strong> </a> <strong class="lb iu">。</strong></p></blockquote><h1 id="7b03" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">一系列功能</h1><p id="0617" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">假设我们想要构建一个<strong class="lb iu">系列的函数</strong>，每个函数都执行给定幂的幂运算。代码应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/8303b96d94afcbabb3904b5abd3eefef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*15e6iHcw2dVE654qkaXJdA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">执行指数运算的一系列函数</p></figure><p id="b7dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嗯，很明显有一个<strong class="lb iu">更高的结构</strong>指向这个:</p><ul class=""><li id="3ef0" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated"><strong class="lb iu">每个函数都有一个参数<em class="ly"> x </em> </strong>(红色)，这是我们想要取幂的数字；</li><li id="f7a7" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><strong class="lb iu">每个函数都执行相同的运算</strong>，取幂，但是每个函数都有一个<strong class="lb iu">不同的指数</strong>(橙色框)。</li></ul><p id="2857" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">解决这个问题的一个方法是<strong class="lb iu">使指数成为显式参数</strong>，就像下面的代码一样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/f189c7db20b63b88a8de23272d30dc47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*L8l8H-y_Ru3pFpUw6YKYIw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">具有两个常规参数的典型函数</p></figure><p id="5b29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这很好，而且效果很好。但是它也要求你在每次调用函数时指定指数。<strong class="lb iu">一定还有别的办法</strong>！当然有；这就是这篇文章的目的:-)</p><h1 id="cb16" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">函数生成器</h1><p id="b85c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们需要<strong class="lb iu">构建另一个(高阶)函数来构建那些函数(正方形、立方体等。)</strong>对我们来说。(高阶)函数只是一个<strong class="lb iu">函数生成器</strong>。但是我们怎么做呢？</p><p id="3fa8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们构建我们试图生成的函数的“<em class="ly">骨架</em>；它们都<strong class="lb iu">取单个自变量<em class="ly">x</em>T5(红色)，而<strong class="lb iu">它们都执行求幂运算</strong>，每个都使用一个<strong class="lb iu">不同的指数</strong>(橙色框，不是自变量)。</strong></p><p id="6d3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好吧。它应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/62e8ca2121c2e6356e81a8e05c6b8b77.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*oXCd462XxWOHPgSQny87aA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">函数的框架有一个未定义的变量(指数)</p></figure><p id="3a0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您尝试用任何一个<strong class="lb iu"> <em class="ly"> x </em> </strong>调用这个函数<strong class="lb iu">，比如说<em class="ly">skeleton _exp幂运算(2) </em>，您会得到下面的<strong class="lb iu">错误</strong>:</strong></p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="7e34" class="nv md it nr b gy nw nx l ny nz">skeleton_exponentiation(2)</span><span id="7673" class="nv md it nr b gy oa nx l ny nz"><strong class="nr iu">Output:<br/>NameError: name ‘exponent’ is not defined</strong></span></pre><p id="cd9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是意料之中的:你的“<em class="ly">骨架</em>函数有<strong class="lb iu">不知道变量<em class="ly">指数</em>是什么</strong>！这就是高阶函数要完成的任务。</p><p id="6de6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们用一个高阶函数(蓝色)包装我们的<em class="ly">框架</em>函数，它将构建所需的函数。我们姑且称之为<em class="ly">指数构建器()</em>。</p><p id="bb8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它的参数是什么，如果有的话？嗯，我们正试图<strong class="lb iu">告诉我们的“<em class="ly">骨架</em>”函数它的指数应该是多少</strong>(橙色框)，所以让我们从那个开始吧！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/829facd63fc2970d21087ffcc1f04201.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*rmpfAH1hmtsID1afGNEoLw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">高阶函数，定义骨架函数的指数</p></figure><p id="319c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我想让你看一下(外层)<strong class="lb iu">返回语句</strong>(在蓝色函数中)。是<strong class="lb iu">而不是</strong>返回一个<strong class="lb iu">值</strong>；是<strong class="lb iu">返回了<em class="ly">骨架</em>功能，而不是</strong>。</p><blockquote class="lv lw lx"><p id="d3b7" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">这毕竟是一个函数构建器:它应该构建(并返回)函数。</p></blockquote><p id="b23e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们调用这个给定指数的高阶函数，比如说2，会发生什么？</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="f04d" class="nv md it nr b gy nw nx l ny nz">returned_function = exponentiation_builder(2)<br/>returned_function</span><span id="cfc4" class="nv md it nr b gy oa nx l ny nz"><strong class="nr iu">Output:<br/>&lt;function __main__.exponentiation_builder.&lt;locals&gt;.skeleton_<br/>exponentiation(x)&gt;</strong></span></pre><p id="6f09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">结果</strong>正如所料，是一个<strong class="lb iu">函数</strong>！</p><p id="ac50" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个函数是做什么的？它应该证明了它的论点——让我们来看看:</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="f252" class="nv md it nr b gy nw nx l ny nz">returned_function(5)</span><span id="d824" class="nv md it nr b gy oa nx l ny nz"><strong class="nr iu">Output:<br/>25</strong></span></pre><p id="140e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后<em class="ly">瞧啊</em>！我们有一个函数生成器！我们可以用它来创建尽可能多的指数函数:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/d5f3bea42e10c9bc3e58fb084776b474.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*eEKz5yfhXyH9oMD0yp_SKQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由高阶函数建立的一系列函数</p></figure><p id="b0a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没那么糟，对吧？这个概念本身非常简单，但是需要密切注意实现细节，以确保“嵌套”的函数和参数被正确定义。</p><h1 id="adb8" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">到处都有功能</h1><p id="cc76" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在，让我们更进一步:如果我们的<strong class="lb iu">高阶函数采用另一个函数作为参数，而不是常规参数(<em class="ly">指数</em>)呢？</strong></p><blockquote class="lv lw lx"><p id="f2ec" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">“等等，什么？！将另一个函数作为参数并返回第三个不同函数的函数？真的吗？”</p></blockquote><p id="63fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，完全正确！令人震惊，对吧？:-)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/2b4f40ef8d23f8dc2b54281bbe083da1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*5WzM9L99-FtdtQgm.jpg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">令人兴奋的功能！</p></figure><blockquote class="lv lw lx"><p id="4249" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">“我为什么要这么做？”</p></blockquote><p id="8ea2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为很酷！不，真的，<strong class="lb iu">(高阶)函数可以作为装饰器</strong>，并且可以用于<strong class="lb iu">修改它附加到</strong>的任何函数或方法的输出。</p><p id="1d81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">准备好了吗？让我们开始吧！</p><p id="bcde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设你写了很多函数，它们都以给定的单位返回值(比如，在美国是<em class="ly">英寸</em>，在其他地方是<em class="ly">毫米</em>)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/1cafaab5dcd13c4b50690b04eb915b22.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*f9GxhzBoqT3OKP8Eaz99Yg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">“许多”函数返回值以英寸为单位</p></figure><p id="a218" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果你被要求把你的代码发送到世界的另一个地方，那么修改你写的每一个函数<strong class="lb iu">来包含一个<strong class="lb iu">乘法因子</strong>以适应不同的单位是非常麻烦的，对吗？</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/44769c9183de20a598b76cce96057f64.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*TnyyU3X6M9TMlbMafKBrew.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">修改输出，繁琐的方式！</p></figure><blockquote class="lv lw lx"><p id="1424" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">“老实说，这看起来像是糟糕的软件工程…”</p></blockquote><p id="3ee0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，最有可能的是<strong class="lb iu">是</strong>糟糕的软件工程——理想情况下，人们会预见到以不同单位产生输出的需要，并将单位(英寸或毫米)作为一个参数，但这超出了这里的重点。</p><p id="f53a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，请继续这个虚构的故事，让我们看看如何毫不费力地修补这个虚构的代码:-)</p><p id="8a7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们知道，我们的<strong class="lb iu"> <em class="ly"> f2() </em> </strong>函数接受<strong class="lb iu">两个参数，<em class="ly"> a </em>和<em class="ly"> b </em> </strong>(红色)，执行一些操作(不管那是什么，我们不关心操作本身)，并产生一个<strong class="lb iu">结果，我们希望将该结果从英寸转换为毫米。</strong>那么，也许我们可以<strong class="lb iu">围绕<em class="ly">【F2()</em></strong>构建另一个函数<em class="ly">来执行转换？</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/23efe8a51ebd64919940591c11892603.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*P7i-DobLDvGmXpZesZc5oQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用外部函数修改输出</p></figure><p id="a077" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是这只适用于<em class="ly"> f2() </em>，我们希望有一个更通用的解决方案，所以<strong class="lb iu">让我们用一个通用函数来替换<em class="ly"> f2() </em>，<em class="ly"> func </em> () </strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/e156bbc9bbce3a6eb1110e465a7fb044.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*PKoe2QNAmgMGc_p2xEV3eA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">具有一个未定义变量(func)的通用函数</p></figure><blockquote class="lv lw lx"><p id="235f" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">“这看起来很熟悉…”</p></blockquote><p id="3e9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这很有意义，因为它非常类似于“函数构建器”一节中的“<em class="ly">框架</em>”函数。和以前一样，<strong class="lb iu">参数</strong>在<strong class="lb iu">红色</strong>中，而<strong class="lb iu">橙色框</strong>是将要执行的<strong class="lb iu">底层通用函数</strong>。</p><p id="e808" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，你能猜到如果我们用任何参数调用<em class="ly"> apply() </em>函数会发生什么吗？</p><blockquote class="lv lw lx"><p id="466a" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">“一个错误？”</p></blockquote><p id="e0a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你答对了——和之前一样的错误，一个<strong class="lb iu"> NameError </strong>，因为<strong class="lb iu"> <em class="ly"> apply() </em> </strong>函数<strong class="lb iu">不知道底层函数<em class="ly"> func </em> —是什么</strong>。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="a9e8" class="nv md it nr b gy nw nx l ny nz">apply(1, 4)</span><span id="be0e" class="nv md it nr b gy oa nx l ny nz"><strong class="nr iu">Output:<br/>NameError: name ‘func’ is not defined</strong></span></pre><p id="9f4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样的错误需要同样的解决方案:让我们用蓝色的高阶函数“包装”我们的<em class="ly"> apply() </em>函数。因为我们试图<strong class="lb iu">告诉我们的<em class="ly"> apply() </em>函数底层函数(<em class="ly"> func </em>)应该是什么</strong>(橙色框)，让我们用它作为“包装器”函数的一个参数！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/2e9f469d6604a37b58b2b559641badd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*bN3EPNc3DkOtoP8sypnGTw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">高阶函数，定义应用函数的基础函数(func)</p></figure><p id="f041" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和之前一模一样:(外部)<strong class="lb iu">返回语句</strong>(蓝色函数中)是<strong class="lb iu">返回一个函数。</strong>不同的是<strong class="lb iu">橙色框</strong>,“wrapper”函数的<strong class="lb iu">参数也是一个函数！</strong></p><blockquote class="lv lw lx"><p id="0339" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">“功能，功能，声音！”</p></blockquote><p id="71ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我听到了，太多的功能要记住…所以，让我们快速回顾一下<strong class="lb iu">四个</strong>(!)上面五行代码中的函数:</p><ul class=""><li id="c8b7" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated"><strong class="lb iu">底层</strong> <strong class="lb iu">函数</strong> : <strong class="lb iu"> <em class="ly"> func() </em> </strong>，它执行一些代码，不管那是什么，并输出一个结果，据报道以英寸为单位；</li><li id="0d4c" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">乘法函数:<em class="ly"> inches_to_mm() </em>，将一个结果从英寸转换成毫米；</li><li id="c3bf" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><strong class="lb iu">通用的“应用”函数</strong>:<em class="ly"/><strong class="lb iu"><em class="ly">apply()</em></strong>，带参数(红色)，<strong class="lb iu">执行底层函数，修改结果</strong>(转换为毫米)；</li><li id="2e58" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><strong class="lb iu">高阶“包装器”函数</strong>:<strong class="lb iu"><em class="ly">convert _ to _毫米()</em> </strong>，其中<strong class="lb iu">将我们正在尝试执行的<strong class="lb iu">的底层函数</strong>作为参数</strong>。</li></ul><blockquote class="lv lw lx"><p id="8f73" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">你还和我在一起吗？我知道这很棘手，所以花点时间把上面的结构看几遍，让它深入理解。</p></blockquote><p id="fc78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们最后使用高阶“包装器”函数来转换原始<strong class="lb iu"><em class="ly">【F2()</em></strong>函数的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/cf1525e7d2318a80109b5f7760a538c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:742/format:webp/1*4s5DuwBMQBCeWfnsm7vHOA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">原始的f2()函数</p></figure><p id="d1db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记住，<strong class="lb iu"><em class="ly">【F2()</em>函数</strong>要扮演<strong class="lb iu">底层函数</strong>的角色，也就是作为<strong class="lb iu">参数传递给“包装器”函数<em class="ly">convert _ to _毫米()</em> </strong>。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="04a9" class="nv md it nr b gy nw nx l ny nz">f2_in_millimeters = convert_to_millimeters(f2)<br/>f2_in_millimeters</span><span id="c8a7" class="nv md it nr b gy oa nx l ny nz"><strong class="nr iu">Output:<br/>&lt;function __main__.convert_to_millimeters.&lt;locals&gt;.apply(a, b)&gt;</strong></span></pre><blockquote class="lv lw lx"><p id="6efa" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><strong class="lb iu">一个函数进去，另一个函数出来！</strong></p></blockquote><p id="9ad0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们调用<strong class="lb iu"> <em class="ly"> a </em> =1 </strong>和<strong class="lb iu"> <em class="ly"> b </em> =4 </strong>的结果函数:</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="60c8" class="nv md it nr b gy nw nx l ny nz">f2_millimeters(1, 4)</span><span id="126f" class="nv md it nr b gy oa nx l ny nz"><strong class="nr iu">Output:<br/>101.6</strong></span></pre><p id="8a25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有了:101.6毫米，对应于4英寸的原始输出。</p><p id="5f50" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">但是等等，还有！</strong></p><h1 id="3166" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">装饰功能</h1><p id="8c17" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">事实证明，你甚至不需要创建另一个函数，你可以<strong class="lb iu">简单地在底层函数<em class="ly"> f2() </em>之上加上“包装器”函数<em class="ly">convert _ to _毫米()</em>，作为装饰器</strong>！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/ed8939643ad491456d80858dd5e37c51.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*1DWFFsU5gFKrN4He4MqLCw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">装饰f2()函数</p></figure><p id="b2ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您可以<strong class="lb iu">直接调用<em class="ly">F2()</em></strong>，<strong class="lb iu">装饰器将自动执行底层函数(即<em class="ly"> f2() </em>)并修改结果</strong>，因此您已经获得了以毫米为单位的输出！</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="8c8e" class="nv md it nr b gy nw nx l ny nz"><br/>f2(1, 4)</span><span id="0a3c" class="nv md it nr b gy oa nx l ny nz"><strong class="nr iu">Output:<br/>101.6</strong></span></pre><p id="5202" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很酷，对吧？</p><blockquote class="lv lw lx"><p id="7fc2" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">“好的，很酷，但是如果我想把<strong class="lb iu"> f3() </strong>的输出也转换成毫米呢？不会起作用，因为<strong class="lb iu"> f3() </strong>有三个参数！</p></blockquote><p id="c0a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接得好！为了让我们的<em class="ly">convert _ to _毫米()</em> decorator <strong class="lb iu">真正通用</strong>，我们需要<strong class="lb iu">修改内部的<em class="ly"> apply() </em>函数来接受任何参数</strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/d57c0dee779c3aa8ab1d31b8ecb31856.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*fv1tLbG-hKikDZ5EW-AJyA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一个真正通用的高阶函数，为apply函数定义底层函数(func)</p></figure><p id="cc59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你可以用这个“包装器”函数来<strong class="lb iu">修饰</strong>任何你想要的函数，<strong class="lb iu"><em class="ly">【f1()</em></strong><strong class="lb iu"><em class="ly">【F2()</em></strong><strong class="lb iu"><em class="ly">【F3()</em></strong>等等…</p><blockquote class="ol"><p id="4da2" class="om on it bd oo op oq or os ot ou lu dk translated">就这样结束了:-)</p></blockquote><p id="1deb" class="pw-post-body-paragraph kz la it lb b lc ov ju le lf ow jx lh li ox lk ll lm oy lo lp lq oz ls lt lu im bi translated">感谢你阅读这篇文章——我相信学习应该是容易的，有趣的，所以我希望你喜欢它:-)。</p><h1 id="4494" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">进一步阅读</h1><p id="0071" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">装饰者是一个很大的话题，我只是想给大家展示一下<strong class="lb iu">背后的主要思想</strong>，也就是<strong class="lb iu">修改一个底层函数的输出/行为。</strong>如果你想深入这个话题，请查看Real Python的“<a class="ae ky" href="https://realpython.com/primer-on-python-decorators/" rel="noopener ugc nofollow" target="_blank">Python Decorators入门</a>”。</p></div><div class="ab cl pa pb hx pc" role="separator"><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf"/></div><div class="im in io ip iq"><p id="f12c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ly">如果您有任何想法、意见或问题，请在下方留言或通过我的</em><a class="ae ky" href="https://bio.link/dvgodoy" rel="noopener ugc nofollow" target="_blank"><em class="ly">bio . link</em></a><em class="ly">页面联系。</em></p></div></div>    
</body>
</html>