<html>
<head>
<title>Building simple Business Intelligence Project using Azure Synapse and Power BI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure Synapse和Power BI构建简单的商业智能项目</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-simple-business-intelligence-project-using-azure-synapse-and-power-bi-39dc5246de02#2022-05-15">https://towardsdatascience.com/building-simple-business-intelligence-project-using-azure-synapse-and-power-bi-39dc5246de02#2022-05-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9f7b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Synapse和Power BI进行Spotify数据分析</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4b24cac538256e32ca7dd18b3ce37230.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fToKmWr1-pQy3btyw7cSkw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">迈克·科诺诺夫在<a class="ae ky" href="https://unsplash.com/s/photos/business-intelligence?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="e889" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我使用Azure Synapse和Power BI创建了一个非常简单的端到端商业智能(BI)项目。但是，在此之前，BI是什么？简而言之，BI是一个收集、存储、分析原始数据并将其转换为可操作的见解的过程，可帮助组织做出更好的数据驱动型决策。</p><p id="ceb4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个项目是使用Azure Synapse analytics和Spotify数据集创建的。Azure Synpase是一个统一的平台，<a class="ae ky" href="https://azure.microsoft.com/en-us/services/synapse-analytics/#:~:text=Azure%20Synapse%20Analytics%20is%20a,or%20dedicated%20options%E2%80%94at%20scale." rel="noopener ugc nofollow" target="_blank">接收、探索、准备、转换、管理和提供数据，以满足即时的BI和机器学习需求。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/e81459ea677b6b2d7aa4e1b7f0d5b8ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wCLMtIwcFX9uAJGLFpHFkQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="beca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是该项目遵循的步骤(请参考上文)，</p><ol class=""><li id="2c62" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">通过Azure Synapse笔记本从Spotify API提取数据(由Apache Spark提供支持)</li><li id="ffa1" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">使用Synapse notebook再次转换数据</li><li id="784a" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">将数据从Synapse笔记本加载到Azure数据湖</li><li id="4058" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">使用Synapse笔记本分析数据</li><li id="c254" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">将数据湖中的数据连接到Power BI并构建仪表板。</li></ol><p id="e648" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以使用Azure Synpase管道而不是笔记本来提取数据。然而，我在这个项目中使用了一个笔记本。</p><p id="ba7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我从我的synapse笔记本上复制了代码并粘贴到本文中，因为没有将Synapse笔记本嵌入到介质中的选项。拍笔记本截图对阅读没有好处。</p><p id="2535" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文不会涉及如何在Azure或任何云概念中创建Synapse笔记本。请点击<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/synapse-analytics/spark/apache-spark-development-using-notebooks" rel="noopener ugc nofollow" target="_blank">查看如何创建Synapse笔记本。</a></p><h1 id="ec04" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">先决条件</h1><ol class=""><li id="3b8d" class="lw lx it lb b lc nc lf nd li ne lm nf lq ng lu mb mc md me bi translated">Spotify客户端ID和客户端密码</li><li id="99a5" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">Azure Synapse订阅</li><li id="6835" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">超级商务智能桌面</li><li id="2247" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">基础云知识</li></ol></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="b863" class="mk ml it bd mm mn no mp mq mr np mt mu jz nq ka mw kc nr kd my kf ns kg na nb bi translated">1)从Spotipy API中提取数据</h1><p id="4e27" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">第一步是从Spotify获取ClientID和Client Secret。为此，我们需要<a class="ae ky" href="https://www.spotify.com/uk/signup" rel="noopener ugc nofollow" target="_blank">在Spotify网站</a>注册，然后<a class="ae ky" href="https://developer.spotify.com/dashboard/" rel="noopener ugc nofollow" target="_blank">创建一个应用</a>来获取ClientID和客户端秘密。</p><p id="317b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Spotify提供了SpotiPy API作为包装器，提取数据非常容易。</p><p id="f682" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Synapse Notebook中，我们可以通过文本文件添加外部python库，并将其作为一个包上传到spark池中。我将文本文件命名为<code class="fe nw nx ny nz b">requirements.txt</code>，并添加了库名。请检查<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/synapse-analytics/spark/apache-spark-manage-python-packages" rel="noopener ugc nofollow" target="_blank">文档</a>。此外，我们需要创建一个spark pool(用于计算功能)来运行synapse笔记本。请查看<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/synapse-analytics/quickstart-create-apache-spark-pool-studio" rel="noopener ugc nofollow" target="_blank">此处</a>如何在synapse studio中创建spark pool。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/ade2aee59de485c2aca0ca2829f74dd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*fgXV5nN6B8hWfYIZAoyxNw.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="615c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导入spotipy库并初始化spotipy，提供存储在名为client_id和client_secret的变量中的<code class="fe nw nx ny nz b">ClinetID</code>和<code class="fe nw nx ny nz b">Client Secret</code></p><pre class="kj kk kl km gt ob nz oc od aw oe bi"><span id="ea32" class="of ml it nz b gy og oh l oi oj"><strong class="nz iu"># Import spotipy and initialise</strong></span><span id="6e42" class="of ml it nz b gy ok oh l oi oj">import spotipy<br/>from spotipy.oauth2 import SpotifyClientCredentials<br/>client_id = 'YOUR SPOTIFY CLIENT ID'<br/>client_secret = 'YOUR SPOTIFY CLIENT SECRET ID'<br/>client_credentials_manager = SpotifyClientCredentials(client_id, client_secret)<br/>sp = spotipy.Spotify(client_credentials_manager=client_credentials_manager)</span></pre><p id="a3d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导入其他必要的库并用于可视化。</p><pre class="kj kk kl km gt ob nz oc od aw oe bi"><span id="e020" class="of ml it nz b gy og oh l oi oj"><strong class="nz iu"># Import necessary library</strong></span><span id="aca2" class="of ml it nz b gy ok oh l oi oj">import pandas as pd<br/>import numpy as np</span><span id="093f" class="of ml it nz b gy ok oh l oi oj">import chart_studio.plotly as py<br/>import chart_studio.tools as tls<br/>import plotly.express as px<br/>from plotly.offline import init_notebook_mode, iplot<br/>init_notebook_mode(connected=True)<br/>import plotly.graph_objs as go<br/>import chart_studio</span></pre><p id="d58b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Spotify API提供曲目、艺术家和曲目功能。首先，我们提取了曲目和艺术家特征。然后，我们提取轨迹特征并将它们合并成一个数据集。</p><h1 id="22f1" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">获取追踪要素</h1><p id="3121" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">Spotipy提供了一个sp.search()方法来查询轨迹要素。请在此查看<a class="ae ky" href="https://developer.spotify.com/documentation/web-api/reference/#/operations/search" rel="noopener ugc nofollow" target="_blank">文档。</a>请注意，我们一次最多只能有50首曲目，最多可以有1000条记录。我非常有兴趣看到与印度市场相关的数据，因此我只提取了与印度相关的数据。我们需要在搜索查询的market参数中提到国家代码。有关市场代码的更多详情，请<a class="ae ky" href="https://developer.spotify.com/documentation/web-api/reference/#/operations/get-available-markets" rel="noopener ugc nofollow" target="_blank">查看此处</a>。</p><pre class="kj kk kl km gt ob nz oc od aw oe bi"><span id="b47f" class="of ml it nz b gy og oh l oi oj"># Creating an empty lists for track features</span><span id="4f8c" class="of ml it nz b gy ok oh l oi oj">artist = []<br/>track = []<br/>track_popularity = []<br/>artist_id = []<br/>track_id = []<br/>length = []</span><span id="887d" class="of ml it nz b gy ok oh l oi oj">#Quering Track features</span><span id="8e2f" class="of ml it nz b gy ok oh l oi oj">for i in range(0,1000,50):</span><span id="9b72" class="of ml it nz b gy ok oh l oi oj"><strong class="nz iu"># Market = 'IN' -&gt; IN is India</strong></span><span id="54f7" class="of ml it nz b gy ok oh l oi oj">tracks = sp.search(q='year:2022', type = 'track', market = 'IN', limit = 50, offset = i)</span><span id="bc1e" class="of ml it nz b gy ok oh l oi oj">for i, j in enumerate(tracks['tracks']['items']):<br/>    artist.append(j['artists'][0]['name'])<br/>    artist_id.append(j['artists'][0]['id'])<br/>    track.append(j['name'])<br/>    track_id.append(j['id'])<br/>    track_popularity.append(j['popularity'])<br/>    length.append(j['duration_ms'])</span></pre><p id="7f3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将追踪要素转换为数据框</p><pre class="kj kk kl km gt ob nz oc od aw oe bi"><span id="b427" class="of ml it nz b gy og oh l oi oj"># Store in the dataframe</span><span id="c969" class="of ml it nz b gy ok oh l oi oj">df = pd.DataFrame({'Artist' : artist, 'Track' : track, 'Track_id' : track_id, 'Track_popularity' : track_popularity, 'Artist_id' : artist_id, 'Length' : length})</span><span id="1823" class="of ml it nz b gy ok oh l oi oj">print(df.shape)</span><span id="4720" class="of ml it nz b gy ok oh l oi oj">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/06d332ad2ea864873231f2d41440f9a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZmZQYtiJodz76-Lzb_dptQ.png"/></div></div></figure><h1 id="2d7f" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">获取艺术家特征</h1><p id="1e4b" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">现在，我们需要为上面提取的曲目添加艺术家特征。API提供了三种艺术家特征<code class="fe nw nx ny nz b">Artist popularity</code>、<code class="fe nw nx ny nz b">generes</code>和<code class="fe nw nx ny nz b">followers</code>。</p><pre class="kj kk kl km gt ob nz oc od aw oe bi"><span id="3d75" class="of ml it nz b gy og oh l oi oj"><strong class="nz iu"># Creating an empty list for artist features</strong></span><span id="d017" class="of ml it nz b gy ok oh l oi oj">artist_popularity = []<br/>genres = []<br/>followers = []</span><span id="308f" class="of ml it nz b gy ok oh l oi oj">for i in artist_id:<br/>    artist = sp.artist(i)<br/>    artist_popularity.append(artist['popularity'])<br/>    genres.append(artist['genres'])<br/>    followers.append(artist['followers']['total'])</span><span id="ff11" class="of ml it nz b gy ok oh l oi oj"><strong class="nz iu">#Assigning the above features into dataframe 'df'</strong></span><span id="fe69" class="of ml it nz b gy ok oh l oi oj">df = df.assign(Artist_Popularity = artist_popularity, Genres = genres, Followers= followers)<br/>df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/420d000f490aeb544c9d79511996b8f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V0egpBqQE1RLq0txmFVjiA.png"/></div></div></figure><h1 id="8671" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">提取轨迹数字特征</h1><p id="6402" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">最后，提取上述轨迹的数字特征。获得这些数字特征既容易又简单。请查看<a class="ae ky" href="https://developer.spotify.com/documentation/web-api/reference/#/operations/get-audio-features" rel="noopener ugc nofollow" target="_blank">文档</a>了解特性详情。有兴趣看看这些功能<code class="fe nw nx ny nz b">danceability, energy, loudness, speechiness, acousticness, liveness, valence and tempo</code>。</p><pre class="kj kk kl km gt ob nz oc od aw oe bi"><span id="bf14" class="of ml it nz b gy og oh l oi oj"><strong class="nz iu">#Creating a empty list</strong></span><span id="48d1" class="of ml it nz b gy ok oh l oi oj">track_features = []</span><span id="61dd" class="of ml it nz b gy ok oh l oi oj"><strong class="nz iu">#Extracting the track features by looping into track id and creating a new dataframe called "tfeatures"</strong></span><span id="92d9" class="of ml it nz b gy ok oh l oi oj">for i in df['Track_id']:<br/>    feature = sp.audio_features(i)<br/>    track_features.append(feature)<br/>tfeatures = pd.DataFrame(columns = ['danceability', 'energy', 'key', 'loudness', 'mode', 'speechiness', 'acousticness', 'instrumentalness', 'liveness', 'valence', 'tempo', 'type', 'id', 'uri', 'track_href', 'analysis_url', 'duration_ms', 'time_signature'])<br/>for j in track_features:<br/>    for k in j:<br/>        tfeatures = tfeatures.append(k, ignore_index=True)<br/>tfeatures.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/69a8f01da6dbde6dd79bbecc6c2a1694.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_VvT3fwfgWK-8Hi6a_oFrQ.png"/></div></div></figure><p id="0fac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们完成了从API中提取数据。下一步是转换数据。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="c18d" class="mk ml it bd mm mn no mp mq mr np mt mu jz nq ka mw kc nr kd my kf ns kg na nb bi translated">2)转换数据</h1><p id="adad" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">做了如下的小改造，</p><ol class=""><li id="7c12" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">将曲目、艺术家和曲目数字特征合并到一个数据框中。</li><li id="4f0b" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">删除不需要的列。</li><li id="0ca0" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">大写的艺术家和轨道功能；也改变了数据类型。</li><li id="700d" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">将持续时间列从毫秒转换为分钟。</li></ol><pre class="kj kk kl km gt ob nz oc od aw oe bi"><span id="322a" class="of ml it nz b gy og oh l oi oj"><strong class="nz iu"># Merging Track and Audio Features and stored in 'df1'</strong></span><span id="b94c" class="of ml it nz b gy ok oh l oi oj">df1 = pd.merge(df, tfeatures, how = 'inner', left_on = 'Track_id', right_on = 'id')</span><span id="4367" class="of ml it nz b gy ok oh l oi oj"><strong class="nz iu"># Dropping the unwanted features</strong></span><span id="6813" class="of ml it nz b gy ok oh l oi oj">df1 = df1[['Artist', 'Track', 'Track_id', 'Track_popularity', 'Artist_id','Artist_Popularity', 'Genres', 'Followers', 'danceability','energy', 'key', 'loudness', 'mode', 'speechiness', 'acousticness','instrumentalness', 'liveness', 'valence', 'tempo', 'duration_ms']]</span><span id="4605" class="of ml it nz b gy ok oh l oi oj"><strong class="nz iu">#Capitalizing the Artist and Track</strong></span><span id="13bc" class="of ml it nz b gy ok oh l oi oj">df1['Artist'] = df1['Artist'].str.capitalize()<br/>df1['Track'] = df1['Track'].str.capitalize()</span><span id="a09c" class="of ml it nz b gy ok oh l oi oj"><strong class="nz iu"># Changing the data type</strong></span><span id="84e6" class="of ml it nz b gy ok oh l oi oj">df1['key'] = df1['key'].astype(int)<br/>df1['mode'] = df1['mode'].astype(int)<br/>df1['instrumentalness'] = df1['instrumentalness'].astype(float)<br/>df1['duration_ms'] = df1['duration_ms'].astype(int)</span><span id="d4e8" class="of ml it nz b gy ok oh l oi oj"><strong class="nz iu"># Duration_ms in milliseconds. Convert into minutes</strong></span><span id="c230" class="of ml it nz b gy ok oh l oi oj">df1['duration_ms'] = df1.apply(lambda x: round(x['duration_ms']/60000,2), axis=1)</span></pre></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="aaee" class="mk ml it bd mm mn no mp mq mr np mt mu jz nq ka mw kc nr kd my kf ns kg na nb bi translated">3)将数据加载到Azure数据湖中</h1><p id="8ea3" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">将数据帧<code class="fe nw nx ny nz b">df1</code>作为名为<code class="fe nw nx ny nz b">spotify.csv</code>的CSV文件存储到Azure Data Lake中</p><p id="ed0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要将我们的<code class="fe nw nx ny nz b">spotify.csv</code>写入数据湖，这非常简单&amp;只需一行代码。请注意，您需要有写权限才能将数据保存到数据湖中。</p><p id="a834" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nw nx ny nz b">abfss://your_container_name@your_storage_account_name.dfs.core.windows.net/filepath</code></p><p id="1903" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我的容器名是<code class="fe nw nx ny nz b">spotify</code>，我的存储帐户名是<code class="fe nw nx ny nz b">storagegen2dstest</code></p><pre class="kj kk kl km gt ob nz oc od aw oe bi"><span id="6a97" class="of ml it nz b gy og oh l oi oj"># Saving the Spotify.csv into the data lake.</span><span id="b6db" class="of ml it nz b gy ok oh l oi oj">df1.to_csv('abfss://spotify@<!-- -->storagegen2dstest<!-- -->.dfs.core.windows.net/spotify.csv', sep=',', encoding='utf-8', index=False)</span></pre><p id="72b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们完成了数据湖的数据加载。现在，我们可以开始分析了。您可以直接开始分析，而无需将数据保存到数据湖中；然而，我想保留它，因为我想以后与Power BI连接。此外，当Spotify中的数据每天发生变化时，我们可以自动执行上述提取、转换和加载操作。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="7a47" class="mk ml it bd mm mn no mp mq mr np mt mu jz nq ka mw kc nr kd my kf ns kg na nb bi translated">4)分析数据</h1><p id="939d" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">我想找到以下问题的答案，</p><blockquote class="oo op oq"><p id="e414" class="kz la or lb b lc ld ju le lf lg jx lh os lj lk ll ot ln lo lp ou lr ls lt lu im bi translated">十大榜单上有多少印度歌曲？</p><p id="be89" class="kz la or lb b lc ld ju le lf lg jx lh os lj lk ll ot ln lo lp ou lr ls lt lu im bi translated">最不流行的10首歌是什么？</p><p id="e525" class="kz la or lb b lc ld ju le lf lg jx lh os lj lk ll ot ln lo lp ou lr ls lt lu im bi translated">排名前10的流派有哪些？流行类歌曲的百分比是多少？</p><p id="13fa" class="kz la or lb b lc ld ju le lf lg jx lh os lj lk ll ot ln lo lp ou lr ls lt lu im bi translated">关注者排名前15的艺人有哪些？那里有印度艺术家吗？</p><p id="8059" class="kz la or lb b lc ld ju le lf lg jx lh os lj lk ll ot ln lo lp ou lr ls lt lu im bi translated">哪首歌最适合跳舞？</p><p id="750b" class="kz la or lb b lc ld ju le lf lg jx lh os lj lk ll ot ln lo lp ou lr ls lt lu im bi translated">在数据集中找出5位拥有多首歌曲的艺术家</p><p id="de6d" class="kz la or lb b lc ld ju le lf lg jx lh os lj lk ll ot ln lo lp ou lr ls lt lu im bi translated">音频特征之间有什么关系吗？</p></blockquote><p id="b4b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从数据湖中读取CSV。</p><pre class="kj kk kl km gt ob nz oc od aw oe bi"><span id="d1b4" class="of ml it nz b gy og oh l oi oj">df1 = pd.read_csv('abfss://spotify@<!-- -->storagegen2dstest<!-- -->.dfs.core.windows.net/spotify.csv')</span></pre><h2 id="71d6" class="of ml it bd mm ov ow dn mq ox oy dp mu li oz pa mw lm pb pc my lq pd pe na pf bi translated">十大榜单上有多少印度歌曲？</h2><pre class="kj kk kl km gt ob nz oc od aw oe bi"><span id="147e" class="of ml it nz b gy og oh l oi oj"><strong class="nz iu"># Sorting the dataframe by Track_popularity</strong><br/>df1.sort_values('Track_popularity', ascending = False, inplace = True)</span><span id="d6de" class="of ml it nz b gy ok oh l oi oj"><strong class="nz iu"># taking the Track and track_popularity and store in a seperate dataframe called "top"</strong></span><span id="7f9b" class="of ml it nz b gy ok oh l oi oj">top = df1[['Track', 'Track_popularity']]<br/>top = top.head(15)</span><span id="a8ea" class="of ml it nz b gy ok oh l oi oj"><strong class="nz iu"># Building visuals</strong></span><span id="0670" class="of ml it nz b gy ok oh l oi oj">fig = px.bar(top, x='Track', y="Track_popularity", orientation = 'v', title = "Top 10 most popular song",labels={"Track": "Track",<br/>"Track_popularity": "Track Popularity"}<br/>)<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pg ph l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="f6e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的数据与印度市场有关。我没看到前10名里有任何印度歌曲。</p><h1 id="9c88" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">最不受欢迎的歌曲是什么？</h1><pre class="kj kk kl km gt ob nz oc od aw oe bi"><span id="6298" class="of ml it nz b gy og oh l oi oj"><strong class="nz iu">#Sorting the dataframe by Track_popularity</strong></span><span id="0a09" class="of ml it nz b gy ok oh l oi oj">df1.sort_values('Track_popularity', ascending = True, inplace = True)<br/>top = df1[['Track', 'Track_popularity', 'Artist']]<br/>top = top.head(10)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/780f80c345d7b19d73a7fc152ed35a83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ovxL3RJOVLYCxMeTNivDHg.png"/></div></div></figure><p id="16a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有趣的是，在最不喜欢的10首歌曲中也没有印度歌曲。</p><h1 id="2503" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">将歌曲按流派分组，流行类有多少首？</h1><pre class="kj kk kl km gt ob nz oc od aw oe bi"><span id="b59b" class="of ml it nz b gy og oh l oi oj"><strong class="nz iu"># Taking track, Track_id, genre and store in a new dataframe called genre</strong></span><span id="eb7e" class="of ml it nz b gy ok oh l oi oj">genre = df1[['Track', 'Track_id', 'Genres']]<br/>genre = genre.explode('Genres')</span><span id="b67b" class="of ml it nz b gy ok oh l oi oj">genre['Genres'] = genre['Genres'].str.capitalize()<br/>genre = genre.groupby('Genres')['Track_id'].count()<br/>genre = genre.to_frame().reset_index()<br/>genre.sort_values('Track_id', ascending = False, inplace = True)<br/>genre = genre.head(10)</span><span id="5981" class="of ml it nz b gy ok oh l oi oj"><strong class="nz iu">#Building Visuals</strong></span><span id="dc76" class="of ml it nz b gy ok oh l oi oj">fig = px.pie(genre, values= 'Track_id', names = 'Genres', title = "Top Genres by total songs", color_discrete_sequence=px.colors.sequential.RdBu)<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pg ph l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="8bbe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">流行音乐占据了前十大流派。此外，我们可以看到许多印度流派都在名单上，如宝莱坞，德西嘻哈，电影等。将近25%的歌曲属于“流行”类。</p><h1 id="5132" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">关注者排名前15的艺术家</h1><pre class="kj kk kl km gt ob nz oc od aw oe bi"><span id="e4a4" class="of ml it nz b gy og oh l oi oj"><strong class="nz iu"># Grouping the artist and finding top 15 by followers</strong><br/>followers = df1[['Artist', 'Followers']].groupby('Artist').sum().sort_values('Followers', ascending = False).head(15).reset_index()</span><span id="9e31" class="of ml it nz b gy ok oh l oi oj"><strong class="nz iu">#Building visuals</strong></span><span id="aece" class="of ml it nz b gy ok oh l oi oj">fig = px.bar(followers, y = "Followers", x = 'Artist', orientation = 'v', title = "Top 15 Artist by Followers",labels={"Artist": "Artist","Followers": "Total Followers"})</span><span id="f4ff" class="of ml it nz b gy ok oh l oi oj">fig.show()</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pg ph l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7c25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不确定艺术家的追随者是全球计算的还是每个市场的。然而，我可以看到两位印度艺术家，像‘阿尼鲁德·拉维钱德尔’和‘A . r .拉赫曼’进入前15名。</p><h1 id="af10" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">哪首歌最适合跳舞？</h1><p id="6ef0" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">我们可以使用danceability特性来找到哪首歌最适合跳舞。可跳舞性值从0到1。如果该值为0.0，则最不适合跳舞，1最适合跳舞。</p><pre class="kj kk kl km gt ob nz oc od aw oe bi"><span id="7324" class="of ml it nz b gy og oh l oi oj"><strong class="nz iu"># Finding top song for best to dance</strong></span><span id="a7bf" class="of ml it nz b gy ok oh l oi oj">dance = df1[['Track', 'danceability']].groupby('Track').mean().sort_values('danceability', ascending = False).head(15).reset_index()</span><span id="3b1d" class="of ml it nz b gy ok oh l oi oj"><strong class="nz iu"># Building visuals</strong><br/>fig = px.bar(dance, x = 'Track', y = "danceability",  orientation = 'v', title = "Which song is the best to dance to?",labels={"Track": "Track","danceability": "Danceability"})</span><span id="5e32" class="of ml it nz b gy ok oh l oi oj">fig.show()</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pg ph l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="9dc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">印度歌曲有，但不在前5名。</p><h1 id="06a2" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">在数据集中找出5位拥有多首歌曲的艺术家</h1><pre class="kj kk kl km gt ob nz oc od aw oe bi"><span id="a7b6" class="of ml it nz b gy og oh l oi oj"><strong class="nz iu"># Finding top 5 artists with more than one song</strong><br/>number = df1[['Artist', 'Track_id']].groupby('Artist').count().sort_values('Track_id', ascending = False).head(5).reset_index()</span><span id="4af2" class="of ml it nz b gy ok oh l oi oj">number.rename(columns = {'Track_id':'Total Songs'}, inplace = True)</span><span id="1ef7" class="of ml it nz b gy ok oh l oi oj">colors=['#fae588','#f79d65','#f9dc5c','#e8ac65','#e76f51','#ef233c','#b7094c'] #color palette</span><span id="1bd8" class="of ml it nz b gy ok oh l oi oj"><strong class="nz iu"># Building Visuals</strong><br/>fig = px.treemap(number, path=['Artist'],values='Total Songs', title = "Top 5 artists with more than one song", width=800, height=400)</span><span id="2b39" class="of ml it nz b gy ok oh l oi oj">fig.update_layout(treemapcolorway = colors, #defines the colors in the treemap margin = dict(t=50, l=25, r=25, b=25))</span><span id="728e" class="of ml it nz b gy ok oh l oi oj">fig.show()<br/></span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pg ph l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="ba88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我可以看到一位印度艺术家(阿尼鲁德·拉文钱德尔)位列前五名。</p><h1 id="d0c0" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">轨迹特征的相关矩阵</h1><pre class="kj kk kl km gt ob nz oc od aw oe bi"><span id="ab4d" class="of ml it nz b gy og oh l oi oj"><strong class="nz iu"># Separating features from the dataframe</strong></span><span id="3afe" class="of ml it nz b gy ok oh l oi oj">features = df1[['danceability', 'energy','loudness', 'mode','speechiness', 'acousticness','instrumentalness', 'liveness', 'valence', 'tempo', ]]</span><span id="0af1" class="of ml it nz b gy ok oh l oi oj"><strong class="nz iu"># Finding correlation</strong><br/>df = features.corr()</span><span id="b473" class="of ml it nz b gy ok oh l oi oj"><strong class="nz iu">#Building Visuals</strong><br/>fig = go.Figure()<br/>fig.add_trace(go.Heatmap(x = df.columns,y = df.index,z = np.array(df),text=df.values,texttemplate='%{text:.2f}'))</span><span id="a1cf" class="of ml it nz b gy ok oh l oi oj">fig.update_layout(width = 800, height = 800,title = "Correlation Matrix for Track Features", coloraxis1=dict(colorscale="Plasma"))<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pg ph l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="addb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">音频特征间的相关矩阵。我没有看到这些特征之间有任何高度的相关性，也看到了负相关性。</p><p id="54fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述结果是动态的，因为Spotify API中的日常数据会根据用户发生变化。</p><p id="2309" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经在Azure Synapse笔记本上完成了上述全部分析。正如我提到的，没有将synapse笔记本嵌入介质的选项。在这里给synapse笔记本拍照不会很好看。因此，我只是复制了本文中的代码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/97be9c4553db8152ef18747df0926c6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*4IyH3goePtGbOVzauPakpw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="eb6f" class="mk ml it bd mm mn no mp mq mr np mt mu jz nq ka mw kc nr kd my kf ns kg na nb bi translated">建筑能源商务智能报告</h1><p id="4b52" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">这是一个有趣的数据集来讲故事。我只是将数据湖中的CSV文件连接到Power BI并构建了简单的报告。你可以点击查看<a class="ae ky" href="https://www.sdhilip.com/spotify-analysis-2/" rel="noopener ugc nofollow" target="_blank">互动链接。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/dcc8712050e5c3697013383a70cb2ebc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*EJFgwskwpeOTMr4uPMsfgQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="06eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以使用其他云平台来执行上述项目。我只是用Azure，因为我主要是在日常工作的基础上。如果是内部解决方案，我们可以使用Python、MySQL和Power BI。</p><p id="8dfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。</p></div></div>    
</body>
</html>