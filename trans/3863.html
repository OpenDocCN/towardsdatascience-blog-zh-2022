<html>
<head>
<title>Security Data Science: Threat Hunting from Sysmon Logs based on Zipf’s Law</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">安全数据科学:基于Zipf定律从Sysmon日志中寻找威胁</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-centric-security-threat-hunting-based-on-zipfs-law-50ad919fc135#2022-08-28">https://towardsdatascience.com/data-centric-security-threat-hunting-based-on-zipfs-law-50ad919fc135#2022-08-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f61f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">企业安全遥测中基于普适Zipfian分布的异常检测工程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5f5aeca7dc15d1e3ce9d24cb073a783a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lXxUk0GBMMg4w7vkgLWnvQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://unsplash.com/photos/okVXy9tG3KY" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>的封面照片类似Zipf定律曲线。</p></figure><p id="66e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文将关注“以数据为中心的安全”范式——利用统计知识满足网络安全需求。无论部署和环境特征如何，这种寻找威胁的方法都会产生相同的结果。我们将基于Zipf定律的统计模式，使用许多工具(如Elasticsearch或Splunk)的内置功能来定义基线活动，并评估超出基线的元素。此外，我们在Python中共享了一个端到端的基于异常的检测实现来分析Sysmon ID 1进程创建事件，并对超出基线的可执行哈希进行威胁情报分析。</p><h1 id="9e72" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">前言</h1><p id="90bd" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">从本质上讲，网络安全在目前的概念状态下似乎是无法解决的。在过去的几十年里，我们已经看到了进攻和防守技术之间永无止境的猫捉老鼠的游戏。今天，安全问题本质上是一个风险最小化的任务，整个行业通常成功的方法是避免成为最容易实现的目标之一。</p><p id="b6d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，即使是顶级组织也面临着挑战。例如，在最近的Lapsus$活动中，一个经验最少、资源一般的威胁参与者可以访问基础设施的敏感部分，如微软、NVIDIA、Okta和counting。这种情况暴露了传统安全操作中的灰色地带，如内部威胁或针对MFA旁路的弱点。</p><p id="23b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">受Dave启发，一个据称有效的方法是关注基线活动，将超出基线(OOB)的行为视为具有调查潜力:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">重点:“(..)了解基线行为至关重要”。</p></figure><p id="7945" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一个用来描述OOB元素的术语是“异常”通常，在讨论异常时，安全从业者会将注意力集中在机器学习(ML)解决方案上。但是，大部分ML炒作都是为了营销需要而人为抽成的。事实上，ML在网络安全领域有着巨大的潜力，对应用研究有着巨大的需求。然而，我们想强调的是，ML并不是最重要的，经常是不需要的，而且经常是适得其反的。</p><p id="5c2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ML挑战的出现是因为，在新奇和异常检测问题中，在像企业网络这样的多维概念空间中基线的定义具有显著的挑战性，这是许多高成本异常检测解决方案的失败之处。这并不意味着我们不能将ML算法用于无监督的安全问题。尽管如此，我还是故意在本文中省略了对基于ML的异常检测算法的讨论(一些想法在这个<a class="ae ky" href="https://twitter.com/ditrizna/status/1504430088808538112?s=20&amp;t=srgxiZAHwzkVOHQF4_lWfg" rel="noopener ugc nofollow" target="_blank"> Twitter帖子</a>中分享了)，因为我们提出了一种更直接、更受广泛支持的统计方法。</p><h1 id="fb0f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">齐夫定律</h1><p id="639f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这里我们讨论一种基于Zipf定律定义基线的具体方法。通过设计，它<em class="mu">总是</em>产生超出基线(OOB)的元素。你不能直接把它们当作警报或者欢迎警报疲劳。因此，我们讨论解决OOB价值观的各种方法。</p><p id="adee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">花哨的统计学词汇在文献中描述了<a class="ae ky" href="https://en.wikipedia.org/wiki/Zipf%27s_law" rel="noopener ugc nofollow" target="_blank">齐夫定律，但我们可以将其定义为特定封闭环境中的“一种元素分布的模式”。这种模式类似于反向指数曲线，如下图1中的紫色线所示:</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/61f182008be6d526eee8d6f4f198b406.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yp4WMvQYt4K-Yc-yY8AZxg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图一。自然语言处理(NLP)中Zipf定律的粗略概括。作者创造的形象。</p></figure><p id="2ae4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最初，Zipf定律是在自然语言处理(NLP)的范围内形成的，表示语料库中单词的分布。在上面的图1中，y轴表示字数，x轴表示按频率排序的唯一单词。例如，如果我们统计维基百科页面上出现的关于<a class="ae ky" href="https://en.wikipedia.org/wiki/Elizabeth_II" rel="noopener ugc nofollow" target="_blank">伊丽莎白二世</a>的单词，我们得到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/ddee4eb6bea273acb81ca273d2b06215.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*qq42nrpjOBiClZQfXiXvbQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图二。任意自然语言语料库中的词频。作者创造的形象。</p></figure><p id="2798" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">似乎在自然语言中，频繁出现的词(“the”、“to”、“of”、“a”、“and”等。)在文本中几乎没有意义。这样的词被称为“<em class="mu">停用词</em>”，通常在进一步的NLP处理中被省略。这就是为什么在NLP应用程序的开头经常会看到下面的代码:</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="79aa" class="nc lw it my b gy nd ne l nf ng"><strong class="my iu">import</strong> nltk<br/><strong class="my iu">from</strong> nltk.corpus <strong class="my iu">import</strong> stopwords<br/>nltk_stopwords = stopwords.words('english')</span><span id="c4d9" class="nc lw it my b gy nh ne l nf ng">words = [word <strong class="my iu">for</strong> word <strong class="my iu">in</strong> text.<strong class="my iu">split()</strong> <strong class="my iu">if</strong> word.<strong class="my iu">lower()</strong> <strong class="my iu">not in </strong>nltk_stopwords]<br/>...</span></pre><p id="846f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在NLP中，为了训练一个模型，Zipfian分布最有价值的部分是在中间的某个地方，而稀有词太独特了，不会影响训练过程。从上面的词频分布中考虑只出现一次的单词:</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="2434" class="nc lw it my b gy nd ne l nf ng">[('Tudor', 1),<br/> ('sovereign', 1),<br/> ('Jamaica', 1),<br/> ('cross', 1),<br/> ('argent', 1)]</span></pre><p id="8394" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然这些元素对NLP任务没什么兴趣，但是它们还是有点意思的，因为它们代表了超出基线的语言！我们的经验表明——这个Zipf的法律属性与防御安全问题高度相关。</p><h1 id="e4c8" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">企业模式</h1><p id="8e61" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Zipf定律代表了一种更普遍的模式，而不仅仅是英语语料库中的词频。我们在许多生产操作方面看到相同的元素外观结构。我们从代表一家中型企业的未公开安全合作伙伴网络中收集数据，具体如下:</p><ul class=""><li id="7076" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">外部出站连接<em class="mu">目的IP地址</em>来自<a class="ae ky" href="https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon#event-id-3-network-connection" rel="noopener ugc nofollow" target="_blank"> Sysmon事件ID 3 </a>事件；“外部”指非专网IP范围和非自身<a class="ae ky" href="https://www.arin.net/resources/guide/asn/" rel="noopener ugc nofollow" target="_blank">ASN</a>；</li><li id="6a3b" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">进程二进制<em class="mu">名称</em>和可移植可执行文件(PE) <em class="mu">散列</em>来自<a class="ae ky" href="https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon#event-id-1-process-creation" rel="noopener ugc nofollow" target="_blank"> Sysmon事件ID 1 </a>进程创建事件；</li><li id="77c4" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><em class="mu">用户名</em>来自账号登录<a class="ae ky" href="https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4624" rel="noopener ugc nofollow" target="_blank">事件ID 4624</a>；</li></ul><p id="fbf3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是这些数据类型在七天时间内基于计数的聚合后形成的模式(请注意，y轴是对数轴):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/dfeb3c0798807e202896c35ef97c80dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RHBD0zPTC8sgXHt49uwiXg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3。七天以来，这是四种数据类型(目标IP、可执行哈希、进程名称、用户名)的频率统计。作者创造的形象。</p></figure><p id="b61b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它们中的每一个都形成了一个已经熟悉的模式。这种方法的一个显著优点是，获取基于计数的统计数据非常简单，并且受到许多主要工具的支持。例如，您可以使用ElasticSearch的“<a class="ae ky" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-rare-terms-aggregation.html" rel="noopener ugc nofollow" target="_blank"> rare_terms </a>”聚合来收集哈希值Zipfian分布的较低尾部。考虑到我们收集流程创建事件(EventID 1)和存储在“<em class="mu"> hash.sha256 </em>”字段中的流程可执行散列，精确的Python代码收集在过去7天内出现不到100次的散列:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx mt l"/></div></figure><p id="57d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Spark中，我们可以使用<a class="ae ky" href="https://sparkbyexamples.com/spark/spark-sql-aggregate-functions/#approx-count-distinct" rel="noopener ugc nofollow" target="_blank">approx _ count _ distinct()</a>来获取相同的统计数据。在Splunk <a class="ae ky" href="https://docs.splunk.com/Documentation/Splunk/latest/SearchReference/Rare" rel="noopener ugc nofollow" target="_blank">中，罕见的</a>运算符提供了相同的结果。这将为您提供以下统计信息:</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="b107" class="nc lw it my b gy nd ne l nf ng">[{'key': '935c1861df1f4018d698e8b65abfa02d7e9037d8f68ca3c2065b6ca165d44ad2',   'doc_count': 51564},  <br/>{'key': 'fc10d47cb2dc511e648d3020a1f5789d1075be54dcacb6aa6d156f23561edf6c',   'doc_count': 25101},<br/>...</span><span id="5430" class="nc lw it my b gy nh ne l nf ng">{'key': 'd51f88c09c3ed32243bb588177c159ecc3b2578a98cb09b6959eb134386ba2af',   'doc_count': 1}</span></pre><h1 id="f440" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">检测工程框架</h1><p id="f271" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了根据这些统计数据进行威胁搜索，我们定义了一个出现计数的阈值,以调查其下的独特元素。在上面的图3中，这被可视化为一条红色虚线，表示在七天内出现10次的阈值。</p><p id="f867" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">阈值10是任意选择的，通常，该值是可配置的超参数，取决于以下细节:</p><ul class=""><li id="43ec" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">聚合窗口-与数据源同步的频率。查询窗口越大，概括越好(即基线元素出现的概率越小)。但是，您获得结果的频率较低，因此潜在的事件响应时间会增加。</li><li id="34cd" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">元素的先前频率—对于登录等不太频繁的事件，阈值可能低于流程创建事件。</li><li id="3bca" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">处理基线外元素的能力和资源。</li></ul><p id="a3eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们成功使用的一般方法可以用下面的图来表示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/5834823a135416dafe7dbb45b81513e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CyKEarQD8TjlL3u7A2q36A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4。基于Zipf定律统计的检测工程综述。作者创造的形象。</p></figure><p id="f7fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">伪代码示例:</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="eaec" class="nc lw it my b gy nd ne l nf ng">instantiate_database()</span><span id="0089" class="nc lw it my b gy nh ne l nf ng">while True:<br/>    stats = get_count_data()</span><span id="f861" class="nc lw it my b gy nh ne l nf ng">    for element,count in stats:<br/>        if count &lt; THRESHOLD and not_in_database():<br/>            is_malicious = analyze()<br/>            if is_malicious:<br/>                report()</span><span id="477c" class="nc lw it my b gy nh ne l nf ng">        put_in_database()</span><span id="fec8" class="nc lw it my b gy nh ne l nf ng">    sleep(QUERY_WINDOW)</span></pre><h2 id="54e5" class="nc lw it bd lx nz oa dn mb ob oc dp mf li od oe mh lm of og mj lq oh oi ml oj bi translated">Sysmon &amp; VirusTotal &amp; SQLite</h2><p id="c7f1" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了简洁起见，我们使用了上面的伪代码，而<a class="ae ky" href="https://gist.github.com/dtrizna/1d087913d54536fc6319a5a414da0d90" rel="noopener ugc nofollow" target="_blank">我们提供了一个在这个要点</a>中定义的现成的解决方案。</p><p id="c073" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它代表了一个使用ElasticSearch从Sysmon ID 1进行可执行哈希聚合的功能示例，并使用VirusTotal (VT) API分析OOB元素，将哈希存储在SQLite数据库中以避免冗余的API查询。</p><p id="d14c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于VT调用是一种有限的资源，因此我们在此报告该脚本对VT API进行了多少次调用的时序洞察:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/2a697c9a5537342d17c97f83dd797f54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*J9DFs8sYXGQF3hQTRpn5jQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图5。一些OOB杂凑。作者创造的形象。</p></figure><p id="785a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在自举高峰之后，API查询稳定下来并保持在较低水平，平均每小时约5个查询。</p><h2 id="03b9" class="nc lw it bd lx nz oa dn mb ob oc dp mf li od oe mh lm of og mj lq oh oi ml oj bi translated">阈值可变性</h2><p id="32eb" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">由于这是一个敏感的参数，我们报告了对该脚本在长期设置中发起的查询的深入分析，以及所有数据的比率。我们基于从一家中型企业获得的遥测数据，分析OOB元素的分析回合数的阈值可变性。以下是代表长期不同阈值下的VirusTotal API调用的时间序列:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/ec25cd62bb06310a98c2c658a8b9fff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RgzXiYlEjwO0jH2MI0KgGQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图6。每次查询的次数基于阈值选择。作者创造的形象。</p></figure><p id="ef1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没有发现显著的差异，只是在分析开始时增加了查询数量。</p><p id="da83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的检测工程框架对环境中其他数据类型的适用性表明，根据经验，设置“阈值=10”会检查所有元素的大约40%:</p><pre class="kj kk kl km gt mx my mz na aw nb bi"><span id="b08e" class="nc lw it my b gy nd ne l nf ng">destination ip, 7d: elements below threshold==10: 38.30%<br/>executable hashes, 7d: elements below threshold==10: 40.54%<br/>process names, 7d: elements below threshold==10: 42.81%<br/>usernames, 7d: elements below threshold==10: 36.04%</span></pre><p id="8645" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于比率与阈值直接相关，以下是可变阈值(x轴)对所有四种数据类型的所有值(y轴)比率的影响的直观表示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/bd6d62d8f3ddcde19bf40bfe62a51114.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*wyW6pQfd3FBQPXrZJ3gvow.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图7。调查的所有元素的比率基于不同数据类型的阈值设置。作者创造的形象。</p></figure><p id="9330" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，您可以通过了解哈希的总数量来考虑您的分析预算(例如，您的环境每月执行25k次唯一哈希)。由于将已经查询过的值存储在DB中，所以每个值只需要分析一次。</p><h1 id="874c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">替代后处理试探法</h1><p id="e41e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">除了虚拟仪器，还有无数选项可以执行半自动或全自动分析。首先，您最终可以利用那些提供威胁情报的第三方许可证(Recorder Future、FireEye、Flashpoint、Anomali、Maltego等)。)你的CISO反复要求使用。</p><p id="6a98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，聪明的内部逻辑可以产生同样重要的结果，因为OOB元素为选择性操作提供了基础，否则这些操作在完整基础架构的范围内是不实际的:</p><ul class=""><li id="6a2b" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">让你的EDR / <a class="ae ky" href="https://github.com/Velocidex/velociraptor" rel="noopener ugc nofollow" target="_blank">迅猛龙</a>对照YARA规则库检查OOB二进制(<a class="ae ky" href="https://github.com/Neo23x0/signature-base/tree/master/yara" rel="noopener ugc nofollow" target="_blank">由<a class="on oo ep" href="https://medium.com/u/2fdc032a69b3?source=post_page-----50ad919fc135--------------------------------" rel="noopener" target="_blank">弗洛里安·罗斯</a>和合著者维护的这个集合</a>是一个好的开始)；</li><li id="d211" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">在主机上执行<a class="ae ky" href="https://docs.microsoft.com/en-us/sysinternals/downloads/autoruns" rel="noopener ugc nofollow" target="_blank">autorunsc.exe</a>，对照预定义的程序列表进行检查，并在出现异常条目时发出警报；</li><li id="cae1" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">根据一个<a class="ae ky" href="https://lolbas-project.github.io/" rel="noopener ugc nofollow" target="_blank"> lolbins </a>列表查询进程名称，并逐渐过滤掉您的环境中常见的事件(基于进程的“命令行”)—警告所有其他事件；</li><li id="4bfe" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">进行<em class="mu">相关</em>分析(对ElasticSearch进行新的查询)，例如，分析具有OOB PE哈希的主机是否在执行的5-10分钟内与外部IP地址进行了网络通信，如果有，则向人工分析师发出警报。</li></ul><h1 id="3907" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="b858" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">有时，该领域的远见者提出并实现令人着迷的想法，例如，以图形为中心的活动目录(AD)安全方法，使用由<a class="on oo ep" href="https://medium.com/u/ef1838a28062?source=post_page-----50ad919fc135--------------------------------" rel="noopener" target="_blank"> SpecterOps </a>团队维护的<a class="ae ky" href="https://github.com/BloodHoundAD/BloodHound" rel="noopener ugc nofollow" target="_blank"> BloodHound </a>等工具，这极大地提高了全球广告网络的质量。或者考虑一下<a class="on oo ep" href="https://medium.com/u/b206c297df42?source=post_page-----50ad919fc135--------------------------------" rel="noopener" target="_blank">贾里德·阿特金森</a>关于重新思考MITRE TTPs的有趣想法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="9430" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们不会假装支持这样的观点。然而，我们希望这篇文章提供了安全专业人员如何在其环境中处理遥测技术的新观点，在(a)定义基线的平面和(b)如何处理OOB项目方面具有广泛的潜力。据推测，这种方法可能会照亮当代安全行动的灰色地带。</p><p id="ead4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">旁注——我们想强调的是，Zipf的法律观察并不局限于前面提到的查询和数据结构——它更普遍。我们考虑在另一篇文章中分享额外的思维平面，Zipf定律可能用于网络安全问题的基于异常的检测工程框架，但对于好奇的人来说，请考虑<a class="ae ky" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-multi-terms-aggregation.html" rel="noopener ugc nofollow" target="_blank"> multi_terms </a>聚合。</p><p id="1ee4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一个提醒，一个完整的代码在这里是<a class="ae ky" href="https://gist.github.com/dtrizna/1d087913d54536fc6319a5a414da0d90" rel="noopener ugc nofollow" target="_blank">这里是</a>，它使用本地SQLite数据库对VirusTotal实施带外哈希分析，以避免不到100行代码中的冗余查询。</p></div></div>    
</body>
</html>