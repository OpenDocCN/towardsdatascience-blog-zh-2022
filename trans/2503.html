<html>
<head>
<title>How to Filter Pandas DataFrames Using ‘in’ and ‘not in’</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用“在”和“不在”筛选熊猫数据帧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pandas-in-notin-ff2415f1e3e1#2022-05-31">https://towardsdatascience.com/pandas-in-notin-ff2415f1e3e1#2022-05-31</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="a794" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">理解相当于SQL“in”和“not in”表达式的熊猫</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/f6f764f658b81bf296f7e999fd543556.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*si7LxRjcl2zKyrJCRR4zZA.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">丹尼尔·利维斯·佩鲁西在<a class="ae kz" href="https://unsplash.com/s/photos/object?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><h2 id="fe06" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">介绍</h2><p id="26a7" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">在pandas中处理数据帧时，我们通常需要根据某些条件来过滤行，比如某列的行值是否在某组指定值中(或者不在其中)。您可以将这样的表达式想象成对同一列有多个<code class="fe mp mq mr ms b">OR</code>操作符。</p><p id="8723" class="pw-post-body-paragraph lw lx iu ly b lz mt jv mb mc mu jy me lj mv mg mh ln mw mj mk lr mx mm mn mo in bi translated">在今天的简短教程中，我们将展示如何使用相当于SQL <code class="fe mp mq mr ms b">IN</code>和<code class="fe mp mq mr ms b">NOT IN</code>表达式的熊猫。此外，我们还将讨论如何在一个熊猫表达式中组合这些条件。</p></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><p id="3f20" class="pw-post-body-paragraph lw lx iu ly b lz mt jv mb mc mu jy me lj mv mg mh ln mw mj mk lr mx mm mn mo in bi translated">首先，让我们创建一个示例数据框架，我们将在本教程中使用它来演示一些概念。</p><pre class="kk kl km kn gu nf ms ng nh aw ni bi"><span id="0309" class="la lb iu ms b gz nj nk l nl nm">import pandas as pd</span><span id="7d53" class="la lb iu ms b gz nn nk l nl nm">df = pd.DataFrame(<br/>    [<br/>        (1, 'A', 10, True),<br/>        (2, 'B', 12, False),<br/>        (3, 'B', 21, False),<br/>        (4, 'C', 18, False),<br/>        (5, 'A', 13, True),<br/>        (6, 'C', 42, True),<br/>        (7, 'B', 19, True),<br/>        (8, 'A', 21, False),<br/>    ],<br/>    columns=['colA', 'colB', 'colC', 'colD']<br/>)</span><span id="3c36" class="la lb iu ms b gz nn nk l nl nm">print(df)</span><span id="5d3d" class="la lb iu ms b gz nn nk l nl nm"><strong class="ms iv"><em class="no">   colA colB  colC   colD<br/></em></strong>0     1    A    10   True<br/>1     2    B    12  False<br/>2     3    B    21  False<br/>3     4    C    18  False<br/>4     5    A    13   True<br/>5     6    C    42   True<br/>6     7    B    19   True<br/>7     8    A    21  False</span></pre></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><h2 id="2148" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">熊猫相当于SQL <code class="fe mp mq mr ms b">IN</code>表达式</h2><p id="cb40" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated"><code class="fe mp mq mr ms b"><a class="ae kz" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.isin.html" rel="noopener ugc nofollow" target="_blank">pandas.Series.isin()</a></code>方法，是相当于SQL中众所周知的<code class="fe mp mq mr ms b">IN</code>表达式的熊猫。该方法返回一个布尔值<code class="fe mp mq mr ms b">Series</code>,指示元素是否包含在指定的值中。</p><p id="6ea9" class="pw-post-body-paragraph lw lx iu ly b lz mt jv mb mc mu jy me lj mv mg mh ln mw mj mk lr mx mm mn mo in bi translated">例如，让我们假设在我们的示例数据帧中，我们希望只保留在列<code class="fe mp mq mr ms b">colB</code>中具有值<code class="fe mp mq mr ms b">A</code>或<code class="fe mp mq mr ms b">C</code>的行。为此，我们可以使用通过<code class="fe mp mq mr ms b">isin()</code>方法获得的结果对数据帧进行切片，如下所示:</p><pre class="kk kl km kn gu nf ms ng nh aw ni bi"><span id="fc2a" class="la lb iu ms b gz nj nk l nl nm">df = df[df.colB.isin(['A', 'C'])]</span><span id="a2e1" class="la lb iu ms b gz nn nk l nl nm">print(df)<br/><strong class="ms iv"><em class="no">   colA colB  colC   colD</em></strong><br/>0     1    A    10   True<br/>3     4    C    18  False<br/>4     5    A    13   True<br/>5     6    C    42   True<br/>7     8    A    21  False</span></pre></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><h2 id="3955" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">熊猫相当于SQL <code class="fe mp mq mr ms b">NOT IN</code>表达式</h2><p id="0dfb" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">同样，我们可以简单地否定来自<code class="fe mp mq mr ms b">isin()</code>方法的结果，以获得与<code class="fe mp mq mr ms b">NOT IN</code>表达式等价的熊猫。<code class="fe mp mq mr ms b">~</code>求反运算符可用于实现这一点。</p><p id="5c07" class="pw-post-body-paragraph lw lx iu ly b lz mt jv mb mc mu jy me lj mv mg mh ln mw mj mk lr mx mm mn mo in bi translated">现在让我们假设我们想要过滤掉在列<code class="fe mp mq mr ms b">colB</code>中具有值<code class="fe mp mq mr ms b">A</code>或<code class="fe mp mq mr ms b">C</code>的所有行。下面的表达式可以解决这个问题。</p><pre class="kk kl km kn gu nf ms ng nh aw ni bi"><span id="b234" class="la lb iu ms b gz nj nk l nl nm">df = df[~df.colB.isin(['A', 'C'])]</span><span id="e2c6" class="la lb iu ms b gz nn nk l nl nm">print(df)<br/><strong class="ms iv"><em class="no">   colA colB  colC   colD<br/></em></strong>1     2    B    12  False<br/>2     3    B    21  False<br/>6     7    B    19   True</span></pre></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><h2 id="f6a2" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">将条件应用于多列</h2><p id="7b76" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">现在让我们假设我们想要在熊猫数据帧上组合多个条件。我们可以使用逻辑AND运算符<code class="fe mp mq mr ms b">&amp;</code>将所有的连接起来。举个例子，</p><pre class="kk kl km kn gu nf ms ng nh aw ni bi"><span id="cfc8" class="la lb iu ms b gz nj nk l nl nm">df = df[df.colB.isin(['A', 'C']) &amp; df.colC.isin([10, 13, 16])]</span><span id="0e66" class="la lb iu ms b gz nn nk l nl nm">print(df)<br/><strong class="ms iv"><em class="no">   colA colB  colC  colD<br/></em></strong>0     1    A    10  True<br/>4     5    A    13  True</span></pre></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><h2 id="99dc" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">isin()方法的替代方法</h2><p id="8006" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">另一种方法是使用<code class="fe mp mq mr ms b">query()</code>方法，让您指定类似SQL的表达式。</p><pre class="kk kl km kn gu nf ms ng nh aw ni bi"><span id="925c" class="la lb iu ms b gz nj nk l nl nm">vals_to_keep = ['A', 'B']<br/>df = df.query('colB in @vals_to_keep')</span><span id="0677" class="la lb iu ms b gz nn nk l nl nm">print(df)<br/><strong class="ms iv"><em class="no">   colA colB  colC   colD<br/></em></strong>0     1    A    10   True<br/>1     2    B    12  False<br/>2     3    B    21  False<br/>4     5    A    13   True<br/>6     7    B    19   True<br/>7     8    A    21  False</span></pre><p id="35bf" class="pw-post-body-paragraph lw lx iu ly b lz mt jv mb mc mu jy me lj mv mg mh ln mw mj mk lr mx mm mn mo in bi translated">同样，我们也可以使用<code class="fe mp mq mr ms b">not in</code>表达式:</p><pre class="kk kl km kn gu nf ms ng nh aw ni bi"><span id="c809" class="la lb iu ms b gz nj nk l nl nm">vals_to_drop = ['A', 'B']<br/>df = df.query('colB not in @vals_to_keep')</span><span id="cd99" class="la lb iu ms b gz nn nk l nl nm">print(df)<br/><strong class="ms iv"><em class="no">   colA colB  colC   colD<br/></em></strong>1     2    B    12  False<br/>2     3    B    21  False<br/>6     7    B    19   True</span></pre><p id="adb2" class="pw-post-body-paragraph lw lx iu ly b lz mt jv mb mc mu jy me lj mv mg mh ln mw mj mk lr mx mm mn mo in bi translated">注意，SQL表达式是区分大小写的，所以如果您改为指定<code class="fe mp mq mr ms b">IN</code>或<code class="fe mp mq mr ms b">NOT IN</code>(即大写字符)，您将以<code class="fe mp mq mr ms b">SyntaxError</code>结束。</p></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><h2 id="78f3" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">最后的想法</h2><p id="f311" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">在今天的文章中，我们讨论了相当于SQL <code class="fe mp mq mr ms b">IN</code>和<code class="fe mp mq mr ms b">NOT IN</code>表达式的熊猫。在过滤掉不符合指定标准的数据帧行时，这样的条件可能非常有用。</p><p id="0374" class="pw-post-body-paragraph lw lx iu ly b lz mt jv mb mc mu jy me lj mv mg mh ln mw mj mk lr mx mm mn mo in bi translated">特别是<code class="fe mp mq mr ms b">isin()</code>表达式非常强大，因为它可以帮助您指定多个条件，为了不从结果中过滤掉，数据帧的行必须至少满足其中一个条件。换句话说，你可以认为它有多个<code class="fe mp mq mr ms b">OR</code>表达式。</p><p id="d66d" class="pw-post-body-paragraph lw lx iu ly b lz mt jv mb mc mu jy me lj mv mg mh ln mw mj mk lr mx mm mn mo in bi translated">最后，我们讨论了<code class="fe mp mq mr ms b">isin()</code>方法的替代方法，即<code class="fe mp mq mr ms b">query()</code>，它允许您在pandas数据帧上指定类似SQL的表达式。</p></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><p id="1b77" class="pw-post-body-paragraph lw lx iu ly b lz mt jv mb mc mu jy me lj mv mg mh ln mw mj mk lr mx mm mn mo in bi translated"><a class="ae kz" href="https://gmyrianthous.medium.com/membership" rel="noopener"> <strong class="ly iv">成为会员</strong> </a> <strong class="ly iv">阅读介质上的每一个故事。你的会员费直接支持我和你看的其他作家。你也可以在媒体上看到所有的故事。</strong></p><div class="np nq gq gs nr ns"><a href="https://gmyrianthous.medium.com/membership" rel="noopener follow" target="_blank"><div class="nt ab fp"><div class="nu ab nv cl cj nw"><h2 class="bd iv gz z fq nx fs ft ny fv fx it bi translated">通过我的推荐链接加入Medium-Giorgos Myrianthous</h2><div class="nz l"><h3 class="bd b gz z fq nx fs ft ny fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oa l"><p class="bd b dl z fq nx fs ft ny fv fx dk translated">gmyrianthous.medium.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og kt ns"/></div></div></a></div></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><p id="676e" class="pw-post-body-paragraph lw lx iu ly b lz mt jv mb mc mu jy me lj mv mg mh ln mw mj mk lr mx mm mn mo in bi translated"><strong class="ly iv">相关文章你可能也喜欢</strong></p><div class="np nq gq gs nr ns"><a rel="noopener follow" target="_blank" href="/how-to-merge-pandas-dataframes-221e49c41bec"><div class="nt ab fp"><div class="nu ab nv cl cj nw"><h2 class="bd iv gz z fq nx fs ft ny fv fx it bi translated">如何合并熊猫数据帧</h2><div class="nz l"><h3 class="bd b gz z fq nx fs ft ny fv fx dk translated">对熊猫数据帧执行左、右、内和反连接</h3></div><div class="oa l"><p class="bd b dl z fq nx fs ft ny fv fx dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="oh l od oe of ob og kt ns"/></div></div></a></div></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu ns"><a rel="noopener follow" target="_blank" href="/how-to-iterate-over-rows-in-a-pandas-dataframe-6aa173fc6c84"><div class="nt ab fp"><div class="nu ab nv cl cj nw"><h2 class="bd iv gz z fq nx fs ft ny fv fx it bi translated">如何迭代熊猫数据框架中的行</h2><div class="nz l"><h3 class="bd b gz z fq nx fs ft ny fv fx dk translated">讨论如何在pandas中迭代行，以及为什么最好避免(如果可能的话)</h3></div><div class="oa l"><p class="bd b dl z fq nx fs ft ny fv fx dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="oi l od oe of ob og kt ns"/></div></div></a></div></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu ns"><a rel="noopener follow" target="_blank" href="/how-to-efficiently-convert-a-pyspark-dataframe-to-pandas-8bda2c3875c3"><div class="nt ab fp"><div class="nu ab nv cl cj nw"><h2 class="bd iv gz z fq nx fs ft ny fv fx it bi translated">加快PySpark和Pandas数据帧之间的转换</h2><div class="nz l"><h3 class="bd b gz z fq nx fs ft ny fv fx dk translated">将大火花数据帧转换为熊猫时节省时间</h3></div><div class="oa l"><p class="bd b dl z fq nx fs ft ny fv fx dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="oj l od oe of ob og kt ns"/></div></div></a></div></div></div>    
</body>
</html>