<html>
<head>
<title>How to Interpret the Odds Ratio with Categorical Variables in Logistic Regression</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何解释Logistic回归中分类变量的比值比</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-interpret-the-odds-ratio-with-categorical-variables-in-logistic-regression-5bb38e3fc6a8#2022-09-17">https://towardsdatascience.com/how-to-interpret-the-odds-ratio-with-categorical-variables-in-logistic-regression-5bb38e3fc6a8#2022-09-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="271e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><strong class="ak">参考类别说明及选择正确的类别</strong></h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b5de1c28ba138b518c4193ba1812fab8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*b5SrPqpISAVOoWCU"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/ja/@dexezekiel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">德克斯·伊齐基尔</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="933c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">逻辑回归是一个非常流行的机器学习模型，一直是许多文章和博客的焦点。虽然有一些使用相对简单的数据的精彩例子，但我很难找到一篇使用分类变量作为特征的综合文章。</p><p id="0468" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为什么每个变量的一个类别在统计输出中被省略？我如何解释回归系数，即“对数优势比”，一个特定类别的变量？</p><p id="5832" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将通过涵盖以下主题来揭开这一神秘面纱:</p><p id="18c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">虚拟变量概述</strong></p><p id="f545" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">什么是参考类别，如何选择一个</strong></p><p id="1a57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">如何解释虚拟变量的比值比</strong></p><p id="da00" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将使用Python和statsmodels包(有很好的统计输出)以及一个开源的自行车旅行数据集，该数据集包含纽约市的城市自行车数据和大量派生的分类变量。从行程持续时间特性中，我生成了一个布尔目标变量，表示自行车行程是否超过20分钟，我已经武断地决定这是一次“长”行程。我们将研究哪些分类特征会显著增加或减少自行车旅行超过20分钟的几率。</p><p id="46cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们开始吧！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="faaa" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated"><strong class="ak">处理分类数据—你好虚拟变量</strong></h2><p id="cc86" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">数据变量可以是<strong class="ky ir">连续的</strong>(介于理论最小值和最大值之间的测量值，如年龄、体重)或<strong class="ky ir">分类的/离散的</strong>(固定值或分类，如工作日、性别)。分类数据不能直接用于机器学习算法，因此需要进行预处理。</p><p id="bf30" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">分类变量可以转换成数字的虚拟变量，这是一种更好的格式。这是数据被转置的地方，因此每个类别由一组二进制特征表示，指示该类别在每行数据中的存在与否。两种流行的方法是<a class="ae kv" href="https://pandas.pydata.org/docs/reference/api/pandas.get_dummies.html" rel="noopener ugc nofollow" target="_blank">熊猫get_dummies() </a>和s <a class="ae kv" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OneHotEncoder.html" rel="noopener ugc nofollow" target="_blank"> cikit-learn的OneHotEncoder() </a>。在这篇文章中，我将重点介绍pd.get_dummies方法。</p><p id="6157" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了避免多重共线性(变量之间的相关性)，大多数模型都要求从数据中删除一个哑变量。这是如何工作的？因为每行至少有一个特性类别的值(假设您已经处理了丢失的值！)，如果特性的每个虚拟变量都是0，那么默认情况下，最后一个类别必须是1。因此，可以删除一个虚拟变量。</p><p id="ba3d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那么我们如何删除一个虚拟变量呢？</p><h2 id="18c7" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated"><strong class="ak">“drop _ first”参数可能不是你的朋友</strong></h2><p id="30dc" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">我学会了在使用pd.get_dummies()创建虚拟变量时总是使用“drop_first=True”参数。这是在线学习平台涵盖的概念之一，但似乎从未深入到你使用它时实际发生的细节。</p><p id="0ffc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我注意到我不能选择哪个类别被删除。默认情况下，它总是删除按字母顺序排列的类别。这违背了所有的数据科学逻辑——当然，类别很重要，而且肯定有一些数据驱动的逻辑来挑选哪一个没有通过最终筛选？</p><p id="c713" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们来回答第一个问题。为什么删除类别很重要？</p><h2 id="3f6a" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated"><strong class="ak">参考类别</strong></h2><p id="3a67" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">被丢弃的类别被称为<strong class="ky ir">引用类别</strong>。当您解释您的模型的结果时，该类别将与所有其他类别进行比较。</p><p id="5162" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">考虑到这一点，有必要通过将逻辑回归模型与您的数据相拟合来回想您试图回答的问题。在我们的例子中，一次自行车旅行是否会超过20分钟，你想确定事件发生的几率是多少？相对于其他类别，例如一周中的某一天，您是否对特定类别的效果感兴趣？<em class="mx">(后面更有解读！)</em></p><p id="513e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，参考类别应该是允许<strong class="ky ir">更容易解释的类别，也是您最关心的类别</strong>。从数学上来说，这可能是在您的数据中具有最大代表性的类别，即代表“标准”的类别。同样，它也可能是在您的数据中意外出现的类别。</p><p id="798a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可视化你的数据可以帮助你做出决定。要素类别的频率或百分比的简单条形图有助于了解它们在数据中的分布情况。它还会揭示你可能想要研究的任何有趣或意想不到的模式。</p><p id="af8c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们考虑一下我们的纽约自行车旅行数据。我已经从每次自行车旅行的开始时间中获得了额外的特征；“工作日”,七个类别代表一周中的某一天,“日类型”表示旅行发生在工作日还是周末。对于那些骑自行车观光的人来说，你可能会认为周末(周六和周日)是骑自行车旅行时间较长的日子。事实上，我们下面的探索性可视化显示，周六的自行车旅行超过20分钟的比例似乎略高。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/edb08a02791346faa14f063fdb7d751c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c2SaTsC1LDOqEvC3lmqPsA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由作者提供，在matplotlib中创建。</p></figure><p id="446d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您的研究问题旨在解决一周中的某一天对自行车旅行超过20分钟是否有影响，您可以将参考类别设置为“周末”,以证实您的怀疑，即工作日自行车旅行超过20分钟的几率明显高于周末超过20分钟的几率。或者，您可以将您的参考类别设置为一周中的某一天，以评估相对于您选择作为参考类别的那一天，其他日子对赔率的影响。</p><p id="9f37" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其他一些挑选参考类别的策略可以在<a class="ae kv" href="https://www.theanalysisfactor.com/strategies-dummy-coding/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h2 id="3884" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated"><strong class="ak">手动选择正确的参考类别</strong></h2><p id="0294" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">因此，我们认为，有能力选择作为参考的类别是非常重要的。那么，我们如何绕过讨厌的默认drop_first参数，选择我们自己的参数呢？</p><p id="5974" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">幸运的是，你可以使用一些工具来选择合适的丢弃方式。以下代码显示了一个快速示例函数，用于确定数据集中具有最高值计数的类别，然后从数据中删除这些类别，并将它们用作引用类别。使用相同的方法，您可以修改函数来选择拥有数据集中最常见属性以外的属性的类别，以用作引用。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者代码</p></figure><p id="5cd7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太好了，现在我们有了最常见类别的列表。现在我们可以把这些从虚拟变量的数据框架中去掉。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者代码</p></figure><p id="9c73" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太好了！现在我们已经用虚拟变量准备好了数据，我们知道哪些是参考类别。我们准备运行逻辑回归！</p><h2 id="6231" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated"><strong class="ak">到赔率比</strong></h2><p id="4acd" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">我已经略微谈到了对比值比的解释，但是让我们再深入一点。在我们将逻辑回归模型拟合到我们的数据之后，查看statsmodels的输出是有帮助的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/99b7ca9fdb1909ee806d5af84c7514b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J5XYLIlGj9OqtqhrsXe-ww.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">statsmodel逻辑回归输出，图片由作者提供。</p></figure><p id="0366" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里，您可以看到左侧列出的所有特性，包括虚拟变量(省略了参考类别！)及其相应的统计数据。让我们分别关注第一列和第四列中的系数(coef)和P值(P&gt;|z)。</p><p id="b59a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该系数代表<strong class="ky ir">的对数优势比</strong>。由于<a class="ae kv" rel="noopener" target="_blank" href="/a-simple-interpretation-of-logistic-regression-coefficients-e3a40a62e8cf">这篇文章</a>有一个很棒的解释，我不会在这里赘述，但它值得做一个高层次的总结。</p><blockquote class="nc nd ne"><p id="619c" class="kw kx mx ky b kz la jr lb lc ld ju le nf lg lh li ng lk ll lm nh lo lp lq lr ij bi translated"><strong class="ky ir">几率是某件事情发生的概率超过它没有发生的概率，记为(p/(1-p </strong>))。如果自行车旅行超过20分钟的概率是25%，那么这个概率是0.25/(1-. 25)= 0.33。所以在100次自行车旅行中，有33次会超过20分钟。</p><p id="ba81" class="kw kx mx ky b kz la jr lb lc ld ju le nf lg lh li ng lk ll lm nh lo lp lq lr ij bi translated"><strong class="ky ir">比值比是两个比值之间的比率或比较，以观察它们在不同情况或条件下如何变化</strong>。特征的比值比是条件1中自行车旅行超过20分钟的比值，与条件2中自行车旅行超过20分钟的比值。</p><p id="e642" class="kw kx mx ky b kz la jr lb lc ld ju le nf lg lh li ng lk ll lm nh lo lp lq lr ij bi translated">正的比值比表明该事件更有可能发生，而负的比值比表明该事件不太可能发生。</p><p id="fe4a" class="kw kx mx ky b kz la jr lb lc ld ju le nf lg lh li ng lk ll lm nh lo lp lq lr ij bi translated">注意，系数是<strong class="ky ir">对数</strong>比值比。对数优势比的“对数”部分就是优势比的对数，因为逻辑回归使用对数函数来解决回归问题。仅仅使用<strong class="ky ir">比值比</strong>要容易得多，所以我们必须取对数比值比的<strong class="ky ir">指数</strong> (np.exp())来得到比值比。</p></blockquote><p id="70cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于分类特征或预测因素，<strong class="ky ir">比值比比较每个预测因素类别相对于参考类别</strong>的事件发生几率，假设所有其他变量保持不变。</p><p id="b680" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">好了，理论完成后，让我们来看几个例子，看看这在实践中是如何工作的。</p><p id="b7ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mx">注意。我们的引用类别是每个特性中最常见的，在我们的例子中是:</em></p><ul class=""><li id="39d7" class="ni nj iq ky b kz la lc ld lf nk lj nl ln nm lr nn no np nq bi translated"><em class="mx">[user _ type]=‘订户’(另一个选项是‘客户’，我假设是指付费乘车的非订户)</em></li><li id="9760" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated"><em class="mx">【性别】=‘男性’</em></li><li id="21b2" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated"><em class="mx">【日类型】=‘工作日’</em></li><li id="c511" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated"><em class="mx">【30岁以下】=‘30岁以上’</em></li><li id="c595" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated"><em class="mx">【工作日】=‘星期三’</em></li></ul><blockquote class="nc nd ne"><p id="62ce" class="kw kx mx ky b kz la jr lb lc ld ju le nf lg lh li ng lk ll lm nh lo lp lq lr ij bi translated"><strong class="ky ir">如果所有其他变量保持不变，给定优势比exp(1.66) = 5.28 </strong>，如果您是客户，则乘车超过20分钟的几率是订户的5倍。<em class="iq">(也许他们是在充分利用他们的车，因为他们不是固定的付费用户！)</em></p><p id="a562" class="kw kx mx ky b kz la jr lb lc ld ju le nf lg lh li ng lk ll lm nh lo lp lq lr ij bi translated"><strong class="ky ir">如果所有其他变量都不变，给定exp(0.32) = 1.37的比值比，如果你是女性，那么骑行超过20分钟的几率比男性高37%。</strong></p><p id="f45c" class="kw kx mx ky b kz la jr lb lc ld ju le nf lg lh li ng lk ll lm nh lo lp lq lr ij bi translated"><strong class="ky ir">如果所有其他变量都保持不变，给定优势比exp(-0.07) = 0.92 </strong>，如果你的年龄在30岁以下，那么骑行超过20分钟的几率比30岁以上的人低8%。</p><p id="5eef" class="kw kx mx ky b kz la jr lb lc ld ju le nf lg lh li ng lk ll lm nh lo lp lq lr ij bi translated"><strong class="ky ir">在工作日或周末，如果所有其他变量保持不变，超过20分钟的乘车几率几乎不变，给定的几率比为exp(0.002) = 1.003 </strong>。</p></blockquote></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="b758" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，我们有它！我希望这有助于解释更多关于在逻辑回归中使用分类特征的问题，并且1)你应该关心你使用的参考类别，2)你有选择的权力，3)对于分类变量来说，优势比并不是很难把握。</p><p id="412c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在我的GitHub库<a class="ae kv" href="https://github.com/lucydickinson/datascience/tree/main/Logistic%20regression%20with%20categorical%20variables" rel="noopener ugc nofollow" target="_blank">这里</a>看到我的全部代码。感谢阅读:)</p></div></div>    
</body>
</html>