<html>
<head>
<title>Processing SCADA Alarm Data Records Offline with ELK</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用ELK离线处理SCADA报警数据记录</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/processing-scada-alarm-data-records-offline-with-elk-4ad509ef97d3#2022-04-28">https://towardsdatascience.com/processing-scada-alarm-data-records-offline-with-elk-4ad509ef97d3#2022-04-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4b33" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">工业自动化的开源工具</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/200616f09a5b7bcc0cf80db1b54dfd0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RWSIMcFmrGCcjUyv92-obQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">米卡·鲍梅斯特在<a class="ae ky" href="https://unsplash.com/s/photos/data-processing?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="f1ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文是我们使用开源数据科学工具来分析SCADA系统产生的警报和事件日志的系列文章的继续。</p><p id="f18c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是本系列的第三篇文章，包括以前的文章，</p><ol class=""><li id="31ac" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/processing-scada-alarm-data-offline-with-elk-7ab9b475ffb9">与ELK离线处理SCADA报警数据</a></li><li id="1419" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/scada-alarm-standards-metrics-56512db128b0"> SCADA报警标准&amp;指标</a></li></ol><p id="3023" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<a class="ae ky" rel="noopener" target="_blank" href="/processing-scada-alarm-data-offline-with-elk-7ab9b475ffb9">使用ELK </a>离线处理SCADA报警数据中，出现了以下内容:</p><ul class=""><li id="2699" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu mj mb mc md bi translated">工业控制系统(又名SCADA系统)、其架构和用途的介绍</li><li id="6601" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">引入并安装了<a class="ae ky" href="https://www.elastic.co/" rel="noopener ugc nofollow" target="_blank">弹性搜索</a>堆栈(ELK)</li><li id="a021" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">来自商业SCADA系统的警报和事件日志被清理并加载到ELK中</li><li id="355d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">使用ElasticSearch Kibana和创建的简单仪表板完成了对原始警报事件的简单分析</li></ul><p id="c36a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<a class="ae ky" rel="noopener" target="_blank" href="/scada-alarm-standards-metrics-56512db128b0"> SCADA报警标准&amp;指标</a>中，涵盖了以下内容:</p><ul class=""><li id="9d58" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu mj mb mc md bi translated">警报管理标准</li><li id="dca6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">警报生命周期</li><li id="271d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">报警系统性能指标</li></ul><p id="9390" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我们已经去过的地方，但我们要去哪里？在本文中，我们将…</p><ul class=""><li id="f248" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu mj mb mc md bi translated">检查警报生命周期</li><li id="024a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">将报警事件处理成报警记录</li><li id="94c6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">用从报警标签中提取的有关过程区域和模块的信息增加报警记录</li><li id="847b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">用有用的统计数据增加警报记录</li></ul><p id="c4db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将使我们在后续文章中创建仪表板，使用<a class="ae ky" rel="noopener" target="_blank" href="/scada-alarm-standards-metrics-56512db128b0"> SCADA警报标准&amp;指标</a>中描述的行业标准指标来分析警报记录。</p><h1 id="3b39" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">SCADA系统</h1><p id="3c11" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">正如前一篇文章中所讨论的，SCADA是基于计算机的工业控制系统的通称。SCADA(监控和数据采集)系统可用于监测和控制工业过程，包括水处理、制造、发电站、食品和饮料等。事实上，任何使用自动化制造设备的工业过程。</p><h1 id="1f36" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">警告</h1><h2 id="01a8" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">定义</h2><p id="88eb" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">警报的目的是提醒操作员需要干预的异常或危险过程条件。</p><h2 id="da0f" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">警报生命周期</h2><p id="010a" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">下图展示了一个简化的警报生命周期，它符合IEC标准。</p><p id="1054" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于每个报警点，被监控的物理过程包含正常和异常两种状态。</p><p id="1629" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，每个报警都有两个属性，报警状态(正常|报警)和确认状态(已确认|未确认)。由于警报有两个属性，它可以在任何时候处于四种状态之一。允许的状态转换如下图所示，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7fdcd8183970f52b667d6b4fd1e703f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GCG1_YNkzYLaR-x3pgQEHQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="d6ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的时序图显示了两个信号之间的典型相互作用，并指定了三个时序值，将在后面的分析中使用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5478098a9f602a92e3d51752876266dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iZ3iH2KdPJFl-RDsj78vpw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="1a44" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">从警报日志创建警报记录</h1><p id="75e9" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们的SCADA系统生成的日志文件描述了每个状态转换(这些在<a class="ae ky" rel="noopener" target="_blank" href="/processing-scada-alarm-data-offline-with-elk-7ab9b475ffb9">使用ELK </a>离线处理SCADA报警数据中进行了分析)。为了能够执行更详细的警报分析(如<a class="ae ky" rel="noopener" target="_blank" href="/scada-alarm-standards-metrics-56512db128b0"> SCADA警报标准&amp;指标</a>中所述),状态转换事件将被处理，我们将为每个警报的整个生命周期生成一个警报记录。</p><h2 id="80e5" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">报警日志的格式</h2><p id="97ea" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我手头的报警日志文件是由施耐德电气CitectSCADA产品生成的。这些文件最初是空格分隔的文本文件，我们之前已经将其转换为CSV。下面是一个典型文件的前五条记录的示例，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5ce05d4b59d6c2228b45b6e19ff6646e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_wNDwHDi5L6owSSE84Ka-g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="a64f" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">报警记录的格式</h2><p id="ed45" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">下面是我们将存储在Elasticsearch数据库中的警报记录的定义。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/1d8e887ec5d304c3b55d18b213601a00.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*rIv_IZlC3FsuQwSTCMfFlg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4fe3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">各个字段的详细信息如下:</p><p id="d679" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">时间戳:</strong></p><p id="5fc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">发出警报时的时间戳。与<strong class="lb iu"> <em class="nu"> raiseTime </em> </strong>的值相同</p><p id="24cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> desc: </strong></p><p id="44bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">产生警报的设备的描述(如增压泵#1电流)</p><p id="ed1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">优先级:</strong></p><p id="b8c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">指示报警优先级的数值。对于此数据集，1–5。</p><p id="365b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">状态:</strong></p><p id="3a3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">警报确认状态。(这是处理报警事件的内部变量，不应写入报警记录)。</p><p id="1bd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> p_state: </strong></p><p id="e45e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“过程状态”对应于报警状态。(这是处理报警事件的内部变量，不应写入报警记录)。</p><p id="6e63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> a_state: </strong></p><p id="2434" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">报警状态；a、B、C或D与状态转换图对齐。(这是处理报警事件的内部变量，不应写入报警记录)。</p><p id="624a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">提出时间:</strong></p><p id="1764" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">警报激活时的时间戳。</p><p id="0a8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">确认时间:</strong></p><p id="c0ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">指示报警被确认的时间的时间戳。</p><p id="00d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> RTNTime: </strong></p><p id="2dce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">指示警报何时转换回正常状态(返回正常)的时间戳。</p><p id="ee2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> t_active </strong></p><p id="5526" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">警报处于活动状态的时间长度。</p><p id="597d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> t_ack: </strong></p><p id="454b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">警报被确认之前的时间长度。</p><p id="8877" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> t_interval: </strong></p><p id="80dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从RTN到标签再次进入报警状态的时间长度。</p><p id="7c8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">喋喋不休:</strong></p><p id="7ef7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个布尔值，表示这是一个振动警报(即每秒触发2次以上的警报)</p><p id="7b0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">稍纵即逝:</strong></p><p id="bd76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个布尔值，表示这是一个短暂的警报(即在操作员有机会采取行动之前返回到正常状态的警报)。被认为小于1秒)</p><p id="6e42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">装备_代码</strong></p><p id="e929" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">模块编号</strong></p><p id="39cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">流程编号:</strong></p><p id="0de6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">子流程_编号:</strong></p><p id="6774" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">设备_编号:</strong></p><p id="2e66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">附加的资产信息在下面的数据扩充中描述。</p><p id="de3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">标签:</strong></p><p id="5589" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">报警信号的字母数字标识符。</p><h2 id="1745" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">数据扩充</h2><p id="67dd" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">许多资产编号方案将资产数据嵌入到资产标识符中。如果提取资产标识符的各个组成部分并将其放入警报记录的各个字段中，则警报记录的分析会变得更容易。</p><p id="d81f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是在这里分析的数据中使用的方案，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/f0a095ade35a2e8df26295d370bc5220.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UOb14nhHHYbiOUHbQ3a44Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="c101" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个简单的正则表达式被用来提取这些组件，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ff14213968be82d14bdaf069fed03fea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*df787DHwO0cw3HpU5o83cw.png"/></div></div></figure><h2 id="1138" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">代码—记录创建</h2><p id="d814" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">将CSV报警事件数据转换为报警记录的代码包含在csv-2-record.py文件中，该文件可在以下<a class="ae ky" href="https://gist.github.com/patrickcberry/0b4b31902245561fbc462a6d13bf2c88" rel="noopener ugc nofollow" target="_blank">要点</a>中找到。</p><h2 id="b0fa" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">主要功能</h2><p id="1482" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">主要功能，</p><ul class=""><li id="f188" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu mj mb mc md bi translated">处理命令行输入参数</li><li id="b411" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">设置循环以迭代所有数据文件</li><li id="63b9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">将每个数据文件读入熊猫数据帧</li><li id="f29b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">使用状态机处理数据帧的每一行</li></ul><h2 id="04bf" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">数据结构</h2><p id="9916" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">由于我们需要处理多个警报日志条目，然后才能将完整的警报记录条目写出到文件中，因此我们需要一个内部数据结构来存储部分处理的警报记录。</p><p id="a238" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建了一个<a class="ae ky" href="https://gist.github.com/patrickcberry/0b4b31902245561fbc462a6d13bf2c88#file-csv-2-record-py-L19" rel="noopener ugc nofollow" target="_blank"> AlarmRecord </a>类来存储数据，该类包含一个<a class="ae ky" href="https://gist.github.com/patrickcberry/0b4b31902245561fbc462a6d13bf2c88#file-csv-2-record-py-L101" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">写出</strong> </a> <strong class="lb iu"> </strong>方法来写出数据。<a class="ae ky" href="https://gist.github.com/patrickcberry/0b4b31902245561fbc462a6d13bf2c88#file-csv-2-record-py-L19" rel="noopener ugc nofollow" target="_blank"> AlarmRecord </a>类是一个Python <a class="ae ky" href="https://docs.python.org/3/library/dataclasses.html" rel="noopener ugc nofollow" target="_blank"> @dataclass </a>是一个用于管理主要由数据组成的类的有用库。</p><p id="7024" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用一个数据变量，它是一个报警记录的字典，使用报警标签作为关键字。</p><p id="2292" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正在处理的<a class="ae ky" href="https://gist.github.com/patrickcberry/0b4b31902245561fbc462a6d13bf2c88#file-csv-2-record-py-L19" rel="noopener ugc nofollow" target="_blank">报警记录</a>存储在<a class="ae ky" href="https://gist.github.com/patrickcberry/0b4b31902245561fbc462a6d13bf2c88#file-csv-2-record-py-L101" rel="noopener ugc nofollow" target="_blank">数据变量</a>(Python<a class="ae ky" href="https://docs.python.org/3/tutorial/datastructures.html#dictionaries" rel="noopener ugc nofollow" target="_blank">字典</a>)中，由报警标签(唯一标识符)索引。</p><h2 id="c736" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">状态机</h2><p id="ac05" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">要处理报警日志条目，需要一个状态机。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7fdcd8183970f52b667d6b4fd1e703f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GCG1_YNkzYLaR-x3pgQEHQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="9e47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为只有四种状态，所以使用了it-then-else结构来创建状态机。这是可行的极限，如果有更多的状态，将需要使用更复杂的实现(例如GOF状态模式)。</p><p id="95a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将只研究两个转换。</p><p id="e2a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们处理一个报警事件，其中报警处于活动状态(on为真)且报警未被确认(ack为假)，那么从我们的报警状态转换图中我们知道我们应该转换到状态b。</p><p id="7441" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码描述了这一点，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a39d3cdb573ac3f573885b4b2ad59ad7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LpP55ROxToVTUIyiR8wqSQ.png"/></div></div></figure><p id="7ef8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们处理一个报警事件，其中报警处于活动状态(on为真)且报警被确认(ack为真)，那么从我们的报警状态转换图中我们知道我们应该从状态B转换到状态c。</p><p id="5b90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码描述了这一点，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bff8f5e1e07af967d8476c21c77b5c51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OmhtYhX6rqNAJzCPznq2aA.png"/></div></div></figure><h2 id="8666" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">加载到弹性搜索</h2><p id="fcfe" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">csv-record-2-es.py文件(在<a class="ae ky" href="https://gist.github.com/patrickcberry/0b4b31902245561fbc462a6d13bf2c88" rel="noopener ugc nofollow" target="_blank">要点</a>中有)用于将报警记录csv文件加载到<a class="ae ky" href="https://www.elastic.co/elastic-stack/" rel="noopener ugc nofollow" target="_blank">弹性搜索</a>中。</p><p id="a1ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码将所有记录读入Pandas dataframe，然后使用Python Elasticsearch库中的<strong class="lb iu"> bulk </strong> upload函数将数据加载到数据库中。</p><h1 id="52ad" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">将来的</h1><p id="8863" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">到目前为止，我们已经处理和分析了原始警报日志文件，并创建了警报记录。在<a class="ae ky" rel="noopener" target="_blank" href="/scada-alarm-standards-metrics-56512db128b0"> SCADA警报标准&amp;指标</a>中，我们看到警报管理标准为警报管理系统定义了12项性能指标。在本系列的下一篇文章中，我们将使用ELK创建仪表板，根据这12个性能标准来评估我们的系统性能。</p><h1 id="595f" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">资源</h1><p id="c7b8" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">完整的代码位于下面的<a class="ae ky" href="https://gist.github.com/patrickcberry/0b4b31902245561fbc462a6d13bf2c88" rel="noopener ugc nofollow" target="_blank">要点</a>。</p><h1 id="38eb" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">进一步阅读</h1><p id="cb81" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">感谢阅读，希望你喜欢这篇文章。</p><p id="8891" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了进一步探索，</p><ul class=""><li id="cab1" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu mj mb mc md bi translated"><a class="ae ky" href="https://patrickberry.medium.com/subscribe" rel="noopener">订阅电子邮件通知</a></li><li id="02fb" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">阅读本系列的第1部分，<a class="ae ky" rel="noopener" target="_blank" href="/processing-scada-alarm-data-offline-with-elk-7ab9b475ffb9">使用ELK离线处理SCADA报警数据</a></li><li id="031e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">阅读本系列的第2部分，<a class="ae ky" rel="noopener" target="_blank" href="/scada-alarm-standards-metrics-56512db128b0"> SCADA报警标准&amp;指标</a></li><li id="cc1e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">点击文章顶部的“关注”按钮</li><li id="baf9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">对于工业4.0的所有内容，请查看我的<a class="ae ky" href="https://medium.com/industrial-digital-transformation-industry-4-0" rel="noopener">工业数字化转型&amp;工业4.0 </a>出版物</li><li id="825e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">欢迎在LinkedIn 上加入我的社交网络(记得提到你已经读过这篇文章)</li></ul><p id="f5a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了支持中型作者，可以考虑<a class="ae ky" href="https://patrickberry.medium.com/membership" rel="noopener">订阅</a>。</p><p id="f315" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记得点击订阅和关注按钮，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/722e03486e49afcdc4f98b1057014bd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KqKMp39UrKR3R_ndpSa7iQ.png"/></div></div></figure></div></div>    
</body>
</html>