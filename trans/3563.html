<html>
<head>
<title>Debugging SageMaker Endpoints Quickly With Local Mode</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用本地模式快速调试SageMaker端点</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/debugging-sagemaker-endpoints-quickly-with-local-mode-2975bd55f6f7#2022-08-08">https://towardsdatascience.com/debugging-sagemaker-endpoints-quickly-with-local-mode-2975bd55f6f7#2022-08-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="be13" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">停止等待您的端点创建</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c31786558def8d6846005514d6dbb38e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uUAguQ8bbYdgAl0O"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://unsplash.com/@benwhitephotography" rel="noopener ugc nofollow" target="_blank">本·怀特</a>的<a class="ae ky" href="https://unsplash.com/photos/9emAQvCJQ4c" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="fef7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于经常使用<a class="ae ky" href="https://docs.aws.amazon.com/sagemaker/latest/dg/deploy-model.html" rel="noopener ugc nofollow" target="_blank"> SageMaker推论</a>的用户来说，一个常见的挫折是能够快速调试端点。通常使用<a class="ae ky" href="https://docs.aws.amazon.com/sagemaker/latest/dg/realtime-endpoints.html" rel="noopener ugc nofollow" target="_blank"> SageMaker端点</a>时，您最终会得到一个<a class="ae ky" href="https://aws.plainenglish.io/adding-custom-inference-scripts-to-amazon-sagemaker-2208c3332510" rel="noopener ugc nofollow" target="_blank">定制推理脚本</a>，帮助您控制模型的预处理和后处理。</p><p id="3931" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最初，当我第一次使用SageMaker时，每当我必须对推理脚本进行更改时，我都会重新部署端点。这很费时间，因为我会等2-3分钟，而不知道推理是否会成功。<a class="ae ky" href="https://sagemaker.readthedocs.io/en/stable/overview.html#local-mode" rel="noopener ugc nofollow" target="_blank"> SageMaker本地模式</a>幸运地通过将<a class="ae ky" href="https://github.com/aws/deep-learning-containers/blob/master/available_images.md" rel="noopener ugc nofollow" target="_blank"> SageMaker容器</a>下拉到您的本地环境来帮助我们简化这个过程。在本文中，我们将采用一个简单的SKLearn模型，并使用SageMaker本地模式部署它，以展示它对于调试您的端点是多么有用。请注意，SageMaker本地模式也可以用于预处理和训练脚本，本文将只讨论具有该特性的模型服务/推理。</p><p id="7263" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意</strong>:对于刚接触AWS的人来说，如果你想继续学习，请确保在下面的<a class="ae ky" href="https://aws.amazon.com/console/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">链接</strong> </a>中注册账户。本文假设对AWS和SageMaker相对满意。如果你想获得更多关于SageMaker入门的指导，请务必查看我的附加资源部分。</p><h2 id="b572" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">设置</h2><p id="8e7b" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在我们开始之前，我们有通常的SageMaker导入来准备我们的环境。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="45fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里主要导入的是<a class="ae ky" href="https://github.com/aws/sagemaker-python-sdk" rel="noopener ugc nofollow" target="_blank"> SageMaker Python SDK </a>，这是支持本地模式的包。这是一个高级的SDK，它是对<a class="ae ky" href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sagemaker.html" rel="noopener ugc nofollow" target="_blank"> Boto3 Python SDK </a>的包装，以简化SageMaker中的常见流程和操作。要完全理解这两个SDK的区别，请参考下面的<a class="ae ky" rel="noopener" target="_blank" href="/sagemaker-python-sdk-vs-boto3-sdk-45c424e8e250">文章</a>。</p><p id="2e92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们可以创建我们的Python Sklearn模型，我们将在本地训练一个<a class="ae ky" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html" rel="noopener ugc nofollow" target="_blank">线性回归</a>模型，并生成一个model.joblib文件，其中包含一个样本回归问题的模型工件/数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">本地模型训练</p></figure><p id="424a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们为生成的模型数据提供的另一个脚本是推理脚本。这包含了<a class="ae ky" href="https://docs.aws.amazon.com/sagemaker/latest/dg/adapt-inference-container.html" rel="noopener ugc nofollow" target="_blank">推理处理器</a>，它将控制端点内模型推理的输入和输出。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">推理脚本</p></figure><p id="de65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SageMaker希望我们的model.joblib和推理脚本中的这两个部分在一个model.tar.gz中结合在一起。我们将这些包装在一起，并将其推到一个<a class="ae ky" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank"> S3桶</a>中，供我们的本地模型拾取。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将数据推送到存储桶</p></figure><p id="e7bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们已经具备了启用本地模式所需的所有要素。</p><h2 id="39ec" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">SageMaker本地模式服务</h2><p id="7d62" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">首先我们创建一个<a class="ae ky" href="https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/local/local_session.py" rel="noopener ugc nofollow" target="_blank"> SageMaker本地会话</a>，这实际上是告诉SageMaker我们正在本地模式下工作。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">本地会话</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/a4ce912f859151ce297d35c57c477890.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g5OXXDDthgBgFazWZisyVw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">验证本地会话(作者截图)</p></figure><p id="6be3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们配置我们的SKLearn SageMaker估计器，使其启用本地模式。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">启用Sklearn服务的本地模式</p></figure><p id="cdd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们传入我们的推理脚本，然后传入带有打包模型数据的模型工件的路径。该路径可以是S3路径，也可以是本地目录结构中的文件路径。</p><p id="95a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看一个示例负载，在这种情况下，我们的模型需要一个2D数组，因此我们使用来自测试数据集的示例数据点创建了一个numpy数组。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">样本有效载荷</p></figure><p id="14ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们可以用局部模式预测器进行样本推断。注意，第一次运行下面的单元时，需要花几分钟的时间，因为需要下载SKLearn的容器映像。请注意，我们还将实例类型指定为local，而不是通常的EC2实例。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">局部模型推理</p></figure><p id="890c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来我们看到的是在端点创建期间生成<a class="ae ky" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/WhatIsCloudWatchLogs.html" rel="noopener ugc nofollow" target="_blank"> CloudWatch日志</a>时，我们通常必须等待才能看到的内容。我们看到我们的推理服务器启动并运行，我们还看到我们的样本预测。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/f0c4a39d5f040cd51409718eb3b45e88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zXd9mPitBvs-FD_lzZcWUg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">推理服务器正在启动(作者截图)</p></figure><p id="9cd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以在推理脚本中看到我们的日志记录语句，然后还可以看到示例负载的输出。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mx"><img src="../Images/3bfbfc0ec188688d1840ec528c880758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vBV5oHZi6EVFDGp4Y-JdQw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">推理日志(作者截图)</p></figure><p id="5e88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们快速地用一个错别字打破我们的推理脚本，看看本地模式是否反映了错误。</p><p id="310d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我将我的predict_fn函数改为“model.pred ”,而不是SKLearn模型所期望的“model.predict”。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">打字错误/错误</p></figure><p id="7fdb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我重新运行正在创建我的SKLearn估计器并使用我更新的脚本执行推理的单元，不久之后我看到了正确的错误反映。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/bdb7cfb518044923e1cd3b7db9172ee4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*omyyFrMQagkI0mB32qQ89A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">错误(作者截图)</p></figure><h2 id="eddb" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">其他资源和结论</h2><div class="mz na gp gr nb nc"><a href="https://github.com/RamVegiraju/SageMaker-Local-Mode/tree/master" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd iu gy z fp nh fr fs ni fu fw is bi translated">GitHub-RamVegiraju/sage maker-Local-Mode:SM本地模式示例Sklearn部署</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">github.com</p></div></div><div class="nl l"><div class="nm l nn no np nl nq ks nc"/></div></div></a></div><p id="fb6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在上面的链接中找到整个示例的代码。SageMaker本地模式是一个非常有用的特性，可以快速调试您的模型训练和推理，正如本文所反映的那样。更多本地模式示例，请查看<a class="ae ky" href="https://github.com/aws-samples/amazon-sagemaker-local-mode" rel="noopener ugc nofollow" target="_blank"> AWS样本库</a>。关于SageMaker入门的更多资源，请点击这里查看我的系列文章<a class="ae ky" href="https://ram-vegiraju.medium.com/list/amazon-sagemaker-f1b06f720fba" rel="noopener"/>。</p></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><p id="6099" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ny">如果你喜欢这篇文章，请在</em><a class="ae ky" href="https://www.linkedin.com/in/ram-vegiraju-81272b162/" rel="noopener ugc nofollow" target="_blank"><em class="ny">LinkedIn</em></a><em class="ny">上与我联系，并订阅我的媒体</em> <a class="ae ky" href="https://ram-vegiraju.medium.com/subscribe" rel="noopener"> <em class="ny">简讯</em> </a> <em class="ny">。如果你是新来的中号，用我的</em> <a class="ae ky" href="https://ram-vegiraju.medium.com/membership" rel="noopener"> <em class="ny">会员推荐</em> </a> <em class="ny">报名吧。</em></p></div></div>    
</body>
</html>