<html>
<head>
<title>How to Add New Data to a Pretrained Model in Scikit-learn</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Scikit-learn中向预训练模型添加新数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-add-new-data-to-a-pretrained-model-in-scikit-learn-ce16911afe33#2022-05-03">https://towardsdatascience.com/how-to-add-new-data-to-a-pretrained-model-in-scikit-learn-ce16911afe33#2022-05-03</a></blockquote><div><div class="fc ik il im in io"/><div class="ip iq ir is it"><h2 id="9b4b" class="iu iv iw bd b dl ix iy iz ja jb jc dk jd translated" aria-label="kicker paragraph">机器学习</h2><div class=""/><div class=""><h2 id="f97d" class="pw-subtitle-paragraph kc jf iw bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">关于如何在scikit-learn中使用warm_start=True和partial_fit()的分步教程</h2></div><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj ku"><img src="../Images/4058220778a58638e208f53bad3fa0f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vjvTh3eBicSX3b4b"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">照片由<a class="ae lk" href="https://unsplash.com/@heyerlein?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">h·海尔林</a>在<a class="ae lk" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="d547" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">当您从头开始构建机器学习模型时，通常会将数据集分为训练集和测试集，然后在训练集上训练您的模型。然后，您在测试集上测试您的模型的性能，如果您得到一些不错的东西，您可以使用您的模型进行预测。</p><p id="2d10" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated"><strong class="ln jg">但是，如果新数据在某个时候变得可用，该怎么办呢？</strong></p><p id="0c68" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">换句话说，如何训练一个已经训练好的模型？还是那句话，如何给一个已经训练好的模型添加新的数据？</p><p id="142e" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">在本文中，我试图使用scikit-learn库来回答这个重要的问题。你可以查看<a class="ae lk" rel="noopener" target="_blank" href="/when-are-you-planning-to-retrain-your-machine-learning-model-5349eb0c4706">vid hi Chugh</a>的这篇有趣的文章，了解你什么时候需要重新训练你的模型。</p><p id="3345" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">对于前一个问题，一个可能的(琐碎的)解决方案是通过使用新旧数据从头开始训练模型。然而，如果第一次训练需要很长时间，这种解决方案就不能扩展。</p><p id="3f1e" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">问题的解决方案是向已经训练好的模型中添加样本。这个scikit-learn允许你在某些情况下这样做。只要遵循一些预防措施。</p><p id="bf07" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">Scikit-learn提出了两种策略:</p><ul class=""><li id="4d0c" class="mj mk iw ln b lo lp lr ls lu ml ly mm mc mn mg mo mp mq mr bi translated">部分拟合</li><li id="f818" class="mj mk iw ln b lo ms lr mt lu mu ly mv mc mw mg mo mp mq mr bi translated">热启动</li></ul><p id="765f" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">为了说明如何在Scikit-learn中向预训练模型添加新数据，我将使用一个实际的例子，使用由Scikit-learn库提供的众所周知的<a class="ae lk" href="https://scikit-learn.org/stable/auto_examples/datasets/plot_iris_dataset.html" rel="noopener ugc nofollow" target="_blank"> iris数据集</a>。</p><h1 id="9bc5" class="mx my iw bd mz na nb nc nd ne nf ng nh kl ni km nj ko nk kp nl kr nm ks nn no bi translated">热启动</h1><p id="2b5d" class="pw-post-body-paragraph ll lm iw ln b lo np kg lq lr nq kj lt lu nr lw lx ly ns ma mb mc nt me mf mg ip bi translated">热启动是一些Scikit型号提供的参数。如果设置为True，则允许在随后的f it调用中使用现有的fit模型属性来初始化新模型。</p><p id="cb1d" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">例如，您可以在随机森林分类器中设置<code class="fe nu nv nw nx b">warm_start = True</code>，然后您可以定期拟合模型。如果对新数据再次调用fit方法，新的估计器将被添加到现有的树中。这意味着使用warm_start = True不会改变现有的树。</p><p id="b4d2" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated"><code class="fe nu nv nw nx b">warm_start = True</code>是否应该<strong class="ln jg">而不是</strong>用于在可能存在<strong class="ln jg">概念漂移</strong>的新数据集上进行增量学习。概念漂移是数据模型中的一种漂移，它发生在输出和输入变量之间的基本关系发生变化时。</p><p id="9619" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">为了理解<code class="fe nu nv nw nx b">warm_start = True</code>是如何工作的，我描述一个例子。这个想法是为了表明，如果我添加新数据，使用warm_start = True可以提高算法的性能，新数据与原始数据具有相同的分布，并且与输出变量保持相同的关系。</p><p id="a7ec" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">首先，我加载由Scikit-learn库提供的iris数据集:</p><pre class="kv kw kx ky gu ny nx nz oa aw ob bi"><span id="863c" class="oc my iw nx b gz od oe l of og">from sklearn import datasets</span><span id="c248" class="oc my iw nx b gz oh oe l of og">iris = datasets.load_iris()<br/>X = iris.data<br/>y = iris.target</span></pre><p id="3fd8" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">然后，我将数据集分成三部分:</p><ul class=""><li id="6c93" class="mj mk iw ln b lo lp lr ls lu ml ly mm mc mn mg mo mp mq mr bi translated"><code class="fe nu nv nw nx b">X_train</code>，<code class="fe nu nv nw nx b"> y_train </code>—40%数据的80%训练集(48个样本)</li><li id="b262" class="mj mk iw ln b lo ms lr mt lu mu ly mv mc mw mg mo mp mq mr bi translated"><code class="fe nu nv nw nx b">X_test</code>，<code class="fe nu nv nw nx b"> y_test</code> —测试集40个数据的20%(12个样本)</li><li id="50ed" class="mj mk iw ln b lo ms lr mt lu mu ly mv mc mw mg mo mp mq mr bi translated"><code class="fe nu nv nw nx b">X2, y2</code> —新样本(60%的数据)(90个样本)</li></ul><pre class="kv kw kx ky gu ny nx nz oa aw ob bi"><span id="68bc" class="oc my iw nx b gz od oe l of og">from sklearn.model_selection import train_test_split</span><span id="d2d4" class="oc my iw nx b gz oh oe l of og">X1, X2, y1, y2 = train_test_split(X, y, test_size=0.60, random_state=42)<br/>X_train, X_test, y_train, y_test = train_test_split(X1, y1, test_size=0.20, random_state=42)</span></pre><p id="78df" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我会用<code class="fe nu nv nw nx b">X2</code>和<code class="fe nu nv nw nx b">y2</code>重新训练模型。</p><p id="aad5" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">请注意，训练集非常小(48个样本)。</p><p id="0c17" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我训练模型，用<code class="fe nu nv nw nx b">warm_start = False</code>:</p><pre class="kv kw kx ky gu ny nx nz oa aw ob bi"><span id="dad0" class="oc my iw nx b gz od oe l of og">from sklearn.ensemble import RandomForestClassifier</span><span id="2c66" class="oc my iw nx b gz oh oe l of og">model = RandomForestClassifier(max_depth=2, random_state=0, warm_start=False, n_estimators=1)<br/>model.fit(X_train, y_train)</span></pre><p id="cf87" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我算了一下分数:</p><pre class="kv kw kx ky gu ny nx nz oa aw ob bi"><span id="d635" class="oc my iw nx b gz od oe l of og">model.score(X_test, y_test)</span></pre><p id="1317" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">它给出了以下输出:</p><pre class="kv kw kx ky gu ny nx nz oa aw ob bi"><span id="19b4" class="oc my iw nx b gz od oe l of og">0.75</span></pre><p id="e5a2" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">现在，我用新数据来拟合这个模型:</p><pre class="kv kw kx ky gu ny nx nz oa aw ob bi"><span id="a5e1" class="oc my iw nx b gz od oe l of og">model.fit(X2, y2)</span></pre><p id="fc5a" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">先前的拟合删除了已经学习的模型。然后，我计算分数:</p><pre class="kv kw kx ky gu ny nx nz oa aw ob bi"><span id="a224" class="oc my iw nx b gz od oe l of og">model.score(X_test, y_test)</span></pre><p id="db56" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">它给出了以下输出:</p><pre class="kv kw kx ky gu ny nx nz oa aw ob bi"><span id="c519" class="oc my iw nx b gz od oe l of og">0.8333333333333334</span></pre><p id="f518" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">现在我用warm_start = True构建一个新模型，看看模型得分是否增加。</p><pre class="kv kw kx ky gu ny nx nz oa aw ob bi"><span id="f028" class="oc my iw nx b gz od oe l of og">model = RandomForestClassifier(max_depth=2, random_state=0, warm_start=True, n_estimators=1)<br/>model.fit(X_train, y_train)<br/>model.score(X_test, y_test)</span></pre><p id="3890" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">它给出了以下输出:</p><pre class="kv kw kx ky gu ny nx nz oa aw ob bi"><span id="008e" class="oc my iw nx b gz od oe l of og">0.75</span></pre><p id="fab3" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">现在，我拟合模型并计算分数:</p><pre class="kv kw kx ky gu ny nx nz oa aw ob bi"><span id="fc44" class="oc my iw nx b gz od oe l of og">model.n_estimators+=1<br/>model.fit(X2, y2)<br/>model.score(X_test, y_test)</span></pre><p id="f057" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">它给出了以下输出:</p><pre class="kv kw kx ky gu ny nx nz oa aw ob bi"><span id="c696" class="oc my iw nx b gz od oe l of og">0.9166666666666666</span></pre><p id="697e" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">增量学习提高了分数！</p><h1 id="6fbd" class="mx my iw bd mz na nb nc nd ne nf ng nh kl ni km nj ko nk kp nl kr nm ks nn no bi translated">部分拟合</h1><p id="276d" class="pw-post-body-paragraph ll lm iw ln b lo np kg lq lr nq kj lt lu nr lw lx ly ns ma mb mc nt me mf mg ip bi translated">Scikit-learn提供的向预训练模型添加新数据的第二个策略是使用<code class="fe nu nv nw nx b">partial_fit()</code>方法。并非所有的模型都提供这种方法。</p><p id="db27" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">虽然<code class="fe nu nv nw nx b">warm_start = True</code>参数不改变模型已经学习的属性参数，但是部分拟合可以改变它，因为它从新数据中学习。</p><p id="fb5e" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我再次考虑虹膜数据集。</p><p id="a6a3" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">现在我用一个<code class="fe nu nv nw nx b">SGDClassifier</code>:</p><pre class="kv kw kx ky gu ny nx nz oa aw ob bi"><span id="9319" class="oc my iw nx b gz od oe l of og">from sklearn.linear_model import SGDClassifier<br/>import numpy as np</span><span id="4251" class="oc my iw nx b gz oh oe l of og">model = SGDClassifier() <br/>model.partial_fit(X_train, y_train, classes=np.unique(y))</span></pre><p id="b872" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">第一次运行partial_fit()方法时，我还必须将所有的类传递给该方法。在这。例如，我假设我知道y中包含的所有类，尽管我没有足够的样本来表示它们。</p><p id="ac05" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我算了一下分数:</p><pre class="kv kw kx ky gu ny nx nz oa aw ob bi"><span id="c72b" class="oc my iw nx b gz od oe l of og">model.score(X_test, y_test)</span></pre><p id="39f4" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">它给出了以下输出:</p><pre class="kv kw kx ky gu ny nx nz oa aw ob bi"><span id="5565" class="oc my iw nx b gz od oe l of og">0.4166666666666667</span></pre><p id="80ae" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">现在，我将新样本添加到模型中:</p><pre class="kv kw kx ky gu ny nx nz oa aw ob bi"><span id="a017" class="oc my iw nx b gz od oe l of og">model.partial_fit(X2, y2)</span></pre><p id="6d3d" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我计算分数:</p><pre class="kv kw kx ky gu ny nx nz oa aw ob bi"><span id="3474" class="oc my iw nx b gz od oe l of og">model.score(X_test, y_test)</span></pre><p id="fc0c" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">它给出了以下输出:</p><pre class="kv kw kx ky gu ny nx nz oa aw ob bi"><span id="826b" class="oc my iw nx b gz od oe l of og">0.8333333333333334</span></pre><p id="2caf" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">添加新数据提高了算法的性能！</p><h1 id="77ef" class="mx my iw bd mz na nb nc nd ne nf ng nh kl ni km nj ko nk kp nl kr nm ks nn no bi translated">摘要</h1><p id="6b75" class="pw-post-body-paragraph ll lm iw ln b lo np kg lq lr nq kj lt lu nr lw lx ly ns ma mb mc nt me mf mg ip bi translated">恭喜你！您刚刚学习了如何在Scikit-learn中向预训练模型添加新数据！您可以使用设置为<code class="fe nu nv nw nx b">True</code>的<code class="fe nu nv nw nx b">warm_start</code>参数或<code class="fe nu nv nw nx b">partial_fit() </code>方法。然而，并非Scikit-learn库中的所有模型都提供向预训练模型添加新数据的可能性。因此，我的建议是检查文档！</p><p id="30f8" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">你可以从我的<a class="ae lk" href="https://github.com/alod83/data-science/blob/master/DataAnalysis/Add%20New%20Data%20to%20a%20Pretrained%20Model.ipynb" rel="noopener ugc nofollow" target="_blank"> Github库</a>下载本教程中使用的代码。</p><p id="6164" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">如果你读到这里，对我来说，今天已经很多了。谢谢！你可以在<a class="ae lk" href="https://alod83.medium.com/my-most-trending-articles-4fbfbe107fb" rel="noopener">这个链接</a>阅读我的趋势文章。</p><h1 id="0ea8" class="mx my iw bd mz na nb nc nd ne nf ng nh kl ni km nj ko nk kp nl kr nm ks nn no bi translated">相关文章</h1><div class="oi oj gq gs ok ol"><a rel="noopener follow" target="_blank" href="/how-to-run-a-data-science-project-in-a-docker-container-2ab1a3baa889"><div class="om ab fp"><div class="on ab oo cl cj op"><h2 class="bd jg gz z fq oq fs ft or fv fx jf bi translated">如何在Docker容器中运行数据科学项目</h2><div class="os l"><h3 class="bd b gz z fq oq fs ft or fv fx dk translated">关于如何将数据科学项目包装在Docker映像中并在Docker中运行的一些技巧和实际例子…</h3></div><div class="ot l"><p class="bd b dl z fq oq fs ft or fv fx dk translated">towardsdatascience.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz le ol"/></div></div></a></div><div class="oi oj gq gs ok ol"><a rel="noopener follow" target="_blank" href="/an-overview-of-the-scikit-learn-clustering-package-d39a0499814"><div class="om ab fp"><div class="on ab oo cl cj op"><h2 class="bd jg gz z fq oq fs ft or fv fx jf bi translated">scikit-learn集群包概述</h2><div class="os l"><h3 class="bd b gz z fq oq fs ft or fv fx dk translated">scikit-learn系列的第二集，解释了用于机器学习的著名Python库</h3></div><div class="ot l"><p class="bd b dl z fq oq fs ft or fv fx dk translated">towardsdatascience.com</p></div></div><div class="ou l"><div class="pa l ow ox oy ou oz le ol"/></div></div></a></div><div class="oi oj gq gs ok ol"><a rel="noopener follow" target="_blank" href="/model-evaluation-in-scikit-learn-abce32ee4a99"><div class="om ab fp"><div class="on ab oo cl cj op"><h2 class="bd jg gz z fq oq fs ft or fv fx jf bi translated">Scikit-learn中的模型评估</h2><div class="os l"><h3 class="bd b gz z fq oq fs ft or fv fx dk translated">关于如何使用scikit-learn计算最常见的回归和分类指标的教程。</h3></div><div class="ot l"><p class="bd b dl z fq oq fs ft or fv fx dk translated">towardsdatascience.com</p></div></div><div class="ou l"><div class="pb l ow ox oy ou oz le ol"/></div></div></a></div><h1 id="334d" class="mx my iw bd mz na nb nc nd ne nf ng nh kl ni km nj ko nk kp nl kr nm ks nn no bi translated">保持联系！</h1><ul class=""><li id="fcc2" class="mj mk iw ln b lo np lr nq lu pc ly pd mc pe mg mo mp mq mr bi translated">在<a class="ae lk" href="https://medium.com/@alod83?source=about_page-------------------------------------" rel="noopener">媒体</a>上跟随我</li><li id="4c9e" class="mj mk iw ln b lo ms lr mt lu mu ly mv mc mw mg mo mp mq mr bi translated">注册我的<a class="ae lk" href="https://medium.com/subscribe?source=about_page-------------------------------------" rel="noopener">简讯</a></li><li id="63b8" class="mj mk iw ln b lo ms lr mt lu mu ly mv mc mw mg mo mp mq mr bi translated">在<a class="ae lk" href="https://www.linkedin.com/in/angelicaloduca/?source=about_page-------------------------------------" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上连接</li><li id="bdc8" class="mj mk iw ln b lo ms lr mt lu mu ly mv mc mw mg mo mp mq mr bi translated">在推特上关注我</li><li id="39ca" class="mj mk iw ln b lo ms lr mt lu mu ly mv mc mw mg mo mp mq mr bi translated">跟着我上<a class="ae lk" href="https://www.facebook.com/alod83?source=about_page-------------------------------------" rel="noopener ugc nofollow" target="_blank">脸书</a></li><li id="e0be" class="mj mk iw ln b lo ms lr mt lu mu ly mv mc mw mg mo mp mq mr bi translated">在Github上关注我</li></ul></div></div>    
</body>
</html>