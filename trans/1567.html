<html>
<head>
<title>Building AWS Lambda Container Images</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建AWS Lambda容器映像</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-aws-lambda-container-images-5c4a9a15e8a2#2022-04-15">https://towardsdatascience.com/building-aws-lambda-container-images-5c4a9a15e8a2#2022-04-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="606a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">打包Lambda代码和依赖项</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ba372fb880eb519539cf465abd9199a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kz5GJTfgt5cejBFw"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自弗兰克<a class="ae ky" href="https://unsplash.com/@frankiefoto" rel="noopener ugc nofollow" target="_blank">麦凯纳</a>拍摄的<a class="ae ky" href="https://unsplash.com/photos/tjX_sniNzgQ" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="503a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>函数非常强大，是无服务器应用程序的核心构件之一。它们可以用来将你的整个应用程序缝合在一起，而且通常在Lambda函数上，你需要<strong class="lb iu">为你的项目安装额外的依赖项</strong>。Lambda不支持某些现成的包/库，您需要找到一种方法在该环境中安装这些依赖项。</p><p id="4eca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">解决这个问题的一个方法是创建一个包含函数依赖项的<a class="ae ky" href="https://docs.aws.amazon.com/lambda/latest/dg/python-package.html" rel="noopener ugc nofollow" target="_blank">部署包/zip文件</a>。这是可行的，但是一个更干净和直观的替代方法是将所有这些打包在一个<a class="ae ky" href="https://docs.aws.amazon.com/lambda/latest/dg/python-image.html" rel="noopener ugc nofollow" target="_blank">容器映像</a>中。我们可以使用AWS <a class="ae ky" href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-images.html#runtimes-images-lp" rel="noopener ugc nofollow" target="_blank">提供的基础图像</a>来进一步简化这个过程。在本文中，我们将研究如何获取其中一个基础映像，并在此基础上为我们的Python Lambda函数安装一个包。我们将构建一个简单的<a class="ae ky" href="https://numpy.org/" rel="noopener ugc nofollow" target="_blank"> NumPy </a>示例，您可以根据自己的示例进行调整。</p><p id="e285" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意</strong>:对于那些刚接触AWS的人来说，如果你想跟进的话，请确保你在下面的<a class="ae ky" href="https://aws.amazon.com/console/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">链接</strong> </a>中做了一个账户。在开始之前，一定要安装Docker。本文还假设您对Python和AWS有基本的了解。</p><h2 id="43c5" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">1.设置</h2><p id="2321" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">对于我们的例子，我们需要三个主要文件:Lambda Python函数、需求文件和docker文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/5d12416709de806ede21d1161e9aa234.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*mlA6SxSHQwQJwt_2NJEaTA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">所需文件(作者截图)</p></figure><p id="2b08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于我们的requirements.txt，我们需要的只是NumPy包。我们将使用传入的示例负载执行一个简单的NumPy操作。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安装数量</p></figure><p id="3bf0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来我们有我们的Python Lambda函数。在这个Lambda函数中，我们将它设置为以一个整数作为输入的样本JSON。使用NumPy，我们将捕获这个整数的平方根，并在Lambda函数被调用时返回它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">进口</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带NumPy的平方根</p></figure><p id="0f3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实际上，您的问题的用例将会复杂得多，我们只是在这里进行一个简单的NumPy操作，以显示我们的Lambda函数正在与我们的附加依赖项一起工作。</p><p id="d223" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以在一个<a class="ae ky" href="https://docs.docker.com/engine/reference/builder/" rel="noopener ugc nofollow" target="_blank">docker文件</a>中捕获我们的代码和依赖关系。首先我们抓取<a class="ae ky" href="https://docs.aws.amazon.com/lambda/latest/dg/python-image.html" rel="noopener ugc nofollow" target="_blank"> AWS基础Python图像</a>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基础Python图像</p></figure><p id="5e37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基础映像在<strong class="lb iu"> LAMBDA_TASK_ROOT </strong>中提供了一个环境变量。我们可以复制我们的Python代码，并在这个目录中安装我们的依赖项。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">复制Lambda代码</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在Lambda_TASK_ROOT目录中安装依赖项</p></figure><p id="d83a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们将CMD设置为我们的处理函数，这应该是<filename>。<functioname>用你们各自的价值观。</functioname></filename></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">替换为您的文件名和函数名</p></figure><h2 id="6e29" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">2.容器映像构建</h2><p id="05c3" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">使用docker文件，我们可以用下面的命令构建Lambda容器映像“numpy-lambda-container”。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">构建图像</p></figure><p id="ee3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们使用Docker run命令启动映像。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">开始Docker图像</p></figure><p id="3d17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在在同一个目录中打开另一个终端，我们可以<a class="ae ky" href="https://phoenixnap.com/kb/curl-command#:~:text=apt%20install%20curl-,What%20Is%20the%20curl%20Command%3F,to%20be%20sent%20or%20received." rel="noopener ugc nofollow" target="_blank"> curl </a>一个样本数据点来本地调用我们的Lambda函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">示例调用</p></figure><p id="7626" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们在另一个Shell中看到结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/63bf5ab374da2f6eef7a6efc80f10b88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t5WZSKbbeougT-4dWvHz7w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">样本结果(作者截图)</p></figure><p id="b87b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，您可以将这个本地映像推送到<a class="ae ky" href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/what-is-ecr.html" rel="noopener ugc nofollow" target="_blank">弹性容器注册表</a> (ECR)。要将所有这些资源推送到AWS，您可以使用AWS <a class="ae ky" rel="noopener" target="_blank" href="/infrastructure-as-code-with-aws-207239573de"> CloudFormation/SAM </a>模板来定义和部署您的基础架构。</p><h2 id="18e5" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">3.其他资源和结论</h2><div class="mx my gp gr mz na"><a href="https://github.com/RamVegiraju/Lambda-Container" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd iu gy z fp nf fr fs ng fu fw is bi translated">GitHub-RamVegiraju/Lambda-Container:创建Lambda容器映像的示例</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">创建Lambda容器图像的示例。为RamVegiraju/Lambda-Container开发做出贡献，创建一个…</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">github.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no ks na"/></div></div></a></div><p id="51f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关示例的代码，请查看上面的链接。Lambda容器映像使得定制Lambda函数以适应您的工作流比以往任何时候都更容易。这是一个非常简单的用例，您可以使用它作为构建自己的复杂函数的基础。如果您想了解如何在Lambda上部署ML模型进行推理，请查看这个<a class="ae ky" href="https://github.com/aws-samples/aws-lambda-docker-serverless-inference" rel="noopener ugc nofollow" target="_blank"> AWS样本库</a>。这是另一个伟大的<a class="ae ky" href="https://github.com/philschmid/serverless-bert-huggingface-aws-lambda-docker" rel="noopener ugc nofollow" target="_blank">例子</a>，在AWS Lambda上部署<a class="ae ky" href="https://arxiv.org/abs/1810.04805" rel="noopener ugc nofollow" target="_blank"> BERT </a>模型用于无服务器推理。</p><p id="bc9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇文章很好地介绍了如何利用AWS Lambda的众多特性之一。一如既往，欢迎在评论中留下任何问题和反馈。</p></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><p id="74eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nw">如果你喜欢这篇文章，请在</em><a class="ae ky" href="https://www.linkedin.com/in/ram-vegiraju-81272b162/" rel="noopener ugc nofollow" target="_blank"><em class="nw">LinkedIn</em></a><em class="nw">上与我联系，并订阅我的媒体</em> <a class="ae ky" href="https://ram-vegiraju.medium.com/subscribe" rel="noopener"> <em class="nw">简讯</em> </a> <em class="nw">。如果你是新来的中号，用我的</em> <a class="ae ky" href="https://ram-vegiraju.medium.com/membership" rel="noopener"> <em class="nw">会员推荐</em> </a> <em class="nw">报名吧。</em></p></div></div>    
</body>
</html>