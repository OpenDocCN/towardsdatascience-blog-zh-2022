<html>
<head>
<title>Sensor fusion explained with rotating iPhone</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用旋转iPhone解释传感器融合</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/sensor-fusion-explained-with-rotating-iphone-fecbcd0df144#2022-07-26">https://towardsdatascience.com/sensor-fusion-explained-with-rotating-iphone-fecbcd0df144#2022-07-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="79c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">传感器融合是利用多个传感器来降低预测的不确定性。更正式的定义来自IEEE地球科学与遥感学会数据融合技术委员会[1]:</p><blockquote class="ko kp kq"><p id="4527" class="jq jr kr js b jt ju jv jw jx jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kn im bi translated">组合由不同仪器和来源提供的空间和时间索引数据<br/>的过程，以改进这些数据的<br/>处理和解释。</p></blockquote><p id="4a31" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">传感器融合广泛用于多种工程应用，从GPS定位检测到自动驾驶。传感器融合是被称为信息融合的更一般术语的特例。有两种不同类型的传感器融合:直接和间接。</p><p id="5a5b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">间接融合来自先验知识和人类或环境输入。例如，如果一个人想确定食物是否新鲜，使用人类的视觉传感器可能是不够的。嗅觉、触觉以及我们对食物储存地点和生产时间的先验知识相结合，可能会让我们对自己是否食用食物有一个全面的了解。</p><p id="135e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">直接融合可以来自异类和同类传感器。它也可以来自软传感器或芯片。让我们看看这些融合类型的例子。</p><p id="9e5c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">同类传感器是测量相同信息的相似传感器。例如，你可以想象几个温度计，每个都有一定程度的内部误差，放在房间的中央。通过合并这两个温度计的测量值，可以更好地估计室内的平均温度，减少温度计测量的不确定性。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi kv"><img src="../Images/086c5d274a31f7aa9cf4aab3293af61d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ePjTE18b_dLJdi69"/></div></div><p class="lh li gj gh gi lj lk bd b be z dk translated"><a class="ae ll" href="https://unsplash.com/@thermopro?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">塞莫普罗</a>在<a class="ae ll" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="bd1d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">异质传感器可以是房间中不同位置的相同温度计。然而，他们都测量温度，房间内的温度可能会因位置不同而不同。考虑到温度计的位置和温度计的内部误差，人们可以从这些局部测量中得出室内的平均温度。</p><p id="93f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">软传感器或软件传感器是虚拟传感器，其中几个测量一起处理以给出系统状态的一个估计。人们可以想到手机如何根据GPS坐标和Wi-Fi信号来估计位置，这提高了位置检测的速度和精度。可以将iPhone中的这个传感器视为一个传感器，但是，它是几个数据源的组合，是一个软传感器。</p><p id="22bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们自己建立一个简单的软传感器。假设我们要测量iPhone方位的角度<em class="kr"> α(t) </em>，如图所示:</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi lm"><img src="../Images/120b4ee98b8f8110c55565750dbe8b30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*htkpzknhbziFbWIbokoSLg.gif"/></div></div><p class="lh li gj gh gi lj lk bd b be z dk translated"><em class="ln">作者图片。左上:旋转视频。右上:根据传感器数据计算的相同旋转。下图代表从传感器数据计算出的α值。</em></p></figure><p id="87f1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了简单和可再现性的目的，我们记录iPhone旋转的数据，然而，通过小的额外努力，这种方法可以被修改为在线工作。</p><p id="59c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">数据收集</strong></p><p id="c072" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了简化实验设置，人们可以将iPhone握在手中，并围绕一个轴旋转。以下是这篇博文的数据收集方式的更多细节:</p><p id="a169" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在开始记录一个测量传感器数据的应用程序后，我一手拿着iPhone，让它的屏幕指向我，并左右旋转它。我以不同的速度旋转iPhone次。在两次旋转之间，我将iPhone返回到初始位置，并保持在初始状态大约5秒钟。</p><p id="5be6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">收集的数据包括投影在iPhone和时间对应轴上的加速度(a0，a1，a2)和转速(o0，o1，o2)。数据看起来是这样的:</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi lo"><img src="../Images/f3713233739565d42da246fe8c393e28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HVPveDRWE-_GRoZ88241ew.png"/></div></div><p class="lh li gj gh gi lj lk bd b be z dk translated"><em class="ln">作者图片</em></p></figure><p id="5780" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">旋转物理学</strong></p><p id="9a4e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">方便考虑iPhone附带的坐标系<em class="kr"> e0e1e2 </em>在静止坐标系中的旋转<em class="kr"> XYZ: </em></p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi lp"><img src="../Images/493a106638ac4273ed7ac92b38af42f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IuZlJA6Vni2QPybzJYLjYw.png"/></div></div><p class="lh li gj gh gi lj lk bd b be z dk translated"><em class="ln">图片作者。</em>iPhone附带的坐标系e0e1e2。XYZ坐标系处于静止状态。</p></figure><p id="c427" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我们将iPhone屏幕垂直放在手边，那么e0轴指向右侧，e1轴指向上方，e2轴从iPhone屏幕指向我们。在这种情况下，总旋转矢量<em class="kr">ω</em>为:</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi lq"><img src="../Images/a9f574990eb7b1f814780ae304f3d4fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M58G-S-9uKO1U-xAbarSFw.png"/></div></div></figure><p id="86f8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以通过对相应向量与<em class="kr">ω</em>的叉积求积分，找到<em class="kr"> e0、e1和e2 </em>中每个向量的相应坐标:</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi lr"><img src="../Images/6f23fd9e73ab438220fe883221a928da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qhvqpt6CXRiYpQJoYrQv_w.png"/></div></div></figure><p id="9bcc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">目标是测量<em class="kr"> X </em>轴和矢量<em class="kr"> e0 </em>在<em class="kr"> XY </em>平面上的投影之间的角度<em class="kr"> α </em>。可以用下面的公式来计算:</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi ls"><img src="../Images/72d00049beae9bab9e31f4f509b13167.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1B65hlAbWZS7rlwRq1NXmQ.png"/></div></div></figure><p id="949b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果<em class="kr"> e0 </em>的投影更靠近<em class="kr"> Y </em>轴，我们就认为<em class="kr"> α </em>为正。如果投影与<em class="kr"> αx </em>之间的角度大于<em class="kr"> pi/2 </em>则为负:</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi lt"><img src="../Images/38ce5422ea16d7c802861f37cf38f9fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C3yLUJ3ZsNyrEMUbVDffdA.png"/></div></div></figure><h2 id="52b2" class="lu lv it bd lw lx ly dn lz ma mb dp mc kb md me mf kf mg mh mi kj mj mk ml mm bi translated">无传感器融合的软传感器</h2><p id="e543" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">首先，我们尝试只使用来自iPhone陀螺仪的数据。使用等式(1)-(4)，我们可以构建测量<em class="kr"> α(t) </em>的软传感器。然而，由于测量误差和数值误差，iPhone附带的坐标系在一段时间后变得不正交。为了实现正交性，可以使用格拉姆-施密特变换。</p><p id="cc7d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完整的算法导致以下步骤:</p><ol class=""><li id="bc74" class="ms mt it js b jt ju jx jy kb mu kf mv kj mw kn mx my mz na bi translated">计算iPhone坐标中的总转速(方程式。1)</li><li id="acad" class="ms mt it js b jt nb jx nc kb nd kf ne kj nf kn mx my mz na bi translated">基于总旋转(等式)更新iPhone坐标。2)</li><li id="6e2a" class="ms mt it js b jt nb jx nc kb nd kf ne kj nf kn mx my mz na bi translated">新iPhone坐标上的格拉姆-施密特变换</li><li id="ec65" class="ms mt it js b jt nb jx nc kb nd kf ne kj nf kn mx my mz na bi translated">计算<em class="kr"> α </em>(等式。3–4)</li></ol><p id="0449" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用于评估iPhone方向的python脚本可能如下所示:</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="73a6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将导致下面的<em class="kr"> α(t): </em></p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi ni"><img src="../Images/1a57ef2f24c11b3686729b8e903693d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hvfQ0tmr0ecNMjibcUfbBw.png"/></div></div><p class="lh li gj gh gi lj lk bd b be z dk translated"><em class="ln">作者图片</em></p></figure><p id="4c82" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">数据收集以这样一种方式进行，即在旋转之间iPhone返回到初始位置。尽管在旋转周期之间有重要的值<em class="kr"> α(t) </em>(标记为红色)。问题出在不连续的测量上。在积分过程中，我们在测量值之间近似未知值，这些近似会导致漂移。</p><p id="60a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第80秒和第85秒之间的再现旋转将如下所示:</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi nj"><img src="../Images/fa143364b12fff17450cc93b0fb16a13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*dFB1ZG9JAzvo-3LmCcwX-w.gif"/></div></div><p class="lh li gj gh gi lj lk bd b be z dk translated"><em class="ln">图片作者。无校正旋转。左上:旋转视频。右上:根据传感器数据计算的相同旋转。下图代表从传感器数据计算出的α值。</em></p></figure><p id="9203" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意，轴线e2不再指向我们(不与轴线Z对齐)。此外，旋转发生在-75 grad值附近，这与旋转的视频记录不一致。</p><h2 id="ae0f" class="lu lv it bd lw lx ly dn lz ma mb dp mc kb md me mf kf mg mh mi kj mj mk ml mm bi translated">传感器融合软测量</h2><p id="1b75" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">改善这种情况的一种方法是将转速数据与加速度数据融合。有了加速度数据，就很容易判断出重力的方向。iPhone的初始<em class="kr"> e1 </em>轴与重力方向相反。旋转之间的静止状态也是如此:<em class="kr"> e1 </em>与重力相反。有可能在总转动矢量中加入一个松弛项，这将说明静止状态下的e1与重力方向相反。当轴线e1偏离，并且不指向重力的相反方向时，这个松弛项会使它向后移动。Berkley [2]的一项“被扔的iPhone”研究中使用了类似的修正。</p><p id="df9b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">关于我们的系统，我们知道的另一个事实是，一般来说，我们围绕手机的e2轴旋转手机，在实验过程中，该轴不会发生剧烈变化。所以e2通常与静止系统的Z轴方向相同。为了说明这一事实，我们可以添加另一个松弛项，如果e2轴由于数字或测量误差而漂移，它将返回到Z轴。</p><p id="4ddc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这种松弛项的公式是:</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi lm"><img src="../Images/460c89b43b298bef476d99d5beb4cb82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1E3YmsAIQG8FGW_WMaedeA.png"/></div></div></figure><p id="85fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">其中<em class="kr"> kf </em>是融合系数，可以根据经验得出(发现等于1就足够了)。注意，在e2校正的情况下，由于e2和Z轴之间的角度不影响<em class="kr"> α的测量，因此Z轴的松弛将会起作用。</em>然而，如果我们选择松弛到e1而不是加速度矢量，这将影响<em class="kr"> α </em>的测量。融合算法如上所述，但是增加了额外的步骤1b:</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="4f48" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<em class="kr"> α(t) </em>的曲线上不再观察到漂移；</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi nk"><img src="../Images/049bb4508aa8adfccfc74e7d77900dbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3V6PGUG5muedE1jgWbmW7g.png"/></div></div><p class="lh li gj gh gi lj lk bd b be z dk translated"><em class="ln">作者图片</em></p></figure><p id="1fcd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">iPhone数据的重建与视频记录非常吻合:</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi nj"><img src="../Images/04c1db2c4996210a8343d08a76be1b84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*f_9cTMsK1R6QDSO6yVKRUg.gif"/></div></div><p class="lh li gj gh gi lj lk bd b be z dk translated"><em class="ln">作者图片。传感器融合旋转。左上:旋转视频。右上:根据传感器数据计算的相同旋转。下图代表从传感器数据计算出的α值。</em></p></figure><p id="b95e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完整的代码可在<a class="ae ll" href="https://github.com/azarnyx/iPhone_rotation" rel="noopener ugc nofollow" target="_blank">这里</a>。传感器融合快乐！</p><p id="6225" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">附注:我要感谢谢尔盖·利特维诺夫对邮报的帮助。</p><p id="abc2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">P.P.S:在第二部分，我比较了这篇博文和视频中的定位。这里是<a class="ae ll" href="https://pub.towardsai.net/image-segmentation-of-rotating-iphone-with-scikit-image-3e27e5fad7a8" rel="noopener ugc nofollow" target="_blank">环节</a>。</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="ee36" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">[1]用于交通管理和互联车辆的ITS传感器和架构，Lawrence A. Klein，2017年</p><p id="49ba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">[2]<a class="ae ll" href="https://rotations.berkeley.edu/reconstructing-the-motion-of-a-tossed-iphone/" rel="noopener ugc nofollow" target="_blank">https://rotations . Berkeley . edu/re constructing-of-motion-of-a-throwed-iphone/</a></p></div></div>    
</body>
</html>