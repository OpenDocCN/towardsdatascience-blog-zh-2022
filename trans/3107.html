<html>
<head>
<title>Reshaping a DataFrame from long to wide format using pivot()</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用pivot()将数据帧从长格式改为宽格式</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/reshaping-a-dataframe-from-long-to-wide-format-using-pivot-b099930b30ae#2022-07-07">https://towardsdatascience.com/reshaping-a-dataframe-from-long-to-wide-format-using-pivot-b099930b30ae#2022-07-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1065" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">介绍Pandas pivot()以及如何使用它将数据帧从长格式转换为宽格式</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3f4f8ae10a46ada7ba3b7cf2fc5f7efe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dHNbKRYPMnu6GCpF9ZRBxA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@joshhild?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Josh Hild </a>在<a class="ae ky" href="https://unsplash.com/s/photos/photo-wall?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><blockquote class="kz la lb"><p id="15a3" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><em class="it">当您处理包含具有某种序列的变量的数据集时，例如时间序列数据，通常需要进行整形。</em></p><p id="02af" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><em class="it">来源于弗吉尼亚大学研究数据服务部[1] </em></p></blockquote><p id="1a04" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">在之前的<a class="ae ky" rel="noopener" target="_blank" href="/reshaping-a-dataframe-using-pandas-melt-83a151ce1907">文章</a>中，我们已经讨论过使用Pandas <code class="fe mc md me mf b"><a class="ae ky" rel="noopener" target="_blank" href="/reshaping-a-dataframe-using-pandas-melt-83a151ce1907">melt()</a></code>将数据从宽格式重塑为长格式。在实践中，我们也经常需要完全相反的操作——将数据从长格式转换为宽格式。这就是熊猫<code class="fe mc md me mf b">pivot()</code>来帮忙的地方。简而言之，熊猫<code class="fe mc md me mf b">pivot()</code>与<code class="fe mc md me mf b"><a class="ae ky" rel="noopener" target="_blank" href="/reshaping-a-dataframe-using-pandas-melt-83a151ce1907">melt()</a></code>完全相反。</p><p id="669c" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">在本文中，我们将探索如何使用Pandas <code class="fe mc md me mf b">pivot()</code>方法将数据帧从长格式重塑为宽格式。本文涵盖以下主题:</p><ol class=""><li id="0192" class="mg mh it lf b lg lh lj lk lz mi ma mj mb mk ly ml mm mn mo bi translated">最简单的<code class="fe mc md me mf b">pivot()</code></li><li id="4a0a" class="mg mh it lf b lg mp lj mq lz mr ma ms mb mt ly ml mm mn mo bi translated">指定<code class="fe mc md me mf b">index</code></li><li id="5ce6" class="mg mh it lf b lg mp lj mq lz mr ma ms mb mt ly ml mm mn mo bi translated">多列</li><li id="8677" class="mg mh it lf b lg mp lj mq lz mr ma ms mb mt ly ml mm mn mo bi translated">多重值</li><li id="aebe" class="mg mh it lf b lg mp lj mq lz mr ma ms mb mt ly ml mm mn mo bi translated">任何重复的值错误</li><li id="db3e" class="mg mh it lf b lg mp lj mq lz mr ma ms mb mt ly ml mm mn mo bi translated"><code class="fe mc md me mf b">pivot()</code>和<code class="fe mc md me mf b">pivot_table()</code>的区别</li></ol><blockquote class="mu"><p id="9495" class="mv mw it bd mx my mz na nb nc nd ly dk translated">源代码请查看<a class="ae ky" href="https://github.com/BindiChen/machine-learning/blob/main/data-analysis/049-pandas-pivot/pivot.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>。更多教程可从<a class="ae ky" href="https://github.com/BindiChen/machine-learning" rel="noopener ugc nofollow" target="_blank"> Github Repo </a>获取。</p></blockquote></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="0f4d" class="nl nm it bd nn no np nq nr ns nt nu nv jz nw ka nx kc ny kd nz kf oa kg ob oc bi translated">1.简单<code class="fe mc md me mf b">pivot()</code></h1><p id="eeb5" class="pw-post-body-paragraph lc ld it lf b lg od ju li lj oe jx ll lz of lo lp ma og ls lt mb oh lw lx ly im bi translated">最简单的<code class="fe mc md me mf b">pivot()</code>必须有一个<code class="fe mc md me mf b">columns</code>值，该值用于指定生成新DataFrame的列的列。在我们的例子中，让我们使用<strong class="lf iu">日期</strong>列。</p><pre class="kj kk kl km gt oi mf oj ok aw ol bi"><span id="94a9" class="om nm it mf b gy on oo l op oq">df.pivot(<strong class="mf iu">columns='Date'</strong>)</span></pre><p id="ef89" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">但是，这个输出往往包含大量的<code class="fe mc md me mf b">NaN</code>。这是因为如果没有指定，<code class="fe mc md me mf b">pivot()</code>中的<code class="fe mc md me mf b">values</code>参数将使用剩余的列来填充新DataFrame的值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/f2ccffb4f9e1525b36a50258308146b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BJr-dUZ82xoeO-DIQWjtZQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">最简单的pivot()(图片由作者提供)</p></figure><p id="940e" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">结果往往没有太大意义，所以一般用例至少指定了<code class="fe mc md me mf b">index</code>。</p><h1 id="a72b" class="nl nm it bd nn no os nq nr ns ot nu nv jz ou ka nx kc ov kd nz kf ow kg ob oc bi translated">2.指定<code class="fe mc md me mf b">index</code></h1><p id="8038" class="pw-post-body-paragraph lc ld it lf b lg od ju li lj oe jx ll lz of lo lp ma og ls lt mb oh lw lx ly im bi translated">将<code class="fe mc md me mf b">index</code>设置为<code class="fe mc md me mf b">'Country'</code>后，您应该会得到如下结果:</p><pre class="kj kk kl km gt oi mf oj ok aw ol bi"><span id="2357" class="om nm it mf b gy on oo l op oq">df.pivot(columns='Date',<strong class="mf iu"> index='Country'</strong>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/a5d7be92b68b930e0bf49e32a21aa937.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XHtFyM5cMlPx251CX_KC0A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">熊猫透视()带列和索引(图片由作者提供)</p></figure><p id="816c" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">有了<code class="fe mc md me mf b">index='Country'</code>，结果数据帧不再有<code class="fe mc md me mf b">NaN</code>。这似乎很神奇，但是对于这个特殊的例子，剩下的列只有<strong class="lf iu"> Cases </strong>列，而<strong class="lf iu"> Country </strong>列包含分类数据。</p><p id="38f6" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">您可能会注意到，结果具有分层索引列<strong class="lf iu">案例</strong>和<strong class="lf iu">日期</strong>(也称为多索引列)。我们可以显式指定<code class="fe mc md me mf b">values</code>参数来消除它:</p><pre class="kj kk kl km gt oi mf oj ok aw ol bi"><span id="875d" class="om nm it mf b gy on oo l op oq">df.pivot(columns='Date', index='Country', <strong class="mf iu">values='Cases'</strong>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/9c4a899a4d505fa5abbe814e53d27227.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1BeygWHXqUlaZXYhuAhTcg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">熊猫透视()带列和索引(图片由作者提供)</p></figure><h1 id="03c7" class="nl nm it bd nn no os nq nr ns ot nu nv jz ou ka nx kc ov kd nz kf ow kg ob oc bi translated">3.多列</h1><p id="7126" class="pw-post-body-paragraph lc ld it lf b lg od ju li lj oe jx ll lz of lo lp ma og ls lt mb oh lw lx ly im bi translated">与相反的方法Pandas <code class="fe mc md me mf b">melt()</code>类似，我们可以指定多个列，将它们作为输出中的列。例如，如果我们想保留<strong class="lf iu">国家</strong>、<strong class="lf iu">纬度</strong>和<strong class="lf iu">经度</strong>作为列，以便更好地参考:</p><pre class="kj kk kl km gt oi mf oj ok aw ol bi"><span id="966f" class="om nm it mf b gy on oo l op oq">df_2.pivot(<br/>    columns='Date', <br/>    <strong class="mf iu">index=['Country', 'Lat', 'Long'], </strong><br/>    values='Cases'<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/868c0dab65335af61a0ec626049e5615.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZFrSEbBqOOv9LCoooL_2VQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">多列熊猫透视()</p></figure><h1 id="0d26" class="nl nm it bd nn no os nq nr ns ot nu nv jz ou ka nx kc ov kd nz kf ow kg ob oc bi translated">4.多重值</h1><p id="66b4" class="pw-post-body-paragraph lc ld it lf b lg od ju li lj oe jx ll lz of lo lp ma og ls lt mb oh lw lx ly im bi translated">类似地，我们可以向<code class="fe mc md me mf b">values</code>参数传递一个列表，以便并排查看不同的类别:</p><pre class="kj kk kl km gt oi mf oj ok aw ol bi"><span id="95cf" class="om nm it mf b gy on oo l op oq">df_3.pivot(<br/>    columns='Date', <br/>    index=['Country', 'Lat', 'Long'], <br/>    <strong class="mf iu">values=['Cases', 'Recovered']</strong><br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/75713dd9d77a2f031ed45351304c83d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FkQwhJx1N04oBasrCmA2kQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">具有多个值的熊猫透视()</p></figure><h1 id="561a" class="nl nm it bd nn no os nq nr ns ot nu nv jz ou ka nx kc ov kd nz kf ow kg ob oc bi translated">5.任何重复的值错误</h1><p id="1156" class="pw-post-body-paragraph lc ld it lf b lg od ju li lj oe jx ll lz of lo lp ma og ls lt mb oh lw lx ly im bi translated">现在，让我们来看一个具有重复值的数据帧。</p><pre class="kj kk kl km gt oi mf oj ok aw ol bi"><span id="b5a7" class="om nm it mf b gy on oo l op oq">df = pd.DataFrame({<br/>    "Store_Manager": ['Tom', 'Tom', 'Chris', 'Chris'],<br/>    "Location": ['London', 'London', 'Oxford', 'Cambridge'],<br/>    "Num_employee": [1, 2, 3, 4]<br/>})</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/0bd016a130fa80cc68350cba33239ce2.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*cvq-hCnvpaFe5gjOgYSgsw.png"/></div></figure><p id="c711" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">当执行下面的语句时，您将得到一个<strong class="lf iu"> ValueError </strong>。这是因为前两行对于<code class="fe mc md me mf b">index</code>和<code class="fe mc md me mf b">columns</code>参数是相同的。</p><pre class="kj kk kl km gt oi mf oj ok aw ol bi"><span id="0e81" class="om nm it mf b gy on oo l op oq">df.pivot(<br/>    <strong class="mf iu">index='Store_Manager', <br/>    columns='Location',</strong> <br/>    values='Num_employee'<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/40bf766c838f2d1b333cbf19b28d64dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rFcLX9Xs-kPGdnNEoNAKrg.png"/></div></div></figure><p id="9355" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">我们可以使用<code class="fe mc md me mf b"><a class="ae ky" rel="noopener" target="_blank" href="/a-practical-introduction-to-pandas-pivot-table-function-3e1002dcd4eb">pivot_table()</a></code>来解决这个问题。但是请记住，默认情况下，<code class="fe mc md me mf b"><a class="ae ky" rel="noopener" target="_blank" href="/a-practical-introduction-to-pandas-pivot-table-function-3e1002dcd4eb">pivot_table()</a></code>将执行<strong class="lf iu"> <em class="le">均值</em> </strong>聚合。例如，运行下面的语句，你会得到一个输出显示"<strong class="lf iu"> <em class="le"> Tom </em> </strong> <em class="le">在伦敦平均有1.5名雇员"</em>。</p><pre class="kj kk kl km gt oi mf oj ok aw ol bi"><span id="1d5e" class="om nm it mf b gy on oo l op oq">df.pivot_table(<br/><strong class="mf iu">    index='Store_Manager', <br/>    columns='Location',</strong> <br/>    values='Num_employee'<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/74d9b3364c781e2110384c98aca6a80c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*oVDhzhCxagQcHzwPk9Ru9A.png"/></div></figure><h1 id="f381" class="nl nm it bd nn no os nq nr ns ot nu nv jz ou ka nx kc ov kd nz kf ow kg ob oc bi translated">6.<code class="fe mc md me mf b">pivot()</code>和<code class="fe mc md me mf b">pivot_table()</code>的区别</h1><p id="dddd" class="pw-post-body-paragraph lc ld it lf b lg od ju li lj oe jx ll lz of lo lp ma og ls lt mb oh lw lx ly im bi translated">基本上，<code class="fe mc md me mf b"><a class="ae ky" rel="noopener" target="_blank" href="/a-practical-introduction-to-pandas-pivot-table-function-3e1002dcd4eb">pivot_table()</a></code>函数是允许执行聚合的<code class="fe mc md me mf b">pivot()</code>函数的推广。</p><p id="b99d" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><code class="fe mc md me mf b">pivot()</code>的主要使用案例有:</p><ol class=""><li id="6b3a" class="mg mh it lf b lg lh lj lk lz mi ma mj mb mk ly ml mm mn mo bi translated">如果您需要透视一个表并显示没有任何聚合的值。</li><li id="0948" class="mg mh it lf b lg mp lj mq lz mr ma ms mb mt ly ml mm mn mo bi translated">您希望将数据帧从长格式转换为宽格式</li></ol><p id="744c" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">当您正在寻找一种从数据中获取洞察力并执行聚合的方法时，<code class="fe mc md me mf b"><a class="ae ky" rel="noopener" target="_blank" href="/a-practical-introduction-to-pandas-pivot-table-function-3e1002dcd4eb">pivot_table()</a></code>应该是最佳选择。如果你想了解更多关于<code class="fe mc md me mf b">pivot_table()</code>的信息，请查看这篇文章:</p><div class="pe pf gp gr pg ph"><a rel="noopener follow" target="_blank" href="/a-practical-introduction-to-pandas-pivot-table-function-3e1002dcd4eb"><div class="pi ab fo"><div class="pj ab pk cl cj pl"><h2 class="bd iu gy z fp pm fr fs pn fu fw is bi translated">熊猫pivot_table()函数实用介绍</h2><div class="po l"><h3 class="bd b gy z fp pm fr fs pn fu fw dk translated">关于熊猫pivot_table()函数你需要知道的一切</h3></div><div class="pp l"><p class="bd b dl z fp pm fr fs pn fu fw dk translated">towardsdatascience.com</p></div></div><div class="pq l"><div class="pr l ps pt pu pq pv ks ph"/></div></div></a></div><h1 id="50e0" class="nl nm it bd nn no os nq nr ns ot nu nv jz ou ka nx kc ov kd nz kf ow kg ob oc bi translated">结论</h1><p id="a7cc" class="pw-post-body-paragraph lc ld it lf b lg od ju li lj oe jx ll lz of lo lp ma og ls lt mb oh lw lx ly im bi translated">在本文中，我们已经讨论了<code class="fe mc md me mf b">pivot()</code>的5个用例，并讨论了<code class="fe mc md me mf b">pivot()</code>和<code class="fe mc md me mf b"><a class="ae ky" rel="noopener" target="_blank" href="/a-practical-introduction-to-pandas-pivot-table-function-3e1002dcd4eb">pivot_table()</a></code>的区别。在数据预处理和探索性数据分析过程中，这是一个非常方便且最受欢迎的方法之一。</p><p id="51d6" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">重塑数据是数据科学中一项重要的基本技能。我希望你喜欢这篇文章，并学到一些新的有用的东西。</p><p id="6837" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">感谢阅读。请查看<a class="ae ky" href="https://github.com/BindiChen/machine-learning/blob/main/data-analysis/049-pandas-pivot/pivot.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>获取源代码，如果您对机器学习的实用方面感兴趣，请继续关注。更多教程可从<a class="ae ky" href="https://github.com/BindiChen/machine-learning" rel="noopener ugc nofollow" target="_blank"> Github Repo </a>获得。</p><h2 id="f80c" class="om nm it bd nn pw px dn nr py pz dp nv lz qa qb nx ma qc qd nz mb qe qf ob qg bi translated">参考</h2><ul class=""><li id="f775" class="mg mh it lf b lg od lj oe lz qh ma qi mb qj ly qk mm mn mo bi translated">[1]弗吉尼亚大学:<a class="ae ky" href="https://data.library.virginia.edu/stata-basics-reshape-data/" rel="noopener ugc nofollow" target="_blank">研究数据服务+科学</a></li></ul></div></div>    
</body>
</html>