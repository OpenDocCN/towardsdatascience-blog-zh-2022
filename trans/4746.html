<html>
<head>
<title>Crafting One Pipeline for Machine Learning Steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为机器学习步骤设计一个管道</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/crafting-one-pipeline-for-machine-learning-steps-373f03e44e1b#2022-10-21">https://towardsdatascience.com/crafting-one-pipeline-for-machine-learning-steps-373f03e44e1b#2022-10-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="75fc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用scikit-learn从输入转换到网格搜索</h2></div><p id="e2ac" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">“一条管道来统治他们，一条管道来寻找他们，一条管道来把他们都带来并在亮度上适合他们。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/417ff8a693adb5c2cde6d96752e12964.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Zg1_rYW3vSLrUBiS"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">由<a class="ae ls" href="https://unsplash.com/es/@frostroomhead?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">罗迪翁·库察耶夫</a>在<a class="ae ls" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="16fd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们查看市面上一本机器学习书籍的“目录”(即<a class="ae ls" href="#0195" rel="noopener ugc nofollow">G<em class="lb">er</em>on，2019 </a>)时，我们看到，在获取数据并将其可视化以获得洞察力之后，大致上有数据清洗、转换和处理数据属性、缩放特征、训练然后微调模型等步骤。数据科学家钟爱的模块<a class="ae ls" href="https://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank"> scikit-learn </a>，有一个惊人的功能(类)以一种简化的方式处理这些步骤:<a class="ae ls" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html" rel="noopener ugc nofollow" target="_blank"> Pipeline </a>。</p><p id="ac81" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在探索在线管道的最佳用途时，我遇到了一些很棒的实现。Luvsandorj 很好地解释了它们是什么(2020)，并展示了如何定制一个更简单的(2022)。<a class="ae ls" href="#0195" rel="noopener ugc nofollow">G<em class="lb">er</em>on</a>(2019，p . 71–72)举了一个例子，写了我们“自己的自定义转换器，用于自定义清理操作或组合特定属性等任务”。迈尔斯 (2021)展示了如何用一个分类器的流水线来运行网格搜索。另一方面，<a class="ae ls" href="#0195" rel="noopener ugc nofollow"> Batista </a> (2018)提出了如何在没有管道的情况下在网格搜索中包括大量分类器。</p><h1 id="71d5" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">介绍</h1><p id="5393" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">在这篇文章中，我将把这些来源结合起来，提出一个最终的ML管道，它可以处理大多数ML任务，如(I)特征清理，(ii)处理缺失值，(iii)缩放和编码特征，(iv)降维，以及(v)运行许多具有不同参数组合的分类器(网格搜索)，如下图所示。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/91ac7a84d5ff8b4aee01b67934aa31e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:322/format:webp/1*oEim8tcziKtIb7ZY6bi5rQ.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">作者图片</p></figure><h1 id="b0e7" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">目录</h1><p id="fe84" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated"><a class="ae ls" href="#15c5" rel="noopener ugc nofollow"><strong class="kh ir">I-库和数据集</strong> </a></p><p id="8e78" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae ls" href="#a59b" rel="noopener ugc nofollow"><strong class="kh ir">II-设置类</strong> </a></p><p id="789a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae ls" href="#3134" rel="noopener ugc nofollow"> <strong class="kh ir"> III-设置网格搜索参数</strong> </a></p><p id="4e72" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae ls" href="#ea63" rel="noopener ugc nofollow"><strong class="kh ir"/></a>四、建筑及安装管道</p><p id="efca" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae ls" href="#190c" rel="noopener ugc nofollow"><strong class="kh ir">V——计算分数</strong> </a></p><p id="e134" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae ls" href="#8381" rel="noopener ugc nofollow"> <strong class="kh ir">结论</strong> </a></p><h1 id="15c5" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak">信息库和数据集</strong></h1><p id="c21e" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">为了简单起见，让我们使用Titanic数据集，它可以很容易地从<a class="ae ls" href="#0195" rel="noopener ugc nofollow"> seaborn库</a>加载。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi mt"><img src="../Images/32e803effc321c6c8fa8b58809929831.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BRkm02Obr1rfDo_AjXsGHw.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">作者图片</p></figure><h1 id="a59b" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak">II-设置类别</strong></h1><p id="9119" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">我们需要为此流程创建以下类:</p><ul class=""><li id="32b7" class="mu mv iq kh b ki kj kl km ko mw ks mx kw my la mz na nb nc bi translated">“FeatureTransformer”操作熊猫数据框，列。例如，虽然它对模型没有影响，但我添加了一个“strlowercase”参数，该参数可以应用于一列(的列表)来转换数据。<em class="lb">(受</em> <a class="ae ls" href="#0195" rel="noopener ugc nofollow"> <em class="lb">启发g埃隆</em></a><em class="lb">)2019年第71–72页</em></li><li id="77db" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">处理缺失值的“估算器”(类似于sklearn的<a class="ae ls" href="https://scikit-learn.org/stable/modules/generated/sklearn.impute.SimpleImputer.html" rel="noopener ugc nofollow" target="_blank">简单估算器类</a>)</li><li id="4459" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">处理缺失值的“缩放器”(类似于sklearn的<a class="ae ls" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html" rel="noopener ugc nofollow" target="_blank">标准缩放器类</a>)</li><li id="e04e" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">【编码器】对(分类的或顺序的)特性进行编码<em class="lb">(受</em><a class="ae ls" href="#0195" rel="noopener ugc nofollow"><em class="lb">Luvsandorj</em></a><em class="lb">，2022</em></li><li id="bb69" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">“分类器开关”用于在网格搜索步骤中的分类器之间切换。<em class="lb">(灵感来自</em><a class="ae ls" href="#0195" rel="noopener ugc nofollow"><em class="lb"/></a><em class="lb">，2021) </em></li></ul><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><h1 id="3134" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak"> III-设置网格搜索参数</strong></h1><p id="8feb" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">我们创建两个字典<em class="lb">(灵感来自</em> <a class="ae ls" href="#0195" rel="noopener ugc nofollow"> <em class="lb">巴蒂斯塔</em> </a> <em class="lb">，2018) </em>:</p><p id="1a89" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">1- models_for_gridsearch =分类器名称作为关键字，分类器对象作为值</p><p id="8f2c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2- params_for_models =分类器名称作为关键字，分类器超参数作为:</p><ul class=""><li id="aa95" class="mu mv iq kh b ki kj kl km ko mw ks mx kw my la mz na nb nc bi translated">空字典(如LogisticRegression行含义分类器将与默认参数一起使用)或</li><li id="b2e0" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">带列表的词典(KNeighboursClassifier或RandomForestClassifier行)</li><li id="5a4d" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">字典列表(如SVC行)</li></ul><p id="896a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">注意:为了简单起见，我注释掉了其他的分类器对象。</em></p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="17a0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的目标是创建一个包含分类器和参数选择的字典列表，然后在网格搜索中使用它们。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/20d4d8ad34a915a81e371ee858040fbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*fd_OD068vQikuSw4cYoINQ.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">作者图片</p></figure><h1 id="ea63" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak">四-建筑和安装管道</strong></h1><p id="1b3d" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">我们已经为我们的管道创建了我们需要的类。是时候按顺序使用它们并使其适合了。</p><p id="2a9f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有一条管道</p><ul class=""><li id="95be" class="mu mv iq kh b ki kj kl km ko mw ks mx kw my la mz na nb nc bi translated">为我们的列分配数据类型，</li><li id="0ded" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">对一些列进行基本的数据转换</li><li id="fe2a" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">估算数字列的缺失值，并对其进行缩放</li><li id="bbdf" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">编码分类列，</li><li id="abc4" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">减少尺寸，</li><li id="bf42" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">进料后通过分类器。</li></ul><p id="ec0b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在将数据分成训练集和测试集之后，我们将这个管道与网格搜索管道参数一起输入到GridSearchCV中，以找到最佳评分模型，并使其适合我们的训练集。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="930b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最佳参数:{'clf': LogisticRegression()}</p><p id="d221" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最高分:0.8573</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nj"><img src="../Images/52a39ad4da6685a97a3a9bb1fd3c5c40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5gOu1ET6BxGfGStNdzQOfQ.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">按作者排列图像的网格搜索模型</p></figure><h1 id="190c" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak"> V-计算分数</strong></h1><p id="7975" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">我们可以使用拟合的管道(pipeline_gridsearch)来计算分数或找到属于我们的目标状态的每个实例的概率。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="c126" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">训练ROC-AUC: 0.8649</p><p id="1e7a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">测试ROC-AUC: 0.8281</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nk"><img src="../Images/6ec259f94dc57c0974ba17c28ac538e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vhmgNHMGCJBXplREXCuBUw.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">作者图片</p></figure><p id="2698" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可以看出，由于我们的FeatureTransformer步骤，embark town值是小写的。毕竟，这是为了证明我们可以在管道内转换我们的特性。</p><h1 id="8381" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">结论</h1><p id="e671" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">定制sklearn类的方式可以(I)转换和预处理我们的特性，(ii)使多个ML模型适合各种超参数，有助于增加代码的可读性，并更好地控制ML步骤。尽管这种方法需要顺序计算(请参见下图),而多管道方法可以提供并行化，尽管边际时间损失，<strong class="kh ir">单独构建一个管道</strong>在我们需要循环通过许多条件、参数、预处理步骤来查看它们对模型的影响的环境中会更有益。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/91ac7a84d5ff8b4aee01b67934aa31e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:322/format:webp/1*oEim8tcziKtIb7ZY6bi5rQ.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">作者图片</p></figure><h1 id="0195" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">参考</h1><ul class=""><li id="21a6" class="mu mv iq kh b ki ml kl mm ko nl ks nm kw nn la mz na nb nc bi translated">g<em class="lb">er</em>on，A. (2019)。使用Scikit-Learn、Keras和TensorFlow进行机器学习:构建智能系统的概念、工具和技术。).奥赖利。</li><li id="1069" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">Luvsandorj，Z 2020，“Pipeline，column transformer and feature union explained”，数据科学方向<em class="lb">，</em>9月29日，2022年10月21日访问，&lt;<a class="ae ls" rel="noopener" target="_blank" href="/pipeline-columntransformer-and-featureunion-explained-f5491f815f">https://Towards Data Science . com/Pipeline-column transformer-and-feature union-explained-f 5491 f815 f</a>&gt;</li><li id="51f2" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">Luvsandorj，Z 2022，“从ML模型到ML管道”，走向数据科学<em class="lb">，</em>5月2日，2022年10月21日访问，&lt;<a class="ae ls" rel="noopener" target="_blank" href="/from-ml-model-to-ml-pipeline-9f95c32c6512">https://towardsdatascience . com/From-ML-Model-to-ML-Pipeline-9f 95 c 32 c 6512</a>&gt;</li><li id="8a0d" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">Miles，J . 2021，“充分利用scikit-learn Pipelines”，走向数据科学<em class="lb">，</em>7月29日，2022年10月21日访问，&lt;<a class="ae ls" rel="noopener" target="_blank" href="/getting-the-most-out-of-scikit-learn-pipelines-c2afc4410f1a">https://Towards Data Science . com/Getting-the-Most-out-of-scikit-learn-Pipelines-C2 AFC 4410 f1a</a>&gt;</li><li id="5046" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">Batista，D . 2018，“scikit-learn中跨多个模型的超参数优化”，个人博客，2月23日，2022年10月21日访问，&lt;<a class="ae ls" href="https://www.davidsbatista.net/blog/2018/02/23/model_optimization/" rel="noopener ugc nofollow" target="_blank">https://www . davidsbatista . net/blog/2018/02/23/model _ optimization/</a>，T4】</li><li id="d6ae" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">瓦斯科姆，法学硕士，(2021年)。seaborn:统计数据可视化。《开源软件杂志》，6卷(60期)，3021页，【https://doi.org/10.21105/joss.03021 T2】</li></ul></div></div>    
</body>
</html>