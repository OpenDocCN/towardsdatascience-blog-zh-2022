<html>
<head>
<title>How to Download Images from Google Photos using Python and Photos Library API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python和照片库API从Google相册下载图像</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-download-images-from-google-photos-using-python-and-photos-library-api-6f9c1e60a3f3#2022-05-23">https://towardsdatascience.com/how-to-download-images-from-google-photos-using-python-and-photos-library-api-6f9c1e60a3f3#2022-05-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/220f8c6f5e979bb117d3e3490cc3e2d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LDYJValqK1zV9ru4EwZ08g.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</p></figure><p id="bfc1" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">使用Google相册REST API，您可以下载、上传和修改储存在Google相册中的图片。</p><p id="ae83" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">作为快速复习，REST是应用程序编程接口的一种架构风格，允许与RESTful web服务进行交互。[Red20]</p><p id="f7d4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">GET请求允许检索数据库条目，POST请求创建新条目，PUT请求更新条目，DELETE请求删除条目。</p><p id="6883" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">以下步骤描述了如何设置一个简单的项目，让您可以使用Python从Google相册下载图像:</p><h2 id="4360" class="ld le it bd lf lg lh dn li lj lk dp ll kq lm ln lo ku lp lq lr ky ls lt lu lv bi translated">1.打开终端窗口并导航到您的工作目录</h2><h2 id="6618" class="ld le it bd lf lg lh dn li lj lk dp ll kq lm ln lo ku lp lq lr ky ls lt lu lv bi translated">2.创建子文件夹结构或克隆存储库</h2><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="c8ff" class="ld le it mb b gy mf mg l mh mi">git clone <a class="ae mj" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:polzerdo55862/google-photos-api.git</span></pre><p id="5059" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><a class="ae mj" href="https://github.com/polzerdo55862/google-photos-api.git" rel="noopener ugc nofollow" target="_blank">https://github.com/polzerdo55862/google-photos-api.git</a></p><figure class="lw lx ly lz gt ju gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/4ae47e27ec7127140ac1173c02778299.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*Oo4LdylmyGmLhnbTYmVOIQ.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">文件夹结构—作者截图</p></figure><p id="f6ce" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">repo包含以下子文件夹:</p><ul class=""><li id="74e0" class="ml mm it kh b ki kj km kn kq mn ku mo ky mp lc mq mr ms mt bi translated"><strong class="kh iu">凭证:</strong>文件夹，用于存储向Google相册库验证“Python应用程序”所需的凭证</li><li id="c99a" class="ml mm it kh b ki mu km mv kq mw ku mx ky my lc mq mr ms mt bi translated"><strong class="kh iu"> media_items_list: </strong>脚本每次运行时，都会保存一个. csv文件，其中包含在指定时间段内上传的所有Google相册媒体项目和相应的元数据</li><li id="36f6" class="ml mm it kh b ki mu km mv kq mw ku mx ky my lc mq mr ms mt bi translated"><strong class="kh iu">下载:</strong>存储从Google相册下载的图片</li></ul><h2 id="ae2e" class="ld le it bd lf lg lh dn li lj lk dp ll kq lm ln lo ku lp lq lr ky ls lt lu lv bi translated">3.创建虚拟环境并安装所需的软件包</h2><p id="9e7c" class="pw-post-body-paragraph kf kg it kh b ki mz kk kl km na ko kp kq nb ks kt ku nc kw kx ky nd la lb lc im bi translated"><code class="fe ne nf ng mb b">python3 -m venv venv</code>，激活<code class="fe ne nf ng mb b">source ./venv/bin/activate</code>，安装需求<code class="fe ne nf ng mb b">pip install -r requirements.txt</code></p><h2 id="cbb6" class="ld le it bd lf lg lh dn li lj lk dp ll kq lm ln lo ku lp lq lr ky ls lt lu lv bi translated">4.将venv添加到Jupyter笔记本</h2><p id="8c6c" class="pw-post-body-paragraph kf kg it kh b ki mz kk kl km na ko kp kq nb ks kt ku nc kw kx ky nd la lb lc im bi translated">安装为Jupyter: <code class="fe ne nf ng mb b">pip install ipykernel</code>提供IPython内核的ipykernel，并将您的虚拟环境添加到Jupyter: <code class="fe ne nf ng mb b">python -m ipykernel install --user --name=venv</code></p><p id="858f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">您可以通过导航到<code class="fe ne nf ng mb b">/Users/Library/Jupyter/kernels</code>来检查安装。应该会有一个名为<code class="fe ne nf ng mb b">venv</code>的新目录。在这个文件夹中，您会发现<code class="fe ne nf ng mb b">kernel.json</code>文件，它定义了您正在使用的Python安装的路径。</p><p id="7eb1" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">卸载不再需要的内核:<code class="fe ne nf ng mb b">jupyter kenelspec uninstall venv</code></p><h2 id="3581" class="ld le it bd lf lg lh dn li lj lk dp ll kq lm ln lo ku lp lq lr ky ls lt lu lv bi translated">5.导航到该文件夹并启动jupyter笔记本/实验室</h2><p id="95ef" class="pw-post-body-paragraph kf kg it kh b ki mz kk kl km na ko kp kq nb ks kt ku nc kw kx ky nd la lb lc im bi translated"><code class="fe ne nf ng mb b">jupyter lab .</code></p><p id="d887" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">创建一个新的jupyter笔记本文件(或者在repo中打开现有的文件),并选择刚刚创建的环境“venv”作为内核</p><figure class="lw lx ly lz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/139ed1539908f3856bd6873ce35caeb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FK0GRiXGh7wvLSmSUAP0iQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">在Jupyter笔记本中选择虚拟环境—作者图片</p></figure><h2 id="6210" class="ld le it bd lf lg lh dn li lj lk dp ll kq lm ln lo ku lp lq lr ky ls lt lu lv bi translated">6.启用Google相册API服务</h2><ul class=""><li id="f8f2" class="ml mm it kh b ki mz km na kq ni ku nj ky nk lc mq mr ms mt bi translated">去谷歌API控制台<a class="ae mj" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">https://console.cloud.google.com/</a>。</li><li id="3cb8" class="ml mm it kh b ki mu km mv kq mw ku mx ky my lc mq mr ms mt bi translated">从菜单栏中，选择一个项目或创建一个新项目。</li></ul><figure class="lw lx ly lz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nl"><img src="../Images/b236c5e9a6aa1a54c937ef80a8af4515.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*TM_B3DddWIR6gr3PZrKVlw.gif"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">创建新项目—作者的图像</p></figure><ul class=""><li id="181c" class="ml mm it kh b ki kj km kn kq mn ku mo ky mp lc mq mr ms mt bi translated">要打开Google API库，从左侧导航菜单中选择<code class="fe ne nf ng mb b">APIs &amp; Services &gt; Library</code></li><li id="52fc" class="ml mm it kh b ki mu km mv kq mw ku mx ky my lc mq mr ms mt bi translated">搜索<code class="fe ne nf ng mb b">Google Photos Library API</code>。选择正确的结果，然后单击“启用”。如果已经启用，请单击“管理”</li><li id="070a" class="ml mm it kh b ki mu km mv kq mw ku mx ky my lc mq mr ms mt bi translated">之后，它会将您转到“照片API/服务详情”页面(<a class="ae mj" href="https://console.cloud.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank">https://console.cloud.google.com/apis/credentials</a>)</li></ul><figure class="lw lx ly lz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nl"><img src="../Images/f23796033fd993beb514cf7c3dd04243.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*j6U8_RLo9S5vQWD3WZQwNA.gif"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">启用API作者提供的图像</p></figure><h2 id="4430" class="ld le it bd lf lg lh dn li lj lk dp ll kq lm ln lo ku lp lq lr ky ls lt lu lv bi translated">7.配置“OAuth同意屏幕”[Sta21]</h2><ul class=""><li id="efde" class="ml mm it kh b ki mz km na kq ni ku nj ky nk lc mq mr ms mt bi translated">在Google相册API服务页面的左侧，点击“<a class="ae mj" href="https://console.cloud.google.com/apis/credentials/consent" rel="noopener ugc nofollow" target="_blank"> OAuth同意屏幕</a>”(在“凭证”下方)并定义同意屏幕</li><li id="4de0" class="ml mm it kh b ki mu km mv kq mw ku mx ky my lc mq mr ms mt bi translated">添加测试用户:指定用于测试API调用的google帐户的电子邮件</li></ul><figure class="lw lx ly lz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/f2b858aa094c55df5fb687ecada3b12e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XtiLnHTySDK33W7lwwDXkg.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">将用户添加到同意屏幕—作者截图</p></figure><h2 id="1774" class="ld le it bd lf lg lh dn li lj lk dp ll kq lm ln lo ku lp lq lr ky ls lt lu lv bi translated">8.创建API/OAuth凭据</h2><ul class=""><li id="9e67" class="ml mm it kh b ki mz km na kq ni ku nj ky nk lc mq mr ms mt bi translated">在Google相册API服务页面的左侧，点击凭证</li><li id="8fa0" class="ml mm it kh b ki mu km mv kq mw ku mx ky my lc mq mr ms mt bi translated">单击“创建凭据”并创建OAuth客户端ID</li><li id="8292" class="ml mm it kh b ki mu km mv kq mw ku mx ky my lc mq mr ms mt bi translated">作为应用程序类型，我选择“桌面应用程序”,并给你的客户端一个你想用来调用API的名称</li><li id="2d94" class="ml mm it kh b ki mu km mv kq mw ku mx ky my lc mq mr ms mt bi translated">将JSON文件下载到创建的凭证中，将其重命名为<code class="fe ne nf ng mb b">client_secret.json</code>，并保存在“凭证”文件夹中</li></ul><figure class="lw lx ly lz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nl"><img src="../Images/5b8a313a467d49df87b5284a836bb8f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*tFklMQo3ZuXuzqwOu9jo9A.gif"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">创建凭据—作者提供的图像</p></figure><h2 id="5173" class="ld le it bd lf lg lh dn li lj lk dp ll kq lm ln lo ku lp lq lr ky ls lt lu lv bi translated">9.首次使用谷歌照片图库API:</h2><p id="70e3" class="pw-post-body-paragraph kf kg it kh b ki mz kk kl km na ko kp kq nb ks kt ku nc kw kx ky nd la lb lc im bi translated">下一节展示了如何使用OAuth凭证通过Google Library API进行身份验证。下面的代码部分包含以下步骤:</p><ol class=""><li id="508c" class="ml mm it kh b ki kj km kn kq mn ku mo ky mp lc nn mr ms mt bi translated">创建GooglePhotosApi对象<code class="fe ne nf ng mb b">google_photos_api = GooglePhotosApi()</code></li></ol><p id="8612" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">2.函数<code class="fe ne nf ng mb b">run_local_server()</code>检查在<code class="fe ne nf ng mb b">.pickle</code>文件中是否已经存储了有效令牌，如果没有，它使用<code class="fe ne nf ng mb b">client_secret.json</code>文件<code class="fe ne nf ng mb b">cred = google_photos_api.run_local_server()</code>运行<strong class="kh iu"> OAuth 2.0授权流</strong></p><p id="433e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">第一次调用API(OAuth 2.0授权流程):</strong></p><p id="7d98" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Google将询问您是否要授予应用程序在范围中定义的所需权限:</p><figure class="lw lx ly lz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/57b7a74fabf007fae54182358e59e3a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qA8l8cjbozigOFmcyx5hcw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</p></figure><p id="da1c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">由于目前这只是一个测试应用，谷歌会让你意识到这一点。单击“继续”继续。一旦授予应用程序必要的权限，就会创建一个<code class="fe ne nf ng mb b">token_...pickle</code>文件，下载并存储在文件夹<code class="fe ne nf ng mb b">/credentials/</code>中。这个令牌文件用于将来的API请求。</p><figure class="lw lx ly lz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/14a24cf25d81ce0c9a9bac96bb0d4436.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pfYEhMYjuP3QzkvIUzagTA.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">第一次API调用后生成的令牌文件—作者截图</p></figure><figure class="lw lx ly lz gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><h2 id="dd46" class="ld le it bd lf lg lh dn li lj lk dp ll kq lm ln lo ku lp lq lr ky ls lt lu lv bi translated">10.使用Pythons请求模块和令牌文件从Google相册中检索数据</h2><p id="1c73" class="pw-post-body-paragraph kf kg it kh b ki mz kk kl km na ko kp kq nb ks kt ku nc kw kx ky nd la lb lc im bi translated">下面的函数向媒体API发送post请求，以获取所有条目的列表。由于API返回限于100个项目，所以搜索范围缩小到一天。因此，如果在一天之内创建/上传了超过100个图像，这种调用只会丢失图像。</p><figure class="lw lx ly lz gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="533e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">使用API的响应将结果和所需的元数据写入数据框并返回:</p><figure class="lw lx ly lz gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><h1 id="af9c" class="ns le it bd lf nt nu nv li nw nx ny ll nz oa ob lo oc od oe lr of og oh lu oi bi translated">11.使用定义的功能从Google相册下载媒体项目</h1><p id="e742" class="pw-post-body-paragraph kf kg it kh b ki mz kk kl km na ko kp kq nb ks kt ku nc kw kx ky nd la lb lc im bi translated">a.用已经下载到<code class="fe ne nf ng mb b">/downloads/</code>文件夹的所有文件创建一个列表</p><p id="5b40" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">b.定义从开始日期到结束日期(今天)的所有日期的列表</p><p id="e362" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">c.对所有日期执行API调用，以获得所有媒体项目的列表。API返回:</p><ul class=""><li id="ccde" class="ml mm it kh b ki kj km kn kq mn ku mo ky mp lc mq mr ms mt bi translated"><strong class="kh iu"> id </strong></li><li id="2c59" class="ml mm it kh b ki mu km mv kq mw ku mx ky my lc mq mr ms mt bi translated"><strong class="kh iu">文件名</strong></li><li id="c138" class="ml mm it kh b ki mu km mv kq mw ku mx ky my lc mq mr ms mt bi translated"><strong class="kh iu">Base Url</strong>:Google相册库API中的基本URL允许你访问媒体项目的字节。它们的有效期是60分钟。(<a class="ae mj" href="https://developers.google.com/photos/library/guides/access-media-items" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/photos/library/guides/access-media-items</a>)</li></ul><p id="99e4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">d.将下载到/downloads/文件夹中的文件的媒体项目列表与Google相册中的媒体项目进行比较，以下载尚未下载的项目。现在可以使用<code class="fe ne nf ng mb b">baseUrl</code>和python请求模块为每个媒体项发送get请求。</p><p id="3e4d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">e.将包含所有媒体项目的列表另存为。csv在<code class="fe ne nf ng mb b">/media_items_list/</code></p><figure class="lw lx ly lz gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><h1 id="d975" class="ns le it bd lf nt nu nv li nw nx ny ll nz oa ob lo oc od oe lr of og oh lu oi bi translated">摘要</h1><p id="df7d" class="pw-post-body-paragraph kf kg it kh b ki mz kk kl km na ko kp kq nb ks kt ku nc kw kx ky nd la lb lc im bi translated">本文描述了如何通过Python使用Google Photos REST API下载(和操作)Google Photos内容。</p><p id="149a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我主要使用API来搜索用我的智能手机拍摄的图像的文本和特征，并将提取的信息推送到概念。</p><h1 id="14c4" class="ns le it bd lf nt nu nv li nw nx ny ll nz oa ob lo oc od oe lr of og oh lu oi bi translated">参考</h1><p id="dad8" class="pw-post-body-paragraph kf kg it kh b ki mz kk kl km na ko kp kq nb ks kt ku nc kw kx ky nd la lb lc im bi translated">[stat 21]错误403:来自Google身份验证web API的access_denied，2021。URL<a class="ae mj" href="https://stackoverflow.com/questions/65184355/error-403-access-denied-from-google-authentication-web-api-despite-google-acc" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/65184355/error-403-access-denied-from-Google-authentic ation-we b-API-Duncan-Google-ACC</a></p><p id="75b1" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">[Red20] RedHat:什么是REST API？, 2020.网址<a class="ae mj" href="https://www.redhat.com/en/topics/api/what-is-a-rest-api" rel="noopener ugc nofollow" target="_blank">https://www.redhat.com/en/topics/api/what-is-a-rest-api</a></p></div></div>    
</body>
</html>