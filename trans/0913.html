<html>
<head>
<title>Easiest Way to Plot on a World Map with Pandas and GeoPandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用熊猫和地质熊猫在世界地图上绘图的最简单方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/easiest-way-to-plot-on-a-world-map-with-pandas-and-geopandas-325f6024949f#2022-03-11">https://towardsdatascience.com/easiest-way-to-plot-on-a-world-map-with-pandas-and-geopandas-325f6024949f#2022-03-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="631e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 Python 中的 Pandas 和 GeoPandas 读取、清理和绘制地理空间数据的综合指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/591d206d76e0f7956fb439d3d6633f5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*brZQ32BwpiJS0fgC6QpIQw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">报道的火球撞击能量[由作者创造]</p></figure><p id="63b5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">学习如何用 Python 创建世界地图可能需要一点时间来弄清楚，但是一旦你知道如何做，你就可以很容易地复制它。假设您有想要绘制的地理数据；你可以用一个带有国家名称的条形图，把你的数据绘制成一个条形图，但是这很无聊。一种更具视觉吸引力的数据呈现方式是将其叠加在地图上，以物理方式显示数据的交互方式。这可能是一个具有挑战性的努力，但我在这里提供帮助。按照这个例子，你应该开始创造惊人的地理空间视觉效果。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mb"><img src="../Images/2b205170df35b6f933bd750f3bff63c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Pmtmqvn31Dhmiztz"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由锡德·巴拉钱德朗在<a class="ae mc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="05f6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我将假设您对如何使用 Python 有一个基本的了解，但是如果您在浏览代码时有任何问题，请在评论中告诉我。我非常乐意帮忙。对于本文，我们将使用来自近地天体研究中心(NASA 喷气推进实验室的一部分)的数据集。如果你想重现本文中的形象，你应该从这个<a class="ae mc" href="https://cneos.jpl.nasa.gov/fireballs/" rel="noopener ugc nofollow" target="_blank">链接</a>下载。将文件下载为<em class="md">。csv </em>文件并保存在方便的位置。现在，让我们进入代码:</p><h2 id="0981" class="me mf it bd mg mh mi dn mj mk ml dp mm lh mn mo mp ll mq mr ms lp mt mu mv mw bi translated">导入库</h2><p id="5820" class="pw-post-body-paragraph ky kz it la b lb mx ju ld le my jx lg lh mz lj lk ll na ln lo lp nb lr ls lt im bi translated">以下是绘制数据所需的库的列表:</p><ul class=""><li id="0b48" class="nc nd it la b lb lc le lf lh ne ll nf lp ng lt nh ni nj nk bi translated"><em class="md"> Matplotlib </em>用于导入<em class="md"> pyplot </em>包(为方便起见定义为<code class="fe nl nm nn no b">plt</code>)，用于绘图目的</li><li id="4619" class="nc nd it la b lb np le nq lh nr ll ns lp nt lt nh ni nj nk bi translated"><em class="md"> Pandas </em>(为方便起见定义为<code class="fe nl nm nn no b">pd</code>)用于从<em class="md">读取和操作数据集。csv </em>文件</li><li id="2643" class="nc nd it la b lb np le nq lh nr ll ns lp nt lt nh ni nj nk bi translated"><em class="md"> GeoPandas </em>(为方便起见定义为<code class="fe nl nm nn no b">gpd</code>)用于创建我们的世界地图</li></ul><pre class="kj kk kl km gt nu no nv nw aw nx bi"><span id="dc22" class="me mf it no b gy ny nz l oa ob"># Importing libraries<br/>import matplotlib.pyplot as plt<br/>import pandas as pd<br/>import geopandas as gpd</span></pre><p id="7cd7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我看过很多论坛和文章，都是关于人们努力安装<em class="md"> GeoPandas </em>的。我自己也有点纠结，但是这个<a class="ae mc" href="https://geoffboeing.com/2014/09/using-geopandas-windows/" rel="noopener ugc nofollow" target="_blank">教程</a>很有帮助，解决了我遇到的问题。如果你还没有安装<em class="md"> GeoPandas </em>，我强烈建议你遵循那个教程。</p><h2 id="c496" class="me mf it bd mg mh mi dn mj mk ml dp mm lh mn mo mp ll mq mr ms lp mt mu mv mw bi translated">读取数据文件</h2><p id="6b67" class="pw-post-body-paragraph ky kz it la b lb mx ju ld le my jx lg lh mz lj lk ll na ln lo lp nb lr ls lt im bi translated">接下来，我们将使用<em class="md"> Pandas </em> (as <code class="fe nl nm nn no b">pd</code>)从<em class="md">cneos _ fireball _ data . CSV</em>文件中读取数据。在<code class="fe nl nm nn no b">read_csv</code>函数中，我们使用文件的标题名来提取所需的数据列。这些头文件的格式并不总是最容易阅读的，所以我们可以使用如图所示的<code class="fe nl nm nn no b">rename</code>函数来重命名它们。</p><pre class="kj kk kl km gt nu no nv nw aw nx bi"><span id="0824" class="me mf it no b gy ny nz l oa ob"># Reading cvs file using pandas<br/>df = pd.read_csv('cneos_fireball_data.csv', <br/>                 usecols=["Peak Brightness Date/Time (UT)", <br/>                 "Calculated Total Impact Energy (kt)", <br/>                 "Latitude (deg.)", "Longitude (deg.)"])<br/>df = df.rename(columns={"Peak Brightness Date/Time (UT)": <br/>                        'Datetime',<br/>                        "Calculated Total Impact Energy (kt)": <br/>                        'Impact Energy [kt]',<br/>                        "Latitude (deg.)": 'Latitude',<br/>                        "Longitude (deg.)": 'Longitude'})<br/><br/># Showing raw data and data types<br/>print(pd.DataFrame(df))<br/>print('\n')<br/>print(df.dtypes)<br/>print('\n')</span></pre><p id="aaf8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">导入数据后，我们可以显示数据集的一部分，并查看有哪些数据类型。下面是这段代码的输出:</p><pre class="kj kk kl km gt nu no nv nw aw nx bi"><span id="ec82" class="me mf it no b gy ny nz l oa ob">             Datetime Latitude Longitude  Impact Energy [kt]<br/>0      1/11/2022 3:33    58.4S    160.2W               2.900<br/>1      1/1/2022 20:23    66.1N    152.6W               0.420<br/>2     12/29/2021 3:15    69.7S    115.0E               0.073<br/>3    12/23/2021 21:27     4.9S     29.6W               0.076<br/>4    12/20/2021 23:15    62.7N     60.3E               0.110<br/>..                ...      ...       ...                 ...<br/>881  11/29/1993 17:48    26.5N     78.3E               0.092<br/>882   10/31/1993 3:39    51.3N    100.9W               0.130<br/>883    10/4/1991 9:22    78.7N      6.3E               1.400<br/>884    10/1/1990 3:51     7.5N    142.8E               5.200<br/>885    4/15/1988 3:03     4.1S    124.3E              14.000</span><span id="c675" class="me mf it no b gy oc nz l oa ob">[886 rows x 4 columns]</span><span id="b59c" class="me mf it no b gy oc nz l oa ob">Datetime               object<br/>Latitude               object<br/>Longitude              object<br/>Impact Energy [kt]    float64<br/>dtype: object</span></pre><p id="75b7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意，<code class="fe nl nm nn no b">Datetime</code>、<code class="fe nl nm nn no b">Latitude</code>和<code class="fe nl nm nn no b">Longitude</code>都是<em class="md">对象</em>数据类型。在我们绘制数据之前，需要对这些进行修正。</p><h2 id="5814" class="me mf it bd mg mh mi dn mj mk ml dp mm lh mn mo mp ll mq mr ms lp mt mu mv mw bi translated">清洗数据集</h2><p id="c53e" class="pw-post-body-paragraph ky kz it la b lb mx ju ld le my jx lg lh mz lj lk ll na ln lo lp nb lr ls lt im bi translated">清理该数据集的第一步是使用<em class="md"> Pandas </em>将<code class="fe nl nm nn no b">Datetime</code>列转换为<em class="md"> datetime </em>数据类型。接下来，我们还需要将<code class="fe nl nm nn no b">Longitude</code>和<code class="fe nl nm nn no b">Latitude</code>列转换为<em class="md"> float </em>数据类型。这包括删除字母 N、E、S 和 W，并将这些方向转换为正确的正值或负值。此外，我们可以将我们的<code class="fe nl nm nn no b">Impact Energy [kt]</code>列限制在 20 kt 以下，以消除一些异常值。</p><pre class="kj kk kl km gt nu no nv nw aw nx bi"><span id="36d7" class="me mf it no b gy ny nz l oa ob"># Converting to a datetime datatype<br/>df['Datetime'] = pd.to_datetime(df['Datetime'], errors='coerce')<br/><br/># Applying +/- based on direction and converting to numeric datatype<br/>for x in range(len(df['Longitude'])):<br/>    if str(df.loc[x, 'Longitude'])[-1] == 'E':<br/>        df.loc[x, 'Longitude'] = str(df.loc[x, 'Longitude'])[:-1]<br/>    if str(df.loc[x, 'Longitude'])[-1] == 'W':<br/>        df.loc[x, 'Longitude'] = \<br/>            '-' + str(df.loc[x, 'Longitude'])[:-1]<br/><br/>for x in range(len(df['Latitude'])):<br/>    if str(df.loc[x, 'Latitude'])[-1] == 'N':<br/>        df.loc[x, 'Latitude'] = str(df.loc[x, 'Latitude'])[:-1]<br/>    if str(df.loc[x, 'Latitude'])[-1] == 'S':<br/>        df.loc[x, 'Latitude'] = \<br/>            '-' + str(df.loc[x, 'Latitude'])[:-1]<br/><br/>df['Longitude'] = pd.to_numeric(df['Longitude'], errors='coerce')<br/>df['Latitude'] = pd.to_numeric(df['Latitude'], errors='coerce')<br/><br/># Converting to numeric datatype<br/>threshold = 20<br/>df = df[df['Impact Energy [kt]'] &lt; threshold]<br/>df['Impact Energy [kt]'] = pd.to_numeric(df['Impact Energy [kt]'], <br/>                                         errors='coerce')</span></pre><p id="0f40" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">清理数据集的最后一步是消除在数据类型转换过程中出现错误的行。当出现错误时,<code class="fe nl nm nn no b">error='coerce'</code>代码将引入一个<code class="fe nl nm nn no b">NaN</code>(意味着当一个值不能被转换成正确的数据类型时),因此我们可以使用<code class="fe nl nm nn no b">dropna</code>和<code class="fe nl nm nn no b">reset_index</code>来消除那些错误并重置我们的数据集索引。</p><pre class="kj kk kl km gt nu no nv nw aw nx bi"><span id="63cd" class="me mf it no b gy ny nz l oa ob"># Dropping the errors from data conversions and resetting index<br/>df.dropna()<br/>df = df.reset_index(drop=True)<br/><br/># Showing cleaned data and data types<br/>print(pd.DataFrame(df))<br/>print('\n')<br/>print(df.dtypes)<br/>print('\n')</span></pre><p id="e2e9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下输出显示了清理后的数据集和更正后的数据类型。</p><pre class="kj kk kl km gt nu no nv nw aw nx bi"><span id="0807" class="me mf it no b gy ny nz l oa ob">               Datetime  Latitude  Longitude  Impact Energy [kt]<br/>0   2022-01-11 03:33:00     -58.4     -160.2               2.900<br/>1   2022-01-01 20:23:00      66.1     -152.6               0.420<br/>2   2021-12-29 03:15:00     -69.7      115.0               0.073<br/>3   2021-12-23 21:27:00      -4.9      -29.6               0.076<br/>4   2021-12-20 23:15:00      62.7       60.3               0.110<br/>..                  ...       ...        ...                 ...<br/>876 1993-11-29 17:48:00      26.5       78.3               0.092<br/>877 1993-10-31 03:39:00      51.3     -100.9               0.130<br/>878 1991-10-04 09:22:00      78.7        6.3               1.400<br/>879 1990-10-01 03:51:00       7.5      142.8               5.200<br/>880 1988-04-15 03:03:00      -4.1      124.3              14.000</span><span id="817a" class="me mf it no b gy oc nz l oa ob">[881 rows x 4 columns]</span><span id="b435" class="me mf it no b gy oc nz l oa ob">Datetime              datetime64[ns]<br/>Latitude                     float64<br/>Longitude                    float64<br/>Impact Energy [kt]           float64<br/>dtype: object</span></pre><h2 id="0e62" class="me mf it bd mg mh mi dn mj mk ml dp mm lh mn mo mp ll mq mr ms lp mt mu mv mw bi translated">创建世界地图和绘制数据</h2><p id="5547" class="pw-post-body-paragraph ky kz it la b lb mx ju ld le my jx lg lh mz lj lk ll na ln lo lp nb lr ls lt im bi translated">最后，我们可以利用<em class="md"> GeoPandas </em>库导入一张世界地图。为了绘制<code class="fe nl nm nn no b">worldmap</code>数据，我们需要创建一个图形。然后，我们可以调用<code class="fe nl nm nn no b">worldmap</code>变量的<code class="fe nl nm nn no b">plot</code>方法。这将在我们的地图上创建世界地图，但我们也想包括我们的火球数据。为了包含它，我们调用<code class="fe nl nm nn no b">scatter</code>并为我们的点定义一些绘图参数。最后，没有标题和轴的情节是不完整的，所以我们也创造了它们。</p><pre class="kj kk kl km gt nu no nv nw aw nx bi"><span id="b57a" class="me mf it no b gy ny nz l oa ob"># From GeoPandas, our world map data<br/>worldmap = gpd.read_file(gpd.datasets.get_path("naturalearth_lowres"))<br/><br/># Creating axes and plotting world map<br/>fig, ax = plt.subplots(figsize=(12, 6))<br/>worldmap.plot(color="lightgrey", ax=ax)<br/><br/># Plotting our Impact Energy data with a color map<br/>x = df['Longitude']<br/>y = df['Latitude']<br/>z = df['Impact Energy [kt]']<br/>plt.scatter(x, y, s=20*z, c=z, alpha=0.6, vmin=0, vmax=threshold,<br/>            cmap='autumn')<br/>plt.colorbar(label='Impact Energy [kt]')<br/><br/># Creating axis limits and title<br/>plt.xlim([-180, 180])<br/>plt.ylim([-90, 90])<br/><br/>first_year = df["Datetime"].min().strftime("%Y")<br/>last_year = df["Datetime"].max().strftime("%Y")<br/>plt.title("NASA: Fireballs Reported by Government Sensors\n" +     <br/>          str(first_year) + " - " + str(last_year))<br/>plt.xlabel("Longitude")<br/>plt.ylabel("Latitude")<br/>plt.show()</span></pre><p id="db85" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果操作正确，您的绘图应该如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/591d206d76e0f7956fb439d3d6633f5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*brZQ32BwpiJS0fgC6QpIQw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">报道的火球撞击能量[由作者创造]</p></figure></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><p id="ff47" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢您阅读文章！给我一个关注，看看我关于 Python、空间和轨道力学的其他文章！如果您有任何意见或顾虑，请告诉我！</p><h2 id="6c16" class="me mf it bd mg mh mi dn mj mk ml dp mm lh mn mo mp ll mq mr ms lp mt mu mv mw bi translated">承认</h2><p id="4c58" class="pw-post-body-paragraph ky kz it la b lb mx ju ld le my jx lg lh mz lj lk ll na ln lo lp nb lr ls lt im bi translated">这里使用的数据集是由美国宇航局 EOSDIS 提供的。由于美国宇航局是一个政府实体，它不许可其材料，包括数据集。你可以在这里找到更多关于 NASA 许可的信息:<a class="ae mc" href="https://earthdata.nasa.gov/earth-observation-data/data-use-policy" rel="noopener ugc nofollow" target="_blank">https://earth data . NASA . gov/earth-observation-data/data-use-policy</a></p></div></div>    
</body>
</html>