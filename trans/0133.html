<html>
<head>
<title>Heroku + Docker in 10 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">10 分钟内 Heroku + Docker</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/heroku-docker-in-10-minutes-f4329c4fd72f#2022-02-06">https://towardsdatascience.com/heroku-docker-in-10-minutes-f4329c4fd72f#2022-02-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b730" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Python 应用程序的部署变得简单，而且是免费的</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ac57c0286d30ca278d3d06cfad73f9c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BsP30-W6KRbA3u6M"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@diegitane?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">迭戈·费尔南德斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="dec0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果只需要精通一门编程语言，那么在本地机器上启动一个 web 应用程序是很容易的。然而，部署一个 web 应用程序需要大量的试验和错误，特别是当涉及到更多工具时，您现在必须担心部署环境、可伸缩性和其他问题。如果您正在寻找部署一个 Python web 应用程序(例如 Flask/Django)，那么这篇文章就是为您准备的！如果你已经对 Heroku 和 Docker 有所了解，可以跳过前三节。</p><p id="0fa7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">更新</em> </strong> <em class="lv">:本文是系列文章的一部分。查看其他“10 分钟内”话题</em> <a class="ae ky" href="https://medium.com/@kayjanwong/list/in-10-minutes-eeaa9aa67055" rel="noopener"> <em class="lv">此处</em> </a> <em class="lv">！</em></p><h1 id="8cae" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">目录</h1><ul class=""><li id="95a3" class="mo mp it lb b lc mq lf mr li ms lm mt lq mu lu mv mw mx my bi translated">为什么是 Heroku？</li><li id="950f" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><a class="ae ky" href="https://medium.com/p/f4329c4fd72f/#d64b" rel="noopener">为什么是 Docker？</a></li><li id="f927" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><a class="ae ky" href="https://medium.com/p/f4329c4fd72f/#7a07" rel="noopener">码头工人速成班</a></li><li id="c28f" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">在 Heroku 部署码头工人</li></ul></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="c950" class="lw lx it bd ly lz nl mb mc md nm mf mg jz nn ka mi kc no kd mk kf np kg mm mn bi translated">为什么是 Heroku？</h1><p id="31c4" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">Heroku 是一个云平台即服务(PaaS)，允许应用程序托管在云上。对于寻找 Python 应用程序免费托管平台的人来说，Heroku 是十大选择之一(尽管也有付费层)。</p><p id="1b16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于免费层，Heroku 提供了与 GitHub 的集成，并使用 Heroku 容器进行部署，称为<code class="fe nt nu nv nw b">dyno</code>。我还会提到一些我觉得很麻烦的使用免费层的注意事项。</p><ol class=""><li id="67f8" class="mo mp it lb b lc ld lf lg li nx lm ny lq nz lu oa mw mx my bi translated">无法选择自定义域，因此应用程序将由<code class="fe nt nu nv nw b">&lt;app-name&gt;.herokuapp.com</code>域托管</li><li id="9a02" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu oa mw mx my bi translated">没有 SSL 证书，但一个解决方法是手动输入<code class="fe nt nu nv nw b">https://</code>来获得相同的安全锁图标</li><li id="cdf7" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu oa mw mx my bi translated">Free <code class="fe nt nu nv nw b">dynos</code>会在一段时间不活动后休眠，因此重启应用程序需要一段时间(大约 1 分钟)来启动容器</li><li id="4d64" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu oa mw mx my bi translated">存储库将被编译成一个<code class="fe nt nu nv nw b">slug</code>，如果段大小超过 500 MB，性能将开始下降。这将严重限制存储库的大小。一种解决方法是将您的应用程序编译成 Docker 映像，并绕过 slug 大小要求</li></ol><p id="c83a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">更新</em> </strong> <em class="lv"> : Heroku 已于 2022 年 11 月移除其免费层，替代方案是使用 Google Cloud 或 Fly。如果你使用的是付费版本的 Heroku，请继续阅读！</em></p><div class="ob oc gp gr od oe"><a rel="noopener follow" target="_blank" href="/google-cloud-vs-fly-io-as-heroku-alternatives-1f5a47716a58"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">Google Cloud vs. Fly.io 作为 Heroku 替代方案</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">自由层 Docker 部署的比较</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">towardsdatascience.com</p></div></div><div class="on l"><div class="oo l op oq or on os ks oe"/></div></div></a></div><h1 id="d64b" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">为什么是 Docker？</h1><p id="443d" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">Docker 帮助在称为容器的包中交付 web 应用程序。使用容器是部署的最佳实践，因为每个容器都有自己的软件、库和配置文件，并且很容易扩展或缩小 web 应用程序。然而，在 Heroku 免费层，我不认为有一个选项来扩展 web 应用程序。</p><p id="5400" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上一节的最后一个警告也是我选择从使用 Heroku 容器切换到 Docker 容器的原因。我正在扩展我的 web 应用程序，意识到我的存储库变得太大了，而我的 web 应用程序越来越慢。在切换到 Docker 容器后，我的 web 应用程序甚至比在我的本地计算机上运行得更快！</p><blockquote class="ot"><p id="aa3c" class="ou ov it bd ow ox oy oz pa pb pc lu dk translated">我建议将 Heroku 与 Docker 结合使用，使您的 web 应用程序面向未来，这样您就不必像我一样进行切换。</p></blockquote><h1 id="7a07" class="lw lx it bd ly lz ma mb mc md me mf mg jz pd ka mi kc pe kd mk kf pf kg mm mn bi translated">码头工人速成班</h1><p id="3626" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">如何创建一个容器的指令通常写在一个<code class="fe nt nu nv nw b">Dockerfile</code>中，编译时要忽略的文件可以在<code class="fe nt nu nv nw b">.dockerignore</code>中找到。下面是一个<code class="fe nt nu nv nw b">.dockerignore</code>文件的示例，但是如果您希望 Docker 编译存储库中的所有内容，这个文件是可选的。</p><pre class="kj kk kl km gt pg nw ph bn pi pj bi"><span id="134d" class="pk lx it nw b be pl pm l pn po">__pycache__<br/>*.pyc<br/>env/<br/>db.sqlite3<br/>docs/<br/>*.log</span></pre><p id="3eec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于<code class="fe nt nu nv nw b">Dockerfile</code>，有一些常用的命令，</p><ul class=""><li id="0567" class="mo mp it lb b lc ld lf lg li nx lm ny lq nz lu mv mw mx my bi translated"><code class="fe nt nu nv nw b">FROM</code>在<code class="fe nt nu nv nw b">Dockerfile</code>的开头使用一次，表示使用哪个基础映像，在我们的例子中，我们希望使用一个支持 Python 的基础映像</li><li id="241e" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe nt nu nv nw b">ARG</code>定义用户在构建时传入的变量。在下面的示例中，<code class="fe nt nu nv nw b">port</code>是构建 Docker 映像时要传入的参数</li><li id="610d" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe nt nu nv nw b">USER</code>运行 Docker 镜像时设置用户名或用户组</li><li id="e712" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe nt nu nv nw b">COPY</code>将文件和目录复制到容器中</li><li id="59e4" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe nt nu nv nw b">WORKDIR</code>设置容器的工作目录</li><li id="c6f6" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe nt nu nv nw b">ENV</code>设置环境变量</li><li id="8b85" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe nt nu nv nw b">RUN</code>运行 shell 命令，该命令在 Linux 上调用<code class="fe nt nu nv nw b">/bin/sh -c</code></li><li id="6cc2" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe nt nu nv nw b">EXPOSE</code>通知 Docker 容器在运行时监听指定的网络端口，用于本地测试 Docker 应用程序</li><li id="f736" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe nt nu nv nw b">CMD</code>在<code class="fe nt nu nv nw b">Dockerfile</code>的末尾使用一次，包含运行执行容器的最终命令</li></ul><p id="a2ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于 Docker 命令完整列表的信息可以在<a class="ae ky" href="https://docs.docker.com/engine/reference/" rel="noopener ugc nofollow" target="_blank"> Docker 文档</a>中找到。下面是<code class="fe nt nu nv nw b">Dockerfile</code>的样图，</p><pre class="kj kk kl km gt pg nw ph bn pi pj bi"><span id="aa52" class="pk lx it nw b be pl pm l pn po">FROM python:3.8-slim<br/>ARG port<br/><br/>USER root<br/>COPY . /&lt;your-app&gt;<br/>WORKDIR /&lt;your-app&gt;<br/><br/>ENV PORT=$port<br/><br/>RUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends apt-utils \<br/>    &amp;&amp; apt-get -y install curl \<br/>    &amp;&amp; apt-get install libgomp1<br/><br/>RUN chgrp -R 0 /&lt;your-app&gt; \<br/>    &amp;&amp; chmod -R g=u /&lt;your-app&gt; \<br/>    &amp;&amp; pip install pip --upgrade \<br/>    &amp;&amp; pip install -r requirements.txt<br/>EXPOSE $PORT<br/><br/>CMD gunicorn app:server --bind 0.0.0.0:$PORT --preload</span></pre><p id="162a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最好在部署之前测试一下<code class="fe nt nu nv nw b">Dockerfile</code>是否能够在本地编译，这需要构建 Docker 映像并运行它。</p><ul class=""><li id="6e22" class="mo mp it lb b lc ld lf lg li nx lm ny lq nz lu mv mw mx my bi translated">构建 Docker 映像:下面的命令传入了<code class="fe nt nu nv nw b">port</code>参数，映像名为<code class="fe nt nu nv nw b">tmp_image</code>、<code class="fe nt nu nv nw b">docker build --no-cache --build-arg port=8060 -t tmp_image .</code></li><li id="d669" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">运行 Docker 镜像:以下命令将 Docker 镜像的端口映射到本地端口，以便可以在本地查看 web 应用程序，<code class="fe nt nu nv nw b">docker run --rm -p 8060:8060 tmp_image</code></li></ul><h1 id="ee9e" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">在 Heroku 部署 Docker</h1><p id="ca05" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">假设您已经有了 web 应用程序的文件夹结构，那么您只需要另外 3 个文件来部署到 Heroku。其中两个文件是 Docker 的指令，如前一节所述，最后一个文件<code class="fe nt nu nv nw b">heroku.yml</code>包含 Heroku 的部署指令。下面是示例项目文件夹结构，</p><pre class="kj kk kl km gt pg nw pp pq aw pr bi"><span id="62b2" class="ps lx it nw b gy pt pu l pv po">your-app<br/>|-- <strong class="nw iu">.dockerignore</strong><br/>|-- app.py<br/>|-- <strong class="nw iu">Dockerfile<br/>|-- heroku.yml<br/></strong>|-- requirements.txt</span></pre><p id="9d04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于<code class="fe nt nu nv nw b">heroku.yml</code>文件，您只需要指明部署使用的是 Docker，文件如下所示，</p><pre class="kj kk kl km gt pg nw ph bn pi pj bi"><span id="376b" class="pk lx it nw b be pl pm l pn po">build:<br/>  docker:<br/>    web: Dockerfile</span></pre><p id="be7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成了！剩下的就是按照屏幕上的指示将 Heroku 链接到您的代码库，您的 web 应用程序将在构建完成后准备就绪！</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><p id="f04e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望你已经学会了如何使用 Docker 在 Heroku 上部署 Python 应用程序。如果您有兴趣查看我以同样方式部署的 web 应用程序，链接在下面！</p><div class="ob oc gp gr od oe"><a href="https://kayjan.herokuapp.com" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">让生活更轻松的工具</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">Kay Jan 的副业项目——自动化重复的数据分析任务，并执行预测和优化</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">kayjan.herokuapp.com</p></div></div><div class="on l"><div class="pw l op oq or on os ks oe"/></div></div></a></div><p id="b0ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">感谢您的阅读！如果你喜欢这篇文章，请随意分享。</strong></p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="d3e0" class="lw lx it bd ly lz nl mb mc md nm mf mg jz nn ka mi kc no kd mk kf np kg mm mn bi translated">相关链接</h1><p id="c89a" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">Heroku 部署文档:<a class="ae ky" href="https://devcenter.heroku.com/categories/deploying-with-docker" rel="noopener ugc nofollow" target="_blank">https://dev center . heroku . com/categories/deploying-with-docker</a></p><p id="2f5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nt nu nv nw b">Dockerfile</code>文档:<a class="ae ky" href="https://docs.docker.com/engine/reference/builder/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/engine/reference/builder/</a></p><p id="a454" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nt nu nv nw b">heroku.yml</code>文件:<a class="ae ky" href="https://devcenter.heroku.com/articles/build-docker-images-heroku-yml" rel="noopener ugc nofollow" target="_blank">https://devcenter . heroku . com/articles/build docker-images-heroku-yml</a></p></div></div>    
</body>
</html>