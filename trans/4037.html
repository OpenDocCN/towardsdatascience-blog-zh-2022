<html>
<head>
<title>Using Arrays in PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在PostgreSQL中使用数组</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-arrays-in-postgresql-450202a2b57f#2022-09-08">https://towardsdatascience.com/using-arrays-in-postgresql-450202a2b57f#2022-09-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="75e5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">学习在SQL中创建和操作列表和嵌套结构</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a547d0e5e6473e702506c7d7b0820eba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ct18RaLt2jPWwKQO"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">卡斯帕·卡米尔·鲁宾在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="90fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您想到表的SQL图像时，选择查询和每个数据点一行的概念(没有嵌套结构)可能会浮现在脑海中。<br/>但是如果你想存储一个数字、产品等的列表呢？一排以内？<br/>你当然可以将列表分解成许多行，但是这可能会导致难以跟踪的行的混乱。幸运的是，PostgreSQL提供了数组数据类型，可用于存储和操作列表。<br/>下面是方法:</p><h2 id="bbcf" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">数组类型</h2><p id="09e7" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">PostgreSQL允许将表中的列定义为可变长度的多维数组。可以创建任何内置或用户定义的基本类型、枚举类型、复合类型、范围类型或域的数组。</p><h2 id="a1e3" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">创建数组</h2><p id="9ba8" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">数组可以采用多种形式，并且有多种方法来声明它们。</p><p id="8922" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在列的数据类型声明后使用关键字ARRAY来表示您想要创建一个声明前数据类型的数组，如下所示。</p><p id="0ffb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以在数据类型声明后面加上方括号(例如text[])，但是我发现这样不太明确，并且不符合关键字版本所遵循的SQL标准。</p><p id="78df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的例子中，我创建了一个小表来模拟购物卡，并用多种产品的一些排列来填充它。如果您运行完整的查询，您还可以看到数组是如何表示为输出的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建和填充数组列</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/caf422769d2ea367f7613f48a871e960.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*8NHjVlleiSoDAiXofA_ltw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">结果表</p></figure><p id="bdc5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">向表中添加数组的另一种方法是使用{ }-语法，而不是带括号的Array关键字。两种方法都有效，你只需要<strong class="lb iu">密切注意带花括号的引文</strong>。，我再次发现关键字语法更明确，括号更接近于其他编程语言中的数组表示，但两者都工作得很好。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="5dd8" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">取消阵列嵌套</h2><p id="1463" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">但是等等！如果您实际上需要展开或取消嵌套特定行的数组，以便在某个产品信息表上连接或在列表项基础上执行其他操作，该怎么办？</p><p id="77c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没问题，PostgreSQL中的数组可以很容易地用UNNEST关键字取消嵌套:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">取消对数组列的嵌套</p></figure><p id="666c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如所料，UNNEST在原始行的相应数组中为每个项目创建一行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/55658a095b4a7297a79f57413eba3969.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/1*5tBL6SBzo9a3vvqlLEGv_w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">取消阵列嵌套的结果</p></figure><h2 id="1de7" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">访问数组项目</h2><p id="3d3c" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">您可能会问自己，每次想要访问单个项以进行进一步操作时，是否必须取消数组嵌套。如果是这样的话，数组结构可能并不是一个好主意。幸运的是，PostgreSQL中的数组允许通过括号和切片索引进行访问，如下所示。这允许容易地选择例如每个列表中的第一个项目或列表中特定范围的项目。</p><p id="1a2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="mx">注意:PostgreSQL数组中的索引从1开始，而不是从0开始，这可能与你在其他编程语言中所习惯的不同。</em>T3】</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">通过索引访问数组项</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi my"><img src="../Images/70feba72024e5daaec7ce5f42fe38789.png" data-original-src="https://miro.medium.com/v2/resize:fit:702/format:webp/1*cYRJiagVLb7IQstzMTLhiA.png"/></div></figure><p id="3729" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">切片使用[start:end]-语法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">通过对具有两个以上数组元素的所有行进行切片来访问数组项。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/1663b72500416fd6bd9e4a71873592eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*X9ToN440iUCH8x74Rf8jUQ.png"/></div></figure><p id="41af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你不确定你的数组有多少项，或者你想按照数组的大小进行过滤，就像我上面做的那样，你可以使用CARDINALITY关键字。这将返回数组中的整数个数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="b0ac" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">按数组元素过滤</h2><p id="5267" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">如果您想选择数组中有特定产品的所有购物车，该怎么办？或者任何其他基于数组项的筛选操作？没问题，PostgreSQL允许将WHERE子句中的item值与ANY关键字结合使用。下面，我正在筛选产品数组列中包含“product_c”的行。这种过滤方式对单个过滤值最有用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">按数组中的项目筛选行</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/45ad3bbab68088f274b98c29740eef82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*bvJuuj9KpbwP1XZxRZRZMA.png"/></div></figure><h2 id="8915" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">包含运算符</h2><p id="f92f" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">您还可以从上面扩展过滤器逻辑，并要求任何包含特定子数组的购物卡。在这里，我使用了代表“包含”的“@ &gt;”操作符。可以这样理解:</p><p id="e306" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">"产品数组包含数组['产品a '，'产品b']"</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/cdeafc0b1e1006bb1ccb5545043bded1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*YJy4M2qB-RjxOXYXtxzaDw.png"/></div></figure><h2 id="8469" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">更新阵列</h2><p id="d525" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">数组和数组值可以像其他数据类型一样进行更新，使用UPDATE … SET …子句，如下所示。您可以通过索引更新单个数组项，也可以更新整个数组。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="c71c" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">前置和追加</h2><p id="f944" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">如果您希望通过追加或前置(在当前值之前插入)数组来专门改变数组，您可以相应地使用ARRAY_APPEND和ARRAY_PREPEND函数。确保<strong class="lb iu">注意到参数顺序</strong>的不同，每个函数的顺序不同，但遵循直觉顺序。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">追加和前置数组</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/f4a5ed3c95fe4065a1ddce9cf5a84e52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*aiMO-sGa9vdR4qejD6XF1w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">前两行通过追加和前置进行更改</p></figure><h2 id="9bd8" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">移除数组项目</h2><p id="7ecb" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">如果你想去掉一个特定的数组项，你可以使用UPDATE…SET…和ARRAY_REMOVE函数。这允许您从所有行的数组中移除一个项，或者在与WHERE子句一起使用时仅移除一个特定项。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">移除数组项目</p></figure><h2 id="0500" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">串联数组</h2><p id="488d" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">最后，您可以使用ARRAY_CAT将PostgreSQL数组连接成一个更大的数组，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/37da88fec47dff5e17af4fee0d8a60db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OEQFzxpUFWeDvjfdltuTAQ.png"/></div></div></figure><p id="7d24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">PostgreSQL数组能做得更多吗？当然，去PostgreSQL文档中寻找更多的可能性。</p><p id="d116" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您已经拥有了在SQL表中使用列表和嵌套结构的所有工具。虽然这些强大的工具允许您打破一行一个记录的模式，但是您应该只在它们提供真正的价值并且不能被更传统的方法替代时才使用它们。现有的SQL最佳实践有很好的理由，所以您绕过它们的理由应该更充分。</p><p id="d216" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望你学到了东西，感谢阅读。</p><div class="ne nf gp gr ng nh"><a href="https://ms101196.medium.com/membership" rel="noopener follow" target="_blank"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd iu gy z fp nm fr fs nn fu fw is bi translated">通过我的推荐链接加入Medium-Merlin sch fer</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">阅读梅林·谢弗(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">ms101196.medium.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv ks nh"/></div></div></a></div></div></div>    
</body>
</html>