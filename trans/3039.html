<html>
<head>
<title>Creating a Python PostgreSQL connection for absolute beginners</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为绝对初学者创建Python PostgreSQL连接</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-a-python-postgresql-connection-for-absolute-beginners-501b97f73de1#2022-07-04">https://towardsdatascience.com/creating-a-python-postgresql-connection-for-absolute-beginners-501b97f73de1#2022-07-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7ea1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Python脚本如何与Postgres数据库通信</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bd93966de3d685b595579b27934f031c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VIwtKT8BIeN4c2Yx"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Postgres来了(图片由<a class="ae ky" href="https://unsplash.com/@apriiil" rel="noopener ugc nofollow" target="_blank">四月宠物杂交</a>在<a class="ae ky" href="https://unsplash.com/photos/jmAGGE6MDeA" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄)</p></figure><p id="1c3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让Python连接到您的数据库并交换信息是一项非常基本的技能，但是创建实际的连接一开始可能会有点奇怪。在这篇文章中，我们将了解如何以一种高效安全的方式创建和使用连接。我们将使用一个名为<code class="fe lv lw lx ly b">psycopg2</code>的包，并通过一些实例演示如何与数据库交互。我们来编码吧！</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="7c68" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">在开始之前..</h1><p id="ee7b" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">想要连接到非PostgreSQL的数据库？查看下面的文章。</p><div class="nd ne gp gr nf ng"><a href="https://mikehuls.medium.com/how-to-make-a-database-connection-in-python-for-absolute-beginners-e2bfd8e4e52" rel="noopener follow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd iu gy z fp nl fr fs nm fu fw is bi translated">绝对初学者如何用Python做数据库连接</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">连接MS SQL Server、MySQL、Oracle和其他数据库的3个步骤(+示例)</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">mikehuls.medium.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu ks ng"/></div></div></a></div></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="69ca" class="nv mh it bd mi nw nx dn mm ny nz dp mq li oa ob ms lm oc od mu lq oe of mw og bi translated">生成SQL查询</h2><p id="abfe" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">本文重点介绍如何使用pyodbc创建与数据库的连接。然后可以使用这个连接来执行SQL。有些数据库使用不同的语法:</p><ul class=""><li id="7a8b" class="oh oi it lb b lc ld lf lg li oj lm ok lq ol lu om on oo op bi translated"><strong class="lb iu"> MS SQL Server </strong> <br/> <code class="fe lv lw lx ly b">SELECT TOP 1 colname FROM tablename LIMIT 10</code></li><li id="5801" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu om on oo op bi translated"><strong class="lb iu">PostgreSQL</strong>T2<br/>。</li></ul><p id="268c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着您必须为特定的数据库编写SQL语句。</p><p id="18e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有一种<strong class="lb iu">与数据库无关的</strong>方法，可以用更Pythonic化的方式定义查询，然后针对某个数据库进行编译。这将<strong class="lb iu">为那个数据库</strong>生成特定的SQL，这样您就不会受限于您当前使用的数据库的特定内容。这意味着，如果你将来决定从MySQL转换到Postgres，你不必修改你的代码。</p><p id="2598" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我正在写这篇文章，所以请务必<a class="ae ky" href="https://mikehuls.medium.com/membership" rel="noopener">关注我</a>！</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="bc3a" class="nv mh it bd mi nw nx dn mm ny nz dp mq li oa ob ms lm oc od mu lq oe of mw og bi translated">关于心理战2</h2><p id="9556" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">Psycopg2是一个为Python编写的PostgreSQL数据库适配器。它是为高度多线程的应用程序而设计的，是用C语言编写的，侧重于有效和安全的通信。</p><p id="ec2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你像我一样，认为<em class="ov">“心理战2..</em>这个名字很怪；这是因为作者犯了一个小错误(<a class="ae ky" href="https://www.postgresql.org/message-id/flat/CA%2BRjkXFL6Jy7actUy%2BS%3DdGfjpuD_jpUYYofGpON%2B1Nq9S2Y75w%40mail.gmail.com#f9771ec89bf350e0594cf9640a1f912c" rel="noopener ugc nofollow" target="_blank">来源</a>):</p><blockquote class="ow"><p id="85ea" class="ox oy it bd oz pa pb pc pd pe pf lu dk translated">我想称之为psychopg(指他们的精神病司机)，但我打错了名字。</p></blockquote><p id="9512" class="pw-post-body-paragraph kz la it lb b lc pg ju le lf ph jx lh li pi lk ll lm pj lo lp lq pk ls lt lu im bi translated">尽管这个有趣的背景故事，psycopg2是一个非常优化，安全和有效的软件包。在接下来的几个部分中，我们将使用它来建立到Postgres数据库的连接并执行一些SQL。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/92c95589dd998d1aac9a8edf9c484a15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BUcOOb5mdjKEs7cR"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">让我们进入我们的数据库(图片由<a class="ae ky" href="https://unsplash.com/@cbpsc1" rel="noopener ugc nofollow" target="_blank">克林特·帕特森</a>在<a class="ae ky" href="https://unsplash.com/photos/exfrR9KkzlE" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上提供)</p></figure><h1 id="d166" class="mg mh it bd mi mj pl ml mm mn pm mp mq jz pn ka ms kc po kd mu kf pp kg mw mx bi translated">创建数据库连接</h1><p id="e18e" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">下面我们将介绍如何建立和使用连接。首先，我们将通过安装依赖项来做准备:</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="762a" class="nv mh it bd mi nw nx dn mm ny nz dp mq li oa ob ms lm oc od mu lq oe of mw og bi translated">准备:依赖性</h2><p id="d82d" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">首先，让我们创建一个虚拟环境，并安装我们唯一的依赖项。看看下面的文章，了解为什么使用venv非常重要，以及如何创建它们。</p><pre class="kj kk kl km gt pq ly pr ps aw pt bi"><span id="db26" class="nv mh it ly b gy pu pv l pw px">pip install pscopg2</span></pre><div class="nd ne gp gr nf ng"><a rel="noopener follow" target="_blank" href="/virtual-environments-for-absolute-beginners-what-is-it-and-how-to-create-one-examples-a48da8982d4b"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd iu gy z fp nl fr fs nm fu fw is bi translated">绝对初学者的虚拟环境——什么是虚拟环境，如何创建虚拟环境(+例子)</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">深入探究Python虚拟环境、pip和避免纠缠依赖</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">towardsdatascience.com</p></div></div><div class="np l"><div class="py l nr ns nt np nu ks ng"/></div></div></a></div></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="0bd4" class="nv mh it bd mi nw nx dn mm ny nz dp mq li oa ob ms lm oc od mu lq oe of mw og bi translated">第一步。创建连接</h2><p id="6d8b" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">第一个目标是创建一个连接(通常每个应用程序有一个连接)。</p><p id="8c55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们将通过从环境中加载凭据来获取凭据，这样我们的应用程序就可以访问凭据，而无需将它们硬编码到脚本中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pz qa l"/></div></figure><p id="e967" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过学习如何应用下面文章中的<code class="fe lv lw lx ly b">env files</code>来防止您的密码泄露:</p><div class="nd ne gp gr nf ng"><a rel="noopener follow" target="_blank" href="/keep-your-code-secure-by-using-environment-variables-and-env-files-4688a70ea286"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd iu gy z fp nl fr fs nm fu fw is bi translated">通过使用环境变量和env文件来保证代码的安全</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">安全地加载一个文件，其中包含我们的应用程序所需的所有机密数据，如密码、令牌等</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">towardsdatascience.com</p></div></div><div class="np l"><div class="qb l nr ns nt np nu ks ng"/></div></div></a></div></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="f245" class="nv mh it bd mi nw nx dn mm ny nz dp mq li oa ob ms lm oc od mu lq oe of mw og bi translated">第二步。创建游标并执行</h2><p id="a84f" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">现在我们有了连接，我们可以创建一个光标。这是一个用于迭代结果集(由查询产生)的对象。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pz qa l"/></div></figure><p id="4c1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码在上下文管理器(<code class="fe lv lw lx ly b">with</code>)语句中创建了一个游标，它有两个主要优点:</p><ol class=""><li id="d62a" class="oh oi it lb b lc ld lf lg li oj lm ok lq ol lu qc on oo op bi translated">上下文管理器中的所有查询都作为一个事务来处理。任何失败的<code class="fe lv lw lx ly b">cursor.execute</code>都将导致先前的回滚</li><li id="75a1" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu qc on oo op bi translated">当我们退出程序块时，光标将自动关闭</li></ol><div class="nd ne gp gr nf ng"><a href="https://medium.com/geekculture/understanding-python-context-managers-for-absolute-beginners-4873b6249f16" rel="noopener follow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd iu gy z fp nl fr fs nm fu fw is bi translated">绝对初学者理解Python上下文管理器</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">理解关于光剑的WITH语句</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">medium.com</p></div></div><div class="np l"><div class="qd l nr ns nt np nu ks ng"/></div></div></a></div></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="99e7" class="nv mh it bd mi nw nx dn mm ny nz dp mq li oa ob ms lm oc od mu lq oe of mw og bi translated">第三步。示例查询</h2><p id="19bc" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">并不是说我们的数据库连接已经建立，我们可以开始查询我们的数据库。在下面的文章中，我们配置了一个到MS SQL Server(以及其他数据库)的连接。本文还包含一些非常有用的示例查询，您也可以将其应用于我们的psycopg2连接。请务必查看它们，以便开始跑步。</p><div class="nd ne gp gr nf ng"><a href="https://mikehuls.medium.com/how-to-make-a-database-connection-in-python-for-absolute-beginners-e2bfd8e4e52" rel="noopener follow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd iu gy z fp nl fr fs nm fu fw is bi translated">绝对初学者如何用Python做数据库连接</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">连接MS SQL Server、MySQL、Oracle和其他数据库的3个步骤(+示例)</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">mikehuls.medium.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu ks ng"/></div></div></a></div></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="4d4b" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">重要的</h1><p id="68c3" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">为了防止SQL注入攻击，一定要清理放入SQL语句中的变量，尤其是在允许用户输入语句的情况下。这一点被<a class="ae ky" href="https://www.explainxkcd.com/wiki/images/5/5f/exploits_of_a_mom.png" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">这部XKCD著名漫画</strong> </a> <strong class="lb iu">诠释得很漂亮。</strong></p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="c29b" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">后续步骤</h1><p id="a42c" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">现在您的脚本可以连接到数据库，您可以开始编写SQL，如下文所示。查看<a class="ae ky" href="https://mikehuls.com/articles?tags=sql" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">此链接</strong> </a>了解许多便捷查询的概述。另请查看本文 中的<a class="ae ky" href="https://mikehuls.medium.com/python-database-migrations-for-beginners-getting-started-with-alembic-84e4a73a2cca" rel="noopener"> <strong class="lb iu">部分，该部分详细介绍了如何实现<strong class="lb iu">数据库迁移</strong>；这样你就可以使用Python来控制数据库结构的版本！非常有用！</strong></a></p><div class="nd ne gp gr nf ng"><a rel="noopener follow" target="_blank" href="/postgresql-how-to-upsert-safely-easily-and-fast-246040514933"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd iu gy z fp nl fr fs nm fu fw is bi translated">PostgreSQL —如何安全、轻松、快速地进行升级</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">防止重复，插入新记录，更新现有记录</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">towardsdatascience.com</p></div></div><div class="np l"><div class="qe l nr ns nt np nu ks ng"/></div></div></a></div></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="1c7e" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="9c1d" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">我希望已经阐明了如何用psycopg2连接到Postgres数据库，并使用该连接来处理数据库。我希望一切都像我希望的那样清楚，但如果不是这样，请让我知道我能做些什么来进一步澄清。与此同时，请查看我的关于各种编程相关主题的其他文章:</p><ul class=""><li id="04be" class="oh oi it lb b lc ld lf lg li oj lm ok lq ol lu om on oo op bi translated"><a class="ae ky" href="https://mikehuls.medium.com/sql-insert-delete-and-update-in-one-statement-sync-your-tables-with-merge-14814215d32c" rel="noopener">在一条语句中插入、删除和更新—使用MERGE同步您的表</a></li><li id="6bdb" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu om on oo op bi translated"><a class="ae ky" href="https://mikehuls.medium.com/why-is-python-so-slow-and-how-to-speed-it-up-485b5a84154e" rel="noopener">Python为什么这么慢，如何加速</a></li><li id="912b" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu om on oo op bi translated"><a class="ae ky" href="https://mikehuls.medium.com/git-for-absolute-beginners-understanding-git-with-the-help-of-a-video-game-88826054459a" rel="noopener"> Git绝对初学者:借助视频游戏理解Git</a></li><li id="9acd" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu om on oo op bi translated"><a class="ae ky" href="https://mikehuls.medium.com/docker-for-absolute-beginners-what-is-docker-and-how-to-use-it-examples-3d3b11efd830" rel="noopener"> Docker对于绝对初学者——Docker是什么以及如何使用它(+例子)</a></li><li id="422a" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu om on oo op bi translated">面向绝对初学者的虚拟环境——什么是虚拟环境，如何创建虚拟环境(+示例</li><li id="9bb2" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu om on oo op bi translated"><a class="ae ky" href="https://mikehuls.medium.com/create-and-publish-your-own-python-package-ea45bee41cdc" rel="noopener">创建并发布自己的Python包</a></li><li id="8a48" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu om on oo op bi translated"><a class="ae ky" href="https://mikehuls.medium.com/create-a-fast-auto-documented-maintainable-and-easy-to-use-python-api-in-5-lines-of-code-with-4e574c00f70e" rel="noopener">用FastAPI用5行代码创建一个快速自动记录、可维护且易于使用的Python API</a></li></ul><p id="8318" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！</p><p id="e1eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">—迈克</p><p id="8c62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ov">又及:喜欢我正在做的事吗？</em> <a class="ae ky" href="https://mikehuls.medium.com/membership" rel="noopener"> <em class="ov">跟我来！</em>T9】</a></p><div class="nd ne gp gr nf ng"><a href="https://mikehuls.medium.com/membership" rel="noopener follow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd iu gy z fp nl fr fs nm fu fw is bi translated">通过我的推荐链接加入Medium—Mike Huls</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">mikehuls.medium.com</p></div></div><div class="np l"><div class="qf l nr ns nt np nu ks ng"/></div></div></a></div></div></div>    
</body>
</html>