<html>
<head>
<title>A Hidden Little Gem that Can Save Your (Power BI) Life</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个隐藏的小宝石，可以拯救你的生命</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-hidden-little-gem-that-can-save-your-power-bi-life-f73f9e8c75af#2022-08-04">https://towardsdatascience.com/a-hidden-little-gem-that-can-save-your-power-bi-life-f73f9e8c75af#2022-08-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="395b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">改变隐藏在表格模型中的属性的默认值可以让你成为一个真正的BI英雄</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/30853ca95d714322b1097e18683b0a2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jZFUfSGeH0Wovk9wnTcwMg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.pexels.com/de-de/foto/braune-katze-208849/" rel="noopener ugc nofollow" target="_blank">pix abay在Pexels上拍摄的照片</a></p></figure><p id="313d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有时候，事情的发生是有原因的。</p><p id="0b72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">几周前，我参加了本尼·德·贾格尔在Data Grillen举办的关于Power BI性能调整的会议。这是一次很棒的会议，本尼分享的技巧之一与表格模型中的<em class="lv"> IsAvailableInMDX </em>属性有关。我记得有时在某个地方听说过它，但老实说很少有机会在现实世界中应用它。但是，正如我一开始所说的，事情的发生是有原因的…</p><p id="921e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上周，我在为一个客户优化Power BI解决方案。我确保将所有的王牌都拿出来，以使数据模型更加高效— <a class="ae ky" href="https://medium.com/p/76d7c4377f2d" rel="noopener">删除了不必要的数据</a>，<a class="ae ky" href="https://medium.com/p/3add4137753e" rel="noopener">尽可能地减少基数</a>，调整列数据类型，并应用了一些<a class="ae ky" href="https://data-mozart.com/power-bi-performance-tuning-cheatsheet/" rel="noopener ugc nofollow" target="_blank">额外的推荐实践</a>…然后，我想起了本尼的提示，决定试一试，看看如果禁用<em class="lv"> IsAvailableInMDX </em>属性会发生什么…</p><h1 id="ab93" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">但是，让我们从解释什么是IsAvailableInMDX属性开始…</h1><p id="c12d" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">如果你去微软文档，你可能会失望，因为这里有一个模糊的财产定义。然而，<a class="ae ky" href="https://blog.crossjoin.co.uk/2018/07/02/isavailableinmdx-ssas-tabular/" rel="noopener ugc nofollow" target="_blank"> Chris Webb不久前写了一篇很棒的博文</a>(许多博文中的一篇)，解释了这种房产及其运作方式。如果您出于某种原因不想阅读Chris的原始帖子(尽管我鼓励您阅读它)，简单地说，IsAvailableInMDX属性值(TRUE或FALSE) <strong class="lb iu">决定了是否构建列上的属性层次结构</strong>。</p><p id="91cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，公平的问题应该是:</p><h1 id="844b" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">什么是属性层次结构？</h1><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="90c7" class="my lx it mu b gy mz na l nb nc">[Date].[Fiscal Year].&amp;[2022]<br/>,[Product].[Category].[Bikes]<br/>,[Sales Territory].[Sales Territory Group].&amp;[Europe]<br/>,[Measures].[Internet Sales Amount]</span></pre><p id="2a86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有认识老好人MDX的人请举手！用于查询SSAS多维模型的语言…正如您可能(也可能没有)看到的，每一列都属于特定的层次结构:财政年度属于日期层次结构，自行车是类别层次结构的一部分，其中父级别是产品…此外，度量也是层次结构的一部分！理解这一点很重要，你很快就会发现。这些都是用户定义的层次结构。</p><p id="4fd3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，SSAS多维还创建了<strong class="lb iu">属性层次</strong>，其中每个常规属性都成为2级层次的一部分，以“全部”作为顶级:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/fb21b13a78e1fd8aaaf97ce9a1a75c9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gqhej_bipRN1_iVLoRJAKw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者插图</p></figure><p id="9080" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">属性层次结构的主要特征是，作为层次结构一部分的列既可以用作MDX查询中的行，也可以用作列。好了，现在你(希望)知道什么是属性层次结构，但是…嘿，Nikola，我们在这里谈论的是Power BI，表格模型…SSAS多维是一项传统技术，对吗？我们可以争论这个问题，但这显然超出了本文的范围:)</p><p id="be03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，这仍然是一个有效的问题:</p><h1 id="c532" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">MDX和Power BI到底有什么共同点？！</h1><p id="c304" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">测验问题:Excel在连接到Analysis Services <strong class="lb iu"> <em class="lv">表格</em> </strong>模型时使用哪种语言(在表格上用粗体和斜体表示)？我来帮你一点:这不是达克斯…</p><p id="836a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，Excel在连接到表格模型时会生成MDX查询！这给我们带来了一个关键的收获:由于Excel依赖于MDX，它也依赖于多维模型中的数据结构。这意味着除非将IsAvailableInMDX属性显式设置为FALSE，否则属性层次结构将成为数据模型的一部分。</p><p id="fc2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，下一个问题是:为什么这个属性没有默认设置为FALSE？在许多实际情况下，Excel是许多数据分析师的首选工具。他们应该能够连接到Power BI后面的Analysis Services表格式模型(不要忘记，<a class="ae ky" href="https://data-mozart.com/mastering-dp-500-power-bi-xmla-endpoints-demystified/" rel="noopener ugc nofollow" target="_blank"> Power BI将数据存储在Analysis Services表格式</a>的实例中)，因此如果该属性在默认情况下被禁用，他们应该不能执行他们的分析。</p><p id="63d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更有意思的是，大部分Power BI开发者根本没有意识到这个属性！他们为什么要这么做？它不能从Power BI桌面访问，在Power BI桌面上根本看不到属性层次结构，而在Power BI本身中，您不会注意到视觉效果中显示的数字有任何差异。那么，既然Power BI中的一切都完美地工作，而您的Excel分析师也乐于使用Power BI数据集的数据创建他们的数据透视表，为什么还要为此烦恼呢？</p><p id="74e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们来了解一下这个问题……这个问题帮助我对客户的Power BI解决方案做出了惊人的改进。</p><p id="3f28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在显示存储在表格模型中的数据时，我不会浪费时间来演示Excel和Power BI之间的区别(同样，去阅读Chris Webb的博客文章，在那里一切都有解释)，而是专注于启用或禁用该属性时数据模型性能的差异。</p><h1 id="2c39" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">数据模型起点</h1><p id="0740" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在本文中，出于演示的目的，我将使用一个Contoso示例数据库，该版本在事实表中包含1亿条记录(承蒙SQLBI.com的帮助，您可以在这里下载和定制不同版本的Contoso数据库<a class="ae ky" href="https://github.com/sql-bi/Contoso-Data-Generator/releases/tag/v1.0.0" rel="noopener ugc nofollow" target="_blank">。它在麻省理工学院许可下可用)。</a></p><p id="8ee6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，让我们将数据导入Power BI，并检查数据模型背后的数字。像往常一样，我将在DAX Studio中使用VertiPaq分析器工具:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/c5dd6af379794067e17a97833052cb92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dBXzM4Cka1X5XspOdQPVWg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4a88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，我的数据集的总大小几乎是6.3 GBs！现在，如果您决定使用IsAvailableInMDX属性，有两种可能的选择:</p><ul class=""><li id="b34e" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">将数据模型中所有列的<strong class="lb iu">的属性值设置为FALSE这意味着根本没有Excel分析。因此，这里的主要问题是:您想完全限制从Excel连接到数据模型吗？</strong></li><li id="d058" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">将数据模型中某些列的属性值设置为FALSE即非属性列，如事实(度量)和键。这仍将启用Excel连接，但禁用的列将不能作为层次结构的一部分</li></ul><p id="0fb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将向您展示这两个选项对数据模型大小和处理时间的影响。</p><h1 id="e323" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">将所有列的IsAvailableInMDX设置为FALSE</h1><p id="4b20" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">让我们从整体方法开始，禁用数据模型中所有列的属性层次结构。因此，我们将测量两个指标:数据模型大小和完整的数据处理持续时间。我们最初的基准是<strong class="lb iu"> 6.27 GBs </strong>和<strong class="lb iu"> 143秒</strong>。显然，数据处理的持续时间取决于多个不同的方面，但是我将尝试在我的(相当强大的)本地机器上隔离这一点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/c27ff14a4e0bda1203240f7382651067.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*87Ywx3nN0J6MYXRkN1Hk3g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a965" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，您可以手动更改每一列的属性值，但是这将花费很长时间，尤其是在大型模型中。因此，下面是一个简单的脚本，您可以从表格编辑器的高级编辑器窗口中执行该脚本，它会将数据模型中所有列的IsAvailableInMDX属性设置为FALSE:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="967d" class="my lx it mu b gy mz na l nb nc">foreach(var column in Model.AllColumns)<br/>    column.IsAvailableInMDX = false;</span></pre><p id="d32e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我将更改保存回我的模型，让我们刷新数据集并检查是否有更改:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/e92792b0489933d87a572c0c675c60e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mzjEbb2mk_a_dwMn7E1-eA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b88a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哦，哇哦！仅仅通过改变一个“隐藏”财产的价值就可以节省15%。在数据处理方面，时间缩短到了118秒，比以前快了25秒。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/9c1b83196e20a6031116dbf6224196ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pkAmG4RxkFZcr0icjfeaSw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="d727" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">备注:</strong>在实际案例中，事实表有大约5亿行，以及更多的维度(其中一些包含200万到300万条记录)，因此性能提升更加显著。</p><p id="3967" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这很好，但是客户的要求是让Excel用户满意，并使他们能够继续使用他们最喜欢的工具。</p><p id="a58d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，让我们将IsAvailableInMDX属性设置为FALSE，仅用于事实(用于创建度量的列)和键列(根据推荐的实践，无论如何都应该对最终用户隐藏)。</p><h1 id="ea53" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">处理“某些”列的IsAvailableInMDX属性的两种方法</h1><p id="5c39" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">现在，是讨论另一点的时候了，当您只想禁用MDX查询的某些列时，这一点很有用。有两种可能的方法来处理<em class="lv"> IsAvailableInMDX </em>属性，我将向您展示这两种方法。让我们从一个简单的开始，但是需要大量手工操作的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/9ae752b2506fd4ee5ac4766a05c56e21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZVXrcTApVN7iO2IbHZ9LMw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3a38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一个更方便的，我敢说也是推荐的方法来实现完全相同的结果，就是利用表格编辑器中的最佳实践分析器扩展来为您完成繁琐的工作！<a class="ae ky" href="https://docs.tabulareditor.com/te2/Best-Practice-Analyzer.html" rel="noopener ugc nofollow" target="_blank"> Best Practice Analyzer </a>是Michael Kowalsky创造的神奇工具，它可以极大地帮助你优化你的数据模型。简而言之，它扫描整个数据模型，并根据结果列出所有未遵循的规则。然后，您可以决定是自己应用推荐的实践，还是让Best Practice Analyzer为您做这件事。</p><p id="6995" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，在这个特定的场景中有一个小问题:BPA有一个规则，只为隐藏列或表被隐藏的列将IsAvailableInMDX属性设置为FALSE，如Michael Kovalsky的文章中所解释的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/3fb2b62ffdb6139f14d706e0727d0fec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c773BBSuOTzkGM9b6z6qiw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="ea84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简而言之，如果您没有按照建议的做法首先隐藏非属性列(事实表列和键)，那么将IsAvailableInMDX属性设置为FALSE的规则将不起作用。这就是迈克尔在他的文章中所说的“规则协同”…</p><p id="c8c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论如何，让我们对MDX查询禁用非属性列的基准进行最后一次检查:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/8aeb26cd92c12cec9f65d6a52454334a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8CL5hzcojCwRIm2EPZ173Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="d353" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这一更改增加了100 MBs的整体数据模型大小，但我们仍然比起点低750 MBs！而且，不要忘记，在这种情况下，这是一个双赢的局面——我们减少了数据模型的大小，同时让我们的Excel用户满意。处理时间略微增加到124秒，因此下面是第二个用例之后的概述:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/dd8c44720836e10ed645a44cf56d98ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tj9VNnizZ3GM7psR-4c4xg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="2ea1" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">结论</h1><p id="cd48" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Power BI(和表格模型)充满了隐藏的宝石。有时候，这些宝石真的很难找到(或者很难理解它们可能的影响)，但是一旦你设法做到了，你就可以对你的Power BI解决方案做出重大改进。</p><p id="b15d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您所看到的，通过简单地更改深深隐藏在表格模型中的属性的默认值，我能够提高Power BI解决方案的效率，而不牺牲整体用户体验和核心功能(即，使用Excel查询Power BI数据集)。</p><p id="306b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢本尼的提示，感谢克里斯精彩的博文。</p><p id="db2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p><p id="06a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">成为会员，阅读Medium上的每一个故事！</p></div></div>    
</body>
</html>