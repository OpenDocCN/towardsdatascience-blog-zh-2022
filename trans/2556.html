<html>
<head>
<title>Uber SQL Interview Questions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">优步SQL面试问题</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/uber-sql-interview-questions-cf6a2a08a23c#2022-06-03">https://towardsdatascience.com/uber-sql-interview-questions-cf6a2a08a23c#2022-06-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e10e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><em class="kf">分解一个有趣的优步SQL面试问题的答案</em></h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/e0d10a23ed0930dc9bf5622407f27626.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mtDbrzr1GapNnsD5O9oreQ.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">作者在<a class="ae kw" href="https://canva.com/" rel="noopener ugc nofollow" target="_blank"> Canva </a>上创建的图片</p></figure><p id="11b9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">优步公司改变了市中心的交通，让数百万用户的生活变得更加轻松。他们的主要产品是一款智能手机应用，可以让用户以合理的价格找到便车。优步还参与了许多其他业务，如食品配送、货运等。</p><p id="4319" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">所有这些运营都有一个共同点:依靠稳定高效的物流来顺利完成行程。为了达到这个目标，优步每天收集大量的数据。该公司拥有一支才华横溢的数据科学家团队，以从可用信息中获得可操作的见解。</p><p id="a994" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在本文中，我们将探讨在优步面试中被问到的一个SQL面试问题。</p><h1 id="679f" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">在优步SQL访谈中测试基本到中级概念</h1><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/39a0e778fad0e7b91076eed4f36bf9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sGiJsZYAd6mLJfF5"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">作者在<a class="ae kw" href="https://canva.com/" rel="noopener ugc nofollow" target="_blank"> Canva </a>上创建的图像</p></figure><h2 id="675f" class="ml lu iq bd lv mm mn dn lz mo mp dp md lg mq mr mf lk ms mt mh lo mu mv mj mw bi translated">聚合函数</h2><p id="2c1c" class="pw-post-body-paragraph kx ky iq kz b la mx jr lc ld my ju lf lg mz li lj lk na lm ln lo nb lq lr ls ij bi translated">在参加面试之前，请阅读这篇《<a class="ae kw" href="https://www.stratascratch.com/blog/the-ultimate-guide-to-sql-aggregate-functions/?utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"><em class="nc">SQL聚合函数终极指南</em> </a>》来刷新你的聚合函数知识。你需要知道聚合函数来解决面试中的大多数SQL问题，更重要的是，在你的日常工作中编写SQL查询。</p><p id="90d7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">您需要掌握聚合函数的基本知识，例如语法、参数以及如何使用GROUP BY语句汇总结果。</p><p id="cbb0" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果你真的想在竞争中脱颖而出，再深挖一点是个好主意。例如，学习如何将聚合函数与其他SQL特性结合使用，比如DISTINCT语句。</p><p id="0b09" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">SUM()是最常用的聚合函数之一。需要解决某一列的数值相加的问题。在下面的问题中，我们将使用它来计算总里程。</p><p id="1557" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">要知道SUM()只能用来计算数字的总数，不能和文本、日期或者其他类型的数值一起使用。了解一些小细节，比如这个函数如何处理空值，会有很大帮助。</p><h2 id="a0c2" class="ml lu iq bd lv mm mn dn lz mo mp dp md lg mq mr mf lk ms mt mh lo mu mv mj mw bi translated">在哪里</h2><p id="c6e2" class="pw-post-body-paragraph kx ky iq kz b la mx jr lc ld my ju lf lg mz li lj lk na lm ln lo nb lq lr ls ij bi translated">WHERE语句是SQL的基本特性之一。尽管它很简单，但它对于在SQL中过滤数据是必不可少的。您应该知道如何在SELECT/FROM语句中使用它来过滤掉不符合条件的行。</p><p id="8308" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">要过滤SQL中的表，您应该知道如何为WHERE语句设置条件。对于条件可以是什么没有限制。您可能需要检查一列中的数值是否比另一列高。您应该准备好如何使用比较运算符来比较其他值，如字符串、日期和浮点数。</p><p id="a515" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">书写条件有语法规则。例如，在比较数字、字符串、日期和其他类型的值时，是否有必要使用引号。</p><p id="9959" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">了解比较运算符如何处理非数字数据很重要。例如，如果您正在处理销售数据，您可能希望将输出限制在一个特定的月份。您可以使用比较运算符来获取某个特定月份的记录，或者确定两个日期中哪个日期先出现。</p><h2 id="3f7f" class="ml lu iq bd lv mm mn dn lz mo mp dp md lg mq mr mf lk ms mt mh lo mu mv mj mw bi translated">以...排序</h2><p id="e84d" class="pw-post-body-paragraph kx ky iq kz b la mx jr lc ld my ju lf lg mz li lj lk na lm ln lo nb lq lr ls ij bi translated">面试官经常要求你返回一列中X个最高值。为此，您需要从最高到最低排列数据，并按顺序输出指定数量的值。</p><p id="42c7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们使用ORDER BY语句对SQL中的行进行排序。它允许您指定一列，SQL将根据该列中的值对记录进行排序。为了解决一些更困难的问题，您可能需要指定多个列。了解如何在表中通过名称或索引来指定列是很有用的。</p><p id="44f5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">一个好的候选人应该知道如何指定值排序的升序和降序，以及如何对日期和字符串值进行排序。</p><p id="1948" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">此外，对细节的了解，比如没有指定顺序时会发生什么，会有很大帮助。</p><h2 id="69ea" class="ml lu iq bd lv mm mn dn lz mo mp dp md lg mq mr mf lk ms mt mh lo mu mv mj mw bi translated">排名窗口函数</h2><p id="6553" class="pw-post-body-paragraph kx ky iq kz b la mx jr lc ld my ju lf lg mz li lj lk na lm ln lo nb lq lr ls ij bi translated">如前所述，为了解决一些问题，候选人必须在一列中输出特定数量的最高值。有多种方法可以解决这些问题。</p><p id="8e70" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在某些情况下，比如下面的问题，可以说一个简单的极限语句足以输出特定数量的值。</p><p id="9e93" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">另一方面，排序窗口函数总是输出一定数量的最高值的最准确和最简单的方法。</p><p id="416d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">研究<a class="ae kw" href="https://www.stratascratch.com/blog/the-ultimate-guide-to-sql-window-functions/?utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> SQL窗口函数</a>和<a class="ae kw" href="https://www.stratascratch.com/blog/an-introduction-to-the-sql-rank-functions/?utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> SQL等级函数</a>，为任何需要你输出X个最高值的SQL问题做准备。</p><p id="f8b6" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">RANK()和DENSE_RANK()之类的函数允许您根据某一列中的值为行分配等级。理解这两种功能之间的区别很重要。</p><h1 id="3143" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">优步SQL面试问题演练</h1><p id="11ea" class="pw-post-body-paragraph kx ky iq kz b la mx jr lc ld my ju lf lg mz li lj lk na lm ln lo nb lq lr ls ij bi translated"><strong class="kz ir">最高总里程数</strong></p><p id="0fe9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在这个问题中，我们有一个数据表，描述了通过优步应用程序预订的每一次旅行。候选人被要求找出促使企业客户使用优步进行旅行的三个最常见的目的。</p><p id="26ff" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在StrataScratch平台上被标注为‘中等’难度，所以只要注意，应该能找到解决方法。有多种方法可以解决这个优步SQL面试问题。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nd"><img src="../Images/bcce856abe83be3230ddfd8c94754a0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ChwBQvbShUfoHhKc"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/10169-highest-total-miles?code_type=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><p id="c002" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">问题的表述可能有点令人困惑，因此您可能需要查看可用的数据来理解问题。</p><p id="80d2" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">问题链接:<a class="ae kw" href="https://platform.stratascratch.com/coding/10169-highest-total-miles?code_type=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank">https://platform . stratascratch . com/coding/10169-最高总里程</a></p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h1 id="5305" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">可用数据集</h1><p id="ab1d" class="pw-post-body-paragraph kx ky iq kz b la mx jr lc ld my ju lf lg mz li lj lk na lm ln lo nb lq lr ls ij bi translated">我的优步司机</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/13fcfdbdeee5e645c9f6f1d90cfd5c98.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*9DVBsokPpgh2dLrJGlvB1A.png"/></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/10169-highest-total-miles?code_type=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><h1 id="ec4c" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">数据假设</h1><p id="4808" class="pw-post-body-paragraph kx ky iq kz b la mx jr lc ld my ju lf lg mz li lj lk na lm ln lo nb lq lr ls ij bi translated">这是一个令人费解的问题，所以你应该多次阅读它，以了解你必须做什么。</p><p id="a775" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">对于像这样的<a class="ae kw" href="https://www.stratascratch.com/blog/40-data-science-interview-questions-from-top-companies/?utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank">数据科学面试问题</a>，预览最终表格或要求面试官描述预期输出是有用的。你可以利用这个机会从最后的结果反推来理解这个问题。</p><p id="a795" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">当你阅读这个问题时，只要有可能，你也应该看看表格中的实际值。这可以帮助你更好地掌握可用的数据。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nh"><img src="../Images/63af250b709cd2caeea9727b44caa284.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dCx1zumE_280jrJ2"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/10169-highest-total-miles?code_type=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><p id="c610" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们看看下表中的列:</p><p id="0149" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"> start_date </strong> —该问题没有要求我们计算每次旅行的持续时间，因此我们不需要旅行开始的确切日期和时间。</p><p id="dfbe" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"> end_date — </strong>类似于<strong class="kz ir"> start_date </strong>列，我们也不需要该列中的值。</p><p id="8800" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">类别</strong> —我们将检查该列中的值，以仅保留业务费用的记录。</p><p id="946c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">开始</strong> —拾取点与此问题无关。</p><p id="2b6b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">停止</strong> —最终目的地与优步SQL面试问题无关。</p><p id="b299" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">里程</strong> —我们需要计算每个目的的总里程。所以我们要把这一列的值加起来。</p><p id="e589" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">目的</strong> —我们的最终输出将包括每个目的的总里程。所以我们肯定需要这个列中的值。</p><p id="4c63" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">查看表格时，请注意每列中值的类型，以了解它们所代表的含义。例如，知道'<strong class="kz ir"> miles </strong>'列包含浮点值可以帮助您决定如何按英里对目的进行排序。</p><p id="1468" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">考生要仔细检查<strong class="kz ir">目的</strong>栏以及里面的所有数值。如果您仔细观察，您会注意到一个重要的细节—一些驱动器记录在这个<strong class="kz ir"> </strong>列中包含一个空值。这是一个需要处理的边缘案例。</p><p id="c33e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">您应该看看每一列中的值的范围。<strong class="kz ir">“类别”</strong>列中的大部分值都是“业务”，这意味着硬盘属于业务费用。然而，如果你仔细看，你会注意到有一些个人费用混在里面。</p><p id="fb7e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">一旦你多次阅读这个问题，你就可以开始制定你的方法了。</p><h1 id="af72" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">解决方案逻辑</h1><p id="dcbb" class="pw-post-body-paragraph kx ky iq kz b la mx jr lc ld my ju lf lg mz li lj lk na lm ln lo nb lq lr ls ij bi translated">这个优步SQL面试问题可能很难理解，所以你应该多看几遍。一个条件是只计算业务费用的总里程。换句话说，“类别”列中的值必须是“业务”。</p><p id="a545" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">将解决方案分解成几个易于管理的步骤。写下你的方法可以帮助你坚持下去。这个问题的解决方案包括四个主要步骤:</p><ol class=""><li id="95d6" class="ni nj iq kz b la lb ld le lg nk lk nl lo nm ls nn no np nq bi translated">过滤记录</li><li id="f983" class="ni nj iq kz b la nr ld ns lg nt lk nu lo nv ls nn no np nq bi translated">计算总里程</li><li id="6966" class="ni nj iq kz b la nr ld ns lg nt lk nu lo nv ls nn no np nq bi translated">订购记录</li><li id="facd" class="ni nj iq kz b la nr ld ns lg nt lk nu lo nv ls nn no np nq bi translated">输出前3个业务目的</li></ol><p id="b5d5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">过滤掉不是业务费用的记录</strong></p><p id="5221" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">第一步，我们将使用一个简单的WHERE语句来过滤掉不是业务费用的记录。</p><p id="16d3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果您查看可用数据，您会注意到一些记录有一个空的“目的”列。换句话说，该列中的值为NULL。</p><p id="5e0b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们将不得不修改我们的WHERE语句，以过滤掉非业务费用以及“目的”栏为空的记录。为此，我们将使用AND逻辑运算符。该条件将只保留同时满足这两个条件的行:在<strong class="kz ir">‘类别’</strong>列中的值是‘业务’，在<strong class="kz ir">‘目的’</strong>列中有一些值。</p><p id="60de" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">第一个条件可以是一个简单的等式运算符，以确保“<strong class="kz ir">类别</strong>”列中的值等于“业务”。对于第二个条件，我们可以简单地写<strong class="kz ir">目的不为空</strong>，它将过滤掉所有的空值。</p><p id="978c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">计算每个目的的总里程数</strong></p><p id="2f69" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">一旦我们有了过滤后的表，我们就可以得到每个目的的总里程。为此，我们将使用SUM()聚合函数和GROUP BY语句来汇总结果。</p><p id="7387" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们将使用ORDER BY语句，根据各种用途的里程总和按降序排列行。</p><p id="a6ab" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">正如您在最后的表中看到的，我们将只有两列:<strong class="kz ir">目的</strong>列，它将包含代表每个组的唯一值，另一列将包含每个目的的聚合值。最后，我们将输出三个最高值。</p><p id="9570" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">根据总里程值降序排列记录</strong></p><p id="fb97" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们可以简单地编写ORDER BY 2来表示应该根据第二列中的值对行进行排序，第二列包含总里程数。</p><p id="54fe" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">输出总里程最高的三个目的</strong></p><p id="dcb8" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">最后一步是输出总里程数最高的三个目的。这一步可以用两种不同的方法来处理:一种是使用LIMIT语句。在这种情况下，解决方案非常简单，并且可能在99.99%的时间里都有效。</p><p id="fb21" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">另一种解决方案是使用窗口排序函数，这往往会产生更准确的结果。在下面几节中，我们将讨论解决这个问题的两种方法。</p><p id="2396" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">极限语句的明显优点是它简单易读。</p><p id="dfcb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">使用LIMIT的问题是数据是不可预测的。总里程数排名第三和第四的目的之间可能存在关联。在这种情况下，使用LIMIT语句会忽略这一事实，仍然输出表中的前三个值。</p><p id="4cee" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">分级窗口功能使您能够更好地控制这些边缘情况。它们允许您输出三个最高值，包括第一、第二或第三名的平手。如果出现平局的几率很高，排序窗口函数是更合适的选择。</p><p id="5c85" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果我们看一下<strong class="kz ir"> miles </strong>列，我们可以看到它包含浮点值。总里程将是该列中值的汇总。因此，我们不太可能打成平手。</p><p id="69ff" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在这种情况下，可以认为极限陈述的简单性超过了由于平局而得到不准确结果的风险。但是，如果您想确保结果的准确性，您应该使用RANK()或DENSE_RANK()函数。</p><p id="491f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">比起LIMIT的简单性和可读性，一些雇主可能更喜欢更健壮的方法，所以你能做的最好的事情就是去问。展示你可以从两个方面解决问题，展示你的分析思维和对SQL的全面了解。</p><p id="f4af" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这可以帮助您展示读取数据的能力，并注意细微差别和细节，比如浮点值不太可能被绑定。</p><p id="2361" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果面试官要求你使用窗口排名功能，做好使用的准备。最重要的是表明你了解这两种解决方案的利弊。</p><p id="9ba7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">最后，我们必须使用AS命令来命名存储每个目的的总英里数的列。应该是一些描述性的东西，比如<strong class="kz ir"> miles_sum </strong>。</p><h1 id="4423" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">解决方法</h1><h2 id="7936" class="ml lu iq bd lv mm mn dn lz mo mp dp md lg mq mr mf lk ms mt mh lo mu mv mj mw bi translated">第1步:过滤表，只保留业务费用</h2><p id="4a7d" class="pw-post-body-paragraph kx ky iq kz b la mx jr lc ld my ju lf lg mz li lj lk na lm ln lo nb lq lr ls ij bi translated">我们可以从获取所有业务支出记录开始。</p><pre class="kh ki kj kk gt nw nx ny nz aw oa bi"><span id="20b4" class="ml lu iq nx b gy ob oc l od oe">SELECT *<br/>FROM my_uber_drives<br/>WHERE category = 'Business'</span></pre><p id="ef17" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果我们运行这段代码，输出将包含业务费用。它看起来会像这样:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi of"><img src="../Images/237d13be1318d947202823c01e027478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vcLwgnjcE_yYkI7i"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/10169-highest-total-miles?code_type=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><h2 id="5ad7" class="ml lu iq bd lv mm mn dn lz mo mp dp md lg mq mr mf lk ms mt mh lo mu mv mj mw bi translated">第二步:获得每个目的的总里程数</h2><p id="f7a0" class="pw-post-body-paragraph kx ky iq kz b la mx jr lc ld my ju lf lg mz li lj lk na lm ln lo nb lq lr ls ij bi translated">我们可以将输出限制为两个必要的列，而不是获得一整行。一个是<strong class="kz ir">目的</strong>列，另一个将使用SUM()聚合函数生成。我们将使用AS命令为该列指定一个描述性名称。</p><p id="cb3d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们可以添加GROUP BY子句来汇总每个目的的总里程。</p><pre class="kh ki kj kk gt nw nx ny nz aw oa bi"><span id="598b" class="ml lu iq nx b gy ob oc l od oe">SELECT purpose,<br/>       SUM(miles) AS miles_sum<br/>FROM my_uber_drives<br/>WHERE category = 'Business'<br/>GROUP BY purpose</span></pre><p id="ac29" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果我们运行这个查询，我们将得到一个更接近最终结果的结果:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi og"><img src="../Images/96b2606e0833fbbbedef31f558934a0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9QzxJu4qJMJIWxNp"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/10169-highest-total-miles?code_type=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><h2 id="a50a" class="ml lu iq bd lv mm mn dn lz mo mp dp md lg mq mr mf lk ms mt mh lo mu mv mj mw bi translated">步骤3:处理无效目的</h2><p id="62f3" class="pw-post-body-paragraph kx ky iq kz b la mx jr lc ld my ju lf lg mz li lj lk na lm ln lo nb lq lr ls ij bi translated">前面的查询返回一个包含一个空列的表，该列表示具有NULL(空)目的的记录的总英里数。</p><p id="a8c9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">目前，我们使用一个条件过滤该表:检查<strong class="kz ir">类别</strong>列中的值，并且只保留业务费用。</p><p id="54ae" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们可以使用AND逻辑运算符向我们的过滤器添加另一个条件。现在，SQL还将检查并只保留属于业务费用的值，并且<strong class="kz ir">目的</strong>列中的值不为空。</p><pre class="kh ki kj kk gt nw nx ny nz aw oa bi"><span id="573e" class="ml lu iq nx b gy ob oc l od oe">SELECT purpose,<br/>       SUM(miles) AS miles_sum<br/>FROM my_uber_drives<br/>WHERE category = 'Business'<br/>  AND purpose IS NOT NULL<br/>GROUP BY purpose</span></pre><p id="92b2" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果我们运行代码，我们将看到输出不再包含空单元格。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi og"><img src="../Images/0611dd5399f7a79d335afd7569c283e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1NA2KDgYcTvEbTcj"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/10169-highest-total-miles?code_type=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><h2 id="b585" class="ml lu iq bd lv mm mn dn lz mo mp dp md lg mq mr mf lk ms mt mh lo mu mv mj mw bi translated">第四步:降序排列</h2><p id="4b30" class="pw-post-body-paragraph kx ky iq kz b la mx jr lc ld my ju lf lg mz li lj lk na lm ln lo nb lq lr ls ij bi translated">为了找到答案，我们需要根据购买的总里程来排序。它们应该按降序排列，最高的在顶部，最低的在底部。</p><p id="0fc5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们将使用ORDER BY语句来实现这一点。</p><pre class="kh ki kj kk gt nw nx ny nz aw oa bi"><span id="0bb0" class="ml lu iq nx b gy ob oc l od oe">SELECT purpose,<br/>       SUM(miles) AS miles_sum<br/>FROM my_uber_drives<br/>WHERE category = 'Business'<br/>  AND purpose IS NOT NULL<br/>GROUP BY purpose<br/>ORDER BY 2 DESC</span></pre><p id="bfd8" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">请注意，我们使用数字2来指定列。SQL将解释它，并根据第二列中的值对记录进行排序，第二列是<strong class="kz ir"> miles_sum </strong>。</p><p id="ca7a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果你运行这段代码，你会发现我们几乎得出了答案:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi oh"><img src="../Images/5a14a1d147314dcb6270b932872268b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*69c1kR73CMwcjhlz"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/10169-highest-total-miles?code_type=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><h2 id="f844" class="ml lu iq bd lv mm mn dn lz mo mp dp md lg mq mr mf lk ms mt mh lo mu mv mj mw bi translated">第五步:保留前三行</h2><p id="aa86" class="pw-post-body-paragraph kx ky iq kz b la mx jr lc ld my ju lf lg mz li lj lk na lm ln lo nb lq lr ls ij bi translated">最后一步，我们需要输出前三行。我们可以用一个简单的极限语句来做这件事。这是一个简单的解决方案，在这种情况下，几乎每次都会返回正确的答案。</p><pre class="kh ki kj kk gt nw nx ny nz aw oa bi"><span id="6a75" class="ml lu iq nx b gy ob oc l od oe">SELECT purpose,<br/>       SUM(miles) AS miles_sum<br/>FROM my_uber_drives<br/>WHERE category = 'Business'<br/>  AND purpose IS NOT NULL<br/>GROUP BY purpose<br/>ORDER BY 2 DESC<br/>LIMIT 3</span></pre><p id="b630" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">它将为我们提供最终的、正确的预期输出:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi oh"><img src="../Images/4b5f4893eb35e763d24924ec01d1a961.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*D_N2TkI8_CZCuBzc"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">截图来自<a class="ae kw" href="https://platform.stratascratch.com/coding/10169-highest-total-miles?code_type=1&amp;utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> StrataScratch </a></p></figure><h1 id="4ce1" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">另一个正确的解决方案</h1><p id="a67d" class="pw-post-body-paragraph kx ky iq kz b la mx jr lc ld my ju lf lg mz li lj lk na lm ln lo nb lq lr ls ij bi translated">在这种方法中，我们使用一个通用的表表达式(简称为CTE ),来过滤掉那些<strong class="kz ir">目的</strong>列为空而<strong class="kz ir">类别</strong>列为除“业务”之外的任何内容的记录。在CTE，我们还会累计各种用途的里程。</p><p id="6bb2" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们可以使用SELECT语句从CTE中提取每组目的及其对应的总里程。</p><p id="91e5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">然后，我们使用RANK()窗口函数按照降序为值生成等级。最后，我们可以使用另一个WHERE语句来只显示等级值小于或等于3的记录。</p><p id="9c6a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这种方法更加稳健，因为它处理的是目的可能与总里程数相关的边缘情况。</p><pre class="kh ki kj kk gt nw nx ny nz aw oa bi"><span id="658e" class="ml lu iq nx b gy ob oc l od oe">WITH cte AS<br/>  (SELECT purpose,<br/>          sum(miles) AS miles_sum<br/>   FROM my_uber_drives<br/>   WHERE purpose IS NOT NULL<br/>     AND category ILIKE '%business%'<br/>   GROUP BY purpose)<br/>SELECT purpose,<br/>       miles_sum<br/>FROM<br/>  (SELECT purpose,<br/>          miles_sum,<br/>          rank() OVER (<br/>                       ORDER BY miles_sum DESC) AS rnk<br/>   FROM cte) a<br/>WHERE rnk&lt;=3</span></pre><h1 id="4cfe" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">最后的话</h1><p id="b58b" class="pw-post-body-paragraph kx ky iq kz b la mx jr lc ld my ju lf lg mz li lj lk na lm ln lo nb lq lr ls ij bi translated">在过去的十年里，优步从一个小公司发展成为今天的大型科技公司。</p><p id="70ef" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这些年来，数据收集和分析一直是其商业模式的重要元素。数据科学家的努力让优步以合理的价格提供舒适的服务。</p><p id="2b82" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">您可以查看“<a class="ae kw" href="https://www.stratascratch.com/blog/uber-data-scientist-interview-question-walkthrough/?utm_source=blog&amp;utm_medium=click&amp;utm_campaign=medium" rel="noopener ugc nofollow" target="_blank"> <em class="nc">优步数据科学家面试问题</em> </a>”以了解更多针对优步数据科学家候选人的问题。在StrataScratch复习实际问题，更新你的SQL知识，确保你在优步面试时不会措手不及。</p></div></div>    
</body>
</html>