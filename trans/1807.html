<html>
<head>
<title>2 Caveats to Avoid When Using Python Assert Statement</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python Assert语句时要避免的2个警告</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/2-caveats-to-avoid-when-using-python-assert-statement-8060e123c26a#2022-04-27">https://towardsdatascience.com/2-caveats-to-avoid-when-using-python-assert-statement-8060e123c26a#2022-04-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="16f5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">消除这些可能发生的无声错误</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f1548b12253d1f3b63eee31a3fed7837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9tIvGz-13JHzVU7N"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@olav_ahrens?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Olav Ahrens rtne</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="a9b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python中的<code class="fe lv lw lx ly b">assert</code>语句允许您运行内部单元测试，并提供测试条件的调试帮助。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="19cc" class="md me it ly b gy mf mg l mh mi"><strong class="ly iu">syntax: assert condition [, Error Message]</strong></span></pre><p id="93ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果条件为真，则什么都不会发生。否则，会引发一个带有可选错误消息的<code class="fe lv lw lx ly b"><strong class="lb iu">AssertionError</strong></code>异常。</p><h1 id="2388" class="mj me it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">assert语句有用的示例</h1><p id="bc0c" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">假设您想根据费率计算折扣价。</p><p id="4d07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使其正常工作，贴现率必须介于0和1之间。</p><p id="2848" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了检查可能导致折扣率高于1的潜在错误，我们可以添加以下断言。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="e1c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们对100美元应用40% (0.4)的贴现率，这将产生预期的结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/28e5d173b165a4b0038f55038b896b11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sv0hW2fXzurzWVxwAYAdUw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0e4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果我们应用120%的贴现率(！)，这会导致以下异常:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/801031e249f0ed9acc116261f4f92d27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sbEWizwjnt76fC4JWWxtMw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7df5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使异常更加明确，我们可以在<code class="fe lv lw lx ly b">assert</code>语句中添加一条错误消息:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="9e2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">再次运行前面的示例会将错误消息添加到控制台。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/e3906fc32fb02c3020d3e9cb3e0fb053.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c6JBmbOAsSbqZJmKQuaoxw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b3f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您查看stacktrace，您会看到解释器指出了断言条件失败的确切行。这对于调试非常有用:对于你和与你合作的其他队友。</p><p id="3825" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，当您将错误消息添加到assert语句中时，这可以作为代码的文档。</p><h1 id="1e72" class="mj me it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">陷阱1:使用断言进行数据验证</h1><p id="4031" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">虽然<code class="fe lv lw lx ly b">assert</code>语句可以帮助您调试代码并在内部进行测试，但是应该谨慎使用，不要依赖它们来验证数据或应用安全检查。</p><p id="b9f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">原因很简单:出于性能原因，可以在生产中禁用<code class="fe lv lw lx ly b">assert</code>语句。因此，如果代码的关键部分使用了它们，将会忽略对条件的检查。</p><p id="cb0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看下面这个使用<code class="fe lv lw lx ly b">assert</code>语句检查管理员权限的例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="e51b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果使用<code class="fe lv lw lx ly b">-O</code>和<code class="fe lv lw lx ly b">—OO</code>命令行开关启动执行该函数的python程序，断言<strong class="lb iu">将被全局禁用。</strong></p><p id="93c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种特殊情况<strong class="lb iu">引入了安全漏洞。</strong></p><p id="9fb9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">→避免这个问题的正确方法是永远不要使用断言进行数据验证。相反，我们可以使用if条件，并在必要时引发异常。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h1 id="6bf4" class="mj me it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">陷阱2:使用括号使断言永远不会失败</h1><p id="1a4f" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">如果你使用了<code class="fe lv lw lx ly b">assert</code>语句，但对语法不太确定，你可能会像这样加上括号。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="453f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，这导致了一个无声的错误。事实上，在写的时候:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="7d61" class="md me it ly b gy mf mg l mh mi"><strong class="ly iu">assert (condition, error_message)</strong></span></pre><p id="25a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"/><code class="fe lv lw lx ly b"><strong class="lb iu">assert</strong></code><strong class="lb iu">语句不检查条件，如果为假则打印错误信息。它实际做的是将</strong> <code class="fe lv lw lx ly b"><strong class="lb iu">(condition, error_message)</strong></code> <strong class="lb iu">整个元组作为一个条件进行求值。</strong></p><p id="b706" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为在Python编程语言中元组的计算结果为True，所以该语句:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="8ffc" class="md me it ly b gy mf mg l mh mi"><strong class="ly iu">assert (condition, error_message)</strong></span></pre><p id="0637" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">永远不会引发错误si <strong class="lb iu">(条件，错误消息)</strong>始终为真。</p><p id="2acc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意ipython解释器如何引发关于括号的语法警告异常。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/c28fa65fec91dde832d4b6ca04183b90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C8Q_N7M90_e6B-MVBuGbnQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="77c0" class="mj me it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">参考</h1><ul class=""><li id="7fac" class="nk nl it lb b lc na lf nb li nm lm nn lq no lu np nq nr ns bi translated"><a class="ae ky" href="https://careerkarma.com/blog/python-assert/" rel="noopener ugc nofollow" target="_blank">https://careerkarma.com/blog/python-assert/</a></li><li id="e299" class="nk nl it lb b lc nt lf nu li nv lm nw lq nx lu np nq nr ns bi translated"><a class="ae ky" href="https://www.programiz.com/python-programming/assert-statement" rel="noopener ugc nofollow" target="_blank">https://www . programiz . com/python-programming/assert-statement</a></li></ul><h1 id="1f53" class="mj me it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">结论</h1><p id="3980" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated"><code class="fe lv lw lx ly b">assert</code>用于调用函数的<em class="ny">程序员</em>出错的情况，与<em class="ny">用户</em>相反。在这种情况下使用<code class="fe lv lw lx ly b">assert</code>可以确保程序员在测试过程中正确使用你的函数。</p><p id="e917" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请记住，<code class="fe lv lw lx ly b">assert</code>并不是为了防止运行时出现错误，因此不应该用于执行数据验证。</p><p id="bec8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，不要在条件和错误消息之间使用括号，因为Python总是将元组求值为True，断言永远不会失败。</p></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><h1 id="6f28" class="mj me it bd mk ml og mn mo mp oh mr ms jz oi ka mu kc oj kd mw kf ok kg my mz bi translated">新到中？你可以每月订阅5美元，并解锁各种主题的无限文章(技术、设计、创业……)你可以通过点击我的推荐链接<a class="ae ky" href="https://ahmedbesbes.medium.com/membership" rel="noopener">来支持我</a></h1><div class="ol om gp gr on oo"><a href="https://ahmedbesbes.medium.com/membership" rel="noopener follow" target="_blank"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd iu gy z fp ot fr fs ou fu fw is bi translated">加入我的介绍链接媒体-艾哈迈德贝斯</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">ahmedbesbes.medium.com</p></div></div><div class="ox l"><div class="oy l oz pa pb ox pc ks oo"/></div></div></a></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/46c5a7cdfef5c313d073bacb26ca782d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8jViL6txqyoEgiXa"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@karsten116?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卡斯滕·怀恩吉尔特</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div></div>    
</body>
</html>