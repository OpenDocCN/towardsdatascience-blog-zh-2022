<html>
<head>
<title>3 Automated Ways to Rename a File with a Current Date String</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用当前日期字符串重命名文件的 3 种自动方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-automated-ways-to-rename-a-file-with-a-current-date-string-3c787a5eb78e#2022-03-21">https://towardsdatascience.com/3-automated-ways-to-rename-a-file-with-a-current-date-string-3c787a5eb78e#2022-03-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8c59" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">分别使用 VBA 宏、批处理文件命令和 Python</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f6eb359c418a8a6982de69df68d497d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JXAU48ORw1wixG9A"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@maddibazzocco?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Maddi Bazzocco </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="5fe5" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">背景</h1><p id="f5a2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">可以在数据准备工作流的早期阶段使用数据科学技术来自动化手动任务。具体来说，在我职业生涯的许多实例中，我不得不使用带有时间戳的固定命名约定来重命名文件。这是为了使下游的工作流程能够区分数据或识别随时间变化的趋势。虽然只手动执行几个文件的重命名是可以接受的，但如果有数百个文件，就不可以了，这在商业环境中是常见的情况。</p><p id="3a62" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">通过一个用例，本文介绍了三(3)种基于当前或预定义日期使用字符串重命名文件的自动化方法，分别使用<strong class="lt iu"> Excel VBA 宏</strong>和<strong class="lt iu">批处理文件命令</strong>和<strong class="lt iu"> Python </strong>。</p><h1 id="c6ba" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">用例</h1><p id="6e79" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我职业生涯的早期，我有机会在一家人寿保险公司担任再保险分析师，该公司将再保险业务转让给多家再保险人。由于再保险人最终是直接保险公司运营的外部第三方，我的部分职责包括每月为再保险人准备各种报告。对于这个用例，我准备的一个报告是系统在一个月的最后一个工作日生成的所有有效策略的摘录。</p><p id="4db3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这个摘录和系统生成的许多其他再保险报告一样，有一个固定的(陈旧的)名称<em class="ms"> inforce_extract.csv </em>。当时准备这些报告的流程要求我通过添加再保险人标签和日期字符串(例如<em class="ms">inforce _ extract _ reinsurer 1 _ 201206 . CSV</em>)来手动重命名这些报告。对于多个再保险人的数百份报告，我遵循这一手动流程两个月，然后决定这是不可行的，因为它非常耗时且容易出现手动错误。</p><p id="b440" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面我将首先介绍我当时分别使用<strong class="lt iu"> Excel VBA 宏</strong>和<strong class="lt iu">批处理文件命令</strong>实现的两种方法，以取代上面概述的手动重命名过程(这两种方法最终使我获得了重大的过程改进)，然后用<strong class="lt iu"> Python </strong>中的一种实现来总结这一点，以帮助那些可能不熟悉前两种方法下的编程语言的人。</p><h1 id="692c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">Excel VBA 宏</h1><p id="d86f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">对于那些熟悉 Excel 的人来说，<strong class="lt iu"> Excel VBA 宏</strong>以通过在其内置的 VBA 编辑器中创建定制函数来自动化手动 Excel 相关任务而闻名。在这种情况下，由于大多数报告是在。csv 格式，我想我可以写一个定制的功能，自动执行以下步骤:</p><ol class=""><li id="573c" class="mt mu it lt b lu mn lx mo ma mv me mw mi mx mm my mz na nb bi translated">打开底层。csv 报告</li><li id="2dfa" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated">在函数中创建一个软编码变量，用于捕获引用日期的字符串(例如，当前报告日期的年和月，或“yyyymm”)</li><li id="5b36" class="mt mu it lt b lu nc lx nd ma ne me nf mi ng mm my mz na nb bi translated">保存。csv 报告为另一个文件，采用选择的格式，文件名中包含步骤 2 中的字符串</li></ol><p id="ef99" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">以 inforce_extract.csv 报告为例，这可以通过运行以下 VBA 宏来实现:</p><p id="0a98" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">第一步</strong></p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="aaf0" class="nm la it ni b gy nn no l np nq">' Open the system generated report<br/>' path needs to be defined as path to directory of the system<br/>' generated report</span><span id="52e9" class="nm la it ni b gy nr no l np nq">Workbooks.Open Filename:=path &amp; "\inforce_extract.csv"<br/>Set inforce_extract = Application.Workbooks("inforce_extract.csv")<br/></span></pre><p id="c97e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">第二步</strong></p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="bd54" class="nm la it ni b gy nn no l np nq">' DateAdd function allows one to soft-code a date referencing a <br/>' pre-defined date</span><span id="d83c" class="nm la it ni b gy nr no l np nq">' The code below would return 202112 at time of writing, which is 3 ' months in arrears to March 2022</span><span id="d1ee" class="nm la it ni b gy nr no l np nq"><br/>date_string = Format(DateAdd("m", -3, Now), "yyyymm")</span></pre><p id="0a7e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">第三步</strong></p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="ea6d" class="nm la it ni b gy nn no l np nq">' Save the extract as "ïnforce_extract_reinsurerX_202112.csv"<br/>' SAVEpath needs to be defined as the path to the directory where<br/>' we want to save the renamed report<br/>' There is also an option to save the file in another format, xlCSV ' is chosen for this instance</span><span id="4fe2" class="nm la it ni b gy nr no l np nq">inforce_extract.SaveAs _<br/>Filename:=SAVEpath &amp; "inforce_extract_reinsurerX" &amp; date_string &amp; ".csv", _<br/>FileFormat:=xlCSV, CreateBackup:=False, <br/>inforce_extract.Saved = True</span></pre><p id="dc03" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">虽然作为每月重命名过程的一部分，我花了一些时间为所有需要重命名的文件编写代码，但这是值得的，因为我只需点击一下鼠标，就可以重命名数百份引用最新报告日期的报告。</p><p id="6295" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">值得注意的是，在<strong class="lt iu">步骤 2 </strong>中引入的 DateAdd 函数也可以用于以类似的方式在<strong class="lt iu">步骤 1 </strong>中打开一个已经带有日期字符串的文件。</p><h1 id="f0ff" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">批处理文件命令</h1><p id="bbbd" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">没过多久，我就对 VBA 宏自动化的过程感到不满意，因为我突然想到，我应该能够更有效地重命名报告，而不需要打开它们。这类似于在 Windows 目录中的文件上按 F2 键并键入新名称。</p><p id="36a5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">由于这是 Excel 之外的操作，VBA 宏不再是合适的工具。当时我的一位同事给我指了指<strong class="lt iu">批处理文件命令</strong>。简单来说，这是一种用于在 Windows 操作系统中创建可执行脚本文件的编程语言。</p><p id="09f6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">脚本文件可以在文本文件中编译和编辑(例如，在 Windows 的记事本中)，并以. bat 扩展名保存。然后，只需双击。蝙蝠文件。</p><p id="1e1d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我需要遵循的步骤有效地减少到只有前面章节中的<strong class="lt iu">步骤 2 </strong>和<strong class="lt iu">步骤 3 </strong>。概括地说，这只是基于最近的报告日期捕获日期字符串，并使用捕获再保险人名称(在报告日期中不变)和日期字符串的命名约定来重命名系统生成的报告，而不需要打开底层文件。</p><p id="dafa" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要在脚本文件中基于当前日期(即今天)捕获日期字符串(注意“@REM”是在脚本文件中显示注释的方式):</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="8596" class="nm la it ni b gy nn no l np nq">@REM Get the current date, by capturing the first 10 substrings  @REM This captures a date of dd/mm/yyyy<br/>set stamp=%date:~-10%<br/></span><span id="1c25" class="nm la it ni b gy nr no l np nq">@REM Get the year (e.g. 2022), by extracting the 7th to 10th        @REM substrings<br/>set year=%stamp:~6,4%<br/></span><span id="7c30" class="nm la it ni b gy nr no l np nq">@REM Get the month (e.g. 03), by extracting the 4th to 5th       @REM substrings<br/>set month=%stamp:~3,2%</span></pre><p id="b2ac" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果我需要捕获基于非当前日期的日期字符串，需要一些额外的步骤。下面的脚本演示了如何根据比当前日期晚 3 个月的日期提取日期字符串“yyyymm”:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="6bf6" class="nm la it ni b gy nn no l np nq">@REM subtract 3 months<br/>set /a month=1%month%-103</span><span id="34f7" class="nm la it ni b gy nr no l np nq"><br/>@REM "Rollback" year and month if the above is negative           @REM e.g. 101 for January - 103 would be negative, then add 12 to @REM month and subtract 1 from year<br/>if %month% LSS 1  (<br/>  set /a month=%month%+12<br/>  set /a year=%year%-1<br/>)</span><span id="cc99" class="nm la it ni b gy nr no l np nq"><br/>@REM Prepend with zero for single-digit month numbers (i.e. if month @REM number is 9 or less, add a leading 0)<br/>if %month% GTR 9 (set month_final=%month%) <br/>else (set month_final=0%month%)</span></pre><p id="f2cf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，要使用再保险人和日期字符串重命名报告:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="61d1" class="nm la it ni b gy nn no l np nq">@REM Define current directory, path needs to be defined as path to @REM directory of the system generated report<br/>cd "path"</span><span id="e2b3" class="nm la it ni b gy nr no l np nq">@REM Rename the inforce_extract.csv report in the path<br/>rename inforce_extract.csv inforce_extract_reinsurerX_%year%%month_final%.csv</span></pre><h1 id="c45d" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">计算机编程语言</h1><p id="08e7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">与上面的两种方法相比，我认为使用以下步骤在 Python 中可以更容易地实现相同的重命名任务:</p><p id="239b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">第一步:导入库</strong></p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="d6d1" class="nm la it ni b gy nn no l np nq">from datetime import datetime<br/>import os</span></pre><p id="ddbf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">第二步:定义要重命名的文件</strong></p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="63ea" class="nm la it ni b gy nn no l np nq">## Path to be defined as directory where the file is saved<br/>inforce_extract = 'path/inforce_extract.csv'</span></pre><p id="5284" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">第三步:创建日期字符串并为文件定义新名称</strong></p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="e8c6" class="nm la it ni b gy nn no l np nq">## The below returns yyyymm, or 220203 at time of writing<br/>date_string = datetime.today().strftime('%Y%m')</span><span id="f908" class="nm la it ni b gy nr no l np nq">## Define new name<br/>new_name = 'path/inforce_extract_reinsurerX_'+ date_string +'.csv'</span></pre><p id="e7f4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">第四步:重命名</strong></p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="4046" class="nm la it ni b gy nn no l np nq">os.rename(inforce_extract, new_name)</span></pre><h1 id="8130" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">总结想法</h1><p id="d222" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我观察到，与我一起工作的大多数人鄙视手工过程，而一些人选择接受，另一些人采取额外的步骤来自动化它们。</p><p id="e144" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我很感激在我职业生涯早期所处的环境中，我被迫使用编程来改进过程。在接下来的几年里，这种有益的经历继续激励我学习各种应用程序的编程，自动化无疑是其中之一，除此之外，数据科学和机器学习也是我日常工作的应用程序。</p><p id="6110" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你喜欢你正在阅读的东西，一定要访问我的个人资料，在这里查看我写的其他文章。</p></div></div>    
</body>
</html>