<html>
<head>
<title>Hyperparameter Optimization for Deep Learning models with Keras Tuner</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Keras 调谐器对深度学习模型进行超参数优化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/hyperparameter-optimization-for-deep-learning-models-with-keras-tuner-4c5010c9ad79#2022-03-28">https://towardsdatascience.com/hyperparameter-optimization-for-deep-learning-models-with-keras-tuner-4c5010c9ad79#2022-03-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b47d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">可扩展的超参数优化框架解决了优化人工神经网络模型的难题</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/148b234a66f5c7464a2ce6c8dfcc9e9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6tZTeA0bhI5fUwuriXmG-w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://pixabay.com/users/marquetand-3570369/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=5076887" rel="noopener ugc nofollow" target="_blank">菲利普·马克特和</a>从<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=5076887" rel="noopener ugc nofollow" target="_blank">皮克斯拜</a>拍摄</p></figure><p id="3dd3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了调整机器学习算法，Scikit-learn 包提供了 GridSearchCV、RandomSearchCV 的实现，以找到 ML 模型的最佳超参数集。但在训练深度学习(ANN)模型时，数据科学家往往难以找到正确的隐藏层数、每层神经元数量、辍学率和其他超参数。为了训练最优的深度学习模型，人们需要找到最佳的超参数集，这是一项非常繁琐的任务，需要硬编码或随着超参数的变化重新运行实验。</p><p id="6d43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://keras.io/keras_tuner/" rel="noopener ugc nofollow" target="_blank"> KerasTuner </a>是一个易于使用、可扩展的超参数优化框架，解决了超参数搜索的痛点，并轻松搜索 ANN 模型的最佳配置。在本文中，我们将使用 Keras Tuner 为图像分类应用程序执行超调。</p><h2 id="8e25" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">设置:</h2><p id="fe52" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated"><strong class="lb iu">数据集:</strong>我们将使用 Keras Tuner 框架为一个 ANN 模型找到最佳的超参数集，该模型对来自<a class="ae ky" href="https://github.com/zalandoresearch/fashion-mnist" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> <em class="mt">时尚 MNIST 数据集</em></strong></a><strong class="lb iu"><em class="mt"/></strong><em class="mt">(在</em> <a class="ae ky" href="https://github.com/zalandoresearch/fashion-mnist/blob/master/LICENSE" rel="noopener ugc nofollow" target="_blank"> <em class="mt">麻省理工学院许可</em> </a> <em class="mt"> ) </em>的服装图像进行分类。数据集是开源的，可以从<code class="fe mu mv mw mx b"><a class="ae ky" href="https://www.tensorflow.org/api_docs/python/tf/keras/datasets/fashion_mnist" rel="noopener ugc nofollow" target="_blank">tf.keras.datasets.fashion_mnist</a></code>访问。</p><p id="6175" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">安装:</strong> KerasTuner 需要<strong class="lb iu"> Python 3.6+ </strong>和<strong class="lb iu"> TensorFlow 2.0+，</strong>确保按要求升级。Keras Tuner 可以从 PyPI 安装，使用:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="c60a" class="lv lw it mx b gy nc nd l ne nf"><strong class="mx iu">!pip install -q -U keras-tuner</strong></span></pre><h1 id="4ed7" class="ng lw it bd lx nh ni nj ma nk nl nm md jz nn ka mg kc no kd mj kf np kg mm nq bi translated">Keras 调谐器:</h1><p id="7dc9" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">KerasTuner 是一个易于使用、可扩展的超参数优化框架，它通过运行定义的语法为您的深度学习模型搜索最佳的超参数集。Keras Tuner 提供 4 种调谐器或算法，包括<code class="fe mu mv mw mx b"><strong class="lb iu">RandomSearch</strong></code>、<code class="fe mu mv mw mx b"><strong class="lb iu">Hyperband</strong></code>、<code class="fe mu mv mw mx b"><strong class="lb iu">BayesianOptimization</strong></code>和<code class="fe mu mv mw mx b"><strong class="lb iu">Sklearn</strong></code>，可执行超参数优化，并可扩展以试验新的搜索算法。</p><p id="9111" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将使用 Keras Tuner 框架优化一个 ANN 模型的<strong class="lb iu"> <em class="mt">学习率</em> </strong>、<strong class="lb iu"> <em class="mt">层数</em> </strong>、<strong class="lb iu"> <em class="mt">每层神经元数、</em> </strong>和<strong class="lb iu"> <em class="mt">辍学率</em> </strong>。</p><blockquote class="nr ns nt"><p id="6cc6" class="kz la mt lb b lc ld ju le lf lg jx lh nu lj lk ll nv ln lo lp nw lr ls lt lu im bi translated">现在，让我们从人工神经网络模型的实现开始，并使用 KerasTuner 软件包优化其超参数。</p></blockquote><h2 id="9f47" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">1.下载并加载数据集:</h2><p id="d70e" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在定义深度学习模型之前，让我们从加载数据集开始:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(代码由作者编写)，下载并加载训练和测试数据</p></figure><h2 id="cb2f" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated"><strong class="ak"> 2。定义人工神经网络模型:</strong></h2><p id="ca84" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">深度学习模型架构是使用 Keras 实现定义的。我们可以使用 Keras Tuner 来调整:</p><ul class=""><li id="4726" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated">致密层数(第 6 行)</li><li id="f871" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">每个致密层中的神经元数量(第 9、10 行)</li><li id="17eb" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">辍学率(第 13、14 行)</li><li id="b21a" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">学习率(第 20、21 行)</li></ul><p id="bd74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在建立深度学习模型时，可以定义超参数搜索空间进行优化。你为超调设置的模型叫做<strong class="lb iu"> <em class="mt">超模</em> </strong>。我们将定义<code class="fe mu mv mw mx b"><strong class="lb iu">model_builder()</strong></code> <strong class="lb iu"> </strong>函数来定义超模。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(由作者编写代码)，使用由运行定义的 KerasTuner 语法定义 ANN 模型</p></figure><h2 id="dbd2" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">3.实例化 Keras 调谐器:</h2><p id="574d" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Keras 调谐器提供<code class="fe mu mv mw mx b"><strong class="lb iu">RandomSearch</strong></code>、<code class="fe mu mv mw mx b"><strong class="lb iu">Hyperband</strong></code>、<strong class="lb iu">、</strong>调谐器来优化超参数。要实例化调谐器，可以指定 hypermodel 函数和其他参数。</p><p id="4f97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">超波段:</strong></p><p id="e307" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">超波段调优算法使用自适应资源分配和提前停止来快速收敛到高性能模型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(代码由作者编写)，实例化 Hyperband 调谐器</p></figure><blockquote class="nr ns nt"><p id="30b2" class="kz la mt lb b lc ld ju le lf lg jx lh nu lj lk ll nv ln lo lp nw lr ls lt lu im bi translated">遵循<a class="ae ky" href="https://keras.io/api/keras_tuner/tuners/hyperband/" rel="noopener ugc nofollow" target="_blank"> KerasTuner 文档</a>获取 Hyperband 参数的描述。</p></blockquote><p id="91d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">随机搜索:</strong></p><p id="ea4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">RandomSeach 算法遵循随机方法来选择超参数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(作者代码)，实例化 RandomSearch 调谐器</p></figure><blockquote class="nr ns nt"><p id="27e3" class="kz la mt lb b lc ld ju le lf lg jx lh nu lj lk ll nv ln lo lp nw lr ls lt lu im bi translated">按照<a class="ae ky" href="https://keras.io/api/keras_tuner/tuners/random/" rel="noopener ugc nofollow" target="_blank"> KerasTuner 文档</a>获取 RandomSearch 参数的描述。</p></blockquote><h2 id="a07d" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">3.运行超参数搜索:</h2><p id="e65b" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated"><code class="fe mu mv mw mx b"><strong class="lb iu">tuner.search()</strong></code> <strong class="lb iu"> </strong>功能可用于在超模上运行超参数搜索。search 方法的参数与用于<code class="fe mu mv mw mx b">tf.keras.model.fit</code>函数的参数相同。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(作者代码)，运行 hyperband 调谐器</p></figure><h2 id="c3bf" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">4.训练优化的模型:</h2><p id="e794" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated"><code class="fe mu mv mw mx b">tuner.get_best_hyperparameters()</code>函数返回超模的最优超参数集。此外，可以传递同一组超参数来训练优化的 ANN 模型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(由作者编码)，用最佳超参数集训练 ANN 模型</p></figure><h1 id="5edd" class="ng lw it bd lx nh ni nj ma nk nl nm md jz nn ka mg kc no kd mj kf np kg mm nq bi translated">输出:</h1><p id="483e" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">下面的结果是通过在具有 60k 训练和 10k 测试样本<strong class="lb iu"> <em class="mt">的<a class="ae ky" href="https://github.com/zalandoresearch/fashion-mnist" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> <em class="mt">时尚 MNIST 数据集</em></strong></a><strong class="lb iu"><em class="mt"/></strong>上训练 ANN 模型而获得的。</em> </strong>优化的人工神经网络模型和具有下述硬编码超参数的人工神经网络模型的性能:</p><div class="kj kk kl km gt ab cb"><figure class="on kn oo op oq or os paragraph-image"><img src="../Images/f5bc9132b33e9ddbbab9261107e05f03.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*z6zAoozMjvLbxCxS713GMw.png"/></figure><figure class="on kn oo op oq or os paragraph-image"><img src="../Images/6a2d7a9d1f0a1e4eddc71e5463ed5d82.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*fvk7EjRrEcITurv1CQp1DA.png"/><p class="ku kv gj gh gi kw kx bd b be z dk ot di ou ov translated">(图片由作者提供)，<strong class="bd ow">左:</strong>在优化的超参数上训练的 ANN 模型的训练和验证精度，<strong class="bd ow">右:</strong>在硬编码的超参数上训练的 ANN 模型的训练和验证精度</p></figure></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/b57aa6992c52c3d1af0440fc4109b86d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RHnzdq2tONkHox33EUptHw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)，人工神经网络/优化人工神经网络模型的训练测试损失和准确性</p></figure><p id="11f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过优化人工神经网络超参数，我们可以观察到约 3%的测试精度差异。</p><h1 id="4891" class="ng lw it bd lx nh ni nj ma nk nl nm md jz nn ka mg kc no kd mj kf np kg mm nq bi translated">结论:</h1><p id="8731" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Keras Tuner 框架可以帮助数据科学家通过优化超参数来训练一个强大的深度学习模型。在定义超模型时，数据科学家需要为每个超参数预先指定参数范围。</p><p id="3ff1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于计算机视觉应用，还可以使用两个预定义的<code class="fe mu mv mw mx b">HyperModel</code>类- <a class="ae ky" href="https://keras-team.github.io/keras-tuner/documentation/hypermodels/#hyperxception-class" rel="noopener ugc nofollow" target="_blank">超例外</a>和<a class="ae ky" href="https://keras-team.github.io/keras-tuner/documentation/hypermodels/#hyperresnet-class" rel="noopener ugc nofollow" target="_blank">超结果</a>。</p><h1 id="8175" class="ng lw it bd lx nh ni nj ma nk nl nm md jz nn ka mg kc no kd mj kf np kg mm nq bi translated">参考资料:</h1><p id="e4b0" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">[1] KerasTuner 文件:<a class="ae ky" href="https://keras.io/keras_tuner/" rel="noopener ugc nofollow" target="_blank">https://keras.io/keras_tuner/</a></p><p id="0ac9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[2]数据集(时尚 MNIST):<a class="ae ky" href="https://github.com/zalandoresearch/fashion-mnist" rel="noopener ugc nofollow" target="_blank">https://github.com/zalandoresearch/fashion-mnist</a></p><blockquote class="oy"><p id="c13e" class="oz pa it bd pb pc pd pe pf pg ph lu dk translated">感谢您的阅读</p></blockquote></div></div>    
</body>
</html>