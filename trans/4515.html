<html>
<head>
<title>A Tutorial on White’s Heteroskedasticity Consistent Estimator Using Python and Statsmodels</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python和Statsmodels的White异方差一致性估计量教程</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-tutorial-on-whites-heteroskedasticity-consistent-estimator-using-python-and-statsmodels-7d38789150d1#2022-10-06">https://towardsdatascience.com/a-tutorial-on-whites-heteroskedasticity-consistent-estimator-using-python-and-statsmodels-7d38789150d1#2022-10-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/10a3467aa44c60cc666ea8dda7827c51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wTguLR6A-AcI5_XHCNjbig.jpeg"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">菲利普·D·T1在<a class="ae jd" href="https://unsplash.com/s/photos/spiral?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><div class=""/><div class=""><h2 id="540e" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">如何通过Python和statsmodels使用White的异方差一致性估计量</h2></div><p id="727b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本文中，我们将学习如何使用HC估计量来执行对异方差稳健的统计推断。</p><p id="ae78" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本文是以下两部分系列的第2部分:</p><p id="f368" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae jd" rel="noopener" target="_blank" href="/introducing-the-whites-heteroskedasticity-consistent-estimator-821beee28516">第1部分:介绍White的异方差一致性估计量</a> <br/> <strong class="kx jh">第2部分:使用Python和Statsmodels的White异方差一致性估计量教程</strong></p><p id="8679" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在第一部分中，我们深入研究了White的异方差一致性估计的理论。让我们快速回忆一下我们在第1部分中学到了什么。</p><p id="30d4" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">考虑以下线性模型:</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lr"><img src="../Images/815dcf2cb5bc450acb0ab63078706b6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*AfobzNk6mbnAqxdkc8Ol8A.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">线性模型(图片由作者提供)</p></figure><p id="c981" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh"> <em class="lw"> y </em> </strong>是响应变量。对于大小为<em class="lw"> n </em>的数据集，它是大小为<em class="lw">【n×1】</em>的列向量。假设模型有<em class="lw"> k个</em>回归变量，包括截距。<strong class="kx jh"> <em class="lw"> β </em> </strong>是回归系数<em class="lw">【β_ 1，β_2，…β_ k】</em>的列向量，其中<em class="lw"> β_1 </em>是截距。<strong class="kx jh"> <em class="lw"> X </em> </strong>是回归变量的矩阵，包括矩阵第1列截距的占位符。<strong class="kx jh"> <em class="lw"> X </em> </strong>大小为<em class="lw">【n X k】</em>。</p><p id="9e87" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面是等式(1)的矩阵形式:</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/78876ac48c36e99323ab34c07e381e2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*dIqM_oGr6Fhiiu6U5NbOkw.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">线性模型(图片由作者提供)</p></figure><p id="d7e9" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">等式(1)的最小二乘估计为<strong class="kx jh"><em class="lw"/></strong>产生以下估计量:</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/1e228a920fca45c6bda6e1ea55645649.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*qH75T3XO9OKz8APVa8V1rA.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated"><strong class="bd lz"><em class="ma"/></strong>的OLS估计器(图片由作者提供)</p></figure><p id="dfb8" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">由于估计系数<strong class="kx jh"> <em class="lw"> β_cap </em> </strong>是随机变量，因此它们具有方差-协方差结构，由以下协方差矩阵给出:</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mb"><img src="../Images/9e1cf51e7e5d67c34e6a5fd790d18c66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MWvw9afnKRDOZQT8CJ2mJw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">拟合回归系数的协方差矩阵(图片由作者提供)</p></figure><p id="aacf" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">该矩阵的对角元素是系数估计的标准误差，这些标准误差用于导出系数的p值和置信区间，换句话说，用于测试系数是否具有统计显著性并计算其精度。</p><p id="6055" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh"> <em class="lw"> β_cap </em> </strong>的协方差矩阵使用下面的矩阵方程来估计(其解释和推导在第一部分中涉及):</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mc"><img src="../Images/31fc38cd27e014f2fcfddb0734abc3c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pu34VVukP7bXKoqqMibS-Q.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">估计系数的协方差矩阵的公式(图片由作者提供)</p></figure><p id="8632" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上式中，<strong class="kx jh">T5【X’</strong>是<strong class="kx jh"><em class="lw">X</em></strong><em class="lw">(-1)</em>算子的转置，对括号中的矩阵求逆。这个等式的核心是<em class="lw">σ</em><strong class="kx jh"><em class="lw">ω</em></strong>，它是模型误差的以下<em class="lw">【n x n】</em>矩阵:</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi md"><img src="../Images/4fc55749e0579dff43b9bf67714ea7cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uuRtieBBJqHdg8ltlxeq9Q.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">当模型误差为<strong class="bd lz">异方差</strong>和非自相关时，回归模型误差的协方差矩阵(图片由作者提供)</p></figure><p id="0529" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="lw"> σ </em>只是一个普通的比例因子，使得<em class="lw"> ω_i=σ _i/σ </em>。当模型的误差为同方差(常方差)和非自相关(在横截面数据集中相当常见)时，<em class="lw"> σ _i=σ </em>对于所有<em class="lw"> i </em>和<em class="lw"> ω_i=1 </em>对于所有<em class="lw"> i </em>和<strong class="kx jh"><em class="lw">ω</em></strong><em class="lw">=</em><strong class="kx jh"><em class="lw">I</em></strong>，恒等式矩阵。在这种情况下，<a class="ae jd" rel="noopener" target="_blank" href="/a-deep-dive-into-the-variance-covariance-matrices-of-classical-linear-regression-models-4322b2cdc8e6">可以看出</a>系数估计的协方差矩阵的公式简化为以下简单公式:</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/01f246e4a3866bcc72b03898f16f005d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CMl4cZ4__FSSZfQLe7YEsA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">当模型误差为<strong class="bd lz">同方差</strong>和<strong class="bd lz">非自相关</strong>时，拟合回归系数的协方差矩阵公式(图片由作者提供)</p></figure><p id="8aae" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">由于<em class="lw"> σ </em>不可直接观测，我们使用以下公式来估计协方差矩阵。这里s是拟合模型的残差的方差:</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/e4d883497b2e3396ddcabc0f1307fdf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O9rOVLtu9zItRqm4u6uiCg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">当模型误差为<strong class="bd lz">同方差</strong>和<strong class="bd lz">非自相关</strong>时，拟合回归系数的估计协方差矩阵的公式(图片由作者提供)</p></figure><p id="529d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">不幸的是，当模型的误差是同方误差时，我们不能使用等式(6)或(6a ),而必须回到等式(4)。在这个方程中，<em class="lw">σ</em><strong class="kx jh"><em class="lw">ω，</em> </strong>模型的误差的协方差矩阵本来就是不可观测的，所以必须进行估计。</p><p id="a04c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为此，我们使用以下由Halbert White提出的估计量(也在第1部分中详细介绍)，或其改进之一(也由White随后提出):</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mg"><img src="../Images/1b9080c25183025c96cff123fb05d9cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KDSg_C0ND9MDueXizP8ACg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">怀特的异方差一致性估计量(图片由作者提供)</p></figure><p id="42d2" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">式(7)中，e_i为第I个预测值对应的拟合模型的残差:<em class="lw">e _ I =(y _ I—</em><strong class="kx jh"><em class="lw">X</em></strong><em class="lw">_ I</em><strong class="kx jh"><em class="lw">β</em></strong><em class="lw">_ cap】</em>其中<strong class="kx jh"><em class="lw">X</em></strong><em class="lw">_ I</em>为第I行<strong class="kx jh"> <em class="lw"> X </em> </strong>。</p><p id="85df" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本文的其余部分，我们将把这些结果付诸实践。我们将看到在模型误差异方差的情况下，如何使用White的HC估计量对模型系数进行统计推断。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><p id="460b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下模型试图从几个社会经济因素来解释美国某县的贫困状况，具体来说，就是该县居民的年龄中位数、该县待售房屋的空置率以及该县至少拥有一个大学学位的人口比例。</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mo"><img src="../Images/fae4b670c1b04f2bd90844f271a14ec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bFula85Jr5iwJTzchXYlzw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">估算县级贫困的线性模型(图片由作者提供)</p></figure><p id="221d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了训练这个模型，我们将使用由美国人口普查局收集并在县一级汇总的几个社会经济指标的使用数据。该数据是美国人口普查局进行的2015-2019年美国社区调查(ACS) 5年估计值的子集。下表包含我们将使用的数据(点击或单击图像进行缩放):</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mp"><img src="../Images/9347b5b9ae140fb0729eac722cbcca19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vkx-0vyGqX3bfcve.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">根据<a class="ae jd" href="https://www.census.gov/data/developers/about/terms-of-service.html" rel="noopener ugc nofollow" target="_blank">使用条款</a>从<a class="ae jd" href="https://www.census.gov/data/developers.html" rel="noopener ugc nofollow" target="_blank">美国人口普查局</a>提取的美国社区调查数据集的子集</p></figure><p id="7f9c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本例中使用的数据集可以从这里 下载<a class="ae jd" href="https://gist.github.com/sachinsdate/0b8ebc2b26afb67a1e83e752c69e1a25" rel="noopener ugc nofollow" target="_blank"> <strong class="kx jh">。完整的ACS数据集可以使用<a class="ae jd" href="https://www.census.gov/data/developers/about/terms-of-service.html" rel="noopener ugc nofollow" target="_blank">公开可用的</a><a class="ae jd" href="https://www.census.gov/data/developers.html" rel="noopener ugc nofollow" target="_blank">API</a>从美国人口普查局的网站上获取，或者直接从人口普查局的<a class="ae jd" href="https://experience.arcgis.com/experience/13a111e06ad242fba0fb62f25199c7dd/page/Page-1/" rel="noopener ugc nofollow" target="_blank"> <strong class="kx jh">社区资源管理器</strong> </a>网站上获取。</strong></a></p><p id="8a48" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将使用Python和<a class="ae jd" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> Pandas </a>将ACS数据文件加载到内存中，并且我们将使用基于Python的<a class="ae jd" href="https://www.statsmodels.org/stable/gettingstarted.html" rel="noopener ugc nofollow" target="_blank"> statsmodels </a>包来构建和拟合线性模型。</p><p id="8fdb" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们从导入所需的包并将数据文件加载到Pandas <code class="fe mq mr ms mt b">DataFrame</code>开始:</p><pre class="ls lt lu lv gt mu mt mv mw aw mx bi"><span id="38fd" class="my mz jg mt b gy na nb l nc nd"><strong class="mt jh">import </strong>pandas <strong class="mt jh">as </strong>pd<br/><strong class="mt jh">import </strong>statsmodels.formula.api <strong class="mt jh">as </strong>smf<br/><strong class="mt jh">from</strong> patsy <strong class="mt jh">import</strong> dmatrices<br/><strong class="mt jh">from</strong> matplotlib <strong class="mt jh">import</strong> pyplot <strong class="mt jh">as</strong> plt</span><span id="3f71" class="my mz jg mt b gy ne nb l nc nd"><strong class="mt jh"><em class="lw">#Load the US Census Bureau data into a Dataframe<br/></em></strong>df = pd.<strong class="mt jh">read_csv</strong>(<strong class="mt jh">'us_census_bureau_acs_2015_2019_subset.csv'</strong>, <strong class="mt jh">header</strong>=0)</span></pre><p id="05e6" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">用<a class="ae jd" href="https://patsy.readthedocs.io/en/latest/quickstart.html" rel="noopener ugc nofollow" target="_blank"> Patsy </a>语法构建模型的方程。Statsmodels会自动将回归的截距添加到模型中，因此我们不必在模型的方程中明确指定它:</p><pre class="ls lt lu lv gt mu mt mv mw aw mx bi"><span id="04f9" class="my mz jg mt b gy na nb l nc nd">reg_expr = <strong class="mt jh">'Percent_Households_Below_Poverty_Level ~ Median_Age + Homeowner_Vacancy_Rate + Percent_Pop_25_And_Over_With_College_Or_Higher_Educ'</strong></span></pre><p id="c519" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">建立和训练模型并打印训练摘要:</p><pre class="ls lt lu lv gt mu mt mv mw aw mx bi"><span id="2c6c" class="my mz jg mt b gy na nb l nc nd">olsr_model = <strong class="mt jh">smf</strong>.<strong class="mt jh">ols</strong>(<strong class="mt jh">formula</strong>=reg_expr, <strong class="mt jh">data</strong>=df)</span><span id="f7b3" class="my mz jg mt b gy ne nb l nc nd">olsr_model_results = olsr_model.<strong class="mt jh">fit</strong>()</span><span id="4b07" class="my mz jg mt b gy ne nb l nc nd"><strong class="mt jh">print</strong>(olsr_model_results.<strong class="mt jh">summary</strong>())</span></pre><p id="af6c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们看到以下总结:</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mp"><img src="../Images/e817feaf0a2cea4de114e41b9f2f2c38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*etDqcZj2qhdIRm7h.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">线性模型的训练总结(图片由作者提供)</p></figure><p id="de85" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将忽略statsmodels报告的R平方值(或0.191的<a class="ae jd" rel="noopener" target="_blank" href="/the-complete-guide-to-r-squared-adjusted-r-squared-and-pseudo-r-squared-4136650fc06c">调整R平方值</a>，因为我们的兴趣在于估计<a class="ae jd" rel="noopener" target="_blank" href="/understanding-partial-effects-main-effects-and-interaction-effects-in-a-regression-model-54e8a127c62d'"><strong class="kx jh"/></a><strong class="kx jh"/>【即系数估计值】，它们的标准误差和95%置信区间，以及系数是否具有统计显著性。让我们放大输出的相关部分:</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nf"><img src="../Images/3df72a945394d5827ddc6c8547bedaf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HjlLBB0bcFWQWHEAMCa22w.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">系数估计值、它们的标准误差、p值和95%置信区间(图片由作者提供)</p></figure><p id="529b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们看到所有的系数估计值在&lt; .001. By default, Statsmodels has assumed homoskedastic errors and accordingly used Eq (6a) reproduced below to calculate the covariance matrix of coefficient estimates which is further used to calculate standard errors, p values and confidence intervals.</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/e4d883497b2e3396ddcabc0f1307fdf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O9rOVLtu9zItRqm4u6uiCg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">The formula for the estimated covariance matrix of the fitted regression coefficients when the model’s errors are <strong class="bd lz">同态分布</strong>和<strong class="bd lz">非自相关</strong>的p处都是显著的(图片由作者提供)</p></figure><p id="190d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们已经看到，如果误差不是齐次的，那么上述公式将产生误导性的结果。因此，我们需要知道模型的误差是同方差的还是异方差的。</p><p id="f7c9" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一个简单的异方差视觉测试包括绘制拟合模型的残差(模型误差的无偏估计)与响应变量的拟合值，如下所示:</p><pre class="ls lt lu lv gt mu mt mv mw aw mx bi"><span id="2f83" class="my mz jg mt b gy na nb l nc nd"><strong class="mt jh"><em class="lw">#Carve out the y and X matrices</em></strong><em class="lw"><br/></em>y_train, X_train = <strong class="mt jh">dmatrices</strong>(reg_expr, df, return_type=<strong class="mt jh">'dataframe'</strong>)</span><span id="a5f5" class="my mz jg mt b gy ne nb l nc nd"><strong class="mt jh"><em class="lw">#Get the predicted values of y from the fitted model</em></strong><em class="lw"><br/></em>y_cap = olsr_model_results.<strong class="mt jh">predict</strong>(X_train)</span><span id="8c82" class="my mz jg mt b gy ne nb l nc nd"><strong class="mt jh"><em class="lw">#Plot the model's residuals against the predicted values of y</em></strong><em class="lw"><br/></em>plt.<strong class="mt jh">xlabel</strong>(<strong class="mt jh">'Predicted value of Percent_Households_Below_Poverty_Level'</strong>)</span><span id="8610" class="my mz jg mt b gy ne nb l nc nd">plt.<strong class="mt jh">ylabel</strong>(<strong class="mt jh">'Residual error'</strong>)</span><span id="46ff" class="my mz jg mt b gy ne nb l nc nd">plt.<strong class="mt jh">scatter</strong>(y_cap, olsr_model_results.resid)</span><span id="bc61" class="my mz jg mt b gy ne nb l nc nd">plt.<strong class="mt jh">show</strong>()</span></pre><p id="44ba" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们得到下面的散点图(画红线只是为了说明异方差):</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ng"><img src="../Images/153bba094386a41a40d2ecf6f606c935.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kwok3IcwpTpTGkEcTb_ZRg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">拟合模型的残差与响应变量的估计值的关系图(图片由作者提供)</p></figure><p id="5709" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">模型的误差明显是异方差的，这应该使我们怀疑statsmodels报告的标准误差、p值和置信区间。</p><p id="0ff7" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">幸运的是，statsmodels允许您在拟合模型时使用几种异方差一致性估计量中的一种。这些被表示为HC0、HC1、HC2、HC3等。</p><p id="bf65" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">第一个，HC0是我们之前看到的White的原始异方差一致性估计量(复制如下):</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mg"><img src="../Images/1b9080c25183025c96cff123fb05d9cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KDSg_C0ND9MDueXizP8ACg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">怀特的异方差一致性估计量(图片由作者提供)</p></figure><p id="a728" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">HC1、HC2、HC3对HC0进行了改进，使其对小规模数据集的偏向性更小。MacKinnon和White在他们1985年的论文中描述了后三种估计量。</p><p id="2444" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将依次尝试这四种方法。在每种情况下，我们将拟合模型并打印出如下培训摘要:</p><pre class="ls lt lu lv gt mu mt mv mw aw mx bi"><span id="c6b9" class="my mz jg mt b gy na nb l nc nd"><strong class="mt jh"><em class="lw">#Ask statsmodels to use the HC estimators</em></strong><em class="lw"><br/></em>olsr_model_results = olsr_model.<strong class="mt jh">fit</strong>(cov_type=<strong class="mt jh">'HC0'</strong>)<br/><strong class="mt jh">print</strong>(olsr_model_results.<strong class="mt jh">summary</strong>())</span><span id="21e6" class="my mz jg mt b gy ne nb l nc nd">olsr_model_results = olsr_model.<strong class="mt jh">fit</strong>(cov_type=<strong class="mt jh">'HC1'</strong>)<br/><strong class="mt jh">print</strong>(olsr_model_results.<strong class="mt jh">summary</strong>())</span><span id="95a9" class="my mz jg mt b gy ne nb l nc nd">olsr_model_results = olsr_model.<strong class="mt jh">fit</strong>(cov_type=<strong class="mt jh">'HC2'</strong>)<br/><strong class="mt jh">print</strong>(olsr_model_results.<strong class="mt jh">summary</strong>())</span><span id="3426" class="my mz jg mt b gy ne nb l nc nd">olsr_model_results = olsr_model.<strong class="mt jh">fit</strong>(cov_type=<strong class="mt jh">'HC3'</strong>)<br/><strong class="mt jh">print</strong>(olsr_model_results.<strong class="mt jh">summary</strong>())</span></pre><p id="0456" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们将所有4次训练的系数估计值叠加起来，并与原始的估计值进行比较:</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nh"><img src="../Images/1300bb3e8efb5cdc8374493aba22b93d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MeftPEd5cD_9msn2_-Q_tg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">使用不同异方差一致性估计后的系数估计、标准误差和置信区间的比较(图片由作者提供)</p></figure><p id="5ee3" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">第一组四行包含标准误差和置信区间，假设均方误差，即使用等式(6a)。下一组行包含使用不同HC估计值的估计值:HC0到HC3。我们看到，即使在使用HC0到HC3之后，所有系数在p &lt; .001. This is good news. However, as expected, the standard errors of the coefficient estimates become larger and the corresponding C.I.s become wider after accounting for heteroskedasticity.</p><p id="a584" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Let’s zoom into a portion of the above figure to see what we mean:</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ni"><img src="../Images/53bab004401b503373c876d1275387fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VU-aVzEzcqXaDBEoJu0Adw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">Comparison of coefficient estimates, standard errors and C.I.s assuming homoskedastic errors and using White’s HC estimator (Image by Author)</p></figure><p id="5e60" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Let’s look at the data for the coefficient estimate of <em class="lw">房主空置率</em>下仍然具有统计显著性。在不考虑异方差误差的情况下，系数估计的标准误差为0.088，但是当我们考虑异方差时，该系数的标准误差几乎翻倍，达到0.158。</p><p id="fd6e" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在不考虑异方差的情况下，<em class="lw">房主_空置率</em>的系数估计的95% C.I.s为<em class="lw">【0.748，1.091】</em>。在考虑异方差后，它们变得更宽:<em class="lw">【0.609，1.230】</em>。</p><p id="ef99" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们还看到，HC1至HC3的使用导致White的HC估算器估算的标准误差向上微移，尽管幅度非常小。例如，HC3估计<em class="lw">房主空置率</em>系数的标准误差为0.163，与HC0报告的估计值0.158相比，仅“提高”了3%。</p><p id="905c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">无论如何，主要的收获如下:</p><blockquote class="nj nk nl"><p id="ed09" class="kv kw lw kx b ky kz kh la lb lc kk ld nm lf lg lh nn lj lk ll no ln lo lp lq ij bi translated">面对异方差，回归模型的系数估计会失去精度。</p></blockquote><p id="5681" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，如果发现模型的误差是异方差的，这是横截面数据集中经常出现的情况，我们应该始终使用异方差一致性估计来对系数估计进行合理的统计推断。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><p id="015f" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面是本文中使用的完整源代码:</p><figure class="ls lt lu lv gt is"><div class="bz fp l di"><div class="np nq l"/></div></figure></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="0907" class="nr mz jg bd ns nt nu nv nw nx ny nz oa km ob kn oc kp od kq oe ks of kt og oh bi translated">参考文献、引文和版权</h1><h2 id="5a9f" class="my mz jg bd ns oi oj dn nw ok ol dp oa le om on oc li oo op oe lm oq or og os bi translated">数据集</h2><p id="438b" class="pw-post-body-paragraph kv kw jg kx b ky ot kh la lb ou kk ld le ov lg lh li ow lk ll lm ox lo lp lq ij bi translated">根据<a class="ae jd" href="https://www.census.gov/data/developers/about/terms-of-service.html" rel="noopener ugc nofollow" target="_blank">使用条款</a>，从<a class="ae jd" href="https://www.census.gov/data/developers.html" rel="noopener ugc nofollow" target="_blank">美国人口普查局</a>提取的美国社区调查数据集。</p><h2 id="ee16" class="my mz jg bd ns oi oj dn nw ok ol dp oa le om on oc li oo op oe lm oq or og os bi translated">报纸</h2><p id="e893" class="pw-post-body-paragraph kv kw jg kx b ky ot kh la lb ou kk ld le ov lg lh li ow lk ll lm ox lo lp lq ij bi translated">怀特，哈尔波特。"异方差一致性协方差矩阵估计和异方差的直接检验."<em class="lw">计量经济学</em>，第48卷第4期，1980年，第817–38页。JSTOR ，<a class="ae jd" href="https://doi.org/10.2307/1912934." rel="noopener ugc nofollow" target="_blank">https://doi.org/10.2307/1912934.</a>2022年9月25日访问。<a class="ae jd" href="http://www-2.rotman.utoronto.ca/~kan/3032/pdf/GeneralizedMethodOfMoments/White_Econometrica_1980.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="kx jh"> PDF下载链接</strong> </a></p><p id="ccbd" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">James G MacKinnon，Halbert White，具有改进的有限样本性质的一些异方差一致性协方差矩阵估计量，<em class="lw">计量经济学杂志，</em>第29卷，第3期，1985年，第305-325页，ISSN 0304-4076，<a class="ae jd" href="https://doi.org/10.1016/0304-4076(85)90158-7." rel="noopener ugc nofollow" target="_blank">https://doi . org/10.1016/0304-4076(85)90158-7。</a>(<a class="ae jd" href="https://www.sciencedirect.com/science/article/pii/0304407685901587" rel="noopener ugc nofollow" target="_blank">https://www . science direct . com/science/article/pii/0304407685901587</a>)<a class="ae jd" href="https://www.econstor.eu/bitstream/10419/189084/1/qed_wp_0537.pdf" rel="noopener ugc nofollow" target="_blank"><strong class="kx jh">PDF下载链接</strong> </a></p><h2 id="1dcb" class="my mz jg bd ns oi oj dn nw ok ol dp oa le om on oc li oo op oe lm oq or og os bi translated">形象</h2><p id="3294" class="pw-post-body-paragraph kv kw jg kx b ky ot kh la lb ou kk ld le ov lg lh li ow lk ll lm ox lo lp lq ij bi translated">本文中的所有图片版权归<a class="ae jd" href="https://www.linkedin.com/in/sachindate/" rel="noopener ugc nofollow" target="_blank"> Sachin Date </a>所有，版权归<a class="ae jd" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener ugc nofollow" target="_blank"> CC-BY-NC-SA </a>所有，除非图片下方提到了不同的来源和版权。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><p id="8dc7" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="lw">如果你喜欢这篇文章，请关注我的</em><a class="ae jd" href="https://timeseriesreasoning.medium.com" rel="noopener"><strong class="kx jh"><em class="lw">Sachin Date</em></strong></a><em class="lw">获取关于回归、时间序列分析和预测主题的提示、操作方法和编程建议。</em></p></div></div>    
</body>
</html>