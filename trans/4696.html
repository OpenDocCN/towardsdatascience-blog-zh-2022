<html>
<head>
<title>Hands-on Guide to Create beautiful Sankey Charts in d3js with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python在d3js中创建漂亮的Sankey图表的实践指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/hands-on-guide-to-create-beautiful-sankey-charts-in-d3js-with-python-8ddab43edb43#2022-10-19">https://towardsdatascience.com/hands-on-guide-to-create-beautiful-sankey-charts-in-d3js-with-python-8ddab43edb43#2022-10-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cfcb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">桑基图表是一个很好的方法，通过观察单个项目如何在各州之间流动，就可以发现最突出的贡献。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ee167388ed83a93a2551340a63497b57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZYUl6vyNgwraVhBNjf-Dig.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">桑基图表示例。(图片由作者提供)</p></figure><p id="8a2c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您需要了解系统中的流程，以揭示流程中潜在的低效状态，Sankey图非常有用。输入数据类似于带有源/目标和权重的网络图，但可以揭示对最突出贡献的新见解。它可以用于许多用例，如改善营销、成本分析、能源流动等方面的客户旅程。<em class="lu"> Sankey </em>图表是<a class="ae lv" rel="noopener" target="_blank" href="/d3blocks-the-python-library-to-create-interactive-and-standalone-d3js-charts-3dda98ce97d4">T5】D3 blocks库T7】的一部分，可以使用Python创建。输出完全封装在一个HTML文件中，您只需要一个互联网浏览器来显示图形。分享和发布因此变得超级简单。<strong class="la iu"> <em class="lu">在这篇博客中，我将介绍桑基图表，并用实际例子演示如何使用它。</em>T11】</strong></a></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="dc48" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="lu">如果你觉得这篇文章很有帮助，可以使用我的</em> <a class="ae lv" href="https://medium.com/@erdogant/membership" rel="noopener"> <em class="lu">推荐链接</em> </a> <em class="lu">继续无限制学习，并注册成为中级会员。另外，</em> <a class="ae lv" href="http://erdogant.medium.com" rel="noopener"> <em class="lu">关注我</em> </a> <em class="lu">关注我的最新内容！</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="cd70" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">桑基图表是D3Blocks的一部分。</h1><p id="e2ce" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated"><a class="ae lv" rel="noopener" target="_blank" href="/d3blocks-the-python-library-to-create-interactive-and-standalone-d3js-charts-3dda98ce97d4"> <em class="lu"> D3Blocks </em> </a> <em class="lu"> </em>是一个包含各种图表的库，可视化部分构建在(d3) javascript上，但可使用Python进行配置。通过这种方式，<em class="lu"> D3Blocks库</em>将d3-javascript的优势(如速度、可伸缩性、灵活性和无限创造力)与Python结合在一起，以便快速轻松地访问广泛的社区，如数据科学领域。特别是对于这个领域，关键是它应该能够轻松地扩展到非常大的数据集。D3Blocks中的每个图表，如Sankey图表，都完全封装在一个HTML文件中，这使得在网站上共享或发布非常容易。此外，除了浏览器之外，它不需要任何其他技术来发布或共享图表。关于<a class="ae lv" rel="noopener" target="_blank" href="/d3blocks-the-python-library-to-create-interactive-and-standalone-d3js-charts-3dda98ce97d4"><em class="lu">D3 blocks</em></a><em class="lu"/>库的更多信息可以在本博客<a class="ae lv" rel="noopener" target="_blank" href="/d3blocks-the-python-library-to-create-interactive-and-standalone-d3js-charts-3dda98ce97d4"> 1 </a>中找到。</p><h1 id="f58d" class="md me it bd mf mg na mi mj mk nb mm mn jz nc ka mp kc nd kd mr kf ne kg mt mu bi translated">桑基图表。</h1><p id="028a" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">可以用Python创建<em class="lu"> Sankey </em>图表，而不用担心任何d3 javascript模块。导入D3Blocks库后，您可以设置用户定义的参数，并基于您的输入数据集创建图表。<strong class="la iu"> <em class="lu">在后台，Sankey模块将为数据集中的状态和流创建颜色、位置、排序和标签。</em> </strong>它还将包含用户自定义的参数，连接所有d3部分，然后最终将其转换成一个单独的HTML文件存储在磁盘上。</p><h2 id="f8f7" class="nf me it bd mf ng nh dn mj ni nj dp mn lh nk nl mp ll nm nn mr lp no np mt nq bi translated">使用桑基图表的理由。</h2><p id="f715" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">当一个动作跟随另一个动作跨越时间或状态时，桑基图是有洞察力的。它有助于揭示流程中潜在的低效状态，例如发现流程中的瓶颈。尽管使用<em class="lu">源-目标-权重</em>的输入类似于网络分析的输入，但是当需要分析流量时，使用网络分析可能很难解释。桑基图中的每个流的高度可能不同，这取决于其数量，因此确定最突出或最有问题的状态变得更简单。这样的细分使得从数据中得出结论变得容易。</p><h2 id="ed8d" class="nf me it bd mf ng nh dn mj ni nj dp mn lh nk nl mp ll nm nn mr lp no np mt nq bi translated">安装。</h2><p id="0205" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">在我们浏览Sankey的功能之前，我们首先需要安装<a class="ae lv" rel="noopener" target="_blank" href="/d3blocks-the-python-library-to-create-interactive-and-standalone-d3js-charts-3dda98ce97d4"> <em class="lu"> D3Blocks库</em> </a>:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="7a01" class="nf me it ns b gy nw nx l ny nz">pip install d3blocks</span></pre><h2 id="dadd" class="nf me it bd mf ng nh dn mj ni nj dp mn lh nk nl mp ll nm nn mr lp no np mt nq bi translated">输入数据框。</h2><p id="833d" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">输入数据是一个包含以下三列的<em class="lu">数据帧</em>:</p><ul class=""><li id="74ce" class="oa ob it la b lb lc le lf lh oc ll od lp oe lt of og oh oi bi translated"><strong class="la iu"> <em class="lu">源</em> </strong>:描述源状态。</li><li id="996e" class="oa ob it la b lb oj le ok lh ol ll om lp on lt of og oh oi bi translated"><strong class="la iu"> <em class="lu">目标</em> </strong>:描述目标状态<em class="lu">。</em></li><li id="56db" class="oa ob it la b lb oj le ok lh ol ll om lp on lt of og oh oi bi translated"><strong class="la iu"> <em class="lu">权重</em> </strong> <em class="lu"> : </em>描述了<em class="lu">源</em>和<em class="lu">目标状态</em>之间流的相对重要性。</li></ul><p id="0ea7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们从<a class="ae lv" href="https://observablehq.com/@d3/sankey" rel="noopener ugc nofollow" target="_blank"> <em class="lu">能量数据集</em></a><em class="lu">【2】</em>加载一个输入数据帧的例子。在这个例子中，有68行3列。<strong class="la iu"> <em class="lu">权重的解释</em> </strong>可以看作<em class="lu">源-目标关系的强度，从而使得流量的宽度</em>。</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="6a1e" class="nf me it ns b gy nw nx l ny nz">print(df)</span><span id="d17d" class="nf me it ns b gy oo nx l ny nz">       source                   target            weight<br/>0      Agricultural 'waste'     Bio-conversion    124.729<br/>1      Bio-conversion           Liquid            0.597<br/>2      Bio-conversion           Losses            26.862<br/>3      Bio-conversion           Solid             280.322<br/>4      Bio-conversion           Gas               81.144<br/>..                ...           ...               ...<br/>63     Thermal generation       District heating  79.329<br/>64     Tidal                    Electricity grid  9.452<br/>65     UK land based bioenergy  Bio-conversion    182.010<br/>66     Wave                     Electricity grid  19.013<br/>67     Wind                     Electricity grid  289.366</span><span id="5ab1" class="nf me it ns b gy oo nx l ny nz">[68 rows x 3 columns]</span></pre><h2 id="5ab9" class="nf me it bd mf ng nh dn mj ni nj dp mn lh nk nl mp ll nm nn mr lp no np mt nq bi translated">输入参数。</h2><p id="4932" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">Sankey块包含代码部分1中描述的各种输入参数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码部分1。桑基图表的输入参数</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="b1a3" class="nf me it bd mf ng nh dn mj ni nj dp mn lh nk nl mp ll nm nn mr lp no np mt nq bi translated">输出文件。</h2><p id="aef2" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">输出是一个HTML文件，存储在磁盘上的指定路径。HTML包含一个可以共享和发布的全功能图表。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="99f6" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">示例:将数据转换为Sankey图表。</h1><p id="cde4" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">让我们从一个小例子开始，演示如何将输入数据转换成图表。在下面的代码段中创建一个数据帧，它有5个关系，每个关系都有<em class="lu"> weight=1 </em>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码部分2:一个小输入数据集如何转化为Sankey图的示例。</p></figure><p id="dcae" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">图1A中的图表显示了<em class="lu">源</em>和<em class="lu">目标</em>状态之间的五个预期流量，所有状态的<em class="lu">权重=1 </em>。这表明所有状态的长度相等。然而，状态<strong class="la iu"> <em class="lu"> A </em> </strong> ( <em class="lu">蓝色</em>)和<em class="lu"> E </em>  ( <em class="lu">黄色</em>)的垂直长度是其他状态的两倍。这是因为在数据帧中，状态<strong class="la iu"> <em class="lu"> A </em> </strong>被列为源状态两次(<em class="lu"> A &gt; F和A &gt; C </em>，状态<strong class="la iu">ET27】被列为目标状态两次(<em class="lu"> B &gt; E和D &gt; E </em>)。让我们改变状态<strong class="la iu"> <em class="lu"> B </em> </strong>的权重，看看会发生什么。如果我们为状态<strong class="la iu"> <em class="lu"> B </em> </strong> <em class="lu">【橙色】</em>设置<em class="lu"> weight=2 </em>，则流的强度加倍(<em class="lu">从1到2 </em>)，状态<strong class="la iu"> <em class="lu"> B </em> </strong>的长度变成之前的两倍垂直长度(如图1B，橙色状态)。此外，状态<strong class="la iu"> <em class="lu"> E </em> </strong>的垂直长度也增加，因为状态<em class="lu"> B &gt; E </em>之间的流动强度增加。或者换句话说:<strong class="la iu"> <em class="lu">一个状态的垂直长度就是特定源/目标状态被看到的次数，加上权重。</em> </strong> <em class="lu">注意，状态计数和权重是归一化的，并且彼此相关。</em>我将加载下一节中设置的<em class="lu">能量数据</em>来创建桑基图表。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/8d3fc8f96f99954091add8807919c99c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vZygd6fO85f7t7xstb4rGw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图Sankey图表是使用代码部分1创建的，具有5种状态之间的流程。画面A:所有权重都设置为1。画面B:状态B-&gt;E之间的权重设置为2。(图片由作者提供)</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="00d5" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">例如:能源数据集。</h1><p id="8618" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">这里，我们将使用<em class="lu">能源数据集</em>创建桑基图表。如前所述，数据集包含68个源-目标行。当我们运行代码部分1时，会创建下面的图表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/7b5f9a747467e6c550c6b71b227b6415.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*U8ZiQR2W4qw5iE6Kbrychg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2:能源数据集的桑基图。(图片由作者提供)</p></figure><p id="901d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">整个数据之间的流动是用所有状态组织的，现在可以揭示最突出的贡献或瓶颈的新见解。一些州可能值得进一步调查，因为每个州的总贡献变得异常。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="001f" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">最后的话。</h1><p id="d983" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">总之，我演示了如何使用Python和d3js功能创建自己的Sankey图表。该图表的开发方式可以处理各种数据集，并允许以交互方式更改颜色、排序和状态定位。桑基图表是<a class="ae lv" rel="noopener" target="_blank" href="/d3blocks-the-python-library-to-create-interactive-and-standalone-d3js-charts-3dda98ce97d4"> <em class="lu"> D3Blocks </em> </a>中的一个模块，d3-javascript在其中形成基础。使用d3-javascript有很多优点，比如速度和灵活性，除了浏览器之外，你不需要任何其他技术来绘制图表。<em class="lu">随意摆弄图书馆吧！</em></p><p id="3ed7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意安全。保持冷静。</p><p id="a3e1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> <em class="lu">欢呼，E. </em> </strong></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="30ca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="lu">如果你觉得这篇文章很有帮助，可以使用我的</em> <a class="ae lv" href="https://medium.com/@erdogant/membership" rel="noopener"> <em class="lu">推荐链接</em> </a> <em class="lu">继续无限制学习，并注册成为中级会员。另外，</em> <a class="ae lv" href="http://erdogant.medium.com" rel="noopener"> <em class="lu">关注我</em> </a> <em class="lu">关注我的最新内容！</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="ce93" class="nf me it bd mf ng nh dn mj ni nj dp mn lh nk nl mp ll nm nn mr lp no np mt nq bi translated">软件</h2><ul class=""><li id="0c5c" class="oa ob it la b lb mv le mw lh ot ll ou lp ov lt of og oh oi bi translated"><a class="ae lv" href="https://github.com/d3blocks/d3blocks" rel="noopener ugc nofollow" target="_blank"> D3Blocks Github </a></li><li id="a8b0" class="oa ob it la b lb oj le ok lh ol ll om lp on lt of og oh oi bi translated"><a class="ae lv" href="https://d3blocks.github.io/d3blocks/" rel="noopener ugc nofollow" target="_blank"> D3Blocks文档页面</a></li></ul><h2 id="f75b" class="nf me it bd mf ng nh dn mj ni nj dp mn lh nk nl mp ll nm nn mr lp no np mt nq bi translated">我们连线吧！</h2><ul class=""><li id="ff1c" class="oa ob it la b lb mv le mw lh ot ll ou lp ov lt of og oh oi bi translated"><a class="ae lv" href="https://www.linkedin.com/in/erdogant/" rel="noopener ugc nofollow" target="_blank">我们在LinkedIn上连线</a></li><li id="73b8" class="oa ob it la b lb oj le ok lh ol ll om lp on lt of og oh oi bi translated"><a class="ae lv" href="https://github.com/erdogant" rel="noopener ugc nofollow" target="_blank">在Github上关注我</a></li><li id="f7b4" class="oa ob it la b lb oj le ok lh ol ll om lp on lt of og oh oi bi translated"><a class="ae lv" href="https://erdogant.medium.com/" rel="noopener">在Medium上跟随我</a></li></ul><h2 id="1b37" class="nf me it bd mf ng nh dn mj ni nj dp mn lh nk nl mp ll nm nn mr lp no np mt nq bi translated">参考</h2><ol class=""><li id="3e83" class="oa ob it la b lb mv le mw lh ot ll ou lp ov lt ow og oh oi bi translated"><em class="lu"> Taskesen，E，</em><a class="ae lv" rel="noopener" target="_blank" href="/d3blocks-the-python-library-to-create-interactive-and-standalone-d3js-charts-3dda98ce97d4"><em class="lu">D3 blocks:Python库，用于创建交互式和独立的D3js图表。</em> </a>中等，2022年9月</li><li id="0ec6" class="oa ob it la b lb oj le ok lh ol ll om lp on lt ow og oh oi bi translated">【observablehq.com】，<a class="ae lv" href="https://observablehq.com/@d3/sankey" rel="noopener ugc nofollow" target="_blank"> <em class="lu">能源数据集</em> </a>，2019 (ISC许可)</li></ol></div></div>    
</body>
</html>