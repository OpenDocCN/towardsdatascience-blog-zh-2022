<html>
<head>
<title>Is your dataset imbalanced?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你的数据集不平衡吗？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/is-your-dataset-imbalanced-292d2a0a1321#2022-06-26">https://towardsdatascience.com/is-your-dataset-imbalanced-292d2a0a1321#2022-06-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4df3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">查看数据集是否不平衡的一些技巧</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/60430022de9234ac4af49b8876fde16b.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/0*lILW1qi8mp9pXen3.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="5181" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于数据科学家来说，处理不平衡的数据集总是很困难。如果我们处理不当，这样的数据集可能会给我们的机器学习模型带来麻烦。因此，在采取适当的预防措施之前，测量数据集的不平衡程度非常重要。在这篇文章中，我建议一些可能的技术。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="2048" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">我们如何定义“不平衡”？</h1><p id="dd72" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">当一些目标类的频率比其他目标类低时，我们说分类数据集是不平衡的。</p><p id="fe48" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">例如，让我们看看iris数据集的目标变量的分布。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/a6cf9f90da517c681477ffe7bcdb0d7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/0*yfSNgsmiS3vGaKvC.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="32f2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如我们所见，频率都是相同的，数据集完全平衡。</p><p id="c881" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在让我们更改数据集，使用乳腺癌数据集。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/b7b691f6ec4dfea3f74b5aa86d5de315.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/0*PJSTll2GxeXlosA5.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="4db8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如我们所看到的，这两个类有不同的频率，所以数据集是不平衡的。</p><p id="f8fe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以，一般来说，不同的频率让我们可以说数据集是不平衡的。然而，通常的经验导致定义为“不平衡”的数据集，其中目标值具有非常不同的频率。</p><p id="c6bd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">事实上，一般来说，稍微不同的频率对大多数模型来说并不是一个大问题。当一个或多个类别的频率非常低时，问题就出现了。在这些情况下，模型可能无法正确地学习如何处理它们。</p><p id="37d1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">像往常一样，我们必须量化“非常小”是什么意思。让我们看一些技术来评估我们是否应该考虑一个不平衡的数据集。</p><h1 id="a2e5" class="lx ly it bd lz ma mw mc md me mx mg mh jz my ka mj kc mz kd ml kf na kg mn mo bi translated">数据可视化</h1><p id="7bdf" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">数据可视化可以给我们一些非常有用的见解，那么我们为什么不应该将它用于这项任务呢？</p><p id="c120" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我建议的方法是用类的频率和它们的95%置信区间绘制一个条形图。记住，给定一个频率<em class="nb"> p </em>，事件总数等于<em class="nb"> N </em>，95%置信区间计算如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/d38e5a9e7074b5d89036e7ca67e3f545.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*OOICJZ3nkc-374ETd2bkpg.png"/></div></figure><p id="ced2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">给定<em class="nb"> m </em>类，期望频率为<em class="nb"> 1/m </em>。因此，我们可以绘制置信区间和与预期频率相关的水平线，并查看它是否穿过置信区间。</p><p id="3ed2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们先导入一些库和“乳腺癌”数据集。</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="b6b6" class="ni ly it ne b gy nj nk l nl nm">import numpy as np <br/>import pandas as pd <br/>from scipy.stats import norm,chisquare <br/>import matplotlib.pyplot as plt<br/>from sklearn.datasets import load_breast_cancer as d </span><span id="3a1a" class="ni ly it ne b gy nn nk l nl nm">X,y = d(return_X_y = True)</span></pre><p id="53d1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，让我们用类的频率、95%置信区间和预期频率绘制条形图。</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="09c0" class="ni ly it ne b gy nj nk l nl nm">freqs =pd.Series(y).value_counts() /len(y) </span><span id="b7bd" class="ni ly it ne b gy nn nk l nl nm">std_errors = np.sqrt(freqs*(1-freqs)/len(y)) </span><span id="b935" class="ni ly it ne b gy nn nk l nl nm">expected_frequency = 1/len(np.unique(y)) freqs.plot(kind='bar',yerr=std_errors*1.96) <br/>plt.axhline(expected_frequency,color='red',linestyle='--')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/f76ee1da157436e026df82a255455f40.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/0*xz2fKWi9wnCeoZ-c.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="5657" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如我们所看到的，间隔距离预期的频率很远，所以数据集平衡的置信度只有5%。相当小。</p><p id="37c5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我们对“葡萄酒”数据集重复这个过程，结果如下。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/37074553bee91f8e9bda8e1acf48d60c.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/0*5h5xkJWN8HevYLY6.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="9ac7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，对于类别0，期望的频率线正确地穿过置信区间，但是对于类别1和2，期望的频率线仅仅略微穿过置信区间。所以我们可以说，在95%的置信度下，类0是平衡的，而我们不确定类1和类2。</p><p id="1c91" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这种简单的方法可以给我们清晰的图形证据，这在数据科学中总是一个好主意。</p><h1 id="c4b2" class="lx ly it bd lz ma mw mc md me mx mg mh jz my ka mj kc mz kd ml kf na kg mn mo bi translated">z检验</h1><p id="80e2" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">对于那些喜欢使用p值的人，我们可以计算t尾z检验的p值，以评估给定频率和预期频率之间的统计差异。我们必须对每门课进行z测试。零假设是频率等于预期频率(即数据集是平衡的)。</p><p id="6480" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在等于<em class="nb"> N </em>的多个事件上，将给定频率与预期频率<em class="nb"> 1/m </em>进行比较的z变量为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/bf8715814fade865d864ed543f505641.png" data-original-src="https://miro.medium.com/v2/resize:fit:410/format:webp/1*wskqRSeq06QR1Th1e3TZ5g.png"/></div></figure><p id="0368" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于双尾z检验，p值为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/5f0c459bc5a5aea7353b409436d666be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*Yivoa0FO3G1roEGCxQjkLg.png"/></div></figure><p id="6a4c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们乘以2，因为这是一个双尾测试。</p><p id="44b4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Python中，我们可以写:</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="3a73" class="ni ly it ne b gy nj nk l nl nm">for target_val in freqs.index: <br/>   z = (freqs[target_val] - expected_frequency)/ std_errors[target_val] </span><span id="8715" class="ni ly it ne b gy nn nk l nl nm">   print("Class:",target_val) print("p-value:",norm.cdf(-np.abs(z)))      <br/>   print("----")</span></pre><p id="4b4d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于乳腺癌数据集，结果是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/3a52f95a620a4ec37393ea93f0214c70.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/0*eIbiZBMVDfdrCiWk.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="cc11" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">p值非常小，因此我们拒绝表示数据集平衡的零假设。</p><p id="bad3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于葡萄酒数据集，我们得到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/7fc80aabe7725cf87fdee79ce5b8a6dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/0*wLOui27cGGLNABYD.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="4b89" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些结果完全符合图形分析。类别1和类别2的p值较小，我们拒绝零假设。类0的p值很高，我们不拒绝零假设。</p><h1 id="2101" class="lx ly it bd lz ma mw mc md me mx mg mh jz my ka mj kc mz kd ml kf na kg mn mo bi translated">卡方检验</h1><p id="5294" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">如果我们想对整个数据集使用单个测试，而不是对每个类使用一个测试，我们可以使用Pearson的卡方检验。</p><p id="7b74" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我们有<em class="nb"> m </em>个类和<em class="nb"> N </em>个总记录以及每个类作为记录，我们可以通过计算统计量来计算这样一个测试的p值:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/944c4a415805f8731bdaed1c44a9d000.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/1*6MVOXdXlxU9cCekmmZqbXQ.png"/></div></figure><p id="0fc7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该变量分布为具有<em class="nb"> m-1 </em>自由度的卡方分布。我们可以进行的测试是单尾测试。无效假设是数据集是平衡的。</p><p id="ef85" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Python中，我们只用一行代码就可以做到:</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="74fd" class="ni ly it ne b gy nj nk l nl nm">chisquare(pd.Series(y).value_counts()).pvalue</span></pre><p id="a349" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于乳腺癌数据集，结果是1.211e-09。所以我们拒绝零假设。对于葡萄酒数据集，p值为0.107，因此我们不拒绝零假设。</p><p id="4225" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请记住，卡方检验只有在您的预期出现次数很大(即大于20)时才有效，否则其背后的近似值将不再可靠。</p><h1 id="23da" class="lx ly it bd lz ma mw mc md me mx mg mh jz my ka mj kc mz kd ml kf na kg mn mo bi translated">一些实用的建议</h1><p id="c4ed" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">我的建议是始终使用数据可视化。这很清楚，没有偏见，所以它总是一个好主意。但是，如果您的同事需要一个p值，您可以使用z检验来逐类评估p值。否则，您可以使用卡方检验计算总体结果。</p><h1 id="1d1f" class="lx ly it bd lz ma mw mc md me mx mg mh jz my ka mj kc mz kd ml kf na kg mn mo bi translated">结论</h1><p id="e9a9" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">在这篇文章中，我提出了一些评估数据集是否不平衡的技术。选择适当的技术将为您提供不同的见解，并引导您采取不同的策略来处理不平衡的数据(例如，SMOTE重采样或类分组)。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="d97d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nb">原载于2022年6月26日https://www.yourdatateacher.com</em><a class="ae nt" href="https://www.yourdatateacher.com/2022/06/27/is-your-dataset-imbalanced/" rel="noopener ugc nofollow" target="_blank"><em class="nb"/></a><em class="nb">。</em></p></div></div>    
</body>
</html>