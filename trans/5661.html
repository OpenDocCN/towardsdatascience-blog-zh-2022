<html>
<head>
<title>ChatGPT and DALL·E 2 in a Panel App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面板应用中的 ChatGPT 和 DALL E 2</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/chatgpt-and-dall-e-2-in-a-panel-app-1c921d7d9021#2022-12-22">https://towardsdatascience.com/chatgpt-and-dall-e-2-in-a-panel-app-1c921d7d9021#2022-12-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9d75" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们用 Python 编写一个聊天机器人吧！</h2></div><p id="45a8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你有兴趣建立一个使用最新人工智能模型的聊天机器人吗？使用 Panel 只需几行代码，我们就可以轻松构建一个包含 ChatGPT 和 DALL E 2 的聊天机器人。ChatGPT 和 DALL E 2 由 OpenAI 开发，根据文本提示从头开始生成文本和图像。在这篇博文中，我们将探索 OpenAI API，并了解如何在一个 Python 面板应用程序中使用 ChatGPT 和 DALL E 2 的创造力。想象一下，一个聊天机器人不仅可以回答问题和制作故事，还可以通过视觉艺术帮助你设想你的故事，那岂不是很酷？</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/5250d8b1051fbbaa50c1148cf641aa4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*I-tsNqjhAH10nxoMCV6_2g.gif"/></div></div></figure><h1 id="3cb4" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">OpenAI API</h1><p id="cf71" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated">要使用 OpenAI API，我们首先需要在 openai.com 上创建一个帐户，并创建一个 API 密钥。记得复制密钥并保存在某个地方以备后用。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mn"><img src="../Images/fbc89f9b2f15b4fcbff41f1b6b31eaef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TwNCqEttm3W0TOI5"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">在 openai.com 创建一个新的 API 键</p></figure><p id="4928" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们可以通过 pip: <code class="fe ms mt mu mv b">pip install openai</code>安装 OpenAI API 的 Python 绑定。</p><p id="5fec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们就可以开始用 Python 编码了！你可以在 Jupyter Notebook 或者 VSCode 或者其他你喜欢的编辑器中编码。</p><p id="b39f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在导入所需的包并定义 API 键之后，我们可以运行<code class="fe ms mt mu mv b">openai.Model.list()</code>来列出 OpenAI 上所有可用的模型。他们有 66 个人！你可以在 beta.openai.com/docs/models.上阅读主要车型的描述</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mn"><img src="../Images/78b49e5180c36e86c626758adf3fd795.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mWUmAa3_2L8omSyp"/></div></div></figure><p id="19a7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些 OpenAI 模型分为五类:文本完成、代码完成、图像生成、微调和嵌入。为了探索 ChatGPT 和 DALL E 2，我们将使用文本完成和图像生成 API 以及<code class="fe ms mt mu mv b">openai.Completion</code>和<code class="fe ms mt mu mv b">openai.Image</code>。</p><p id="5513" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将这两个 API 请求方法封装到两个函数中，在这两个函数中，我们给出一个提示并接收一个文本和图像 URL。这两个函数中有很多参数可以使用。例如，<code class="fe ms mt mu mv b">openai.Completion</code>让你从一组 GPT-3 模型中选择，这里我选择了<em class="mw"> text-davinci-003 </em>，OpenAI 发布的最有能力的 GPT-3 模型。它还允许您定义完成时生成的最大令牌数和温度，这是模型将承担的风险，0 表示定义良好的答案，1 表示更有创意的答案。同样，<code class="fe ms mt mu mv b">openai.Image</code>允许您定义返回的图像数量和图像大小，您可以从“256x256”、“512x512”和“1024x1024”中选择。</p><pre class="lf lg lh li gt mx mv my bn mz na bi"><span id="ef74" class="nb lr it mv b be nc nd l ne nf">def openai_completion(prompt):<br/>    response = openai.Completion.create(<br/>      model="text-davinci-003",<br/>      prompt=prompt,<br/>      max_tokens=150,<br/>      temperature=0.5<br/>    )<br/>    return response['choices'][0]['text']<br/><br/>def openai_image(prompt):<br/>    response = openai.Image.create(<br/>      prompt=prompt,<br/>      n=1,<br/>      size="512x512"<br/>    )<br/>    image_url = response['data'][0]['url']<br/>    return image_url<br/><br/></span></pre><p id="b264" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们试着给他们提示，看看会发生什么。openai_completion 函数能够正确地告诉我奥斯汀的当前温度，openai_image 函数返回“独角兽在云上徒步旅行”的图像。成功！</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mn"><img src="../Images/8f7620f68beb1e6f07c93afcd9d3c275.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3RQ7vUb1Ef9vrtEM"/></div></div></figure><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ng"><img src="../Images/03b3af5b53691c9d6eacc35bef607d6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8bG4koV525MdgCT8"/></div></div></figure><h1 id="0006" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">面板仪表板</h1><p id="4e9a" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated">现在我们已经学习了 OpenAI 文本完成 API 和图像生成 API，我们可以在 Python 面板仪表板中将它们结合在一起吗？</p><p id="93d8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">什么是面板？Panel 是开源 HoloViz 生态系统中的仪表板库，提供高级工具来简化 Python 中的可视化，由 Philipp Rudiger、Jim Bednar 和一个贡献者社区开发。查看 panel.holoviz.org<a class="ae nh" href="http://panel.holoviz.org/" rel="noopener ugc nofollow" target="_blank">了解更多信息。</a></p><p id="c3e2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了构建一个面板仪表板，让我们首先导入<code class="fe ms mt mu mv b">panel</code>和相关的模块:</p><pre class="lf lg lh li gt mx mv my bn mz na bi"><span id="74a6" class="nb lr it mv b be nc nd l ne nf">import panel as pn<br/>pn.extension(loading_spinner='dots', loading_color='#00aa41')</span></pre><p id="4ac3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后让我们制作三个小部件。<code class="fe ms mt mu mv b">inp</code>是我们输入文本提示与聊天机器人聊天的地方，<code class="fe ms mt mu mv b">button_conversation</code>是“聊天！”按钮，它将向 OpenAI 文本完成 API 发送提示，而<code class="fe ms mt mu mv b">button_image</code>是“图像！”将提示发送到 OpenAI 图像生成 API 的按钮。</p><pre class="lf lg lh li gt mx mv my bn mz na bi"><span id="93a9" class="nb lr it mv b be nc nd l ne nf">inp = pn.widgets.TextInput(value="", placeholder='Enter text here…')<br/>button_conversation = pn.widgets.Button(name="Chat!")<br/>button_image = pn.widgets.Button(name="Image!")</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mn"><img src="../Images/2a3dfc56177bd2bd3c9e69291c4b1db8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xdpLmAfeasnGze5b"/></div></div></figure><p id="743e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe ms mt mu mv b">get_conversations</code>函数在一个面板对象中返回我们与聊天机器人的所有对话。这里有几点需要注意:</p><ul class=""><li id="1656" class="ni nj it kk b kl km ko kp kr nk kv nl kz nm ld nn no np nq bi translated"><code class="fe ms mt mu mv b">convos_text</code>将所有对话存储在列表中。当我们给 OpenAI 文本完成一个提示时，我们包括了历史中的所有聊天。</li><li id="4350" class="ni nj it kk b kl nr ko ns kr nt kv nu kz nv ld nn no np nq bi translated">面板支持降价。我将所有的提示和 OpenAI 的响应添加到 Markdown 格式中。</li><li id="e47d" class="ni nj it kk b kl nr ko ns kr nt kv nu kz nv ld nn no np nq bi translated">每当有新的聊天时，就会创建一个新的面板对象来反映这个新的聊天，并将其添加到<code class="fe ms mt mu mv b">convos</code>列表中。</li></ul><p id="a4e2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe ms mt mu mv b">get_image</code>函数要简单得多，我们只需在一个面板对象中显示来自图像 URL 的图像。面板仪表板中显示的所有内容都必须是面板对象。</p><pre class="lf lg lh li gt mx mv my bn mz na bi"><span id="6464" class="nb lr it mv b be nc nd l ne nf">convos_text = [] # store all texts in a list<br/>convos = [] # store all panel objects in a list<br/><br/>def get_conversations(_):<br/>    prompt = inp.value<br/>    inp.value = ''<br/>    if prompt != "":<br/>        convos_text.append(prompt)<br/>        openai_answer = openai_completion('\n'.join(convos_text)) # prompt includes all history<br/>        convos_text.append(openai_answer)<br/>        convos.append(<br/>            pn.Row('\U0001F60A', pn.pane.Markdown(prompt, width=600))<br/>        )<br/>        convos.append(<br/>            pn.Row('\U0001F916', pn.pane.Markdown(openai_answer, width=600, style={'background-color': '#F6F6F6'}))<br/>        )<br/>    if len(convos_text) == 0:<br/>        convos.append(pn.Row('\U0001F916', pn.pane.Markdown("Give me something!", width=600, style={'background-color': '#F6F6F6'})))<br/><br/>    return pn.Column(*convos)<br/><br/><br/>def get_image(_):<br/>    if len(convos_text)&gt;0:<br/>        image_prompt = convos_text[-1]<br/>        image_url = openai_image(image_prompt)<br/>        return pn.pane.PNG(image_url, width=600)</span></pre><p id="f0a2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后最后一步是将<code class="fe ms mt mu mv b">get_conversations</code>函数与<code class="fe ms mt mu mv b">button_conversation</code>按钮绑定，将<code class="fe ms mt mu mv b">get_image</code>函数与<code class="fe ms mt mu mv b">button_image</code>按钮绑定，也就是说只有当我们点击按钮时，函数才会执行。然后，我们将所有面板部件和交互组件组织在一个仪表板中。</p><pre class="lf lg lh li gt mx mv my bn mz na bi"><span id="7a49" class="nb lr it mv b be nc nd l ne nf">interactive_conversation = pn.bind(get_conversations, button_conversation)<br/>interactive_image = pn.bind(get_image, button_image)<br/><br/>dashboard = pn.Column(<br/>    inp,<br/>    pn.Row(button_conversation,button_image),<br/>       pn.panel(interactive_conversation, loading_indicator=True, height=500),<br/>    pn.panel(interactive_image, loading_indicator=True, height=500),<br/>    <br/>)<br/><br/>dashboard.servable()</span></pre><h1 id="1fca" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">完全码</h1><p id="22a9" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated">您可以在我的 GitHub repo 中找到完整的代码:</p><p id="e555" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae nh" href="https://github.com/sophiamyang/panel_openai/" rel="noopener ugc nofollow" target="_blank">https://github.com/sophiamyang/panel_openai/</a></p><p id="f26e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请随意尝试一下。运行<code class="fe ms mt mu mv b">panel serve panel_openai.py</code>或<code class="fe ms mt mu mv b">panel serve panel_openai.ipynb</code>查看文章开头所示的交互式仪表盘！</p><p id="5792" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">同样，在这个应用程序中，你可以输入提示，点击“聊天！”开始与聊天机器人聊天，点击“图片！”根据最近的对话生成图像。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nw"><img src="../Images/d6cfab4b1ca3bcadddfd6e2eae09efbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1Y4i6mfKpZoVEs8H"/></div></div></figure><h1 id="132e" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">在哪里可以了解更多关于 Panel 的信息？</h1><ul class=""><li id="1164" class="ni nj it kk b kl mi ko mj kr nx kv ny kz nz ld nn no np nq bi translated">查看我之前的博客文章<a class="ae nh" rel="noopener" target="_blank" href="/3-ways-to-build-a-panel-visualization-dashboard-6e14148f529d?sk=2cd93ae39586305bae8cfaead2bf7bb4"> 3 种构建面板可视化仪表板的方法</a>。</li><li id="e65f" class="ni nj it kk b kl nr ko ns kr nt kv nu kz nv ld nn no np nq bi translated">查看官方文件:holoviz.org、panel.holoviz.org 和 hvplot.holoviz.org。</li><li id="b937" class="ni nj it kk b kl nr ko ns kr nt kv nu kz nv ld nn no np nq bi translated">去 https://awesome-panel.org/的<a class="ae nh" href="https://awesome-panel.org/" rel="noopener ugc nofollow" target="_blank">寻找灵感。</a></li><li id="0864" class="ni nj it kk b kl nr ko ns kr nt kv nu kz nv ld nn no np nq bi translated">如果你有问题或想连接到其他面板用户，请查看 https://discourse.holoviz.org/.<a class="ae nh" href="https://discourse.holoviz.org/." rel="noopener ugc nofollow" target="_blank"/></li></ul><h1 id="4512" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">结论</h1><p id="31c6" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated">在本文中，我们演示了如何在 Panel 中构建一个简单的聊天机器人。使用两个 OpenAI APIs 并将 ChatGPT 和 DALL E 2 结合在一个应用程序中，我们的聊天机器人具有文本生成和图像生成功能。如果您还没有尝试过，请尝试一下！</p><h1 id="cc90" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">致谢:</h1><p id="18c3" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated">感谢 Jim Bednar、Simon Hansen、Maxime Liquet 和 Philipp Rudiger 的指导和反馈！</p><h1 id="93d1" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">参考资料:</h1><ul class=""><li id="34de" class="ni nj it kk b kl mi ko mj kr nx kv ny kz nz ld nn no np nq bi translated"><a class="ae nh" href="https://openai.com/" rel="noopener ugc nofollow" target="_blank">https://openai.com/</a></li><li id="2a25" class="ni nj it kk b kl nr ko ns kr nt kv nu kz nv ld nn no np nq bi translated"><a class="ae nh" href="https://panel.holoviz.org" rel="noopener ugc nofollow" target="_blank">https://panel.holoviz.org</a></li><li id="a63c" class="ni nj it kk b kl nr ko ns kr nt kv nu kz nv ld nn no np nq bi translated"><a class="ae nh" rel="noopener" target="_blank" href="/3-ways-to-build-a-panel-visualization-dashboard-6e14148f529d?sk=2cd93ae39586305bae8cfaead2bf7bb4">https://towards data science . com/3-ways-to-build-a-panel-visualization-dashboard-6e 14148 f 529d？sk = 2cd 93 AE 39586305 BAE 8 cfaead 2 BF 7 bb 4</a></li><li id="d04d" class="ni nj it kk b kl nr ko ns kr nt kv nu kz nv ld nn no np nq bi translated"><a class="ae nh" href="https://www.youtube.com/watch?v=n5nn3mQxrE8" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=n5nn3mQxrE8</a></li></ul><p id="b29f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi">. . .</p><p id="a69f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由<a class="ae nh" href="https://twitter.com/sophiamyang" rel="noopener ugc nofollow" target="_blank">索菲亚杨</a>于 2022 年 12 月 22 日。</p><p id="2db3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Sophia Yang 是 Anaconda 的高级数据科学家。在<a class="ae nh" href="https://www.linkedin.com/in/sophiamyang/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>、<a class="ae nh" href="https://twitter.com/sophiamyang" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和<a class="ae nh" href="https://www.youtube.com/SophiaYangDS" rel="noopener ugc nofollow" target="_blank"> YouTube </a>上与我联系，并加入 ds/ml<a class="ae nh" href="https://discord.com/invite/6BremEf9db" rel="noopener ugc nofollow" target="_blank">❤️读书俱乐部</a></p></div></div>    
</body>
</html>