<html>
<head>
<title>Components of a Production ML System Using Only Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">仅使用Python的生产ML系统的组件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/components-of-a-production-ml-system-using-only-python-d6cf27405c82#2022-07-29">https://towardsdatascience.com/components-of-a-production-ml-system-using-only-python-d6cf27405c82#2022-07-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0b74" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">学习和构建MLOps组件基础的基础</h2></div><p id="54fb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我最近为纽约数据科学学院做了一个关于<a class="ae le" href="https://www.youtube.com/watch?v=Zu9WDwBwEW4&amp;feature=youtu.be]" rel="noopener ugc nofollow" target="_blank">生产中的机器学习的演讲，我根据这个演讲改编了这篇文章。这篇文章的目的是使用<em class="lf">唯一的</em> Python代码演示一个生产ML系统的一些组件的基本功能。对于感兴趣的人，</a><a class="ae le" href="https://info.nycdatascience.com/waitinglistforupcomingclass?hs_preview=CfYnYAcl-80863152231" rel="noopener ugc nofollow" target="_blank">我还将在2022-23</a>的生产课上教授机器学习！</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/f6010f7dfeff8e7b8cb5802ed178048f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Dhzax5uAbfzRYtBz"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">由<a class="ae le" href="https://unsplash.com/@devilbitez?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Devilz拍摄。</a> on <a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="c3bb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">免责声明</strong>:本文不代表<em class="lf">实际</em>生产系统的设置，而是作为一个教育工具，代表这些工具的一些轻量级功能，以帮助那些没有机会使用这些系统的人熟悉这些系统。</p><p id="ae9d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">也就是说，下面的每个代码片段都是为了演示您可能在实现MLOps的生产ML系统中看到的一些东西——仅使用<em class="lf">Python！酷吧？要开始使用，请确保安装了以下库:</em></p><pre class="lh li lj lk gt lw lx ly lz aw ma bi"><span id="cd1b" class="mb mc it lx b gy md me l mf mg">pandas<br/>sklearn<br/>pytest</span></pre><p id="9de9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是一些我们将在本教程中使用的合成用户数据。它包含两个输入要素和一个目标。这并不代表真实的场景，但有利于演示:</p><pre class="lh li lj lk gt lw lx ly lz aw ma bi"><span id="ab53" class="mb mc it lx b gy md me l mf mg"><strong class="lx iu">import</strong> pandas <strong class="lx iu">as</strong> pd</span><span id="46e2" class="mb mc it lx b gy mh me l mf mg">url = "<a class="ae le" href="https://raw.githubusercontent.com/kylegallatin/components-of-an-ml-system/main/data/user_data.csv" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/kylegallatin/components-of-an-ml-system/main/data/user_data.csv</a>"</span><span id="5901" class="mb mc it lx b gy mh me l mf mg">user_data <strong class="lx iu">=</strong> pd<strong class="lx iu">.</strong>read_csv(url, index_col<strong class="lx iu">=</strong>0)<br/>user_data<strong class="lx iu">.</strong>head()</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi mi"><img src="../Images/a308142b7c0afbc8ac21ca7b294862cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wthyMItpPR2lmhRCY85Y0Q.png"/></div></div></figure><p id="3705" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们开始吧…</p><h1 id="b099" class="mj mc it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">功能存储</h1><p id="28bb" class="pw-post-body-paragraph ki kj it kk b kl na ju kn ko nb jx kq kr nc kt ku kv nd kx ky kz ne lb lc ld im bi translated">特征库(和特征系统)旨在使机器学习系统的特征易于管理、产品化和定义。它们通常可用于模型训练和低延迟服务。一些技术来看看:泰克顿，盛宴。</p><p id="d777" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面的解决方案允许我们将用户数据转换成一个以<code class="fe nf ng nh lx b">user_id</code>为关键字的字典——这样我们就可以快速检索我们想要预测的用户的特征。它也不妨碍我们在培训过程中读取所有数据。</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="94f5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以用我们的数据初始化这个类，然后将新的特性定义为函数！该函数将自动应用于我们的数据并创建新功能:</p><pre class="lh li lj lk gt lw lx ly lz aw ma bi"><span id="51da" class="mb mc it lx b gy md me l mf mg">feature_store <strong class="lx iu">=</strong> SuperSimpleFeatureStore(user_data)<br/><br/><strong class="lx iu">def</strong> new_feature(feature_dict: Dict) <strong class="lx iu">-&gt;</strong> Dict:<br/>    <strong class="lx iu">return</strong> feature_dict["feature_1"] <strong class="lx iu">**</strong> 2<br/><br/>feature_store<strong class="lx iu">.</strong>register_feature("feature_3", new_feature)<br/>feature_store<strong class="lx iu">.</strong>get_user_feature("a27b09ee-0cf8-11ed-899e-b29c4abd48f4")</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/a721f010aef9cac5475acd005dcecdac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*-HBh0DliOLfoeviA28UyxA.png"/></div></figure><h1 id="6a4d" class="mj mc it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">ML元数据存储(实验跟踪)和模型注册</h1><p id="14cd" class="pw-post-body-paragraph ki kj it kk b kl na ju kn ko nb jx kq kr nc kt ku kv nd kx ky kz ne lb lc ld im bi translated">ML元数据(实验跟踪)本质上是你的数据科学项目的实验室笔记本。这个想法是你捕捉所有的元数据和实验运行的信息，使事情具有可重复性。在此之上是一个模型注册中心，这将是一个更集中的管理和版本化模型的地方。一些可以参考的工具:MLFlow，Weights and Biases，Comet，Sagemaker。</p><p id="6364" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种情况下，我们的设计更简单。我们将在一个CSV文件中捕获关于我们实验的所有信息，用于跟踪结果。</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="5c3f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们有了助手函数，我们可以进行不同的训练运行并记录结果:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="ni nj l"/></div></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nl"><img src="../Images/14f322b3221f88861e7f20406627bbbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yp_1nCnXcw-704Fto9a5UQ.png"/></div></div></figure><p id="9ab3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每当我们运行上面的代码时，我们将向我们的“ML元数据存储”追加另一行。</p><h1 id="e81e" class="mj mc it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">自动化培训渠道</h1><p id="65dd" class="pw-post-body-paragraph ki kj it kk b kl na ju kn ko nb jx kq kr nc kt ku kv nd kx ky kz ne lb lc ld im bi translated">一旦模型代码、数据和参数被优化，代码可以被抽象到源代码控制的repo (git)中，训练代码可以被调度和自动化。在像电子商务这样的情况下，已经有新的数据进入，模型经常需要重新训练。您想要自动化训练和部署模型的过程，这些模型的参数已经被合理地设置。一些可以参考的工具:气流，库伯流。</p><p id="80cd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在可能是迄今为止最大的过度简化中，我这样编译了代码，并将其放入自己的Python脚本中——然后添加了一个无限循环，以在每次运行之间休息1分钟来持续训练模型。这样，我们可以在后台运行脚本来不断训练新的模型(在运行之间有60秒的睡眠时间)。</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="a912" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要在后台运行该脚本，请使用:</p><pre class="lh li lj lk gt lw lx ly lz aw ma bi"><span id="7b62" class="mb mc it lx b gy md me l mf mg">python3 main.py &amp;</span></pre><h1 id="c43c" class="mj mc it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">连续累计</h1><p id="21af" class="pw-post-body-paragraph ki kj it kk b kl na ju kn ko nb jx kq kr nc kt ku kv nd kx ky kz ne lb lc ld im bi translated">持续集成是主动向中央存储库提交变更的行为，也包括自动化测试和构建。大多数这些动作都是由git提交和推送到Github这样的远程存储库来触发的。在本例中，我添加了一个可以使用<code class="fe nf ng nh lx b">pytest</code>运行的简单测试。虽然还没有自动化，但这是在ML repo中设置测试的一个很好的起点。值得关注的工具:Jenkins、云构建、Buildkite。</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="ni nj l"/></div></figure><pre class="lh li lj lk gt lw lx ly lz aw ma bi"><span id="4e12" class="mb mc it lx b gy md me l mf mg">pytest</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nm"><img src="../Images/91661c7ae455138a34db7ccb2a6adbb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P5Tef5MTnIeVcw8bQcjlUw.png"/></div></div></figure><p id="12fe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">动作</strong>:通过添加<code class="fe nf ng nh lx b">pytest</code> <a class="ae le" href="https://pre-commit.com/" rel="noopener ugc nofollow" target="_blank">命令作为git预提交挂钩</a>，自己练习CI(ie将在您尝试提交代码时运行)。</p><h1 id="4d29" class="mj mc it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">持续交付/部署和模型服务器</h1><p id="79bb" class="pw-post-body-paragraph ki kj it kk b kl na ju kn ko nb jx kq kr nc kt ku kv nd kx ky kz ne lb lc ld im bi translated">连续交付是可靠地发布软件的小的迭代变更的实践，以确保它可以被可靠地发布。持续部署就是持续部署。在ML的情况下，这将是自动化过程的一部分——其中模型训练管道自动将新训练的模型发送到模型服务器。要看的工具:Jenkins，Cloud Build，Buildkite，Argo CD。</p><p id="d7a1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">模型服务器通常是接受预测输入(要素)并返回预测的HTTP服务器。要看的工具:Tensorflow发球，谢顿核心。</p><p id="e61e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种情况下，不是做“CD ”,我们只是在每次预测时更新加载最新的训练模型(记住它在后台更新)。然后，我们使用一个<code class="fe nf ng nh lx b">predict</code>函数代替模型服务器来获取给定用户ID的特性并进行预测。</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="ni nj l"/></div></figure><pre class="lh li lj lk gt lw lx ly lz aw ma bi"><span id="3224" class="mb mc it lx b gy md me l mf mg">array([0.])</span></pre><p id="7a6d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在真实的场景中，我们永远不会为每个预测再次加载模型，但是这段代码确保我们无论如何都使用最新的模型。为了改进这个解决方案，请尝试添加代码，以便在我们的模型存储发生变化时只读取新的模型！</p><h1 id="7cff" class="mj mc it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">性能监控</h1><p id="437e" class="pw-post-body-paragraph ki kj it kk b kl na ju kn ko nb jx kq kr nc kt ku kv nd kx ky kz ne lb lc ld im bi translated">生产系统的监控和可观察性绝对是一个系统中最重要的组成部分之一。真正的系统也有警报，通知工程师生产问题。在这种情况下，我们将创建一个简单的监视器，记录预测的延迟并报告平均值。一些研究工具:普罗米修斯，格拉夫纳。</p><p id="c7ec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这段代码添加了一个非常简单的监视类，它跟踪并记录做出预测所需的时间。</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="25a8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们想在继续预测时看到平均预测时间，我们可以使用监视器来实现！</p><pre class="lh li lj lk gt lw lx ly lz aw ma bi"><span id="f260" class="mb mc it lx b gy md me l mf mg">monitor<strong class="lx iu">.</strong>mean()</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nn"><img src="../Images/f2669b6d918d62d23f1d8f890b822b09.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/format:webp/1*IdMahBibcQGrsnAe_ZNI-g.png"/></div></div></figure><h2 id="d456" class="mb mc it bd mk no np dn mo nq nr dp ms kr ns nt mu kv nu nv mw kz nw nx my ny bi translated">结论</h2><p id="06d9" class="pw-post-body-paragraph ki kj it kk b kl na ju kn ko nb jx kq kr nc kt ku kv nd kx ky kz ne lb lc ld im bi translated">生产系统是困难的，如果没有在工业部门工作过相当长的时间，就更难获得实际经验。虽然上面的代码或示例都不是“生产就绪”的，但是它们应该为您提供一个学习这些组件的基础知识的基础，然后在它们的基础上进行构建。</p><p id="346c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在野外，您可能会看到这里所表示的组件的许多不同的组合和实现——包括我没有包括的其他组件！如果您想在本文中看到更多的概念，请告诉我！在这里看这个项目的<a class="ae le" href="https://github.com/kylegallatin/components-of-an-ml-system" rel="noopener ugc nofollow" target="_blank"> git回购。</a></p><p id="a673" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">今年秋天，我将教授一门生产机器学习课程，如果感兴趣，请联系LinkedIn或Twitter！</p></div></div>    
</body>
</html>