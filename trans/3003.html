<html>
<head>
<title>Pivot Table Concepts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据透视表概念</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pivot-table-concepts-report-analyze-story-tell-e3c2e2d36036#2022-06-30">https://towardsdatascience.com/pivot-table-concepts-report-analyze-story-tell-e3c2e2d36036#2022-06-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0dd7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">报道、分析、讲述故事</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/38d43ee528edf1d185f1feeb185e13a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CwIfC5K1E4oYDjXq"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">阿德里安·特林考斯在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="a719" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="05ea" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">给定数据集，<strong class="lt iu">数据透视表</strong>是分析、回答问题和讲述故事的强大工具。透视并不局限于Excel中的分析，而是一种转换数据的通用技术，通常转换成更易理解的格式。</p><h2 id="ee8f" class="mo la it bd lb mp mq dn lf mr ms dp lj ma mt mu ll me mv mw ln mi mx my lp mz bi translated">章节参考</h2><ol class=""><li id="0d20" class="na nb it lt b lu lv lx ly ma nc me nd mi ne mm nf ng nh ni bi translated">为什么是pivot？</li><li id="1762" class="na nb it lt b lu nj lx nk ma nl me nm mi nn mm nf ng nh ni bi translated">宽数据与长数据</li><li id="e796" class="na nb it lt b lu nj lx nk ma nl me nm mi nn mm nf ng nh ni bi translated">例如:Google Sheets、Python和PostgresSQL</li><li id="a999" class="na nb it lt b lu nj lx nk ma nl me nm mi nn mm nf ng nh ni bi translated">聚合函数</li><li id="23a7" class="na nb it lt b lu nj lx nk ma nl me nm mi nn mm nf ng nh ni bi translated">缺失数据</li><li id="fbfc" class="na nb it lt b lu nj lx nk ma nl me nm mi nn mm nf ng nh ni bi translated">外卖食品</li></ol><h1 id="82d0" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">为什么是Pivot？</h1><p id="1121" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果我们正在制造某样东西(任何东西),每次其中一件东西从装配线上下来时，我们都会记录关于这件东西的一些基本信息:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/3561b34b72ccb9d748906a452e51935c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lmJsJLO63Ra7xV4Z2GWMKA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">原始“数据集”</p></figure><p id="5e82" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated">我们可以用数据透视表来回答这个问题</p><ul class=""><li id="df49" class="na nb it lt b lu np lx nq ma nu me nv mi nw mm nx ng nh ni bi translated">我们每样东西做了多少种？</li><li id="3692" class="na nb it lt b lu nj lx nk ma nl me nm mi nn mm nx ng nh ni bi translated">每种东西的平均长度是多少？</li><li id="0085" class="na nb it lt b lu nj lx nk ma nl me nm mi nn mm nx ng nh ni bi translated">每种事物的最快和最慢速度是多少？</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/8e93504d2b589a06559d2869cebd359a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iBj6v2OLllafngidLjwB2g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用数据透视表总结每种类型的属性(下面包含代码示例)</p></figure><p id="a934" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated">最重要的是，我们可以根据目标受众的偏好，以多种形式给出这些问题的答案。我们可以做一个小小的调整，每次测量显示一行，并在输入数据集中为每种类型创建一列，而不是每种类型一行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/fb023f67d26948c0a542eeace7d61afc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lM5MROo-ClQW8nxYMkHVzQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">完全相同的信息以不同的方式呈现。只需要改变一个关键词。</p></figure><h1 id="9a88" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">宽数据与长数据</h1><p id="9d5f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">旋转是将“长数据”转换为“宽数据”的行为。宽数据格式和长数据格式有不同的用途。首先考虑如何收集数据通常会有所帮助。</p><p id="6921" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated">在单个二维表中表示潜在的多维数据可能需要一些折衷。有些数据会重复(长数据格式)，或者数据集可能需要空白单元格(宽数据)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/bf2a17b0d6cb8c5b1672ca650cb49fb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5pqz77RW4Yl4B-SvNcge-A.png"/></div></div></figure><blockquote class="ob oc od"><p id="544e" class="lr ls mn lt b lu np ju lw lx nq jx lz oe nr mc md of ns mg mh og nt mk ml mm im bi translated">我们经常需要将长的<strong class="lt iu">数据</strong>(一个观察列表)转化为<strong class="lt iu">信息</strong>(一个摘要，通常是广泛的数据)以供人们解读。这就是<strong class="lt iu">旋转</strong>数据的用处。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/7098a31a2dc47a9ebe45db8ce72423f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8PQ71ldzGQeABv5gk81gVA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd oi">长数据。</strong>观察多年来不同省份的月汽车销量。每个<strong class="bd oi">年、月、地域、车辆类型、燃料类型</strong>组一个<strong class="bd oi">行</strong>。这在软件中解析起来很简单，但对于人工比较来说并不理想。该表用作本文示例的“原始”数据(来源<a class="ae ky" href="https://www.statcan.gc.ca/en/start" rel="noopener ugc nofollow" target="_blank">https://www . stat can . GC . ca</a></p></figure><p id="fc7b" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated">我们可以获取上面的长数据，然后<em class="mn">将它转换成一种更容易被人使用的宽格式。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/4971f9d11443e479e84be2991e333284.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eKSYCqD6E2LicOlWl___Og.png"/></div></div></figure><p id="0c48" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated">现在我们来看看如何用3种不同的方式来做到这一点:Python(带熊猫)、Google Sheets和PostgreSQL</p><p id="92ff" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated"><strong class="lt iu">带熊猫的蟒蛇皮旋转</strong></p><p id="3abb" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated">从加载到<code class="fe ok ol om on b">df_long_data</code>的原始数据集开始</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/634c0c796ce7a7224141a19914216b73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TKM8WBbpNsBGgDk0V5HYpQ.png"/></div></div></figure><p id="a8c8" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated">请注意这里的关键论点。</p><ol class=""><li id="51cf" class="na nb it lt b lu np lx nq ma nu me nv mi nw mm nf ng nh ni bi translated"><strong class="lt iu"> Index </strong>决定了结果最左边一列的唯一性。</li><li id="c3f0" class="na nb it lt b lu nj lx nk ma nl me nm mi nn mm nf ng nh ni bi translated"><strong class="lt iu">列</strong>为输入表的“车辆类型”和“年份”列中的每个唯一值创建一列。</li><li id="6cc7" class="na nb it lt b lu nj lx nk ma nl me nm mi nn mm nf ng nh ni bi translated"><strong class="lt iu">值</strong>定义在输出表的单元格中放置什么。</li><li id="1b0a" class="na nb it lt b lu nj lx nk ma nl me nm mi nn mm nf ng nh ni bi translated"><strong class="lt iu"> aggfunc </strong>定义<em class="mn">如何</em>组合值(通常为sum，但也使用其他聚合函数:min、max、mean、95%百分点、mode)。您还可以定义自己的聚合函数并传入该函数。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/de019b3ace11822f152ea62a46b6a50e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V1hatidRU5p42h5IINqunQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上面Python代码的输出。</p></figure><p id="e2a3" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated"><strong class="lt iu">在谷歌工作表中旋转</strong></p><p id="f545" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated">Google sheets中的旋转和我们上面的python代码做着完全一样的事情，但是是以图形化的方式。我们没有为<code class="fe ok ol om on b">pivot_table</code>函数指定参数，而是从下拉列表中选择。但是要记住的重要一点是，pivoting并不“属于”任何特定的软件，它是一种处理数据的通用方法。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/f9c345973c34ea13044c852e15034078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*cbDlVDCyT4pyteW5_yNSFw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在谷歌工作表中旋转。请注意列的顺序是多么重要。在Python示例中，“车辆类型”在“年份”之前，这改变了分组。</p></figure><p id="94b1" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated"><strong class="lt iu">PostgreSQL中的分组</strong></p><p id="e6e9" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated">许多关系数据库没有内置的pivot函数。我们可以编写一个接近预期结果的查询，但是它需要一些人工干预来定义可能的组。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/e0bfbf6227d5818f3c0230197123fbfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*o1kWLJbEbzPokuwfj8IOdw.gif"/></div></div></figure><h2 id="09c0" class="mo la it bd lb mp mq dn lf mr ms dp lj ma mt mu ll me mv mw ln mi mx my lp mz bi translated">聚合函数</h2><p id="c7a1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Sum通常用于合并数据透视表中的数据，但数据透视表比简单的求和灵活得多。不同的工具会提供自己选择的<strong class="lt iu">聚合函数。</strong>例如，熊猫提供:<code class="fe ok ol om on b">min, max, first, last, unique, std (standard deviation), var (variance), count, unique, quantile</code>等等。我们还可以定义自己的聚合函数，并将多个不同的聚合函数传递给同一透视表中的同一列或不同列。</p><p id="a876" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated">例如，这个调用将<em class="mn"/><code class="fe ok ol om on b">min</code>和<code class="fe ok ol om on b">max</code>聚合函数都映射到我们的数据，提供两组列来显示每年给定月份的最小和最大汽车销售量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/0bf1704d989027607e00edf905baf03e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gUYLOLDuZKU6D7nZrXCgCQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">对数据透视表中的同一列使用多个聚合</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/f68762ea7fa333faeb369632ce6ec39e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nOnhhsPoeLyaN9AWv5hKgw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">输出</p></figure><h1 id="a99b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">缺失数据</h1><p id="6553" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">与任何聚合一样，必须处理缺失数据。在这里使用的示例数据中，有许多月份都有<code class="fe ok ol om on b">0</code>销售额。最可能的解释是没有收集那几个月的数据，而不是实际上没有销售。还有一种情况是数据完全丢失,“单元格”为空或者包含一个<code class="fe ok ol om on b">null</code>值。无论什么程序，你都需要接受(并意识到)这些情况下的默认行为，或者指定要做什么。</p><p id="9333" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated"><code class="fe ok ol om on b">(5, 7) = 6</code>的平均值，而是<code class="fe ok ol om on b">(5, 0, 0, 7) = 3</code>的平均值和<code class="fe ok ol om on b">(5,null, 7) = ?</code>的平均值。缺失的数据有时会以微妙的方式影响你的结果。</p><h1 id="f8cc" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">外卖食品</h1><p id="1b09" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">数据透视表是一个强大的概念，可以帮助汇总、探索和组织原始数据到信息中。它们可以用来弄清楚数据集中发生了什么，或者浓缩信息与他人分享。</p><ul class=""><li id="5cea" class="na nb it lt b lu np lx nq ma nu me nv mi nw mm nx ng nh ni bi translated">当你需要用数据做一份报告或回答一个问题时，从考虑现有数据的形状开始。</li><li id="05c3" class="na nb it lt b lu nj lx nk ma nl me nm mi nn mm nx ng nh ni bi translated">你的变量是列名还是行名？</li><li id="c1ff" class="na nb it lt b lu nj lx nk ma nl me nm mi nn mm nx ng nh ni bi translated">你是按<em class="mn">观察</em>(大致，长)一排还是按<em class="mn">主题</em>(大致，宽)一排？</li><li id="2421" class="na nb it lt b lu nj lx nk ma nl me nm mi nn mm nx ng nh ni bi translated">您的<em class="mn">主题</em>(索引)是否在不止一行中重复。</li><li id="1adc" class="na nb it lt b lu nj lx nk ma nl me nm mi nn mm nx ng nh ni bi translated">汇总您的数据(最小值、平均值、最大值、分位数、计数、唯一值)能否回答您的问题？</li><li id="122d" class="na nb it lt b lu nj lx nk ma nl me nm mi nn mm nx ng nh ni bi translated">你能添加一个变量作为列，然后让你旋转来回答你的问题吗？</li><li id="7722" class="na nb it lt b lu nj lx nk ma nl me nm mi nn mm nx ng nh ni bi translated">长而宽的数据不是绝对的。</li><li id="3211" class="na nb it lt b lu nj lx nk ma nl me nm mi nn mm nx ng nh ni bi translated">您可以用同一索引一次聚合多个值。或者具有多个聚合函数的相同值。</li></ul></div></div>    
</body>
</html>