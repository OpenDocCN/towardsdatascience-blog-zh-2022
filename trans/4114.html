<html>
<head>
<title>Combining Formation Data With Well Log Measurements in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在熊猫中将地层数据与测井测量相结合</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/combining-formation-data-with-well-log-measurements-in-pandas-8c29589ec132#2022-09-12">https://towardsdatascience.com/combining-formation-data-with-well-log-measurements-in-pandas-8c29589ec132#2022-09-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="1aeb" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">PYTHON和岩石物理学</h2><div class=""/><div class=""><h2 id="43ff" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">用Python集成地下测量</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/96c19f1b14ec6e81599c31cd4f27ed2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UUKjI0PM-wvuRiHUlxZm3Q.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">马丁斯·克拉斯廷斯摄影:<a class="ae lh" href="https://www.pexels.com/photo/cracked-stone-wall-838981/" rel="noopener ugc nofollow" target="_blank">https://www.pexels.com/photo/cracked-stone-wall-838981/</a></p></figure><p id="ae78" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当处理地下数据时，我们经常处理以不同方式采样的数据集。例如，以规则的增量在地下的间隔上连续记录测井测量值(例如，每0.1米的测量值)，而地层顶部是单个深度点。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi me"><img src="../Images/9f0c7119ed3e5a4ed7f5139a80141449.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oZTmDQdZqs-USX4JRuenSw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">测井和地质构造数据的不同采样率。图片由作者提供。</p></figure><p id="024a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本文中，我们将介绍一种将地质地层顶部数据与测井测量相结合的方法。这将允许我们将这些数据用于未来的机器学习过程和数据可视化。</p><h2 id="37ab" class="mf mg it bd mh mi mj dn mk ml mm dp mn lr mo mp mq lv mr ms mt lz mu mv mw iz bi translated">视频教程</h2><p id="b350" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">这个教程的视频版本可以在我的YouTube频道上找到，链接如下。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h2 id="6d30" class="mf mg it bd mh mi mj dn mk ml mm dp mn lr mo mp mq lv mr ms mt lz mu mv mw iz bi translated">本教程中使用的数据</h2><p id="c0ae" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">本教程中使用的数据是Equinor在2018年发布的Volve数据集的子集。数据集的全部细节，包括许可证，可以在下面的链接中找到。</p><div class="ne nf gp gr ng nh"><a href="https://www.equinor.com/energy/volve-data-sharing" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd jd gy z fp nm fr fs nn fu fw jc bi translated">Volve现场数据集</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">Equinor已经正式发布了一套完整的北海油田数据，供研究、学习和应用</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">www.equinor.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv lb nh"/></div></div></a></div><p id="32b4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Volve数据许可证基于CC BY 4.0许可证。许可协议的全部细节可以在这里找到:</p><p id="c768" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><a class="ae lh" href="https://cdn.sanity.io/files/h61q9gi9/global/de6532f6134b9a953f6c41bac47a0c055a3712d3.pdf?equinor-hrs-terms-and-conditions-for-licence-to-data-volve.pdf" rel="noopener ugc nofollow" target="_blank">https://cdn . sanity . io/files/h 61 q 9 gi 9/global/de 6532 f 6134 b 9 a 953 f 6 c 41 BAC 47 a 0 c 055 a 3712d 3 . pdf？equinor-hrs-条款和条件-许可-数据-volve.pdf </a></p><h1 id="c526" class="nw mg it bd mh nx ny nz mk oa ob oc mn ki od kj mq kl oe km mt ko of kp mw og bi translated">导入库和数据</h1><p id="f583" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">本教程的第一步是导入我们将要使用的库。在本例中，我们将结合使用<a class="ae lh" href="http://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> pandas </a>来加载和存储我们的地层数据，以及<a class="ae lh" href="https://github.com/kinverarity1/lasio" rel="noopener ugc nofollow" target="_blank"> lasio </a>来从las文件加载我们的测井数据。</p><pre class="ks kt ku kv gt oh oi oj ok aw ol bi"><span id="abd0" class="mf mg it oi b gy om on l oo op">import lasio<br/>import pandas as pd</span></pre><p id="9335" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，我们将开始导入我们的测井数据。为此，我们需要调用<code class="fe oq or os oi b">lasio.read()</code>并传入。las文件。</p><p id="1bb9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">由于我们将在pandas中工作，我们需要将<a class="ae lh" href="https://github.com/kinverarity1/lasio" rel="noopener ugc nofollow" target="_blank"> lasio </a>对象转换为dataframe，然后重置索引。这将获取设置为深度的当前索引，并将其作为新列放入dataframe中。</p><pre class="ks kt ku kv gt oh oi oj ok aw ol bi"><span id="20b4" class="mf mg it oi b gy om on l oo op">df_19SR = lasio.read('Data/15-9-19_SR_COMP.las').df()<br/>df_19SR.reset_index(inplace=True)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/49c9ab58c447758ec738a0ef43d2314c.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*Qn5rA0IRcSKCUFffxoS_CA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">从las文件中加载后，Volve井15/9–19-SR的Pandas数据帧。图片由作者提供。</p></figure><h2 id="56c5" class="mf mg it bd mh mi mj dn mk ml mm dp mn lr mo mp mq lv mr ms mt lz mu mv mw iz bi translated">装载地层数据</h2><p id="d981" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">地层数据通常存储在csv文件的简单表格中，带有地层名称和相关深度。因此，我们可以通过使用<code class="fe oq or os oi b">pd.read_csv()</code>并传入文件名来使用pandas加载csv。</p><p id="5d74" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这个例子中，文件没有标题行，所以需要添加一个标题行，我们可以通过使用<code class="fe oq or os oi b">names</code>参数来指定名称。</p><pre class="ks kt ku kv gt oh oi oj ok aw ol bi"><span id="2dcc" class="mf mg it oi b gy om on l oo op">df_19SR_formations = pd.read_csv('Data/Volve/15_9_19_SR_TOPS_NPD.csv', header=None, names=['Formation', 'DEPT'])</span><span id="a319" class="mf mg it oi b gy ou on l oo op">df_19SR_formations['DEPT'] = df_19SR_formations['DEPT'].astype(float)</span><span id="bb8e" class="mf mg it oi b gy ou on l oo op">df_19SR_formations</span></pre><p id="2e75" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦地层数据被加载到数据帧中，我们就可以通过调用其名称:<code class="fe oq or os oi b">df_19SR_formations</code>来查看该数据帧，这将返回以下内容:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/cebe7682d430cce9e51af55dd3fa85cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/1*V6YruAu7e8I5jQ-6sdGvow.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">Volve油田15/9–19-SR井内地质构造的名称和深度。图片由作者提供。</p></figure><h1 id="51c7" class="nw mg it bd mh nx ny nz mk oa ob oc mn ki od kj mq kl oe km mt ko of kp mw og bi translated">合并数据</h1><p id="23f1" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">现在有了两个包含我们想要处理的数据的数据帧，我们需要将它们组合起来。我们可以通过创建一个函数来实现这一点，然后使用<code class="fe oq or os oi b">.apply()</code>方法来检查每个深度值，并查看在该深度级别应该出现什么样的地层。</p><p id="ea8e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在下面的函数中，我们首先创建地层深度和名称的列表。</p><p id="cf1d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，我们逐一循环，检查三个条件:</p><ol class=""><li id="deab" class="ow ox it lk b ll lm lo lp lr oy lv oz lz pa md pb pc pd pe bi translated">如果我们在列表中的最后一个编队(项目)</li><li id="f072" class="ow ox it lk b ll pf lo pg lr ph lv pi lz pj md pb pc pd pe bi translated">如果我们位于列表中第一个地层(项目)之前的深度</li><li id="3c08" class="ow ox it lk b ll pf lo pg lr ph lv pi lz pj md pb pc pd pe bi translated">如果我们在两个地层深度之间</li></ol><pre class="ks kt ku kv gt oh oi oj ok aw ol bi"><span id="9a01" class="mf mg it oi b gy om on l oo op">def add_formations_to_df(depth_value:float) -&gt; str:<br/>    formation_depths = df_19SR_formations['DEPT'].to_list()<br/>    formation_names = df_19SR_formations['Formation'].to_list()<br/>    <br/>    for i, depth in enumerate(formation_depths):<br/>        # Check if we are at last formation<br/>        if i == len(formation_depths)-1:<br/>            return formation_names[i]<br/>        <br/>        # Check if we are before first formation<br/>        elif depth_value &lt;= formation_depths[i]:<br/>            return ''<br/>        <br/>        # Check if current depth between current and next formation<br/>        elif depth_value &gt;= formation_depths[i] and depth_value &lt;= formation_depths[i+1]:<br/>            return formation_names[i]</span></pre><p id="d858" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦编写了函数，我们就可以在数据帧中创建一个名为FORMATION的新列，并将这个新函数应用到<code class="fe oq or os oi b">DEPT</code>列。</p><pre class="ks kt ku kv gt oh oi oj ok aw ol bi"><span id="ad96" class="mf mg it oi b gy om on l oo op">df_19SR['FORMATION'] = df_19SR['DEPT'].apply(add_formations_to_df)</span><span id="e091" class="mf mg it oi b gy ou on l oo op">df_19SR</span></pre><p id="e0b5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我们调用dataframe时，我们可以看到我们的新列中有地层数据。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/d6a417644a5d8d844e0ae174b51b6c5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*uctPB-UTfH7jBUyUN_SGbw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">结合地层数据和测井数据后的数据帧。图片由作者提供。</p></figure><p id="521c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以仔细看看一个具体的深度范围:4339到4341米，看看地层名称的变化。</p><pre class="ks kt ku kv gt oh oi oj ok aw ol bi"><span id="f7f8" class="mf mg it oi b gy om on l oo op">df_19SR.loc[(df_19SR['DEPT'] &gt;= 4339) &amp; (df_19SR['DEPT'] &lt;= 4341)]</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pl"><img src="../Images/dac3e5ffc013f1aacfc85019465784a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UGsAAThj3pLHzyHvismXFQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">使用将测井数据和地层顶部合并在一起后的数据帧。在熊猫中应用()方法。图片由作者提供。</p></figure><p id="deb7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">正如我们在上面看到的，斯卡格拉克调频在4340米后开始，在此之前，我们有胡金调频。</p><h1 id="161d" class="nw mg it bd mh nx ny nz mk oa ob oc mn ki od kj mq kl oe km mt ko of kp mw og bi translated">摘要</h1><p id="739f" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">将地质地层信息集成到测井数据集中是一个相对简单的过程。一旦我们在主数据框架中有了这些信息，我们就可以使用它来可视化我们关于地质的数据，并且在我们进行机器学习过程时也可以利用这些信息。</p><p id="92bb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您想了解如何将地层顶部与测井测量结果结合起来进行可视化，请查看这篇文章:</p><div class="ne nf gp gr ng nh"><a rel="noopener follow" target="_blank" href="/adding-formation-data-to-a-well-log-plot-3897b96a3967"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd jd gy z fp nm fr fs nn fu fw jc bi translated">将地层数据添加到测井曲线中</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">使用Python和matplotlib进一步绘制测井曲线</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">towardsdatascience.com</p></div></div><div class="nq l"><div class="pm l ns nt nu nq nv lb nh"/></div></div></a></div></div><div class="ab cl pn po hx pp" role="separator"><span class="pq bw bk pr ps pt"/><span class="pq bw bk pr ps pt"/><span class="pq bw bk pr ps"/></div><div class="im in io ip iq"><p id="215f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="pu">感谢阅读。在你走之前，你一定要订阅我的内容，把我的文章放到你的收件箱里。</em> <a class="ae lh" href="https://andymcdonaldgeo.medium.com/subscribe" rel="noopener"> <strong class="lk jd"> <em class="pu">你可以在这里做！</em></strong></a><strong class="lk jd"><em class="pu"/></strong><em class="pu">或者，您也可以</em> <a class="ae lh" href="https://fabulous-founder-2965.ck.page/2ca286e572" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd"> <em class="pu">注册我的简讯</em> </strong> </a> <em class="pu">免费将更多内容直接发送到您的收件箱。</em></p><p id="92a3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">其次，通过注册会员，你可以获得完整的媒介体验，并支持我和其他成千上万的作家。每月只需花费你5美元，你就可以接触到所有精彩的媒体文章，也有机会通过写作赚钱。</p><p id="6733" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="pu">如果你用</em> <a class="ae lh" href="https://andymcdonaldgeo.medium.com/membership" rel="noopener"> <strong class="lk jd"> <em class="pu">我的链接</em></strong></a><strong class="lk jd"><em class="pu"/></strong><em class="pu">报名，你直接用你的一部分费用支持我，不会多花你多少钱。如果你这样做了，非常感谢你的支持！</em></p></div></div>    
</body>
</html>