<html>
<head>
<title>Standard vs Legacy SQL in BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">BigQuery中的标准SQL与传统SQL</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/standard-vs-legacy-sql-bigquery-6d01fa3046a9#2022-08-30">https://towardsdatascience.com/standard-vs-legacy-sql-bigquery-6d01fa3046a9#2022-08-30</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="3bb6" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">理解标准SQL和遗留SQL在Google Cloud BigQuery环境中的区别</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/bf48c9bc557477057a30bf2d02fde831.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YpFLpJaxkfSiCi57JAB8FQ.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/s/photos/sql?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae kz" href="https://unsplash.com/@sunder_2k25?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Sunder Muthukumaran </a>拍摄</p></figure><p id="a87b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">BigQuery是谷歌云平台上的一项托管数据仓库服务，它允许组织持久保存他们的数据，也允许分析师访问这些数据并提取有价值的信息。</p><p id="fba6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当我开始使用BigQuery时，我遇到了两个当时对我来说不太清楚的术语，即<strong class="lc iv">标准</strong>和<strong class="lc iv">遗留</strong> SQL。这本质上是BigQuery支持的两种方言，具有不同的语法、语义和功能。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="a6b7" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">传统与标准SQL</h2><p id="4a79" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">过去，BigQuery使用一种非标准的SQL方言执行查询，称为<strong class="lc iv"> BigQuery SQL </strong>。然而，自从BigQuery 2.0发布以来，该服务现在支持标准SQL，而以前的<strong class="lc iv"> BigQuery SQL被重命名为遗留SQL </strong>。</p><p id="4b05" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">标准SQL是一种ANSI兼容的查询语言。值得一提的是，目前，在BigQuery上运行查询的首选语言是标准SQL。</p><p id="d515" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">保留传统SQL主要是为了向后兼容，因此，建议迁移到标准SQL，因为我们预计在将来的某个时候，传统SQL将被弃用。数据定义语言(DDL)和数据模型语言(DML)等功能仅受标准SQL支持</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="3cee" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">主要区别</h2><p id="c4c3" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">遗留SQL中的每种类型在标准SQL中都有对应的类型(反之亦然)，这意味着遗留SQL中的类型在标准方言中有不同的名称。关于标准方言和传统方言之间的精确映射，你可以参考<a class="ae kz" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/migrating-from-legacy-sql#type_differences" rel="noopener ugc nofollow" target="_blank">官方文件</a>。</p><p id="81bf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">此外，与传统SQL相比，标准方言的类型<code class="fe nb nc nd ne b">TIMESTAMP</code>的有效值范围更小。前者只接受范围在<code class="fe nb nc nd ne b">0001-01-01 00:00:00.000000</code>和<code class="fe nb nc nd ne b">9999-12-31 23:59:59.999999</code>之间的值。</p><p id="464e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">标准方言和传统方言在查询中转义字符(如连字符)的方式也不同。在前者中，我们使用反斜杠(<code class="fe nb nc nd ne b">`</code>)字符，而在后者中使用方括号(<code class="fe nb nc nd ne b">[]</code>)。</p><p id="0e6b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">此外，传统SQL在引用项目名称时使用冒号<code class="fe nb nc nd ne b">:</code>作为分隔符，而标准方言需要句点<code class="fe nb nc nd ne b">.</code></p><pre class="kk kl km kn gu nf ne ng nh aw ni bi"><span id="bafb" class="md me iu ne b gz nj nk l nl nm">#standardSQL<br/>SELECT *<br/>FROM `bigquery-public-data.samples.shakespeare`;</span><span id="2981" class="md me iu ne b gz nn nk l nl nm">#legacySQL<br/>SELECT * <br/>FROM <!-- -->`bigquery-public-data:samples.shakespeare`;</span></pre><p id="3e0c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">另外值得一提的是，标准方言不支持<a class="ae kz" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/migrating-from-legacy-sql#table_decorators" rel="noopener ugc nofollow" target="_blank">表装饰器</a>和其他一些<a class="ae kz" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/migrating-from-legacy-sql#wildcard_functions" rel="noopener ugc nofollow" target="_blank">通配符函数</a>。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="0bef" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">标准SQL的优势</h2><p id="4e67" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">如前所述，标准SQL比传统SQL方言有几个优点。更具体地说，它支持</p><ul class=""><li id="2f60" class="no np iu lc b ld le lg lh lj nq ln nr lr ns lv nt nu nv nw bi translated"><code class="fe nb nc nd ne b">WITH</code>条款</li><li id="ddc1" class="no np iu lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated">用户定义的SQL函数</li><li id="a5d9" class="no np iu lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated"><code class="fe nb nc nd ne b">SELECT</code>和<code class="fe nb nc nd ne b">WHERE</code>条款中的子查询</li><li id="ada2" class="no np iu lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated">插入、更新和删除</li><li id="3181" class="no np iu lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated">更多数据类型，如<code class="fe nb nc nd ne b">ARRAY</code>和<code class="fe nb nc nd ne b">STRUCT</code></li><li id="299a" class="no np iu lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated">更准确的<code class="fe nb nc nd ne b">COUND(DISTINCT ..)</code>子句(与过去有许多重大限制的遗留SQL方言的<code class="fe nb nc nd ne b">EXACT_COUNT_DISTINCT</code>相比)</li><li id="4dc8" class="no np iu lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated">相关子查询</li><li id="952e" class="no np iu lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated">和更复杂的<code class="fe nb nc nd ne b">JOIN</code>谓词</li></ul><p id="10d6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">关于标准SQL方言的这个功能的实际例子，你可以参考官方BigQuery文档<a class="ae kz" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/migrating-from-legacy-sql#standard_sql_highlights" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="8dcd" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">更改默认方言</h2><p id="4e3b" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">BigQuery上的默认方言是标准SQL。但是，这可以通过在SQL查询中包含前缀来改变。如果您希望切换到遗留SQL，您需要在指定查询之前包含前缀<code class="fe nb nc nd ne b">#legacySQL</code>。标准SQL对应的前缀是<code class="fe nb nc nd ne b">#standardSQL</code>。</p><p id="3c4f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，这些前缀必须在查询之前，不区分大小写，并且在查询和前缀本身之间应该有一个换行符。</p><p id="3b6f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">例如，考虑以下使用传统SQL方言的查询:</p><pre class="kk kl km kn gu nf ne ng nh aw ni bi"><span id="9c1f" class="md me iu ne b gz nj nk l nl nm">#legacySQL<br/>SELECT<br/>  weight_pounds, <br/>  state, <br/>  year, <br/>  gestation_weeks<br/>FROM<br/>  [bigquery-public-data:samples.natality]<br/>ORDER BY<br/>  weight_pounds DESC<br/>LIMIT<br/>  10;</span></pre></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="bcee" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">最后的想法</h2><p id="f311" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">BigQuery无疑是Google云平台上最受欢迎的云服务之一，因为几乎每个现代组织都需要托管数据仓库服务。</p><p id="70d5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因此，利用大多数可用的特性来帮助您有效地、大规模地解决问题是非常重要的。</p><p id="5bb2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在今天的文章中，我们讨论了BigQuery的一个最基本的方面，即用于运行服务操作的SQL方言。请注意，我们只讨论了遗留和标准SQL方言之间总体差异的一小部分。</p><p id="5f73" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果你还在运行传统的SQL，我个人强烈推荐迁移到标准的SQL方言，因为它是Google推荐的方言，也提供了更强大的功能。有关差异的完整列表，请参考<a class="ae kz" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/migrating-from-legacy-sql" rel="noopener ugc nofollow" target="_blank">官方指南“迁移到标准SQL”。</a></p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><p id="1b77" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://gmyrianthous.medium.com/membership" rel="noopener"> <strong class="lc iv">成为会员</strong> </a> <strong class="lc iv">阅读介质上的每一个故事。你的会员费直接支持我和你看的其他作家。你也可以在媒体上看到所有的故事。</strong></p><div class="oc od gq gs oe of"><a href="https://gmyrianthous.medium.com/membership" rel="noopener follow" target="_blank"><div class="og ab fp"><div class="oh ab oi cl cj oj"><h2 class="bd iv gz z fq ok fs ft ol fv fx it bi translated">通过我的推荐链接加入Medium-Giorgos Myrianthous</h2><div class="om l"><h3 class="bd b gz z fq ok fs ft ol fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="on l"><p class="bd b dl z fq ok fs ft ol fv fx dk translated">gmyrianthous.medium.com</p></div></div><div class="oo l"><div class="op l oq or os oo ot kt of"/></div></div></a></div></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><p id="676e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">相关文章你可能也喜欢</strong></p><div class="oc od gq gs oe of"><a rel="noopener follow" target="_blank" href="/ddl-dml-e802a25076c6"><div class="og ab fp"><div class="oh ab oi cl cj oj"><h2 class="bd iv gz z fq ok fs ft ol fv fx it bi translated">DDL和DML是什么？</h2><div class="om l"><h3 class="bd b gz z fq ok fs ft ol fv fx dk translated">理解SQL中DDL和DML的区别</h3></div><div class="on l"><p class="bd b dl z fq ok fs ft ol fv fx dk translated">towardsdatascience.com</p></div></div><div class="oo l"><div class="ou l oq or os oo ot kt of"/></div></div></a></div></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu of"><a rel="noopener follow" target="_blank" href="/oltp-vs-olap-9ac334baa370"><div class="og ab fp"><div class="oh ab oi cl cj oj"><h2 class="bd iv gz z fq ok fs ft ol fv fx it bi translated">OLTP与OLAP:他们的区别是什么</h2><div class="om l"><h3 class="bd b gz z fq ok fs ft ol fv fx dk translated">在数据处理系统的上下文中理解OLTP和OLAP之间的区别</h3></div><div class="on l"><p class="bd b dl z fq ok fs ft ol fv fx dk translated">towardsdatascience.com</p></div></div><div class="oo l"><div class="ov l oq or os oo ot kt of"/></div></div></a></div></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu of"><a rel="noopener follow" target="_blank" href="/connect-airflow-worker-gcp-e79690f3ecea"><div class="og ab fp"><div class="oh ab oi cl cj oj"><h2 class="bd iv gz z fq ok fs ft ol fv fx it bi translated">如何在Cloud Composer上连接到气流工作者</h2><div class="om l"><h3 class="bd b gz z fq ok fs ft ol fv fx dk translated">在谷歌云平台上连接气流工作者</h3></div><div class="on l"><p class="bd b dl z fq ok fs ft ol fv fx dk translated">towardsdatascience.com</p></div></div><div class="oo l"><div class="ow l oq or os oo ot kt of"/></div></div></a></div></div></div>    
</body>
</html>