<html>
<head>
<title>Smokin’ Bayes Meets Logistic Regression</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">吸烟贝叶斯符合逻辑回归</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/smokin-bayes-cd6eb089fcd3#2022-02-03">https://towardsdatascience.com/smokin-bayes-cd6eb089fcd3#2022-02-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9a65" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">贝叶斯推理结合广义线性模型比较吸烟者和非吸烟者死亡率的例子</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4e19df01b2e0dc8d6c4ec512ed0e1fe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EnKyfRJekz2wa0GuNmfGug.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我没有发现 Bayes 是否吸烟的信息。然而，我可以通过结合先验知识(当时男性吸烟的比例)和数据(画像上的他不吸烟)来估计他是吸烟者的概率。作者图片</p></figure><p id="9dff" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">前段时间在看<a class="ae lr" href="https://calmcode.io/smoking/the-dataset.html" rel="noopener ugc nofollow" target="_blank">抽烟:数据集</a>(这个数据集原来是在<a class="ae lr" href="https://rdrr.io/cran/mosaicData/man/Whickham.html" rel="noopener ugc nofollow" target="_blank">的 mosiac R 包</a>里找到的。)在<a class="ae lr" href="https://calmcode.io/" rel="noopener ugc nofollow" target="_blank"> calmcode.io </a>上的系列视频。他们向你展示如何分析和比较吸烟者和非吸烟者的 10 年死亡率。(注意，不是吸烟的影响——而是作为一名吸烟者——因为吸烟者的生活方式与那些除了吸烟以外在其他方面没有区别的人不同。)</p><p id="ef69" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这篇文章中，我将使用贝叶斯推理和一个广义线性模型，来计算与 calmcode 的视觉方法相比，作为一个吸烟者的影响。首先，让我们看看他们发现了什么。</p><h1 id="e6a3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">视觉方法</h1><p id="f5d6" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">吸烟数据集中的每一行代表一个人，她是否吸烟，十年后是否还活着。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="86a3" class="mu lt iq mq b gy mv mw l mx my"><a class="ae lr" href="https://rdrr.io/r/base/library.html" rel="noopener ugc nofollow" target="_blank">library</a>(<a class="ae lr" href="https://tidyverse.tidyverse.org" rel="noopener ugc nofollow" target="_blank">tidyverse</a>)<br/><a class="ae lr" href="https://rdrr.io/r/base/library.html" rel="noopener ugc nofollow" target="_blank">library</a>(rethinking)<br/><a class="ae lr" href="https://rdrr.io/r/base/library.html" rel="noopener ugc nofollow" target="_blank">library</a>(<a class="ae lr" href="http://mjskay.github.io/tidybayes.rethinking" rel="noopener ugc nofollow" target="_blank">tidybayes.rethinking</a>)<br/><a class="ae lr" href="https://rdrr.io/r/base/library.html" rel="noopener ugc nofollow" target="_blank">library</a>(<a class="ae lr" href="https://mjskay.github.io/tidybayes/" rel="noopener ugc nofollow" target="_blank">tidybayes</a>)<br/><br/>df_raw &lt;- readr::<a class="ae lr" href="https://readr.tidyverse.org/reference/read_delim.html" rel="noopener ugc nofollow" target="_blank">read_csv</a>("smoking.csv", col_types = "cfi")<br/><br/>df &lt;- df_raw <a class="ae lr" href="https://magrittr.tidyverse.org/reference/pipe.html" rel="noopener ugc nofollow" target="_blank">%&gt;%</a> <br/>  <a class="ae lr" href="https://dplyr.tidyverse.org/reference/mutate.html" rel="noopener ugc nofollow" target="_blank">transmute</a>(<br/>    age,<br/>    is_smoker = smoker,<br/>    is_dead = <a class="ae lr" href="https://dplyr.tidyverse.org/reference/if_else.html" rel="noopener ugc nofollow" target="_blank">if_else</a>(outcome == "Dead", 1L, 0L)<br/>  )</span><span id="a94f" class="mu lt iq mq b gy mz mw l mx my"><a class="ae lr" href="https://rdrr.io/r/utils/head.html" rel="noopener ugc nofollow" target="_blank">head</a>(df_raw)</span><span id="d85c" class="mu lt iq mq b gy mz mw l mx my"># A tibble: 6 × 3<br/>  outcome smoker   age<br/>  &lt;chr&gt;   &lt;fct&gt;  &lt;int&gt;<br/>1 Alive   Yes       23<br/>2 Alive   Yes       18<br/>3 Dead    Yes       71<br/>4 Alive   No        67<br/>5 Alive   No        64<br/>6 Alive   Yes       38</span></pre><p id="b4a8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们还稍微调整了数据集，并将其保存到<code class="fe na nb nc mq b">df</code>。这将在以后派上用场。从现在开始，我们将关注死亡率而不是存活率。</p><p id="878d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最基本(也是最天真)的方法是计算每种吸烟状态的死亡率。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="b710" class="mu lt iq mq b gy mv mw l mx my">df <a class="ae lr" href="https://magrittr.tidyverse.org/reference/pipe.html" rel="noopener ugc nofollow" target="_blank">%&gt;%</a> <br/>  <a class="ae lr" href="https://dplyr.tidyverse.org/reference/group_by.html" rel="noopener ugc nofollow" target="_blank">group_by</a>(is_smoker) <a class="ae lr" href="https://magrittr.tidyverse.org/reference/pipe.html" rel="noopener ugc nofollow" target="_blank">%&gt;%</a> <br/>  <a class="ae lr" href="https://dplyr.tidyverse.org/reference/summarise.html" rel="noopener ugc nofollow" target="_blank">summarise</a>(death_rate = <a class="ae lr" href="https://rdrr.io/r/base/mean.html" rel="noopener ugc nofollow" target="_blank">mean</a>(is_dead))</span><span id="1624" class="mu lt iq mq b gy mz mw l mx my"># A tibble: 2 × 2<br/>  is_smoker death_rate<br/>  &lt;fct&gt;          &lt;dbl&gt;<br/>1 Yes            0.239<br/>2 No             0.314</span></pre><p id="5bfb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">哇，似乎吸烟者的死亡率更低！但是…我们不会因为年龄而“控制”。让我们比较一下每个年龄组的死亡率:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="b287" class="mu lt iq mq b gy mv mw l mx my">df_agg &lt;- df <a class="ae lr" href="https://magrittr.tidyverse.org/reference/pipe.html" rel="noopener ugc nofollow" target="_blank">%&gt;%</a> <br/>  <a class="ae lr" href="https://dplyr.tidyverse.org/reference/mutate.html" rel="noopener ugc nofollow" target="_blank">mutate</a>(round_age = plyr::<a class="ae lr" href="https://rdrr.io/pkg/plyr/man/round_any.html" rel="noopener ugc nofollow" target="_blank">round_any</a>(age, 10)) <a class="ae lr" href="https://magrittr.tidyverse.org/reference/pipe.html" rel="noopener ugc nofollow" target="_blank">%&gt;%</a> <br/>  <a class="ae lr" href="https://dplyr.tidyverse.org/reference/group_by.html" rel="noopener ugc nofollow" target="_blank">group_by</a>(round_age, is_smoker) <a class="ae lr" href="https://magrittr.tidyverse.org/reference/pipe.html" rel="noopener ugc nofollow" target="_blank">%&gt;%</a> <br/>  <a class="ae lr" href="https://dplyr.tidyverse.org/reference/summarise.html" rel="noopener ugc nofollow" target="_blank">summarise</a>(death_rate = <a class="ae lr" href="https://rdrr.io/r/base/mean.html" rel="noopener ugc nofollow" target="_blank">mean</a>(is_dead), .groups = "drop")</span><span id="8539" class="mu lt iq mq b gy mz mw l mx my"><a class="ae lr" href="https://ggplot2.tidyverse.org/reference/ggplot.html" rel="noopener ugc nofollow" target="_blank">ggplot</a>(df_agg, <a class="ae lr" href="https://ggplot2.tidyverse.org/reference/aes.html" rel="noopener ugc nofollow" target="_blank">aes</a>(round_age, death_rate, color = is_smoker)) + <br/>  <a class="ae lr" href="https://ggplot2.tidyverse.org/reference/geom_path.html" rel="noopener ugc nofollow" target="_blank">geom_line</a>() + <br/>  <a class="ae lr" href="https://ggplot2.tidyverse.org/reference/labs.html" rel="noopener ugc nofollow" target="_blank">labs</a>(<br/>    title = "Mortality rates of smokers are higher for all age groups",<br/>    y = "10-year mortality rate",<br/>    x = "Age group"<br/>  )</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/a85eb4ac10ccae2d0a3776cea5121f15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OX-ZcdebmO2nPp43y5LUUQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="1344" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这就展现了一个完全不同的画面！在所有年龄组中，吸烟者的死亡率都较高。之前，由于数据集中吸烟者和不吸烟者的年龄比例不同，我们得到了不同的汇总结果。这就是著名的<a class="ae lr" href="https://en.wikipedia.org/wiki/Simpson's_paradox" rel="noopener ugc nofollow" target="_blank">辛普森悖论</a>。</p><p id="0ed2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Calmcode 视频到此为止。但是我想知道，如果没有宁滨时代，如何更精确地估计差异？</p><h1 id="a2d6" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">贝叶斯方法</h1><p id="a02e" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">我们将使用带有二项式可能性的广义线性模型。在我们的案例中，当数据被组织到单个试验案例中时(无论该人是否在未来 10 年内死亡)，该模型的通用名称是<a class="ae lr" href="https://en.wikipedia.org/wiki/Logistic_regression" rel="noopener ugc nofollow" target="_blank">逻辑回归</a>。我们将使用<a class="ae lr" href="https://en.wikipedia.org/wiki/Logit" rel="noopener ugc nofollow" target="_blank"> logit </a> link 对年龄和死亡率之间的关系进行建模。为了确保所有的<code class="fe na nb nc mq b">p</code>值从[∞，∞]映射到[0，1]，这种转换是必要的，否则我们在定义先验时必须小心。</p><p id="cd1c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这里是<code class="fe na nb nc mq b">logit(p) ~ age</code>在图上的样子:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="0b98" class="mu lt iq mq b gy mv mw l mx my"><a class="ae lr" href="https://ggplot2.tidyverse.org/reference/ggplot.html" rel="noopener ugc nofollow" target="_blank">ggplot</a>(df_agg, <a class="ae lr" href="https://ggplot2.tidyverse.org/reference/aes.html" rel="noopener ugc nofollow" target="_blank">aes</a>(round_age, logit(death_rate), color = is_smoker)) + <br/>  <a class="ae lr" href="https://ggplot2.tidyverse.org/reference/geom_path.html" rel="noopener ugc nofollow" target="_blank">geom_line</a>() + <br/>  <a class="ae lr" href="https://ggplot2.tidyverse.org/reference/labs.html" rel="noopener ugc nofollow" target="_blank">labs</a>(<br/>    title = "We will approximate logit(p) ~ age with linear function.", <br/>    y = "logit(10-year mortality rate)", <br/>    x = "Age group"<br/>  )</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/af7333e6af97173747efb58d1b77b9e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5_yfym8R1E7rWXvNDXhy5Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="1051" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通过观察该图，我们似乎可以将<code class="fe na nb nc mq b">logit(death_rate)</code>建模为某一年龄死亡率的线性组合(截距)和代表死亡率随年龄变化的斜率。两组的斜率似乎也是一样的。</p><p id="2795" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">由此，我们可以为我们的模型构建一个公式列表并运行它:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="a124" class="mu lt iq mq b gy mv mw l mx my">formulas &lt;- <a class="ae lr" href="https://rdrr.io/r/base/list.html" rel="noopener ugc nofollow" target="_blank">alist</a>(<br/>    is_dead ~ <a class="ae lr" href="https://rdrr.io/r/stats/Binomial.html" rel="noopener ugc nofollow" target="_blank">dbinom</a>(1, p),<br/>    logit(p) &lt;- a[is_smoker] + b * (age - 60),<br/>    a[is_smoker] ~ <a class="ae lr" href="https://rdrr.io/r/stats/Normal.html" rel="noopener ugc nofollow" target="_blank">dnorm</a>(-0.3, 0.25),<br/>    b ~ <a class="ae lr" href="https://rdrr.io/r/stats/Normal.html" rel="noopener ugc nofollow" target="_blank">dnorm</a>(0.1, 0.05)<br/>)<br/><br/>model &lt;- <a class="ae lr" href="https://rdrr.io/pkg/rethinking/man/ulam.html" rel="noopener ugc nofollow" target="_blank">ulam</a>(formulas, data = df, warmup = 200, iter = 500, chains = 4, cores = 4)</span></pre><p id="b4db" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我来解释一下<code class="fe na nb nc mq b">formulas</code>:</p><ul class=""><li id="3738" class="ne nf iq kx b ky kz lb lc le ng li nh lm ni lq nj nk nl nm bi translated"><code class="fe na nb nc mq b">is_dead</code>遵循 1 次试验的二项分布(也称为伯努利分布)，而<code class="fe na nb nc mq b">p</code>代表成功的概率(在我们的例子中，成功等于未来 10 年的死亡)。</li><li id="c338" class="ne nf iq kx b ky nn lb no le np li nq lm nr lq nj nk nl nm bi translated">关联函数<code class="fe na nb nc mq b">logit(p)</code>是十年死亡率的线性组合，取决于一个人是否吸烟，由截距<code class="fe na nb nc mq b">a</code>表示，斜率<code class="fe na nb nc mq b">b</code>在吸烟者和非吸烟者之间共享。基于上面的情节，我决定使用这样的模型。<code class="fe na nb nc mq b">logit(death_rate)</code>似乎与年龄呈线性相关。两组的斜率似乎是相同的。唯一不同的是截距。我决定在 60 岁而不是 0 岁时计算，因为这更直观，而且该模型对低年龄没有意义。</li><li id="c81c" class="ne nf iq kx b ky nn lb no le np li nq lm nr lq nj nk nl nm bi translated">代表两组 60 岁死亡率的截距<code class="fe na nb nc mq b">a</code>的先验值相同。这是基于目测，但它足够广泛，在有意义的范围内。我也可以从其他在线数据集中重用它。</li><li id="dd67" class="ne nf iq kx b ky nn lb no le np li nq lm nr lq nj nk nl nm bi translated">斜率的先验<code class="fe na nb nc mq b">b</code>也是基于目测，但也可以从在线数据集提前确定，在理想情况下更严格。</li></ul><p id="3a66" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在查看模型之前，让我们仔细检查一下先验知识:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="3e17" class="mu lt iq mq b gy mv mw l mx my">prior &lt;- <a class="ae lr" href="https://rdrr.io/pkg/rethinking/man/extract.samples.html" rel="noopener ugc nofollow" target="_blank">extract.prior</a>(model, n = 200)</span><span id="5a24" class="mu lt iq mq b gy mz mw l mx my"><a class="ae lr" href="https://tibble.tidyverse.org/reference/tibble.html" rel="noopener ugc nofollow" target="_blank">tibble</a>(<br/>  sample = 1:200,<br/>  a = prior$a[,1], # you get two priors for intercepts (one for each group) but they are the same<br/>  b = prior$b<br/>) <a class="ae lr" href="https://magrittr.tidyverse.org/reference/pipe.html" rel="noopener ugc nofollow" target="_blank">%&gt;%</a><br/>  tidyr::<a class="ae lr" href="https://tidyr.tidyverse.org/reference/expand.html" rel="noopener ugc nofollow" target="_blank">crossing</a>(age = <a class="ae lr" href="https://rdrr.io/r/base/Extremes.html" rel="noopener ugc nofollow" target="_blank">min</a>(df$age):<a class="ae lr" href="https://rdrr.io/r/base/Extremes.html" rel="noopener ugc nofollow" target="_blank">max</a>(df$age)) <a class="ae lr" href="https://magrittr.tidyverse.org/reference/pipe.html" rel="noopener ugc nofollow" target="_blank">%&gt;%</a><br/>  <a class="ae lr" href="https://dplyr.tidyverse.org/reference/mutate.html" rel="noopener ugc nofollow" target="_blank">mutate</a>(p = <a class="ae lr" href="https://purrr.tidyverse.org/reference/map2.html" rel="noopener ugc nofollow" target="_blank">pmap_dbl</a>(<a class="ae lr" href="https://rdrr.io/r/base/list.html" rel="noopener ugc nofollow" target="_blank">list</a>(a, b, age), \(a, b, age) <a class="ae lr" href="https://rdrr.io/pkg/rethinking/man/rethinking-internal.html" rel="noopener ugc nofollow" target="_blank">inv_logit</a>(a + b * (age - 60)))) <a class="ae lr" href="https://magrittr.tidyverse.org/reference/pipe.html" rel="noopener ugc nofollow" target="_blank">%&gt;%</a><br/>  <a class="ae lr" href="https://ggplot2.tidyverse.org/reference/ggplot.html" rel="noopener ugc nofollow" target="_blank">ggplot</a>() +<br/>  <a class="ae lr" href="https://ggplot2.tidyverse.org/reference/geom_path.html" rel="noopener ugc nofollow" target="_blank">geom_line</a>(<a class="ae lr" href="https://ggplot2.tidyverse.org/reference/aes.html" rel="noopener ugc nofollow" target="_blank">aes</a>(age, p, group = sample), alpha = 0.2) +<br/>  <a class="ae lr" href="https://ggplot2.tidyverse.org/reference/geom_point.html" rel="noopener ugc nofollow" target="_blank">geom_point</a>(data = df_agg, <a class="ae lr" href="https://ggplot2.tidyverse.org/reference/aes.html" rel="noopener ugc nofollow" target="_blank">aes</a>(round_age, death_rate, color = is_smoker)) + <br/>  <a class="ae lr" href="https://ggplot2.tidyverse.org/reference/labs.html" rel="noopener ugc nofollow" target="_blank">labs</a>(title = "Priors seem fine", y = "10-year mortality rate")</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/962db30ab7ddbd0c8528520297ee2c10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x1R_DmLKUbxgbG1Od5lYUg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="5d2d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">前科看起来不错——信息足够丰富，但也很灵活。链的跟踪和 trank 图看起来也不错——你必须相信我。</p><p id="d331" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下是该模型的摘要:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="d4e0" class="mu lt iq mq b gy mv mw l mx my"><a class="ae lr" href="https://rdrr.io/r/base/summary.html" rel="noopener ugc nofollow" target="_blank">summary</a>(model)</span><span id="6f72" class="mu lt iq mq b gy mz mw l mx my">Inference for Stan model: 49f5d62bf6172f02e3638f3ae2372250.<br/>4 chains, each with iter=500; warmup=200; thin=1; <br/>post-warmup draws per chain=300, total post-warmup draws=1200.</span><span id="ccbe" class="mu lt iq mq b gy mz mw l mx my">mean se_mean   sd    2.5%     25%     50%     75%   97.5%<br/>a[1]   -0.04    0.00 0.12   -0.26   -0.13   -0.05    0.04    0.20<br/>a[2]   -0.20    0.00 0.10   -0.39   -0.26   -0.20   -0.14    0.01<br/>b       0.12    0.00 0.01    0.11    0.12    0.12    0.13    0.14<br/>lp__ -474.88    0.06 1.23 -478.10 -475.46 -474.57 -473.98 -473.49<br/>     n_eff Rhat<br/>a[1]   627    1<br/>a[2]   678    1<br/>b     1177    1<br/>lp__   494    1<br/><br/>Samples were drawn using NUTS(diag_e) at Mon Jan 10 19:35:02 2022.<br/>For each parameter, n_eff is a crude measure of effective sample size,<br/>and Rhat is the potential scale reduction factor on split chains (at <br/>convergence, Rhat=1).</span></pre><p id="d979" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以看到，与不吸烟者的截距<code class="fe na nb nc mq b">a[2]</code>相比，吸烟者的截距<code class="fe na nb nc mq b">a[1]</code>具有更高的死亡率。我们可以使用<code class="fe na nb nc mq b">tidybayes</code>软件包中的便捷函数绘制这两个参数的整体分布图(已经转换为 60 岁时的死亡率)及其差异:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="a117" class="mu lt iq mq b gy mv mw l mx my">samples_a &lt;- model <a class="ae lr" href="https://magrittr.tidyverse.org/reference/pipe.html" rel="noopener ugc nofollow" target="_blank">%&gt;%</a><br/>  <a class="ae lr" href="http://mjskay.github.io/tidybayes/reference/recover_types.html" rel="noopener ugc nofollow" target="_blank">recover_types</a>(df) <a class="ae lr" href="https://magrittr.tidyverse.org/reference/pipe.html" rel="noopener ugc nofollow" target="_blank">%&gt;%</a><br/>  <a class="ae lr" href="http://mjskay.github.io/tidybayes/reference/spread_draws.html" rel="noopener ugc nofollow" target="_blank">spread_draws</a>(a[is_smoker]) <a class="ae lr" href="https://magrittr.tidyverse.org/reference/pipe.html" rel="noopener ugc nofollow" target="_blank">%&gt;%</a> <br/>  <a class="ae lr" href="https://dplyr.tidyverse.org/reference/mutate.html" rel="noopener ugc nofollow" target="_blank">mutate</a>(p = <a class="ae lr" href="https://rdrr.io/pkg/rethinking/man/rethinking-internal.html" rel="noopener ugc nofollow" target="_blank">inv_logit</a>(a)) <a class="ae lr" href="https://magrittr.tidyverse.org/reference/pipe.html" rel="noopener ugc nofollow" target="_blank">%&gt;%</a> <br/>  <a class="ae lr" href="https://dplyr.tidyverse.org/reference/bind.html" rel="noopener ugc nofollow" target="_blank">bind_rows</a>(.,  <a class="ae lr" href="http://mjskay.github.io/tidybayes/reference/compare_levels.html" rel="noopener ugc nofollow" target="_blank">compare_levels</a>(., p, by = is_smoker)) </span><span id="0965" class="mu lt iq mq b gy mz mw l mx my"><a class="ae lr" href="https://ggplot2.tidyverse.org/reference/ggplot.html" rel="noopener ugc nofollow" target="_blank">ggplot</a>(samples_a, <a class="ae lr" href="https://ggplot2.tidyverse.org/reference/aes.html" rel="noopener ugc nofollow" target="_blank">aes</a>(p, is_smoker)) + <br/>  <a class="ae lr" href="http://mjskay.github.io/ggdist/reference/stat_sample_slabinterval.html" rel="noopener ugc nofollow" target="_blank">stat_halfeye</a>() + <br/>  <a class="ae lr" href="https://ggplot2.tidyverse.org/reference/labs.html" rel="noopener ugc nofollow" target="_blank">labs</a>(title = "Posterior distributions for intercepts and their difference")</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/8ee8860e1ceb09faede3533f241301f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZwLSicHEIOSfJ2BNfiUMPw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="4e06" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这些分布基于后验样本。有了它们，我们还可以计算出不吸烟者死亡率较低的概率:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="71f3" class="mu lt iq mq b gy mv mw l mx my">samples_a <a class="ae lr" href="https://magrittr.tidyverse.org/reference/pipe.html" rel="noopener ugc nofollow" target="_blank">%&gt;%</a> <br/>  <a class="ae lr" href="https://dplyr.tidyverse.org/reference/filter.html" rel="noopener ugc nofollow" target="_blank">filter</a>(is_smoker == "No - Yes") <a class="ae lr" href="https://magrittr.tidyverse.org/reference/pipe.html" rel="noopener ugc nofollow" target="_blank">%&gt;%</a> <br/>  <a class="ae lr" href="https://dplyr.tidyverse.org/reference/summarise.html" rel="noopener ugc nofollow" target="_blank">summarise</a>(prob = <a class="ae lr" href="https://rdrr.io/r/base/mean.html" rel="noopener ugc nofollow" target="_blank">mean</a>(p &lt; 0))</span><span id="339d" class="mu lt iq mq b gy mz mw l mx my"># A tibble: 1 × 2<br/>  is_smoker  prob<br/>  &lt;chr&gt;     &lt;dbl&gt;<br/>1 No - Yes  0.845</span></pre><p id="02ae" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">吸烟者有 85%的几率会有更高的死亡率。我们还可以看到死亡率的差异是如何随年龄变化的(注意，差异的形状是由我们的模型定义的，而不是大小):</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="233e" class="mu lt iq mq b gy mv mw l mx my">newdata &lt;- tidyr::<a class="ae lr" href="https://tidyr.tidyverse.org/reference/expand.html" rel="noopener ugc nofollow" target="_blank">crossing</a>(<br/>  age = 20:90, <br/>  is_smoker = <a class="ae lr" href="https://rdrr.io/r/base/unique.html" rel="noopener ugc nofollow" target="_blank">unique</a>(df$is_smoker)<br/>)</span><span id="0d0c" class="mu lt iq mq b gy mz mw l mx my">linpreds &lt;- <a class="ae lr" href="http://mjskay.github.io/tidybayes/reference/add_predicted_draws.html" rel="noopener ugc nofollow" target="_blank">add_linpred_draws</a>(model, newdata = newdata, value = "p") </span><span id="1a24" class="mu lt iq mq b gy mz mw l mx my">linpreds <a class="ae lr" href="https://magrittr.tidyverse.org/reference/pipe.html" rel="noopener ugc nofollow" target="_blank">%&gt;%</a> <br/>  <a class="ae lr" href="https://dplyr.tidyverse.org/reference/group_by.html" rel="noopener ugc nofollow" target="_blank">group_by</a>(age, .draw) <a class="ae lr" href="https://magrittr.tidyverse.org/reference/pipe.html" rel="noopener ugc nofollow" target="_blank">%&gt;%</a> <br/>  <a class="ae lr" href="https://dplyr.tidyverse.org/reference/summarise.html" rel="noopener ugc nofollow" target="_blank">summarise</a>(<br/>    p_diff = p[is_smoker == "Yes"] - p[is_smoker == "No"]<br/>  ) <a class="ae lr" href="https://magrittr.tidyverse.org/reference/pipe.html" rel="noopener ugc nofollow" target="_blank">%&gt;%</a> <br/>  <a class="ae lr" href="https://ggplot2.tidyverse.org/reference/ggplot.html" rel="noopener ugc nofollow" target="_blank">ggplot</a>(<a class="ae lr" href="https://ggplot2.tidyverse.org/reference/aes.html" rel="noopener ugc nofollow" target="_blank">aes</a>(x = age)) +<br/>  <a class="ae lr" href="http://mjskay.github.io/ggdist/reference/stat_lineribbon.html" rel="noopener ugc nofollow" target="_blank">stat_lineribbon</a>(<a class="ae lr" href="https://ggplot2.tidyverse.org/reference/aes.html" rel="noopener ugc nofollow" target="_blank">aes</a>(y = p_diff), .width = 0.9, fill = "gray") + <br/>  <a class="ae lr" href="https://ggplot2.tidyverse.org/reference/labs.html" rel="noopener ugc nofollow" target="_blank">labs</a>(<br/>    title = "Mean difference in mortality rate with 90% credible interval",<br/>    subtitle = "Shape of the difference was imposed by our model.",<br/>    y = "Difference in 10-year mortality rate with 90% CI"<br/>  )</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/f2a8fd2c269d2fa7f544c5b4289e152c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I6_FStdRtiQoeVLYjqaA8w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="8eb6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">60 岁左右人群的 10 年死亡率似乎平均增加了约 4%(90%可信区间在 10%和-2.5%之间)，年龄越小死亡率越低。这可能是有道理的:</p><ul class=""><li id="9a81" class="ne nf iq kx b ky kz lb lc le ng li nh lm ni lq nj nk nl nm bi translated">对于年轻人来说，吸烟的影响还没有那么大(而且他们的死亡率也更低)；</li><li id="1613" class="ne nf iq kx b ky nn lb no le np li nq lm nr lq nj nk nl nm bi translated">即使不吸烟，老年人也更容易死亡。</li></ul><p id="4e8f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以通过除以而不是减去死亡率来计算死亡率的相对上升。在这种情况下，年轻人的相对上升幅度约为 20%，然后开始缓慢下降，在 60 岁时约为 10%，然后几乎可以忽略不计。</p><p id="ce1f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们还可以看到所有年龄组中两组死亡率的 90%可信区间:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="bc72" class="mu lt iq mq b gy mv mw l mx my"><a class="ae lr" href="https://ggplot2.tidyverse.org/reference/ggplot.html" rel="noopener ugc nofollow" target="_blank">ggplot</a>(linpreds, <a class="ae lr" href="https://ggplot2.tidyverse.org/reference/aes.html" rel="noopener ugc nofollow" target="_blank">aes</a>(x = age, color = is_smoker, fill = is_smoker)) +<br/>  <a class="ae lr" href="http://mjskay.github.io/ggdist/reference/stat_lineribbon.html" rel="noopener ugc nofollow" target="_blank">stat_lineribbon</a>(<a class="ae lr" href="https://ggplot2.tidyverse.org/reference/aes.html" rel="noopener ugc nofollow" target="_blank">aes</a>(y = p), .width = 0.9, alpha = 0.5) +<br/>  <a class="ae lr" href="https://ggplot2.tidyverse.org/reference/geom_point.html" rel="noopener ugc nofollow" target="_blank">geom_point</a>(data = df_agg, <a class="ae lr" href="https://ggplot2.tidyverse.org/reference/aes.html" rel="noopener ugc nofollow" target="_blank">aes</a>(x = round_age, y = death_rate)) + <br/>  <a class="ae lr" href="https://ggplot2.tidyverse.org/reference/labs.html" rel="noopener ugc nofollow" target="_blank">labs</a>(<br/>    title = "Mortality rate ~ age with 90% credible intervals",<br/>    y = "10-year mortality rate"<br/>  )</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/9e48dd58199c893682ed336c01c64c15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wxc7uiEFU6iBvgE1fgm96w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="7039" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="fd57" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">使用<code class="fe na nb nc mq b">logit</code>链接函数使我们能够将伯努利变量<code class="fe na nb nc mq b">p</code> (10 年死亡率)建模为年龄的线性函数。另一方面，贝叶斯方法使我们能够获得参数值的分布——对于任何年龄和吸烟状态。我们可以按照我们喜欢的方式进行汇总:这是否是吸烟者死亡率更高的可能性，死亡率(差异)的可信区间(最终有意义的置信区间)……</p><p id="c04a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">贝叶斯推理和广义线性模型代表了一种灵活而强大的组合。但是，正确地指定模型背后的假设(公式集)是我们的责任。从这些发现中学习——所以，不要吸烟。并使用吸烟贝叶斯。</p></div><div class="ab cl ns nt hu nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="ij ik il im in"><p id="9e93" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="nz">原载于</em><a class="ae lr" href="https://mihagazvoda.com/" rel="noopener ugc nofollow" target="_blank"><em class="nz"/></a><em class="nz">。</em></p></div></div>    
</body>
</html>