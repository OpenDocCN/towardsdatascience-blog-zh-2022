<html>
<head>
<title>Tutorial of Python Azure functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python Azure函数教程</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tutorial-of-python-azure-functions-81949b1fd6db#2022-08-11">https://towardsdatascience.com/tutorial-of-python-azure-functions-81949b1fd6db#2022-08-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/bf7d15bd056ff6661594306864fd1dec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*okH4J0Ng7Ij9Sij0"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">由<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae jd" href="https://unsplash.com/@element5digital?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Element5数码</a>拍摄</p></figure><div class=""/><div class=""><h2 id="4bc2" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">将您的代码作为API发布，无需传统的服务器设置</h2></div><h1 id="6717" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">介绍</h1><p id="1095" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">Azure functions是一个“<strong class="lp jh">无服务器解决方案</strong>”，这意味着你不必担心传统的服务器设置。它可以用于各种场景，包括a)构建web API，b)运行计划任务，c)响应数据库更改等事件。在本教程中，我们将使用Azure函数将应用程序发布为web API。</p><figure class="mk ml mm mn gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mj"><img src="../Images/cb4926582a95c99b7da3d3a8708ad779.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*KRSEryx-5c7f3OngtOrnmA.gif"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">本教程中描述的示例应用程序的发布版本(图片由作者提供)。</p></figure><h1 id="e694" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">环境配置</h1><p id="7f49" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">如果你之前没有使用过Azure函数，那么最耗时的步骤就是环境设置。我建议进行以下设置:</p><ol class=""><li id="b306" class="mo mp jg lp b lq mq lt mr lw ms ma mt me mu mi mv mw mx my bi translated">具有有效订阅的Azure帐户。<a class="ae jd" href="https://azure.microsoft.com/free/?ref=microsoft.com&amp;utm_source=microsoft.com&amp;utm_medium=docs&amp;utm_campaign=visualstudio" rel="noopener ugc nofollow" target="_blank">你可以免费创建一个账户</a>。</li><li id="2544" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated">Azure功能核心工具版本3.x。</li><li id="b1ca" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated">Python版。</li><li id="c00f" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated"><a class="ae jd" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a>在一个支持的平台上(<a class="ae jd" href="https://code.visualstudio.com/docs/supporting/requirements#_platforms" rel="noopener ugc nofollow" target="_blank">看一下支持的平台</a>)。</li><li id="509c" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated">Visual Studio代码的<a class="ae jd" href="https://marketplace.visualstudio.com/items?itemName=ms-python.python" rel="noopener ugc nofollow" target="_blank"> Python扩展</a>。</li><li id="570a" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated">Visual Studio代码的<a class="ae jd" href="https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azurefunctions" rel="noopener ugc nofollow" target="_blank"> Azure函数扩展</a>。</li></ol><p id="7859" class="pw-post-body-paragraph ln lo jg lp b lq mq kh ls lt mr kk lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">如您所见，有六个主要步骤可能会占用您几个小时的时间。幸运的是，你只需要做一次。</p><h1 id="fa63" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">初始结构</h1><p id="a010" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我们从已经有工作应用程序的州开始这个项目。我们的应用程序告诉您，在过去的7天里，波罗的海地区的最高电价是在哪里、什么时候、什么价格(<a class="ae jd" href="https://azurefunctionsresearch.azurewebsites.net/api/my-calculator" rel="noopener ugc nofollow" target="_blank"> <strong class="lp jh">查看实时应用程序</strong> </a>)。</p><p id="6b1f" class="pw-post-body-paragraph ln lo jg lp b lq mq kh ls lt mr kk lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">项目的初始结构由包含最高价格计算函数的<code class="fe nh ni nj nk b">calculator.py</code>文件和定义两个库的<code class="fe nh ni nj nk b">requirements.txt</code>文件组成:<code class="fe nh ni nj nk b">requests</code>和<code class="fe nh ni nj nk b">azure-functions</code>。</p><figure class="mk ml mm mn gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/ebadc176b937e3bafb7aae98c96157f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FnKBZGt2gFQflW0kzfI-PA.jpeg"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">初始项目结构(图片由作者提供)。</p></figure><h1 id="4cd5" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">在本地创建Azure函数</h1><p id="97a4" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">要开始将我们的代码包装成Azure函数，我们首先需要创建本地Azure functions项目。遵循以下步骤(或微软的<a class="ae jd" href="https://docs.microsoft.com/en-us/azure/azure-functions/create-first-function-vs-code-python#create-an-azure-functions-project" rel="noopener ugc nofollow" target="_blank">详细说明</a>):</p><ol class=""><li id="ea71" class="mo mp jg lp b lq mq lt mr lw ms ma mt me mu mi mv mw mx my bi translated">在活动栏中选择Azure图标。然后在工作区(本地)区域，选择+按钮，在下拉列表中选择创建函数。出现提示时，选择创建函数。</li><li id="c548" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated">选择项目工作环境的目录位置，然后选择“选择”。</li><li id="c8e2" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated">根据提示提供以下信息:<br/> 3.1选择一种语言:<code class="fe nh ni nj nk b">Python</code>。<br/> 3.2选择Python解释器创建虚拟环境。<br/> 3.3为您的项目功能选择模板:选择<code class="fe nh ni nj nk b">HTTP trigger</code>。<br/> 3.4提供函数名:输入<code class="fe nh ni nj nk b">my-calculator</code>。<br/> 3.5授权级别:选择<code class="fe nh ni nj nk b">Anonymous</code>，可以让任何人调用你的函数端点。<br/> 3.6选择您希望如何打开您的项目:选择<code class="fe nh ni nj nk b">Add to workspace.</code></li></ol><p id="f3fa" class="pw-post-body-paragraph ln lo jg lp b lq mq kh ls lt mr kk lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">Visual Studio代码自动创建必要的文件，我们的项目目录现在将具有如下图2所示的结构:</p><figure class="mk ml mm mn gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nm"><img src="../Images/f39d09480ef036e55ad4508f42716b9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NtGkHl4nHxLdtD-NIsU_5g.jpeg"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">启动Azure功能前(图1)和后(图2)的项目结构(图片由作者提供)。</p></figure><h1 id="efca" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">将您的代码与Azure函数链接起来</h1><p id="a3c6" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">目前，Azure function backbone已经创建，但我们还没有将我们的应用程序链接到它。</p><p id="7cbe" class="pw-post-body-paragraph ln lo jg lp b lq mq kh ls lt mr kk lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">打开<code class="fe nh ni nj nk b">my-calculator</code>文件夹内的<code class="fe nh ni nj nk b">__init__.py</code>文件。该文件包含将作为Azure函数运行的<code class="fe nh ni nj nk b">main</code>函数。目前，该文件中充满了示例代码(如下图1所示)。为了运行我们的计算器，我们对文件进行了以下修改:</p><ol class=""><li id="12da" class="mo mp jg lp b lq mq lt mr lw ms ma mt me mu mi mv mw mx my bi translated">导入您的函数(在我们的例子中<code class="fe nh ni nj nk b">from calculator import highest_price_function</code>，</li><li id="1389" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated">导入json库，将字典转换成JSON格式(REST APIs的标准输出格式)。</li><li id="c9b8" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated">用自己的逻辑替换<code class="fe nh ni nj nk b">main</code>函数里面的代码:<br/> a .运行函数，保存结果。<br/> b .将结果(我们的结果是一个字典)转换成JSON。<br/> c .返回JSON结果。</li></ol><figure class="mk ml mm mn gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nn"><img src="../Images/d9c7dbdd97ce04e9b97c44c0bd200329.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HE7vxsyG640IBq1Q33-Iog.jpeg"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">已修改__init__。py文件将您的代码包装在Azure函数中(图片由作者提供)。</p></figure><h1 id="4688" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">在本地测试该功能</h1><p id="c920" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">要在本地启动该功能，请按F5或播放图标。如果一切顺利，您将在终端窗口中看到端点的URL:</p><figure class="mk ml mm mn gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi no"><img src="../Images/b185c8c52727e9e5726efbcae0d84865.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KmmeXwH8tGt9z1a-jD1YzA.jpeg"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">在本地启动该功能后，您将在终端窗口中找到该功能的URL(图片由作者提供)。</p></figure><p id="a031" class="pw-post-body-paragraph ln lo jg lp b lq mq kh ls lt mr kk lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">复制此URL并将其粘贴到我们的浏览器中，或者只需在VS代码中单击它:</p><figure class="mk ml mm mn gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mj"><img src="../Images/cb4926582a95c99b7da3d3a8708ad779.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*KRSEryx-5c7f3OngtOrnmA.gif"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">本教程中描述的示例应用程序的发布版本(图片由作者提供)。</p></figure><h1 id="033e" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">将该功能部署到Azure cloud</h1><p id="9633" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我们现在准备将该功能部署到Azure。遵循以下步骤(<a class="ae jd" href="https://docs.microsoft.com/en-us/azure/azure-functions/create-first-function-vs-code-python#sign-in-to-azure" rel="noopener ugc nofollow" target="_blank">或微软官方指令</a>):</p><ol class=""><li id="4e9b" class="mo mp jg lp b lq mq lt mr lw ms ma mt me mu mi mv mw mx my bi translated">登录Azure(如果需要)，</li><li id="e35a" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated">打开Azure扩展，选择<strong class="lp jh">创建资源</strong>，搜索“<strong class="lp jh">创建功能App </strong>”。</li><li id="bad1" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated">填写提示:<br/> 3.1选择订阅—选择订阅(如果只有一个订阅就看不到这个了)。<br/> 3.2输入全局唯一名称—输入函数的名称。<br/> 3.3选择运行时堆栈—选择您在本地机器上使用的语言版本。<br/> 3.4选择新资源的位置——选择您附近的某个地区。</li><li id="d7ef" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated">在Azure扩展的<strong class="lp jh">工作区</strong>部分，选择项目文件夹并点击<strong class="lp jh"> Deploy </strong>。</li></ol><figure class="mk ml mm mn gt is gh gi paragraph-image"><div class="gh gi np"><img src="../Images/698365750adcba8ae049e590a118e50a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*VtSr8MsSInPcuNFUx-EM_A.jpeg"/></div></figure><p id="a98f" class="pw-post-body-paragraph ln lo jg lp b lq mq kh ls lt mr kk lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">该应用程序现已发布，您可以与任何有兴趣使用它的人共享它(<a class="ae jd" href="https://azurefunctionsresearch.azurewebsites.net/api/my-calculator" rel="noopener ugc nofollow" target="_blank"> <strong class="lp jh">查看本教程的实际应用</strong> </a>)。</p><h1 id="05bc" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">摘要</h1><p id="814a" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">总的来说，Azure functions绝对是一个值得考虑的工具，当你想与世界分享你的数据应用程序的原型时:</p><ol class=""><li id="dbff" class="mo mp jg lp b lq mq lt mr lw ms ma mt me mu mi mv mw mx my bi translated"><strong class="lp jh">文档&amp;教程</strong> —非常好</li><li id="42bd" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated"><strong class="lp jh">初始设置复杂性</strong> —中等</li><li id="a3fa" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated"><strong class="lp jh">开发复杂度</strong> —中低</li><li id="1937" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated"><strong class="lp jh">部署复杂性</strong> —低</li><li id="132f" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated"><strong class="lp jh">授权可能性</strong> —高</li><li id="8be0" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated"><strong class="lp jh">授权复杂度</strong> —低</li><li id="c345" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated"><strong class="lp jh">速度&amp;可扩展性</strong> —高水平</li><li id="f2b6" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated"><strong class="lp jh">监控</strong> —高功能开箱即用</li><li id="c299" class="mo mp jg lp b lq mz lt na lw nb ma nc me nd mi mv mw mx my bi translated"><strong class="lp jh">定价</strong> —几乎免费(用于原型制作)</li></ol><p id="2de6" class="pw-post-body-paragraph ln lo jg lp b lq mq kh ls lt mr kk lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">你可以从这篇文章中读到<a class="ae jd" href="https://eljand.medium.com/rapid-prototyping-azure-functions-1cd8293ab300" rel="noopener">我对Azure功能的全面评测。玩得开心！</a></p></div></div>    
</body>
</html>