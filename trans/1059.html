<html>
<head>
<title>Text classification made easy with AutoKeras</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AutoKeras 简化了文本分类</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/text-classification-made-easy-with-autokeras-c1020ff60b17#2022-03-20">https://towardsdatascience.com/text-classification-made-easy-with-autokeras-c1020ff60b17#2022-03-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4a68" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个利用自动机器学习能力的简单例子</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8ed29e996a4dbf04146c8a793f2fcccf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qwLBjeDyBQJArn1eFVOg7Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><h1 id="33d3" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">目录</h1><ol class=""><li id="31be" class="lq lr it ls b lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated"><a class="ae mi" href="#d320" rel="noopener ugc nofollow">简介</a></li><li id="b814" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md me mf mg mh bi translated"><a class="ae mi" href="#65b1" rel="noopener ugc nofollow">环境设置</a></li><li id="2e31" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md me mf mg mh bi translated"><a class="ae mi" href="#e9c4" rel="noopener ugc nofollow">数据准备</a></li><li id="70b0" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md me mf mg mh bi translated"><a class="ae mi" href="#0e0a" rel="noopener ugc nofollow">文本分类</a></li><li id="3673" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md me mf mg mh bi translated"><a class="ae mi" href="#e8df" rel="noopener ugc nofollow">导出性能最佳的型号</a></li><li id="7232" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md me mf mg mh bi translated"><a class="ae mi" href="#82ea" rel="noopener ugc nofollow">结论</a></li><li id="8708" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md me mf mg mh bi translated"><a class="ae mi" href="#73b5" rel="noopener ugc nofollow">参考文献</a></li></ol><h1 id="d320" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">1.介绍</h1><p id="a9d7" class="pw-post-body-paragraph mo mp it ls b lt lu ju mq lv lw jx mr lx ms mt mu lz mv mw mx mb my mz na md im bi translated"><strong class="ls iu">自动化机器学习</strong> ( <strong class="ls iu"> AutoML </strong>)旨在自动化机器学习解决方案的设计。</p><p id="09a5" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">特别是，它包括一系列技术来自动确定数据准备、模型和超参数的最佳集合。</p><p id="9e1d" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">AutoML 可以通过更容易地采用机器学习来支持该领域知识有限的用户。此外，它还可以通过加速实验和缩短上市时间来帮助更高级的用户。</p><p id="2125" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">在神经网络竞赛中，AutoML 在不同的神经网络架构和超参数中搜索，以找到最佳匹配，这个过程称为<strong class="ls iu">神经架构搜索</strong> ( <strong class="ls iu"> NAS </strong>)。</p><p id="9ead" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated"><strong class="ls iu"> AutoKeras </strong> <strong class="ls iu"> </strong>是一个开源库，使用 Keras API 实现了深度学习的 AutoML。</p><p id="a7d2" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">在这篇文章中，我们将使用 AutoKeras 来训练一个文本分类器，能够在几行代码中检测垃圾邮件。特别是，我们将提供代码片段，可以很容易地在⁴.的谷歌实验室复制和执行</p><h1 id="65b1" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">2.环境设置</h1><p id="c855" class="pw-post-body-paragraph mo mp it ls b lt lu ju mq lv lw jx mr lx ms mt mu lz mv mw mx mb my mz na md im bi translated">让我们从 Colab 笔记本上安装 AutoKeras:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="fba9" class="nl kz it nh b gy nm nn l no np">!pip install autokeras</span></pre><p id="2443" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">要在本地环境下安装 AutoKeras，我们应该在官方文档上查看与 Python 和 TensorFlow 的兼容性。让我们导入所需的库:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="8f67" class="nl kz it nh b gy nm nn l no np">import pandas as pd<br/>import numpy as np<br/>import tensorflow as tf<br/>import autokeras as ak</span></pre><h1 id="e9c4" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">3.数据准备</h1><p id="6791" class="pw-post-body-paragraph mo mp it ls b lt lu ju mq lv lw jx mr lx ms mt mu lz mv mw mx mb my mz na md im bi translated">对于这个例子，我们将使用来自⁶.<strong class="ls iu">UCI 机器学习库</strong>的公开可用的<strong class="ls iu">垃圾短信收集数据集</strong> ⁵ <strong class="ls iu"> </strong>该数据由一个文本文件组成，其中包含一组被标记为垃圾邮件或 ham 的 SMS 消息。</p><p id="e3ec" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">我们进行如下操作:</p><ul class=""><li id="cf58" class="lq lr it ls b lt nb lv nc lx nq lz nr mb ns md nt mf mg mh bi translated">将数据集下载为 zip 文件夹:</li></ul><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="6a2c" class="nl kz it nh b gy nm nn l no np">!wget "https://archive.ics.uci.edu/ml/machine-learning-databases/00228/smsspamcollection.zip"</span></pre><ul class=""><li id="cdb7" class="lq lr it ls b lt nb lv nc lx nq lz nr mb ns md nt mf mg mh bi translated">打开文件夹:</li></ul><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="54c1" class="nl kz it nh b gy nm nn l no np">!unzip -o smsspamcollection.zip</span></pre><ul class=""><li id="e2a5" class="lq lr it ls b lt nb lv nc lx nq lz nr mb ns md nt mf mg mh bi translated">检查数据文件的前几行:</li></ul><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="6a71" class="nl kz it nh b gy nm nn l no np">!head -10 SMSSpamCollection</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/cf506e74f3d1195b3df05fbd402e69b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X09TphxFeEaGrEJ47uJmhA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><ul class=""><li id="1ab8" class="lq lr it ls b lt nb lv nc lx nq lz nr mb ns md nt mf mg mh bi translated">对于每一行，我们注意到标签后面跟着一个制表符和原始文本消息。我们选择处理文件以获得一个<code class="fe nv nw nx nh b">pandas.DataFrame</code> <strong class="ls iu"> </strong>对象，因为这种格式代表了数据科学实验中的一个共同起点:</li></ul><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="98b6" class="nl kz it nh b gy nm nn l no np">fileName = '/content/SMSSpamCollection'</span><span id="0eb1" class="nl kz it nh b gy ny nn l no np">df = pd.DataFrame({'label':int(), 'text':str()}, index=[])</span><span id="c8e1" class="nl kz it nh b gy ny nn l no np">with open(fileName) as f:<br/>  for line in f.readlines():<br/>    split = line.split('\t')<br/>    df = df.append({'label': 1 if split[0]=='spam' else 0,<br/>                    'text': split[1]},<br/>                   ignore_index = True)</span><span id="ce55" class="nl kz it nh b gy ny nn l no np">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/13896ef39dc2223816b2e49482ac41ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*PIJ-0j6_NiKQsIhUGzkRMQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><ul class=""><li id="009d" class="lq lr it ls b lt nb lv nc lx nq lz nr mb ns md nt mf mg mh bi translated"><code class="fe nv nw nx nh b">autokeras.TextClassifier</code> ⁷类需要以<code class="fe nv nw nx nh b">numpy.ndarray</code>或<code class="fe nv nw nx nh b">tf.data.Dataset</code>的形式输入数据。因此，我们转换我们的数据，并将它们分成训练集和测试集:</li></ul><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="a85b" class="nl kz it nh b gy nm nn l no np">from sklearn.model_selection import train_test_split</span><span id="605a" class="nl kz it nh b gy ny nn l no np">x = np.array(df.text)<br/>y = np.array(df.label)</span><span id="9593" class="nl kz it nh b gy ny nn l no np">x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.25)</span></pre><h1 id="0e0a" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">4.文本分类</h1><p id="3ada" class="pw-post-body-paragraph mo mp it ls b lt lu ju mq lv lw jx mr lx ms mt mu lz mv mw mx mb my mz na md im bi translated">为了构建文本分类器，我们只需要创建一个<code class="fe nv nw nx nh b">autokeras.TextClassifier</code> ⁷类的实例，并将其放在训练数据上:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="a217" class="nl kz it nh b gy nm nn l no np">clf = ak.TextClassifier()</span><span id="2a40" class="nl kz it nh b gy ny nn l no np">clf.fit(x_train, y_train)</span></pre><p id="cb90" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">AutoKeras 将<strong class="ls iu">根据验证数据的性能自动确定最佳模型和超参数</strong>。</p><p id="dbc1" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">注意事项:</p><ul class=""><li id="5355" class="lq lr it ls b lt nb lv nc lx nq lz nr mb ns md nt mf mg mh bi translated"><code class="fe nv nw nx nh b">autokeras.TextClassifier</code>类接受<code class="fe nv nw nx nh b">max_trials</code>参数来设置可以尝试的不同 Keras 模型的最大数量。因为默认值是 100，所以为了快速演示，可能需要减小它，例如<code class="fe nv nw nx nh b">clf = autokeras.TextClassifier(max_trials = 3)</code>。</li><li id="ff61" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md nt mf mg mh bi translated">我们之前将标签映射到整数(0: ham，1: spam)。这不是绝对必要的:我们可以使用原始标签作为 well⁷.</li><li id="994d" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md nt mf mg mh bi translated">默认情况下，AutoKeras 使用最后 20%的训练数据作为验证数据。可以使用<code class="fe nv nw nx nh b">validation_split</code>参数来指定所需的分流比，例如:</li></ul><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="b6e1" class="nl kz it nh b gy nm nn l no np">clf.fit(x_train, <br/>        y_train,<br/>        validation_split = 0.3)</span></pre><p id="93aa" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">在训练过程之后，我们可以使用最佳分类器对测试集进行预测并评估性能:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="aa4b" class="nl kz it nh b gy nm nn l no np">from sklearn.metrics import classification_report</span><span id="2567" class="nl kz it nh b gy ny nn l no np">y_hat = clf.predict(x_test)</span><span id="3170" class="nl kz it nh b gy ny nn l no np">print(classification_report(y_test, y_hat))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/433bb7f732a1f6bc198e32d071748b67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oXyww05vVsZsOnU--IYkyQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">测试集评估。图片作者。</p></figure><h1 id="e8df" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">5.导出性能最佳的模型</h1><p id="1ec7" class="pw-post-body-paragraph mo mp it ls b lt lu ju mq lv lw jx mr lx ms mt mu lz mv mw mx mb my mz na md im bi translated">可以导出最佳分类器并检查其架构，如下所示:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="a89a" class="nl kz it nh b gy nm nn l no np"># get the best performing model<br/>model = clf.export_model()</span><span id="a86a" class="nl kz it nh b gy ny nn l no np"># display the architecture of the best performing model<br/>model.summary()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/261a3e6f7da6c606d724014d88a9766f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_V_ihwdZLvaVexoWfR7Oxw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">运行 max_trials=3 的实验后获得的最佳性能模型的体系结构。图片作者。</p></figure><p id="ecc6" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">重要的是要记住，这个模型来自一个不同的过程，而不是超参数调整。在超参数调整中，模型是已知的，我们通过在给定范围的可能值中搜索来调整一些参数，以提高性能。相反，对于 NAS，我们试图确定模型体系结构本身。因此，其他培训工作可能会导致不同于上面显示的模型架构。</p><p id="2981" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">还可以保存和加载模型以备将来使用:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="1f4e" class="nl kz it nh b gy nm nn l no np">from tensorflow.keras.models import load_model</span><span id="9b60" class="nl kz it nh b gy ny nn l no np"># save the model on disk<br/>model.save("text_classifier", save_format = "tf")</span><span id="fd3f" class="nl kz it nh b gy ny nn l no np"># load the model from disk<br/>loaded_model = load_model("text_classifier",<br/>                          custom_objects = ak.CUSTOM_OBJECTS)</span><span id="226d" class="nl kz it nh b gy ny nn l no np"># use loaded model for future predictions on new samples<br/>loaded_model.predict(x_test)</span></pre><h1 id="82ea" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">6.结论</h1><p id="f128" class="pw-post-body-paragraph mo mp it ls b lt lu ju mq lv lw jx mr lx ms mt mu lz mv mw mx mb my mz na md im bi translated">在这篇文章中，我们用几行代码创建了一个强大的文本分类器。我们利用了 AutoML 的强大功能和直观简洁的 AutoKeras 界面。</p><p id="06d5" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">AutoML 寻求简化机器学习。它通过自动化人类实验中最耗时的阶段来减少人工劳动。它还使缺乏该领域更深知识的观众更容易采用机器学习。</p><p id="1113" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">AutoKeras 官方文档包含更多示例和高级主题。</p><h1 id="73b5" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">7.参考</h1><p id="6ba4" class="pw-post-body-paragraph mo mp it ls b lt lu ju mq lv lw jx mr lx ms mt mu lz mv mw mx mb my mz na md im bi translated">[1]<a class="ae mi" href="https://en.wikipedia.org/wiki/Neural_architecture_search" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Neural_architecture_search</a></p><p id="b88f" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">[2]<a class="ae mi" href="https://autokeras.com/" rel="noopener ugc nofollow" target="_blank">https://autokeras.com/</a></p><p id="8a97" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">[3]金海峰、宋清泉、；<em class="oc"> Auto-keras:一个高效的神经结构搜索系统</em>；第 25 届 ACM SIGKDD 知识发现国际会议论文集&amp;数据挖掘；ACM2019 ( <a class="ae mi" href="https://arxiv.org/abs/1806.10282" rel="noopener ugc nofollow" target="_blank">环节</a>)</p><p id="91ba" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated"><a class="ae mi" href="https://colab.research.google.com/" rel="noopener ugc nofollow" target="_blank">https://colab.research.google.com/</a></p><p id="3b60" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated"><a class="ae mi" href="https://archive.ics.uci.edu/ml/datasets/sms+spam+collection" rel="noopener ugc nofollow" target="_blank">https://archive.ics.uci.edu/ml/datasets/sms+spam+collection</a></p><p id="1dd6" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated"><a class="ae mi" href="https://archive.ics.uci.edu/ml/index.php" rel="noopener ugc nofollow" target="_blank">https://archive.ics.uci.edu/ml/index.php</a></p><p id="6640" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated"><a class="ae mi" href="https://autokeras.com/text_classifier/" rel="noopener ugc nofollow" target="_blank">https://autokeras.com/text_classifier/</a></p></div></div>    
</body>
</html>