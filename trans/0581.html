<html>
<head>
<title>Let the Script Find Out the ML Model that Outperforms Yours</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让脚本找出优于您的ML模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-automl-sklearn-fd85d3b3c5e#2022-02-23">https://towardsdatascience.com/python-automl-sklearn-fd85d3b3c5e#2022-02-23</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="ed5e" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">这个自动ML Python库让每个人都成为数据科学向导</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/913424f02870fbf7050e73a15a601dd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7yQWQAKUvR_cuJW1Ao5AXA.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">将数据科学交给AutoML —照片由<a class="ae kz" href="https://www.pexels.com/@rozegold?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Aidan Roof </a>从<a class="ae kz" href="https://www.pexels.com/photo/person-on-truck-s-roof-2449600/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>拍摄</p></figure><p id="0847" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">自动化是一个古老的概念，它改变了一切。我们发明的所有机器和技术都是一种方式，或者说是一种自动化形式。</p><p id="89d4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">数据科学领域是我们自动化思维的一种方式。我们不是手动给物体贴标签，而是训练计算机大规模地这样做。</p><p id="d37d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是教授计算机的过程在很长一段时间里是手工操作的；直到最近，科学家们还在考虑AutoML。</p><p id="88aa" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">构建预测系统是一个多阶段的过程。它可能包括</p><ul class=""><li id="5d94" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">收集数据(或整合数据源；)</li><li id="4cc0" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">准备数据集；</li><li id="97f5" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">训练机器学习模型和调整超参数；</li><li id="86bf" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">在生产系统上部署模型，以及；</li><li id="eaa6" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">监控已部署模型的性能。</li></ul><p id="02ab" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Auto ML是一个术语，指的是在这些阶段中消除手工操作的技术。</p><div class="mk ml gq gs mm mn"><a rel="noopener follow" target="_blank" href="/how-to-become-a-citizen-data-scientist-294660da0494"><div class="mo ab fp"><div class="mp ab mq cl cj mr"><h2 class="bd iv gz z fq ms fs ft mt fv fx it bi translated">欢迎来到公民数据科学家的时代</h2><div class="mu l"><h3 class="bd b gz z fq ms fs ft mt fv fx dk translated">数据科学在很大程度上已经被大众化。AI现在是主流！</h3></div><div class="mv l"><p class="bd b dl z fq ms fs ft mt fv fx dk translated">towardsdatascience.com</p></div></div><div class="mw l"><div class="mx l my mz na mw nb kt mn"/></div></div></a></div><p id="5fae" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">很多数据科学家用Python，大部分用scikit-learn。很难找到不是这样的人。</p><p id="d10b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Scikit-learn提供了优秀的高级API来构建ML模型。他们删除了大量样板代码，否则这些代码会让科学家们抓狂。</p><p id="c64f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这篇文章是关于一个将scikit-learn推进了一步的工具——auto-sk learn。你可以从<a class="ae kz" href="https://papers.neurips.cc/paper/5872-efficient-and-robust-automated-machine-learning" rel="noopener ugc nofollow" target="_blank">高效稳健的自动化机器学习</a>，福雷尔<em class="nc">等人</em>，神经信息处理系统进展28 (NIPS 2015)中了解更多。</p><h1 id="d19c" class="nd ne iu bd nf ng nh ni nj nk nl nm nn ka no kb np kd nq ke nr kg ns kh nt nu bi translated">为什么我们需要在sklearn之上安装auto-sklearn？</h1><p id="78c0" class="pw-post-body-paragraph la lb iu lc b ld nv jv lf lg nw jy li lj nx ll lm ln ny lp lq lr nz lt lu lv in bi translated">除了数据清理和准备，数据科学家生活中最具挑战性的部分是找到正确的模型。</p><p id="7f53" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当AutoML还不流行的时候，我和我的团队有过几周这样做的经历。虽然如果你是初学者，我仍然推荐这种方法，但对于实际项目来说，它可能不是最佳的。</p><p id="ab10" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果不充分利用你的脑力，你会陷入困境。反复改变超参数并等待结果并不能更好地利用你的智力技能。</p><div class="mk ml gq gs mm mn"><a rel="noopener follow" target="_blank" href="/is-deep-learning-right-for-you-b59a2219c457"><div class="mo ab fp"><div class="mp ab mq cl cj mr"><h2 class="bd iv gz z fq ms fs ft mt fv fx it bi translated">如何评价深度学习是否适合自己？</h2><div class="mu l"><h3 class="bd b gz z fq ms fs ft mt fv fx dk translated">可能不会！在浪费时间之前，这里是你需要知道的</h3></div><div class="mv l"><p class="bd b dl z fq ms fs ft mt fv fx dk translated">towardsdatascience.com</p></div></div><div class="mw l"><div class="oa l my mz na mw nb kt mn"/></div></div></a></div><p id="8f67" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这就是auto-sklearn解决的问题。你可以让计算机改变超参数，评估它们的输出，然后<strong class="lc iv">选择最佳模型</strong>。另外，你可以<strong class="lc iv">给培训设定一个时间限制</strong>。除了这些好处，你可以在桌面分布式系统上运行并行的贝叶斯优化。</p><p id="1f2a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可以从PyPI存储库中安装auto-sklearn。下面的代码将安装这个库，并通过检查它的版本来确认。</p><pre class="kk kl km kn gu ob oc od oe aw of bi"><span id="2972" class="og ne iu oc b gz oh oi l oj ok">pip install auto-sklearn<br/>python -c "import autosklearn;print(autosklearn.__version__)"</span><span id="1067" class="og ne iu oc b gz ol oi l oj ok"># 0.14.6</span></pre><p id="c65a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">其他安装方法请参考<a class="ae kz" href="https://automl.github.io/auto-sklearn/master/installation.html" rel="noopener ugc nofollow" target="_blank"> auto-sklearn文档</a>。</p><h1 id="7e53" class="nd ne iu bd nf ng nh ni nj nk nl nm nn ka no kb np kd nq ke nr kg ns kh nt nu bi translated">为我们的数据集构建(自动)ML模型。</h1><p id="e9cb" class="pw-post-body-paragraph la lb iu lc b ld nv jv lf lg nw jy li lj nx ll lm ln ny lp lq lr nz lt lu lv in bi translated">让我们开始使用自动学习建立一个实际的模型。</p><p id="bcb1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">为了便于说明，我使用了Kaggle上的<a class="ae kz" href="https://www.kaggle.com/yasserh/wine-quality-dataset" rel="noopener ugc nofollow" target="_blank">葡萄酒质量数据集</a>。</p><p id="d441" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">该数据集包括11个预测变量和一个响应变量。响应变量葡萄酒质量有六个不同的等级。我们的任务是建立一个机器学习模型，在给定其他变量的情况下预测质量类别。</p><p id="7952" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">以下命令将加载数据集，并为模型定型做准备。它删除id列并分隔响应变量。</p><pre class="kk kl km kn gu ob oc od oe aw of bi"><span id="501d" class="og ne iu oc b gz oh oi l oj ok">import pandas as pd</span><span id="b683" class="og ne iu oc b gz ol oi l oj ok">df = pd.read_csv('./WineQT.csv')</span><span id="f41d" class="og ne iu oc b gz ol oi l oj ok">df.drop('Id', axis=1, inplace=True)</span><span id="c50c" class="og ne iu oc b gz ol oi l oj ok">y = df.quality.copy()<br/>X = df.drop('quality', axis=1)</span></pre><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="om on l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">葡萄酒质量数据集的特征变量— <a class="ae kz" href="https://www.kaggle.com/yasserh/wine-quality-dataset" rel="noopener ugc nofollow" target="_blank"> <br/> CC0:公共领域</a></p></figure><p id="78bd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们也将数据集分成几组进行训练和测试。</p><pre class="kk kl km kn gu ob oc od oe aw of bi"><span id="04bf" class="og ne iu oc b gz oh oi l oj ok">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=1)</span></pre><p id="37d1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">到目前为止，我们还没有做任何与通常使用scikit-learn不同的事情。但是这里有一个auto-sklearn API，它可以训练多个模型，并找到最适合我们的模型。</p><pre class="kk kl km kn gu ob oc od oe aw of bi"><span id="c4f5" class="og ne iu oc b gz oh oi l oj ok">model = AutoSklearnClassifier(<br/>    time_left_for_this_task=5*60,<br/>    per_run_time_limit=30<br/>)</span></pre><p id="1cdc" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在上面的代码中，我们给出了两个参数值。这些不是模型超参数。相反，我们限制了训练过程的时间。</p><p id="b32d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本例中，我们将API配置为每次运行30秒(对于一组特定的超参数)，整个过程不超过5分钟。</p><p id="9de4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">出于说明目的，这些数字是任意的。在决定这些值之前，您应该考虑真实情况下的数据集大小和计算资源。</p><p id="d2be" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们也根据我们的测试集来评估我们的结果模型。</p><pre class="kk kl km kn gu ob oc od oe aw of bi"><span id="9cd7" class="og ne iu oc b gz oh oi l oj ok">y_hat = model.predict(X_test)<br/>acc = accuracy_score(y_test, y_hat)<br/>print(f"Model Accuracy:{acc}")</span><span id="9f18" class="og ne iu oc b gz ol oi l oj ok">Model Accuracy:0.6693121693121693</span></pre><p id="47df" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这是一个相当不错的葡萄酒质量分类的准确性。</p><p id="d891" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果我们自己找出最好的模型会是什么样的？</p><h1 id="1390" class="nd ne iu bd nf ng nh ni nj nk nl nm nn ka no kb np kd nq ke nr kg ns kh nt nu bi translated">手工建立分类器的方法及其问题。</h1><p id="fa15" class="pw-post-body-paragraph la lb iu lc b ld nv jv lf lg nw jy li lj nx ll lm ln ny lp lq lr nz lt lu lv in bi translated">如果你想用scikit-learn来做这件事，你需要像下面这样的东西。这里的问题是你不知道<code class="fe oo op oq oc b">max_features</code>和<code class="fe oo op oq oc b">n_estimators.</code>的最佳值</p><pre class="kk kl km kn gu ob oc od oe aw of bi"><span id="f892" class="og ne iu oc b gz oh oi l oj ok">RandomForestClassifier(max_features=15, n_estimators=512)</span></pre><p id="04f8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">为了找到比其他组更好的一组，您可能需要为这些超参数尝试几个不同的数字。</p><p id="53fa" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但这只是在我们确信模型将是随机森林模型的时候。如果没有，你可能还得尝试其他算法。这给我们的流程增加了额外的复杂性。</p><p id="f7b4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">另一方面，auto-sklearn在很短的时间间隔内用许多超参数尝试了大约15个不同的分类器。</p><p id="93bf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们还可以看到auto-sklearn尝试的不同模型及其在此过程中的排名。下面的代码将打印所有跑步的排行榜。</p><pre class="kk kl km kn gu ob oc od oe aw of bi"><span id="4603" class="og ne iu oc b gz oh oi l oj ok">model.leaderboard()</span></pre><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="om on l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Auto-sklearn排行榜告诉我们在我们的数据集上试用的不同算法及其统计数据。</p></figure><p id="20b7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果我们需要更多地了解这些不同的模型，我们可以调用show_models方法来获取细节。</p><div class="mk ml gq gs mm mn"><a rel="noopener follow" target="_blank" href="/become-a-data-scientist-or-data-engineer-without-coding-skills-fbf11ac8e278"><div class="mo ab fp"><div class="mp ab mq cl cj mr"><h2 class="bd iv gz z fq ms fs ft mt fv fx it bi translated">如何在不编码的情况下成为一名出色的数据科学家(+工程师)</h2><div class="mu l"><h3 class="bd b gz z fq ms fs ft mt fv fx dk translated">从数据中获得意义是常识。编码技能不是数据科学家或数据工程师的超能力。</h3></div><div class="mv l"><p class="bd b dl z fq ms fs ft mt fv fx dk translated">towardsdatascience.com</p></div></div><div class="mw l"><div class="or l my mz na mw nb kt mn"/></div></div></a></div><h1 id="1144" class="nd ne iu bd nf ng nh ni nj nk nl nm nn ka no kb np kd nq ke nr kg ns kh nt nu bi translated">用AutoML在大数据集上训练ML模型</h1><p id="20d8" class="pw-post-body-paragraph la lb iu lc b ld nv jv lf lg nw jy li lj nx ll lm ln ny lp lq lr nz lt lu lv in bi translated">当数据集很大时，自动ML技术将消耗更多的资源，并且运行更长的时间。</p><p id="8fe9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是凭借我们的专业知识和偏好，我们可以大大缩短这个时间。以下代码将分类器搜索空间限制为高斯朴素贝叶斯和k个最近邻。</p><p id="4dbb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们也可以关闭特征预处理。如果我们的任何特征是分类的，auto-sklearn会自动进行一次性编码。在大型数据集上，这可能需要相当长的时间。</p><pre class="kk kl km kn gu ob oc od oe aw of bi"><span id="bd44" class="og ne iu oc b gz oh oi l oj ok">automl = autosklearn.classification.AutoSklearnClassifier(<br/>    include = {<br/>        'classifier': ["gaussian_nb", "k_nearest_neighbors"],<br/>        'feature_preprocessor': ["no_preprocessing"]<br/>    },<br/>    exclude=<strong class="oc iv">None</strong><br/>)</span></pre><p id="5e01" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">include和exclude配置使我们能够更好地控制AutoML搜索空间。然而，对于小数据集，我不会改变它们。这确保了我得到的模型是最好的，超出了我的启发式假设。</p><h1 id="51f0" class="nd ne iu bd nf ng nh ni nj nk nl nm nn ka no kb np kd nq ke nr kg ns kh nt nu bi translated">最后的想法</h1><p id="998d" class="pw-post-body-paragraph la lb iu lc b ld nv jv lf lg nw jy li lj nx ll lm ln ny lp lq lr nz lt lu lv in bi translated">在我们结束之前，我有一些想法要分享。</p><p id="3f2c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">auto-sklearn等自动ML库解决了每个数据科学家面临的噩梦般的问题。如果没有这样的工具，熟练的专业人员的宝贵时间将被浪费。</p><p id="8b16" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是不能保证AutoML模型永远是最好的。数据科学家可以通过领域知识和专业技能找到更好的模型。</p><p id="e3fe" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是AutoML会是未来吗？</p><p id="7802" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我想是的。</p><p id="6c63" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当汽车上的自动变速器上市时，许多人批评它有一些小缺点。但是今天，自动挡的车比手动挡的车多。</p><p id="3610" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">就像汽车类比一样，Auto ML在这一点上可能并不完美。但很快就能超越专业科学家。</p><blockquote class="os ot ou"><p id="edc8" class="la lb nc lc b ld le jv lf lg lh jy li ov lk ll lm ow lo lp lq ox ls lt lu lv in bi translated">数据集鸣谢:<a class="ae kz" href="https://www.kaggle.com/yasserh/wine-quality-dataset/metadata" rel="noopener ugc nofollow" target="_blank">葡萄酒质量数据集</a>作者:<a class="ae kz" href="https://www.kaggle.com/yasserh" rel="noopener ugc nofollow" target="_blank"> M Yasser </a>来自<a class="ae kz" href="https://www.kaggle.com/" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>，CC0:公共领域许可。</p></blockquote></div><div class="ab cl oy oz hy pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="in io ip iq ir"><blockquote class="os ot ou"><p id="011d" class="la lb nc lc b ld le jv lf lg lh jy li ov lk ll lm ow lo lp lq ox ls lt lu lv in bi translated">感谢阅读，在<a class="ae kz" href="https://www.linkedin.com/in/thuwarakesh/" rel="noopener ugc nofollow" target="_blank"> <strong class="lc iv"> LinkedIn </strong> </a>，<a class="ae kz" href="https://twitter.com/Thuwarakesh" rel="noopener ugc nofollow" target="_blank"> <strong class="lc iv"> Twitter </strong> </a>，<a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener"> <strong class="lc iv"> Medium </strong> </a>上向我问好。</p><p id="7450" class="la lb nc lc b ld le jv lf lg lh jy li ov lk ll lm ow lo lp lq ox ls lt lu lv in bi translated">还不是中等会员？请使用此链接<a class="ae kz" href="https://thuwarakesh.medium.com/membership" rel="noopener"> <strong class="lc iv">成为会员</strong> </a>因为，不需要你额外付费，我为你引荐赚取一小笔佣金。</p></blockquote></div></div>    
</body>
</html>