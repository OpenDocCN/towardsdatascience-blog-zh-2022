<html>
<head>
<title>From Raw Data to a Cleaned Database: A Deep Dive into Versatile Data Kit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从原始数据到干净的数据库:对多功能数据工具包的深入研究</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/from-raw-data-to-a-cleaned-database-a-deep-dive-into-versatile-data-kit-ab5fd992a02e#2022-02-11">https://towardsdatascience.com/from-raw-data-to-a-cleaned-database-a-deep-dive-into-versatile-data-kit-ab5fd992a02e#2022-02-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="570c" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">数据库ˌ资料库</h2><div class=""/><div class=""><h2 id="08f9" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用通用数据工具包(VMware 最近发布的一个框架)和 Trino DB 的完整示例</h2></div><figure class="ks kt ku kv gu kw gi gj paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gi gj kr"><img src="../Images/2dc106dec8ed22e212882d3f770c7676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EWbHOC-H-zAZiqy9"/></div></div><p class="ld le gk gi gj lf lg bd b be z dk translated">马库斯·温克勒在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="67c5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最近，VMware 发布了一款新的开源工具，名为<a class="ae lh" href="https://github.com/vmware/versatile-data-kit" rel="noopener ugc nofollow" target="_blank">通用数据工具包</a>(简称 VDK)，可以非常快速地管理数据。该工具允许用几行代码将不同格式的数据接收到一个数据库中。</p><p id="adee" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我之前的文章中，我描述了一个基本的例子，它使用了 VDK，并且描述了如何安装和运行它。总而言之，您应该:</p><ul class=""><li id="da63" class="me mf it lk b ll lm lo lp lr mg lv mh lz mi md mj mk ml mm bi translated">有一个运行的数据库(VDK 以外)</li><li id="17c9" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">在 VDK 中配置数据库接口，包括用户名、口令、主机和端口</li><li id="75b3" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">在 VDK 定义如何使用 SQL 查询或用 Python 实现的更复杂的过程接收数据库中的数据。</li></ul><p id="bbdf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦您在数据库中获取了数据，您就可以根据需要使用它们，例如，构建有趣的仪表板或可视化。</p><p id="5d0a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本文中，我主要关注一个完整的例子，从数据接收开始，一直到数据处理。该示例使用 Trino 数据库和 MySQL 服务器来存储数据，使用 VDK 来接收数据库中的数据。</p><p id="59fe" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下图显示了一个可能的架构，包括 VDK、Trino 服务器和 MySQL 服务器:</p><figure class="ks kt ku kv gu kw gi gj paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gi gj ms"><img src="../Images/00ab749e0cdcf5e1874a59cd6a9debbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xkxtXDsckFnQgOpA2bKBFQ.jpeg"/></div></div><p class="ld le gk gi gj lf lg bd b be z dk translated">作者图片</p></figure><p id="2b2a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">具体来说，文章组织如下:</p><ul class=""><li id="f51b" class="me mf it lk b ll lm lo lp lr mg lv mh lz mi md mj mk ml mm bi translated">场景的定义</li><li id="54ec" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">数据库的设置</li><li id="1e66" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">VDK 的数据接收</li><li id="ba6f" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">VDK 的数据处理</li></ul><h1 id="2fb6" class="mt mu it bd mv mw mx my mz na nb nc nd ki ne kj nf kl ng km nh ko ni kp nj nk bi translated">1 情景的定义</h1><p id="f82f" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">该方案的目标是分析美国不同地区的预期寿命，并将它们与该地区的国内生产总值(GDP)进行比较。为了实现这一目标，您应该下载与美国预期寿命相关的数据，并将其与相关的 GDP 合并。</p><blockquote class="nq"><p id="ca7f" class="nr ns it bd nt nu nv nw nx ny nz md dk translated">这个例子展示了如何通过 VDK 提取和集成这个场景所需的数据。</p></blockquote><p id="4d20" class="pw-post-body-paragraph li lj it lk b ll oa kd ln lo ob kg lq lr oc lt lu lv od lx ly lz oe mb mc md im bi translated">我们可以使用以下两个数据集，它们都以 CSV 文件的形式提供:</p><ul class=""><li id="e16f" class="me mf it lk b ll lm lo lp lr mg lv mh lz mi md mj mk ml mm bi translated"><a class="ae lh" href="https://catalog.data.gov/dataset/u-s-life-expectancy-at-birth-by-state-and-census-tract-2010-2015" rel="noopener ugc nofollow" target="_blank">2010-2015 年美国各州和人口普查区的出生时预期寿命</a></li><li id="0ece" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated"><a class="ae lh" href="https://catalog.data.gov/dataset/u-s-state-life-expectancy-by-sex-2018" rel="noopener ugc nofollow" target="_blank">2018 年美国各州按性别划分的预期寿命</a></li></ul><p id="5312" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">之前的数据集是在美国政府工程许可下发布的。</p><p id="c2c9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">除了前面的数据集，我们还可以使用以下附加数据集:</p><ul class=""><li id="8fcc" class="me mf it lk b ll lm lo lp lr mg lv mh lz mi md mj mk ml mm bi translated"><a class="ae lh" href="https://www.bea.gov/data/gdp/gdp-county-metro-and-other-areas" rel="noopener ugc nofollow" target="_blank">美国各县国内生产总值</a></li><li id="e9cf" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated"><a class="ae lh" href="https://raw.githubusercontent.com/cphalpert/census-regions/master/us%20census%20bureau%20regions%20and%20divisions.csv" rel="noopener ugc nofollow" target="_blank">美国人口普查局地区和部门</a>(摘自<a class="ae lh" href="https://www.census.gov/geographies/reference-maps/2010/geo/2010-census-regions-and-divisions-of-the-united-states.html" rel="noopener ugc nofollow" target="_blank">本官方链接</a>)</li></ul><p id="463e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">前两个数据集分别由美国经济分析局和美国人口普查局发布，两者都在公共许可下提供开放数据。</p><p id="9574" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">数据集<em class="of">2010-2015 年美国各州和人口普查区出生时预期寿命</em>包含 73，121 条与 2010-2015 年期间美国人预期寿命相关的记录，按州和县划分。</p><p id="5e34" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下图显示了数据集的摘录:</p><figure class="ks kt ku kv gu kw gi gj paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gi gj og"><img src="../Images/08cf385094dba41f4507c16a484b18fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RU_-3E0HEqKzwglVg9Uoeg.png"/></div></div><p class="ld le gk gi gj lf lg bd b be z dk translated">作者图片</p></figure><p id="69fa" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">数据集“2018 年美国各州按性别划分的预期寿命”包含 156 条与 2018 年美国人预期寿命相关的记录，按州和性别(男性、女性、总数)划分。下图显示了数据集的摘录:</p><figure class="ks kt ku kv gu kw gi gj paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gi gj oh"><img src="../Images/353bb76878ea9373dfc825434efb898a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6hO7pKE2AZX1SohQaZUBpg.png"/></div></div><p class="ld le gk gi gj lf lg bd b be z dk translated">作者图片</p></figure><p id="7bef" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">数据集“美国各县国内生产总值”包含 3，163 条与美国各县实际国内生产总值相关的记录，涉及 2017 年至 2020 年期间。数据集包含许多列。下图显示了数据集的摘录:</p><figure class="ks kt ku kv gu kw gi gj paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gi gj oi"><img src="../Images/a1282104e180095ab036767ef6e6b71f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wGd8BpTrVQxih5TKWPYTaQ.png"/></div></div><p class="ld le gk gi gj lf lg bd b be z dk translated">作者图片</p></figure><p id="a836" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">数据集“美国各县国内生产总值”包含 3，163 条与美国各县实际国内生产总值相关的记录，涉及 2017 年至 2020 年期间。数据集包含许多列。下图显示了数据集的摘录:</p><figure class="ks kt ku kv gu kw gi gj paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gi gj oj"><img src="../Images/5a7ac816b95c83b20f634bd7733427b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wvLIrKikquR5_0ymUFOJrg.png"/></div></div><p class="ld le gk gi gj lf lg bd b be z dk translated">作者图片</p></figure><h1 id="34f7" class="mt mu it bd mv mw mx my mz na nb nc nd ki ne kj nf kl ng km nh ko ni kp nj nk bi translated">2 数据库的设置</h1><p id="2a47" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">我们将所有数据存储在 Trino 数据库中，作为 MySQL 服务器的接口。<a class="ae lh" href="https://trino.io/" rel="noopener ugc nofollow" target="_blank"> Trino </a>是一款用于大数据分析的分布式开源 SQL 查询引擎。它运行分布式和并行查询，速度非常快。对于 Trino 数据库的设置，你可以遵循<a class="ae lh" rel="noopener" target="_blank" href="/getting-started-with-trino-query-engine-dc6a2d027d5">我之前的教程</a>。</p><p id="f101" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本例中，Trino 在本地运行，具有以下最小的<code class="fe ok ol om on b">config.properties</code>配置文件:</p><pre class="ks kt ku kv gu oo on op oq aw or bi"><span id="8e2d" class="os mu it on b gz ot ou l ov ow">coordinator=true<br/>node-scheduler.include-coordinator=true<br/>http-server.http.port=8080<br/>query.max-memory=5GB<br/>query.max-memory-per-node=1GB<br/>query.max-total-memory-per-node=2GB<br/>discovery.uri=http://127.0.0.1:8080<br/>http-server.https.enabled=false</span></pre><p id="6be1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此外，Trino DB 使用 MySQL 目录，配置如下(文件<code class="fe ok ol om on b">mysql.properties</code>位于 Trino 服务器的目录文件夹中):</p><pre class="ks kt ku kv gu oo on op oq aw or bi"><span id="615e" class="os mu it on b gz ot ou l ov ow">connector.name=mysql<br/>connection-url=jdbc:mysql://localhost:3306<br/>connection-user=root<br/>connection-password=<br/>allow-drop-table=true</span></pre><p id="3695" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，这个例子假设 MySQL 服务器上存在一个名为<code class="fe ok ol om on b">life-expectancy</code>的空模式。</p><h1 id="9b1c" class="mt mu it bd mv mw mx my mz na nb nc nd ki ne kj nf kl ng km nh ko ni kp nj nk bi translated">3 VDK 的数据接收</h1><p id="c1af" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">VDK 使用以下配置运行(<code class="fe ok ol om on b">config.ini</code>):</p><pre class="ks kt ku kv gu oo on op oq aw or bi"><span id="5604" class="os mu it on b gz ot ou l ov ow">db_default_type=TRINO<br/>ingest_method_default = trino<br/>trino_catalog = mysql<br/>trino_use_ssl =<br/>trino_host = localhost<br/>trino_port = 8080<br/>trino_user = root<br/>trino_schema = life-expectancy<br/>trino_ssl_verify =</span></pre><p id="3bbe" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">数据摄取将数据源部分中定义的两个 CSV 表上传到数据库中。对于每个表，通过以下步骤执行数据接收:</p><ul class=""><li id="6ec2" class="me mf it lk b ll lm lo lp lr mg lv mh lz mi md mj mk ml mm bi translated">删除现有的表(如果有)</li><li id="898d" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">创建新表格</li><li id="ce34" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">直接从 CSV 文件中摄取表格值。</li></ul><p id="2e3b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">前两步将使用 SQL 语言编写，而最后一步将使用 Python 编写。</p><p id="09d4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">每个数据集都将被包含在一个名称与数据集名称相似的表中。例如，<a class="ae lh" href="https://catalog.data.gov/dataset/u-s-life-expectancy-at-birth-by-state-and-census-tract-2010-2015" rel="noopener ugc nofollow" target="_blank">美国出生时预期寿命(按州和人口普查区域)——2010–2015</a>数据集将被纳入<code class="fe ok ol om on b">life_expectancy_2010_2015</code>表中。</p><h2 id="609d" class="os mu it bd mv ox oy dn mz oz pa dp nd lr pb pc nf lv pd pe nh lz pf pg nj iz bi translated">3.1 删除现有表格</h2><p id="afb6" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">首先，我创建一个脚本，命名为<code class="fe ok ol om on b">01_delete_table_life_expectancy_2010_2015.sql</code>:</p><pre class="ks kt ku kv gu oo on op oq aw or bi"><span id="b689" class="os mu it on b gz ot ou l ov ow"><strong class="on jd">DROP TABLE IF EXISTS</strong> life_expectancy_2010_2015</span></pre><p id="6064" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">脚本名称前面的数字<code class="fe ok ol om on b">01</code>表示 VDK 框架将把它作为第一个脚本运行。</p><p id="66f9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我还创建了<code class="fe ok ol om on b">02_delete_table_life_expectancy_2018.sql</code>脚本，它删除了<code class="fe ok ol om on b">life_expectancy_2018</code>表，其他脚本删除了<code class="fe ok ol om on b">us_regions</code>和<code class="fe ok ol om on b">us_gdp</code>表。</p><h2 id="f940" class="os mu it bd mv ox oy dn mz oz pa dp nd lr pb pc nf lv pd pe nh lz pf pg nj iz bi translated">3.2 创建新表</h2><p id="b067" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">现在，我为新表创建模式，并将其存储在<code class="fe ok ol om on b">03_create_table_life_expectancy_2010_2015.sql</code>脚本中:</p><pre class="ks kt ku kv gu oo on op oq aw or bi"><span id="9106" class="os mu it on b gz ot ou l ov ow"><strong class="on jd">CREATE TABLE</strong> life_expectancy_2010_2015 (<br/>   State varchar(32),<br/>   County varchar(32),<br/>   CensusTractNumber varchar(32),<br/>   LifeExpectancy decimal(4,2),<br/>   LifeExpectancyRange varchar,<br/>   LifeExpectancyStandardError decimal(4,2)<br/>)</span></pre><p id="fc31" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">与前面的脚本类似，我创建了<code class="fe ok ol om on b">04_create_table_life_expectancy_2018.sql</code>:</p><pre class="ks kt ku kv gu oo on op oq aw or bi"><span id="9893" class="os mu it on b gz ot ou l ov ow"><strong class="on jd">CREATE TABLE</strong> life_expectancy_2018 (<br/>   State varchar(32),<br/>   Sex varchar(32),<br/>   LEB decimal(3,1),<br/>   SE decimal(3,1),<br/>   Quartile varchar(32)<br/>)</span></pre><p id="7337" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">以及<code class="fe ok ol om on b">us_regions</code>和<code class="fe ok ol om on b">us_gdp</code>表:</p><pre class="ks kt ku kv gu oo on op oq aw or bi"><span id="b42b" class="os mu it on b gz ot ou l ov ow"><strong class="on jd">CREATE TABLE</strong> us_regions (<br/>   State varchar(32),<br/>   StateCode varchar(2),<br/>   Region varchar(32),<br/>   Division varchar(32)<br/>)</span><span id="2e0b" class="os mu it on b gz ph ou l ov ow"><strong class="on jd">CREATE TABLE</strong> us_gdp (<br/>   County varchar(32),<br/>   Year2017 bigint,<br/>   Year2018 bigint,<br/>   Year2019 bigint,<br/>   Year2020 bigint<br/>)</span></pre><h2 id="f229" class="os mu it bd mv ox oy dn mz oz pa dp nd lr pb pc nf lv pd pe nh lz pf pg nj iz bi translated">3.2 直接从 CSV 文件摄取表格值</h2><p id="ad7c" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">最后，我可以接收<code class="fe ok ol om on b">life_expectancy_2010_2015</code>表中的表值。我使用 VDK API 提供的<code class="fe ok ol om on b">IJobInput</code>类。我定义了一个将被 VDK 框架读取的<code class="fe ok ol om on b">run()</code>函数，并在其中编写了摄取代码:</p><pre class="ks kt ku kv gu oo on op oq aw or bi"><span id="8f13" class="os mu it on b gz ot ou l ov ow">import pandas as pd<br/>from vdk.api.job_input import IJobInput</span><span id="1e97" class="os mu it on b gz ph ou l ov ow">def <strong class="on jd">run</strong>(job_input: IJobInput):</span><span id="0847" class="os mu it on b gz ph ou l ov ow">  # Read CSV file</span><span id="87a4" class="os mu it on b gz ph ou l ov ow">   url = "http://data.cdc.gov/api/views/5h56-n989/rows.csv"<br/>   dtypes = {<br/>      "State": str,<br/>      "County": str,<br/>      "Census Tract Number": str,<br/>      "Life Expectancy": np.float64,<br/>      "Life Expectancy Range": str,<br/>      "Life Expectancy Standard Error": np.float64,<br/>   }</span><span id="2e16" class="os mu it on b gz ph ou l ov ow">   df = pd.read_csv(url, dtype=dtypes).replace("'", "''", regex=True)<br/>   df.columns = df.columns.str.replace(" ", "")</span><span id="341d" class="os mu it on b gz ph ou l ov ow">   # Ingest CSV file</span><span id="a708" class="os mu it on b gz ph ou l ov ow">  job_input.<strong class="on jd">send_tabular_data_for_ingestion</strong>(<br/>      df.itertuples(index=False),<br/>      destination_table="life_expectancy_2010_2015",<br/>      column_names=df.columns.tolist()<br/> )</span></pre><p id="8689" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了获取数据库中 CSV 的每一行，我使用了<code class="fe ok ol om on b">IJobInput</code>类的<code class="fe ok ol om on b">send_tabular_data_for_ingestion()</code>方法。</p><p id="b971" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以用同样的技术摄取其他数据集。</p><h1 id="27b5" class="mt mu it bd mv mw mx my mz na nb nc nd ki ne kj nf kl ng km nh ko ni kp nj nk bi translated">4 VDK 的数据处理</h1><p id="fb1d" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">数据处理包括以下任务:</p><ul class=""><li id="3553" class="me mf it lk b ll lm lo lp lr mg lv mh lz mi md mj mk ml mm bi translated">清洁桌子</li><li id="ca5e" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">合并已清理的表</li></ul><h2 id="b5b2" class="os mu it bd mv ox oy dn mz oz pa dp nd lr pb pc nf lv pd pe nh lz pf pg nj iz bi translated">4.1 清洁桌子</h2><p id="739e" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">清洁<code class="fe ok ol om on b">life_expectancy_2010_2015</code>工作台包括以下两个操作:</p><ul class=""><li id="4a6f" class="me mf it lk b ll lm lo lp lr mg lv mh lz mi md mj mk ml mm bi translated">按县分组记录</li><li id="be63" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">将列<code class="fe ok ol om on b">LifeExpectancyRange</code>拆分成两个十进制列<code class="fe ok ol om on b">MinLifeExpectancyRange</code>和<code class="fe ok ol om on b">MaxLifeExpectancyRange</code>。</li></ul><p id="f3fc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe ok ol om on b">life_expectancy_2010_2015</code>工作台的清洗过程的输出被存储在一个名为<code class="fe ok ol om on b">cleaned_life_expectancy_2010_2015</code>的新表中。</p><p id="9165" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">前面的两个操作都可以通过 SQL 语句实现:</p><pre class="ks kt ku kv gu oo on op oq aw or bi"><span id="29a9" class="os mu it on b gz ot ou l ov ow"><strong class="on jd">CREATE TABLE</strong> cleaned_life_expectancy_2010_2015 <strong class="on jd">AS</strong></span><span id="21e2" class="os mu it on b gz ph ou l ov ow">(<strong class="on jd">SELECT</strong> State,<br/>   LifeExpectancy,<br/>   cast(split(life_expectancy_2010_2015.LifeExpectancyRange,'-')[1] AS decimal(4,2)) AS MinLifeExpectancyRange,<br/>   cast(split(life_expectancy_2010_2015.LifeExpectancyRange,'-')[2] AS decimal(4,2)) AS MaxLifeExpectancyRange,<br/>   LifeExpectancyStandardError<br/><strong class="on jd">FROM</strong> life_expectancy_2010_2015<br/><strong class="on jd">WHERE</strong> County = '(blank)'<br/>)</span></pre><p id="13ea" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在数据集中，所有带有<code class="fe ok ol om on b">County = '(blank)'</code>的行包含给定县的预期寿命总值。因此，只需选择这些行，我就可以轻松地按县分组。</p><p id="7eca" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下图显示了结果表:</p><figure class="ks kt ku kv gu kw gi gj paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gi gj pi"><img src="../Images/9982314009d78260b12c40cde170c708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*26I6TbjXnBqaLh9QLZ1Vvg.png"/></div></div><p class="ld le gk gi gj lf lg bd b be z dk translated">作者图片</p></figure><p id="90df" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，我打扫桌子。清洁<code class="fe ok ol om on b">life_expectancy_2018</code>工作台包括以下操作:</p><ul class=""><li id="9896" class="me mf it lk b ll lm lo lp lr mg lv mh lz mi md mj mk ml mm bi translated">将列<code class="fe ok ol om on b">LEB</code>重命名为<code class="fe ok ol om on b">LifeExpectancy</code></li><li id="7130" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">将列<code class="fe ok ol om on b">SE</code>重命名为<code class="fe ok ol om on b">LifeExpectancyStandardError</code></li><li id="6a98" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">将列<code class="fe ok ol om on b">Quartile</code>分成两个十进制列<code class="fe ok ol om on b">MinLifeExpectancyRange</code>和<code class="fe ok ol om on b">MaxLifeExpectancyRange</code></li><li id="6764" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">仅选择带有<code class="fe ok ol om on b">Sex = 'Total'</code>的行。</li></ul><p id="851c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">前面的所有操作都可以通过一条 SQL 语句实现:</p><pre class="ks kt ku kv gu oo on op oq aw or bi"><span id="aae7" class="os mu it on b gz ot ou l ov ow"><strong class="on jd">CREATE TABLE</strong> cleaned_life_expectancy_2018 AS</span><span id="1f4b" class="os mu it on b gz ph ou l ov ow">(<strong class="on jd">SELECT</strong> State,<br/>    LEB AS LifeExpectancy,<br/>    cast(split(life_expectancy_2018.Quartile,' - ')[1] AS decimal(4,2)) AS MinLifeExpectancyRange,<br/>    cast(split(life_expectancy_2018.Quartile,' - ')[2] AS decimal(4,2)) AS MaxLifeExpectancyRange,<br/>    SE AS LifeExpectancyStandardError</span><span id="9e6f" class="os mu it on b gz ph ou l ov ow">  <strong class="on jd">FROM</strong> life_expectancy_2018<br/>  <strong class="on jd">WHERE</strong> Sex = 'Total' and State &lt;&gt; 'United States'<br/>)</span></pre><p id="60a8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下表显示了<code class="fe ok ol om on b">cleaned_life_expectancy_2018</code>表的示例:</p><figure class="ks kt ku kv gu kw gi gj paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gi gj pj"><img src="../Images/01ef6462c5fbffd74e4efd2aa4183c3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SnYoBZ--6HC2pV2F4QSuqQ.png"/></div></div><p class="ld le gk gi gj lf lg bd b be z dk translated">作者图片</p></figure><p id="93f0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">注意，清理之后，<code class="fe ok ol om on b">cleaned_life_expectancy_2010_2015</code>和<code class="fe ok ol om on b">cleaned_life_expectancy_2018</code>表具有相同的模式。</p><h2 id="3047" class="os mu it bd mv ox oy dn mz oz pa dp nd lr pb pc nf lv pd pe nh lz pf pg nj iz bi translated">4.2 合并清理后的表格</h2><p id="5955" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">最后，我准备合并所有的表。我执行以下操作:</p><ul class=""><li id="89ff" class="me mf it lk b ll lm lo lp lr mg lv mh lz mi md mj mk ml mm bi translated"><strong class="lk jd">垂直合并<code class="fe ok ol om on b">cleaned_life_expectancy_2010_2015</code>和<code class="fe ok ol om on b">cleaned_life_expectancy_2018</code>工作台之间的</strong>；</li><li id="5b52" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated"><strong class="lk jd">结果表与<code class="fe ok ol om on b">us_regions</code>和<code class="fe ok ol om on b">us_gdp</code>表之间的水平合并</strong>。</li></ul><p id="d1b7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">垂直合并意味着将第二个数据集追加到第一个数据集，而水平合并向结果表添加三个新列，称为<code class="fe ok ol om on b">Period</code>、<code class="fe ok ol om on b">GDP</code>和<code class="fe ok ol om on b">Region</code>，结果表称为<code class="fe ok ol om on b">merged_life_expectancy</code>。仅针对带有<code class="fe ok ol om on b">Period = '2018'</code>的记录设置<code class="fe ok ol om on b">GDP</code>属性。对于其他记录，它被设置为<code class="fe ok ol om on b">0</code>，因为它不可用。</p><pre class="ks kt ku kv gu oo on op oq aw or bi"><span id="6ac0" class="os mu it on b gz ot ou l ov ow"><strong class="on jd">CREATE TABLE</strong> merged_life_expectancy <strong class="on jd">AS</strong></span><span id="9f43" class="os mu it on b gz ph ou l ov ow">(<strong class="on jd">SELECT</strong> us_regions.State,<br/>    LifeExpectancy,<br/>    MinLifeExpectancyRange,<br/>    MaxLifeExpectancyRange,<br/>    '2010-2015' AS Period,<br/>    Region,<br/>    0 AS GDP<br/> <strong class="on jd">FROM</strong> cleaned_life_expectancy_2010_2015 <br/>     JOIN us_regions <br/>     ON us_regions.State = cleaned_life_expectancy_2010_2015.State<br/>)</span><span id="deb5" class="os mu it on b gz ph ou l ov ow"><strong class="on jd">UNION</strong></span><span id="8f7b" class="os mu it on b gz ph ou l ov ow">(<strong class="on jd">SELECT</strong> us_regions.State,<br/>    LifeExpectancy,<br/>    MinLifeExpectancyRange,<br/>    MaxLifeExpectancyRange,<br/>    '2018' AS Period,<br/>    Region,<br/>    Year2018 AS GDP<br/><strong class="on jd">FROM</strong> cleaned_life_expectancy_2018<br/>    JOIN us_regions <br/>    ON us_regions.State = cleaned_life_expectancy_2018.State<br/>    INNER JOIN us_gdp <br/>    ON us_gdp.County = cleaned_life_expectancy_2018.State<br/><strong class="on jd">WHERE</strong> Year2018 &gt; 100000000<br/>)</span></pre><p id="a97e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在第二个<code class="fe ok ol om on b">SELECT</code>语句中，<code class="fe ok ol om on b">WHERE</code>条件指定了<code class="fe ok ol om on b">Year2018 &gt; 100000000</code>。这允许只选择县。</p><p id="333b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最终的表格如下表所示:</p><figure class="ks kt ku kv gu kw gi gj paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gi gj pk"><img src="../Images/f99eaef7f2e9985e5d0600f96e97e7a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gUrnawcL0_ZQYZc4YwascA.png"/></div></div><p class="ld le gk gi gj lf lg bd b be z dk translated">作者图片</p></figure><h1 id="905e" class="mt mu it bd mv mw mx my mz na nb nc nd ki ne kj nf kl ng km nh ko ni kp nj nk bi translated">摘要</h1><p id="7038" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">恭喜你！您刚刚学习了如何在 VDK 接收和处理数据！这可以通过用 SQL 和 Python 编写简单的脚本来实现。</p><p id="5431" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这个例子的完整代码可在<a class="ae lh" href="https://github.com/vmware/versatile-data-kit/tree/main/examples/life-expectancy" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p><p id="52d0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下一步是构建显示处理结果的报告。敬请关注，了解如何操作:)</p><p id="dfa1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于多功能数据工具包的问题或疑问，您可以直接加入他们的<a class="ae lh" href="https://join.slack.com/t/versatiledata-rgg2437/shared_invite/zt-tvnl62c3-qP0EUYJZJxb6Ws_eQWyDtQ" rel="noopener ugc nofollow" target="_blank">公共 slack workspace </a>或<a class="ae lh" href="mailto:join-versatiledatakit@groups.vmware.com?subject=Invite%20me%20to%20the%20VDK%20mailing%20list" rel="noopener ugc nofollow" target="_blank">他们的邮件列表</a>或<a class="ae lh" href="https://twitter.com/intent/follow?screen_name=VDKProject" rel="noopener ugc nofollow" target="_blank">在 Twitter 上关注他们</a>。</p><p id="929b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你读到这里，对我来说，今天已经很多了。谢谢！你可以在<a class="ae lh" href="https://alod83.medium.com/which-topics-would-you-like-to-read-c68314dc6813" rel="noopener">这篇文章</a>中读到更多关于我的信息。</p><h1 id="74f0" class="mt mu it bd mv mw mx my mz na nb nc nd ki ne kj nf kl ng km nh ko ni kp nj nk bi translated">相关文章</h1><div class="pl pm gq gs pn po"><a rel="noopener follow" target="_blank" href="/an-overview-of-versatile-data-kit-a812cfb26de7"><div class="pp ab fp"><div class="pq ab pr cl cj ps"><h2 class="bd jd gz z fq pt fs ft pu fv fx jc bi translated">多功能数据工具包概述</h2><div class="pv l"><h3 class="bd b gz z fq pt fs ft pu fv fx dk translated">开始使用多功能数据工具包，这是一个使数据工程师工作更高效的框架</h3></div><div class="pw l"><p class="bd b dl z fq pt fs ft pu fv fx dk translated">towardsdatascience.com</p></div></div><div class="px l"><div class="py l pz qa qb px qc lb po"/></div></div></a></div><div class="pl pm gq gs pn po"><a rel="noopener follow" target="_blank" href="/getting-started-with-trino-query-engine-dc6a2d027d5"><div class="pp ab fp"><div class="pq ab pr cl cj ps"><h2 class="bd jd gz z fq pt fs ft pu fv fx jc bi translated">Trino 查询引擎入门</h2><div class="pv l"><h3 class="bd b gz z fq pt fs ft pu fv fx dk translated">一步一步的教程，介绍如何安装 Trino，将其连接到 SQL server 并编写一个简单的 Python 客户端。</h3></div><div class="pw l"><p class="bd b dl z fq pt fs ft pu fv fx dk translated">towardsdatascience.com</p></div></div><div class="px l"><div class="qd l pz qa qb px qc lb po"/></div></div></a></div><div class="pl pm gq gs pn po"><a href="https://alod83.medium.com/how-to-represent-and-query-hierarchical-data-in-sql-69b6b77577e8" rel="noopener follow" target="_blank"><div class="pp ab fp"><div class="pq ab pr cl cj ps"><h2 class="bd jd gz z fq pt fs ft pu fv fx jc bi translated">如何在 SQL 中表示和查询层次数据</h2><div class="pv l"><h3 class="bd b gz z fq pt fs ft pu fv fx dk translated">关于如何使用关系数据库构建和查询分层表的教程。</h3></div><div class="pw l"><p class="bd b dl z fq pt fs ft pu fv fx dk translated">alod83.medium.com</p></div></div><div class="px l"><div class="qe l pz qa qb px qc lb po"/></div></div></a></div></div></div>    
</body>
</html>