<html>
<head>
<title>How To Automate and Simplify Your Machine Learning Experiment Workflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何自动化和简化您的机器学习实验工作流程</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-automate-and-simplify-your-machine-learning-experiment-workflow-2be19f4aaa6#2022-05-02">https://towardsdatascience.com/how-to-automate-and-simplify-your-machine-learning-experiment-workflow-2be19f4aaa6#2022-05-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8f16" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">ArgParse是一个有用的模块，我用它来执行多个ML实验，并在web应用程序中清晰地报告观察结果</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/90990de3a2909efceac50e28c71a74d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rxdLeEOzm0CHXsQJQMwaeQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@campaign_creators?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">活动发起人</a>在<a class="ae ky" href="https://unsplash.com/s/photos/workflow?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="9aa0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论是为了确定最佳模型，还是为了了解模型对数据或超参数的不同变化的细微差别，您都需要进行大量的机器学习实验。结果可能是有趣的，使模型选择的过程。</p><p id="4cab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为我工作的一部分，我通常不得不执行一些ML实验，这些实验可以是——(比如)测试降维技术、文本预处理技术(在NLP模型的情况下)的有效性，或者像处理测试集大小这样的简单事情。无论哪种方式，您都可能不得不多次运行一个代码，并记录所有观察结果以便以后进行比较。这与超参数调整过程略有不同，我们的目的是确定最适合我们问题的技术。</p><p id="6120" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，在过去的几年中，我从机器学习社区中获得了一些东西，并将其转化为一个整洁的工作流程。</p><h1 id="0f9e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">问题</h1><p id="0b9a" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">先建一个小问题。我们可以尝试使用Sklearn的<a class="ae ky" href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.make_classification.html" rel="noopener ugc nofollow" target="_blank"> make_classification </a>方法，通过人工生成高维数据集来解决二元分类任务的情况。</p><p id="c9bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我生成了一个包含1000个实例和30个特征(15个信息性特征和15个冗余特征)的数据集，并测试了以下内容:</p><ol class=""><li id="7945" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">两种降维技术——主成分分析(PCA)和局部线性嵌入(LLE)</li><li id="9523" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">两种类型的期望输出维度(来自降维技术)— 5维和10维(因为我们有30维数据)。</li><li id="765b" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">三种机器学习分类器—逻辑回归、SVC和随机森林分类器。</li></ol><p id="3cf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，我们有12个不同的实验(2 x 2 x 3)来得到所有不同组合的结果。手动运行所有的实验会令人疲惫不堪，所以我使用了一些python库和工具来简化它。</p><p id="1784" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，运行12个不同实验的目的是为了选择更好地解决问题的适当技术。在训练ML分类器时，我们还需要包括超参数调整(为了解释简单，我将跳过这一步)。</p><h1 id="d2e0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">该过程</h1><p id="d0cc" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">首先，我将制作一个代码框架，包含所有必要的预处理步骤、模型训练和模型评估。</p><p id="8b66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二步是将以下集成/更改添加到代码框架中:</p><ol class=""><li id="4ab5" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">将代码保存在<code class="fe ng nh ni nj b">.py</code>文件中(以防Jupyter笔记本用于训练模型)。</li><li id="8517" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">使用<a class="ae ky" href="https://docs.python.org/3/library/argparse.html" rel="noopener ugc nofollow" target="_blank"> Argparse </a>模块包装代码，该模块帮助我们在命令行中使用用户定义的参数运行代码。</li><li id="7f0c" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">在一个<code class="fe ng nh ni nj b">.sh</code>文件中用所有用户定义的参数编写一个循环。这个shell脚本将用于多次运行<code class="fe ng nh ni nj b">.py</code>文件，每次我们都使用<code class="fe ng nh ni nj b">for loop</code>来更改参数。</li><li id="8daa" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">将结果和工件(如果有的话)发布到web应用程序。</li></ol><h1 id="e4e6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">代码</h1><p id="b81d" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我列出了循环实验的所有步骤，现在让我们来看看我准备的代码框架。在<code class="fe ng nh ni nj b">arguments</code>块上做一个记录。这些是用户定义的参数，或者是我们在实验过程中感兴趣的参数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="7f93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面显示的是一个简单的降维和二进制分类代码。准确度分数被用作定义分类模型性能的度量。</p><p id="4433" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码的顶部提到了用户定义的参数。我们希望将argparse包装器集成到这些参数中。过程相当简单。</p><p id="1e94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们添加了<code class="fe ng nh ni nj b">parse_args()</code>函数来包含所有用户定义的参数。整个代码封装在另一个名为<code class="fe ng nh ni nj b">main(args)</code>的函数中，该函数接受参数。如您所见，argparse的集成很容易。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h1 id="5abf" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">Shell脚本</h1><p id="2642" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">现在，我们已经准备好了带有代码的<code class="fe ng nh ni nj b">argparse_automate.py</code>文件和所有用户定义参数的argparse包装器。下一步是创建如下所示的shell脚本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="3791" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ng nh ni nj b">loop.sh</code>将python文件与所有参数循环在一起。我们只需要使用命令行来运行shell脚本，所有12个实验将一个接一个地运行。<code class="fe ng nh ni nj b">echo</code>选项将打印用于特定运行的特定参数(如果需要，您可以删除它)。</p><p id="673e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:即使其中一个实验出现错误，循环仍会继续运行。</p><h1 id="a8f1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">工件和Web应用程序</h1><p id="cdd5" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在这个例子中，我没有保存任何ML工件，比如可视化、模型保存文件或者结果。将对应于每组参数的工件保存起来，并将它们排序到它们自己的特定文件夹中，这将非常方便。</p><p id="7e98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Python中创建嵌套文件夹的一种简单方法是使用路径库:</p><pre class="kj kk kl km gt nm nj nn no aw np bi"><span id="a62e" class="nq lw it nj b gy nr ns l nt nu">path = f'output/{dim_red_type}/{n_comp}/{classifier}/'</span><span id="c28c" class="nq lw it nj b gy nv ns l nt nu">Path(path).mkdir(parents=True, exist_ok=True)</span></pre><p id="77a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个实验都有一个文件夹，所有的结果都可以方便地访问。</p><p id="1227" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更进一步，所有这些结果和工件都可以在一个Streamlit web应用程序中显示。它看起来会像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/a543d7448a94d3df6bcd924cb5ae5568.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B2fe118OMIUHuQ12ABR50A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Streamlit Web应用程序(图片由作者提供)</p></figure><p id="eaa0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面Streamlit web应用程序的屏幕截图中，我包含了一个带有单选按钮(在左边)的过滤器选项，可以用来切换所需的参数。通过这种方式，不同实验和人工制品的结果可以在一个地方查看，不会太混乱。这对于以清晰的方式向不精通机器学习的客户展示结果非常有帮助。</p><blockquote class="nx ny nz"><p id="67dd" class="kz la oa lb b lc ld ju le lf lg jx lh ob lj lk ll oc ln lo lp od lr ls lt lu im bi translated">与本文相关的代码可以在这个<a class="ae ky" href="https://github.com/rohithteja/automate-ml-workflow" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中找到。您可以根据您的项目进行修改。</p></blockquote><p id="3112" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可能存在比我在本文中使用的方法更好的方法。如果你知道有什么技术可以改进我建议的工作流程，请随时告诉我！</p></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><p id="48c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读，干杯！</p><pre class="kj kk kl km gt nm nj nn no aw np bi"><span id="e1d5" class="nq lw it nj b gy nr ns l nt nu"><strong class="nj iu">Want to Connect?</strong></span><span id="fbec" class="nq lw it nj b gy nv ns l nt nu">Reach me at <a class="ae ky" href="https://www.linkedin.com/in/rohithteja/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>, <a class="ae ky" href="https://twitter.com/rohithtejam" rel="noopener ugc nofollow" target="_blank">Twitter</a>, <a class="ae ky" href="https://github.com/rohithteja" rel="noopener ugc nofollow" target="_blank">GitHub</a> or just <a class="ae ky" href="https://www.buymeacoffee.com/rohithteja" rel="noopener ugc nofollow" target="_blank">Buy Me A Coffee</a>!</span></pre></div></div>    
</body>
</html>