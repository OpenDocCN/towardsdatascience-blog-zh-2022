<html>
<head>
<title>How to Manage Conda Environments on an Apple Silicon M1 Mac</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在苹果硅M1 Mac上管理Conda环境</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-manage-conda-environments-on-an-apple-silicon-m1-mac-1e29cb3bad12#2022-05-23">https://towardsdatascience.com/how-to-manage-conda-environments-on-an-apple-silicon-m1-mac-1e29cb3bad12#2022-05-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3b08" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用conda管理ARM64和x86 Python环境</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5b0c4e81bbc3c06ff016476ccba52d81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*n2v35UMHUEN8Mf5p"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">简·kopřiva在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="3376" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">本文描述了如何使用conda管理ARM64和x86 Python环境。要使用pyenv(我的首选工具)和虚拟环境完成同样的事情，请参见我的文章</em> <a class="ae ky" rel="noopener" target="_blank" href="/how-to-use-manage-multiple-python-versions-on-an-apple-silicon-m1-mac-d69ee6ed0250"> <em class="lv">。</em></a></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="acac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您使用Python的时间足够长，您最终将需要使用不同的Python版本来管理环境。当开始新项目时，你会想要利用最新的特性(<a class="ae ky" href="https://docs.python.org/3/whatsnew/3.10.html" rel="noopener ugc nofollow" target="_blank"> Python 3.10 </a>最近发布了！)，但是您还需要维护使用以前版本的旧项目。作为一名数据科学家，我经常遇到这个问题——我经常回到旧的项目和代码，所以我需要一种简单的方法来管理使用不同Python版本的多个环境。</p><p id="8e8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是康达的用武之地。Conda是一个非常流行的包和环境管理工具(我们将讨论环境管理方面)。它允许您为不同的项目维护单独的环境——每个环境可以包含不同的包、不同的包版本，甚至不同的Python版本——并且可以快速轻松地在它们之间切换。</p><p id="1362" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">注意:本文面向Mac用户，尤其是Apple Silicon Mac用户，但基本的conda指令将在所有平台上工作。</em></p><h1 id="3f5b" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">使用conda创建Python环境</h1><p id="44b7" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">按照这些说明安装conda并开始使用环境。</p><h2 id="cf7e" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">1.安装康达</h2><p id="5cc1" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">有几种口味的康达可用，其中一些描述如下。按照超链接查找安装说明。每个安装程序都将为您提供相同的环境管理工具。<strong class="lb iu">如果你不确定要安装哪个，就选Miniforge。</strong></p><ul class=""><li id="e3e2" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><a class="ae ky" href="https://github.com/conda-forge/miniforge" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">Miniforge</strong></a><strong class="lb iu"/><em class="lv">(我的推荐)</em> : <strong class="lb iu"> </strong>一个社区驱动的项目，支持多种系统架构。它创建了类似于Miniconda的最小conda环境(见下一个要点)。</li><li id="731c" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated"><a class="ae ky" href="https://docs.conda.io/en/latest/miniconda.html" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">Miniconda</strong></a>:conda官方最小安装程序。它创建了最小的conda环境，而没有自动安装任何软件包。</li><li id="47ce" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated"><a class="ae ky" href="https://docs.anaconda.com/anaconda/install/index.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> Anaconda </strong> </a>:原康达分布。它会自动将大量的Python包安装到新的conda环境中，因此它倾向于创建大型且臃肿的环境。我不推荐蟒蛇。</li></ul><h2 id="77fb" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">2.创造康达环境</h2><p id="0029" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">创造康达环境非常容易。要使用特定版本的Python(在本例中为Python 3.9)创建一个新的conda环境，请从您的终端运行以下代码:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="99df" class="na me it ob b gy of og l oh oi">conda create -n myenv python=3.9</span></pre><p id="f164" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将创建一个名为<code class="fe oj ok ol ob b">myenv</code>的新conda环境。要激活conda环境，运行<code class="fe oj ok ol ob b">conda activate myenv</code>(您可以通过<code class="fe oj ok ol ob b">conda env list</code>查看您所有conda环境的列表)。一旦环境被激活，你可以使用<code class="fe oj ok ol ob b">conda install</code>或<code class="fe oj ok ol ob b">pip install</code>安装Python包——<code class="fe oj ok ol ob b">conda install</code>更彻底地管理包版本的依赖关系，你必须使用<code class="fe oj ok ol ob b">pip install</code>来安装不能通过conda获得的包。</p><p id="c039" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">管理conda环境的完整文档链接<a class="ae ky" href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><h1 id="aec5" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">苹果硅苹果电脑的其他挑战</h1><p id="6605" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">上述步骤几乎总是足够了。然而，在较新的苹果电脑上(就我个人而言，我用的是M1 MacBook Air )，你可能会在安装某些软件包时遇到问题。当苹果从英特尔芯片转到他们内部的苹果硅芯片时，他们从x86架构变成了ARM64架构。这在很大程度上是一件好事——你在日常使用中会注意到的唯一区别是，新芯片比旧芯片更快、更高效。</p><p id="8c3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，您可能偶尔会遇到包兼容性问题。苹果的ARM64架构尚不支持一些Python包——例如，我在使用ortools包时就遇到了这个问题。您将在安装期间得到错误，并且您将不能在您的代码中使用这个包。最终，当开发人员为他们的包添加ARM64支持时，这个问题应该会消失，但与此同时，您必须找到另一个解决方案。</p><p id="f758" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，conda提供了一个简单的短期解决方案:<strong class="lb iu">您可以在Apple Silicon Mac上轻松创建x86架构的conda环境。</strong>很简单，不需要安装任何额外的软件。</p><h1 id="0302" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">使用x86架构创建conda环境</h1><p id="7058" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">如果您需要使用只在x86架构上工作的包，只需遵循这些步骤。首先尝试前面的步骤，只有在遇到软件包安装问题时才到这里来。否则，您会牺牲性能而没有任何好处。</em> </strong></p><h2 id="1497" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">1.安装conda(如果您还没有安装的话)</h2><p id="97be" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">遵循与上一节中步骤1相同的说明。您<em class="lv">不需要</em>安装一个单独版本的conda来处理x86环境。</p><h2 id="eceb" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">2.创造康达环境</h2><p id="5867" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">这是指令有点不同的地方，但只是一点点不同。我们只需要告诉conda，我们希望我们的环境使用x86架构，而不是原生的ARM64架构。我们可以通过下面几行代码来实现，这些代码创建并激活一个名为<code class="fe oj ok ol ob b">myenv_x86</code>的新conda环境:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="a1c8" class="na me it ob b gy of og l oh oi">CONDA_SUBDIR=osx-64 conda create -n myenv_x86 python=3.9<br/>conda activate myenv_x86<br/>conda config --env --set subdir osx-64</span></pre><p id="98d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一行创建环境。我们简单地设置<code class="fe oj ok ol ob b">CONDA_SUBDIR</code>环境变量来指示conda应该使用x86 Python可执行文件创建en environment。第二行激活环境，第三行确保conda将x86版本的Python包安装到环境中。</p><p id="5a88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在我的<code class="fe oj ok ol ob b">~/.zshrc</code>文件中创建了一个简单的shell函数，这样我就不需要在每次创建新的x86环境时记住确切的命令。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="8f81" class="na me it ob b gy of og l oh oi">### add this to ~/.zshrc (or ~/.bashrc if you're using Bash)</span><span id="e368" class="na me it ob b gy om og l oh oi">create_x86_conda_environment () {<br/>  # create a conda environment using x86 architecture<br/>  # first argument is environment name, all subsequent arguments will be passed to `conda create`<br/>  # example usage: create_x86_conda_environment myenv_x86 python=3.9<br/>  <br/>  CONDA_SUBDIR=osx-64 conda create -n $@<br/>  conda activate $1<br/>  conda config --env --set subdir osx-64<br/>}</span></pre><p id="fe85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！一旦您创建了x86环境，它的工作方式与使用默认系统架构的常规conda环境完全相同。只需开始安装软件包，您就可以开始了！</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="9054" class="md me it bd mf mg on mi mj mk oo mm mn jz op ka mp kc oq kd mr kf or kg mt mu bi translated">结论</h1><p id="7a45" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如果你是Apple Silicon Mac用户，你可能偶尔会遇到软件包安装问题。最终，在开发人员有足够的时间将ARM64支持添加到他们的包中后，这些问题应该会消失，但对于一些利基包来说，这可能需要几年的时间。同时，本文演示了如何使用conda创建与不支持ARM64的包兼容的环境。希望这篇文章能帮你省去一些故障排除！</p><p id="676b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python版本管理可能很棘手，但conda提供了一个很好的解决方案。我喜欢的另一个工具是pyenv(与虚拟环境相结合)——详情见我的文章<a class="ae ky" rel="noopener" target="_blank" href="/how-to-use-manage-multiple-python-versions-on-an-apple-silicon-m1-mac-d69ee6ed0250">这里</a>。如果你有另一个你更喜欢的工具，我很乐意听听它！</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="6f5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://medium.com/@djcunningham0/membership" rel="noopener">成为媒体会员</a>访问成千上万作家的故事！</p></div></div>    
</body>
</html>