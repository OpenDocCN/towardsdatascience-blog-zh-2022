<html>
<head>
<title>Join vs. Merge in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫中的加入与合并</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/join-vs-merge-in-pandas-17b1b773bfb5#2022-02-16">https://towardsdatascience.com/join-vs-merge-in-pandas-17b1b773bfb5#2022-02-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8a9e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Pandas 的 join 和 merge 函数之间的实际差异</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/70d0720f5f90064a7f87e6da65a6a6f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*frrMOkeilnN1TKlE03tnpQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@hannahbusing?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">汉娜·布斯</a>在<a class="ae ky" href="https://unsplash.com/s/photos/join?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h2 id="bd25" class="lg lh it bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">这些功能</h2><p id="fd39" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk lp ml mm mn lt mo mp mq lx mr ms mt mu im bi translated">作为一名数据科学家，总有一天你会面临一个问题，你的数据一部分在数据集 A 中，另一部分在数据集 b 中。</p><p id="b1e5" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">当这样的问题发生时，您肯定会从 SQL 中寻找一个类似于以前的<code class="fe na nb nc nd b">join</code>的函数。如果你正在使用 Python，你很可能会面对熊猫库中的这两个选项:<code class="fe na nb nc nd b">df.join()</code>或<code class="fe na nb nc nd b">df.merge()</code>。</p><p id="d43e" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">在这篇文章中，我们想了解基本的区别，并决定使用哪一个。</p><p id="9f1d" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">总之，两者将执行相同的任务，即查看来自<em class="ne">数据集 A </em>和来自<em class="ne">数据集 B </em>的列，并根据您选择的连接类型返回结果—见下图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/12fd94fbbc04bb01f23c9503e779511f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*12-oau_QspKTkDiNGgDdkg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">联接类型。图片由作者提供。</p></figure><blockquote class="ng"><p id="d0ae" class="nh ni it bd nj nk nl nm nn no np mu dk translated">A 里有什么？B 里面是什么？</p><p id="9c8d" class="nh ni it bd nj nk nq nr ns nt nu mu dk translated">让我们检查两个表，看看什么是相等的…</p></blockquote><h2 id="8225" class="lg lh it bd li lj nv dn ll lm nw dp lo lp nx lr ls lt ny lv lw lx nz lz ma mb bi translated">熊猫加入</h2><p id="c1b3" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk lp ml mm mn lt mo mp mq lx mr ms mt mu im bi translated">我首先把熊猫<code class="fe na nb nc nd b">join</code>带到餐桌上，因为——在我看来——它不如<code class="fe na nb nc nd b">merge</code>灵活。</p><p id="918d" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">Pandas join 总是需要将右边表的列或索引与左边表的索引相匹配。因此，假设您在左边的表中有一个数字索引从 1 到 20 的表，您希望将它与给定的右边的表进行匹配。它们必须具有相同的索引，或者右表必须具有与左表中的索引具有相同数字/信息的列。</p><p id="10cb" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">我知道，这很令人困惑。让我们编写代码来看看结果。会更有意义。</p><pre class="kj kk kl km gt oa nd ob oc aw od bi"><span id="105d" class="lg lh it nd b gy oe of l og oh"><strong class="nd iu"># Creating two Dataframes</strong></span><span id="6abf" class="lg lh it nd b gy oi of l og oh"># Set seed<br/>np.random.seed(10)</span><span id="8c69" class="lg lh it nd b gy oi of l og oh"># dataframe 1<br/>df1 = pd.DataFrame( {'Category': np.random.choice(['A', 'A+', 'B', 'C'], size=20)} )</span><span id="b7d4" class="lg lh it nd b gy oi of l og oh">df1['Score'] = np.select([df1.Category == 'A+', df1.Category == 'A', df1.Category == 'B', df1.Category == 'C'],<br/>                        [10, np.random.choice([7,8,9]), np.random.choice([4,5,6]), np.random.choice([1,2,3])])<br/>df1.index = [i for i in range(1,21)]</span><span id="0dc1" class="lg lh it nd b gy oi of l og oh"># dataframe 2<br/>df2 = pd.DataFrame( { 'Category': df1.Category} )</span><span id="9f22" class="lg lh it nd b gy oi of l og oh">df2['Location'] = np.select([df1.Category == 'A+', df1.Category == 'A', df1.Category == 'B', df1.Category == 'C'],<br/>                            ['North', np.random.choice(['Southwest','South']), np.random.choice(['South', 'East', 'Northeast']), np.random.choice(['Northeast','South','Southeast'])])<br/>df2.index = [i for i in range(1,21)]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/25564834b166a31a062af52081ff61c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*NY27IB9Re1UrXX44-oiThw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">两个数据帧。图片由作者提供。</p></figure><p id="6f3b" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">请注意，两者都有相同的索引和相同的“id”。</p><pre class="kj kk kl km gt oa nd ob oc aw od bi"><span id="a456" class="lg lh it nd b gy oe of l og oh"># Join both df<br/>df1.join(df2, lsuffix='_1', rsuffix='_2')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/555773d28e4811e6007248d5828c11be.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*m3sBHsfqgpVxot4nRmiJ8A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">连接函数的结果。图片由作者提供。</p></figure><p id="692a" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">您可以看到它在这种情况下工作得非常好，因为两个数据集有相同的索引。</p><p id="9c36" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">现在，第二个例子显示了<code class="fe na nb nc nd b">join</code>方法在熊猫身上的局限性。如果我在两边创建一个名为 ID 的列，并保留原来的索引(从 0 到 19)，看看会发生什么。</p><p id="21fb" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">如果我运行这个…</p><pre class="kj kk kl km gt oa nd ob oc aw od bi"><span id="3050" class="lg lh it nd b gy oe of l og oh"># Creating two Dataframes</span><span id="330f" class="lg lh it nd b gy oi of l og oh"># Set seed<br/>np.random.seed(10)</span><span id="176d" class="lg lh it nd b gy oi of l og oh"><strong class="nd iu"># dataframe 1 with ID col</strong><br/>df1 = pd.DataFrame( {'ID': range(1,21),<br/>                     'Category': np.random.choice(['A', 'A+', 'B', 'C'], size=20)} )</span><span id="f9e0" class="lg lh it nd b gy oi of l og oh">df1['Score'] = np.select([df1.Category == 'A+', df1.Category == 'A', df1.Category == 'B', df1.Category == 'C'],<br/>                        [10, np.random.choice([7,8,9]), np.random.choice([4,5,6]), np.random.choice([1,2,3])])</span><span id="a3b6" class="lg lh it nd b gy oi of l og oh"><strong class="nd iu"># dataframe 2 with ID col</strong><br/>df2 = pd.DataFrame( { 'ID': range(1,21),<br/>                     'Category': df1.Category} )</span><span id="a2cd" class="lg lh it nd b gy oi of l og oh">df2['Location'] = np.select([df1.Category == 'A+', df1.Category == 'A', df1.Category == 'B', df1.Category == 'C'],<br/>                            ['North', np.random.choice(['Southwest','South']), np.random.choice(['South', 'East', 'Northeast']), np.random.choice(['Northeast','South','Southeast'])])</span><span id="d7f0" class="lg lh it nd b gy oi of l og oh"><strong class="nd iu">#Join on the column ID</strong><br/>df1.join(df2, on= 'ID', lsuffix='_1', rsuffix='_2')</span></pre><p id="f9b9" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">事情是这样的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/98513bb1be0432c6a4744c58dc52f9e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*ISsHpVklXL_s44hbup3rKg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用 Join 进行联接时出错。图片由作者提供。</p></figure><p id="ca1d" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">我已经指定我想要列<code class="fe na nb nc nd b">ID</code>上的<code class="fe na nb nc nd b">join</code>，但是 Pandas <strong class="me iu">将尝试将右表中的列 ID 与左表中的索引相匹配。这就是问题发生的时候。即使两个表在 ID 列中有相同的 ID(1 到 20)，索引仍然是从 0 到 19。我们会错过一些连接。</strong></p><h2 id="2e5d" class="lg lh it bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">熊猫合并</h2><p id="9490" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk lp ml mm mn lt mo mp mq lx mr ms mt mu im bi translated">熊猫<code class="fe na nb nc nd b">merge</code>的功能更加多样，因为它可以从两边连接柱子。所以在这里，使用与上面完全相同的代码，但是将方法改为<code class="fe na nb nc nd b">merge()</code>，我们将得到正确的结果。</p><pre class="kj kk kl km gt oa nd ob oc aw od bi"><span id="f116" class="lg lh it nd b gy oe of l og oh"># Creating two Dataframes</span><span id="548a" class="lg lh it nd b gy oi of l og oh"># Set seed<br/>np.random.seed(10)</span><span id="4e55" class="lg lh it nd b gy oi of l og oh"># dataframe 1<br/>df1 = pd.DataFrame( {'ID': range(1,21),<br/>                     'Category': np.random.choice(['A', 'A+', 'B', 'C'], size=20)} )</span><span id="2379" class="lg lh it nd b gy oi of l og oh">df1['Score'] = np.select([df1.Category == 'A+', df1.Category == 'A', df1.Category == 'B', df1.Category == 'C'],<br/>                        [10, np.random.choice([7,8,9]), np.random.choice([4,5,6]), np.random.choice([1,2,3])])</span><span id="9642" class="lg lh it nd b gy oi of l og oh"># dataframe 2<br/>df2 = pd.DataFrame( { 'ID': range(1,21),<br/>                     'Category': df1.Category} )</span><span id="15ca" class="lg lh it nd b gy oi of l og oh">df2['Location'] = np.select([df1.Category == 'A+', df1.Category == 'A', df1.Category == 'B', df1.Category == 'C'],<br/>                            ['North', np.random.choice(['Southwest','South']), np.random.choice(['South', 'East', 'Northeast']), np.random.choice(['Northeast','South','Southeast'])])</span><span id="5a3e" class="lg lh it nd b gy oi of l og oh"><strong class="nd iu"># MERGE on the column ID</strong><br/>df1.merge(df2, on='ID', how= 'inner')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/384018424f06c0e5699107a0624a687e.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*mvizp9MhmENAy2ulYboRXg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">合并结果。图片由作者提供。</p></figure><p id="c6dd" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">merge 方法还有其他很酷的参数，比如合并两个具有不同列名的数据帧的能力。假设左边的表是 ID，右边的表是 ID2 列。我们只需使用这些代码来实现合并。</p><pre class="kj kk kl km gt oa nd ob oc aw od bi"><span id="9d10" class="lg lh it nd b gy oe of l og oh">df1.merge(df2, left_on='ID', right_on='ID2', how= 'inner', )</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/cb036ba52c51216ff5586865f7fe6f4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*C0V9EuoVyy8CdYQOdKVqtQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用不同的列名合并。图片由作者提供。</p></figure><h2 id="e332" class="lg lh it bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">在你走之前</h2><p id="68f5" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk lp ml mm mn lt mo mp mq lx mr ms mt mu im bi translated">连接数据集是数据科学家的一项常见任务。如果你知道每种方法是如何工作的，你就更容易选择选择哪一种。</p><p id="8366" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">对我来说，我通常去<code class="fe na nb nc nd b">df.merge()</code>，因为那里更灵活。不确定熊猫团队是否会永远保留这两只熊猫，但知道它们的基本区别是有好处的。</p><p id="bab4" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">不要忘记从这两种方法探索文档。</p><p id="6881" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated"><a class="ae ky" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html" rel="noopener ugc nofollow" target="_blank">熊猫合并</a></p><p id="9d9d" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated"><a class="ae ky" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.join.html" rel="noopener ugc nofollow" target="_blank">熊猫加入</a></p><p id="a15a" class="pw-post-body-paragraph mc md it me b mf mv ju mh mi mw jx mk lp mx mm mn lt my mp mq lx mz ms mt mu im bi translated">如果你喜欢这个内容，请关注我的博客。</p><div class="oo op gp gr oq or"><a href="https://gustavorsantos.medium.com/" rel="noopener follow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd iu gy z fp ow fr fs ox fu fw is bi translated">古斯塔沃·桑托斯-中等</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">阅读古斯塔夫·桑托斯在媒介上的作品。数据科学家。我从数据中提取见解，以帮助个人和公司…</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">gustavorsantos.medium.com</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf ks or"/></div></div></a></div></div></div>    
</body>
</html>