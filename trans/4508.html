<html>
<head>
<title>AWS Managed Workflows for Apache Airflow vs. Glue</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Apache Airflow与Glue的AWS托管工作流</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/aws-managed-workflows-for-apache-airflow-vs-glue-184eca9e6996#2022-10-06">https://towardsdatascience.com/aws-managed-workflows-for-apache-airflow-vs-glue-184eca9e6996#2022-10-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3142" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">找出MWAA胶水和AWS胶水的区别</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6915df24cbb9679d1c8089b0bd7b16f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*p2s3LKgbMy-9ReG5"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">马丁·亚当斯在<a class="ae kv" href="https://unsplash.com/s/photos/pipes?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="8c9e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2020年，AWS为Apache Airflow (MWAA)推出了亚马逊管理的工作流。Apache Airflow是一个开源的工作编排平台，由Airbnb在2014年创建。从那时起，许多公司开始使用它，并将其用于各种用例。它是一个工作流协调工具，允许用户在计划的时间按顺序和逻辑运行作业，或者临时执行作业。由于其架构不依赖于用户无法控制的嵌入式存储，人们可以将队列服务和元数据存储外部化到Airflow之外，以便您可以将Airflow堆栈设计为可水平扩展的。</p><p id="9019" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，与其他开源项目一样，维护气流资源成为了您的责任。这不是一件小事。了解了需求，AWS让MWAA负责后勤方面的工作。最近的AWS服务让我想到了AWS Glue——一种托管ETL(提取、转换和加载)服务，以及它们之间的区别。</p><h1 id="1e6d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">MWAA和AWS胶水对比</h1><p id="ef0f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Apache Airflow和AWS Glue的目标不同，但它们有一些共同点。两者都允许您创建和管理工作流。由于这种相似性，你可以用气流完成的一些任务也可以用胶水来完成，反之亦然。这种共性让我们在想要选择一个而不是另一个的时候有了歧义。要做出明智的决定，了解它们之间的区别非常重要。</p><h1 id="aeaa" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">服务器与无服务器</h1><p id="e665" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们首先从对它们的工作方式有重大影响的架构差异开始。MWAA是基于服务器的，而AWS Glue是无服务器的。我们不会在这里讨论这两个不同的概念，但MWAA和胶水继承了建筑差异的缺点和优点，它们出现在三个主要领域。</p><h1 id="72bb" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">费用</h1><p id="672d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">云平台提供商提供无服务器服务，人们选择它们的原因之一是成本效益。Apache Airflow被设计为在服务器上运行。这意味着，即使没有作业运行，您的气流资源仍将保持活动状态，这将在空闲时间产生成本。MWAA仍然是基于服务器的，但它提供了一种通过自动伸缩来节省成本的方法。MWAA监控资源的使用情况，如果需要更多的资源就增加工作线程的数量，如果需要更少的资源就减少工作线程的数量。但是，由于它是基于服务器的，您无法避免在空闲时间运行服务器。AWS Glue是无服务器和事件驱动的。当你触发时，它将开始分配服务器资源。在空闲时间，它不使用任何资源，也不会产生任何成本。</p><p id="eafd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在MWAA，有四个主要因素决定你的账单。</p><ul class=""><li id="43e9" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">实例大小</li><li id="b0bf" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">附加工作实例</li><li id="1e6a" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">附加调度程序实例</li><li id="6bdb" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">元数据库存储</li></ul><p id="7289" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些费用将乘以使用小时数。</p><p id="2e0a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<a class="ae kv" href="https://aws.amazon.com/glue/pricing/" rel="noopener ugc nofollow" target="_blank"> AWS胶水</a>里，你是按DPU或者数据处理单元乘以使用小时来收费的。根据您运行的工作类型，DPU的计算方式会有所不同。有三种类型。</p><ul class=""><li id="4da1" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">Python shell:您可以选择0.0625或1 DPU。</li><li id="5608" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">Apache Spark:您可以最少使用2个dpu，最多使用100个dpu。</li><li id="cb9a" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">Spark Streaming:您可以使用最少2个dpu，最多100个dpu。</li></ul><h1 id="5938" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">工作隔离</h1><p id="319a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在服务器环境中，工作流共享相同的资源。当工作流进程消耗大量内存或CPU时，它会对其他进程产生负面影响。如果您没有均匀地分配触发时间，并且错误地配置了最大工作人员数，则在MWAA可能会出现这种症状。相比之下，AWS Glue为每个工作流提供了一个隔离的环境，因为每个工作流都使用独立的资源。当您运行繁重的数据密集型工作时，不会影响同时运行的其他工作流。</p><h1 id="6230" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">响应性</h1><p id="70be" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在MWAA，服务器总是在运行，随时可以使用。当触发作业工作流时，它几乎没有延迟就开始了。在AWS Glue中，因为它是无服务器的，ETL工作流从分配必要的资源开始。这意味着在实际作业开始之前会有一些延迟。此外，当您必须使用外部库时，每次作业启动时，它首先安装那些库，然后开始实际的作业。</p><h1 id="fdbb" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">工作编排与ETL</h1><p id="ecba" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">值得讨论一下每项服务的设计目的。让我提醒你，气流是一个工作编排工具。如果我们在<a class="ae kv" href="https://en.wikipedia.org/wiki/Orchestration" rel="noopener ugc nofollow" target="_blank">维基百科</a>中搜索编排的定义，它也会给你一个编排者的定义。</p><p id="84cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">指挥是受过训练的音乐专业人员，他给乐队分配乐器</p><p id="56f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里我们要重点说的词是“赋值”。气流的一个理想用例是将工作委派给其他资源。当然，我们仍然可以在Airflow内运行非密集型任务，但是如果可能的话，最好分配它们。避免在气流中运行繁重的任务也可以防止它们占用共享资源。MWAA的一个很好的优势是它在AWS之内。这意味着您可以使用IAM和安全组更恰当地访问其他AWS服务，如EMR、Athena、S3、Redshift等。</p><p id="6886" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">AWS Glue专门做ETL。当您提取、转换和加载数据时，通常需要昂贵的过程。为了处理密集型任务，可以在Glue中使用Apache Spark集群。由于能够在内部使用Spark集群，您可以运行大规模数据处理，而不必担心资源耗尽。</p><h1 id="3fe7" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">监控和记录</h1><p id="7377" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">MWAA和AWS胶水都提供了方便的监测方法。这对于气流来说是一个很大的提升。当您在自己的服务器上设置和使用Airflow时，您会意识到检查Airflow日志并不方便用户。Airflow为任务、web服务器、调度程序、工作程序和Dag写入不同类型的日志。默认情况下，它将这些日志写在服务器内部。要读取日志，您必须SSH到服务器并运行命令。当您希望使用分布式服务器来实现可伸缩性时，这变得更加复杂。这将需要您创建中央日志存储，并进行额外的设置，以使所有服务器都将日志写入该单一位置。</p><p id="5436" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为MWAA是由AWS管理的，所以所有的日志都被写入CloudWatch。这意味着您可以使用Logs Insights搜索某些日志，并拥有一个显示CPU、内存和网络流量等服务器资源使用情况的仪表板。此外，您还可以监控许多其他特定于气流的指标。您还可以通过编程方式设置警报和管理通知收件人。</p><p id="414d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">AWS Glue，由于是原生的AWS服务，也有很好的监控能力。不同的是，除了CloudWatch，你还可以在GlueStudio的Glue内部监控你的Glue资源。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/e436c9b5b0173579dadad43d5cce1332.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YT05qW3W_7kIdpTI"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">GlueStudio监控仪表板(图片由作者提供)</p></figure><p id="3c7f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我发现在Glue中更容易深入和跟踪失败的作业。上图是GlueStudio监控菜单的第一个屏幕。它给你高层次的数字。你可以点击每个数字去找相关的工作。当您在那里选择一个作业时，您可以搜索它的CloudWatch日志并查看其他指标。当您有许多工作流要监控时，这种设计可以让您更清楚地了解情况，从而更容易地跟踪问题。</p><h1 id="c45f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">云的形成</h1><p id="dcd2" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">由于Airflow已经成为AWS中托管服务的一部分，因此您可以对Airflow基础架构进行云计算。然而，不仅是基础设施环境，就连Airflow的本地配置变量也可以被云化。当您已经通过CloudFormation管理AWS资源时，这将为您提供资源管理的一致性，并使跨不同环境的气流管理更加容易。AWS胶水当然可以通过CloudFormation来管理。一个很大的不同是，您甚至可以使用它来创建和定义工作流，这给了您更深层次的可控性。</p><h1 id="9a3f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">AWS SDK和CLI</h1><p id="2a30" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">除了CloudFormation，MWAA还可以像其他AWS资源一样与AWS SDK和CLI交互。使用它们，您可以创建、更新和删除MWAA环境，并检索它们的环境信息，包括日志记录策略、工作线程数量、调度程序等等。您也可以运行Airflow的内部<a class="ae kv" href="https://docs.aws.amazon.com/mwaa/latest/userguide/airflow-cli-command-reference.html#airflow-cli-commands-supported" rel="noopener ugc nofollow" target="_blank">命令</a>来控制Dag，但MWAA CLI并不支持Airflow的所有本机命令，如回填(查看此AWS <a class="ae kv" href="https://docs.aws.amazon.com/mwaa/latest/userguide/airflow-cli-command-reference.html#parsing-support" rel="noopener ugc nofollow" target="_blank">文档</a>)、Dag列表、Dag列表运行、Dag下一次执行等等。这些限制主要是因为Airflow不是作为AWS的原生服务而创建的。说了这么多，AWS Glue完全可以用SDK和CLI来控制。你基本上可以使用库来执行所有的任务和控制整个Glue资源。</p><h1 id="9ba9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">包扎</h1><p id="5067" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">MWAA和AWS Glue都是编排作业的好工具——MWAA用于一般作业，Glue专门用于ETL。上面讨论的这些架构和功能上的差异将影响您对工具的选择。当然，知道了这些区别，你可能想考虑同时使用它们，这会给你更多的灵活性。当你使用两者时，你可以控制来自MWAA的Glue资源，例如，因为Glue的SDK给了你更多的控制权，而Airflow拥有glue <a class="ae kv" href="https://airflow.apache.org/docs/apache-airflow-providers-amazon/stable/_api/airflow/providers/amazon/aws/operators/glue/index.html" rel="noopener ugc nofollow" target="_blank">操作器</a>。这两个服务内部都有很大的生态系统，有很多东西需要学习，所以在开始全面开发之前尝试一下是很好的。</p></div></div>    
</body>
</html>