<html>
<head>
<title>Build and Distribute a Python Package Using venv and PyPI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用venv和PyPI构建和分发Python包</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-build-and-distribute-a-python-package-using-venv-and-pypi-d17dade7f8c2#2022-04-13">https://towardsdatascience.com/how-to-build-and-distribute-a-python-package-using-venv-and-pypi-d17dade7f8c2#2022-04-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/2659b0b4977b989eac82dfeb73ca4287.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*a5JHCI2nOKbdZyxg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@fempreneurstyledstock?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">莱昂·温特</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="1985" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Python是一个开源平台，建立在无数付费和自由开发者的基础上。当以面向对象编程(OOP)风格编码时，它的灵活性和可重用代码得到了最好的利用。当我们创建可以重复使用的类和函数时，我们展示了OOP。这些类最好的例子可能是在Python包中实现的。</p><p id="4d77" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当开发一个python包时，问自己一个问题总是好的，“谁将会或可能会从这些代码变得用户友好和易于访问中受益？”答案通常是很多，特别是如果它是在广泛的应用程序中实现的一个普通的重复任务，并且代表了其他程序员或不太喜欢数学的外行用户所面临的问题。</p><h1 id="2f63" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">第一步:注册pypi.org账户</h1><p id="9636" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">报名账号:<a class="ae kf" href="https://pypi.org/" rel="noopener ugc nofollow" target="_blank"><strong class="ki iu"/></a><strong class="ki iu">。</strong>Python包索引(PyPI)是Python编程语言的软件仓库</p><h1 id="6569" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤2:升级pip版本</h1><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="6ddf" class="mq lf it mm b gy mr ms l mt mu">python3 -m pip install --upgrade pip</span></pre><h1 id="1f98" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤3:配置您的环境</h1><p id="dca7" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">理想情况下，您在特定于包的环境中开发您的包。因此，一旦您导航到一个文件夹目标<strong class="ki iu"> package_name/ </strong>，您将运行下面的命令。我们这样做，所以我们有一个空白的石板来在一个干净的工作环境中安装所需的依赖项。导航到最终创建包的文件夹后。我们可以使用命令:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="9b50" class="mq lf it mm b gy mr ms l mt mu">python3 -m venv env</span></pre><p id="1153" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将在您现有的工作目录中创建一个名为“env”的文件夹，它代表您的环境的名称。</p><p id="0181" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你正在使用VS代码(强烈推荐)，那么你可以通过点击<strong class="ki iu"> Ctrl+ shift+ P </strong> (PC)或<strong class="ki iu"> Cmd+ shift+ P </strong> (Mac)并选择“选择解释器”来选择这个环境，并从下拉列表中选择你的虚拟环境。</p><p id="eec4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您喜欢在VSCode中从命令行控制，您可以使用:</p><p id="e3ad" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mv mw mx mm b">source env/bin/activate</code></p><h1 id="14d0" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤4:文件结构</h1><p id="c26f" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">您的包的生成文件结构应该类似于以下内容:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="2d39" class="mq lf it mm b gy mr ms l mt mu">package_name/<br/>├── LICENSE<br/>├── setup.cfg<br/>├── setup.py<br/>├── README.md<br/>├── MANIFEST.in<br/>├── env/<br/>├── package_name/<br/>│    ├── __init__.py<br/>│    └── example.py<br/>└── tests/<br/>│    ├── __init__.py<br/>└──  └── tests.py/</span></pre><p id="0a8a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，让我们看一下上面列出的接下来几个文件的创建过程。</p><h1 id="76d7" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">__init__。巴拉圭</h1><p id="e130" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">您的<strong class="ki iu"> __init__。py </strong>文件应该是空的，用来让python知道你正在使用一个类，因为它有助于初始化它。你可以选择在这里放一些包依赖项，但是大多数应该在<strong class="ki iu"> example.py </strong>文件中运行。你将需要一个<strong class="ki iu"> __init__。包中每个子文件夹的py </strong>。所以如果你有更多的子包，你会有更多的<strong class="ki iu"> __init__。每个对应文件夹中的py </strong>文件。</p><h1 id="e7c9" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">README.md</h1><p id="c66d" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">这应该是一个信息性的降价文件。它为用户提供了如何使用软件包的信息。这将最终出现在你的pypi.org主页上。这里可以看到我的例子:<a class="ae kf" href="https://pypi.org/project/psmpy/" rel="noopener ugc nofollow" target="_blank">https://pypi.org/project/psmpy/</a>。最好保持这种信息丰富，并尽可能面向用例。</p><h1 id="fcdb" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">Setup.py文件</h1><p id="5b7a" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">不需要静态setup.cfg和setup.py都可以。所以选一个吧。一个<strong class="ki iu"> setup.cfg </strong>在技术上是首选。</p><ul class=""><li id="9ddf" class="my mz it ki b kj kk kn ko kr na kv nb kz nc ld nd ne nf ng bi translated">setup.cfg =静态安装文件</li><li id="3052" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nd ne nf ng bi translated">setup.py =动态设置文件</li></ul><p id="a0b5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是一个setup.py(动态文件)的示例:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="204a" class="mq lf it mm b gy mr ms l mt mu">from pathlib import Path<br/>from setuptools import find_packages, setup</span><span id="e930" class="mq lf it mm b gy nm ms l mt mu">dependencies = ['matplotlib', 'numpy', 'pandas',<br/>                'seaborn', 'sklearn', 'scipy', 'sklearn']</span><span id="e29c" class="mq lf it mm b gy nm ms l mt mu"># read the contents of README file<br/>this_directory = Path(__file__).parent<br/>long_description = (this_directory / "README.md").read_text()</span><span id="6386" class="mq lf it mm b gy nm ms l mt mu">setup(<br/>    name='example-package',<br/>    packages=find_packages(),<br/>    version='0.0.1',<br/>    description='Propensity score matching for python and graphical plots',<br/>    author='Author name here',<br/><a class="ae kf" href="mailto:author_email='askline1@gmail.com" rel="noopener ugc nofollow" target="_blank">author_email='</a>author<strong class="mm iu">@example</strong>.com',<br/>    long_description=long_description,<br/>    long_description_content_type='text/markdown',<br/>    license='MIT',<br/>    project_urls={<br/>        "Bug Tracker": "<a class="ae kf" href="https://github.com/adriennekline/psmpy" rel="noopener ugc nofollow" target="_blank">https://github.com/</a>",<br/>    },<br/>    classifiers=[<br/>        "Programming Language :: Python :: 3.6",<br/>        "License :: OSI Approved :: MIT License",<br/>        "Operating System :: OS Independent",<br/>    ],<br/>    install_requires=dependencies,<br/>    setup_requires=['pytest-runner'],<br/>    tests_require=['pytest==4.4.1'],<br/>    test_suite='tests',<br/>)</span></pre><p id="c507" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以及setup.cfg(静态)文件的示例:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="9946" class="mq lf it mm b gy mr ms l mt mu">[metadata]<br/>name = example-package<br/>version = 0.0.1<br/>author = Example Author<br/>author_email = author<strong class="mm iu">@example</strong>.com<br/>description = A small example package<br/>long_description = file: README.md<br/>long_description_content_type = text/markdown<br/>url = https://github.com/pypa/sampleproject<br/>project_urls =<br/>    Bug Tracker = https://github.com/pypa/sampleproject/issues<br/>classifiers =<br/>    Programming Language :: Python :: 3<br/>    License :: OSI Approved :: MIT License<br/>    Operating System :: OS Independent<br/><br/>[options]<br/>package_dir =<br/>    = src<br/>packages = find:<br/>python_requires = &gt;=3.6<br/><br/>[options.packages.find]<br/>where = package_name</span></pre><h1 id="f0f5" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">批准</h1><p id="09c0" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">这里有一个麻省理工学院许可证的例子(这很可能是你需要的)。还有其他选择——https://choosealicense.com/<a class="ae kf" href="https://choosealicense.com/" rel="noopener ugc nofollow" target="_blank"/>【2】。下面是我自己工作中使用的麻省理工学院许可证的一个例子:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="a15d" class="mq lf it mm b gy mr ms l mt mu">Copyright (c) 2022 Author name</span><span id="5bb1" class="mq lf it mm b gy nm ms l mt mu">Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</span><span id="a6a1" class="mq lf it mm b gy nm ms l mt mu">The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</span><span id="9fbc" class="mq lf it mm b gy nm ms l mt mu">THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span></pre><h1 id="054f" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">清单. in</h1><p id="60b5" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">您可以在这里列出所有要包含在软件包发行版中的额外文件。这将确保您的<strong class="ki iu"> license.txt </strong>和<strong class="ki iu"> README.md </strong>将由最终用户下载并随您的软件包一起安装。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="6a64" class="mq lf it mm b gy mr ms l mt mu">include LICENSE<br/>include README.md</span></pre><h1 id="ce4e" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">示例. py</h1><p id="e975" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">这里是您构建类的地方。您可以在这里引入其他函数、子包和库。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="34bc" class="mq lf it mm b gy mr ms l mt mu">from .functions import cohenD<br/>import numpy as np<br/>from scipy.special import logit, expit<br/>from sklearn.neighbors import NearestNeighbors<br/>import matplotlib.pyplot as plt<br/>import pandas as pd<br/>from sklearn.linear_model import LogisticRegression<br/>import math<br/>import pandas.api.types as ptypes<br/>import seaborn as sns<br/>sns.set(rc={'figure.figsize': (10, 8)}, font_scale=1.3)</span><span id="9721" class="mq lf it mm b gy nm ms l mt mu">class PsmPy:<br/>    """<br/>    Matcher Class -- Match data for an observational study.<br/>    Parameters<br/>    ----------<br/>    data : pd.DataFrame<br/>        Data representing the treated group<br/>    treatment : str<br/>        Column representing the control group<br/>    indx : str<br/>        Name of index column<br/>    exclude : list (optional)<br/>        List of variables to ignore in regression/matching.<br/>    target : str (optional)<br/>        Outcome variable of interest, will ignore in regression/matching<br/>    ----------    <br/>    """</span><span id="887a" class="mq lf it mm b gy nm ms l mt mu">def __init__(self, data, treatment, indx, exclude=[], target='outcome'):<br/>        # variables generated during matching<br/>        # assign unique indices to test and control<br/>        self.data = data.dropna(axis=0, how="all")  # drop NAN rows</span><span id="c753" class="mq lf it mm b gy nm ms l mt mu">.<br/>.<br/>.</span></pre><h1 id="ee23" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">第五步。构建您的包</h1><p id="0a3a" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在构建你的轮子和发行版之前，你需要将你的虚拟环境<strong class="ki iu"> venv </strong>改回你的<strong class="ki iu">基础</strong>环境。你需要安装麻绳。Twine是一个将Python包发布到PyPI的工具。它为源代码和二进制发行版提供构建[3]。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="aa61" class="mq lf it mm b gy mr ms l mt mu">$ conda activate base</span><span id="5d3f" class="mq lf it mm b gy nm ms l mt mu">(base) $ pip install twine<br/>(base) $ pip install build</span></pre><p id="b4cb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">创建源和轮分布:</p><p id="ec3d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">source——一个主要是源代码<br/> wheel的分发包——一个经过处理的分发包，可以更快地安装</strong></p><p id="b4d4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">sdist =源分布<br/> bdist_wheel =轮分布</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="7684" class="mq lf it mm b gy mr ms l mt mu">(base) $ python setup.py sdist bdist_wheel</span></pre><p id="229a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将在您的目录中添加一个<strong class="ki iu"> dist </strong>文件夹:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="1e81" class="mq lf it mm b gy mr ms l mt mu">package_name/<br/>├── LICENSE<br/>├── setup.cfg<br/>├── setup.py<br/>├── README.md<br/>├── venv/<br/>├── <strong class="mm iu">dist/<br/></strong>│    ├── <strong class="mm iu">package_name-0.1.0-py3-none-any.whl</strong><br/>│    ├── <strong class="mm iu">package_name-0.1.0.tar.gz<br/></strong>├── <strong class="mm iu">build</strong><br/>├── <strong class="mm iu">package_name.egg-info</strong><br/>├── package_name/<br/>│    ├── __init__.py<br/>│    └── example.py<br/>└── tests/</span></pre><h1 id="30b4" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤6:上传/分发您的包</h1><p id="4303" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">使用命令将您的包上传到PyPI:<strong class="ki iu">twine upload dist/*</strong>。系统将提示您输入之前创建的用户名和密码！</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="88ee" class="mq lf it mm b gy mr ms l mt mu">(base) $ twine upload dist/*</span><span id="a31a" class="mq lf it mm b gy nm ms l mt mu">Uploading distributions to <a class="ae kf" href="https://upload.pypi.org/legacy/" rel="noopener ugc nofollow" target="_blank">https://upload.pypi.org/legacy/</a><br/>Enter your username: <strong class="mm iu">YOUR_USER_NAME</strong><br/>Enter your password: <strong class="mm iu">YOUR_PASSWORD</strong><br/>Uploading package_name-0.1.0.tar.gz<br/>100%|██████████████████████████████████████████████████████████████| 2.5k/2.5k [00:01&lt;00:00, 2.1kB/s]</span></pre><p id="7ac9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您还可以将您的发行版上传到TestPyPI进行测试(可选):</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="64fb" class="mq lf it mm b gy mr ms l mt mu">(base) $ twine upload -r testpypi dist/*</span></pre><p id="c65b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你现在可以通过<strong class="ki iu"> pip </strong>命令从pypi.org安装你自己的软件包。请注意，当您更新您的软件包时，您需要更改版本号，否则将无法上传到pypi.org。</p><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/1699488c75838771b4e06c8ffe7250f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EGjku2aiaY-Cfc7dYRhWDg.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</p></figure><p id="ae98" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">快乐创作！</p><h1 id="93dd" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">参考</h1><p id="62d4" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">[1]打包Python项目，<a class="ae kf" href="https://packaging.python.org/en/latest/tutorials/packaging-projects/" rel="noopener ugc nofollow" target="_blank">https://Packaging . Python . org/en/latest/tutorials/Packaging-Projects/</a>，访问时间:2022年4月11日<br/>【2】选择开源许可，<a class="ae kf" href="https://choosealicense.com/" rel="noopener ugc nofollow" target="_blank">https://choosealicense.com/</a>访问时间:2022年4月13日<br/>【3】Twine，<a class="ae kf" href="https://twine.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">https://pypi.org/project/twine/</a>访问时间:2022年4月13日</p></div></div>    
</body>
</html>