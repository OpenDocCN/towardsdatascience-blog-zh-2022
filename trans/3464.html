<html>
<head>
<title>How to Select the Right Statistical Tests for Different A/B Metrics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为不同的A/B指标选择正确的统计测试</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-select-the-right-statistical-tests-for-different-a-b-metrics-c8a1865851e#2022-08-01">https://towardsdatascience.com/how-to-select-the-right-statistical-tests-for-different-a-b-metrics-c8a1865851e#2022-08-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b311" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">讨论5种A/B指标的定位方法</h2></div><h1 id="738b" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="8afd" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">本文将A/B测试评估指标总结为<strong class="kz ir"> 5个类别</strong>，并在下表中概述了<strong class="kz ir">建议的对其显著性值</strong>的统计测试。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi lt"><img src="../Images/46a3b9ff6656d8592d7253e61d7035b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M957qGgDOre0EUTuZVrmXw.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">按作者分类的表格</p></figure><h1 id="5877" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">目录</h1><ol class=""><li id="bcde" class="mj mk iq kz b la lb ld le lg ml lk mm lo mn ls mo mp mq mr bi translated"><a class="ae ms" href="#1a90" rel="noopener ugc nofollow">我们为什么要在乎</a></li><li id="5369" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls mo mp mq mr bi translated"><a class="ae ms" href="#1215" rel="noopener ugc nofollow">用户平均指标</a></li><li id="68b7" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls mo mp mq mr bi translated"><a class="ae ms" href="#f15d" rel="noopener ugc nofollow">用户级转化指标</a></li><li id="3f99" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls mo mp mq mr bi translated"><a class="ae ms" href="#e753" rel="noopener ugc nofollow">浏览量级转化指标</a></li><li id="29f8" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls mo mp mq mr bi translated"><a class="ae ms" href="#5b15" rel="noopener ugc nofollow">百分位数指标</a></li><li id="8ead" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls mo mp mq mr bi translated"><a class="ae ms" href="#3ca6" rel="noopener ugc nofollow">总和指标</a></li><li id="3772" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls mo mp mq mr bi translated"><a class="ae ms" href="#e8c1" rel="noopener ugc nofollow">总结和实用提示</a></li><li id="c4e0" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls mo mp mq mr bi translated"><a class="ae ms" href="#6219" rel="noopener ugc nofollow">注</a></li></ol><h1 id="1a90" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">我们为什么要关心？</h1><p id="6813" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">虽然t-tests非常强大，但是它们并不普遍适用于数据世界，因为数据世界中的业务指标分布与单一正态分布有很大不同。例如，每个用户发送的礼物数量和分享行为通常与严重的异常值有很大的偏差。这是因为用户行为不像统计规则那样有组织和客观，而是情绪化的，通常以极端行为为特征。</p><p id="0673" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">作为数据科学家，我们有责任，也是我们的价值所在，更深入地研究从统计学角度看具有科学意义的不同业务指标的适当测试方法。我们应该时刻提醒自己在进行t检验之前要检查抽样分布。</p><h1 id="d9e6" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">细节扩展</h1><p id="799c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在这一主要段落中，我讨论了与5个度量类别中的每一个相对应的适当的测试方法。简而言之，决定使用哪种方法的两个关键方面是统计和实验角度。具体来说，我们想问自己两个问题:</p><ol class=""><li id="f069" class="mj mk iq kz b la my ld mz lg nd lk ne lo nf ls mo mp mq mr bi translated">抽样分布是否符合假设(如独立性、正态性等)。)的建议测试方法？</li><li id="3996" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls mo mp mq mr bi translated">随机化单元是否与分析单元一致？</li></ol><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi ng"><img src="../Images/e890953228d630b924a75f403f76d8ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ajoTeyhXC9LSOxB9VI33g.jpeg"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated"><a class="ae ms" href="https://unsplash.com/photos/oZuBNC-6E2s" rel="noopener ugc nofollow" target="_blank">图片由Towfiqu Barbhuiya在Unsplash上拍摄</a></p></figure><h2 id="1215" class="nh kg iq bd kh ni nj dn kl nk nl dp kp lg nm nn kr lk no np kt lo nq nr kv ns bi translated">1.用户平均指标(例如，喜欢/用户、停留时间/用户等)</h2><blockquote class="nt"><p id="c344" class="nu nv iq bd nw nx ny nz oa ob oc ls dk translated">建议的测试<strong class="ak"> : </strong> Welch的T-Test，如果指标不是严重稀疏和偏斜的。否则，选择<strong class="ak">曼-惠特尼秩和U检验</strong></p></blockquote><p id="40ba" class="pw-post-body-paragraph kx ky iq kz b la od jr lc ld oe ju lf lg of li lj lk og lm ln lo oh lq lr ls ij bi translated"><strong class="kz ir"> <em class="oi">什么是用户平均指标？</em>T29】</strong></p><p id="3e68" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">用户平均指标是根据独立用户的数量对总体业务绩效进行平均的指标，如实验期间<strong class="kz ir">每个用户的平均点赞数</strong>和<strong class="kz ir">每个用户的平均停留时间</strong>。它们是A/B测试中经常使用的评估标准，这种控制组和实验组之间的数学期望或样本均值是否相同的比较也是最常见和最经典的统计测试场景之一。</p><p id="5481" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated"><strong class="kz ir"> <em class="oi">如何测试用户平均指标</em> </strong></p><p id="880d" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">对样本均值统计量进行假设检验的方法通常是<strong class="kz ir">双样本t检验。</strong>简单地说，双样本t检验通过比较两个样本组之间的样本均值来确定两个总体中某个指标的期望均值是否相等。<strong class="kz ir">两个</strong> <strong class="kz ir">假设</strong>以一种坦率但不太精确的方式是:</p><ul class=""><li id="317e" class="mj mk iq kz b la my ld mz lg nd lk ne lo nf ls oj mp mq mr bi translated"><strong class="kz ir">每个样本观察值需要是独立的，并且遵循正态或准正态分布(i.i.d.): </strong>独立分布假设通常得到满足，因为每个用户都可以被视为独立的个体*，并且实验的随机化单元通常是用户级的(大多数实验通过用户id来确定特定用户属于哪个实验组)。<strong class="kz ir">具有独立性，然后可以应用中心极限定理导出正态性</strong>，满足双样本t检验的这一假设。值得重申的是，尽管CLT下的t-检验的稳健性被公认为t-检验结果通常是有效的，即使总体分布在技术上不是正态的(准/渐近正态)，这在现实世界的问题中是经常发生的，<strong class="kz ir">稳健性对于非中度偏离正态的分布是有界的</strong> ( <a class="ae ms" href="https://www.cambridge.org/core/journals/mathematical-proceedings-of-the-cambridge-philosophical-society/article/abs/effect-of-nonnormality-on-the-t-distribution/400D10D04B8C956E6F2D9783CB6BEF23" rel="noopener ugc nofollow" target="_blank"> Bartlett，1935</a>；Snijders，2011年。如果基础分布严重偏斜、多模态或带有极端异常值的稀疏分布，它就变得不太可信。<br/> <strong class="kz ir"> <br/> </strong>作为旁注，<a class="ae ms" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.probplot.html" rel="noopener ugc nofollow" target="_blank">分位数-分位数(QQ)图</a>，<a class="ae ms" href="https://seaborn.pydata.org/generated/seaborn.histplot.html" rel="noopener ugc nofollow" target="_blank">直方图</a>，<a class="ae ms" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.shapiro.html" rel="noopener ugc nofollow" target="_blank">夏皮罗-维尔克检验</a>，<a class="ae ms" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.kstest.html" rel="noopener ugc nofollow" target="_blank">科尔莫戈罗夫-斯米尔诺夫(KS)检验</a>是检验正态性的常用方法。</li><li id="795a" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls oj mp mq mr bi translated"><strong class="kz ir">两个总体中评估指标的方差可以是未知的，但它们需要是同质的:</strong>这不是一个严格的假设，因为我们可以使用<a class="ae ms" href="https://en.wikipedia.org/wiki/Welch%27s_t-test" rel="noopener ugc nofollow" target="_blank">韦尔奇的t-检验</a>，或不等方差t-检验，来进行相等均值的假设检验。Welch的t检验和Student的t检验在数学上的区别主要是关于自由度和样本方差估计。事实上，<strong class="kz ir">我们应该总是使用韦尔奇的t检验，而不是学生t检验</strong>。这不仅是一些学术文章(Delacre等人，2017年)所暗示的，也是科技公司的实验平台工程师根据我的经验提出的，因为从数据库中提取所有数据并断言方差相等可能会<strong class="kz ir">计算昂贵</strong>和耗时，这通常也是一个伪命题(在数百万和数十亿规模上计算方差可能非常繁重)。</li></ul><blockquote class="ok ol om"><p id="3cd3" class="kx ky oi kz b la my jr lc ld mz ju lf on na li lj oo nb lm ln op nc lq lr ls ij bi translated">Delacre等人(2017年)表明，当不满足方差齐性假设时，Welch的<em class="iq">t</em>-检验对1型错误率提供了更好的控制，当假设满足时，与Student的<em class="iq">t</em>-检验相比，它几乎没有损失稳健性。因此，他们认为韦尔奇的<em class="iq"> t </em>测试应该作为一种默认策略。</p></blockquote><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi oq"><img src="../Images/23e59c5b1c87e83d825a19c6722f0ef3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MnNwmvsrJDMQoGd6FYFE9w.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">等式1: t统计量</p></figure><p id="bbd4" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">对于那些高度偏斜的指标，针对两个独立组的非参数方法— <strong class="kz ir"> Mann-Whitney秩和U检验(MW检验)</strong> —更为合适，因为它使用“等级”而非真实值来确定指标的差异是否显著，从而绕过了由极值引入的失真。此外，即使通过用等级替代绝对值来丢失信息，MW测试的灵敏度(功效)也不会令人失望，因为当分布高度偏斜时，其他参数测试(如t-test)做出真正积极推断的能力会有更大幅度的下降— <em class="oi"> VK团队进行了模拟，并详细展示了这一想法。我强烈建议在这里</em>  <em class="oi">查阅他们的中型文章</em> <a class="ae ms" href="https://vkteam.medium.com/practitioners-guide-to-statistical-tests-ed2d580ef04f#9e58" rel="noopener"> <em class="oi">。</em></a></p><p id="08d7" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">然而，MW测试的缺点是它是<strong class="kz ir">计算密集型的</strong>，因为它需要对完整的样本集进行排序来生成等级，所以在决定进行MW测试之前，应该考虑数据的大小。</p><h2 id="f15d" class="nh kg iq bd kh ni nj dn kl nk nl dp kp lg nm nn kr lk no np kt lo nq nr kv ns bi translated">2.用户级转换指标</h2><blockquote class="nt"><p id="500a" class="nu nv iq bd nw nx ny nz oa ob oc ls dk translated">建议的检验:比例Z检验</p></blockquote><p id="9a18" class="pw-post-body-paragraph kx ky iq kz b la od jr lc ld oe ju lf lg of li lj lk og lm ln lo oh lq lr ls ij bi translated"><strong class="kz ir"> <em class="oi">什么是用户级转化指标？</em>T29】</strong></p><p id="86f0" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">用户级转化是从<strong class="kz ir">二进制结果</strong>中得出的指标——该用户是否保留，该用户是否转化，等等。换句话说，所有用户将只有一个观察值，该观察值是1或0的标识符，这使得用户级别的转换度量基本上是<strong class="kz ir">二项式比例统计</strong> (#转换的用户/#所有用户)。</p><p id="4f67" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated"><strong class="kz ir"> <em class="oi">如何测试用户级转化指标？</em> </strong></p><p id="12af" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">根据中心极限定理(CLT)，我们可以使用正态分布安全地近似二项比例统计的分布。另一种思考方式是<strong class="kz ir">对二项式聚合进行比例分配非常类似于取平均值</strong>，其中当用户总数(人口规模)足够大时，CLT可以有效地断言任何样本均值分布的正态性。因此，z-test成为一个完美的候选。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi or"><img src="../Images/2e73a84b8acff32b2bf70f47882177f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AkRxag7OEiSN_09GXFIfpg.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">等式2:二项式比例</p></figure><p id="0270" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">与上面讨论的用户平均度量相比，通常满足正态近似的假设，因为由于二进制伯努利事件的良好特性，底层采样分布是二项式的，而不是急剧偏斜的。此外，用户数量或人口规模通常非常大，以支持合理的近似值(根据经验，当<em class="oi"> N*p &gt; 5 </em>和<em class="oi"> N*(1-p) &gt; 5 </em>时，我们通常很有信心)。请参阅参考资料了解更多详细信息)。</p><p id="e137" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">值得注意的是，如果实验中的样本值不是<strong class="kz ir">独立同分布(i.i.d.) </strong>，则中心极限定理不可信，z检验不能应用。这在用户级度量场景中并不重要，因为在默认情况下，随机化单元是针对用户的，因此我们认为每个人的行为都是独立的。然而，<strong class="kz ir">当指标在比用户更精细的级别上聚合时，这种独立的假设可能不成立</strong>，例如下面第三节中的页面浏览量级别的转换指标。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi os"><img src="../Images/b79c78c21650f20a351d8a0a6d148ee4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HPQwUMmBKb6jMb0QwwIa-A.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">等式3: z统计</p></figure></div><div class="ab cl ot ou hu ov" role="separator"><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy"/></div><div class="ij ik il im in"><h2 id="e753" class="nh kg iq bd kh ni nj dn kl nk nl dp kp lg nm nn kr lk no np kt lo nq nr kv ns bi translated">3.页面视图级别的转换指标</h2><blockquote class="nt"><p id="f6d3" class="nu nv iq bd nw nx ny nz oa ob oc ls dk translated">建议检验:德尔塔法+ T检验</p></blockquote><p id="63bc" class="pw-post-body-paragraph kx ky iq kz b la od jr lc ld oe ju lf lg of li lj lk og lm ln lo oh lq lr ls ij bi translated"><strong class="kz ir"> <em class="oi">有哪些浏览量级的转化指标？</em> </strong></p><p id="acdd" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">一个常见的例子是点击率(CTR)，定义为#点击事件/ #查看事件。</p><p id="d23d" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated"><strong class="kz ir"> <em class="oi">这里简单使用t检验有哪些问题？</em>T25】</strong></p><p id="57db" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">在A/B实验中，分析浏览量级转换指标(如点击率)的统计意义通常很复杂。本质问题是<strong class="kz ir">的分析单位</strong>(即事件级别——点击事件和印象事件)不同于<strong class="kz ir">的随机化单位</strong>(即用户级别)，这可能<strong class="kz ir">使我们的t检验无效并低估方差。</strong></p><p id="b08e" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">具体来说，当我们计算实验组和对照组之间CTR的p值时，我们实际上是聚合所有点击事件，并除以每组中所有用户的所有印象事件，然后对差异进行t检验。这个过程有一个固有的正态假设，即数据样本需要从正态分布中独立抽取。换句话说，由于每个样本观察都是一个视图事件，<strong class="kz ir">我们需要确保所有的视图事件都是独立的。否则，我们无法使用CLT来断言我们的均值统计的正态性。</strong></p><p id="7849" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">然而，这种独立性假设被违反了。在我们按用户随机化的A/B实验中(<em class="oi">这通常是默认选项，因为如果我们按会话随机化，每个用户都会有不一致的产品体验</em>)，一个用户可以有多次点击/查看事件，这些事件与我们的常识相关——我们最多可以断言每个人的行为是独立的，但现在和明天的行为不是时间序列相关的。因此，样本方差将不再是总体方差的无偏估计值——我们的平均统计量的<strong class="kz ir">真实样本方差可能会比我们的估计值</strong>高，因为<strong class="kz ir">共方差步骤在</strong>中，而我们在计算中遗漏了它。</p><p id="309b" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">因此，对于具有事件级粒度的度量，如果坚持传统的t检验方法，则不可避免地会低估方差。低估样本方差的直接后果是假阳性——真实且高的方差可能<strong class="kz ir">驱使样本均值</strong>偏离零假设，并且<strong class="kz ir">误导我们得出低p值，即使治疗无效</strong>。</p><p id="3689" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated"><strong class="kz ir"> <em class="oi">如何解决这个样本依赖问题？</em> </strong></p><p id="808a" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">有两种方法可以解决这个问题:(1)使用<strong class="kz ir"> delta方法</strong>对差异进行t检验，或者(2)使用<strong class="kz ir"> bootstrapping </strong>方法对经验方差进行t检验，这在&lt; <a class="ae ms" href="https://www.cambridge.org/core/books/trustworthy-online-controlled-experiments/D97B26382EB0EB2DC2019A7A7B518F59" rel="noopener ugc nofollow" target="_blank"> <em class="oi">可信在线控制实验:A/B测试实用指南</em> </a> &gt;中也有强调</p><blockquote class="ok ol om"><p id="c6fe" class="kx ky oi kz b la my jr lc ld mz ju lf on na li lj oo nb lm ln op nc lq lr ls ij bi translated">使随机化单元比分析单元更粗糙，如<br/>由用户随机化并分析点击率(按页面)，将会起作用，但需要更细致的分析方法，如bootstrap或delta方法(Deng等人，2017年；Deng，Knoblich和Lu，2018年Tang等人，2010年；Deng等人，2011年)。</p></blockquote><ul class=""><li id="d9d7" class="mj mk iq kz b la my ld mz lg nd lk ne lo nf ls oj mp mq mr bi translated"><strong class="kz ir"> Delta方法</strong> : Delta方法通常被认为是更有效的方法。关键思想可以解释为将页面视图级别的CTR比率指标重写为两个“平均用户级别指标”的<strong class="kz ir">比率，并在该比率指标</strong> <em class="oi">(使用泰勒展开和斯卢茨基定理)</em>上断言CLT，以便我们可以将<strong class="kz ir">分析粒度从页面级别转换为用户级别</strong>，这现在与我们的分流单位(即用户)一致。这样，我们设法恢复了独立身份，因为<strong class="kz ir">我们的分子和分母都是独立身份样本的平均值</strong>。以CTR为例，<code class="fe pa pb pc pd b">AVG.clicks</code>和<code class="fe pa pb pc pd b">AVG.views</code>在极限和独立同分布中共同为二元正态，使得两个平均值之比<code class="fe pa pb pc pd b">CTR</code>也成为正态分布(Kohavi，r .，Tang，d .，&amp; Xu，Y. (2020))。代码实现可以在Ahmad Nur Aziz的中帖<a class="ae ms" href="https://medium.com/@ahmadnuraziz3/applying-delta-method-for-a-b-tests-analysis-8b1d13411c22" rel="noopener">这里</a>找到。</li></ul><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pe"><img src="../Images/84213f330f7fcafd0065a8322dbd9ea1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Agfs70YUv8_uuHW19a1GbA.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">等式4:点击率(CTR)定义</p></figure><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pf"><img src="../Images/4c62176c567aad39e873f3951b00fcde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r09F96EwG8wdxM6fA9NOTg.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">等式5:使用Delta方法的t统计量</p></figure><ul class=""><li id="4766" class="mj mk iq kz b la my ld mz lg nd lk ne lo nf ls oj mp mq mr bi translated"><strong class="kz ir">Bootstrapping</strong>:Bootstrapping是一种基于模拟的方法，根据经验计算样本均值统计的方差。其核心思想是从按用户id分层的每个组中的所有视图事件中重复抽取许多样本，然后从这些引导样本中计算许多平均统计量，并相应地估计这些统计量的方差。<strong class="kz ir">按用户ID分层可确保满足ID . I . d .假设</strong>并且方差估计是可信的。</li></ul><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pg"><img src="../Images/16ef6276d9766b1e6a1cb6d3fb7eb138.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lVUUvffvdfiubeX3VuVPUQ.jpeg"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">Stephen Phillips在Unsplash上拍摄的图片</p></figure><p id="8314" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">然而，自举在计算上是昂贵的，因为模拟基本上是对数百亿用户日志进行多次迭代操作和聚合(<em class="oi">复杂度~ O(nB)其中n是样本大小，B是自举迭代次数</em>)。因此，尽管它很灵活，但它通常不是科技公司的首选，而是更多地被用作关键决策的防弹双重检查基准。</p></div><div class="ab cl ot ou hu ov" role="separator"><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy"/></div><div class="ij ik il im in"><h2 id="5b15" class="nh kg iq bd kh ni nj dn kl nk nl dp kp lg nm nn kr lk no np kt lo nq nr kv ns bi translated">4.百分位度量</h2><blockquote class="nt"><p id="4d5a" class="nu nv iq bd nw nx ny nz oa ob oc ls dk translated">建议测试:中心极限定理(CLT) + Z测试</p></blockquote><p id="eb0a" class="pw-post-body-paragraph kx ky iq kz b la od jr lc ld oe ju lf lg of li lj lk og lm ln lo oh lq lr ls ij bi translated"><strong class="kz ir"> <em class="oi">什么是百分位度量？</em> </strong></p><p id="1bb9" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">分位数指标，比如95%的页面加载时间，对于A/B测试来说是至关重要的，因为许多业务方面都以边缘案例为特征，因此可以更好地用分位数指标来描述。</p><p id="fa4d" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated"><strong class="kz ir"> <em class="oi">测试百分位指标的挑战是什么？</em>T9】</strong></p><p id="83a4" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">大多数百分比指标，例如95%的页面加载延迟，是在页面查看粒度中定义的工程性能指标。因此，随机化单元(用户)不会与分析单元(页面浏览量)相匹配，这使得独立性假设和使用简单样本方差的总体方差估计无效。</p><p id="074f" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated"><strong class="kz ir"> <em class="oi">如何测试百分制指标？</em>T13】</strong></p><ul class=""><li id="4b53" class="mj mk iq kz b la my ld mz lg nd lk ne lo nf ls oj mp mq mr bi translated"><strong class="kz ir">Bootstrapping:</strong>Bootstrapping作为一种“普遍适用”的工具，在这里可以用来估计经验方差和对百分位度量的样本均值进行t检验。尽管如此，它的计算仍然非常昂贵，因此不能很好地扩展。</li><li id="2ff4" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls oj mp mq mr bi translated"><strong class="kz ir">CLT+比例Z检验:</strong>场景背后有相当多的数学，但我会尝试用简单的术语来展示主要观点(如果感兴趣，强烈推荐阅读<a class="ae ms" href="https://alexdeng.github.io/causal/abstats.html#percentilevar" rel="noopener ugc nofollow" target="_blank">亚历克斯邓(2021) </a>)。首先，我们将首先探讨分位数度量的分布，统计学家已经证明样本百分位数是近似正态的:</li></ul><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi ph"><img src="../Images/8c829751a30bc781424df7d1624e8264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1IizPmbW2FaUnXOAsmNx-Q.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">等式6:95%度量的渐近正态性的说明。</p></figure><p id="5516" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated"><strong class="kz ir"> <em class="oi"> σ </em> </strong>是指一个数据点是否小于第95百分位的标准差(不能用‘传统’伯努利方式估计，因为这里的观测值是相依的)。<strong class="kz ir"> <em class="oi"> F </em> </strong>为底层数据的未知概率密度函数。</p><p id="4da8" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">太好了！由于分位数遵循正态分布，我们可以使用Z检验来计算p值。嗯，这通常是我们要去的方向，但有一个关键的障碍——σ<strong class="kz ir"/>以及概率密度函数<strong class="kz ir"> <em class="oi"> F </em> </strong>是未知的，可能难以估计。</p><p id="36b5" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">所以我们现在的目标是得到一个好的方差估计值(用红色圈起来的)。业内采用的方法不止一种。LinkedIn、Quora和Wish的数据科学家直接估计这个密度函数，而微软和则参考了由<a class="ae ms" href="https://alexdeng.github.io/causal/probability-minimum.html#ref-Deng2018kdd" rel="noopener ugc nofollow" target="_blank"> Alex Deng、Knoblich和Lu</a>(【2018)引入的一个新想法，该想法绕过了对密度函数<strong class="kz ir"> <em class="oi"> F </em> </strong>的估计。相反，他们首先通过调查小于百分位数的观察值的二项式比例的分布来估计真实百分位数的置信区间，如等式7所示:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pi"><img src="../Images/fbdb332ce4021e432e2eb1e774e0289f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O12ApoBTCRxS2za66pKjew.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">等式7:95%度量的置信区间</p></figure><p id="696b" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">其次，他们基于近似置信区间的长度反向推导方差估计。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pj"><img src="../Images/8a209eb8fe492bdd89ac3bc95a140a98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SH3xHwmHxn7eWbPkW1s7oA.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">等式8:从置信区间得出标准偏差</p></figure><p id="cd98" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">最后，通过方差估计，我们可以继续计算样本百分位的z统计量和相应的p值，类似于那些平均度量。</p></div><div class="ab cl ot ou hu ov" role="separator"><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy"/></div><div class="ij ik il im in"><h2 id="3ca6" class="nh kg iq bd kh ni nj dn kl nk nl dp kp lg nm nn kr lk no np kt lo nq nr kv ns bi translated">5.合计指标(不推荐)</h2><blockquote class="nt"><p id="d6da" class="nu nv iq bd nw nx ny nz oa ob oc ls dk translated">建议的测试:模拟</p></blockquote><p id="4da1" class="pw-post-body-paragraph kx ky iq kz b la od jr lc ld oe ju lf lg of li lj lk og lm ln lo oh lq lr ls ij bi translated"><strong class="kz ir"> <em class="oi">什么是和度量？</em>T11】</strong></p><p id="f5e5" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">总和指标指的是实验组和对照组的合计指标，包括文章阅读次数的总数、总GMV、发布的总视频等。</p><p id="04cf" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated"><strong class="kz ir"> <em class="oi">这里有哪些挑战？</em>T15】</strong></p><p id="c6a7" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">总和指标通常是产品开发的北极星指标，但由于缺乏统计有效性和混淆误差，可能很难测试。具体来说，在实验组和对照组中，SUM指标可以分解为<strong class="kz ir">用户平均指标</strong>和<strong class="kz ir">用户计数</strong>，这意味着SUM指标不仅受<strong class="kz ir">实际业务波动</strong>(用户平均指标)的影响，还受<strong class="kz ir">流量分流</strong>引入的不可避免的随机误差的影响。：</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pk"><img src="../Images/b30b25012325d6bf22a820eb249bd200.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V5xmmH2x-VybQSp1jRt9mA.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">等式9:解开总和度量</p></figure><p id="6833" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">虽然用户平均指标遵循(准)正态分布，而流量分流遵循p = 0.5的二项式分布，但经典统计没有关于两者乘积分布的完整研究。</p><p id="e692" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated"><strong class="kz ir"> <em class="oi">应该如何测试用户平均指标？</em> </strong></p><p id="c2d7" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">我们可以用<strong class="kz ir">模拟</strong>来处理这个问题。由于这两种分布是确定的和独立的，我们可以通过迭代抽取样本来获得它们自己的概率密度函数(PDF)。然后，如果将两个PDF相乘，我们可以得到总和度量的经验PDF。因此，可以通过研究我们在治疗组中实际看到的总和统计如何符合我们的模拟分布来计算p值。</p><p id="22a6" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">这是一个相对令人生畏的过程，有相当数量的近似值。所以通常不推荐。我建议使用用户平均指标测试产品特性的有效性/统计显著性，如果管理层真的关心的话，计算总和指标的增量提升。</p></div><div class="ab cl ot ou hu ov" role="separator"><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy"/></div><div class="ij ik il im in"><h1 id="e8c1" class="kf kg iq bd kh ki pl kk kl km pm ko kp jw pn jx kr jz po ka kt kc pp kd kv kw bi translated">总结和实用技巧</h1><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pq"><img src="../Images/83c5ae2f55b829ec217eda6ef9359d52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-_c2ehWY-_n-SzLVa5E6tw.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated"><a class="ae ms" href="https://unsplash.com/photos/fIq0tET6llw" rel="noopener ugc nofollow" target="_blank">图片由Diego PH在Unsplash上拍摄</a></p></figure><p id="c59d" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">关于正确统计检验的问题本质上是问，给定实验和控制组数据，哪个检验具有最大的<strong class="kz ir">敏感性或统计功效</strong>。</p><p id="5a8d" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">这种能力与我们指标的基本分布和样本的独立性密切相关。因此，在继续分析之前，<strong class="kz ir">检查分布偏斜度</strong>和<strong class="kz ir">仔细考虑假设</strong>始终是一个好的做法。</p><p id="1502" class="pw-post-body-paragraph kx ky iq kz b la my jr lc ld mz ju lf lg na li lj lk nb lm ln lo nc lq lr ls ij bi translated">以下是根据我的个人经验和我从参考资料中学到的三个技巧:</p><ol class=""><li id="2850" class="mj mk iq kz b la my ld mz lg nd lk ne lo nf ls mo mp mq mr bi translated">当数据有偏差时，t检验不那么稳健，曼-惠特尼检验也不那么弱。</li><li id="9809" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls mo mp mq mr bi translated">考虑转换指标(如对数转换)以减轻偏斜，甚至用更正态分布的指标来代替。</li><li id="9c11" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls mo mp mq mr bi translated">如果你不想弄乱令人生畏的统计数据，另一种方法是尝试方差减少技术，如CUPED。毕竟，我们的目的是获得高功效和值得信赖的显著性推论。</li></ol><h1 id="6219" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">注意:</h1><ol class=""><li id="608d" class="mj mk iq kz b la lb ld le lg ml lk mm lo mn ls mo mp mq mr bi translated">所有的方程式都是作者手工编码的。</li><li id="e638" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls mo mp mq mr bi translated">*每个用户都是独立的个体:假设没有网络效应。以下引用自<a class="ae ms" href="https://alexdeng.github.io/causal/abstats.html#percentilevar" rel="noopener ugc nofollow" target="_blank"> Alex Deng (2021) </a>的文章很好地解释了A/B测试场景中独立性假设的思想:</li></ol><blockquote class="ok ol om"><p id="97bb" class="kx ky oi kz b la my jr lc ld mz ju lf on na li lj oo nb lm ln op nc lq lr ls ij bi translated">在在线实验中，用户通常被视为自主的基本单位，因此通常被用作随机化单位……一般的经验法则是，我们总是可以将随机化单位视为独立身份。我们将此命名为<em class="iq">随机化单位原则</em> (RUP)。例如，当一个实验按用户、页面浏览量(<a class="ae ms" href="https://alexdeng.github.io/causal/probability-minimum.html#ref-choiceofexp" rel="noopener ugc nofollow" target="_blank"> S. Deng等人，2011 </a>)、cookie日(【唐】等人，2010 )或会话/访问进行随机分组时，建议，合理的做法是假设这些级别上的观察值分别为独立同分布。之前没有公开发表的工作明确提到。但是它被社区广泛用于A/B测试的分析</p></blockquote><h1 id="7253" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">参考</h1><ul class=""><li id="26fc" class="mj mk iq kz b la lb ld le lg ml lk mm lo mn ls oj mp mq mr bi translated">阿齐兹·阿恩(2021)。Delta方法在A/B测试分析中的应用。<a class="ae ms" href="https://medium.com/@ahmadnuraziz3/applying-delta-method-for-a-b-tests-analysis-8b1d13411c22" rel="noopener"><em class="oi">https://medium . com/@ ahmadnuaziz 3/applying-delta-method-for-a-b-tests-analysis-8b1d 13411 c 22</em></a></li><li id="390e" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls oj mp mq mr bi translated">巴特利特，硕士(1935年4月)。非正态性对t分布的影响。在<em class="oi">剑桥哲学学会的数学会议录</em>(第31卷第2期，第223-231页)。剑桥大学出版社。</li><li id="2d0b" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls oj mp mq mr bi translated">邓，a .，Knoblich，u .，，陆，J. (2018)。在度量分析中应用Delta方法:具有新颖思想的实用指南。在<em class="oi">第24届ACM SIGKDD知识发现国际会议论文集&amp;数据挖掘</em>(第233–242页)。</li><li id="d695" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls oj mp mq mr bi translated">邓(2021)。8.6百分位度量的置信区间和方差估计。<em class="oi">因果推理及其在网络产业中的应用。</em><a class="ae ms" href="https://alexdeng.github.io/causal/abstats.html#percentilevar" rel="noopener ugc nofollow" target="_blank"><em class="oi">https://alexdeng.github.io/causal/abstats.html#indvar</em></a></li><li id="1f79" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls oj mp mq mr bi translated">德拉克雷，m .，拉肯斯，d .，和莱斯，C. (2017)。为什么心理学家应该默认使用韦尔奇的t检验而不是学生的t检验。<em class="oi">《国际社会心理学评论》</em>，<em class="oi"> 30 </em> (1)。</li><li id="8bab" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls oj mp mq mr bi translated">李庆国(2021)。如何希望A/B测试百分位数。<a class="ae ms" rel="noopener" target="_blank" href="/how-wish-a-b-tests-percentiles-35ee3e4589e7"><em class="oi">https://towards data science . com/how-wish-a-b-tests-percentiles-35ee 3e 4589 e 7</em></a></li><li id="25a8" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls oj mp mq mr bi translated">刘，硕士，孙，x，瓦什尼，硕士，徐，杨(2019)。分位数度量的大规模在线实验。<em class="oi"> arXiv预印本arXiv:1903.08762 </em>。</li><li id="4d22" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls oj mp mq mr bi translated">柯哈维，r .，唐，d .，，徐，Y. (2020)。可信的在线控制实验:A/B测试实用指南。在<em class="oi">可信的在线控制实验:A/B测试实用指南</em> (p. I)。剑桥:剑桥大学出版社。</li><li id="917d" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls oj mp mq mr bi translated">斯尼德斯(2011年)。统计方法:稳健性。<em class="oi">摘自</em><a class="ae ms" href="https://www.stats.ox.ac.uk/~snijders/SM_robustness.pdf" rel="noopener ugc nofollow" target="_blank"><em class="oi">【http://www.stats.ox.ac.uk/统计方法】MT2011 Snijders </em> </a> <em class="oi">。</em></li><li id="8258" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls oj mp mq mr bi translated">VK队。(2020).统计检验从业者指南。<a class="ae ms" href="https://vkteam.medium.com/practitioners-guide-to-statistical-tests-ed2d580ef04f#9e58" rel="noopener"><em class="oi">https://vk team . medium . com/practices-guide-to-statistical-tests-ed2d 580 ef 04 f # 9e 58</em></a></li><li id="0eca" class="mj mk iq kz b la mt ld mu lg mv lk mw lo mx ls oj mp mq mr bi translated">邢，T和崇，k . z(2018)。百分位数差异的双样本假设检验。<a class="ae ms" href="https://quoradata.quora.com/Two-Sample-Hypothesis-Tests-for-Differences-in-Percentiles" rel="noopener ugc nofollow" target="_blank"><em class="oi">https://quoradata . quora . com/双样本假设检验百分位数差异</em> </a></li></ul></div></div>    
</body>
</html>