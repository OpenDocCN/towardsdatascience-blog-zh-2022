<html>
<head>
<title>Time Series Forecasting: Ensemble Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列预测:集成学习</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-forecasting-ensemble-learning-df5fcbb48581#2022-07-08">https://towardsdatascience.com/time-series-forecasting-ensemble-learning-df5fcbb48581#2022-07-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1b32" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用决策树和ARIMA模型展示集成学习的威力</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b4fe248fe49f39aaaf648f85818de231.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iYqEZ6lw5v5ZjABFPwkeRQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">仪表图像——作者<a class="ae kv" href="https://unsplash.com/@d_morgan" rel="noopener ugc nofollow" target="_blank">多丽丝·摩根</a></p></figure><p id="4047" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我将展示集成学习对于时间序列预测的预测能力。集成学习导致模型具有更高的预测准确性、更低的过拟合可能性和不同的预测集。</p><p id="7445" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将使用ASHRAE(美国供暖、制冷和空调工程师协会)提供的数据集，该数据集包含各种建筑的电力、冷冻水、蒸汽和热水的每小时计量数据。这个数据集可以在<a class="ae kv" href="https://www.kaggle.com/competitions/ashrae-energy-prediction/overview" rel="noopener ugc nofollow" target="_blank">这里</a> (CC0:公共领域)找到。在下一节中，我们将导入必要的python包，并加载计量和建筑数据。</p><h2 id="4ea3" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">加载数据</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mn"><img src="../Images/7040c2aa1683cfcca4da28d359948f96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qX3NUUZvxtfoRsZyGoeG-w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">建筑行业—按作者</p></figure><p id="8d6f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的图像中，我们可以看到有大约1400个独特的建筑分布在不同的区域。并非所有建筑物都有干净的数据，一些建筑物的计量数据比其他建筑物包含更多缺失值。让我们设想一个缺失数据点最少的建筑样本。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mo"><img src="../Images/8cb674f64bf9829b0634ffea3814040d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SQGh-mSBUKhwhQbY5evZmg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">建筑样本—按作者</p></figure><p id="a9c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到大部分的情节都大相径庭。例如，即使对于办公楼，我们也可以看到每栋建筑的用水量差异很大。这表明建筑物的区域对于每次预测可能不是很有用。</p><p id="7367" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文的剩余部分，我们将使用1266号建筑的热水用量数据。这似乎很少有错误或长时间没有使用。使用各种特征和外部数据集，我们将有望创建一个具有高预测准确性的模型。在下面的单元格中，我们隔离了这个建筑样本，将样本拆分为一个训练集和一个验证集，并绘制出结果。橄榄色数据是训练数据，紫色部分是验证集。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/e603997838e4a772cd11b784c16ec037.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*srMXYm3bz2ANgEvWgC3CKw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">1266号楼热水使用情况—作者</p></figure><p id="33a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一年中热水使用量似乎有8-10次高峰。这可能是由于低温、特殊事件或其他完全不同的原因。还有10–20分的建筑热水使用量，这可能表示假期、周末或错误。这些初步的想法不能仅用可视化来证实或否认，我们将需要在开发模型时进行进一步的探索。</p><p id="37c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在将使用数据中基于时间的特征来查看潜在的季节性。我们可以在Matplotlib中创建支线图，并获取每个可能特征值的平均计量热水用量。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/1509e7c6931cdd5eed9d371ffcb12190.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xpVkw__ADNKBz6AXCwZLWQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">潜在季节性—按作者</p></figure><p id="dcd0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与下午时段(PM)相比，上午时段(AM)似乎使用了更多的热水。有趣的是，周日的热水用量似乎比一周中的任何一天都要高。星期几、星期几和其他特征可能是重要的，或者它们可能只是噪声，但是我们不能仅从可视化中确定这一点。</p><h2 id="1d29" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">基线LGBM模型</h2><p id="29a0" class="pw-post-body-paragraph kw kx iq ky b kz mq jr lb lc mr ju le lf ms lh li lj mt ll lm ln mu lp lq lr ij bi translated">通过单独使用这些特征，我们可以生成一个基线LGBM模型。LGBM是一个基于决策树算法的梯度推进框架。这个框架不同于XGB，因为它的树模型是逐叶增长的，而不是逐层增长的。这导致更快的训练时间和相当的准确性。欲了解更多关于这些模型之间的差异，请查看本文。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="26c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们可以使用训练好的模型来预测验证集中每个小时的热水用量，并用真实标签绘制预测结果。图标题还显示了预测的RMSE(均方根误差)。这将为我们提供一个具体的度量标准，用于度量模型的准确性。请注意，我们还没有进行n步预测，我们纯粹是使用从时间戳特性设计而来的特性。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/2d64a5b9c2dcce0488cfd94ce4c58d10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VkP4j8VZBxOyVheWrJKS4w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">基线LGBM RMSE:~ 59.9——作者</p></figure><h2 id="10c6" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">假期数据</h2><p id="8c73" class="pw-post-body-paragraph kw kx iq ky b kz mq jr lb lc mr ju le lf ms lh li lj mt ll lm ln mu lp lq lr ij bi translated">在下一节中，我们将使用美国假日数据的<a class="ae kv" href="https://www.kaggle.com/datasets/donnetew/us-holiday-dates-2004-2021" rel="noopener ugc nofollow" target="_blank">外部数据源</a>(CC0:公共域)。这可能是解释热水需求低谷的有用特征，并可能提高模型的准确性。将这些数据合并到训练集中后，我们将更新模型并进行新的预测。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/c691f0c00af0404d80fdc239ccd776db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v9PUA0k-0DJRC7_Fzke9mA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">LGBM w/ Holiday RMSE:约59.9英镑——作者</p></figure><p id="8caa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个模型比以前的RMSE提高了0.0041。这是一个相当不起眼的改进，但是我们现在将保留这个特性，以防它与我们在下一节中添加的其他特性结合起来很有价值。</p><h2 id="cd68" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">气象资料</h2><p id="babf" class="pw-post-body-paragraph kw kx iq ky b kz mq jr lb lc mr ju le lf ms lh li lj mt ll lm ln mu lp lq lr ij bi translated">我要添加的第二个数据源是来自ASHRAE数据集(CC0:公共领域)的天气数据。这提供了离数据集中的建筑物最近的塔的实时历史天气测量值。</p><p id="9369" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们必须小心，因为我们的数据来自实时测量，而不是10小时的预测。如果我们只是简单地使用这种天气信息作为一个功能，我们将犯数据泄漏！因此，我们将通过向每一列添加少量高斯噪声来模拟天气数据中的误差。这将使模型更少依赖于天气数据，更不容易过度拟合。</p><p id="b795" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们可以用添加的特征来拟合LGBM模型，对新预测的RMSE进行评分，并根据其真实值绘制预测。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/a43219eb63ea2433b8540d0f02d50f26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RQzGzf-FSc4rJIr9PvPAxw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">LGBM w/ Weather RMSE:约41.8英镑——作者</p></figure><p id="c3d5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">哇！与上一次迭代相比，RMSE显著增加了约20个点。因为我们在这个模型的迭代中增加了7个特征，所以不容易看出哪个特征对准确性的提高贡献最大。幸运的是，LGBM模型本身就具有特性重要性。在下面的图中，我们将每个特征的重要性形象化。我们可以看到，所有7个特征对模型都很重要，但海平面气压、气温和风向的影响最大。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/2fd1965cac95dc3af34ed575d766e368.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*1MxGhLLORqu21K0nfQNA5w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">要素重要性图-按作者</p></figure><h2 id="3d16" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">ARIMA模型</h2><p id="70c5" class="pw-post-body-paragraph kw kx iq ky b kz mq jr lb lc mr ju le lf ms lh li lj mt ll lm ln mu lp lq lr ij bi translated">最后，我们将在预测中加入一个ARIMA模型。在现实世界中，在单一时间点对未来750小时进行预测是没有意义的。你更有可能提前n小时预测一个数据点。你做的预测越靠前，它就可能越不准确。</p><p id="8b5a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">进行n步预测的一个好处是，您可以将更多的本地化信息合并到您的模型中。我们将通过集成LGBM模型和SARIMA(季节性自回归综合移动平均)模型来实现这一点。萨里玛是基于ARIMA模型架构，但它纳入了季节性的组成部分。基于ARIMA的模型是时间序列预测的黄金标准，可以产生准确的预测。</p><p id="1714" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在下一个单元格中，我们迭代地对整个验证数据集进行10步预测，然后观察SARIMA本身的表现。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/21283e161a37a040cb47d2bb4d454cc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bkf8pba5WzAkjWxvifYOlw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">萨里玛模型RMSE: ~38.7英镑——作者</p></figure><p id="646a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">时间序列预测的黄金标准再次来袭！该模型的RMSE约为38，比LGBM模型高出近3个百分点。</p><p id="6b3b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有人可能会认为放弃LGBM模型是正确的，但是我们可以通过组合这两个模型来获得更好的模型精度。集成是指将多个模型的平均预测值进行组合，得出最终预测值。这通常会提高模型精度并减少过度拟合。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/768c8714a27016418d9b4627c453047c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DzU2dX3Wvzb9gzl0GMEbaQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">RMSE LGBM-SARIMA合奏:~ 32.3——作者</p></figure><p id="c20e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">哇！我们将SARIMA模型的RMSE提高了约7个点，将LGBM模型的提高了约9个点。这是一个重大的改进，展示了集成学习的力量。</p><h2 id="ed95" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">最后的想法</h2><p id="71b7" class="pw-post-body-paragraph kw kx iq ky b kz mq jr lb lc mr ju le lf ms lh li lj mt ll lm ln mu lp lq lr ij bi translated">集成学习在AI/ML中与在现实世界中一样强大。在现实世界中，当你和一群不同的人一起解决一个问题时，你可能会创造出更有效的解决方案。这是由于每个小组成员的独特经验和不同的技能组合。这和集成学习没什么区别。通过组合不同的模型架构和特性组合，您可以创建一组不同的预测。</p><p id="03da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想了解更多信息，我在下面提供了一些额外的资源。这篇文章的代码可以在这里找到。</p><h2 id="2ea2" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">资源</h2><ol class=""><li id="ded9" class="mw mx iq ky b kz mq lc mr lf my lj mz ln na lr nb nc nd ne bi translated"><a class="ae kv" href="https://en.wikipedia.org/wiki/Ensemble_learning" rel="noopener ugc nofollow" target="_blank">集成学习维基</a></li><li id="b5ec" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><a class="ae kv" rel="noopener" target="_blank" href="/time-series-forecasting-with-arima-sarima-and-sarimax-ee61099e78f6">时间序列预测w/ ARIMA、SARIMA和SARIMAX </a></li><li id="bc05" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><a class="ae kv" href="https://lightgbm.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> LGBM文件</a></li><li id="be84" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><a class="ae kv" href="https://www.statsmodels.org/devel/generated/statsmodels.tsa.arima.model.ARIMA.html" rel="noopener ugc nofollow" target="_blank"> StatsModels文档</a></li></ol></div></div>    
</body>
</html>