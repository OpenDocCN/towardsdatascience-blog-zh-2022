<html>
<head>
<title>How to flatten MultiIndex Columns and Rows in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 Pandas 中展平多索引列和行</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-flatten-multiindex-columns-and-rows-in-pandas-f5406c50e569#2022-03-12">https://towardsdatascience.com/how-to-flatten-multiindex-columns-and-rows-in-pandas-f5406c50e569#2022-03-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="542a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在 Pandas 数据框架中有效展平多索引列和行的 6 个技巧</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8ed2b78e6a9009b9846c834539a04336.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g_REzNbFT2kFK89VeqkZqg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安娜斯塔西娅·切平斯卡在<a class="ae ky" href="https://unsplash.com/s/photos/row-and-column?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="ec1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个<strong class="lb iu"> MultiIndex </strong>(也称为层次索引)数据帧允许您将多个列作为一个行标识符，将多个行作为一个标题标识符。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/786fadf8a269a241435af10373ca3c9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bvMuj1LBKcLwwwyQYnarpw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">熊猫多指数数据框架示例(图片由作者提供)</p></figure><p id="dea2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">MultIndex 对于复杂的数据分析非常有用，尤其是在处理高维数据时。Pandas 有多种方法可以输出多索引数据帧，例如，<code class="fe lw lx ly lz b"><a class="ae ky" rel="noopener" target="_blank" href="/all-pandas-groupby-you-should-know-for-grouping-data-and-performing-operations-2a8ec1327b5">groupby()</a></code>、<code class="fe lw lx ly lz b"><a class="ae ky" rel="noopener" target="_blank" href="/reshaping-a-dataframe-using-pandas-melt-83a151ce1907">melt()</a></code>、<code class="fe lw lx ly lz b"><a class="ae ky" rel="noopener" target="_blank" href="/a-practical-introduction-to-pandas-pivot-table-function-3e1002dcd4eb">pivot_table()</a></code>、<code class="fe lw lx ly lz b"><a class="ae ky" rel="noopener" target="_blank" href="/reshaping-a-dataframe-with-pandas-stack-and-unstack-925dc9ce1289">stack()</a></code>等。然而，有时在数据帧中使用单级索引会更容易。</p><p id="00e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，您将了解如何扁平化多索引列和行。本文组织如下:</p><ol class=""><li id="8304" class="ma mb it lb b lc ld lf lg li mc lm md lq me lu mf mg mh mi bi translated">展平列:使用<code class="fe lw lx ly lz b">get_level_values()</code></li><li id="4aa4" class="ma mb it lb b lc mj lf mk li ml lm mm lq mn lu mf mg mh mi bi translated">展平列:使用<code class="fe lw lx ly lz b">to_flat_index()</code></li><li id="fcde" class="ma mb it lb b lc mj lf mk li ml lm mm lq mn lu mf mg mh mi bi translated">展平列:连接列标签</li><li id="a496" class="ma mb it lb b lc mj lf mk li ml lm mm lq mn lu mf mg mh mi bi translated">展平行:展平所有标高</li><li id="434a" class="ma mb it lb b lc mj lf mk li ml lm mm lq mn lu mf mg mh mi bi translated">展平行:展平特定标高</li><li id="11ff" class="ma mb it lb b lc mj lf mk li ml lm mm lq mn lu mf mg mh mi bi translated">展平行:连接行标签</li></ol><blockquote class="mo"><p id="019e" class="mp mq it bd mr ms mt mu mv mw mx lu dk translated">请查看<a class="ae ky" href="https://github.com/BindiChen/machine-learning/blob/main/data-analysis/069-pandas-flatten-multiIndex/flatten-multiindex.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>获取源代码。更多教程可从<a class="ae ky" href="https://github.com/BindiChen/machine-learning" rel="noopener ugc nofollow" target="_blank"> Github Repo </a>获得。</p></blockquote></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="bed8" class="nf ng it bd nh ni nj nk nl nm nn no np jz nq ka nr kc ns kd nt kf nu kg nv nw bi translated">1.多索引列:使用<code class="fe lw lx ly lz b">get_level_values()</code></h1><p id="0c55" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">首先，让我们创建一个示例 DataFrame 并调用<code class="fe lw lx ly lz b">groupby()</code>来创建一个多索引列:</p><pre class="kj kk kl km gt oc lz od oe aw of bi"><span id="d0a5" class="og ng it lz b gy oh oi l oj ok">df = pd.DataFrame({<br/>    'name': ['Tom', 'James', 'Allan', 'Chris'],<br/>    'year': ['2000', '2000', '2001', '2001'],<br/>    'math': [67, 80, 75, 50],<br/>    'star': [1, 2, 3, 4]<br/>})</span><span id="87f1" class="og ng it lz b gy ol oi l oj ok">df_grouped = df.<strong class="lz iu">groupby('year')</strong>.agg(<br/>    { 'math': ['mean', 'sum'], 'star': 'sum'}<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/4df382796fb9a0b7aae070bf3f21d071.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jrbf5fEVgd-ZrB8GZB3swQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">多索引数据框(图片由作者提供)</p></figure><p id="da56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行<code class="fe lw lx ly lz b">df_grouped.columns</code>，我们可以看到我们有一个多索引列</p><pre class="kj kk kl km gt oc lz od oe aw of bi"><span id="7e25" class="og ng it lz b gy oh oi l oj ok">df_grouped.columns</span><span id="034a" class="og ng it lz b gy ol oi l oj ok">MultiIndex([('math', 'mean'),<br/>            ('math',  'sum'),<br/>            ('star',  'sum')],<br/>           )</span></pre><p id="8939" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">展平多索引列的最简单方法是将<code class="fe lw lx ly lz b">columns</code>设置为特定级别，例如，将<code class="fe lw lx ly lz b">columns</code>设置为顶级:</p><pre class="kj kk kl km gt oc lz od oe aw of bi"><span id="44dd" class="og ng it lz b gy oh oi l oj ok">df_grouped.columns = df_grouped<strong class="lz iu">.columns.get_level_values(0)</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/fea0697bf1347e4fb32d8d25f191875a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YbUrVQRGq3drfy1RFfjW5w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">扁平化多索引数据框架(图片由作者提供)</p></figure><p id="b25a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lw lx ly lz b">get_level_values(0)</code>返回顶层，我们将该值赋给<code class="fe lw lx ly lz b">df_grouped.columns</code>。这当然有效，但是您可能已经注意到结果有 2 个数学列。</p><h1 id="9c8c" class="nf ng it bd nh ni oo nk nl nm op no np jz oq ka nr kc or kd nt kf os kg nv nw bi translated">2.展平列:使用<code class="fe lw lx ly lz b">to_flat_index()</code></h1><p id="f96e" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">从 Pandas 版本 0.24.0 开始，<code class="fe lw lx ly lz b">to_flat_index()</code>将 MultiIndex 转换为包含级别值的元组索引:</p><pre class="kj kk kl km gt oc lz od oe aw of bi"><span id="6518" class="og ng it lz b gy oh oi l oj ok">df_grouped.<strong class="lz iu">columns.to_flat_index()</strong></span><span id="f37b" class="og ng it lz b gy ol oi l oj ok"># output<br/>Index(<strong class="lz iu">[('math', 'mean'), ('math', 'sum'), ('star', 'sum')]</strong>, dtype='object')</span></pre><p id="ac8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过将结果分配给<code class="fe lw lx ly lz b">df_grouped.columns</code>，结果将如下所示:</p><pre class="kj kk kl km gt oc lz od oe aw of bi"><span id="2023" class="og ng it lz b gy oh oi l oj ok">df_grouped.columns = df_grouped<strong class="lz iu">.columns.to_flat_index()</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/47b12b1e01cf514de169e93f485c5be9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N8l2xkZZDoztoa7KwDX1TA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">扁平化多索引数据框架(图片由作者提供)</p></figure><h1 id="96d0" class="nf ng it bd nh ni oo nk nl nm op no np jz oq ka nr kc or kd nt kf os kg nv nw bi translated">3.展平列:连接列标签</h1><p id="0d33" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">如果您想要一个更好的人类可读的单级索引，您可以连接 MultiIndex 中的值:</p><pre class="kj kk kl km gt oc lz od oe aw of bi"><span id="40ab" class="og ng it lz b gy oh oi l oj ok"><strong class="lz iu">['_'.join(col) for col in df_grouped.columns.values]</strong></span><span id="02d0" class="og ng it lz b gy ol oi l oj ok"># output<br/>['math_mean', 'math_sum', 'star_sum']</span></pre><p id="4ae6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过将结果赋值给<code class="fe lw lx ly lz b">df_grouped.columns</code>，结果将如下所示:</p><pre class="kj kk kl km gt oc lz od oe aw of bi"><span id="79b8" class="og ng it lz b gy oh oi l oj ok">df_grouped.columns <br/>  = ['_'.join(col) for col in df_grouped.columns.values]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/33f32f9d62088af52b5f52168483a8fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R62IataWTThBNWHQLPQD3A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">扁平化多索引数据框架(图片由作者提供)</p></figure><h1 id="ad02" class="nf ng it bd nh ni oo nk nl nm op no np jz oq ka nr kc or kd nt kf os kg nv nw bi translated">4.展平行:展平所有标高</h1><p id="964f" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">假设我们有以下包含多索引行的数据帧:</p><pre class="kj kk kl km gt oc lz od oe aw of bi"><span id="e224" class="og ng it lz b gy oh oi l oj ok">multi_index = pd.MultiIndex.from_tuples([<br/>  ('Oxford', 'A', '01-01-2022'), <br/>  ('Oxford', 'B', '01-01-2022'), <br/>  ('Oxford', 'A', '02-01-2022'),<br/>  ('Oxford', 'B', '02-01-2022'),<br/>  ('London', 'C', '01-01-2022'), <br/>  ('London', 'D', '01-01-2022'),<br/>  ('London', 'C', '02-01-2022'),<br/>  ('London', 'D', '02-01-2022')], <br/>  names=['Location','Store', 'Date']<br/>)</span><span id="a86e" class="og ng it lz b gy ol oi l oj ok">data = {<br/>  'Num_employee': [1,2,3,4,5,6,7,8],<br/>  'Sales': [11,22,33,44,55,66,77,88]<br/>}</span><span id="9c97" class="og ng it lz b gy ol oi l oj ok">df = pd.DataFrame(data, index=multi_index)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/1728f8a6f9c14d8493b70d7a7adc4596.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*pN_9_qlPMhQEOdk5rgtSjQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">多索引数据框架(图片由作者提供)</p></figure><p id="5d72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以简单地调用<code class="fe lw lx ly lz b">reset_index()</code>来展平 MultiIndex 的每个级别:</p><pre class="kj kk kl km gt oc lz od oe aw of bi"><span id="e2f6" class="og ng it lz b gy oh oi l oj ok">df.reset_index()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/c432a7ee827944ad531d76138ed895f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rgs069xGHZgQTB9j-uK-Tg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">扁平化多索引数据框架(图片由作者提供)</p></figure><h1 id="415d" class="nf ng it bd nh ni oo nk nl nm op no np jz oq ka nr kc or kd nt kf os kg nv nw bi translated">5.展平行:展平特定标高</h1><p id="e137" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated"><code class="fe lw lx ly lz b">reset_index()</code>中的第一个参数控制要展平的级别。默认为<code class="fe lw lx ly lz b">None</code>展平所有级别。要展平一个级别或一个级别列表，我们可以传递一个数字/字符串或一个列表:</p><pre class="kj kk kl km gt oc lz od oe aw of bi"><span id="2afc" class="og ng it lz b gy oh oi l oj ok"># Flatten 'Date' level<br/>df.reset_index(<strong class="lz iu">2</strong>)<br/>df.reset_index(<strong class="lz iu">'Date'</strong>)</span><span id="ecfe" class="og ng it lz b gy ol oi l oj ok"># Flatten 'Store' and 'Date'<br/>df.reset_index(<strong class="lz iu">[1, 2]</strong>)<br/>df.reset_index(<strong class="lz iu">['Store', 'Date']</strong>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/0d6b8a876cdc52a22649a2b9730991fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W36uQ3rzXkaF_XUyHKkcIQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">扁平化多索引数据框架(图片由作者提供)</p></figure><h1 id="d749" class="nf ng it bd nh ni oo nk nl nm op no np jz oq ka nr kc or kd nt kf os kg nv nw bi translated">6.展平行:连接行标签</h1><p id="8104" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">类似地，我们可以连接 MultiIndex 中的值来创建一个更好的人类可读的单一索引:</p><pre class="kj kk kl km gt oc lz od oe aw of bi"><span id="6e3c" class="og ng it lz b gy oh oi l oj ok">['_'.join(col) for col in df.index.values]</span><span id="f689" class="og ng it lz b gy ol oi l oj ok"># output<br/>['Oxford_A_01-01-2022',<br/> 'Oxford_B_01-01-2022',<br/> 'Oxford_A_02-01-2022',<br/> 'Oxford_B_02-01-2022',<br/> 'London_C_01-01-2022',<br/> 'London_D_01-01-2022',<br/> 'London_C_02-01-2022',<br/> 'London_D_02-01-2022']</span></pre><p id="8d46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过将结果分配给<code class="fe lw lx ly lz b">df.columns</code>，结果将如下所示:</p><pre class="kj kk kl km gt oc lz od oe aw of bi"><span id="4e5c" class="og ng it lz b gy oh oi l oj ok">df.index = ['_'.join(col) for col in df.index.values]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/878e870c9b97f0ab4212a5dcc2b18b31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hVNapRp_maqVAVO5xZBNPA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">扁平化多索引数据框架(图片由作者提供)</p></figure><h1 id="23dd" class="nf ng it bd nh ni oo nk nl nm op no np jz oq ka nr kc or kd nt kf os kg nv nw bi translated">结论</h1><p id="c37a" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">在本文中，我们讨论了关于在 Pandas 中展平多索引列和行的 6 个用例。希望这篇文章能帮你节省分析数据的时间。</p><p id="c631" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。请查看<a class="ae ky" href="https://github.com/BindiChen/machine-learning/blob/main/data-analysis/069-pandas-flatten-multiIndex/flatten-multiindex.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>获取源代码，如果您对机器学习的实用方面感兴趣，请继续关注。更多教程可从<a class="ae ky" href="https://github.com/BindiChen/machine-learning" rel="noopener ugc nofollow" target="_blank"> Github Repo </a>获得。</p></div></div>    
</body>
</html>