<html>
<head>
<title>Tips and Tricks for Loading Large CSV Files into Pandas DataFrames — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将大型 CSV 文件加载到 Pandas 数据帧的提示和技巧—第 1 部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tips-and-tricks-for-loading-large-csv-files-into-pandas-dataframes-part-1-fac6e351fe79#2022-12-21">https://towardsdatascience.com/tips-and-tricks-for-loading-large-csv-files-into-pandas-dataframes-part-1-fac6e351fe79#2022-12-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f00a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何读取大型 CSV 文件，以最大限度地减少内存使用和加载时间</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/318f3c318261ee582f26b296a4f91b27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yhdhg0tRwCA5Yn1R"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@jordanharrison?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">乔丹·哈里森</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="57e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您在现实世界中使用的大多数数据集通常非常庞大，它们以千兆字节为单位，包含数百万行。在本文中，我将讨论一些在处理大型 CSV 数据集时可以使用的技术。</p><p id="7df5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">处理大型 CSV 文件时，有两个主要问题:</p><ul class=""><li id="b3da" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">加载大型 CSV 文件时使用的内存量。</li><li id="c0bf" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">加载大型 CSV 文件所花费的时间。</li></ul><p id="a391" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">理想情况下，您希望最小化数据帧的内存占用以及加载时间。在本文中，我将使用一个样本数据集向您展示。</p><h1 id="8cba" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">我们的数据集</h1><p id="7225" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">对于本文，我将使用来自<a class="ae ky" href="https://www.kaggle.com/datasets/4e614ec846ab778f6a2ff166232d5a65f5e6786b4f5781690588bd2cccd71cb6?resource=download" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/datasets/4 e 614 EC 846 ab 778 f 6 a2 ff 166232 D5 a 65 f 5 e 6786 B4 f 5781690588 BD 2 CCD 71 CB 6 的<strong class="lb iu">日本贸易统计数据</strong>？资源=下载</a>。</p><blockquote class="ng nh ni"><p id="accd" class="kz la nj lb b lc ld ju le lf lg jx lh nk lj lk ll nl ln lo lp nm lr ls lt lu im bi translated">许可证类型:<a class="ae ky" href="https://creativecommons.org/licenses/by-sa/4.0/" rel="noopener ugc nofollow" target="_blank"> CC BY-SA 4.0 </a></p></blockquote><p id="f4ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该数据集包含 1988 年至 2020 年的贸易数据。它包含超过 1 亿行，CSV 文件占据了 4.5 Gb 的巨大空间。因此它是阐释本文中概念的理想数据集。</p><h1 id="2152" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">将 CSV 文件加载到熊猫数据帧中</h1><p id="8c6c" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">让我们首先加载超过 1 亿行的整个 CSV 文件。我很想知道加载数据帧需要多长时间，以及它的内存占用量:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="9b3e" class="ns mk it no b be nt nu l nv nw">import time<br/>import pandas as pd<br/><br/>start = time.time()<br/><br/>df = pd.read_csv("custom_1988_2020.csv")<br/><br/>print(time.time() - start, ' seconds')<br/>display(df)<br/>display(df.info())</span></pre><p id="004a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/4928ac7640d101f72ee0b0fc3541322c.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*FxSpLFy0bM89qtL-7iseFg.png"/></div></figure><p id="db99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总内存占用量高达 6.8 GB。)我花了 30 秒把它载入熊猫的数据框。</p><blockquote class="ng nh ni"><p id="1ac4" class="kz la nj lb b lc ld ju le lf lg jx lh nk lj lk ll nl ln lo lp nm lr ls lt lu im bi translated">作为参考，我用的是 32GB 内存的 Mac Studio。</p></blockquote><h1 id="cac0" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">检查列</h1><p id="d912" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">让我们检查数据框中的列:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="f72b" class="ns mk it no b be nt nu l nv nw">df.columns</span></pre><p id="f29e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您现在应该意识到这个 CSV 文件没有标题，因此 Pandas 将假定 CSV 文件中的第一行包含标题:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="b7c8" class="ns mk it no b be nt nu l ny nw">Index(['198801', '1', '103', '100', '000000190', '0', '35843', '34353'], dtype='object')</span></pre><h1 id="3423" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">使用标题加载</h1><p id="0d12" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">由于 CSV 文件没有标题，您至少可以使用<code class="fe nz oa ob no b">header</code>参数告诉 Pandas 在 CSV 文件中没有标题:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="4fe7" class="ns mk it no b be nt nu l nv nw"># loading with no headers specified<br/>df = pd.read_csv("custom_1988_2020.csv", header=None)<br/>display(df)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/0f753fc0c4e8a7637750fc5963938fa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*ef2kGrKb9GOBC5dtKkQxaw.png"/></div></figure><p id="c9ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas 现在将自动从 0 开始命名列，然后是 1，依此类推。</p><p id="70d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从<a class="ae ky" href="https://www.kaggle.com/datasets/4e614ec846ab778f6a2ff166232d5a65f5e6786b4f5781690588bd2cccd71cb6?resource=download" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/datasets/4 e 614 EC 846 ab 778 f 6 a2 ff 166232 D5 a 65 f 5 e 6786 B4 f 5781690588 BD 2 CCD 71 CB 6 上对数据集的描述？resource=download </a>，我们知道各个栏目的含义:</p><ul class=""><li id="b2a1" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">ym(年+月)</li><li id="c4a3" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">exp_imp(导出:1，导入:2)</li><li id="e5fc" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">hs9(协调制度编码)</li><li id="76be" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">海关</li><li id="3b96" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">国家</li><li id="6007" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">雌三醇环戊醚</li><li id="2a59" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">Q2(数量)</li><li id="ac4c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">价值(以千日元计)</li></ul><p id="47c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们使用<code class="fe nz oa ob no b">names</code>参数来命名列:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="89b7" class="ns mk it no b be nt nu l nv nw">df = pd.read_csv("custom_1988_2020.csv", <br/>                 header=None, <br/>                 names=['YearMonth', 'ExportImport', 'HSCode', 'Customs', <br/>                        'Country', 'Q1', 'Q2_Quantity', 'Value'])<br/>display(df)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/4c98a2fc299c5d54f5cae53c987c1877.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*eEMmrYamMMBk2Dd-JVTPeQ.png"/></div></figure><p id="e343" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">DataFrame 现在有以下列名:'<strong class="lb iu"> YearMonth' </strong>，'<strong class="lb iu"> ExportImport' </strong>，'<strong class="lb iu"> HSCode </strong>，'<strong class="lb iu">海关</strong>，'<strong class="lb iu">国家</strong>，'<strong class="lb iu"> Q1' </strong>，'<strong class="lb iu">Q2 _ 数量'</strong>，'<strong class="lb iu">值'</strong>。</p><h1 id="b01d" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">加载特定列</h1><p id="dd46" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">由于 CSV 文件如此之大，您想问自己的下一个问题是—您真的需要所有的列吗？要加载特定的列，您可以使用<code class="fe nz oa ob no b">usecols</code>参数来指定您想要加载的列:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="982f" class="ns mk it no b be nt nu l nv nw">start = time.time()<br/><br/>df = pd.read_csv("custom_1988_2020.csv", <br/>                 header=None, <br/>                 names=['YearMonth', 'ExportImport', 'HSCode', 'Customs', <br/>                        'Country', 'Q1', 'Q2_Quantity', 'Value'],                 <br/>                 usecols = ["YearMonth", "Value"])<br/><br/>print(time.time() - start, ' seconds')<br/>display(df)<br/>display(df.info())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/d7c3882132dacddb5eac6413abd1eeb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*WUYMSBS5Iv5ce_D8Zt5PIQ.png"/></div></figure><p id="56af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您从上面的输出中看到的，内存占用已经减少到 1.7GB，加载时间现在减少到 17 秒。</p><p id="4d3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nz oa ob no b">usecols</code>参数也支持列位置索引。上面的内容也可以用列号 0 和 7 重写:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="4b35" class="ns mk it no b be nt nu l nv nw">df = pd.read_csv("custom_1988_2020.csv", <br/>                 header=None, <br/>                 names=['YearMonth', 'ExportImport', 'HSCode', 'Customs', <br/>                        'Country', 'Q1', 'Q2_Quantity', 'Value'],                 <br/>                 usecols = [0, 7])<br/><br/>print(time.time() - start, ' seconds')<br/>display(df)</span></pre><p id="bea0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，不能使用-1 来表示最后一列，如下所示:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="6513" class="ns mk it no b be nt nu l nv nw">usecols = [0, -1])   # -1 is not supported</span></pre><p id="8e10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nz oa ob no b">usecols</code>参数也支持 lambda 函数。例如，如果要检索除<strong class="lb iu">国家</strong>列之外的所有列，可以使用下面的 lambda 表达式:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="1ece" class="ns mk it no b be nt nu l nv nw">df = pd.read_csv("custom_1988_2020.csv", <br/>                 header=None, <br/>                 names=['YearMonth', 'ExportImport', 'HSCode', 'Customs', <br/>                        'Country', 'Q1', 'Q2_Quantity', 'Value'],                 <br/>                 usecols = lambda column: column not in ['Country'])<br/>display(df)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/84a3cb23aefa01afee437e267ce677b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*3k04gDS2odC55hukO1IGTg.png"/></div></figure><p id="ef3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">国家</strong>列现在将从结果中排除。</p><p id="65e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nz oa ob no b">usecols</code>参数中使用 lambda 函数可以让你做一些有趣的事情，比如加载名称中包含“Q”的列，例如:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="13c2" class="ns mk it no b be nt nu l nv nw">usecols = lambda column: "Q" in column</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/52e360e368675dbe086aeb33eeb8eca9.png" data-original-src="https://miro.medium.com/v2/resize:fit:396/format:webp/1*_qVkyXW_h0DDVH8NiAhplA.png"/></div></figure><p id="5973" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者列名长度超过七个字符:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="7bd9" class="ns mk it no b be nt nu l nv nw">usecols = lambda column: len(column) &gt; 7</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/ca28b07b062c93e50471b4a7abbea48d.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*LMMLVdjVtRfif6UZiyqVSg.png"/></div></figure><h1 id="4ff0" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">加载前 n 行</h1><p id="9d19" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在许多情况下，您不需要整个 CSV 文件中的所有行。也许前 100 行就足够了。为此，您可以使用<code class="fe nz oa ob no b">nrows</code>参数来指定想要加载的前 n 行:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="5a2c" class="ns mk it no b be nt nu l nv nw">start = time.time()<br/><br/>df = pd.read_csv("custom_1988_2020.csv", <br/>                 header=None, <br/>                 names=['YearMonth', 'ExportImport', 'HSCode', 'Customs', <br/>                        'Country', 'Q1', 'Q2_Quantity', 'Value'],                 <br/>                 nrows=100)<br/><br/>print(time.time() - start, ' seconds')<br/>display(df[:15])<br/>display(df.info())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/a593ce2be2a1d12f18cb09fb96487bdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*WJRKEI7sYI-Ad2evoiax4Q.png"/></div></figure><p id="e07c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从上面的结果中，您可以看到加载前 100 行只需要 0.1 秒，生成的数据帧只占用 6.4 KB。</p><h1 id="0c4e" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">跳过行</h1><p id="708b" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">有时，您可能希望跳过 CSV 文件中的某些行。为此，使用<code class="fe nz oa ob no b">skiprows</code>参数:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="90b9" class="ns mk it no b be nt nu l nv nw">df = pd.read_csv("custom_1988_2020.csv", <br/>                 header=None, <br/>                 names=['YearMonth', 'ExportImport', 'HSCode', 'Customs', <br/>                        'Country', 'Q1', 'Q2_Quantity', 'Value'],                 <br/>                 skiprows=2,<br/>                 nrows=100<br/>)<br/>display(df[:15])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/be3a43111775d03cc209059d49ee50bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*hEgDYS58l_UFUaYBcAxIbg.png"/></div></figure><p id="a9b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的结果显示 CSV 文件的前两行被跳过:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/3b0bc91550fe6f200275028e612f984b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*L7sHOaI-uagqqPRuBoGTOQ.png"/></div></figure><p id="ea92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以跳过特定的行:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="8004" class="ns mk it no b be nt nu l nv nw">df = pd.read_csv("custom_1988_2020.csv", <br/>                 header=None, <br/>                 names=['YearMonth', 'ExportImport', 'HSCode', 'Customs', <br/>                        'Country', 'Q1', 'Q2_Quantity', 'Value'],                 <br/>                 skiprows=[0,2,4],<br/>                 nrows=100<br/>)<br/>display(df[:15])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/f1146e5a95c43e96fb3d2efd9af12139.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*ycExzGyWi2cN1r9VKLGa3g.png"/></div></figure><p id="91e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的结果显示第 0、2 和 4 行被跳过:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/b5b90c4482489982be87f89b8038ab97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*m0eMyy8yIM3_V-SU4MYasg.png"/></div></div></figure><p id="e56a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以使用一个<code class="fe nz oa ob no b">range</code>对象来指定要跳过的行的范围:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="876b" class="ns mk it no b be nt nu l nv nw">df = pd.read_csv("custom_1988_2020.csv", <br/>                 header=None, <br/>                 names=['YearMonth', 'ExportImport', 'HSCode', 'Customs', <br/>                        'Country', 'Q1', 'Q2_Quantity', 'Value'],                 <br/>                 skiprows=range(5,10),<br/>                 nrows=100<br/>)<br/>display(df[:15])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/fe03e919c49486f44a56c7957a8c2222.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*MF-Ty2ntuleJxLthylhVTA.png"/></div></figure><p id="89df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的结果显示第 5 行到第 9 行被跳过。<code class="fe nz oa ob no b">skiprows</code>参数的值也可以使用 lambda 函数编写，如下所示:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="8e3f" class="ns mk it no b be nt nu l nv nw">df = pd.read_csv("custom_1988_2020.csv", <br/>                 header=None, <br/>                 names=['YearMonth', 'ExportImport', 'HSCode', 'Customs', <br/>                        'Country', 'Q1', 'Q2_Quantity', 'Value'],                 <br/>                 skiprows=lambda x: 5 &lt;= x &lt; 10,<br/>                 nrows=100<br/>)</span></pre><p id="adf1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用 lambda 函数，您可以跳过所有偶数行:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="3e75" class="ns mk it no b be nt nu l nv nw">df = pd.read_csv("custom_1988_2020.csv", <br/>                 header=None, <br/>                 names=['YearMonth', 'ExportImport', 'HSCode', 'Customs', <br/>                        'Country', 'Q1', 'Q2_Quantity', 'Value'],                 <br/>                 skiprows=lambda x: x % 2 == 0,<br/>                 nrows=100<br/>)<br/><br/>print(time.time() - start, ' seconds')<br/>display(df[:15])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/13e4ddbb2e3da2d49a86f93d2b33ab0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*Hl33xdDy-Jx7WEC8Xu7MxA.png"/></div></figure><p id="aaf2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述结果显示所有偶数行都被跳过:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/b5b90c4482489982be87f89b8038ab97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*m0eMyy8yIM3_V-SU4MYasg.png"/></div></div></figure><h1 id="9259" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">加载特定行</h1><p id="fac7" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">到目前为止，您已经学习了如何加载前 n 行，以及跳过 CSV 文件中的特定行。如何在 CSV 文件中加载特定的行？没有允许你这样做的参数，但是你可以利用<code class="fe nz oa ob no b">skiprows</code>参数得到你想要的。</p><p id="01ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe nz oa ob no b">skiprows</code>参数中的 lambda 函数，您可以指定跳过哪些行<em class="nj">而不是</em>(这实际上意味着您<em class="nj">希望</em>加载哪些行):</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="e621" class="ns mk it no b be nt nu l nv nw">start = time.time()<br/><br/>df = pd.read_csv("custom_1988_2020.csv", <br/>                 header=None, <br/>                 names=['YearMonth', 'ExportImport', 'HSCode', 'Customs', <br/>                        'Country', 'Q1', 'Q2_Quantity', 'Value'],                 <br/>                 skiprows=lambda x: x not in [1,3],<br/>                 nrows=100<br/>)<br/><br/>print(time.time() - start, ' seconds')<br/>display(df[:15])<br/>display(df.info())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/5a148fd59bed874ac95c1a5069b3b327.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*BjH8q55sU3SVhY-EdK5foQ.png"/></div></figure><p id="e786" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的结果显示保留了编号为 1 和 3 的行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/dba087ad119dfd669abc3510904d4339.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*nxw5yKWLdqtSn1Bn2KJ8VA.png"/></div></figure><blockquote class="ng nh ni"><p id="fd38" class="kz la nj lb b lc ld ju le lf lg jx lh nk lj lk ll nl ln lo lp nm lr ls lt lu im bi translated">这种方法的缺点是必须扫描整个 CSV 文件，因此仅加载两行就需要 20 秒。</p></blockquote><h1 id="69a1" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">正在加载最后 n 行</h1><p id="99a2" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我想讨论的最后一个挑战是如何从 CSV 文件中加载最后 n 行。虽然加载前 n 行很容易，但加载后 n 行就不那么简单了。但是你可以利用你到目前为止所学的知识来解决这个问题。</p><p id="d8ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，计算 CSV 文件中有多少行:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="1d89" class="ns mk it no b be nt nu l nv nw"># read the last n rows<br/>start = time.time()<br/><br/>row_count = sum(1 for l in open('custom_1988_2020.csv')) <br/><br/>print(time.time() - start, ' seconds')<br/>row_count</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/020ad8f08ae05f1b69428b2f926583ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/format:webp/1*QM14ZkTrSRP5R67TDJNmiw.png"/></div></figure><p id="6eac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于 CSV 文件中有超过 1 亿行，所以计算行数大约需要 10 秒钟。另外，记住这个 CSV 文件没有头文件。所以 113607322 是记录的实际行数。</p><p id="f75a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，要加载最后 20 行，使用<code class="fe nz oa ob no b">skiprows</code>参数并传递给它一个 lambda 函数来跳过除最后 20 行之外的所有行:</p><pre class="kj kk kl km gt nn no np bn nq nr bi"><span id="6c70" class="ns mk it no b be nt nu l nv nw"># read the last n rows<br/>start = time.time()<br/><br/>df = pd.read_csv("custom_1988_2020.csv", <br/>                 header=None, <br/>                 names=['YearMonth', 'ExportImport', 'HSCode', 'Customs', <br/>                        'Country', 'Q1', 'Q2_Quantity', 'Value'],                 <br/>                 skiprows=lambda x: 0 &lt;= x &lt; row_count - 20,<br/>                 nrows=100)<br/><br/>print(time.time() - start, ' seconds')<br/>display(df)<br/>display(df.info())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/13bd05c89afa12a6093a00c5833077d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*Js-sH435wykde_xJoFq7ww.png"/></div></figure><p id="d05b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果显示了加载到 Pandas 数据帧中的最后 20 行。</p><blockquote class="ng nh ni"><p id="3cf1" class="kz la nj lb b lc ld ju le lf lg jx lh nk lj lk ll nl ln lo lp nm lr ls lt lu im bi translated">与上一节一样，缺点是在加载过程中必须扫描整个 CSV 文件(因此加载数据帧需要 22 秒)。</p></blockquote><h2 id="74b4" class="or mk it bd ml os ot dn mp ou ov dp mt li ow ox mv lm oy oz mx lq pa pb mz pc bi translated">如果你喜欢阅读我的文章，并且认为它对你的职业/学习有所帮助，请考虑注册成为一名灵媒会员。每月 5 美元，你可以无限制地访问 Medium 上的所有文章(包括我的)。如果你使用下面的链接注册，我会赚一小笔佣金(不需要你额外付费)。你的支持意味着我将能够投入更多的时间来写这样的文章。</h2><div class="pl pm gp gr pn po"><a href="https://weimenglee.medium.com/membership" rel="noopener follow" target="_blank"><div class="pp ab fo"><div class="pq ab pr cl cj ps"><h2 class="bd iu gy z fp pt fr fs pu fu fw is bi translated">加入媒介与我的介绍链接-李伟孟</h2><div class="pv l"><h3 class="bd b gy z fp pt fr fs pu fu fw dk translated">阅读李维孟(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="pw l"><p class="bd b dl z fp pt fr fs pu fu fw dk translated">weimenglee.medium.com</p></div></div><div class="px l"><div class="py l pz qa qb px qc ks po"/></div></div></a></div><h1 id="839e" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">摘要</h1><p id="a198" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在本文中，我介绍了从 CSV 文件中加载熊猫数据帧的多种技术。通常，不需要将整个 CSV 文件加载到数据帧中。通过只加载您需要的内容，您不仅节省了时间，还节省了在内存中保存数据帧所需的内存。在下一篇文章中，我将向您展示减少数据帧内存占用的技术。敬请期待！</p></div></div>    
</body>
</html>