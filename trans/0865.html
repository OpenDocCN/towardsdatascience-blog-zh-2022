<html>
<head>
<title>The Battle of Interactive Geographic Visualization Part 4 — Altair</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">交互式地理可视化之战第四部分——牛郎星</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-battle-of-interactive-geographic-visualization-part-4-altair-5b67e3e5e29e#2022-03-08">https://towardsdatascience.com/the-battle-of-interactive-geographic-visualization-part-4-altair-5b67e3e5e29e#2022-03-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="dbe6" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">PYTHON。数据科学。地理可视化。</h2><div class=""/><div class=""><h2 id="b83c" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用 Altair 软件包创建漂亮的交互式地理绘图</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/89bf58d725aa25a22727da2b9e84a168.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OGY9XvFAk-Vkbm6o"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://unsplash.com/@claybanks?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">粘土银行</a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><h1 id="7d2c" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">我们离开的地方</h1><p id="1168" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">在这个系列中，我们已经确定了三(3)种制作美丽的地理散射图的方法。</p><ul class=""><li id="db5f" class="mw mx it mc b md my mg mz mj na mn nb mr nc mv nd ne nf ng bi translated"><strong class="mc jd">全息视图</strong> — <a class="ae lh" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-1-interactive-geoplot-using-one-line-of-8214e9ed1bb4">交互式地理可视化之战第一部分——使用一行代码的交互式地理地图</a></li><li id="a456" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated"><strong class="mc jd"> Plotly Express — </strong> <a class="ae lh" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-2-interactive-geoplot-using-one-line-of-2118af59a77c">交互式地理可视化之战第二部分——使用一行代码的交互式 geo plot</a></li><li id="62b3" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated"><strong class="mc jd"> Plotly Go </strong> — <a class="ae lh" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-3-plotly-graph-objects-go-c3d3f2a00132">交互式地理可视化之战第三部分——Plotly 图形对象(Go) </a></li></ul><p id="b7b7" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">在本文中，我们将学习如何使用数据科学社区中 plotly 包最著名的竞争对手之一 Altair 来创建类似的图。</p><h1 id="4e51" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">牵牛星作为一个包</h1><p id="0de2" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">Altair 被比作 Plotly Express，因为它是一种高级声明性语言，很像 seaborn、holoviews 和 ggplot。这意味着我们用控制来换取易用性。</p><p id="5803" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">与其他图表不同，Altair 专注于拥有一种图形语法，在这种语法中，从单个图形创建组合图表更容易，类似于如何将单词组合成人类句子。这使得 Altair 的语法更加接近 ggplot，对于 R 用户来说是一个优势。</p><p id="dde6" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">Altair 也有我们称之为“交互语法”的东西，可以很容易地在部件和情节之间，以及情节本身之间创建交互。例如，在我们下面的图中，与图表左侧的交互将模拟我们与右侧的交互，只要它们属于同一个图表。</p><p id="854f" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">最后，当谈到外观时，Altair 会在您调整情节大小时保留情节的元素。这在我们不断添加更多类别时非常有用，这与其他可视化库不同，后者维护的是整体绘图属性(图形大小)，从而扭曲了绘图元素。</p><h1 id="bb3b" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated"><strong class="ak">编码</strong></h1><h2 id="8452" class="np lj it bd lk nq nr dn lo ns nt dp ls mj nu nv lu mn nw nx lw mr ny nz ly iz bi translated">预赛</h2><p id="b79b" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">和其他人一样，让我们装载我们的包:</p><pre class="ks kt ku kv gt oa ob oc od aw oe bi"><span id="a059" class="np lj it ob b gy of og l oh oi">import pandas as pd<br/>import altair as alt</span><span id="b2aa" class="np lj it ob b gy oj og l oh oi">import geopandas as gpd<br/>from shapely.geometry import Point</span><span id="8a1f" class="np lj it ob b gy oj og l oh oi">alt.renderers.enable('default') #Allows the map to be displayed in the notebook/Jupyterlab</span></pre><h2 id="1427" class="np lj it bd lk nq nr dn lo ns nt dp ls mj nu nv lu mn nw nx lw mr ny nz ly iz bi translated">加载数据集</h2><p id="9698" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">加载以下数据集:</p><pre class="ks kt ku kv gt oa ob oc od aw oe bi"><span id="1b3d" class="np lj it ob b gy of og l oh oi">df = pd.read_csv('data/Coffee Brands Footprint.csv',<br/>                index_col=0)<br/>df.head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ok"><img src="../Images/9785790201dbbed1d59a9c918e38e9a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nHWg6Ib-a1IPz8Cf.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片:我们数据集的前五次观察。</p></figure><p id="aaee" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated"><strong class="mc jd"> <em class="ol">使用 Altair 的一点警告:</em> </strong> <em class="ol"> Altair 使用数据转换器，要求所有列都是“JSON 可序列化的”。这意味着您的列中不应该有几何数据类型。</em></p><p id="cbe7" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">现在，与 Plotly 不同，我们需要导入自己的 shapefiles 来提供地图的边界。<a class="ae lh" href="https://gadm.org/" rel="noopener ugc nofollow" target="_blank">https://gadm.org/</a>提供了几乎所有你需要的 shapefiles。</p><h2 id="dbb7" class="np lj it bd lk nq nr dn lo ns nt dp ls mj nu nv lu mn nw nx lw mr ny nz ly iz bi translated">加载形状文件</h2><pre class="ks kt ku kv gt oa ob oc od aw oe bi"><span id="46fa" class="np lj it ob b gy of og l oh oi">#Load the geodataframe<br/>gdf = gpd.read_file('Shapefiles/gadm36_PHL_shp/gadm36_PHL_1.shp')</span><span id="05b7" class="np lj it ob b gy oj og l oh oi">#Options When It Comes to Boundaries of the Shapefile</span><span id="c774" class="np lj it ob b gy oj og l oh oi">philippines = alt.Chart(gdf).mark_geoshape(stroke='white',<br/>                            fill='lightgray').encode().properties(width=400,<br/>                                                                 height=800).project('mercator')</span><span id="b5b7" class="np lj it ob b gy oj og l oh oi">philippines</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi om"><img src="../Images/14f0f5abea2e6063d6811c40a7c75201.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*ufy-LK4eQgqRpgY7VzmCcA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片由作者提供:在 Jupyterlab 展示的菲律宾 Shapefile</p></figure><p id="3c8d" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">让我们回顾一下上面的一些选项:</p><ul class=""><li id="4397" class="mw mx it mc b md my mg mz mj na mn nb mr nc mv nd ne nf ng bi translated">表示“另类的”图表—这段代码从提供的数据集创建 Altair 图表。在这种情况下，我们提供了地理数据框架。</li><li id="0070" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated">mark _ geo shape——该命令让 Altair 知道数据帧的属性应该如何准确地在绘图中表示；在我们的例子中，它是一个 geo_shape。</li><li id="6265" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated">描边-这是指线颜色或地理数据框的边界。政治边界越详细，这个参数就越重要。</li><li id="6cf7" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated">填充-地图的颜色填充。</li><li id="e5ad" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated">编码—这是将列映射到映射的可视属性的代码部分。</li><li id="0849" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated">属性——我们用它来改变图(或图形)本身的宽度、高度或任何其他属性。</li><li id="7521" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated">投影-投影类型。在我们的情况下是可选的，但对大多数美国地图有帮助。</li></ul><h2 id="85d2" class="np lj it bd lk nq nr dn lo ns nt dp ls mj nu nv lu mn nw nx lw mr ny nz ly iz bi translated">绘制地理散射图</h2><p id="1809" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">下面的代码将创建一个类似的散点图，就像我们前三(3)篇文章一样:</p><pre class="ks kt ku kv gt oa ob oc od aw oe bi"><span id="01b2" class="np lj it ob b gy of og l oh oi">points = alt.Chart(df).mark_circle(opacity=0.7).encode(<br/>    longitude='lng:Q',<br/>    latitude='lat:Q',<br/>    size=alt.value(10),<br/>    color='brand',<br/>    tooltip=['brand', 'vicinity'])</span><span id="777d" class="np lj it ob b gy oj og l oh oi">points</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi on"><img src="../Images/13f8964cdb23182e6e904947d16db23c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/1*UAl8Sk1sx6sN_loCb8iXoA.gif"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">GIF by Author:生成的散点不受 shapefile 的限制。</p></figure><p id="762d" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">这些参数与我们用于 geoshape 的参数非常相似，但是请注意，对于 geoscatterplots，我们需要为<code class="fe oo op oq ob b">longitude</code>和<code class="fe oo op oq ob b">latitude</code>填充参数或自变量。</p><p id="13fe" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">注意，提供该参数的格式是“<strong class="mc jd"> column_name:Q </strong>”。因为我们的经度列被命名为‘LNG’，所以提供给经度列的值是<code class="fe oo op oq ob b">lng:Q</code>。代码工作所需的<code class="fe oo op oq ob b">:Q</code>是<strong class="mc jd"/>。还要注意，对于尺寸参数，我们也使用了<code class="fe oo op oq ob b">alt.value</code>。</p><h2 id="160f" class="np lj it bd lk nq nr dn lo ns nt dp ls mj nu nv lu mn nw nx lw mr ny nz ly iz bi translated">结合这两个图</h2><p id="99dc" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">最后，Altair 地图的一个非常酷的特性，尤其是地理可视化，就是你可以简单地添加我们之前创建的两个地图。</p><pre class="ks kt ku kv gt oa ob oc od aw oe bi"><span id="89f3" class="np lj it ob b gy of og l oh oi">points | philippines + points</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi or"><img src="../Images/b7c2ef76e0ddea0f206085a63dc0b290.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*a-uBtHYtD-RqMH62EG7gxQ.gif"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者 GIF:只需使用“+”号就可以将两个图形相加。</p></figure><h1 id="2494" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">结束语</h1><p id="cde9" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">Altair 被认为是一个高级声明库，所以它的易用性必须与 plotly express 相提并论。因为它能够读取我们导入的 shapefile，所以它有能力变得更加优雅，尤其是对于较低级别的边界。</p><p id="9e8c" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">虽然 Altair 对于 geoscatterplot 来说同样很棒，但是对于 choropleth 来说同样很容易使用。请继续关注我们尝试使用不同的包来创建 choropleths。</p><p id="094b" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">感谢阅读，并让我知道你的想法！</p><p id="f104" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated"><strong class="mc jd">请查看我的其他文章:</strong></p><p id="52ab" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-1-interactive-geoplot-using-one-line-of-8214e9ed1bb4">交互式地理可视化之战第一部分——使用一行代码的交互式地理地图</a></p><p id="f1f0" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-2-interactive-geoplot-using-one-line-of-2118af59a77c">交互式地理可视化之战第二部分——使用一行代码的交互式地理地图</a></p><p id="1eb0" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-3-plotly-graph-objects-go-c3d3f2a00132">交互式地理可视化之战第三部分——Plotly 图形对象(Go) </a></p><p id="db1e" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/mapping-your-favorite-coffee-shop-in-the-philippines-using-google-places-api-and-folium-2f9d5ad697bf?source=your_stories_page----------------------------------------">使用 Google Places API 和 fluous 为您在菲律宾最喜欢的咖啡店绘制地图</a></p><p id="cdb8" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/psvisualizing-the-philippines-population-density-using-geopandas-ab8190f52ed1?source=your_stories_page----------------------------------------">使用 GeoPandas 可视化菲律宾的人口密度</a></p><h1 id="4fa4" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated"><strong class="ak">参考文献</strong></h1><p id="b17c" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated"><a class="ae lh" href="https://stackoverflow.com/questions/59845407/plotly-express-vs-altair-vega-lite-for-interactive-plots#:~:text=One%20notable%20difference%20is%20that,fit%20an%20overall%20plot%20size." rel="noopener ugc nofollow" target="_blank"> STACKOVERFLOW:牛郎星 vs Plotly Express </a></p></div></div>    
</body>
</html>