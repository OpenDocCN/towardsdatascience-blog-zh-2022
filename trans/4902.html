<html>
<head>
<title>Using Eurostat statistical data on Europe with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python处理欧盟统计局的欧洲统计数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-eurostat-statistical-data-on-europe-with-python-2d77c9b7b02b#2022-11-01">https://towardsdatascience.com/using-eurostat-statistical-data-on-europe-with-python-2d77c9b7b02b#2022-11-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4c86" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">欧统局是欧洲统计的主要切入点。本文将帮助您快速学习如何使用Python中的数据。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ba2a252152f138c0d78b454d1a3fb5e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cgYBmcVdkU7oDevB"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@lukechesser?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卢克·切瑟</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="bb57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">欧盟统计局是欧盟的统计机构。他们的任务是提供欧洲的统计数字和数据。所有的数据都可以浏览和下载。你可以在这里浏览他们完整的数据库。本文的最终代码可以在我的GitHub上以<a class="ae ky" href="https://github.com/lmeulen/EasyEuroStat" rel="noopener ugc nofollow" target="_blank"> easy_eurostat包</a>的形式获得。</p><h2 id="c0f5" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">数据集</h2><p id="887e" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">所有表格都可以通过它们的识别码下载。此代码显示在数据库浏览器中数据集名称后面的括号中。请看下图中的红圈。下载的文件是gzipped tar格式的，包含一个制表符分隔的数据文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/d02b5442a8e58614c627526fcc5d7a6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rZ3jgxWe9Aw_2UK6NLnNGg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">红圈表示数据集ID(作者截图)</p></figure><p id="d228" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用数据集识别码，可以从URL下载带有参数<code class="fe mu mv mw mx b">file=data/dataset.tsv.gz</code>的格式<code class="fe mu mv mw mx b">https://ec.europa.eu/eurostat/estat-navtree-portlet-prod/BulkDownloadListing</code>的数据集:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="158b" class="lv lw it mx b gy nc nd l ne nf">import os<br/>import gzip<br/>import urllib.request</span><span id="d057" class="lv lw it mx b gy ng nd l ne nf">def download_eurostat_dataset(dataset):<br/>    url = "<a class="ae ky" href="https://ec.europa.eu/eurostat/estat-navtree-portlet-prod/BulkDownloadListing?file=data/" rel="noopener ugc nofollow" target="_blank">https://ec.europa.eu/eurostat/" + \<br/>          "estat-navtree-portlet-prod/" + \<br/>          "BulkDownloadListing?file=data/</a>" + \<br/>          dataset + ".tsv.gz"<br/>    out_file = os.path.join("cache", dataset + ".tsv")<br/>    if os.path.exists(out_file):<br/>        return<br/>    try:<br/>        with urllib.request.urlopen(url) as resp:<br/>            with gzip.GzipFile(fileobj=resp) as data:<br/>                file_content = data.read()</span><span id="b94e" class="lv lw it mx b gy ng nd l ne nf"># Write to file in binary mode 'wb'<br/>        with open(out_file, 'wb') as f:<br/>            f.write(file_content)<br/>    except Exception as e:<br/>        print(e)</span><span id="9ac5" class="lv lw it mx b gy ng nd l ne nf">download_eurostat_dataset("teilm020")</span></pre><p id="6f5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个例子下载数据集<code class="fe mu mv mw mx b">teilm020</code>(失业数字)并将制表符分隔的文件存储在缓存目录中。数据集保存在磁盘上，因此可以用作欧盟统计局数据库的缓存版本。gzipped文件加载到内存中，并在写入前解压缩。在这种情况下，由于数据集的大小有限，在内存中工作不成问题。</p><p id="a0e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">存储的文件是制表符分隔的格式，除了第一列是逗号分隔的(让我们不要让它太容易)。深入研究CSV导入函数的工作方式，可以发现一种复杂的方式来接受逗号和制表符作为分隔符。因此，要将数据集加载到Pandas数据帧中，我们可以使用以下代码:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="d17f" class="lv lw it mx b gy nc nd l ne nf">def get_eurostat_dataset(dataset):<br/>    download_eurostat_dataset(dataset)<br/>    df = pd.read_csv(os.path.join("cache", dataset + ".tsv"),<br/>                     sep=",|\t| [^ ]?\t", na_values=":",<br/>                     engine="python")<br/>    df.columns = [x.split('\\')[0].strip(' ') for x in df.columns]<br/>    return df</span><span id="74a6" class="lv lw it mx b gy ng nd l ne nf">df = get_eurostat_dataset("teilm020")</span></pre><p id="e968" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从周围的空格中清除列名(有时在列名的末尾有一个空格)，最后一列有一个后缀“\time”，表示后面的列是时间序列。这个后缀也被删除。</p><p id="137c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">产生的数据帧如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/491c1cd9ce30116bdcf6d7e4cd7dd26c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aoxhv_VNbrGvhcqOE-vFMw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">失业数据的数据框架(作者截图)</p></figure><h2 id="592d" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">字典</h2><p id="87aa" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">前五列是代码，指代码列表。这些代码清单(字典)可以在欧盟统计局网站上的<a class="ae ky" href="https://ec.europa.eu/eurostat/estat-navtree-portlet-prod/BulkDownloadListing?sort=1&amp;dir=dic%2Fen" rel="noopener ugc nofollow" target="_blank">这里</a>找到。列名等于该位置的<code class="fe mu mv mw mx b">.dic</code>文件的名称。该文件包含由制表符分隔的键/值对。<em class="ni">键</em>是缩写，<em class="ni">值</em>是全文。在数据集中，编码列是第一个不是用制表符分隔而是用逗号分隔的列。遍历这些列名，我们可以用文本值逐个替换它们。</p><p id="2103" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了用它们的值替换代码，我们需要从Eurostat加载字典文件，并将其导入字典:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="14af" class="lv lw it mx b gy nc nd l ne nf">def download_eurostat_dict(dictionary):<br/>    dictionary = dictionary.lower()<br/>    url = "<a class="ae ky" href="https://ec.europa.eu/eurostat/estat-navtree-portlet-prod/BulkDownloadListing?sort=1&amp;downfile=dic%2Fen%2F" rel="noopener ugc nofollow" target="_blank">https://ec.europa.eu/eurostat/" + \<br/>          "estat-navtree-portlet-prod/BulkDownloadListing" + \<br/>          "?sort=1&amp;downfile=dic%2Fen%2F</a>" +\<br/>          dictionary + ".dic"<br/>    out_file = os.path.join("cache", dictionary + ".dic")<br/>    if os.path.exists(out_file):<br/>        return<br/>    try:<br/>        with urllib.request.urlopen(url) as resp:<br/>                file_content = resp.read().decode('utf-8')<br/>        with open(out_file, 'w') as f:<br/>            f.write(file_content)<br/>    except Exception as e:<br/>        print(e)<br/>    <br/>def get_eurostat_dictionary(dictionary, inverse=False):<br/>    download_eurostat_dict(dictionary)<br/>    filename = os.path.join("cache", dictionary + ".dic")<br/>    try:<br/>        with open(filename) as f:<br/>            d = {}<br/>            for line in f:<br/>                if len(line) &gt; 1:<br/>                    row = line.split('\t')<br/>                    d[row[0]] = row[1].strip()<br/>        if inverse:<br/>            d = {v: k for k, v in d.items()}<br/>        return d<br/>    except:<br/>        return {}</span></pre><p id="b68a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与数据集一样，副本被下载到用作缓存的本地文件夹中。不同之处在于，字典文件没有压缩，可以下载后存储。</p><p id="b618" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">字典文件每行包含一个由制表符分隔的键/值对。一些字典文件在每个键/值对之间包含一个空行，因此需要检查行长度以跳过空行。该值从' \n '字符中去除。</p><p id="d17c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了字典，数据帧中的代码可以被替换。Panda dataframe有一个特定于此功能的方法<code class="fe mu mv mw mx b">replace()</code>。当在以字典作为参数的列上调用它时，该列中的所有值都将被替换为与当前列值相关联的值作为键。</p><h2 id="ed7b" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">替换代码</h2><p id="839c" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated"><code class="fe mu mv mw mx b">get_eurostat_dataset</code>方法扩展了用值替换代码列键的功能:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="c49e" class="lv lw it mx b gy nc nd l ne nf">def get_eurostat_dataset(dataset):<br/>    download_eurostat_dataset(dataset)<br/>    df = pd.read_csv(os.path.join("cache", dataset + ".tsv"),<br/>                     sep=",|\t| [^ ]?\t", na_values=":", <br/>                     engine="python")<br/>    df.columns = [x.split('\\')[0].strip(' ') for x in df.columns]<br/>    # Now get the dictionary columns (first line, comma sep)<br/>    with open(os.path.join("cache", dataset + ".tsv")) as f:<br/>        first_line = f.readline()<br/>    codes = first_line.split('\t')[0].split('\\')[0].split(',')<br/>    # Replace codes with value<br/>    for c in codes:<br/>        code_list = get_eurostat_dictionary(c)<br/>        df[c] = df[c].replace(code_list)<br/>    df = df.set_index(codes).transpose()<br/>    return df</span></pre><p id="66df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在返回之前，数据帧被转置，所有代码列都是多级列索引的一部分。起初，这似乎很复杂，但数据框架变得更容易使用。</p><p id="4e92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">读取相同的数据集现在会导致:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/9a655f1c3436ad87a1c4df6c66a61df5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MUtt-PpSbJrkpjT34AipjA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">更新的数据框架(作者截图)</p></figure><h2 id="fc1c" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">从数据集到图表</h2><p id="62f4" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">访问和使用多索引列的工作方式如下:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="9f84" class="lv lw it mx b gy nc nd l ne nf">&gt;&gt;&gt; # Get names of all levels<br/>&gt;&gt;&gt; print(df.columns.names)</span><span id="89cf" class="lv lw it mx b gy ng nd l ne nf">['s_adj', 'age', 'sex', 'unit', 'geo']</span><span id="5141" class="lv lw it mx b gy ng nd l ne nf">&gt;&gt;&gt; # Obtaining all unique values for level 2 ('sex')<br/>&gt;&gt;&gt; print(df.columns.get_level_values(1).unique())</span><span id="3b5e" class="lv lw it mx b gy ng nd l ne nf">Index(['Females', 'Males', 'Total'], dtype='object', name='sex')</span><span id="d096" class="lv lw it mx b gy ng nd l ne nf">&gt;&gt;&gt; #Selecting unemployment data for all sexes combined<br/>&gt;&gt;&gt; df.loc[:, ('Seasonally adjusted data, ...',<br/>               'Total', <br/>               'Total',<br/>               'Percentage of population in the labour force')]</span></pre><p id="525c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，以创建奥地利失业数据的条形图为例:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="e726" class="lv lw it mx b gy nc nd l ne nf">d = df.loc[:, ('Seasonally adjusted data, not calendar adjusted' +\<br/>               ' data','Total', 'Total',<br/>               'Percentage of population in the labour force')]<br/>ax = d['Austria'].plot.bar()<br/>ax.set_title('Unemployment in Austria')<br/>ax.set_xlabel('Month')<br/>_ = ax.set_ylabel('Unemployment percentage')</span></pre><p id="dec7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导致</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/9485301b921e82809c11d59e07a784f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*07MfozUuTQP2NIWqCdLmSQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">奥地利失业率(作者截图)</p></figure><p id="26ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，现在我们知道如何从欧盟统计局下载和准备数据，并使用它来创建图表。所有数据集都包含每个国家的数据，因此下一步是制作一个choropleth地图。</p><h2 id="df0d" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">等值区域图</h2><p id="533b" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">欧盟统计局还提供了地理数据。该地理数据包含国家边界、地区边界、城市等。详细程度称为NUTS，NUTS级别0是国家级别。通过增加这个数字，可以添加更多的细节，但是现在级别0已经足够了:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="010f" class="lv lw it mx b gy nc nd l ne nf">import geopandas as gpd</span><span id="ee50" class="lv lw it mx b gy ng nd l ne nf">def download_url(url, filename, binary=False):<br/>    if os.path.exists(filename):<br/>        return<br/>    try:<br/>        with urllib.request.urlopen(url) as resp:<br/>                file_content = resp.read()<br/>                if not binary:<br/>                    file_content = file_content.decode('utf-8')<br/>        with open(filename, 'wb' if binary else 'w') as f:<br/>            f.write(file_content)<br/>    except Exception as e:<br/>        print(e)</span><span id="62a9" class="lv lw it mx b gy ng nd l ne nf">def download_eurostat_geodata():<br/>    url = "<a class="ae ky" href="https://gisco-services.ec.europa.eu/distribution/v2/nuts/shp/NUTS_RG_20M_2021_3035.shp.zip" rel="noopener ugc nofollow" target="_blank">https://gisco-services.ec.europa.eu/distribution/v2/" +\<br/>          "nuts/shp/NUTS_RG_20M_2021_3035.shp.zip</a>"<br/>    out_file = os.path.join('data', <br/>                            'NUTS_RG_20M_2021_3035.shp.zip')<br/>    download_url(url, out_file, binary=True)</span></pre><p id="c610" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用比例为1:20mio的<code class="fe mu mv mw mx b">RG_20M</code>文件。如果需要更多细节，还有1:10mio、1:3mio和1:1mio文件可供选择。替换文件名中的<code class="fe mu mv mw mx b">20M</code>以下载另一台秤，例如1:10米欧秤的<code class="fe mu mv mw mx b">10M</code>。</p><p id="9c1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下载的zip文件包含一个<a class="ae ky" href="https://en.wikipedia.org/wiki/Shapefile" rel="noopener ugc nofollow" target="_blank">地理空间形状文件</a>。ESRI的这种文件格式是矢量化地理空间数据最常见的格式。它由表示地理空间项目(国家、道路等)的点、线和多边形组成。所有项目都可以有与之关联的属性。</p><p id="614a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://geopandas.org/en/stable/" rel="noopener ugc nofollow" target="_blank"> GeoPandas包</a>是处理地理空间数据的优秀Python包。它是Pandas数据框架的扩展，增加了地理空间功能。它可以与pip或Conda一起安装:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="502d" class="lv lw it mx b gy nc nd l ne nf">pip install geopandas</span><span id="68be" class="lv lw it mx b gy ng nd l ne nf">or</span><span id="08cb" class="lv lw it mx b gy ng nd l ne nf">conda install -c conda-forge geopandas</span></pre><p id="c35d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">GeoPandas能够以zip格式打开shapefile:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="25d6" class="lv lw it mx b gy nc nd l ne nf">def get_eurostat_geodata(lvl=0):<br/>    download_eurostat_geodata()<br/>    borders = gpd.read_file(os.path.join('data', <br/>                            'NUTS_RG_20M_2021_3035.shp.zip'))  <br/>    return borders[borders['LEVL_CODE'] == lvl]</span></pre><p id="fa68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">生成的数据帧如下所示。<code class="fe mu mv mw mx b">geometry</code>列包含地理空间项目，在本例中，它们都是多边形(<code class="fe mu mv mw mx b">MULTIPOLYGON</code>)。其他列是属性。国家代码在<code class="fe mu mv mw mx b">NUTS_ID</code>和<code class="fe mu mv mw mx b">CNTR_CODE</code>列中。国家代码列对于一个国家的所有元素都是相同的，例如包括道路、河流和城市。<code class="fe mu mv mw mx b">NUTS_ID</code>是一个独特的标识，当国家代码出现在该列时，该行包含国家边界。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/08e60bf45e310328edb80c876034cbad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jZxxMYAIqmwSPEzeZgHRtg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GeoPandas数据框架内容(作者截图)</p></figure><p id="0a86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了检查数据帧的内容，我们可以用内置的<code class="fe mu mv mw mx b">plot()</code>方法绘制它。</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="a2f4" class="lv lw it mx b gy nc nd l ne nf">countries = get_eurostat_geodata()</span><span id="4bd2" class="lv lw it mx b gy ng nd l ne nf">ax = countries.plot()<br/>ax.set_xlim(2000000, 8000000)<br/>ax.set_ylim(1000000, 5500000)</span></pre><p id="74a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这导致了欧洲的一个阴谋:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/b0fbe2afe76c6863f3b4a83b48dbf515.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HT3WThC_ueKvLxuQ2w3RMw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">欧洲示例图(作者截图)</p></figure><p id="0663" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">x和y限制裁剪掉了像加那利群岛这样遥远的部分。</p><p id="831c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当<code class="fe mu mv mw mx b">plot()</code>参数<code class="fe mu mv mw mx b">column</code>被指定时，一个choropleth映射被创建。该列用于根据该列的值对国家/地区进行着色。首先，我们必须把失业数据框架和国家数据框架结合起来。国家数据框架使用国家缩写作为标识。这个缩写在包含国家全称的失业数据的导入阶段被删除。地理词典用于反向翻译。</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="6d49" class="lv lw it mx b gy nc nd l ne nf">d = df.loc[:, ('Seasonally adjusted data, not calendar adjusted' +\<br/>                ' data','Total', 'Total',<br/>                'Percentage of population in the labour force')]<br/>d = d[d.index == '2022M08'].transpose().reset_index()<br/>code_list = get_eurostat_dictionary('geo', inverse=True)<br/>d['geo'] = d['geo'].replace(code_list)<br/>d = countries.merge(d, right_on='geo', left_on='NUTS_ID')</span></pre><p id="cc35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，像以前一样过滤失业数据(所有性别的总人数)。选择2022年08月是因为它是包含所有国家数据的最后一行。此后，数据帧被转置，导致</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/baac01425ef9e3ac783dca750acf0871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YO9yPA128W8_hv8MQ7QcsA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">每个国家的失业率(作者截图)</p></figure><p id="b360" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">字典用于将国名翻译回它们的缩写。</p><p id="574b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">失业数据和国家数据现在可以合并了。确保将失业数据合并到国家数据中，以确保生成的数据框确实是能够绘制地图的GeoPandas数据框。国家代码在<code class="fe mu mv mw mx b">countries</code>数据框的<code class="fe mu mv mw mx b">NUTS_ID</code>栏中。绘制choropleth图的最终代码是</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="606c" class="lv lw it mx b gy nc nd l ne nf">ax = d.plot(column='2022M08', legend=True)<br/>ax.set_xlim(2000000, 7000000)<br/>ax.set_ylim(1000000, 6000000)<br/>ax.set_title('Unemployment in the European Union')</span></pre><p id="db24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导致</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/0ae269e93b68ae00617be48995b39440.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FJceLrBs0VF3Ayw1s70yzA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">欧洲失业地图(作者截图)</p></figure><p id="b860" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">恭喜你！现在，您已经拥有了使用欧盟统计局开放数据的所有工具，包括创建图表和地图。</p><h2 id="5b44" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">easy_eurostat软件包</h2><p id="e7ad" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我已经根据上面的代码创建了一个包。代码得到了更好的重用，并且添加了一些易于使用的方法参数。一个例子是用于<code class="fe mu mv mw mx b">download_eurostat_data</code>方法的de <code class="fe mu mv mw mx b">transpose</code>参数。上面的代码显示，在下载过程中，表被转置，但它需要另一个转置，撤销第一个转置，以将其用于映射目的。布尔<code class="fe mu mv mw mx b">transpose</code>参数定义是否在该方法中执行转置。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="628a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有代码在我的GitHub上都有<a class="ae ky" href="https://github.com/lmeulen/EasyEuroStat" rel="noopener ugc nofollow" target="_blank"> easy_eurostat包</a>。按需随意使用。</p><p id="62b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这个包实现的这篇文章的例子:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="ac87" class="lv lw it mx b gy nc nd l ne nf">from easy_eurostat import get_eurostat_geodata, get_eurostat_dataset</span><span id="88bd" class="lv lw it mx b gy ng nd l ne nf"># Plotting the Austrian unemployment numbers over time<br/>df = get_eurostat_dataset("teilm020")<br/>d= df.loc[:, ('Seasonally adjusted data, not calendar adjusted' +\<br/>                ' data','Total', 'Total',<br/>                'Percentage of population in the labour force')]<br/>ax = d['Austria'].plot.bar()<br/>ax.set_title('Unemployment in Austria')<br/>ax.set_xlabel('Month')<br/>_ = ax.set_ylabel('Unemployment percentage')</span><span id="e8d7" class="lv lw it mx b gy ng nd l ne nf"># Making a choropleth map of unemployment numbers in Europe<br/>df = get_eurostat_dataset("teilm020", replace_codes=True,<br/>                          transpose=False, keep_codes=['geo'])<br/>df = df[(df['age'] == 'Total') &amp; (df['sex'] == 'Total')]</span><span id="1b38" class="lv lw it mx b gy ng nd l ne nf">df = pd.merge(countries, df, left_on='NUTS_ID', right_on='geo')<br/>ax = df.plot(column='2022M08', legend=True)<br/>ax.set_xlim(2000000, 7000000)<br/>ax.set_ylim(1000000, 6000000)<br/>ax.set_title('Unemployment in the European Union')</span></pre><h1 id="034c" class="nr lw it bd lx ns nt nu ma nv nw nx md jz ny ka mg kc nz kd mj kf oa kg mm ob bi translated">最后的话</h1><p id="4e09" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我希望你喜欢这篇文章。要获得更多灵感，请查看我的其他文章:</p><ul class=""><li id="0673" class="oc od it lb b lc ld lf lg li oe lm of lq og lu oh oi oj ok bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/summarize-a-text-with-python-b3b260c60e72">用Python总结一段文字</a></li><li id="c4b9" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated"><a class="ae ky" href="https://medium.com/p/5112279d743a" rel="noopener">F1分析和Python入门</a></li><li id="ca38" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/solar-panel-power-generation-analysis-7011cc078900">太阳能电池板发电分析</a></li><li id="4756" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated"><a class="ae ky" href="https://towardsdev.com/perform-a-function-on-columns-in-a-csv-file-a889ef02ca03" rel="noopener ugc nofollow" target="_blank">对CSV文件中的列执行功能</a></li><li id="f64e" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/create-a-heatmap-from-the-logs-of-your-activity-tracker-c9fc7ace1657">根据你的活动跟踪器的日志创建热图</a></li><li id="5c94" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/parallel-web-requests-in-python-4d30cc7b8989">使用Python的并行web请求</a></li></ul><p id="9d7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有的故事都可以在我的个人资料中找到。如果你喜欢这篇文章或我的任何其他文章，请点击下面的按钮！</p><p id="2b14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ni">免责声明:本文包含的观点和意见仅归作者所有。</em></p></div></div>    
</body>
</html>