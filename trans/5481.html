<html>
<head>
<title>Using an Out-of-Core Approach to Process Large Datasets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用核外方法处理大型数据集</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-speed-up-data-processing-in-pandas-a272d3485b24#2022-12-09">https://towardsdatascience.com/how-to-speed-up-data-processing-in-pandas-a272d3485b24#2022-12-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="af0e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">利用开源库加快大数据分析工作流程</h2></div><p id="a826" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你是一名处理大型数据集的数据科学家，那么在执行分析或训练机器学习模型时，你肯定已经用完了内存(OOM)。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/da047bb770eb18a629c83008f21be1ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KKvQjBZWMTFcmA4L"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">增强您的工作流程。卡拉·富勒在<a class="ae lr" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="9eb7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这并不奇怪。台式机或笔记本电脑上的可用内存很容易超过大型数据集。我们被迫一次只处理一小部分数据，这可能导致低效的数据分析。</p><p id="7564" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">更糟糕的是，对大型数据集执行数据分析可能需要很长时间，尤其是在使用复杂的算法和模型时。</p><blockquote class="ls lt lu"><p id="973d" class="kf kg lv kh b ki kj jr kk kl km ju kn lw kp kq kr lx kt ku kv ly kx ky kz la ij bi translated">声明:我不隶属于 vaex。</p></blockquote><h1 id="e888" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">Vaex:大型数据集的数据分析库。</h1><p id="180d" class="pw-post-body-paragraph kf kg iq kh b ki mr jr kk kl ms ju kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">输入 vaex。这是一个强大的开源数据分析库，用于处理大型数据集。它通过使用核外方法处理不适合内存的大型数据集来加速数据分析。这意味着它只在需要时将数据加载到内存中。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/5b1e8cd1b102e6e7ca0b1b6f866f6f6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:432/format:webp/1*PNnOd81WiU5XCXdA5x6PsA.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">Vaex:大型数据集的银弹(<a class="ae lr" href="https://vaex.io/docs/index.html#" rel="noopener ugc nofollow" target="_blank">来源</a>)</p></figure><h1 id="967d" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated"><strong class="ak">vaex 的 4 个主要特性</strong></h1><p id="4dd0" class="pw-post-body-paragraph kf kg iq kh b ki mr jr kk kl ms ju kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">vaex 有助于加速数据分析的一些关键特性包括:</p><ol class=""><li id="40e4" class="mx my iq kh b ki kj kl km ko mz ks na kw nb la nc nd ne nf bi translated"><strong class="kh ir">快速高效地处理大型数据集:</strong> vaex 使用优化的内存数据表示和并行算法。vaex 处理大量表格数据，每秒处理 10 亿行。</li><li id="512f" class="mx my iq kh b ki ng kl nh ko ni ks nj kw nk la nc nd ne nf bi translated"><strong class="kh ir">灵活的交互式数据探索</strong>:它允许您使用各种内置的可视化工具和工具交互式地探索数据，包括散点图、直方图和内核密度估计。</li><li id="7e03" class="mx my iq kh b ki ng kl nh ko ni ks nj kw nk la nc nd ne nf bi translated"><strong class="kh ir">易于使用的 API: </strong> vaex 有一个用户友好的 API。该库还与 pandas、numpy 和 matplotlib 等流行的数据科学工具集成良好。</li><li id="75d2" class="mx my iq kh b ki ng kl nh ko ni ks nj kw nk la nc nd ne nf bi translated"><strong class="kh ir">可扩展性:</strong> vaex 可以扩展到非常大的数据集，可以在单台机器上使用，也可以分布在一个机器集群上。</li></ol><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/e6bc5e1a9b00a50925a1256a77ec6ccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*bJOUKiBmAdDQ_IVJ8XQWSg.jpeg"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">以闪电般速度处理数据。通过稳定扩散成像。</p></figure><h1 id="78c4" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">vaex 入门</h1><p id="81fa" class="pw-post-body-paragraph kf kg iq kh b ki mr jr kk kl ms ju kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">要在您的数据分析项目中使用 Vaex，您可以使用 pip 简单地安装它:</p><pre class="lc ld le lf gt nm nn no bn np nq bi"><span id="6cc4" class="nr ma iq nn b be ns nt l nu nv">pip install vaex</span></pre><p id="5849" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装 Vaex 后，您可以将其导入 Python 代码并执行分析。</p><p id="dd66" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是一个简单的示例，说明如何使用 Vaex 计算数据集的平均值和标准差。</p><pre class="lc ld le lf gt nm nn no bn np nq bi"><span id="761b" class="nr ma iq nn b be ns nt l nu nv">import vaex<br/><br/># load an example dataset<br/>df = vaex.example()<br/><br/># calculate the mean and standard deviation<br/>mean = df.mean(df.x)<br/>std = df.std(df.x)<br/><br/># print the results<br/>print("mean:", mean)<br/>print("std:", std)<br/></span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nw"><img src="../Images/a00c0ecd04cfc57f08735dec51d074a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r75BaFkP33-HbaPqYxypMg.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">示例 dataframe ( <a class="ae lr" href="https://github.com/vaexio/vaex/blob/master/LICENSE.txt" rel="noopener ugc nofollow" target="_blank"> MIT license </a>)有 330，000 行。</p></figure><p id="b26c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个例子中，我们使用<code class="fe nx ny nz nn b">vaex.open()</code>函数加载一个示例数据帧(上面的截图)，然后使用<code class="fe nx ny nz nn b">mean()</code>和<code class="fe nx ny nz nn b">std()</code>方法计算数据集的均值和标准差。</p><h1 id="94e1" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">Vaex 语法类似于 pandas</h1><h2 id="df87" class="oa ma iq bd mb ob oc dn mf od oe dp mj ko of og ml ks oh oi mn kw oj ok mp ol bi translated">用 vaex 过滤</h2><p id="1fae" class="pw-post-body-paragraph kf kg iq kh b ki mr jr kk kl ms ju kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">vaex 中的很多功能都和熊猫类似。例如，要使用 vaex 过滤数据，可以使用以下方法。</p><pre class="lc ld le lf gt nm nn no bn np nq bi"><span id="64c2" class="nr ma iq nn b be ns nt l nu nv">df_negative = df[df.x &lt; 0]<br/>print(df_negative[['x','y','z','r']])</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi om"><img src="../Images/f7bec4fe3097526a41198dfe5fc2b8ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CBzynhDWmKgwZO66DteQYg.png"/></div></div></figure><h2 id="372e" class="oa ma iq bd mb ob oc dn mf od oe dp mj ko of og ml ks oh oi mn kw oj ok mp ol bi translated">使用 vaex 进行分组</h2><p id="b6cd" class="pw-post-body-paragraph kf kg iq kh b ki mr jr kk kl ms ju kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">聚合数据对于任何分析都是必不可少的。我们可以使用 vaex 来执行与熊猫相同的功能。</p><pre class="lc ld le lf gt nm nn no bn np nq bi"><span id="08e8" class="nr ma iq nn b be ns nt l nu nv"># Create a categorical column that determines if x is positive or negative<br/>df['x_sign'] = df['x'] &gt; 0<br/><br/># Create an aggregation based on x_sign to get y's mean and z's min and max.<br/>df.groupby(by='x_sign').agg({'y': 'mean',<br/>                             'z': ['min', 'max']})</span></pre><p id="ab67" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其他聚合，包括<code class="fe nx ny nz nn b">count</code>、<code class="fe nx ny nz nn b">first</code>、<code class="fe nx ny nz nn b">std</code>、<code class="fe nx ny nz nn b">var</code>、<code class="fe nx ny nz nn b">nunique</code>可用。</p><h1 id="ceec" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">使用 vaex 执行机器学习</h1><p id="d0d9" class="pw-post-body-paragraph kf kg iq kh b ki mr jr kk kl ms ju kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">也可以使用 vaex 进行机器学习。它的 API 与 scikit-learn 的结构非常相似。</p><p id="c94d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要使用它，我们需要执行 pip 安装。</p><pre class="lc ld le lf gt nm nn no bn np nq bi"><span id="2dc5" class="nr ma iq nn b be ns nt l nu nv">import vaex</span></pre><p id="ce4c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将说明如何使用 vaex 来预测泰坦尼克号的幸存者。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/3ad4cd15582f8e3a63f6b33f8d5a47fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*LLtnOo2Jdf2shNmo3Kw7Ew.jpeg"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">用泰坦尼克号幸存者问题来说明 vaex。通过稳定扩散成像。</p></figure><p id="3ccb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，需要将<a class="ae lr" href="https://www.kaggle.com/c/titanic" rel="noopener ugc nofollow" target="_blank"> titanic 数据集</a>加载到 vaex 数据帧中。我们将使用<code class="fe nx ny nz nn b">vaex.open()</code>方法，如下所示:</p><pre class="lc ld le lf gt nm nn no bn np nq bi"><span id="afbd" class="nr ma iq nn b be ns nt l nu nv">import vaex<br/><br/># Download the titanic dataframe (MIT License) from https://www.kaggle.com/c/titanic<br/># Load the titanic dataset into a vaex dataframe<br/>df = vaex.open('titanic.csv')</span></pre><p id="3a82" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦数据集被加载到 dataframe 中，我们就可以使用<code class="fe nx ny nz nn b">vaex.ml</code>来训练和评估一个预测乘客是否在泰坦尼克号灾难中幸存的机器学习模型。例如，数据科学家可以使用随机森林分类器来训练模型，如下所示。</p><pre class="lc ld le lf gt nm nn no bn np nq bi"><span id="4281" class="nr ma iq nn b be ns nt l nu nv">from vaex.ml.sklearn import Predictor<br/>from sklearn.ensemble import GradientBoostingClassifier<br/><br/># Download the titanic dataframe (MIT License) from https://www.kaggle.com/c/titanic<br/># Load the titanic dataset into a vaex dataframe<br/>titanic_df = vaex.open('titanic.csv')<br/><br/>titanic_df = titanic_df.dropna()<br/><br/># Get numeric columns of titanic_df<br/>features = ['Age','SibSp','Parch','Fare','Pclass']<br/>target = 'Survived'<br/><br/># Use GradientBoostingClassifier as an example<br/>model = GradientBoostingClassifier(random_state=42)<br/>vaex_model = Predictor(features=features, target=target, model=model, prediction_name='prediction')<br/><br/>vaex_model.fit(df=titanic_df)</span></pre><p id="4cc9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当然，其他预处理步骤和机器学习模型(包括神经网络！)都有。</p><p id="9b62" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦模型被训练，数据科学家使用<code class="fe nx ny nz nn b">transform()</code>方法执行预测，如下所示:</p><pre class="lc ld le lf gt nm nn no bn np nq bi"><span id="a9cf" class="nr ma iq nn b be ns nt l nu nv">titanic_df = vaex_model.transform(titanic_df)</span></pre><p id="1846" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们打印结果。请注意，有一个新列“预测”。</p><pre class="lc ld le lf gt nm nn no bn np nq bi"><span id="25e2" class="nr ma iq nn b be ns nt l nu nv">print(titanic_df)</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi on"><img src="../Images/dcee54afaa70f1d7589fb38bf040ee3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b95-0nE3s7ZgmEoSmNeB5A.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">预测的结果</p></figure><p id="84e9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用 vaex 解决泰坦尼克号问题绝对是大材小用，但这足以说明 vaex 可以解决机器学习问题。</p><h1 id="2037" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">使用 vaex 增强您的数据科学管道</h1><p id="53ab" class="pw-post-body-paragraph kf kg iq kh b ki mr jr kk kl ms ju kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">总的来说，vaex.ml 提供了在大型数据集上执行机器学习的强大工具。它的核外方法和优化的算法使得在不适合内存的数据集上训练和评估机器学习模型成为可能。</p><p id="0a29" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们没有介绍 vaex 可用的许多功能。为此，我强烈建议您查看<a class="ae lr" href="https://vaex.io/docs/index.html#" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="4c8c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以下是完整的代码:</p><pre class="lc ld le lf gt nm nn no bn np nq bi"><span id="6ffd" class="nr ma iq nn b be ns nt l nu nv">import vaex<br/><br/># load an example dataset<br/>df = vaex.example()<br/>print(df)<br/><br/># calculate the mean and standard deviation<br/>mean = df.mean(df.x)<br/>std = df.std(df.x)<br/><br/># print the results<br/>print("mean:", mean)<br/>print("std:", std)<br/><br/>df_negative = df[df.x &lt; 0]<br/>print(df_negative)<br/><br/># Create a categorical column that determines if x is positive or negative<br/>df['x_sign'] = df['x'] &gt; 0<br/><br/># Create an aggregation based on x_sign to get y's mean and z's min and max.<br/>df.groupby(by='x_sign').agg({'y': 'mean',<br/>                             'z': ['min', 'max']})<br/><br/>from vaex.ml.sklearn import Predictor<br/>from sklearn.ensemble import GradientBoostingClassifier<br/><br/># Download the titanic dataframe (MIT License) from https://www.kaggle.com/c/titanic<br/># Load the titanic dataset into a vaex dataframe<br/>titanic_df = vaex.open('titanic.csv')<br/><br/>titanic_df = titanic_df.dropna()<br/><br/># Get numeric columns of titanic_df<br/>features = ['Age','SibSp','Parch','Fare','Pclass']<br/>target = 'Survived'<br/><br/>model = GradientBoostingClassifier(random_state=42)<br/>vaex_model = Predictor(features=features, target=target, model=model, prediction_name='prediction')<br/><br/>vaex_model.fit(df=titanic_df)<br/><br/>titanic_df = vaex_model.transform(titanic_df)Follow me for more content.</span></pre><p id="aa65" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我是一名在技术部工作的数据科学家。我定期在 Medium 和 LinkedIn 上分享这样的数据科学技巧。关注我，了解更多未来内容。</p></div></div>    
</body>
</html>