<html>
<head>
<title>Performing Data Analytics on the Flights Delay dataset using the Polars Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Polars库对航班延误数据集进行数据分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/performing-data-analytics-on-the-flights-delay-dataset-using-the-polars-library-284f385cc497#2022-10-28">https://towardsdatascience.com/performing-data-analytics-on-the-flights-delay-dataset-using-the-polars-library-284f385cc497#2022-10-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9b8a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用Polars对2015年航班延误数据集进行各种数据分析</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f280944aa6b5a0f89347eaca5ae6a9c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YyUxUusJvFvE3G0m"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@chuttersnap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> CHUTTERSNAP </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="7244" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2015航班延误数据集是数据分析学习者使用的经典数据集。该报告由美国交通部运输统计局发布。该数据集跟踪美国大型航空公司运营的国内航班的准点表现，并包含关于准点、延误、取消和改道航班数量的汇总信息。</p><p id="f98b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将利用这个数据集来展示如何使用Polars dataframe库执行数据分析。</p><h1 id="7fb0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">下载数据集</h1><p id="5328" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">你可以从<a class="ae ky" href="https://www.kaggle.com/datasets/usdot/flight-delays" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/datasets/usdot/flight-delays</a>下载数据集。</p><div class="ms mt gp gr mu mv"><a href="https://www.kaggle.com/datasets/usdot/flight-delays" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">2015年航班延误和取消</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">你应该乘坐哪家航空公司的航班来避免重大延误？</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">www.kaggle.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj ks mv"/></div></div></a></div><blockquote class="nk nl nm"><p id="015d" class="kz la nn lb b lc ld ju le lf lg jx lh no lj lk ll np ln lo lp nq lr ls lt lu im bi translated">许可:<a class="ae ky" href="https://creativecommons.org/publicdomain/zero/1.0/" rel="noopener ugc nofollow" target="_blank"> CC0:公共领域</a></p></blockquote><p id="2540" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据集包含三个CSV文件:</p><ul class=""><li id="94bf" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated"><strong class="lb iu"> airlines.csv </strong></li><li id="ce41" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><strong class="lb iu"> airports.csv </strong></li><li id="d226" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><strong class="lb iu"> flights.csv </strong></li></ul><p id="5559" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个CSV文件中的列如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/5976c0e84f1a256a5b2f75efcd796d77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*fMRJUSazsJBsnNsW5UHl3w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="1fdd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">具体来说，<strong class="lb iu"> flights.csv </strong>文件包含超过580万行。这使得它成为展示Polars库效率的理想数据集。</p><h1 id="4313" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">加载数据集</h1><p id="9fed" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">首先，使用<code class="fe og oh oi oj b">scan_csv()</code>方法加载<strong class="lb iu"> flights.csv </strong>文件，该方法从csv文件中缓慢读取:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="29de" class="oo lw it oj b gy op oq l or os">import polars as pl</span><span id="76fb" class="oo lw it oj b gy ot oq l or os">q = (<br/>    pl.scan_csv('flights.csv')<br/>)<br/>q.collect()</span></pre><p id="1b4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据集的快照如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/21e9d9b177ce56e05a6d9e854505610f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*86Gp8u8MEyMOunQqDEvjsA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="9afb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">加载的数据帧包含超过580万行和31列。</p><h1 id="604d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">查找所有被取消的航班</h1><p id="bcdf" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">接下来，让我们找出所有被取消的航班。您可以通过检查<strong class="lb iu">取消的</strong>栏来完成。在<strong class="lb iu">取消的</strong>栏中只有两个可能的值:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="89ff" class="oo lw it oj b gy op oq l or os">q = (<br/>    pl.scan_csv('flights.csv')<br/><strong class="oj iu">    .select(pl.col('CANCELLED').unique())</strong><br/>)<br/>q.collect()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/4c42c0c4b6f62211d9f550cc8b055c4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:192/format:webp/1*spF9Mo1SrK0uOE8xH9xzfg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="2684" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">取消的航班用值<strong class="lb iu"> 1 </strong>表示。因此，您可以使用<code class="fe og oh oi oj b">filter()</code>方法来获取所有值为1的行，用于<strong class="lb iu">取消的</strong>列:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="0fdd" class="oo lw it oj b gy op oq l or os">q = (<br/>    pl.scan_csv('flights.csv')<br/><strong class="oj iu">    .filter((pl.col('CANCELLED') &gt; 0))</strong><br/>)<br/>q.collect()</span></pre><p id="efc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果的快照如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/0ee7348482ac2d12ef5e46f81b95e59a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*BDbYekghuCIjtosw__r9hw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="b4fb" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">查找每个航空公司取消的航班总数</h1><p id="9a9c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">看看哪个航空公司取消的航班最多会很有意思。您可以这样做，首先使用<code class="fe og oh oi oj b">groupby()</code>方法按航空公司对行进行分组，然后使用<code class="fe og oh oi oj b">agg()</code>方法对所有被取消的航班进行汇总:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="efcd" class="oo lw it oj b gy op oq l or os">q = (<br/>    pl.scan_csv('flights.csv')<br/><strong class="oj iu">    .groupby('AIRLINE')<br/>    .agg(pl.col('CANCELLED').sum())</strong><br/>)<br/>q.collect()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/fea984216df9b248fa9694d06b10ad53.png" data-original-src="https://miro.medium.com/v2/resize:fit:320/format:webp/1*tKRmgN0_KWDyvhE9BN4Jpg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="47d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么取消航班最多的航空公司是哪家呢？分类吧！</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="f861" class="oo lw it oj b gy op oq l or os">q = (<br/>    pl.scan_csv('flights.csv')<br/>    .groupby('AIRLINE')<br/>    .agg(pl.col('CANCELLED').sum())<br/> <strong class="oj iu">   .sort(by='CANCELLED',reverse=True)</strong><br/>)<br/>q.collect()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/9ae8321defef1da725ef4adde7a5e72b.png" data-original-src="https://miro.medium.com/v2/resize:fit:324/format:webp/1*bwO5Giw2nmhphAi9x1DcDQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4b9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个航空公司代码代表什么？让我们加载另一个包含航空公司代码和名称的CSV文件:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="c48e" class="oo lw it oj b gy op oq l or os">pl.read_csv('airlines.csv')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/a4948294e74e648cc8bcfdfae30de668.png" data-original-src="https://miro.medium.com/v2/resize:fit:414/format:webp/1*gUmtVek0HZQClGu9CP_O2A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="ef20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用上面的数据框架来加入我们先前的结果:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="ebda" class="oo lw it oj b gy op oq l or os">q = (<br/>    pl.scan_csv('flights.csv')<br/>    .groupby('AIRLINE')<br/>    .agg(pl.col('CANCELLED').sum())<br/>    .sort(by='CANCELLED',reverse=True)<br/>)</span><span id="6c62" class="oo lw it oj b gy ot oq l or os"><strong class="oj iu">q = (<br/>    pl.scan_csv('airlines.csv')<br/>    .join(q, 'IATA_CODE', 'AIRLINE')<br/>)</strong></span><span id="1a22" class="oo lw it oj b gy ot oq l or os">q.collect()</span></pre><p id="07b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你现在知道哪个航空公司取消的航班最多了。😀</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/0a3848259f06d6c38db6aeee683bc230.png" data-original-src="https://miro.medium.com/v2/resize:fit:582/format:webp/1*QxWdjfFosx8MHLxWQqkMwA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="9ad2" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">将年、月和日列合并成一列</h1><p id="c52b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在<strong class="lb iu"> flights.csv </strong>文件中，每个航班的日期使用三个不同的列来表示，即<strong class="lb iu">年</strong>、<strong class="lb iu">月</strong>和<strong class="lb iu">日</strong>。对于执行数据分析，如果可以将三列合并成一个日期列，可能会更容易。为此，您可以使用<code class="fe og oh oi oj b">pl.date()</code>函数，然后使用<code class="fe og oh oi oj b">alias()</code>函数来重命名新创建的列:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="7269" class="oo lw it oj b gy op oq l or os">q = (<br/>    pl.scan_csv('flights.csv')<br/><strong class="oj iu">    .with_columns(<br/>        pl.date('YEAR','MONTH','DAY')<br/>        .alias("SCHEDULED_DEPARTURE_DATE")<br/>    )<br/></strong>)<br/>q.collect()</span></pre><p id="4c6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果现在包含一个新添加的名为<strong class="lb iu">SCHEDULED _ department _ DATE</strong>的列:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/0148562ef3acd09ebb05463ec6ba3867.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*jyQBVQmjWkUcSiC9G4CDjw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b0dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe og oh oi oj b">with_columns()</code>函数添加或覆盖数据帧中的列。</p><h1 id="b9d5" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">组合日期和时间列</h1><p id="fb92" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">除了计划出发日期存储在三个单独的列中，您还会注意到有一个名为<strong class="lb iu">SCHEDULED _ department</strong>的列。此列是一个整数列，存储数字，如5，10，直到2359。这些值代表的实际上是HHMM格式的出发时间。所以5实际上代表00:05，而2359实际上代表23:59。如果您要对这个列执行分析，您肯定需要进一步处理这个列。</p><p id="bcb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我要做的是将四列合并成一个<code class="fe og oh oi oj b">datetime</code>列:</p><ul class=""><li id="9e5e" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated"><strong class="lb iu">年份</strong></li><li id="0a75" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><strong class="lb iu">月</strong></li><li id="0aac" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><strong class="lb iu">日</strong></li><li id="1f11" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><strong class="lb iu">预定_出发</strong></li></ul><p id="53f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们在上一节中所看到的，将前三者结合起来是很容易的。第四列需要一些处理:</p><ul class=""><li id="fb38" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">您需要将出发时间格式化为一个字符串，然后提取前两个数字来表示小时(HH)</li><li id="88ad" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">然后提取代表分钟(MM)的最后两位数字</li></ul><p id="5951" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述操作可以写成如下形式:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="3035" class="oo lw it oj b gy op oq l or os">q = (<br/>    pl.scan_csv('flights.csv')<br/><strong class="oj iu">    .with_columns(<br/>        pl.col('SCHEDULED_DEPARTURE').apply(<br/>          lambda x: ("{0:04d}".format(int(x)))[:2])<br/>        .alias('HH')<br/>    )<br/>    .with_columns(<br/>      pl.col('SCHEDULED_DEPARTURE').apply(<br/>          lambda x: ("{0:04d}".format(int(x)))[2:])<br/>        .alias('MM')<br/>    )   <br/>    .with_columns(<br/>        pl.datetime('YEAR','MONTH','DAY','HH','MM')<br/>        .alias("SCHEDULED_DEPARTURE_DATETIME")<br/>    )    <br/></strong>)<br/>q.collect()</span></pre><p id="f4d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终结果包含一个新添加的名为<strong class="lb iu">SCHEDULED _ department _ DATETIME</strong>的列:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/2e1a5815114807b5c8720f9196067e14.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*kwBBSnHwmTAgkW7BIvwMjQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="2d2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，结果还包含两个中间列<strong class="lb iu"> HH </strong>和<strong class="lb iu"> MM </strong>。最好使用<code class="fe og oh oi oj b">drop()</code>功能将它们放下:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="033e" class="oo lw it oj b gy op oq l or os">q = (<br/>    pl.scan_csv('flights.csv')<br/>    .with_columns(<br/>        pl.col('SCHEDULED_DEPARTURE').apply(<br/>          lambda x: ("{0:04d}".format(int(x)))[:2])<br/>        .alias('HH')<br/>    )<br/>    .with_columns(<br/>        pl.col('SCHEDULED_DEPARTURE').apply(<br/>          lambda x: ("{0:04d}".format(int(x)))[2:])<br/>        .alias('MM')<br/>    )   <br/>    .with_columns(<br/>        pl.datetime('YEAR','MONTH','DAY','HH','MM')<br/>        .alias("SCHEDULED_DEPARTURE_DATETIME")<br/>    )  <br/><strong class="oj iu">    .drop(['HH','MM'])</strong><br/>)<br/>q.collect()</span></pre><p id="4351" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果中不再有<strong class="lb iu"> HH </strong>和<strong class="lb iu"> MM </strong>列:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/c3cf753434952f4e8a573d413098fc28.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/format:webp/1*aJ35ueNw7Ui-XpIawa2JVA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="e309" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">显示目的地机场名称、城市和州</strong></h1><p id="f76d" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">假设您想要查找从<strong class="lb iu"> CVG </strong>出发的所有航班，并显示目的地的机场名称、城市和州。为此，您需要在两个数据帧之间执行一个连接— <strong class="lb iu"> airports.csv </strong>和<strong class="lb iu"> flights.csv </strong>。您可以使用以下代码片段完成上述任务:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="5b0c" class="oo lw it oj b gy op oq l or os">df_airports = pl.scan_csv('airports.csv') <br/>(<br/>    pl.scan_csv('flights.csv')<br/>    .filter(<br/>        pl.col('ORIGIN_AIRPORT') == 'CVG'    <br/>    )        <br/>    .join(df_airports, <br/>          left_on='DESTINATION_AIRPORT',<br/>          right_on='IATA_CODE',<br/>          how='left')<br/>    .select(pl.col(['FLIGHT_NUMBER', 'ORIGIN_AIRPORT', <br/>                    'DESTINATION_AIRPORT', 'AIRPORT', <br/>                    'CITY', 'STATE']))<br/>).collect()</span></pre><ul class=""><li id="7fe1" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">首先将<strong class="lb iu"> airports.csv </strong>文件加载到dataframe中，然后是<strong class="lb iu"> flights.csv </strong>文件。</li><li id="9caa" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">使用包含航班详细信息的数据框架，对从CVG始发的航班执行过滤。</li><li id="ce88" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">然后，使用机场数据框在所有来自CVG的航班上执行左连接</li><li id="6770" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">最后，您只希望结果包含六列— <strong class="lb iu">航班号</strong>、<strong class="lb iu">出发地机场</strong>、<strong class="lb iu">目的地机场</strong>、<strong class="lb iu">机场</strong>、<strong class="lb iu">城市</strong>和<strong class="lb iu">州</strong></li></ul><p id="3135" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/3334297faadd361292b202d23b9ca84b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*N-2nHeSTkQHUF7zuYBKmAg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="b2a6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">统计每个州的机场数量</h1><p id="7ed7" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">由于<strong class="lb iu"> airports.csv </strong>文件包含每个州的机场列表，我们可以统计每个州的机场总数:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="49ca" class="oo lw it oj b gy op oq l or os">(<br/>    pl.scan_csv('airports.csv')<br/>    .groupby('STATE')<br/>    .agg(<br/>        pl.col('AIRPORT').count()<br/>    )<br/>).collect()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/5363f590ceb48df8f908342351431a0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:260/format:webp/1*-W7F-2JCBGDmluQvjBZQKA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="abef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想查看每个州的机场名称列表，请移除<code class="fe og oh oi oj b">count()</code>功能:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="90bb" class="oo lw it oj b gy op oq l or os">(<br/>    pl.scan_csv(‘airports.csv’)<br/>    .groupby(‘STATE’)<br/>    .agg(<br/>        pl.col(‘AIRPORT’)<br/>    )<br/>).collect()</span></pre><p id="64ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将看到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/42941ed45cb5b8ed1bf5bfffde901af1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RmB_K3CyHNJBjeDqfECKow.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="c37c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">找到每个航空公司的最大和最小延迟</h1><p id="3a46" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><strong class="lb iu"> flights.csv </strong>文件中的<strong class="lb iu"> ARRIVAL_DELAY </strong>列表示每个航班的延迟时间(分钟)。<strong class="lb iu"> ARRIVAL_DELAY </strong>的正值表示航班晚点，负值表示航班提前到达。查看每个航空公司的最大和最小延误时间会很有趣:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="9885" class="oo lw it oj b gy op oq l or os">(<br/>    pl.scan_csv('flights.csv')<br/>    .groupby('AIRLINE')<br/>    .agg(<br/>        [<br/>            pl.col('ARRIVAL_DELAY').max().alias('MAX_DELAY'),<br/>            pl.col('ARRIVAL_DELAY').min().alias('MIN_DELAY')<br/>        ]<br/>    )<br/>).collect()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/59e813f306ebc13e13d0d09eb574490f.png" data-original-src="https://miro.medium.com/v2/resize:fit:486/format:webp/1*ynJ80rkwQT6SBpDFfZ99mg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="d1d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从结果中可以看到<strong class="lb iu"> AA </strong>(美国航空公司)的最大延迟为1971分钟，而<strong class="lb iu"> US </strong>(美国航空公司)和<strong class="lb iu"> AA </strong>的最小延迟为-87分钟。</p><p id="7baa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，显示最大和最小延迟并不能反映全部情况。我们可以计算到达延迟的平均值和标准偏差:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="9d76" class="oo lw it oj b gy op oq l or os">(<br/>    pl.scan_csv('flights.csv')<br/>    .groupby('AIRLINE')<br/>    .agg(<br/>        [<br/>            pl.col('ARRIVAL_DELAY').max().alias('MAX_DELAY'),<br/>            pl.col('ARRIVAL_DELAY').min().alias('MIN_DELAY'),<br/><strong class="oj iu">            pl.col('ARRIVAL_DELAY').mean().alias('AVG_DELAY'),<br/>            pl.col('ARRIVAL_DELAY').std().alias('STD_DELAY'),<br/></strong>        ]<br/>    )<br/>).collect()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/6f93b8136b81da6ffc1d59fa403b94a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*xZcQnfW8rSNkOxm4QBIlkA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="d90e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，您将看到<strong class="lb iu">与</strong>(阿拉斯加航空公司)的平均到达延迟最低(-0.976563)。</p><p id="b258" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个更好的主意是绘制直方图来显示每家航空公司的延误情况:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="ee43" class="oo lw it oj b gy op oq l or os">import plotly.express as px</span><span id="94ff" class="oo lw it oj b gy ot oq l or os">def histogram(airline):    <br/>    df = (<br/>        pl.scan_csv('flights.csv')<br/>        .filter(<br/>            pl.col('AIRLINE') == airline<br/>        )<br/>    ).collect()<br/>    <br/>    # plot a histogram showing the arrival delay for the specific <br/>    # airline<br/>    fig = px.histogram(df.to_pandas(),<br/>                       x = 'ARRIVAL_DELAY',<br/>                       title=f'Flight delays for {airline}')<br/>    fig.show()</span><span id="4b8e" class="oo lw it oj b gy ot oq l or os">airlines = (<br/>    pl.scan_csv('airlines.csv')<br/>).collect()</span><span id="1254" class="oo lw it oj b gy ot oq l or os">for airline in airlines['IATA_CODE'].to_list():<br/>    histogram(airline)</span></pre><p id="1d7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图显示了<strong class="lb iu"> UA </strong>(联合航空公司)的延迟频率:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/931bc5945687f9c63decfb9ec0f510bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aAvPct-XvDkD3F2K5Im_mA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="15c5" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">查找每个航空公司的航班号</h1><p id="cded" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">您可以使用<code class="fe og oh oi oj b">unique()</code>功能列出每个航空公司的唯一航班号:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="f1ff" class="oo lw it oj b gy op oq l or os">(<br/>    pl.scan_csv('flights.csv')<br/>    .groupby('AIRLINE')<br/>    .agg(pl.col('FLIGHT_NUMBER').unique())    <br/>).collect()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/b2f44c205a3fdff8e1fba5bd841d2cd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:390/format:webp/1*_LCqBBbHmTxWUuj2PsP8_g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3c33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以使用<code class="fe og oh oi oj b">n_unique()</code>功能查找每家航空公司的独特航班数量:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="340b" class="oo lw it oj b gy op oq l or os">(<br/>    pl.scan_csv('flights.csv')<br/>    .groupby('AIRLINE')<br/><strong class="oj iu">    .agg(pl.col('FLIGHT_NUMBER').n_unique())    </strong><br/>    # this also works<br/>    # .agg(pl.col('FLIGHT_NUMBER').unique().count())<br/>).collect()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/902ed549872ad0a578caf53da075d962.png" data-original-src="https://miro.medium.com/v2/resize:fit:378/format:webp/1*5XZSpyUO9u7n6zyAIEd6YQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><blockquote class="nk nl nm"><p id="1afa" class="kz la nn lb b lc ld ju le lf lg jx lh no lj lk ll np ln lo lp nq lr ls lt lu im bi translated">注意，您也可以在<code class="fe og oh oi oj b">unique()</code>功能后使用<code class="fe og oh oi oj b">count()</code>功能。</p></blockquote><div class="ms mt gp gr mu mv"><a href="https://weimenglee.medium.com/membership" rel="noopener follow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">加入媒介与我的介绍链接-李伟孟</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">阅读李维孟(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">weimenglee.medium.com</p></div></div><div class="ne l"><div class="pm l ng nh ni ne nj ks mv"/></div></div></a></div><h1 id="5ab1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">摘要</h1><p id="5519" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在本文中，我们快速浏览了一些可以在航班延误数据集上执行的数据分析。就我个人而言，在我的电脑上使用这个数据集通常会导致很多问题，因为数据集很大，并且通常需要很多时间，尤其是当你连接列或数据帧时。但是有了Polars，事情变得更加高效，代码也更加直观。让我知道你的航班延误数据集的经验！</p></div></div>    
</body>
</html>