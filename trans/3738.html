<html>
<head>
<title>Use itertools.groupby() to Count Consecutive Occurrences in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用itertools.groupby()计算Python中连续出现的次数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/use-itertools-groupby-to-count-consecutive-occurrences-in-python-7bb83248b83e#2022-08-19">https://towardsdatascience.com/use-itertools-groupby-to-count-consecutive-occurrences-in-python-7bb83248b83e#2022-08-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f6b5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">比如最长的热浪持续了几天？</h2></div></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/99e9c40ac1efac3efbc08bc9df815063.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*r0iFtGGDMZn-t5tI"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">在<a class="ae lf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae lf" href="https://unsplash.com/@ridham?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Ridham Nagralawala </a>拍摄的照片</p></figure></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><h1 id="b03a" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">语境决定一切。这为什么有用？</h1><p id="d2f2" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">作为一名分析师，您可能希望探究诸如连续性等细微差别，以了解根本原因或移除数据中的异常值。</p><p id="6b71" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">激发这篇文章的主题是天气。2022年，俄勒冈州波特兰的气温与前一年世界其他地区甚至波特兰的许多创纪录热浪相比是温和的。</p><p id="dcfa" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">然而，尽管与2021年创纪录的高温相比，2022年可能是温和的，但这一年似乎很热。也许连续几天的炎热天气影响了我的感知？让我们用Python来统计热天条纹(也称为热浪)来分析这个假设。</p><h1 id="4dbb" class="lg lh it bd li lj mz ll lm ln na lp lq jz nb ka ls kc nc kd lu kf nd kg lw lx bi translated">美国的天气数据</h1><p id="b338" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在之前的一篇文章中，我写了关于来自国家环境信息中心(NCEI)的<a class="ae lf" href="https://www.noaa.gov/big-data-project-frequently-asked-questions" rel="noopener ugc nofollow" target="_blank">公开可用数据</a>来源。请阅读该文章，了解有关如何访问数据的更多详细信息，并访问<a class="ae lf" href="https://www.ncei.noaa.gov/about" rel="noopener ugc nofollow" target="_blank"> NCEI </a>了解更多有关NCEI和国家环境卫星、数据和信息服务(NESDIS)任务的信息。</p><div class="ne nf gp gr ng nh"><a rel="noopener follow" target="_blank" href="/democratizing-historical-weather-data-with-r-cc3c76dde7c5"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd iu gy z fp nm fr fs nn fu fw is bi translated">用R民主化历史天气数据</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">园丁指南，有人搬到不同的气候，或任何其他原因，人们可能有兴趣分析…</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">towardsdatascience.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv kz nh"/></div></div></a></div><p id="386b" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在这篇文章中，重点将是TMAX，在特定气象站观测到的最高日温度。俄勒冈州波特兰市的数据和我的探索性数据分析可在<a class="ae lf" href="https://github.com/wpbSabi/weather/blob/main/consecutive%20days%20of%20heat.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p><p id="bdd3" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">以下数据框是为此分析而创建的，包含真/假布尔型字段，用于指示温度是至少80度、至少90度还是至少100华氏度。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/678c6c9f6be71ed7ad99800a88b23808.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/format:webp/1*ZoGBqKKRL7tCuqxZ9NWqgg.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">一个数据框，包含按日期和年份划分的温度阈值的真/假布尔字段(图片由作者提供)</p></figure><h1 id="46ba" class="lg lh it bd li lj mz ll lm ln na lp lq jz nb ka ls kc nc kd lu kf nd kg lw lx bi translated">连续几天气温都在华氏90度以上</h1><p id="c952" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated"><strong class="ma iu">计算连续发生的次数并不像你想象的那么简单。</strong>需要进行多次计算才能得出解决方案，开发一种能够处理多年数据的算法并不容易。</p><p id="5523" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">然而，有一些软件包可以减少为这个算法编写的函数的数量。Python的<code class="fe nx ny nz oa b">itertools.groupby()</code>包是我实现这一分析的最简单的方法。</p><p id="36f0" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">首先，从<code class="fe nx ny nz oa b">itertools</code>包中导入<code class="fe nx ny nz oa b">groupby()</code>函数。</p><pre class="kq kr ks kt gt ob oa oc od aw oe bi"><span id="42ef" class="of lh it oa b gy og oh l oi oj"><strong class="oa iu">from</strong> itertools <strong class="oa iu">import</strong> groupby</span></pre><p id="8b89" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">接下来，定义一个函数，该函数将一年的数据点列表作为参数，然后返回一个列表。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="54cb" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">这个返回列表中的每个元素都包含了那一年每一次热浪的持续时间。例如，如果我们为热设定的阈值是90华氏度，那么对于给定的年份，具有四个元素如[1，5，1，2]的列表将意味着该年有四次热浪。第一波有一天最高温度达到或超过90度。第二波包括连续5天超过90度。诸如此类。</p><ul class=""><li id="d707" class="om on it ma b mb mu me mv mh oo ml op mp oq mt or os ot ou bi translated">第一波有一天最高温度达到或超过90度。第二波包括连续5天超过90度。诸如此类。</li></ul><p id="d1dd" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">然后，编写另一个函数来执行以下操作:</p><ol class=""><li id="d581" class="om on it ma b mb mu me mv mh oo ml op mp oq mt ov os ot ou bi translated">使用上面定义的函数确定每年最长的热浪</li><li id="dbd7" class="om on it ma b mb ow me ox mh oy ml oz mp pa mt ov os ot ou bi translated">在数据框中循环遍历每一年</li><li id="d227" class="om on it ma b mb ow me ox mh oy ml oz mp pa mt ov os ot ou bi translated">返回每年最长90度热浪的数据框(以天为单位)</li></ol><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="a36b" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">为了获得比较，为80度和100度编写了类似的函数。</p><h1 id="0120" class="lg lh it bd li lj mz ll lm ln na lp lq jz nb ka ls kc nc kd lu kf nd kg lw lx bi translated">结果分析</h1><p id="6ef7" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在回顾每年最长的热浪之前，我们先来考察一下每年的总体高温天数。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi pb"><img src="../Images/62f973e59df35e0df88cd5ae19235b6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NPnv9QwVX3M1dljKpZSxmA.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">截至2022年的年度趋势，这是该视图中的最后一年，位于俄勒冈州波特兰市(图片由作者提供)</p></figure><p id="9e93" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">确实2021年<em class="pc">是</em>热！80度或以上的天气有90天，是有记录以来最多的。100度和90度的天气也是今年有记录以来最热的一年。</p><p id="2682" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><em class="pc">在这篇文章的原始版本写于夏末之后，波特兰实际上在10月有破纪录的12个80度的天。否则，2021年大约会有20多个80度的日子。</em></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/b21774497bb4722795b039cec21b1627.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/1*AYv2ADIcOFH-Aoc4yXhMkg.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">过去5年中超过热阈值的总天数(图片由作者提供)</p></figure><p id="4883" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">下一张图表显示了2022年最长的热浪。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi pb"><img src="../Images/da280461fe862e2ee7cd63bc75c6c050.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GYtQ8lbUSLB9f5EyRNz8Jw.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">2022年前最长的热浪(图片由作者提供)</p></figure><p id="b8c0" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">对于80度以上</p><ul class=""><li id="5cd7" class="om on it ma b mb mu me mv mh oo ml op mp oq mt or os ot ou bi translated">有记录以来最长的热浪(21天)发生在1985年。</li><li id="9f41" class="om on it ma b mb ow me ox mh oy ml oz mp pa mt or os ot ou bi translated">2022以10天排名第27</li><li id="baf9" class="om on it ma b mb ow me ox mh oy ml oz mp pa mt or os ot ou bi translated">2021以13天排在第11位</li></ul><p id="41a5" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">对于90度以上</p><ul class=""><li id="d6d2" class="om on it ma b mb mu me mv mh oo ml op mp oq mt or os ot ou bi translated">有记录以来最长的热浪(8天)发生在2009年</li><li id="cf78" class="om on it ma b mb ow me ox mh oy ml oz mp pa mt or os ot ou bi translated">2022以7天排名第二</li><li id="2aad" class="om on it ma b mb ow me ox mh oy ml oz mp pa mt or os ot ou bi translated">2021以6天排第5</li></ul><p id="82fb" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">对于100度以上</p><ul class=""><li id="f87b" class="om on it ma b mb mu me mv mh oo ml op mp oq mt or os ot ou bi translated">有记录以来最长的热浪(4天)发生在1941年和1981年</li><li id="bd48" class="om on it ma b mb ow me ox mh oy ml oz mp pa mt or os ot ou bi translated">2022以2天排名第7</li><li id="3355" class="om on it ma b mb ow me ox mh oy ml oz mp pa mt or os ot ou bi translated">2021以3天排名第四</li></ul><h1 id="1b17" class="lg lh it bd li lj mz ll lm ln na lp lq jz nb ka ls kc nc kd lu kf nd kg lw lx bi translated">结论:我的假设是错误的</h1><p id="e773" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">虽然这一分析没有包括统计意义上的实验设计，但两年热浪的总结已经表明，最近的记忆正在偏见我对2022年炎热夏天的看法。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/7ae4a7cf57a19809d5aca31e83ed13e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:356/format:webp/1*zF70W6Z38MeL2fUdpoloOg.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">2022年到2021年最长的热浪(图片由作者提供)</p></figure><p id="9306" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我发现了几个有趣的趋势:</p><ul class=""><li id="a5a3" class="om on it ma b mb mu me mv mh oo ml op mp oq mt or os ot ou bi translated">与其他最热的年份相比，2021年有更多的冷却期。这就是为什么总的高温日数没有导致有记录以来最长的热浪。</li><li id="ff0c" class="om on it ma b mb ow me ox mh oy ml oz mp pa mt or os ot ou bi translated">连续的高温天气似乎是周期性的。最后一年(2022年)处于周期的低端。</li><li id="3f2c" class="om on it ma b mb ow me ox mh oy ml oz mp pa mt or os ot ou bi translated">每年高温天气的天数有增加的趋势，但热浪的趋势不太明显。</li></ul></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><p id="2759" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><em class="pc">最后更新2022-12月:添加了文章图片，更新了9月和10月数据的图表，并为可读性做了一些小编辑。</em></p><p id="f75f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果你喜欢这篇文章，并想阅读(和写)更多这样的文章，请考虑点击我的个人资料图片旁边的<em class="pc">关注</em>按钮和/或使用我的推荐链接<a class="ae lf" href="https://sabolch-horvat.medium.com/membership" rel="noopener">https://sabolch-horvat.medium.com/membership</a>订阅中等会员</p></div></div>    
</body>
</html>