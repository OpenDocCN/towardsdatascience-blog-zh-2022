<html>
<head>
<title>Python Decorator: What, Why, and How</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python Decorator:什么，为什么，以及如何</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-decorator-what-why-and-how-f6b2d86e858e#2022-10-26">https://towardsdatascience.com/python-decorator-what-why-and-how-f6b2d86e858e#2022-10-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/e1a8f7ccf35a9f8cf9b657d7cd5319a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y2-DYY8YNhth-_-bcOvjhA.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">朱莉安娜·马尔他在<a class="ae jg" href="https://unsplash.com/s/photos/gift-wrapping?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><div class=""/><p id="bfc5" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Python decorator是帮助我们高效编码的非常有用的工具。正如我在上一篇文章中提到的，高效编码是我成为更好的数据科学家所遵循的原则之一:</p><div class="is it gp gr iu le"><a rel="noopener follow" target="_blank" href="/seven-principals-i-follow-to-be-a-better-data-scientist-25a547d6acfc"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd jk gy z fp lj fr fs lk fu fw ji bi translated">成为更好的数据科学家我遵循的七条原则</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">树立我的北极星</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">towardsdatascience.com</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls ja le"/></div></div></a></div><p id="ed79" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我想揭示Python decorators的用例，并讨论它们如何对您的日常编程任务有所帮助。</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h2 id="63ba" class="ma mb jj bd mc md me dn mf mg mh dp mi kr mj mk ml kv mm mn mo kz mp mq mr ms bi translated"><strong class="ak">什么是Python装饰师</strong></h2><p id="d0d6" class="pw-post-body-paragraph kg kh jj ki b kj mt kl km kn mu kp kq kr mv kt ku kv mw kx ky kz mx lb lc ld im bi translated">Python decorator的名字听起来可能很花哨，但本质上，它只不过是一个工具，您可以使用它来定制现有函数的输出，而无需修改函数本身。之所以称之为“<strong class="ki jk"> <em class="my">【装饰者】</em> </strong>是因为你可以把同样的概念应用到，就好像你在包装礼物一样。我们可以在不同的节日用不同的包装纸装饰礼物。即使礼物本身是一样的，我们也可以通过不同的装饰，在不同的场合送出。将这个比喻应用于python编程语言，礼物是python函数，包装器是python装饰器，而您的任务是不同的假日。在本文中，我将讨论python decorators的两个主要用例:一个是修改函数，另一个是缓存函数输出以保存未来的运行时。我们将在下一节看到这两个用例的例子。</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h2 id="71a7" class="ma mb jj bd mc md me dn mf mg mh dp mi kr mj mk ml kv mm mn mo kz mp mq mr ms bi translated">为什么以及如何使用Python Decorator</h2><p id="948d" class="pw-post-body-paragraph kg kh jj ki b kj mt kl km kn mu kp kq kr mv kt ku kv mw kx ky kz mx lb lc ld im bi translated"><strong class="ki jk"> 1 -修改功能输出而不修改功能本身</strong></p><p id="2c98" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在讨论如何用Python decorator修改函数之前，让我们从一个简单的函数开始:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="7c37" class="ma mb jj ne b gy ni nj l nk nl">def add_five(x):<br/>    return x+5</span></pre><p id="da74" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个函数只是将输入x加5，为了简单起见，我们假设x是数字。</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nm"><img src="../Images/991349e4da8f716489543f5fc11665bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DXB6V3VFw3nHChhF1DU8mQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者代码</p></figure><p id="4040" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以看到，当你调用这个函数时，它产生一个输出，在输入的基础上加5。这是一个非常简单的函数，操作简单明了。现在，如果我们想使用这个函数，但是对输出应用一个条件，说输出不能大于10，那该怎么办呢？我们可以在<strong class="ki jk"> add_five() </strong>函数的基础上添加以下函数:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="f20d" class="ma mb jj ne b gy ni nj l nk nl">def ensure_ceiling(func):<br/>    ceiling = 10<br/>    def wrapper(x):<br/>        value = func(x)<br/>        return value if value &lt; ceiling else x<br/>    return wrapper</span></pre><p id="3533" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki jk">assure _ ceiling()</strong>函数接受一个函数作为输入。它首先将上限定义为10。然后定义一个<strong class="ki jk">包装器</strong>函数，它接受输入函数的输入x并产生一个输出值。然后<strong class="ki jk">包装器</strong>函数的输出将使用上限条件进行修改。最后，<strong class="ki jk">确保上限</strong>函数返回<strong class="ki jk">包装器</strong>函数作为输出。然后我们可以修改<strong class="ki jk"> add_five </strong>函数，将其作为<strong class="ki jk">确保_上限</strong>函数的输入。让我们看看它是如何工作的:</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nn"><img src="../Images/30b314d5827e5f3efd977428faf23122.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YOxGH48__GLs__IJ_ohHMw.png"/></div></div></figure><p id="ac69" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，如果我们把input设为3，<strong class="ki jk">assure _ ceiling</strong>函数会使用里面的包装函数产生一个值，这个值就是<strong class="ki jk"> add_five(3) </strong>。<strong class="ki jk">包装器</strong>函数的输出是8，因为8小于上限10，这也是<strong class="ki jk">确保上限(加五)</strong>将返回的值。到目前为止，它的工作方式类似于<strong class="ki jk"> add_five() </strong>。如果我们给的初始输入是6呢？那么add_five(6)将是11，高于10的上限。因此，它将返回输入本身，而不是返回11，6:</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi no"><img src="../Images/1c0cadf53bde6a6ffcd4a5f870ef9911.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZXYsqLr7qLs-ge-rRSJ_uw.png"/></div></div></figure><p id="fb0f" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们在这里没有真正使用装饰器，尽管我们已经定义了装饰器函数。使用它的最有效方法是通过下面的代码:</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi np"><img src="../Images/2c75480df56b745d9376da334ed1ce28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*un3SzBFxfSuJ3XoWqYVOEg.png"/></div></div></figure><p id="e75a" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">写完<strong class="ki jk">确保_上限</strong>函数后，我们可以在我们要修饰的函数的正上方用“@”符号“<strong class="ki jk"><em class="my">【wrap】</em></strong>”。应用后，我们可以直接调用修饰函数来获得修改后的输出。</p><p id="44a7" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki jk"> 2 —缓存之前的运行结果</strong></p><p id="bd36" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">装饰器也可以作为函数级缓存。使用同一个<strong class="ki jk"> add_five() </strong>函数，我们可以在每次运行函数时保存输出，这样当后面给出相同的输入时，就可以快速抓取结果，而不需要再次运行函数。这是非常有用的，尤其是当函数需要很长时间才能运行并且会被重用的时候。让我们看看这里的例子。我们首先定义装饰者:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="5e3e" class="ma mb jj ne b gy ni nj l nk nl">def ensure_ceiling_cache(func):<br/>    ceiling = 10<br/>    cache = {}<br/>    def wrapper(x):<br/>        if x in cache.keys():<br/>           print(f’Using cache for {x}’)<br/>        else:<br/>           print(f’Using function for {x}’)<br/>           value = func(x) if func(x) &lt; ceiling else x<br/>           cache[x] = value<br/>     return cache[x]<br/> return wrapper</span></pre><p id="7edc" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在装饰器中，我们包含一个“缓存”字典来保存每次运行的输出，然后定义一个if/else语句来决定我们是需要运行函数来获得结果，还是简单地使用缓存的字典。我们来看看它在<strong class="ki jk"> add_five() </strong>中的用法:</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nq"><img src="../Images/98f90cb21e6755dcb46a6ce33ad4f129.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yz-Q91H5EdLh_fJ22vW7ew.png"/></div></div></figure><p id="812a" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，当我们调用<strong class="ki jk"> add_five() </strong>函数时，它不仅会为输出应用一个上限，而且它还有一个保存在装饰器内部的缓存字典。第二次调用<strong class="ki jk"> add_five(3) </strong>时，不会使用函数产生结果，只是简单的查找前面的结果是什么。</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nr"><img src="../Images/0ce49fec8fe2922e749adc1812b83666.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hsxcCMGbf6QUCs6cOEz1Jg.png"/></div></div></figure></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><p id="bfa5" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">总之，我们已经使用python decorator修改了现有的函数，并缓存了以前的输出，以便在重复运行函数时节省时间。希望带有示例的用例简单易懂。你还遇到过哪些使用python decorators的场景？请在下面的评论中告诉我们！</p><p id="138c" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢您的阅读！以下是我写的一些关于Python编程的其他文章:</p><ul class=""><li id="d9da" class="ns nt jj ki b kj kk kn ko kr nu kv nv kz nw ld nx ny nz oa bi translated"><a class="ae jg" href="https://zzhu17.medium.com/web-scraping-yahoo-finance-news-a18f9b20ee8a" rel="noopener">网页抓取雅虎财经新闻</a></li><li id="e116" class="ns nt jj ki b kj ob kn oc kr od kv oe kz of ld nx ny nz oa bi translated"><a class="ae jg" href="https://pub.towardsai.net/getting-valuable-insights-and-visualizations-from-tweets-using-python-and-twint-28d9f9eb9128" rel="noopener ugc nofollow" target="_blank">使用twint获取并分析推特</a></li><li id="018b" class="ns nt jj ki b kj ob kn oc kr od kv oe kz of ld nx ny nz oa bi translated"><a class="ae jg" rel="noopener" target="_blank" href="/two-simple-method-to-sort-a-python-dictionary-a7907c266dba">python字典排序的两种简单方法</a></li><li id="bb0d" class="ns nt jj ki b kj ob kn oc kr od kv oe kz of ld nx ny nz oa bi translated"><a class="ae jg" href="https://python.plainenglish.io/introducing-python-package-cvxopt-implementing-svm-from-scratch-dc40dda1da1f" rel="noopener ugc nofollow" target="_blank">使用CVXOPT从头开始实现SVM</a></li></ul><p id="a5ad" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我还有<a class="ae jg" href="https://medium.com/@zzhu17/list/data-science-interview-preparation-bfb0986a61a3" rel="noopener">一份关于<a class="ae jg" rel="noopener" target="_blank" href="/20-machine-learning-related-questions-to-prepare-for-interviews-93bcba72f911">机器学习</a>、<a class="ae jg" rel="noopener" target="_blank" href="/22-statistics-questions-to-prepare-for-data-science-interviews-d5651a8b3c56">统计</a>、<a class="ae jg" rel="noopener" target="_blank" href="/12-probability-practice-questions-for-data-science-interviews-2ec5230304d9">概率</a>、<a class="ae jg" rel="noopener" target="_blank" href="/structure-your-answers-for-case-study-questions-during-data-science-interviews-a14a02d21e6c">案例研究</a>、<a class="ae jg" rel="noopener" target="_blank" href="/prepare-behavioral-questions-for-data-science-interviews-96e97f13be15">行为问题</a>的数据科学家面试准备问题清单</a>，如果需要可以查阅一下。</p><p id="d442" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">还有我的文章如果感兴趣的话:</p><div class="is it gp gr iu le"><a href="https://zzhu17.medium.com/my-blog-posts-gallery-ac6e01fe5cc3" rel="noopener follow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd jk gy z fp lj fr fs lk fu fw ji bi translated">我的博客文章库</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">我快乐的地方</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">zzhu17.medium.com</p></div></div><div class="ln l"><div class="og l lp lq lr ln ls ja le"/></div></div></a></div><p id="8df6" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">订阅我的电子邮件列表:</p><div class="is it gp gr iu le"><a href="https://zzhu17.medium.com/subscribe" rel="noopener follow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd jk gy z fp lj fr fs lk fu fw ji bi translated">每当朱发表。</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">每当朱发表。感谢您的阅读！通过订阅保持对我的故事的更新！由…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">zzhu17.medium.com</p></div></div><div class="ln l"><div class="oh l lp lq lr ln ls ja le"/></div></div></a></div><p id="1f72" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注册成为中级会员:</p><div class="is it gp gr iu le"><a href="https://zzhu17.medium.com/membership" rel="noopener follow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd jk gy z fp lj fr fs lk fu fw ji bi translated">请通过我的推荐链接朱加入媒体</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">阅读朱(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">zzhu17.medium.com</p></div></div><div class="ln l"><div class="oi l lp lq lr ln ls ja le"/></div></div></a></div><p id="d904" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">或者在YouTube上关注我:</p><div class="is it gp gr iu le"><a href="https://youtube.com/channel/UCMs6go1pvY5OOy1DXVtMo5A" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd jk gy z fp lj fr fs lk fu fw ji bi translated">朱</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">你好。欢迎来到我的Youtube频道！！！我想用这个空间来分享我的生活、观点、建议和有趣的东西…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">youtube.com</p></div></div><div class="ln l"><div class="oj l lp lq lr ln ls ja le"/></div></div></a></div></div></div>    
</body>
</html>