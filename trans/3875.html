<html>
<head>
<title>Why You Shouldn’t Use pandas.get_dummies For Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么不应该用pandas.get_dummies进行机器学习</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/why-you-shouldnt-use-pandas-get-dummies-for-machine-learning-e088a435beef#2022-08-29">https://towardsdatascience.com/why-you-shouldnt-use-pandas-get-dummies-for-machine-learning-e088a435beef#2022-08-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6528" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">反对用熊猫做热门编码的理由</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/05e991755cbfa411463ab3d0e077b20a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AvxuRYqYflXVJQYi9fsLDQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自Pexels的Alexander Kovalev的照片:<a class="ae ky" href="https://www.pexels.com/photo/grayscale-photography-of-stop-signage-under-sky-1585711/" rel="noopener ugc nofollow" target="_blank">https://www . Pexels . com/photo/gray-photography-of-stop-signage-under-sky-1585711/</a></p></figure><p id="0d18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">熊猫图书馆因其在机器学习项目中的实用性而闻名。</p><p id="028e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，Pandas中有一些工具对于训练模型来说并不理想。这种工具的一个最好的例子是<code class="fe lv lw lx ly b">get_dummies</code>函数，它用于一个热编码。</p><p id="7cad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们提供了熊猫的一个热门编码功能的快速纲要，并解释了为什么它不适合机器学习任务。</p><h2 id="30b1" class="lz ma it bd mb mc md dn me mf mg dp mh li mi mj mk lm ml mm mn lq mo mp mq mr bi translated">一个关于熊猫的热门编码</h2><p id="f094" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">让我们先快速回顾一下如何用Pandas对变量进行热编码。</p><p id="b0da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们正在处理以下数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/8952e92d9306417f52b526b6b5555461.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*MXKRRSNRsiMWHcpflnaOVQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="11b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以从这个数据集中创建虚拟变量，方法是识别分类特征，然后使用<code class="fe lv lw lx ly b">get_dummies</code>函数转换它们。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/5e83a4f3f19e325363becd101f4a0864.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*VjjxamRn8lWg3I-evC670w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="c0c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以用虚拟变量替换数据集中的当前分类特征。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/f67438e69405cafed8b1443f12c02b98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hMMjo39ION3C9zfYpcMigQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="3bc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总而言之，<code class="fe lv lw lx ly b">get_dummies</code>功能使用户能够用最少的代码来编码他们的特性，适合熊猫工具。</p><h2 id="d877" class="lz ma it bd mb mc md dn me mf mg dp mh li mi mj mk lm ml mm mn lq mo mp mq mr bi translated">熊猫的缺点. get_dummies</h2><p id="cdd8" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated"><code class="fe lv lw lx ly b">get_dummies</code>函数是一种快速简单的变量编码方式，可用于任何后续分析。然而，出于机器学习的目的使用这种编码方法是错误的，原因有二。</p><ol class=""><li id="6717" class="nc nd it lb b lc ld lf lg li ne lm nf lq ng lu nh ni nj nk bi translated"><strong class="lb iu">get _ dummies函数不考虑看不见的数据</strong></li></ol><p id="5c2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">任何机器学习模型都必须考虑看不见的数据。因此，用测试数据生成的虚拟变量必须与用训练数据生成的虚拟变量相匹配。</p><p id="9b3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑到这一点，很容易看出使用Pandas进行热编码会导致什么问题。</p><p id="0fd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">熊猫图书馆的<code class="fe lv lw lx ly b">get_dummies</code>方法基于当前值对特征进行编码。然而，测试数据中唯一值的数量总有可能<em class="nl">不</em>与训练数据中唯一值的数量相匹配。</p><p id="d5c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上例的数据集中，<code class="fe lv lw lx ly b">job</code>特征包含3个唯一值:“医生”、“护士”和“外科医生”。对该列执行一次热编码会产生3个虚拟变量。</p><p id="aa6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，如果测试数据的<code class="fe lv lw lx ly b">job</code>特性比训练集的特性有更多的唯一值，会发生什么呢？这些数据会产生与用于训练模型的数据不匹配的虚拟变量。</p><p id="979e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了说明这一点，让我们用这个数据训练一个线性回归模型，把<code class="fe lv lw lx ly b">income</code>作为目标标签。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="c99b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们希望用一个测试数据集来评估这个模型。为此，我们还需要对新数据集进行热编码。但是，该数据集的<code class="fe lv lw lx ly b">job</code>特征有4个唯一值:“医生”、“护士”、“外科医生”和“药剂师”。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="deb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，在对测试集执行一次热编码后，训练集和测试集中的输入特征数量不匹配。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/9126dc1e25e6ff9c1ec61982e837cb3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*fTaO09EqxDOT0d4NJPA3oA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="4e7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个热编码测试数据集有8个输入要素。</p><p id="f708" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，用包含7个输入特征的数据训练的线性回归模型将不能使用不同维度的数据进行预测。</p><p id="7997" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了展示这一点，让我们尝试在测试集上使用<code class="fe lv lw lx ly b">predict</code>方法来生成预测。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/65f488c940f3fcf76a0d8958dcd62aba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ieTCR-HSHGcBXO6iTyaRA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="8048" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如预期的那样，该模型无法用这些测试数据进行预测。</p><p id="01c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 2。get_dummies方法与其他机器学习工具不兼容。</strong></p><p id="4df7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据预处理通常需要执行一系列操作。</p><p id="a071" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，Pandas库的一个热门编码方法很难与标准化和主成分分析等操作无缝结合使用。</p><p id="6458" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然<code class="fe lv lw lx ly b">get_dummies</code>函数当然可以集成到预处理过程中，但它需要一种在代码可读性和效率方面不太理想的方法。</p><h2 id="338c" class="lz ma it bd mb mc md dn me mf mg dp mh li mi mj mk lm ml mm mn lq mo mp mq mr bi translated">更好的选择</h2><p id="ca98" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">幸运的是，有更好的编码分类变量的方法来解决上述问题。</p><p id="9f1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些方法中最受欢迎的是Scikit Learn的<a class="ae ky" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OneHotEncoder.html" rel="noopener ugc nofollow" target="_blank">onehotencode</a>，它更适合机器学习任务。</p><p id="473f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们使用当前数据集来演示OneHotEncoder。</p><p id="6e2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们创建一个<code class="fe lv lw lx ly b">OneHotEncoder</code>对象，将‘ignore’赋给<code class="fe lv lw lx ly b">handle_unknown</code>参数。这确保了经过训练的模型能够处理看不见的数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="d947" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们创建一个存储<code class="fe lv lw lx ly b">OneHotEncoder</code>对象的<code class="fe lv lw lx ly b">Pipeline</code>对象。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="6c90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，我们创建一个<code class="fe lv lw lx ly b">ColumnTransformer</code>对象，我们可以用它来指定需要编码的特性。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="fa2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要一个<code class="fe lv lw lx ly b">ColumnTransformer</code>对象，因为没有它，<em class="nl">每个</em>列都将被编码，包括数字特征。使用该对象时，有必要将“通过”值分配给<code class="fe lv lw lx ly b">remainder</code>参数。这确保了没有在转换器中指定的列不会被删除。</p><p id="39d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了这个新的column transformer对象，我们现在可以用<code class="fe lv lw lx ly b">fit_transform</code>方法对训练数据集进行编码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="940b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们可以用<code class="fe lv lw lx ly b">transform</code>方法对测试数据进行编码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="783d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这一次，生成预测应该没有问题，因为训练集和测试集具有相同数量的输入特征。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/bde7c95c57a6a32db5f8de7e012c28fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*D4-7t34Q-RkLJAcbtn_u3A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><h2 id="bf7e" class="lz ma it bd mb mc md dn me mf mg dp mh li mi mj mk lm ml mm mn lq mo mp mq mr bi translated">OneHotEncoder的工作原理</h2><p id="72b9" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">在机器学习环境中，Scikit Learn的<code class="fe lv lw lx ly b">OneHotEncoder</code>优于Pandas library的<code class="fe lv lw lx ly b">get_dummies</code>方法的原因有很多。</p><p id="abdf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，它使用户能够训练模型，而不必担心训练集和测试集之间的分类特征的唯一值的差异。</p><p id="2848" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其次，由于Scikit Learn库提供的其他工具，用户现在可以更有效地简化其他操作。</p><p id="4cee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为像<code class="fe lv lw lx ly b">StandardScaler</code>和<code class="fe lv lw lx ly b">PCA</code>这样的流行类来自同一个Scikit Learn包，所以更容易内聚地使用它们并有效地处理数据集。尽管给定的任务需要大量的操作，但是用户会发现用可读的代码来执行它们是很容易的。</p><p id="99de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe lv lw lx ly b">OneHotEncoder</code>的唯一缺点是它的学习曲线有点陡。希望学习使用该Scikit学习工具的用户还必须熟悉其他Scikit学习工具，如<code class="fe lv lw lx ly b">Pipeline</code>和<code class="fe lv lw lx ly b">ColumnTransformer</code>。</p><h2 id="cba3" class="lz ma it bd mb mc md dn me mf mg dp mh li mi mj mk lm ml mm mn lq mo mp mq mr bi translated">结论</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fef8c215cb0d20a66fbbf67418029bfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*K_T8pO1hYWYYwbC9"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@prateekkatyal?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Prateek Katyal </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="cf8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我开始训练模型时，使用熊猫为机器学习任务编码是我最大的失误之一，所以我认为值得强调这个问题，以免其他人犯同样的错误。</p><p id="ccd2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">即使您一直在使用Pandas进行热编码，我也强烈建议您在未来的项目中切换到Scikit Learn库的<code class="fe lv lw lx ly b">OneHotEncoder</code>。</p><p id="1d29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我祝你在数据科学的努力中好运！</p></div></div>    
</body>
</html>