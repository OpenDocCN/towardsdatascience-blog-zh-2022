<html>
<head>
<title>Geo Lift Experiments II: Spotify Blend Case Study</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Geo Lift实验II: Spotify Blend案例研究</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/geo-lift-experiments-ii-spotify-blend-case-study-476a81099744#2022-07-05">https://towardsdatascience.com/geo-lift-experiments-ii-spotify-blend-case-study-476a81099744#2022-07-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7482" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这是两部分系列的第2部分，介绍产品环境中的geo lift实验:</h2></div><ol class=""><li id="1ae1" class="ki kj it kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated"><a class="ae la" rel="noopener" target="_blank" href="/geo-lift-experiments-i-understanding-difference-in-differences-5f35e41a2fdb">理解差异中的差异</a></li><li id="3348" class="ki kj it kk b kl lb kn lc kp ld kr le kt lf kv kw kx ky kz bi translated">Spotify Blend案例研究</li></ol><p id="d53f" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">在这一部分，我们将把我们在<a class="ae la" rel="noopener" target="_blank" href="/geo-lift-experiments-i-understanding-difference-in-differences-5f35e41a2fdb">第一部分</a>中探索的内容应用到案例研究中。让我们深入案例研究。</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ma"><img src="../Images/2ca539a86cf6d25de802fdee036c7201.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SuCeB2rQHFl6uM56"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">照片由<a class="ae la" href="https://unsplash.com/@deepak_jpeg?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">迪帕克·乔杜里</a>在<a class="ae la" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><h2 id="1e22" class="mq mr it bd ms mt mu dn mv mw mx dp my kp mz na nb kr nc nd ne kt nf ng nh ni bi translated">产品背景:Spotify Blend</h2><p id="f1b4" class="pw-post-body-paragraph lg lh it kk b kl nj ju li kn nk jx lj kp nl ll lm kr nm lo lp kt nn lr ls kv im bi translated">假设我们是Spotify播放列表体验团队的项目经理。对于任何不熟悉这个功能的人来说，这是一个允许用户与他们选择的朋友创建播放列表的功能。然后，播放列表会自动生成用户及其朋友都喜欢的歌曲。它还向用户显示他们的音乐品味和朋友的音乐品味之间的匹配分数。当用户收听新音乐时，该品味匹配分数改变，并且播放列表提供的推荐变得更好。</p><p id="07e4" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">作为这个特性的项目经理，让我们假设我们发现用户在设置混合的体验上有一些摩擦。邀请朋友加入blend时，会向用户显示一个本机共享模式，以便与朋友共享邀请链接(如下所示)。当朋友们点击与他们分享的链接时，他们就会被添加到混合中。让我们假设，查看数据，我们看到在用户点击邀请按钮和他们的朋友成功接受他们的邀请之间有相当大的落差。我们没有太多的数据来说明这到底是为什么，因为这可能是由于用户没有通过共享模式发送邀请。也可能是朋友没有回复邀请信息。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi no"><img src="../Images/dd960a6ae609a5998b1004b74e19ae66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KHt13ECebgp_RyI_hyhEwQ.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">点击Spotify Blend功能上的邀请按钮时的原生共享模式。(图片由作者提供)</p></figure><h2 id="824b" class="mq mr it bd ms mt mu dn mv mw mx dp my kp mz na nb kr nc nd ne kt nf ng nh ni bi translated">假设</h2><p id="f7a7" class="pw-post-body-paragraph lg lh it kk b kl nj ju li kn nk jx lj kp nl ll lm kr nm lo lp kt nn lr ls kv im bi translated">我们假设，通过在Spotify应用程序中保持这种体验，用户更有可能成功邀请他们的朋友，并创建一个混合。我们希望更改这部分功能，允许用户通过用户名(或从关注者下拉列表中选择)搜索用户，以便将他们添加到混合中。作为一个数据驱动的项目经理，我们希望将此作为一个实验来验证我们的假设和假说。</p><h2 id="2cfe" class="mq mr it bd ms mt mu dn mv mw mx dp my kp mz na nb kr nc nd ne kt nf ng nh ni bi translated">问题</h2><p id="5271" class="pw-post-body-paragraph lg lh it kk b kl nj ju li kn nk jx lj kp nl ll lm kr nm lo lp kt nn lr ls kv im bi translated">由于多个用户之间的交互对该功能至关重要，因此一个用户使用该功能的方式并不独立于另一个用户使用该功能的方式。因此，如果我们将此作为传统的AB测试来运行，将每个用户作为随机单元，那么我们将违反SUTVA。从用户的角度来看，如果用户可以在Spotify中搜索并邀请他们的朋友，但他们的朋友在控制组中，看不到邀请，这将中断他们的体验，并影响他们使用该功能的方式。</p><p id="8e47" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">解决这个问题的一个方法是将网络分成互相跟随的用户群，并在群集级别执行随机分配。然而，由于这是Spotify的首批多用户体验之一，让我们假设没有任何基础设施来运行这种类型的实验。就开发资源而言，建立基础设施的成本很高，我们希望更有资源来更快地迭代。</p><p id="62ee" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">让我们假设，通过一些探索性的数据分析，我们发现98%的用户只创建与来自他们自己地理位置的其他用户的混合。通过将我们的特征变化限制在特定的地理区域，我们非常接近于重建SUTVA。因此，这似乎是一个地球同步轨道提升实验的绝佳候选。我们承认，地理提升实验的结果并不像我们要进行的社交聚类实验或如果我们100%的用户只与来自他们自己地理的用户创建混合那样是一个强有力的因果关系指标。但是我们认为，如果把这个实验作为一个地理提升实验来运行，我们会得到这个变化的影响的一个很好的指示。</p><p id="e635" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">我们的控制地理位置将为<code class="fe np nq nr ns b">geo_1</code>，我们的治疗地理位置将为<code class="fe np nq nr ns b">geo_2</code>。我们将只在<code class="fe np nq nr ns b">geo_2</code>发布改变，我们相信这将增加点击邀请按钮的用户被至少一个朋友接受邀请的可能性。因此，我们的成功度量将是表示用户是否成功邀请1个朋友加入混合的转换度量。</p><h2 id="30df" class="mq mr it bd ms mt mu dn mv mw mx dp my kp mz na nb kr nc nd ne kt nf ng nh ni bi translated">混杂因素</h2><p id="adc4" class="pw-post-body-paragraph lg lh it kk b kl nj ju li kn nk jx lj kp nl ll lm kr nm lo lp kt nn lr ls kv im bi translated">让我们假设我们已经仔细地选择了<code class="fe np nq nr ns b">geo_1</code>和<code class="fe np nq nr ns b">geo_2</code>，这样我们可以控制的任何混杂因素都可以在两个地理区域一致地应用。任何可能对此功能的指标产生影响的普遍获得活动都适用于两个地区。</p><p id="6146" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">现在我们已经清楚了上下文，让我们假设我们已经运行了这个实验一段时间，并且已经收集了足够的数据。所以让我们深入分析一下。</p><h2 id="9dc5" class="mq mr it bd ms mt mu dn mv mw mx dp my kp mz na nb kr nc nd ne kt nf ng nh ni bi translated">分析</h2><p id="9d16" class="pw-post-body-paragraph lg lh it kk b kl nj ju li kn nk jx lj kp nl ll lm kr nm lo lp kt nn lr ls kv im bi translated">在开始分析之前，值得注意的是，这里使用的数据是人工生成的，因此已经是本练习的理想格式。在现实世界中，我们可能需要执行一些ETL操作来获得这种格式的数据。然而，这超出了本文的范围。这些数据也不代表Spotify的实际用户参与度数据。</p><p id="4dd5" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">让我们导入依赖项并研究实验数据。</p><pre class="mb mc md me gt nt ns nu nv aw nw bi"><span id="7e7c" class="mq mr it ns b gy nx ny l nz oa">import pandas as pd<br/>import numpy as np<br/>import pymc3 as pm<br/>import theano.tensor as tt<br/>import matplotlib.pyplot as plt<br/>import arviz as az</span><span id="b15f" class="mq mr it ns b gy ob ny l nz oa">experiment_data = pd.read_csv('experiment_data.csv')</span><span id="e3f7" class="mq mr it ns b gy ob ny l nz oa">experiment_data.head()</span></pre><figure class="mb mc md me gt mf gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/928bf1b02a163feade78bf3618e1c608.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*x7LXXKI026WzkF8Qj5E9vA.png"/></div></figure><p id="41dd" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">我们看到数据包含一个散列来表示用户Id，用户在哪个组中，转换后的列表示用户的邀请是否成功。让我们继续总结不同组的转化率。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/69f3f96819ee30d2702984ebcb672b62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*yG8ipPZWjOdv4NCXGbZmKg.png"/></div></figure><p id="720b" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">我们将把每组的转换率建模为一个具有Beta分布的变量，就像我们之前在做<a class="ae la" rel="noopener" target="_blank" href="/bayesian-ab-testing-part-i-conversions-ac2635f878ec">转换率的贝叶斯建模</a>时所做的那样。我们不会通过检查来估计每个Beta分布的参数，而是将它们建模为0和相应组样本大小之间的均匀分布变量。所以让我们开始这样做:</p><pre class="mb mc md me gt nt ns nu nv aw nw bi"><span id="6029" class="mq mr it ns b gy nx ny l nz oa">diff_model = pm.Model()</span><span id="8a14" class="mq mr it ns b gy ob ny l nz oa">with diff_model:<br/>    geo_1_pre_a = pm.Uniform('geo_1_pre_a', lower=0, upper=1367)<br/>    geo_1_pre_b = pm.Uniform('geo_1_pre_b', lower=0, upper=1367)    <br/>    <br/>    geo_1_post_a = pm.Uniform('geo_1_post_a', lower=0, upper=1893)<br/>    geo_1_post_b = pm.Uniform('geo_1_post_b', lower=0, upper=1893)<br/>    <br/>    geo_2_pre_a = pm.Uniform('geo_2_pre_a', lower=0, upper=1522)<br/>    geo_2_pre_b = pm.Uniform('geo_2_pre_b', lower=0, upper=1522)    <br/>    <br/>    geo_2_post_a = pm.Uniform('geo_2_post_a', lower=0, upper=1408)<br/>    geo_2_post_b = pm.Uniform('geo_2_post_b', lower=0, upper=1408)</span></pre><p id="6153" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">既然我们已经对分布参数进行了建模，我们就可以对每个转换率的分布进行建模了。</p><pre class="mb mc md me gt nt ns nu nv aw nw bi"><span id="0fb5" class="mq mr it ns b gy nx ny l nz oa">with diff_model:<br/>    geo_1_pre_cr = pm.Beta('geo_1_pre_cr', alpha=geo_1_pre_a, beta=geo_1_pre_b)<br/>    <br/>    geo_1_post_cr = pm.Beta('geo_1_post_cr', alpha=geo_1_post_a, beta=geo_1_post_b)    <br/>    <br/>    geo_2_pre_cr = pm.Beta('geo_2_pre_cr', alpha=geo_2_pre_a, beta=geo_2_pre_b)    <br/>    <br/>    geo_2_post_cr = pm.Beta('geo_2_post_cr', alpha=geo_2_post_a, beta=geo_2_post_b)</span></pre><p id="ab34" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">在对每个转换率进行建模后，我们现在可以对特性发布前后的差异进行建模，同时对差异中的差异进行建模，这就是我们的提升。</p><pre class="mb mc md me gt nt ns nu nv aw nw bi"><span id="3499" class="mq mr it ns b gy nx ny l nz oa">with diff_model:<br/>    diff_pre = pm.Deterministic('diff_pre', (geo_2_pre_cr - geo_1_pre_cr))<br/>    diff_post = pm.Deterministic('diff_post', (geo_2_post_cr - geo_1_post_cr))<br/>    diff_in_diff = pm.Deterministic('diff_in_diff', diff_post - diff_pre)</span></pre><p id="6761" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">既然我们已经对差异进行了分层建模，我们可以添加我们的观察值。但在此之前，我们不妨也对每个geo中的提升进行建模，以帮助我们更好地理解不同混杂因素导致的提升。</p><pre class="mb mc md me gt nt ns nu nv aw nw bi"><span id="37b3" class="mq mr it ns b gy nx ny l nz oa">with diff_model:<br/>    diff_geo_1 = pm.Deterministic('diff_geo_1', (geo_1_post_cr - geo_1_pre_cr))<br/>    diff_geo_2 = pm.Deterministic('diff_geo_2', (geo_2_post_cr - geo_2_pre_cr))</span></pre><p id="1a08" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">最后，我们将观察到的转化率添加到模型中，然后对其进行采样。我们将这些转化率建模为伯努利变量，该变量使用之前建模的转化率作为转化率的概率。</p><pre class="mb mc md me gt nt ns nu nv aw nw bi"><span id="ee2c" class="mq mr it ns b gy nx ny l nz oa">with diff_model:<br/>    geo_1_pre_conversions = pm.Bernoulli('geo_1_pre_conversions', p=geo_1_pre_cr, observed=conversion_values['geo_1_pre'])<br/>    <br/>    geo_1_post_conversions = pm.Bernoulli('geo_1_post_conversions', p=geo_1_post_cr, observed=conversion_values['geo_1_post'])    <br/>    <br/>    geo_2_pre_conversions = pm.Bernoulli('geo_2_pre_conversions', p=geo_2_pre_cr, observed=conversion_values['geo_2_pre'])    <br/>    <br/>    geo_2_post_conversions = pm.Bernoulli('geo_2_post_conversions', p=geo_2_post_cr, observed=conversion_values['geo_2_post'])</span><span id="8345" class="mq mr it ns b gy ob ny l nz oa">trace = pm.sample()</span></pre><p id="02d4" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">一旦模型被采样，我们就可以绘制采样分布图。</p><pre class="mb mc md me gt nt ns nu nv aw nw bi"><span id="64ef" class="mq mr it ns b gy nx ny l nz oa">with diff_model:<br/>    az.plot_trace(trace, compact=False)</span></pre><figure class="mb mc md me gt mf gh gi paragraph-image"><div class="gh gi od"><img src="../Images/ace0f435d5f6ec912e9b10bf5ec4e54c.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*EFTXoC1Td4RSRYJJ0mI3Yg.png"/></div></figure><p id="576c" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">查看<code class="fe np nq nr ns b">diff_in_diff</code>图，隆起很可能大于0，隆起的最高概率约为5%。</p><p id="c392" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">我们现在可以检查所有模型的统计数据，并了解它们的95%可信区间在哪里。</p><pre class="mb mc md me gt nt ns nu nv aw nw bi"><span id="ca36" class="mq mr it ns b gy nx ny l nz oa">with diff_model:<br/>    display(az.summary(trace, kind='stats', round_to=2, hdi_prob=0.95))</span></pre><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi oe"><img src="../Images/631cdbcfe784a3cc54fff82655749bdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WQlUwfGKArAWORtcYNZUeg.png"/></div></div></figure><p id="5efd" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">特别是，我们想看看最近3个模型的统计数据— <code class="fe np nq nr ns b">diff_in_diff</code>、<code class="fe np nq nr ns b">diff_geo_1</code>和<code class="fe np nq nr ns b">diff_geo_2</code>。</p><p id="c6e6" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">看起来我们的<code class="fe np nq nr ns b">diff_in_diff</code>平均值为5 %, 95%的可信区间在0-9%之间。因此，虽然这一变化很可能确实影响了用户邀请的成功程度，但也很可能只是很小的影响。</p><p id="ae01" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">查看我们的控制地理，<code class="fe np nq nr ns b">diff_geo_1</code>表明在<code class="fe np nq nr ns b">geo_2</code>发布变更前后平均有5%的差异，95%可信区间位于2–9%之间。由于这个原因，我们没有发布特性变化，这种变化很可能是由于混杂因素造成的。</p><h2 id="6a55" class="mq mr it bd ms mt mu dn mv mw mx dp my kp mz na nb kr nc nd ne kt nf ng nh ni bi translated">结论</h2><p id="79a3" class="pw-post-body-paragraph lg lh it kk b kl nj ju li kn nk jx lj kp nl ll lm kr nm lo lp kt nn lr ls kv im bi translated">虽然看起来我们想要测试的变化可能对用户的邀请有多成功产生了影响，但这种影响可能非常小。如果我们对此次升级感到满意，我们可以将该功能推广到多个地区，并持续监控成功指标。然而，如果我们觉得影响太小，我们可以重新评估我们的假设，想出其他方法来改善用户体验。</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><p id="becc" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated">感谢阅读这篇文章！我希望它能帮助你更好地理解当传统的实验不起作用时，如何用这种方法来测试真实的产品特性。</p><p id="3563" class="pw-post-body-paragraph lg lh it kk b kl km ju li kn ko jx lj kp lk ll lm kr ln lo lp kt lq lr ls kv im bi translated"><em class="of">如果你喜欢阅读我的文章，愿意支持我的写作，并且正在考虑订阅一个媒体，请随时使用我下面的推荐链接。我会从你的订阅费中提成。</em></p><div class="og oh gp gr oi oj"><a href="https://medium.com/@kaushsk12/membership" rel="noopener follow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd iu gy z fp oo fr fs op fu fw is bi translated">通过我的推荐链接加入Medium</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">阅读Kaushik Sureshkumar(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接…</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">medium.com</p></div></div><div class="os l"><div class="ot l ou ov ow os ox mk oj"/></div></div></a></div></div></div>    
</body>
</html>