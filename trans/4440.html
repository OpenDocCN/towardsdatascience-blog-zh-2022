<html>
<head>
<title>It’s Time To Say Goodbye To The Merge Method in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">是时候告别熊猫里的合并法了</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/its-time-to-say-goodbye-to-the-merge-method-in-pandas-b7f39a4a3fb6#2022-10-03">https://towardsdatascience.com/its-time-to-say-goodbye-to-the-merge-method-in-pandas-b7f39a4a3fb6#2022-10-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="facb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">为什么我在Pandas中停止使用合并方法，为什么你也应该这样做</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/04af32002d25b2babae5a85bfd1d5273.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z-dI1_4QP_MMwfgQ"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@alain_pham?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Alain Pham </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="a95a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Pandas中的<code class="fe ls lt lu lv b">merge()</code>方法无疑是数据科学家在数据科学项目中最常用的方法之一。</p><p id="437b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该方法源于SQL中的表连接思想，并扩展到pythonic环境中的表连接，它基于一个或多个列中的匹配值合并两个Pandas数据帧。</p><p id="aebe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下图对此进行了说明:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/b55ba5c2366dbd47f07fea8a2ca228aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*Grd5EFxMDRaGR7MdaNDpiw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">连接表的图解概述(图片由作者提供)</p></figure><p id="9570" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">merge()</code>方法的直观性质使其成为Pandas用户加入数据框架的理想选择。</p><p id="1765" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，当谈到运行时，在Pandas中有一个相对更好的选择，您应该比<code class="fe ls lt lu lv b">merge()</code>方法更喜欢。</p><p id="b9fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这里找到这篇文章的代码。</p><p id="90f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们探索一下🚀！</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="20f0" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated">合并表的方法</h1><h2 id="7078" class="mw mf iq bd mg mx my dn mk mz na dp mo lf nb nc mq lj nd ne ms ln nf ng mu nh bi translated">方法1:使用merge()</h2><p id="ceb5" class="pw-post-body-paragraph kw kx iq ky b kz ni jr lb lc nj ju le lf nk lh li lj nl ll lm ln nm lp lq lr ij bi translated">如上所述，在Pandas中合并数据帧的传统且最常见的方法是使用<code class="fe ls lt lu lv b">merge()</code>方法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="d693" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如上面的代码块所示，该方法接受两个数据帧，<code class="fe ls lt lu lv b">df1</code>和<code class="fe ls lt lu lv b">df2</code>。</p><p id="3b2d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，我们使用<code class="fe ls lt lu lv b">how</code>参数(上例中的<code class="fe ls lt lu lv b">"left"</code>)指定希望执行的连接类型。</p><p id="7666" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们用<code class="fe ls lt lu lv b">left_on</code>参数指定匹配第一个数据帧(<code class="fe ls lt lu lv b">df1</code>)中的值时要考虑的列，用<code class="fe ls lt lu lv b">right_on</code>参数指定匹配第二个数据帧(<code class="fe ls lt lu lv b">df2</code>)中的值时要考虑的列。</p><h2 id="d709" class="mw mf iq bd mg mx my dn mk mz na dp mo lf nb nc mq lj nd ne ms ln nf ng mu nh bi translated">方法2:使用join()</h2><p id="a692" class="pw-post-body-paragraph kw kx iq ky b kz ni jr lb lc nj ju le lf nk lh li lj nl ll lm ln nm lp lq lr ij bi translated">join()方法在目标上类似于Pandas中的merge()方法，但是在实现上有一些不同。</p><ol class=""><li id="e327" class="np nq iq ky b kz la lc ld lf nr lj ns ln nt lr nu nv nw nx bi translated"><code class="fe ls lt lu lv b">join()</code>方法在<code class="fe ls lt lu lv b">df2</code>和<code class="fe ls lt lu lv b">df1</code>的索引处执行查找。然而，<code class="fe ls lt lu lv b">merge()</code>方法主要用于使用列中的条目进行连接。</li><li id="9297" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">默认情况下，<code class="fe ls lt lu lv b">join()</code>方法执行左连接。而<code class="fe ls lt lu lv b">merge()</code>方法在其默认行为中求助于内部连接。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/87ca78c1ac90f95eed9a60bd03c9c550.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*6xOawDPgISh2efjL4jEFCA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">索引值连接表(作者图片)</p></figure><p id="d274" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的代码块演示了<code class="fe ls lt lu lv b">join()</code>方法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe no l"/></div></figure><p id="fbbb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如上所述，<code class="fe ls lt lu lv b">join()</code>方法执行索引查找来连接两个数据帧。也就是说，对应于相同索引值的行被合并。</p><p id="d295" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，在使用<code class="fe ls lt lu lv b">join()</code>方法时，应该首先将希望执行join的列设置为DataFrame的索引，然后调用join()方法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="5fbc" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated">实验装置</h1><p id="d585" class="pw-post-body-paragraph kw kx iq ky b kz ni jr lb lc nj ju le lf nk lh li lj nl ll lm ln nm lp lq lr ij bi translated">为了在Pandas中评估<code class="fe ls lt lu lv b">merge()</code>方法的运行时性能，我们将把它与<code class="fe ls lt lu lv b">join()</code>方法进行比较。</p><p id="66c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">具体来说，我们将创建两个虚拟数据帧，并使用方法<code class="fe ls lt lu lv b">merge()</code>和<code class="fe ls lt lu lv b">join()</code>执行连接。</p><p id="eb48" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个实验的实现如下所示:</p><ul class=""><li id="6967" class="np nq iq ky b kz la lc ld lf nr lj ns ln nt lr of nv nw nx bi translated">首先，我们设置来自<code class="fe ls lt lu lv b">(-high, +high)</code>的整数值。我们将在不同大小的数据帧上比较这两种方法的性能，数据帧的行数来自<code class="fe ls lt lu lv b">rows_list</code>，列数来自<code class="fe ls lt lu lv b">n_columns</code>。最后，我们将运行每个实验<code class="fe ls lt lu lv b">repeat</code>次。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><ul class=""><li id="8bbd" class="np nq iq ky b kz la lc ld lf nr lj ns ln nt lr of nv nw nx bi translated"><code class="fe ls lt lu lv b">create_df</code>方法接受一系列参数并返回一个随机数据帧。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><ul class=""><li id="01b7" class="np nq iq ky b kz la lc ld lf nr lj ns ln nt lr of nv nw nx bi translated">在下面的代码中，我们在同一个数据帧<code class="fe ls lt lu lv b">df1</code>和<code class="fe ls lt lu lv b">df2</code>上测量<code class="fe ls lt lu lv b">merge()</code>方法和<code class="fe ls lt lu lv b">join()</code>方法的运行时间。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og no l"/></div></figure><blockquote class="oh oi oj"><p id="4bad" class="kw kx ok ky b kz la jr lb lc ld ju le ol lg lh li om lk ll lm on lo lp lq lr ij bi translated">注意，要使用<code class="fe ls lt lu lv b">join()</code>方法，您应该首先将列设置为数据帧的索引。</p></blockquote><h1 id="22c3" class="me mf iq bd mg mh oo mj mk ml op mn mo jw oq jx mq jz or ka ms kc os kd mu mv bi translated">结果</h1><p id="bb3f" class="pw-post-body-paragraph kw kx iq ky b kz ni jr lb lc nj ju le lf nk lh li lj nl ll lm ln nm lp lq lr ij bi translated">接下来，我们来看结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/040311b9847a3c7a888072cf99e7feef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pg4HL_HdCzCB2cNbpIAtDQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Join vs Merge方法的实验结果(图片由作者提供)</p></figure><ul class=""><li id="1cd2" class="np nq iq ky b kz la lc ld lf nr lj ns ln nt lr of nv nw nx bi translated">蓝色线图描述了<code class="fe ls lt lu lv b">merge()</code>方法的运行时间，黄色线图代表了<code class="fe ls lt lu lv b">join()</code>方法的运行时间。</li><li id="5e64" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr of nv nw nx bi translated">我们将行数从100万改变到1000万，并注意到两种方法的运行时间与行数正相关。</li><li id="a5af" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr of nv nw nx bi translated">然而，<code class="fe ls lt lu lv b">join()</code>方法在运行时间上比传统的<code class="fe ls lt lu lv b">merge()</code>方法有了显著的改进。</li><li id="6863" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr of nv nw nx bi translated">随着行数的增加，两种方法的运行时间之间的差异也会增加。这表明您应该始终使用<code class="fe ls lt lu lv b">join()</code>方法来合并数据帧，尤其是在较大数据集的情况下。</li></ul></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="509d" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated">结论</h1><p id="4951" class="pw-post-body-paragraph kw kx iq ky b kz ni jr lb lc nj ju le lf nk lh li lj nl ll lm ln nm lp lq lr ij bi translated">总之，在这篇文章中，我们在一个虚拟数据帧上比较了熊猫的<code class="fe ls lt lu lv b">merge()</code>和<code class="fe ls lt lu lv b">join()</code>方法的性能。</p><p id="7e92" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">实验结果表明，就运行时间而言，使用<code class="fe ls lt lu lv b">join()</code>方法对索引列进行合并比使用<code class="fe ls lt lu lv b">merge()</code>方法更有效——提供了高达<strong class="ky ir"> 4到5倍的性能提升。</strong></p><p id="5031" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这里找到这篇文章<a class="ae kv" href="https://deepnote.com/workspace/avi-chawla-695b-aee6f4ef-2d50-4fb6-9ef2-20ee1022995a/project/Untitled-project-118d9af3-9bb2-4714-8dd4-d3f84b4de020/%2Fnotebook.ipynb" rel="noopener ugc nofollow" target="_blank">的代码。</a></p><p id="971e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读！</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><p id="7409" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://subscribepage.io/450q" rel="noopener ugc nofollow" target="_blank"> 🧑‍💻<strong class="ky ir">成为数据科学专家！获取包含450多个熊猫、NumPy和SQL问题的免费数据科学掌握工具包。</strong> </a></p><p id="79ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">✉️ <a class="ae kv" href="https://medium.com/subscribe/@avi_chawla" rel="noopener"> <strong class="ky ir">注册我的电子邮件列表</strong> </a>不要错过另一篇关于数据科学指南、技巧和提示、机器学习、SQL、Python等的文章。Medium会将我的下一篇文章直接发送到你的收件箱。</p></div></div>    
</body>
</html>