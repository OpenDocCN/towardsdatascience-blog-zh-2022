<html>
<head>
<title>Building an Interactive Image Labeler with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python构建交互式图像标注器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-an-interactive-image-labeler-with-python-e1a14c5fc4#2022-11-08">https://towardsdatascience.com/building-an-interactive-image-labeler-with-python-e1a14c5fc4#2022-11-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="184d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用鼠标或键盘标记您的图像数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/627664e73177f4713d7e3052d1f4fb3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Aj-Xc7HikKcpPM3l"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马特·布里内在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="feff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">给数据贴标签是一件痛苦的事。然而，准确标记的数据是数据科学和机器学习的基础。所以，让我们看看如何用Python来加速这个过程。</p><p id="a343" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将构建两种类型的贴标机来记录:</p><ul class=""><li id="d9f0" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">鼠标点击的位置</li><li id="e988" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">键盘上按下的键</li></ul><p id="42fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些可以用来直接在笔记本上标记图像。我们将讨论用于创建这些的代码，你也可以在<a class="ae ky" href="https://github.com/conorosully/medium-articles/blob/master/src/image_tools/image_labelling.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到它。</p><p id="27df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们将使用下面的导入。我们有一些标准包装(第2-3行)。我们有一些用来处理图像的包(第5-6行)。最后一个用于处理文件路径(第8行)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="5acd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将处理用于训练模型的图像，该模型引导自动驾驶汽车在轨道上行驶。你可以在<a class="ae ky" href="https://www.kaggle.com/datasets/conorsully1/jatracer-images?select=object_detection" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上找到这些例子。记下图像名称:</p><pre class="kj kk kl km gt ml mm mn mo aw mp bi"><span id="6942" class="mq mr it mm b gy ms mt l mu mv">181_160_c78164b4-40d2-11ed-a47b-a46bb6070c92.jpg</span></pre><p id="9ca3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">图像尺寸为224 x 224。名称中的前两个数字是该图像中的X和Y坐标。我们希望使用图像作为输入来预测这个坐标。</p><p id="afcf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不清楚？让我们展示其中一张图片。图像存储在第2行<strong class="lb iu">的目录中。我们加载所有这些图像的路径(第3行)。</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="8657" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们采用列表中的第一条路径(第1行)，并从图像路径(第4–6行)中获取X和Y坐标。然后我们显示图像和坐标(第9-11行)。具体来说，我们使用cv2函数在给定的坐标上画一个圆(第10行)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="4867" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在<strong class="lb iu">图1 </strong>中看到输出。自动驾驶汽车要右转了。理想的方向是朝着绿圈给出的坐标走。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/49c8c7af40e7f5e8e9bd64469cf2bd5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*kHe4Vg3OaT4NhQjyWjPgcQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1:图像数据示例(来源:作者)</p></figure><p id="e370" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设你花了几个小时收集数据，却发现它被错误地贴上了标签(这确实发生在我们身上)。试图手动更改文件名中的x/y坐标将是一场噩梦。相反，我们将使用Python。</p><h1 id="b075" class="mx mr it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">标签1:鼠标点击</h1><p id="58bd" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated"><strong class="lb iu">图2 </strong>展示了我们的第一台贴标机。当你点击图片时，它会被保存到一个名为“重新标记”的文件夹中。使用鼠标单击的坐标更新图像名称。你可以看到一个类似的标签如何被用来记录图像中物体的位置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/3641105301dec012e76824b2201f8c9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*EjtW2SoRpqURq_QOQ4k9ZQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2:贴标机1的演示(来源:作者)</p></figure><p id="bf60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要构建这个标签器，我们首先要定义我们的读写路径。第一个是保存现有图像的地方(第1行)。第二个是保存更新图像的位置(第2行)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="de43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们定义一个函数，<strong class="lb iu"> onclick </strong>，当我们点击一个图像时，这个函数就会运行。它获取鼠标点击的坐标(第6 — 7行)。我们用这些坐标创建一个新名称(第10-12行),并用这个名称在新位置保存图像(第14行)。</p><p id="1395" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每次迭代后，绘图被清除(第17行)。如果不这样做，你会遇到内存问题。然后，我们通过删除第一个实例(第25行)来更新路径列表，并显示列表中的下一个图像(第25–29行)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="c99d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在下面看到我们如何使用这个函数。我们首先获取我们想要重新标记的所有图像的路径(第6行)。我们加载第一幅图像(第9–10行)并显示它(第16–17行)。重要的一步是向图形添加点击功能(第14行)。为此，我们将我们的<strong class="lb iu"> onclick </strong>函数作为参数传递给了<strong class="lb iu"> mpl_connect </strong>函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="52e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一件要注意的事情是全局变量的使用(第2-3行)。这允许在<strong class="lb iu"> onclick </strong>函数中更新这些变量。我们还有行<strong class="lb iu"> %matplotlib tk </strong>(行1)。这将在笔记本外的窗口中打开图形。</p><h1 id="16bf" class="mx mr it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">标签2:鼠标点击</h1><p id="4dd1" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">现在，让我们添加一点香料到这个标签。在图3 的<strong class="lb iu">中，你可以看到我们给图像添加了绿色圆圈。这些给出了先前标签的坐标。他们让我们看到哪些图片的标签是错误的。你也可以看到这个贴标机直接在笔记本上工作。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/14f6e6396f303410dcf1847082b8bef0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*lCVNCAW_L7IgjeDKUM3Gbw.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3:贴标机2的演示(来源:作者)</p></figure><p id="9cf2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码类似于我们之前看到的。最重要的是，我们将保存的图像(第9行)必须不同于我们显示的图像(第32行)。否则，我们的图像上都会有亮绿色的圆圈。虽然，这将使模型更容易做出预测！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="0cf6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，我们使用这个函数的方式和以前一样。这次我们有<strong class="lb iu"> %matplotlib noteboo </strong> k(第1行)。这将在笔记本中保留交互图像。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="131b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当使用这个标签时，一个技巧是点击你想从数据集中删除的图像的左上角。然后，您可以过滤掉x &lt; 5和y &lt; 5的所有图像。</p><h1 id="01a7" class="mx mr it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">标签3:键盘按压</h1><p id="b37b" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">让我们用键盘代替记录鼠标点击。如果您想要对图像进行分组以执行分类任务，这将非常有用。</p><p id="7079" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于我们的例子，我们将把我们的图像分为左转弯和右转弯。每当我们点击<strong class="lb iu"> l </strong>(左)<strong class="lb iu"> r </strong>(右)或<strong class="lb iu"> d </strong>(删除)键时，下图就会发生变化。我们还在左上角添加了一个数字。这让我们知道还有多少图像需要标记。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/10f90feb582c46f6434babc009f1f070.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*JXE4a0XskXO6TdUsoAxUGQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4:贴标机3的演示(来源:作者)</p></figure><p id="f122" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先在press 上定义一个函数<strong class="lb iu">，它将在按键时运行。我们获取密钥(第7行)，并使用图像名称作为ID(第10–11行)。接下来会发生什么取决于按下哪个键:</strong></p><ul class=""><li id="dbb4" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">如果我们没有点击一个有效的键，将显示一条错误消息(第14-16行)</li><li id="9c19" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">“l”</strong>我们将一个ID添加到ID列表中，并将“left”添加到标签列表中</li><li id="a006" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">“r”</strong>我们追加ID和“right”</li><li id="4f48" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">我们不附加任何东西</li></ul><p id="71eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">图形被清除(第27行)，我们更新图像(第29–39行)。我们将<strong class="lb iu"> img_path </strong>列表的长度作为文本包含在左上角(第36行)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="ccec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">即使按下“d”键，图像也会更新。收集这些数据时，有时会有一只迷路的手挡住去路。我们现在可以轻松地从分类数据集中移除/删除这些杂乱的图像。</p><p id="a062" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们在下面看看如何使用这个函数。我们将id和标签列表定义为全局变量(第3–6行)。我们加载图像路径列表(第9行)并加载第一个图像作为matplotlib图形(第12–17行)。类似地，在我们向图中添加按压功能之前(第20行)。这次我们传入'<strong class="lb iu"> key_press_event </strong>和新函数<strong class="lb iu"> onpress </strong>作为参数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="25ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你标记完所有的图片，你将会看到类似的列表。对于您的任务，我强烈建议将它们保存为csv。你不会想再做一遍所有的标记吧！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/0755a62b407112884527262657f9ecc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mkqoi-3FI_GJrmCoNwtgCw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(来源:作者)</p></figure></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><p id="7a41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你喜欢这篇文章！你可以成为我的<a class="ae ky" href="https://conorosullyds.medium.com/membership" rel="noopener"> <strong class="lb iu">推荐会员</strong> </a> <strong class="lb iu"> :) </strong>来支持我</p><div class="oc od gp gr oe of"><a href="https://conorosullyds.medium.com/membership" rel="noopener follow" target="_blank"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd iu gy z fp ok fr fs ol fu fw is bi translated">通过我的推荐链接加入Medium康纳·奥沙利文</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">conorosullyds.medium.com</p></div></div><div class="oo l"><div class="op l oq or os oo ot ks of"/></div></div></a></div><p id="7356" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">|<a class="ae ky" href="https://twitter.com/conorosullyDS" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae ky" href="https://www.youtube.com/channel/UChsoWqJbEjBwrn00Zvghi4w" rel="noopener ugc nofollow" target="_blank">YouTube</a>|<a class="ae ky" href="https://mailchi.mp/aa82a5ce1dc0/signup" rel="noopener ugc nofollow" target="_blank">时事通讯</a> —注册免费参加<a class="ae ky" href="https://adataodyssey.com/courses/shap-with-python/" rel="noopener ugc nofollow" target="_blank"> Python SHAP课程</a></p><h2 id="1378" class="mq mr it bd my ou ov dn nc ow ox dp ng li oy oz ni lm pa pb nk lq pc pd nm pe bi translated">资料组</h2><p id="4c46" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated"><strong class="lb iu"> JatRacer Images </strong> (CC0:公有领域)<a class="ae ky" href="https://www.kaggle.com/datasets/conorsully1/jatracer-images?select=object_detection" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/datasets/conorsully 1/JatRacer-Images？选择=对象_检测</a></p></div></div>    
</body>
</html>