<html>
<head>
<title>An alternative to p-values in A/B testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">A/B 测试中 p 值的替代方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/an-alternative-to-p-values-in-a-b-testing-44f1406d3f91#2022-11-10">https://towardsdatascience.com/an-alternative-to-p-values-in-a-b-testing-44f1406d3f91#2022-11-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3cb6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在 A/B 测试中，总变异距离的高概率下界(HPLBs)如何能产生一个综合的有吸引力的测试统计量</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/afce9235a7fa3e1c1577b84b36c5850a.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*CQNEIEMwPAOs2e_by6PGng.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">图 1:来自原始论文的图(作者)</p></figure><p id="5fca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">撰稿人:<a class="lq lr ep" href="https://medium.com/u/f562dceaeb63?source=post_page-----44f1406d3f91--------------------------------" rel="noopener" target="_blank">洛里斯·米歇尔</a>，<a class="lq lr ep" href="https://medium.com/u/ca780798011a?source=post_page-----44f1406d3f91--------------------------------" rel="noopener" target="_blank">杰弗里·纳夫</a></p><p id="9f22" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一般 A/B 测试的经典步骤，即决定两组观察值是否来自不同的分布(比如 P 和 Q)，是:</p><ul class=""><li id="bf28" class="ls lt it kw b kx ky la lb ld lu lh lv ll lw lp lx ly lz ma bi translated">假设一个零假设和一个备择假设(这里分别为 P=Q 和 P≠Q)；</li><li id="72f9" class="ls lt it kw b kx mb la mc ld md lh me ll mf lp lx ly lz ma bi translated">定义重要性水平α；</li><li id="14e8" class="ls lt it kw b kx mb la mc ld md lh me ll mf lp lx ly lz ma bi translated">构建一个统计测试(拒绝或不拒绝空值的二元决策)；</li><li id="67e3" class="ls lt it kw b kx mb la mc ld md lh me ll mf lp lx ly lz ma bi translated">导出测试统计量 T；</li><li id="6bb2" class="ls lt it kw b kx mb la mc ld md lh me ll mf lp lx ly lz ma bi translated">从 t 的近似/渐近/精确零分布获得 p 值。</li></ul><p id="bf0f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然而，当这样的检验拒绝零，即当 P 值是显著的(在给定的水平上)时，我们仍然缺乏对 P 和 Q 之间的差异有多强的度量。事实上，测试的拒绝状态在现代应用中可能是无用的信息(复杂数据)，因为有足够的样本量(假设水平和功效固定)，任何测试都倾向于拒绝空值(因为它很少完全为真)。例如，了解有多少数据点支持分布差异是很有趣的。</p><p id="b650" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，基于来自 P 和 Q 的有限样本，一个比“P 不同于 Q 吗？”可以表述为“实际支持 P 和 Q 之间分布差异的观测值λ的概率下限是多少？”。这将正式转化为以高概率(比如 1-α)满足λˇ≤λ的估计值λˇ的构造。我们称这样的估计为λ上的<strong class="kw iu">高概率下界</strong> (HPLB)。</p><p id="5ca0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这个故事中，我们想鼓励在 A/B 测试中使用 HPLBs，并给出一个论点，说明为什么λ的正确概念是 P 和 Q 之间的<a class="ae mg" href="https://en.wikipedia.org/wiki/Total_variation_distance_of_probability_measures" rel="noopener ugc nofollow" target="_blank">总变化距离</a>，即 TV(P，Q)。我们将在另一篇文章中解释和详细描述这种 HPLB 的构造。您可以随时查看我们的<a class="ae mg" href="https://arxiv.org/pdf/2005.06006.pdf" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu"><em class="mh">pape</em></strong>r</a>了解更多详情。</p><p id="f671" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">为什么总变异距离？</strong></p><p id="fda1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">总变异距离是概率的一个强(细)度量。这意味着如果两个概率分布不同，那么它们的总变化距离将是非零的。它通常被定义为集合上概率的最大不一致。然而，它更直观地表现为概率 P 和 Q 之间的离散传输度量(见图 2):</p><blockquote class="mi mj mk"><p id="4380" class="ku kv mh kw b kx ky ju kz la lb jx lc ml le lf lg mm li lj lk mn lm ln lo lp im bi translated">概率度量 P 和 Q 之间的总变化距离是需要从 P 改变/移动以获得概率度量 Q 的概率质量的分数(反之亦然)。</p></blockquote><p id="1208" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">实际上，总变化距离代表 P 和 Q 之间的点的分数，这正是λ的正确概念。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mo"><img src="../Images/520bcdd7ab50d398523c92b4e4df2e54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7k1Sl-0gAoBG3ENoWBs0VA.jpeg"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">图 2:左上方表示 TV(P，Q)的可能质量差。右上角通常定义为 TV(P，Q)最大概率不一致(在 sigma 代数上)。底部离散的最佳运输公式，质量分数不同于 P 和 Q(作者)。</p></figure><p id="173c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">如何使用 HPLB 及其优势？</strong></p><p id="a72b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">估计值λˇ对 A/B 测试很有吸引力，因为这个单一的数字既包含了<strong class="kw iu">统计显著性</strong>(如 p 值一样)又包含了<strong class="kw iu">效应大小</strong>估计值。它可以按如下方式使用:</p><ul class=""><li id="3984" class="ls lt it kw b kx ky la lb ld lu lh lv ll lw lp lx ly lz ma bi translated">定义置信水平(1-alpha)；</li><li id="770f" class="ls lt it kw b kx mb la mc ld md lh me ll mf lp lx ly lz ma bi translated">基于这两个样本构造 HPLBλˇ；</li><li id="871f" class="ls lt it kw b kx mb la mc ld md lh me ll mf lp lx ly lz ma bi translated">如果λˇ是零，则不拒绝该空值，否则如果λˇ&gt; 0，则拒绝该空值，并推断λ(不同的分数)至少是概率为 1-α的λˇ。</li></ul><p id="43de" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当然，要付出的代价是λˇ的值取决于所选的置信水平(1-α),而 p 值与之无关。然而，在实践中，置信水平变化不大(通常设置为 95%)。</p><p id="722c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">考虑医学中效应大小的例子。与没有接受药物治疗的安慰剂组相比，新的药物治疗需要在实验组中具有显著的效果。但影响有多大也很重要。因此，我们不应该只谈论 p 值，还应该给出一些效应大小的度量。这一点现在在优秀的医学研究中得到广泛认可。事实上，一种使用更直观的方法计算 TV(P，Q)的方法已被用于单变量设置，以描述治疗组和对照组之间的差异。我们的 HPLB 方法提供了显著性和效应大小的度量。让我们用一个例子来说明这一点:</p><p id="ee3c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">举个例子</strong></p><p id="4971" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们模拟二维的两个分布 P 和 Q。因此，P 将只是一个多元正态分布，而 Q 是 P 和具有移动平均值的多元正态分布之间的一个<em class="mh">混合物</em>。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="f50c" class="my mz it mu b gy na nb l nc nd">library(mvtnorm)<br/>library(HPLB)</span><span id="057e" class="my mz it mu b gy ne nb l nc nd">set.seed(1)<br/>n&lt;-2000<br/>p&lt;-2</span><span id="ca0d" class="my mz it mu b gy ne nb l nc nd">#Larger delta -&gt; more difference between P and Q<br/>#Smaller delta -&gt; Less difference between P and Q<br/>delta&lt;-0</span><span id="e936" class="my mz it mu b gy ne nb l nc nd"># Simulate X~P and Y~Q for given delta<br/>U&lt;-runif(n)<br/>X&lt;-rmvnorm(n=n, sig=diag(p))<br/>Y&lt;- (U &lt;=delta)*rmvnorm(n=n, mean=rep(2,p), sig=diag(p))+ (1-(U &lt;=delta))*rmvnorm(n=n, sig=diag(p))</span><span id="eb6b" class="my mz it mu b gy ne nb l nc nd">plot(Y, cex=0.8, col="darkblue")<br/>points(X, cex=0.8, col="red")</span></pre><p id="68e0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">混合权重增量控制两个分布的不同程度。delta 从 0 到 0.9 变化，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi nf"><img src="../Images/40fab83a23fec464e5166f8304af539f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ys_Q-OdV2HYBkibZ2xj-bA.jpeg"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">模拟 delta=0(右上)、delta=0.05(左上)、delta=0.3(右下)和 delta=0.8(左下)的数据。来源:作者</p></figure><p id="6d21" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，我们可以计算每种情况下的 HPLB:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="6f49" class="my mz it mu b gy na nb l nc nd">#Estimate HPLB for each case (vary delta and rerun the code)<br/>t.train&lt;- c(rep(0,n/2), rep(1,n/2) )<br/>xy.train &lt;-rbind(X[1:(n/2),], Y[1:(n/2),])<br/>t.test&lt;- c(rep(0,n/2), rep(1,n/2) )<br/>xy.test &lt;-rbind(X[(n/2+1):n,], Y[(n/2+1):n,])<br/>rf &lt;- ranger::ranger(t~., data.frame(t=t.train,x=xy.train))<br/>rho &lt;- predict(rf, data.frame(t=t.test,x=xy.test))$predictions</span><span id="a276" class="my mz it mu b gy ne nb l nc nd">tvhat &lt;- HPLB(t = t.test, rho = rho, estimator.type = "adapt")<br/>tvhat</span></pre><p id="5434" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我们用上面的种子集来做，我们</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/392b25d4391a6a5c7cef2a899f08ba10.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/1*qLf_E0fKuTNj47hof-yusg.jpeg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">不同增量的估计值。</p></figure><p id="1e0f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，HPLB 设法(I)检测何时两个分布确实没有变化，即当δ为零时它为零，(ii)当δ仅为 0.05 时已经检测到极小的差异，以及(iii)检测到差异越大，δ越大。同样，需要记住的关于这些值的重要事情是，它们确实有意义——值 0.64 将是真实 TV 的下限，概率很高。特别是，每一个大于零的数字都意味着 P=Q 在 5%的水平上被拒绝。</p><p id="36df" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">结论:</strong></p><p id="0fc7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当涉及到 A/B 测试(双样本测试)时，重点通常是统计测试的拒绝状态。当检验拒绝零分布时，在实践中有一个分布差异的强度度量是有用的。通过构建总变化距离的高概率下限，我们可以构建预期不同的观测值部分的下限，从而提供分布差异和偏移强度的综合答案。</p><p id="22b0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> <em class="mh">免责声明和资源:</em> </strong> <em class="mh">我们意识到我们遗漏了许多细节(效率、HPLBs 的构建、功率研究……)，但希望能够开阔思路。在我们的</em> <a class="ae mg" href="https://arxiv.org/pdf/2005.06006.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> <em class="mh">页面</em></strong>R</a><strong class="kw iu"><em class="mh"/></strong><em class="mh">中可以找到 M <em class="mh">矿石的详细信息以及与现有试验的比较，并查看起重机上的 R-package HPLB。</em></em></p></div></div>    
</body>
</html>