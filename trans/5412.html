<html>
<head>
<title>Python Pipreqs — How to Create requirements.txt File Like a Sane Person</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">python pip reqs——如何像正常人一样创建 requirements.txt 文件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-pipreqs-how-to-create-requirements-txt-file-like-a-sane-person-c82da5d5cd13#2022-12-05">https://towardsdatascience.com/python-pipreqs-how-to-create-requirements-txt-file-like-a-sane-person-c82da5d5cd13#2022-12-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7957" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><strong class="ak">想在 requirements.txt 中只包含您使用的库吗？试试 pipreqs，这是一个用于创建更精简的需求文件的 Python 模块。</strong></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8082359042da3017514ad8d455918d0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_rlos6uVk6XMkhSKwTrL3Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">文章缩略图(图片由作者提供)</p></figure><p id="c2ed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">每个 Python 项目都应该有一个<code class="fe lu lv lw lx b">requirements.txt</code>文件。它存储项目运行所需的所有库的信息，并且在部署 Python 项目时是必不可少的。传统上，这是通过<code class="fe lu lv lw lx b">pip freeze</code>命令完成的，该命令输出安装在虚拟环境中的所有库。</p><p id="2452" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是如果您只想要项目中使用的那些呢？这就是 pipreqs 发挥作用的地方。它做的和<code class="fe lu lv lw lx b">pip freeze</code>一样，但是更好。</p><p id="2b82" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">想象一下，您创建了一个新的虚拟环境，并安装了一系列依赖项。在项目期间，您决定不使用一些库，但是您忘记了从环境中删除它们。用<code class="fe lu lv lw lx b">pip freeze</code>生成的<code class="fe lu lv lw lx b">requirements.txt</code>文件会包含使用过的和未使用过的库，这只是浪费资源。</p><p id="80c5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有一个更好的方法，今天你会了解到这一切。</p><p id="1658" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不想看书？好吧，你不必:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="41a9" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">如何使用 Python Pipreqs 创建 requirements.txt 文件</h1><p id="e758" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">我们开始吧。基于 Python 3.10，我用 Anaconda 创建了一个名为<code class="fe lu lv lw lx b">pipreqs_test</code>的新虚拟环境。您可以自由使用 Anaconda 或任何其他环境管理器:</p><pre class="kj kk kl km gt ne lx nf bn ng nh bi"><span id="68f0" class="ni mi it lx b be nj nk l nl nm">conda create --name pipreqs_test python=3.10 -y<br/>conda activate pipreqs_test</span></pre><p id="f2ad" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从这里开始，让我们用 pip 安装一些 Python 库:</p><pre class="kj kk kl km gt ne lx nf bn ng nh bi"><span id="d5c8" class="ni mi it lx b be nj nk l nl nm">pip install numpy pandas matplotlib seaborn statsmodels plotly scikit-learn</span></pre><p id="1147" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是 shell 输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/0da5da4dabcb9e39377661223e9b0fcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8erJc-hGWC7lTOOEhplMkg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 1 —使用 pip 安装 Python 库(图片由作者提供)</p></figure><p id="96bc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，创建一个只使用 Numpy 和 Pandas 的 Python 脚本:</p><pre class="kj kk kl km gt ne lx nf bn ng nh bi"><span id="a7c1" class="ni mi it lx b be nj nk l nl nm">import numpy as np<br/>import pandas as pd<br/><br/><br/>arr = np.array([1, 2, 3])<br/>df = pd.DataFrame({'x': [1, 2, 3], 'y': [4, 5, 6]})</span></pre><p id="60bb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我已经把我的命名为<code class="fe lu lv lw lx b">script.py</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/f2a873f7a209559aeeee8bbd7e3f331c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0cIqljrnhQrsLuUJSgljYg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片 2-Python 文件的内容(图片由作者提供)</p></figure><p id="2eba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们首先来看看发出一个<code class="fe lu lv lw lx b">pip freeze</code>命令会将什么保存到需求文件中:</p><pre class="kj kk kl km gt ne lx nf bn ng nh bi"><span id="84f1" class="ni mi it lx b be nj nk l nl nm">pip freeze &gt; requirements.txt</span></pre><p id="dddd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">事实证明，大量的库——包括使用过的和未使用过的，以及它们的依赖关系:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/eec838bdf226fd0aadbd6e52b141dacd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B0f2Zo7lIQcsk7YEAnvs8g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 3——使用 pip 冻结生成的需求文件(图片由作者提供)</p></figure><p id="000d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您在一台新机器上运行这个脚本，并从一个<code class="fe lu lv lw lx b">requirements.txt</code>文件安装 Python 依赖项，将会安装许多未使用的库。如果您能设法只安装项目中使用的库，那就更好了。</p><p id="3cc6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这就是 pipreqs 的闪光点。但是首先，我们必须安装它:</p><pre class="kj kk kl km gt ne lx nf bn ng nh bi"><span id="5dac" class="ni mi it lx b be nj nk l nl nm">pip install pipreqs</span></pre><p id="231d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Pipreqs 的工作方式是扫描给定目录中的所有<code class="fe lu lv lw lx b">.py</code>文件，并在 Python 文件中寻找导入。这样，它应该只将您实际使用的库写到<code class="fe lu lv lw lx b">requirements.txt</code>。</p><p id="0746" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是保存需求的一般命令:</p><pre class="kj kk kl km gt ne lx nf bn ng nh bi"><span id="8214" class="ni mi it lx b be nj nk l nl nm">pipreqs &lt;path-to-python-project-folder&gt;</span></pre><p id="0402" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您在 Python 项目文件夹中，只需运行以下命令:</p><pre class="kj kk kl km gt ne lx nf bn ng nh bi"><span id="8dae" class="ni mi it lx b be nj nk l nl nm">pipreqs .</span></pre><p id="4f04" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您将看到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/fd523005a2744268467a5878a402278f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CzAXhoA_GNrXw_Ud8ib6jw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 4——使用 pipreqs 创建 requirements.txt 文件(图片由作者提供)</p></figure><p id="f419" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">依赖项现在被保存到<code class="fe lu lv lw lx b">requirements.txt</code>中，所以让我们看看里面有什么:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/b52968bc7ed834c438bc7b96d7f9bcf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dc7WgK6BiFJflFWD_yEwoA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 5——使用 pipreqs 生成的需求文件(图片由作者提供)</p></figure><p id="d520" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">令人惊讶的是——只有熊猫和熊猫被包括在内！这些都是在新机器或新环境中运行项目所需的依赖项。</p><p id="dbc6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但你对 Pipreqs 能做的就这些吗？接下来让我们来看几个“高级”用例。</p><h1 id="d8a7" class="mh mi it bd mj mk nq mm mn mo nr mq mr jz ns ka mt kc nt kd mv kf nu kg mx my bi translated">Pipreqs 还能做什么？</h1><p id="ded1" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">您可以通过将它们打印到控制台来检查项目中使用了哪些库:</p><pre class="kj kk kl km gt ne lx nf bn ng nh bi"><span id="7a4d" class="ni mi it lx b be nj nk l nl nm">pipreqs &lt;path-to-folder&gt; --print</span></pre><p id="aed2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">结果如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/2584a007f45c4e504ef97a25c68285bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*56JzqIjifwfSz0U12cKEPw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 6 —打印依赖关系(作者提供的图片)</p></figure><p id="f4f3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这不会将依赖关系写到文件中，所以请记住这一点。</p><p id="af74" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您也可以强制覆盖<code class="fe lu lv lw lx b">requirements.txt</code>文件。如果你已经有了需求文件，这个命令是需要的，因为单独运行<code class="fe lu lv lw lx b">pipreqs .</code>不会覆盖它:</p><pre class="kj kk kl km gt ne lx nf bn ng nh bi"><span id="0eb5" class="ni mi it lx b be nj nk l nl nm">pipreqs &lt;path-to-folder&gt; --force</span></pre><p id="142c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">更新后的<code class="fe lu lv lw lx b">requirements.txt</code>文件现已保存:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/643a8c58c36ae3c37dc5c7d0d3fca822.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uonh6TMUdRFygejyfij3Zw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 7 —强制覆盖 requirements.txt 文件(图片由作者提供)</p></figure><p id="75b1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您也可以将<code class="fe lu lv lw lx b">requirements.txt</code>文件保存到不同的目的地。请确保包含完整的文件路径，包括文件名:</p><pre class="kj kk kl km gt ne lx nf bn ng nh bi"><span id="a268" class="ni mi it lx b be nj nk l nl nm">pipreqs &lt;path-to-folder&gt; --savepath &lt;path-to-file&gt;</span></pre><p id="990d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我是这样把文件保存到桌面上的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/810b45debebeefcdf195452131346388.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dDYxCrD3utDLisZRAp0BLA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 8 —将 requirements.txt 保存到不同的位置(图片由作者提供)</p></figure><p id="6115" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这几乎就是你对 Pipreqs 所能做的一切。还有一些额外的选项和参数，但这些是您在 99%的时间里都会用到的。</p><p id="3c1c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来让我们做一个简短的回顾。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="1eb8" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">总结 Python Pipreqs</h1><p id="a45f" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">通过<code class="fe lu lv lw lx b">pip freeze</code>用老方法生成需求文件没有错。它只是包括一堆不必要的库和它们的依赖项，因为安装在一个环境中的所有东西(或者上帝禁止的，全球范围内)都会被选中。</p><p id="1675" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Pipreqs 通过扫描给定项目文件夹中的 Python 文件并寻找实际导入的库来解决这一不便。这不是什么开创性的东西，但它会让你的项目更整洁，这总是受欢迎的。</p><p id="12c5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你用什么来跟踪项目的依赖关系？你认为 Pipreqs 是更好的选择吗？请在下面的评论区告诉我。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><p id="9d54" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="nv">喜欢这篇文章吗？成为</em> <a class="ae nw" href="/@radecicdario/membership" rel="noopener ugc nofollow" target="_blank"> <em class="nv">中等会员</em> </a> <em class="nv">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="nx ny gp gr nz oa"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">通过我的推荐链接加入 Medium-Dario rade ci</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">阅读达里奥·拉德契奇(以及媒体上数以千计的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">medium.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo ks oa"/></div></div></a></div></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h2 id="0bc3" class="op mi it bd mj oq or dn mn os ot dp mr lh ou ov mt ll ow ox mv lp oy oz mx pa bi translated">保持联系</h2><ul class=""><li id="4dc5" class="pb pc it la b lb mz le na lh pd ll pe lp pf lt pg ph pi pj bi translated">雇用我作为一名技术作家</li><li id="ce25" class="pb pc it la b lb pk le pl lh pm ll pn lp po lt pg ph pi pj bi translated">订阅<a class="ae nw" href="https://www.youtube.com/c/BetterDataScience" rel="noopener ugc nofollow" target="_blank"> YouTube </a></li><li id="fccc" class="pb pc it la b lb pk le pl lh pm ll pn lp po lt pg ph pi pj bi translated">在<a class="ae nw" href="https://www.linkedin.com/in/darioradecic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上连接</li></ul></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><p id="9856" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="nv">原载于 2022 年 12 月 5 日 https://betterdatascience.com</em><em class="nv"/><a class="ae nw" href="https://betterdatascience.com/python-pipreqs/" rel="noopener ugc nofollow" target="_blank"><em class="nv">。</em></a></p></div></div>    
</body>
</html>