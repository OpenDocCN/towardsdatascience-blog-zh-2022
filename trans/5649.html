<html>
<head>
<title>Build a Full-Stack ML Application With Pydantic And Prefect</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Pydantic 和 Prefect 构建全栈 ML 应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-a-full-stack-ml-application-with-pydantic-and-prefect-915f00fe0c62#2022-12-21">https://towardsdatascience.com/build-a-full-stack-ml-application-with-pydantic-and-prefect-915f00fe0c62#2022-12-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="922c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用一行代码创建 ML 特征工程的用户界面</h2></div><h2 id="18f6" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">动机</h2><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="lj lk l"/></div></figure><p id="de1d" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">作为一名数据科学家，您可能会经常调整您的特征工程流程，并调整您的机器学习模型以获得良好的结果。</p><p id="2909" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">不用深入代码来更改函数参数:</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi me"><img src="../Images/5d982b559fdc24e222b9dd052654e1d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*z9DHxjrckUmEZKSo3mOfPw.gif"/></div></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">作者图片</p></figure><p id="15a3" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">…，如果能从 UI 中更改参数值不是很好吗？</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mp"><img src="../Images/25b269cd5bf9fb04c7a7adac36da886a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*wdCbGZsZfD-7UVCsrHrMdA.gif"/></div></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">作者图片</p></figure><p id="6030" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">这就是 Pydantic 和 Prefect 派上用场的地方。在本文中，您将学习如何使用这两个工具来:</p><ul class=""><li id="9f0d" class="mq mr it ln b lo lp lr ls kr ms kv mt kz mu md mv mw mx my bi translated">通过 UI 调整您的函数输入值</li><li id="e1c5" class="mq mr it ln b lo mz lr na kr nb kv nc kz nd md mv mw mx my bi translated">在运行函数之前验证参数值</li></ul><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ne"><img src="../Images/55618432a3dd429bf799269120b50905.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t-a8o3LoQMFZQ-BsoU5xKA.png"/></div></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">作者图片</p></figure><p id="c6e7" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">您可以随意使用本文的源代码:</p><div class="nf ng gp gr nh ni"><a href="https://github.com/khuyentran1401/iris-prefect" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">GitHub-khuyentran 1401/iris-prefect</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">github.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw mj ni"/></div></div></a></div><h1 id="5111" class="nx kj it bd kk ny nz oa kn ob oc od kq jz oe ka ku kc of kd ky kf og kg lc oh bi translated">用提督创建用户界面</h1><p id="2309" class="pw-post-body-paragraph ll lm it ln b lo oi ju lq lr oj jx lt kr ok lv lw kv ol ly lz kz om mb mc md im bi translated">perfect 是一个开源库，允许你编排和观察用 Python 定义的数据管道。</p><div class="nf ng gp gr nh ni"><a href="https://medium.com/the-prefect-blog/orchestrate-your-data-science-project-with-prefect-2-0-4118418fd7ce" rel="noopener follow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">使用 Prefect 2.0 协调您的数据科学项目</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">让您的数据科学管道能够抵御故障</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">medium.com</p></div></div><div class="nr l"><div class="oo l nt nu nv nr nw mj ni"/></div></div></a></div><p id="c2b1" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">要安装提督，请键入:</p><pre class="le lf lg lh gt op oq or bn os ot bi"><span id="f281" class="ou kj it oq b be ov ow l ox oy">pip install prefect</span></pre><p id="6453" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">让我们使用 Prefect UI 为您的 Python 函数创建一个简单的前端应用程序。从用户界面运行该功能有三个步骤:</p><ul class=""><li id="afaf" class="mq mr it ln b lo lp lr ls kr ms kv mt kz mu md mv mw mx my bi translated">把你的功能变成一种流动</li><li id="8dbd" class="mq mr it ln b lo mz lr na kr nb kv nc kz nd md mv mw mx my bi translated">为流创建部署</li><li id="10d9" class="mq mr it ln b lo mz lr na kr nb kv nc kz nd md mv mw mx my bi translated">启动代理来运行部署</li></ul><h2 id="fb93" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">将功能转化为流程</h2><p id="42c3" class="pw-post-body-paragraph ll lm it ln b lo oi ju lq lr oj jx lt kr ok lv lw kv ol ly lz kz om mb mc md im bi translated">从把一个简单的功能变成一个<em class="oz">流程</em>开始。</p><p id="6f03" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">一个<a class="ae on" href="https://docs.prefect.io/concepts/flows/" rel="noopener ugc nofollow" target="_blank">流程</a>是所有完美工作流程的基础。要将<code class="fe pa pb pc oq b">process</code>函数转换成流程，只需将<code class="fe pa pb pc oq b">flow</code>装饰器添加到<code class="fe pa pb pc oq b">process</code>函数中。</p><pre class="le lf lg lh gt op oq or bn os ot bi"><span id="82f8" class="ou kj it oq b be ov ow l ox oy"># process.py<br/><br/>from prefect import flow<br/><br/>@flow # add a decorator<br/>def process(<br/>    raw_location: str = "data/raw",<br/>    process_location: str = "data/processed",<br/>    raw_file: str = "iris.csv",<br/>    label: str = "Species",<br/>    test_size: float = 0.3,<br/>    columns_to_drop: list = ["Id"],<br/>):<br/>    data = get_raw_data(raw_location, raw_file)<br/>    processed = drop_columns(data, columns=columns_to_drop)<br/>    X, y = get_X_y(processed, label)<br/>    split_data = split_train_test(X, y, test_size)<br/>    save_processed_data(split_data, process_location)</span></pre><blockquote class="pd pe pf"><p id="60cd" class="ll lm oz ln b lo lp ju lq lr ls jx lt pg lu lv lw ph lx ly lz pi ma mb mc md im bi translated">点击查看完整脚本<a class="ae on" href="https://github.com/khuyentran1401/iris-prefect/blob/master/src/process_without_prefect.py" rel="noopener ugc nofollow" target="_blank">。</a></p></blockquote><h2 id="cab6" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">为流创建部署</h2><p id="d915" class="pw-post-body-paragraph ll lm it ln b lo oi ju lq lr oj jx lt kr ok lv lw kv ol ly lz kz om mb mc md im bi translated">接下来，我们将创建一个<em class="oz">部署</em>来从 UI 运行流程。一个<a class="ae on" href="https://docs.prefect.io/concepts/deployments/" rel="noopener ugc nofollow" target="_blank">部署</a>是一个服务器端的概念，它封装了一个流，允许它通过 API 被触发。</p><p id="99f6" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">为了在<code class="fe pa pb pc oq b">process.py</code>文件中创建<code class="fe pa pb pc oq b">process</code>流的部署，在您的终端中键入以下内容:</p><pre class="le lf lg lh gt op oq or bn os ot bi"><span id="76f6" class="ou kj it oq b be ov ow l ox oy">prefect deployment build process.py:process -n 'iris-process' -a</span></pre><p id="71cc" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">其中:</p><ul class=""><li id="47e6" class="mq mr it ln b lo lp lr ls kr ms kv mt kz mu md mv mw mx my bi translated"><code class="fe pa pb pc oq b">-n 'iris-process'</code>指定部署的名称为<code class="fe pa pb pc oq b">iris-process</code></li><li id="37ab" class="mq mr it ln b lo mz lr na kr nb kv nc kz nd md mv mw mx my bi translated"><code class="fe pa pb pc oq b">-a</code>告诉提督同时构建和应用部署</li></ul><p id="2ec9" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">要从 UI 查看您的部署，请登录到您的 Prefect Cloud accoun 或在您的本地计算机上启动 Prefect Orion 服务器:</p><pre class="le lf lg lh gt op oq or bn os ot bi"><span id="03b5" class="ou kj it oq b be ov ow l ox oy">prefect orion start</span></pre><p id="2b43" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">打开网址<a class="ae on" href="http://127.0.0.1:4200/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:4200/ </a>，应该会看到提督 UI:</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi pj"><img src="../Images/33d18728db64af2b0d23fd7af1a6e8b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lIoFZx3bDLRgOpsIR_8j_A.png"/></div></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">作者图片</p></figure><p id="204d" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">点击<em class="oz"> </em>的【部署】标签<em class="oz"> </em>查看所有部署。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi pk"><img src="../Images/5855474e1ceab4ddfd29f33ee246f2b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tBAq9imCQnlqb_oXSIGgfw.png"/></div></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">作者图片</p></figure><h2 id="9a71" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">运行部署</h2><p id="c91e" class="pw-post-body-paragraph ll lm it ln b lo oi ju lq lr oj jx lt kr ok lv lw kv ol ly lz kz om mb mc md im bi translated">要用默认参数值运行一个部署，选择该部署，点击<em class="oz"> </em>按钮，然后点击【快速运行】</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi pl"><img src="../Images/bd7d33f93554f97481f05ea022c92613.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*KPRQS3aeuYhL_Anv3-r9Ag.gif"/></div></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">作者图片</p></figure><p id="ca01" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">要使用自定义参数值运行部署，单击<em class="oz"> </em>按钮<em class="oz">，</em>然后单击“自定义运行”</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi pl"><img src="../Images/439ffbf09fbaa89c571878528169fbf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*jGKmPR3aoXeIs3SEaHPhBg.gif"/></div></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">作者图片</p></figure><p id="2b4d" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">您可以看到，Prefect 根据类型注释为您的流参数自动创建不同的输入元素。例如:</p><ul class=""><li id="b007" class="mq mr it ln b lo lp lr ls kr ms kv mt kz mu md mv mw mx my bi translated">文本字段用于<code class="fe pa pb pc oq b">label: str</code>、<code class="fe pa pb pc oq b">raw_file: str</code>、<code class="fe pa pb pc oq b">raw_location: str</code>和<code class="fe pa pb pc oq b">process_location: str</code></li><li id="33c7" class="mq mr it ln b lo mz lr na kr nb kv nc kz nd md mv mw mx my bi translated">数字字段用于<code class="fe pa pb pc oq b">test_size: float</code></li><li id="0f55" class="mq mr it ln b lo mz lr na kr nb kv nc kz nd md mv mw mx my bi translated">多行文本字段用于<code class="fe pa pb pc oq b">columns_to_drop: list</code></li></ul><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi pm"><img src="../Images/e29fc488bbb28edcd4376152ae141e63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yFhRHUxScQRNdfSj8SXjJQ.png"/></div></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">作者图片</p></figure><p id="4a92" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">我们可以通过以下方式增强用户界面:</p><ul class=""><li id="e7fd" class="mq mr it ln b lo lp lr ls kr ms kv mt kz mu md mv mw mx my bi translated">使用<code class="fe pa pb pc oq b">typing.List[str]</code>将<code class="fe pa pb pc oq b">columns_to_drop</code>变为多选字段</li><li id="b5cd" class="mq mr it ln b lo mz lr na kr nb kv nc kz nd md mv mw mx my bi translated">使用<code class="fe pa pb pc oq b">typing.Literal['option1', 'option2']</code>将<code class="fe pa pb pc oq b">raw_location</code>变为下拉菜单。</li></ul><pre class="le lf lg lh gt op oq or bn os ot bi"><span id="c974" class="ou kj it oq b be ov ow l ox oy">from typing import List, Literal<br/><br/>@flow<br/>def process(<br/>    raw_location: Literal["data/raw", "data/processed"] = "data/raw", # replace str<br/>    process_location: Literal["data/raw", "data/processed"] = "data/processed", # replace str<br/>    raw_file: str = "iris.csv",<br/>    label: str = "Species",<br/>    test_size: float = 0.3,<br/>    columns_to_drop: List[str] = ["Id"], # replace list <br/>):<br/>...</span></pre><p id="9f92" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">要将更改应用到参数模式，再次运行<code class="fe pa pb pc oq b">prefect deployment build</code>命令:</p><pre class="le lf lg lh gt op oq or bn os ot bi"><span id="7393" class="ou kj it oq b be ov ow l ox oy">prefect deployment build process.py:process -n 'iris-process' -a</span></pre><p id="096e" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">现在，您将看到一个多选字段和下拉菜单。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi pn"><img src="../Images/6e19faa8cbf79009bc49102cb3946a9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*devdS6hrUGe-07uSutEbBw.gif"/></div></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">作者图片</p></figure><p id="4d81" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">要查看您的所有流程运行，单击<code class="fe pa pb pc oq b">Flow Runs</code>选项卡:</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi pj"><img src="../Images/33d18728db64af2b0d23fd7af1a6e8b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lIoFZx3bDLRgOpsIR_8j_A.png"/></div></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">作者图片</p></figure><p id="2c58" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">现在，当您查看最新的流程运行时，您会看到其状态为<code class="fe pa pb pc oq b">Late</code>。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi po"><img src="../Images/6f737217f5cff0551576f101c25f4a26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T_sRZFYdkchPKF-wUkBSeg.png"/></div></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">作者图片</p></figure><p id="749a" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">这是因为没有<a class="ae on" href="https://docs.prefect.io/concepts/work-queues/" rel="noopener ugc nofollow" target="_blank">代理</a>来运行部署。让我们通过在终端中键入以下命令来启动代理:</p><pre class="le lf lg lh gt op oq or bn os ot bi"><span id="f316" class="ou kj it oq b be ov ow l ox oy">prefect agent start -q default</span></pre><p id="f38b" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated"><code class="fe pa pb pc oq b">-q default</code>标志告诉提督使用默认的工作队列。</p><p id="3b64" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">启动代理后，流程运行将被代理拾取，并在完成后标记为<code class="fe pa pb pc oq b">Completed</code>。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi pp"><img src="../Images/5921b3f39f5d7612c780921676643406.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k62xZCPvD-hBZ5vZ5OYOLA.png"/></div></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">作者图片</p></figure><p id="5f8c" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">通过单击“参数”选项卡，您可以查看用于该特定运行的参数值。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi pq"><img src="../Images/54601b22a0d51f751bb4a22145ab9d54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HSmGle5FpcZ_i3NpwrOquw.png"/></div></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">作者图片</p></figure><h1 id="46d5" class="nx kj it bd kk ny nz oa kn ob oc od kq jz oe ka ku kc of kd ky kf og kg lc oh bi translated">用 Pydantic 验证参数</h1><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="lj lk l"/></div></figure><h2 id="9960" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">在运行流程之前验证参数</h2><p id="2c35" class="pw-post-body-paragraph ll lm it ln b lo oi ju lq lr oj jx lt kr ok lv lw kv ol ly lz kz om mb mc md im bi translated"><a class="ae on" href="https://docs.pydantic.dev/" rel="noopener ugc nofollow" target="_blank"> Pydantic </a>是一个 Python 库，通过利用类型注释进行数据验证。</p><p id="2cf5" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">默认情况下，Prefect 使用 Pydantic 来强制流参数的数据类型，并在执行流运行之前验证它们的值。因此，带有类型提示的流参数被自动强制转换为正确的对象类型。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ne"><img src="../Images/c6eaa2dd2cdae463ff965a2ae37b4f85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VPBzAAPWxmLq5KOkpb-3Mw.png"/></div></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">作者图片</p></figure><p id="a108" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">在下面的代码中，类型注释指定<code class="fe pa pb pc oq b">test_size</code>是一个浮动对象。因此，Prefect 将字符串输入强制转换成一个 float 对象。</p><pre class="le lf lg lh gt op oq or bn os ot bi"><span id="f26b" class="ou kj it oq b be ov ow l ox oy">@flow<br/>def process(<br/>    raw_location: str = "data/raw",<br/>    process_location: str = "data/processed",<br/>    raw_file: str = "iris.csv",<br/>    label: str = "Species",<br/>    test_size: float = 0.3,<br/>    columns_to_drop: List[str] = ["Id"],<br/>):<br/>    ...<br/><br/>if __name__ == "__main__":<br/>    process(test_size='0.4') # "0.4" is coerced into type float</span></pre><h2 id="697b" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">使用 Pydantic 模型分组参数</h2><p id="0238" class="pw-post-body-paragraph ll lm it ln b lo oi ju lq lr oj jx lt kr ok lv lw kv ol ly lz kz om mb mc md im bi translated">还可以使用 Pydantic 将参数组织成逻辑组。</p><p id="e4a5" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">例如，您可以:</p><ul class=""><li id="723c" class="mq mr it ln b lo lp lr ls kr ms kv mt kz mu md mv mw mx my bi translated">将指定位置的参数分组到<code class="fe pa pb pc oq b">data_location</code>组。</li><li id="808b" class="mq mr it ln b lo mz lr na kr nb kv nc kz nd md mv mw mx my bi translated">将处理数据的参数归入<code class="fe pa pb pc oq b">process_config</code>组。</li></ul><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi pr"><img src="../Images/1eb3ece197ba4f39b0e9a2d26e3631a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PqPP_KmVm90GJf5okQBKSQ.png"/></div></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">作者图片</p></figure><p id="0559" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">要完成这种很好的参数分组，只需使用 Pydantic 模型。</p><p id="0ddf" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">模型只是继承自<code class="fe pa pb pc oq b">pydantic.BaseModel</code>的类。每个模型代表一组参数。</p><pre class="le lf lg lh gt op oq or bn os ot bi"><span id="e70c" class="ou kj it oq b be ov ow l ox oy">from pydantic import BaseModel<br/><br/><br/>class DataLocation(BaseModel):<br/>    raw_location: Literal["data/raw", "data/processed"] = "data/raw"<br/>    raw_file: str = "iris.csv"<br/>    process_location: Literal["data/raw", "data/processed"] = "data/processed"<br/><br/><br/>class ProcessConfig(BaseModel):<br/>    drop_columns: List[str] = ["Id"]<br/>    label: str = "Species"<br/>    test_size: float = 0.3<br/></span></pre><p id="2f4e" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">接下来，让我们使用模型作为流参数的类型提示:</p><pre class="le lf lg lh gt op oq or bn os ot bi"><span id="85f1" class="ou kj it oq b be ov ow l ox oy">@flow<br/>def process(<br/>    data_location: DataLocation = DataLocation(),<br/>    process_config: ProcessConfig = ProcessConfig(),<br/>):<br/>    ...</span></pre><p id="3599" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">要访问模型的字段，只需使用<code class="fe pa pb pc oq b">model.field</code>属性。例如，要访问<code class="fe pa pb pc oq b">DataLocation</code>模型中的<code class="fe pa pb pc oq b">raw_location</code>字段，请使用:</p><pre class="le lf lg lh gt op oq or bn os ot bi"><span id="0c22" class="ou kj it oq b be ov ow l ox oy">data_location = DataLocation()<br/>data_location.raw_location</span></pre><blockquote class="pd pe pf"><p id="6529" class="ll lm oz ln b lo lp ju lq lr ls jx lt pg lu lv lw ph lx ly lz pi ma mb mc md im bi translated">你可以在这里了解更多关于 Pydantic 模型<a class="ae on" href="https://docs.pydantic.dev/usage/models/" rel="noopener ugc nofollow" target="_blank">。</a></p></blockquote><h2 id="8763" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">创建自定义验证</h2><p id="9457" class="pw-post-body-paragraph ll lm it ln b lo oi ju lq lr oj jx lt kr ok lv lw kv ol ly lz kz om mb mc md im bi translated">Pydantic 还允许您用<code class="fe pa pb pc oq b">validator</code>装饰器创建定制的验证器。</p><p id="7062" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">让我们创建一个名为<code class="fe pa pb pc oq b">must_be_non_negative</code>的验证器，它检查<code class="fe pa pb pc oq b">test_size</code>的值是否为非负。</p><pre class="le lf lg lh gt op oq or bn os ot bi"><span id="6bbd" class="ou kj it oq b be ov ow l ox oy">from pydantic import BaseModel, validator<br/><br/>class ProcessConfig(BaseModel):<br/>    drop_columns: List[str] = ["Id"]<br/>    label: str = "Species"<br/>    test_size: float = 0.3<br/><br/>    @validator("test_size")<br/>    def must_be_non_negative(cls, v):<br/>        if v &lt; 0:<br/>            raise ValueError(f"{v} must be non-negative")<br/>        return v</span></pre><p id="e8b1" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">如果<code class="fe pa pb pc oq b">test_size</code>的值为负，Pydantic 将产生一个<code class="fe pa pb pc oq b">ValueError</code>:</p><pre class="le lf lg lh gt op oq or bn os ot bi"><span id="6af9" class="ou kj it oq b be ov ow l ox oy">pydantic.error_wrappers.ValidationError: 1 validation error for ProcessConfig<br/>test_size<br/>  -0.1 must be non-negative (type=value_error)</span></pre><blockquote class="pd pe pf"><p id="85f6" class="ll lm oz ln b lo lp ju lq lr ls jx lt pg lu lv lw ph lx ly lz pi ma mb mc md im bi translated">你可以在这里了解更多关于验证器的信息。</p></blockquote><h1 id="2f31" class="nx kj it bd kk ny nz oa kn ob oc od kq jz oe ka ku kc of kd ky kf og kg lc oh bi translated">ML 项目中 Pydantic 和 Prefect 的用例</h1><p id="ca4d" class="pw-post-body-paragraph ll lm it ln b lo oi ju lq lr oj jx lt kr ok lv lw kv ol ly lz kz om mb mc md im bi translated">机器学习项目需要数据科学家经常调整 ML 模型的参数，以获得良好的性能。</p><p id="9b79" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">使用 Pydantic 和 Prefect，您可以在 UI 上为每个参数选择一组值，然后在 GridSearch 中使用这些值。</p><pre class="le lf lg lh gt op oq or bn os ot bi"><span id="ba31" class="ou kj it oq b be ov ow l ox oy"># train.py<br/><br/>class DataLocation(BaseModel):<br/>    raw_location: Literal["data/raw", "data/processed"] = "data/raw"<br/>    raw_file: str = "iris.csv"<br/>    process_location: Literal["data/raw", "data/processed"] = "data/processed"<br/><br/>class SVC_Params(BaseModel):<br/>    C: List[float] = [0.1, 1, 10, 100, 1000]<br/>    gamma: List[float] = [1, 0.1, 0.01, 0.001, 0.0001]<br/><br/>    @validator("*", each_item=True)<br/>    def must_be_non_negative(cls, v):<br/>        if v &lt; 0:<br/>            raise ValueError(f"{v} must be non-negative")<br/>        return v<br/><br/>@flow<br/>def train_model(model_params: SVC_Params = SVC_Params(), X_train, y_train):<br/>    grid = GridSearchCV(SVC(), model_params.dict(), refit=True, verbose=3)<br/>    grid.fit(X_train, y_train)<br/>    return grid</span></pre><blockquote class="pd pe pf"><p id="58dd" class="ll lm oz ln b lo lp ju lq lr ls jx lt pg lu lv lw ph lx ly lz pi ma mb mc md im bi translated"><a class="ae on" href="https://github.com/khuyentran1401/iris-prefect/blob/master/src/train_model.py" rel="noopener ugc nofollow" target="_blank">查看完整脚本。</a></p></blockquote><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/a0fdf955fabc98036b37bccf02678c89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/1*RSxHOAR6P4FyCKvu1atm6Q.gif"/></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">作者图片</p></figure><h1 id="8f87" class="nx kj it bd kk ny nz oa kn ob oc od kq jz oe ka ku kc of kd ky kf og kg lc oh bi translated">结论</h1><p id="dc89" class="pw-post-body-paragraph ll lm it ln b lo oi ju lq lr oj jx lt kr ok lv lw kv ol ly lz kz om mb mc md im bi translated">恭喜你！你刚刚学会了如何通过完美的用户界面参数化你的 ML 训练过程和特征工程。</p><p id="2022" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">调整参数值并确保它们具有正确的格式和数据类型的能力，将使您和您的队友在 ML 工作中更容易、更快速地试验不同的参数值。</p></div><div class="ab cl pt pu hx pv" role="separator"><span class="pw bw bk px py pz"/><span class="pw bw bk px py pz"/><span class="pw bw bk px py"/></div><div class="im in io ip iq"><p id="8e6b" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">我喜欢写关于数据科学概念的文章，喜欢玩不同的数据科学工具。你可以在 LinkedIn 和 T2 Twitter 上与我联系。</p><p id="1a5e" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt kr lu lv lw kv lx ly lz kz ma mb mc md im bi translated">星<a class="ae on" href="https://github.com/khuyentran1401/Data-science" rel="noopener ugc nofollow" target="_blank">这个回购</a>如果你想检查我写的文章的代码。在 Medium 上关注我，了解我的最新数据科学文章:</p><div class="nf ng gp gr nh ni"><a rel="noopener follow" target="_blank" href="/validate-your-pandas-dataframe-with-pandera-2995910e564"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">用 Pandera 验证你的熊猫数据框架</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">确保您的数据符合您的期望</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">towardsdatascience.com</p></div></div><div class="nr l"><div class="qa l nt nu nv nr nw mj ni"/></div></div></a></div><div class="nf ng gp gr nh ni"><a rel="noopener follow" target="_blank" href="/create-observable-and-reproducible-notebooks-with-hex-460e75818a09"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">使用 Hex 创建可观察和可复制的笔记本</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">如何将笔记本电脑集成到您的数据管道中</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">towardsdatascience.com</p></div></div><div class="nr l"><div class="qb l nt nu nv nr nw mj ni"/></div></div></a></div><div class="nf ng gp gr nh ni"><a rel="noopener follow" target="_blank" href="/dvc-github-actions-automatically-rerun-modified-components-of-a-pipeline-a3632519dc42"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">DVC + GitHub 动作:自动重新运行修改过的管道组件</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">快速迭代 DS 项目的完美组合</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">towardsdatascience.com</p></div></div><div class="nr l"><div class="qc l nt nu nv nr nw mj ni"/></div></div></a></div><div class="nf ng gp gr nh ni"><a rel="noopener follow" target="_blank" href="/4-pre-commit-plugins-to-automate-code-reviewing-and-formatting-in-python-c80c6d2e9f5"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">4 个预提交插件，用于在 Python 中自动检查和格式化代码</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">使用 black、flake8、isort 和 interrogate 编写高质量的代码</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">towardsdatascience.com</p></div></div><div class="nr l"><div class="qd l nt nu nv nr nw mj ni"/></div></div></a></div></div></div>    
</body>
</html>