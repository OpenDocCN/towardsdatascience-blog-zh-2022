<html>
<head>
<title>Can ML predict where my cat is now?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ML能预测我的猫现在在哪吗？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/can-ml-predict-where-my-cat-is-now-part-2-7efaec267339#2022-07-02">https://towardsdatascience.com/can-ml-predict-where-my-cat-is-now-part-2-7efaec267339#2022-07-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="05e0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">利用过去行为和天气观测的猫预测模型</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/001cf1d477f831f8e7b88387cbfc7521.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M8jgv4B7OUH0ij-gmxqKdw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">温贝托·阿雷利亚诺在<a class="ae kv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><blockquote class="kw kx ky"><p id="82f9" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">通过捕获几个月的历史位置和温度数据，这篇博客介绍了如何训练机器学习(ML)模型来预测我的猫一天中会去哪里。</p><p id="4212" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">对于不耐烦的人，你可以直接跳到预测网站<a class="ae kv" href="https://cat-predict-app.herokuapp.com" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></blockquote><h1 id="9c7f" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">猫过去的行为能预测未来的睡觉地点吗？</h1><p id="2ac0" class="pw-post-body-paragraph kz la iq lc b ld mo jr lf lg mp ju li mq mr ll lm ms mt lp lq mu mv lt lu lv ij bi translated">利用一些廉价的硬件(以及一只对数据隐私问题矛盾的猫)，我想看看我是否可以训练一个机器学习(ML)模型来预测这只猫Snowy一天中会去哪里。</p><p id="67e6" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mq lk ll lm ms lo lp lq mu ls lt lu lv ij bi translated">基于家庭的位置和温度跟踪允许我建立一个她最喜欢的睡觉地点的房间的广泛历史。我有一个理论，通过从她的过去收集足够的数据，我能够训练一个ML模型来预测她未来可能去哪里。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/0b2ccd9232958200bb054add9a3883a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*pcBZHKQDm-IwLH-w"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用Streamlit web应用程序预测猫的位置(图片由作者提供)</p></figure><h1 id="2a91" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">用于房间级cat跟踪的硬件</h1><p id="2843" class="pw-post-body-paragraph kz la iq lc b ld mo jr lf lg mp ju li mq mr ll lm ms mt lp lq mu mv lt lu lv ij bi translated">第一项任务是收集大量关于Snowy历史上在哪里度过的数据，以及温度和降雨量等环境因素。我设定了一个任意的目标，收集三个月来在房子里和房子周围活动的每小时更新。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/bae5bd951a066b346141f5a4ab359d75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/0*E-QJe1SfpuWuFoJr.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">用房间信标定位猫(图片由作者提供)</p></figure><p id="2bf4" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mq lk ll lm ms lo lp lq mu ls lt lu lv ij bi translated">猫不擅长数据输入；所以我需要一种自动的方法来收集她的位置。我让白雪戴上一个小的电池供电的蓝牙追踪器。她衣领上的这个装置只是发射一个常规的独特的蓝牙低能量(<a class="ae kv" href="https://en.wikipedia.org/wiki/Bluetooth_Low_Energy" rel="noopener ugc nofollow" target="_blank"> BLE </a>)信号。然后我用八个固定的接收器来监听这个BLE信号。这些接收器节点是基于<a class="ae kv" href="https://en.wikipedia.org/wiki/ESP32" rel="noopener ugc nofollow" target="_blank"> ESP32 </a>的存在检测节点，放置在房屋内和周围指定的房间中(6个在室内，2个在室外)。</p><p id="a64c" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mq lk ll lm ms lo lp lq mu ls lt lu lv ij bi translated">每个接收节点不断寻找唯一的BLE信号，并测量接收信号强度指标(<a class="ae kv" href="https://en.wikipedia.org/wiki/Received_signal_strength_indication" rel="noopener ugc nofollow" target="_blank"> RSSI </a>)。信号越强，白雪离那个信标就越近(要么是这样，要么是她在摆弄电池)。例如，如果我在研究传感器旁边收到几秒钟的强信号，我可以假设白雪可能非常接近那个房间。</p><p id="7d79" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mq lk ll lm ms lo lp lq mu ls lt lu lv ij bi translated">最终我收集了三个月的位置观测，超过<strong class="lc ir">1200万</strong>的位置、温度、湿度和降雨量观测(我<em class="lb">可能</em>已经超过了数据收集的上限)。</p><p id="0fde" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mq lk ll lm ms lo lp lq mu ls lt lu lv ij bi translated">我一直试图回答的问题是，我能利用这些历史观察建立一个她可能去哪里的预测模型吗？我能有多大信心用一台机器来预测一只猫可能在哪里，来预测白雪的藏身之处？</p><h1 id="2504" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">ML训练营</h1><p id="241d" class="pw-post-body-paragraph kz la iq lc b ld mo jr lf lg mp ju li mq mr ll lm ms mt lp lq mu mv lt lu lv ij bi translated">监督学习是基于示例输入-输出对创建将输入映射到输出的函数的ML任务。在我的例子中，我想对猫的位置、温度、一天中的时间等进行历史观察。，作为输入和查找模式…预测未来猫位置的函数(推理)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/fa77a19b243bde6f59d5c6bcf93dccfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NncPI9cL6dCDozOgXEdZ3g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">温度、时间和日期——它能映射到位置吗？(图片由作者提供)</p></figure><p id="1e26" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mq lk ll lm ms lo lp lq mu ls lt lu lv ij bi translated">我的假设是这个问题可以从这些数据中归纳出来；例如，未来的数据将遵循过去猫行为的一些常见模式(对于猫来说，这种假设可能是有问题的)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/c1dcce1aede51a458cc7e81f0691ab99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vBucY3DB1DfM_UJqEeZ7ug.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">猫咪位置预测(图片由作者提供)</p></figure><p id="bfa2" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mq lk ll lm ms lo lp lq mu ls lt lu lv ij bi translated">该训练使用过去的信息来建立一个模型，该模型是可部署的人工制品。一旦训练了候选模型，就可以测试它的预测准确性并最终部署它。在我的例子中，我希望创建一个web应用程序来预测Snowy可能在哪里打盹。</p><p id="429b" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mq lk ll lm ms lo lp lq mu ls lt lu lv ij bi translated">同样重要的是，该模型不必明确输出绝对位置，但可以根据置信度给出答案。如果它输出P(位置:研究)接近1.0，则它是有信心的，但是接近0.5的值表示对预测Snowy的位置的信心“不确定”。</p><h1 id="4f2d" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">使用dbt汇总数据</h1><p id="2ce1" class="pw-post-body-paragraph kz la iq lc b ld mo jr lf lg mp ju li mq mr ll lm ms mt lp lq mu mv lt lu lv ij bi translated">我的数据平台<a class="ae kv" href="https://www.home-assistant.io/" rel="noopener ugc nofollow" target="_blank">家庭助手</a>将每个传感器更新存储在<a class="ae kv" href="https://www.home-assistant.io/docs/backend/database/" rel="noopener ugc nofollow" target="_blank">状态</a>表中。这<em class="lb">真的是</em>细粒度的，每隔几秒就有来自所有传感器的更新(在我的例子中，每天大约有18，000个传感器更新)。为了简化模型训练，我想把数据总结成每小时更新的数据——基本上是一个单一的(最普遍的)位置，以及温度和湿度读数。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/7ffb5bcbf5c17a7cf4760db708c95384.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lrglkFoIFjc3B9dmB5QMNA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">将大量数据汇总成每小时的摘要(图片由作者提供)</p></figure><p id="1018" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mq lk ll lm ms lo lp lq mu ls lt lu lv ij bi translated">最初，我用一堆SQL语句(如<a class="ae kv" href="https://github.com/saubury/cat-predictor/blob/master/sql/extract.sql" rel="noopener ugc nofollow" target="_blank"> this </a>)手动运行数据处理来处理数据。然而，我发现这相当麻烦，因为我想在新的位置和环境条件下重新训练模型。我决定使用可靠的数据工程工具<a class="ae kv" href="https://www.getdbt.com/" rel="noopener ugc nofollow" target="_blank"> dbt </a>来简化数据库中SQL转换的创建，以使再培训更加有效。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/ade92c651da525d4791c29181dbe5bb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_f7RFFdXwyGWcSVTvnKwtg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示数据转换的dbt谱系图(图片由作者提供)</p></figure><p id="168e" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mq lk ll lm ms lo lp lq mu ls lt lu lv ij bi translated">dbt负责将这些my select语句转换成表和视图，在我的postgres数据仓库中执行数据转换。</p><h1 id="3636" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">模型训练和评估</h1><p id="d6d8" class="pw-post-body-paragraph kz la iq lc b ld mo jr lf lg mp ju li mq mr ll lm ms mt lp lq mu mv lt lu lv ij bi translated">一旦我清理了我的数据，我就使用Scikit-learn随机<a class="ae kv" href="https://www.datacamp.com/tutorial/random-forests-classifier-python" rel="noopener ugc nofollow" target="_blank">森林决策树</a>分类作为我的预测模型。<a class="ae kv" href="https://en.wikipedia.org/wiki/Random_forest" rel="noopener ugc nofollow" target="_blank">随机森林</a>根据训练数据创建决策树。对于Snowy来说，这意味着位置预测是从投票的多次随机迭代中得出的分类——选择投票最多的结果位置。</p><p id="5f89" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mq lk ll lm ms lo lp lq mu ls lt lu lv ij bi translated">如果你看一下<a class="ae kv" href="https://github.com/saubury/cat-predict/blob/master/notebooks/cat_predictor_app.ipynb" rel="noopener ugc nofollow" target="_blank"> python笔记本</a>，你可以看到为输入分配一个类标签所采取的步骤，这些步骤基于许多例子，这些例子是从过去对一天中的时间、温度和位置的数千次观察中训练出来的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/d0bdcb0858266c4bf07d603caf6a85bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_YIXxul5hKvKUBF8AO2ovA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">用于可视化要素重要性的Python代码段(图片由作者提供)</p></figure><p id="4e9d" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mq lk ll lm ms lo lp lq mu ls lt lu lv ij bi translated">关于Scikit-learn决策树模型的一个真正酷的事情是可视化正在发生的事情是多么容易。通过可视化模型特征(如上),我可以看到“一天中的一小时”是模型中最重要的特征。</p><p id="76c9" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mq lk ll lm ms lo lp lq mu ls lt lu lv ij bi translated">直觉上这是有道理的——一天中的时间可能对下雪的地方有最大的影响。预测白雪位置的第二个最重要的特征是室外气温。这也是有道理的——如果她想出去，太热或太冷都有可能改变。我发现令人惊讶的是<em class="lb">最不重要的</em>特性是<em class="lb">正在训练</em>特性。一种可能的解释是，该功能仅在白天有意义，当白雪晚上在室内睡觉时，下雨不会对模型产生影响。</p><p id="8710" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mq lk ll lm ms lo lp lq mu ls lt lu lv ij bi translated">还可以使用Scikit-Learn从Python中的随机森林中可视化出一棵决策树。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/792418cd7e57bdd558e1515edd47489c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7KkpmxEWN0GW1sKkV86YtQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示小时和日期决策点的可视化决策树(图片由作者提供)</p></figure><p id="8e6e" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mq lk ll lm ms lo lp lq mu ls lt lu lv ij bi translated">在我的显示树中，我可以看到一天中的某个小时是预测中的初始决策点，上午7:00是算法中有趣的部分。这是我们家闹钟响起的时间——猫被激励起来寻找食物。该树的另一个有趣部分是“一周中的某一天≤ 5.5”。这相当于一周中的某一天是周一到周五——同样，算法的这一部分是有意义的，因为我们(和猫)通常在周末会起得晚一点</p><h1 id="0393" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">Streamlit中的cat predictor网络应用程序</h1><p id="0c10" class="pw-post-body-paragraph kz la iq lc b ld mo jr lf lg mp ju li mq mr ll lm ms mt lp lq mu mv lt lu lv ij bi translated">有了创建的模型，我现在想要构建一个web应用程序来基于一系列输入预测Snowy的位置。<a class="ae kv" href="https://docs.streamlit.io/" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>是一个开源的Python库，它使得创建web应用程序变得很容易(无需我学习一堆前端框架)。我为特征值添加了滑块和选择框，比如日期和温度。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/c0815b3150e6f6feac8cbb5d060b568e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q6taGyYXoITfcBE6qldU0Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Web应用程序—输入为滑块控件(图片由作者提供)</p></figure><p id="db86" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mq lk ll lm ms lo lp lq mu ls lt lu lv ij bi translated">瞧——我用更多的<a class="ae kv" href="https://github.com/saubury/cat-predict-app/blob/master/cat_predictor_app.py" rel="noopener ugc nofollow" target="_blank"> python代码</a>创建了一个猫预测应用程序；预测雪猫可能位置的网络应用。我找到了一些优秀的指令来将我的Streamlit应用程序部署到Heroku。</p><p id="07ad" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li mq lk ll lm ms lo lp lq mu ls lt lu lv ij bi translated">那么，ML能预测我的猫现在在哪里吗？没错——而且惊人的准确。白雪在花园里愉快地睡着了，正如预测应用程序<a class="ae kv" href="https://cat-predict-app.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">所预测的那样。</a></p><h1 id="8c04" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">代码链接</h1><p id="64b2" class="pw-post-body-paragraph kz la iq lc b ld mo jr lf lg mp ju li mq mr ll lm ms mt lp lq mu mv lt lu lv ij bi translated">希望你发现这个博客和代码对你所有的宠物位置预测需求有所帮助</p><ul class=""><li id="0e25" class="nf ng iq lc b ld le lg lh mq nh ms ni mu nj lv nk nl nm nn bi translated">数据平台和ML预测:<a class="ae kv" href="https://github.com/saubury/cat-predict" rel="noopener ugc nofollow" target="_blank">https://github.com/saubury/cat-predict</a></li><li id="1fdd" class="nf ng iq lc b ld no lg np mq nq ms nr mu ns lv nk nl nm nn bi translated">Streamlit应用:<a class="ae kv" href="https://github.com/saubury/cat-predict-app" rel="noopener ugc nofollow" target="_blank">https://github.com/saubury/cat-predict-app</a></li></ul></div></div>    
</body>
</html>