<html>
<head>
<title>Experiments on Returns on Investment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">投资回报实验</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/experiments-on-returns-on-investment-34a1953c5f16#2022-12-29">https://towardsdatascience.com/experiments-on-returns-on-investment-34a1953c5f16#2022-12-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="6ecf" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/causal-data-science" rel="noopener" target="_blank">因果数据科学</a></h2><div class=""/><div class=""><h2 id="8ae3" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated"><em class="ko">比率度量推断的 delta 方法介绍。</em></h2></div><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/ed1a62767627b48e81c06194fc06ae5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pvB73PeFwaJJcdEwyjbJpQ.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">封面图片，由作者使用<a class="ae lf" href="https://creator.nightcafe.studio/" rel="noopener ugc nofollow" target="_blank">nightcafe</a>生成</p></figure><p id="9334" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">当我们进行一项实验时，我们通常不仅对一项治疗(新产品、新功能、新界面……)对收入的影响感兴趣，还对其成本效益感兴趣。换句话说，投资是否值得？常见的例子包括计算资源投资、广告回报、点击率和其他比率指标。</p><p id="8c6f" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">当我们调查因果关系时，金标准是<a class="ae lf" href="https://en.wikipedia.org/wiki/Randomized_experiment" rel="noopener ugc nofollow" target="_blank">随机对照试验</a>，也就是<strong class="li ja"> AB 测试</strong>。将治疗随机分配给人群的一个子集(用户、患者、顾客等)，我们确保平均而言，结果的差异可以归因于治疗。然而，当感兴趣的目标是成本效益时，AB 测试提出了一些额外的问题，因为我们不仅对一种治疗效果感兴趣，而且对两种治疗效果的<strong class="li ja">比率</strong>感兴趣，即投资的结果超过其成本。</p><p id="b1ca" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">在本帖中，我们将看到当感兴趣的对象是<strong class="li ja">投资回报率(ROI) </strong>时，如何分析随机实验。我们将探索衡量投资是否有回报的替代指标。我们还将介绍一个非常强大的复杂度量推断工具:delta 方法。虽然代数可能很密集，但结果很简单:我们可以使用简单的线性回归来计算比率估计量的置信区间。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="fbe7" class="mj mk iq bd ml mm mn mo mp mq mr ms mt kf mu kg mv ki mw kj mx kl my km mz na bi translated">投资云计算</h1><p id="6645" class="pw-post-body-paragraph lg lh iq li b lj nb ka ll lm nc kd lo lp nd lr ls lt ne lv lw lx nf lz ma mb ij bi translated">为了更好地说明这些概念，我们将在整篇文章中使用一个玩具示例:假设我们是一个在线市场，我们想要投资云计算，我们想要通过切换到一个更高层的服务器来提高我们内部搜索引擎的计算能力。这个想法是，更快的搜索将改善用户体验，潜在地导致更高的销售额。所以，问题是:投资值不值这个成本？感兴趣的对象是<strong class="li ja">投资回报率</strong>。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="ab gu cl ng"><img src="../Images/e6f013f0628985a1446511efc0baddb6.png" data-original-src="https://miro.medium.com/v2/format:webp/1*C7YBqny7cnlln0G5V9WQIA.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">作者使用<a class="ae lf" href="https://creator.nightcafe.studio/" rel="noopener ugc nofollow" target="_blank">nightcafe</a>生成的图像</p></figure><p id="337c" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">与通常的 AB 测试或随机实验不同，我们对单一的因果影响不感兴趣，而是对两个指标的<strong class="li ja">比率</strong>感兴趣:对收入的影响和对成本的影响。我们仍将使用<strong class="li ja">随机对照试验</strong>或<strong class="li ja"> AB 测试</strong>来估算投资回报率:我们将用户随机分配到治疗组或对照组。接受治疗的用户将受益于更快的云机器，而控制用户将使用旧的较慢的机器。随机化确保我们可以通过比较治疗组和对照组中的用户来估计新机器对成本或收入的影响:平均值的<strong class="li ja">差异</strong>是平均治疗效果的无偏估计值。然而，事情因为它们的比例而变得更加复杂。</p><p id="8367" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我从<code class="fe nh ni nj nk b"><a class="ae lf" href="https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/src/dgp.py" rel="noopener ugc nofollow" target="_blank">src.dgp</a></code>导入数据生成过程<code class="fe nh ni nj nk b">dgp_cloud()</code>。关于以前的文章，我生成了一个新的 DGP 父类，它处理随机化和数据生成，而它的子类包含特定的用例。我也从<code class="fe nh ni nj nk b"><a class="ae lf" href="https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/src/utils.py" rel="noopener ugc nofollow" target="_blank">src.utils</a></code>导入绘图函数和库。为了不仅包括代码，还包括数据和表格，我使用了<a class="ae lf" href="https://deepnote.com" rel="noopener ugc nofollow" target="_blank"> Deepnote </a>，一个类似 Jupyter 的基于网络的协作笔记本环境。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="d5c9" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">该数据包含一个月内一组 10.000 个用户的总数<code class="fe nh ni nj nk b">cost</code>和<code class="fe nh ni nj nk b">revenue</code>的信息。我们也有关于治疗的信息:搜索引擎是运行在旧的还是<code class="fe nh ni nj nk b">new machines</code>上。正如商业指标经常发生的那样，成本和收入的分布都非常不均衡(T21)。此外，大多数人不购买任何东西，因此产生零收入，即使他们仍然使用该平台，产生正成本。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="nn nm l"/></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="ab gu cl ng"><img src="../Images/6624663de694d9790670d0949c0c719e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*uJ4sq-zPdADX1KnItvTnfw.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">成本和收入分布，按作者分类的图像</p></figure><p id="b52d" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们可以通过回归治疗指标的结果来计算<code class="fe nh ni nj nk b">cost</code>和<code class="fe nh ni nj nk b">revenue</code>的<strong class="li ja">均值差</strong>估计值。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="no nm l"/></div></figure><p id="521e" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">平均每个用户增加了 0.5152 美元。营收呢？</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="no nm l"/></div></figure><p id="b5e2" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">每个用户的平均<code class="fe nh ni nj nk b">revenue</code>也增加了 1.0664 美元。那么，这笔投资<strong class="li ja">盈利了吗</strong>？</p><p id="a5e5" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">要回答这个问题，我们首先必须决定使用哪个指标作为我们的<strong class="li ja">结果指标</strong>。在比率度量的情况下，这不是微不足道的。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="224c" class="mj mk iq bd ml mm mn mo mp mq mr ms mt kf mu kg mv ki mw kj mx kl my km mz na bi translated">平均回报还是平均回报？</h1><p id="61e7" class="pw-post-body-paragraph lg lh iq li b lj nb ka ll lm nc kd lo lp nd lr ls lt ne lv lw lx nf lz ma mb ij bi translated">这是一个非常诱人的解决问题的方法:的确，我们有两个变量，所以我们可以计算它们的比率，然后像往常一样，使用一个<strong class="li ja">单变量</strong>:个人水平回报来分析一切。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi np"><img src="../Images/e58993c3dc8effba0baf82a75be18a89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CckGBl08CIcZCtj8Qyf6qQ.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">个人回报，作者图片</p></figure><p id="4bb5" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">如果我们使用这个单一的度量来分析实验，会发生什么？</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="nq nm l"/></div></figure><p id="cd66" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">估计效果为<strong class="li ja">负且显著</strong>，-0.7392！新机器似乎不是一项好的投资，回报率下降了 74%。</p><p id="5164" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">这个结果似乎与我们先前的估计相矛盾。我们之前已经看到，收入的平均增长超过了成本(1.0664 美元对 0.5152 美元)。为什么会这样呢？问题是我们给重度用户和轻度用户的权重是一样的。让我们用一个简单的有两个用户的<strong class="li ja">例子</strong>。第一个(蓝色)是轻度用户，以前花费 1 美元并返回 10 美元，而现在花费 4 美元并返回 20 美元。另一个用户(violet)是一个重度用户，以前花费 10 美元并返回 100 美元，现在花费 20 美元并返回 220 美元。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="ab gu cl ng"><img src="../Images/9170f011c58010db7324cd7d5eb9b681.png" data-original-src="https://miro.medium.com/v2/format:webp/1*TMMFLt30KIrFFOmV57BmbQ.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">高使用率和低使用率用户示例，按作者排序</p></figure><p id="703f" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">平均回报率为-3 倍:平均每个用户的回报率下降了 300%。然而，每个用户的总回报是 1000%:13 美元的成本增加产生了 130 美元的收入！结果大相径庭，完全由两个用户的<strong class="li ja">权重</strong>决定:重度用户的影响在<strong class="li ja">相对</strong>方面较低，但在<strong class="li ja">绝对</strong>方面较高，而轻度用户则相反。因此，平均相对效果主要由轻度用户驱动，而相对平均效果主要由重度用户驱动。</p><p id="f7e6" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated"><strong class="li ja">哪个指标</strong>与我们的设置更相关？当谈到投资回报时，我们通常感兴趣的是了解我们所花的钱是否得到了回报。所以<strong class="li ja">总收益</strong>比平均收益更有意思。</p><p id="433c" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">从现在开始，感兴趣的对象将是<strong class="li ja">投资回报率(ROI) </strong>，由预期收入增长超过预期成本增长给出，我们将用希腊字母 rho，<em class="nr"> ρ </em>表示。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ns"><img src="../Images/6c11d6f7203c28474077cbf605cb4c2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uYZwpuKUvDgJI3nIrTUnMQ.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">投资回报，作者图片</p></figure><p id="06c5" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们可以<strong class="li ja">估计</strong>ROI 为之前两次估计的比率:治疗组和对照组之间的平均收入差异，与治疗组和对照组之间的平均成本差异(差异用希腊字母 delta 表示)。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nt"><img src="../Images/0d25e73e722f73a7660e2870c81cc572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-KDvpI35cTdgpXfyE-alFw.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">投资回报的估算者，图片由作者提供</p></figure><p id="f713" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">请注意与前面的公式有一个微妙但至关重要的<strong class="li ja">差异</strong>:我们用经验期望运算符𝔼ₙ替换了<a class="ae lf" href="https://en.wikipedia.org/wiki/Expected_value" rel="noopener ugc nofollow" target="_blank">期望值</a> 𝔼，也称为<a class="ae lf" href="https://en.wikipedia.org/wiki/Arithmetic_mean" rel="noopener ugc nofollow" target="_blank">样本平均值</a>。符号上的差异很小，但概念上的差异是巨大的。第一个，𝔼，是一个理论上的概念，而第二个，𝔼ₙ，是经验上的:它是一个依赖于实际数据的数字。我个人喜欢这个符号，因为它强调了两个概念之间的紧密联系(第二个概念是第一个概念的经验对应)，同时也清楚地表明第二个概念取决于样本大小<em class="nr"> n </em>。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="nu nm l"/></div></figure><p id="99c2" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">估计值为 2.0698:在新机器上每多花 1 美元，收入就多 2.0698 美元。听起来很棒！</p><p id="58f7" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">但是我们应该在多大程度上相信这个数字呢？是和一个显著不同，还是只是被噪音驱动？</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="f194" class="mj mk iq bd ml mm mn mo mp mq mr ms mt kf mu kg mv ki mw kj mx kl my km mz na bi translated">推理</h1><p id="7838" class="pw-post-body-paragraph lg lh iq li b lj nb ka ll lm nc kd lo lp nd lr ls lt ne lv lw lx nf lz ma mb ij bi translated">为了回答这个问题，我们想计算一个<a class="ae lf" href="https://en.wikipedia.org/wiki/Confidence_interval" rel="noopener ugc nofollow" target="_blank"> <strong class="li ja">置信区间</strong> </a>来进行我们的估计。我们如何计算比率度量的置信区间？第一步是计算估计量的标准差。一种始终可用的方法是<a class="ae lf" href="https://en.wikipedia.org/wiki/Bootstrapping_(statistics)" rel="noopener ugc nofollow" target="_blank"> <strong class="li ja"> bootstrap </strong> </a>:通过多次替换对数据进行重新采样，并使用样本上估计值的分布来计算估计值的标准偏差。</p><p id="89ed" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">让我们在自己的案例中尝试一下。我计算了 10.000 个引导样本的标准偏差，使用带有选项<code class="fe nh ni nj nk b">frac=1</code>的函数<code class="fe nh ni nj nk b">pd.DataFrame().sample()</code>获得相同大小的数据集，并使用选项<code class="fe nh ni nj nk b">replace=True</code>进行替换采样。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="nv nm l"/></div></figure><p id="9aa0" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">标准差的 bootstrap 估计等于 0.979。有多好？</p><p id="e0c1" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">由于我们完全控制数据生成过程，我们可以模拟估计量的“真实”分布。我们对 10.000 次模拟进行此操作，然后计算估计量的标准偏差。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="nw nm l"/></div></figure><p id="d6c0" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">使用“真实”数据生成过程的估计量的估计方差略高，但非常相似，约为 1.055。</p><p id="9ea7" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">bootstrap 的问题是它的计算量非常大，因为它需要重复估计过程数千次。我们现在要探索另一个<em class="nr">极其</em>强大的替代方案，它只需要一个估计步骤，即<a class="ae lf" href="https://en.wikipedia.org/wiki/Delta_method" rel="noopener ugc nofollow" target="_blank"> <strong class="li ja">增量法</strong> </a>。delta 方法通常允许我们对随机变量的函数进行推断，因此它的应用比比率更广泛。</p><p id="0197" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">⚠️ <strong class="li ja">警告</strong>:下一部分将会是代数密集型的。如果你愿意，你可以跳过它，直接进入最后一节。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="0ac1" class="mj mk iq bd ml mm mn mo mp mq mr ms mt kf mu kg mv ki mw kj mx kl my km mz na bi translated">德尔塔法</h1><p id="5d1e" class="pw-post-body-paragraph lg lh iq li b lj nb ka ll lm nc kd lo lp nd lr ls lt ne lv lw lx nf lz ma mb ij bi translated">什么是<strong class="li ja"> delta 法</strong>？简而言之，对于随机变量函数来说，这是一个非常强大的<strong class="li ja">渐近推断</strong>方法，它利用了泰勒展开式。简而言之，德尔塔法需要四个要素</p><ul class=""><li id="f63a" class="nx ny iq li b lj lk lm ln lp nz lt oa lx ob mb oc od oe of bi translated">一个或多个<a class="ae lf" href="https://en.wikipedia.org/wiki/Random_variable" rel="noopener ugc nofollow" target="_blank">随机变量</a></li><li id="ce1e" class="nx ny iq li b lj og lm oh lp oi lt oj lx ok mb oc od oe of bi translated">函数(一元或多元，一元或多维)</li><li id="1cbe" class="nx ny iq li b lj og lm oh lp oi lt oj lx ok mb oc od oe of bi translated"><a class="ae lf" href="https://en.wikipedia.org/wiki/Central_limit_theorem" rel="noopener ugc nofollow" target="_blank">中心极限定理</a></li><li id="0785" class="nx ny iq li b lj og lm oh lp oi lt oj lx ok mb oc od oe of bi translated"><a class="ae lf" href="https://en.wikipedia.org/wiki/Taylor_series" rel="noopener ugc nofollow" target="_blank">泰勒展开式</a></li></ul><p id="8b24" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我将假设所有四个概念的一些基本知识。假设我们有一组满足<strong class="li ja">中心极限定理(CLT) </strong>要求的随机变量的实现 X₁、…、Xₙ:独立性，期望值同分布<em class="nr"> μ </em>，有限方差<em class="nr"> σ </em>。在这些条件下，CLT 告诉我们，样本平均𝔼ₙ[X]在分布上收敛于正态分布，或者更准确地说</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ol"><img src="../Images/9442a9ecd8aa2ee565c830545385f939.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qutdlKLQnA7FzOjtoTqk_w.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">中心极限定理，作者图片</p></figure><p id="eca5" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">等式是什么意思？它表示“归一化样本平均值，按系数√n 缩放，在分布上收敛于标准正态分布，即对于足够大的样本，它近似为高斯分布。</p><p id="f554" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">现在，假设我们对样本平均值<em class="nr"> f </em>的<strong class="li ja">函数</strong>感兴趣(𝔼ₙ[X]).注意，这不同于函数𝔼ₙ[ <em class="nr"> f </em> (X)】的样本平均值。delta 方法告诉我们样本平均值的函数在分布中收敛到什么。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi om"><img src="../Images/dbb9fd01c5b8b8535b43d47e40ad2406.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VLLCU-mVvjYMqTpPY0Hvnw.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">Delta 方法，图片由作者提供</p></figure><p id="f28f" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">其中<em class="nr">f’(μ)</em>是函数<em class="nr"> f </em>的导数，在<em class="nr"> μ </em>处计算。</p><p id="1904" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">这个公式背后的<strong class="li ja">直觉</strong>是什么？我们在方差的表达式里面有一个新的项，平方一阶导数<em class="nr">f’(μ)</em>(≠二阶导数)。如果函数的导数很低，方差就会减小，因为不同的输入会转化为相似的输出。相反，如果函数的导数很高，则分布的方差会放大，因为不同的输入会转化为更多不同的输出。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="ab gu cl ng"><img src="../Images/f8ea87d8db178115d1ac2bbc22f09f19.png" data-original-src="https://miro.medium.com/v2/format:webp/1*l8CRxnVGcdd_kZr259HjkQ.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">德尔塔法背后的直觉，作者图片</p></figure><p id="d287" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">这个结果直接来自泰勒近似的<em class="nr"> f </em> (𝔼ₙ[X]):</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi on"><img src="../Images/d6f28cc707b1c810ec8e0bd40d0a8a12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dKjJNdzXs1W4wm8NC4RMIg.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">一阶泰勒展开，作者图片</p></figure><p id="5e17" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">重要的是，渐近地，最后一项消失，线性近似完全成立！</p><p id="9f0f" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">这与<strong class="li ja">比率估算器</strong>有什么联系？为了理解这一点，我们需要更多的数学知识，从一维转换到二维。在我们的例子中，我们有两个随机变量的二元函数，δ<em class="nr">R</em>和δ<em class="nr">C</em>，它返回它们的比率。在多元函数<em class="nr"> f </em>的情况下，估计量的渐近方差由下式给出</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi oo"><img src="../Images/1daab55a2d24ecbba53c89a8d113fbfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1VjMaNzi2OHcKsln1TS1uQ.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">ROI 估计值的渐近方差，图片由作者提供</p></figure><p id="f274" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">其中，∇表示函数的<a class="ae lf" href="https://en.wikipedia.org/wiki/Gradient" rel="noopener ugc nofollow" target="_blank">梯度</a>，即方向导数的向量，σₙ是 x 的经验方差-协方差矩阵，在我们的例子中，它们对应于</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi op"><img src="../Images/5c29dd51dc940d796348ea5276370a8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JoaX5pCYnnI0VCXn9GTjWg.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">ROI 估计值的梯度，图片由作者提供</p></figure><p id="7e1a" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">和</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi oq"><img src="../Images/7a976947c3815b26cf31fa691cbd66a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Odd7La-Z_IeK1HXSNV3tKQ.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">经验方差-协方差矩阵，图片由作者提供</p></figure><p id="663c" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">，其中下标<em class="nr"> n </em>表示经验对应物，至于期望值。</p><p id="8f8a" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">将前面三个方程与一点矩阵代数结合起来，我们得到了投资回报估计量的渐近方差公式。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi or"><img src="../Images/105d4ff1385f36c50c8da57868c81b50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jmI1y62wbb2RaHDRmOyaUQ.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">ROI 估计值的渐近方差，图片由作者提供</p></figure><p id="d4d6" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">由于估计量由<em class="nr">ρ̂</em>=𝔼ₙ[δ<em class="nr">r</em>/𝔼ₙ[δ<em class="nr">c</em>给出，我们可以将渐近方差改写为</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi os"><img src="../Images/5762f3930fcfb943d3a710fea0842504.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*foiiThBQvXafrgI_ccemVQ.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">ROI 估计值的渐近方差，图片由作者提供</p></figure><p id="a30c" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">最后一个表达式非常有趣，因为它表明我们可以将估计量的渐近方差重写为新辅助变量的均值差异估计量的<strong class="li ja">方差。事实上，我们可以将上面的表达式重写为</strong></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ot"><img src="../Images/d359627ceccf81e2923e2aa6dcf69aa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*njrJSzJJDqZH1Ddts4Bhhg.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">ROI 估计值的渐近方差，图片由作者提供</p></figure><p id="c584" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">这个表达式非常有用，因为它给了我们直觉，允许我们通过<strong class="li ja">线性回归</strong>来估计估计量的标准偏差。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="6517" class="mj mk iq bd ml mm mn mo mp mq mr ms mt kf mu kg mv ki mw kj mx kl my km mz na bi translated">线性回归推断</h1><p id="cf2a" class="pw-post-body-paragraph lg lh iq li b lj nb ka ll lm nc kd lo lp nd lr ls lt ne lv lw lx nf lz ma mb ij bi translated">你跳过前一部分了吗？没问题！</p><p id="7fd6" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">经过一些代数运算后，我们得出结论，估计 ROI 估计量<em class="nr"> ρ̂ </em>的方差<strong class="li ja">等价于估计辅助变量<strong class="li ja"/><em class="nr">r̃</em>的均值差异估计量的方差</strong>，定义为</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ou"><img src="../Images/0fc13991180896204ab07a607acec93a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r5pWOwDAVdJMxZqu1sOMJg.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">辅助变量，作者图片</p></figure><p id="fff9" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">这个表达式起初可能看起来晦涩难懂，但它非常有用。事实上，它给了我们(1)对估计量方差的直观<strong class="li ja">解释</strong>和(2)估计方差的<strong class="li ja">实用</strong>方法。</p><p id="5766" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">先解读！上面的表达应该怎么读？我们可以将经验估计量的方差估计为均值差异估计量的方差，对于新变量<em class="nr"> R̃ </em>，我们可以很容易地从数据中计算出来。我们只需要获得收入<em class="nr"> R </em>，减去成本<em class="nr"> C </em>乘以估计的投资回报率<em class="nr"> ρ̂ </em>并按预期成本差|𝔼ₙ[δ<em class="nr">c</em>】将其缩减。我们可以将这个变量解释为<strong class="li ja">基准收入</strong>，即不受投资影响的收入。它与预期成本差异成比例的事实告诉我们，它的方差在总投资中是递减的:我们花得越多，我们就能越精确地估计这笔支出的回报。</p><p id="a3dc" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">现在，让我们通过<strong class="li ja">四个步骤</strong>来估计 ROI 估计量的方差。</p><ol class=""><li id="458a" class="nx ny iq li b lj lk lm ln lp nz lt oa lx ob mb ov od oe of bi translated">我们需要估计投资回报率<em class="nr"> ρ̂ </em>。</li></ol><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="nw nm l"/></div></figure><p id="3e4f" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">2.术语|𝔼ₙ[δ是治疗组和对照组之间平均费用的绝对差异。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="ow nm l"/></div></figure><p id="bd45" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">3.我们现在拥有了生成辅助变量<em class="nr"> R̃ </em>的所有要素。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="ow nm l"/></div></figure><p id="3e54" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">4.治疗-对照差异的方差δ<em class="nr">r̃</em>可以通过线性回归直接计算，如均值差异估计量的随机对照试验(见 Angrist 和 Pischke，2008)。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="no nm l"/></div></figure><p id="9f92" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">ROI 的估计标准误差为 0.917，非常接近 bootstrap 估计值 0.979 和模拟值 1.055。然而，关于引导，delta 方法允许我们在一个单一的步骤中计算它，使它明显地<strong class="li ja">更快</strong>(在我的本地机器上大约 1000 倍)。</p><p id="d8b4" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">注意，这个估计的标准差意味着 95% <strong class="li ja">的置信区间</strong>为 2.0698 +- 1.96 × 0.917，等于[-0.2735，3.8671]。这似乎是个好消息，因为置信区间不覆盖零。然而，请注意，在这种情况下，一个更有趣的<strong class="li ja">零假设</strong>是 ROI 等于 1:我们收支平衡。大于 1 的值意味着盈利，而小于 1 的值意味着亏损。在我们的案例中，我们不能拒绝新机器投资无利可图的无效假设。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="d426" class="mj mk iq bd ml mm mn mo mp mq mr ms mt kf mu kg mv ki mw kj mx kl my km mz na bi translated">结论</h1><p id="8968" class="pw-post-body-paragraph lg lh iq li b lj nb ka ll lm nc kd lo lp nd lr ls lt ne lv lw lx nf lz ma mb ij bi translated">在本文中，我们探讨了一个非常常见的因果推断问题:评估投资回报率。无论是新硬件的物理投资、虚拟成本还是广告支出，我们都有兴趣了解这种增量成本是否有回报。额外的复杂性来自于这样一个事实，我们正在研究的不是一个，而是两个相互交织的因果量。</p><p id="50b6" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们首先探索和比较不同的结果指标，以评估投资是否有回报。然后，我们引入了一个非常强大的方法来对复杂的随机变量进行推理:T2 德尔塔法。在比率的特定情况下，delta 方法为估计量的渐近方差提供了一种非常有见地和实用的函数形式，可以通过简单的线性回归进行估计。</p><h2 id="f887" class="ox mk iq bd ml oy oz dn mp pa pb dp mt lp pc pd mv lt pe pf mx lx pg ph mz iw bi translated">参考</h2><p id="0f77" class="pw-post-body-paragraph lg lh iq li b lj nb ka ll lm nc kd lo lp nd lr ls lt ne lv lw lx nf lz ma mb ij bi translated">[1] A. Deng，U. Knoblich，J. Lu，<a class="ae lf" href="https://arxiv.org/pdf/1803.06336.pdf" rel="noopener ugc nofollow" target="_blank">《在度量分析中应用 Delta 方法:具有新颖想法的实用指南》</a> (2018)。</p><p id="9a39" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">[2] R. Budylin，A. Drutsa，I. Katsev，V. Tsoy，<a class="ae lf" href="https://dl.acm.org/doi/abs/10.1145/3159652.3159699" rel="noopener ugc nofollow" target="_blank">高效在线受控实验的比率度量的一致变换</a> (2018)。<em class="nr"> ACM </em>。</p><p id="c310" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">[3] J. Angrist，J. Pischke，<a class="ae lf" href="https://www.mostlyharmlesseconometrics.com/" rel="noopener ugc nofollow" target="_blank">大多无害的计量经济学:一个经验主义者的伴侣</a> (2009)。<em class="nr">普林斯顿大学出版社</em>。</p><h2 id="389a" class="ox mk iq bd ml oy oz dn mp pa pb dp mt lp pc pd mv lt pe pf mx lx pg ph mz iw bi translated">相关文章</h2><ul class=""><li id="d26a" class="nx ny iq li b lj nb lm nc lp pi lt pj lx pk mb oc od oe of bi translated"><a class="ae lf" href="https://medium.com/towards-data-science/the-bayesian-bootstrap-6ca4a1d45148" rel="noopener">贝叶斯自举</a></li><li id="4080" class="nx ny iq li b lj og lm oh lp oi lt oj lx ok mb oc od oe of bi translated"><a class="ae lf" rel="noopener" target="_blank" href="/df3065a0388e">异常值、杠杆、残差和有影响的观察值</a></li><li id="1912" class="nx ny iq li b lj og lm oh lp oi lt oj lx ok mb oc od oe of bi translated"><a class="ae lf" rel="noopener" target="_blank" href="/b07ab46aa782"> A/B 测试、隐私和在线回归</a></li></ul><h2 id="d68b" class="ox mk iq bd ml oy oz dn mp pa pb dp mt lp pc pd mv lt pe pf mx lx pg ph mz iw bi translated">密码</h2><p id="ce3d" class="pw-post-body-paragraph lg lh iq li b lj nb ka ll lm nc kd lo lp nd lr ls lt ne lv lw lx nf lz ma mb ij bi translated">你可以在这里找到 Jupyter 的原始笔记本:</p><div class="pl pm gp gr pn po"><a href="https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/delta.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="pp ab fo"><div class="pq ab pr cl cj ps"><h2 class="bd ja gy z fp pt fr fs pu fu fw iz bi translated">Blog-Posts/delta . ipynb at main matter courthoud/Blog-Posts</h2><div class="pv l"><h3 class="bd b gy z fp pt fr fs pu fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="pw l"><p class="bd b dl z fp pt fr fs pu fu fw dk translated">github.com</p></div></div><div class="px l"><div class="py l pz qa qb px qc kz po"/></div></div></a></div></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h2 id="bbeb" class="ox mk iq bd ml oy oz dn mp pa pb dp mt lp pc pd mv lt pe pf mx lx pg ph mz iw bi translated">感谢您的阅读！</h2><p id="e7d6" class="pw-post-body-paragraph lg lh iq li b lj nb ka ll lm nc kd lo lp nd lr ls lt ne lv lw lx nf lz ma mb ij bi translated">我真的很感激！🤗<em class="nr">如果你喜欢这个帖子并且想看更多，可以考虑</em> <a class="ae lf" href="https://medium.com/@matteo.courthoud" rel="noopener"> <strong class="li ja"> <em class="nr">关注我</em> </strong> </a> <em class="nr">。我定期发布与因果推理和数据分析相关的主题。我尽量让我的帖子简单而精确，总是提供代码、例子和模拟。</em></p><p id="84c7" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated"><em class="nr">还有，一个小小的</em> <strong class="li ja"> <em class="nr">免责声明</em> </strong> <em class="nr">:我写作是为了学习所以错误是家常便饭，尽管我尽力了。当你发现他们的时候，请告诉我。也很欣赏新话题的建议！</em></p></div></div>    
</body>
</html>