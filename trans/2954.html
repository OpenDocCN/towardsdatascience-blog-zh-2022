<html>
<head>
<title>How to Build a Regression Model for Discontinuous Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何建立不连续数据的回归模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-build-a-regression-model-for-discontinuous-data-bf4b493a491f#2022-06-28">https://towardsdatascience.com/how-to-build-a-regression-model-for-discontinuous-data-bf4b493a491f#2022-06-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b829" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我们将研究如何对不连续数据的一种常见情况进行建模</h2></div><p id="641e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">大多数现实世界中生成数据的过程都受现实世界事件的支配。随着季度业绩的公布和天灾人祸的消息，股票价格会暴跌和飙升。随着金融危机、衰退和供应冲击的爆发，失业和油价等宏观经济指标会经历突然的趋势逆转。</p><p id="3033" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以在足够长的时间内收集的任何真实世界的时间序列数据为例，你很难不发现至少一个趋势的急剧上升或下降，其严重程度足以将序列分为“之前”和“之后”部分。</p><p id="4e03" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这种情况下，分析师的工作不仅是建立一个对这种不连续性<em class="lb">稳健的统计模型，而且还要估计导致这些不连续性的事件的影响。</em></p><p id="3abf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">研究人员开发了许多技术来实现这双重目标。我们将在不连续(或几乎不连续)数据的常见情况下研究这样一种技术。</p><p id="7b32" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们来看看下面这张图表，显示了美国从2002年1月1日到2020年1月1日的每周失业率。该数据包含了一次大衰退，即从2007年12月延续到2009年6月的“T2大衰退”。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ld"><img src="../Images/22faa3456730705488dcd810ebb9de82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C1_EuUiBQk8knE2pj4Nrfg.png"/></div></div><p class="lp lq gj gh gi lr ls bd b be z dk translated">美国劳工统计局，失业率[UNRATE]，检索自弗雷德，<a class="ae lc" href="https://fred.stlouisfed.org/series/UNRATE" rel="noopener ugc nofollow" target="_blank">圣路易斯美联储银行</a>；2022年6月18日(<a class="ae lc" href="https://fred.stlouisfed.org/searchresults/?st=unemployment&amp;t=public%20domain%3A%20citation%20requested&amp;ob=sr&amp;od=desc" rel="noopener ugc nofollow" target="_blank">公共领域数据</a>)</p></figure><p id="1028" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们希望为这些数据构建一个回归模型，我们至少有以下几种不同的方法:</p><ol class=""><li id="ca00" class="lt lu iq kh b ki kj kl km ko lv ks lw kw lx la ly lz ma mb bi translated">我们可以构建一个分段回归模型，对上述数据集的三个不同部分进行建模，即衰退之前、期间和之后的部分。</li><li id="3392" class="lt lu iq kh b ki mc kl md ko me ks mf kw mg la ly lz ma mb bi translated">我们可以使用一种称为<a class="ae lc" href="https://blogs.worldbank.org/impactevaluations/tools-trade-regression-kink-design" rel="noopener ugc nofollow" target="_blank">回归扭结设计</a>的回归技术。</li><li id="eb09" class="lt lu iq kh b ki mc kl md ko me ks mf kw mg la ly lz ma mb bi translated">我们可以用一个<a class="ae lc" rel="noopener" target="_blank" href="/a-math-lovers-guide-to-hidden-markov-models-ad718df9fde8">隐马尔可夫模型</a>进行实验。具体来说，一个2状态马尔可夫转换自回归(MSAR)模型。这两种状态将表示衰退和非衰退阶段。MSAR模型也应该能够代表在这样的时间序列数据集中必然存在的<a class="ae lc" rel="noopener" target="_blank" href="/the-intuition-behind-correlation-62ca11a3c4a">自相关</a>。</li><li id="0a21" class="lt lu iq kh b ki mc kl md ko me ks mf kw mg la ly lz ma mb bi translated">最后，我们可以简单地选择在衰退期不对数据建模，从而将衰退期压缩到零宽度区域。因此，与前三种方法相反，我们不会对衰退期间时间序列的行为感兴趣。因此，我们也需要准备好丢失包含在经济衰退期数据集中的信息。</li></ol><p id="ffc2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，如果我们简化这一点，有些人可能会说，这是一个不正确的决定，在时间序列的衰退阶段丢弃数据点，这就为以下有趣的线性模型打开了大门:</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi mh"><img src="../Images/1231bfded7b88b0c5ddd168f235575b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mXHx4EVlvBVEOdiqhO1kMA.png"/></div></div><p class="lp lq gj gh gi lr ls bd b be z dk translated">失业率的回归不连续模型(图片由作者提供)</p></figure><p id="a930" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的模型中:</p><ul class=""><li id="895f" class="lt lu iq kh b ki kj kl km ko lv ks lw kw lx la mi lz ma mb bi translated"><em class="lb"> β_0 </em>为截距。</li><li id="958c" class="lt lu iq kh b ki mc kl md ko me ks mf kw mg la mi lz ma mb bi translated"><em class="lb"> β_1 </em>是<em class="lb">时间周期</em>变量的系数。<em class="lb"> Time_Period </em>为正整数，取1、2、3等。我们引入这一变量是为了捕捉经济衰退之前和之后这两个数据部分的月环比趋势。</li><li id="1977" class="lt lu iq kh b ki mc kl md ko me ks mf kw mg la mi lz ma mb bi translated"><em class="lb"> β_2 </em>是<a class="ae lc" rel="noopener" target="_blank" href="/what-are-dummy-variables-and-how-to-use-them-in-a-regression-model-ee43640d573e"> <strong class="kh ir">虚拟变量</strong> </a> <em class="lb">历元</em>的系数。我们将位于衰退开始之前的数据集部分的<em class="lb">纪元</em>设置为0，将位于衰退阶段结束之后的数据集部分的<em class="lb">纪元</em>设置为1。</li><li id="da06" class="lt lu iq kh b ki mc kl md ko me ks mf kw mg la mi lz ma mb bi translated"><em class="lb"> ϵ </em>是一个误差项，它捕捉了我们的模型无法解释的未评级方差。</li></ul><p id="3de2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae lc" href="https://gist.github.com/sachinsdate/76eaeda29fab2668cd0bb637c1a14e25" rel="noopener ugc nofollow" target="_blank">这里有一个到数据集</a>的链接，该数据集包含就业率、<em class="lb">时间段</em>和<em class="lb">纪元</em>变量。它不包含衰退阶段包含的数据点。</p><h1 id="2ed7" class="mj mk iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">建立和训练回归模型</h1><p id="f84d" class="pw-post-body-paragraph kf kg iq kh b ki nb jr kk kl nc ju kn ko nd kq kr ks ne ku kv kw nf ky kz la ij bi translated">让我们使用Python、Pandas和statsmodels来构建和训练这个模型。</p><p id="20c3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们首先将数据集加载到Pandas数据框架中:</p><pre class="le lf lg lh gt ng nh ni nj aw nk bi"><span id="da15" class="nl mk iq nh b gy nm nn l no np"><strong class="nh ir">import </strong>pandas <strong class="nh ir">as </strong>pd<br/><strong class="nh ir">import </strong>statsmodels.formula.api <strong class="nh ir">as </strong>smf<br/><strong class="nh ir">import </strong>statsmodels.graphics.tsaplots <strong class="nh ir">as </strong>tsa<br/><strong class="nh ir">from </strong>matplotlib <strong class="nh ir">import </strong>pyplot <strong class="nh ir">as </strong>plt</span><span id="5ba3" class="nl mk iq nh b gy nq nn l no np">df = pd.read_csv(<strong class="nh ir">'unemployment_rate_us_fred.csv'</strong>, header=0)</span></pre><p id="2953" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，让我们用<a class="ae lc" href="https://patsy.readthedocs.io/en/latest/quickstart.html" rel="noopener ugc nofollow" target="_blank"> Patsy </a>语法构造回归表达式。</p><pre class="le lf lg lh gt ng nh ni nj aw nk bi"><span id="bf1e" class="nl mk iq nh b gy nm nn l no np">reg_exp = <strong class="nh ir">'UNRATE ~ Time_Period + Epoch'</strong></span></pre><p id="2aef" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的表达式中，请注意，回归截距并未明确提及，但是当我们使用它来构建模型时，statsmodels会自动包含它。</p><p id="9638" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们使用statsmodel构建OLS模型。我们将回归表达式和数据集作为参数传递:</p><pre class="le lf lg lh gt ng nh ni nj aw nk bi"><span id="7381" class="nl mk iq nh b gy nm nn l no np">regdis_model = smf.<strong class="nh ir">ols</strong>(<strong class="nh ir">formula</strong>=reg_exp, <strong class="nh ir">data</strong>=df)</span></pre><p id="44f9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，让我们训练模型并打印训练总结:</p><pre class="le lf lg lh gt ng nh ni nj aw nk bi"><span id="0835" class="nl mk iq nh b gy nm nn l no np">regdis_model_results = regdis_model.<strong class="nh ir">fit</strong>()<br/><strong class="nh ir">print</strong>(regdis_model_results.<strong class="nh ir">summary</strong>())</span></pre><p id="a590" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们看到以下输出。我在输出中突出了几个有趣的区域:</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi nr"><img src="../Images/39da37efd9788216ed01c68fa50dcc09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dclrJJ8hMvFp-gkPMDdG-g.png"/></div></div><p class="lp lq gj gh gi lr ls bd b be z dk translated">回归模型的训练输出(图片由作者提供)</p></figure><h1 id="63aa" class="mj mk iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">分析模型性能</h1><p id="1450" class="pw-post-body-paragraph kf kg iq kh b ki nb jr kk kl nc ju kn ko nd kq kr ks ne ku kv kw nf ky kz la ij bi translated">在右上角，我们观察到<a class="ae lc" rel="noopener" target="_blank" href="/the-complete-guide-to-r-squared-adjusted-r-squared-and-pseudo-r-squared-4136650fc06c">调整后的R平方</a>为. 925。该模型能够解释92.5%的失业率差异。</p><p id="9d9f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在调整后的R平方的正下方，我们看到Statsmodels报告了用于回归分析的<a class="ae lc" rel="noopener" target="_blank" href="/fisher-test-for-regression-analysis-1e1687867259"> F检验的输出</a>。已经为我们计算了F统计量，其值为1220，p值为1.09E-111。f检验的输出表明，在p为&lt; .001时，模型的系数是<em class="lb">共同显著的</em>，这意味着，该模型在解释未评级的方差方面比均值模型做得更好(在这种情况下，做得好得多)。</p><p id="8b2f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们将注意力转向输出的中心部分，在这里我们可以看到系数估计值、它们的标准误差、p值和估计值周围的置信区间。我们看到，所有三个系数的估计值在&lt; .001.</p><p id="c373" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">The coefficient of <em class="lb">时间段</em>的p值处是显著的(— 0.0525)，这表明在衰退阶段<em class="lb">的任一侧，在<em class="lb">时间段</em>中，失业率估计会以0.0525(约5%)的<em class="lb">平均</em>率下降。</em>回想一下，在我们的数据集中，单位时间段是一个月。</p><p id="bc8e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，<em class="lb">纪元的系数</em>提供了一个有趣的见解。其值为6.3757。我们的模型估计，2008年至2009年的大衰退已经导致美国失业率平均增加了6.3757%，95%的置信区间相当窄，从6.111%到6.641%。</p><h2 id="79b4" class="nl mk iq bd ml ns nt dn mp nu nv dp mt ko nw nx mv ks ny nz mx kw oa ob mz oc bi translated">残差分析</h2><p id="c2dd" class="pw-post-body-paragraph kf kg iq kh b ki nb jr kk kl nc ju kn ko nd kq kr ks ne ku kv kw nf ky kz la ij bi translated">让我们看看statsmodels报告的残差正态性的<a class="ae lc" rel="noopener" target="_blank" href="/testing-for-normality-using-skewness-and-kurtosis-afd61be860"> <strong class="kh ir"> Jarque-Bera和综合测试</strong> </a>的结果:</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi od"><img src="../Images/e430f6169f90ce8b53c7c7af1dda667a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_rqyzpQBC88KScKtG9TNXw.png"/></div></div></figure><p id="40b1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">两个测试的p值都在0.05以上，从而验证了测试的默认假设，即残差呈正态分布。这意味着，我们可以依赖模型报告的置信区间估计。这是好消息。</p><p id="07a0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，德宾-沃森检验的统计数据在&lt; 2.0 indicating a positive auto-correlation among the residual errors. The test’s finding is vindicated by the following auto-correlation plot:</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi oe"><img src="../Images/8191f26ef6feb74829922616eebf49b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pys-MER2bDV790c6Jk-wSA.png"/></div></div><p class="lp lq gj gh gi lr ls bd b be z dk translated">Auto-correlation plot of the residual errors (Image by Author)</p></figure><p id="1d4c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">The above plot can be produced by executing the following two lines of code:</p><pre class="le lf lg lh gt ng nh ni nj aw nk bi"><span id="8de6" class="nl mk iq nh b gy nm nn l no np">tsa.<strong class="nh ir">plot_acf</strong>(regdis_model_results.<strong class="nh ir">resid</strong>)<br/>plt.<strong class="nh ir">show</strong>()</span></pre><p id="ab71" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">The plot shows a strong auto-correlation at LAG-1, which means that each value in the time series of residual errors is correlated with the value that immediately precedes it in the time series. Since values at LAG 1 and LAG 2 are correlated, and LAG 2 and LAG 3 are similarly correlated, LAG 1 and LAG 3 are also correlated but to a lesser extent. Thus we see a gently sloping curve of correlations at the other lags also.</p><p id="6b47" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">A strong auto-correlation of this type in the residuals implies that our model is missing one of more key explanatory variables. Or, the entire functional form of our model may need to be revisited. Perhaps, one of the other three kinds of models suggested at the beginning of the article would prove to be more effective in explaining the variance in UNRATE.</p><p id="dad0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Nevertheless, our plucky little linear model seems to have held up well to the scrutiny. It has allowed us to model the discontinuity that <em class="lb">出来，我们将</em>引入失业数据集中。它不仅估计了大衰退双方的失业趋势，还为我们提供了一种科学估计大衰退对失业率影响的方法。</p></div><div class="ab cl of og hu oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="ij ik il im in"><h1 id="8831" class="mj mk iq bd ml mm om mo mp mq on ms mt jw oo jx mv jz op ka mx kc oq kd mz na bi translated">参考文献、引文和版权</h1><h2 id="f080" class="nl mk iq bd ml ns nt dn mp nu nv dp mt ko nw nx mv ks ny nz mx kw oa ob mz oc bi translated">数据集</h2><p id="3c01" class="pw-post-body-paragraph kf kg iq kh b ki nb jr kk kl nc ju kn ko nd kq kr ks ne ku kv kw nf ky kz la ij bi translated">美国劳工统计局，失业率[UNRATE]，从圣路易斯美联储银行检索；https://fred.stlouisfed.org/series/UNRATE<a class="ae lc" href="https://fred.stlouisfed.org/series/UNRATE" rel="noopener ugc nofollow" target="_blank">。(在</a><a class="ae lc" href="https://fred.stlouisfed.org/searchresults/?st=unemployment&amp;t=public%20domain%3A%20citation%20requested&amp;ob=sr&amp;od=desc" rel="noopener ugc nofollow" target="_blank">公共领域</a>可用)。本文中使用的数据集的精选版本<a class="ae lc" href="https://gist.github.com/sachinsdate/76eaeda29fab2668cd0bb637c1a14e25" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir">可以从这里</strong> </a>下载。</p><h2 id="8920" class="nl mk iq bd ml ns nt dn mp nu nv dp mt ko nw nx mv ks ny nz mx kw oa ob mz oc bi translated">形象</h2><p id="70f3" class="pw-post-body-paragraph kf kg iq kh b ki nb jr kk kl nc ju kn ko nd kq kr ks ne ku kv kw nf ky kz la ij bi translated">本文中的所有图片版权归<a class="ae lc" href="https://www.linkedin.com/in/sachindate/" rel="noopener ugc nofollow" target="_blank"> Sachin Date </a>所有，版权归<a class="ae lc" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener ugc nofollow" target="_blank"> CC-BY-NC-SA </a>所有，除非图片下面提到了不同的来源和版权。</p></div><div class="ab cl of og hu oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="ij ik il im in"><p id="cad6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">如果您喜欢这篇文章，请关注我的</em><a class="ae lc" href="https://timeseriesreasoning.medium.com" rel="noopener"><strong class="kh ir"><em class="lb">Sachin Date</em></strong></a><em class="lb">以获得关于回归、时间序列分析和预测主题的提示、操作方法和编程建议。</em></p></div></div>    
</body>
</html>