<html>
<head>
<title>Using Python to Interact With Excel (PLAXIS Input)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 与 Excel 交互(PLAXIS 输入)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-python-to-interact-with-excel-plaxis-input-a2124f6ebc72#2022-12-20">https://towardsdatascience.com/using-python-to-interact-with-excel-plaxis-input-a2124f6ebc72#2022-12-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="0389" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">PLAXIS 自动化系列</h2><div class=""/><div class=""><h2 id="347f" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">逐步走向自动化的指南</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/5fa03d50ccf5150073252ffb1f51b441.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KRvhEGacBHexmoaBlbzKpQ.jpeg"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated"><a class="ae le" href="https://unsplash.com/s/photos/python-programming?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae le" href="https://unsplash.com/@altumcode?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> AltumCode </a>拍摄的照片</p></figure><p id="7812" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们都喜欢用户友好的界面。PLAXIS Input app 当然是这样一个界面的好例子。经过很少的训练，初学者可以很容易地创建一个垫基脚模型。</p><p id="54c3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">但是，使用鼠标在 PLAXIS 输入中执行操作是非常常见的，如果我们正在处理一个复杂的模型，这可能是一个乏味的过程。当前输入接口有三个限制:</p><ol class=""><li id="a622" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma mg mh mi mj bi translated">批量几何图形输入非常耗时。虽然“阵列”选项可用，但它仅限于具有相同几何图形的元素。</li><li id="b0af" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma mg mh mi mj bi translated">在对设计进行参数化研究时，我们经常需要重新绘制几何图形，这样效率很低。</li><li id="276d" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma mg mh mi mj bi translated">每个元素的命名需要手动完成。如果我们有复杂的模型，命名对于阶段来说非常有用。</li></ol><p id="e2df" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">本教程旨在扩展从<strong class="lh ja">第一教程</strong>中学到的课程。我们将使用 Excel 作为输入几何和材料属性的界面，并在 PLAXIS 中创建板元素。</p><ol class=""><li id="d7c8" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma mg mh mi mj bi translated">使用熊猫从 Excel 中读取值</li><li id="5761" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma mg mh mi mj bi translated">用 Excel 输入几何图形并创建板元素</li><li id="cc3a" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma mg mh mi mj bi translated">用 Excel 输入材料属性并分配材料</li></ol><p id="1e29" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">和以前一样，本教程要求读者已经安装了 VS 代码和 PLAXIS 环境。如果您不熟悉这个页面，请按照下面文章中的说明进行操作。</p><div class="mp mq gp gr mr ms"><a rel="noopener follow" target="_blank" href="/start-using-python-to-automate-plaxis-35a5297321e7"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ja gy z fp mx fr fs my fu fw iz bi translated">开始使用 Python 来自动化 PLAXIS</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">逐步走向自动化的指南</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">towardsdatascience.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng ky ms"/></div></div></a></div><p id="041f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">此外，我们还需要在 PLAXIS 环境中安装<em class="nh"> pandas </em>。如果您还没有安装外部模块，请按照下面的说明进行安装。</p><div class="mp mq gp gr mr ms"><a rel="noopener follow" target="_blank" href="/plaxis-output-visualisation-using-python-a144d2367094"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ja gy z fp mx fr fs my fu fw iz bi translated">使用 Python 实现 PLAXIS 输出可视化</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">逐步走向自动化的指南</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">towardsdatascience.com</p></div></div><div class="nb l"><div class="ni l nd ne nf nb ng ky ms"/></div></div></a></div><h1 id="9d4d" class="nj nk iq bd nl nm nn no np nq nr ns nt kf nu kg nv ki nw kj nx kl ny km nz oa bi translated">Excel 输入界面</h1><p id="e834" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">本教程的最终目标是从 Excel 输入模板中提取值，并使用它们在 PLAXIS 中创建结构元素。因此，定义输入接口非常重要。</p><p id="b4ac" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们将创建一个空的 excel 电子表格，将其命名为<strong class="lh ja"> "Input_param" </strong>。该界面包含三个工作表:</p><ul class=""><li id="c682" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma og mh mi mj bi translated">几何学</li><li id="8f43" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma og mh mi mj bi translated">盘子</li><li id="88c0" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma og mh mi mj bi translated">PlateMatName</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/c604598da860455cf6479dc67e5dbfd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*ZGu1ugukpSy3vs7V2R_gxQ.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者截图自 Excel</p></figure><p id="f554" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">创建工作表时，请确保它们遵循如上所示的相同名称，因为命名区分大小写。</p><h2 id="663c" class="oi nk iq bd nl oj ok dn np ol om dp nt lo on oo nv ls op oq nx lw or os nz iw bi translated">几何学</h2><p id="5ad0" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">“几何”工作表的目的是定义结构元素的坐标。这些值将在下一节的“孔板”工作表中使用。它包括如下所示的四列:</p><ol class=""><li id="43b7" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma mg mh mi mj bi translated">距离:定义特定结构元素的 x 坐标名称。例如，“LDWall”定义左侧地下连续墙的 x 坐标。</li><li id="cee7" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma mg mh mi mj bi translated">x 值:将实际的 x 坐标赋给对应的“距离”。例如，我们将-5 m 指定给“LDWall ”,这意味着左侧地下连续墙将从 x = -5 m 开始。</li><li id="c4b1" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma mg mh mi mj bi translated">RL:为特定结构元素定义 y 坐标的名称。与“LDWall”类似，“DWallTop”定义了地下连续墙顶部的 y 坐标。</li></ol><p id="a24b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">y 值:将实际的 y 坐标赋给对应的“RL”。类似于“X 值”的概念。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/d9cceb4935a1390c65d13850484cdf69.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*ecznqqy3ezk0ka30LHxlEQ.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者截图自 Excel</p></figure><p id="4605" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这些坐标定义将用于“板”工作表中。</p><h2 id="1c72" class="oi nk iq bd nl oj ok dn np ol om dp nt lo on oo nv ls op oq nx lw or os nz iw bi translated">盘子</h2><p id="35e5" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">此工作表的目的是设计多个板元素的属性，包括:</p><ul class=""><li id="dc56" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma og mh mi mj bi translated">名称:如 PLAXIS 中所示(任何不带空格的名称，用下划线代替空格)</li><li id="dcdc" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma og mh mi mj bi translated">接口:决定是否应为该元素创建正接口和负接口(Y/N)</li><li id="0a8a" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma og mh mi mj bi translated">材料:决定应该将什么材料分配给特定的板(任何不带空格的名称，用下划线代替空格)</li></ul><p id="be51" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">X1，Y1，X2 和 Y2:因为 PLAXIS 2D 的板是一条线，它需要两个点的坐标。最后四列使用前面章节中的定义来指定坐标。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/34dcae7d30de057dd06dbb75440fc894.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*dWb-6f1pF573_zKhjKUIbA.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者截图自 Excel</p></figure><p id="3e87" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">创建此工作表后，我们可以转到最后一个工作表“PlateMatName”。</p><h2 id="245a" class="oi nk iq bd nl oj ok dn np ol om dp nt lo on oo nv ls op oq nx lw or os nz iw bi translated">PlateMatName</h2><p id="8ec4" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">此工作表旨在定义我们在上一节中指定的材料属性。请注意，此处输入的名称需要与“孔板”工作表中给出的名称完全相同。</p><p id="c4ba" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">孔板属性有五个输入:</p><ul class=""><li id="b103" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma og mh mi mj bi translated">EA(千牛/米)</li><li id="a74d" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma og mh mi mj bi translated">EI (kNm /m)</li><li id="c806" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma og mh mi mj bi translated">单位重量，w(千牛/米/米)</li><li id="943f" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma og mh mi mj bi translated">泊松比，v (nu) (-)</li><li id="9269" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma og mh mi mj bi translated">防止打孔(是/否)</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/c54f9f596d3da05290bb08e9819d7148.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*PvJghSCdMbx6jTqynDiBQQ.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者截图自 Excel</p></figure><p id="ab7e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这些是 PLAXIS 2D 公司的典型材料属性，只是为了确保所有输入属性都采用正确的单位。</p><p id="4225" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">本例中使用的值旨在创建一个挖掘模型。确保您已经创建了包含上述工作表和值的 excel 电子表格。</p><p id="3622" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">一旦创建了输入文件，我们就可以开始下一步了。</p><h1 id="b855" class="nj nk iq bd nl nm nn no np nq nr ns nt kf nu kg nv ki nw kj nx kl ny km nz oa bi translated">步骤 1:使用熊猫从 Excel 中读取值</h1><p id="9b58" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">步骤 1 的主要目标是从“几何”工作表中提取坐标定义，并将值存储为字典，以备后用。</p><p id="4ef6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">首先，我们创建一个空的 python 文件，并将其命名为“excel_geometry.py”。</p><h2 id="1939" class="oi nk iq bd nl oj ok dn np ol om dp nt lo on oo nv ls op oq nx lw or os nz iw bi translated">导入模块并启动服务器</h2><p id="83d8" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">与之前的教程类似，我们将从导入相关模块和启动服务器开始。</p><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="5db4" class="pb nk iq ox b be pc pd l pe pf">from plxscripting.easy import *<br/>import subprocess, time<br/>import pandas as pd<br/>import openpyxl<br/><br/>###############################################<br/>PLAXIS_PATH = r'C:\Program Files\Bentley\Geotechnical\PLAXIS 2D CONNECT Edition V22\\Plaxis2DXInput.exe'  # Specify PLAXIS path on server.<br/>PORT_i = 10000  # Define a port number.<br/>PORT_o = 10001<br/>PASSWORD = 'SxDBR&lt;TYKRAX834~'  # Define a password.<br/>subprocess.Popen([PLAXIS_PATH, f'--AppServerPassword={PASSWORD}', f'--AppServerPort={PORT_i}'], shell=False)  # Start the PLAXIS remote scripting service.<br/>time.sleep(5)  # Wait for PLAXIS to boot before sending commands to the scripting service.<br/><br/># Start the scripting server.<br/>s_i, g_i = new_server('localhost', PORT_i, password=PASSWORD)<br/>s_o, g_o = new_server('localhost', PORT_o, password=PASSWORD)<br/><br/>s_i.new()<br/><br/>g_i.gotostructures()</span></pre><h2 id="25d1" class="oi nk iq bd nl oj ok dn np ol om dp nt lo on oo nv ls op oq nx lw or os nz iw bi translated">读取 Excel 文件</h2><p id="1816" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">文件位置:C:\ Users \ phtsang \ Desktop \ PLAXIS _ v 22 \ Python _ automation</p><p id="e6cc" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">文件名:我们之前创建的电子表格“Input_param.xlsx”</p><p id="ff26" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">由于我们要从“Geometry”中提取值，所以我们将使用“pd.read_excel()”，并使用“sheet_name”指定我们要读取的工作表。</p><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="e892" class="pb nk iq ox b be pc pd l pe pf">source=r"C:\Users\phtsang\Desktop\PLAXIS_V22\Python_automation"<br/>file="Input_param"+".xlsx"<br/>geomsheet="Geometry"<br/>df_geom = pd.read_excel(file, sheet_name = geomsheet,engine="openpyxl")</span></pre><p id="848a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">字典和数据框架的详细解释可以在以下文章中找到:</p><div class="mp mq gp gr mr ms"><a rel="noopener follow" target="_blank" href="/goodbye-boring-plaxis-output-with-python-fc5c8b26cdb2"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ja gy z fp mx fr fs my fu fw iz bi translated">用 Python 告别枯燥的 PLAXIS 输出</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">逐步走向自动化的指南</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">towardsdatascience.com</p></div></div><div class="nb l"><div class="pg l nd ne nf nb ng ky ms"/></div></div></a></div><h2 id="a2b5" class="oi nk iq bd nl oj ok dn np ol om dp nt lo on oo nv ls op oq nx lw or os nz iw bi translated">读取坐标定义</h2><p id="04d5" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">在这里，我将演示从 dataframe 读取值的第一种方法(把它想象成一个 excel 表)。下面是“几何”工作表的表格。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/d9cceb4935a1390c65d13850484cdf69.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*ecznqqy3ezk0ka30LHxlEQ.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者截图自 Excel</p></figure><p id="ee1c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">假设我们希望提取列 A 和 B，并存储为以“X 值”为标题的字典。这可以通过以下步骤完成:</p><ul class=""><li id="3e8d" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma og mh mi mj bi translated">首先，我们需要使用命令' df_geom.columns[]'定位我们想要的列。例如，“df_geom.columns[0]”给出第一个列名“Dist”。对“X 值”列进行同样的操作。</li><li id="a0a0" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma og mh mi mj bi translated">下一步是提取指定列名下的所有行。这是在 pandas 中使用双方括号命令完成的:“df_geom[[df_geom.columns[0]，df_geom.columns[0]]”</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/bf30fb194404fa9931d72480410e5474.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*e9lWUlmhu92emBqR1UBEkQ.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者截图自 VS 代码</p></figure><ul class=""><li id="32ff" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma og mh mi mj bi translated">由于我们只想在字典中包含“X 值”，所以我们将“Dist”设置为索引。</li></ul><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="2ad6" class="pb nk iq ox b be pc pd l pe pf">set_index(df_geom.columns[0])</span></pre><ul class=""><li id="05b8" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma og mh mi mj bi translated">最后，我们使用 pandas 命令' to_dict()'将数据帧转换为字典。</li></ul><p id="013c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">合并代码后，它应该看起来像这样:</p><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="3b5f" class="pb nk iq ox b be pc pd l pe pf">geom=[]<br/>for i in range(2):<br/>    geom1=df_geom[[df_geom.columns[i*2],df_geom.columns[i*2+1]]].set_index(df_geom.columns[i*2]).to_dict()<br/>    geom.append(geom1)</span></pre><p id="4ee9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><em class="nh"> geom </em>列表的输出如下所示:</p><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="d806" class="pb nk iq ox b be pc pd l pe pf">[{'X value': {'LDWall': -5.0, 'RDWall': 8.0, 'CentreWall': 1.0}}, {'Y value': {'DWallTop': 9.0, 'DWallBot': -6.0, 'Slab1': 6.5, 'BaseSlab': -1.0}}]</span></pre><p id="7f4b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">通过创建一个字典，我们可以很容易地通过名字来赋值。例如，我可以用下面的代码给一个点赋值-5。这在进行参数研究时特别有用，因为我们可以直观地知道要更改哪些坐标。</p><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="b9cc" class="pb nk iq ox b be pc pd l pe pf">geom[0]['X value']['LDWall']</span></pre><p id="5a03" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">既然我们已经存储了坐标，那么我们可以使用这些值来创建结构元素。</p><h1 id="6ad5" class="nj nk iq bd nl nm nn no np nq nr ns nt kf nu kg nv ki nw kj nx kl ny km nz oa bi translated">步骤 2:用 Excel 输入几何图形并创建板元素</h1><p id="6ac0" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">在步骤 2 中，我们将从“Plates”工作表中提取值，并相应地创建 plate 元素。</p><p id="ce49" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">一般来说，步骤类似于第一个教程，除了这一次我们需要根据输入表中提供的信息创建元素。它涉及以下行动:</p><ol class=""><li id="589d" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma mg mh mi mj bi translated">查找唯一的材质名称并创建空材质</li><li id="ca19" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma mg mh mi mj bi translated">遍历表中的元素数</li><li id="eb1e" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma mg mh mi mj bi translated">使用用户输入的名称和坐标定义创建板</li><li id="0970" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma mg mh mi mj bi translated">检查接口要求(是/否),并根据需要创建正接口和负接口。给它们取一个合适的名字。</li><li id="a254" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma mg mh mi mj bi translated">根据表格中的“材料”栏指定材料</li></ol><p id="fc0e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">输入表中涉及的信息如下所示。我们将需要它来引用我们的代码。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/34dcae7d30de057dd06dbb75440fc894.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*dWb-6f1pF573_zKhjKUIbA.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者截图自 Excel</p></figure><ul class=""><li id="a34e" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma og mh mi mj bi translated">首先，我们需要从“Plates”工作表中提取值，并存储为“df_plate”。</li></ul><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="1e65" class="pb nk iq ox b be pc pd l pe pf">#Plates:<br/>platesheet="Plates"<br/>df_plate = pd.read_excel(file, sheet_name = platesheet,engine="openpyxl")</span></pre><ul class=""><li id="9884" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma og mh mi mj bi translated">然后，我们需要从“材料”列中读取值，并找到唯一的材料(即 RC1000 和 RC600)。要从特定单元格读取值，我们可以使用 pandas 命令' df_plate.iloc[row，column]'。它遵循同样的规则<em class="nh">列出</em>应该使用索引的数据类型。</li><li id="f75a" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma og mh mi mj bi translated">例如，如果我们想从表中获取“RightDWall”和“BaseSlab”。我们可以使用“df_plate.iloc[1，0]”和“df_plate.iloc[2，0]”。需要注意的是，当使用<em class="nh"> iloc </em>时，第一行(标题)被跳过。如果我们想得到所有的行，我们可以写' df_plate.iloc[:，0]'。</li><li id="ba41" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma og mh mi mj bi translated">之后，可以使用' dict.fromkeys()'来查找唯一值。结合我们现有的代码。</li></ul><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="2d09" class="pb nk iq ox b be pc pd l pe pf">material=list(dict.fromkeys(df_plate.iloc[:,2].to_list()))</span></pre><ul class=""><li id="2b55" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma og mh mi mj bi translated">然后我们可以用上面给定的材质名创建空材质。之后，我们将材质作为对象存储到“platematerials”中。</li></ul><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="6126" class="pb nk iq ox b be pc pd l pe pf">for i in range(len(material)):<br/>    g_i.platemat('Identification',material[i])<br/><br/>platematerials = [mat for mat in g_i.Materials[:] if mat.TypeName.value == 'PlateMat']</span></pre><ul class=""><li id="1aa1" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma og mh mi mj bi translated">下一步是遍历表中的所有输入元素。</li></ul><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="49c5" class="pb nk iq ox b be pc pd l pe pf">for i in range(df_plate.count()[0])</span></pre><ul class=""><li id="9b39" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma og mh mi mj bi translated">我们需要使用“g_i.plate((X1，Y1)，(X2，Y2))”的用户输入值来创建板。请参见下面两个使用 iloc 提取特定单元格值的示例。</li></ul><p id="7c9b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">geom[0]['X 值'][df_plate.iloc[0，3]]从表中定位 D2，因此给出-5(我们对 LDWall 的定义)</p><p id="98e5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">geom[1]['X 值'][df_plate.iloc[0，4]]从表中定位 E2，因此给出 9(我们对 DWallTop 的定义)</p><p id="0e32" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">使用此逻辑，我们可以创建板元素的两个点。</p><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="dc90" class="pb nk iq ox b be pc pd l pe pf">#Create Plate<br/>plate=g_i.plate(<br/>    (geom[0]['X value'][df_plate.iloc[i,3]],geom[1]['Y value'][df_plate.iloc[i,4]]),<br/>    (geom[0]['X value'][df_plate.iloc[i,5]],geom[1]['Y value'][df_plate.iloc[i,6]]),<br/>    )</span></pre><ul class=""><li id="5bad" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma og mh mi mj bi translated">然后，我们根据“名称”列更改该板的名称。</li></ul><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="2943" class="pb nk iq ox b be pc pd l pe pf">plate1=plate[-1]<br/>plate1.rename(df_plate.iloc[i,0])</span></pre><ul class=""><li id="0866" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma og mh mi mj bi translated">使用<em class="nh"> if </em>语句检查是否需要接口。如果为' Y '，则使用' g _ I . po interface(plate)'和' g_i.neginterface(plate)'创建接口。</li></ul><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="a6b6" class="pb nk iq ox b be pc pd l pe pf">if df_plate.iloc[i,1] == 'Y':<br/>    plate2=plate[-2]<br/>    g_i.posinterface(plate2)<br/>    g_i.neginterface(plate2)</span></pre><ul class=""><li id="717b" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma og mh mi mj bi translated">然后，我使用 PLAXIS 命令' rename()'来命名接口，这样我就有了“LeftDWall_PosInterface”。为每个元素指定一个特定的名称对于登台特别有用。</li></ul><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="b9f1" class="pb nk iq ox b be pc pd l pe pf">plate2.PositiveInterface.rename(df_plate.iloc[i,0]+'_PosInterface')<br/>        plate2.NegativeInterface.rename(df_plate.iloc[i,0]+'_NegInterface')</span></pre><ul class=""><li id="790e" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma og mh mi mj bi translated">最后一步是根据“材料”栏将材料放置到板上。请记住，我们已经将空材料“RC1000”和“RC600”作为对象存储在“platematerials”中。我们将需要使用 if 来检查表中提供的材料名称。如果材质的名称与现有的材质对象匹配，则使用' plate.setmaterial()'将该材质指定给该板。</li></ul><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="628f" class="pb nk iq ox b be pc pd l pe pf">for j in range(len(material)):<br/>     if df_plate.iloc[i,2] == platematerials[j].Identification:<br/>            plate1.setmaterial(platematerials[j])</span></pre><p id="8cf2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">最终脚本应该如下所示:</p><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="2040" class="pb nk iq ox b be pc pd l pe pf">#Plates:<br/>platesheet="Plates"<br/>df_plate = pd.read_excel(file, sheet_name = platesheet,engine="openpyxl")<br/><br/>#Material<br/>material=list(dict.fromkeys(df_plate.iloc[:,2].to_list()))<br/><br/>for i in range(len(material)):<br/>    g_i.platemat('Identification',material[i])<br/><br/>platematerials = [mat for mat in g_i.Materials[:] if mat.TypeName.value == 'PlateMat']<br/><br/>for i in range(df_plate.count()[0]):<br/>    #Create Plate<br/>    plate=g_i.plate(<br/>        (geom[0]['X value'][df_plate.iloc[i,3]],geom[1]['Y value'][df_plate.iloc[i,4]]),<br/>        (geom[0]['X value'][df_plate.iloc[i,5]],geom[1]['Y value'][df_plate.iloc[i,6]]),<br/>        )<br/>    plate1=plate[-1]<br/>    #Rename Plate<br/>    plate1.rename(df_plate.iloc[i,0])<br/>    #Create Interface<br/>    if df_plate.iloc[i,1] == 'Y':<br/>        plate2=plate[-2]<br/>        g_i.posinterface(plate2)<br/>        g_i.neginterface(plate2)<br/>    #Rename Interface<br/>        plate2.PositiveInterface.rename(df_plate.iloc[i,0]+'_PosInterface')<br/>        plate2.NegativeInterface.rename(df_plate.iloc[i,0]+'_NegInterface')<br/>    #Set Material<br/>    for j in range(len(material)):<br/>        if df_plate.iloc[i,2] == platematerials[j].Identification:<br/>            plate1.setmaterial(platematerials[j])</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pi"><img src="../Images/efc9358f2c098f9e7fb404e4e03c48ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bkejbzwGV9UA4i6Bxg47uA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者截图自 VS 代码</p></figure><p id="234b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">一旦创建了板元素，我们就可以定义我们的材料属性了。</p><h1 id="38c3" class="nj nk iq bd nl nm nn no np nq nr ns nt kf nu kg nv ki nw kj nx kl ny km nz oa bi translated">步骤 3:用 Excel 输入材料属性并指定材料</h1><p id="0c83" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">在第 3 步中，我们的目标是从“PlateMatName”工作表中提取材质属性，并将这些属性分配给我们在上一节中创建的材质对象(即“RC1000”和“RC600”)。</p><p id="979c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">输入表中涉及的信息如下所示。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/c54f9f596d3da05290bb08e9819d7148.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*PvJghSCdMbx6jTqynDiBQQ.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者截图自 Excel</p></figure><ul class=""><li id="5dda" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma og mh mi mj bi translated">与上一步类似，我们首先从“PlateMatName”中读取值，并将它们存储为 dataframe。</li></ul><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="2405" class="pb nk iq ox b be pc pd l pe pf">platematsheet="PlateMatName"<br/>df_platemat = pd.read_excel(file, sheet_name = platematsheet,engine="openpyxl")</span></pre><ul class=""><li id="a09a" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma og mh mi mj bi translated">如“Excel 输入界面”下所述，板材属性有五个输入:EA (kN/m)、EI (kNm /m)、单位重量、w (kN/m/m)、泊松比、v (nu) (-)、防冲(Y/N)。</li><li id="8b8d" class="mb mc iq lh b li mk ll ml lo mm ls mn lw mo ma og mh mi mj bi translated">我们将遍历表中的行，并使用 iloc 找到每个值，并将它们分配给相应的变量。</li></ul><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="b433" class="pb nk iq ox b be pc pd l pe pf">for i in range(df_platemat.count()[0]):<br/>   EA = df_platemat.iloc[i,1]<br/>   EI = df_platemat.iloc[i,2]<br/>   w = df_platemat.iloc[i,3]<br/>   nu = df_platemat.iloc[i,4]<br/>   if df_platemat.iloc[i,5] == 'Y':<br/>       Punch=True<br/>   else:<br/>       Punch=False</span></pre><ul class=""><li id="30a8" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma og mh mi mj bi translated">然后，我们检查“名称”列。如果它与 PLAXIS 中的 material 对象的名称相匹配，我们将属性分配给该对象。</li></ul><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="278f" class="pb nk iq ox b be pc pd l pe pf">platematerials = [mat for mat in g_i.Materials[:] if mat.TypeName.value == 'PlateMat']<br/><br/>for j in range(len(platematerials)):<br/>    if df_platemat.iloc[i,0] == platematerials[j].Identification:<br/>        platematerials[j].setproperties("MaterialType","Elastic", "w", w, "EA1", EA, <br/>        "EI", EI, "StructNu", nu, 'PreventPunching', Punch)</span></pre><ul class=""><li id="28a2" class="mb mc iq lh b li lj ll lm lo md ls me lw mf ma og mh mi mj bi translated">最后，使用 PLAXIS 命令' setproperties()'来设置材料属性。</li></ul><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="07cc" class="pb nk iq ox b be pc pd l pe pf">platematerials[j].setproperties("MaterialType","Elastic", "w", w, "EA1", EA, "EI", EI, "StructNu", nu, 'PreventPunching', Punch)</span></pre><p id="35fa" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">最终的脚本如下所示:</p><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="4834" class="pb nk iq ox b be pc pd l pe pf">platematsheet="PlateMatName"<br/>df_platemat = pd.read_excel(file, sheet_name = platematsheet,engine="openpyxl")<br/><br/>for i in range(df_platemat.count()[0]):<br/>    EA = df_platemat.iloc[i,1]<br/>    EI = df_platemat.iloc[i,2]<br/>    w = df_platemat.iloc[i,3]<br/>    nu = df_platemat.iloc[i,4]<br/>    if df_platemat.iloc[i,5] == 'Y':<br/>        Punch=True<br/>    else:<br/>        Punch=False<br/><br/>    platematerials = [mat for mat in g_i.Materials[:] if mat.TypeName.value == 'PlateMat']<br/><br/>    for j in range(len(platematerials)):<br/>        if df_platemat.iloc[i,0] == platematerials[j].Identification:<br/>            platematerials[j].setproperties("MaterialType","Elastic", "w", w, "EA1", EA, <br/>            "EI", EI, "StructNu", nu, 'PreventPunching', Punch)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pj"><img src="../Images/c25d8f2e6fd54c7731b9af30a8997863.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XjrE_EHHxT3qxR9GFfifkQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者截图自 VS 代码</p></figure><p id="ae9e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">使用以下命令运行脚本。</p><pre class="kp kq kr ks gt ow ox oy bn oz pa bi"><span id="1cb6" class="pb nk iq ox b be pc pd l pk pf">(PLAXIS) C:\Users\phtsang\Desktop\PLAXIS_V22\Python_automation&gt;python excel_geometry.py</span></pre><p id="c855" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">你应该看到以下是在 2D 普拉西斯创建的。正如您在 Model explorer 中看到的，我们创建的所有板都有我们在输入表中指定的名称。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pl"><img src="../Images/7a61c14c1617808281563a41f2779a8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SeXhp0b1gGZvkMvrGj7I2A.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者截图自 PLAXIS</p></figure><p id="c092" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">就材料而言，RC1000 和 RC600 具有我们在表中指定的特性。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pm"><img src="../Images/500c4b4d24cfc6d626808980c5b2b663.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TbH0PWDg_Z8vN7i3M2MlUg.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者截图自 PLAXIS</p></figure><p id="e486" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">精彩！我们刚刚为 2D PLAXIS 创建了一个用户界面。</p><h1 id="59e3" class="nj nk iq bd nl nm nn no np nq nr ns nt kf nu kg nv ki nw kj nx kl ny km nz oa bi translated">结论</h1><p id="7594" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">以上是关于使用 Python 与 Excel 交互的第四篇教程。学完本教程后，您应该能够从 excel 获得输入，创建多个结构元素，并在 PLAXIS 中分配材料属性。</p><p id="52ab" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果你喜欢阅读这类内容，请随时关注我的页面。我将继续发布这一系列关于用 Python 自动化 PLAXIS 的教程。除此之外，我还热衷于分享关于如何使用 Python 来自动化工程中的工作流的知识。</p></div><div class="ab cl pn po hu pp" role="separator"><span class="pq bw bk pr ps pt"/><span class="pq bw bk pr ps pt"/><span class="pq bw bk pr ps"/></div><div class="ij ik il im in"><p id="b5d4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">你可以在我的<a class="ae le" href="https://github.com/philiptsangeic/PLAXIS_Python_Automation/blob/master/excel_geometry.py" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到这篇文章中演示的代码。</p></div></div>    
</body>
</html>