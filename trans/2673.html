<html>
<head>
<title>Python Logging — Saving Logs to a File &amp; Sending Logs to an API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python日志记录——将日志保存到文件中，并将日志发送到API</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-logging-saving-logs-to-a-file-sending-logs-to-an-api-75ec5964943f#2022-06-09">https://towardsdatascience.com/python-logging-saving-logs-to-a-file-sending-logs-to-an-api-75ec5964943f#2022-06-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3c7c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将日志放在调试代码需要的地方</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a45036a0ae5c9a6e6f606b025fbf18bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AkmuzXL5mhIlIPod"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们将我们的日志发送到需要它们的地方(图片由<a class="ae ky" href="https://unsplash.com/photos/M0ubHuffWmY" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@kingdineo" rel="noopener ugc nofollow" target="_blank"> Dineo Motau </a>提供)</p></figure><p id="f7e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">包括登录到您的Python应用程序对于了解您的程序做什么和快速调试是必不可少的。它允许您尽可能快速、轻松地解决错误。你的程序可以记录有用的信息，但是当出现问题时<em class="lv">它如何通知你</em>？我们无法在崩溃的应用程序中读取终端日志！</p><p id="a127" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文向您展示了使用处理程序保存日志的两种方法。第一种是最简单的；只需<strong class="lb iu">使用FileHandler将所有日志写入文件</strong>。第二种方法使用HttpHandler<strong class="lb iu">将您的日志发送到HTTP端点</strong>(类似于API)。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><div class="kj kk kl km gt md"><a href="https://mikehuls.medium.com/python-logging-for-absolute-beginners-8e89032b1b4c" rel="noopener follow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd iu gy z fp mi fr fs mj fu fw is bi translated">绝对初学者的Python日志记录</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">停止使用print语句进行调试，转而使用更高级的语句</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">mikehuls.medium.com</p></div></div><div class="mm l"><div class="mn l mo mp mq mm mr ks md"/></div></div></a></div><p id="5d37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们先了解一下日志记录时使用处理程序的概念。如您所知，您可以通过创建一个记录器，然后调用该记录器上的一个日志记录方法来记录消息，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="617a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们在上面的例子中调用<code class="fe mu mv mw mx b">error</code>方法的<code class="fe mu mv mw mx b">debug</code>、<code class="fe mu mv mw mx b">info</code>时，我们的日志记录器必须<em class="lv">处理这些日志记录调用。默认情况下，它只是将消息(带有一些元数据，按照<code class="fe mu mv mw mx b">basicConfig</code>中的格式指定)打印到控制台。</em></p><p id="c92c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的部分中，我们向日志记录器添加了更多的处理程序，它们对日志做其他的事情。对于每个处理程序，我们可以指定级别、字段和格式，如下所示。</p><div class="my mz gp gr na md"><a rel="noopener follow" target="_blank" href="/create-your-custom-python-package-that-you-can-pip-install-from-your-git-repository-f90465867893"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd iu gy z fp mi fr fs mj fu fw is bi translated">创建您的自定义私有Python包，您可以从您的Git存储库中PIP安装该包</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">使用您的git repo共享您的自建Python包。</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">towardsdatascience.com</p></div></div><div class="mm l"><div class="nb l mo mp mq mm mr ks md"/></div></div></a></div></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="6346" class="nc nd it bd ne nf ng nh ni nj nk nl nm jz nn ka no kc np kd nq kf nr kg ns nt bi translated">代码示例—实现处理程序</h1><p id="2439" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">在本文中，我们的目标是为我们的日志记录器添加三个处理程序，每个都有自己的格式:</p><ul class=""><li id="1d28" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated"><strong class="lb iu">流处理程序</strong> <br/>用于打印到控制台。我们想打印所有日志(<code class="fe mu mv mw mx b">debug</code>及以上)</li><li id="2555" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><strong class="lb iu">文件处理器</strong> <br/>将日志保存在一个文件中。我们希望保存除<code class="fe mu mv mw mx b">debug</code>日志之外的所有日志</li><li id="0811" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><strong class="lb iu"> HTTP处理器</strong> <br/>通过HTTP发送日志(例如发送到一个API)。我们只想发送<code class="fe mu mv mw mx b">error</code>和<code class="fe mu mv mw mx b">critical</code>日志</li></ul><p id="be6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有这些记录器都将单独配置；他们将有自己的格式和级别。</p><div class="my mz gp gr na md"><a rel="noopener follow" target="_blank" href="/multi-tasking-in-python-speed-up-your-program-10x-by-executing-things-simultaneously-4b4fc7ee71e"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd iu gy z fp mi fr fs mj fu fw is bi translated">Python中的多任务处理:通过同时执行，将程序速度提高10倍</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">应用线程和进程加速代码的分步指南</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">towardsdatascience.com</p></div></div><div class="mm l"><div class="on l mo mp mq mm mr ks md"/></div></div></a></div></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="b33a" class="oo nd it bd ne op oq dn ni or os dp nm li ot ou no lm ov ow nq lq ox oy ns oz bi translated">1:设置我们的记录器</h2><p id="25c8" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">首先，我们将创建我们的记录器，简单明了:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="0acd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，我们不再对<code class="fe mu mv mw mx b">basicConfig</code>做任何事情。我们用<code class="fe mu mv mw mx b">setLevel</code>方法设置默认级别，接下来我们将分别为每个处理程序指定格式和级别。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f2974016252d254a2c915fe44d6c63b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eJxZttb8wSjgwt5U"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">溪流中的一根木头(我几乎讲完了木头笑话)(图片由<a class="ae ky" href="https://unsplash.com/@zacksmith" rel="noopener ugc nofollow" target="_blank">扎克·史密斯</a>在<a class="ae ky" href="https://unsplash.com/photos/kSxzRXZJrag" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄)</p></figure><h2 id="6407" class="oo nd it bd ne op oq dn ni or os dp nm li ot ou no lm ov ow nq lq ox oy ns oz bi translated">2.添加流处理程序</h2><p id="e050" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">我们将配置流处理程序，将日志发送到控制台，并打印出来:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="0bf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，我们首先专门为流处理程序创建了一个<code class="fe mu mv mw mx b">Formatter</code>。然后我们将定义实际的StreamHandler，指定我们希望输出到sys.stdout(控制台),然后我们将格式化程序设置为处理程序。然后，我们将处理程序添加到日志记录对象中。</p><p id="361a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/ab2efe20e085b235cf50383188b8bdef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UGKLeKtrmSIMRyrLACdcPQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的控制台输出(图片来自作者)</p></figure><p id="1420" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经成功地将日志打印到了控制台上！查看下面的文章，了解如何在您的控制台上创建<strong class="lb iu">彩色日志:</strong></p><div class="my mz gp gr na md"><a href="https://mikehuls.medium.com/colored-logs-for-python-2973935a9b02" rel="noopener follow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd iu gy z fp mi fr fs mj fu fw is bi translated">Python的彩色日志</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">将彩色消息打印到控制台</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">mikehuls.medium.com</p></div></div><div class="mm l"><div class="pb l mo mp mq mm mr ks md"/></div></div></a></div></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="e525" class="oo nd it bd ne op oq dn ni or os dp nm li ot ou no lm ov ow nq lq ox oy ns oz bi translated">3.添加文件处理程序</h2><p id="4a21" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">这些步骤与流处理程序完全相同。不同之处在于我们指定了另一种格式和不同的级别。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="2cff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/44e7f90be14deb80c43abe2019f7635f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rvFn5hbDsFYMSoN0PhKzCw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">颜色是由PyCharm插件添加的(图片由作者提供)</p></figure><p id="939a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开<code class="fe mu mv mw mx b">test.log</code>文件表明我们不仅仅是写了一个文件，我们还可以清楚地看到日志与streamHandler的格式不同。还要注意，我们没有将<code class="fe mu mv mw mx b">debug</code>日志保存到文件中。就像我们想要的一样。</p><p id="c9b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦您使用filehandler一段时间，您的日志文件就会变得相当大。查看<a class="ae ky" href="https://mikehuls.medium.com/my-logging-file-gets-too-big-python-logging-to-multiple-files-c7fccf97d3a4" rel="noopener"> <strong class="lb iu">这篇文章</strong> </a>可以解决那个问题。</p><div class="my mz gp gr na md"><a rel="noopener follow" target="_blank" href="/simple-trick-to-work-with-relative-paths-in-python-c072cdc9acb9"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd iu gy z fp mi fr fs mj fu fw is bi translated">在Python中使用相对路径的简单技巧</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">轻松计算运行时的文件路径</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">towardsdatascience.com</p></div></div><div class="mm l"><div class="pd l mo mp mq mm mr ks md"/></div></div></a></div></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="ee73" class="oo nd it bd ne op oq dn ni or os dp nm li ot ou no lm ov ow nq lq ox oy ns oz bi translated">4.添加HTTP处理程序</h2><p id="dcef" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">这些步骤与上一步没有太大区别:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="2331" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这几行简短的代码将我们的日志通过HTTP发送到一个URL。</p><p id="c8bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">重要的</em> </strong> <em class="lv">:然而，这个处理程序有一个主要的缺点:它阻塞线程直到它完成请求。在未来，我将重点关注为非阻塞HTTP处理程序实现自定义日志处理程序。</em><strong class="lb iu"><em class="lv"/></strong><a class="ae ky" href="https://mikehuls.medium.com/membership" rel="noopener"><strong class="lb iu"><em class="lv">关注我</em> </strong> </a> <em class="lv">敬请关注！</em></p><div class="my mz gp gr na md"><a rel="noopener follow" target="_blank" href="/git-for-absolute-beginners-understanding-git-with-the-help-of-a-video-game-88826054459a"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd iu gy z fp mi fr fs mj fu fw is bi translated">绝对初学者的Git:借助视频游戏理解Git</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">以一个经典的RPG作为类比，获得如何使用git的直觉</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">towardsdatascience.com</p></div></div><div class="mm l"><div class="pe l mo mp mq mm mr ks md"/></div></div></a></div></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="3da1" class="nc nd it bd ne nf ng nh ni nj nk nl nm jz nn ka no kc np kd nq kf nr kg ns nt bi translated">结论</h1><p id="be79" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">在本文中，我们已经讨论了流、文件和HTTP的处理程序。还有一些我们没有处理的，比如套接字处理程序和SMTP处理程序。因为这篇文章已经很长了，我还没有在这篇文章中涉及到这些，但也许在未来的文章中会涉及到，所以请一定要关注我。</p><p id="e701" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望一切都像我希望的那样清楚，但如果不是这样，请让我知道我能做些什么来进一步澄清。同时，看看我的其他关于各种编程相关主题的文章，比如:</p><ul class=""><li id="04be" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated"><a class="ae ky" href="https://mikehuls.medium.com/cython-for-absolute-beginners-30x-faster-code-in-two-simple-steps-bbb6c10d06ad" rel="noopener">面向绝对初学者的cyt hon——两步代码速度提高30倍</a></li><li id="6bdb" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><a class="ae ky" href="https://mikehuls.medium.com/why-is-python-so-slow-and-how-to-speed-it-up-485b5a84154e" rel="noopener">Python为什么这么慢，如何加速</a></li><li id="912b" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><a class="ae ky" href="https://mikehuls.medium.com/git-for-absolute-beginners-understanding-git-with-the-help-of-a-video-game-88826054459a" rel="noopener"> Git绝对初学者:借助视频游戏理解Git</a></li><li id="926b" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><a class="ae ky" href="https://mikehuls.medium.com/simple-trick-to-work-with-relative-paths-in-python-c072cdc9acb9" rel="noopener">在Python中使用相对路径的简单技巧</a></li><li id="6e8b" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">面向绝对初学者的Docker:图像和容器的区别</li><li id="9acd" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><a class="ae ky" href="https://mikehuls.medium.com/docker-for-absolute-beginners-what-is-docker-and-how-to-use-it-examples-3d3b11efd830" rel="noopener"> Docker(面向绝对初学者)——Docker是什么以及如何使用(+示例)</a></li><li id="422a" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><a class="ae ky" href="https://mikehuls.medium.com/virtual-environments-for-absolute-beginners-what-is-it-and-how-to-create-one-examples-a48da8982d4b" rel="noopener">绝对初学者的虚拟环境——什么是虚拟环境，如何创建虚拟环境(+示例</a>)</li><li id="9bb2" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><a class="ae ky" href="https://mikehuls.medium.com/create-and-publish-your-own-python-package-ea45bee41cdc" rel="noopener">创建并发布自己的Python包</a></li><li id="8a48" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><a class="ae ky" href="https://mikehuls.medium.com/create-a-fast-auto-documented-maintainable-and-easy-to-use-python-api-in-5-lines-of-code-with-4e574c00f70e" rel="noopener">用FastAPI用5行代码创建一个快速自动记录、可维护且易于使用的Python API</a></li></ul><p id="8318" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！</p><p id="e1eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">—迈克</p><p id="8c62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">又及:喜欢我正在做的事吗？</em> <a class="ae ky" href="https://mikehuls.medium.com/membership" rel="noopener"> <em class="lv">跟我来！</em>T9】</a></p><div class="my mz gp gr na md"><a href="https://mikehuls.medium.com/membership" rel="noopener follow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd iu gy z fp mi fr fs mj fu fw is bi translated">通过我的推荐链接加入媒体-迈克·赫斯</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">mikehuls.medium.com</p></div></div><div class="mm l"><div class="pf l mo mp mq mm mr ks md"/></div></div></a></div></div></div>    
</body>
</html>