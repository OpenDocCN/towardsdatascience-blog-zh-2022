<html>
<head>
<title>10 Pandas Query Examples That Will Make You Use Pandas Query Easily</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">10个熊猫查询示例，让你轻松使用熊猫查询</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/10-pandas-query-examples-that-will-make-you-use-pandas-query-easily-12a45b1e115#2022-07-26">https://towardsdatascience.com/10-pandas-query-examples-that-will-make-you-use-pandas-query-easily-12a45b1e115#2022-07-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="7cef" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">数据科学</h2><div class=""/><div class=""><h2 id="fdc9" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">开始使用熊猫查询功能轻松过滤您的数据</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/8e1de3459b29a9648c5b5ca6e7fba002.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZNA18FeG6UwiTsrBZkugrg.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">由cookie_studio创作的<a class="ae lh" href="https://www.freepik.com/photos/drip-coffee" rel="noopener ugc nofollow" target="_blank">滴咖啡照片</a>——【www.freepik.com T4】</p></figure><p id="b78c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">主数据集过滤使用熊猫查询功能！</strong></p><p id="7de8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">有了Pandas库，Python中的数据分析变得很容易。在执行数据分析任务时，您通常需要选择数据子集进行深入研究。而这可以用<strong class="lk jd">熊猫轻松实现。DataFrame.query() </strong>函数。</p><p id="b24c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，了解如何高效和有效地利用它非常重要。</p><p id="441e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我列举了10个例子，解释了几乎所有可以使用查询函数过滤数据点的用例。最后，你将能够在需要的时候毫不费力地使用熊猫的查询功能。</p><p id="f9fc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可以通过下面的索引快速跳转到您最喜欢的用例。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="2e29" class="mj mk it mf b gy ml mm l mn mo"><strong class="mf jd">· </strong><a class="ae lh" href="#7fc6" rel="noopener ugc nofollow"><strong class="mf jd">Filtering using Single Condition</strong></a><br/>  ∘ <a class="ae lh" href="#66c5" rel="noopener ugc nofollow">Example 1</a><br/><strong class="mf jd">· </strong><a class="ae lh" href="#5a5d" rel="noopener ugc nofollow"><strong class="mf jd">Filtering on Multiple Conditions</strong></a><br/>  ∘ <a class="ae lh" href="#bd3d" rel="noopener ugc nofollow">Example 1</a><br/>  ∘ <a class="ae lh" href="#67af" rel="noopener ugc nofollow">Example 2</a><br/>  ∘ <a class="ae lh" href="#685e" rel="noopener ugc nofollow">Example 3</a><br/><strong class="mf jd">· </strong><a class="ae lh" href="#7968" rel="noopener ugc nofollow"><strong class="mf jd">Filtering based on Text Columns</strong></a><br/>  ∘ <a class="ae lh" href="#1c2d" rel="noopener ugc nofollow">Example 1</a><br/><strong class="mf jd">· </strong><a class="ae lh" href="#5d7e" rel="noopener ugc nofollow"><strong class="mf jd">Simple Math Operation in Pandas Query</strong></a><br/>  ∘ <a class="ae lh" href="#4280" rel="noopener ugc nofollow">Example 1</a><br/>  ∘ <a class="ae lh" href="#4b75" rel="noopener ugc nofollow">Example 2</a><br/><strong class="mf jd">· </strong><a class="ae lh" href="#1821" rel="noopener ugc nofollow"><strong class="mf jd">Built-In Functions in Pandas Query</strong></a><br/>  ∘ <a class="ae lh" href="#2c05" rel="noopener ugc nofollow">Example 1</a><br/>  ∘ <a class="ae lh" href="#3165" rel="noopener ugc nofollow">Example 2</a><br/><strong class="mf jd">· </strong><a class="ae lh" href="#e832" rel="noopener ugc nofollow"><strong class="mf jd">Filtering based on Date-Time Columns</strong></a><br/>  ∘ <a class="ae lh" href="#224c" rel="noopener ugc nofollow">Example 1</a><br/>  ∘ <a class="ae lh" href="#d651" rel="noopener ugc nofollow">Example 2</a><br/><strong class="mf jd">· </strong><a class="ae lh" href="#ebb0" rel="noopener ugc nofollow"><strong class="mf jd">Inplace in Pandas Query Function</strong></a></span></pre><blockquote class="mp mq mr"><p id="3391" class="li lj ms lk b ll lm kd ln lo lp kg lq mt ls lt lu mu lw lx ly mv ma mb mc md im bi translated">📍注意:我使用的是自己创建的<a class="ae lh" href="https://github.com/17rsuraj/data-curious/blob/master/TowardsDataScience/Dummy_Sales_Data_v1.csv" rel="noopener ugc nofollow" target="_blank"> Dummy_Sales_Data </a>，你可以在我的<a class="ae lh" href="https://github.com/17rsuraj/data-curious/blob/master/TowardsDataScience/Dummy_Sales_Data_v1.csv" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd"> Github </strong> </a> repo上免费获得<a class="ae lh" href="https://github.com/17rsuraj/data-curious/blob/master/LICENSE.md" rel="noopener ugc nofollow" target="_blank"><strong class="lk jd">MIT License</strong></a><strong class="lk jd">！</strong>！</p></blockquote><p id="a825" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们将数据集导入熊猫数据框架— <code class="fe mw mx my mf b"><strong class="lk jd">df</strong></code></p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="0c50" class="mj mk it mf b gy ml mm l mn mo">import pandas as pd<br/>df = pd.read_csv("Dummy_Sales_Data_v1.csv")<br/>df.head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mz"><img src="../Images/69fc6c7b04d33f110d0f42ad616ca667.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*brnKcKl0J7KVeqfJ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">虚拟销售数据|作者图片</p></figure><p id="3a0c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是一个简单的9999 x 12的数据集，我用Python中的<a class="ae lh" rel="noopener" target="_blank" href="/faker-an-amazing-and-insanely-useful-python-library-b313a60bdabf"><strong class="lk jd">Faker</strong></a><strong class="lk jd"/>创建的📚</p><p id="02ea" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你可以在本文末尾下载一个完整的笔记本，里面有所有这些例子！</p></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><p id="eaa0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在进入示例之前，快速回顾一下pandas中的查询功能—</p><p id="1ac5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi nh translated">Q查询函数用于根据指定的表达式提取记录，并返回新的数据帧。表达式是以字符串形式书写的条件或条件组合。</p><p id="c31a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在后端，使用pandas中的<code class="fe mw mx my mf b"><strong class="lk jd">eval()</strong></code>函数计算该表达式，并返回数据或记录的子集，其中表达式被计算为<strong class="lk jd"> TRUE </strong>。</p><p id="8e51" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，要过滤pandas DataFrame，您只需在查询函数中指定条件，您将在后续示例中看到这一点。</p><blockquote class="nq"><p id="a3a7" class="nr ns it bd nt nu nv nw nx ny nz md dk translated">为什么要在熊猫数据帧<code class="fe mw mx my mf b"><strong class="ak">.loc</strong></code>、<code class="fe mw mx my mf b"><strong class="ak">.iloc</strong></code>和括号<code class="fe mw mx my mf b"><strong class="ak">[ ]</strong></code>上使用<code class="fe mw mx my mf b"><strong class="ak">query()</strong></code>符号</p></blockquote><ul class=""><li id="c455" class="oa ob it lk b ll oc lo od lr oe lv of lz og md oh oi oj ok bi translated">pandas DataFrame属性——<code class="fe mw mx my mf b"><strong class="lk jd"> .loc</strong></code>和<code class="fe mw mx my mf b"><strong class="lk jd">.iloc</strong></code>——专门用于根据行和列标签和索引提取数据集的子集。因此，它并没有真正为您提供根据条件过滤数据帧的灵活性。</li><li id="38fa" class="oa ob it lk b ll ol lo om lr on lv oo lz op md oh oi oj ok bi translated">括号符号<code class="fe mw mx my mf b"><strong class="lk jd">[ ]</strong></code>为您提供了根据条件过滤数据帧的灵活性，但是用多对方括号来编写在语法上是很庞大的</li></ul><p id="43b9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">另一方面，pandas <code class="fe mw mx my mf b"><strong class="lk jd">query()</strong></code>函数为您提供了基于一个或多个条件提取数据帧子集的灵活性，这些条件被写成一个非常简单的表达式。您真的不需要考虑或检查任何丢失的括号！💯</p><p id="574b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，您知道了为什么应该使用query()函数来过滤数据集，让我们从示例开始吧。</p></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><p id="fe34" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">从最简单的用例开始—基于单个条件(即仅一列上的条件)过滤数据帧。</p><h1 id="7fc6" class="oq mk it bd or os ot ou ov ow ox oy oz ki pa kj pb kl pc km pd ko pe kp pf pg bi translated">使用单一条件过滤</h1><p id="ddd9" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">当过滤单个条件时，在<code class="fe mw mx my mf b">query()</code>函数中待评估的表达式将只包含一个条件。并且返回的输出将包含该表达式计算为<code class="fe mw mx my mf b">TRUE</code>的所有行。</p><h2 id="66c5" class="mj mk it bd or pm pn dn ov po pp dp oz lr pq pr pb lv ps pt pd lz pu pv pf iz bi translated">示例1</h2><p id="981d" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">假设您想提取数量为95的所有行。所以逻辑形式的条件可以写成—</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="338b" class="mj mk it mf b gy ml mm l mn mo"><strong class="mf jd">Quantity == 95</strong></span></pre><p id="b104" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">📌记住，你需要把这个条件写成一个字符串，也就是用双引号<code class="fe mw mx my mf b"><strong class="lk jd">“ ”</strong></code> <strong class="lk jd"> </strong>把它括起来。</p><p id="fbde" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，您可以根据以下条件过滤数据帧—</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="ac6c" class="mj mk it mf b gy ml mm l mn mo"><strong class="mf jd">df.query("Quantity == 95")</strong></span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pw"><img src="../Images/6e9f703e6c048c0d790ff5f012b5182c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DrPI4UdFnqhkzj7UrHOsEA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">在pandas查询中使用单个条件进行过滤()|图片由作者提供</p></figure><p id="72d2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">看起来很简单。它返回数量为95的所有行。</p><p id="296a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">嗯，这很简单，你甚至可以像这样使用括号符号——<code class="fe mw mx my mf b"><strong class="lk jd">df[df[“Quantity”]==95]</strong></code><strong class="lk jd"/>。</p><blockquote class="mp mq mr"><p id="66a1" class="li lj ms lk b ll lm kd ln lo lp kg lq mt ls lt lu mu lw lx ly mv ma mb mc md im bi translated">但是，如果您想在同一列中再包含一个条件，该怎么办呢？？</p></blockquote><p id="4850" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这无疑在括号符号中增加了一对方括号，使得它<em class="ms">庞大</em>并且从长远来看<em class="ms">难以管理</em>。这就是<code class="fe mw mx my mf b"><strong class="lk jd">query()</strong></code>的有效性开始显现的时候。</p><h1 id="5a5d" class="oq mk it bd or os ot ou ov ow ox oy oz ki pa kj pb kl pc km pd ko pe kp pf pg bi translated">根据多个条件过滤</h1><p id="c7b3" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">无论您根据一个还是多个条件进行过滤，query()的语法都是相同的——通过将条件括在<code class="fe mw mx my mf b"><strong class="lk jd">“ ”</strong></code> <strong class="lk jd"> </strong>中，将条件写成字符串。</p><p id="e92c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">但是，您必须指定如何基于两个或更多条件进行过滤，因此您可以从以下两个条件中选择一个:</p><ul class=""><li id="ed07" class="oa ob it lk b ll lm lo lp lr px lv py lz pz md oh oi oj ok bi translated"><code class="fe mw mx my mf b"><strong class="lk jd">AND</strong></code>:只有两个条件都满足时，才返回数据帧中的所有记录</li><li id="a06d" class="oa ob it lk b ll ol lo om lr on lv oo lz op md oh oi oj ok bi translated"><code class="fe mw mx my mf b"><strong class="lk jd">OR</strong></code>:返回数据帧中满足一个或两个条件的所有记录。</li></ul><p id="7c1e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们用下面两个例子来看看它是如何工作的。</p><h2 id="bd3d" class="mj mk it bd or pm pn dn ov po pp dp oz lr pq pr pb lv ps pt pd lz pu pv pf iz bi translated">示例1</h2><p id="12b3" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">假设，您想要选择两个条件(数量为95，单价为182)都为真的所有行。</p><p id="5770" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">所以，你应该选择<code class="fe mw mx my mf b">AND</code>逻辑。在query()表达式中，使用关键字<code class="fe mw mx my mf b"><strong class="lk jd">and</strong></code>实现。💯</p><p id="a11d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">注意，包含单价的列被命名为<em class="ms">单价(美元)</em></p><p id="c4d9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">所以，条件是—</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="3669" class="mj mk it mf b gy ml mm l mn mo"><strong class="mf jd">Quantity == 95<br/>UnitPrice(USD) == 182</strong></span></pre><p id="a2ad" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这个表达会变成—</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="8470" class="mj mk it mf b gy ml mm l mn mo"><strong class="mf jd">"Quantity == 95 and UnitPrice(USD) == 182"</strong></span></pre><p id="5a9c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要提取所需的数据集，您需要编写—</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="3ea9" class="mj mk it mf b gy ml mm l mn mo"><strong class="mf jd">df.query("Quantity == 95 and UnitPrice(USD) == 182")</strong></span></pre><p id="10be" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，您得到的不是输出，而是关于<em class="ms">‘单价’</em>的<strong class="lk jd"> KeyError </strong>，如下所示。🚨🚨</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qa"><img src="../Images/6a640a824171e5dfb75ea06b5423e53f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F1mhQxhSvioIuP9psdIKhg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者的列名|图像不一致时出现关键错误</p></figure><blockquote class="mp mq mr"><p id="43f0" class="li lj ms lk b ll lm kd ln lo lp kg lq mt ls lt lu mu lw lx ly mv ma mb mc md im bi translated">但是为什么会出现这个错误呢？？</p></blockquote><p id="331d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是因为，query()函数对列名有一些限制。并且列名<em class="ms">单价(美元)</em>在查询()中使用无效。</p><p id="0ca0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">query()表达式将列名<em class="ms"> UnitPrice(USD </em>)中的<em class="ms"> UnitPric </em> e解释为要对变量USD进行操作的函数。</p><p id="053f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">📌<a class="ae lh" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.query.html" rel="noopener ugc nofollow" target="_blank"><strong class="lk jd">query()guidelines</strong></a>为这个问题提供了一个快速的替代方法，将反勾号中的无效列名称为— <code class="fe mw mx my mf b"><strong class="lk jd"> `UnitPrice(USD)`</strong></code></p><p id="e1c3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">所以你应该写的正确表达是—</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="1048" class="mj mk it mf b gy ml mm l mn mo"><strong class="mf jd">df.query("Quantity == 95 and `UnitPrice(USD)` == 182")</strong></span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qb"><img src="../Images/714e3c4db9bf349367cbac1610936b17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kKJPIM7_cDNaDrRox5rRYQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">按作者在查询()和逻辑|图像中筛选多个条件</p></figure><p id="31f3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如您所见，当这两个条件都满足时，只有3条记录。</p><p id="0400" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，同样有可能你忘记提到一个反勾号，程序将抛出另一个<em class="ms">语法错误</em>。因此，一个最简单的解决方案是将<a class="ae lh" rel="noopener" target="_blank" href="/how-to-rename-columns-in-pandas-with-examples-24c983fcc3b8"> <strong class="lk jd">中的列名</strong> </a>修改如下—</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="2aac" class="mj mk it mf b gy ml mm l mn mo">df.rename(columns={<strong class="mf jd">'UnitPrice(USD)':'UnitPrice'</strong>, <br/>                   'Shipping_Cost(USD)':'Shipping_Cost',<br/>                   'Delivery_Time(Days)':'Delivery_Time'},<br/>          inplace=True)</span></pre><p id="43bf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，您现在可以使用新的列名获得相同的输出，如下所示—</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="f0c7" class="mj mk it mf b gy ml mm l mn mo">df.query("Quantity == 95 and <strong class="mf jd">UnitPrice == 182</strong>")</span></pre><p id="374d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">或者，您也可以使用<em class="ms">与号运算符</em> <code class="fe mw mx my mf b"><strong class="lk jd">&amp;</strong></code> <strong class="lk jd"> </strong>获得相同的输出，如下所示</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="8ee8" class="mj mk it mf b gy ml mm l mn mo">df.query("Quantity == 95 <strong class="mf jd">&amp;</strong> UnitPrice == 182")</span></pre><p id="4d81" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你可以看到这是多么简单——你可以用简单的英语把表达写在纸上。</p><p id="e21b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，让我们看看如何实现<code class="fe mw mx my mf b"><strong class="lk jd">OR</strong></code>逻辑。</p><h2 id="67af" class="mj mk it bd or pm pn dn ov po pp dp oz lr pq pr pb lv ps pt pd lz pu pv pf iz bi translated">示例2</h2><p id="e88b" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">假设您希望获得至少满足上述一个条件的所有行。</p><p id="cdc4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你所需要做的就是在以下两个条件之间使用关键字<code class="fe mw mx my mf b"><strong class="lk jd">or</strong></code>—</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="b258" class="mj mk it mf b gy ml mm l mn mo"><strong class="mf jd">df.query("Quantity == 95 or UnitPrice == 182")</strong></span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qc"><img src="../Images/61f8ad53773ac79b0c209e4050680cb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PIsT3PODRrPuicD5WbhmYg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">根据多个条件或逻辑筛选|按作者筛选图像</p></figure><p id="b6e1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">它返回两个条件之一为真的所有行(<em class="ms">见上图</em>中的第2到第5行)以及两个条件都为真的行(<em class="ms">第1行</em></p><p id="05ae" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里也可以使用按位运算符<code class="fe mw mx my mf b"><strong class="lk jd">|</strong></code>来代替<code class="fe mw mx my mf b"><strong class="lk jd">or</strong></code>关键字。✅</p><p id="57f3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">更进一步，您还可以在query()中使用<code class="fe mw mx my mf b"><strong class="lk jd">NOT</strong></code>逻辑，当query中的指定条件被评估为<code class="fe mw mx my mf b">FALSE</code>时，它将返回所有记录。</p><h2 id="685e" class="mj mk it bd or pm pn dn ov po pp dp oz lr pq pr pb lv ps pt pd lz pu pv pf iz bi translated">示例3</h2><p id="93dd" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">假设您想要获取所有数量不等于95的行。</p><p id="7b1f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最简单的答案是在表达式中的条件前使用<code class="fe mw mx my mf b"><strong class="lk jd">not</strong></code>关键字或否定运算符<code class="fe mw mx my mf b"><strong class="lk jd">~</strong></code>，如下所示。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="4765" class="mj mk it mf b gy ml mm l mn mo"><strong class="mf jd">df.query("not (Quantity == 95)")</strong></span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qd"><img src="../Images/83db8df641f9d92e0dd797e6eba2b30d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bmIopIRzqUC4zlZ6_VJ10Q.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">在查询|作者图片中使用NOT逻辑进行过滤</p></figure><p id="4fb1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">正如您在输出中看到的，它包含了Quantity不为95的所有行。</p><p id="7300" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此外，条件不必总是等于运算符，而是可以在定义条件时从<code class="fe mw mx my mf b"><strong class="lk jd">==</strong></code>、<code class="fe mw mx my mf b"><strong class="lk jd">!=</strong></code>、<code class="fe mw mx my mf b"> <strong class="lk jd">&gt;</strong></code>、<code class="fe mw mx my mf b"><strong class="lk jd">&lt;</strong></code>、<code class="fe mw mx my mf b"><strong class="lk jd">≥</strong></code>、<strong class="lk jd"> ≤ </strong>中选择任意一个。</p><p id="9876" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，在以下条件下使用不等运算符<code class="fe mw mx my mf b"><strong class="lk jd">!=</strong></code>，可以得到与<code class="fe mw mx my mf b">NOT</code>逻辑相同的输出</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="3ce8" class="mj mk it mf b gy ml mm l mn mo">df.query("<strong class="mf jd">Quantity != 95</strong>")</span></pre><p id="c74a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这将进一步节省您编写(可能会忘记结束)额外的圆括号的努力！从而简化了<code class="fe mw mx my mf b">query()</code>的表述。</p><p id="02c0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">条件并不总是需要在数字列上。您始终可以基于非数字文本列来筛选数据点。</p><h1 id="7968" class="oq mk it bd or os ot ou ov ow ox oy oz ki pa kj pb kl pc km pd ko pe kp pf pg bi translated">基于文本列的过滤</h1><p id="c6bb" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">根据文本列进行筛选时，您的条件应该是将列名与字符串进行比较。</p><blockquote class="mp mq mr"><p id="6829" class="li lj ms lk b ll lm kd ln lo lp kg lq mt ls lt lu mu lw lx ly mv ma mb mc md im bi translated">记住，你的<code class="fe mw mx my mf b">query()</code>表达式已经是字符串了。那么如何在另一个字符串中写一个字符串呢？？</p></blockquote><p id="eff8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">📌只需用单引号将您想要在条件中使用的文本值括起来，如<code class="fe mw mx my mf b"><strong class="lk jd">‘ ’</strong></code> <strong class="lk jd"> </strong>。让我们看一个如何做到这一点的例子。</p><h2 id="1c2d" class="mj mk it bd or pm pn dn ov po pp dp oz lr pq pr pb lv ps pt pd lz pu pv pf iz bi translated">示例1</h2><p id="e110" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">假设，您想要获取状态为'<em class="ms">未发货</em>'的所有记录。你可以把这个用<code class="fe mw mx my mf b">query()</code>表达式写成—</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="857c" class="mj mk it mf b gy ml mm l mn mo">df.query("Status == <strong class="mf jd">'Not Shipped'</strong>")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qe"><img src="../Images/1f86d81c34a004afdef0d9fed3d77a8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dCNISNb2hjaFFfdbzVxJBg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">按作者过滤文本栏|图像</p></figure><p id="759f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">它返回所有记录，其中Status列包含值— ' <em class="ms">未发货</em>'。</p><p id="9cad" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">同样，您可以在同一列或不同列上使用多个条件，它可以是数字列和非数字列上条件的组合。💯</p><p id="c068" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在现实世界中，大多数时候，用于过滤数据帧的条件包括某些计算。Pandas query()允许您在查询表达式中自由使用数学。</p><h1 id="5d7e" class="oq mk it bd or os ot ou ov ow ox oy oz ki pa kj pb kl pc km pd ko pe kp pf pg bi translated">熊猫查询中的简单数学运算</h1><p id="97cf" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">数学运算可以是任何东西，比如加、减、乘、除，甚至是列中某个值的平方或立方。</p><p id="34d1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">由于数学运算是用于数值的，所以只能在查询表达式中的数值列上使用，如下例所示。</p><h2 id="4280" class="mj mk it bd or pm pn dn ov po pp dp oz lr pq pr pb lv ps pt pd lz pu pv pf iz bi translated">示例1</h2><p id="db03" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">例如，假设当double of shipping cost小于50时，您希望从数据集中获取所有行。</p><p id="ca09" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这就像用简单的英语书写表达式一样简单，如下所示</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="79b9" class="mj mk it mf b gy ml mm l mn mo">df.query("<strong class="mf jd">Shipping_Cost*2</strong> &lt; 50")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qf"><img src="../Images/206af98ec04157e0bd3427b22abecb4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qb3-dWPkNFT5pHwYvttPXA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">query()函数内的数学运算|作者图片</p></figure><p id="e687" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">嘣！它返回所有需要的行。</p><p id="6fbc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您还可以在一列或多列中包含甚至有点复杂的计算。💯</p><h2 id="4b75" class="mj mk it bd or pm pn dn ov po pp dp oz lr pq pr pb lv ps pt pd lz pu pv pf iz bi translated">示例2</h2><p id="28e0" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">假设您希望得到所有<em class="ms">数量的平方和运输成本的平方之和小于500 </em>的行。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="26eb" class="mj mk it mf b gy ml mm l mn mo">df.query("<strong class="mf jd">Quantity**2 + Shipping_Cost**2</strong> &lt; 500")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qf"><img src="../Images/da81faebfb63492242782ab8eeae7d84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4sEQ0vpts9TahUzRjWdCUQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">query()函数中的复杂数学运算|作者图片</p></figure><p id="9093" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可能已经注意到，使用query()函数进行复杂的计算是多么简单。</p><p id="e475" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">但是，您并不仅限于使用不同的数学运算，而是可以在查询表达式中使用内置函数。</p><h1 id="1821" class="oq mk it bd or os ot ou ov ow ox oy oz ki pa kj pb kl pc km pd ko pe kp pf pg bi translated">熊猫查询中的内置函数</h1><p id="0457" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">Python内置的函数如<code class="fe mw mx my mf b">sqrt()</code>、<code class="fe mw mx my mf b">abs()</code>、<code class="fe mw mx my mf b">factorial()</code>、<code class="fe mw mx my mf b">exp()</code>等可以很容易地在查询表达式中使用。您可以像在正常用例中一样直接使用它。</p><h2 id="2c05" class="mj mk it bd or pm pn dn ov po pp dp oz lr pq pr pb lv ps pt pd lz pu pv pf iz bi translated">示例1</h2><p id="dfc9" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">检索单价的平方根大于15的所有行。因此这里将使用内置函数— <code class="fe mw mx my mf b">sqrt()</code>。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="b6ec" class="mj mk it mf b gy ml mm l mn mo">df.query(<strong class="mf jd">"sqrt(UnitPrice) &gt; 15"</strong>)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qg"><img src="../Images/2cfbfc825c85cef1cc259ca25fd6089f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8oPqPZm8gpkP2EIwDbtiGw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">在Pandas query()中使用内置函数|图片作者</p></figure><p id="8ce6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">很简单！该查询将返回单价超过225的所有行。</p><p id="6d58" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此外，query()函数非常灵活，您还可以在同一个查询表达式中使用内置函数和数学函数。</p><h2 id="3165" class="mj mk it bd or pm pn dn ov po pp dp oz lr pq pr pb lv ps pt pd lz pu pv pf iz bi translated">示例2</h2><p id="1fcc" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">获得所有单价的平方根小于一半运费的记录是如此简单，你可以用——</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="4cd0" class="mj mk it mf b gy ml mm l mn mo">df.query("<strong class="mf jd">sqrt(UnitPrice) &lt; Shipping_Cost/2</strong>")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qf"><img src="../Images/ed2e651bb5a14d5e957701f36f6b5df7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0j_acyTAAaEaI1eEZ7jpbg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">数学和内置函数在查询表达式|作者图片中的组合</p></figure><p id="0ca5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这样，您可以使用不同复杂程度的多个条件来过滤数据集。这也是使用一个简单的查询。✅</p><p id="6254" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">到目前为止，您观察到的所有查询示例都是关于数字和文本列的。但是，query()的用法并不仅限于这些数据类型。</p><p id="6607" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">通常，您需要根据日期时间值过滤数据帧。query()函数非常灵活，您可以根据日期和时间值轻松过滤数据集，这一点您可以在下一节中了解。</p><h1 id="e832" class="oq mk it bd or os ot ou ov ow ox oy oz ki pa kj pb kl pc km pd ko pe kp pf pg bi translated">基于日期-时间列进行筛选</h1><p id="a1b3" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">使用query()函数根据日期时间值过滤数据帧的唯一要求是，包含这些值的列的数据类型应该是<code class="fe mw mx my mf b"><strong class="lk jd">datetime64[ns]</strong></code> <strong class="lk jd"> </strong> ✅</p><p id="2ba5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我们的示例数据集中，OrderDate列包含日期时间值，但它被解析为字符串值。您可以很容易地<a class="ae lh" rel="noopener" target="_blank" href="/change-column-data-type-in-pandas-954d7acdef1d">将该列转换成所需的数据类型</a>,使用—</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="3b63" class="mj mk it mf b gy ml mm l mn mo">df["OrderDate"] = <strong class="mf jd">pd.to_datetime</strong>(df["OrderDate"], format="%Y-%m-%d")</span></pre><p id="edb0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，您已经准备好使用<code class="fe mw mx my mf b">query()</code>中的日期-时间列过滤数据帧。要提取关于日期的有用信息并在query()函数中使用它们，<code class="fe mw mx my mf b"><strong class="lk jd">dt</strong></code>访问器非常方便。</p><blockquote class="mp mq mr"><p id="8812" class="li lj ms lk b ll lm kd ln lo lp kg lq mt ls lt lu mu lw lx ly mv ma mb mc md im bi translated">📌<strong class="lk jd"> dt </strong>是一个访问器对象，用于提取日期时间序列的类似日期时间的属性。</p></blockquote><p id="0ff5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们探索一下可以根据日期时间值过滤数据集的不同方法。</p><h2 id="224c" class="mj mk it bd or pm pn dn ov po pp dp oz lr pq pr pb lv ps pt pd lz pu pv pf iz bi translated">示例1</h2><p id="2342" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">假设您想要获取订单日期在八月份的所有记录。你需要做的就是—</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="5589" class="mj mk it mf b gy ml mm l mn mo">df.query("<strong class="mf jd">OrderDate.dt.month == 8</strong>")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qf"><img src="../Images/38c5a82c4a1cfbb5d86df47204afddc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xgzAwssT51ew5qSKruM9bg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">使用query()中的日期筛选数据集|按作者排序的图像</p></figure><p id="e2ef" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如您所见，所有记录都有八月份的订单日期。<code class="fe mw mx my mf b"><strong class="lk jd">OrderDate.dt.month</strong></code> <strong class="lk jd"> </strong>展示了如何使用<code class="fe mw mx my mf b"><strong class="lk jd">dt</strong></code>访问器从整个日期值中只提取月份。</p><p id="9dc8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">进一步过滤，假设您想要获得2021年8月的所有订单，其中订单日为15或更多。你可以通过——</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="9b57" class="mj mk it mf b gy ml mm l mn mo">df.query("<strong class="mf jd">OrderDate.dt.month == 8 and OrderDate.dt.year == 2021 and OrderDate.dt.day &gt;=15</strong>")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qh"><img src="../Images/4dc22ecc1952c6e5a4431e5a54238997.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_30mWdu1l5zVtm3_DBGqGQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">根据日期-时间变量的多个条件进行筛选|按作者排序的图片</p></figure><p id="c88f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">尽管这是一个典型的<code class="fe mw mx my mf b"><strong class="lk jd">dt</strong></code>访问器的例子，并且在同一列上组合多个条件，但是这个表达式似乎太长了，因此不是一个好的实践。</p><p id="cd8b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">编写它只是为了演示如何使用<code class="fe mw mx my mf b"><strong class="lk jd">dt</strong></code>操作符提取数据的不同部分，以及如何组合多个条件。</p><p id="2c3f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，您可以通过编写非常简单表达式得到完全相同的输出，如下所示</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="8d6f" class="mj mk it mf b gy ml mm l mn mo">df.query("<strong class="mf jd">OrderDate &gt;= '2021-08-15' and OrderDate &lt;= '2021-08-31'</strong>")</span></pre><p id="f077" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此外，您还可以在单个表达式中组合日期-时间列上的条件和任何其他列上的条件。💯</p><h2 id="d651" class="mj mk it bd or pm pn dn ov po pp dp oz lr pq pr pb lv ps pt pd lz pu pv pf iz bi translated">示例2</h2><p id="79c0" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">例如，检索订单日期为前一个示例且状态为Delivered的所有记录非常简单，查询表达式为</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="5bed" class="mj mk it mf b gy ml mm l mn mo">df.query("<strong class="mf jd">OrderDate &gt;= '2021-08-15' and OrderDate &lt;= '2021-08-31' and Status == 'Delivered'</strong>")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qi"><img src="../Images/630f78d88557455ff0b3a63c9ddc9427.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x5ldljKtmEinLSW4_XTsGw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">根据不同列的多个条件进行筛选|按作者排序的图片</p></figure><p id="de30" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">它返回表达式计算为True的所有记录。同样，这只是一个演示如何在单个查询中组合日期-时间和文本列条件的示例。</p><p id="8f92" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">到目前为止，您只指定了要在query()函数中计算的表达式。然而，该函数还采用了另一个可选参数— <code class="fe mw mx my mf b"><strong class="lk jd">inplace</strong></code></p><h1 id="ebb0" class="oq mk it bd or os ot ou ov ow ox oy oz ki pa kj pb kl pc km pd ko pe kp pf pg bi translated">就地熊猫查询功能</h1><p id="252d" class="pw-post-body-paragraph li lj it lk b ll ph kd ln lo pi kg lq lr pj lt lu lv pk lx ly lz pl mb mc md im bi translated">在所有示例中，您都可以看到df.query()生成了一个新的数据帧。这是因为query() — <code class="fe mw mx my mf b"><strong class="lk jd"> inplace</strong></code> —的第二个参数默认设置为False。</p><p id="ce8d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，即使在多个条件下过滤数据帧后，如果您检查数据帧的大小，它将显示9999 x 12的原始大小</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="fb33" class="mj mk it mf b gy ml mm l mn mo"><strong class="mf jd">df.shape</strong></span><span id="8ed4" class="mj mk it mf b gy qj mm l mn mo"># output<br/><strong class="mf jd">(9999, 12)</strong></span></pre><p id="da76" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，使用<code class="fe mw mx my mf b"><strong class="lk jd">inplace=False</strong></code>，查询没有修改原始数据集。当你想改变原始数据帧时，只需点击<code class="fe mw mx my mf b">inplace=True</code>。</p><p id="b10a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">🚨但是要小心使用<code class="fe mw mx my mf b"> inplace=True</code>，因为它会覆盖原始数据帧。因此，一旦执行了带有此选项的查询，就没有机会恢复原始数据帧。</p><p id="a958" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">以上就是使用query()过滤数据点的全部内容！</p></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><p id="cdb9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我希望你发现这篇文章非常有用，令人耳目一新，并且你学会了一些非常酷的过滤熊猫数据帧的技巧。我确信，读完这篇文章后，你会更频繁、更流利地使用pandas query()函数。</p><p id="dd69" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">过去4年多以来，我一直在使用Python进行数据分析，并发现query()函数最便于过滤数据集。这些技巧中的大部分，我每天都在工作中使用。</p><blockquote class="nq"><p id="2705" class="nr ns it bd nt nu nv nw nx ny nz md dk translated">有兴趣在媒体上阅读更多的故事吗？？</p></blockquote><p id="c48c" class="pw-post-body-paragraph li lj it lk b ll oc kd ln lo od kg lq lr ql lt lu lv qm lx ly lz qn mb mc md im bi translated">💡考虑<a class="ae lh" href="https://medium.com/@17.rsuraj/membership" rel="noopener"> <strong class="lk jd">成为媒体会员</strong> </a>到<strong class="lk jd">访问媒体上无限的</strong>故事和每日有趣的媒体文摘。我会得到你的费用的一小部分，没有额外的费用给你。</p><p id="0793" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">💡请务必<a class="ae lh" href="https://medium.com/subscribe/@17.rsuraj" rel="noopener"> <strong class="lk jd">注册我的电子邮件列表</strong> </a>以免错过另一篇关于数据科学指南、技巧和提示、SQL和Python的文章。</p><p id="879b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">💡这里有一个完整的<a class="ae lh" href="https://github.com/17rsuraj/data-curious/blob/master/TowardsDataScience/pandas_query_deep_dive.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd">笔记本</strong> </a>里面有所有的例子。</p><p id="9114" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">感谢您的阅读！</strong></p></div></div>    
</body>
</html>