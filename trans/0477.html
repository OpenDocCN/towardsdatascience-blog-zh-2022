<html>
<head>
<title>Top Encoders for Data Scientists</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据科学家的顶级编码器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/top-encoders-for-data-scientists-fbc8dce42531#2022-02-18">https://towardsdatascience.com/top-encoders-for-data-scientists-fbc8dce42531#2022-02-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="fa12" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">意见</h2><div class=""/><div class=""><h2 id="7980" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">2022年，为您的机器学习算法提供更好的分类编码方法(而不是一次性编码)</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/05f9741cad0d330b3528fa0c53b6d30d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PKSYjSIVXR_KCxLV"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">桑迪·米勒在<a class="ae lh" href="https://unsplash.com/s/photos/transform?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a>【1】上拍摄的照片。</p></figure></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="9283" class="lp lq it bd lr ls lt lu lv lw lx ly lz ki ma kj mb kl mc km md ko me kp mf mg bi translated">目录</h1><ol class=""><li id="7924" class="mh mi it mj b mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">介绍</li><li id="6f18" class="mh mi it mj b mk mz mm na mo nb mq nc ms nd mu mv mw mx my bi translated">目标编码器</li><li id="396f" class="mh mi it mj b mk mz mm na mo nb mq nc ms nd mu mv mw mx my bi translated">CatBoost编码器</li><li id="85a8" class="mh mi it mj b mk mz mm na mo nb mq nc ms nd mu mv mw mx my bi translated">CatBoost库自动编码器</li><li id="4f46" class="mh mi it mj b mk mz mm na mo nb mq nc ms nd mu mv mw mx my bi translated">摘要</li><li id="499f" class="mh mi it mj b mk mz mm na mo nb mq nc ms nd mu mv mw mx my bi translated">参考</li></ol><h1 id="4452" class="lp lq it bd lr ls ne lu lv lw nf ly lz ki ng kj mb kl nh km md ko ni kp mf mg bi translated">介绍</h1><p id="a772" class="pw-post-body-paragraph nj nk it mj b mk ml kd nl mm mn kg nm mo nn no np mq nq nr ns ms nt nu nv mu im bi translated">曾经的编码统治者，<em class="nw">一键编码</em>，已经不复存在。更新、更好、更简单的编码方法已经出现，并开始取代传统的编码类型。在一个算法实现更快、特性可解释性更好的世界里，等等。，数据科学过程中仍有一部分相当陈旧和缺乏——编码——它花费的时间太长、太乏味、太混乱。并非所有的模型，但在一些模型中，是不能被模型吸收的分类特征。您会看到错误，并想，<em class="nw">为什么我不能使用一个看起来如此明显的特性，为什么我必须将我的数据框架扩展到数百列</em>？这些新的编码方法使您能够将更多的精力放在您想要使用的功能上，有些功能非常明显，而不是您愿意花费时间来消化它们。话虽如此，让我们更深入地探讨一下，如何通过对分类特征进行更好的编码来获得更好的结果。</p><h1 id="0565" class="lp lq it bd lr ls ne lu lv lw nf ly lz ki ng kj mb kl nh km md ko ni kp mf mg bi translated">目标编码器</h1><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/f44c9d43eb3b79c64c1cf8e5b40e0497.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*N3_6BJTGVesnvWzv"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://unsplash.com/@brady_bellini?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">布雷迪·贝里尼</a>在<a class="ae lh" href="https://unsplash.com/s/photos/target?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a>【2】上的照片。</p></figure><p id="2480" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated">以下编码器就是基于这种目标编码方法构建的。根据<a class="ae lh" href="https://contrib.scikit-learn.org/category_encoders/targetencoder.html" rel="noopener ugc nofollow" target="_blank">sci kit-learn</a>【3】，“<em class="nw">特征被替换为目标的后验概率，以及目标在你的训练数据上的先验概率</em>”。更简单地说，当您有一个分类特性时，您可以将列值从一个文本值/字符串替换为该分类值的数字表示。</p><blockquote class="oc od oe"><p id="ff04" class="nj nk nw mj b mk nx kd nl mm ny kg nm of nz no np og oa nr ns oh ob nu nv mu im bi translated">以下是您将用于此编码的通用代码:</p></blockquote><pre class="ks kt ku kv gt oi oj ok ol aw om bi"><span id="6664" class="on lq it oj b gy oo op l oq or">pip install category_encoders</span><span id="194f" class="on lq it oj b gy os op l oq or"><strong class="oj jd">import</strong> <strong class="oj jd">category_encoders</strong> <strong class="oj jd">as</strong> <strong class="oj jd">ce</strong></span><span id="29b7" class="on lq it oj b gy os op l oq or">target_encoder = ce.TargetEncoder(cols=['cat_col_1', 'cat_col_2'])</span><span id="52a4" class="on lq it oj b gy os op l oq or">target_encoder.fit(X, y)</span><span id="8c1d" class="on lq it oj b gy os op l oq or">X_transformed = target_encoder.transform(X_pre_encoded)</span></pre><p id="2298" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated">所以，假设你有:</p><ul class=""><li id="9943" class="mh mi it mj b mk nx mm ny mo ot mq ou ms ov mu ow mw mx my bi translated">cat_col_1 =动物</li><li id="e7ff" class="mh mi it mj b mk mz mm na mo nb mq nc ms nd mu ow mw mx my bi translated">cat_col_2 =天气类型</li></ul><p id="7669" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated">您可以用一个实际的float代替one-hot-encoding，one-hot-encoding会将可能的值转置到新的列中，如果实际上是该类别值，则表示为0/1。</p><p id="3253" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated">此外，不是<code class="fe ox oy oz oj b">dog</code>、<code class="fe ox oy oz oj b">fish</code>、<code class="fe ox oy oz oj b">cat</code>，你会有→ 0.33、. 20、. 10等。根据你的数据，和天气类型类似的东西，比如<code class="fe ox oy oz oj b">raining</code>、<code class="fe ox oy oz oj b">sunny</code>、<code class="fe ox oy oz oj b">snowing</code> → 0.05、. 60、. 05等。</p><p id="264a" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated"><em class="nw">这种目标编码方法也是接下来两种方法的基础方法。</em></p><h1 id="8766" class="lp lq it bd lr ls ne lu lv lw nf ly lz ki ng kj mb kl nh km md ko ni kp mf mg bi translated">CatBoost编码器</h1><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/88cdc8fa137f9c00310b64147bb54272.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*255PNzdi-A5SGp65"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">詹姆斯·萨顿在<a class="ae lh" href="https://unsplash.com/s/photos/cat?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a>【4】上的照片。</p></figure><p id="40a8" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated">与上面的编码器类似，字符串/文本、对象或类别值类型将被替换为浮点型。代码也是一样的，除了用<code class="fe ox oy oz oj b">CatBoostEncoder</code>替换<code class="fe ox oy oz oj b">TargetEncoder</code>。</p><p id="c46e" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated">使用这种目标编码方法将编码器应用于分类要素的另一个好处是，您不仅可以减少数据帧的维数，还可以通过另一个库(如SHAP)更容易地了解分类要素的要素重要性。</p><p id="28f8" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated"><a class="ae lh" href="https://contrib.scikit-learn.org/category_encoders/catboost.html" rel="noopener ugc nofollow" target="_blank"> CatBoost编码</a> [5]更好使用，因为它通过过去数据的有序目标编码以及更多随机排列来防止目标泄漏。</p><blockquote class="oc od oe"><p id="bf40" class="nj nk nw mj b mk nx kd nl mm ny kg nm of nz no np og oa nr ns oh ob nu nv mu im bi translated">从CatBoost文档中，我们可以看到该方法是下面的<a class="ae lh" href="https://catboost.ai/en/docs/concepts/algorithm-main-stages_cat-to-numberic" rel="noopener ugc nofollow" target="_blank">方法</a>【6】，主要有以下好处，对此我表示赞同:</p></blockquote><ul class=""><li id="18e5" class="mh mi it mj b mk nx mm ny mo ot mq ou ms ov mu ow mw mx my bi translated">改变输入的随机顺序和数据类型的转换</li><li id="4a24" class="mh mi it mj b mk mz mm na mo nb mq nc ms nd mu ow mw mx my bi translated">通过利用不仅仅是数字特征来改进培训，因此您在预处理数据上花费的时间更少</li></ul><h1 id="252e" class="lp lq it bd lr ls ne lu lv lw nf ly lz ki ng kj mb kl nh km md ko ni kp mf mg bi translated">CatBoost库自动编码器</h1><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/0661baab9b64df329b626ac13dfe09f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QJfDMhPgGPsQgOsy"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://unsplash.com/@gerandeklerk?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Geran de Klerk </a>在<a class="ae lh" href="https://unsplash.com/s/photos/two-cats?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a>【7】上拍摄。</p></figure><p id="1eaa" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated">有了一种全新的名为CatBoost的算法，可以自动对数据的类别数据类型进行编码，而不必手动对数据应用编码器。该算法结合了目标编码的优点，特别是CatBoost编码的优点，此外，还在本机代码中实现了功能解释。</p><p id="204e" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated">虽然它与上面的编码器没有什么不同，但它甚至更容易使用，对我来说，这是对分类特征进行编码的最简单的方法，特别是当您还处理有时会混淆的数字特征时(<em class="nw">两种数据类型</em>)。</p><p id="847f" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated">这种编码器不仅更容易使用，算法库和编码器经常击败大多数其他算法，包括Random Forest和XGBoost，这在CatBoosts的主页上有文档记录。</p><blockquote class="oc od oe"><p id="5727" class="nj nk nw mj b mk nx kd nl mm ny kg nm of nz no np og oa nr ns oh ob nu nv mu im bi translated">以下是用Python实现CatBoost代码的简单方法:</p></blockquote><pre class="ks kt ku kv gt oi oj ok ol aw om bi"><span id="4e6e" class="on lq it oj b gy oo op l oq or"># import your library<br/>from catboost import CatBoostRegressor</span><span id="46a6" class="on lq it oj b gy os op l oq or">CAT_FEATURES = [] #list of your categorical features</span><span id="4cb4" class="on lq it oj b gy os op l oq or"># set up the model<br/>catboost_model = CatBoostRegressor(n_estimators=100,<br/>                                   loss_function = 'RMSE',<br/>                                   eval_metric = 'RMSE',<br/>                                   cat_features = CAT_FEATURES)<br/># fit model<br/>catboost_model.fit(X_train, y_trian, <br/>                   eval_set = (X_test, y_test),<br/>                   use_best_model = True,<br/>                   plot = True)</span><span id="b496" class="on lq it oj b gy os op l oq or"># easily print out your SHAP feature importances, including your CAT_FEATURES</span><span id="1653" class="on lq it oj b gy os op l oq or">shap_values = catboost_model.get_feature_importance(Pool(<br/>                       X_train,<br/>                       label = y_train,<br/>                       cat_features = CAT_FEATURES<br/>),type = "ShapValues")</span><span id="3999" class="on lq it oj b gy os op l oq or">shap_values = shap_values[:,:-1]</span><span id="0809" class="on lq it oj b gy os op l oq or">shap.summary_plot(shap_values, X_train, max_display=50)</span></pre><h1 id="99bd" class="lp lq it bd lr ls ne lu lv lw nf ly lz ki ng kj mb kl nh km md ko ni kp mf mg bi translated">摘要</h1><p id="d10f" class="pw-post-body-paragraph nj nk it mj b mk ml kd nl mm mn kg nm mo nn no np mq nq nr ns ms nt nu nv mu im bi translated">正如你所看到的，数据科学总是在不断发展，编码方法也不例外。在本文中，我们看到了一些与分类变量的one-hot-enoding相反的替代方法。好处包括能够在总体上利用分类特征，以及通过更简单的解释轻松地接受它们，最终允许更快、更便宜(<em class="nw">有时</em>)和更准确的建模。</p><blockquote class="oc od oe"><p id="dcfd" class="nj nk nw mj b mk nx kd nl mm ny kg nm of nz no np og oa nr ns oh ob nu nv mu im bi translated">总而言之，以下是较好的编码类型:</p></blockquote><pre class="ks kt ku kv gt oi oj ok ol aw om bi"><span id="6d4e" class="on lq it oj b gy oo op l oq or">* Target Encoder</span><span id="2901" class="on lq it oj b gy os op l oq or">* CatBoost Encoder</span><span id="f154" class="on lq it oj b gy os op l oq or">* CatBoost Library Automatic Encoder</span></pre><p id="7f50" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated">我希望你觉得我的文章既有趣又有用。如果您同意或不同意这些编码器，请随时在下面发表评论。为什么或为什么不？关于数据科学预处理，您认为还有哪些编码器值得指出？这些当然可以进一步澄清，但我希望我能够为您的数据和数据科学模型提供一些更有益的编码器。</p><p id="66b3" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated"><strong class="mj jd"> <em class="nw">我不隶属于这些公司。</em> </strong></p><p id="6541" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated"><em class="nw">请随时查看我的个人资料、</em> <a class="pa pb ep" href="https://medium.com/u/abe5272eafd9?source=post_page-----fbc8dce42531--------------------------------" rel="noopener" target="_blank"> Matt Przybyla </a>、<em class="nw">和其他文章，并通过以下链接订阅接收我的博客的电子邮件通知，或通过点击屏幕顶部的订阅图标</em>  <em class="nw">点击订阅图标</em> <strong class="mj jd"> <em class="nw">，如果您有任何问题或意见，请在LinkedIn上联系我。</em></strong></p><p id="4e2f" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated"><strong class="mj jd">订阅链接:【https://datascience2.medium.com/subscribe】<a class="ae lh" href="https://datascience2.medium.com/subscribe" rel="noopener"/></strong></p><p id="e0ed" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated"><strong class="mj jd">引荐链接:</strong><a class="ae lh" href="https://datascience2.medium.com/membership" rel="noopener">https://datascience2.medium.com/membership</a></p><p id="5444" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated">(<em class="nw">如果你在Medium </em>上注册会员，我会收到一笔佣金)</p><h1 id="c2e2" class="lp lq it bd lr ls ne lu lv lw nf ly lz ki ng kj mb kl nh km md ko ni kp mf mg bi translated">参考</h1><p id="d7c9" class="pw-post-body-paragraph nj nk it mj b mk ml kd nl mm mn kg nm mo nn no np mq nq nr ns ms nt nu nv mu im bi translated">[1]桑迪·米勒在<a class="ae lh" href="https://unsplash.com/s/photos/transform?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片，(2021)</p><p id="2f2e" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated">[2]照片由<a class="ae lh" href="https://unsplash.com/@brady_bellini?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">布雷迪·贝里尼</a>在<a class="ae lh" href="https://unsplash.com/s/photos/target?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a>(2021)拍摄</p><p id="95ac" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated">[3] Will McGinnis，<a class="ae lh" href="https://contrib.scikit-learn.org/category_encoders/targetencoder.html" rel="noopener ugc nofollow" target="_blank">sci kit-学习目标编码器</a>，(2016)</p><p id="defc" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated">[4]詹姆斯·萨顿(James Sutton)在<a class="ae lh" href="https://unsplash.com/s/photos/cat?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片，(2018)</p><p id="e3f6" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated">[5] Will McGinnis，<a class="ae lh" href="https://contrib.scikit-learn.org/category_encoders/catboost.html" rel="noopener ugc nofollow" target="_blank"> scikit-learn CatBoost编码器</a>，(2016)</p><p id="00a3" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated">[6] Yandex，<a class="ae lh" href="https://catboost.ai/en/docs/concepts/algorithm-main-stages_cat-to-numberic" rel="noopener ugc nofollow" target="_blank"> CatBoost —分类—数字</a>，(2022)</p><p id="434b" class="pw-post-body-paragraph nj nk it mj b mk nx kd nl mm ny kg nm mo nz no np mq oa nr ns ms ob nu nv mu im bi translated">[7]图片由<a class="ae lh" href="https://unsplash.com/@gerandeklerk?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Geran de Klerk </a>在<a class="ae lh" href="https://unsplash.com/s/photos/two-cats?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplas</a>(2017)上拍摄</p></div></div>    
</body>
</html>