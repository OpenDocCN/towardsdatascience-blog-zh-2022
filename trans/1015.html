<html>
<head>
<title>Three steps for expanding my Tabular model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">扩展我的表格模型的三个步骤</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/three-steps-for-expanding-my-tabular-model-9e2d939378d7#2022-03-16">https://towardsdatascience.com/three-steps-for-expanding-my-tabular-model-9e2d939378d7#2022-03-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3416" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在 Power BI 中扩展数据模型是一项日常任务。我们定期这么做。但是，大多数时候，我们没有考虑我们需要采取的三个必要步骤。让我们深入研究一下。</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/acb6607a8f505dd983fda4809f68cf8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7qhTScB0hjvEVYBr"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">由<a class="ae kz" href="https://unsplash.com/@lindsayhenwood?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">林赛·亨伍德</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="e836" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">介绍</h1><p id="c145" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">每当我们必须改变我们的数据模型时，我们必须首先理解需求。</p><p id="c68d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">一旦我们知道需要什么，我们就必须:</p><ol class=""><li id="5e5a" class="mt mu it lu b lv mo ly mp mb mv mf mw mj mx mn my mz na nb bi translated">定义目标数据模型</li><li id="9e26" class="mt mu it lu b lv nc ly nd mb ne mf nf mj ng mn my mz na nb bi translated">获取和准备数据</li><li id="8c6e" class="mt mu it lu b lv nc ly nd mb ne mf nf mj ng mn my mz na nb bi translated">完成数据模型并计算和测试结果</li></ol><p id="fa95" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">大多数时候，我们是凭直觉做到这一点的。</p><p id="0035" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">但有时，我们需要重新考虑我们必须做什么以及如何去做。</p><p id="4437" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">虽然下面解释的需求是相对具体的，但是我将使用标准方法来满足这些需求。正如你将看到的，我会遇到一些不寻常的挑战，我会告诉你如何解决它们。</p><h1 id="455f" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">要求</h1><p id="3f10" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">我的一个客户问我，他如何根据年销售额对客户进行分类，并在 Power BI 的切片器中使用这些分类。</p><p id="1420" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">因此，我需要创建一个计算列来计算每个客户每年的销售额，并将分类分配给客户。</p><p id="5ce9" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">让我们来完成这些步骤。我们会在前进的道路上发现一些绊脚石。</p><h1 id="d331" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">步骤 1 —数据建模</h1><p id="6d7b" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">下图显示了原始数据模型:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nh"><img src="../Images/d0df749daba76e97e7163fffc0976290.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FNRDQPwGVSz4SuFY136EMQ.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图 1 —原始数据模型(作者绘制)</p></figure><p id="c300" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">从逻辑的角度来看，我们需要创建一个结合所有客户和所有年份的表。然后，我们可以计算每个客户每年的销售额，对每个客户进行分类。</p><p id="a67b" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">下面您会看到带有附加表的数据模型:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ni"><img src="../Images/f11b082a8fac87bcdfda1ca418610493.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-AWoKW84VcQldxHioGCSPw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图 2 —数据模型(起点)(作者绘制)</p></figure><p id="3fc1" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">新的<em class="nj">每年客户分类</em>表与客户表中的客户 Id 和日期表中的年份相关联。从而创建了一个与数据表的 m:n 关系。</p><p id="d979" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">因为我想用客户类别的选择来过滤日期<strong class="lu iu">和</strong>客户表，所以我需要将关系设置为双向过滤:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ni"><img src="../Images/7ec6cfe7bbc57fb4994466e9c8dbde56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UtkkKjnHS3aTexJfHx4Q_A.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图 3 —双向过滤的数据模型(作者绘制)</p></figure><p id="1d19" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">但是，这种配置给数据模型带来了不确定性:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nk"><img src="../Images/05f203608d1038a8588f7e46b1587e92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MiazV613M-FD-h5eXYhhfA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图 4 —不明确的数据模型(由作者绘制)</p></figure><p id="e212" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">如您所见，Sales 表可以通过多条路径到达。表格模型不允许这样的配置。</p><p id="42f9" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">当我试图将第二个关系设置为交叉筛选时，我得到一条错误消息:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nl"><img src="../Images/19915b9ab7b6788602fcfe20023d441f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xbrs_VoPrPNwi2y0_Ip6qg.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图 5 —不明确的错误消息(作者提供的图片)</p></figure><p id="2c2f" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这个特性确保了我的数据模型不会有歧义。</p><p id="a25d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">由于这种方法行不通，我们需要将逻辑视图转移到技术视图来解决这个问题。</p><p id="921e" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在继续之前，花点时间尝试自己找到解决方案:</p><p id="7feb" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi">.</p><p id="3873" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi">.</p><p id="3a11" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi">.</p><p id="3ea4" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi">.</p><p id="101b" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在 Power BI 或 Analysis Services (SSAS)的表格模型中建模数据的一个原则是避免雪花模式，如上所示。重温一段感情需要时间。这同样适用于使用雪花来过滤数据。</p><p id="88ff" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">参加 SQLBI 关于数据建模的免费在线课程可以获得关于这个主题的很好的解释。</p><p id="8db8" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">或者观看以下来自 SQLBI 的关于模糊性问题的视频:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="e75f" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">好吧，有什么解决办法？</p><p id="8e3d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我们需要改变模型，在新的每年客户分类表和销售表之间建立联系:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi no"><img src="../Images/6d11b3504cf28ccd6148ba7efa5406d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uL35VE1fvCir29S1hTpSjA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图 6 —目标数据模型(由作者绘制)</p></figure><p id="adcc" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">为了实现这一点，我们需要在两个表中添加一个额外的列，将 CustomerKey 和订单年份结合起来</p><p id="75fc" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">下一步，我们将准备数据来满足这些要求。</p><h1 id="88c5" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">步骤 2 —数据准备</h1><p id="0d08" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">首先，我们必须决定在哪里准备数据。</p><p id="6395" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">当我们有一个关系数据库作为数据源时，我们可以在数据库中创建一个视图，或者添加一个新表并定期刷新数据。</p><p id="b136" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">如果这是不可能的，我们可以使用数据库查询或使用 Power Query 来准备数据。</p><p id="74bd" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在我的例子中，不允许我更改源上的数据库。</p><p id="3fa8" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">但是在将数据导入 Power BI 时，我可以通过查询添加新表。</p><p id="9236" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">但是，我们有两种方法来准备新表:</p><ol class=""><li id="0f11" class="mt mu it lu b lv mo ly mp mb mv mf mw mj mx mn my mz na nb bi translated">从所有客户与所有年份的组合来看</li><li id="fc67" class="mt mu it lu b lv nc ly nd mb ne mf nf mj ng mn my mz na nb bi translated">来自销售表中客户和订单日期的组合</li></ol><p id="a787" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这两种变体之间的区别如下:</p><ul class=""><li id="620a" class="mt mu it lu b lv mo ly mp mb mv mf mw mj mx mn np mz na nb bi translated">使用 Customer 表时，每个客户和年份都有一行，不管该客户在该年是否下了订单</li><li id="e1ca" class="mt mu it lu b lv nc ly nd mb ne mf nf mj ng mn np mz na nb bi translated">使用 Sales 表时，您将只获得每年下订单的客户的行</li><li id="b4d9" class="mt mu it lu b lv nc ly nd mb ne mf nf mj ng mn np mz na nb bi translated">使用销售表时，您将得到一个更短的表</li></ul><p id="c5ee" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">您需要根据自己的需求来决定哪种变体最适合您:</p><ul class=""><li id="e65a" class="mt mu it lu b lv mo ly mp mb mv mf mw mj mx mn np mz na nb bi translated">如果您只对某一年有订单的客户感兴趣，那么可以使用销售表</li><li id="1093" class="mt mu it lu b lv nc ly nd mb ne mf nf mj ng mn np mz na nb bi translated">当您对所有客户都感兴趣时，不管订单如何，请使用客户表</li></ul><p id="2528" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">根据源系统的不同，加载时间会有所不同。您必须用您的源系统测试这一点。<a class="ae kz" href="https://docs.microsoft.com/en-us/power-query/power-query-folding" rel="noopener ugc nofollow" target="_blank">查询折叠</a>可以在这个场景中产生显著的不同。</p><h1 id="62b7" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">通过查询获取数据</h1><p id="4e33" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">从数据库中，我们可以使用以下查询从 Customer 表中获取数据:</p><pre class="kk kl km kn gt nq nr ns nt aw nu bi"><span id="5aef" class="nv lb it nr b gy nw nx l ny nz">WITH [Years]<br/>AS<br/>    (SELECT DISTINCT [Year]<br/>        FROM [dbo].[Date])<br/>    SELECT [CustomerKey]<br/>        ,[Year]<br/>        ,CONVERT(nvarchar(50)<br/>              , [CustomerKey]) + ‘_’ + CONVERT(nvarchar(50), [Year]) AS [CustomerPerYear]<br/>      FROM [dbo].[DimCustomer]<br/>           CROSS JOIN [Years];</span></pre><p id="e6d9" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">或者类似下面的查询，当从 Sales 表中获取数据时:</p><pre class="kk kl km kn gt nq nr ns nt aw nu bi"><span id="93a5" class="nv lb it nr b gy nw nx l ny nz">SELECT DISTINCT CONVERT(nvarchar(30), [CustomerKey]) + ‘_’ + CONVERT(nvarchar(30), YEAR([OrderDate]) )<br/>    FROM [dbo].[V_FactOnlineSales];</span></pre><p id="4e30" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">但是有时候，你必须使用 Power Query 来准备你的数据。</p><p id="1ce5" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">例如，当源数据不是来自关系数据库，或者您不具备所需的技能时。</p><h1 id="0226" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">使用 Power Query 获取数据</h1><p id="9b1d" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">让我们看看如何使用 Customers 表作为源为新表准备数据:</p><ol class=""><li id="9423" class="mt mu it lu b lv mo ly mp mb mv mf mw mj mx mn my mz na nb bi translated">打开 Power Query 并从 Customer 表中创建一个引用:</li></ol><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/80d81408252931466599e3c192f7f6cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*APJTAcRSc4CKLeHZx2uw4w.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图 7 —创建客户表的引用(作者提供的图片)</p></figure><p id="1e87" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">2.删除除客户密钥之外的所有其他列:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/2cdc296c2187a39d3caae88a0dae9785.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*e4JBcvA0flRxGU-_bh_MBw.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图 8 —删除所有列，除了自定义键(图片由作者提供)</p></figure><p id="909a" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">3.从日期表中添加自定义列:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oc"><img src="../Images/50d224b73960ed1e113a63dbe8ee7195.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4h5zJdTOp6mW-qrwlOrNmg.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图 9 —从日期表中添加一个定制列(作者提供的图片)</p></figure><p id="df87" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">4.展开日期表，仅使用年份列:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi od"><img src="../Images/821e1d03980337c563950cf14294015e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*u3p3wEAxdbKwYxLueZJhlA.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图 10 —展开数据表(作者提供的图片)</p></figure><p id="b536" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这一步对应于上面 SQL 语句中的交叉连接。它将 Customer 表的每一行与 date 表的 Year 列中的每个值相乘。</p><p id="b34e" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">5.选择剩余的列并删除所有重复的列:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/7bb607cc30f088cbdc05f17d45b43bf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*MYt7cAOxn0zqjBSleb3zKQ.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图 11 —删除所有重复项(图片由作者提供)</p></figure><p id="4b74" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在你看到结果了:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi of"><img src="../Images/9a91106cad9eb6852782656548e86fad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*vP1WRLCt8Tj3lomm0VSWeg.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图 12 —日期表中所有年份所有客户的结果(作者提供的图片)</p></figure><p id="2a7f" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">当使用 Sales 表作为新表的源时，过程是不同的。</p><p id="6a14" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">首先，您必须在 Sales 表中创建键列，结合 CustomerKey 和 Year:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi og"><img src="../Images/c936bb5d09457e679167500632235bfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ISgw8f80Daw9uRHTwTFouA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图 13 —添加新的键列(作者提供的图片)</p></figure><p id="c18c" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">对新表使用以下表达式:</p><pre class="kk kl km kn gt nq nr ns nt aw nu bi"><span id="6160" class="nv lb it nr b gy nw nx l ny nz">Text.From ( [CustomerKey] ) &amp; “_” &amp; Text.From ( [OrderYear] ))</span></pre><p id="3ad0" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在 sales 表中，可以使用下列表达式之一:</p><p id="6b28" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">当您有一个数字日期键列时，可以使用下面的表达式，如 20220322:</p><pre class="kk kl km kn gt nq nr ns nt aw nu bi"><span id="686b" class="nv lb it nr b gy nw nx l ny nz">Text-From ( [CustomerKey] )<br/>    &amp; “_”<br/>    &amp; Text.From ( OrderDateKey / 10000 )</span></pre><p id="6a01" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">或者这个表达式，当 OrderDate 作为日期列时:</p><pre class="kk kl km kn gt nq nr ns nt aw nu bi"><span id="b4bc" class="nv lb it nr b gy nw nx l ny nz">Text.From ( [CustomerKey] )<br/>    &amp; “_”<br/>    &amp; Text.From ( Date.Year ( [OrderDate] ) )</span></pre><p id="d7c2" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">接下来，创建一个被引用的表，删除除新的 CustomerPerYear 列之外的所有列，并删除重复的列。</p><p id="9014" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在，您已经准备好将数据加载到数据模型中，并完成解决方案。</p><h1 id="503f" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">步骤 3 —完成数据模型并计算和测试结果</h1><p id="9c4b" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">下一步是在新的每年<em class="nj">客户分类</em>表和销售表之间添加一个关系:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oh"><img src="../Images/e4364a96e581c174034533c6dfee8940.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U5cAVo7GApN7hFvJ_9Vv_Q.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图 14 —带有新表的数据模型(作者提供的图片)</p></figure><p id="9dde" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">下一步是使用上下文转换来计算每个客户每年的销售额。</p><p id="502f" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">如果您不了解这种机制，可以阅读我关于上下文转换的文章:</p><div class="oi oj gp gr ok ol"><a rel="noopener follow" target="_blank" href="/whats-fancy-about-context-transition-in-dax-efb5d5bc4c01"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd iu gy z fp oq fr fs or fu fw is bi translated">DAX 中的语境转换有什么奇特之处</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">行和过滤器上下文是 DAX 中众所周知的概念。但是我们可以通过上下文转换在这两者之间切换。</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">towardsdatascience.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz kt ol"/></div></div></a></div><p id="ecd9" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">首先，我们创建一个调用现有销售度量值的计算列:</p><pre class="kk kl km kn gt nq nr ns nt aw nu bi"><span id="26ab" class="nv lb it nr b gy nw nx l ny nz">Sales per Year = [Online Sales (By Order Date)]</span></pre><p id="e096" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">下一步是验证结果。</p><p id="f00c" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我在我的报告中添加了一个矩阵，包括客户、年份和基本度量，比如销售额。现在，我可以使用矩阵中的结果与新表中的结果进行比较。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi pa"><img src="../Images/241176aa9b98bc597fe8ff8ba50ba6f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w0desCfHWtz6uWxWBJ1NcA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图 15 —结果的验证(作者提供的图片)</p></figure><p id="9001" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">下一步是添加计算分类的条件:</p><pre class="kk kl km kn gt nq nr ns nt aw nu bi"><span id="75a5" class="nv lb it nr b gy nw nx l ny nz">Category by Sales =</span><span id="9bb0" class="nv lb it nr b gy pb nx l ny nz">SWITCH( TRUE()<br/>    ,ISBLANK([Online Sales (By Order Date)]), “No Sales”<br/>        ,[Online Sales (By Order Date)] &lt; 10000, “Small Sales”<br/>        ,[Online Sales (By Order Date)] &gt;= 10000<br/>           &amp;&amp; [Online Sales (By Order Date)] &lt; 25000, “Medium Sales”<br/>        ,”Large Sales”<br/>        )</span></pre><p id="b1f6" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在可以创建一个度量来计算新的<em class="nj">客户每年分类</em>表中的行数(Counter = count rows(‘客户每年’))，从而创建一个如下所示的报告:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi pc"><img src="../Images/00228b63ee34c8a48f0e85d7ae80677c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mYWDCg9wqkisdEkbDGdR6A.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图 16 —包含每个类别的销售和客户(包括没有销售的客户)的报告(图片由作者提供)</p></figure><p id="bd42" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">要获得这个报告，您必须使用新表中的 Year 列。日期表中的年份列将不起作用。</p><p id="6394" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">有一个解决方案可以解决无法使用日期表的问题。</p><p id="7a45" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我邀请你思考这个问题，并写下你的解决方案作为回应。</p><h1 id="efbf" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">结论</h1><p id="9383" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">如您所见，逻辑或业务视图和技术解决方案之间可能存在差异。</p><p id="14a6" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">它有助于为您的模型创建计划更改的绘图。这样的绘图将有助于看到和理解计划中的变化的含义。</p><p id="9684" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这些要求对数据的准备有重大影响。您需要了解预期，以便根据需要准备数据。</p><p id="4f7b" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">完成数据模型的最后一步很简单，因为绘图已经包含了数据模型的定义。</p><p id="a56b" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">计算结果的 DAX 代码是最后一步，可能非常简单也可能非常复杂。计算也是由需求定义的。</p><p id="97f2" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">如您所见，对需求的理解对于解决方案的定义至关重要。理解需求所花的每一分钟都将节省您在实施解决方案过程中的时间。</p><p id="5ee6" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">不要小看这个。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi pd"><img src="../Images/a911e5b2c455b9fa04f496ca7a61a811.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GiHFh89ywf6QOFzr"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">由<a class="ae kz" href="https://unsplash.com/@wild_away?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">达伦·劳伦斯</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="1d1c" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">参考</h1><p id="1b5d" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">我使用 Contoso 样本数据集，就像我以前的文章一样。你可以从微软<a class="ae kz" href="https://www.microsoft.com/en-us/download/details.aspx?id=18279" rel="noopener ugc nofollow" target="_blank">这里</a>免费下载 ContosoRetailDW 数据集。</p><p id="08c1" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">Contoso 数据可以在 MIT 许可下自由使用，如这里的<a class="ae kz" href="https://github.com/microsoft/Power-BI-Embedded-Contoso-Sales-Demo" rel="noopener ugc nofollow" target="_blank">所述</a>。</p><div class="oi oj gp gr ok ol"><a href="https://medium.com/@salvatorecagliari/membership" rel="noopener follow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd iu gy z fp oq fr fs or fu fw is bi translated">通过我的推荐链接加入 Medium-Salvatore Cagliari</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">medium.com</p></div></div><div class="ou l"><div class="pe l ow ox oy ou oz kt ol"/></div></div></a></div></div></div>    
</body>
</html>