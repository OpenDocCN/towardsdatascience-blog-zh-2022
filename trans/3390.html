<html>
<head>
<title>6 BigQuery SQL Functions Every User Should Know</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">每个用户都应该知道的6个大查询SQL函数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/6-bigquery-sql-functions-every-user-should-know-9ed97b1cf72e#2022-07-27">https://towardsdatascience.com/6-bigquery-sql-functions-every-user-should-know-9ed97b1cf72e#2022-07-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0c20" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">检查您的数据库是否也有它们</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/72c1e7441d5bfed35e9475cbdc46ac5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vgeCTYLGpVTXupFMwL-Lgg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由来自<a class="ae ky" href="https://www.pexels.com/photo/photography-of-woman-using-laptop-1181681/" rel="noopener ugc nofollow" target="_blank">佩克斯</a>的<a class="ae ky" href="https://www.pexels.com/@divinetechygirl/" rel="noopener ugc nofollow" target="_blank">克里斯蒂娜·莫里洛</a>拍摄</p></figure><p id="9b3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我的上一篇文章中，我讨论了可以简化查询的<a class="ae ky" rel="noopener" target="_blank" href="/4-bigquery-sql-shortcuts-that-can-simplify-your-queries-30f94666a046"> 4大查询SQL快捷方式</a>。从那时起，我发现了6个更有用的SQL函数，我希望我能早点知道，今天我想和大家分享一下。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="949c" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">1.生成数组</h2><p id="9015" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated"><strong class="lb iu"> GENERATE_ARRAY </strong>函数允许您创建一个数组，其起始值和结束值以步长值递增。如果您想要生成一系列具有特定序列的数字，这将非常有用。注意，查询结果只有一行数据，因为值在一个数组中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/f523a2a78ca9996943f0db33c3b19e2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/1*kA6dh-CQ3aujTvdxjASrYw.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者创建的GENERATE_ARRAY查询示例的屏幕截图</p></figure><h2 id="2f0f" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">2.生成日期数组</h2><p id="1574" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">与GENERATE_ARRAY类似，<strong class="lb iu"> GENERATE_DATE_ARRAY </strong>函数允许您按步长间隔创建一个日期数组。如果您需要创建一系列具有特定间隔的日期，这将非常有用。我使用下面的1天间隔创建了14个日期，但是您可以使用BigQuery支持的任何间隔，例如周、月和年。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/38fb3f7436de534d846ddcbd386c9643.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/1*zsIplM-UeRkhXz7doiwPsg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者创建的GENERATE_DATE_ARRAY查询示例的屏幕截图</p></figure><h2 id="1271" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">3.UNNEST</h2><p id="40ee" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">函数允许你为一个数组的每个值创建行。UNNEST可以与GENERATE_ARRAY或GENERATE_DATE_ARRAY一起使用。当我需要一个日期的主列表来连接时，这个函数非常有用，这样可以确保我查询的时间段内的所有日期都有值。</p><p id="0b18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的查询中，我创建了一个名为<em class="nc"> two_weeks </em>的<a class="ae ky" href="https://chartio.com/resources/tutorials/using-common-table-expressions/" rel="noopener ugc nofollow" target="_blank"> CTE </a>，然后对名为<em class="nc"> date_array </em>的结果数组列使用<strong class="lb iu"> UNNEST </strong>函数来创建每个日期的一行。为了让UNNEST正确工作，您<strong class="lb iu">必须在从</strong>和<strong class="lb iu">中查询的</strong><strong class="lb iu"/>或<strong class="lb iu">表名后添加一个逗号</strong> <strong class="lb iu">，然后在数组列上调用</strong>的<strong class="lb iu"> UNNEST </strong>函数。注意，查询结果显示了14行，表明UNNEST为<em class="nc"> date_array </em>中的每个日期创建了一行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/eb9402ae666376ed14b57da2719bb32e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/1*PludhwUHw8xfwB60zXfD-A.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者创建的UNNEST查询示例的屏幕截图</p></figure><h2 id="b346" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">4.最后一天</h2><p id="506d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated"><strong class="lb iu"> LAST_DAY </strong>函数返回给定日期的当月最后一天。如果您需要提供一个月的最后一天来进行报告，这将非常有用。</p><p id="9652" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的查询中，我使用包含2022年每个月的第一天的GENERATE_DATE_ARRAY创建了一个名为<em class="nc"> one_year </em>的CTE，然后调用<strong class="lb iu"> LAST_DAY </strong>函数来创建包含该月最后一天的第二列。查询结果显示2022年每个月的开始和结束。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/6b1bc9d1084062ccde5a48991a927ed7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/1*mkkkE-w6J8xhzOGn6E567A.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者创建的最后一天查询示例的屏幕截图</p></figure><h2 id="b6dc" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">5 / 6.最小和最大</h2><p id="dce4" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated"><strong class="lb iu">最小</strong>返回一组值或列中的最小值，而<strong class="lb iu">最大</strong>显示最大值。注意，如果任何参数为空，则返回空值。</p><p id="beef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的例子中，我使用了<strong class="lb iu">最小</strong>和<strong class="lb iu">最大</strong>函数来返回样本表<em class="nc"> test_greatest_least </em>中3列的最小和最大值。请注意，最小和最大与最小和最大函数有何不同，后者查看表中一列的所有行。这里，<em class="nc"> col_a </em>上的MIN和MAX将返回0作为10行中的最小值，MAX将返回5。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/2cb3dfe661de822f9d8d65587f6b79bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/1*uJ67keQ-1EKHQnM0xRAo0Q.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者创建的最小和最大查询示例的屏幕截图</p></figure><h2 id="8068" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">最后的想法</h2><p id="6b65" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">虽然我提到的函数在BigQuery中可用，但LAST_DAY、GREATEST和LEAST等一些函数在Redshift和Snowflake等其他数据库中也可用。如果你有几分钟的时间，我强烈推荐阅读你的数据库文档，因为你永远不知道你可能会发现有用的功能。</p><p id="3fb4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nc">注意:以上所有的查询都是在</em> <a class="ae ky" href="https://cloud.google.com/bigquery/docs/sandbox" rel="noopener ugc nofollow" target="_blank"> <em class="nc">大查询沙箱</em> </a> <em class="nc">上运行的，这对任何拥有谷歌账户的人来说都是免费的。</em></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="c1b1" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">你可能也会喜欢…</h2><div class="ng nh gp gr ni nj"><a rel="noopener follow" target="_blank" href="/4-bigquery-sql-shortcuts-that-can-simplify-your-queries-30f94666a046"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">4个可以简化查询的BigQuery SQL快捷方式</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">检查您的数据库是否也有它们</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">towardsdatascience.com</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx ks nj"/></div></div></a></div><div class="ng nh gp gr ni nj"><a rel="noopener follow" target="_blank" href="/how-to-troubleshoot-an-abnormal-kpi-change-b9eb0c3d46a1"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">如何对异常KPI变化进行故障排除</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">调查DAU下降的案例研究</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">towardsdatascience.com</p></div></div><div class="ns l"><div class="ny l nu nv nw ns nx ks nj"/></div></div></a></div><div class="ng nh gp gr ni nj"><a rel="noopener follow" target="_blank" href="/why-building-a-machine-learning-model-is-like-cooking-4bed1f6115d1"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">为什么建立机器学习模型就像烹饪一样</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">逐步比较</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">towardsdatascience.com</p></div></div><div class="ns l"><div class="nz l nu nv nw ns nx ks nj"/></div></div></a></div></div></div>    
</body>
</html>