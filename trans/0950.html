<html>
<head>
<title>Simplest Way to Create a Choropleth Map by U.S. States in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 创建美国各州 Choropleth 地图的最简单方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/simplest-way-of-creating-a-choropleth-map-by-u-s-states-in-python-f359ada7735e#2022-03-14">https://towardsdatascience.com/simplest-way-of-creating-a-choropleth-map-by-u-s-states-in-python-f359ada7735e#2022-03-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="576d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用此代码模板在两分钟内创建一个美国 Choropleth 地图，无需 GeoJSON</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b5c3e22a0f0dca0ad89b0378eef985f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PJS4bmRv-sbtMEFaS-qiaA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://pixabay.com/photos/business-card-mockup-to-dye-hand-3847385/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>提供(作者修改)</p></figure><p id="5049" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Choropleth 地图是最流行的地理空间数据可视化之一。它是一种专题地图，在地图上的预定义区域使用不同的阴影来表示与度量相关的地理特征。它可以被标绘在任何地图上，也可以被标绘在不同的地理区域，如国家、州、县、邮政编码等。</p><p id="0178" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">follous 通常是我创建 choropleth 地图的首选包，尤其是那些可能需要对风格和设计进行大量定制的地图。然而，很多时候，我们可能只需要按美国各州绘制一个简单的 choropleth 地图(就像下面的例子)，而不想经历使用<code class="fe lv lw lx ly b">geopandas</code>或导入<code class="fe lv lw lx ly b">geojson</code>文件来完成工作的麻烦。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lz"><img src="../Images/71eff37597851f3a794348cb8bede4b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bgulbuPq6oKtep1L3jQyCw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="29b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在对比了多个图形库如 Folium、Plotly、Matplotlib 等之后。，我发现使用<code class="fe lv lw lx ly b">Plotly_Express</code>是按州创建美丽的美国 choropleth 地图的最简单快捷的方法。<code class="fe lv lw lx ly b">Plotly_Express</code>内置了美国各州的几何图形，因此无需使用任何 GeoJson 文件。您所需要的只是在一个简单的代码模板中指定几个参数，一切都准备好了！</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h2 id="0cd6" class="mh mi it bd mj mk ml dn mm mn mo dp mp li mq mr ms lm mt mu mv lq mw mx my mz bi translated">先决条件</h2><p id="111c" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">如果您还没有这样做，您将需要使用以下命令安装<code class="fe lv lw lx ly b">Plotly_Express</code>:</p><pre class="kj kk kl km gt nf ly ng nh aw ni bi"><span id="271f" class="mh mi it ly b gy nj nk l nl nm">pip install plotly-express</span></pre><p id="4931" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，在本帖中，我们将使用一个小样本数据集来创建一个 choropleth 地图，该地图可视化了 2022 年 1 月美国各州的单户房产价格。</p><p id="5c52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要下载原始数据集，请转到<a class="ae ky" href="https://www.redfin.com/news/data-center/" rel="noopener ugc nofollow" target="_blank"> Redfin 的数据中心</a>，向下滚动到“它如何工作”部分，并下载“州”级别的区域数据。这是一个免费的、开放的数据集，你可以下载并根据自己的目的使用，并注明出处。然后，我们可以使用下面的代码来选择绘制地图所需的列和数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/ef79c3167a1dab4428dec07781103bc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tt3peWPI2scKtAXNd25__Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h2 id="5786" class="mh mi it bd mj mk ml dn mm mn mo dp mp li mq mr ms lm mt mu mv lq mw mx my mz bi translated">创建美国各州的 Choropleth 地图</h2><p id="7d55" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">现在我们的数据已经准备好了，让我们看看使用<code class="fe lv lw lx ly b">Plotly_Express</code>创建美国各州的 choropleth 地图有多简单。下面是代码模板，您可以使用<code class="fe lv lw lx ly b">Plotly_Express</code>来绘制美国各州的 choropleth 地图。</p><pre class="kj kk kl km gt nf ly ng nh aw ni bi"><span id="629b" class="mh mi it ly b gy nj nk l nl nm">import plotly.express as px</span><span id="e8c0" class="mh mi it ly b gy nq nk l nl nm">fig = px.choropleth(df,<br/>                    locations='state_code', <br/>                    locationmode="USA-states", <br/>                    scope="usa",<br/>                    color='Median Sales Price ($)',<br/>                    color_continuous_scale="Viridis_r", <br/>                    <br/>                    )<br/>fig.show()</span></pre><p id="3258" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是您需要在代码模板中指定的一些重要参数:</p><ul class=""><li id="0901" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated"><code class="fe lv lw lx ly b">locations</code>:这应该是数据帧中代表美国各州的列名。确保您提供的<code class="fe lv lw lx ly b">locations</code>是两个字母的州名缩写。</li><li id="e1cf" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe lv lw lx ly b">locationmode</code>:要使用 Plotly_Express 内置的美国州几何图形，需要设置<code class="fe lv lw lx ly b">locationmode='USA-states'</code>。</li><li id="b8ab" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe lv lw lx ly b">scope</code>:这里应该指定为‘美国’。</li><li id="6346" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe lv lw lx ly b">color</code>:这应该是表示您希望按状态可视化的指标的列的名称。</li><li id="f881" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><code class="fe lv lw lx ly b">color_continuous_scale</code>:您可以使用以下任何一种指定的色标。您可以将“_r”添加到已命名的色标中以反转它。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/6eb82a350715365eef50982cdfb8ba74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U8sgAqARIiepdMgThusMbA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="72da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基本就是这样！如果您想向地图添加带有某种格式的标题，也可以简单地添加以下代码:</p><pre class="kj kk kl km gt nf ly ng nh aw ni bi"><span id="0d76" class="mh mi it ly b gy nj nk l nl nm">fig.update_layout(<br/>      title_text = 'Jan 2022 Median Housing Price by State',<br/>      title_font_family="Times New Roman",<br/>      title_font_size = 22,<br/>      title_font_color="black", <br/>      title_x=0.45, <br/>         )</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/257fe8c799727cd645a9e5d4d4ea7251.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dGsCRhdHvzENmvawoOV87A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h2 id="c345" class="mh mi it bd mj mk ml dn mm mn mo dp mp li mq mr ms lm mt mu mv lq mw mx my mz bi translated">奖励:创建美国各州的动画 Choropleth 地图</h2><p id="39f0" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">在上面的例子中，我们使用<code class="fe lv lw lx ly b">plotly_express</code>创建了一个快照 choropleth 地图，它可视化了 2022 年 1 月各州的房价。使用动画的 choropleth 地图来观察各州的房价如何随着时间的推移而演变将会很有趣。</p><p id="9c23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好消息是用<code class="fe lv lw lx ly b">plotly_express</code>做起来超级简单。您所需要做的就是确保您的时间范围列(在我们的例子中是:“period_begin”)以升序排序(第 9 行)，然后在您的<code class="fe lv lw lx ly b">px.choropleth()</code>代码中添加<code class="fe lv lw lx ly b">animation_frame</code>参数(第 17 行)！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/349bbfe0dfed012d064f5226e2bf7c98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*JBo6q_yykbsTlUhSIY1OAA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者 GIF</p></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><p id="a24f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">Plotly_Express</code>还具有内置的几何图形，可显示自然地球数据集中定义的国家/地区的世界地图。根据<a class="ae ky" href="https://plotly.com/python/choropleth-maps/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>的文档，要使用内置国家几何图形，您需要提供<code class="fe lv lw lx ly b">locations</code>作为<a class="ae ky" href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3" rel="noopener ugc nofollow" target="_blank">三个字母的 ISO 国家代码</a>。其他一切都遵循美国各州 choropleth 地图的相同代码模板。</p><p id="15c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您需要按美国各州或世界各国以外的地理区域绘制 choropleth 地图，则需要使用适当的 GeoJson 文件来定义相应的地理区域边界，例如县、邮政编码等。您可以使用<code class="fe lv lw lx ly b">Plotly_Express</code>、<code class="fe lv lw lx ly b">Plotly_Go</code>或<code class="fe lv lw lx ly b">Folium</code>来创建地图。如果你想学习如何使用<code class="fe lv lw lx ly b">Folium</code>创建一个高度可定制和复杂的 choropleth 地图，你可以阅读下面的文章。</p><div class="oi oj gp gr ok ol"><a rel="noopener follow" target="_blank" href="/folium-and-choropleth-map-from-zero-to-pro-6127f9e68564"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd iu gy z fp oq fr fs or fu fw is bi translated">叶和 Choropleth 地图:从零到专业</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">使用带有图层控制和自定义工具提示的 follow 创建交互式 Choropleth 地图的分步教程</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">towardsdatascience.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz ks ol"/></div></div></a></div><p id="f612" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！我希望你喜欢这个教程，并且学到了一些关于地理空间数据可视化的新知识。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h2 id="02ce" class="mh mi it bd mj mk ml dn mm mn mo dp mp li mq mr ms lm mt mu mv lq mw mx my mz bi translated">参考和数据源</h2><ol class=""><li id="ff94" class="nr ns it lb b lc na lf nb li pa lm pb lq pc lu pd nx ny nz bi translated">Plotly 文档:<a class="ae ky" href="https://plotly.com/python/choropleth-maps/" rel="noopener ugc nofollow" target="_blank">https://plotly.com/python/choropleth-maps/</a></li><li id="724f" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu pd nx ny nz bi translated">数据来源:Redfin 月度住房市场数据——州一级。这是由<a class="ae ky" href="https://www.redfin.com/news/data-center/" rel="noopener ugc nofollow" target="_blank"> Redfin </a>、<em class="pe">T5】一家全国性房地产经纪公司提供的一个开放数据集，你可以免费下载，并注明出处。</em></li></ol></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><p id="c53d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以通过这个<a class="ae ky" href="https://medium.com/@insightsbees/membership" rel="noopener">推荐链接</a>注册 Medium 会员(每月 5 美元)来获得我的作品和 Medium 的其他内容。通过这个链接注册，我将收到你的一部分会员费，不需要你额外付费。谢谢大家！</p></div></div>    
</body>
</html>