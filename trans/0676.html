<html>
<head>
<title>Evaluating classification models with Kolmogorov-Smirnov (KS) test</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Kolmogorov-Smirnov (KS)检验评估分类模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/evaluating-classification-models-with-kolmogorov-smirnov-ks-test-e211025f5573#2022-02-28">https://towardsdatascience.com/evaluating-classification-models-with-kolmogorov-smirnov-ks-test-e211025f5573#2022-02-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3306" class="pw-subtitle-paragraph jo ip iq bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">使用KS检验评估类分布之间的分离</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/8f713817a7952ef3fcd814aa1b138db5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UaPrBaAL37FE1enpVi1-mA.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">图片由<a class="ae kw" href="https://unsplash.com/@possessedphotography" rel="noopener ugc nofollow" target="_blank">拥有的摄影</a>在Unsplash上拍摄</p></figure><p id="fce5" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在大多数二元分类问题中，我们使用ROC曲线和ROC AUC分数作为模型如何区分两个不同类别的预测的度量。我在另一篇文章中解释了这种机制<a class="ae kw" rel="noopener" target="_blank" href="/interpreting-roc-curve-and-roc-auc-for-classification-evaluation-28ec3983f077">，但是直觉很简单:如果模型给否定类较低的概率分数，给肯定类较高的分数，我们可以说这是一个好模型。</a></p><p id="445b" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">现在这里有一个问题:我们也可以使用KS-2samp测试来做这件事！</p><h1 id="2efa" class="lt lu iq bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">科尔莫戈罗夫-斯米尔诺夫试验</h1><p id="d9b5" class="pw-post-body-paragraph kx ky iq kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">两个样本的KS统计量仅仅是它们的两个CDF之间的最高距离，因此如果我们测量正类分布和负类分布之间的距离，我们可以有另一个度量来评估分类器。</p><p id="94f8" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这种方法有一个好处:ROC AUC得分从0.5到1.0，而KS统计值从0.0到1.0。对于业务团队来说，理解0.5是ROC AUC的烂分，而0.75“仅仅”是中等分是不太直观的。还有一篇<a class="ae kw" href="https://arxiv.org/ftp/arxiv/papers/1606/1606.00496.pdf" rel="noopener ugc nofollow" target="_blank">预印论文</a>【1】声称KS计算起来更简单。</p><p id="02be" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果你想更好地理解KS测试是如何工作的，可以看看我关于这个主题的文章:</p><div class="mq mr gp gr ms mt"><a rel="noopener follow" target="_blank" href="/comparing-sample-distributions-with-the-kolmogorov-smirnov-ks-test-a2292ad6fee5"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd ir gy z fp my fr fs mz fu fw ip bi translated">用Kolmogorov-Smirnov (KS)检验比较样本分布</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">如何使用python比较样本并了解它们是否来自同一个发行版</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">towardsdatascience.com</p></div></div><div class="nc l"><div class="nd l ne nf ng nc nh kq mt"/></div></div></a></div><h1 id="69e1" class="lt lu iq bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">实验</h1><p id="b65c" class="pw-post-body-paragraph kx ky iq kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">我们开始工作吧。</p><p id="8e31" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我的<a class="ae kw" href="https://github.com/vinyluis/Articles/tree/main/Kolmogorov-Smirnov" rel="noopener ugc nofollow" target="_blank"> github </a>上有所有的代码，所以我只讲述最重要的部分。</p><div class="mq mr gp gr ms mt"><a href="https://github.com/vinyluis/Articles/tree/main/Kolmogorov-Smirnov" rel="noopener  ugc nofollow" target="_blank"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd ir gy z fp my fr fs mz fu fw ip bi translated">文章/Kolmogorov-Smirnov在主要乙烯/文章</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">第1篇:用Kolmogorov-Smirnov检验比较样本分布(TBD)</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">github.com</p></div></div><div class="nc l"><div class="ni l ne nf ng nc nh kq mt"/></div></div></a></div><p id="99ab" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">作为一个例子，我们可以构建三个数据集，它们在类之间具有不同的分离级别(参见代码以了解它们是如何构建的)。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nj"><img src="../Images/ed667693ec8b183fee0183f75d1aaeda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CjW0j2t6ZLGxOf-WRm-eDw.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">三个样本的散点图。图片作者。</p></figure><p id="4bd0" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在“好的”数据集上，类没有重叠，它们之间有一个明显的间隙。在“中等”上，有足够的重叠来混淆分类器。“坏”数据集上的重叠如此强烈，以至于这些类几乎是不可分的。</p><p id="3274" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我为每个数据集训练了一个默认的朴素贝叶斯分类器。通过绘制直方图，我们可以看到每一类的预测分布。在x轴上，我们有一个被分类为“阳性”的观察值的概率，在y轴上，我们有直方图的每个箱中的观察值的计数:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nk"><img src="../Images/7f7c2adedae11ab963310c5a51c42bc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GXesn6imhOkwG3zqnBIeSw.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">类别分离直方图。图片作者。</p></figure><p id="4c43" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">“好”的例子(左)有一个完美的分离，正如所料。“中等”的一个(中心)有一点重叠，但大多数例子可以正确分类。然而，分类器不能分离“坏的”例子(右)。</p><p id="59ef" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们现在可以评估每种情况的KS和ROC AUC:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="1860" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">输出是:</p><pre class="kh ki kj kk gt nn no np nq aw nr bi"><span id="ff09" class="ns lu iq no b gy nt nu l nv nw">Good classifier:<br/>KS: 1.0000 (p-value: 7.400e-300)<br/>ROC AUC: 1.0000</span><span id="3d0a" class="ns lu iq no b gy nx nu l nv nw">Medium classifier:<br/>KS: 0.6780 (p-value: 1.173e-109)<br/>ROC AUC: 0.9080</span><span id="c2a0" class="ns lu iq no b gy nx nu l nv nw">Bad classifier:<br/>KS: 0.1260 (p-value: 7.045e-04)<br/>ROC AUC: 0.5770</span></pre><p id="0678" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">好的(或者我应该说完美的)分类器在这两个指标上都获得了满分。</p><p id="804f" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">中等的ROC AUC为0.908，听起来几乎完美，但KS分数为0.678，这更好地反映了类不是“几乎完美”可分的事实。</p><p id="0803" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">最后，糟糕的分类器得到了0.57的AUC分数，这是糟糕的(对于我们这些知道0.5 =最坏情况的数据爱好者来说)，但听起来没有KS分数0.126那么糟糕。</p><p id="9331" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们还可以检查每个案例的CDF:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ny"><img src="../Images/228db91780a1e3d5f8c78eb558099177.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CAFnW8Nm5rF3EEtsestedA.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">好、中和坏分类器的CDF。图片作者。</p></figure><p id="f66a" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">正如所料，坏分类器在类0和类1的CDF之间有一个狭窄的距离，因为它们几乎是相同的。中等分类器在类CDF之间具有更大的间隙，因此KS统计量也更大。最后，“完美的”分类器在它们的CDF上没有重叠，所以距离是最大的，KS = 1。</p><h1 id="f1dd" class="lt lu iq bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">数据不平衡的影响</h1><p id="5498" class="pw-post-body-paragraph kx ky iq kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">以及数据失衡如何影响KS评分？</p><p id="aa4a" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了测试这一点，我们可以基于“中等”数据集生成三个数据集:</p><ul class=""><li id="2f4b" class="nz oa iq kz b la lb ld le lg ob lk oc lo od ls oe of og oh bi translated">原，其中正类有100%的原例(500)</li><li id="5ba1" class="nz oa iq kz b la oi ld oj lg ok lk ol lo om ls oe of og oh bi translated">一个数据集，其中正类有50%的原始示例(250)</li><li id="7350" class="nz oa iq kz b la oi ld oj lg ok lk ol lo om ls oe of og oh bi translated">一个数据集，其中正类只有10%的原始示例(50)</li></ul><p id="7182" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在所有这三种情况下，负类在所有500个例子中都不会改变。训练分类器后，我们可以看到它们的直方图，如前所述:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nk"><img src="../Images/a5c43c591910a64adcf7ad7ca0b80131.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u_pP3TmiKXUaF4hGW1y_gA.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">不平衡数据的类分离直方图。图片作者。</p></figure><p id="7d63" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">负类基本相同，正类只是规模变化。</p><p id="4360" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们可以使用相同的函数来计算KS和ROC AUC得分:</p><pre class="kh ki kj kk gt nn no np nq aw nr bi"><span id="8b8d" class="ns lu iq no b gy nt nu l nv nw">print("Balanced data:")<br/>ks_100, auc_100 = evaluate_ks_and_roc_auc(y_100, y_proba_100)</span><span id="1e77" class="ns lu iq no b gy nx nu l nv nw">print("Positive class with 50% of the data:")<br/>ks_50, auc_50 = evaluate_ks_and_roc_auc(y_50, y_proba_50)</span><span id="2b8b" class="ns lu iq no b gy nx nu l nv nw">print("Positive class with 10% of the data:")<br/>ks_10, auc_10 = evaluate_ks_and_roc_auc(y_10, y_proba_10)</span></pre><p id="ff0d" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">输出是:</p><pre class="kh ki kj kk gt nn no np nq aw nr bi"><span id="92f4" class="ns lu iq no b gy nt nu l nv nw">Balanced data:<br/>KS: 0.6780 (p-value: 1.173e-109)<br/>ROC AUC: 0.9080</span><span id="92b3" class="ns lu iq no b gy nx nu l nv nw">Positive class with 50% of the data:<br/>KS: 0.6880 (p-value: 3.087e-79)<br/>ROC AUC: 0.9104</span><span id="a73c" class="ns lu iq no b gy nx nu l nv nw">Positive class with 10% of the data:<br/>KS: 0.6280 (p-value: 1.068e-17)<br/>ROC AUC: 0.8837</span></pre><p id="a6f2" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">即使在最坏的情况下，积极的类有90%的例子，在这种情况下，KS分数只比原来的少7.37%。ROC和KS对数据不平衡都具有鲁棒性。</p><h1 id="9f9f" class="lt lu iq bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">多类分类评估</h1><p id="7386" class="pw-post-body-paragraph kx ky iq kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">正如ROC曲线和ROC AUC的情况一样，我们无法在不将其转化为二元分类问题的情况下计算多类问题的KS。我们可以通过使用“OvO”和“OvR”策略来做到这一点。</p><p id="d6ed" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">您可以在我的<a class="ae kw" href="https://github.com/vinyluis/Articles/tree/main/Kolmogorov-Smirnov" rel="noopener ugc nofollow" target="_blank"> GitHub存储库中找到本文</a>的代码片段，但是您也可以使用我关于多类ROC曲线和ROC AUC的文章作为参考:</p><div class="mq mr gp gr ms mt"><a rel="noopener follow" target="_blank" href="/multiclass-classification-evaluation-with-roc-curves-and-roc-auc-294fd4617e3a"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd ir gy z fp my fr fs mz fu fw ip bi translated">用ROC曲线和ROC AUC进行多类分类评价</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">将最常用的分类评估度量用于具有OvR和OvO的多类分类问题…</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">towardsdatascience.com</p></div></div><div class="nc l"><div class="on l ne nf ng nc nh kq mt"/></div></div></a></div><h1 id="2188" class="lt lu iq bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated"><strong class="ak">结论</strong></h1><p id="6f31" class="pw-post-body-paragraph kx ky iq kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">KS和ROC AUC技术将以不同的方式评估相同的指标。即使ROC AUC是分类分离的最广泛的度量，了解两者总是有用的。</p><p id="33cc" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">当我开始在一个使用KS的地方工作时，我才明白为什么我需要使用它。这更多的是一个偏好的问题，真的，所以坚持做让你舒服的事情。</p><h1 id="6934" class="lt lu iq bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">如果你喜欢这个帖子…</h1><p id="823e" class="pw-post-body-paragraph kx ky iq kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">支持我一杯咖啡！</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><a href="https://www.buymeacoffee.com/vinitrevisan"><div class="gh gi oo"><img src="../Images/acf4154cfebdc13859934db49fd502cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*h_y4o6IwDDFFWIyKQE7Rww.png"/></div></a><p class="ks kt gj gh gi ku kv bd b be z dk translated">给我买杯咖啡！</p></figure><p id="cf7c" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">看看这个很棒的帖子</p><div class="mq mr gp gr ms mt"><a rel="noopener follow" target="_blank" href="/comparing-robustness-of-mae-mse-and-rmse-6d69da870828"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd ir gy z fp my fr fs mz fu fw ip bi translated">MAE、MSE和RMSE的稳健性比较</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">存在异常值时主要回归指标的表现</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">towardsdatascience.com</p></div></div><div class="nc l"><div class="op l ne nf ng nc nh kq mt"/></div></div></a></div><h1 id="5fc4" class="lt lu iq bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">参考</h1><p id="1255" class="pw-post-body-paragraph kx ky iq kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">[1] Adeodato，P. J. L .，Melo，S. M. <a class="ae kw" href="https://arxiv.org/ftp/arxiv/papers/1606/1606.00496.pdf" rel="noopener ugc nofollow" target="_blank">关于Kolmogorov-Smirnov和ROC曲线度量在二元分类中的等价性。</a></p><p id="9ad1" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">[2] Scipy Api参考。<a class="ae kw" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.ks_2samp.html" rel="noopener ugc nofollow" target="_blank"> scipy.stats.ks_2samp。</a></p><p id="0aba" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">[3] Scipy Api参考。<a class="ae kw" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.ks_1samp.html" rel="noopener ugc nofollow" target="_blank"> scipy.stats.ks_1samp。</a></p><p id="7aa3" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">[4] Scipy Api参考。<a class="ae kw" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.kstwo.html" rel="noopener ugc nofollow" target="_blank"> scipy.stats.kstwo </a>。</p><p id="6a62" class="pw-post-body-paragraph kx ky iq kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">[5] Trevisan，V. <a class="ae kw" rel="noopener" target="_blank" href="/interpreting-roc-curve-and-roc-auc-for-classification-evaluation-28ec3983f077">解读ROC曲线和ROC AUC进行分类评价。</a></p></div></div>    
</body>
</html>