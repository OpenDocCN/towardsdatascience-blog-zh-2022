<html>
<head>
<title>Who’s Your Number-One Supporter on Strava?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谁是你在斯特拉发的头号支持者？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/whos-your-number-1-supporter-on-strava-5a888230f361#2022-10-27">https://towardsdatascience.com/whos-your-number-1-supporter-on-strava-5a888230f361#2022-10-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="af39" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">探索Strava API并使用Python找到答案</h2></div></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/38de2b6008d1ef00ac5adf254006d3e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OO_AyDVSgN9VZk7_pDPJqg.jpeg"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">维克多·比斯特罗夫在<a class="ae lc" href="https://unsplash.com/s/photos/cycling?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><h1 id="bf99" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">头号动机</h1><p id="af9c" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">在过去的几年里，Strava成了我追踪骑行和跑步活动的首选应用。这款应用有很多很酷的功能，其中一个就是你的朋友可以为你的活动给你好评。有时候，这些荣誉只是激励你继续前进的动力。</p><p id="541e" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">2022年，当我准备攀登阿尔卑斯山并比以前更经常使用Strava时，我注意到有些人在荣誉方面比其他人更慷慨。但是我不知道是谁，这让我开始思考。有没有一种方法可以比应用程序提供的更深入地了解我的统计数据？嗯，有。</p><p id="e9e6" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在本文中，我使用了一种非常常见的“提取转换负载”方法来构建项目。我将展示我如何设法从Strava获取活动数据(提取)，计算新的见解(转换)，并构建“Kudos Graph”和其他可视化工具，以了解应该感谢谁的支持(加载)。</p><p id="ac90" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">随着时间的推移，我发现这种方法是组织类似数据项目的好方法。在开始之前，最后注意一点，这里显示的所有内容都是可复制的，代码可以在Github(本文末尾的链接)上获得，因此您可以构建自己的代码。</p><p id="74bc" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">让我们开始编码吧！</p></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><h1 id="3e63" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">#2 API连接和授权</h1><p id="a3f7" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">这可能是本文中不太有趣的部分，但却是必要的部分。为了使用Strava API并获得您的数据，您首先需要在网站上注册一个应用程序(没有看起来那么可怕)，并获得授权令牌。</p><ol class=""><li id="c1dc" class="mw mx iq lx b ly mr mb ms me my mi mz mm na mq nb nc nd ne bi translated">注册一个应用程序可以在登录时通过以下链接完成:【https://www.strava.com/settings/api】T4。这将为您提供您的客户端ID和客户端密码。</li><li id="c85d" class="mw mx iq lx b ly nf mb ng me nh mi ni mm nj mq nb nc nd ne bi translated">第一步只会让你到此为止，并授予你访问顶线数据。要访问活动级别数据，您需要遵循以下链接:<a class="ae lc" href="http://www.strava.com/oauth/authorize?client_id=[REPLACE_WITH_YOUR_CLIENT_ID]&amp;response_type=code&amp;redirect_uri=http://localhost/exchange_token&amp;approval_prompt=force&amp;scope=profile:read_all,activity:read_all" rel="noopener ugc nofollow" target="_blank"><em class="nk">http://www.strava.com/oauth/authorize?client_id=</em><strong class="lx ir"><em class="nk">【REPLACE _ WITH _ YOUR _ CLIENT _ ID】</em></strong><em class="nk">&amp;response _ type = code&amp;redirect _ uri = http://localhost/exchange _ token&amp;approval _ prompt = force&amp;scope = profile:read _ all，activity:read_all </em> </a></li><li id="a95c" class="mw mx iq lx b ly nf mb ng me nh mi ni mm nj mq nb nc nd ne bi translated">在登陆页面点击“授权”，在出现的网址中写下你得到的授权码:<em class="nk"><br/>http://localhost/exchange _ token？state =&amp;CODE =</em><strong class="lx ir"><em class="nk">【THIS _ IS _ THE _ CODE _ YOU _ NEED _ TO _ COPY】</em></strong><em class="nk">&amp;scope = read，activity:read_all，profile:read_all </em></li></ol><p id="4056" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我从Benji Knights Johnson的这篇文章中得到了所有这些，文章中对这些步骤进行了更详细的解释:</p><div class="nl nm gp gr nn no"><a href="https://medium.com/swlh/using-python-to-connect-to-stravas-api-and-analyse-your-activities-dummies-guide-5f49727aac86" rel="noopener follow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">使用Python连接到Strava的API并分析您的活动——傻瓜指南</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">我找不到一本完整的指南，从头到尾介绍了连接到Strava的API的所有部分…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">medium.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc kw no"/></div></div></a></div><p id="54a2" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">现在让乐趣开始吧。</p></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><h1 id="9652" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">#3认证</h1><p id="8010" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">我们需要做的第一件事是认证，即从Strava获取访问令牌。下面的函数将通过一个POST请求做到这一点，该请求包含我们在上一节中获得的到端点<a class="ae lc" href="https://www.strava.com/oauth/token" rel="noopener ugc nofollow" target="_blank">https://www.strava.com/oauth/token</a>的细节(客户端id、客户端秘密、刷新令牌和授权码)。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="od oe l"/></div></figure></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><h1 id="56e3" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">#4提取数据</h1><p id="6a1c" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">在本节中，我们创建两个函数来:</p><ol class=""><li id="0cb4" class="mw mx iq lx b ly mr mb ms me my mi mz mm na mq nb nc nd ne bi translated"><strong class="lx ir">获取档案中所有活动的列表。</strong> <br/>使用我们之前得到的访问令牌，并指定两个定义我们感兴趣的活动范围的日期，我们得到这两个日期之间所有活动的列表及其主要特征。</li><li id="01e1" class="mw mx iq lx b ly nf mb ng me nh mi ni mm nj mq nb nc nd ne bi translated"><strong class="lx ir">获取特定活动的kudoers列表。</strong> <br/>不幸的是，先前请求的结果中不包含活动的kudoers列表。我们需要构建get_kudos函数，该函数返回单个活动的kudoers列表，由activity_id标识。</li></ol><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="od oe l"/></div></figure></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><h1 id="a0c0" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">#5转变数据</h1><p id="8949" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">现在我们已经得到了我们想要的数据，我们的想法是只保留我们需要的，并把它放在熊猫数据帧中。</p><p id="427f" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">下面的转换函数从活动列表中提取以下数据:</p><ol class=""><li id="390d" class="mw mx iq lx b ly mr mb ms me my mi mz mm na mq nb nc nd ne bi translated">用作活动的唯一标识符的活动id。</li><li id="6832" class="mw mx iq lx b ly nf mb ng me nh mi ni mm nj mq nb nc nd ne bi translated">每项活动的kudos数。</li><li id="b173" class="mw mx iq lx b ly nf mb ng me nh mi ni mm nj mq nb nc nd ne bi translated">通过在一个循环中利用get_kudos()函数，得到一个活动的所有kudoers的列表。</li><li id="900d" class="mw mx iq lx b ly nf mb ng me nh mi ni mm nj mq nb nc nd ne bi translated">每次活动的距离。</li><li id="acd1" class="mw mx iq lx b ly nf mb ng me nh mi ni mm nj mq nb nc nd ne bi translated">每项活动花费的时间。</li><li id="933a" class="mw mx iq lx b ly nf mb ng me nh mi ni mm nj mq nb nc nd ne bi translated">活动的类型。</li></ol><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="7373" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">⚠️:strava API的使用是有限制的。我们被限制为每15分钟100个电话，每天1000个电话。</p><p id="7808" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在这个项目中，我们调用API一次来获取活动列表，然后对每个活动调用一次来获取每个活动中的kudoers列表。</p><p id="719c" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">这意味着，如果在考虑的窗口中有超过100个活动，代码将不能工作，您需要稍微修改它以符合API使用限制。</p></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><h1 id="8b8f" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">#6荣誉图(以及其他一些见解)</h1><p id="1322" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">剩下唯一要做的就是利用我们刚刚构建的函数，开始绘制一些有趣的东西！</p><p id="2e56" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">就我而言，我正在考虑我在2022年的活动，直到今天——2022年10月24日。</p><p id="4ced" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">从我们的数据结构中，可以非常容易地获得给定期间的一些高级KPI:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi of"><img src="../Images/4644d301eb7cad17ee5ecbacce514ccf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*918z528Fb1CET7JwTKKORw.png"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">高级KPIs按作者分类的图片</p></figure></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><p id="6ebd" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">因为我们在前一节中获得了每项活动的运动类型，所以我们也可以很容易地调查某些类型的活动是否比其他活动更容易获得荣誉。以下是每种活动的平均荣誉数:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi og"><img src="../Images/823fa60f7bb86c87c759bbf7b6208f2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C11ACqGHqdaXvzo-U4HOxw.png"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">每种活动类型的平均kudos数—按作者分类的图片</p></figure></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><p id="1283" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">即使它不是最受欢迎的活动类型，跑步是我拥有最多数据点的运动，所以这是我试图挖掘更多的地方。我们可以试着理解为什么一项活动会比另一项活动获得更多的荣誉。让我们来看看跑步的距离和活动将获得的荣誉之间可能的相关性。</p><p id="9b0a" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">事实证明，似乎存在正相关关系，即跑步时间越长，kudos的数量就越高，如下图所示。诚然，鉴于我们考虑的数据点数量很少，这一结果的统计学意义是有争议的。这里唯一确定的结论是，我需要跑得更多。</p><p id="abf0" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我们可以在分析中走得更远，看看其他变量的影响，但我将把这留给另一篇文章。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi oh"><img src="../Images/3eb7f75fa330281e55548a80d99608df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4CS3iviZE3eXWo6cat4O1g.png"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">跑步的距离和获得的荣誉数成正相关——作者图表</p></figure></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><p id="8e66" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">最后，我们可以绘制“荣誉图”,从中我们可以看到谁是我们最大的支持者，并大声喊出来。<br/>当然，有些人比其他人更沉迷于Strava，当他们向下滚动活动提要时会给予称赞，而其他人只会偶尔打开应用程序，只对他们碰巧看到的最近活动给予称赞。<br/>这张图表绝不是在评判人们是否给予赞扬，它只是简单地展示了你在其他地方看不到的新见解——即使是在这款应用的高级版本中也看不到。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi oh"><img src="../Images/9d988496aab6a08e42eeea6e7db76830.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XecAMAaCh3tUKVpYcVGTRw.png"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">显示最高支持者的“荣誉图”——按作者分类的图表</p></figure></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><h1 id="bde9" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">#7最后的想法</h1><p id="7bff" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">毫无疑问，我们可以利用从Strava API获得的所有数据做更多的事情。这只是回答一个不寻常的问题的第一枪，也是一个很好的练习。</p><p id="1960" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">如果你想分析你的Strava活动，找出谁是你最大的支持者，完整的代码可以在这里找到:<br/><a class="ae lc" href="https://github.com/Guigs11/strava_kudos" rel="noopener ugc nofollow" target="_blank"><em class="nk">https://github.com/Guigs11/strava_kudo</em>s</a></p></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><p id="c927" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated"><em class="nk">感谢一路看完文章！<br/>欢迎在下方留言，如有任何问题/备注，也可通过</em><a class="ae lc" href="https://www.linkedin.com/in/guillaume-weingertner-a4a27972/" rel="noopener ugc nofollow" target="_blank"><em class="nk">LinkedIn</em></a><em class="nk">联系我！<br/>更多来了！</em></p></div></div>    
</body>
</html>