<html>
<head>
<title>Exploring Query Folding in Power Query</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索电力查询中的查询折叠</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/exploring-query-folding-in-power-query-8288fb3c9c2f#2022-08-04">https://towardsdatascience.com/exploring-query-folding-in-power-query-8288fb3c9c2f#2022-08-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="67ce" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">查询折叠是Power Query中的一个重要特性，可以将处理步骤卸载到数据源。有了这个特性，电源查询可以减少CPU和RAM的消耗。让我们看看如何使用它。</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/a8c2e5b83ba9b1acadd99fee6d8ee5b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qx-gj8Et6b0dbKUo"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">由<a class="ae kz" href="https://unsplash.com/@element5digital?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">元素5数码</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="934f" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">什么是查询折叠，我们如何使用它？</h1><p id="f416" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">查询折叠是将超级查询转换推回到源的机制，以减少超级查询的负载。</p><p id="5b07" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这只适用于某些数据源，即关系数据库和类似于关系数据库的数据源。</p><p id="54db" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">例如，请看下图，其中显示了Power BI，它从数据库中获取数据:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/e761968fee9a40948b8f5d5949d2759c.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*lZa-rPanRkqU8qqhPA6a2A.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图1 —来自数据库的数据(由作者提供)</p></figure><p id="8c12" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在Power查询中添加转换步骤时，我们希望避免Power查询上不必要的负载。</p><p id="02cb" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">用原生数据库语言SQL将这种转换推回到源数据库会很好。</p><p id="77ad" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">但是我们为什么要拥有它呢？</p><h1 id="60e0" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">为什么我们需要查询折叠？</h1><p id="f148" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">您可能知道，关系数据库引擎在管理数据方面非常有效。</p><p id="fcbd" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">关系数据库引擎擅长的操作有:</p><ul class=""><li id="c5ab" class="mu mv it lu b lv mo ly mp mb mw mf mx mj my mn mz na nb nc bi translated">数据排序(排序依据)</li><li id="0bf8" class="mu mv it lu b lv nd ly ne mb nf mf ng mj nh mn mz na nb nc bi translated">组合数据(连接/合并)</li><li id="3f66" class="mu mv it lu b lv nd ly ne mb nf mf ng mj nh mn mz na nb nc bi translated">对大量数据执行计算(计算列)</li><li id="c8e7" class="mu mv it lu b lv nd ly ne mb nf mf ng mj nh mn mz na nb nc bi translated">只做必要的事情(优化查询)</li></ul><p id="6e5e" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">但最关键的一点是，关系数据库引擎运行在服务器硬件上，这是为了处理大量数据而优化的。这些服务器拥有比我们简陋的笔记本电脑或个人电脑更多的CPU内核和内存，处理数据的限制也比我们少得多。</p><p id="d712" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">所有支持SQL的数据源都可以支持查询折叠。除了明显的关系数据库(如SQL Server、Oracle、DB/2等。)，OData sources、Exchange、Active Directory等都支持查询折叠。</p><p id="2b5a" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">让我们仔细看看。</p><h1 id="21f7" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">让我们从SQL Server数据库中获取数据</h1><p id="e1fe" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">现在，我使用我常用的Contoso数据库来查看查询折叠的运行情况。</p><p id="87a1" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我切换到Power Query，并使用Azure SQL数据库源以导入模式从我的数据库中获取一些表:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/902db55ffed835b863b9ddddca2bd3f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*ahsJrnZiWbbHFDL_X4Y5xg.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图2 —源表(作者提供的图)</p></figure><p id="25de" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">将表加载到Power Query后，您可以右键单击其中一个应用的步骤，并查看“查看本地查询”项是否处于活动状态:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/a9084a7b776fa0eda50875ab7673f83c.png" data-original-src="https://miro.medium.com/v2/resize:fit:520/format:webp/1*cchAC06D1jTXOHP76hTi0w.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图3 —获取原生查询(作者提供的图)</p></figure><p id="0217" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">如果它是活动的，则使用查询折叠，您可以看到Power Query生成并发送到源数据库的查询:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/c4668c7592051ee3f0b18762d0d96259.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*qu2s0vkCeeWIFuSB7ItOzQ.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图4 —第一个本地查询(作者提供的图)</p></figure><p id="f852" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在这种情况下，查询很简单，直接发送到源数据库。</p><h1 id="21ae" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">探索查询折叠</h1><p id="fe84" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">现在，让我们应用一些修改:</p><ul class=""><li id="6eed" class="mu mv it lu b lv mo ly mp mb mw mf mx mj my mn mz na nb nc bi translated">删除一些列</li><li id="7514" class="mu mv it lu b lv nd ly ne mb nf mf ng mj nh mn mz na nb nc bi translated">更改列的名称</li><li id="a08f" class="mu mv it lu b lv nd ly ne mb nf mf ng mj nh mn mz na nb nc bi translated">更改列的数据类型</li></ul><p id="6a29" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">当我得到本机查询时，我看到这样的内容:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/b3a0807c473a285330ee4d02f8c4ba99.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*gk8y7jqGKd9H29aGJXGBFg.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图5 —修改后的原生查询(由作者提供)</p></figure><p id="0ffc" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">如您所见，该查询已经更改，以反映Power Query中的步骤。</p><p id="7197" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">您可以注意到，该查询不再包含已删除的列，而是直接使用该查询转换DateKey列。</p><p id="3511" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这比在Power Query中这样做要高效得多，Power Query会消耗我们计算机中的CPU和内存。</p><p id="8b49" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在，让我们做一个更复杂的转换。</p><p id="b46a" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">为了描述产品，我们有以下层次结构:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nm"><img src="../Images/d4aa524deeccabf40af76ca5c1233c26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7y3L1dSgys9-aUQ8b4_Yhw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图6 —产品层次结构(作者提供的图)</p></figure><p id="5656" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">你可能知道，Power BI不喜欢这样的表层次结构。Power BI最适合事实表和维度表之间的单步关系。</p><p id="0435" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">目标是将这些表合并成一个产品表。</p><p id="3ddb" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我们可以使用Power Query中的Merge转换将产品类别合并到产品子类别中，并将结果合并到产品中(是的，我们可以直接从产品表中执行此操作，因为Power Query可以识别数据库中的现有关系，但是让我们看看手动执行此操作时会发生什么):</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nn"><img src="../Images/c6dcba2eea8541e28b5de9d6000a8629.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DDRSyb1lP2hZngY_EGidww.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图7 —带有合并表的本地查询(由作者提供)</p></figure><p id="3295" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">查询要复杂得多，因为它必须合并(连接)源表来形成结果。</p><p id="331c" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">但是数据库引擎是为做这类事情而优化的，它将比Power Query更好地完成这项任务。</p><h1 id="54f5" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">不可折叠操作</h1><p id="a93e" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">不幸的是，并不是所有的转换都可以折叠。</p><p id="b0ab" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">但是很容易确定哪个不会折叠:</p><ol class=""><li id="a64c" class="mu mv it lu b lv mo ly mp mb mw mf mx mj my mn no na nb nc bi translated">影响多个源(数据库)的转换<br/>例如，当您想要合并数据库中的表格和文本文件中的表格时，查询折叠是不可能的，因为文本文件不理解SQL。<br/>遗憾的是，这同样适用于合并来自两个不同数据库的数据，即使它们驻留在同一个数据库服务器上</li><li id="d5d5" class="mu mv it lu b lv nd ly ne mb nf mf ng mj nh mn no na nb nc bi translated">当您应用无法翻译成SQL <br/>的复杂转换时，例如，当您使用M函数来操作数据时。</li></ol><p id="8df2" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">您可以在下面参考资料部分的文章中找到关于不可折叠转换的更多信息。</p><p id="10ac" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">你必须意识到这些限制。因此，在查询折叠不再可能之前，您必须执行尽可能多的转换。这种方法通过将计算卸载到数据库引擎来提高负载性能。</p><h1 id="ac22" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">本地查询和查询折叠</h1><p id="9106" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">当从数据库中检索数据时，我们可以编写自己的查询。</p><p id="0469" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">例如，假设我们编写了一个SQL查询，将三个产品表连接在一起，将结果导入到Power Query中:</p><pre class="kk kl km kn gt np nq nr ns aw nt bi"><span id="9084" class="nu lb it nq b gy nv nw l nx ny">SELECT [P].[ProductKey]<br/>,[P].[ProductLabel]<br/>,[P].[ProductName]<br/>,[P].[ProductDescription]<br/>,[PSC].[ProductSubcategoryName]<br/>,[PSC].[ProductSubcategoryLabel]<br/>,[PSC].[ProductSubcategoryDescription]<br/>,[PC].[ProductCategoryName]<br/>,[PC].[ProductCategoryLabel]<br/>,[PC].[ProductCategoryDescription]<br/>,[P].[Manufacturer]<br/>,[P].[BrandName]<br/>,[P].[ClassID]<br/>,[P].[ClassName]<br/>,[P].[StyleID]<br/>,[P].[StyleName]<br/>,[P].[ColorID]<br/>,[P].[ColorName]<br/>,[P].[Size]<br/>,[P].[SizeRange]<br/>,[P].[SizeUnitMeasureID]<br/>,[P].[Weight]<br/>,[P].[WeightUnitMeasureID]<br/>,[P].[UnitOfMeasureID]<br/>,[P].[UnitOfMeasureName]<br/>,[P].[StockTypeID]<br/>,[P].[StockTypeName]<br/>,[P].[UnitCost]<br/>,[P].[UnitPrice]<br/>,[P].[AvailableForSaleDate]<br/>,[P].[StopSaleDate]<br/>,[P].[Status]<br/>  FROM [dbo].[DimProduct] AS [P]<br/>    INNER JOIN [dbo].[DimProductSubcategory] AS [PSC]<br/>      ON [PSC].[ProductSubcategoryKey] = [P].[ProductSubcategoryKey]<br/>    INNER JOIN [dbo].[DimProductCategory] AS [PC]<br/>      ON [PC].[ProductCategoryKey] = [PSC].[ProductCategoryKey];</span></pre><p id="dd2a" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在超级查询中，如下所示:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/d5602994b7a9bfb44f2343c1625a8627.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*EuOFqYToFVS9PR9ttsZQGA.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图8 —用本地查询导入表(作者提供的图)</p></figure><p id="1d08" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">执行此操作时，会自动禁用查询折叠:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/ee6b602308338312e47d0ecdf49dae66.png" data-original-src="https://miro.medium.com/v2/resize:fit:510/format:webp/1*m3LJF3nwPvYRNX36P5MD3A.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图9 —使用原生查询禁用查询折叠(作者提供的图片)</p></figure><p id="b07c" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">要启用查询折叠，您必须更改M代码，如下面引用的文章中所述(<a class="ae kz" href="https://blog.crossjoin.co.uk/2021/02/21/query-folding-on-sql-queries-in-power-query-using-value-nativequery-and-enablefoldingtrue/" rel="noopener ugc nofollow" target="_blank">在Power Query Using Value中对SQL查询进行查询折叠)。NativeQuery()和EnableFolding=true(克里斯·韦伯的博客)</a>。</p><p id="b1ae" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在我们的例子中，我必须将M脚本更改为以下内容:</p><pre class="kk kl km kn gt np nq nr ns aw nt bi"><span id="6591" class="nu lb it nq b gy nv nw l nx ny">let<br/>Source = Sql.Databases(“sca4tvddemo.database.windows.net”),</span><span id="2300" class="nu lb it nq b gy ob nw l nx ny">ContosoRetailDW = Source<br/>                {[Name = “ContosoRetailDW”]}<br/>                 [Data],</span><span id="384c" class="nu lb it nq b gy ob nw l nx ny">RunSQL = Value.NativeQuery(<br/>                  ContosoRetailDW,</span><span id="2cb9" class="nu lb it nq b gy ob nw l nx ny">“SELECT [P].[ProductKey]<br/>,[P].[ProductLabel]<br/>,[P].[ProductName]<br/>,[P].[ProductDescription]<br/>,[PSC].[ProductSubcategoryName]<br/>,[PSC].[ProductSubcategoryLabel]<br/>,[PSC].[ProductSubcategoryDescription]<br/>,[PC].[ProductCategoryName]<br/>,[PC].[ProductCategoryLabel]<br/>,[PC].[ProductCategoryDescription]<br/>,[P].[Manufacturer]<br/>,[P].[BrandName]<br/>,[P].[ClassID]<br/>,[P].[ClassName]<br/>,[P].[StyleID]<br/>,[P].[StyleName]<br/>,[P].[ColorID]<br/>,[P].[ColorName]<br/>,[P].[Size]<br/>,[P].[SizeRange]<br/>,[P].[SizeUnitMeasureID]<br/>,[P].[Weight]<br/>,[P].[WeightUnitMeasureID]<br/>,[P].[UnitOfMeasureID]<br/>,[P].[UnitOfMeasureName]<br/>,[P].[StockTypeID]<br/>,[P].[StockTypeName]<br/>,[P].[UnitCost]<br/>,[P].[UnitPrice]<br/>,[P].[AvailableForSaleDate]<br/>,[P].[StopSaleDate]<br/>,[P].[Status]<br/>  FROM [dbo].[DimProduct] AS [P]<br/>    INNER JOIN [dbo].[DimProductSubcategory] AS [PSC]<br/>      ON [PSC].[ProductSubcategoryKey] = [P].[ProductSubcategoryKey]<br/>    INNER JOIN [dbo].[DimProductCategory] AS [PC]<br/>      ON [PC].[ProductCategoryKey] = [PSC].[ProductCategoryKey]”,<br/>null,<br/><strong class="nq iu">[EnableFolding = true]</strong><br/>)<br/>in<br/>RunSQL</span></pre><p id="e6a8" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">请注意，我已经删除了查询末尾的分号。</p><p id="6c3b" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这是必要的，因为在执行查询折叠时，Power query会将此查询包含在外部查询中。</p><p id="9d88" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这意味着这种方法只适用于不在每个查询末尾强制使用分号的数据库引擎，如SQL Server和Postgres等。</p><p id="fa1e" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在本地查询选项是可用的，并且在添加转换后仍然可用。因此，这些转换被合并到源数据库中:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/bc1aa0ca32b5d55ab6713018e9a7fe53.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/1*1BgW4Yc1H3k-VUqPjh4fOQ.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图10 —修改M代码后获得原生查询(图由作者提供)</p></figure><h1 id="52ac" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">结论</h1><p id="c618" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">当您访问数据库时，您应该知道查询折叠是如何优化数据加载性能的。</p><p id="4ba5" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">然后，一旦将一个源中的数据与另一个源中的数据组合起来，就应该注意转换的顺序，以便将尽可能多的转换推送到源数据库中。</p><p id="a2cf" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">如果你只有几千行也没关系。但是，一旦装载了数百万行，性能就变得至关重要。</p><p id="2f61" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">如您所见，利用查询折叠的强大功能并不需要了解SQL。只需查看查看原生查询的选项是否可用，或者不查看查询折叠是否发生。</p><p id="744d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">当然，你可以开始学习SQL，直接在查询时进行所有的转换。</p><p id="0629" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">你决定什么对你最好。</p><p id="17d8" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">感谢您的阅读。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi od"><img src="../Images/e55a20dc5f69c2c9581aff8317b81c3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Vd_56ZYd_0KiTB_P"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@jontyson?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">乔恩·泰森</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="19c8" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">参考</h1><p id="bf20" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">有关超级查询和查询折叠如何工作的详细信息，请参阅以下资源:</p><ul class=""><li id="95ec" class="mu mv it lu b lv mo ly mp mb mw mf mx mj my mn mz na nb nc bi translated"><a class="ae kz" href="https://docs.microsoft.com/en-us/power-query/query-folding-basics" rel="noopener ugc nofollow" target="_blank">Power Query中查询求值和查询折叠概述(MS文档)</a></li><li id="e097" class="mu mv it lu b lv nd ly ne mb nf mf ng mj nh mn mz na nb nc bi translated"><a class="ae kz" href="https://docs.microsoft.com/en-us/power-query/power-query-folding" rel="noopener ugc nofollow" target="_blank"> PowerQuery查询折叠(MS文档)</a>(务必阅读本文末尾链接的文章)</li><li id="0b9c" class="mu mv it lu b lv nd ly ne mb nf mf ng mj nh mn mz na nb nc bi translated"><a class="ae kz" href="https://www.mssqltips.com/sqlservertip/3635/query-folding-in-power-query-to-improve-performance/" rel="noopener ugc nofollow" target="_blank">增强查询中的查询折叠以提高性能(MSSQL提示)</a></li><li id="b21d" class="mu mv it lu b lv nd ly ne mb nf mf ng mj nh mn mz na nb nc bi translated"><a class="ae kz" href="https://blog.crossjoin.co.uk/2021/02/21/query-folding-on-sql-queries-in-power-query-using-value-nativequery-and-enablefoldingtrue/" rel="noopener ugc nofollow" target="_blank">使用值对SQL查询进行查询折叠。NativeQuery()和EnableFolding=true(克里斯·韦伯的博客)</a></li><li id="e5b6" class="mu mv it lu b lv nd ly ne mb nf mf ng mj nh mn mz na nb nc bi translated"><a class="ae kz" href="https://docs.microsoft.com/en-us/power-query/native-query-folding" rel="noopener ugc nofollow" target="_blank">原生查询上的查询折叠—超级查询|微软文档</a></li><li id="aea1" class="mu mv it lu b lv nd ly ne mb nf mf ng mj nh mn mz na nb nc bi translated"><a class="ae kz" href="https://blog.crossjoin.co.uk/?s=Query+folding&amp;submit=Search" rel="noopener ugc nofollow" target="_blank">克里斯·韦伯博客上“查询折叠”的搜索结果</a></li></ul><p id="7d91" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">一定不要错过@Nikola Ilic关于查询折叠的文章。</p><p id="95fc" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我使用Contoso样本数据集，就像我以前的文章一样。数据集可以在MIT许可下自由使用，如这里的<a class="ae kz" href="https://github.com/microsoft/Power-BI-Embedded-Contoso-Sales-Demo" rel="noopener ugc nofollow" target="_blank">所述</a>。</p><p id="7b38" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">下载链接在这里:<a class="ae kz" href="https://www.microsoft.com/en-gb/download/details.aspx?id=18279" rel="noopener ugc nofollow" target="_blank">从微软官方下载中心</a>下载面向零售业的微软Contoso BI演示数据集。</p><p id="c2c1" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">或者，您可以使用SQLBI的工具<a class="ae kz" href="https://www.sqlbi.com/tools/contoso-data-generator/" rel="noopener ugc nofollow" target="_blank"> Contoso数据生成器</a>来生成Contoso数据集的副本。</p><div class="oe of gp gr og oh"><a href="https://medium.com/@salvatorecagliari/membership" rel="noopener follow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">通过我的推荐链接加入Medium-Salvatore Cagliari</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">阅读萨尔瓦托勒·卡利亚里的每一个故事(以及媒体上成千上万的其他作家)。您的会员费直接…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">medium.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov kt oh"/></div></div></a></div></div></div>    
</body>
</html>