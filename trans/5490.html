<html>
<head>
<title>Writing Window Functions with the Frame Clause</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Frame 子句编写窗口函数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/writing-window-functions-with-the-frame-clause-e91ada9da8b9#2022-12-09">https://towardsdatascience.com/writing-window-functions-with-the-frame-clause-e91ada9da8b9#2022-12-09</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><h2 id="56b9" class="ip iq ir bd b dl is it iu iv iw ix dk iy translated" aria-label="kicker paragraph">辅导的</h2><div class=""/><div class=""><h2 id="c726" class="pw-subtitle-paragraph jx ja ir bd b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dk translated">计算 6 个月移动平均值</h2></div><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj kp"><img src="../Images/46562c40b53bba02a4ee078da589249e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Mg35NFHZcgvdw7CwC8QiA.jpeg"/></div></div><p class="lb lc gk gi gj ld le bd b be z dk translated">佩克斯·马体·米罗什尼琴科</p></figure><p id="fb2f" class="pw-post-body-paragraph lf lg ir lh b li lj kb lk ll lm ke ln lo lp lq lr ls lt lu lv lw lx ly lz ma ik bi translated">当我看着我所做的工作时，我认为自己是一名建筑工人。像大多数建筑工人一样，我有工作时使用的工具。我越了解这些工具，工作就越容易做。其中一个工具是窗口功能。我喜欢它的多功能性；它分割、切割和控制数据的能力。</p><p id="a153" class="pw-post-body-paragraph lf lg ir lh b li lj kb lk ll lm ke ln lo lp lq lr ls lt lu lv lw lx ly lz ma ik bi translated">在本教程中，我们将深入研究窗口函数中的<strong class="lh jb">框架子句</strong>。我们使用 frame 子句来控制计算中包含的行数。我们在使用<strong class="lh jb">集合窗口函数</strong>或某些<strong class="lh jb">值窗口函数</strong>时会发现框架子句。本教程假设你对窗口函数有基本的了解。如果你是窗口函数新手，推荐阅读<strong class="lh jb"> SQL 窗口函数</strong>，一段爱恨情仇。</p><div class="mb mc gq gs md me"><a rel="noopener follow" target="_blank" href="/sql-window-functions-78593bcabf4"><div class="mf ab fp"><div class="mg ab mh cl cj mi"><h2 class="bd jb gz z fq mj fs ft mk fv fx ja bi translated">SQL 窗口函数</h2><div class="ml l"><h3 class="bd b gz z fq mj fs ft mk fv fx dk translated">爱恨交加的关系</h3></div><div class="mm l"><p class="bd b dl z fq mj fs ft mk fv fx dk translated">towardsdatascience.com</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms kz me"/></div></div></a></div><p id="2cf6" class="pw-post-body-paragraph lf lg ir lh b li lj kb lk ll lm ke ln lo lp lq lr ls lt lu lv lw lx ly lz ma ik bi translated">当处理数据时，窗口函数是一个强大的工具。为了帮助解释<strong class="lh jb">框架子句</strong>，我展示了如何使用它来计算一个<strong class="lh jb"> 6 个月的移动平均值</strong>。</p><h2 id="f4a6" class="mt mu ir bd mv mw mx dn my mz na dp nb lo nc nd ne ls nf ng nh lw ni nj nk ix bi translated">数据:如何访问它？</h2><p id="3c6b" class="pw-post-body-paragraph lf lg ir lh b li nl kb lk ll nm ke ln lo nn lq lr ls no lu lv lw np ly lz ma ik bi translated">要跟进，您可以通过以下方式访问数据:</p><ul class=""><li id="45ee" class="nq nr ir lh b li lj ll lm lo ns ls nt lw nu ma nv nw nx ny bi translated"><a class="ae nz" href="https://form.jotform.com/223404174362045" rel="noopener ugc nofollow" target="_blank">点击此处</a>，我将向您发送用户名和密码以及如何访问数据的说明，以便您直接查询数据库。我有几个用户座位。注册无需付费，也不会收集个人信息。我正在探索新的方法来帮助读者轻松地接触这些材料。</li><li id="e63e" class="nq nr ir lh b li oa ll ob lo oc ls od lw oe ma nv nw nx ny bi translated">直接从<a class="ae nz" href="https://github.com/bensondavies/DataFiles/blob/main/sales_revenue.csv" rel="noopener ugc nofollow" target="_blank">这里</a>下载一个 csv 文件，这样你就可以把它上传到你自己的数据库。</li></ul><p id="c0a4" class="pw-post-body-paragraph lf lg ir lh b li lj kb lk ll lm ke ln lo lp lq lr ls lt lu lv lw lx ly lz ma ik bi translated">现在我们已经知道了，我们可以更深入地了解窗口函数中的<strong class="lh jb">框架子句</strong>。</p><h2 id="a1ba" class="mt mu ir bd mv mw mx dn my mz na dp nb lo nc nd ne ls nf ng nh lw ni nj nk ix bi translated">框架子句:是什么？</h2><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj of"><img src="../Images/6816da232227060b92adaa5d2ef5b102.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j0giL8lkBQGve0mI2W_0CQ.jpeg"/></div></div><p class="lb lc gk gi gj ld le bd b be z dk translated">窗口功能，作者</p></figure><p id="9ada" class="pw-post-body-paragraph lf lg ir lh b li lj kb lk ll lm ke ln lo lp lq lr ls lt lu lv lw lx ly lz ma ik bi translated">框架子句确定包含在窗口函数计算中的行。我使用术语<strong class="lh jb">计算</strong>作为提醒，窗口函数产生一个数值结果<strong class="lh jb">和</strong>在<strong class="lh jb">框架子句</strong>中指定的行确定结果。这才是真正的重点。<strong class="lh jb">你</strong>可以通过使用<strong class="lh jb">框架子句</strong>来控制窗口函数的<strong class="lh jb">结果</strong>。</p><p id="d4e4" class="pw-post-body-paragraph lf lg ir lh b li lj kb lk ll lm ke ln lo lp lq lr ls lt lu lv lw lx ly lz ma ik bi translated">frame 子句具有以下语法:</p><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj og"><img src="../Images/e38c9c418f1971efb5cfe5fcbf8f1b0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aPKh8DATvaeLX6K0VBO5xQ.jpeg"/></div></div><p class="lb lc gk gi gj ld le bd b be z dk translated">框架子句语法，作者</p></figure><h2 id="a134" class="mt mu ir bd mv mw mx dn my mz na dp nb lo nc nd ne ls nf ng nh lw ni nj nk ix bi translated">框架条款:大局！</h2><p id="cb77" class="pw-post-body-paragraph lf lg ir lh b li nl kb lk ll nm ke ln lo nn lq lr ls no lu lv lw np ly lz ma ik bi translated">从概念上来说，我发现把窗口框架想象成从左到右向下执行是很有帮助的。<strong class="lh jb">向下</strong>走到下一排。<strong class="lh jb">从左到右</strong>在向下到下一行之前填充结果列。</p><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj oh"><img src="../Images/ebba67a97e667e775ba48460d01ce3a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1D1oJ4PrPN5keJUK9QUsnA.jpeg"/></div></div><p class="lb lc gk gi gj ld le bd b be z dk translated">窗口框架执行，作者</p></figure><p id="6050" class="pw-post-body-paragraph lf lg ir lh b li lj kb lk ll lm ke ln lo lp lq lr ls lt lu lv lw lx ly lz ma ik bi translated">在我们的示例中，假设处理从第 7 行开始:</p><ul class=""><li id="5495" class="nq nr ir lh b li lj ll lm lo ns ls nt lw nu ma nv nw nx ny bi translated">第 7 行(蓝色):窗口框架包括当前行(第 7 行)和之前的 5 行(第 2-6 行)，用于确定窗口函数结果，<strong class="lh jb"> X </strong>。一旦该列填充了结果，处理<strong class="lh jb">继续向下</strong>并到达下一行<strong class="lh jb">第 8 行</strong>。</li><li id="b9ca" class="nq nr ir lh b li oa ll ob lo oc ls od lw oe ma nv nw nx ny bi translated">第 8 行(橙色):在第 8 行，重复该过程，窗口框架包括当前行(第 8 行)和前面的 5 行(第 3-7 行)，以确定窗口函数结果，<strong class="lh jb"> Y </strong>。一旦该列填充了结果，处理<strong class="lh jb">继续向下</strong>到下一行<strong class="lh jb">第 9 行</strong>。</li><li id="c4f9" class="nq nr ir lh b li oa ll ob lo oc ls od lw oe ma nv nw nx ny bi translated">第 9 行(灰色):在第 9 行，重复该过程，窗口帧包括当前行(第 9 行)和前面的 5 行(第 3-7 行)，以确定窗口函数结果，<strong class="lh jb"> Y </strong>。一旦该列填充了结果，处理继续到下一行，<strong class="lh jb">行 10 </strong>。</li></ul><p id="db08" class="pw-post-body-paragraph lf lg ir lh b li lj kb lk ll lm ke ln lo lp lq lr ls lt lu lv lw lx ly lz ma ik bi translated">处理继续向右下方进行，直到到达最后一行。<strong class="lh jb">要点</strong>要记住:</p><ul class=""><li id="56b0" class="nq nr ir lh b li lj ll lm lo ns ls nt lw nu ma nv nw nx ny bi translated">框架将<strong class="lh jb">向下移动</strong>并在每行处理后将<strong class="lh jb">结果列填充到右侧</strong>。</li><li id="a12e" class="nq nr ir lh b li oa ll ob lo oc ls od lw oe ma nv nw nx ny bi translated"><strong class="lh jb">当前行</strong>随着每行的加工而变化。</li></ul><h2 id="70b9" class="mt mu ir bd mv mw mx dn my mz na dp nb lo nc nd ne ls nf ng nh lw ni nj nk ix bi translated">框架条款:计算 6 个月移动平均线</h2><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div class="gi gj oi"><img src="../Images/a9db21090819b99d9c078957d79b9362.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*k7QEqvd13rP606jBRHVMhg.jpeg"/></div><p class="lb lc gk gi gj ld le bd b be z dk translated">销售示例，作者</p></figure><p id="ca5d" class="pw-post-body-paragraph lf lg ir lh b li lj kb lk ll lm ke ln lo lp lq lr ls lt lu lv lw lx ly lz ma ik bi translated">在我们的例子中，对于上面显示的数据，我们假设语法是“前 5 行和当前行之间的行”。处理从第 7 行开始。</p><ul class=""><li id="8aa0" class="nq nr ir lh b li lj ll lm lo ns ls nt lw nu ma nv nw nx ny bi translated">第 7 行(蓝色):窗口框架包括当前行(第 7 行)和前面的 5 行(第 2-6 行)，以确定 6 个月的移动平均值$582，497。6 个月移动平均线的计算如下。一旦该列被填充，处理继续向下进行到 r <strong class="lh jb"> ow 8。</strong></li></ul><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div class="gi gj oj"><img src="../Images/c839768db7120205289d49c4eaa2ac05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*wIDx6lh1RBz2S1ye1fbPVw.jpeg"/></div></figure><ul class=""><li id="6ba8" class="nq nr ir lh b li lj ll lm lo ns ls nt lw nu ma nv nw nx ny bi translated">第 8 行(橙色):在第 8 行，重复该过程，窗口框架包括当前行(第 8 行)和前面的 5 行(第 3-7 行)，以确定 6 个月的移动平均值$601，488。6 个月移动平均线的计算如下。一旦该列被填充，处理继续向下进行到 r <strong class="lh jb"> ow 9。</strong></li></ul><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div class="gi gj oj"><img src="../Images/227c70c555887ce713e79059233bab95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*wiXACTh9kkgDVm9HQNp2qA.jpeg"/></div></figure><ul class=""><li id="fd72" class="nq nr ir lh b li lj ll lm lo ns ls nt lw nu ma nv nw nx ny bi translated">第 9 行(灰色):在第 9 行，重复该过程，窗口框架包括当前行(第 9 行)和前面的 5 行(第 4-8 行)，以确定 6 个月的移动平均值$625，009。6 个月移动平均线的计算如下。一旦该列被填充，处理继续从左到右向下进行到最后一行<strong class="lh jb">。</strong></li></ul><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div class="gi gj oj"><img src="../Images/71b6e6fe69ae17a248656cd077046e7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*G5X2zqLqnOPBDmisOJJiYA.jpeg"/></div></figure><h2 id="bd8a" class="mt mu ir bd mv mw mx dn my mz na dp nb lo nc nd ne ls nf ng nh lw ni nj nk ix bi translated">我们的场景</h2><p id="7266" class="pw-post-body-paragraph lf lg ir lh b li nl kb lk ll nm ke ln lo nn lq lr ls no lu lv lw np ly lz ma ik bi translated">下面的例子中的数据包括按月的销售收入。目的是使用<strong class="lh jb">框架条款</strong>计算 6 个月移动平均线。说完这些，让我们在 SQL 编辑器中深入研究一下代码。对于 6 个月移动平均线<strong class="lh jb">，</strong>，我们使用<strong class="lh jb">平均窗口函数</strong>，并将<strong class="lh jb">框架子句</strong>设置为“前 5 行和当前行之间的行”。这里，我们也按升序对月份进行排序，因为我们希望从最早的日期到最后的日期进行聚合。</p><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj ok"><img src="../Images/b3001ae2e7133bf093be77bcc1f516aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HVNYl53MVdvWA3jSV6WyvA.jpeg"/></div></div></figure><p id="d8bf" class="pw-post-body-paragraph lf lg ir lh b li lj kb lk ll lm ke ln lo lp lq lr ls lt lu lv lw lx ly lz ma ik bi translated">当查询运行时，它会在 SQL 编辑器中显示结果。突出显示的第 7–9 行与前面解释中共享的结果相匹配。我建议通过下载数据集或请求用户名和密码来练习。暂时就这样了。继续成长、学习和发展。</p><p id="0408" class="pw-post-body-paragraph lf lg ir lh b li lj kb lk ll lm ke ln lo lp lq lr ls lt lu lv lw lx ly lz ma ik bi translated"><strong class="lh jb"> <em class="ol">分享的灵感</em> </strong> <em class="ol">:每一次分享的关键一击和教训，都让我想起我以前的同学，当时的经理，索菲亚。她用自己的语言、善良、专注和领导力帮助我重拾信心。当我结束为她工作时，我觉得我可以飞黄腾达了。直到今天，我还在惊叹她和她丈夫亚伯的善良。每一天都是让别人的生活变得更好的机会。拿着！</em></p></div></div>    
</body>
</html>