<html>
<head>
<title>Diagrams as Code in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中作为代码的图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/diagrams-as-code-python-d9cbaa959ed5#2022-08-23">https://towardsdatascience.com/diagrams-as-code-python-d9cbaa959ed5#2022-08-23</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="ed38" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">用Python创建云系统架构图</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/de3964abe5b0a665b8ed97fb353f873d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wUXTv35KOXZBv4g7upwCBQ.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@mariolagr?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">玛丽奥拉·格罗贝尔斯卡</a>在<a class="ae kz" href="https://unsplash.com/s/photos/diagram?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="d13a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在过去的几年里，我使用了许多不同的工具来绘制系统架构图，包括数据平台和云架构，包括<a class="ae kz" href="https://draw.io" rel="noopener ugc nofollow" target="_blank"> <strong class="lc iv"> draw.io </strong> </a>和<a class="ae kz" href="https://excalidraw.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lc iv"> Excalidraw </strong> </a>。</p><p id="7ff6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">尽管这些平台提供了各种各样的工具，可以帮助你画出想要的图，但我一直在为一些事情而挣扎。首先，对我来说，与组织中的其他人分享图表并不容易，这样他们就有可能更新或修改它们。其次，对我的图进行版本控制几乎是不可能的，在大多数情况下，我必须保存一个包含元数据的文件，该文件可以用来重新加载一个旧的图。</p><p id="5721" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最后，我的图缺乏一致性——在我看来——这是非常重要的，因为你需要创建几个不同的图，并且必须呈现给用户和同事。我所说的一致性是指能够使用各种图表组件——包括边、节点等。—始终如一。</p><p id="3b12" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最近，我遇到了一个Python包，它可以让你在没有任何设计工具的情况下，用Python代码绘制云系统架构。换句话说，它以代码的形式提供了图表，您可以通过编程的方式绘制图表，同时能够对它们进行版本控制。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="8d75" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">图表包</h2><p id="30db" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated"><a class="ae kz" href="https://diagrams.mingrammer.com/" rel="noopener ugc nofollow" target="_blank"> Diagrams </a>是一个Python包，可以用来创建云系统架构图，支持亚马逊Web Services (AWS)、微软Azure、谷歌云平台(GCP)、Kubernetes、阿里云、甲骨文云等六大云提供商。此外，它还支持其他常用的技术，如特定的编程语言、框架、聊天系统和更多的节点。同时，您还可以选择创建定制节点，以服务于您的特定用例。</p><p id="37ef" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">该包需要Python 3.6或更高版本，因此在尝试之前，请确保您的主机上有兼容的Python版本。此外，您还必须安装<a class="ae kz" href="https://www.graphviz.org/" rel="noopener ugc nofollow" target="_blank">Graphviz</a>——一个开源的图形可视化软件，Diagrams package使用它来呈现图表。</p><blockquote class="nb nc nd"><p id="9194" class="la lb ne lc b ld le jv lf lg lh jy li nf lk ll lm ng lo lp lq nh ls lt lu lv in bi translated">如果你使用的是<a class="ae kz" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">自制软件</a>，macOS用户可以通过<code class="fe ni nj nk nl b">brew install graphviz</code>下载Graphviz。同样，安装了<a class="ae kz" href="https://chocolatey.org/" rel="noopener ugc nofollow" target="_blank"> Chocolatey </a>的Windows用户也可以运行<code class="fe ni nj nk nl b">choco install graphviz</code>。</p><p id="67b9" class="la lb ne lc b ld le jv lf lg lh jy li nf lk ll lm ng lo lp lq nh ls lt lu lv in bi translated">—图表文档</p></blockquote><p id="3b6c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在你已经仔细检查了你的Python版本并安装了Graphviz，你可以继续通过<code class="fe ni nj nk nl b">pip</code>安装这个包了:</p><pre class="kk kl km kn gu nm nl nn no aw np bi"><span id="a94a" class="md me iu nl b gz nq nr l ns nt">$ pip install diagrams</span></pre></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="92eb" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">用Python创建云架构图</h2><p id="b97a" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">在将我们的第一个图创建为代码之前，让我们探索一下这个包的一些最基本的组件。</p><p id="9eb8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">第一个是<code class="fe ni nj nk nl b">Diagram</code>，它是表示全局图上下文的主要对象。你可以使用<code class="fe ni nj nk nl b">Diagram</code>作为上下文管理器</p><pre class="kk kl km kn gu nm nl nn no aw np bi"><span id="f40e" class="md me iu nl b gz nq nr l ns nt"><strong class="nl iv">from</strong> diagrams <strong class="nl iv">import</strong> Diagram<br/><strong class="nl iv">from</strong> diagrams.gcp.analytics <strong class="nl iv">import</strong> Bigquery<br/></span><span id="1c07" class="md me iu nl b gz nu nr l ns nt"><strong class="nl iv">with</strong> Diagram('My Diagram'):<br/>    BigQuery('Data Warehouse')</span></pre><p id="ce61" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">上面的代码片段将创建一个由单个BigQuery节点组成的图表，该节点是Google云平台上的托管数据仓库服务。</p><p id="b33f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这个包的第二个基本组件是<code class="fe ni nj nk nl b">Node</code>，它是一个抽象的概念，代表一个单一的系统组件对象。典型的<code class="fe ni nj nk nl b">Node</code>由三个基本部分组成；<strong class="lc iv">提供方</strong>、<strong class="lc iv">资源类型</strong>和<strong class="lc iv">名称。</strong>例如，我们在前面的代码片段中使用的BigQuery节点是由<code class="fe ni nj nk nl b">gcp</code>提供者提供的，属于<code class="fe ni nj nk nl b">analytics</code>资源类型(显然BigQuery对应于节点的名称)。请注意，您甚至可以创建自己的自定义节点:</p><pre class="kk kl km kn gu nm nl nn no aw np bi"><span id="a27e" class="md me iu nl b gz nq nr l ns nt"><strong class="nl iv">from</strong> diagrams <strong class="nl iv">import</strong> Diagram, Node</span><span id="3717" class="md me iu nl b gz nu nr l ns nt"><strong class="nl iv">with</strong> Diagram('My Diagram'):<br/>    Node('This is a custom node')</span></pre><p id="3d7c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">使用这个库创建图的第三个关键组件叫做<code class="fe ni nj nk nl b">Cluster</code>，它允许多个节点以一种方式组合在一起，这些节点都与集群中不包含的任何其他节点相隔离。</p><p id="73a8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">例如，考虑下面由三个节点组成的图表；一个用于Google云存储(这是Google云平台上的托管对象存储服务)，一个云SQL节点(这是GCP上的托管Postgres服务)和一个本地MongoDB。</p><pre class="kk kl km kn gu nm nl nn no aw np bi"><span id="a2ca" class="md me iu nl b gz nq nr l ns nt"><strong class="nl iv">from</strong> diagrams <strong class="nl iv">import</strong> Cluster, Diagram<br/><strong class="nl iv">from </strong>diagrams.gcp.database <strong class="nl iv">import</strong> SQL<br/><strong class="nl iv">from</strong> diagrams.gcp.storage <strong class="nl iv">import</strong> GCS<br/><strong class="nl iv">from</strong> diagrams.onprem.database <strong class="nl iv">import</strong> MongoDB</span><span id="a5a4" class="md me iu nl b gz nu nr l ns nt"><strong class="nl iv">with</strong> Diagram('My Diagram', direction='TB'):<br/>  gcs = GCS('Google Cloud Storage')</span><span id="8580" class="md me iu nl b gz nu nr l ns nt"><strong class="nl iv">with</strong> Cluster('Databases'):<br/>  cloud_sql = SQL('Cloud SQL')<br/>  mongodb = MongoDB('MongoDB')</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nv"><img src="../Images/4e595935a9c6eb5df6786235ac2962ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-hVVH4HrWGOY9bzVSD99Ug.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">带有数据库集群的示例图—来源:作者</p></figure><p id="7765" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最后，图的最后一个基本组件是<code class="fe ni nj nk nl b">Edge</code>——一个表示两个<code class="fe ni nj nk nl b">Node</code>对象之间的边的对象，有三个属性；标签、颜色和样式。</p><pre class="kk kl km kn gu nm nl nn no aw np bi"><span id="876d" class="md me iu nl b gz nq nr l ns nt"><strong class="nl iv">from</strong> diagrams <strong class="nl iv">import</strong> Diagram, Edge, Node<br/></span><span id="9897" class="md me iu nl b gz nu nr l ns nt"><strong class="nl iv">with</strong> Diagram('My Diagram', direction='TB'):<br/>    n1 = Node('n1')<br/>    n2 = Node('n2')<br/>    n3 = Node('n3')<br/>    n4 = Node('n4')<br/>    n5 = Node('n5')<br/>    n6 = Node('n6')   <br/>    <br/>    n1 &gt;&gt; n2<br/>    n3 - n4<br/>    n5 &gt;&gt; Edge(label='This is a label', color='red') &gt;&gt; n6</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nw"><img src="../Images/f13f65de2ca06d77098ac3beddfd4335.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VCatf6Xz4PHrgweUn0BllQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">不同类型边的示例—来源:作者</p></figure></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="8520" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">创建架构图</h2><p id="d25b" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">现在我们已经了解了用Python构建一个图所需的基本对象，让我们使用前面提到的组件创建一个更真实的流程。</p><p id="d356" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在下面的例子中(摘自官方文档),我们创建了一个与Google云平台上的消息收集系统相对应的图表。</p><pre class="kk kl km kn gu nm nl nn no aw np bi"><span id="4d95" class="md me iu nl b gz nq nr l ns nt"><strong class="nl iv">from</strong> diagrams <strong class="nl iv">import</strong> Cluster, Diagram<br/><strong class="nl iv">from</strong> diagrams.gcp.analytics <strong class="nl iv">import</strong> BigQuery, Dataflow, PubSub<br/><strong class="nl iv">from</strong> diagrams.gcp.compute <strong class="nl iv">import</strong> AppEngine, Functions<br/><strong class="nl iv">from</strong> diagrams.gcp.database <strong class="nl iv">import</strong> BigTable<br/><strong class="nl iv">from</strong> diagrams.gcp.iot <strong class="nl iv">import</strong> IotCore<br/><strong class="nl iv">from</strong> diagrams.gcp.storage <strong class="nl iv">import</strong> GCS</span><span id="98fa" class="md me iu nl b gz nu nr l ns nt"><strong class="nl iv">with</strong> Diagram("Message Collecting", show=False):<br/>    pubsub = PubSub("pubsub")</span><span id="572e" class="md me iu nl b gz nu nr l ns nt"><strong class="nl iv">with</strong> Cluster("Source of Data"):<br/>        [IotCore("core1"),<br/>         IotCore("core2"),<br/>         IotCore("core3")] &gt;&gt; pubsub</span><span id="cb4b" class="md me iu nl b gz nu nr l ns nt"><strong class="nl iv">with</strong> Cluster("Targets"):<br/>        with Cluster("Data Flow"):<br/>            flow = Dataflow("data flow")</span><span id="fed8" class="md me iu nl b gz nu nr l ns nt"><strong class="nl iv">with</strong> Cluster("Data Lake"):<br/>            flow &gt;&gt; [BigQuery("bq"),<br/>                     GCS("storage")]</span><span id="1001" class="md me iu nl b gz nu nr l ns nt"><strong class="nl iv">with</strong> Cluster("Event Driven"):<br/>            with Cluster("Processing"):<br/>                flow &gt;&gt; AppEngine("engine") &gt;&gt; BigTable("bigtable")</span><span id="43cb" class="md me iu nl b gz nu nr l ns nt"><strong class="nl iv">with</strong> Cluster("Serverless"):<br/>                flow &gt;&gt; Functions("func") &gt;&gt; AppEngine("appengine")</span><span id="5ce4" class="md me iu nl b gz nu nr l ns nt">pubsub &gt;&gt; flow</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nx"><img src="../Images/d9ee8683cc931597d3153b64a839b4e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GK4D5g4O4uEc4VpUYzDeqQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Google云平台上的消息收集图—来源:<a class="ae kz" href="https://diagrams.mingrammer.com/docs/getting-started/examples" rel="noopener ugc nofollow" target="_blank">文档</a></p></figure></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="b1a6" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">最后的想法</h2><p id="f311" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">架构图非常重要，因为它们清楚地展示了组织中各种组件的工作方式。因此，重要的是让他们正确，并以一种良好、直观和一致的方式呈现他们。</p><p id="10fe" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">此外，能够容易地共享这些图也很重要，通过这种方式，它们可以容易地被不同的人修改，同时被版本控制。</p><p id="641c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当涉及到绘制和共享架构图时，作为代码的图是一种可以帮助您朝着这个方向前进的方法。在今天的教程中，我们展示了如何利用<code class="fe ni nj nk nl b">diagrams</code>包来用Python编程创建图表。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><p id="1b77" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://gmyrianthous.medium.com/membership" rel="noopener"> <strong class="lc iv">成为会员</strong> </a> <strong class="lc iv">阅读介质上的每一个故事。你的会员费直接支持我和你看的其他作家。你也可以在媒体上看到所有的故事。</strong></p><div class="ny nz gq gs oa ob"><a href="https://gmyrianthous.medium.com/membership" rel="noopener follow" target="_blank"><div class="oc ab fp"><div class="od ab oe cl cj of"><h2 class="bd iv gz z fq og fs ft oh fv fx it bi translated">通过我的推荐链接加入Medium-Giorgos Myrianthous</h2><div class="oi l"><h3 class="bd b gz z fq og fs ft oh fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oj l"><p class="bd b dl z fq og fs ft oh fv fx dk translated">gmyrianthous.medium.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op kt ob"/></div></div></a></div></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><p id="676e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">相关文章您可能也喜欢</strong></p><div class="ny nz gq gs oa ob"><a rel="noopener follow" target="_blank" href="/apache-airflow-architecture-496b9cb28288"><div class="oc ab fp"><div class="od ab oe cl cj of"><h2 class="bd iv gz z fq og fs ft oh fv fx it bi translated">阿帕奇气流架构</h2><div class="oi l"><h3 class="bd b gz z fq og fs ft oh fv fx dk translated">深入探讨Apache Airflow架构及其如何编排工作流</h3></div><div class="oj l"><p class="bd b dl z fq og fs ft oh fv fx dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="oq l om on oo ok op kt ob"/></div></div></a></div></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu ob"><a rel="noopener follow" target="_blank" href="/parallel-computing-92c4f818c"><div class="oc ab fp"><div class="od ab oe cl cj of"><h2 class="bd iv gz z fq og fs ft oh fv fx it bi translated">什么是并行计算？</h2><div class="oi l"><h3 class="bd b gz z fq og fs ft oh fv fx dk translated">理解并行计算在数据工程环境中的重要性</h3></div><div class="oj l"><p class="bd b dl z fq og fs ft oh fv fx dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="or l om on oo ok op kt ob"/></div></div></a></div></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu ob"><a rel="noopener follow" target="_blank" href="/big-o-notation-32fb458e5260"><div class="oc ab fp"><div class="od ab oe cl cj of"><h2 class="bd iv gz z fq og fs ft oh fv fx it bi translated">大O符号</h2><div class="oi l"><h3 class="bd b gz z fq og fs ft oh fv fx dk translated">用Big-O符号计算算法的时间和空间复杂度</h3></div><div class="oj l"><p class="bd b dl z fq og fs ft oh fv fx dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="os l om on oo ok op kt ob"/></div></div></a></div></div></div>    
</body>
</html>