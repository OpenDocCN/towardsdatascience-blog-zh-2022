<html>
<head>
<title>This Decorator will Make Python 30 Times Faster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">这个装饰器将使Python速度提高30倍</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/this-decorator-will-make-python-30-times-faster-715ca5a66d5f#2022-09-30">https://towardsdatascience.com/this-decorator-will-make-python-30-times-faster-715ca5a66d5f#2022-09-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="beb9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">以熊猫为例</h2></div><p id="03bc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">撰写人:<a class="ae le" href="https://medium.com/u/d38873cbc5aa?source=post_page-----40d1ab7243c2--------------------------------" rel="noopener">阿玛尔·哈斯尼</a> &amp; <a class="ae le" href="https://medium.com/u/7f47bdb8b8c0?source=post_page-----40d1ab7243c2--------------------------------" rel="noopener">迪亚·赫米拉</a></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/f6011cac2adc152b6aa606213ae793cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/0*eHk6ZR2ctKPUHcVT.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">人工智能生成的图像(稳定扩散)</p></figure><p id="c8ef" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可能知道，python是一种解释型语言。这意味着python代码不是直接编译成机器代码，而是由另一个名为<strong class="kk iu">解释器</strong>(大多数情况下为<code class="fe lr ls lt lu b"> cpython</code>)的程序实时解释。</p><p id="7c51" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这也是为什么与编译语言相比，python有如此大的灵活性(动态类型，到处运行等等)的原因之一。然而，这也是python非常慢的原因。</p><h1 id="3995" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">缓慢python的解决方案</h1><p id="de9d" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">python速度慢实际上有多种解决方案:</p><ul class=""><li id="e90d" class="ms mt it kk b kl km ko kp kr mu kv mv kz mw ld mx my mz na bi translated">使用<code class="fe lr ls lt lu b">cython</code>:python的超集编程语言</li><li id="44aa" class="ms mt it kk b kl nb ko nc kr nd kv ne kz nf ld mx my mz na bi translated">使用C/C++语言结合<code class="fe lr ls lt lu b"> ctypes</code>、<code class="fe lr ls lt lu b"> pybind11</code>或<code class="fe lr ls lt lu b"> CFFI</code>编写python绑定</li><li id="d1e3" class="ms mt it kk b kl nb ko nc kr nd kv ne kz nf ld mx my mz na bi translated"><a class="ae le" href="https://docs.python.org/3/extending/extending.html" rel="noopener ugc nofollow" target="_blank">用C/C++扩展Python</a></li><li id="3a19" class="ms mt it kk b kl nb ko nc kr nd kv ne kz nf ld mx my mz na bi translated">使用其他编译语言，如<a class="ae le" href="https://github.com/PyO3/pyo3" rel="noopener ugc nofollow" target="_blank"> rust </a></li></ul><p id="59ef" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如您所见，所有这些方法都需要使用python之外的另一种语言，并编译代码以便与python一起工作。</p><p id="f7cc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">尽管这些都是有效的选择，但它们并不是让python变得更快的对初学者最友好的方法，并且不一定容易设置。</p><h2 id="c2ba" class="ng lw it bd lx nh ni dn mb nj nk dp mf kr nl nm mh kv nn no mj kz np nq ml nr bi translated">Numba和JIT编译</h2><p id="4ac6" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">来认识一下<code class="fe lr ls lt lu b"> numba</code>一个python包，它将使您的代码运行速度大大加快，而无需放弃python的便利性:</p><blockquote class="ns"><p id="057d" class="nt nu it bd nv nw nx ny nz oa ob ld dk translated">Numba是一个开源的JIT编译器，它将Python和NumPy代码的子集翻译成快速的机器代码。</p></blockquote><p id="9fb9" class="pw-post-body-paragraph ki kj it kk b kl oc ju kn ko od jx kq kr oe kt ku kv of kx ky kz og lb lc ld im bi translated"><code class="fe lr ls lt lu b">numba</code>使用<strong class="kk iu">实时(JIT)编译</strong>(这意味着它是在python代码执行期间的运行时编译的，而不是之前),在你问之前，不，你甚至不需要安装C/C++编译器。你所需要做的就是用pip/conda安装它:</p><pre class="lg lh li lj gt oh lu oi oj aw ok bi"><span id="fe19" class="ng lw it lu b gy ol om l on oo">pip install numba</span></pre><p id="528b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们已经说得够多了，让我们试一个例子(来自<code class="fe lr ls lt lu b"> numba</code>的文档)。我们希望使用蒙特卡罗模拟来计算<strong class="kk iu"> π </strong>的估计值:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="3839" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意如何使用<code class="fe lr ls lt lu b">numba</code>，只需要我们导入一个装饰器(<code class="fe lr ls lt lu b"> njit</code>)，它将完成所有的工作。</p><p id="7600" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">运行这段代码，对两个版本进行计时，显示出<strong class="kk iu"> numba比普通python </strong>快30倍:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="op oq l"/></div></figure><h2 id="7e66" class="ng lw it bd lx nh ni dn mb nj nk dp mf kr nl nm mh kv nn no mj kz np nq ml nr bi translated">一些警告</h2><p id="a7ea" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">如此呈现，听起来好得令人难以置信。但是它确实有它的缺点:</p><ul class=""><li id="7952" class="ms mt it kk b kl km ko kp kr mu kv mv kz mw ld mx my mz na bi translated">有一个开销，第一次运行一个<code class="fe lr ls lt lu b">numba</code>修饰函数。这是因为<code class="fe lr ls lt lu b">numba</code>会在函数第一次执行的时候试图找出参数的类型并编译它。所以第一次运行时会慢一点。</li><li id="c288" class="ms mt it kk b kl nb ko nc kr nd kv ne kz nf ld mx my mz na bi translated">并不是所有的python代码都会用<code class="fe lr ls lt lu b"> numba</code>编译，例如，如果你对同一个变量或者列表元素使用混合类型，你会得到一个错误。</li></ul><h1 id="7fe7" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">立体公园里的熊猫</h1><p id="a8bd" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated"><code class="fe lr ls lt lu b">numba</code>是专为<code class="fe lr ls lt lu b"> numpy</code>设计的，对numpy数组非常友好。你知道<code class="fe lr ls lt lu b"> numpy</code>上还建了什么吗？<br/>你猜对了:<code class="fe lr ls lt lu b"> pandas</code>。当使用用户定义的函数或者甚至执行不同的数据帧操作时，这会导致疯狂的优化。</p><p id="05f4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看一些例子，从这个数据框架开始:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="op oq l"/></div></figure><h2 id="1a6c" class="ng lw it bd lx nh ni dn mb nj nk dp mf kr nl nm mh kv nn no mj kz np nq ml nr bi translated">用户定义的函数</h2><p id="ebfb" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">numba的另一个方法是<code class="fe lr ls lt lu b"> vectorize</code>，这使得创建numpy通用函数(<a class="ae le" href="https://numpy.org/doc/stable/reference/ufuncs.html" rel="noopener ugc nofollow" target="_blank"> ufuncs </a>)变得轻而易举。</p><p id="7fbc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一个简单的例子是计算数据集中高度列的平方:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="op oq l"/></div></figure><h2 id="77b2" class="ng lw it bd lx nh ni dn mb nj nk dp mf kr nl nm mh kv nn no mj kz np nq ml nr bi translated">基本操作</h2><p id="551b" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">另一个例子(使用<code class="fe lr ls lt lu b"> njit</code>)是使用以下代码计算身体质量指数(身体质量指数):</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="ee18" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以看到，即使是基本操作，numba仍然比原始熊猫花费更少的时间(6.77毫秒对8.63毫秒)</p><h1 id="b875" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">最后的想法</h1><p id="3f77" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">使用<code class="fe lr ls lt lu b"> numba</code>是一种非常简单的方法，可以让你的代码运行得更快。有时，在你的代码被成功编译之前，可能需要一些尝试，但是一般来说，它可以开箱即用。</p><p id="981e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你对让熊猫跑得更快的更多方法感兴趣，看看我们关于<code class="fe lr ls lt lu b"> eval</code> &amp; <code class="fe lr ls lt lu b"> query</code>的文章:</p><div class="or os gp gr ot ou"><a href="https://python.plainenglish.io/these-methods-will-change-how-you-use-pandas-921e4669271f" rel="noopener  ugc nofollow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">这些方法将改变你使用熊猫的方式</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">通过一个简单的改变让熊猫跑得更快</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">python .平原英语. io</p></div></div><div class="pd l"><div class="pe l pf pg ph pd pi ll ou"/></div></div></a></div><p id="1733" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">谢谢你坚持到现在。注意安全，在接下来的故事中再见😊！</p><h1 id="89a3" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">更多文章阅读</h1><div class="or os gp gr ot ou"><a rel="noopener follow" target="_blank" href="/rapidly-explore-jupyter-notebooks-right-in-your-terminal-67598d2265c2"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">快速浏览Jupyter笔记本电脑(就在您的终端中)</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">优化笔记本搜索</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">towardsdatascience.com</p></div></div><div class="pd l"><div class="pj l pf pg ph pd pi ll ou"/></div></div></a></div><div class="or os gp gr ot ou"><a rel="noopener follow" target="_blank" href="/equivalents-between-pandas-and-pyspark-c8b5ba57dc1d"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">你从熊猫到Pyspark的平稳过渡指南</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">熊猫大战PySpark 101</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">towardsdatascience.com</p></div></div><div class="pd l"><div class="pk l pf pg ph pd pi ll ou"/></div></div></a></div><div class="or os gp gr ot ou"><a rel="noopener follow" target="_blank" href="/8-tips-to-write-cleaner-code-376f7232652c"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">编写更简洁代码的8个技巧</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">始终获得干净、可读和优雅的代码</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">towardsdatascience.com</p></div></div><div class="pd l"><div class="pl l pf pg ph pd pi ll ou"/></div></div></a></div><div class="or os gp gr ot ou"><a rel="noopener follow" target="_blank" href="/how-to-easily-merge-multiple-jupyter-notebooks-into-one-e464a22d2dc4"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">如何轻松将多台Jupyter笔记本合并为一台</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">黑进你的Jupyter</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">towardsdatascience.com</p></div></div><div class="pd l"><div class="pm l pf pg ph pd pi ll ou"/></div></div></a></div></div></div>    
</body>
</html>