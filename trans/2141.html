<html>
<head>
<title>How to Run Airflow Locally With Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Docker在本地运行气流</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/run-airflow-docker-1b83a57616fb#2022-05-13">https://towardsdatascience.com/run-airflow-docker-1b83a57616fb#2022-05-13</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="8654" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">在本地机器上使用Docker运行Airflow的分步指南</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/018fda1bcd21d1f74bec0c7f2af21d2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U8MMJcv-SxA2Y9wqp5Bv0w.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">约书亚·雷德科普在<a class="ae kz" href="https://unsplash.com/s/photos/coding?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h2 id="6107" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">介绍</h2><p id="079c" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">Apache Airflow是数据工程领域最热门的技术之一，它允许用户大规模地构建、编排和监控数据管道。</p><p id="16c7" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">很有可能你已经通过<code class="fe mu mv mw mx b">pip</code>安装了Airflow，试图在本地运行它，但是很有可能你会遇到问题，甚至更糟，搞乱你的本地环境。</p><p id="e684" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">如果您想在本地机器上测试气流，那么最简单的方法就是使用Docker图像。在今天的简短教程中，我们将逐步完成一个指南，帮助您在几分钟内通过Docker启动并运行Airflow。</p></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><h2 id="ea11" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">先决条件</h2><p id="34e7" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">首先，您需要确保您已经安装了</p><ul class=""><li id="362c" class="nf ng iu ly b lz mp mc mq lj nh ln ni lr nj mo nk nl nm nn bi translated"><a class="ae kz" href="https://docs.docker.com/engine/install/" rel="noopener ugc nofollow" target="_blank"> Docker社区版</a></li><li id="5d0a" class="nf ng iu ly b lz no mc np lj nq ln nr lr ns mo nk nl nm nn bi translated"><a class="ae kz" href="https://docs.docker.com/compose/install/" rel="noopener ugc nofollow" target="_blank"> Docker Compose </a>(注意，你需要版本≥ 1.29.1)</li></ul></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><h2 id="4f83" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">步骤1:获取docker-compose.yaml</h2><p id="eae7" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">我们首先需要的是docker-compose.yaml文件。在您的主目录上创建一个新目录(姑且称之为<code class="fe mu mv mw mx b">airflow-local</code>):</p><pre class="kk kl km kn gu nt mx nu nv aw nw bi"><span id="35c1" class="la lb iu mx b gz nx ny l nz oa">$ mkdir airflow-local<br/>$ cd airflow-local</span></pre><p id="d0e8" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">并获取<code class="fe mu mv mw mx b">docker-compose.yaml</code>文件(注意，我们将使用Airflow v2.3.0)</p><pre class="kk kl km kn gu nt mx nu nv aw nw bi"><span id="d1bf" class="la lb iu mx b gz nx ny l nz oa">$ curl -LfO 'https://airflow.apache.org/docs/apache-airflow/2.3.0/docker-compose.yaml'</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ob"><img src="../Images/4b047c6a356e1291fa0b0d320e0a3e3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yYPMw_9MoS2eWlYF8urXzg.png"/></div></div></figure><p id="53ee" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">您可以随意查看撰写文件以及其中定义的服务，即<code class="fe mu mv mw mx b">airflow-scheduler</code>、<code class="fe mu mv mw mx b">airflow-webserver</code>、<code class="fe mu mv mw mx b">airflow-worker</code>、<code class="fe mu mv mw mx b">airflow-init</code>、<code class="fe mu mv mw mx b">flower</code>、<code class="fe mu mv mw mx b">postgres</code>和<code class="fe mu mv mw mx b">redis</code>。</p></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><h2 id="fb31" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">步骤2:创建目录</h2><p id="2dc3" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">现在，当您在<code class="fe mu mv mw mx b">airflow-local</code>目录中时，我们将需要创建另外三个目录:</p><ul class=""><li id="f471" class="nf ng iu ly b lz mp mc mq lj nh ln ni lr nj mo nk nl nm nn bi translated"><code class="fe mu mv mw mx b">dags</code></li><li id="c4da" class="nf ng iu ly b lz no mc np lj nq ln nr lr ns mo nk nl nm nn bi translated"><code class="fe mu mv mw mx b">logs</code></li><li id="d1f1" class="nf ng iu ly b lz no mc np lj nq ln nr lr ns mo nk nl nm nn bi translated"><code class="fe mu mv mw mx b">plugins</code></li></ul><pre class="kk kl km kn gu nt mx nu nv aw nw bi"><span id="f33e" class="la lb iu mx b gz nx ny l nz oa">$ mkdir ./dags ./logs ./plugins</span></pre><h2 id="e069" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">步骤3:设置气流用户</h2><p id="7ff7" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">现在，我们必须导出一个环境变量，以确保主机上的文件夹和容器中的文件夹共享相同的权限。我们将简单地将这些变量添加到一个名为<code class="fe mu mv mw mx b">.env</code>的文件中。</p><pre class="kk kl km kn gu nt mx nu nv aw nw bi"><span id="525d" class="la lb iu mx b gz nx ny l nz oa">$ echo -e "AIRFLOW_UID=<strong class="mx iv">$(</strong>id -u<strong class="mx iv">)</strong>\nAIRFLOW_GID=0" &gt; .env</span></pre><p id="7d87" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">使用<code class="fe mu mv mw mx b">cat</code>检查<code class="fe mu mv mw mx b">.env</code>的内容，确保其包含上述两个变量。</p><pre class="kk kl km kn gu nt mx nu nv aw nw bi"><span id="a736" class="la lb iu mx b gz nx ny l nz oa">$ cat .env<br/>AIRFLOW_UID=501<br/>AIRFLOW_GID=0</span></pre></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><h2 id="c22f" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">步骤4:初始化气流数据库</h2><p id="aeb2" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">现在我们已经准备好初始化气流数据库，首先启动<code class="fe mu mv mw mx b">airflow-init</code>容器:</p><pre class="kk kl km kn gu nt mx nu nv aw nw bi"><span id="79d7" class="la lb iu mx b gz nx ny l nz oa">$ docker-compose up airflow-init</span></pre><p id="fc9e" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">该服务将运行<code class="fe mu mv mw mx b">airflow db init</code>，并为气流数据库创建管理员用户。默认情况下，创建的帐户有登录名<code class="fe mu mv mw mx b">airflow</code>和密码<code class="fe mu mv mw mx b">airflow</code>。</p></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><h2 id="a381" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">步骤5:启动气流服务</h2><p id="0baa" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">让气流启动并运行的最后一件事是启动我们在步骤1中看到的气流服务。</p><pre class="kk kl km kn gu nt mx nu nv aw nw bi"><span id="5794" class="la lb iu mx b gz nx ny l nz oa">$ docker-compose up</span></pre><p id="53c4" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">请注意，上述命令可能需要一段时间，因为需要启动多个服务。完成后，您可以在新的命令行选项卡中使用以下命令来验证这些映像已启动并正在运行:</p><pre class="kk kl km kn gu nt mx nu nv aw nw bi"><span id="87dc" class="la lb iu mx b gz nx ny l nz oa">$ docker ps</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oc"><img src="../Images/cd8a70cd72379d79257b289d92f8a1d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3oCXu6wPXOLJ1fRKKAjgDQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">气流图像启动并运行——来源:作者</p></figure><h2 id="2f4a" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">步骤6:访问气流用户界面</h2><p id="3a64" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">要访问Airflow用户界面，只需前往您喜欢的浏览器并打开<code class="fe mu mv mw mx b">localhost:8080</code>。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj od"><img src="../Images/1e67d241a5f1693c48a73c349266dd07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rQEZBcbHP7o_xxrwHWzIlA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">气流管理员登录——来源:作者</p></figure><p id="7349" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">键入您的凭据(如前所述，默认情况下，这些凭据将被设置为<code class="fe mu mv mw mx b">airflow</code>并点击“登录”)。现在，您应该可以访问气流控制面板，在这里您可以看到一些用气流修补的Dag示例。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oe"><img src="../Images/346a5934992cdb209ab025d54f7f89fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R_7rXTloIhLzXFeYHJshwg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">气流界面上的DAGs示例—来源:作者</p></figure><h2 id="c9b0" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">第七步:进入气流工作者容器</h2><p id="f5d6" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">您甚至可以进入worker容器，以便使用下面的命令运行<code class="fe mu mv mw mx b">airflow</code>命令。您可以通过运行<code class="fe mu mv mw mx b">docker ps</code>找到气流工作者服务的<code class="fe mu mv mw mx b">&lt;container-id&gt;</code>:</p><pre class="kk kl km kn gu nt mx nu nv aw nw bi"><span id="4539" class="la lb iu mx b gz nx ny l nz oa">$ docker exec -it &lt;container-id&gt; bash</span></pre><p id="185c" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">举个例子，</p><pre class="kk kl km kn gu nt mx nu nv aw nw bi"><span id="28de" class="la lb iu mx b gz nx ny l nz oa">$ docker exec -it d2697f8e7aeb bash<br/>$ default@d2697f8e7aeb:/opt/airflow$ airflow version<br/>2.3.0</span></pre><h2 id="2934" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">第八步:收拾残局</h2><p id="6288" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">一旦你完成了你的实验，你可以通过简单的运行来清理我们刚刚创造的混乱</p><pre class="kk kl km kn gu nt mx nu nv aw nw bi"><span id="3d38" class="la lb iu mx b gz nx ny l nz oa">$ docker-compose down --volumes --rmi all</span></pre><p id="6a73" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">此命令将停止并删除所有正在运行的容器，删除包含数据库数据和已下载映像的卷。</p><p id="ffe1" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">如果您再次运行<code class="fe mu mv mw mx b">docker ps</code>，您可以验证没有容器启动并运行</p><pre class="kk kl km kn gu nt mx nu nv aw nw bi"><span id="17db" class="la lb iu mx b gz nx ny l nz oa">$ docker ps<br/>CONTAINER ID  IMAGE   COMMAND   CREATED   STATUS    PORTS     NAMES</span></pre></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><h2 id="c4a7" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">最后的想法</h2><p id="f311" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">在今天的简短教程中，我们探索了一个分步指南，它可以帮助您通过Docker在本地计算机上安装和运行Apache Airflow v2.3.0。</p><p id="3530" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">请注意，Airflow Docker图像仅用于测试目的。如果你计划在生产环境中部署气流，我推荐你在Kubernetes上用官方的舵图运行它。</p></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><p id="1b77" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated"><a class="ae kz" href="https://gmyrianthous.medium.com/membership" rel="noopener"> <strong class="ly iv">成为会员</strong> </a> <strong class="ly iv">阅读介质上的每一个故事。你的会员费直接支持我和你看的其他作家。你也可以在媒体上看到所有的故事。</strong></p><div class="of og gq gs oh oi"><a href="https://gmyrianthous.medium.com/membership" rel="noopener follow" target="_blank"><div class="oj ab fp"><div class="ok ab ol cl cj om"><h2 class="bd iv gz z fq on fs ft oo fv fx it bi translated">通过我的推荐链接加入Medium-Giorgos Myrianthous</h2><div class="op l"><h3 class="bd b gz z fq on fs ft oo fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oq l"><p class="bd b dl z fq on fs ft oo fv fx dk translated">gmyrianthous.medium.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow kt oi"/></div></div></a></div></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><p id="676e" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated"><strong class="ly iv">相关文章你可能也喜欢</strong></p><div class="of og gq gs oh oi"><a rel="noopener follow" target="_blank" href="/data-engineer-tools-c7e68eed28ad"><div class="oj ab fp"><div class="ok ab ol cl cj om"><h2 class="bd iv gz z fq on fs ft oo fv fx it bi translated">数据工程师的工具</h2><div class="op l"><h3 class="bd b gz z fq on fs ft oo fv fx dk translated">数据工程工具箱的基础</h3></div><div class="oq l"><p class="bd b dl z fq on fs ft oo fv fx dk translated">towardsdatascience.com</p></div></div><div class="or l"><div class="ox l ot ou ov or ow kt oi"/></div></div></a></div></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu oi"><a rel="noopener follow" target="_blank" href="/python-3-11-f62708eed569"><div class="oj ab fp"><div class="ok ab ol cl cj om"><h2 class="bd iv gz z fq on fs ft oo fv fx it bi translated">Python 3.11有什么值得期待的</h2><div class="op l"><h3 class="bd b gz z fq on fs ft oo fv fx dk translated">探索Python 3.11中的新增内容和更新，以及如何尽早获得3.11 Alpha版本</h3></div><div class="oq l"><p class="bd b dl z fq on fs ft oo fv fx dk translated">towardsdatascience.com</p></div></div><div class="or l"><div class="oy l ot ou ov or ow kt oi"/></div></div></a></div></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu oi"><a href="https://betterprogramming.pub/kafka-cli-commands-1a135a4ae1bd" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fp"><div class="ok ab ol cl cj om"><h2 class="bd iv gz z fq on fs ft oo fv fx it bi translated">用于日常编程的15个Kafka CLI命令</h2><div class="op l"><h3 class="bd b gz z fq on fs ft oo fv fx dk translated">演示最常用的Kafka命令行界面命令的使用</h3></div><div class="oq l"><p class="bd b dl z fq on fs ft oo fv fx dk translated">better编程. pub</p></div></div><div class="or l"><div class="oz l ot ou ov or ow kt oi"/></div></div></a></div></div></div>    
</body>
</html>