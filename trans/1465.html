<html>
<head>
<title>Building a Panel Dashboard with Snowpark for Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Snowpark为Python构建面板仪表盘</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-panel-dashboard-with-snowpark-for-python-fe1b16e7bd75#2022-04-11">https://towardsdatascience.com/building-a-panel-dashboard-with-snowpark-for-python-fe1b16e7bd75#2022-04-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d951" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">数据科学家的雪花</h2></div><p id="9e37" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数据科学家通常使用SQL与数据仓库进行交互，但通常依赖Python进行数据发现、可视化和建模。如果我们可以用我们喜欢的Python工具直接与数据仓库交互，那该有多好？Snowflake现在原生支持Python和Snowpark for Python。它使我们的数据科学家能够用Python编码，同时享受Snowflake提供的相同的安全性、性能、治理和可管理性优势。有了这个工具，我可以与我的数据仓库交互，可视化数据，甚至直接用Python构建和部署模型到我的数据仓库。要了解数据库中有什么，首先要做的一件事就是可视化您的数据。在本文中，我将向您展示如何创建这个面板仪表板，以便有意义地可视化雪花数据集中的500万个数据点。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi le"><img src="../Images/5c11f1f7ef6d3b1ae4277c7e40307d54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*FDPLbU8QBuzrSIE9"/></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">作者图片</p></figure><h1 id="04f8" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated"><strong class="ak">什么是Python的Snowpark？</strong></h1><p id="46a2" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated">Snowpark for Python允许数据科学家编写我们熟悉的Python代码，并在Snowflake中将Python翻译回SQL。通过与Anaconda的合作，我们可以为Snowpark使用所有安全且精心管理的Python包。雪花甚至在Anaconda中有自己的Python包存储库:【https://repo.anaconda.com/pkgs/snowflake<a class="ae mn" href="https://repo.anaconda.com/pkgs/snowflake/" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="5944" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated"><strong class="ak">什么是面板？</strong></h1><p id="e273" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated"><a class="ae mn" href="https://panel.holoviz.org/" rel="noopener ugc nofollow" target="_blank"> Panel </a>构建交互式仪表盘和应用。就像R闪亮，但更强大。它是由我的Anaconda同事Philipp Rudiger、Jean-Luc Stevens和Jim Bednar开发的。Panel是HoloViz生态系统中的七个库之一。如果你想了解更多关于HoloViz和Panel的知识，可以看看我之前的博文《为什么我喜欢HoloViz、panel.holoviz.org和awesome-panel.org》。</p><h1 id="a33b" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated"><strong class="ak">材料</strong></h1><p id="531f" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated">为了这篇文章，请查看我在Github上的<a class="ae mn" href="https://github.com/sophiamyang/snowflake-example/blob/main/snowflake_plot.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本</a>。</p><h1 id="4c43" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated"><strong class="ak">设置</strong></h1><p id="6a50" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated">本文使用了来自雪花市场的“OpenStreetMap — Nodes (USA)”数据。这些数据可以免费使用。在市场中找到这些数据，点击“获取数据”，然后你应该会看到它出现在你的“数据”中。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mo"><img src="../Images/87b2cbfbde6b89430fcf565d55029bb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zgiKBMf6uIg4-VfQ"/></div></div></figure><p id="8a3f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要访问Snowpark for Python，您可以在命令行中运行以下命令来创建一个新的Conda环境，激活该环境，安装Snowpark for Python，安装所需的viz包，并启动一个Jupyter笔记本。</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="185e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们可以开始在Jupyter笔记本上编码了。</p><h1 id="bf18" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated"><strong class="ak">进口所需模块</strong></h1><p id="f5c0" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated">首先，我们需要从Snowpark导入所需的模块。我将我的所有凭证保存在一个单独的文件中，并将其导入到这里，但是您应该使用自己的凭证。</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h1 id="8809" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated"><strong class="ak">与雪花建立连接</strong></h1><p id="a4ad" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated">我们创建一个连接到我们雪花帐户的会话。</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="057d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">或者，您可以使用外部浏览器进行身份验证:</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h1 id="cfc7" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated"><strong class="ak">获取数据</strong></h1><p id="eca7" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated">接下来，我们从OpenStreetMap数据库中获取数据。这个数据库中有两个独立的表:数据表和地理表。Geography表包含与数据表相关联的几何信息，如经度和纬度。下面的代码显示了从雪花中查询数据的两种方法:</p><ul class=""><li id="0881" class="mv mw it kk b kl km ko kp kr mx kv my kz mz ld na nb nc nd bi translated"><code class="fe ne nf ng nh b">session.table</code>返回整个表格的内容。</li><li id="f188" class="mv mw it kk b kl ni ko nj kr nk kv nl kz nm ld na nb nc nd bi translated"><code class="fe ne nf ng nh b">session.sql</code>允许我们编写SQL查询并返回SQL结果。几何数据被定义为一个<a class="ae mn" href="https://docs.snowflake.com/en/sql-reference/data-types-geospatial.html" rel="noopener ugc nofollow" target="_blank">地理对象</a>，这是一个包含经度和纬度的字典。我使用<a class="ae mn" href="https://docs.snowflake.com/en/sql-reference/functions/st_x.html" rel="noopener ugc nofollow" target="_blank"> st_x </a>和st_y将经度和纬度作为两个独立的列提取出来。</li></ul><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="mt mu l"/></div></figure><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi nn"><img src="../Images/8ca41b1fc86b239a16c68ed3ea4e6329.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gwYNFrH0_SRTAU2b"/></div></div></figure><h1 id="5e3b" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated"><strong class="ak">数据处理</strong></h1><p id="ebac" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated">这里实际上没有多少数据处理步骤。我使用来自Snowpark for Python的<code class="fe ne nf ng nh b"><a class="ae mn" href="https://docs.snowflake.com/en/LIMITEDACCESS/snowpark-python.html#joining-dataframes" rel="noopener ugc nofollow" target="_blank">.join</a></code>函数连接了两个表。然后我们可以将这个Snowpark数据框转换成我们熟悉的熊猫数据框。</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h1 id="91a3" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">用Datashader绘制500万个数据点</h1><p id="c73b" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated">这个OpenStreetMap数据包含5百万个数据点，我想在地图上绘制它的经度和纬度信息。</p><p id="d915" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Datashader是HoloViz家族中的大数据可视化工具。使用Numba(实时编译器)和Dask(并行计算)，Datashader可以在一台机器上非常快速地绘制出数百万甚至数十亿个数据点。如果你想了解更多关于Datashader如何工作的信息，请查看我之前关于Datashader的文章。</p><p id="7c52" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好的，回到我们的例子。首先，我们导入用于绘图的模块。我们需要将我们的经度和纬度转换为Web墨卡托坐标，以便它们能够正确地显示在地图上。然后我写了这个函数<code class="fe ne nf ng nh b">datashader_plot</code>来绘制这500万个数据点，并用地图覆盖它们。在这个函数中，我们首先创建一个地图<code class="fe ne nf ng nh b">map_tiles</code>，然后使用<code class="fe ne nf ng nh b">hvplot</code>配合<code class="fe ne nf ng nh b">rasterize=True</code>使用Datashader进行栅格化，这样就可以快速而有意义的可视化大数据。</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="86f0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">结果显示了一个包含所有500万个数据点的交互图！</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi le"><img src="../Images/5beba4bd5fa8213e4bfeb1ec70e5705c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*5kf4rKsKEvQF6GWn"/></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">作者图片</p></figure><h1 id="5780" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">创建交互式仪表板</h1><p id="ffb1" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated">如果我们想要选择设施，并根据我们选择的设施展示我们的地块，会怎么样？在这里，我创建了一个面板小部件来选择数据中的前10个便利设施，然后我创建了一个面板仪表板，其中的绘图对应于我们选择的便利设施。我用了hvPlot。iteractive创建此仪表板，了解有关hvPlot的更多信息。互动，查看<a class="ae mn" rel="noopener" target="_blank" href="/the-easiest-way-to-create-an-interactive-dashboard-in-python-77440f2511d1?sk=e1ea8c40c090cdbe7689333267f73b25">我之前的博文</a>。</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="mt mu l"/></div></figure><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi le"><img src="../Images/6b07b820b8b2f293908532ddb672b97d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*rMAr1N-77s50fwO1"/></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">作者图片</p></figure><p id="b1ea" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们可以使用一个模板来使我们的仪表板看起来更好。运行<code class="fe ne nf ng nh b">template.show()</code>将自动打开一个标签，显示我们的最终仪表板。</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="mt mu l"/></div></figure><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi le"><img src="../Images/3c1541547b9c56fb4924b7b2b30061ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*CZrIhFTU1Y7PA294"/></div><p class="lm ln gj gh gi lo lp bd b be z dk translated">作者图片</p></figure><h1 id="5e38" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">部署仪表板</h1><p id="f947" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated">我希望雪花可以提供一种方法，直接在雪花上部署我们的面板应用程序，这样我所有的数据和仪表板都可以在一个地方访问——雪花。</p><p id="0ae1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要将这个仪表板作为web服务器启动，我们可以取消对<code class="fe ne nf ng nh b">template.servable()</code>上面最后一行的注释，只需运行<code class="fe ne nf ng nh b">panel serve snowflake_plot.ipynb</code>。有关如何将仪表板部署到服务器的详细信息，请查看<a class="ae mn" href="https://panel.holoviz.org/user_guide/Server_Deployment.html" rel="noopener ugc nofollow" target="_blank">面板文档</a>，或者我之前关于将仪表板部署到<a class="ae mn" rel="noopener" target="_blank" href="/deploy-a-python-visualization-panel-app-to-google-cloud-cafe558fe787?sk=98a75bd79e98cba241cc6711e6fc5be5"> Google Cloud App Engine </a>和<a class="ae mn" rel="noopener" target="_blank" href="/deploy-a-python-visualization-panel-app-to-google-cloud-ii-416e487b44eb?sk=aac35055957ba95641a6947bbb436410"> Google Cloud Run </a>的文章。</p><p id="134c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我真的很喜欢使用Snowpark for Python，我对它的许多特性感到兴奋，包括Python UDFs、模型构建和部署。我想写的东西太多了。敬请关注我的下一篇文章！</p><h1 id="24ef" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">承认</h1><p id="4142" class="pw-post-body-paragraph ki kj it kk b kl mi ju kn ko mj jx kq kr mk kt ku kv ml kx ky kz mm lb lc ld im bi translated">感谢您的反馈和支持！</p><h1 id="5468" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated"><strong class="ak">参考文献</strong>:</h1><ul class=""><li id="e2bc" class="mv mw it kk b kl mi ko mj kr no kv np kz nq ld na nb nc nd bi translated">https://panel.holoviz.org/<a class="ae mn" href="https://panel.holoviz.org/" rel="noopener ugc nofollow" target="_blank"/></li><li id="b612" class="mv mw it kk b kl ni ko nj kr nk kv nl kz nm ld na nb nc nd bi translated">【https://datashader.org/ T4】</li><li id="93c2" class="mv mw it kk b kl ni ko nj kr nk kv nl kz nm ld na nb nc nd bi translated"><a class="ae mn" href="https://www.snowflake.com/blog/snowflake-partners-with-and-invests-in-anaconda-to-bring-enterprise-grade-open-source-python-innovation-to-the-data-cloud/" rel="noopener ugc nofollow" target="_blank">https://www . snow flake . com/blog/snow flake-partners-with-and-investments-anaconda-to-bring-enterprise-grade-open-source-python-innovation-to-the-data-cloud/</a></li><li id="939d" class="mv mw it kk b kl ni ko nj kr nk kv nl kz nm ld na nb nc nd bi translated"><a class="ae mn" href="https://www.snowflake.com/snowpark-for-python/" rel="noopener ugc nofollow" target="_blank">https://www.snowflake.com/snowpark-for-python/</a></li></ul><p id="4f48" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我是Anaconda的高级数据科学家Sophia Yang。请随时在<a class="ae mn" href="https://twitter.com/sophiamyang" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae mn" href="https://www.linkedin.com/in/sophiamyang/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>和<a class="ae mn" href="https://www.youtube.com/SophiaYangDS" rel="noopener ugc nofollow" target="_blank"> YouTube </a>:)上与我联系</p></div></div>    
</body>
</html>