<html>
<head>
<title>5 real handy python decorators for analyzing/debugging your code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于分析/调试代码的 5 个真正方便的 python 装饰器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/5-real-handy-python-decorators-for-analyzing-debugging-your-code-c22067318d47#2022-03-14">https://towardsdatascience.com/5-real-handy-python-decorators-for-analyzing-debugging-your-code-c22067318d47#2022-03-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="927e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将这些方便的、通用的装饰器直接应用到您的代码中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/138ca2c5c2a6ac548cbe52b79671073c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gq2gf6Ghi3qyOr9M"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">装饰精美(图片由<a class="ae ky" href="https://unsplash.com/@sabasayad" rel="noopener ugc nofollow" target="_blank">萨巴·萨阿德</a>在<a class="ae ky" href="https://unsplash.com/photos/fnkoGdJEuiE" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄)</p></figure><p id="4a30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">decorators 的美妙之处在于它们非常容易应用，但是为你的代码提供了很多额外的功能。在本文中，我们将介绍 5 个方便的装饰器，您可以轻松地将它们应用到调试代码时遇到的实际问题中。我们来看看能帮到你的装饰师:</p><ol class=""><li id="cc5f" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">为你的功能计时</li><li id="3761" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">性能检查</li><li id="0db3" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">中继器</li><li id="0ba7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">执行前询问您是否确定</li><li id="a78b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">用 try-catch 包装您的函数</li></ol><p id="7763" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文的目标是为您提供一些现成的装饰器，并启发您开发一些方便的、通用的装饰器。</p><p id="ee8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="mj">在我们开始之前:</em> </strong>你知道你还可以让装修工记录状态吗？示例:计算一个函数被调用的次数，这样你就可以对它进行速率限制。请务必阅读本文<a class="ae ky" href="https://mikehuls.medium.com/six-levels-of-python-decorators-1f12c9067b23" rel="noopener"><strong class="lb iu"/></a>以了解装饰器是如何工作的，如何应用它们以及何时使用装饰器。在这篇文章中，我们用 6 个越来越复杂的步骤来探索装饰者。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="1994" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">1.计时器</h1><p id="4e32" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">让我们从简单开始；我们将从一个装饰器开始，它打印出我们的函数运行所花费的时间。这是代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="f0cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，我们的装饰器本身是用@ wrapps(func)包装的。这是为了确保我们传递了包装的函数。如果我们不这样做的话,<code class="fe nq nr ns nt b">wrapper.__name__</code>只会打印出‘包装’,而不是我们实际正在装饰的功能。</p><p id="8798" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在一个计算素数的函数上使用这个装饰器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="8091" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们检查调用<code class="fe nq nr ns nt b">is_prime_number(number=155153)</code>时的输出:</p><pre class="kj kk kl km gt nu nt nv nw aw nx bi"><span id="c5cc" class="ny ms it nt b gy nz oa l ob oc">[isprime] took 5.601100000000005 ms</span></pre></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="726e" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">2.性能检查</h1><p id="84c0" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">计时我们的功能很好，但我们需要更多的信息。除了持续时间之外，下一个装饰器还提供了关于函数的信息，包括名称和文档字符串，以及性能信息，如内存使用情况:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="7c3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它与前面的函数非常相似，只是我们打印出了更多的信息:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="c13d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">调用<code class="fe nq nr ns nt b">is_prime_number(number=9843861881)</code>会打印出以下内容:</p><pre class="kj kk kl km gt nu nt nv nw aw nx bi"><span id="b149" class="ny ms it nt b gy nz oa l ob oc">Function:             is_prime_number ( Checks whether a number is a prime number )<br/>Memory usage:         0.000432 MB<br/>Peak memory usage:    0.000622 MB<br/>Duration:             0.000015 sec<br/>----------------------------------------</span></pre></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="a307" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">3.中继器</h1><p id="3822" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">这个装饰器在被调用时重复某个函数。这对于测试性能(参见其他 decorators)或者压力测试来说是很方便的</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="3da7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它是这样使用的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="5352" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">调用 sayhello()将产生以下输出:</p><pre class="kj kk kl km gt nu nt nv nw aw nx bi"><span id="86cf" class="ny ms it nt b gy nz oa l ob oc">hello<br/>hello</span></pre><p id="957e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，在测量其性能时，可以很好地使用这个装饰器执行几次。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="356e" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">4.提示“您确定吗？”执行前</h1><p id="3954" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">这个装饰器可以添加到需要很长时间才能完成或者有重大影响的函数中(比如删除数据)。一旦你调用了这个函数，装饰者会确保你在调用它之前确认你想要执行这个函数。否则它将返回并且<em class="mj">而不是</em>调用函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="17e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们再次修饰一下简单的 say_hi 函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="70f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，我们能够在装饰器上设置提示消息。当我们调用<code class="fe nq nr ns nt b">say_hi()</code>时，您将会看到:</p><pre class="kj kk kl km gt nu nt nv nw aw nx bi"><span id="7508" class="ny ms it nt b gy nz oa l ob oc">Sure? Press y to continue, press n to stop</span></pre><p id="36aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你输入‘y’那么我们将执行<code class="fe nq nr ns nt b">say_hi()</code>，任何其他输入(包括<em class="mj">没有</em>输入)将阻止<code class="fe nq nr ns nt b">say_hi()</code>执行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/7e9f783120a152a8f29faf38493e47f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*J0YyJ0mjORNofmZQ8Q2Y1Q.png"/></div></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="10b7" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">5.试着找一个室内装潢师</h1><p id="da78" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">这使用装饰器将您的函数包装在一个 try-except 块中。优势在于，只需一行 Python 代码，整个函数就不会出现异常。代码如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="1986" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在下面的函数中使用这个装饰器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="63f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当我们调用<code class="fe nq nr ns nt b">trycatchExample(9, 3)</code>时，函数返回<code class="fe nq nr ns nt b">3.0</code>`。如果我们调用<code class="fe nq nr ns nt b">trycatchExample(9, 0)</code>`(除以 0 ),它会正确返回以下内容:</p><pre class="kj kk kl km gt nu nt nv nw aw nx bi"><span id="20da" class="ny ms it nt b gy nz oa l ob oc">Exception in trycatchExample: division by zero</span></pre><p id="bc47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我建议只将这个装饰器用于调试目的，并更准确地捕捉函数中的错误。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="0e3f" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">结论</h1><p id="62ae" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">通过这篇文章，我希望能够提供更多关于装饰者带来的好处的信息。如果我启发了你，分享一些你自己的便利的装饰！此外，你知道你甚至可以保持你的装饰状态吗？查看<a class="ae ky" href="https://mikehuls.medium.com/six-levels-of-python-decorators-1f12c9067b23" rel="noopener"> <strong class="lb iu">这篇文章</strong> </a> <strong class="lb iu"> </strong>深入探究装修工是如何工作的。</p><p id="cc5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有建议/澄清，请评论，以便我可以改进这篇文章。与此同时，请查看我的关于各种编程相关主题的其他文章:</p><ul class=""><li id="d816" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu oe mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/why-is-python-so-slow-and-how-to-speed-it-up-485b5a84154e" rel="noopener">Python 为什么慢，如何加速</a></li><li id="f670" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu oe mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/image-analysis-for-beginners-destroying-duck-hunt-with-opencv-e19a27fd8b6" rel="noopener">用 Python OpenCV 破坏猎鸭</a></li><li id="c404" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu oe mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/image-analysis-for-beginners-creating-a-motion-detector-with-opencv-4ca6faba4b42" rel="noopener">使用 Python OpenCV 创建运动检测器</a></li><li id="aa83" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu oe mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/advanced-multi-tasking-in-python-applying-and-benchmarking-threadpools-and-processpools-90452e0f7d40" rel="noopener">Python 中的高级多任务处理:应用线程池和进程池并进行基准测试</a></li><li id="5579" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu oe mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/write-your-own-c-extension-to-speed-up-python-x100-626bb9d166e7" rel="noopener">编写自己的 C 扩展来加速 Python x100 </a></li><li id="ae28" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu oe mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/getting-started-with-cython-how-to-perform-1-7-billion-calculations-per-second-in-python-b83374cfcf77" rel="noopener">cyt hon 入门:如何用 Python 执行&gt;每秒 17 亿次计算</a></li><li id="dc80" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu oe mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/create-a-fast-auto-documented-maintainable-and-easy-to-use-python-api-in-5-lines-of-code-with-4e574c00f70e" rel="noopener">用 FastAPI 用 5 行代码创建一个快速自动归档、可维护且易于使用的 Python API</a></li><li id="755c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu oe mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/create-and-publish-your-own-python-package-ea45bee41cdc" rel="noopener">创建并发布你自己的 Python 包</a></li><li id="23ae" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu oe mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/create-your-custom-python-package-that-you-can-pip-install-from-your-git-repository-f90465867893" rel="noopener">创建您的定制私有 Python 包，您可以从您的 Git 库 PIP 安装该包</a></li><li id="5487" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu oe mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/virtual-environments-for-absolute-beginners-what-is-it-and-how-to-create-one-examples-a48da8982d4b" rel="noopener">面向绝对初学者的虚拟环境——什么是虚拟环境以及如何创建虚拟环境(+示例)</a></li><li id="f910" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu oe mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/dramatically-improve-your-database-inserts-with-a-simple-upgrade-6dfa672f1424" rel="noopener">通过简单的升级大大提高您的数据库插入速度</a></li></ul><p id="5399" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！</p><p id="2280" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">—迈克</p><p id="6009" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">页（page 的缩写）学生:比如我正在做的事情？<a class="ae ky" href="https://mikehuls.medium.com/membership" rel="noopener">跟着我！</a></p><div class="of og gp gr oh oi"><a href="https://mikehuls.medium.com/membership" rel="noopener follow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd iu gy z fp on fr fs oo fu fw is bi translated">通过我的推荐链接加入 Medium—Mike Huls</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">mikehuls.medium.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow ks oi"/></div></div></a></div></div></div>    
</body>
</html>