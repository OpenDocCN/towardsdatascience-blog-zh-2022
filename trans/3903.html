<html>
<head>
<title>Monte Carlo Simulation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">蒙特 卡罗模拟</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/monte-carlo-simulation-7c198d01c531#2022-08-30">https://towardsdatascience.com/monte-carlo-simulation-7c198d01c531#2022-08-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e900" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><strong class="ak">第3部分:直方图&amp;密度图</strong></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2c6b0bec6739c75e62573bdc3d5af20c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vB1kBcZ6LLHDqXT8"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@britishlibrary?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">大英图书馆</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="21a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/monte-carlo-simulation-2b24fc810683">蒙特卡洛模拟</a> (MCS)是一种抽样实验，其目的是估计取决于一个或多个随机输入变量的感兴趣的量的分布。</p><p id="80fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">MCS的开发包括<strong class="lb iu">三个基本步骤</strong>:</p><p id="0e91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">1.建立一个预测模型，明确识别因变量(结果、未知的关注量、待评估的函数)和自变量(随机输入变量)。</p><p id="a8f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.确定输入变量的概率分布。标准程序包括分析经验或历史数据，并使数据符合特定的分布。当这些数据不可用时，选择一个合适的概率分布并明智地选择其参数。</p><p id="d4f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.多次重复模拟，获得输出或因变量的随机值。使用统计方法计算一些描述性的统计指标，并绘制图表，如结果变量的直方图或密度图。</p><p id="88d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如在<a class="ae ky" href="https://medium.com/p/8db846f3d8ed#09a4-6a25f853d2de" rel="noopener">之前的一篇文章中所指出的，</a>我们可以使用蒙特卡洛模拟来定量说明业务或运营管理任务中的风险。</p><h1 id="2aa3" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">机器故障&amp;修理</strong></h1><p id="6029" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">蒙特卡洛模拟的实际应用包括制造操作，其中机器故障之间的时间和它们相应的修理时间是随机变量。</p><p id="0b3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设一个大工厂，其中一个处理单元每年335天每天24小时运行(30天用于人员休假和年度维护)。管理层希望购买另一个处理单元来生产另一个最终产品。他们知道这样的处理单元会导致随机的机械故障，这需要非常熟练的维修团队。因此，每一次故障都代表着一笔重要的成本。</p><p id="20b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">管理层决定进行蒙特卡洛模拟，从数字上评估与新项目相关的风险。</p><p id="b13d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当前处理单元的历史数据显示，机器故障间隔时间具有以下经验分布:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/a143e594fcf9526f735f1a19cee022a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*QbVuvBB0FPxfCk0hHt2f7w.png"/></div></figure><p id="82b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">修理这种处理单元所需的时间具有以下经验分布:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/9b6abdef9ef53d8245178e15cbea4e6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*qHzdadP151v2XmVxQNlCjw.png"/></div></figure><h1 id="0e87" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">用于蒙特卡洛模拟的Python代码</strong></h1><p id="0829" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">下面的Python代码允许我们开发一个MCS来对新投资所涉及的风险进行数字评估:</p><p id="8803" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们导入了几个Python库:</p><p id="b8a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">NumPy:Python编程语言的一个库，为创建大型多维向量和矩阵提供支持，并提供大量高级数学函数来操作它们。</p><p id="8db4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mt">SciPy</em>:Python的免费开源库。基于NumPy，包含统计、线性代数、最优化、插值、信号处理和其他科学和工程常用方法的模块。</p><p id="3f3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mt"> Matplotlib </em>和<em class="mt"> Seaborn </em>是用于制图的传统Python库。</p><p id="cf3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mt"> PrettyTable </em>是一个Python库，用于以视觉上吸引人的ASCII表格格式轻松显示表格数据。</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="c88f" class="mz lw it mv b gy na nb l nc nd"><a class="ae ky" href="http://twitter.com/author" rel="noopener ugc nofollow" target="_blank">@author</a>: darwt<br/>"""</span><span id="2dfb" class="mz lw it mv b gy ne nb l nc nd"># Import Modules<br/>import numpy  as np</span><span id="ff09" class="mz lw it mv b gy ne nb l nc nd">from scipy import stats<br/>from scipy.stats import sem</span><span id="8b67" class="mz lw it mv b gy ne nb l nc nd">import matplotlib.pyplot as plt<br/>import seaborn as sns <br/>from prettytable import PrettyTable<br/>  <br/>your_path = 'your path'</span></pre><p id="7687" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们指出每年的运行小时数、维修团队产生的每小时成本、故障间隔运行小时数的经验分布以及维修所需的经验分布。</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="cd29" class="mz lw it mv b gy na nb l nc nd"># initialization module<br/> <br/>Operating_hours_year = 335 * 24</span><span id="9577" class="mz lw it mv b gy ne nb l nc nd">Cost_LostTime_hour = 55.50    <br/># .........................................<br/># historical data of hours of operation between failures (HbF)<br/>Hours_between_Failures = [200, 400, 600, 800, 1000, 1200, 1400]</span><span id="35e7" class="mz lw it mv b gy ne nb l nc nd"># discrete probabilities for hours of operation between failures<br/>probabilities_HBF = [0.1, 0.2, 0.1, 0.2, 0.3, 0.05, 0.05]</span><span id="aa30" class="mz lw it mv b gy ne nb l nc nd"># historical data of hours needed to repair (TTR)<br/>Time_to_Repair = [24, 48, 72, 96, 120]</span><span id="6c49" class="mz lw it mv b gy ne nb l nc nd">probabilities_TTR =[0.10, 0.20, 0.25, 0.25, 0.20]</span></pre><p id="680a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们设置了大量的重复，因此我们的样本平均值将非常接近预期值。我们还定义了置信区间(CI)的置信水平。</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="65b1" class="mz lw it mv b gy na nb l nc nd">Number_of_Replications = 2000</span><span id="63f6" class="mz lw it mv b gy ne nb l nc nd">confidence = 0.95                      ## selected by the analyst</span><span id="e5ef" class="mz lw it mv b gy ne nb l nc nd"># Lists to be filled during calculations<br/>list_of_HBF,    list_of_TTR = [], []<br/>list_Lost_Time, list_cost_TTR = [], []<br/>list_Hours_Prod = []</span></pre><p id="99e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">MCS背后的逻辑在下面几行代码中描述。我们有两个循环:外部循环(<em class="mt">用于在范围(复制次数)内运行)</em>与运行或复制次数相关；内环(<em class="mt">而acum _ time&lt;= Operating _ hours _ year</em>)与年度生产和故障有关。我们用了两次<em class="mt"> np </em>。<em class="mt"> random.choice </em>根据相应的概率，从两个经验分布中产生一个大小为1的随机样本。</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="a2c5" class="mz lw it mv b gy na nb l nc nd">for run in range(Number_of_Replications):<br/>    acum_time, acum_hbf, acum_ttr = 0, 0, 0<br/>    while acum_time &lt;= Operating_hours_year:<br/>        HBF = np.random.choice(Hours_between_Failures, <br/>                               1, p=list(probabilities_HBF)) <br/>        TTR = np.random.choice(Time_to_Repair,<br/>                               1, p=list(probabilities_TTR))<br/>        acum_time += (HBF + TTR)<br/>        acum_hbf  += HBF<br/>        acum_ttr  +=TTR<br/>         <br/>        <br/>    Total_HBF = round(float(acum_hbf),4)<br/>    Total_TTR = round(float(acum_ttr),4)<br/>    Perc_lost_Time = round(float(Total_TTR/Total_HBF * 100),2)<br/>    Hours_Prod = Operating_hours_year - Total_TTR<br/>    Cost_TTR   = Total_TTR * Cost_LostTime_hour<br/>    <br/>    list_of_HBF.append(Total_HBF)<br/>    list_of_TTR.append(Total_TTR) <br/>    list_Lost_Time.append(Perc_lost_Time)<br/>    <br/>    list_cost_TTR.append(Cost_TTR)<br/>    list_Hours_Prod.append(Hours_Prod)</span></pre><p id="bb35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用NumPy和SciPy来计算关键的描述性统计指标，特别是我们的主要结果<em class="mt">Cost _ TTR = Total _ TTR * Cost _ lost time _ hour</em>的百分位表<em class="mt">。此输出变量表示与机器故障和相应维修时间相关的成本。媒体代表了这种成本的预期值。</em></p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="9033" class="mz lw it mv b gy na nb l nc nd">media =  round(np.mean(list_cost_TTR),2)<br/>median = round(np.median(list_cost_TTR),2)<br/>var   = round(np.var(list_cost_TTR), 2) <br/>stand = round(np.std(list_cost_TTR),2)</span><span id="75d6" class="mz lw it mv b gy ne nb l nc nd">std_error = round(sem(list_cost_TTR),2)</span><span id="0e9c" class="mz lw it mv b gy ne nb l nc nd">skew   = round(stats.skew(list_cost_TTR),2)<br/>kurt   = round(stats.kurtosis(list_cost_TTR),2)</span><span id="ba16" class="mz lw it mv b gy ne nb l nc nd">minimum = round(np.min(list_cost_TTR),2)<br/>maximum = round(np.max(list_cost_TTR),2)</span><span id="3b32" class="mz lw it mv b gy ne nb l nc nd">dof  = Number_of_Replications - 1    <br/>t_crit = np.abs(stats.t.ppf((1-confidence)/2,dof))</span><span id="ba05" class="mz lw it mv b gy ne nb l nc nd">half_width =  round(stand *t_crit/np.sqrt(Number_of_Replications),2)  <br/>inf = media - half_width<br/>sup = media + half_width  <br/>                      <br/>inf = round(float(inf),2)<br/>sup = round(float(sup),2)</span></pre><p id="0039" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将<em class="mt"> PrettyTable </em>用于统计报告和百分比报告:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="2aef" class="mz lw it mv b gy na nb l nc nd">t = PrettyTable(['Statistic', 'Value'])<br/>t.add_row(['Trials', Number_of_Replications])<br/>t.add_row(['Mean', media])<br/>t.add_row(['Median', median])<br/>t.add_row(['Variance', var])<br/>t.add_row(['Stand Dev', stand])<br/>t.add_row(['Skewness', skew])<br/>t.add_row(['Kurtosis', kurt])<br/>t.add_row(['Half Width', half_width])<br/>t.add_row(['CI inf', inf])<br/>t.add_row(['CI sup', sup])<br/>t.add_row(['Minimum', minimum])<br/>t.add_row(['Maximum', maximum])<br/>print(t)</span><span id="42e5" class="mz lw it mv b gy ne nb l nc nd">percents = np.percentile(list_cost_TTR, [10, 20, 30, 40, 50, 60, 70, 80, 90, 100])</span><span id="2fcf" class="mz lw it mv b gy ne nb l nc nd">p = PrettyTable(['Percentile (%)', 'Lost Time Cost'])<br/>p.add_row(['  10  ', percents[0]])<br/>p.add_row(['  20  ', percents[1]])<br/>p.add_row(['  30  ', percents[2]])<br/>p.add_row(['  40  ', percents[3]])<br/>p.add_row(['  50  ', percents[4]])<br/>p.add_row(['  60  ', percents[5]])<br/>p.add_row(['  70  ', percents[6]])<br/>p.add_row(['  80  ', percents[7]])<br/>p.add_row(['  90  ', percents[8]])<br/>p.add_row([' 100  ', percents[9]])<br/>print(p)</span></pre><p id="1e9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们使用Matplotlib和Seaborn制作图表:一个直方图显示了每年预期损失时间成本的潜在频率分布，一个密度图显示了由于故障和维修造成的损失时间百分比的概率密度函数。</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="ac03" class="mz lw it mv b gy na nb l nc nd"># Lost Time Cost Histogram</span><span id="797c" class="mz lw it mv b gy ne nb l nc nd">n_bins = 20</span><span id="312f" class="mz lw it mv b gy ne nb l nc nd">fig, ax = plt.subplots(figsize=(8, 6))<br/>ax.hist(list_cost_TTR,  histtype ='bar', bins=20, color = 'c',<br/>         edgecolor='k', alpha=0.65, density = False)  # density=False show counts</span><span id="9975" class="mz lw it mv b gy ne nb l nc nd">ax.axvline(media,  color='g', linestyle='dashed', linewidth=3)<br/>ax.axvline(median, color='r', linestyle='dashed', linewidth=3)<br/> <br/>ax.set_title('Frequency Chart')<br/>ax.set_ylabel('Counts')<br/>ax.set_xlabel('U$S')<br/>ax.grid(axis = 'y')</span><span id="401d" class="mz lw it mv b gy ne nb l nc nd">plt.savefig(your_path +'Expected Lost Time Cost per Year',<br/>            bbox_inches='tight', dpi=150)<br/>plt.show()</span><span id="4e8d" class="mz lw it mv b gy ne nb l nc nd"># Percent Lost Time Cost Density Plot</span><span id="7f19" class="mz lw it mv b gy ne nb l nc nd">sns.distplot(list_Lost_Time, hist=False, kde=True, <br/>             bins=int(180/5), color = 'lightblue', <br/>             axlabel = 'Percent Lost Time (%)',<br/>             hist_kws={'edgecolor':'black'},<br/>             kde_kws = {'shade': True, 'linewidth': 3})</span><span id="568a" class="mz lw it mv b gy ne nb l nc nd">plt.savefig(your_path + 'Percent Lost Time' , <br/>            bbox_inches='tight', dpi=150)          <br/>plt.show()</span></pre><h1 id="c8c8" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">输出分析</strong></h1><p id="fdf9" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们做了2000次复制，附加了几个列表。然后，我们计算了与机器故障和相应维修时间相关的成本的关键描述性统计指标。下表显示了<em class="mt">统计报告:</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/9ce336a788c026736a93692f3b0e7aba.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*IQcwrq_79Caz-EihOrAE6w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">表1，作者用PrettyTable做的。</p></figure><p id="c2d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">表1显示平均值和中值之间的差异很小，半宽度区间几乎可以忽略不计。结果分布是正偏的，峰度可以忽略不计。</p><p id="849a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">表2显示了百分位数报告。我们可以看到，损失的时间成本超过5000万美元的可能性超过20%。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/6dd63b7c63920848234d86a613bf7083.png" data-original-src="https://miro.medium.com/v2/resize:fit:614/format:webp/1*FGLZ8mrGbaBEmvhn6kRaPA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">表2，作者用PrettyTable做的。</p></figure><p id="4f23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">图1显示了我们的结果的分布(<em class="mt">损失时间成本</em>)作为一个有20个箱的直方图。平均值和中值分别用绿色和红色垂直线表示。像往常一样，直方图提供了我们感兴趣的量的分布的可视化表示:它的位置、分布、偏斜度和峰度。我们声称期望值(95%置信水平)在44.000美元左右。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/963831c39d7e29f35e4ab8e24e75e098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*0_dyj8Sfom8Nmp1QsZsMsQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1，作者用Matplotlib做的。</p></figure><p id="86f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">图2显示了输出变量<em class="mt">百分比损失时间的密度图。</em>请记住，密度图的关键思想是消除直方图的锯齿特征，从而更好地显示分布形状。</p><p id="5853" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">显然，分布是单峰的。我们声称，由于机器故障，平均会损失10%的工作时间。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/0f6c78311642c8a86c37f71788246d42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*hDipGDgr7c8B_N7W_kn9sQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2，作者和Seaborn一起做的。</p></figure><p id="cd6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">蒙特卡洛模拟是决策者和项目经理用来定量评估风险影响的计算技术。任何模拟研究的基本步骤是对输出数据进行适当的统计分析。统计报告和分布图(直方图和密度图)对于评估风险暴露水平是强制性的。</p><p id="f985" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不要忘记给小费，尤其是当你把文章添加到列表中的时候。</p></div></div>    
</body>
</html>