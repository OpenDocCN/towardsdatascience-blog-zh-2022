<html>
<head>
<title>Avoid Using “pip freeze” — Use “pipreqs” instead</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">避免使用“pip冻结”，而是使用“pipreqs”</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/goodbye-pip-freeze-welcome-pipreqs-258d2e7a5a62#2022-11-02">https://towardsdatascience.com/goodbye-pip-freeze-welcome-pipreqs-258d2e7a5a62#2022-11-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a4a0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">您的项目依赖关系很重要—有效地管理它们</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f92ffb2c776c6e737af5a0453f485792.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*O6h5RMBMAg-AgBIb"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图像由<a class="ae ky" href="https://unsplash.com/@ankhesenamunnn" rel="noopener ugc nofollow" target="_blank">安赫塞娜蒙</a>在<a class="ae ky" href="https://unsplash.com/photos/L1GO3yAV_U8" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="f48a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">动机</h1><p id="3c85" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">包管理是软件开发工作流的最佳实践之一，因为它促进了软件交付的自动化。</p><p id="23d7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如今，大多数数据科学家和机器学习工程师已经在他们的管道自动化中采用了这种最佳实践。即使这个过程被认为是一个好的实践，大多数从业者采用的方法可能并不总是有效的:使用<code class="fe ms mt mu mv b"><a class="ae ky" href="https://pip.pypa.io/en/stable/cli/pip_freeze/" rel="noopener ugc nofollow" target="_blank">pip freeze</a>.</code></p><p id="66c0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这篇概念博客中，你会明白有一个比使用<code class="fe ms mt mu mv b">pip freeze.</code>更好的选择</p><h1 id="d821" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">这就是为什么你不应该使用画中画冻结</h1><p id="a5cd" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">假设您正在处理一个需要5个依赖项的项目:<code class="fe ms mt mu mv b">dep1</code>、<code class="fe ms mt mu mv b">dep2</code>、<code class="fe ms mt mu mv b">dep3</code>、<code class="fe ms mt mu mv b">dep4</code>和<code class="fe ms mt mu mv b">dep5</code>。大多数人在生成依赖文件时的反应是使用下面这个神奇的命令:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="5529" class="na la it mv b gy nb nc l nd ne">pip freeze &gt; requirements.txt</span></pre><blockquote class="nf ng nh"><p id="4a97" class="lr ls ni lt b lu mn ju lw lx mo jx lz nj mp mc md nk mq mg mh nl mr mk ml mm im bi translated">但是这怎么会是一个问题呢？</p></blockquote><p id="c513" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">大多数库的安装需要其他自动安装的库。下面是一个插图。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="3938" class="na la it mv b gy nb nc l nd ne"># Install the <strong class="mv iu">transformers</strong> library<br/>pip install transformers</span></pre><p id="4781" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe ms mt mu mv b">transformers</code>库的安装会生成以下消息:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="d766" class="na la it mv b gy nb nc l nd ne">Successfully installed huggingface-hub-0.10.1 tokenizers-0.13.1 transformers-4.23.1</span></pre><p id="a035" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这意味着这两个额外的库<code class="fe ms mt mu mv b">huggingface-hub-0.10.1</code> <code class="fe ms mt mu mv b">tokenizers-0.13.1</code>已经和transformer库一起安装了，并且这两个库将自动包含在requirement.txt文件中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/acff2355d275b33f131d9e109f291287.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*JHLEGQdUBD3UnYSWApEe3g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">pip冻结命令的图示(图片由作者提供)</p></figure><blockquote class="nf ng nh"><p id="d0a3" class="lr ls ni lt b lu mn ju lw lx mo jx lz nj mp mc md nk mq mg mh nl mr mk ml mm im bi translated">但我还是不觉得有什么问题！不要担心，我们会成功的…</p></blockquote><p id="0c1b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，想象一下变形金刚库被升级并需要不同的库<code class="fe ms mt mu mv b"><strong class="lt iu">new_lib-1.2.3</strong></code>和<code class="fe ms mt mu mv b"><strong class="lt iu">another_new_lib-0.2.1</strong></code>。这意味着先前的依赖关系<code class="fe ms mt mu mv b">huggingface-hub-0.10.1</code> <code class="fe ms mt mu mv b">tokenizers-0.13.1</code>不再相关，对吗？至少对❌.项目来说是这样</p><p id="7a1a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">问题来了👇🏽</strong></p><p id="401b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">生成requirements.txt文件的新版本除了包含新的依赖项之外，还将包含旧的依赖项；如果您只想保留相关的依赖项，您将不得不手动删除旧的依赖项。然后想象一下处理一个需要20、30或50个库的项目！这很快就会成为一个令人头疼的问题🤯。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/e1c6e2d16a22de7df035e3ae723acb84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*AX6TkEqQ27xhAWwKQwlYZw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd no"> pip冻结</strong>保留以前安装的不再需要的旧包(图片由作者提供)</p></figure><p id="2b3d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">总之，<code class="fe ms mt mu mv b">pip freeze</code>不够聪明，无法有效地管理依赖关系，以下是一些原因:</p><p id="0a90" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">→ <code class="fe ms mt mu mv b"><strong class="lt iu">pip freeze</strong></code> <strong class="lt iu">仅用于“pip安装”</strong>:它仅知道使用<code class="fe ms mt mu mv b">pip install</code>命令安装的软件包。这意味着任何使用不同方法安装的软件包，如<code class="fe ms mt mu mv b">peotry</code>、<code class="fe ms mt mu mv b">setuptools</code>、<code class="fe ms mt mu mv b">conda</code>等。不会包含在最终的requirements.txt文件中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/ba2f10a8805f7b743cba7ecc59622e5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pOWQdMthW81mtGcud-swug.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">pip冻结仅考虑使用pip命令安装的库(图片由作者提供)</p></figure><p id="825f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">→ <code class="fe ms mt mu mv b"><strong class="lt iu">pip freeze</strong></code> <strong class="lt iu">不考虑依赖版本冲突:</strong><strong class="lt iu"/>项目生命周期是迭代的，因此可能需要现有库的全新或升级版本。使用<code class="fe ms mt mu mv b">pip freeze</code>保存环境中的所有包，包括那些与项目无关的包。</p><p id="238e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">→ <code class="fe ms mt mu mv b"><strong class="lt iu">pip freeze</strong></code> <strong class="lt iu">抓取一切:</strong>如果你没有使用虚拟环境，<code class="fe ms mt mu mv b">pip freeze</code>生成包含所有库的需求文件，包括你的项目范围之外的库。</p><blockquote class="nf ng nh"><p id="d268" class="lr ls ni lt b lu mn ju lw lx mo jx lz nj mp mc md nk mq mg mh nl mr mk ml mm im bi translated">那么，我能做些什么来解决这些问题呢？<br/>好问题！</p></blockquote><p id="b230" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">答案是通过使用<code class="fe ms mt mu mv b">pipreqs</code>🎉</p><h1 id="3c7a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">Pipreqs —更好的选择</h1><p id="3e63" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe ms mt mu mv b"><a class="ae ky" href="https://pypi.org/project/pipreqs/" rel="noopener ugc nofollow" target="_blank">pipreqs</a></code>首先扫描所有的python文件(。py)，然后基于项目的每个python文件中的<code class="fe ms mt mu mv b">import</code>语句生成requirements.txt文件。此外，它解决了使用<code class="fe ms mt mu mv b">pip freeze</code>时面临的所有问题。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/90cd63f90a67b30e1c905ab11a395059.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*UvcgC00BcEstKF2gJ4_o6A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">pireqs扫描过程(图片由作者提供)</p></figure><p id="993b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">使用下面的<code class="fe ms mt mu mv b">pip</code>命令，安装非常简单。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="9edb" class="na la it mv b gy nb nc l nd ne">pip install pipreqs</span></pre><p id="70b2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一旦您安装了库，您只需要提供项目的根位置，并运行这个命令来生成项目的requirements.txt文件。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="6d67" class="na la it mv b gy nb nc l nd ne">pipreqs /&lt;your_project_root_path&gt;/</span></pre><p id="108e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">有时您可能想要更新需求文件。在这种情况下，您需要使用<code class="fe ms mt mu mv b">--force</code>选项来强制重新生成文件。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="81e0" class="na la it mv b gy nb nc l nd ne">pipreqs <strong class="mv iu">--force</strong> /&lt;your_project_root_path&gt;/</span></pre><p id="4726" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">假设您想要忽略特定子文件夹中的一些python文件的库。这可以通过在指定需要忽略的子文件夹之前使用<code class="fe ms mt mu mv b">--ignore</code>选项来实现。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="2853" class="na la it mv b gy nb nc l nd ne">pipreqs /&lt;your_project_root_path&gt;/ <strong class="mv iu">--ignore</strong> /&lt;your_project_root_path&gt;/folder_to_ignore/</span></pre><h1 id="68a9" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="90eb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">恭喜你！🎉🍾您刚刚了解了一种新的、有效的管理项目相关性的方法。</p><p id="4806" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你喜欢阅读我的故事，并希望支持我的写作，考虑<a class="ae ky" href="https://zoumanakeita.medium.com/membership" rel="noopener">成为一个媒体成员</a>。每月支付5美元，你就可以无限制地阅读媒体上的故事。</p><p id="f7bf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">欢迎在<a class="ae ky" href="https://zoumanakeita.medium.com/" rel="noopener">媒体</a>、<a class="ae ky" href="https://twitter.com/zoumana_keita_" rel="noopener ugc nofollow" target="_blank">推特</a>和<a class="ae ky" href="https://www.youtube.com/channel/UC9xKdy8cz6ZuJU5FTNtM_pQ" rel="noopener ugc nofollow" target="_blank"> YouTube </a>上关注我，或者在<a class="ae ky" href="https://www.linkedin.com/in/zoumana-keita/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上打招呼。讨论人工智能、人工智能、数据科学、自然语言处理和人工智能是一种乐趣！</p></div></div>    
</body>
</html>