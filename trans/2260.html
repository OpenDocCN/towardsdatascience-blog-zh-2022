<html>
<head>
<title>Predict Transactions On Your Website Using Big Query ML</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用大查询ML预测您网站上的交易</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predict-transactions-on-your-website-using-big-query-ml-c365f58d29ca#2022-05-18">https://towardsdatascience.com/predict-transactions-on-your-website-using-big-query-ml-c365f58d29ca#2022-05-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a00c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">基于谷歌分析数据训练模型</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/908ea3e28b4befffff844f3970ae6456.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PkiIlFUpNW9R5CNZ"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@pickawood?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">皮卡伍德</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="8ee4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你在网上销售产品，预测哪些用户会转化可以帮助你增加收入。例如，它可以让您:</p><ul class=""><li id="9ed3" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">创建定制广告受众</li><li id="6e0c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">基于用户行为生成动态产品推荐</li><li id="afef" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">自定义现有用户的电子邮件工作流</li></ul><p id="5d13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个分析，我们将使用<code class="fe mj mk ml mm b">google_analytics_sample</code>公共数据集，您可以在这里找到<a class="ae ky" href="https://support.google.com/analytics/answer/7586738#zippy=%2Cin-this-article" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="3e12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大查询公共数据集是实践数据科学的惊人资源。然而，如果你有自己的网站，用你的网站数据训练你的模型会更有趣！</p><h2 id="e42c" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">步骤1:了解数据集</h2><p id="1960" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">当我们研究这个模式时，我们可以看到我们有一个列<strong class="lb iu"> visitId </strong>，这意味着我们每个会话有一行。</p><blockquote class="nl nm nn"><p id="d877" class="kz la no lb b lc ld ju le lf lg jx lh np lj lk ll nq ln lo lp nr lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">会话</em> </strong></p><p id="e17e" class="kz la no lb b lc ld ju le lf lg jx lh np lj lk ll nq ln lo lp nr lr ls lt lu im bi translated">用户在您的网站或应用上活跃的时间段。默认情况下，如果用户处于非活动状态达30分钟或更长时间，任何未来的活动都将归于新的会话。离开您的站点并在30分钟内返回的用户被算作原始会话的一部分。</p></blockquote><p id="79fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">来源:<a class="ae ky" href="https://support.google.com/analytics/answer/6086069?hl=en" rel="noopener ugc nofollow" target="_blank">谷歌分析文档</a></p><p id="70a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还有一个列<strong class="lb iu"> transactions，</strong>，它是一个整数列，对应于会话中的事务数量。我们并不真正关心实际的数字，我们只是想检查用户是否转换。</p><p id="6f9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们有我们的一系列功能:</p><ul class=""><li id="e701" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu"> totals </strong>包含一些有趣的指标，如页面浏览量、网站停留时间…</li><li id="f2c3" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu"> trafficSource </strong>包含关于源(用户来自哪里)的数据</li><li id="c00a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">设备</strong>包含所用设备的信息</li><li id="eccb" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">地理网络</strong>包含地理信息</li><li id="089e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu"> hits </strong>包含事件信息，甚至是交易信息。</li></ul><p id="99ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们有一个小问题:hit包含关于事务的数据，这可能是数据泄漏。ML模型应该只访问在事务之前<strong class="lb iu">发生的事情。</strong></p><p id="5464" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了避免数据泄露，我们将去掉hits列。当然，对于包含在其他指标中的事务数据，我们可能仍然有一些问题。例如，会话的持续时间包括结帐过程的持续时间，这需要一些时间。页面浏览量也是如此。理想情况下，我们需要从这些指标中减去结帐页面发生的事情，但是我们现在忽略这一点。</p><h2 id="15cf" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">步骤2:将数据分为训练集和测试集</h2><p id="03ca" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">大查询允许我们在创建模型时分割数据，但我们也希望避免查看测试数据，因此我们将把数据集分割成一个训练和测试表。</p><p id="2f8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的表有2556行，因此80–20%的分割将得到:</p><ul class=""><li id="e494" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">列车拆分的2044行</li><li id="5c96" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">512行用于测试分割</li></ul><p id="a15b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们需要生成随机数。SQL没有本地随机函数，所以我们将使用Javascript函数。这是我喜欢大查询的原因之一，你可以对任何列应用JavaScript函数！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="69f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这给了我们:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="c639" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，有效！现在让我们创建我们的表。首先，让我们创建保存随机数的表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="62a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们将创建我们的训练和测试集。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><h2 id="47fd" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated"><strong class="ak">步骤3:探索Data Studio中的训练集</strong></h2><p id="6509" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">让我们在Data Studio上创建一个新报告，并选择Big Query作为源。</p><p id="5a54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要知道的第一件事是交易的访问份额。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者的数据工作室报告</p></figure><p id="473d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这显然是一个不平衡的数据集，我们必须记住这一点！</p><p id="d1cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们试着看看购买者和非购买者的页面浏览量和网站停留时间的影响。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者的数据工作室报告</p></figure><p id="25fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里显然有一个模式:似乎买家比非买家在网站上花费更多的时间，浏览更多的页面，这是有道理的。</p><p id="61dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，让我们看看来源和转换之间的关系。这次我们将使用频道分组。</p><blockquote class="nl nm nn"><p id="1c9e" class="kz la no lb b lc ld ju le lf lg jx lh np lj lk ll nq ln lo lp nr lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">频道分组</em> </strong></p><p id="4993" class="kz la no lb b lc ld ju le lf lg jx lh np lj lk ll nq ln lo lp nr lr ls lt lu im bi translated">频道分组是基于规则的流量来源分组。在整个分析报告中，你可以看到你的数据根据默认的渠道分组进行组织，这是一个最常见的流量来源分组，如<em class="it">付费搜索</em>和<em class="it">直接</em>。这使您可以快速检查每个流量通道的性能。</p></blockquote><p id="fa1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">来源:<a class="ae ky" href="https://support.google.com/analytics/answer/6086078?hl=en&amp;ref_topic=6083659" rel="noopener ugc nofollow" target="_blank">谷歌分析文档</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者的数据工作室报告</p></figure><p id="719f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">频道分组似乎有影响，但是我们必须小心，因为我们没有很多数据。</p><h2 id="f97a" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">步骤4:构建我们的ML模型</h2><p id="6fb5" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">让我们试试逻辑回归，这是最常见的分类模型之一。如果您不知道逻辑回归，我在参考资料中提供了一些StatQuest视频的链接。</p><p id="dbdf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在大查询上创建模型的语法很简单:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><h2 id="5fa9" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">步骤5:评估我们的模型</h2><p id="33c1" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">现在我们已经创建了模型，是时候看看它在我们的测试集上是否表现良好了！</p><p id="d37e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于我们的数据是不平衡的，准确性将不是一个评估模型的好指标:仅仅通过每次预测错误，我们将获得超过98%的准确性。</p><p id="3bdb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我们将使用ROC曲线来预测我们的模型。</p><p id="1a54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们编写一个查询来评估我们的逻辑回归:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="751a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这说明用途:</p><ul class=""><li id="c8ca" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">我们识别50%的交易。</li><li id="3c2c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在我们确定为事务的会话中，实际上只有22%是事务。</li></ul><p id="6c38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">即使这些数字看起来不怎么样，但当你想到一个用户只有1.7%的转化机会时，也没那么糟糕。这给了我们几乎95%的ROC_AUC。</p><p id="1381" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，我们可能没有足够的数据来构建一个强大的模型，但是想象一下用成千上万的会话来做这件事！</p><h2 id="658c" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">步骤6:使用模型</h2><p id="38f5" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">在现实生活中，我们可以通过多种方式使用这个模型。</p><p id="d048" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一种方法是实时使用ML模型来确定用户将要购买的概率:</p><ul class=""><li id="1f4c" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">如果概率很高，我们什么都不做。</li><li id="3e61" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">如果概率为中等，我们会显示一个弹出窗口，显示只在今天有效的折扣代码，试图说服用户购买。</li><li id="6e93" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">如果概率低，我们什么都不做。</li></ul><p id="b811" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种模式将帮助我们说服犹豫不决的用户。</p><p id="2bdf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这种模式的另一种方法是建立观众群；我们把概率最高但是还没买或者很长时间没买的用户拿过来，我们用他们来创造一个定制的广告受众，或者我们给他们发邮件。</p><h2 id="2421" class="mn mo it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">资源</h2><ul class=""><li id="2b0f" class="lv lw it lb b lc ng lf nh li nv lm nw lq nx lu ma mb mc md bi translated"><a class="ae ky" href="https://cloud.google.com/bigquery/public-data" rel="noopener ugc nofollow" target="_blank">大查询公共数据集</a></li><li id="93b1" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://developers.google.com/analytics" rel="noopener ugc nofollow" target="_blank">谷歌分析文档</a></li><li id="1b40" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create#data_split_method" rel="noopener ugc nofollow" target="_blank">大查询ML文档</a></li><li id="39a8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions?hl=en#javascript-udf-structure" rel="noopener ugc nofollow" target="_blank">大查询用户自定义函数文档</a></li><li id="2e9b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://support.google.com/datastudio/answer/6283323?hl=en&amp;ref_topic=6267740" rel="noopener ugc nofollow" target="_blank"> Data Studio文档</a></li><li id="7cf4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://www.youtube.com/watch?v=yIYKR4sgzI8&amp;list=PLblh5JKOoLUKxzEP5HA2d-Li7IJkHfXSe" rel="noopener ugc nofollow" target="_blank">统计任务:逻辑回归</a></li><li id="eb5d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://www.youtube.com/watch?v=4jRBRDbJemM" rel="noopener ugc nofollow" target="_blank"> StatQuest: ROC和AUC，解释清楚！</a></li></ul></div></div>    
</body>
</html>