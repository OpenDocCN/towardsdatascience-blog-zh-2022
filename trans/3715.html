<html>
<head>
<title>Training YOLO? Select Anchor Boxes Like This</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">训练YOLO？像这样选择定位框</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/training-yolo-select-anchor-boxes-like-this-3226cb8d7f0b#2022-08-18">https://towardsdatascience.com/training-yolo-select-anchor-boxes-like-this-3226cb8d7f0b#2022-08-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c61e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><em class="kf">回顾YOLOv5和YOLOv7中的自动锚点选择算法</em></h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/40ae6437071577817ae1942f6f0560b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hTPIAQj1Zut6wEO56_QDIw.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kw" href="https://www.pexels.com/ru-ru/photo/1379354/" rel="noopener ugc nofollow" target="_blank">原图</a>作者修改</p></figure><p id="03b6" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">一些卷积神经网络，包括后来版本的YOLO，依赖于锚点。因此，在开始训练你的网络之前，你需要决定你将使用什么锚，并根据你所拥有的数据做出这个决定。锚集就像是你传递给模型的一个常量，就像是一个先验，它包含了数据集中对象大小的性质。</p><p id="fed9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">根据<a class="ae kw" href="https://www.mathworks.com/help/vision/ug/anchor-boxes-for-object-detection.html#:~:text=What%20Is%20an%20Anchor%20Box,sizes%20in%20your%20training%20datasets." rel="noopener ugc nofollow" target="_blank"> MathWorks </a>:</p><blockquote class="lt lu lv"><p id="dcc3" class="kx ky lw kz b la lb jr lc ld le ju lf lx lh li lj ly ll lm ln lz lp lq lr ls ij bi translated">锚定框是一组具有一定高度和宽度的预定义边界框。这些框被定义为捕获您想要检测的特定对象类的比例和纵横比，并且通常基于您的训练数据集中的对象大小来选择。”</p></blockquote><p id="688e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">选择好的锚点很重要，因为YOLO不是直接预测边界框，而是预测锚点框的位移。自然，神经网络比大位移更好(更准确)地预测小位移。因此，你选择的锚盒越好，神经网络做的“工作”就越少，模型产生的准确度就越高。</p><p id="3933" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">自动锚定算法是在<a class="ae kw" href="https://github.com/ultralytics/yolov5" rel="noopener ugc nofollow" target="_blank"> YOLOv5库</a>中引入的，后来被复制粘贴到<a class="ae kw" href="https://github.com/WongKinYiu/yolov7" rel="noopener ugc nofollow" target="_blank"> YOLOv7库</a>中，没有做任何修改。该算法的思想如下:</p><p id="5a07" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在训练之前，脚本检查提供的锚点与数据的匹配程度，如果不匹配，脚本将重新计算它们；并且用新的、更合适的锚来训练模型。听起来是一个非常有用的特性，不是吗？</p><p id="ea87" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">的确如此。这篇文章致力于自动锚定算法:它是如何工作的，它背后的直觉是什么。如果你有兴趣—继续阅读:)</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><p id="7a20" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在回顾了<a class="ae kw" href="https://github.com/ultralytics/yolov5/blob/master/utils/autoanchor.py" rel="noopener ugc nofollow" target="_blank">自动锚定代码</a>之后，我相信最好将其解释为一个4步算法:</p><p id="f584" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">第一步。从<strong class="kz ir"> <br/> </strong>步骤2的训练数据中获取边界框尺寸。选择一个指标来定义锚定适应性<br/>步骤3。进行聚类以获得锚的初始猜测<br/>步骤4。进化主播，提高主播体能</p><h1 id="f76b" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">第一步。从训练数据中获取边界框大小</h1><p id="7735" class="pw-post-body-paragraph kx ky iq kz b la mz jr lc ld na ju lf lg nb li lj lk nc lm ln lo nd lq lr ls ij bi translated">您需要的是所有列车图像中所有边界框(标签)的高度和宽度。注意，对于已经调整大小的图像(调整到模型输入大小)，高度和宽度应该以像素计算。</p><p id="c1a1" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">默认情况下，YOLOv5和YOLOv7的模型输入大小为640x640，这意味着图像较大一侧的大小调整为640，纵横比保持不变，较短一侧填充。见下面的可视化。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ne"><img src="../Images/517a4dbfaaa4b4807c562b031a67ca78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ADU6xJesfTPSi3LpL-cXLA.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated"><em class="kf">边界框的高度和宽度应根据模型输入尺寸重新计算。原图来自</em> <a class="ae kw" href="https://cocodataset.org/#home" rel="noopener ugc nofollow" target="_blank"> <em class="kf"> COCO数据集</em> </a> <em class="kf">，可视化由作者创作。</em></p></figure><h1 id="72f8" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">第二步。选择一个指标来定义锚点适合度</h1><p id="b43e" class="pw-post-body-paragraph kx ky iq kz b la mz jr lc ld na ju lf lg nb li lj lk nc lm ln lo nd lq lr ls ij bi translated">接下来，我们需要一个度量来比较锚盒集，并了解哪一个更适合数据。</p><p id="7724" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">理想情况下，<strong class="kz ir">度量应该与损耗函数</strong>(特别是盒损耗)相关联:度量越好，损耗越低。并且如果使用该度量选择锚盒，则模型已经以较低的损失开始训练。完美！</p><p id="ff61" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这个指标将用于进化算法中，这意味着你可以使用任何指标，而不用考虑一些优化算法可能强加的约束。</p><p id="8afe" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">YOLO自动锚定算法中使用的度量是棘手的，也许你不需要知道那么多细节，但对于那些感兴趣的人，解释如下:</p><ul class=""><li id="c0b6" class="nf ng iq kz b la lb ld le lg nh lk ni lo nj ls nk nl nm nn bi translated">有一个阈值定义为超参数(称为<em class="lw"> anchor_t </em>，默认为4；有时用作<em class="lw"> 1/anchor_t </em>，为0.25)。这个阈值意味着，如果锚定框比边界框标签大或小不超过4倍，我们就认为它是一个好的锚定框。</li><li id="6e04" class="nf ng iq kz b la no ld np lg nq lk nr lo ns ls nk nl nm nn bi translated">我们希望每个边界框标签尽可能靠近至少一个定位框。我们希望它接近阈值(不超过4倍大或小)。</li><li id="3ac7" class="nf ng iq kz b la no ld np lg nq lk nr lo ns ls nk nl nm nn bi translated">平均而言，达到了良好的适应度，这意味着一些边界框(可能是离群值)可能仍然远离锚点。</li><li id="40cc" class="nf ng iq kz b la no ld np lg nq lk nr lo ns ls nk nl nm nn bi translated">对于每个边界框，我们选择最好的锚点，但是我们从最差的拟合边开始计算它的拟合度(希望这样有意义)。</li></ul><p id="6318" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果您还想了解指标是如何计算的，我真的建议您仔细阅读下面的计算。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nt"><img src="../Images/3fef106c9426e22630c7748ad2312022.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CsaDQUA9WDLAOPpcEPGJrA.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated"><em class="kf">如何在YOLOv5和YOLOv7中计算适应性指标。本例中有3个锚点，在YOLOs中默认为9个锚点。图片作者。</em></p></figure><h1 id="63e3" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">第三步。进行聚类以获得锚的初始猜测</h1><p id="13d4" class="pw-post-body-paragraph kx ky iq kz b la mz jr lc ld na ju lf lg nb li lj lk nc lm ln lo nd lq lr ls ij bi translated">在<a class="ae kw" href="https://arxiv.org/abs/1612.08242v1" rel="noopener ugc nofollow" target="_blank"> YOLOv2 </a>中，仅使用k-means聚类算法计算锚盒。k-means的典型距离度量是欧几里德距离，然而，对于该距离，较大的框比小的度量产生更多的误差，因此作者利用1-IoU(并集上的交集)作为距离度量。顺便说一下，IoU与YOLO损失函数的关系比欧氏距离更密切。</p><p id="1d8c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">只做k-means聚类已经是一个很好的方法，它会给你比手工挑选锚盒更好的结果。然而，后来YOLO版本的作者决定走得更远:</p><ul class=""><li id="c6c4" class="nf ng iq kz b la lb ld le lg nh lk ni lo nj ls nk nl nm nn bi translated">K-means(具有简单的欧几里德距离)用于获得锚盒的初始猜测。</li><li id="3a26" class="nf ng iq kz b la no ld np lg nq lk nr lo ns ls nk nl nm nn bi translated">使用进化算法(在步骤4中有更多描述)来寻找相对于先前在步骤2中选择的度量的最佳锚集。</li></ul><p id="58b1" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如何选择集群的数量？默认情况下，YOLOv5和YOLOv7使用9个锚框，因此簇的数量应为9。</p><p id="4e2c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"> <em class="lw">初学者注意事项</em> </strong>。K-means算法在来自训练集的所有包围盒标签上运行。用于聚类的特征-以像素为单位的宽度和高度。最终聚类中心是锚盒。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nu"><img src="../Images/338f45d8699d8116287a06fb43000700.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8a4LeInLRvE2GOENoElxTA.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated"><em class="kf"> K-means聚类算法用于找到锚盒的初始猜测。本例中有3个锚点，在YOLOs中默认为9个锚点。图片作者。</em></p></figure><h1 id="56ce" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">第四步。进化主播，提高主播体能</h1><p id="fd06" class="pw-post-body-paragraph kx ky iq kz b la mz jr lc ld na ju lf lg nb li lj lk nc lm ln lo nd lq lr ls ij bi translated">进化算法的灵感来源于自然，简单而美丽。我们从k-means中取出锚集，稍微随机改变一些锚盒的高度和宽度(变异)，然后计算适合度。如果新的变异锚集更好，则对新的锚集执行下一次变异，否则，使用旧的锚。如果你更喜欢视觉消费信息，下面是这种进化算法的工作原理。</p><p id="64c5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在YOLOv5和YOLOv7中，evolution运行1000次迭代(默认情况下),可能会大量更改初始锚集。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nv"><img src="../Images/42d799688a54df7769fbc7384d0e0489.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6EvZIEFyHMClXxiGidBEWw.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated"><em class="kf">进化算法在YOLOv5和YOLOv7中的自动锚定。图片作者。</em></p></figure><h1 id="2944" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">最后一句话</h1><p id="3470" class="pw-post-body-paragraph kx ky iq kz b la mz jr lc ld na ju lf lg nb li lj lk nc lm ln lo nd lq lr ls ij bi translated">现在你知道YOLO自动锚是如何工作的了，所有的细节。我计划在未来回顾YOLO的其他地方，所以如果你感兴趣——订阅并保持更新。</p><p id="9183" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">同时，我鼓励你看看我的其他一些帖子:</p><div class="nw nx gp gr ny nz"><a rel="noopener follow" target="_blank" href="/learn-to-reproduce-papers-beginners-guide-2b4bff8fcca0"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">学习复制论文:初学者指南</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">关于如何理解深度学习论文和实现所描述的方法的分步指导。用一个…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">towardsdatascience.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on kq nz"/></div></div></a></div><div class="nw nx gp gr ny nz"><a rel="noopener follow" target="_blank" href="/explainable-defect-detection-using-convolutional-neural-networks-case-study-284e57337b59"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">使用卷积神经网络的可解释缺陷检测:案例研究</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">没有任何包围盒标签的训练对象检测模型。这篇文章展示了可解释人工智能的力量。</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">towardsdatascience.com</p></div></div><div class="oi l"><div class="oo l ok ol om oi on kq nz"/></div></div></a></div><div class="nw nx gp gr ny nz"><a rel="noopener follow" target="_blank" href="/word2vec-with-pytorch-implementing-original-paper-2cd7040120b0"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">使用PyTorch的Word2vec:实现原始论文</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">涵盖所有实现细节，跳过高级概述。代码附后。</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">towardsdatascience.com</p></div></div><div class="oi l"><div class="op l ok ol om oi on kq nz"/></div></div></a></div></div></div>    
</body>
</html>