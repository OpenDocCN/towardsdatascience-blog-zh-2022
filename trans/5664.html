<html>
<head>
<title>NodeFormer: Scalable Graph Transformers for Million Nodes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NodeFormer:百万节点的可伸缩图转换器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/scalable-graph-transformers-for-million-nodes-2f0014ceb9d4#2022-12-22">https://towardsdatascience.com/scalable-graph-transformers-for-million-nodes-2f0014ceb9d4#2022-12-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="cc99" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用 O(N)传递所有对消息</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9e3207e3195bd4fb6b61cca604b64cab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fm5-sGT4K0fOa9gl4_789Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片:Unsplash。</p></figure><p id="6087" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最近，建立用于处理图结构数据的变换器模型在机器学习研究社区中引起了广泛的兴趣。一个关键的挑战来自全球注意力的二次方复杂性，这阻碍了变形金刚扩展到大图。本博客将简要介绍 NeurIPS22 的最新研究成果:</p><blockquote class="lr ls lt"><p id="a227" class="kv kw lu kx b ky kz jr la lb lc ju ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated"><a class="ae ly" href="https://openreview.net/pdf?id=sMezXGG5So" rel="noopener ugc nofollow" target="_blank"> NodeFormer:一个可扩展的图结构学习转换器，用于节点分类</a>，其<a class="ae ly" href="https://github.com/qitianwu/NodeFormer" rel="noopener ugc nofollow" target="_blank">公共实现</a>可用。</p></blockquote><p id="50da" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">这项工作提出了一种可扩展的图转换器，用于大型节点分类图，其中节点数量可以从数千变化到数百万(甚至更多)</strong>。关键模块是基于内核化 Gumbel-Softmax 的消息传递，它在 O(N)复杂度  (N 表示节点数)内实现<strong class="kx ir"> <em class="lu">所有对特征传播。</em></strong></p><p id="f77b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下内容将总结这项工作的主要思想和成果。</p><h1 id="c0d2" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">图形转换器与图形神经网络</h1><p id="f3b7" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">与依赖于在固定输入图拓扑上传递消息的图神经网络(GNNs)不同，图转换器可以通过每个传播层中的自适应拓扑更灵活地聚集来自所有节点的全局信息。具体来说，图形转换器有几个优点:</p><ul class=""><li id="8b88" class="mw mx iq kx b ky kz lb lc le my li mz lm na lq nb nc nd ne bi translated"><strong class="kx ir"> <em class="lu">处理不完善的结构。</em> </strong>对于具有异质性、长程相关性和伪边的图形数据，GNNs 往往因其局部特征聚合设计而表现出能力不足。然而，变压器采用全局注意力，将来自所有节点的信息聚集在一层中，这可以克服输入结构的限制。</li><li id="5cfd" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated"><strong class="kx ir"> <em class="lu">避免过度挤压。</em> </strong>当将信息聚合到固定长度的向量中时，GNNs 可能会指数地丢失信息，而图转换器利用全局注意力聚合，可以自适应地关注为目标节点的预测任务提供信息的主导节点。</li><li id="4339" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated"><strong class="kx ir"> <em class="lu">无图任务的灵活性。</em> </strong>除了图的问题，还有各种各样没有图结构的任务。例如，图像和文本分类(每个图像可以被视为一个节点，但没有图形将它们连接起来)，以及物理模拟(每个粒子都是一个节点，但没有显式观察的图形)。虽然通常的做法是在输入特征上使用 k-NN 来构建用于消息传递的相似性图，但是这种人工创建的图通常独立于下游预测任务，并且会导致次优性能。转换器通过自动学习消息传递的自适应图结构来解决这个问题。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/8535f506f65a03edbc8bd5511247c490.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_bOUG_JkJaUZEYTt.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">对于节点分类，转换器可以将来自所有其他节点的信息聚合到一个层中。Transformers 给出的分层更新规则可以看作是一步节点嵌入更新和图结构估计的组合(我们可以把注意力矩阵看作图邻接矩阵)</p></figure><h1 id="dec9" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">在大型图上构建变压器的挑战</h1><p id="4271" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">有几个挑战使得在大型图上构建转换器成为一个不小的问题，特别是在节点数超过数千的图上。</p><ul class=""><li id="f8c1" class="mw mx iq kx b ky kz lb lc le my li mz lm na lq nb nc nd ne bi translated"><strong class="kx ir"> <em class="lu">全局注意力的二次复杂度:</em> </strong>用于所有对特征聚集的注意力计算需要 O(N)复杂度，这对于大图是禁止的，其中 N 可以是任意大的，例如从几千到几百万。具体来说，如果 N 大于 10K，一个 16GB 内存的普通 GPU 将无法在所有节点上运行这样的全局关注。</li><li id="432a" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated"><strong class="kx ir"> <em class="lu">图稀疏性的调节:</em> </strong>与密集连接所有节点对的关注图(我们可以将关注矩阵视为加权图邻接矩阵)相比，真实世界的图通常是稀疏的。问题是当 N 变大时，在这样一个密集图上的特征传播可能会导致我们所说的过度规范化问题，这意味着来自不同节点的信息被其他节点所分散。在传播之前稀疏化可学习结构的合理补救措施。</li></ul><h1 id="4f1d" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">基于内核化 Gumbel-Softmax 的消息传递</h1><p id="0076" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">我们的工作节点形成器结合了<a class="ae ly" href="https://people.eecs.berkeley.edu/~brecht/papers/07.rah.rec.nips.pdf" rel="noopener ugc nofollow" target="_blank">随机特征图</a>和<a class="ae ly" href="https://arxiv.org/abs/1611.01144" rel="noopener ugc nofollow" target="_blank"> Gumbel-Softmax </a>作为解决上述问题的统一模型。具体来说，Gumbel-Softmax 首先用于替换原始的基于 Softmax 的注意力特征聚合:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/465c8b65001dbddb7745706b686d0fae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZI3fkCd0I-ZOREJu.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用当前层的所有节点表示来更新下一层节点表示。Gumbel-Sofmtax 可以被视为对目标节点 u 的所有节点中的一个相邻节点进行采样的连续放松。实际上，可以采样 K 次，这产生一组采样的相邻节点。q、k、v 是来自结点表示的变换要素</p></figure><p id="bc35" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上面的等式定义了需要 O(N)的节点 u 的计算，并且计算 N 个节点的表示需要 O(N)的复杂度，因为必须独立地计算所有对的注意力分数。为了解决这个困难，我们求助于<a class="ae ly" href="https://arxiv.org/abs/2009.14794" rel="noopener ugc nofollow" target="_blank"> Performer </a>中的主要思想，并采用随机特征映射(RFM)来近似 gum bel-Softmax(Performer 中最初采用 RFM 旨在近似确定性 soft max 注意力，这里我们将这种技术扩展到具有随机噪声的 Gumbel-Softmax)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/dd7cbcb9845bea5fb904d3b8aeed836c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_gyViDdC7Pio0BOw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用建议的内核化 Gumbel-Softmax 的新更新规则。从 LHS 到 RHS 的推导是根据矩阵乘积的基本关联规则</p></figure><p id="a04e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">重要的是，在新的计算中，即上述方程的 RHS 中，两个求和项(在 N 个节点上)由所有节点共享，并且在一层中只能计算一次。因此，这导致更新一层中 N 个节点的复杂度为 O(N)。</p><h1 id="9c46" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">如何利用输入图</h1><p id="5129" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">另一个重要的问题是如何利用输入结构(如果有的话),因为上面的全对消息传递忽略了输入图。我们另外提出两个简单的策略:</p><ul class=""><li id="9505" class="mw mx iq kx b ky kz lb lc le my li mz lm na lq nb nc nd ne bi translated"><strong class="kx ir"> <em class="lu">添加关系偏差:</em> </strong>我们另外假设一个可学习的标量项，如果在输入图中节点 u 和 v 之间存在边，则该标量项被添加到节点 u 和 v 之间的注意力得分中。</li><li id="a2ad" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated"><strong class="kx ir"> <em class="lu">边缘正则化损失:</em> </strong>使用边缘(u，v)的关注分数作为估计概率，并为所有观察到的边缘定义最大似然估计(MLE)损失。直观地说，这种设计最大化了观察到的边缘的注意力权重。</li></ul><p id="9510" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是输入图的重要性(或者说信息量)在不同的数据集之间是不同的。所以在实践中，需要调整权重(作为一个超参数),它决定了对输入图的重视程度。下图显示了 NodeFormer 的整体数据流。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/d1c062a4045756f9df14d51067ea5099.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cJoMrYkAkEwjqQ96.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">节点形成器的数据流，其输入包含类似于普通 GNNs 的节点特征和图邻接。红色部分是通过内核化 Gumbel-Softmax 传递的所有对消息，绿色部分是关系偏差，蓝色部分是边缘正则化损失。如果输入图不重要或不可用，后两个部分可以省略。</p></figure><h1 id="ba1a" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">实验结果</h1><p id="3ba5" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">我们将 NodeFormer 应用于节点分类任务，并在八个数据集上取得了与常见的 GNNs 和最先进的图结构学习模型<a class="ae ly" href="https://arxiv.org/abs/1903.11960" rel="noopener ugc nofollow" target="_blank"> LDS </a>和<a class="ae ly" href="https://proceedings.neurips.cc/paper/2020/hash/e05c7ba4e087beea9410929698dc41a6-Abstract.html" rel="noopener ugc nofollow" target="_blank"> IDGL </a>相比极具竞争力的结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/f9ce4f6de01436777601fd4a6555c5f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EiI-onyWzpj9cj6r.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">NodeFormer 和普通 GNN 模型的对比实验结果</p></figure><p id="8ed5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">除了节点分类，我们还考虑了图像和文本分类任务，其中输入图形丢失。我们使用具有不同 k(5，10，15，20)的 k-NN 来构建图，并且还考虑不使用节点形成器的输入图。有趣的是，后一种情况不会导致明显的性能下降，有时还会带来更好的性能。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/bc15dc34257b9437090e3e98e9466bdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dMbeIMVeiYPkNtT9.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">节点嵌入和估计关注分数的可视化(过滤掉低权重的那些)。我们用一种颜色标记同一标签类的节点。全局注意力倾向于连接同一类中的节点，并且还增加了图的全局连通性</p></figure><p id="a781" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">作为一个新的模型类，我们强调 NodeFormer 的一些优点:</p><ul class=""><li id="3c0f" class="mw mx iq kx b ky kz lb lc le my li mz lm na lq nb nc nd ne bi translated"><strong class="kx ir"> <em class="lu">容量:</em> </strong> NodeFormer 通过各层的稀疏关注和来自所有节点的潜在聚合信息，自适应地学习图结构。</li><li id="df72" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated"><strong class="kx ir"> <em class="lu">可扩展性:</em> </strong> NodeFormer 支持 O(N)复杂度和小批量分区训练。在实践中，<em class="lu">它仅使用 4GB 内存就成功地扩展到具有百万个节点的大型图。</em></li><li id="3c55" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated"><strong class="kx ir"> <em class="lu">效率:</em></strong>node former 的训练可以通过基于梯度的优化以高效的端到端方式完成。例如，在 1000 个纪元中对 Cora 进行培训和评估只需要 1-2 分钟。</li><li id="4f9d" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated"><strong class="kx ir"> <em class="lu">灵活性:</em> </strong> NodeFormer 灵活用于归纳学习和处理无图情况。</li></ul><p id="ac39" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们还简要讨论了 NodeFormer 的潜在应用。一般来说，NodeFormer 可以用作图形结构数据的通用编码器，或者处理标准预测任务中实例之间的相互依赖。具体来说，它可以很容易地应用于两类问题:</p><ul class=""><li id="fc1d" class="mw mx iq kx b ky kz lb lc le my li mz lm na lq nb nc nd ne bi translated"><strong class="kx ir">(大)图上的预测任务</strong>，即目标是基于节点特征和图结构预测每个节点(或边)的标签。例如，预测大型社交网络中的用户活动。</li><li id="0139" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated"><strong class="kx ir">没有输入图和节点形成器的标准预测任务(分类或回归)</strong>可用于开发数据集中实例之间的潜在相互依赖性。例如图像分类。</li></ul><p id="4b8a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这篇博客介绍了一种新的图形转换器，它可以成功地扩展到大型图形，并显示出优于普通 gnn 的良好性能。变压器式模型具有一些固有的优势，可以克服 GNNs 在处理长程相关性、异质性、过度挤压、图形噪声和完全没有图形方面的局限性。尽管如此，构建强大的图形转换器作为下一代图形表示模型仍然是一个开放和未充分探索的问题，我们希望这项工作可以在这个方向上提供一些见解。</p><p id="f021" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果对这项工作感兴趣，人们可以阅读报纸了解更多的细节。</p><blockquote class="lr ls lt"><p id="65d0" class="kv kw lu kx b ky kz jr la lb lc ju ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated">论文:<a class="ae ly" href="https://openreview.net/pdf?id=sMezXGG5So" rel="noopener ugc nofollow" target="_blank">https://openreview.net/pdf?id=sMezXGG5So</a></p><p id="062e" class="kv kw lu kx b ky kz jr la lb lc ju ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated">代号:【https://github.com/qitianwu/NodeFormer T2】</p></blockquote><p id="d9d9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">除非另有说明，所有图片均为作者所有。</p></div></div>    
</body>
</html>