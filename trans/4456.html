<html>
<head>
<title>Time Series Forecasting on Power Consumption</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">电力消费的时间序列预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-forecasting-on-power-consumption-273d56768b99#2022-10-04">https://towardsdatascience.com/time-series-forecasting-on-power-consumption-273d56768b99#2022-10-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8f9c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">本文旨在利用时间序列分析来预测摩洛哥泰图安市的电力消耗</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8ec416b00c8deecaa17e91953f574135.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*C_vcSQszquuh6kLT"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@matthewhenry?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马太·亨利</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><h1 id="64e7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="53b1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">该项目的目标是利用<strong class="lt iu">时间序列分析</strong>来预测摩洛哥Tétouan市10分钟内的能源消耗。</p><h2 id="7e38" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">语境</h2><p id="9440" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">根据2014年的人口普查，泰图安是摩洛哥的一个城市，人口<strong class="lt iu"> 38万</strong>，面积<strong class="lt iu">11570km</strong>。这座城市位于该国的北部，面向地中海。夏天的天气特别湿热。</p><p id="e2fe" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">根据国有<strong class="lt iu"> ONEE </strong>“国家电力和饮用水办公室”的数据，摩洛哥2019年的能源生产主要来自煤炭(38%)，其次是水电(16%)、燃油(8%)、天然气(18%)、风能(11%)、太阳能(7%)和其他(2%) [1]。</p><p id="d163" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">鉴于对不可再生资源的高度依赖(64%)，预测能源消耗可以帮助利益相关者更好地管理采购和库存。最重要的是，摩洛哥的计划是通过增加可再生能源的产量来减少能源进口。众所周知，像风能和太阳能这样的能源存在一年到头都不可用的风险。从一个中等城市开始，了解该国的能源需求，可能是规划这些资源的进一步举措。</p><h2 id="a375" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">数据</h2><p id="e320" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">公共服务运营商Amendis的监控和数据采集系统(<strong class="lt iu"> SCADA </strong>)负责收集和提供项目用电数据。<strong class="lt iu">配电网</strong>由3个区域站供电，即:Quads、Smir和Boussafou。三个区域电站为城市的三个不同区域供电，这就是为什么我们有三个潜在的目标变量。</p><p id="34ae" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">你可以在<a class="ae ky" href="https://archive.ics.uci.edu/ml/datasets/Power+consumption+of+Tetouan+city" rel="noopener ugc nofollow" target="_blank">这个链接</a>【2】【3】找到的数据，有从2017年1月1日开始，一直到同年12月30日(不是31日)的<strong class="lt iu"> 10分钟窗口</strong>中的<strong class="lt iu"> 52，416 </strong>能耗观测。一些功能包括:</p><ol class=""><li id="b2f7" class="ne nf it lt b lu mz lx na ma ng me nh mi ni mm nj nk nl nm bi translated"><code class="fe nn no np nq b">Date Time</code>:十分钟的时间窗口。</li><li id="b923" class="ne nf it lt b lu nr lx ns ma nt me nu mi nv mm nj nk nl nm bi translated"><code class="fe nn no np nq b">Temperature</code>:天气温度，单位为摄氏度</li><li id="3a0f" class="ne nf it lt b lu nr lx ns ma nt me nu mi nv mm nj nk nl nm bi translated"><code class="fe nn no np nq b">Humidity</code>:天气湿度百分比</li><li id="3fe6" class="ne nf it lt b lu nr lx ns ma nt me nu mi nv mm nj nk nl nm bi translated"><code class="fe nn no np nq b">Wind Speed</code>:风速单位为千米/小时</li><li id="ab79" class="ne nf it lt b lu nr lx ns ma nt me nu mi nv mm nj nk nl nm bi translated"><code class="fe nn no np nq b">Zone 1 Power Consumption</code>单位为千瓦(KW)</li><li id="5761" class="ne nf it lt b lu nr lx ns ma nt me nu mi nv mm nj nk nl nm bi translated"><code class="fe nn no np nq b">Zone 2 Power Consumption</code>单位为千瓦</li><li id="8d3d" class="ne nf it lt b lu nr lx ns ma nt me nu mi nv mm nj nk nl nm bi translated"><code class="fe nn no np nq b">Zone 3 Power Consumption</code>单位为千瓦</li></ol><h1 id="7940" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">代码部署</h1><h2 id="2a06" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">导入数据集</h2><p id="36fc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">几乎每个<strong class="lt iu">数据科学</strong>项目的第一步都是导入我们将使用的数据集以及第一部分所需的库。</p><p id="212d" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">项目的数据导入和EDA部分需要的库当然是<code class="fe nn no np nq b">Pandas</code>和<code class="fe nn no np nq b">NumPy</code>，以及<code class="fe nn no np nq b">Matplotlib</code>和<code class="fe nn no np nq b">Seaborn</code>。</p><pre class="kj kk kl km gt nw nq nx ny aw nz bi"><span id="0ea4" class="mn la it nq b gy oa ob l oc od">#Importing libraries<br/>import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns</span></pre><p id="8272" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">我们可以使用下面的链接直接从<strong class="lt iu"> UCI机器学习库</strong>加载数据。如果您在浏览器上搜索相同的链接，它会启动文件的下载。</p><pre class="kj kk kl km gt nw nq nx ny aw nz bi"><span id="9e24" class="mn la it nq b gy oa ob l oc od"># Load data from URL using pandas read_csv method<br/>df = pd.read_csv('<a class="ae ky" href="https://archive.ics.uci.edu/ml/machine-learning-databases/00616/Tetuan%20City%20power%20consumption.csv'" rel="noopener ugc nofollow" target="_blank">https://archive.ics.uci.edu/ml/machine-learning-databases/00616/Tetuan%20City%20power%20consumption.csv'</a>)</span><span id="fe85" class="mn la it nq b gy oe ob l oc od">df.head()</span></pre><p id="c500" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">使用命令<code class="fe nn no np nq b">df.head()</code>，我们可以可视化数据集所有列的前5行。我对它们进行了重新命名，以便在下面的章节中能够容纳它们。</p><pre class="kj kk kl km gt nw nq nx ny aw nz bi"><span id="836e" class="mn la it nq b gy oa ob l oc od">|    | DateTime      |   Temp |   Hum |   Wind |<br/>|---:|:--------------|-------:|------:|-------:|<br/>|  0 | 1/1/2017 0:00 |  6.559 |  73.8 |  0.083 |<br/>|  1 | 1/1/2017 0:10 |  6.414 |  74.5 |  0.083 |<br/>|  2 | 1/1/2017 0:20 |  6.313 |  74.5 |  0.08  |<br/>|  3 | 1/1/2017 0:30 |  6.121 |  75   |  0.083 |<br/>|  4 | 1/1/2017 0:40 |  5.921 |  75.7 |  0.081 |</span></pre><p id="3b1a" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">我们注意到每个特征只呈现出<strong class="lt iu">数值</strong>，因此我们可以假设一个潜在的预测任务将需要<strong class="lt iu">回归技术</strong>而不是分类。</p><pre class="kj kk kl km gt nw nq nx ny aw nz bi"><span id="a5d9" class="mn la it nq b gy oa ob l oc od">|    |   Diff Fl |   Zone 1 PC |   Zone 2 PC |   Zone 3 PC |<br/>|---:|----------:|------------:|------------:|------------:|<br/>|  0 |     0.119 |     34055.7 |     16128.9 |     20241   |<br/>|  1 |     0.085 |     29814.7 |     19375.1 |     20131.1 |<br/>|  2 |     0.1   |     29128.1 |     19006.7 |     19668.4 |<br/>|  3 |     0.096 |     28228.9 |     18361.1 |     18899.3 |<br/>|  4 |     0.085 |     27335.7 |     17872.3 |     18442.4 |</span></pre><p id="fdfb" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">由于数据集的索引是数字形式的，我可以使用<code class="fe nn no np nq b">DateTime</code>列作为我的索引，这对于图表绘制来说会更容易。</p><pre class="kj kk kl km gt nw nq nx ny aw nz bi"><span id="1521" class="mn la it nq b gy oa ob l oc od">#transforming DateTime column into index<br/>df = df.set_index('DateTime')<br/>df.index = pd.to_datetime(df.index)</span></pre><p id="803f" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">命令<code class="fe nn no np nq b">df.set_index()</code>允许我们用<code class="fe nn no np nq b">DateTime</code>列替换当前索引，命令<code class="fe nn no np nq b">pd.to_datetime()</code>将新索引的格式变为可读格式。</p><h2 id="e106" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">探索性数据分析</h2><p id="258a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们现在可以专注于<strong class="lt iu">数据探索</strong>和<strong class="lt iu">可视化。</strong></p><p id="cf85" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">让我们从使用seaborn绘制一个<strong class="lt iu">相关矩阵</strong>开始。相关矩阵向我们展示了数据集中每个要素与其他要素之间的单一相关性。一般来说，相关性可以是:</p><ul class=""><li id="6d8c" class="ne nf it lt b lu mz lx na ma ng me nh mi ni mm of nk nl nm bi translated">&lt;0.3 and therefore <strong class="lt iu">虚弱</strong></li><li id="1f9c" class="ne nf it lt b lu nr lx ns ma nt me nu mi nv mm of nk nl nm bi translated">介于0.3和0.6之间，因此<strong class="lt iu">适中</strong></li><li id="b21c" class="ne nf it lt b lu nr lx ns ma nt me nu mi nv mm of nk nl nm bi translated">介于0.6和0.9之间，因此<strong class="lt iu">强</strong></li><li id="46f7" class="ne nf it lt b lu nr lx ns ma nt me nu mi nv mm of nk nl nm bi translated">&gt; 0.9 <strong class="lt iu">极强</strong></li></ul><p id="4748" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">另一方面，<strong class="lt iu">符号</strong>表示两个因子是同向增长还是反向增长。相关性-0.9表示随着<strong class="lt iu">一个变量增加，另一个变量减少</strong>。但是，根据环境的不确定性，范围可能会发生变化。在定量金融中，0.3或0.4的相关性可以被认为是强相关性。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/871ee7becaf8201bc1cc62baea902fd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0QxKo6b4ENLbP7oIsjepAg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">特征相关矩阵-按作者分类的图片</p></figure><p id="970a" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">我们来分析一下与功耗相比，这些因素的总体趋势:</p><ul class=""><li id="d10f" class="ne nf it lt b lu mz lx na ma ng me nh mi ni mm of nk nl nm bi translated"><code class="fe nn no np nq b">Temperature</code>与所有<strong class="lt iu">用电区域</strong>正相关。更多地使用空调可能是对此的一种解释。</li><li id="4f4d" class="ne nf it lt b lu nr lx ns ma nt me nu mi nv mm of nk nl nm bi translated">另一方面，<code class="fe nn no np nq b">Humidity</code>显示了与所有三个区域的功耗的轻微负相关<strong class="lt iu"/></li><li id="f78d" class="ne nf it lt b lu nr lx ns ma nt me nu mi nv mm of nk nl nm bi translated"><code class="fe nn no np nq b">Power Z1</code>、<code class="fe nn no np nq b">Power Z2</code>、<code class="fe nn no np nq b">Power Z3</code>相互之间呈现出<strong class="lt iu">高相关性</strong>。这表明所有地区的消费模式略有不同，但它们都趋向于同时增加和减少。</li></ul><h2 id="08fc" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">特征创建</h2><p id="2223" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">从这一点开始，我从由Kaggle的大师Rob Mulla出版的<a class="ae ky" href="https://www.kaggle.com/code/robikscube/time-series-forecasting-with-machine-learning-yt" rel="noopener ugc nofollow" target="_blank"> Kaggle笔记本</a>中获取了大部分代码，并根据我的情况进行了修改。我绝对推荐看一看他的伟大作品。</p><p id="435a" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">如标题所示，结合<strong class="lt iu"> EDA的特征创建代表</strong>第三步。在时间序列分析和预测中，“时间”可能是你可以支配的唯一特征，所以最好从中提取尽可能多的信息。下面的函数从<code class="fe nn no np nq b">DateTime</code>索引中创建列。</p><p id="a941" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">例如，在时间<code class="fe nn no np nq b">1/1/2017 0:10</code>，命令<code class="fe nn no np nq b">df.index.hour</code>将提取值0，因为现在是午夜。<code class="fe nn no np nq b">df.index.dayofweek</code>将显示6为2017年1月1日是星期天(从0开始计数)，以此类推。</p><p id="dbd6" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">通过在我们的<code class="fe nn no np nq b">df</code>上运行函数<code class="fe nn no np nq b">create_features</code>，我们立即创建了<strong class="lt iu">函数中定义的所有特性</strong>。</p><pre class="kj kk kl km gt nw nq nx ny aw nz bi"><span id="2ff7" class="mn la it nq b gy oa ob l oc od">def create_features(df):<br/>    """<br/>    Create time series features based on time series index.<br/>    """<br/>    df = df.copy()<br/>    df['hour'] = df.index.hour<br/>    df['dayofweek'] = df.index.dayofweek<br/>    df['quarter'] = df.index.quarter<br/>    df['month'] = df.index.month<br/>    df['year'] = df.index.year<br/>    df['dayofyear'] = df.index.dayofyear<br/>    df['dayofmonth'] = df.index.day<br/>    df['weekofyear'] = df.index.isocalendar().week<br/>    return df</span><span id="e323" class="mn la it nq b gy oe ob l oc od">df = create_features(df)</span></pre><p id="a2a1" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">此时，我们可以<strong class="lt iu">用方框图</strong>表示每个特性，以查看特定时间段内的最小、第25个百分点、平均、第75个百分点和最大消耗。</p><p id="a78e" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">如果我们按小时绘制图表，我们可以看到<strong class="lt iu">1区</strong>的平均消耗量比2区和3区<strong class="lt iu">高得多。最重要的是，所有三个地区的平均消耗量在晚上都会增加。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/374059786c5d07c8488cf7406ae0a67c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mo0YqjL1BBUBiEisbg6Fcw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">2017年全年每小时功耗(千瓦)的箱线图—图片由作者提供</p></figure><p id="f5ff" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">不出所料，温度在白天中部时段呈上升趋势，然后在晚上下降。这就是为什么只有50%的时间消耗和温度一起变化。随着晚上头几个小时气温开始下降，耗电量突然飙升。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/22dc66255b0b0cc41898dc502965560a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eBC9jVhyQwwjtDqXpNLebw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">2017年全年以摄氏度为单位的小时温度箱线图-图片由作者提供</p></figure><p id="8aa6" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">另一方面，湿度在一天中较冷的时候增加，在最热的时候减少。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/56d8f4ef120713e5fc360f212d0436c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bTTwKCPcDUcHZtk71EzsHQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">2017年全年每小时湿度百分比箱线图-图片由作者提供</p></figure><p id="eed5" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">简单移动平均线(<strong class="lt iu"> SMA </strong>)是平滑我们预测的基本信息。移动平均计算时间序列中所有数据点的<strong class="lt iu">平均值，以便为预测算法提取有价值的信息。</strong></p><pre class="kj kk kl km gt nw nq nx ny aw nz bi"><span id="39af" class="mn la it nq b gy oa ob l oc od">#Calculating moving average</span><span id="58f9" class="mn la it nq b gy oe ob l oc od">df['SMA30'] = df['Zone 1 Power Consumption'].rolling(30).mean()<br/>df['SMA15'] = df['Zone 1 Power Consumption'].rolling(15).mean()</span></pre><p id="25b3" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">用户可以使用命令<code class="fe nn no np nq b">rolling(n_days).mean()</code>指示SMA中包含的天数。</p><h2 id="8f64" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">列车测试分离</h2><p id="a0ca" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这个阶段，<strong class="lt iu">数据集</strong>可以在<strong class="lt iu">训练</strong>和<strong class="lt iu">测试</strong>之间分割。在正常情况下，我们会随机选择新的记录来训练算法，并在剩下的记录上进行测试。在这种情况下，在训练和测试记录之间保留一个<strong class="lt iu">时序</strong>是很重要的。</p><p id="6405" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">70%的可用数据是从1月1日的<strong class="lt iu">到10月10日的</strong>，因此这将是我们的训练集，而从10月2日的<strong class="lt iu">到12月30日的</strong>(可用的最后一个数据点)将是我们的测试集。</p><p id="2c9a" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">您会注意到<code class="fe nn no np nq b">Temperature</code>、<code class="fe nn no np nq b">dayofyear</code>、<code class="fe nn no np nq b">hour</code>、<code class="fe nn no np nq b">dayofweek</code>、<code class="fe nn no np nq b">SMA30</code>和<code class="fe nn no np nq b">SMA15</code>列已经被选择作为模型的输入。在启动<strong class="lt iu">最终训练阶段</strong>之前，我计算了每一列的特性重要性，并排除了返回值为0的特性。如果你想看我应用这种技术的项目，请看一下<a class="ae ky" rel="noopener" target="_blank" href="/feature-importance-to-predict-mushrooms-edibility-in-python-5aa133fea3f8">这篇文章</a>中更深入的解释。</p><p id="a024" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">我最初只选择<code class="fe nn no np nq b">Zone 1 Power Consumption</code>作为目标变量，因为在这种情况下逐区域进行更有意义，因为每个区域都有其特定的电力需求。另一个解决问题的方法是创建第四列<strong class="lt iu">合计</strong>三个区域的能源需求。</p><pre class="kj kk kl km gt nw nq nx ny aw nz bi"><span id="056e" class="mn la it nq b gy oa ob l oc od">#defining input and target variable</span><span id="96d1" class="mn la it nq b gy oe ob l oc od">X_train = df.loc[:'10-01-2017',['Temperature','dayofyear', 'hour', 'dayofweek', 'SMA30', 'SMA15']]</span><span id="7d85" class="mn la it nq b gy oe ob l oc od">y_train = df.loc[:'10-01-2017', ['Zone 1 Power Consumption']]</span><span id="91f4" class="mn la it nq b gy oe ob l oc od">X_test = df.loc['10-01-2017':,['Temperature','dayofyear', 'hour', 'dayofweek', 'SMA30', 'SMA15']]</span><span id="2b16" class="mn la it nq b gy oe ob l oc od">y_test = df.loc['10-01-2017':, ['Zone 1 Power Consumption']]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/9b0d4644a0330e3290b802616f27b57d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3VBonuhqsQodrFqgkoiDHw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">训练和测试数据集分割-按作者分类的图像</p></figure><p id="ba5a" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">从图表中，你可以看到<strong class="lt iu">用电量</strong>在八月底达到峰值，并在一月份达到最低点，我再次看到温度趋势在这里发挥了重要作用。这确实是我们在模型中包含的特性之一。</p><h2 id="4ec6" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">预言</h2><p id="08cd" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了预测我们测试集中的记录，我决定使用的算法是<strong class="lt iu">梯度提升</strong>，我在我以前的<a class="ae ky" rel="noopener" target="_blank" href="/feature-importance-to-predict-mushrooms-edibility-in-python-5aa133fea3f8">文章</a>中简要解释了它是如何工作的以及它做得最好。</p><p id="27b7" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">在以下代码部分中设置的超参数中，我认为最相关的是:</p><ul class=""><li id="b2c7" class="ne nf it lt b lu mz lx na ma ng me nh mi ni mm of nk nl nm bi translated"><code class="fe nn no np nq b">n_estimators</code>:XGBoost<strong class="lt iu">算法将尝试从训练数据中学习的学习轮数</strong></li><li id="d864" class="ne nf it lt b lu nr lx ns ma nt me nu mi nv mm of nk nl nm bi translated"><code class="fe nn no np nq b">max_depth</code>:一棵树可以拥有的<strong class="lt iu">最大深度</strong>，越深的树越容易造成过度拟合</li><li id="9956" class="ne nf it lt b lu nr lx ns ma nt me nu mi nv mm of nk nl nm bi translated"><code class="fe nn no np nq b">learning_rate</code>:或<strong class="lt iu">收缩因子</strong>，当创建新的树来纠正残差时，学习率(&lt; 1.0)“减慢”模型拟合数据的能力，因此随着树的数量增加而学习</li><li id="c622" class="ne nf it lt b lu nr lx ns ma nt me nu mi nv mm of nk nl nm bi translated"><code class="fe nn no np nq b">verbose</code>:模型在控制台上打印结果的频率，我们在这里设置100为<code class="fe nn no np nq b">n_estimators</code>相当高。默认值为1。</li></ul><pre class="kj kk kl km gt nw nq nx ny aw nz bi"><span id="e022" class="mn la it nq b gy oa ob l oc od">import xgboost as xgb<br/>from sklearn.metrics import mean_squared_error</span><span id="2869" class="mn la it nq b gy oe ob l oc od"><br/>reg = xgb.XGBRegressor(base_score=0.5, booster='gbtree',    <br/>                       n_estimators=1500,<br/>                       early_stopping_rounds=50,<br/>                       objective='reg:linear',<br/>                       max_depth=6,<br/>                       learning_rate=0.03, <br/>                       random_state = 48)</span><span id="d536" class="mn la it nq b gy oe ob l oc od">reg.fit(X_train, y_train,         <br/>        eval_set=[(X_train, y_train), (X_test, y_test)],<br/>        verbose=100)</span></pre><p id="6574" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">我们感兴趣的列是右边的一列，因为<strong class="lt iu"> RMSE </strong>值与测试集相关联，而左边的一列与训练集相关联。您可以清楚地看到<strong class="lt iu">均方根误差</strong>在每次迭代中快速下降，直到在600个估计器阈值后达到最小值。</p><pre class="kj kk kl km gt nw nq nx ny aw nz bi"><span id="8f3a" class="mn la it nq b gy oa ob l oc od">[0]    validation_0-rmse:32788.2     validation_1-rmse:30041.3<br/>[100]  validation_0-rmse:1909.16     validation_1-rmse:2153.27<br/>[200]  validation_0-rmse:902.714     validation_1-rmse:2118.83<br/>[300]  validation_0-rmse:833.652     validation_1-rmse:2061.93<br/>[400]  validation_0-rmse:789.513     validation_1-rmse:1952.1<br/>[500]  validation_0-rmse:761.867     validation_1-rmse:1928.96<br/>[600]  validation_0-rmse:737.458     validation_1-rmse:1920.88<br/>[700]  validation_0-rmse:712.632     validation_1-rmse:1921.39<br/>[800]  validation_0-rmse:694.613     validation_1-rmse:1920.75<br/>[900]  validation_0-rmse:676.772     validation_1-rmse:1917.38<br/>[1000] validation_0-rmse:662.595     validation_1-rmse:1920.73<br/>[1100] validation_0-rmse:647.64      validation_1-rmse:1925.71<br/>[1200] validation_0-rmse:634.896     validation_1-rmse:1927.89<br/>[1300] validation_0-rmse:620.82      validation_1-rmse:1932.68<br/>[1400] validation_0-rmse:609.903     validation_1-rmse:1937.36<br/>[1499] validation_0-rmse:599.637     validation_1-rmse:1935.59</span><span id="48af" class="mn la it nq b gy oe ob l oc od">XGBRegressor(early_stopping_rounds=50, learning_rate=0.03, max_depth=6,n_estimators=1500, random_state=48)</span></pre><p id="bc47" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">通过绘制出<strong class="lt iu">重要性</strong>每个<strong class="lt iu">特征</strong>在预测正确结果中的作用，我们可以清楚地注意到一些相关的模式。</p><pre class="kj kk kl km gt nw nq nx ny aw nz bi"><span id="7e60" class="mn la it nq b gy oa ob l oc od">fi = pd.DataFrame(data=reg.feature_importances_,<br/>             index=X_train.columns,<br/>             columns=['importance'])</span></pre><p id="1a8e" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">两个最重要的因素是特定测量的<strong class="lt iu"> 15天SMA </strong>和<strong class="lt iu">小时</strong>。不出所料，<strong class="lt iu">温度</strong>是<strong class="lt iu">预测能源消耗相对重要的唯一外部因素</strong>。正如预期的那样，初始数据集中的所有其他因素在项目的预测部分几乎不起作用，它们的重要性实际上是0。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/ceeaf9885bf2f23682fad00283684af0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XYf3o5vT_RZWgq3OHr5yfg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">特征重要性XGBoost回归器-按作者分类的图片</p></figure><p id="f32d" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">一旦我将它与初始数据集合并，我们最终可以看到模型的整体性能。</p><pre class="kj kk kl km gt nw nq nx ny aw nz bi"><span id="49dd" class="mn la it nq b gy oa ob l oc od">y_test = pd.DataFrame(y_test)<br/>y_test['prediction'] = reg.predict(X_test)<br/>df = df.merge(y_test[['prediction']], how='left', left_index=True, right_index=True)</span></pre><p id="8a16" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">总体而言，预测遵循了<strong class="lt iu">冷季</strong>的<strong class="lt iu">典型下降趋势</strong>，尽管该模型在识别11月和12月的峰值时有些困难。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/f4ff4db02e5e64d53cf69271ff475489.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3zuxDvNwlXqhHecKBgLEIQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">实际记录与预测的全面比较—作者提供的图片</p></figure><p id="1c07" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">如果我们放大到10月的前15天，我们可以清楚地看到预测与该月的测试数据有多接近。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/5ddcaee921aa6fc8156c9b44495469e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*97Q5xFWGRyQMwnlmJxPvNg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">10月15日的实际记录与预测对比——图片由作者提供</p></figure><p id="8ac9" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">但是在<strong class="lt iu">12月</strong>，峰值预测与实际记录<strong class="lt iu">相差很远</strong>。这可以在未来的模型中通过调整超参数或改进特征工程以及许多其他选项来改进。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/e9439d10cc2f12d839b8f039efa7b318.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uzO03SwPKEOUXBeDB7x7zw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">12月15天的实际记录与预测对比—作者图片</p></figure><p id="c3dd" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">准确性度量突出了回归器的良好但不优秀的性能。<strong class="lt iu"> R </strong>表示由回归模型解释的目标变量中观察到的可变性的百分比。在这种情况下，<strong class="lt iu"> 91% </strong>的观测数据可以用模型来解释，这是一个很好的结果。</p><p id="dc67" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">平均绝对误差<strong class="lt iu"/>(MAE)简单计算为绝对误差的平均值。分数告诉我们，模型从实际记录中平均偏离<strong class="lt iu"> 1354.63 KWs </strong>，这样不好吗？就电力支出而言，每10分钟提供大约比所需多(或少)1300千瓦的电力需要多少钱？下面是你如何评价它的好坏。</p><p id="7cf0" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated"><strong class="lt iu">均方误差</strong> (MSE)的计算类似于MAE，但它将平方与实际vs预测差相加。平均来说，我们的模型是好的，MAE告诉我们，但是MSE表明这个模型可能有很大的误差。事实上,<strong class="lt iu">平方差</strong>倾向于通过增加加权因子来放大模型所犯的更大错误。</p><p id="b15d" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">最后，<strong class="lt iu">均方根误差</strong> (RMSE)就是MSE的平方根。你会注意到3746515.40的平方根是1935.59。在这种情况下，RMSE比MSE有用得多。我们知道，1935年的<strong class="lt iu">比1354.63年的MAE略高</strong>，这表明我们的模型<strong class="lt iu">平均预测得很好</strong>，但在具体记录上往往“<strong class="lt iu">错误</strong>”得有点多，实际值与预测值相差太远。</p><p id="96b0" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">理想的情况是让MAE、MSE和RMSE<strong class="lt iu">尽可能接近0</strong>，但不是精确的0，我们仍然希望避免过度拟合。</p><pre class="kj kk kl km gt nw nq nx ny aw nz bi"><span id="8fe8" class="mn la it nq b gy oa ob l oc od">r2:                      0.9101<br/>MAE:                  1354.6314<br/>MSE:               3746515.4004<br/>RMSE:                 1935.5917</span></pre><h1 id="74d7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="00d9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我希望你喜欢这个项目，并希望它对你需要做的任何时间序列分析都有用！</p><p id="da80" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated"><strong class="lt iu">超参数调整</strong>和<strong class="lt iu">特征工程</strong>是未来项目的两个主要改进领域。除此之外，部署一个<strong class="lt iu">简单回归器</strong>并因此将准确度分数与基准进行比较通常是一个很好的实践。</p><p id="a9cd" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated"><strong class="lt iu">未来任务</strong>包括收集2018年途安电力消耗的实际数据，并预测这些记录。</p><p id="ff77" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">如果你想更深入地挖掘代码，这里有一个<a class="ae ky" href="https://www.kaggle.com/code/gvaldata/time-series-forecasting-on-power-consumption-z1" rel="noopener ugc nofollow" target="_blank">链接</a>到一个Kaggle笔记本，上面有该项目的从头到尾的版本。为这个伟大的建议大声喊出来！</p></div><div class="ab cl ol om hx on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="im in io ip iq"><p id="2af3" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated"><em class="os">最后一点，如果您喜欢该内容，请考虑添加一个关注，以便在新文章发布时得到通知。如果你对这篇文章有什么要考虑的，写在评论里吧！我很想读读它们:)谢谢你的阅读！</em></p><p id="c80a" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated"><em class="os"> PS:如果你喜欢我写的东西，如果你能通过</em> <a class="ae ky" href="https://giovanni-valdata.medium.com/membership" rel="noopener"> <em class="os">这个链接</em> </a> <em class="os">订阅一个中等会员，那对我来说就是全世界。有了会员资格，你就获得了媒体文章提供的惊人价值，这是支持我的内容的一种间接方式！</em></p></div><div class="ab cl ol om hx on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="im in io ip iq"><p id="fd1f" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">[1] (2019).摩洛哥——能源。2022年9月25日检索，来自国际贸易管理局www.trade.gov网站:<a class="ae ky" href="https://www.trade.gov/country-commercial-guides/morocco-energy#:~:text=Per%20the%20state%2Downed%20power,%2C%20others%20(2%20percent)." rel="noopener ugc nofollow" target="_blank">https://www . Trade . gov/country-commercial-guides/Morocco-energy #:~:text = Per % 20 the % 20 state % 2d owned % 20 power，%2C%20others%20(2%20percent)。</a></p><p id="5c0d" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">[2] Salam，a .，&amp; El Hibaoui，A. (2018年12月)。http://archive.ics.uci.edu/ml的UCI机器学习知识库。加州欧文:加州大学信息与计算机科学学院。‌</p><p id="4f88" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">[3]萨拉姆，a .，&amp;埃尔希巴乌伊，A. (2018年12月)。电力消耗预测的机器学习算法比较:铁头市案例研究。在<em class="os"> 2018第六届国际可再生与可持续能源大会(IRSEC) </em>(第1–5页)。IEEE。</p><p id="5d71" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">[4] robikscube。(2022年7月5日)。用机器学习进行时间序列预测。2022年9月29日检索，来自kaggle.com网站:<a class="ae ky" href="https://www.kaggle.com/code/robikscube/time-series-forecasting-with-machine-learning-yt" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/code/robikscube/time-series-forecasting-with-machine-learning-yt</a></p></div></div>    
</body>
</html>