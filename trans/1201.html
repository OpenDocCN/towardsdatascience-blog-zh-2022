<html>
<head>
<title>Is your ML model stable? Checking model stability and population drift with PSI and CSI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你的 ML 模型稳定吗？用 PSI 和 CSI 检查模型稳定性和总体漂移</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/checking-model-stability-and-population-shift-with-psi-and-csi-6d12af008783#2022-03-28">https://towardsdatascience.com/checking-model-stability-and-population-shift-with-psi-and-csi-6d12af008783#2022-03-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f9fb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何确保你的机器学习模型仍然像训练的那样运行</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/029eb0d1af102fc48f98e1726981bbaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rOlBWzbdiGSlLzobmnSllg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由 Unsplash 上的 Aziz achar ki 原创</p></figure><p id="6baf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们建立的机器学习模型基于一个简单的前提:我们将在推理时间使用的数据应该与训练时使用的数据具有相同的分布。</p><p id="a5f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个前提很简单，但相当有力，因为它意味着我们可以根据以前已知的观察结果来推断新的观察结果。</p><p id="00f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，有时一些现实生活中的影响会导致观察结果发生变化。一个例子是新冠肺炎疫情。在病毒传播之前训练出来的金融模型，在疫情之后可能不太适用。家庭收入可能会减少，甚至那些没有减少的家庭在花钱前也可能会三思。</p><p id="9946" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些影响可能是无声的，为了避免它们，我们需要评估模型的稳定性，或者换句话说，在现实生活场景发生变化后，模型是否仍然有效。</p><p id="964c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将向您展示两个可以做到这一点的指标，群体稳定性指数(PSI)和特征稳定性指数(CSI)。</p><h1 id="2568" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">模型稳定性</h1><p id="4541" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在动态系统分析中，我们可以把一个稳定的系统定义为在存在扰动的情况下保持不变(或只有微小变化)的系统。简单地说，一个稳定的系统对外部变化是稳健的。</p><p id="74a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">测量模型稳定性的一种方法是检查总体或数据漂移，评估总体或特征在模型环境中的变化情况。</p><p id="b8f8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">人口流动有几个可能的来源。一些例子可以包括</p><ul class=""><li id="cfd0" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">社会经济关系的变化，如通货膨胀、疾病或政治变化；</li><li id="ed86" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">无法解释的事件，比如假期、世界杯，甚至是自然灾害；</li><li id="f69e" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">新的竞争对手进入市场，和/或客户转移；</li><li id="656d" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">所提供产品或营销活动的变化。</li></ul><p id="2969" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据和人口漂移的一个较少被评论的来源是模型本身的使用。如果您开发了一个模型来解决一个业务问题，并且这个解决方案是有效的，那么环境就变了，这个模型可能不会有同样的性能！</p><p id="7743" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在下面的章节中，我将展示如何在机器学习模型的稳定性的背景下计算 PSI 和 CSI。所有代码和示例都可以在我的 GitHub 资源库中找到:</p><div class="nd ne gp gr nf ng"><a href="https://github.com/vinyluis/Articles/tree/main/Model%20Stability" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">主要乙烯基/物品的物品/模型稳定性</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">文章:用 PSI 和 CSI [EN]检查模型稳定性和人口转移展示了如何使用 PSI(人口稳定性…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">github.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu kp ng"/></div></div></a></div><h1 id="55a8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">人口稳定指数</h1><p id="5a07" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">人口稳定指数(PSI)，顾名思义，是衡量人口在两个不同的时刻发生了多大的变化。</p><p id="1dfa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的目标是根据模型的预测(独立)变量来看人口分布如何变化。如果是回归模型，可以直接用预测值，但是如果是二元分类模型，就需要用概率(scikit-learn 上有<code class="fe nv nw nx ny b">.predict_proba()</code>)。</p><p id="5f8f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们通过将预测变量的范围分割成相同大小的部分来创建测试数据的箱。箱的数量是任意的，但是通常使用 10 个。</p><p id="0525" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们将每个箱内的人口百分比与“新”生产数据进行比较。绘制这些箱，我们可以直观地比较它们:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/c4c693696b05f24c75927cc4b4b2ceeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*VSX_5Wsm_hUKqXwypH_PgA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="425a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">很明显，新增人口已经漂移。最初的分布更窄，平均值更接近于 4，因为新的分布平均值接近于 6，分布更广。</p><p id="9712" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们使用下面的公式计算每个箱的 PSI:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/cadeb6f0398f020651d80a659b6d01f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*nhVqI5AJC-DeTCoP4XvraQ.png"/></div></div></figure><p id="b211" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果如下表所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/1045957242846a067d86c83ff4bb06fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/0*xdkcpmdk_NvfW88U"/></div></figure><p id="755d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们愿意，我们可以将平均 PSI 作为整个模型的单一指标。在这种情况下，模型的 PSI 为 0.1435。</p><p id="fd9d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通常，我们认为:</p><ul class=""><li id="3614" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">PSI &lt; 0.1 = The population hasn’t changed, and we can keep the model</li><li id="a27c" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">0.1 ≤ PS1 &lt; 0.2 = The population has slightly changed, and it is advisable to evaluate the impacts of these changes</li><li id="735c" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">PSI ≥ 0.2 = The changes in population are significant, and the model should be retrained or even redesigned.</li></ul><p id="4e14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">In our example, the change was significant, but not so much that needs immediate action. We still should dive deeper into the causes and we can do it with CSI.</p><p id="d3ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">But first, remember that we created bins of our data with fixed-size ranges? Another way to calculate PSI would be by using quantile bins. In this scenario, by using 10 bins we assure that each bin will have 10% of the initial population, and we compare with the new population:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/d29acfb1f188f0b3b5e92bb636f8cfc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*1eeOTIzRld6-0rEkcsPkzA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Image by author</p></figure><p id="16e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">The process here is pretty much the same, but the results can be slightly different:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/2e745063e9284b3db3948673481d5a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/0*tVzEVu2My40G5ZEy"/></div></figure><p id="3cb3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">The average PSI in this scenario is 0.1087, which is still in the “warning” zone, but much closer to the 0.1000 value of the “safe” zone.</p><p id="e644" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">If you have the time and resources, it is advisable to calculate PSI both ways.</p><p id="e787" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">If you are looking for the Python code to calculate PSI, please check out my <a class="ae kv" href="https://github.com/vinyluis/Articles/tree/main/Model%20Stability" rel="noopener ugc nofollow" target="_blank"> GitHub </a>，功能如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od oe l"/></div></figure><h1 id="d50b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">特征稳定性指数</h1><p id="d75e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在前面的例子中，我们模型的 PSI 在 0.1 到 0.2 之间的“警告”区域。我们现在需要了解哪些特征可能导致了漂移。输入 CSI。</p><p id="89b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">特征稳定性指数(CSI)用于评估每个特征的稳定性或漂移，以便我们可以找到有问题的特征。由于 PSI 关注的是人口漂移对模型预测的影响，因此 CSI 关注的是了解要素分布是如何变化的。</p><p id="69a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用它非常简单:我们只需应用与 PSI 相同的公式，但不是通过使用预测变量来宁滨数据，而是使用每个特征来创建条块:</p><pre class="kg kh ki kj gt of ny og oh aw oi bi"><span id="53d6" class="oj lt iq ny b gy ok ol l om on"># Fixed<br/>print("CSI - Fixed-size bins")<br/>for col in sample_initial.columns:<br/>    csi_values = psi(sample_initial[col].values, sample_new[col].values, mode = 'fixed')<br/>    csi = np.mean(csi_values)<br/>    print(f'{col} -&gt; {csi=:.4f}')</span><span id="67d6" class="oj lt iq ny b gy oo ol l om on"># Quantile<br/>print("\\nCSI - Quantile bins")<br/>for col in sample_initial.columns:<br/>    csi_values = psi(sample_initial[col].values, sample_new[col].values, mode = 'quantile')<br/>    csi = np.mean(csi_values)<br/>    print(f'{col} -&gt; {csi=:.4f}')</span></pre><p id="78d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本例中，结果是:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi op"><img src="../Images/829e9db772e1f07924617be76932af75.png" data-original-src="https://miro.medium.com/v2/resize:fit:344/format:webp/1*DenPG6kml7_3oAGBXj4AIw.png"/></div></figure><p id="8871" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以 x1 几乎没有变化，x2 略有变化但仍在“安全区”上，而 x3 变化显著，很可能是造成种群漂移的特征。</p><h1 id="b0c4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="3f0b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">数据科学课程通常不涉及模型稳定性，但在处理生产模型时，模型稳定性确实非常重要。我希望这篇文章能帮助你理解它，并应用到你的管道中。</p><p id="9379" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另外，请参考我的 GitHub 存储库，查看一个回归和一个分类示例:</p><div class="nd ne gp gr nf ng"><a href="https://github.com/vinyluis/Articles/tree/main/Model%20Stability" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">主要乙烯基/物品的物品/模型稳定性</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">文章:用 PSI 和 CSI [EN]检查模型稳定性和人口转移展示了如何使用 PSI(人口稳定性…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">github.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu kp ng"/></div></div></a></div><h1 id="add2" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">如果你喜欢这个帖子…</h1><p id="823e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">支持我一杯咖啡！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://www.buymeacoffee.com/vinitrevisan"><div class="gh gi oq"><img src="../Images/acf4154cfebdc13859934db49fd502cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*h_y4o6IwDDFFWIyKQE7Rww.png"/></div></a><p class="kr ks gj gh gi kt ku bd b be z dk translated">给我买杯咖啡！</p></figure><p id="cf7c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看看这个很棒的帖子</p><div class="nd ne gp gr nf ng"><a rel="noopener follow" target="_blank" href="/evaluating-the-potential-return-of-a-model-with-lift-gain-and-decile-analysis-319f00fde5b6"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">用提升、增益和十分位数分析评估模型的潜在回报</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">使用这三个工具来理解你的机器学习模型的有用性</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">towardsdatascience.com</p></div></div><div class="np l"><div class="or l nr ns nt np nu kp ng"/></div></div></a></div><h1 id="272d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">参考</h1><p id="bc76" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">[1] Yurdakul，b .种群稳定性指数的统计性质。<a class="ae kv" href="https://scholarworks.wmich.edu/cgi/viewcontent.cgi?article=4249&amp;context=dissertations" rel="noopener ugc nofollow" target="_blank">https://scholarworks.wmich.edu/cgi/viewcontent.cgi?article = 4249&amp;context =学位论文</a></p><p id="7765" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[2]伯克，m .人口稳定指数。【https://mwburke.github.io/data 科学/2018/04/29/人口-稳定-指数. html </p></div></div>    
</body>
</html>