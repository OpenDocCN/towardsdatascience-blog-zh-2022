<html>
<head>
<title>A new application of structural entropy for multivariate time series anomaly detection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">结构熵在多元时间序列异常检测中的新应用</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-new-application-of-structural-entropy-for-multivariate-time-series-anomaly-detection-1ea890bfef86#2022-10-14">https://towardsdatascience.com/a-new-application-of-structural-entropy-for-multivariate-time-series-anomaly-detection-1ea890bfef86#2022-10-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9443" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何快速找到多个信号中缺失或不变数据的出现</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f8508d738f844936597f74a46d4fca5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*owJZHoILzNMFw7Wzf9dXTg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由来自<a class="ae ky" href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=5598725" rel="noopener ugc nofollow" target="_blank">皮克斯拜</a>的<a class="ae ky" href="https://pixabay.com/users/strodestudios-18441643/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=5598725" rel="noopener ugc nofollow" target="_blank">安娜·斯帕拉维克</a>拍摄</p></figure><p id="7a3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我喜欢时间序列。在这篇文章中，我将继续探索多变量时间序列，并介绍一种检测特殊异常的新方法。同样，我仍然使用熵，一个简单而强大的工具。</p><p id="1058" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然这取决于应用程序，但我们通常可以假设我们希望我们的时间序列是<strong class="lb iu">连续且变化的</strong>，没有任何缺失值。但是由于设备错误、不正确的测量以及数据收集和存储问题，现实世界中的异常情况可能会出现。</p><p id="640e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种异常的一个结果是特定时期的数据值丢失。另一种情况是用指示错误的唯一值替换数据，或者用先前的值填充数据。简而言之，对于那些异常时段，信号变得<strong class="lb iu">缺失或恒定</strong>。</p><p id="9208" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以用移动窗口扫描时间序列来识别这些异常。实现很简单。多时间序列呢？我们需要单独监控每个时间序列吗？</p><p id="e5db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将给出一个简单的解决方案，将这个问题作为多变量时间序列的异常检测问题。它不会关注单个时间序列，但如果任何时间序列丢失或不变，它仍然可以捕捉异常。</p><p id="06d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将跳过结构熵的介绍及其在<strong class="lb iu">检测相关性变化引起的异常</strong>中的应用。如果概念对你来说是新的，请参考我的帖子，<a class="ae ky" rel="noopener" target="_blank" href="/anomaly-detection-for-multivariate-time-series-with-structural-entropy-63f9c34cb67?source=your_stories_page-------------------------------------">用结构熵对多元时间序列进行异常检测</a>。</p><h2 id="834e" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">生成合成数据集</h2><p id="e8d3" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">这次用合成数据吧。首先，生成六个时间序列。三个由高斯过程生成(x0，x1，x2)。两个是通过随机游走产生的(x3和x4)，一个是通过ARMA模型产生的(x5)。它们是独立的，不相关的。我将在下面的参考资料部分分享我的笔记本的链接。图1显示了结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/e6402abac7aef6dfa1ba9fefce470321.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sWTQmo8QFi-JWShLBFetnQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">情节一。合成时间序列(图片由作者提供)</p></figure><p id="c579" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们添加一些异常部分。正如您在图2中看到的，有三种类型的异常:不相关变为相关，数据值缺失，数据值变为常数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/15355d140c788f9b18dc21b038906d8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kCHBzFnzvxW5xgEqM9kQ7w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">情节二。6个具有五个异常截面的时间序列(图片由作者提供)</p></figure><h2 id="9f57" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">相关矩阵的一个技巧</h2><p id="7b07" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">计算结构熵依赖于滚动窗口中相关矩阵的结果。相关矩阵包含每个组合的皮尔逊相关系数。假设一个变量全部缺失或不变；当与其他变量结合时，皮尔逊相关系数是多少？</p><p id="40bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们认为皮尔逊相关系数是由个体方差标准化的协方差(等式1)。如果一个变量没有有效值，它的方差就不存在。如果一个变量是常数，那么它的方差是0。对于这两种情况，等式1的分母将变为Na或0，因此根据定义，皮尔逊相关系数<strong class="lb iu">将不可用。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a09c11fd9e4edbb7e5317b142f2e1717.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zJWGsVKJyqWlmvT31R9PUA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">等式1(图片由作者提供)</p></figure><p id="5074" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是整个绿色异常部分的相关矩阵(x2缺失)。由于x2的值缺失，您可以看到x2涉及的所有相关系数的NaN。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/ea1b37839ed22d3cbc6d379edce522b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*WhRhyk-JvSttckls-xQKDA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3相关矩阵(图片由作者提供)</p></figure><p id="5bf2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们对矩阵使用一个技巧。如果我们<strong class="lb iu">用1替换NaN，那么x2将与其他变量100%相关，并通过连接</strong>将它们连接起来形成单个集群。一个组的熵是多少？零。</p><h2 id="c936" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">熵的魔力</h2><p id="fdc1" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">曲线4示出了在应用相关矩阵计算技巧之后的结构熵，该技巧简单地是用1 代替所有的Na<strong class="lb iu">。异常部分1(橙色，在指数200到300附近)的熵下降，因为新构建的相关性，这是预期的。由于缺失数据或恒定数据，异常部分2和3(绿色和红色)的熵下降到零。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/79aaab8054997f99254aac548956aa51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*csLzmCZFiqR61e2kKKOP0A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4结构熵(图片由作者提供)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/1e9bae0530f572e2e69d2dd80c3a95bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KM5O6pcNVTDPEGfOM2OZJA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">情节5(作者图片)</p></figure><p id="1863" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以将所有信息一起呈现在图5中。请注意，熵变成了右边的第二个y轴。您可能会注意到，最后两个异常区域(棕色和紫色)的熵没有变化。原因是观察或检测窗口的大小。该窗口设置有50个数据点。最后两个异常区的长度小于50。这意味着在那些异常区域中，任何50的滚动窗口大小都有有效值，因此相关矩阵中没有Na，最后，熵不会变为零。</p><h2 id="4278" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">结论</h2><p id="488e" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">正如在<a class="ae ky" rel="noopener" target="_blank" href="/anomaly-detection-for-multivariate-time-series-with-structural-entropy-63f9c34cb67">试验数据和股票市场例子</a>中看到的，结构熵比识别相关性变化提供了更多的好处。一个应用可能是<strong class="lb iu">监控实时信号</strong>。我们可以将许多时间序列组合在一起，并计算它们的熵。它不仅可以捕捉相关漂移和异常，还可以捕捉组中任何时间序列的缺失值或常数值。我们不需要监控每个人。</p><p id="df79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以将结构熵应用于多元<strong class="lb iu">时间序列分段</strong>，就像根据熵值将时间维度分割成段一样。</p><p id="e356" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种方法的缺点是，它不会明确地告诉我们哪些信号导致了异常熵值<strong class="lb iu"/>。我们可能需要做更多的探索。我想这是一个公平的交易。我们现在可以看到几个甚至几百个时间序列的总体状况；作为交换，我们模糊了对个人的关注。我们还需要仔细选择适合数据和业务需求的窗口大小。</p><p id="ca9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。</p><p id="c3c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">享受你的时间序列数据吧！</p><h2 id="5e45" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">参考</h2><p id="8e92" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated"><a class="ae ky" href="https://github.com/ningja1/blog_notebooks/blob/main/anomaly_missing_constant/anomaly_missing_constant.ipynb" rel="noopener ugc nofollow" target="_blank">GitHub上的笔记本</a></p><p id="f744" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/anomaly-detection-for-multivariate-time-series-with-structural-entropy-63f9c34cb67?source=your_stories_page-------------------------------------">基于结构熵的多元时间序列异常检测</a></p></div></div>    
</body>
</html>