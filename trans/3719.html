<html>
<head>
<title>Monte Carlo Simulation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">蒙特 卡罗模拟</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/monte-carlo-simulation-8db846f3d8ed#2022-08-18">https://towardsdatascience.com/monte-carlo-simulation-8db846f3d8ed#2022-08-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="50ae" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><strong class="ak">第二部分:风险分析</strong></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a7ef925202b290ebaedd4f3267fb8e15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rHNOP5zPCzpLSR2G"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@meric?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">梅里达勒</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="ba20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本系列的<a class="ae ky" rel="noopener" target="_blank" href="/monte-carlo-simulation-2b24fc810683">上一篇文章</a>中，我们将<strong class="lb iu">蒙特卡罗模拟</strong> (MCS)定义为“一个抽样实验，其目的是估计取决于一个或多个随机输入变量的感兴趣的量的分布”。我们为研究中的问题建立一个数学模型，并通过重复采样来估计其结果。该方法提供了模拟结果的分布，从中可以很容易地获得图表和汇总统计数据。</p><p id="e9a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，<strong class="lb iu">风险</strong>被定义为不良结果发生的概率。<strong class="lb iu">定量风险分析</strong>是用数字资源估计任何项目风险的数值程序。</p><p id="a27b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，如果蒙特卡洛模拟提供了一系列可能的结果及其相应的概率，我们就可以用它来量化决策中的风险。</p><p id="6bc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将举例说明蒙特卡罗模拟来说明投资项目中的风险。</p><h1 id="4b7a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">投资项目的风险分析</strong></h1><p id="f1a8" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">大型投资项目、股票投资组合的回报、规划建设时间表以及类似项目都是必须进行风险分析的典型情况。我们必须能够回答这样的问题:成本超过收益的可能性有多大？我们遭受财务损失的可能性有多大？这个项目按时完成的可能性有多大？在我们投资第一美元之前，我们应该对这些问题进行评估。</p><p id="8656" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们假设实施一个重要投资项目的决定权在我们手中。该项目有六个成本组成部分:国际贸易商品、当地贸易商品、劳动力、设备和机械、土地征用、税收和财务成本。这些组成部分的总和就是项目的最终成本。</p><p id="ea67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的首要任务是获得每项成本的<strong class="lb iu">最可能值</strong>的估计值。表1显示了每个成本组成部分最可能的值。相应的总成本为54.56百万美元</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/f53f6f4870a5ff6b7dab559644e4e88c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*5T1-YIcyxAGwwPfwPxIGdw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">表1:最可能的值</p></figure><p id="3dcc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，如果我们完全确定成本计算的准确性，剩下的唯一任务就是将六个组成部分相加以显示最终成本。但当项目达到一定规模时，这种情况在实践中很少出现。在一个真实的项目中，每一个组成部分都会表现出一定程度的随机性，<strong class="lb iu">我们必须进行风险分析</strong> <strong class="lb iu">来量化不良结果的概率。</strong></p><p id="9944" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在缺乏严格数据的情况下，习惯上使用<strong class="lb iu">三角分布</strong>作为未知输入分布<strong class="lb iu">的粗略近似值。</strong>三角分布只取决于三个参数:最小值(a)、最大可能性和最大值(b)。这种分布简单、灵活，并且可以呈现各种形状。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/1658a6f7bf7addf6adc68a6df30f187f.png" data-original-src="https://miro.medium.com/v2/resize:fit:676/format:webp/1*qSIdeRGbyfeoppxTf4QnEA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">三角形分布的参数和公式，来源:维基百科[1]</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/f7613d2ad559976740ba2eb568269705.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*A8cOpuWFjlV1eiy6eS0h6g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">三角形分布的PDF和CDF图表，来源:维基百科[1]</p></figure><p id="0e9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">表2显示了每个成本构成的参数值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/232c790481ab3e3159e0a9900b90f232.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*iZr_OXrpi_QAEPhg7sCyLw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">表2:每个组件的参数</p></figure><h1 id="fd6a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">MCS的Python代码</strong></h1><p id="0791" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">以下Python代码允许我们开发一个带有统计摘要和频率直方图的MCS:</p><p id="ca32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们将Numpy库作为<em class="mv"> np </em>导入，将Scipy用于一些统计计算，将Matplotlib和PrettyTable用于最终输出。</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="1d51" class="nb lw it mx b gy nc nd l ne nf"><a class="ae ky" href="http://twitter.com/author" rel="noopener ugc nofollow" target="_blank">@author</a>: darwt<br/>"""</span><span id="fc2f" class="nb lw it mx b gy ng nd l ne nf"># Import Modules</span><span id="35a7" class="nb lw it mx b gy ng nd l ne nf">import numpy  as np</span><span id="367b" class="nb lw it mx b gy ng nd l ne nf">from scipy import stats<br/>from scipy.stats import sem<br/>from scipy.stats import percentileofscore</span><span id="78b0" class="nb lw it mx b gy ng nd l ne nf">import matplotlib.pyplot as plt<br/>from prettytable import PrettyTable<br/>  <br/>your_path = your path </span></pre><p id="c80a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下三个列表描述了三角形分布的参数:</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="9be1" class="nb lw it mx b gy nc nd l ne nf">minimum   = [13.80, 4.80, 4.14, 15.00, 3.29, 1.44]<br/>most_like = [16.25, 5.33, 6.44, 19.23, 4.43, 2.88]<br/>maximum   = [17.20, 7.20, 7.45, 22.50, 6.97, 4.32]</span><span id="02c7" class="nb lw it mx b gy ng nd l ne nf">Sum_most_like = sum(most_like)<br/> <br/>Number_of_Component_Costs = 6</span></pre><p id="589a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了用MCS获得有效的结果，我们需要进行大量的重复。我们还定义了置信区间(CI)的置信水平。</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="fe96" class="nb lw it mx b gy nc nd l ne nf">Number_of_Replications = 3000</span><span id="6c7e" class="nb lw it mx b gy ng nd l ne nf">confidence = 0.95</span></pre><p id="bb35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">MCS背后的逻辑在以下代码行中描述:</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="6c3a" class="nb lw it mx b gy nc nd l ne nf">list_of_costs = []<br/>for run in range(Number_of_Replications):<br/>    acum_cost = 0<br/>    for i in range(Number_of_Component_Costs):<br/>        cost = np.random.triangular(minimum[i], <br/>                                    most_like[i],  maximum[i], 1)<br/>        acum_cost +=cost<br/>        <br/>    Total_Cost = round(float(acum_cost),1)<br/>    <br/>    list_of_costs.append(Total_Cost)</span></pre><p id="a501" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用Numpy和Scipy获得关键描述性统计指标的汇总，特别是一个<em class="mv">百分位表。</em></p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="50c6" class="nb lw it mx b gy nc nd l ne nf">media = round(np.mean(list_of_costs),2)<br/>stand = round(np.std(list_of_costs),2)<br/>var   = round(np.var(list_of_costs),2) <br/>std_error = round(sem(list_of_costs),2)</span><span id="5ef5" class="nb lw it mx b gy ng nd l ne nf">median = round(np.median(list_of_costs),2)<br/>skew   = round(stats.skew(list_of_costs),2)<br/>kurt   = round(stats.kurtosis(list_of_costs),2)</span><span id="313d" class="nb lw it mx b gy ng nd l ne nf">dof  = Number_of_Replications - 1    <br/>t_crit = np.abs(stats.t.ppf((1-confidence)/2,dof))</span><span id="1ef9" class="nb lw it mx b gy ng nd l ne nf">half_width =  round(stand *t_crit/np.sqrt(Number_of_Replications),2)  <br/>inf = media - half_width<br/>sup = media + half_width  <br/>                      <br/>inf = round(float(inf),2)<br/>sup = round(float(sup),2)</span><span id="319a" class="nb lw it mx b gy ng nd l ne nf">t = PrettyTable(['Statistic', 'Value'])<br/>t.add_row(['Trials', Number_of_Replications])<br/>t.add_row(['Mean', media])<br/>t.add_row(['Median', median])<br/>t.add_row(['Variance', var])<br/>t.add_row(['Stand Dev', stand])<br/>t.add_row(['Skewness', skew])<br/>t.add_row(['Kurtosis', kurt])<br/>t.add_row(['Half Width', half_width])<br/>t.add_row(['CI inf', inf])<br/>t.add_row(['CI sup', sup])<br/>print(t)</span><span id="edbb" class="nb lw it mx b gy ng nd l ne nf">percents = np.percentile(list_of_costs,[10, 20, 30, 40, 50, <br/>                                        60, 70, 80, 90, 100])</span><span id="ceeb" class="nb lw it mx b gy ng nd l ne nf">p = PrettyTable(['Percentile (%)', 'Cost'])<br/>p.add_row(['  10  ', percents[0]])<br/>p.add_row(['  20  ', percents[1]])<br/>p.add_row(['  30  ', percents[2]])<br/>p.add_row(['  40  ', percents[3]])<br/>p.add_row(['  50  ', percents[4]])<br/>p.add_row(['  60  ', percents[5]])<br/>p.add_row(['  70  ', percents[6]])<br/>p.add_row(['  80  ', percents[7]])<br/>p.add_row(['  90  ', percents[8]])<br/>p.add_row([' 100  ', percents[9]])<br/>print(p)</span></pre><p id="01f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们绘制了两个图表:结果变量(<em class="mv">总成本</em>)的直方图，包括一条指示媒体的绿色垂直线，以及另一条指示最可能值的垂直线(红色)。第二个图表是累积直方图，显示了最终成本低于最可能值的概率。</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="a8e5" class="nb lw it mx b gy nc nd l ne nf">percentile_of_most_like = round(percentileofscore(list_of_costs, Sum_most_like),2)</span><span id="1e31" class="nb lw it mx b gy ng nd l ne nf">n_bins = 20</span><span id="9d90" class="nb lw it mx b gy ng nd l ne nf">fig, ax = plt.subplots(figsize=(8, 6))<br/>ax.hist(list_of_costs,  histtype ='bar', bins=20, color = 'c',<br/>        edgecolor='k', alpha=0.65,<br/>        density = True)  # density=False show counts</span><span id="a272" class="nb lw it mx b gy ng nd l ne nf">ax.axvline(media, color='g', linestyle='dashed', linewidth=3)<br/>ax.axvline(Sum_most_like, color='r', <br/>           linestyle='dashed', linewidth=3)<br/>ax.text(48,0.185, 'Mean - - -', color = 'green'  )<br/>ax.text(48,0.155, 'Most Like - - -', color = 'red'  )</span><span id="e85c" class="nb lw it mx b gy ng nd l ne nf">ax.set_title('Frequency Chart')<br/>ax.set_ylabel('Probability')<br/>ax.set_xlabel('Total Cost (MM*1000 U$S)')<br/>ax.grid(axis = 'y')</span><span id="7048" class="nb lw it mx b gy ng nd l ne nf">plt.show()</span><span id="0d20" class="nb lw it mx b gy ng nd l ne nf">fig, ax = plt.subplots(figsize=(8, 6))<br/>n, bins, patches = ax.hist(list_of_costs, n_bins,<br/>                           density=True, histtype='bar',<br/>                           cumulative=True, edgecolor='k',<br/>                           alpha = 0.65)<br/>ax.hlines(percentile_of_most_like/100, 46, Sum_most_like, <br/>          color='r', linestyle='dashed', linewidth=2)<br/>ax.text(46 + 0.1, percentile_of_most_like/100 + 0.1, <br/>        'Cumulative Probability:' + str(percentile_of_most_like) +'%',rotation=360)</span><span id="3ef9" class="nb lw it mx b gy ng nd l ne nf">ax.set_title('Cumulative Histogram')<br/>ax.set_ylabel('Cumulative Probability')<br/>ax.set_xlabel('Total Cost (MM*1000 U$S)')<br/>ax.grid(axis = 'y')</span><span id="e0a5" class="nb lw it mx b gy ng nd l ne nf">plt.show()</span></pre><h1 id="5d47" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">分析</strong></h1><p id="89b4" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们进行了3000次复制，将每次复制的总成本附加到一个列表中(<em class="mv">list _ of _ costs . append(Total _ Cost</em>)。然后，我们计算了关键的描述性统计指标:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/fbac4aea474d2dfed3bb033460b9e8a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:396/format:webp/1*o4LOM9J5Peet3FC5Zlj7HA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">表3:统计报告</p></figure><p id="8301" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">表3显示，平均值和中值实际上具有相同的值，半宽度区间几乎可以忽略不计，并且分布具有零偏斜度和几乎为零峰度。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/68fd680f513ef02cce3fd88390ae9ae8.png" data-original-src="https://miro.medium.com/v2/resize:fit:446/format:webp/1*O74aINQlj6DEdTnuMKRi5g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">表4:百分位报告</p></figure><p id="44ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">表4显示了百分比报告。我们认为总成本低于5300万美元的可能性等于或小于30%。</p><p id="bdf6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">图1显示了我们的结果的分布(<em class="mv">总成本</em>)作为一个有20个箱的直方图。平均成本和最可能成本分别用绿色和红色垂直线表示。请记住，直方图提供了数据集分布的可视化表示:数据的位置、分布、偏斜度和峰度。显然，分布的外观与统计报告中指示的值相匹配。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/c6becef1ba81e5c3f4ceb5804fd463f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*c8UUz0E4pp1UwmrErsSPEw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1:作者用Matplotlib做的频率表</p></figure><p id="0086" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">涉及风险的问题可以用累积直方图</strong>来回答(图2)。红色水平线对应最可能值的百分位数。超出我们预测成本的概率为44.1%(100–55.9)。现在，<strong class="lb iu">我们可以用数字来评估与我们投资项目相关的风险。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/c9469ddc0d1d5786e75563c634f297e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*aJHBi07G6Au8BoFEuOFZ-A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2:作者用Matplotlib制作的累积直方图</p></figure><p id="61a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果开发得当，蒙特卡罗模拟是一种相对简单的数值技术，可以对极具挑战性的项目进行风险分析。</p><p id="4da1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不要忘记给作者小费，尤其是当你把这篇文章添加到列表中的时候。</p><h1 id="3c7f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">参考</h1><p id="79c8" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">[1]:<a class="ae ky" href="https://en.wikipedia.org/wiki/Triangular_distribution" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Triangular_distribution</a></p></div></div>    
</body>
</html>