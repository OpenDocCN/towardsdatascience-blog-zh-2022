<html>
<head>
<title>Mean vs Median Causal Effect</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">平均因果效应与中位数因果效应</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/mean-vs-median-causal-effect-37057a6c54c9#2022-10-10">https://towardsdatascience.com/mean-vs-median-causal-effect-37057a6c54c9#2022-10-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="37f6" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/causal-data-science" rel="noopener" target="_blank">因果数据科学</a></h2><div class=""/><div class=""><h2 id="4250" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated"><em class="ko">介绍A/B测试中的分位数回归</em></h2></div><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/7144ed912ea93a77a3d53f09aba636a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4DNKnDEI9Ly_dZiLDjr94w.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">封面图片，由作者使用<a class="ae lf" href="https://creator.nightcafe.studio/" rel="noopener ugc nofollow" target="_blank">nightcafe</a>生成</p></figure><p id="7650" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">在A/B测试中，也称为<a class="ae lf" href="https://en.wikipedia.org/wiki/Randomized_controlled_trial" rel="noopener ugc nofollow" target="_blank">随机对照试验</a>，我们通常估计<strong class="li ja">平均治疗效果(ATE) </strong>:治疗(药物、广告、产品……)对感兴趣的结果(疾病、公司收入、客户满意度……)的影响，其中“平均值”取自测试对象(患者、用户、客户……)。ATE是一个非常有用的量，因为它告诉我们，如果我们用同样的方法治疗一个新的受试者，我们可以预期的效果。</p><p id="ea2d" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">然而，有时我们可能对不同于平均值的数量感兴趣，例如<a class="ae lf" href="https://en.wikipedia.org/wiki/Median" rel="noopener ugc nofollow" target="_blank"> <strong class="li ja">中值</strong> </a>。中位数是对<em class="mc">中心趋势</em>的另一种度量，它对异常值更稳健，并且通常在偏斜分布的情况下提供更多信息。更一般地说，我们可能想要估计结果分布的不同分位数<a class="ae lf" href="https://en.wikipedia.org/wiki/Quantile" rel="noopener ugc nofollow" target="_blank">的影响。一个<strong class="li ja">常见用例</strong>是研究UI变化对网站加载时间的影响:一个稍微大一点的网站可能对大多数用户来说是一个察觉不到的变化，但对少数连接非常慢的用户来说是一个很大的变化。另一个常见的用例是研究产品变化对很少有人购买的产品的影响:是现有客户购买更多，还是我们在吸引新客户？</a></p><p id="da2a" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">这些问题很难用估计平均治疗效果的线性回归来回答。更合适的工具是<strong class="li ja">分位数回归</strong>，它可以替代估计<em class="mc">中位治疗效果</em>。在本文中，我们将简要介绍分位数回归和分位数处理效应的估计。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="23e5" class="mk ml iq bd mm mn mo mp mq mr ms mt mu kf mv kg mw ki mx kj my kl mz km na nb bi translated">忠诚卡和消费</h1><p id="fc16" class="pw-post-body-paragraph lg lh iq li b lj nc ka ll lm nd kd lo lp ne lr ls lt nf lv lw lx ng lz ma mb ij bi translated">假设我们是一家网上商店，我们想增加销售额。我们决定向顾客提供一张优惠卡，当他们在商店增加消费时，可以享受折扣。我们想评估忠诚卡是否能有效增加销售额，所以我们进行了一个<strong class="li ja"> A/B测试</strong>:我们随机地只向一部分顾客提供忠诚卡。</p><p id="7061" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我从<code class="fe nh ni nj nk b"><a class="ae lf" href="https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/src/dgp.py" rel="noopener ugc nofollow" target="_blank">src.dgp</a></code>导入数据生成过程<code class="fe nh ni nj nk b">dgp_loyalty()</code>。我还从<code class="fe nh ni nj nk b"><a class="ae lf" href="https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/src/utils.py" rel="noopener ugc nofollow" target="_blank">src.utils</a></code>引进了一些绘图函数和库。为了不仅包括代码，还包括数据和表格，我使用了<a class="ae lf" href="https://deepnote.com" rel="noopener ugc nofollow" target="_blank"> Deepnote </a>，一个类似Jupyter的基于网络的协作笔记本环境。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="81ab" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">现在，我们来看看数据。我们有10，000名客户的信息，我们观察他们的<code class="fe nh ni nj nk b">spend</code>以及他们是否被提供了<code class="fe nh ni nj nk b">loyalty</code>卡。我们还观察了一些人口统计数据，比如<code class="fe nh ni nj nk b">age</code>和<code class="fe nh ni nj nk b">gender</code>。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="nn nm l"/></div></figure><p id="bd4c" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">有趣的是，我们注意到感兴趣的结果<code class="fe nh ni nj nk b">spend</code>，似乎有很多零。让我们深入了解一下。</p><h2 id="da23" class="no ml iq bd mm np nq dn mq nr ns dp mu lp nt nu mw lt nv nw my lx nx ny na iw bi translated">平均值与中位数</h2><p id="35c0" class="pw-post-body-paragraph lg lh iq li b lj nc ka ll lm nd kd lo lp ne lr ls lt nf lv lw lx ng lz ma mb ij bi translated">在分析我们的实验之前，让我们看看我们的结果变量<code class="fe nh ni nj nk b">spend</code>。我们首先使用<strong class="li ja">中心性度量</strong>来检查它。我们有两个主要的选择:平均值和中间值。</p><p id="58ee" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">首先，它们是什么？<strong class="li ja">平均值</strong>捕捉平均值，而<strong class="li ja">中值</strong>捕捉分布中心的值。一般来说，平均值在数学上更容易处理和解释，而中位数对异常值更稳健。你可以在网上找到很多文章来比较这两种方法，并建议哪一种更合适以及何时使用。我们来看看均值和中位数<code class="fe nh ni nj nk b">spend</code>。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="nz nm l"/></div></figure><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="nz nm l"/></div></figure><p id="e4ff" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们如何解读这两个数字？人们在我们商店平均消费28美元。但是，超过50%的人什么都不花。正如我们所看到的，这两项措施都提供了大量信息，并且在一定程度上是互补的。通过绘制其直方图，我们可以更好地理解<code class="fe nh ni nj nk b">spend</code>的分布。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="oa nm l"/></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ob"><img src="../Images/2dec80440d00da3bfe1ab38e6498962a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JGIZOWvdXk-OXIjxMOCpCA.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">支出分布，按作者分类的图像</p></figure><p id="312b" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">从平均值和中值来看，<code class="fe nh ni nj nk b">spend</code>的分布非常<strong class="li ja">偏斜</strong>，超过5000名顾客(总共10000名)没有消费任何东西。</p><p id="a96e" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">一个自然的问题是:我们对平均<code class="fe nh ni nj nk b">spend</code>或中位数<code class="fe nh ni nj nk b">spend</code>的<code class="fe nh ni nj nk b">loyalty</code>卡片的影响感兴趣吗？第一个将告诉我们客户是否平均花费更多，而第二个将告诉我们客户是否平均花费更多。</p><p id="0168" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">线性回归可以告诉我们<code class="fe nh ni nj nk b">loyalty</code>牌对平均<code class="fe nh ni nj nk b">spend</code>的影响。然而，如果我们对<code class="fe nh ni nj nk b">loyalty</code>卡片对中位数<code class="fe nh ni nj nk b">spend</code>(或其他分位数)的影响感兴趣，我们能做什么呢？答案是<strong class="li ja">分位数回归</strong>。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="fdd4" class="mk ml iq bd mm mn mo mp mq mr ms mt mu kf mv kg mw ki mx kj my kl mz km na nb bi translated">分位数回归</h1><p id="16b4" class="pw-post-body-paragraph lg lh iq li b lj nc ka ll lm nd kd lo lp ne lr ls lt nf lv lw lx ng lz ma mb ij bi translated">使用<strong class="li ja">线性回归</strong>，我们尝试估计一个结果变量<em class="mc"> Y </em>(在我们的示例中为<code class="fe nh ni nj nk b">spend</code>)相对于一个或多个解释变量<em class="mc"> X </em>(在我们的示例中为<code class="fe nh ni nj nk b">loyalty</code>)的<em class="mc">条件期望函数</em>。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi oc"><img src="../Images/4ce8fd38d933e12b5222c93c3a04e049.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3J2WzS7ukciba79ctIMa8g.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">条件期望函数，作者图片</p></figure><p id="777a" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">换句话说，我们想找到一个函数<em class="mc"> f </em>使得<em class="mc"> f(X) = </em> 𝔼[ <em class="mc"> Y|X </em>。我们通过解决以下<strong class="li ja">最小化问题</strong>来做到这一点:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi od"><img src="../Images/b918165c9ee15f1becf9b989338c0fcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sjzGxkoBZJHz4TpGKsCBVg.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">条件期望函数的估计，作者图片</p></figure><p id="ab81" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">可以看出，解决这个极小化问题的函数<em class="mc"> f </em>确实是<em class="mc"> Y </em>的条件期望，相对于<em class="mc"> X </em>。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="oe nm l"/></div></figure><p id="f3b3" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">由于<em class="mc"> f(X) </em>可以是无限维的，我们通常估计<em class="mc"> f(X) </em>的一个<strong class="li ja">参数形式</strong>。最常见的是线性形式<em class="mc"> f(X)=βX </em>，其中<em class="mc"> β </em>通过求解相应的最小化问题来估计:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi oc"><img src="../Images/6051c312069ddbea474e295db5ded11c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lM0u_W7KqWyplXX1bcp4Ew.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">线性回归系数，作者图片</p></figure><p id="249e" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">线性形式不仅仅是方便，还可以解释为<em class="mc"> f(X) </em>的<strong class="li ja">最佳局部逼近</strong>，参考泰勒展开式。</p><p id="7ad5" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">使用<strong class="li ja">分位数回归</strong>，我们做同样的事情。唯一的区别是，我们不是估计<em class="mc"> Y </em>相对于<em class="mc"> X </em>的条件期望，而是要估计<em class="mc"> Y </em>相对于<em class="mc"> X </em>的<em class="mc"> q </em> - <a class="ae lf" href="https://en.wikipedia.org/wiki/Quantile" rel="noopener ugc nofollow" target="_blank">分位数</a>。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi of"><img src="../Images/1e0fcdef6f4033a147e72830a8b458ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YFarnuL6jj52su4h5oVPlA.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">条件分位数函数，作者图片</p></figure><p id="c0c8" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">首先，什么是<strong class="li ja">分位数</strong>？维基百科的定义说</p><blockquote class="og oh oi"><p id="3004" class="lg lh mc li b lj lk ka ll lm ln kd lo oj lq lr ls ok lu lv lw ol ly lz ma mb ij bi translated">在统计学和概率学中，分位数是将概率分布的范围划分为具有相等概率的连续区间的切割点，或者以同样的方式划分样本中的观察值。常见的分位数有特殊的名称，如四分位数(四组)、十分位数(十组)、百分位数(100组)。”</p></blockquote><p id="74b1" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">例如，0.1分位数表示位于分布质量的10%右侧的值。<strong class="li ja">中位数</strong>是0.5分位数(或者，等价地，50ᵗʰ百分位或5ᵗʰ十分位)，对应于分布中心的值。让我们看一个简单的例子，使用<a class="ae lf" href="https://en.wikipedia.org/wiki/Log-normal_distribution" rel="noopener ugc nofollow" target="_blank">对数正态分布</a>。我绘制了三个四分位数，将数据分成四个大小相等的区间。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="om nm l"/></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="ab gu cl on"><img src="../Images/29c1f00652d8c7097cf00cd837527a04.png" data-original-src="https://miro.medium.com/v2/format:webp/1*82fa9M2TnWQAlFx4HMReow.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">对数正态分布的分位数，按作者分类的图像</p></figure><p id="8d33" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">如我们所见，三个四分位数将数据分成四个大小相等的区间。</p><p id="2e58" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">那么，分位数回归的<strong class="li ja">目标</strong>是什么呢？目标是找到一个函数<em class="mc"> f </em>使得<em class="mc"> f(X) = F⁻ (y_q) </em>，其中<em class="mc"> F </em>是<em class="mc"> Y </em>的<a class="ae lf" href="https://en.wikipedia.org/wiki/Cumulative_distribution_function" rel="noopener ugc nofollow" target="_blank">累积分布函数</a>，而<em class="mc"> y_q </em>是<em class="mc"> Y </em>分布的<em class="mc">q</em>-分位数。</p><p id="4bd9" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们如何做到这一点？用一点线性代数就可以表明，我们可以获得条件分位数作为下面的<strong class="li ja">最小化问题</strong>的解:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi oo"><img src="../Images/746ec809343f2ed661955820b316de98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VdJvEBQNG2YAbYNIbWFuoA.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">条件分位数函数估计，作者图片</p></figure><p id="d271" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">其中<em class="mc"> ρ_q </em>(上面隐式定义)是具有以下形状的辅助加权函数。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi op"><img src="../Images/5593b3cbbfe4507ee0027a9316b3b156.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u1C7RWv6OrsmNOUWFg-KSg.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">Rho加权函数，图片由作者提供</p></figure><p id="aa9f" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">目标函数背后的<strong class="li ja">直觉</strong>是什么？</p><p id="75b2" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">这个想法是我们可以这样解释这个等式</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi oq"><img src="../Images/319f8129c3e3d89234c884e15282fa46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nGI-4Cqw2PeWZA4xjKIX5g.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">目标函数解释，图像由作者提供</p></figure><p id="288b" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">所以，当<em class="mc"> f(X) </em>对应分位数<em class="mc"> y_q </em>时，目标函数值为零。</p><p id="e0bd" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">与之前完全一样，我们可以估计出<em class="mc"> f </em>的一个<strong class="li ja">参数形式</strong>，并且与之前完全一样，如<a class="ae lf" href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1468-0262.2006.00671.x" rel="noopener ugc nofollow" target="_blank"> Angrist、Chernozhukov和Fernández-Val (2006) </a>所示，我们可以将其解释为<strong class="li ja">最佳局部近似</strong>。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi or"><img src="../Images/6a6d93c53250dee621dc9f6933e27fb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cWmF_78EI1oQQXH5egzhZQ.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">分位数系数，作者图片</p></figure><p id="ae84" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们写了<em class="mc"> β̂ _q </em>来表示这是条件<em class="mc"> q </em>分位数函数的最佳线性近似系数。</p><p id="5ddc" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们如何估计分位数回归？</p><h2 id="8806" class="no ml iq bd mm np nq dn mq nr ns dp mu lp nt nu mw lt nv nw my lx nx ny na iw bi translated">估计</h2><p id="80d7" class="pw-post-body-paragraph lg lh iq li b lj nc ka ll lm nd kd lo lp ne lr ls lt nf lv lw lx ng lz ma mb ij bi translated"><a class="ae lf" href="https://www.statsmodels.org/stable/index.html" rel="noopener ugc nofollow" target="_blank"> statsmodels </a>包允许我们用<code class="fe nh ni nj nk b"><a class="ae lf" href="https://www.statsmodels.org/dev/generated/statsmodels.regression.quantile_regression.QuantReg.html" rel="noopener ugc nofollow" target="_blank">quantreg()</a></code>函数估计分位数回归。我们只需要在拟合模型时指定分位数<em class="mc"> q </em>。我们用<em class="mc"> q=0.5 </em>，对应中值。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="os nm l"/></div></figure><p id="d5b8" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">分位数回归估计<code class="fe nh ni nj nk b">loyalty</code>的正系数。这个估计与线性回归相比如何？</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="os nm l"/></div></figure><p id="6472" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">线性回归的估计系数较高。这是什么意思？稍后，我们将在分位数回归系数的<em class="mc">解释</em>上花费更多时间。</p><p id="48df" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们能以其他变量作为分析的条件吗？我们怀疑<code class="fe nh ni nj nk b">spend</code>也会受到客户人口统计的影响，我们希望通过对<code class="fe nh ni nj nk b">age</code>和<code class="fe nh ni nj nk b">gender</code>进行条件分析来提高我们估计的精确度。我们可以将变量添加到<code class="fe nh ni nj nk b">quantreg()</code>模型中。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="ot nm l"/></div></figure><p id="f40d" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">当我们对<code class="fe nh ni nj nk b">age</code>和<code class="fe nh ni nj nk b">gender</code>进行条件分析时，<code class="fe nh ni nj nk b">loyalty</code>的系数增加。线性回归的情况并非如此。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="ot nm l"/></div></figure><p id="9e9e" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">有几件事我们还没有提到。第一个是<strong class="li ja">推理</strong>。在分位数回归中，我们如何计算估计值的置信区间和p值？</p><h2 id="821b" class="no ml iq bd mm np nq dn mq nr ns dp mu lp nt nu mw lt nv nw my lx nx ny na iw bi translated">推理</h2><p id="48b6" class="pw-post-body-paragraph lg lh iq li b lj nc ka ll lm nd kd lo lp ne lr ls lt nf lv lw lx ng lz ma mb ij bi translated">累积分布<em class="mc"> F </em>的<em class="mc"> q- </em>分位数的估计值<em class="mc"> y </em>的渐近方差由下式给出</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ou"><img src="../Images/57bdb839601d419c5725375c0c79e0b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5-POqSS0kie8FwwqwE-aNA.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">分位数渐近方差，作者图片</p></figure><p id="d9e3" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">其中<em class="mc"> f </em>是<em class="mc"> F </em>的<a class="ae lf" href="https://en.wikipedia.org/wiki/Probability_density_function" rel="noopener ugc nofollow" target="_blank">密度函数</a>。这个表达式可以分解成<strong class="li ja">两个分量</strong> : <em class="mc"> q(1-q) </em>和<em class="mc"> f⁻ (y) </em>。</p><p id="70a1" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">第一个分量<em class="mc"> q(1-q) </em>告诉我们，分位数越接近分布的中心，分位数的方差就越高。为什么会这样呢？首先，我们需要考虑一个点的分位数何时响应第二个点的值的变化而变化。当第二个点从第一个点的左侧交换到右侧(反之亦然)时，分位数会发生变化。如果第一个点位于分布的中间，这在直觉上是非常容易的，但是如果它位于极值，这就非常困难了。</p><p id="84d5" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">第二个成分，<em class="mc"> f⁻ (y) </em>，告诉我们，如果点<strong class="li ja">是孤立的</strong>，那么方差更高，因此我们对它的了解更少。</p><p id="35eb" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">重要的是，估计分位数的方差需要对<em class="mc"> Y </em>的整个分布进行<strong class="li ja">估计。这是通过近似来完成的，并且计算量非常大。如果这个过程变得计算量太大，像bootstrap或<a class="ae lf" rel="noopener" target="_blank" href="/6ca4a1d45148">贝叶斯bootstrap </a>这样的替代程序总是可用的。</strong></p><p id="d501" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">第二个我们还没有谈到的是估算系数的<strong class="li ja">解释</strong>。我们通过中值回归得到了<code class="fe nh ni nj nk b">spend</code>的较低系数<code class="fe nh ni nj nk b">loyalty</code>。这是什么意思？</p><h2 id="3bf2" class="no ml iq bd mm np nq dn mq nr ns dp mu lp nt nu mw lt nv nw my lx nx ny na iw bi translated">解释</h2><p id="ee35" class="pw-post-body-paragraph lg lh iq li b lj nc ka ll lm nd kd lo lp ne lr ls lt nf lv lw lx ng lz ma mb ij bi translated">线性回归系数的<strong class="li ja">解释</strong>很简单:每个系数都是条件期望函数𝔼[ <em class="mc"> Y|X </em>相对于<em class="mc"> X </em>一维的导数。在我们的例子中，我们可以将<code class="fe nh ni nj nk b">loyalty</code>的回归系数解释为平均<code class="fe nh ni nj nk b">spend</code>从获得<code class="fe nh ni nj nk b">loyalty</code>卡开始增加。重要的是，这里的“平均”是指平均而言，每个客户都是如此。</p><p id="cbe0" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">然而，分位数回归系数的解释是很棘手的。之前，我们很想说<code class="fe nh ni nj nk b">loyalty</code>卡增加了中位顾客3.4美元的消费。但是<strong class="li ja">是什么意思</strong>？是同一个中位客户花费更多，还是我们有不同的中位客户？这可能看起来像一个哲学问题，但它对报告分位数回归结果有重要意义。在第一种情况下，我们正在做一个声明，至于线性回归系数的解释，适用于一个<em class="mc">单一个体</em>。在第二种情况下，我们正在对<em class="mc">分布</em>进行陈述。</p><p id="d68e" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated"><a class="ae lf" href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1468-0262.2005.00570.x" rel="noopener ugc nofollow" target="_blank"> Chernozhukov和Hansen (2005) </a>表明一个强有力但有用的假设是<strong class="li ja">秩不变性</strong>:假设处理<strong class="li ja">不改变</strong>分布的相对组成。换句话说，如果我们在实验前按<code class="fe nh ni nj nk b">spend</code>对人进行排名，我们假设这个排名不受<code class="fe nh ni nj nk b">loyalty</code>卡的引入的影响。如果我以前花的比你少，我以后可能会花更多，但仍然比你少(对任何两个人来说)。</p><p id="b874" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">在这种假设下，我们可以将分位数系数解释为<strong class="li ja">位于结果分布不同点的单个个体</strong>的边际效应，如上面提供的第一种解释。此外，我们可以报告许多分位数的治疗效果，并将每个分位数解释为不同个体的局部效果。让我们绘制不同分位数<code class="fe nh ni nj nk b">spend</code>的治疗效果分布图。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="ov nm l"/></div></figure><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="oa nm l"/></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="ab gu cl on"><img src="../Images/6e5786f09e9d2cb034a01df6e22abc2b.png" data-original-src="https://miro.medium.com/v2/format:webp/1*0STbv1ZCg6NkQV7TAJJl4Q.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">分位数因果效应，按作者分类的图像</p></figure><p id="baf0" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">这个情节<strong class="li ja">极有见地</strong>:对于几乎一半的客户来说，<code class="fe nh ni nj nk b">loyalty</code>卡没有任何作用。另一方面，已经在消费的顾客最终会消费更多(大约多10/12美元)。这是一个非常强大的洞察力，我们可能会错过一个估计平均影响为5美元的线性回归。</p><p id="1862" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们可以重复同样的练习，根据<code class="fe nh ni nj nk b">gender</code>和<code class="fe nh ni nj nk b">age</code>进行分析。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="oa nm l"/></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="ab gu cl on"><img src="../Images/82cfdb177dfde03e3892f27083828627.png" data-original-src="https://miro.medium.com/v2/format:webp/1*-G0WK4cckTev6GWPHqTxzw.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">条件分位数因果效应，作者图片</p></figure><p id="a06b" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">对其他协变量的调节消除了治疗效果的异质性。这张卡增加了大多数人的支出。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="0a3f" class="mk ml iq bd mm mn mo mp mq mr ms mt mu kf mv kg mw ki mx kj my kl mz km na nb bi translated">结论</h1><p id="5bcf" class="pw-post-body-paragraph lg lh iq li b lj nc ka ll lm nd kd lo lp ne lr ls lt nf lv lw lx ng lz ma mb ij bi translated">在本文中，我们探讨了一个不同的<strong class="li ja">因果估计</strong>:中位数治疗效果。与我们通常估计的平均治疗效果相比如何？利弊与中位数的利弊密切相关相对于作为<em class="mc">集中趋势</em>衡量标准的均值。中位治疗效果更能说明对普通受试者的影响，对异常值也更稳健。然而，它们在计算上要求更高，并且它们需要用于识别的强假设，例如秩不变性。</p><h2 id="8c48" class="no ml iq bd mm np nq dn mq nr ns dp mu lp nt nu mw lt nv nw my lx nx ny na iw bi translated">参考</h2><p id="43bb" class="pw-post-body-paragraph lg lh iq li b lj nc ka ll lm nd kd lo lp ne lr ls lt nf lv lw lx ng lz ma mb ij bi translated">[1] R. Koenker，<a class="ae lf" href="https://www.cambridge.org/core/books/quantile-regression/C18AE7BCF3EC43C16937390D44A328B1" rel="noopener ugc nofollow" target="_blank">《分位数回归》</a> (1996)，剑桥大学出版社<em class="mc"/>。</p><p id="8166" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">[2] R. Koenker，K. Hallock，<a class="ae lf" href="https://www.aeaweb.org/articles?id=10.1257/jep.15.4.143" rel="noopener ugc nofollow" target="_blank">分位数回归</a> (2001)，<em class="mc">《经济展望杂志》</em>。</p><p id="6806" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">[3] V. Chernozhukov，C. Hansen，<a class="ae lf" href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1468-0262.2005.00570.x" rel="noopener ugc nofollow" target="_blank">一个分位数处理效应的IV模型</a> (2005)，<em class="mc">计量经济学</em>。</p><p id="22bd" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">[4] J. Angrist，V. Chernozhukov，I. Fernández-Val，<a class="ae lf" href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1468-0262.2006.00671.x" rel="noopener ugc nofollow" target="_blank">错误设定下的分位数回归，应用于美国工资结构</a> (2006)，<em class="mc">计量经济学</em>。</p><h2 id="c725" class="no ml iq bd mm np nq dn mq nr ns dp mu lp nt nu mw lt nv nw my lx nx ny na iw bi translated">相关文章</h2><ul class=""><li id="9073" class="ow ox iq li b lj nc lm nd lp oy lt oz lx pa mb pb pc pd pe bi translated"><a class="ae lf" rel="noopener" target="_blank" href="/b63dc69e3d8c">Dag和控制变量</a></li><li id="d714" class="ow ox iq li b lj pf lm pg lp ph lt pi lx pj mb pb pc pd pe bi translated"><a class="ae lf" rel="noopener" target="_blank" href="/6ca4a1d45148">贝叶斯自举</a></li><li id="5a3b" class="ow ox iq li b lj pf lm pg lp ph lt pi lx pj mb pb pc pd pe bi translated"><a class="ae lf" rel="noopener" target="_blank" href="/a928f67413e4">再见散点图，欢迎入库散点图</a></li></ul><h2 id="a524" class="no ml iq bd mm np nq dn mq nr ns dp mu lp nt nu mw lt nv nw my lx nx ny na iw bi translated">密码</h2><p id="6c4c" class="pw-post-body-paragraph lg lh iq li b lj nc ka ll lm nd kd lo lp ne lr ls lt nf lv lw lx ng lz ma mb ij bi translated">你可以在这里找到Jupyter的原始笔记本:</p><div class="pk pl gp gr pm pn"><a href="https://github.com/matteocourthoud/Blog-Posts/blob/main/notebooks/quantile_reg.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="po ab fo"><div class="pp ab pq cl cj pr"><h2 class="bd ja gy z fp ps fr fs pt fu fw iz bi translated">博客帖子/quantile _ reg . ipynb at main Matteo courthoud/博客帖子</h2><div class="pu l"><h3 class="bd b gy z fp ps fr fs pt fu fw dk translated">我的中型博客文章的代码和笔记本。为matteocourthoud/Blog-Posts的发展作出贡献</h3></div><div class="pv l"><p class="bd b dl z fp ps fr fs pt fu fw dk translated">github.com</p></div></div><div class="pw l"><div class="px l py pz qa pw qb kz pn"/></div></div></a></div></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h2 id="38ce" class="no ml iq bd mm np nq dn mq nr ns dp mu lp nt nu mw lt nv nw my lx nx ny na iw bi translated">感谢您的阅读！</h2><p id="fc23" class="pw-post-body-paragraph lg lh iq li b lj nc ka ll lm nd kd lo lp ne lr ls lt nf lv lw lx ng lz ma mb ij bi translated"><em class="mc">真的很感谢！</em>🤗<em class="mc">如果你喜欢这个帖子并且想看更多，可以考虑</em> <a class="ae lf" href="https://medium.com/@matteo.courthoud" rel="noopener"> <strong class="li ja"> <em class="mc">关注我</em> </strong> </a> <em class="mc">。我定期发布与因果推理和数据分析相关的主题。我尽量让我的帖子简单而精确，总是提供代码、例子和模拟。</em></p><p id="650b" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated"><em class="mc">还有，一个小小的</em> <strong class="li ja"> <em class="mc">免责声明</em> </strong> <em class="mc">:我写作是为了学习所以错误是常态，尽管我尽力了。当你发现他们的时候，请告诉我。也很欣赏新话题的建议！</em></p></div></div>    
</body>
</html>