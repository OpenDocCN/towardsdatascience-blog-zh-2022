<html>
<head>
<title>Find Informative Features for Machine Learning Models with Upgini</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Upgini查找机器学习模型的信息特征</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/find-informative-features-for-machine-learning-models-with-upgini-17489158ffaa#2022-08-21">https://towardsdatascience.com/find-informative-features-for-machine-learning-models-with-upgini-17489158ffaa#2022-08-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fa44" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用于丰富特性的Python库</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/87cff5837a5c859bccca9d3c8ded7495.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4_xwduzKy0tYBTjeJQIamg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Kushagra Kevat 在<a class="ae ky" href="https://unsplash.com/s/photos/boost?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="00a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">特征工程是构建机器学习模型的重要组成部分。我们通常会花费大量时间来寻找新的功能，为机器学习模型增加信息能力。</p><p id="c418" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">找到一个有助于预测目标变量的特征并不是一件容易的事情。我们最终可能会创建出对模型没有或增加很少价值的特性。另一方面，如果我们最终创建了一个增强模型的准确性和健壮性的特征。找到这样的特征几乎总是比超参数优化更有帮助。</p><p id="9562" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没有免费的午餐，所以我们可能需要搜索大量的数据源或执行广泛的探索性数据分析，以便能够找到将产生重大影响的功能。</p><p id="7d20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://upgini.com/" rel="noopener ugc nofollow" target="_blank"> Upgini </a>正是为此目的而创建的开源Python库。它所做的是搜索成千上万的公共和社区数据源，然后创建将提高模型性能的要素。</p><p id="01e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">特征工程可以被认为是一个两步任务。第一步是找到数据(即特征)，第二步是检查它与问题的相关性。Upgini完成了这两个步骤。它不仅发现特征，而且评估它们。</p><p id="444a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Upgini的enricher对象返回现有功能和新功能的SHAP值，以便我们了解新功能有多有用。SHAP值经常用于机器学习模型的可解释性和可解释性。</p><p id="9c79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看一个例子来演示如何使用Upgini来丰富特性。第一步是安装Upgini，可通过pip完成，如下所示:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4d08" class="ma mb it lw b gy mc md l me mf">pip install upgini</span></pre><p id="8f9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用OpenML网站上有<a class="ae ky" href="https://creativecommons.org/share-your-work/public-domain/cc0/" rel="noopener ugc nofollow" target="_blank"> CCO </a>许可的<a class="ae ky" href="https://www.openml.org/search?type=data&amp;status=any&amp;id=41041&amp;sort=runs" rel="noopener ugc nofollow" target="_blank"> intuit </a>数据集。该任务是电子邮件响应预测，因此数据集包含一些要素和一个二进制目标变量。我们将使用Pandas来读取和清理数据集。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="90b0" class="ma mb it lw b gy mc md l me mf">import pandas as pd</span><span id="93d8" class="ma mb it lw b gy mg md l me mf">data = pd.read_csv("csv_result-intuit.csv")</span><span id="633c" class="ma mb it lw b gy mg md l me mf">data.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/b3251f8de92fc12496709ad3292f0326.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mNoL00UXjRj2i17jmsIhZg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="cdca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">res1是目标变量，取值为0和1。数据集需要清理一下。</p><ul class=""><li id="a81d" class="mi mj it lb b lc ld lf lg li mk lm ml lq mm lu mn mo mp mq bi translated">id功能是多余的，因此我们将删除它们。</li><li id="93d4" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated">邮政编码99999无效，因此我们也将删除这些行。</li></ul><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="55b5" class="ma mb it lw b gy mc md l me mf">data = data.drop(["id","id.1"], axis=1)</span><span id="3cba" class="ma mb it lw b gy mg md l me mf">data = data[data.zip != 99999]</span></pre></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h2 id="991e" class="ma mb it bd nd ne nf dn ng nh ni dp nj li nk nl nm lm nn no np lq nq nr ns nt bi translated">搜索关键字</h2><p id="ece5" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">Upgini通过搜索关键字找到特征。它目前支持以下功能:</p><ul class=""><li id="6aee" class="mi mj it lb b lc ld lf lg li mk lm ml lq mm lu mn mo mp mq bi translated">日期/日期时间</li><li id="f584" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated">邮政编码</li><li id="627d" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated">国家</li><li id="bb40" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated">电话号码</li><li id="1b2b" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated">散列电子邮件</li><li id="dca3" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated">IP地址</li></ul><p id="4e96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当创建一个enricher对象时，我们需要指出包含搜索关键字的列，在我们的例子中是邮政编码。需要提及的重要一点是，在使用邮政编码时，我们还需要定义国家。因此，我们将创建一个列来显示这些邮政编码所在的国家，即美国。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="709a" class="ma mb it lw b gy mc md l me mf">data["country"] = "US"</span></pre></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h2 id="eb0f" class="ma mb it bd nd ne nf dn ng nh ni dp nj li nk nl nm lm nn no np lq nq nr ns nt bi translated">数据清理和预处理</h2><p id="84f5" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">有些行具有重复的特征值，但目标值不同。我们还将使用Pandas的删除重复项功能来删除它们。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d0df" class="ma mb it lw b gy mc md l me mf">cols = list(data.columns)<br/>cols.remove("res1")</span><span id="1252" class="ma mb it lw b gy mg md l me mf">data = data.drop_duplicates(subset=cols)</span></pre><p id="9dc4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">原始数据集包含20000个观察值(即行)，就目标值而言，这是非常不平衡的。大约95%的目标值为0，这意味着没有响应。处理不平衡数据集有不同的方法，但这不是本文的主题。因此，我们将从数据集中提取一个不那么不平衡的样本。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="bf81" class="ma mb it lw b gy mc md l me mf">data_1 = data[data.res1==1]<br/>data_0 = data[data.res1==0].sample(n=4000)</span><span id="562b" class="ma mb it lw b gy mg md l me mf">data = pd.concat([data_0, data_1], axis=0, ignore_index=True)</span><span id="b527" class="ma mb it lw b gy mg md l me mf">data["res1"].value_counts(normalize=True)</span><span id="ae49" class="ma mb it lw b gy mg md l me mf"><strong class="lw iu">Output</strong><br/>0    0.807591<br/>1    0.192409</span></pre><p id="a51c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在% 80.76%的目标值是0。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h2 id="499c" class="ma mb it bd nd ne nf dn ng nh ni dp nj li nk nl nm lm nn no np lq nq nr ns nt bi translated">列车测试分离</h2><p id="000a" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">下一步是将数据分成训练集和测试集。我们将通过使用Scikit-learn的列车测试分割功能来执行此操作。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="b29c" class="ma mb it lw b gy mc md l me mf">from sklearn.model_selection import train_test_split</span><span id="6c70" class="ma mb it lw b gy mg md l me mf">X = data.drop(columns=["res1"])<br/>y = data["res1"]</span><span id="aabb" class="ma mb it lw b gy mg md l me mf">X_train, X_test, y_train, y_test = train_test_split(<br/>    X, y, test_size=0.25, random_state=42<br/>)</span></pre></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h2 id="de90" class="ma mb it bd nd ne nf dn ng nh ni dp nj li nk nl nm lm nn no np lq nq nr ns nt bi translated">使用Upgini查找功能</h2><p id="bf52" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">我们现在将创建一个Upgini的enricher对象。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ecd2" class="ma mb it lw b gy mc md l me mf">from upgini import FeaturesEnricher, SearchKey</span><span id="f0d1" class="ma mb it lw b gy mg md l me mf">enricher = FeaturesEnricher(<br/>    search_keys = {<br/>      "zip": SearchKey.POSTAL_CODE,<br/>      "country": SearchKey.COUNTRY<br/>    },<br/>    api_key = "WRITE YOUR API KEY HERE"<br/>)</span></pre><p id="f950" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">搜索键是通过将列名和搜索键类型写成Python字典中的键值来定义的。另一个参数是api密匙，你可以通过注册<a class="ae ky" href="https://upgini.com/" rel="noopener ugc nofollow" target="_blank"> Upgini </a>免费获得。</p><p id="6642" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是使训练集适合刚刚创建的enricher对象。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2252" class="ma mb it lw b gy mc md l me mf">enricher.fit(X_train,<br/>             y_train,<br/>             eval_set=[(X_test, y_test)]<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/2cfcab8208c46fbb8df04aefcdc874fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wCyvI26WtzDDSs0TyjRdNQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="bc52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">发现了3个新特性。我们还可以看到现有要素的SHAP值和SHAP值。其他特性的SHAP值为0，所以我没有把它们包含在上面的截图中。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h2 id="1acd" class="ma mb it bd nd ne nf dn ng nh ni dp nj li nk nl nm lm nn no np lq nq nr ns nt bi translated">衡量绩效</h2><p id="1e9e" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">最后一步是衡量新特性对模型性能的影响。我将使用一个随机的森林分类器来完成这个任务，但是你可以随意使用任何你喜欢的算法。让我们首先创建模型。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="0a62" class="ma mb it lw b gy mc md l me mf">from sklearn.ensemble import RandomForestClassifier</span><span id="5ba9" class="ma mb it lw b gy mg md l me mf">clf = RandomForestClassifier(<br/>    n_estimators=100, <br/>    max_depth=3, <br/>    random_state=0<br/>)</span></pre><p id="0df8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用enricher对象的计算度量方法来评估新特性。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="244d" class="ma mb it lw b gy mc md l me mf">enricher.calculate_metrics(<br/>    X_train, y_train, <br/>    eval_set = [(X_test, y_test)],<br/>    estimator = clf,<br/>    scoring = "accuracy"<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/b386ced650d7f916e0891426a698f44f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vvnN2sDIlEv2Y8WqMs5hWQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="2bcc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">性能改进显示在提升列中。训练集的精度提高了%6.8，而测试集的精度提高了%1.2。考虑到获得这些特性是多么简单，这实际上是一个很大的改进。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h2 id="33f4" class="ma mb it bd nd ne nf dn ng nh ni dp nj li nk nl nm lm nn no np lq nq nr ns nt bi translated">结论</h2><p id="3e1d" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">在某些任务中，1%的精度改进可能至关重要。考虑一个有数百个位置的零售连锁店。需求预测增加1%可以在库存规划、供应链运营和其他运营工作中节省数千美元。</p><p id="1dec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们在上面的例子中所看到的，用Upgini搜索新特性只需要几个简单的步骤。因此，考虑到它的潜力和易用性，它绝对值得一试。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><p id="929f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ob">你可以成为</em> <a class="ae ky" href="https://sonery.medium.com/membership" rel="noopener"> <em class="ob">媒介会员</em> </a> <em class="ob">解锁我的全部写作权限，外加其余媒介。如果你已经是了，别忘了订阅</em><a class="ae ky" href="https://sonery.medium.com/subscribe" rel="noopener"><em class="ob"/></a><em class="ob">如果你想在我发表新文章时收到电子邮件。</em></p><p id="5779" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>