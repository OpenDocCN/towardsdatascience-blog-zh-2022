<html>
<head>
<title>4 Tips for Using Python Pandas More Efficiently</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">更有效地使用Python熊猫的4个技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/4-tips-for-using-python-pandas-more-efficiently-8dd9a850b979#2022-04-19">https://towardsdatascience.com/4-tips-for-using-python-pandas-more-efficiently-8dd9a850b979#2022-04-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="86db" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">简单而实用的指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/547fa89d1f6297a5320f70a5fb4f3ac8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jp88U_55LBgT7E5ggwYoEw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@simonsun2017?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">西蒙孙</a>在<a class="ae ky" href="https://unsplash.com/s/photos/tips?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="97ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas是一个非常实用的功能库，用于数据分析和操作任务。自2019年以来，我一直在使用熊猫，它一直能够为我的任务提供解决方案。</p><p id="37aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在使用熊猫大约3年后，我意识到我一开始并没有非常有效地使用它。在某些情况下，我解决某个特定问题的方法比最优解要长。我也没有非常有效和准确地使用一些功能。</p><p id="8c9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我仍然能够完成任务。然而，当我发现更好更实用的做事方法时，我的整个工作流程都得到了改善。</p><p id="7fde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我将分享4个小贴士，帮助你充分利用熊猫。让我们从创建示例中使用的样本数据帧开始。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="313b" class="ma mb it lw b gy mc md l me mf">import numpy as np<br/>import pandas as pd</span><span id="04d4" class="ma mb it lw b gy mg md l me mf">df = pd.DataFrame({<br/>    "Team": ["A","A","B","B","B",np.nan,np.nan,"C"],<br/>    "Player": [<br/>       "John","Jane","Ashley","Emily","Matt","Jenny","Max","Alex"<br/>    ],<br/>    "Score": [81, 84, np.nan, 91, np.nan, 86, 94, 89]<br/>})</span><span id="fb3c" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/c35ce6b76a98d82889a53d8f4b8f1e2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GzuHQ7ESHq6YBlIv3t5I-Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure><p id="31e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有一个3列8行的数据框架，在team和score列中有一些缺失值。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="1b60" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">1.具有空值的value_counts函数</h2><p id="9c03" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">value_counts函数是最常用的Pandas函数之一。它计算一列中每个不同值的出现次数。默认情况下，它不考虑空值(即缺失值)。这可能会产生误导，尤其是当我们处理大文件的时候。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="52a8" class="ma mb it lw b gy mc md l me mf">df["Team"].value_counts()</span><span id="c4e1" class="ma mb it lw b gy mg md l me mf"><strong class="lw iu"># output</strong><br/>B    3<br/>A    2<br/>C    1<br/>Name: Team, dtype: int64</span></pre><p id="c9e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">team列中有空值，但是我们在value_counts函数的输出中看不到它们。我们可以通过使用dropna参数让它计算空值，如下所示。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="541a" class="ma mb it lw b gy mc md l me mf">df["Team"].value_counts(dropna=False)</span><span id="6914" class="ma mb it lw b gy mg md l me mf"><strong class="lw iu"># output</strong><br/>B      3<br/>A      2<br/>NaN    2<br/>C      1<br/>Name: Team, dtype: int64</span></pre><p id="56ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在输出更准确了。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="241c" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">2.使用其他列填充缺失值</h2><p id="59eb" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">现实生活中的数据集通常包含无法忽略的缺失值。我们需要正确处理它们，以产生准确可靠的输出。</p><p id="f2c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有不同的选项来填充缺失的值。最佳方案取决于数据和任务的特征。例如，我们可以使用列平均值来填充缺失的值。处理时间序列数据时，上一个或下一个值可能是更好的选择。</p><p id="8929" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一种选择是使用其他列中的数据。在我们的数据框架中，我们可以使用球员列来填充球队列中缺少的值。我将向您展示完成这项任务的两种不同技术。第一种方法是使用loc方法手动选择缺失的值。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="45b9" class="ma mb it lw b gy mc md l me mf">df.loc[df["Team"].isna()==True, "Team"] = df["Player"]</span></pre><p id="b5a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">左侧选择“团队”列中缺少的值。右侧将player列中的值分配给这些值。</p><p id="a005" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二种是直接使用fillna函数。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="9a1b" class="ma mb it lw b gy mc md l me mf">df["Team"].fillna(df["Player"], inplace=True)</span><span id="f2e0" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/4329550b8223ad145cdf42b1335f5cf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RKkitNulHDRDxRZfS582rw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="5605" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">3.使用Python字典</h2><p id="cbd8" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">Dictionary是Python内置的数据结构。它对于数据分析和处理中的各种任务来说非常方便。我们也可以将它们与熊猫功能一起使用，使它们更有用。</p><p id="465c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，replace函数用于替换列或数据帧中的值。假设我们有一个包含每个球员的球队数据的球队字典。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="76ed" class="ma mb it lw b gy mc md l me mf">teams = {<br/>    "John":"A",<br/>    "Jane":"A",<br/>    "Ashley":"B",<br/>    "Emily":"B",<br/>    "Matt":"B",<br/>    "Jenny":"C",<br/>    "Max":"C",<br/>    "Alex":"C"<br/>}</span></pre><p id="5da2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用这个字典将球队列中的球员姓名替换为他们的球队名称。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="19a4" class="ma mb it lw b gy mc md l me mf">df["Team"] = df["Team"].replace(teams)</span><span id="f18c" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/352de17e53e3c9d4db44f55c8e0387a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gVAR2VbDQXklxf8Z7IHHfQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure><p id="991a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以这样做:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="bfac" class="ma mb it lw b gy mc md l me mf">df["Team"] = df["Team"].replace("Jenny","C")<br/>df["Team"] = df["Team"].replace("Max","C")</span></pre><p id="4d10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这肯定不如用字典方便。此外，我们可能需要替换几个值。在这种情况下，使用字典只用一行代码就可以完成任务，而不是编写几行代码。</p><p id="fd80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以用Python字典增强其他一些Pandas函数。这里有一篇我写的关于这个话题的更详细的文章。</p><div class="nl nm gp gr nn no"><a rel="noopener follow" target="_blank" href="/4-python-pandas-functions-that-serve-better-with-dictionaries-bbfcc6c39fa5"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd iu gy z fp nt fr fs nu fu fw is bi translated">4 Python Pandas函数更好地服务于字典</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">多利用熊猫。</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">towardsdatascience.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc ks no"/></div></div></a></div></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="bad8" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">4.缺少值的整数列</h2><p id="08e2" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">分数列中的值是整数，但它们显示为浮点数。原因是该列中缺少值。</p><p id="7873" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">整数的默认数据类型不支持空值，因此数据类型被强制转换为浮点型。如果将这些值表示为整数很重要，可以使用可空整数数据类型。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8833" class="ma mb it lw b gy mc md l me mf">df["Score"] = df["Score"].astype(pd.Int64Dtype())</span><span id="e9a8" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/1ef92af3aca675e6ebf489a86ad98e06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i6kqxfUVXRwRFuK0pvCxZA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure><p id="4b59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在分数显示为整数。</p><p id="9eac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据清理和操作是任何面向数据的产品的重要组成部分。Pandas提供了一些功能和方法来加快和简化您的工作流程。为了最大限度地利用熊猫，你应该尝试发现任何功能的全部潜力。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="3d75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="od">你可以成为</em> <a class="ae ky" href="https://sonery.medium.com/membership" rel="noopener"> <em class="od">媒介会员</em> </a> <em class="od">解锁我的全部写作权限，外加其余媒介。如果你已经是了，别忘了订阅</em><a class="ae ky" href="https://sonery.medium.com/subscribe" rel="noopener"><em class="od"/></a><em class="od">如果你想在我发表新文章时收到电子邮件。</em></p><div class="nl nm gp gr nn no"><a href="https://sonery.medium.com/membership" rel="noopener follow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd iu gy z fp nt fr fs nu fu fw is bi translated">通过我的推荐链接加入Medium-Soner yl DRM</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">sonery.medium.com</p></div></div><div class="nx l"><div class="oe l nz oa ob nx oc ks no"/></div></div></a></div><p id="1ef0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>