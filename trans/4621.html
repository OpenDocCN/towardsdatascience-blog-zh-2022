<html>
<head>
<title>How to Use Pandas to Get Your Data in the Format You Need</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Pandas以您需要的格式获取数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-use-pandas-to-get-your-data-in-the-format-you-need-dc7fd63ab5e9#2022-10-13">https://towardsdatascience.com/how-to-use-pandas-to-get-your-data-in-the-format-you-need-dc7fd63ab5e9#2022-10-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6b39" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解长格式和宽格式数据之间的区别，以及如何在Pandas中进行转换。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ec9968af97868e21f9f11692717a2be5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GpMI4iPGbmE1eS3C"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">戴维·贝克尔在Unsplash<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">上的照片</a></p></figure><p id="4d2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据科学家都知道这样一个事实:你的数据永远不会是你想要的样子。您可能会得到一个有点条理的电子表格或合理的合理表格，但是在您准备好进行分析之前，总会有一些清理工作要做。</p><p id="ac41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，能够在不同形式的数据之间转换至关重要。有时，这只是可读性和易于解释的问题。其他时候，你会毫不夸张地发现，除非你的数据是特定的格式，否则你试图使用的软件包或模型根本无法工作。不管是什么情况，这都是一项很好的技能。</p><p id="45dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将讨论两种常见的数据形式:<strong class="lb iu">长格式数据</strong>和<strong class="lb iu">宽格式数据</strong>。这些是数据科学中广泛使用的范例，熟悉它们是有好处的。我们将通过一些例子来了解这两种数据格式到底是什么样子，然后我们将了解如何使用Python(更具体地说，是Pandas)在它们之间进行转换。</p><p id="41da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们开始吧。</p><h2 id="cca2" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">长格式与宽格式数据</h2><p id="260d" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">最简单的方法是从直接的定义开始[1]:</p><ul class=""><li id="a6af" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated"><strong class="lb iu">宽格式数据</strong>为自变量的每个可能值提供一行，所有因变量记录在列标签中。因此，每一行中的标签(对于自变量)将是唯一的。</li><li id="6c7d" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><strong class="lb iu">长格式数据</strong>每个观察值占一行，每个因变量作为一个新值记录在多行中。因此，独立变量<em class="nh">的值在行内重复</em>。</li></ul><p id="6e46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好吧，酷——但这意味着什么？如果我们看一个例子会更容易理解。假设我们有一个学生的数据集，我们存储他们在期中考试、期末考试和课堂项目中的分数。概括地说，我们的数据如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/92ce8ed5b7196e49176188a4d5b7c307.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*x_UUNoRIqTT9S-vKO97BXQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b766" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，每个学生都是自变量，每个分数都是各自的因变量(因为特定考试或项目的分数取决于学生)。我们可以看到,<code class="fe nj nk nl nm b">Student</code>的值对于每一行都是唯一的，正如我们对宽格式数据的预期。</p><p id="d8ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们看看完全相同的数据，但形式更长:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/3182879b2d56a151cae3802fcf201124.png" data-original-src="https://miro.medium.com/v2/resize:fit:590/format:webp/1*TYEQAXJoAUVT6vgrIPXAmQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="acd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这一次，我们为每个观察值安排了一行。在这种情况下，观察对应于特定作业的分数。在上面这个数据的宽格式版本中，我们在一行中记录了多个观察值(分数)，而这里每一行都有自己的分数。</p><p id="1693" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们可以看到自变量<code class="fe nj nk nl nm b">Student</code>的值以这种数据格式重复出现，这也是我们所期望的。</p><p id="1c5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一会儿，我们将讨论为什么您应该关心这些不同的格式。但是首先，让我们快速看一下如何使用Pandas在这些不同的数据格式之间进行转换。</p><h2 id="8d5a" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">宽格式数据到长格式数据:Melt函数</h2><p id="fb61" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">再一次，让我们看看上面的宽格式数据。这一次，我们将为数据帧起一个名字:<code class="fe nj nk nl nm b">student_data</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/92ce8ed5b7196e49176188a4d5b7c307.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*x_UUNoRIqTT9S-vKO97BXQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b03f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了将学生数据转换成长格式，我们使用下面一行代码:</p><pre class="kj kk kl km gt no nm np nq aw nr bi"><span id="b305" class="lv lw it nm b gy ns nt l nu nv">student_data.melt('Student', var_name='Assignment', value_name='Score')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/3182879b2d56a151cae3802fcf201124.png" data-original-src="https://miro.medium.com/v2/resize:fit:590/format:webp/1*TYEQAXJoAUVT6vgrIPXAmQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="d6c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是一步一步的解释:</p><ul class=""><li id="a927" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated"><code class="fe nj nk nl nm b">melt</code>函数被设计成将宽格式数据转换成长格式数据[2]。</li><li id="a188" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><code class="fe nj nk nl nm b">var_name</code>参数指定了我们想要命名的第二列——包含我们各自的因变量的那一列。</li><li id="c5f1" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><code class="fe nj nk nl nm b">value_name</code>参数指定了我们想要命名的第三列——包含我们正在观察的单个值的列(在本例中是分数)。</li></ul><p id="bae3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了，现在我们有了长格式数据。但是，如果——不管出于什么原因——我们需要回到宽格式呢？</p><h2 id="f5e6" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">长格式数据到宽格式数据:Pivot函数</h2><p id="b8e6" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">现在，我们从上面数据的长版本开始，称为<code class="fe nj nk nl nm b">student_data_long</code>。下面一行代码会将其转换回原始格式:</p><pre class="kj kk kl km gt no nm np nq aw nr bi"><span id="60a6" class="lv lw it nm b gy ns nt l nu nv">student_data_long.pivot(index='Student', columns='Assignment', values='Score')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/3d64a2698f78f823de9849453c90cf3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*EIPyjTsf3EFH4xE10E0FoA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="481d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了稍微更新的标签(<code class="fe nj nk nl nm b">pivot</code>显示整个列标签<code class="fe nj nk nl nm b">'Assignment'</code>，这正是我们从上面开始的数据。</p><p id="011a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是一步一步的解释:</p><ul class=""><li id="df3e" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated"><code class="fe nj nk nl nm b">pivot</code>函数被设计成将宽格式数据转换成长格式数据[3]，但是<a class="ae ky" href="https://medium.com/towards-data-science/a-comparison-of-groupby-and-pivot-in-pythons-pandas-module-527909e78d6b" rel="noopener">实际上可以完成比这里显示的更多的事情</a> [4]。</li><li id="a68a" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><code class="fe nj nk nl nm b">index</code>参数指定我们希望将哪一列的值作为唯一的行(即独立变量)。</li><li id="a7b1" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><code class="fe nj nk nl nm b">columns</code>参数指定哪个列的唯一值(长格式)将成为唯一列标签。</li><li id="0db8" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><code class="fe nj nk nl nm b">values</code>参数指定哪一列的标签将构成我们宽格式中的实际数据条目。</li></ul><p id="d535" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是全部了！</p><h2 id="fdde" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">为什么重要？</h2><p id="efe6" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">最后，我想简单强调一下，虽然上面的乍一看似乎很肤浅，但实际上这是一项非常有用的技能。很多时候，你会发现以某种格式保存数据会让你的生活变得更加容易。</p><p id="e8f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我用自己工作中的一个例子来说明。我经常需要用Python做数据可视化，我选择的模块是Altair。这导致了一个意想不到的问题:大多数电子表格倾向于宽格式，但Altair的规范在长格式中使用起来要容易得多。</p><p id="4e5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今年早些时候，我花了很长时间来开发一个特别的可视化。当我接受堆栈溢出时，我发现我需要做的就是将我的数据转换成长格式。如果你持怀疑态度，<a class="ae ky" href="https://stackoverflow.com/questions/71059865/is-there-a-way-to-transform-a-nominal-dataframe-into-a-bubble-plot-in-altair" rel="noopener ugc nofollow" target="_blank">你可以自己去看看这个帖子</a>。</p><p id="7100" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，你可能不从事可视化工作，但是如果你正在阅读这篇文章，可以肯定你确实在从事数据工作。因此，你应该知道如何操作它，这只是你的工具箱中又一个有用的技能。</p><p id="7f7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">祝你的数据科学事业好运。</p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><p id="e5ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">想擅长Python？</strong> <a class="ae ky" href="https://witty-speaker-6901.ck.page/0977670a91" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">获取独家，免费获取我简单易懂的指南</strong> </a> <strong class="lb iu">。想在介质上无限阅读故事？用我下面的推荐链接注册！</strong></p><div class="oe of gp gr og oh"><a href="https://murtaza5152-ali.medium.com/?source=entity_driven_subscription-607fa603b7ce---------------------------------------" rel="noopener follow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">穆尔塔扎阿里培养基</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">阅读媒介上穆尔塔扎·阿里的作品。华盛顿大学的博士生。对人机感兴趣…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">murtaza5152-ali.medium.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov ks oh"/></div></div></a></div><h2 id="d1c6" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">参考</h2><p id="5da1" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">[1]<a class="ae ky" href="https://altair-viz.github.io/user_guide/data.ht" rel="noopener ugc nofollow" target="_blank">https://altair-viz.github.io/user_guide/data.ht</a><br/>【2】<a class="ae ky" href="https://pandas.pydata.org/docs/reference/api/pandas.melt.html" rel="noopener ugc nofollow" target="_blank">https://pandas . pydata . org/docs/reference/API/pandas . melt . html</a><br/>【3】<a class="ae ky" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.pivot.html" rel="noopener ugc nofollow" target="_blank">https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.pivot.html</a><br/>【4】<a class="ae ky" href="https://medium.com/towards-data-science/a-comparison-of-groupby-and-pivot-in-pythons-pandas-module-527909e78d6b" rel="noopener">https://medium . com/forward-data-science/a-comparison-of-group by-and-pivot-in-python-pandas-module-527909 e78d6b</a></p></div></div>    
</body>
</html>