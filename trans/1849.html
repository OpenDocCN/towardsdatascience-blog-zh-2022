<html>
<head>
<title>Smart Paraphrasing Using Constrained Beam Search in NLP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自然语言处理中使用约束波束搜索的智能解释</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/smart-paraphrasing-using-constrained-beam-search-in-nlp-9af6fd046e5c#2022-04-29">https://towardsdatascience.com/smart-paraphrasing-using-constrained-beam-search-in-nlp-9af6fd046e5c#2022-04-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="41d2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">套用保留搜索引擎优化和文案的特定关键字</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/21cf251dff3623fabb31f7226a7b6cbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uOH6rovYoQ64xvPAme57cg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://pixabay.com/photos/notepad-coffee-pen-fountain-pen-1276779/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的无版权图片</p></figure><p id="8d68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Huggingface最近在变形金刚库中引入了带有约束波束搜索的<a class="ae ky" href="https://huggingface.co/blog/constrained-beam-search" rel="noopener ugc nofollow" target="_blank">引导文本生成</a>。</p><p id="e4e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用受约束的波束搜索来指导哪些单词需要包含在解码的输出文本中。</p><p id="ebd3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这在文案和SEO中有一些有趣的用例。</p><h1 id="9de6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">用例1: SEO(搜索引擎优化)</h1><p id="bbfa" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">例如，如果你正在写一篇关于<strong class="lb iu">“模因营销”</strong>的文章，你想要确保“模因营销”这个词在整个博客或文章中被多次使用，以便它在谷歌搜索(SEO)中排名更高，并在该主题上建立权威。</p><p id="1c73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个概念叫做<strong class="lb iu">“关键词填充”</strong>，当然需要适度使用，不要显得垃圾。所以这促使我们使用“模因营销”这个短语，即使我们是在转述，也不要改变它。因此，在这种情况下，有必要重写(意译)任何旧的内容，保持短语“模因营销”完好无损。</p><p id="becd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个完美的受约束的beam用例，在你想要解释的地方搜索，同时在解释的版本中保持一个短语或关键字不变。</p><p id="e04d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，SEO专家会识别出<a class="ae ky" href="https://ahrefs.com/blog/long-tail-keywords/" rel="noopener ugc nofollow" target="_blank">长尾关键词</a>，即搜索量较好但相关结果较少的小众短语(例如:平足的最佳跑鞋)，并在其上撰写文章。这有助于他们在谷歌搜索中排名更快，并在第一页显示他们的网站。有时，他们想改写自己写的一句话，但又想原封不动地保留“平足的最佳跑鞋”等短语。</p><h1 id="d303" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">用例2:文案</h1><p id="6f5d" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">文案是为任何营销材料撰写内容，无论是博客、网站、传单等。</p><p id="3277" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有效的文案写作是理解人类的心理，并写一个文案，推动客户走向最终目标，如推动注册，销售产品等。</p><p id="546b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看Marketingexamples.com的一个文案技巧，建议使用简单的语言而不是多余的语言。</p><p id="c4a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果我们将登录页面复制为“<strong class="lb iu">通过构建真实项目增强您的前端技能</strong>”，则建议可以将像Supercharge、unleash、exceed、empower这样的登录页面单词替换为更简单的单词，听起来更自然、更真实。</p><p id="c7a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，在我们的例子中，我们理想地将这句话解释为“<strong class="lb iu">通过构建真正的项目增强你的前端技能</strong>”，但是使用词语<strong class="lb iu">“改进”</strong>听起来更自然。</p><p id="2b36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这也是约束波束搜索的一个完美用例，我们可以将<strong class="lb iu">“改进”</strong>作为强制字。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/7152f9ae64a5378414c20a957edf3e05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N-L7AXqSz3xi4vKzvE2oHA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="64e0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">输入和输出</h1><p id="fbed" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们的解释模型的输入将是-</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="4918" class="my lw it mu b gy mz na l nb nc"><strong class="mu iu">Supercharge your data science skills by building real world projects.</strong></span></pre><p id="31e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">带波束搜索的解释器输出(无约束):</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="66a6" class="my lw it mu b gy mz na l nb nc"><strong class="mu iu">1. By implementing real world projects, you can improve your data science skills. <br/>2. By implementing real world projects, you can boost your data science skills. <br/>3. By implementing real world projects, you can enhance your data science skills.</strong></span></pre><p id="48af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们用强制字<strong class="lb iu">【提高】</strong>，则转述输出带约束的光束，搜索结果是:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="e2cb" class="my lw it mu b gy mz na l nb nc"><strong class="mu iu">1. By implementing real world projects, you can improve your data science skills. <br/>2. By executing real world projects, you can improve your data science skills. <br/>3. Build real world projects to improve your data science skills.</strong></span></pre><p id="11f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以看到“<strong class="lb iu">improve”</strong>在每个句子中生成，因为我们限制了对它的波束搜索。</p><h1 id="86cd" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">项目</h1><p id="7b3e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">现在让我们进入项目的编码部分！这里，我们将使用我们上面讨论的文案示例，并使用约束波束搜索来解释我们的原始句子。</p><p id="fa99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里可以找到<a class="ae ky" href="https://colab.research.google.com/drive/1Xq7g8tTXDekL9DPKQXnhxsjCr7UqyUdT?usp=sharing" rel="noopener ugc nofollow" target="_blank"> colab笔记本</a>。</p><ol class=""><li id="0fe9" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated">在Google Colab中安装必要的库</li></ol><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="bf6d" class="my lw it mu b gy mz na l nb nc"><strong class="mu iu">!pip install -q sentencepiece<br/>!pip install -q transformers==4.18.0</strong></span></pre><p id="5a98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.下载我们为SaaS应用<a class="ae ky" href="https://questgen.ai/" rel="noopener ugc nofollow" target="_blank"> Questgen </a>训练的和开源的转述器模型。这个转述器只被训练来转述短句，所以适用于转述标题等。</p><p id="47a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将模型加载到GPU内存中。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="c15a" class="my lw it mu b gy mz na l nb nc"><strong class="mu iu">import torch</strong></span><span id="1d07" class="my lw it mu b gy nm na l nb nc"><strong class="mu iu">from transformers import AutoTokenizer, AutoModelForSeq2SeqLM</strong></span><span id="293d" class="my lw it mu b gy nm na l nb nc"><strong class="mu iu">model = AutoModelForSeq2SeqLM.from_pretrained("ramsrigouthamg/t5-large-paraphraser-diverse-high-quality")<br/>tokenizer = AutoTokenizer.from_pretrained("ramsrigouthamg/t5-large-paraphraser-diverse-high-quality")</strong></span><span id="0878" class="my lw it mu b gy nm na l nb nc"><strong class="mu iu">device = torch.device("cuda" if torch.cuda.is_available() else "cpu")<br/>print ("device ",device)<br/>model = model.to(device)</strong></span></pre><p id="953e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们运行波束搜索和约束波束搜索，输入句子<strong class="lb iu">“通过构建真实世界的项目来增强您的数据科学技能。”</strong>和force_word <strong class="lb iu">“提高”。</strong></p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="1cc7" class="my lw it mu b gy mz na l nb nc"><strong class="mu iu"># Copy writing example - Use a given word in paraphrasing</strong></span><span id="eccb" class="my lw it mu b gy nm na l nb nc"><strong class="mu iu">context = "Supercharge your data science skills by building real world projects."<br/>force_words = ["improve"]</strong></span><span id="8649" class="my lw it mu b gy nm na l nb nc"><strong class="mu iu">text = "paraphrase: "+context + " &lt;/s&gt;"</strong></span><span id="72c6" class="my lw it mu b gy nm na l nb nc"><strong class="mu iu">input_ids = tokenizer(text,max_length =128, padding=True, return_tensors="pt").input_ids<br/>input_ids = input_ids.to(device)</strong></span><span id="de48" class="my lw it mu b gy nm na l nb nc"><strong class="mu iu"># Beam search</strong></span><span id="b85a" class="my lw it mu b gy nm na l nb nc"><strong class="mu iu">outputs = model.generate(<br/>    input_ids,<br/>    num_beams=10,<br/>    num_return_sequences=3,<br/>    max_length=128,<br/>    early_stopping=True,<br/>    no_repeat_ngram_size=1,<br/>    remove_invalid_values=True,<br/>)</strong></span><span id="cbfd" class="my lw it mu b gy nm na l nb nc"><strong class="mu iu">print ("\nNormal beam search\n")<br/>print ("Original: ",context)<br/>for beam_output in outputs:<br/>    sent = tokenizer.decode(beam_output, skip_special_tokens=True,clean_up_tokenization_spaces=True)<br/>    print (sent)</strong></span><span id="5759" class="my lw it mu b gy nm na l nb nc"><strong class="mu iu"># Constrained Beam search</strong></span><span id="4106" class="my lw it mu b gy nm na l nb nc"><strong class="mu iu">force_words_ids = tokenizer(force_words, add_special_tokens=False).input_ids</strong></span><span id="30a8" class="my lw it mu b gy nm na l nb nc"><strong class="mu iu">outputs = model.generate(<br/>    input_ids,<br/>    force_words_ids=force_words_ids,<br/>    max_length=128,<br/>    early_stopping=True,<br/>    num_beams=10,<br/>    num_return_sequences=3,<br/>    no_repeat_ngram_size=1,<br/>    remove_invalid_values=True,<br/>)</strong></span><span id="c87b" class="my lw it mu b gy nm na l nb nc"><strong class="mu iu">print ("\nConstrained beam search\n")<br/>print ("Original: ",context)<br/>for beam_output in outputs:<br/>    sent = tokenizer.decode(beam_output, skip_special_tokens=True,clean_up_tokenization_spaces=True)<br/>    print (sent)</strong></span></pre><p id="17eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是输出结果:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="3207" class="my lw it mu b gy mz na l nb nc"><strong class="mu iu">Normal beam search</strong></span><span id="8956" class="my lw it mu b gy nm na l nb nc"><strong class="mu iu">Original:  Supercharge your data science skills by building real world projects.<br/>paraphrasedoutput: By implementing real world projects, you can improve your data science skills.<br/>paraphrasedoutput: By implementing real world projects, you can boost your data science skills.<br/>paraphrasedoutput: By implementing real world projects, you can enhance your data science skills.</strong></span><span id="b9af" class="my lw it mu b gy nm na l nb nc"><strong class="mu iu">Constrained beam search</strong></span><span id="3f71" class="my lw it mu b gy nm na l nb nc"><strong class="mu iu">Original:  Supercharge your data science skills by building real world projects.<br/>paraphrasedoutput: By implementing real world projects, you can improve your data science skills.<br/>paraphrasedoutput: By executing real world projects, you can improve your data science skills.<br/>paraphrasedoutput: Build real world projects to improve your data science skills.</strong></span></pre><p id="4c63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以看到，常规波束搜索的输出仅在生成的一个的<strong class="lb iu">中包含<strong class="lb iu">“改进”</strong>，而它出现在约束波束搜索生成的所有<strong class="lb iu">三个句子</strong>中。</strong></p><h1 id="a426" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论:</h1><p id="0fe1" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">条件文本生成一直是语言模型文本生成中的一个活跃的研究领域，我们希望将输出导向生成某些关键字或主题。随着在HuggingFace中引入约束波束搜索，我们已经向那个目标迈进了一步。</p><p id="f23b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在许多文本生成应用中，如翻译、图像字幕、释义等，我们经常会遇到在生成的输出文本中使用/保留某个关键字/关键短语的需要。</p><p id="eeaa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论是SEO还是文案，我们都需要在转述时保持某个关键字/关键短语不变，我们需要强制某个关键字出现以适应文案意图的语气，我们在本教程中已经看到了几个现实世界中的约束波束搜索用例。</p></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><p id="be39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">祝NLP探索愉快，如果你喜欢它的内容，请随时在Twitter上找到我。</p><p id="762d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想学习使用变形金刚的现代自然语言处理，看看我的课程<a class="ae ky" href="https://www.udemy.com/course/question-generation-using-natural-language-processing/?referralCode=C8EA86A28F5398CBF763" rel="noopener ugc nofollow" target="_blank">使用自然语言处理的问题生成</a></p></div></div>    
</body>
</html>