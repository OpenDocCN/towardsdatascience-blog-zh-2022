<html>
<head>
<title>Transformers for Tabular Data (Part 3): Piecewise Linear &amp; Periodic Encodings</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">表格数据转换器(第三部分):分段线性和周期编码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/transformers-for-tabular-data-part-3-piecewise-linear-periodic-encodings-1fc49c4bd7bc#2022-11-22">https://towardsdatascience.com/transformers-for-tabular-data-part-3-piecewise-linear-periodic-encodings-1fc49c4bd7bc#2022-11-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2428" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">先进的数字嵌入提高了性能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/26e80d64de4069b0a78515186472f9b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NolLttzuGCfgVrCb"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@pawel_czerwinski?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Pawel Czerwinski </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><h1 id="6298" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="c1c1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这是我探索表格数据转换器的第三部分。</p><ul class=""><li id="9d56" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm mu mv mw mx bi translated"><a class="ae ky" href="https://medium.com/towards-data-science/transformers-for-tabular-data-tabtransformer-deep-dive-5fb2438da820" rel="noopener">第 1 部分:TabTransformer </a></li><li id="304c" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/improving-tabtransformer-part-1-linear-numerical-embeddings-dbc3be3b5bb5">第 2 部分:具有线性数字嵌入的 FT-变压器</a></li></ul><p id="066a" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">在第 2 部分中，我描述了线性数字嵌入以及它们是如何在 FT-Transformer 模型中使用的。这篇文章将探索数字嵌入的更复杂的版本，所以如果你还没有阅读前一部分，我强烈建议从那里开始，然后再回到这篇文章。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/9a7812c4e28f7781e8ff0c712ebaa0b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cPHXGvupFmiX4JDGCT9W-g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">FT-变压器。图片作者。</p></figure><p id="2a35" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">提醒一下，上面你可以看到之前探索过的 FT-Transformer 的架构。该模型首先嵌入数字和分类特征，然后将这些嵌入通过变换器层，以获得最终的 CLS 令牌表示。</p><p id="4831" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">数字特征嵌入是一个相对较新的研究课题，这篇文章将深入探讨两种新提出的数字嵌入方法——分段线性编码和周期编码。Gorishniy 等人(2022)在名为<a class="ae ky" href="https://arxiv.org/pdf/2203.05556.pdf" rel="noopener ugc nofollow" target="_blank">关于表格深度学习</a>中数字特征的嵌入的论文中描述了这两种方法。看完这篇文章后，一定要去看看！</p><p id="1ab2" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">如果你对简单地应用这些方法感兴趣，那么去实用的<a class="ae ky" href="https://github.com/aruberts/TabTransformerTF/blob/main/notebooks/fttransformer-numerical-demo.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>看看，在那里我展示了如何用<code class="fe nh ni nj nk b">tabtransformertf</code> <a class="ae ky" href="https://github.com/aruberts/TabTransformerTF" rel="noopener ugc nofollow" target="_blank">包</a>来使用它们。如果你对这些方法实际上是如何工作的感兴趣，那么请继续阅读！</p><h1 id="f1d2" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">数字嵌入</h1><p id="7c96" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">数字嵌入层将单个浮点转换成密集的数字表示(嵌入)。这种转换很有用，因为这些嵌入可以与分类块一起通过 Transformer 块传递，从而增加了更多的学习内容。</p><h2 id="a700" class="nl la it bd lb nm nn dn lf no np dp lj ma nq nr ll me ns nt ln mi nu nv lp nw bi translated">线性嵌入</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/9fc6a0d1ed821bf5703c5159047af9ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ySvMMjT8TUVFnQ18.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">线性嵌入。图片作者。</p></figure><p id="d7f2" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">简单回顾一下，线性嵌入层是简单的全连接层(可选地具有 ReLU 激活)。这些图层之间不能共享权重，这一点很重要，因此每个数字要素都有一个嵌入图层。更多信息，请阅读<a class="ae ky" rel="noopener" target="_blank" href="/improving-tabtransformer-part-1-linear-numerical-embeddings-dbc3be3b5bb5">之前关于 FT-Transformer 的帖子</a>。</p><h2 id="e4d1" class="nl la it bd lb nm nn dn lf no np dp lj ma nq nr ll me ns nt ln mi nu nv lp nw bi translated">周期性嵌入</h2><p id="4996" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">周期性激活的想法现在在 ML 中相当流行。例如，Transformer 架构中的周期性编码允许模型表示单词在句子中的位置(您可以在此处阅读更多相关信息，例如<a class="ae ky" href="https://kikaben.com/transformers-positional-encoding/" rel="noopener ugc nofollow" target="_blank"/>)。但是如何将它应用于表格数据呢？Gorishniy 等人(2022)提出以下等式来编码特征<strong class="lt iu"> <em class="ny"> x </em> </strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/fcdd17f967d49d75e936eb53649b4387.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*gIp0n4AtW-wFIcyd_Hu3Dw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">周期性编码方程。资料来源:Gorishniy 等人(2022 年)</p></figure><p id="1b14" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">让我们试着解开这个方法。编码过程有三个主要步骤:</p><ol class=""><li id="b52e" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm oa mv mw mx bi translated">使用学习向量(<strong class="lt iu"> <em class="ny"> c </em> </strong>)转换为预激活值(<strong class="lt iu"> <em class="ny"> v </em> </strong>)</li><li id="277a" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm oa mv mw mx bi translated">使用正弦和余弦激活值(<strong class="lt iu"> <em class="ny"> v </em> </strong></li><li id="2ab8" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm oa mv mw mx bi translated">正弦值和余弦值的串联</li></ol><p id="806a" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">第一步是学习发生的地方。特征的原始值乘以学习参数<strong class="lt iu"> <em class="ny"> c_i </em> </strong>，其中<em class="ny"> i </em>是嵌入的维度。因此，如果我们选择嵌入维数为 3，那么每个特征将有 3 个参数要学习。</p><p id="3a44" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">作为说明性示例，考虑下面随机生成的特征。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/767ccd04b839444f7cc7ccb13d5a88df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*Q3TW9mN6Phqa5D6TU8qSkQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">随机特征分布。由作者策划。</p></figure><p id="a1ea" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">使用三个不同的<strong class="lt iu"> <em class="ny"> c </em> </strong>参数，我们可以将其转换为三个预激活值(即维数为 3 的嵌入)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/b4980e7a690550e72b09907e428d09dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N_CDri6isNCHUrugZAQM9w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">随机特征的周期性预激活嵌入。由作者策划。</p></figure><p id="2162" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">然后，使用正弦和余弦运算将这些激活前值转换为激活后值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/d18c04c03788fe8f064bcf66f174e348.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0yrdOBPLFXo6j7SClHz4oA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">随机特征的周期性后激活嵌入。由作者策划。</p></figure><p id="f2b7" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">如你所见，斜率影响周期性激活频率。斜率较大的预激活(蓝线)具有频率较高的后激活值。另一方面，斜率较小的预激活值(绿色和橙色线)会导致低频激活。从上图判断，<code class="fe nh ni nj nk b">1</code>的特征值大概会被编码为<code class="fe nh ni nj nk b">[-0.98, -0.90, 0.85]</code>,<code class="fe nh ni nj nk b">-1</code>会被编码为<code class="fe nh ni nj nk b">[0.97, 0.8, -0.9]</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/60e0221f4b2888d52aa66735c030a8e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-WkxNLUUeh02maXsvPVg2A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">周期性嵌入。图片作者。</p></figure><p id="ed6f" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">作者还建议在周期性编码的基础上添加一个额外的线性层，这样最终的嵌入图看起来如上所示。</p><h2 id="86bf" class="nl la it bd lb nm nn dn lf no np dp lj ma nq nr ll me ns nt ln mi nu nv lp nw bi translated">分段线性编码(分位数宁滨)</h2><p id="b58b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这种嵌入方法从 one-hot-encoding(一种流行的分类编码方法)中获得灵感，并使其适应数字特征。该过程的第一步是将一个特征分割成<strong class="lt iu"> <em class="ny"> t </em> </strong>个箱。作者提出了两种分割方法——分位数法和目标宁滨法。本节描述第一种方法，第二种方法将在后面介绍。</p><p id="5f28" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">分位数宁滨相对简单-我们将特征分成<strong class="lt iu"> <em class="ny"> t </em> </strong>等宽的条柱。例如，如果我们想要以 3 个箱结束(即<strong class="lt iu"> <em class="ny"> t = 3 </em> </strong>)，我们要计算的分位数是— <code class="fe nh ni nj nk b">0, 0.33, 0.66, 1.0</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/b2d038614056720429b4514827cc4a7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*AyzH25q4OMWyUwdFkh_fwg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">随机特征的分位数宁滨。由作者策划。</p></figure><p id="4ac7" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">每个分位数(<strong class="lt iu"> <em class="ny"> Bt </em> </strong>)被表示为一个元组— <code class="fe nh ni nj nk b">[bin_start, bin_end)</code>，所以在这种情况下，我们最终有 3 个箱— <code class="fe nh ni nj nk b">[-3.85, -0.41), [-0.41, 0.44), [0.44. 3.26)</code>。这种表示的公式符号如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/e06235105db77c686829f209c5b63353.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*fo-s4WKWCCVghoXSDAKrEA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">宾斯公式符号。资料来源:Gorishniy 等人(2022 年)</p></figure><p id="f9e7" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">一旦我们获得了这些箱，我们就可以开始对特征进行编码。编码公式如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/06378fc3625dbe3cf656fd3248140e77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*5IsXYZN0f9KWvooJmbIqPQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">PLE 公式。资料来源:Gorishniy 等人(2022 年)</p></figure><p id="ed63" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">正如你所看到的，对于每个值，我们都将以一个<strong class="lt iu"> <em class="ny"> t </em> </strong>维嵌入结束。总共有 3 个选项——0、1 或介于两者之间。对每个 bin 和每个值应用此公式后，我们的嵌入结果如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/79faf1ec1ed3c4cbc53bfb66b12443f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X1269ZgTwIPzoYxBt6lFZw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">随机特征的 PLE 嵌入。由作者策划。</p></figure><p id="e63b" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">正如你所看到的，较小的值只有一个“活动嵌入”(PLE 1)，在中间我们得到 PLE 2 活跃。最后，在最后一个 bin 中，所有三个嵌入都被激活。这样，<code class="fe nh ni nj nk b">-1</code>的值近似变成了<code class="fe nh ni nj nk b">[0.8, 0.0, 0.0]</code>，而<code class="fe nh ni nj nk b">1</code>变成了<code class="fe nh ni nj nk b">[1.0, 1.0, 0.2]</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/4e34e604462afa480778c7773c60ca68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1pZP1nY9TxUzutGsPnvYRA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">分位数宁滨的 PLE 嵌入。图片作者。</p></figure><h2 id="9012" class="nl la it bd lb nm nn dn lf no np dp lj ma nq nr ll me ns nt ln mi nu nv lp nw bi translated">目标宁滨方法</h2><p id="9488" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">目标宁滨包括使用决策树算法来帮助构建箱。正如我们在上面看到的，分位数方法将我们的要素分割成等宽的条柱，但在某些情况下可能不是最佳的。决策树将能够找到关于目标的最有意义的分割。例如，如果有更多的目标方差朝向更大的要素值，则大多数条柱可能会向右移动。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/a1f45933cac2c39b75784e216234bdd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ut-u56SaEjYlx_eBYyJBug.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">PLE 嵌入目标宁滨。图片作者。</p></figure><h1 id="76e8" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">报告的结果</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/65d55e63ec9fb4b46a013b2b3ef517db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uxOISg58QVVwtTzlDGeQJg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Gorishniy 等人(2022 年)报告的结果摘录</p></figure><p id="3345" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">本文结合 MLP、雷斯内特和变压器架构，对所有提出的嵌入方法进行了广泛的比较研究。本表中<strong class="lt iu"> L </strong>代表线性，<strong class="lt iu"> Q </strong>代表分位数，<strong class="lt iu"> T </strong>代表目标，<strong class="lt iu"> LR </strong>代表带 ReLu 的线性，<strong class="lt iu"> P </strong>代表周期性。</p><p id="6797" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">从上表可以看出，整个数据集没有唯一的赢家(没有免费的午餐定理在起作用)，因此嵌入类型可能被视为另一个要优化的超参数。然而，当我们将周期和 PLE 编码与简单的线性嵌入进行比较时，大多数时候我们会看到性能的显著提高。</p><h1 id="4431" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">验证结果</h1><p id="03e5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们看看是否可以在一个流行的玩具数据集上重现本文的结果——California Housing。你可以在这里看到完整的工作笔记本<a class="ae ky" href="https://github.com/aruberts/TabTransformerTF/blob/main/notebooks/fttransformer-numerical-demo.ipynb" rel="noopener ugc nofollow" target="_blank"/>，而下面我将介绍建模所需的主要部分。像以前的帖子一样，我将使用我的<code class="fe nh ni nj nk b">tabtrasnformertf</code> <a class="ae ky" href="https://github.com/aruberts/TabTransformerTF" rel="noopener ugc nofollow" target="_blank">包</a>(如果你喜欢，请给它一个星形⭐️)，你可以使用命令<code class="fe nh ni nj nk b">pip install -U tabtransformertf</code>轻松安装(或更新)它。</p><h2 id="7c1e" class="nl la it bd lb nm nn dn lf no np dp lj ma nq nr ll me ns nt ln mi nu nv lp nw bi translated">数据下载和预处理</h2><p id="0cbd" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们可以使用<code class="fe nh ni nj nk b">sklearn</code>玩具数据库下载数据。预处理过程非常简单——进行 train/val/test 分割，缩放数据并将其转换为 TF 数据集。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="af81" class="nl la it bd lb nm nn dn lf no np dp lj ma nq nr ll me ns nt ln mi nu nv lp nw bi translated">周期性嵌入</h2><p id="7f9b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要使用周期性嵌入，您只需在<code class="fe nh ni nj nk b">numerical_embedding_type</code>参数中指定即可。所有其他参数我已经在<a class="ae ky" rel="noopener" target="_blank" href="/improving-tabtransformer-part-1-linear-numerical-embeddings-dbc3be3b5bb5">之前的</a>帖子中介绍过了，所以如果你有任何问题，请参考一下。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="137b" class="nl la it bd lb nm nn dn lf no np dp lj ma nq nr ll me ns nt ln mi nu nv lp nw bi translated">具有分位数宁滨嵌入的 PLE</h2><p id="3e3a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">同样的程序适用于 PLE 分位数嵌入。您唯一需要更改的是将<code class="fe nh ni nj nk b">numerical_embedding_type</code>参数设置为<code class="fe nh ni nj nk b">ple</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="4ca9" class="nl la it bd lb nm nn dn lf no np dp lj ma nq nr ll me ns nt ln mi nu nv lp nw bi translated">PLE 与目标宁滨嵌入</h2><p id="682b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果您更喜欢使用基于目标的宁滨，而不是分位数，则需要指定几个附加参数。</p><ul class=""><li id="12b3" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm mu mv mw mx bi translated">需要为决策树训练提供目标(参数<code class="fe nh ni nj nk b">y</code>)。</li><li id="75b4" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">需要指定决策树<code class="fe nh ni nj nk b">task</code>，可以是<code class="fe nh ni nj nk b">regression</code>也可以是<code class="fe nh ni nj nk b">classification</code>。</li><li id="ea78" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">也可以指定额外的决策树参数(<code class="fe nh ni nj nk b">ple_tree_params</code>)(可选)</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><h1 id="dd34" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">FT 变压器培训</h1><p id="b129" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您可以像任何其他 Keras 模型一样使用嵌入来训练 FT 转换器。下面你可以看到训练其中一个模型的代码，但是同样的步骤也适用于其余的模型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><h1 id="c178" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">估价</h1><p id="3dae" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">既然模型已经训练好了，我们可以将它们相互比较，与基线比较，与论文中报告的结果比较。请记住，这里报告的数字只是针对单个模型运行和训练/测试分割，因此您的结果很可能会有所不同(但相对性能应该大致相同)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/061bc0f6a38c0ebc817fbdb9e49dab2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*im7f89tyBTdkshhS-skEYw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">验证损失历史。由作者生成。</p></figure><p id="a09b" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">如您所见，对于这个特定的数据集，使用更复杂的数字嵌入有巨大的价值。具有 PLE 嵌入的 FT-变压器给出最好的结果，其次是周期性嵌入。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/4b2e21bc067a8d1ec86c3f2c5acf7b01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AAYevDaSQBHoLCKmmQSHCw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">按模型划分的 RMSE 指标。由作者生成。</p></figure><p id="85de" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">当我们将结果与两个基于树的模型(Random Forest 和 CatBoost)进行比较时，我们可以看到，具有 PLE 嵌入的 FT 转换器优于第一个，并接近第二个的性能。鉴于数据集很小，而且深度学习不太友好，这是非常令人印象深刻的。</p><p id="9d81" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">观察到的性能比论文中报道的性能差。这很可能是由于次优超参数或实现中的差异。此外，论文中报告的结果是多次运行的平均值，因此这也可以解释一些变化。</p><h1 id="2488" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="d6ab" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这篇文章中，我们探索了两种强大的数字嵌入方法——周期编码和分段线性编码。你看到了它们如何转换数字特征，以及如何使用<code class="fe nh ni nj nk b">tabtransformertf</code>包将它们用于 FT-Transformer。</p><p id="bb53" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">虽然这两种方法在嵌入数字特征时应用了非常不同的逻辑，但它们都可以极大地提高深度学习模型的性能。这些方法的主要缺点是模型可能需要更长的时间来训练，但在 GPU 上这种差异可以忽略不计。所以在你的数据集上尝试一下，让我知道效果如何！</p><h1 id="4a32" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">文献学</h1><ul class=""><li id="889a" class="mn mo it lt b lu lv lx ly ma oq me or mi os mm mu mv mw mx bi translated">加州住房数据集；佩斯，r .凯利和罗纳德·巴里，稀疏空间自回归，统计和概率信，33(1997)291–297(CC0:公共领域)</li><li id="4df8" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">Gorishniy 等人，2022 年，<a class="ae ky" href="https://arxiv.org/abs/2203.05556" rel="noopener ugc nofollow" target="_blank">关于表格深度学习中数字特征的嵌入</a></li></ul></div></div>    
</body>
</html>