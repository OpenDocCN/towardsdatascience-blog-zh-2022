<html>
<head>
<title>The Ultimate Guide to PDPs and ICE Plots</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PDP和ICE绘图的最终指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-ultimate-guide-to-pdps-and-ice-plots-4182885662aa#2022-06-28">https://towardsdatascience.com/the-ultimate-guide-to-pdps-and-ice-plots-4182885662aa#2022-06-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d527" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><strong class="ak">部分依赖图和个体条件期望图背后的直觉、数学和代码(R和Python)</strong></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/008885ea46e847c74a330aa84b15d791.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XXLRHV_3L8JFx6LxLQCmbw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(来源:作者)</p></figure><p id="6f07" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">PDP和ICE图都可以帮助我们理解我们的模型如何做出预测。</p><p id="9dfa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用<strong class="la iu">PDP</strong>，我们可以可视化模型特征和目标变量之间的关系。他们能告诉我们一段关系是线性的、非线性的还是没有关系。</p><p id="77f2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">类似地，<strong class="la iu"> ICE Plots </strong>可以在特征之间存在交互时使用。我们将深入研究这两种方法。</p><p id="d945" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们从<strong class="la iu">PDP</strong>开始。我们将带您<strong class="la iu">一步步</strong>了解PDP是如何创建的。你会发现它们是一种直观的方法。即便如此，我们也要解释一下PDP背后的<strong class="la iu">数学</strong>。然后我们继续前进到<strong class="la iu">冰原</strong>。您将会看到，如果对PDP有很好的了解，这些都很容易理解。在此过程中，我们讨论了这些方法的不同应用和变体，包括:</p><ul class=""><li id="b1f7" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">连续和分类特征的PDP和ICE图</li><li id="c8fb" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">二元目标变量的PDP</li><li id="2b94" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">2个型号特性的PDP</li><li id="8eb3" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">衍生PDP</li><li id="b556" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">基于PDP和ICE图的特征重要性</li></ul><p id="2abb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们一定要讨论这两种方法的<strong class="la iu">优点</strong>和<strong class="la iu">局限性</strong>。这些是重要的部分。它们帮助我们理解什么时候方法是最合适的。它们还告诉我们在某些情况下它们会导致不正确的结论。</p><p id="5e8a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，我们将带您浏览这些方法的<strong class="la iu"> R和Python代码</strong>。对于R，我们应用<a class="ae mi" href="https://cran.r-project.org/web/packages/ICEbox/ICEbox.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="la iu">冰箱</strong> </a>和<a class="ae mi" href="https://cran.r-project.org/web/packages/iml/iml.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="la iu"> iml </strong> </a>包来创建可视化。我们还使用<a class="ae mi" href="https://www.rdocumentation.org/packages/vip/versions/0.3.2" rel="noopener ugc nofollow" target="_blank"> <strong class="la iu"> vip </strong> </a>来计算特征重要性。对于Python，我们将使用scikit-learn的实现，<a class="ae mi" href="https://scikit-learn.org/stable/modules/generated/sklearn.inspection.PartialDependenceDisplay.html" rel="noopener ugc nofollow" target="_blank"><strong class="la iu">partialdependicedisplays</strong></a>。您可以在这些部分找到带有代码的GitHub repos的链接。</p><h1 id="d688" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">部分相关图</h1><p id="2f82" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">我们从PDP的逐步演示开始。为了解释这种方法，我们随机生成了一个包含1000行的数据集。它包含了二手车销售的细节。你可以在<strong class="la iu">表1 </strong>中看到这些特性。我们希望使用前5个特征来预测汽车的<strong class="la iu">价格</strong>。你可以在<a class="ae mi" href="https://www.kaggle.com/datasets/conorsully1/pdp-and-ice-plots" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上找到这个数据集。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/6fbdf109d29a1ee4435a14d99a19dec7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fv-TIs2sN-nJqCMje1Av2Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">表1:二手车销售数据集概述(来源:作者)(数据集:<a class="ae mi" href="https://www.kaggle.com/datasets/conorsully1/pdp-and-ice-plots/settings" rel="noopener ugc nofollow" target="_blank"> kaggle </a>)(牌照:CC0)</p></figure><p id="f2ed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了预测价格，我们首先需要使用该数据集训练一个模型。在我们的例子中，我们用100棵树训练了一个随机的森林。确切的模型并不重要，因为PDP是一种<a class="ae mi" rel="noopener" target="_blank" href="/what-are-model-agnostic-methods-387b0e8441ef">模型不可知的</a>方法。我们现在将看到它们是使用模型预测构建的。我们不考虑模型的内部运作。这意味着我们探索的可视化将类似于随机森林、XGBoost、神经网络等…</p><p id="3fa0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<strong class="la iu">表2 </strong>中，我们的数据集中有一个观察值用于训练模型。在最后一列中，我们可以看到这辆车的预测价格。为了创建PDP，我们改变其中一个特性的值，并记录结果预测。例如，如果我们改变<strong class="la iu">汽车年龄</strong>，我们将得到不同的预测。我们这样做的同时保持其他特性的真实值不变。例如，<strong class="la iu">车主_年龄</strong>将保持在19，<strong class="la iu"> km_drive </strong>将保持在27544。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/b7eaa1255af5abf5cd390b73c9e84496.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zh1h8FPufDdTdaX148taGw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">表2:训练数据和预测示例(来源:作者)</p></figure><p id="f015" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看<strong class="la iu">图1 </strong>，可以看到这个过程的结果。这显示了针对该特定观察的<strong class="la iu">预测价格</strong>(部分yhat)和<strong class="la iu">车龄</strong>之间的关系。你可以看到，随着车龄的增加，预测价格下降。黑点给出原预测价格(<strong class="la iu"> 4，654 </strong>)和car_age ( <strong class="la iu"> 4.03 </strong>)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/43fb61ff71b88acb1084e5028b898ecd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q38TsuaaPeHEnOAx_C-8Qw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1:观察1中不同车龄的预测价格(来源:作者)</p></figure><p id="4845" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，我们对数据集中的每个观察值或观察值子集重复这个过程。在<strong class="la iu">图2 </strong>中，可以看到100次观测的预测线。为了清楚起见，对于每个观察，我们只改变了<strong class="la iu">车龄</strong>。我们将剩余的特征保持在它们的原始值不变。这些值与我们在<strong class="la iu">表2 </strong>中看到的值不同。这就解释了为什么每一行的起点都不同。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/0d920fc2adc60f4d7986cc0aa71e2dc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1tSVJQqnfEyrAvjNErIoCA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2:100次观察的预测线(来源:作者)</p></figure><p id="7c79" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要创建PDP，最后一步是计算<strong class="la iu">汽车年龄</strong>的每个值的平均预测值。这给了我们<strong class="la iu">图3 </strong>中的粗黄线。这条线是PDP。通过保持其他特征不变并对观察值进行平均，我们能够分离出与car_age的关系。我们可以看到，预测价格会随着车龄的增长而下降。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/ca90dbb961579f0dabe4040b478bd23f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*84P0AwtwYZ6ywiAnTFiQbw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3:汽车时代的部分依赖图(来源:作者)</p></figure><p id="b68f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可能已经注意到了x轴上的短线。这些是<strong class="la iu">汽车时代</strong>的四分位数。也就是说，10%的car_age值小于第一行，90%小于最后一行。这就是所谓的地毯阴谋。它向我们展示了特征的分布。在这种情况下，car_age的值在其范围内相当均匀地分布。当我们讨论PDP的局限性时，我们将理解为什么这是有用的。</p><p id="05a1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可能还注意到，并非所有的预测线都遵循PDP趋势。一些较高的线似乎增加了。这表明，对于这些观察，价格与车龄有相反的关系。也就是说，预测的价格会随着车龄的增加而增加。请记住这一点。当我们讨论冰的情节时，我们将会回来。</p><h2 id="d990" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">PDP背后的数学</h2><p id="b6ce" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">对于更注重数学的人来说，PDP也有一个正式的定义。让我们从刚刚创建的PDP函数开始。这由<strong class="la iu">等式1 </strong>给出。集合C将包含除car_age之外的所有特征。对于给定的<strong class="la iu"> car_age </strong>值和观察值I，我们使用c中特性的原始值找到预测价格。我们对所有100个观察值都这样做，并找到平均值。这个等式将给出我们在<strong class="la iu">图3 </strong>中看到的粗黄线。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/8dfc19867ab3363a838aa964670daa85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ww8ok_ptVYy_3p1HH5vDlQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">等式car _ age的PD函数(来源:作者)</p></figure><p id="f08d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<strong class="la iu">等式2 </strong>中，我们对上述等式进行了推广。这是一组特征的PD函数。S. C将包含除s中的特征之外的所有特征。我们现在还对n次观察进行平均。这可以达到数据集中的观察总数(即1000)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/40532d6b6f90d208e36c0afd15009857.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EeY0h-0hgpnj87a_lgKcFQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">等式2:特征集S的近似PD函数(来源:作者)</p></figure><p id="f106" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">到目前为止，我们只讨论了S由一个特征组成的情况。在上一节中，我们有S = {car_age}。稍后，我们将向您展示包含2项功能的PDP。我们通常不会在s中包含超过2个特征，否则，将很难可视化PD功能。</p><p id="19fc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上述等式实际上只是PD函数的近似。真正的数学定义在<strong class="la iu">等式3 </strong>中给出。对于集合S中的给定值，我们找到了集合c中的预期预测值。为此，我们需要将模型函数w.r.t .与观察到集合c中的值的概率进行积分。要完全理解此方程，您需要一些随机微积分方面的经验。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/f4a65fa61c5c8a527eb76f30396483a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K-ELmfxQ-YlfDXQ0c3n2gA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">等式3:特征集S的PD函数(来源:作者)</p></figure><p id="fdc0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用PDP时，对近似值的理解就足够了。真正的PD功能实现起来并不实际。首先，与近似法相比，它的实现在计算上更加昂贵。其次，考虑到我们有限的观测数据，我们只能估算出大概的概率。也就是说，我们无法找到每个观察值的真实概率。最后，许多模型不是连续的函数，这使得它们很难集成。</p><h2 id="a9b2" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">连续功能的PDP</h2><p id="7795" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">了解我们如何创建PDP后，我们将继续使用它们。使用这些图我们可以理解模型特征和目标变量之间关系的<strong class="la iu"> </strong>本质。比如我们已经在<strong class="la iu">图4 </strong>中看到了<strong class="la iu"> car_age </strong> PDP。预测价格以相当稳定的速度下降。这表明car_age与价格有一个线性关系。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/230d143bf65338e36612d847ec638564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*COcA5F4mmZ28juZ2-O3hfw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4:汽车时代PDP(来源:作者)</p></figure><p id="e8c3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<strong class="la iu">图5 </strong>中，我们可以看到另一个特性的PDP，<strong class="la iu">修复</strong>。这是汽车接受维修/服务的次数。最初，预测价格往往会随着维修次数的增加而增加。我们希望一辆可靠的汽车接受一些定期保养。然后在6/7修左右，价格趋于降低。过度维修可能说明车有问题。由此我们可以看出，价格与维修之间存在<strong class="la iu">非线性关系</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/f799fdaa549807ee432bcfa5b14f3a57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uYIwlejo2qI_Kgrl8437Sw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图5:维修PDP(来源:作者)</p></figure><p id="34eb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从上面，我们可以看到PDP在<strong class="la iu">可视化</strong>非线性关系时是有用的。我们将在下面的文章中更深入地探讨这个话题。在处理许多功能时，查看所有PDP可能不切实际。所以我们也讨论使用互信息和特征重要性来帮助<strong class="la iu">找到</strong>非线性关系。</p><div class="nx ny gp gr nz oa"><a rel="noopener follow" target="_blank" href="/finding-and-visualising-non-linear-relationships-4ecd63a43e7e"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">发现并可视化非线性关系</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">用部分相关图(PDP)、互信息和特征重要性分析非线性关系</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">towardsdatascience.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo ks oa"/></div></div></a></div><p id="d631" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<strong class="la iu">图6 </strong>中，我们可以看到一个特性与目标变量没有关系时的PDP示例。对于<strong class="la iu">车主年龄</strong>，PDP保持不变。这告诉我们，当我们改变所有者年龄时，预测价格不会改变。稍后，我们将看到如何使用PDP变化的思想来创建特性重要性分数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/5a203216233ac9771fc8f37692e0f0ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BYijgRe5h5bQ2UEaQRgqQA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图6: owner_age PDP(来源:作者)</p></figure><h2 id="7528" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">分类特征的PDP</h2><p id="706b" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">我们上面讨论的特征都是连续的。我们还可以为分类特征创建PDP。例如，参见图7 中<strong class="la iu">的<strong class="la iu"> car_type </strong>的绘图。这里我们计算每种汽车的平均预测值——普通型(0)或经典型(1)。我们用柱状图来代替直线。我们可以看到，老爷车往往售价更高。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/f6c67fea009369c4d238995d66463856.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b3NuNdNqWVZC_NoTFGXJxQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图7: car_type PDP(来源:作者)</p></figure><h2 id="4baa" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">二元目标变量的PDP</h2><p id="c02e" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">二元目标变量的PDP与连续目标的PDP相似。假设我们想预测汽车价格是高于(1)平均值还是低于(0)平均值。我们构建了一个随机森林，使用相同的特征来预测这个二进制变量。我们可以使用与之前相同的流程为此模型创建PDP。只不过现在我们的预测是一种可能性。</p><p id="eff0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">比如在<strong class="la iu">图8 </strong>中，可以看到car_age的PDP。我们现在在y轴上有一个预测的概率。这是汽车高于二手车平均价格的概率。我们可以看到，随着车龄的增长，概率有降低的趋势。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/6d1e1ece61360efaa8409d32f150645f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C3VOMwUhBA0RodIo5V9ZAg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图8:二元目标变量的PDP(来源:作者)</p></figure><h2 id="cf38" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">两个功能的PDP</h2><p id="3249" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">回到我们的连续目标变量。我们还可以看到两个特性的PDP。在<strong class="la iu">图9 </strong>中，我们可以看到<strong class="la iu"> km_driven </strong>和<strong class="la iu"> car_age </strong>不同组合下的平均预测值。该图表的创建方式与一个特性的PDP相同。也就是说，保持其余特征的原始值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/0877513d72af351706c50322486e5937.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wS8FBm7YpCByw9YDI6WxBA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图9: 2专题PDP(来源:作者)</p></figure><p id="0d1d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些PDP对于可视化功能之间的交互非常有用。上图显示了行驶里程和车龄之间可能的相互作用。也就是说，当两个特性的值都较大时，预测价格往往会较低。在得出这些类型的结论时，你应该谨慎。</p><p id="e2a1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是因为如果两个特征相关，我们可以得到相似的结果。稍后，当我们讨论PDP的局限性时，将会看到事实确实如此。即行驶里程与车龄相关。车越老，行驶里程越多。这就是为什么当两种特性都较高时，我们会看到较低的预测价格。</p><h2 id="d2b4" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">衍生PDP</h2><p id="fcf3" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">衍生PDP是PDP的变体。它显示了PDP的斜率/导数。它可用于更好地理解原始PDP。然而，在大多数情况下，我们从这些情节中获得的洞察力是有限的。它们通常对非线性关系更有用。</p><p id="c903" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，以<strong class="la iu">图10 </strong>中的维修衍生PDP为例。这是我们之前在<strong class="la iu">图5 </strong>中看到的线的导数。我们可以看到，在大约6次修复时，导数为0。此时，导数由正变负。换句话说，最初的PDP从增加到减少w.r.t .维修。这告诉我们，经过6次修理后，汽车的价格将会下降。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/77f47415034d5c96feae32a238b7ad79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qXt2TFfMqSwAB6J1vuSx_g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图10:维修衍生PDP(来源:作者)</p></figure><h2 id="69cc" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">PDP功能重要性</h2><p id="a984" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">在结束这一部分时，我们有一个基于PDP的功能重要性分数。这是通过确定每个特性的PDP的“平坦度”来实现的。具体来说，对于连续变量，我们计算绘图值的标准偏差。对于分类变量，我们通过首先取范围来估计标准差。即最大值减去最小PDP值。然后我们将范围除以4。这个计算来自一个叫做范围规则的概念。</p><p id="b7c9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以在<strong class="la iu">图11 </strong>中看到基于PDP的功能对我们功能的重要性。请注意，owner_age的分数相对较低。如果我们回想一下图6 中的PDP，这是有意义的。我们看到PDP相对稳定。换句话说，y轴值总是接近它们的平均值。它们的标准差很低。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/167b04b779696b87165c68f1bea6122e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UOF2hNa0mgFYdyY3nyWjXw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图11:基于PDP的特性重要性(来源:作者)</p></figure><p id="2f8d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有更广为人知的特征重要性分数，例如排列特征重要性。您可能更喜欢使用这种基于PDP的评分，因为它可以提供一定的一致性。如果您正在分析要素趋势，现在可以使用通过类似逻辑计算的要素重要性分数。你也可以避免解释两种不同方法的逻辑。</p><h1 id="48c0" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">个体条件期望(ICE)图</h1><p id="3c02" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">随着PDP的方式，让我们继续到冰图。您会很高兴地知道，我们已经讨论了创建它们的过程。取<strong class="la iu">图12 </strong>下图。这是我们在<strong class="la iu">图3 </strong>中的car_age PDP之前创建的图。这是一个汽车时代的<strong class="la iu">冰图</strong>。冰图由每个单独观测的预测线组成。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/e719a6479bdb54a477129509c40568ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aR2-TGmcQKa8SALNEhGKvg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图12:汽车时代的冰图(来源:作者)</p></figure><p id="dfa7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当模型中存在交互时，冰图非常有用。也就是说，一个特征与目标变量的关系取决于另一个特征的值。在上图中可能很难看出这一点。为了使事情更清楚，我们可以把我们的冰图放在中间。在<strong class="la iu">图13 </strong>中，我们通过让所有预测线从0开始来实现这一点。现在很清楚，根据一些观察，预测的价格会随着车龄的增加而增加。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/29541a1b7370fbee7ab219cc4e3c9b80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9MDnl15Z6jpHwtFRUgp-xA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图13:中心冰图(来源:作者)</p></figure><p id="db43" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了理解是什么导致了这种行为，我们可以改变冰图的颜色。在<strong class="la iu">图14 </strong>中，我们根据汽车类型改变了颜色。我们把老爷车的线弄成蓝色，普通车的线弄成红色。我们现在可以看到，这种关系来自于car_age和car_type之间的交互。凭直觉，一辆老爷车随着年龄的增长会升值是有道理的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/5367690bd29bde0fe495909527a67804.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lYsimrft0lBMTU5DTFcX7g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图14:彩色冰图(来源:作者)</p></figure><p id="b292" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后一项添加是将PDP线添加到图中。这样，我们就可以将ICE图和PDP结合起来。这可以强调一些观察结果如何偏离平均趋势。我们可以看到，如果我们只依赖PDP，我们将会错过这种互动。也就是说，当使用<strong class="la iu">图3 </strong>中的PDP时，我们得出的结论是，所有汽车的价格都会随着车龄的增长而下降。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/1e626522f57cb529c8d71adb8ff87594.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ijsFD7jMb65MOCAFbvKfvA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图15:PDP和ICE的组合图(来源:作者)</p></figure><p id="dcae" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">与PDP一样，ICE图可以帮助我们可视化数据中的重要关系。为了找到这些关系，我们可能需要使用像特性重要性这样的指标。另一种专门用于突出模型中交互作用的度量是弗里德曼的H-统计量。我们将在下面的文章中讨论使用所有这些方法。</p><div class="nx ny gp gr nz oa"><a rel="noopener follow" target="_blank" href="/finding-and-visualising-interactions-14d54a69da7c"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">发现和可视化交互</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">使用特征重要性、弗里德曼的H-统计量和ICE图分析相互作用</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">towardsdatascience.com</p></div></div><div class="oj l"><div class="or l ol om on oj oo ks oa"/></div></div></a></div><h2 id="2f7d" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">分类特征的冰图</h2><p id="47e7" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">我们可以用箱线图来显示分类特征的冰图。例如，我们在<strong class="la iu">图16 </strong>中有<strong class="la iu"> car_type </strong>的ICE图。方框中间的粗线给出了平均预测值。换句话说，他们就是PDP。我们可以看到普通汽车的预测价格更低(0)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/52dc0d2effc1159df2c9c041d21e0e81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PJpwK8xCSuS4646-qH-Gaw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图16: car_type ICE情节(来源:作者)</p></figure><h2 id="fb9d" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">基于ICE图的特征重要性</h2><p id="383b" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">我们还可以计算基于ICE图的特征重要性分数。这类似于基于PDP的评分，只是我们不再考虑平均预测线。我们现在使用单独的预测线来计算分数。这意味着分数将考虑特征之间的相互作用。</p><p id="f246" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在图17 中，我们有我们的模型的基于ICE图的分数。我们可以将这些与<strong class="la iu">图11 </strong>中基于PDP的分数进行比较。最大的不同是汽车时代的分数现在更大了。从300增加到345。根据我们上面的分析，这是有意义的。我们看到了影响车龄和价格之间关系的交互作用。基于PDP的特征重要性不考虑这种相互作用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/2ca67d5594d579bef491385b146affcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IfY0fIPsTkmOI6OC7ary2g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图17:基于ICE图的特征重要性(来源:作者)</p></figure><h1 id="da35" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">PDP和ICE图的优势</h1><p id="ce98" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">到目前为止，希望我们已经很好地理解了PDP和ICE图，以及我们可以从中获得的见解。我们将继续讨论这些方法的优势。然后在下一节中，我们将讨论其局限性。理解这些是至关重要的，这样你就不会从图中得出不正确的结论。</p><h2 id="1593" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">隔离功能趋势</h2><p id="c41c" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">我们可以使用散点图来可视化数据中的关系，但数据是杂乱的。例如，我们可以在<strong class="la iu">图18 </strong>中看到car_age和car_type之间的交互作用。这些点围绕真正的潜在趋势而变化。这是因为统计噪声和价格与其他特征也有关系的事实。在真实的数据集中，这个问题可能会更严重。最终，很难看出数据的趋势。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/0b7257c8573932851a541bc65bb72929.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4CtRCBE_5_25KK0aFQX3Vw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图18:汽车年龄和汽车类型交互的散点图(来源:作者)</p></figure><p id="a85b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用PDP和ICE图时，我们不再使用原始数据值。我们正在研究模型预测。如果构建正确，模型将捕捉数据中的潜在关系，并忽略统计噪声。然后，我们可以分离出特定特征的趋势。这是通过保持其他特征值不变并对观察值进行平均来实现的。</p><p id="4623" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这就是PDP和ICE图如此有用的原因。它们允许我们去除噪声和其他特征的影响。这使得我们更容易看到数据中的潜在关系。在这个意义上，这些方法可以用于数据探索，而不仅仅是理解我们的模型。</p><h2 id="f6a9" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">开门见山地解释</h2><p id="b18f" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">希望通过向您介绍构建PDP的过程，您会很容易理解。这样，你就可以获得对该方法的直观理解，而不需要一个数学定义。这也意味着这些方法很容易向非技术人员解释。这在工业环境中很有用。</p><h2 id="65ac" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">易于实施</h2><p id="a2fe" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">这些方法也很容易实现。我们只需要改变特征值并记录结果预测。我们甚至不需要考虑模型的内部运作。这意味着相同的实现可以用于任何模型。当我们讨论R和Python代码时，你会看到这些方法已经有了很好的实现。</p><h1 id="72ad" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">PDP和ICE图的局限性</h1><h2 id="7576" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">假设特征独立</h2><p id="d02d" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">继续讨论局限性，我们将从这些方法的主要问题开始。这是因为他们假设特征是独立的。这并不总是如此，因为特征可以是相互关联的。例如，以<strong class="la iu">图19 </strong>中的km_driven和car_age散点图为例。有明显的相关性。直觉上，这是有道理的。老式汽车往往行驶更长的距离。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/b077d4cbc7bea4026f293265f71f1f21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tazcJabcGarjgVpVt9dFIw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图19:行驶里程与车龄的散点图(来源:作者)</p></figure><p id="d3e7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">问题是，当我们为观测值构建预测线时，我们将对某个要素的所有可能值进行采样。例如，假设我们想为km_driven构建一个PDP。以图20中红色给出的观察结果为例。它的车龄是10年。为了建立预测线，我们将改变虚线椭圆中所有值的km_driven。然而，在现实中，这种车龄的观测只能在实心椭圆内行驶一段距离。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/521dff35a052e957a4496ad5aba3a604.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qRe2BVQiEPcXmfKz6TAk2A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图20:随机抽样的问题(来源:作者)</p></figure><p id="97c5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们的模型不是在实心椭圆之外的观察上训练出来的。尽管如此，我们仍在根据这些观察结果的预测创建PDP。结果是，预测线是建立在模型以前没有“看到”的观察结果上的。这可能会产生不直观的结果，并导致关于特征趋势的错误结论。</p><h2 id="bbd4" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">同等关注所有特征值</h2><p id="331a" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">即使特征是不相关的，我们仍然会得出不正确的结论。对于每个观察值，我们对所有可能的特征值进行采样。这给予所有值同等的权重。实际上，该特性的一些值不太常见。例如在特征分布的极端。这些数值的趋势将会有更多的不确定性。</p><p id="b08d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">考虑到这一点，通常包括地毯情节。这些有助于我们理解特征的分布。在我们看到地毯图的分位数版本之前。<strong class="la iu">图21 </strong>，给出了替代版本。在这里，我们为每个观察值设置了单独的行。我们可以看到，km_driven值越高，观测值越少。因此，我们应该更加小心地解释这些值的趋势。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/5a9e6999550d0061ad9144da5d127445.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GF6dG8RkEvydv4bgDqlaAA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图21:km _ driven的替代PDP(来源:作者)</p></figure><h2 id="fbda" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">结论取决于你的模型</h2><p id="e3a8" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">正如优势中提到的，使用模型预测可以帮助我们更清楚地看到关系。问题是模型可能做出不正确的预测。一个不合适的模型可能会错过重要的关系。通过对噪声建模，过度拟合的模型可以呈现实际上并不存在的关系。最终，我们得出的结论将取决于我们的模型。考虑模型的性能很重要。</p><p id="3e3e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">即使有了一个精确的模型，我们仍然会有问题。一个模型可以忽略一些关系而支持其他关系。我们会得出错误的结论，即被忽略的特征与目标变量没有关系。这意味着，在进行数据探索时，您可能希望将要素限制在您有兴趣探索的子集内。</p><h2 id="0ac9" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">PDP忽略交互</h2><p id="043e" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">如前所述，通过使用平均值，PDP可能会错过交互。因此，基于PDP的特征重要性也将错过这些交互。这意味着，如果存在交互，分数可能会低估某个特征的重要性。我们在car_age特写中看到了这一点。一个解决方案是使用ICE图或坚持排列特征重要性。</p><h2 id="2c59" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">实施的局限性</h2><p id="0d05" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">在接下来的部分中，我们将带您浏览用于实现这些方法的代码。我们将看到每种实现都有其优缺点。有些包没有我们讨论的所有情节的实现。例如，如果您正在使用Python，那么就我所知，对于派生PDP或特性重要性，没有实现。</p><h1 id="095b" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">PDP和ICE图的r代码</h1><p id="6f4a" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">在本节中，我们将带您浏览用于创建PDP和ICE图的R代码。我们将研究使用三种不同的包。我们使用<a class="ae mi" href="https://cran.r-project.org/web/packages/ICEbox/ICEbox.pdf" rel="noopener ugc nofollow" target="_blank">冰箱</a>和<a class="ae mi" href="https://cran.r-project.org/web/packages/iml/iml.pdf" rel="noopener ugc nofollow" target="_blank"> iml </a>来创建情节。结合这些允许我们创建我们上面讨论的所有情节。对于特征重要性分数，我们使用<a class="ae mi" href="https://www.rdocumentation.org/packages/vip/versions/0.3.2" rel="noopener ugc nofollow" target="_blank"> vip </a>。你可以在<a class="ae mi" href="https://github.com/conorosully/medium-articles/blob/master/src/interpretable%20ml/PDPs%20and%20ICE%20Plots/PDP_ICE.R" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到我们讨论的所有代码。</p><p id="00e5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们从加载数据集开始(第1行)。这与我们在本文开头的表1中讨论的是同一个问题。我们还将car_type设置为分类特征(第2行)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><h2 id="5088" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated"><strong class="ak">造型</strong></h2><p id="854b" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">在我们创建PDP和ICE图之前，我们需要一个模型。我们使用randomForest包来做这件事(第1行)。我们使用价格和6个特征建立一个模型(第4-6行)。具体来说，我们使用了一个有100棵树的随机森林(第6行)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="102e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于下面的大多数图，我们将使用模型<strong class="la iu"> rf </strong>。这已经在连续目标变量上进行了训练。我们还想在二进制目标变量上建立一个模型，<strong class="la iu"> rf_binary，</strong>。这是为了向您展示不同类型的目标的代码和输出是如何不同的。</p><p id="0bc0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我们创建二进制目标变量。如果原始汽车价格高于平均值，则该值为1，如果低于平均值，则该值为0(第2-4行)。然后，我们像前面一样构建一个随机森林(第7–9行)。有了这些模型，我们现在可以继续使用PDP和ICE图来了解它们是如何工作的。随着我们的深入，输出将显示在相关代码的下方。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><h2 id="69ff" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">包装—冰箱</h2><p id="bb65" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">我们将从冰箱包开始(第1行)。我们将使用它为car_age创建一个PDP。我们使用<strong class="la iu"> ice </strong>函数为car_age创建一个iceplot对象(第4–7行)。我们传递我们的模型、特性和目标变量(第4-6行)。该对象将包含car_age的所有单个预测行。它还将包含平均预测线(即PDP)。</p><p id="038d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后我们使用plot函数显示iceplot对象(第9–11行)。默认情况下，此包将始终显示冰图。要创建PDP，我们需要隐藏各个预测线。我们通过将它们全部变成白色来做到这一点(第11行)。我们还隐藏了给出原始car_age值的点(第10行)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/d164c71c03cd9f0cc1787fed34e36e7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aLrVGc-Tzz91vlibtLBKKw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(来源:作者)</p></figure><p id="3d72" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要创建冰图，我们可以使用相同的冰图对象。现在，我们不再隐藏单独的线条，而是根据它们的汽车类型给它们着色(第5行)。经典车和普通车的区别在于它们的线条分别是蓝色和红色。我们也进入了冰情节(3线)。我们通过仅绘制10%的单独线条(第2行)将绘图限制为100个观察值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/56b5efe506da0b7429e677b070f45013.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wCQ7kDixXtgvnIqYFitHIA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(来源:作者)</p></figure><p id="6f5c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们也可以使用ICEBox包来绘制衍生PDP。我们以与之前相同的方式创建一个iceplot对象进行修复(第1–4行)。然后我们用它来创建一个骰子对象(第5行)。最后，我们绘制骰子对象(第7–10行)。我们已经设置了plot_sd = F(第10行)。这隐藏了各个预测线的标准偏差。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/9ed836014822d7ef3abd9b8515fac3d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bj2HaGId3CweeTN2ozP1kw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(来源:作者)</p></figure><p id="196e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们用这个包创建的最后一个图是二进制目标变量的PDP。代码类似于之前。除了使用<strong class="la iu"> rf_binary </strong>之外，唯一的区别是传递了一个预测函数(第4–6行)。这让<strong class="la iu"> ice </strong>函数知道我们的预测是根据概率给出的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/0197c5172b19705a31f544d6916be826.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uI8-AWIWO9MjcHiSCK4u2g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(来源:作者)</p></figure><p id="14c6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">冰箱包装有一些优点。通过用另一个特征给冰图着色，它允许我们清楚地看到相互作用。它也是唯一一个实现了衍生PDP的包。就局限性而言，它不处理分类特征。这意味着我们不能为car_type特征创建图。它也没有为2个功能实施PDP。</p><h2 id="caa6" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">包装— iml</h2><p id="7d1f" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">下一个包iml可以解决这些限制。首先，我们将使用它为car_age创建一个PDP。我们使用随机森林和数据集创建一个预测器对象(第4行)。使用它，我们创建一个特征效果对象(第7 -9行)。我们使用“pdp”作为功能效果方法(第9行)。最后，我们绘制这个特征效果对象(第10行)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/8ed46dae09888b15e025a2213ef710b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S6aLv6aEIHXAo5QRAo74ww.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(来源:作者)</p></figure><p id="6122" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们使用类似的代码为car_age创建一个ICE图。我们使用与之前相同的预测器对象(第1行)。我们现在将方法设置为“pdp+ice”(第3行)。这将给我们一个组合的PDP和ICE图。我们还将图居中，因此所有预测线都从0开始(第4行)。将方法设置为“ice”将删除黄色PDP。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/a33c5414d0900fe0e25f59c15bd68f50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gl110mcWYj_nNB6Zp6zc5Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(来源:作者)</p></figure><p id="5ab5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">iml包也可以处理分类特征。下面我们为car_type创建PDP(第2-5行)。这给了我们下面的直方图。类似地，我们为car_type创建一个ICE图(第8–11行)。这给了我们箱线图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><div class="kj kk kl km gt ab cb"><figure class="ou kn ov ow ox oy oz paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/90003d35fa68f3536f5ca9aa83ce481d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*3cBfX5ZWwvPNE9GB9wfdaA.jpeg"/></div></figure><figure class="ou kn ov ow ox oy oz paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/56b690660badba09efe47329a8672c71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*PJpwK8xCSuS4646-qH-Gaw.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk pa di pb pc translated">(来源:作者)</p></figure></div><p id="74eb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">iml的另一个优势是它为2个特性实现了PDP。下面我们为汽车年龄和公里驾驶创建一个PDP。代码类似于之前。唯一的区别是我们传递了一个带有两个特性名称的向量(第2行)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/8416a38aaf4b569236414e6d59e71c36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Czqwyx9o7RkrjzCSOdc2w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(来源:作者)</p></figure><p id="42bb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，我们为二元目标变量创建一个PDP。我们用<strong class="la iu"> rf_binary </strong>(第1行)创建预测器对象，但是代码的其余部分和以前一样。你可以看到我们现在有两个图。请注意，它们是彼此相反的。这是因为第一个图给出了汽车低于平均值(0)的概率。第二个图给出了高于平均值(1)的概率。当目标变量有两个以上的值时，为每个值绘制图表非常有用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/1a7468ae44bcce823fdf20be594d7b94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A9coRXEj5mfkaByo-m4bwg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(来源:作者)</p></figure><h2 id="57c5" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">套餐— vip</h2><p id="a4b5" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">以上两个包都没有实现特性重要性分数。为了计算这些，我们使用vip包(第1行)。创建基于PDP的分数(第4行)和基于ICE的分数(第7行)非常简单。我们已经将方法设置为“固定”。这代表特征重要性排序度量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><div class="kj kk kl km gt ab cb"><figure class="ou kn ov ow ox oy oz paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/07762fde2af95b7e4623c780cb02a5f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*TkIhOdu3bE4u4IjxMrWtKw.jpeg"/></div></figure><figure class="ou kn ov ow ox oy oz paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/e699d3859dbabfd3aa838cce76f5175f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*r5A9q8fXm0_U4-ABV5mCWw.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk pa di pb pc translated">(来源:作者)</p></figure></div><h1 id="10a3" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">用于PDP和ICE图的Python代码</h1><p id="32ca" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">在本节中，我们将带您浏览用于创建PDP和ICE图的Python代码。你也可以在<a class="ae mi" href="https://github.com/conorosully/medium-articles/blob/master/src/interpretable%20ml/PDPs%20and%20ICE%20Plots/PDP_ICE.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到这个。我们将使用scikit-learn的实现，<a class="ae mi" href="https://scikit-learn.org/stable/modules/generated/sklearn.inspection.PartialDependenceDisplay.html" rel="noopener ugc nofollow" target="_blank"> PartialDependenceDisplay </a>。另一个我们不会讨论的包是<a class="ae mi" href="https://pdpbox.readthedocs.io/en/latest/index.html?highlight=importance#the-common-headache" rel="noopener ugc nofollow" target="_blank"> PDPbox </a>。</p><p id="1e52" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们从导入Python包开始。我们导入了一些用于处理和可视化数据的通用包(第2–4行)。我们有两个不同的建模软件包— <strong class="la iu"> RandomFrorestRegressor </strong>(第6行)和<strong class="la iu"> xgboost </strong>(第7行)。最后，我们有用于创建PDP和ICE图的包(第9–10行)。第一个包用于可视化绘图。第二个包用于获得用于创建图的预测。这在我们以后探索分类特征时会很方便。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="16cd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">PDP包由scikit-learn提供。您仍然可以将它们用于不是用scikit-learn包创建的模型。稍后当我们用xgb包建模二进制目标变量时，您将会看到这一点。</p><h2 id="7987" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">连续目标变量</h2><p id="eee4" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">我们将从连续目标变量开始。我们加载数据集(第2行)。这与我们在本文开头的表1中讨论的是同一个问题。我们得到了目标变量(第5行)和特征(第6行)。我们用这些来训练一个随机的森林(第9-10行)。具体来说，随机森林由100棵树组成。每棵树的最大深度为4。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="5a05" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们现在可以使用<strong class="la iu"> PartialDependenceDisplay </strong>包来理解这个模型是如何工作的。首先，我们将为car_age创建一个PDP。为此，我们使用<strong class="la iu"> from_estimator </strong>函数。我们传入模型、X特征矩阵和特征名称。您可以在代码下面看到输出。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/9eaaaaafe2826f0b604cb4f00fcb4351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKWoAJaDqawwp_hw73KZEQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(来源:作者)</p></figure><p id="3e93" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了创建一个ICE图，我们需要将<strong class="la iu">种类</strong>参数设置为‘individual’(第4行)。我们还将情节居中(第6行)。默认情况下，这些函数只显示特征的5%到95%的百分位数。如果你想显示汽车年龄的全部范围，你需要改变它。也就是0到40岁。我们在第5行做这个。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/ae6d52230b7c5a2ce79728fb1772e25c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S9TA6G6pRiycQFL3RtQFzg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(来源:作者)</p></figure><p id="5441" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们在下面探索一些其他的选择。将种类特性设置为“两者”将显示PDP和ICE图(第4行)。我们还可以使用<strong class="la iu"> ice_lines_kw </strong>(第4行)和<strong class="la iu"> pd_line_kw </strong>(第5行)参数分别更改ice图和PDP线的样式。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/caa31231d4142a03a8db867756b7d89c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f-df-CC0yrbDody4O6rG0Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(来源:作者)</p></figure><p id="d2f0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">创建包含两个功能的PDP与之前类似。我们所需要做的就是传递一个特性名称的数组，而不是一个单独的特性名称。你可以在下面看到我们是如何为车龄和公里数做这些的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/abbca0adb22766fe7d19b4404f46895d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t2-fo6bM8iuqfApwYtgg3A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(来源:作者)</p></figure><p id="0ffb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">scikit-learn包的缺点是它将分类特征视为连续特征。你可以在下面看到这样做的结果。PDP和ICE图由线条给出。直方图和箱线图会给出更好的解释。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/086c8e44732656c7409bcdfec70532ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GjpT5Dr9uNOPyy7HknrTKw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(来源:作者)</p></figure><p id="e04c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以通过创造自己的情节来解决这个问题。我们使用<strong class="la iu">partial _ dependency</strong>函数来实现这一点(第3行)。我们使用该函数的方式与使用<strong class="la iu"> for_estimator </strong>函数的方式相同。不同的是，它不显示一个情节。它仅返回用于创建图的数据。<strong class="la iu"> pd_ice </strong>将包含car_type的PDP和ice图的数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="2fe8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以在下面看到我们如何使用它来创建PDP。我们从从<strong class="la iu"> pd_ice </strong>(第2行)获取平均值开始。这将是普通车和老爷车的平均预测。使用这些，我们绘制一个条形图(第5-14行)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">[分手]</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/06349fbe888cb1eed4626ec8814b01eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p5pri0-imGyyTGDy03v9uw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(来源:作者)</p></figure><p id="ab21" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于冰图，我们可以创建一个箱线图。我们从<strong class="la iu"> pd_ice </strong>(第2行)中得到单独的预测。然后，我们将这些分为普通车和经典车预测(第4-6行)。最后，我们绘制箱线图(第9-14行)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/1fe6bffde32e726b06b33c3b3f760bb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CDHnSBkfVO613doUQuWunA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(来源:作者)</p></figure><h2 id="5c56" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">二元目标变量</h2><p id="e10f" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">最后，我们将创建一个二元目标变量的ICE图。首先，我们创建变量(第2–3行)。如果原始汽车价格高于平均值，则其值为1，如果低于平均值，则其值为0。我们使用这个二元变量训练一个模型(第6–7行)。这一次我们使用了一个最大深度为2的XBGClassifier和100棵树。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="e0a2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们像以前一样为汽车时代画一个冰图。你会注意到y轴现在给出的是概率而不是价格。您还可以看到，将scikit-learn包与其他建模包一起使用非常简单。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/2b59fe38fdd3912375f5c12752a9ec29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-BWAYJOhGoygxg3mh4XvUQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(来源:作者)</p></figure><p id="0322" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用Python的缺点是没有衍生PDP和特性重要性分数的实现(据我所知)。虽然，对于大多数问题，上面的图表是你所需要的。如果您需要其他方法，您可以使用<strong class="la iu">partial _ dependency</strong>函数自己实现它们。</p><p id="189b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望这篇文章对你有用！我真的希望它成为PDP和ICE情节的终极指南。如果你认为我错过了什么，请在评论中提出。另外，如果有什么不清楚的地方，请告诉我。我很乐意更新文章:)</p></div><div class="ab cl pj pk hx pl" role="separator"><span class="pm bw bk pn po pp"/><span class="pm bw bk pn po pp"/><span class="pm bw bk pn po"/></div><div class="im in io ip iq"><p id="3653" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">PDP和ICE图是<strong class="la iu">可解释的机器学习</strong>方法。它们被用来理解我们的模型是如何做出预测的。另一种流行的方法是SHAP。SHAP值的一个优点是它们可以用来理解个人预测是如何做出的。还可以将它们聚合起来，以了解模型作为一个整体是如何工作的。在下面的文章中，我们将探索如何在Python中应用这种方法。</p><div class="nx ny gp gr nz oa"><a rel="noopener follow" target="_blank" href="/introduction-to-shap-with-python-d27edc23c454"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">Python SHAP简介</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">如何创造和解释SHAP情节:瀑布，力量，决定，SHAP和蜂群</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">towardsdatascience.com</p></div></div><div class="oj l"><div class="pq l ol om on oj oo ks oa"/></div></div></a></div></div><div class="ab cl pj pk hx pl" role="separator"><span class="pm bw bk pn po pp"/><span class="pm bw bk pn po pp"/><span class="pm bw bk pn po"/></div><div class="im in io ip iq"><p id="4aeb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望这篇文章对你有帮助！你可以成为我的<a class="ae mi" href="https://conorosullyds.medium.com/membership" rel="noopener"> <strong class="la iu">推荐会员</strong> </a> <strong class="la iu">来支持我。你可以访问medium上的所有文章，我可以得到你的部分费用。</strong></p><div class="nx ny gp gr nz oa"><a href="https://conorosullyds.medium.com/membership" rel="noopener follow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">通过我的推荐链接加入Medium康纳·奥沙利文</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">conorosullyds.medium.com</p></div></div><div class="oj l"><div class="pr l ol om on oj oo ks oa"/></div></div></a></div><p id="7356" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以在|<a class="ae mi" href="https://twitter.com/conorosullyDS" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae mi" href="https://www.youtube.com/channel/UChsoWqJbEjBwrn00Zvghi4w" rel="noopener ugc nofollow" target="_blank">YouTube</a>|<a class="ae mi" href="https://mailchi.mp/aa82a5ce1dc0/signup" rel="noopener ugc nofollow" target="_blank">时事通讯</a>上找到我——注册免费参加<a class="ae mi" href="https://adataodyssey.com/courses/shap-with-python/" rel="noopener ugc nofollow" target="_blank"> Python SHAP课程</a></p><h2 id="b905" class="nj mk it bd ml nk nl dn mp nm nn dp mt lh no np mv ll nq nr mx lp ns nt mz nu bi translated">参考</h2><p id="4958" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">C.莫尔纳尔、<strong class="la iu">可解释机器学习</strong> <em class="ps"> </em> (2021)、<a class="ae mi" href="https://christophm.github.io/interpretable-ml-book/" rel="noopener ugc nofollow" target="_blank">https://christophm.github.io/interpretable-ml-book/</a></p><p id="60f0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">南用Python进行可解释的机器学习 (2021)</p><p id="38e9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">格伦威尔，B.M .，博姆克，B.C .和麦卡锡，a . j .(2018)。<strong class="la iu">一种简单有效的基于模型的可变重要性度量</strong>。<a class="ae mi" href="https://arxiv.org/abs/1805.04755" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/abs/1805.04755</a></p></div></div>    
</body>
</html>