<html>
<head>
<title>8 Code Snippets To Quickly Get Started With MLflow Tracking</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快速入门MLflow跟踪的8个代码片段</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/8-code-snippets-to-quickly-get-started-with-mlflow-tracking-63064d99d3ff#2022-02-14">https://towardsdatascience.com/8-code-snippets-to-quickly-get-started-with-mlflow-tracking-63064d99d3ff#2022-02-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="feaa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">更好地记录实验和重现实验的技巧</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9ff430b16f52be0077ccfecdc332bad1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rBesKa7mYEI3mTcn"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@ffstop?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Fotis Fotopoulos </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="6c84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名数据科学家，我每天都在使用MLflow。</p><p id="bba8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我用它来跟踪机器学习实验，将模型推送到注册表并对其进行版本管理，并轻松地与同事就相同的项目进行协作。</p><blockquote class="lv lw lx"><p id="ee56" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><em class="it">在深入使用这个工具一年多后，我开始了解它的来龙去脉，作为对这段经历的总结</em> <strong class="lb iu"> <em class="it">，这篇文章是我经常使用的8个有用代码片段的汇总。</em>T9】</strong></p></blockquote><p id="509a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随意跳过你知道的，浏览那些你不太熟悉的。</p><p id="b75b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事不宜迟，我们来看看吧！🔍</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="8ab9" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">📚MLflow术语的30秒快速回顾</h1><p id="5246" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated"><em class="ly">之前在MLflow上写过帖子。如果您有兴趣了解更多关于这个MLOps工具的信息，这里有一个6分钟的故事，涵盖了基本知识⏬</em></p><div class="ng nh gp gr ni nj"><a rel="noopener follow" target="_blank" href="/how-to-use-mlflow-on-aws-to-better-track-machine-learning-experiments-bbcb8acded65"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">如何在AWS上使用MLflow来更好地跟踪你的机器学习实验</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">记录一切以获得更好的再现性</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">towardsdatascience.com</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx ks nj"/></div></div></a></div><p id="bc0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">MLflow有四个组件。</p><p id="df77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们今天感兴趣的一个叫做<strong class="lb iu"> MLflow Tracking </strong>:广义来说，你可以把它看作模型和机器学习项目的GIT仓库。</p><p id="d709" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它允许您在一个中心位置，即一个远程服务器，跟踪参数、指标和文件(也称为工件)。</p><p id="15be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">MLflow跟踪被组织成实验，并且每个实验被分成运行(这就是你在这篇文章的其余部分需要知道的)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/8afead0fffa237a297f0903c4ddcc5aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tcE9-fpCwT3IWxBx.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片— MLflow术语</p></figure><p id="24ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，一个实验可以专用于训练用于肺炎检测的计算机视觉模型，并且该实验中的每次运行将与特定的训练会话相关。因此，跑步与其他跑步不同，每次跑步都有:</p><ul class=""><li id="162d" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated"><strong class="lb iu">一组特定的超参数:</strong>学习率、辍学率、层数等。</li><li id="db2b" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><strong class="lb iu">性能指标</strong> : f1分数、准确度等。</li><li id="57ea" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><strong class="lb iu">工件</strong>:这些可以是不同格式的文件:分类/误分类图像样本、用于视觉解释的激活图、CSV文件中的预测、HTML报告等。</li></ul><p id="0e74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑到这一点，现在让我们来看看有望让您提高工作效率的代码片段。</p><p id="5d4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ly"> PS*:在运行以下代码片段之前，您应该创建一个MLflow实验并启动一个UI服务器。如果不知道怎么做，可以查看我之前的</em> <a class="ae ky" rel="noopener" target="_blank" href="/how-to-use-mlflow-on-aws-to-better-track-machine-learning-experiments-bbcb8acded65"> <em class="ly">帖子</em> </a> <em class="ly">。</em></p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="98c2" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">1-记录运行中的数据</h1><p id="f3b1" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在MLflow上创建一个实验之后，记录数据可能是您与该工具的第一次交互。</p><p id="762f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要记录一些参数和指标，首先需要开始一次运行，并在其上下文中调用<code class="fe on oo op oq b">log_param</code>和<code class="fe on oo op oq b">log_metric</code>方法。</p><p id="c29f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两个方法将一个键和值作为第一个和第二个参数。</p><p id="59ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一个例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="4ab1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，也可以使用<code class="fe on oo op oq b">log_param<strong class="lb iu">s</strong></code> <strong class="lb iu"> </strong>和<code class="fe on oo op oq b">log_metric<strong class="lb iu">s</strong></code> <strong class="lb iu"> </strong>的方法。在这种情况下，您必须传递一个参数或度量的字典。</p><p id="0065" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">👉在<code class="fe on oo op oq b">with</code>语句后声明的<code class="fe on oo op oq b">run</code>对象允许你访问当前运行的信息。</p><p id="72b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该信息可通过<code class="fe on oo op oq b">to_dictionary</code>方法提取。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="d07f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">小心⚠️ </strong></p><p id="bcc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当指标对您的数据有意义时，或者如果您想根据它们的值对您的跑步进行排序，请使用指标。例如，如果您想按递减的层数对运行进行排序，<code class="fe on oo op oq b">n_layers</code>应该是一个度量而不是一个参数。</p><p id="e66b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是当<code class="fe on oo op oq b">n_layers</code>作为一个参数被记录时发生的情况:它被认为是一个字符串，递增顺序变成<code class="fe on oo op oq b">1</code>、<code class="fe on oo op oq b">10</code>、<code class="fe on oo op oq b">11</code>等等。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/11b764dd2fa9bb98a22ae9805dbab6a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFGgiO88gHSiCuI6v4B3kg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图— n_layers被视为字符串</p></figure><h1 id="35f0" class="mj mk it bd ml mm ou mo mp mq ov ms mt jz ow ka mv kc ox kd mx kf oy kg mz na bi translated">2-记录嵌套运行中的数据</h1><p id="a176" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">不管出于什么原因，这种情况可能会发生，您可能希望在另一个运行中创建一个运行。语法和以前一样:唯一的区别是在创建嵌套运行时，您必须将<code class="fe on oo op oq b">nested</code>参数设置为True。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="2137" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是MLflow UI上的视觉效果:可以折叠内部有嵌套运行的运行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/996ce0336d7a472eca74ef3c4533fee1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7gezCDfJGT4WjSCCoN91hg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截屏—嵌套运行的示例</p></figure><p id="d6ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">👉值得注意的是，这两个运行——父运行和嵌套运行——有两个不同的运行id。</strong></p><h1 id="4c6a" class="mj mk it bd ml mm ou mo mp mq ov ms mt jz ow ka mv kc ox kd mx kf oy kg mz na bi translated">3-根据其id获取运行并访问其数据</h1><p id="24f8" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">给定运行id，您可以提取一个运行对象，这允许轻松地访问它的数据:参数、度量、标签和元数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="451f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行对象将有两个属性:</p><ul class=""><li id="ff43" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated"><code class="fe on oo op oq b">data</code>:封装了一个<code class="fe on oo op oq b">RunData</code>对象，其中包含了度量、参数和标签</li></ul><pre class="kj kk kl km gt pa oq pb pc aw pd bi"><span id="faf1" class="pe mk it oq b gy pf pg l ph pi"><strong class="oq iu">&gt;&gt;&gt; run.data.metrics<br/>{'coverage': 0.76, 'f1': 0.83, 'precision': 0.76, 'recall': 0.92}</strong></span><span id="5b37" class="pe mk it oq b gy pj pg l ph pi"><strong class="oq iu">&gt;&gt;&gt; run.data.params<br/>{'dropout': '0.25', 'lr': '0.01', 'n_layers': '5', 'optimizer': 'Adam'}</strong></span></pre><ul class=""><li id="9bc6" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated"><code class="fe on oo op oq b">info</code>:它封装了一个<code class="fe on oo op oq b">RunInfo</code>对象，该对象包含额外的运行元数据，比如开始和结束时间、run_id、实验id和工件URI。</li></ul><pre class="kj kk kl km gt pa oq pb pc aw pd bi"><span id="af9c" class="pe mk it oq b gy pf pg l ph pi"><strong class="oq iu">&gt;&gt;&gt; run.info.run_id<br/>'5aa1f947312a44c68c844bc4034497d7'</strong></span><span id="d4bd" class="pe mk it oq b gy pj pg l ph pi"><strong class="oq iu">&gt;&gt;&gt; run.info.experiment_id<br/>'418327'</strong></span></pre><h1 id="98b4" class="mj mk it bd ml mm ou mo mp mq ov ms mt jz ow ka mv kc ox kd mx kf oy kg mz na bi translated">4-基于搜索查询过滤运行</h1><p id="8dab" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">您可以轻松搜索跑步记录。</p><p id="8cb4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先创建50个具有随机度量值和参数值的假运行。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="04f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想要基于特定的过滤器搜索这些运行，您可以直接从界面中进行搜索。</p><p id="ce6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果您想要过滤使用SGD作为优化器的运行，您必须在搜索框中输入以下查询:</p><pre class="kj kk kl km gt pa oq pb pc aw pd bi"><span id="e694" class="pe mk it oq b gy pf pg l ph pi"><strong class="oq iu">params.optimizer="sgd"</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pk"><img src="../Images/0f5dec96394fa614b3eed64d22d97aaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mUcIGeftbpWVIcq-mBlZ9A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用户截屏—基于搜索查询的过滤器运行</p></figure><p id="1cea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想以编程方式实现这一点，您必须使用<code class="fe on oo op oq b">search_runs</code>方法并将搜索查询传递给<code class="fe on oo op oq b">filter_string</code>参数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="00db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以有更复杂的搜索查询。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="0fff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">👉点击</strong>  <strong class="lb iu">可以了解更多搜索语法</strong> <a class="ae ky" href="https://www.mlflow.org/docs/latest/search-syntax.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">。</strong></a></p><h1 id="e57f" class="mj mk it bd ml mm ou mo mp mq ov ms mt jz ow ka mv kc ox kd mx kf oy kg mz na bi translated">5-上传工件</h1><p id="0848" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">除了参数和度量之外，运行还可能包含诸如CSV文件、二进制对象、HTML页面、图像等工件。</p><p id="4051" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要上传工件，请使用<code class="fe on oo op oq b">log_artifact</code>。作为第一个参数，这个方法采用本地文件系统上的工件路径。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="86a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦工件被记录，您可以从UI中点击run并检查文件是否被正确上传。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/e1b598d732cea2d86fdbbf7844431f68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bUGgFRrVPC9D-Vj8gI5Bpg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供—上传的工件</p></figure><p id="17f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们想要提供一个目标文件夹来写入工件，我们可以在<code class="fe on oo op oq b">artifact_path</code>参数中设置它。</p><p id="a4e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，让我们将<code class="fe on oo op oq b">artifact_path</code>设置到一个名为<code class="fe on oo op oq b">stats</code>的文件夹中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="dd8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们再次检查UI，我们会看到<code class="fe on oo op oq b">stats_comparison.csv</code>文件现在在<code class="fe on oo op oq b">stats</code>文件夹中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pm"><img src="../Images/3c12c0f06d8dd687147a0616b433169f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PYeyMXt8i0E0OMLxui_Ibw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截屏——上传的工件和目标文件夹</p></figure><p id="cd18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以使用<code class="fe on oo op oq b">log_artifact<strong class="lb iu">s</strong></code>方法来上传一个目录的全部内容。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/88f68fc52644c502299c3d4003cc1ca1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1_51OaPgr-9bt1SRA_KKLA.png"/></div></div></figure><p id="3627" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> →简而言之:</strong></p><ul class=""><li id="b2df" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated">您可以在每次运行时上传任何想要的工件</li><li id="3910" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">您可以自定义目标文件夹层次结构</li><li id="60ee" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">要上传文件夹的全部内容，请使用<code class="fe on oo op oq b">log_artifact<strong class="lb iu">s</strong></code></li><li id="367a" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">要上传单个文件，请使用<code class="fe on oo op oq b">log_artifact</code></li></ul><h1 id="fa5d" class="mj mk it bd ml mm ou mo mp mq ov ms mt jz ow ka mv kc ox kd mx kf oy kg mz na bi translated">6-下载工件</h1><p id="315f" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">正如所料，下载运行的工件也是可能的:您可以通过调用<code class="fe on oo op oq b">download_artifacts</code>方法来完成。</p><p id="bfc4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们使用之前的运行，在其中我们将图像记录为工件，并在本地创建一个<code class="fe on oo op oq b">downloads</code>文件夹来下载它们。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="f677" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe on oo op oq b">download_artifacts</code>除了运行id之外，还有两个重要的参数。</p><ul class=""><li id="8219" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated"><code class="fe on oo op oq b">path</code>是MLflow跟踪服务器中所需工件的相对源路径</li><li id="3e37" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><code class="fe on oo op oq b">dst_path</code>是下载指定工件的本地文件系统目标目录的路径。该目录必须已经存在。</li></ul><p id="3db4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们将<code class="fe on oo op oq b">path</code>设置为<code class="fe on oo op oq b"><strong class="lb iu">.</strong></code>并将<code class="fe on oo op oq b">dst_path</code>设置为<code class="fe on oo op oq b"><strong class="lb iu">downloads</strong></code>，那么运行中记录的所有内容都将被下载到<code class="fe on oo op oq b"><strong class="lb iu">downloads</strong></code>文件夹中。</p><p id="bf78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是您也可以将<code class="fe on oo op oq b"><strong class="lb iu">path</strong></code>参数设置为运行中任何想要的工件路径。你不必下载所有的东西。</p><h1 id="63ee" class="mj mk it bd ml mm ou mo mp mq ov ms mt jz ow ka mv kc ox kd mx kf oy kg mz na bi translated">7-更新现有运行</h1><p id="79d9" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">如果运行已经存在，您可以向其中添加更多数据，也可以更新现有数据。你所需要的只是它的运行id。</p><p id="71da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们更新之前运行的指标。</p><p id="89b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是更新前的运行指标:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi po"><img src="../Images/f98d1916b28759b94b81b21c00e2eb30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6XqmtiNlJHVDL6BOga85cw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图—更新前运行</p></figure><p id="044f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们生成一些随机指标，并用它们来覆盖前面的指标。这是通常的语法。唯一的区别是您设置了<code class="fe on oo op oq b">run_id</code>参数，而不是<code class="fe on oo op oq b">experiment_id</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="8049" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们在UI上再次检查相同的运行，我们将看到指标已经更新。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/245b351219923b8a37d4f80ab80e0843.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WnhVyGep4HDf8v7XBX8xhQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图—更新后运行</p></figure><h2 id="9efa" class="pe mk it bd ml pq pr dn mp ps pt dp mt li pu pv mv lm pw px mx lq py pz mz qa bi translated">⚠️关于更新运行参数的说明</h2><p id="f486" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">出于某种原因，MLflow不允许您覆盖现有运行的<strong class="lb iu">参数</strong>。</p><p id="1a64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您运行以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="8303" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将面临以下错误:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qb"><img src="../Images/152dff08ec5f14287e407cc5818aa4c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iGqf51qcBHbyf094S5t3yA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图—参数覆盖后的MLflowException</p></figure><p id="85fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我承认，更新运行参数在许多情况下都是有用的。如果你知道一个简单的方法，请在评论中告诉我。</p><h1 id="46bc" class="mj mk it bd ml mm ou mo mp mq ov ms mt jz ow ka mv kc ox kd mx kf oy kg mz na bi translated">8-创建并上传自定义Pyfunc模型</h1><p id="5c3c" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">除了支持用通用框架(scikit-learn、Keras、Gluon等)构建的机器学习模型的日志记录。)，MLflow提供了将任意python代码包装在一个类中并使用它进行推理的灵活性。</p><p id="17d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您的推理管道不标准时，这非常有用。当您的模型在预测时需要包含外部工件，或者当它需要发送多个输出或执行某种后处理时，可能会发生这种情况。</p><p id="0d87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您还需要在预测管道中集成一些业务逻辑时，使用自定义模型会很有价值:这是发挥创造力的地方。</p><p id="86cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">👉让我们构建一个定制的pyfunc模型来演示这是如何实现的。</p><p id="bd27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个模型将使用一个经过训练的随机森林作为工件。它将通过添加一些数据验证来自定义推理，并将在一个字典中返回多个输出。</p><blockquote class="lv lw lx"><p id="e7b4" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">这只是一个例子，但是它应该给你一些灵感来开发更复杂的管道。T11】</p></blockquote><ul class=""><li id="f29d" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated">首先，让我们训练一个随机森林模型。为了简单起见，我们将使用虹膜数据集。<br/>一旦通过交叉验证对模型进行了训练和评估，我们将使用joblib库保存它。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><ul class=""><li id="f643" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated">我们准备了一个字典，列出了所有将与模型一起上传的工件。<br/>该字典将引用每个工件的本地路径，MLflow稍后将负责上传它。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><ul class=""><li id="652d" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated">通过继承PythonModel类来定义MLflow包装器。</li></ul><p id="15d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个类必须覆盖两个方法:<code class="fe on oo op oq b">load_context</code>和<code class="fe on oo op oq b">predict</code>。</p><ol class=""><li id="eee2" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu qc of og oh bi translated"><code class="fe on oo op oq b">load_context</code>接收一个上下文参数，其中包含模型的工件路径。该方法作为一个构造函数，用于将模型工件作为属性加载。</li><li id="8417" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu qc of og oh bi translated"><code class="fe on oo op oq b">predict</code>接收上下文和输入参数。<code class="fe on oo op oq b">inputs</code>论证是一本字典。这是你获得创造力和定制推理逻辑的地方。</li></ol><p id="79fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的例子中，<code class="fe on oo op oq b">predict</code>方法提取输入特征，验证它们的形状，并将它们传递给预加载的模型工件。</p><p id="d2ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，它提取多个预测，如概率分数和预测标签，并用成功消息将所有内容打包到一个字典中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><ul class=""><li id="6b9a" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated">为了上传定制模型，我们首先需要创建一个AwesomeModel类的实例，并将其传递给<code class="fe on oo op oq b">mlflow.pyfunc.log_model</code>函数。<br/>这个函数也采用我们在下面定义的工件字典。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="7fc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦模型被记录，它就在MLflow UI上变得可见。</p><p id="da1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意MLflow是如何自动添加一个包含预先训练的随机森林模型的<code class="fe on oo op oq b">artifacts</code>文件夹的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qd"><img src="../Images/4201bfe81b08010ba36c8ba2dcd9b286.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ae5B9S_XEXlpKqVshlYGww.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图—上传的pyfunc模型</p></figure><ul class=""><li id="91ba" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated">现在给定运行id，您可以本地加载模型并执行推理。<br/>一切都打包成这个模型。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="1694" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">酷吧？</p><h1 id="ccad" class="mj mk it bd ml mm ou mo mp mq ov ms mt jz ow ka mv kc ox kd mx kf oy kg mz na bi translated">资源:</h1><p id="82bd" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">这里有一个材料列表，您可以通过它来了解更多关于MLflow的信息:</p><ul class=""><li id="361e" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/5-tips-for-mlflow-experiment-tracking-c70ae117b03f">https://towards data science . com/5-tips-for-ml flow-experiment-tracking-c 70 AE 117 b 03 f</a></li><li id="2fbe" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/how-to-use-mlflow-on-aws-to-better-track-machine-learning-experiments-bbcb8acded65">https://towards data science . com/how-to-use-ml flow-on-AWS-to-better-track-machine-learning-experiments-BBC b8 ACD ed 65</a></li><li id="1a33" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><a class="ae ky" href="https://www.mlflow.org/docs/latest/tutorials-and-examples/tutorial.html" rel="noopener ugc nofollow" target="_blank">https://www . ml flow . org/docs/latest/tutorials-and-examples/tutorial . html</a></li></ul><h1 id="3744" class="mj mk it bd ml mm ou mo mp mq ov ms mt jz ow ka mv kc ox kd mx kf oy kg mz na bi translated">感谢阅读🙏</h1><p id="a081" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">如果您已经做到了这一步，我想感谢您的宝贵时间，并希望您已经学到了一些关于有效使用MLflow的有用知识。</p><p id="7ccd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你知道其他MLflow技巧，请在评论中告诉我。</p><p id="5a0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">话虽如此，我还是祝你编码愉快💻。</p><p id="a6fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下次见！👋</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h2 id="2468" class="pe mk it bd ml pq pr dn mp ps pt dp mt li pu pv mv lm pw px mx lq py pz mz qa bi translated">新到中？你可以每月订阅5美元，并解锁各种主题的无限文章(技术、设计、创业……)，你可以通过点击我的推荐链接<a class="ae ky" href="https://ahmedbesbes.medium.com/membership" rel="noopener">来支持我。</a></h2><div class="ng nh gp gr ni nj"><a href="https://ahmedbesbes.medium.com/membership" rel="noopener follow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">加入我的介绍链接媒体-艾哈迈德贝斯</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">ahmedbesbes.medium.com</p></div></div><div class="ns l"><div class="qe l nu nv nw ns nx ks nj"/></div></div></a></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qf"><img src="../Images/dc29731db7b87fcf2a5522da11d6e2ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sAl8OPUJKB8x4uHq"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@karsten116?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Karsten Winegeart </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div></div>    
</body>
</html>