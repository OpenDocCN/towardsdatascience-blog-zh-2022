<html>
<head>
<title>A Look Into SQL’s Order Of Execution</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对SQL执行顺序的研究</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-look-into-sqls-order-of-execution-d0b81e361c66#2022-08-15">https://towardsdatascience.com/a-look-into-sqls-order-of-execution-d0b81e361c66#2022-08-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3f4a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这就是执行选择查询的方式</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/48cde8f6640755e8ddad03d1cc002e4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VEYCcgfwdkGzC1zB"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Bradyn Trollip 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="ebd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在编写了大量的SQL脚本之后，您可能会在性能方面达到某种形式的平稳状态。你用同样的策略提取洞察力，并遇到同样类型的错误。</p><p id="4add" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，通过花时间了解SQL中的子句是如何计算的，您可以改善编写查询的体验。</p><p id="eb4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们讨论SQL中的执行顺序，并解释为什么它很重要。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="0d81" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">执行顺序</h2><p id="9741" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">SQL查询在计算子句时遵循特定的顺序，类似于数学运算遵循PEMDAS或比德马斯的方式。</p><p id="4bff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从用户的角度来看，查询从第一个子句开始，到最后一个子句结束。然而，在执行时，查询实际上并不是从上到下读取的。</p><p id="eec4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查询中子句的执行顺序如下:</p><p id="4902" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 1。FROM/JOIN: </strong>首先执行FROM和/或JOIN子句来确定感兴趣的数据。</p><p id="64cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 2。WHERE: </strong>执行WHERE子句来过滤掉不符合约束的记录。</p><p id="b9da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 3。GROUP BY: </strong>执行GROUP BY子句，根据一列或多列中的值对数据进行分组。</p><p id="6b36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 4。HAVING: </strong>执行HAVING子句来删除不满足约束条件的已创建的分组记录。</p><p id="6685" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 5。SELECT: </strong>执行SELECT子句来导出所有需要的列和表达式。</p><p id="7757" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 6。ORDER BY: </strong>执行ORDER BY子句，以升序或降序对派生值进行排序。</p><p id="59b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 7。LIMIT/OFFSET: </strong>最后，执行LIMIT和/或OFFSET子句来保持或跳过指定的行数。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="0368" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">个案研究</h2><p id="8b81" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">为了说明SQL的执行顺序，最好使用一个例子。</p><p id="e07a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有两个名为Orders和Products的表，其中详细列出了购买文具的情况。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/938407b54a12b23d3d0c092866c15489.png" data-original-src="https://miro.medium.com/v2/resize:fit:1094/format:webp/1*40aWuIZnp3EzgoDJTb7fag.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">订单表(由作者创建)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/7b3682836d5400d500e7c1a7b75f3e2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*akRkaKm76Cqy9qDCSE-PQw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">产品表(由作者创建)</p></figure><p id="c064" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这些表格，我们想要找出:</p><p id="fdeb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谁在钢笔上花了第二多的钱？</p><p id="6ef2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过下面的查询获得答案。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/d900fffcbe135f61c4f46e658fe4fb89.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/format:webp/1*r-bmANThdKOD-e5rYGDIsg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="58d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">答案成功输出，但最初是如何导出的？</p><p id="59bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如前所述，用户可能会从SELECT子句开始读取查询，并以OFFSET子句结束，但是SQL不会从上到下读取子句。</p><p id="4b6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相反，它通过以下步骤得出答案:</p><p id="2bdd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">1.FROM和JOIN子句合并Products和Orders表以获得感兴趣的总数据。</p><p id="b5bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.WHERE子句删除未购买钢笔的记录。</p><p id="cb71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.GROUP BY子句按名称将记录分组在一起。</p><p id="54db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.HAVING子句删除在钢笔上花费超过2000英镑的群体。</p><p id="b271" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.SELECT子句派生出购买者和他们在钢笔上花费的相应金额。</p><p id="e151" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">6.ORDER BY子句根据在笔上花费的总金额以降序对结果进行排序。</p><p id="3283" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">7.LIMIT和OFFSET子句跳过第一行，只保留下一条记录，其中包含在钢笔上花费第二多的人。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="5482" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">为什么这很重要</h2><p id="84af" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">初看起来，SQL的执行顺序似乎并不重要。毕竟，如果查询提供了想要的输出，谁会关心子句是如何计算的呢？</p><p id="1b4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，不熟悉执行顺序的用户将难以编写更复杂的查询，因为出现的任何问题都将更难调试。那些希望更轻松地排除错误的人将受益于理解SQL中子句的读取顺序。</p><p id="4fab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，SQL中的一个常见错误是错误地引用列别名。</p><p id="e6a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过使用“订单”和“产品”表来回答另一个问题，从而突出这个错误:</p><p id="4753" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在那些花费不到50英镑的人中，谁在一份订单上花了最多的钱？</p><p id="6045" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过将Products表中的price变量乘以Orders表中的quantity变量，并用别名“total_spent”来命名该表达式，从而计算出在一个订单上花费的总金额。</p><p id="c7dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看以下查询输出的答案。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/03b12d39f3007bda4fb22cbd56c50aaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*So5JKNVuL4bdvAbdMNM95Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="1651" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个错误？这是怎么回事？</p><p id="e464" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不熟悉执行顺序的用户可能看不到在WHERE子句中使用列别名“total _ spent”的问题，因此从表面上看，该查询似乎是有效的。</p><p id="74af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，知道了SQL中的执行顺序，很明显，由于列别名是在SELECT子句中创建的，在WHERE子句之后的对其进行评估，所以SQL在评估WHERE子句时不会包含该别名，因此会出现错误。</p><p id="fc64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然我们可以识别错误的来源，我们可以通过在WHERE子句的表达式中不使用列别名来修复它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/23ff49008c2b6eaa42b5795b3add9315.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*2USZ0e17n8LY6oH2XbVxpw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出预览(由作者创建)</p></figure><p id="19de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查询现在成功运行。</p><p id="fd1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，ORDER BY子句仍然使用列别名“total _ spent ”,这很好，因为该子句是在SELECT子句的之后计算的<em class="ng">。</em></p><p id="8bef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一般来说，对于理解SQL执行顺序的人来说，这样的问题很容易解决。然而，那些对它视而不见的人将很难修复表面上看似良性的错误。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="d12f" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">结论</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/85b7a87f297c212340aeb93830388741.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WEJkqua1kv_vy5sj"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@prateekkatyal?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Prateek Katyal </a>拍摄</p></figure><p id="03b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总而言之，了解查询是如何被读取的将有助于用户改进他们的脚本，并在排除任何错误时获得更轻松的体验。</p><p id="630b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">起初，记住这个顺序可能会令人生畏，但只要有一点经验，执行的顺序就会很容易记住(就像PEMDAS或比德马斯)。</p><p id="2005" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我祝你在数据科学的努力中好运！</p></div></div>    
</body>
</html>