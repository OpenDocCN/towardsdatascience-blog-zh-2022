<html>
<head>
<title>Sentiment Analysis with TFX Pipelines — Local Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TFX管道的情感分析—本地部署</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/sentiment-analysis-with-tfx-pipelines-local-deploy-e9daa4cbde2a#2022-10-18">https://towardsdatascience.com/sentiment-analysis-with-tfx-pipelines-local-deploy-e9daa4cbde2a#2022-10-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a856" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><strong class="ak">建立一个本地TFX管道，使用Transformer架构创建一个情感分析模型，并使用TF为该模型提供服务</strong></h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5322cfc61d84158b8d5bc4a834ff8caf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ZZKFiX5zRv17D34muiGfA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@sigmund?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">西格蒙德</a>在<a class="ae kv" href="https://unsplash.com/s/photos/pipelines?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><h1 id="89c0" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak"> 1。简介</strong></h1><p id="695e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在本文中，我们将介绍<strong class="lq ir">构建管道来部署情感分析模型的过程。</strong></p><p id="e55b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">本文是两部分中的第一部分。在这一部分中，我们将讨论如何在本地运行我们的管道。在第二部分中，<a class="ae kv" href="https://arturlunardi.medium.com/ci-cd-for-tfx-pipelines-with-vertex-and-ai-platform-c562452fba1" rel="noopener">使用Vertex和AI平台的TFX管道的CI/CD</a>，我们将介绍如何使我们的模型在<a class="ae kv" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> Google云平台</a> (GCP)上可用，以及如何开发我们的CI/CD管道。</p><p id="232c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">完成本文后，您将能够:</p><ul class=""><li id="b5e6" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated">创建情感分析模型</li><li id="389d" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">创建集成所有组件的管道</li><li id="f4b6" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">通过REST API在本地服务您的模型</li><li id="b9fc" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">分析您的管道元数据</li></ul><p id="f4ec" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">整个应用程序的代码可以在这个GitHub存储库中找到<a class="ae kv" href="https://github.com/arturlunardi/sentiment-analysis-tfx" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="d9f7" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak"> 2。TFX(张量流扩展)+ MLOps </strong></h1><p id="8e71" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">为了建立我们的管道，我们将使用<a class="ae kv" href="https://www.tensorflow.org/tfx" rel="noopener ugc nofollow" target="_blank"> TFX </a>。</p><blockquote class="nd ne nf"><p id="c1ea" class="lo lp ng lq b lr mk jr lt lu ml ju lw nh mm lz ma ni mn md me nj mo mh mi mj ij bi translated">根据TFX用户指南，“TFX是一个基于TensorFlow的谷歌生产规模的机器学习(ML)平台。它提供了一个配置框架和共享库，以集成定义、启动和监控您的机器学习系统所需的通用组件。”</p></blockquote><p id="8f41" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">根据迪·fante⁵的说法，mlops中有三个非常重要的概念:</p><ul class=""><li id="97e0" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated">数据来源:你的数据来自哪里，它是如何产生的，提交了什么方法和过程。</li><li id="e918" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">数据谱系</strong>:到达流水线末端之前的步骤顺序。</li><li id="b616" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">元数据:</strong>描述数据的数据。它们用来解释我们所观察的物体的特征。</li></ul><p id="31b6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir">这3个是生产模型中的关键部分，因为它们可以帮助你跟踪模型生命周期中发生的变化。生产模型有几个版本、文件和涉及的人员，所以使用能够轻松再现我们管道所处环境的框架是很重要的，比如TFX。</strong></p><h1 id="85f4" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak"> 3。管道</strong></h1><p id="1ac1" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">TFX流水线是实现ML流水线的一系列组件，ML流水线是专门为可扩展的高性能机器学习任务设计的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/19d70874406909b83b1c0e4c958b45b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9VjWKD8W97Pn9CPoga2_pw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd nl">图一。</strong> TFX管道。这张图片复制自谷歌创作和分享的<a class="ae kv" href="https://developers.google.com/readme/policies" rel="noopener ugc nofollow" target="_blank">作品，并根据</a><a class="ae kv" href="https://creativecommons.org/licenses/by/4.0/" rel="noopener ugc nofollow" target="_blank">知识共享4.0归属许可</a>中描述的条款使用。来源:<a class="ae kv" href="https://www.tensorflow.org/tfx/guide" rel="noopener ugc nofollow" target="_blank">https://www.tensorflow.org/tfx/guide</a></p></figure><p id="b684" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">每个组件负责TFX管道中的一项任务，很多时候，一个组件依赖于另一个组件的输出。TFX有几个<a class="ae kv" href="https://www.tensorflow.org/tfx/tutorials" rel="noopener ugc nofollow" target="_blank">教程</a>解释如何使用<a class="ae kv" href="https://www.tensorflow.org/tfx/guide?#tfx_standard_components" rel="noopener ugc nofollow" target="_blank">组件</a>。</p><h2 id="8d42" class="nm kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated"><strong class="ak"> 3.1组件</strong></h2><p id="c891" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在我们的例子中，我们选择不使用InfraValidator组件。然而，我们选择在管道中增加一个节点，<a class="ae kv" href="https://www.tensorflow.org/tfx/api_docs/python/tfx/v1/dsl/Resolver" rel="noopener ugc nofollow" target="_blank"> Resolver </a>。Resolver是一个特殊的TFX节点，它处理特殊工件的解析，在我们的例子中，它被用来指定Evaluator组件中的最后一个基本模型。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/d4b0ab7e174732c8a7aecfc782f67f52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TRWTf9dXXDD1FuzRMI1qQw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd nl">图二。</strong> TFX地方管道(图片由作者提供)。这张图片是从谷歌创作和分享的<a class="ae kv" href="https://developers.google.com/readme/policies" rel="noopener ugc nofollow" target="_blank">作品中复制的，并根据</a><a class="ae kv" href="https://creativecommons.org/licenses/by/4.0/" rel="noopener ugc nofollow" target="_blank">知识共享4.0归属许可</a>中描述的条款使用。来源:<a class="ae kv" href="https://www.tensorflow.org/tfx/guide" rel="noopener ugc nofollow" target="_blank">https://www.tensorflow.org/tfx/guide</a></p></figure><p id="169c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在<em class="ng"> run_pipeline.py </em>中，我们定义了TFX管道。所有组件和参数都将位于该文件中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="f949" class="nm kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated"><strong class="ak"> 3.1.1示例生成</strong></h2><p id="fa0a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">它是管道的初始输入组件，处理并选择性地拆分输入数据集。使用外部来源的文件，如CSV、TFRecord、Avro、Parquet和BigQuery。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="8ce4" class="nm kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated">统计数据生成</h2><p id="86b5" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">计算数据集统计数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="99f3" class="nm kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated">3.1.3方案</h2><p id="19f4" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">检查统计数据并创建数据模式。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="1cf7" class="nm kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated">示例验证器</h2><p id="c02e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在数据的训练和传递中查找异常和缺失值，例如检测数据偏差。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="2d88" class="nm kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated"><strong class="ak"> 3.1.5转换</strong></h2><p id="3424" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">对数据集执行要素工程。在这个组件中，我们执行模型变量的所有转换/创建。该组件的一个重要之处在于，它生成一个存储数据全局属性的图表，这些属性将用于训练和推理，从而提供可靠性。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="6032" class="nm kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated"><strong class="ak"> 3.1.6调谐器</strong></h2><p id="7290" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">调整模型的超参数。调谐器可以在所有管道运行中运行，如果您只想不时地执行超参数调谐，也可以导入调谐器。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="ba83" class="nm kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated"><strong class="ak"> 3.1.7培训师</strong></h2><p id="43ac" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">训练模型。在这个组件中，除了定义它的整个架构之外，我们还指定了它将在哪里以及如何被训练。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="6098" class="nm kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated"><strong class="ak"> 3.1.8分解器</strong></h2><p id="0e06" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">一个特殊的TFX节点，处理特殊工件的解析，在我们的例子中，它用于指定评估器组件中的最后一个基本模型。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="b636" class="nm kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated"><strong class="ak"> 3.1.9评估员</strong></h2><p id="026b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">对培训结果进行深入分析，并帮助验证导出的模型，确保它们足够好，可以投入生产。在这个组件中，可以指定度量验证阈值，如果没有达到限制，就阻止模型投入生产。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="a30f" class="nm kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated"><strong class="ak"> 3.1.10推杆</strong></h2><p id="791a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">将模型部署到显示基础结构。这是我们指定模型将被服务的地方。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="c61c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">因此，我们的应用程序的结构是这样的:</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="a8a8" class="nm kx iq oc b gy og oh l oi oj">│   run_local_pipe.ipynb<br/>│<br/>├───modules<br/>│   │   label_encoder.pkl<br/>│   │   model.py<br/>│   │   preprocessing.py<br/>│   │<br/>│   ├───best_hyperparameters<br/>│   │       best_hyperparameter.txt<br/>│   │<br/>│   └───data<br/>│           data.csv<br/>│<br/>└───tfx-pipeline<br/>    │   kubeflow_v2_runner.py<br/>    │   local_runner.py<br/>    │<br/>    └───pipeline<br/>        │   configs.py<br/>        │   run_pipeline.py</span></pre><p id="4746" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在<strong class="lq ir"> <em class="ng"> tfx-pipeline </em> </strong>目录中，我们有引用编排器设置的文件。</p><ul class=""><li id="579f" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated"><em class="ng">local _ runner . py</em>-定义本地运行管道的参数和变量</li><li id="1c0f" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><em class="ng">kubeflow _ v2 _ runner . py</em>—定义参数和变量，使用kube flow作为编排器在本地/云运行管道</li></ul><p id="add7" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在<strong class="lq ir"><em class="ng">tfx-pipeline/pipeline</em></strong>中我们有引用管道设置的文件</p><ul class=""><li id="2225" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated"><em class="ng"> configs.py </em> —定义全局应用程序设置，如管道名称和文件路径</li><li id="c6d7" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><em class="ng">run _ pipeline . py</em>—TFX管道的定义，所有组件和参数的定义</li></ul><p id="8ed2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在<strong class="lq ir"> <em class="ng">模块</em> </strong>中我们有参考模型构造的文件。</p><ul class=""><li id="699b" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated"><em class="ng"> label_encoder.pkl </em> —来自sci-kit的LabelEncoder对象学习编码/解码目标变量</li><li id="a0de" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><em class="ng"> model.py </em> —构建分类模型(训练器组件)</li><li id="f66a" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><em class="ng">预处理. py </em> —变量的转换和预处理(转换组件)</li><li id="5226" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><em class="ng">best _ hyperparameter . txt</em>-来自调谐器组件的文件，包含模型的超参数</li></ul><p id="5a1d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">最后，使用<em class="ng"> run_local_pipe.ipynb </em>,除了分析生成的工件之外，我们还可以在本地创建和运行管道。</p><h2 id="0458" class="nm kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated"><strong class="ak"> 3.2 —模型建筑</strong></h2><p id="164f" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们的模型是对<a class="ae kv" href="https://arxiv.org/abs/1706.03762" rel="noopener ugc nofollow" target="_blank">变压器</a>架构的改编。这种架构的最大区别是引入了<em class="ng">注意机制</em>，它分析输入序列并提供序列每个部分重要性的上下文。因此，与递归神经网络(RNN)不同，<strong class="lq ir">这种架构允许数据并行化，减少了训练时间。</strong></p><p id="882a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">该模型是用TensorFlow构建的，目标是将句子分类为肯定、否定或中性，因此<strong class="lq ir">它是一个分类模型。</strong></p><p id="5238" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在管道构建过程中，有两个非常重要的组件:Transform和Trainer。在我们的架构中，这些组件分别由文件<em class="ng"> preprocessing.py </em>和<em class="ng"> model.py </em>表示。让我们逐一解决这些问题，以理解变量的处理和模型的构建。</p><h2 id="c558" class="nm kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated"><strong class="ak"> 3.2.1数据</strong></h2><p id="fe53" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><strong class="lq ir">我们的训练数据是葡萄牙语(PT-BR) </strong>的新闻标题，分类为:正面、负面或中性，已经通过LabelEncoder以数字格式表示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/f1a8878b3a463d39f70a852ac6bc0e82.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*WE_UnKbQ9EVCZ2ciXuJlQQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd nl">图三。</strong>训练数据(图片由作者提供)。</p></figure><h2 id="6b96" class="nm kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated"><strong class="ak"> 3.2.2预处理</strong></h2><p id="0e08" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们选择对输入数据执行一些转换。下面的函数说明了输入数据的变换。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="75ae" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">重点是从输入字符串中删除重音符号、特殊字符、数字和停用词。</p><h2 id="74bb" class="nm kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated"><strong class="ak"> 3.2.3型号</strong></h2><p id="a74e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们不会深入所有数据加载/训练函数的细节，因为它们已经在TFX教程中广泛演示过了。</p><p id="b8d3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我只想讨论定义模型的两个要点:架构和签名。</p><h2 id="37d2" class="nm kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated"><strong class="ak">建筑</strong></h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/9f70c5bcde1c0923b9fad22a228722a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*zHS07X0RStjXbghHHdidiw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd nl">图4。</strong>模型建筑(图片由作者提供)。</p></figure><p id="20dd" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">由于<strong class="lq ir">我们的模型是对原始架构</strong>的改编，我们选择让它更简单。</p><p id="4107" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们的模型接受输入并将它们转换成嵌入，嵌入是句子的向量表示。之后，嵌入内容被传递到多头注意力层，多头注意力层将为句子中的每个单词创建向量，表示单词之间的重要性和上下文关系。归一化层用于帮助稳定梯度下降并帮助模型收敛。</p><p id="ff6c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">最后，我们将输出传递给前馈网络(FFN)，这是一个简单的层，有助于将注意力向量转换为块之间可消化的形式。我们添加了几个类似的层，直到我们定义了输出层，由softmax函数激活，它输出一个概率向量，涉及目标变量的3个类别。</p><p id="065a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这样，我们的模型构造如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="7223" class="nm kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated"><strong class="ak">签名</strong></h2><p id="0c17" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">当使机器学习模型可用时，我们需要考虑我们的模型将如何接收数据进行预测。TensorFlow模型具有<a class="ae kv" href="https://www.tensorflow.org/guide/saved_model" rel="noopener ugc nofollow" target="_blank"> SavedModel </a>格式，它允许我们创建几个签名来定义我们的模型将如何接收数据并做出可用的预测。</p><p id="d28c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">因此，我们<strong class="lq ir">创建了一个签名，它接受字符串形式的输入</strong>，而不是最初的TFX示例，它期望数据为<a class="ae kv" href="https://www.tensorflow.org/api_docs/python/tf/train/Example" rel="noopener ugc nofollow" target="_blank"> tf.train.Example </a>格式。我们的<strong class="lq ir">签名的输出返回每个类的概率，具有最高概率的类，以及最高预测概率的值。</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="8cdc" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">然后，我们定义模型的签名。在预测时，我们可以选择我们想要的签名，因此我们的模型可以接受几种数据格式。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h1 id="0fe0" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak"> 4。本地部署</strong></h1><p id="87f9" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">最后，我们可以运行我们的管道。<em class="ng"> run_local_pipe.ipynb </em>笔记本是为我们创建、运行和分析我们的管道而制作的。</p><p id="243d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们使用TFX-cli创建管道，将本地引擎和所需文件的路径作为参数传递，在这个文件中是<em class="ng"> local_runner.py </em>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="5fa5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">最后，我们可以运行它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="5cec" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在，我们的所有组件都将运行，我们的模型可用于预测。</p><h1 id="e349" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak"> 5。为模型提供TensorFlow服务</strong></h1><p id="74ab" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">有几种方法可以为预测模型提供服务，其中一种是TensorFlow服务。</p><blockquote class="nd ne nf"><p id="c692" class="lo lp ng lq b lr mk jr lt lu ml ju lw nh mm lz ma ni mn md me nj mo mh mi mj ij bi translated">TensorFlow Serving是一个灵活、高性能的机器学习模型服务系统，专为生产环境而设计。TensorFlow服务可以轻松部署新的算法和实验，同时保持相同的服务器架构和API。TensorFlow服务提供了与TensorFlow模型的现成集成，但可以轻松扩展为服务于其他类型的模型和数据。⁴</p></blockquote><p id="1bec" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">首先，我们定义模型的位置，并下载TF服务包。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="806c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">然后我们开始TensorFlow服务。这里我们定义一些重要的参数:</p><p id="44e2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">-<strong class="lq ir"><em class="ng">rest _ API _ port</em></strong>:将用于REST请求的端口。</p><p id="faa6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">- <strong class="lq ir"> <em class="ng"> model_name </em> </strong>:您将在REST请求的URL中使用这个。什么都有可能。</p><p id="10de" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">-<strong class="lq ir"><em class="ng">model _ base _ path</em></strong>:这是你保存模型的目录路径。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="9d5d" class="nm kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated"><strong class="ak"> 5.1提出休息请求</strong></h2><p id="d83e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们现在准备提出请求。我们加载我们的编码器来根据训练转换我们的目标变量，我们定义url、我们的签名和我们想要预测的数据。然后，我们向我们的服务器发出一个POST预测请求，它会返回每个实例参与目标类的概率、预测的类以及最高预测概率的值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h1 id="bf71" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak"> 6。评估管道工件</strong></h1><p id="05fa" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">TFX管道组件的输出被称为工件。这些工件注册在元数据存储库中，我们在设置中定义它。这些工件中的一些可以用图形可视化，它们为我们的数据提供了有价值的见解。</p><p id="172d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir">我们可以通过我们的元数据存储库访问由我们的管道产生的工件。</strong>我们还可以过滤特定类型的赝像，以可视化和定义这些赝像的输出路径。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="4bc9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">从这些人工制品中，我们可以形象地展示它们。例如，让我们来看看统计结果。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="0c26" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">然后，我们可以并排查看训练和验证数据统计。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/9b3883fe65464d0dde2533d339f6150e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uxrcawqk9OR767zgjPV_rg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd nl">图5。</strong> StatisticsGen(图片由作者提供)。</p></figure><h1 id="5dc0" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak"> 7。结论</strong></h1><p id="bb10" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">开发本地管道是集成我们的应用程序并能够标准化我们模型的训练和推理的第一步。为了改进我们的管道，在本文的第2部分中，除了应用CI/CD实践之外，我们将在云环境中开发和部署它，使它可扩展并且更易于维护。</p><h1 id="fbce" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak"> 8。参考文献</strong></h1><p id="6775" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">[1]<a class="ae kv" href="https://www.tensorflow.org/tfx/guide" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir">《TFX用户指南》</strong></a>(2021年9月01日)，TensorFlow。</p><p id="555e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">[2]瓦斯瓦尼，a；新泽西州沙泽尔、新泽西州帕尔马；Uszkoreit，j；琼斯湖；戈麦斯。凯泽湖；Polosukhin，I. <a class="ae kv" href="https://arxiv.org/abs/1706.03762v5" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir">注意力是你所需要的全部。</strong></a>(2017年6月12日)，arXiv预印本arXiv:1706.03762。</p><p id="1d05" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">[3]南丹，A. <a class="ae kv" href="https://keras.io/examples/nlp/text_classification_with_transformer/" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir">文字分类用变压器</strong></a>(2020年5月10日)，Keras。</p><p id="aa7b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">【4】<a class="ae kv" href="https://www.tensorflow.org/tfx/guide/serving" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir">TF服役</strong></a>(2021年1月28日)，TensorFlow。</p><p id="74fc" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">[5]迪凡特，A. L. <a class="ae kv" rel="noopener" target="_blank" href="/how-i-deployed-my-first-machine-learning-model-1147c04c449b"> <strong class="lq ir">我如何部署我的第一个机器学习模型</strong></a>(2021年12月15日)，中。</p><p id="bdf8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">[6] Amoateng，D. <a class="ae kv" href="https://github.com/amoat7/Text_classification_pipeline_tfx_local" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir">文本分类管道tfx local</strong></a>(2022年1月1日)，GitHub。</p></div></div>    
</body>
</html>