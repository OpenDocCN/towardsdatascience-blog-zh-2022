<html>
<head>
<title>Causal Effects via Propensity Scores</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过倾向得分的因果效应</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/propensity-score-5c29c480130c#2022-09-06">https://towardsdatascience.com/propensity-score-5c29c480130c#2022-09-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="96c8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何估计观测数据的影响</h2></div><p id="a5c8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本文是因果效应系列文章的第二篇。在前一篇文章中，我们为<a class="ae le" rel="noopener" target="_blank" href="/causal-effects-f30f962ffff3">因果关系</a>奠定了理论基础，但仍有一些挥之不去的实际问题。也就是说，<em class="lf">我们如何从观测数据中计算因果关系？</em>在这里，我将讨论一套技术，使用一种叫做倾向得分的东西来做到这一点。在讨论之后，我们将给出使用这些技术处理真实数据的示例Python代码。</p><p id="de45" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">要点:</strong></p><ol class=""><li id="6aa8" class="lg lh it kk b kl km ko kp kr li kv lj kz lk ld ll lm ln lo bi translated">倾向评分评估治疗的可能性</li><li id="8338" class="lg lh it kk b kl lp ko lq kr lr kv ls kz lt ld ll lm ln lo bi translated">具有相似倾向得分的受试者具有相似的基线协变量</li><li id="4d33" class="lg lh it kk b kl lp ko lq kr lr kv ls kz lt ld ll lm ln lo bi translated">3流行的倾向评分技术有:匹配、分层和治疗加权的逆概率</li></ol><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi lu"><img src="../Images/137fe62bca01dbd0a08becb97ea12bb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dr6q5FH93Bqr3EIkwFOW8A.png"/></div></div><p class="mg mh gj gh gi mi mj bd b be z dk translated">倾向评分估计治疗的可能性。图片作者。</p></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="2c87" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了估计因果关系，我们需要数据。更具体地说，我们需要包含<strong class="kk iu">结果</strong>、<strong class="kk iu">治疗</strong>和<strong class="kk iu">协变量</strong>的数据(之前的<a class="ae le" rel="noopener" target="_blank" href="/causal-effects-f30f962ffff3">定义为</a>)。然而，并不是所有的数据源都是相同的。在讨论倾向得分之前，我们必须明确区分两种获取数据的方式。</p><h1 id="165d" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated"><strong class="ak">观察性与介入性研究</strong></h1><p id="540e" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">第一个<strong class="kk iu">我们可以称之为<strong class="kk iu">观察研究</strong>。这包括被动地测量系统，而不干预数据生成过程。大多数数据收集都属于这一类别。</strong></p><p id="4493" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第二种获取数据的方式我们可以称之为<strong class="kk iu">介入研究</strong>。这是我们为了一个特定的目标而故意影响数据生成过程的时候。这包括像<strong class="kk iu">随机对照试验</strong>这样的事情，其中一个群体的<em class="lf">随机</em>样本被分成两组(即对照组和治疗组)并进行比较。随机化的主要好处是，它将倾向于在<strong class="kk iu">测量和未测量</strong>协变量[ <a class="ae le" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3144483/" rel="noopener ugc nofollow" target="_blank"> 1 </a> ]方面平衡治疗和对照人群。</p><p id="bcf8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">区分这些类型的研究有两个原因。<strong class="kk iu">一</strong>，观察数据一般不控制亚群体大小(如对照组可能比治疗组大10倍)，而<strong class="kk iu">二</strong>，对照组和治疗组可能存在系统差异。</p><p id="e26f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，如果试图估计吸烟对肝脏健康的因果影响，如果吸烟者比不吸烟者倾向于喝更多的酒，比较吸烟者和不吸烟者(在野外)可能会产生有偏见的估计。</p><p id="8652" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，如果试图从观察数据中计算出无偏的因果效应，我们可能会感到绝望。然而，你可能已经从副标题中猜到了，有一个解决方案:倾向得分。</p><h1 id="3cd7" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated"><strong class="ak">倾向得分</strong></h1><p id="008c" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">一个<strong class="kk iu">倾向得分</strong>估计一个受试者 <strong class="kk iu">基于其他特征</strong>(即协变量)接受特定治疗的<strong class="kk iu">概率。这个分数接近平衡分数，这意味着当条件成立时，治疗组和对照组的协变量看起来相似。这使得对照人群和治疗人群的比较令人想起介入研究，但来自观察数据[ <a class="ae le" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3144483/" rel="noopener ugc nofollow" target="_blank"> 1 </a> ]。</strong></p><p id="6902" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">生成倾向得分最流行的方法是通过逻辑回归[ <a class="ae le" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3144483/" rel="noopener ugc nofollow" target="_blank"> 1 </a> ]。考虑一下<a class="ae le" rel="noopener" target="_blank" href="/causal-effects-f30f962ffff3">上一篇文章</a>中的Tylenol例子。在那里，我们进行了治疗(即一种药丸)，我们想测量它对结果(即头痛状态)的影响。</p><p id="3e05" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但假设现在我们无法获得来自RCT的数据，只有包含以下信息的观察数据:年龄、收入、性别、是否服药以及头痛状况的变化。</p><p id="aae5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有了这个数据集，我们可以通过逻辑回归模型以一种直接的方式获得倾向得分。我们简单地将我们的协变量(即年龄、收入和性别)设置为<strong class="kk iu">预测值</strong>，将“是否服药”变量设置为<strong class="kk iu">目标值</strong>。下图对此进行了说明。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi no"><img src="../Images/1a98e8ad71649a7b368fc8e5584875b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G5RHbRZCzK9yUW_Ni7Sj7g.png"/></div></div><p class="mg mh gj gh gi mi mj bd b be z dk translated">生成倾向得分的第一步。将协变量和治疗变量传递到逻辑回归模型中。图片作者。</p></figure><p id="369f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦我们有了逻辑回归模型，我们就可以获得数据集中每个受试者的治疗概率(即倾向得分)。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi np"><img src="../Images/a1f22e539734b1fe7d909cef2471b571.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uM3W3HNBArG1nuXXSZW1zg.png"/></div></div><p class="mg mh gj gh gi mi mj bd b be z dk translated">生成倾向得分的第2步。将每个受试者的协变量数据输入到逻辑回归模型中，获得得分。图片作者。</p></figure><h1 id="f130" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated"><strong class="ak"> 3种倾向评分方法</strong></h1><p id="74db" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">既然我们知道了什么是倾向得分以及如何计算，我们转向如何使用倾向得分来估计因果关系。在这里，我描述了3种流行的方法来做到这一点。</p><h2 id="8508" class="nq ms it bd mt nr ns dn mx nt nu dp nb kr nv nw nd kv nx ny nf kz nz oa nh ob bi translated"><strong class="ak"> 1)匹配</strong></h2><p id="4090" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated"><strong class="kk iu">匹配</strong>包括创建具有相似倾向得分的<strong class="kk iu">治疗-未治疗对</strong>。一个简单的方法是通过以<em class="lf">贪婪</em>方式<em class="lf">(贪婪搜索先前描述的</em><a class="ae le" rel="noopener" target="_blank" href="/causal-discovery-6858f9af6dcb"><em class="lf"/></a><em class="lf">)</em>将每个治疗的对象与具有最接近倾向得分的未治疗的对象进行匹配。</p><p id="6b1a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">换句话说，挑选一个接受治疗的受试者，将他们与倾向得分最接近的未接受治疗的受试者一一匹配。如果我们确保没有未经治疗的受试者与一个以上经治疗的受试者匹配，则称之为<strong class="kk iu">无替代匹配</strong>。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi oc"><img src="../Images/b249fb7b94e0145e987e255b17e86c08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K480UhgiFpwuygzYAM_DJQ.png"/></div></div><p class="mg mh gj gh gi mi mj bd b be z dk translated">倾向评分匹配(无替换)的工作原理说明。图片作者。</p></figure><p id="b118" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该过程将创建所谓的<strong class="kk iu">匹配样本</strong>，其中<strong class="kk iu">每个治疗对象与未治疗对象</strong>匹配。注意，在上图中，倾向分数为0.07和0.12的受试者没有与接受治疗的受试者匹配，因此这些受试者没有进入匹配样本。</p><p id="caf8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有了我们匹配的样本，就可以通过直接比较治疗和未治疗的人群来计算治疗效果，就像我们在<a class="ae le" rel="noopener" target="_blank" href="/causal-effects-f30f962ffff3">之前的博客</a>中所做的那样。更多匹配策略见奥斯汀的论文。</p><h2 id="d752" class="nq ms it bd mt nr ns dn mx nt nu dp nb kr nv nw nd kv nx ny nf kz nz oa nh ob bi translated"><strong class="ak"> 2)分层</strong></h2><p id="8d75" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated"><strong class="kk iu">倾向得分<strong class="kk iu">的分层</strong>将受试者分成具有相似倾向得分</strong>的组，在这些组中可以计算因果关系。这通常作为<strong class="kk iu">两步流程</strong>来完成。<strong class="kk iu">首先</strong>，受试者根据其倾向得分进行排名排序(即从最小到最大PS排序)。<strong class="kk iu">然后</strong>，排序后的科目被拆分成大小相等的组(即分位数)。</p><p id="46cb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">基于<a class="ae le" href="https://psycnet.apa.org/record/1968-16440-001" rel="noopener ugc nofollow" target="_blank"> Cochran (1968) </a>的工作，一个好的经验法则是将受试者分成5组(即五分位数)，然而，也可以做出其他选择。例如，在下图中，这个两步过程是针对被分成4个大小相等的组(即四分位数)的受试者进行说明的。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi no"><img src="../Images/64e56201d03bb2a47d965a76743d43d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LCRvlPP1VQkK29rOm2Lghg.png"/></div></div><p class="mg mh gj gh gi mi mj bd b be z dk translated">对倾向评分进行分层的两步流程图。图片作者。</p></figure><p id="f7d5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦我们根据PS对受试者进行了分层，我们就可以通过<strong class="kk iu">直接比较每组</strong>内的治疗和未治疗人群(作为前的<a class="ae le" rel="noopener" target="_blank" href="/causal-effects-f30f962ffff3">)来计算治疗效果。然后，我们更进一步，通过加权平均汇总组水平的治疗效果，以获得总体治疗效果。</a></p><h2 id="2faf" class="nq ms it bd mt nr ns dn mx nt nu dp nb kr nv nw nd kv nx ny nf kz nz oa nh ob bi translated"><strong class="ak"> 3)治疗权重的逆概率(IPTW) </strong></h2><p id="045a" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated"><strong class="kk iu">治疗加权的逆概率</strong>与我们迄今为止讨论的方法相比有着根本的不同。在匹配和分层中，我们使用倾向评分来导出<em class="lf">受试者组</em>，这些受试者组可用于计算治疗效果。然而，对于IPTW，<strong class="kk iu">我们使用倾向得分来推导每个受试者的<em class="lf">权重</em>，然后这些权重用于直接计算治疗效果</strong>。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi od"><img src="../Images/d56f057e66d65e134374a0fdea982c28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WTKiqp0VpPUWSLT9Jhw5sQ.png"/></div></div><p class="mg mh gj gh gi mi mj bd b be z dk translated">说明如何计算治疗加权逆概率的权重(IPTW)。图片作者。</p></figure><p id="6bbe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了计算效果，我们先从<strong class="kk iu">开始</strong>，我们根据上图右侧的等式给每个受试者分配一个权重。注意，治疗和未治疗受试者的体重方程是不同的。</p><p id="b5d4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">接下来</strong>，我们使用刚刚得出的权重，分别对接受治疗和未接受治疗的受试者的结果变量值进行汇总。<strong class="kk iu">最后</strong>，我们取治疗和未治疗人群的汇总结果值的差值。这种差异被视为平均处理效果(ATE)。下面给出了整个过程的直观总结。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi oe"><img src="../Images/b66641792add71094985ae3e837b271b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*scMiqY765Pi-Echdqlvysg.png"/></div></div><p class="mg mh gj gh gi mi mj bd b be z dk translated">如何使用治疗加权的逆概率计算平均治疗效果的直观总结(IPTW)。图片作者。</p></figure><h2 id="39e4" class="nq ms it bd mt nr ns dn mx nt nu dp nb kr nv nw nd kv nx ny nf kz nz oa nh ob bi translated"><strong class="ak">平衡诊断:评估倾向评分绩效</strong></h2><p id="4308" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">在理想情况下，倾向得分是一个平衡得分，也就是说，如果我们看两个得分相同的受试者，他们的潜在协变量应该是相同的。然而，在实践中，这种情况很少发生。倾向分数仅仅作为这种理想情况的近似。</p><p id="4d4d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">也就是说，我们可以使用这个想法来推导策略，以评估我们的倾向得分模型的性能。例如，在匹配的情况下，我们可以在匹配的样本中选取处理组和未处理组，并比较它们的潜在协变量分布。</p><p id="2d11" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于正态分布的变量，这可以通过简单地比较平均值和标准差来实现。对于其他类型的分布，可以使用诸如KS检验、KL散度、Wasserstein距离等技术。关于平衡诊断的进一步讨论，我建议读者参考奥斯汀[<a class="ae le" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3144483/" rel="noopener ugc nofollow" target="_blank">1</a>]<strong class="kk iu">T3]的精彩论文。 </strong></p><h2 id="83d1" class="nq ms it bd mt nr ns dn mx nt nu dp nb kr nv nw nd kv nx ny nf kz nz oa nh ob bi translated"><strong class="ak">基于回归的技术</strong></h2><p id="5cb7" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">在进入示例代码之前，值得一提的是，当试图从观察数据中计算因果效应时，基于倾向得分的方法并不是我们唯一的选择。还有另外一类技术，我们可以称之为<a class="ae le" rel="noopener" target="_blank" href="/causal-effects-via-regression-28cb58a2fffc"> <strong class="kk iu">基于回归的</strong> </a>。这包括诸如<strong class="kk iu">线性回归、元学习器和双机器学习</strong>等方法。事实上，在之前关于<a class="ae le" rel="noopener" target="_blank" href="/causal-inference-962ae97cefda">因果推理</a>的一篇文章中，我们使用了一个元学习者来估计读研对收入的影响。在这里，我们将重复这一分析，但现在使用基于倾向得分的方法。</p><div class="of og gp gr oh oi"><a rel="noopener follow" target="_blank" href="/causal-effects-via-regression-28cb58a2fffc"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd iu gy z fp on fr fs oo fu fw is bi translated">通过回归的因果效应</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">Python示例代码的3种流行技术</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">towardsdatascience.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow me oi"/></div></div></a></div><h1 id="d78d" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated"><strong class="ak">示例:估计研究生院对收入的治疗效果(使用倾向得分)</strong></h1><p id="66b8" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">在这个例子中，我们将使用前面讨论的3种倾向得分方法来估计研究生学位对收入的因果影响。该分析与<a class="ae le" rel="noopener" target="_blank" href="/causal-inference-962ae97cefda">因果推理</a>博客中的例子几乎相同。我们再次使用<a class="ae le" href="https://py-why.github.io/dowhy/v0.8/" rel="noopener ugc nofollow" target="_blank"> DoWhy </a> Python库，并且在我们的因果模型中只考虑3个变量:年龄、hasGraduateDegree和大于50k(收入)。示例代码可以在<a class="ae le" href="https://github.com/ShawhinT/YouTube-Blog/tree/main/propensity_score" rel="noopener ugc nofollow" target="_blank"> GitHub Repo </a>中找到。</p><p id="c3db" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们从导入必要的Python模块开始。</p><pre class="lv lw lx ly gt ox oy oz pa aw pb bi"><span id="c793" class="nq ms it oy b gy pc pd l pe pf"><strong class="oy iu">import</strong> pickle<br/><br/><strong class="oy iu">import</strong> dowhy<br/><strong class="oy iu">from</strong> dowhy <strong class="oy iu">import</strong> CausalModel<br/><strong class="oy iu">import</strong> numpy <strong class="oy iu">as</strong> np</span></pre><p id="a651" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们加载数据集。这里我们使用同样的<a class="ae le" href="https://archive.ics.uci.edu/ml/datasets/census+income" rel="noopener ugc nofollow" target="_blank">美国人口普查数据</a>来自<a class="ae le" rel="noopener" target="_blank" href="/causal-discovery-6858f9af6dcb">因果发现</a>例子【3】。</p><pre class="lv lw lx ly gt ox oy oz pa aw pb bi"><span id="142d" class="nq ms it oy b gy pc pd l pe pf">df <strong class="oy iu">=</strong> pickle<strong class="oy iu">.</strong>load( open( "df_propensity_score.p", "rb" ) )</span></pre><p id="bc2c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用Python DoWhy库估算因果效应的第一步是明确定义<strong class="kk iu">因果模型</strong>，即陈述变量之间的<strong class="kk iu">因果关系。这里，我们将假设与之前的<a class="ae le" rel="noopener" target="_blank" href="/causal-inference-962ae97cefda">相同的因果模型。</a></strong></p><pre class="lv lw lx ly gt ox oy oz pa aw pb bi"><span id="bf85" class="nq ms it oy b gy pc pd l pe pf">model<strong class="oy iu">=</strong>CausalModel(<br/>        data <strong class="oy iu">=</strong> df,<br/>        treatment<strong class="oy iu">=</strong> "hasGraduateDegree",<br/>        outcome<strong class="oy iu">=</strong> "greaterThan50k",<br/>        common_causes<strong class="oy iu">=</strong>"age",<br/>        )</span><span id="e5fa" class="nq ms it oy b gy pg pd l pe pf">model<strong class="oy iu">.</strong>view_model()</span></pre><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/888a7c1a1addb1eff53adfde016fd321.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*OE7TLqiKs6dEX1uWVjNXDA.png"/></div><p class="mg mh gj gh gi mi mj bd b be z dk translated">view_model()方法的输出是我们的因果模型的图形表示。</p></figure><p id="b7a7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们生成一个estimand，这是计算因果效应的基本方法。这确保了测量的混杂因素(即年龄)得到适当的调整。</p><pre class="lv lw lx ly gt ox oy oz pa aw pb bi"><span id="3f32" class="nq ms it oy b gy pc pd l pe pf">identified_estimand_experiment <strong class="oy iu">=</strong> model<strong class="oy iu">.</strong>identify_effect(proceed_when_unidentifiable<strong class="oy iu">=True</strong>)</span></pre><p id="e5b9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们最终可以使用每种倾向得分方法来估计hasGraduateDegree对greaterThan50k的因果效应。</p><pre class="lv lw lx ly gt ox oy oz pa aw pb bi"><span id="3ffe" class="nq ms it oy b gy pc pd l pe pf"><em class="lf"># create list of names of the propensity score methods</em><br/>ps_method_name_list <strong class="oy iu">=</strong> ["matching", "stratification", "weighting"]</span><span id="0d21" class="nq ms it oy b gy pg pd l pe pf"><em class="lf"># initialize dictionary to store estimates from each method and list to store ATEs</em><br/>ps_estimate_dict <strong class="oy iu">=</strong> {}<br/>ps_estimate_val_list <strong class="oy iu">=</strong> []</span><span id="e989" class="nq ms it oy b gy pg pd l pe pf"># estimate effect for each method<br/><strong class="oy iu">for</strong> ps_method_name <strong class="oy iu">in</strong> ps_method_name_list:<br/>    ps_estimate <strong class="oy iu">=  </strong>model<strong class="oy iu">.</strong>estimate_effect(identified_estimand_experiment,<br/>                                    method_name<strong class="oy iu">=</strong>"backdoor.propensity_score_" <strong class="oy iu">+</strong> ps_method_name,<br/>                                    confidence_intervals<strong class="oy iu">=False</strong>,<br/>                                    method_params<strong class="oy iu">=</strong>{})<br/>    <em class="lf"># add estimate to dict and ATE to list</em><br/>    ps_estimate_dict[ps_method_name] <strong class="oy iu">=</strong> ps_estimate<br/>    ps_estimate_val_list<strong class="oy iu">.</strong>append(ps_estimate<strong class="oy iu">.</strong>value)<br/>    <br/>    print(ps_estimate)<br/>    print("\n")</span></pre><p id="bb2d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每种方法的平均处理效果估计如下:<strong class="kk iu">匹配</strong> — 0.136，<strong class="kk iu">分层</strong> — 0.25，<strong class="kk iu"> IPTW </strong> — 0.331。给出大约0.24的总平均值。</p><h2 id="4fb4" class="nq ms it bd mt nr ns dn mx nt nu dp nb kr nv nw nd kv nx ny nf kz nz oa nh ob bi translated">我该如何解读这个？</h2><p id="c681" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">我们可以把这个总比率解释为:在给定的年龄，即<strong class="kk iu">读研究生，获得研究生学位的期望值的单位变化将导致某人一年挣5万多的概率增加大约24%</strong>。这些结果与我们之前使用元学习者方法看到的<a class="ae le" rel="noopener" target="_blank" href="/causal-inference-962ae97cefda"/>大致相同(我们看到ATE = 0.20)。</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="pi pj l"/></div></figure><h2 id="5998" class="nq ms it bd mt nr ns dn mx nt nu dp nb kr nv nw nd kv nx ny nf kz nz oa nh ob bi translated">一句警告</h2><p id="85ed" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">最后，我要提醒从业者对这些方法要有所保留。不像随机对照试验那样，随机化可以处理来自<strong class="kk iu">测量的</strong> <strong class="kk iu">和</strong>未测量的混杂因素的偏倚，倾向评分方法只帮助我们对抗<strong class="kk iu">测量的</strong>混杂因素。</p><p id="b063" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，可以想象，还有其他一些影响学位和收入的因素没有被我们的数据集捕捉到，比如:父母的职业/收入、研究领域和职业道德。</p><p id="80f2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本系列的下一篇博客中，我们将讨论<strong class="kk iu">如何应对不可测量的混杂因素</strong>，并将do运算符带回我们对因果关系的讨论。</p><div class="of og gp gr oh oi"><a rel="noopener follow" target="_blank" href="/causal-effects-via-the-do-operator-5415aefc834a"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd iu gy z fp on fr fs oo fu fw is bi translated">通过Do运算符的因果关系</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">将观察转化为干预</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">towardsdatascience.com</p></div></div><div class="or l"><div class="pk l ot ou ov or ow me oi"/></div></div></a></div></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="cfa7" class="mr ms it bd mt mu pl mw mx my pm na nb jz pn ka nd kc po kd nf kf pp kg nh ni bi translated">资源</h1><p id="6b12" class="pw-post-body-paragraph ki kj it kk b kl nj ju kn ko nk jx kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated"><strong class="kk iu">更多关于因果关系</strong> : <a class="ae le" href="https://shawhin.medium.com/understanding-causal-effects-37a054b2ec3b" rel="noopener">因果关系概述</a> | <a class="ae le" rel="noopener" target="_blank" href="/causality-an-introduction-f8a3f6ac4c4a">因果关系:介绍</a> | <a class="ae le" rel="noopener" target="_blank" href="/causal-inference-962ae97cefda">因果推断</a> | <a class="ae le" rel="noopener" target="_blank" href="/causal-discovery-6858f9af6dcb">因果发现</a></p><p id="bd97" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">连接</strong> : <a class="ae le" href="https://shawhint.github.io/" rel="noopener ugc nofollow" target="_blank">我的网站</a> | <a class="ae le" href="https://calendly.com/shawhintalebi" rel="noopener ugc nofollow" target="_blank">预定电话</a> | <a class="ae le" href="https://shawhint.github.io/connect.html" rel="noopener ugc nofollow" target="_blank">发邮件给我</a></p><p id="506f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">社交</strong>:<a class="ae le" href="https://www.youtube.com/channel/UCa9gErQ9AE5jT2DZLjXBIdA" rel="noopener ugc nofollow" target="_blank">YouTube</a>|<a class="ae le" href="https://www.linkedin.com/in/shawhintalebi/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae le" href="https://twitter.com/ShawhinT" rel="noopener ugc nofollow" target="_blank">Twitter</a></p><p id="e857" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">支持</strong> : <a class="ae le" href="https://www.buymeacoffee.com/shawhint?source=about_page-------------------------------------" rel="noopener ugc nofollow" target="_blank">给我买杯咖啡</a> ☕️ | <a class="ae le" href="https://shawhin.medium.com/membership?source=about_page-------------------------------------" rel="noopener">成为会员</a> ⭐️</p><div class="of og gp gr oh oi"><a href="https://shawhin.medium.com/membership" rel="noopener follow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd iu gy z fp on fr fs oo fu fw is bi translated">通过我的推荐链接加入媒体——肖文·塔莱比</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">⭐️成为会员使用我的推荐链接，并获得充分的媒体上的每一篇文章。您的会员费直接…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">shawhin.medium.com</p></div></div><div class="or l"><div class="pq l ot ou ov or ow me oi"/></div></div></a></div></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="e799" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[1] <a class="ae le" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3144483/" rel="noopener ugc nofollow" target="_blank">减少观察性研究中混杂效应的倾向评分方法简介</a>作者Peter C. Austin</p><p id="35e5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[2] <a class="ae le" href="https://academic.oup.com/biomet/article/70/1/41/240879" rel="noopener ugc nofollow" target="_blank">保罗·r·罗森鲍姆</a>唐纳德·b·鲁宾&amp;的《倾向评分在因果效应观察研究中的核心作用》</p><p id="903c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[3] <a class="ae le" href="https://archive.ics.uci.edu/ml/datasets/census+income" rel="noopener ugc nofollow" target="_blank"> Dua，d .和Graff，C. (2019)。http://archive.ics.uci.edu/ml UCI机器学习库</a>。加州欧文:加州大学信息与计算机科学学院。</p></div></div>    
</body>
</html>