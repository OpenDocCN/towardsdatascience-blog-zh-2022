<html>
<head>
<title>Tips and Tricks for Loading Excel Spreadsheets into Pandas DataFrames</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将 Excel 电子表格加载到 Pandas 数据框架中的技巧和诀窍</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tips-and-tricks-for-loading-excel-spreadsheets-into-pandas-dataframes-c486ac1ed16f#2022-12-30">https://towardsdatascience.com/tips-and-tricks-for-loading-excel-spreadsheets-into-pandas-dataframes-c486ac1ed16f#2022-12-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c57a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何正确地将工作表加载到 Pandas 数据框架中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/69d7358a6b705e4657f7f36d7fbf9417.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*i9vWIVqMWlzMA_PG"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">鲁拜图·阿扎德在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="6200" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在大多数数据分析项目中，您通常会遇到的最常见和最流行的数据文件格式之一是 CSV。然而，来自金融部门的人经常处理另一种格式——Excel 电子表格。</p><p id="e18d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然很多关于 Pandas DataFrame 的文章都侧重于使用 CSV 文件加载，但在本文中，我将重点讨论 Excel。我将向您展示如何将工作表从 Excel 加载到您的数据框架中，以及一些将工作表的一部分加载到数据框架中的技巧和诀窍。</p><p id="2dc5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于本文，我将使用两个示例 Excel 电子表格。</p><blockquote class="lv lw lx"><p id="d15f" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><strong class="lb iu">注</strong>:本文所有图片和截图均由作者创作</p></blockquote><h2 id="e05f" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">相关阅读</h2><blockquote class="lv lw lx"><p id="d799" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><strong class="lb iu">将大型 CSV 文件加载到 Pandas DataFrames 的提示和技巧</strong> — <strong class="lb iu">第 2 部分</strong>(<a class="ae ky" rel="noopener" target="_blank" href="/tips-and-tricks-for-loading-large-csv-files-into-pandas-dataframes-part-2-5fc02fc4e3ab">https://towards data science . com/Tips-and-Tricks-for-load-Large-CSV-Files-into-Pandas-data frames-Part-2-5fc 02 fc 4 E3 ab</a>)</p><p id="a540" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><strong class="lb iu">将大型 CSV 文件加载到 Pandas DataFrames 的提示和技巧—第 1 部分</strong>(<a class="ae ky" rel="noopener" target="_blank" href="/tips-and-tricks-for-loading-large-csv-files-into-pandas-dataframes-part-1-fac6e351fe79">https://towards data science . com/Tips-and-Tricks-for-load-Large-CSV-Files-into-Pandas-data frames-Part-1-fac 6 e 351 Fe 79</a>)</p></blockquote><h1 id="7420" class="mv md it bd me mw mx my mh mz na nb mk jz nc ka mn kc nd kd mq kf ne kg mt nf bi translated">样本 Excel 电子表格#1</h1><p id="46b9" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我的第一个 Excel 电子表格样本(<strong class="lb iu">my data . xls</strong>)；自行创建)包含两个工作表:</p><ul class=""><li id="9002" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated"><strong class="lb iu">机场</strong></li><li id="4740" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated"><strong class="lb iu">航空公司</strong></li></ul><blockquote class="lv lw lx"><p id="34a4" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">两个工作表中的数据来自航班延误数据集—<a class="ae ky" href="https://www.kaggle.com/datasets/usdot/flight-delays" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/datasets/usdot/flight-delays</a>。<strong class="lb iu">许可</strong> : <a class="ae ky" href="https://creativecommons.org/publicdomain/zero/1.0/" rel="noopener ugc nofollow" target="_blank"> CC0:公共领域</a></p></blockquote><p id="b81e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是机场工作表的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/969d114a2e834a661458c134bdf0e214.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wSIlgDBe8qh3nHP2PNgheQ.png"/></div></figure><p id="367d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是<strong class="lb iu">航空公司</strong>的工作表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/f4c06aaed35106503e54507c03d15587.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DpSj4SiR-VIGHId4tg0h_Q.png"/></div></figure><blockquote class="lv lw lx"><p id="65be" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">请注意，airlines 工作表不包含标题。</p></blockquote><h1 id="8972" class="mv md it bd me mw mx my mh mz na nb mk jz nc ka mn kc nd kd mq kf ne kg mt nf bi translated">安装 xlrd 包</h1><p id="d13f" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">加载旧的<strong class="lb iu">。xls </strong>格式的 Excel 文件，需要安装<strong class="lb iu"> xlrd </strong>包:</p><blockquote class="lv lw lx"><p id="b2bf" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><strong class="lb iu"> xlrd </strong>是一个库，用于从历史记录中的 Excel 文件读取数据和格式化信息。xls 格式。</p></blockquote><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="41ec" class="of md it ob b be og oh l oi oj">pip install xlrd</span></pre><h1 id="e4d7" class="mv md it bd me mw mx my mh mz na nb mk jz nc ka mn kc nd kd mq kf ne kg mt nf bi translated">导入 Excel 电子表格</h1><p id="d837" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">让我们尝试使用 Pandas 中的<code class="fe ok ol om ob b">read_excel()</code>函数加载 Excel 电子表格中的数据:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="5558" class="of md it ob b be og oh l oi oj">import pandas as pd<br/><br/>df = pd.read_excel('mydata.xls')<br/>df</span></pre><p id="efd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是数据帧的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/f0af1608f7aa2de0d41fdd4418c2ccfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rads_-j79jpLqJaJStgHLw.png"/></div></div></figure><p id="98c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，虽然我们的 Excel 电子表格有两个工作表，但只加载了第一个工作表。</p><h1 id="1679" class="mv md it bd me mw mx my mh mz na nb mk jz nc ka mn kc nd kd mq kf ne kg mt nf bi translated">加载所有工作表</h1><p id="1ca2" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">要加载 Excel 电子表格中的所有工作表，请将<code class="fe ok ol om ob b">sheet_name</code>参数设置为<code class="fe ok ol om ob b">None</code>:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="d02e" class="of md it ob b be og oh l oi oj">df = pd.read_excel('mydata.xls', <br/>                   sheet_name=None)<br/>print(df)</span></pre><p id="3b79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果不再是熊猫的数据框架；相反，它是一个数据框架的字典:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="9aff" class="of md it ob b be og oh l oo oj">{'<strong class="ob iu">airports</strong>':     IATA_CODE                              AIRPORT  \<br/>0         ABE  Lehigh Valley International Airport   <br/>1         ABI             Abilene Regional Airport   <br/>2         ABQ    Albuquerque International Sunport   <br/>3         ABR            Aberdeen Regional Airport   <br/>4         ABY   Southwest Georgia Regional Airport   <br/>..        ...                                  ...   <br/>317       WRG                     Wrangell Airport   <br/>318       WYS               Westerly State Airport   <br/>319       XNA  Northwest Arkansas Regional Airport   <br/>320       YAK                      Yakutat Airport   <br/>321       YUM           Yuma International Airport   <br/><br/>                               CITY STATE COUNTRY  LATITUDE  LONGITUDE  <br/>0                         Allentown    PA     USA  40.65236  -75.44040  <br/>1                           Abilene    TX     USA  32.41132  -99.68190  <br/>2                       Albuquerque    NM     USA  35.04022 -106.60919  <br/>3                          Aberdeen    SD     USA  45.44906  -98.42183  <br/>4                            Albany    GA     USA  31.53552  -84.19447  <br/>..                              ...   ...     ...       ...        ...  <br/>317                        Wrangell    AK     USA  56.48433 -132.36982  <br/>318                West Yellowstone    MT     USA  44.68840 -111.11764  <br/>319  Fayetteville/Springdale/Rogers    AR     USA  36.28187  -94.30681  <br/>320                         Yakutat    AK     USA  59.50336 -139.66023  <br/>321                            Yuma    AZ     USA  32.65658 -114.60597  <br/><br/>[322 rows x 7 columns], '<strong class="ob iu">airlines</strong>':     UA         United Air Lines Inc.<br/>0   AA        American Airlines Inc.<br/>1   US               US Airways Inc.<br/>2   F9        Frontier Airlines Inc.<br/>3   B6               JetBlue Airways<br/>4   OO         Skywest Airlines Inc.<br/>5   AS          Alaska Airlines Inc.<br/>6   NK              Spirit Air Lines<br/>7   WN        Southwest Airlines Co.<br/>8   DL          Delta Air Lines Inc.<br/>9   EV   Atlantic Southeast Airlines<br/>10  HA        Hawaiian Airlines Inc.<br/>11  MQ  American Eagle Airlines Inc.<br/>12  VX                Virgin America}</span></pre><p id="943d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果中的关键字是工作表的名称。以下语句显示为<strong class="lb iu">机场</strong>工作表加载的数据帧:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="965a" class="of md it ob b be og oh l oi oj">display(df['airports'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/77930d05bd8efc5f9198543b718933f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5SUrYUMndSrneob2Krf9bw.png"/></div></div></figure><p id="6330" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，以下语句显示为<strong class="lb iu"> airlines </strong>工作表加载的数据帧:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="df10" class="of md it ob b be og oh l oi oj">display(df['airlines'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/05df05c443d86ff0bdd5c64da87e677d.png" data-original-src="https://miro.medium.com/v2/resize:fit:464/format:webp/1*GRAv-VtwS2fhtqIxyI8JkA.png"/></div></figure><blockquote class="lv lw lx"><p id="cfb6" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">不要担心标题；我会尽快修好它。</p></blockquote><h1 id="1fe9" class="mv md it bd me mw mx my mh mz na nb mk jz nc ka mn kc nd kd mq kf ne kg mt nf bi translated">加载特定工作表</h1><p id="1da6" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">如果您想要加载特定的工作表，将您想要加载的工作表的名称存储为一个列表，并将其传递给<code class="fe ok ol om ob b">sheet_name</code>属性:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="5d8b" class="of md it ob b be og oh l oi oj">df = pd.read_excel('mydata.xls', <br/>                   sheet_name=['airports','airlines'])<br/>print(df)</span></pre><p id="2e49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的语句加载了<strong class="lb iu">机场</strong>和<strong class="lb iu">航空公司</strong>工作表，结果是一个数据帧字典。</p><h1 id="1061" class="mv md it bd me mw mx my mh mz na nb mk jz nc ka mn kc nd kd mq kf ne kg mt nf bi translated">转换列的类型</h1><p id="25e9" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">您可以使用<code class="fe ok ol om ob b">dtypes</code>属性检查加载到<strong class="lb iu">机场</strong>数据框架中的每一列的数据类型:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="25e4" class="of md it ob b be og oh l oi oj">df['airports'].dtypes</span></pre><p id="e727" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">观察熊猫将根据工作表中每一列的值的类型来加载它们:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="893d" class="of md it ob b be og oh l oo oj">IATA_CODE     object<br/>AIRPORT       object<br/>CITY          object<br/><strong class="ob iu">STATE         object<br/>COUNTRY       object<br/></strong>LATITUDE     float64<br/>LONGITUDE    float64<br/>dtype: object</span></pre><p id="62d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">特别是对于<strong class="lb iu">机场</strong>数据帧，最好将<strong class="lb iu">州</strong>和<strong class="lb iu">国家</strong>列表示为<code class="fe ok ol om ob b">category</code>类型，而不是<code class="fe ok ol om ob b">object</code>类型。这是为了减少数据帧的内存占用。您可以使用<code class="fe ok ol om ob b">dtype</code>参数在加载期间执行类型转换:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="30e6" class="of md it ob b be og oh l oi oj">import numpy as np<br/><br/>df = pd.read_excel('mydata.xls', <br/>                   sheet_name='airports',<br/>                   dtype= {<br/>                       'STATE': 'category',<br/>                       'COUNTRY':'category'<br/>                   })<br/>df.dtypes</span></pre><p id="ec72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的语句中，我加载了<strong class="lb iu">机场</strong>工作表，并指示使用<code class="fe ok ol om ob b">category</code>数据类型加载<strong class="lb iu">州</strong>和<strong class="lb iu">国家</strong>列。您可以在加载数据帧后验证这一点:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="485f" class="of md it ob b be og oh l oo oj">IATA_CODE      object<br/>AIRPORT        object<br/>CITY           object<br/><strong class="ob iu">STATE        category<br/>COUNTRY      category<br/></strong>LATITUDE      float64<br/>LONGITUDE     float64<br/>dtype: object</span></pre><h1 id="52f2" class="mv md it bd me mw mx my mh mz na nb mk jz nc ka mn kc nd kd mq kf ne kg mt nf bi translated">转换列的值</h1><p id="2657" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">除了加载特定类型的列，您还可以在加载期间使用<code class="fe ok ol om ob b">converters</code>参数执行值转换。例如，假设我想将所有的纬度和经度值转换成<em class="ly">度、分和秒</em>格式。</p><p id="0702" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我首先定义了进行转换的函数:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="284f" class="of md it ob b be og oh l oi oj"># convert from decimal degrees to degrees, minutes, seconds<br/>def deg_to_dms(deg):<br/>    deg = float(deg)<br/>    m, s = divmod(abs(deg)*3600, 60)<br/>    d, m = divmod(m, 60)<br/>    return int(-d if deg &lt; 0 else d), int(m), s</span></pre><p id="da07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，使用<code class="fe ok ol om ob b">converters</code>参数指定您想要转换的列:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="c5da" class="of md it ob b be og oh l oi oj">df = pd.read_excel('mydata.xls', <br/>                   sheet_name='airports',<br/>                   dtype= {<br/>                       'STATE': 'category',<br/>                       'COUNTRY':'category'<br/>                   },<br/>                   converters={<br/>                       'LATITUDE': deg_to_dms,<br/>                       'LONGITUDE': deg_to_dms,<br/>                   })<br/>df</span></pre><p id="5c5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是转换的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/18cebe69d08e6642da14558bd07f3e63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sxf2A3fm-OK0AqkEEKpthg.png"/></div></div></figure><p id="bfcf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">检查列的数据类型:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="27d1" class="of md it ob b be og oh l oi oj">df.dtypes</span></pre><p id="0081" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您会看到<strong class="lb iu">纬度</strong>和<strong class="lb iu">经度</strong>列都是<code class="fe ok ol om ob b">object</code>类型:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="af22" class="of md it ob b be og oh l oo oj">IATA_CODE      object<br/>AIRPORT        object<br/>CITY           object<br/>STATE        category<br/>COUNTRY      category<br/><strong class="ob iu">LATITUDE       object<br/>LONGITUDE      object<br/></strong>dtype: object</span></pre><p id="bf03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您尝试提取第一行的纬度值:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="e774" class="of md it ob b be og oh l oi oj">lat_first_row = df.iloc[0,5]<br/>type(lat_first_row)</span></pre><p id="9706" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将看到该值的类型为<code class="fe ok ol om ob b">tuple</code>:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="9451" class="of md it ob b be og oh l oo oj">tuple</span></pre><h1 id="0d32" class="mv md it bd me mw mx my mh mz na nb mk jz nc ka mn kc nd kd mq kf ne kg mt nf bi translated">使用列标题加载</h1><p id="a607" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">前面我提到过<strong class="lb iu">航空公司</strong>工作表没有标题。所以如果你把它载入一个数据帧:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="7984" class="of md it ob b be og oh l oi oj">df = pd.read_excel('mydata.xls', <br/>                   sheet_name='airlines')<br/>df</span></pre><p id="6838" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果是第一行的内容将被用作标题:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/217ce2f971b9403254599c686969e194.png" data-original-src="https://miro.medium.com/v2/resize:fit:466/format:webp/1*7M3cHFrfO4cLZvgycu1cOA.png"/></div></figure><p id="61c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">显然这是不可接受的。要修复它，使用<code class="fe ok ol om ob b">header</code>参数并将其设置为<code class="fe ok ol om ob b">None</code>:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="7c31" class="of md it ob b be og oh l oi oj">df = pd.read_excel('mydata.xls', <br/>                   sheet_name='airlines', <br/>                   header=None)<br/>df</span></pre><p id="1ed3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在将使用默认的标题<strong class="lb iu"> 0 </strong>和<strong class="lb iu"> 1 </strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/a4c5b507468148bad4a310a7939b633c.png" data-original-src="https://miro.medium.com/v2/resize:fit:462/format:webp/1*zuqy0XdS8ewFi9klX394pQ.png"/></div></figure><p id="10e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用<code class="fe ok ol om ob b">names</code>参数更改标题:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="0194" class="of md it ob b be og oh l oi oj">df = pd.read_excel('mydata.xls', <br/>                   sheet_name='airlines', <br/>                   header=None,<br/>                   names=['IATA_CODE','AIRLINE'])<br/>df</span></pre><p id="ad53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在已经设置了列名:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/1c5535445c4b1d2731d6bfbd9ffe41c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:562/format:webp/1*Y4YFOviqXSgJn8Zud9EKBA.png"/></div></figure><h1 id="90b4" class="mv md it bd me mw mx my mh mz na nb mk jz nc ka mn kc nd kd mq kf ne kg mt nf bi translated">加载特定列</h1><p id="759e" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">如果您只想加载工作表中的特定列，您可以使用<code class="fe ok ol om ob b">usecols</code>参数:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="d266" class="of md it ob b be og oh l oi oj">df = pd.read_excel('mydata.xls', <br/>                   sheet_name='airports', <br/>                   usecols=['IATA_CODE','AIRPORT','CITY','STATE','COUNTRY'])<br/>df</span></pre><p id="8b8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的语句中，我只想加载'<strong class="lb iu"> IATA_CODE </strong>'、<strong class="lb iu">机场</strong>'、<strong class="lb iu">城市</strong>'、<strong class="lb iu">州</strong>'和'<strong class="lb iu">国家</strong>'列:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/fa10969d80c279d8af31e554896cf5b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*4gxDweHQGy-wZJZHIw8R1Q.png"/></div></figure><p id="710c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实际上，您省略了纬度列<strong class="lb iu">和经度列</strong>和经度列。在这种情况下，使用 lambda 函数指定<em class="ly">省略</em>可能会更容易:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="82e2" class="of md it ob b be og oh l oi oj">df = pd.read_excel('mydata.xls', <br/>                   sheet_name='airports', <br/>                   usecols=lambda column: column not in ['LATITUDE','LONGITUDE'])<br/>df</span></pre><p id="611b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一种方法是指定要加载到 Excel 电子表格中的列名。嘿，还记得我们正在使用 Excel 电子表格吗？以下语句显示了如何使用<em class="ly"> Excel-way </em>加载列<strong class="lb iu"> F </strong> ( <strong class="lb iu">纬度</strong>)到<strong class="lb iu"> G </strong> ( <strong class="lb iu">经度</strong>):</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="512d" class="of md it ob b be og oh l oi oj">df = pd.read_excel('mydata.xls', <br/>                   sheet_name='airports', <br/>                   usecols='F:G')<br/>df</span></pre><p id="31f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/c10d3c4f3eea08d8976493c185d97161.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*4ZtoTHfUsnwnn_oTzoE62w.png"/></div></figure><p id="190d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你还想要<strong class="lb iu"> IATA_CODE </strong>和<strong class="lb iu">机场</strong>栏目，可以轻松搞定，像这样！</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="0072" class="of md it ob b be og oh l oi oj">df = pd.read_excel('mydata.xls', <br/>                   sheet_name='airports', <br/>                   usecols='A,B,F:G')<br/>df</span></pre><p id="911a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果现在包含四列:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/df9d3b246b367cffe329a0d878071b9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*KjOiHYYKa2S4xjcUNP2lGA.png"/></div></figure><h1 id="ff72" class="mv md it bd me mw mx my mh mz na nb mk jz nc ka mn kc nd kd mq kf ne kg mt nf bi translated">示例 Excel 电子表格#2</h1><p id="d302" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">到目前为止，第一个 Excel spreahsheet 相当简单(我想说它对于现实世界来说太干净了)。我将使用的第二个数据集更加真实，它可以从<a class="ae ky" href="https://data.world/davelaff/restaurant-inventory-log" rel="noopener ugc nofollow" target="_blank">https://data.world/davelaff/restaurant-inventory-log</a>下载。</p><blockquote class="lv lw lx"><p id="71d3" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">这是一个餐厅库存工作簿。这些数据是真实的，但远远不是最新的。列出的价格不是实际价格。<strong class="lb iu">许可</strong>:公共领域</p></blockquote><p id="6987" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该 Excel 电子表格包含两个工作表:</p><ul class=""><li id="a4a3" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated"><strong class="lb iu">库存工作表</strong></li><li id="8207" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated"><strong class="lb iu">子类别库存值</strong></li></ul><p id="920e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是<strong class="lb iu">库存工作表</strong>的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/de891befd7f9c8400053b556cc1931e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PUF6qOrycIxHMuc9-GoGOg.png"/></div></div></figure><p id="4e6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里是<strong class="lb iu">子类别库存值</strong>工作表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/acc71d500dc9dd3b98d9ab114193201d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9-Knf2iWQ9j1aKedpk7_sg.png"/></div></div></figure><h1 id="dd49" class="mv md it bd me mw mx my mh mz na nb mk jz nc ka mn kc nd kd mq kf ne kg mt nf bi translated">安装 xlrd 包</h1><p id="60f0" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">加载更新的<strong class="lb iu">。xlsx </strong> Excel 文件格式，需要安装<strong class="lb iu"> openpyxl </strong>包:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="780f" class="of md it ob b be og oh l oi oj">pip install openpyxl</span></pre><blockquote class="lv lw lx"><p id="c827" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">openpyxl 是一个 Python 库，用于读取/写入 Excel 2010 xlsx/xlsm 文件。</p></blockquote><h1 id="a9df" class="mv md it bd me mw mx my mh mz na nb mk jz nc ka mn kc nd kd mq kf ne kg mt nf bi translated">加载数据集</h1><p id="50ec" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">让我们加载第一个工作表:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="545a" class="of md it ob b be og oh l oi oj">df = pd.read_excel('RESTAURANT INVENTORY LOG.xlsx', <br/>                   sheet_name='Inventory Worksheets')<br/><br/>df</span></pre><p id="d56d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是输出结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/836767b619e8edbd2d9e90c775e8224e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T-Sa2Fp1TecpcyDRcabiGQ.png"/></div></div></figure><p id="71ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意到<strong class="lb iu">未命名:0 </strong>列了吗？此外，请注意最下面几行包含<strong class="lb iu"> NaN </strong> s？</p><p id="c4b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您检查 Excel 电子表格，您会注意到实际数据从 B 列开始，并且在工作表的底部有一些空单元格:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/77d75e5a16903f840dcbafe2106791c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tCNoBt2hnifJhaQP4JitdQ.png"/></div></div></figure><p id="a142" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了让 Pandas 正确加载数据帧，您需要指定想要加载的列以及要加载的行数。这里，我将使用<code class="fe ok ol om ob b">usecols</code>和<code class="fe ok ol om ob b">nrows</code>参数来实现:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="f5a7" class="of md it ob b be og oh l oi oj">df = pd.read_excel('RESTAURANT INVENTORY LOG.xlsx', <br/>                   sheet_name='Inventory Worksheets',<br/>                   usecols="B:Q", <br/>                   nrows=797)<br/>df</span></pre><p id="da18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果现在看起来好多了:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/1cc94d3f5d6821d3c64feb44b0c52951.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fnqwFjld6TXGiLlZAB9DjQ.png"/></div></div></figure><p id="16e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于第二个工作表，假设我要加载的实际数据在工作表的中间(我用红色突出显示)。为了帮助您直观地看到要加载的行，如果您想要加载以红色突出显示的数据，我已经指出了需要跳过加载的行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/88cfc064f52f89084bc8410bd2e95a42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Og3ijaN4Pqd4s5Hwd31HVQ.png"/></div></div></figure><p id="09e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要加载<strong class="lb iu"> FOOD </strong>部分下的所有行，首先创建一个列表来存储要跳过的行:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="d297" class="of md it ob b be og oh l oi oj">rows_to_skip = list(range(0,5))<br/>rows_to_skip.append(6)</span></pre><p id="af6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面将生成一个值列表— <code class="fe ok ol om ob b">[0,1,2,3,4,6]</code>。然后，使用<code class="fe ok ol om ob b">skiprows</code>、<code class="fe ok ol om ob b">usecols</code>和<code class="fe ok ol om ob b">nrows</code>参数从工作表中的准确位置加载数据:</p><pre class="kj kk kl km gt oa ob oc bn od oe bi"><span id="a7ab" class="of md it ob b be og oh l oi oj">df = pd.read_excel('RESTAURANT INVENTORY LOG.xlsx', <br/>                   sheet_name='Subcategory Inventory Value',<br/>                   skiprows=rows_to_skip,<br/>                   usecols="B:AA", <br/>                   nrows=8)<br/>df</span></pre><p id="207b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图显示了包含<strong class="lb iu">食物</strong>部分下的行和列的数据帧:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/791a73e9c2c325df91991056905fa9c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ooUEaOa7XS31bhAvlspVQ.png"/></div></div></figure><h2 id="b605" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">如果你喜欢阅读我的文章，并且认为它对你的职业/学习有所帮助，请考虑注册成为一名灵媒会员。每月 5 美元，你可以无限制地访问 Medium 上的所有文章(包括我的)。如果你使用下面的链接注册，我会赚一小笔佣金(不需要你额外付费)。你的支持意味着我将能够投入更多的时间来写这样的文章。</h2><div class="pl pm gp gr pn po"><a href="https://weimenglee.medium.com/membership" rel="noopener follow" target="_blank"><div class="pp ab fo"><div class="pq ab pr cl cj ps"><h2 class="bd iu gy z fp pt fr fs pu fu fw is bi translated">加入媒介与我的介绍链接-李伟孟</h2><div class="pv l"><h3 class="bd b gy z fp pt fr fs pu fu fw dk translated">阅读李维孟(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="pw l"><p class="bd b dl z fp pt fr fs pu fu fw dk translated">weimenglee.medium.com</p></div></div><div class="px l"><div class="py l pz qa qb px qc ks po"/></div></div></a></div><h1 id="df56" class="mv md it bd me mw mx my mh mz na nb mk jz nc ka mn kc nd kd mq kf ne kg mt nf bi translated">摘要</h1><p id="e453" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">从 Excel 文件加载 Pandas 数据帧与从 CSV 文件加载非常相似。主要区别在于:</p><ul class=""><li id="cb56" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated">一个 Excel 文件可能包含多个工作表，您需要指明要加载哪个工作表。</li><li id="a2b5" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">从 Excel 加载提供了通过 Excel 列名指定列的灵活性。这使您可以轻松识别要从中加载数据的列。</li><li id="2b69" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">由于 Excel 工作表中的数据可能不会以严格的表格格式填充，因此通常需要指定要加载的行数，以及加载时要跳过的行数。</li></ul><p id="807d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一般来说，从 Excel 文件加载时，需要特别注意工作表中数据的格式。玩得开心！</p></div></div>    
</body>
</html>