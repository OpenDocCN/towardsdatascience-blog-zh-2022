<html>
<head>
<title>Running Jupyter Notebooks On Docker Containers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Docker容器上运行Jupyter笔记本</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/running-jupyter-notebooks-on-docker-containers-47862f6b96a0#2022-08-05">https://towardsdatascience.com/running-jupyter-notebooks-on-docker-containers-47862f6b96a0#2022-08-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0479" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">与SageMaker Studio Lab和Docker合作的项目</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8b7a06ba4561d325e125a5b36d944229.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*t4NdMuJGOuMXXM8q"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/es/@carrier_lost?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">伊恩·泰勒</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="cf04" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这篇文章的目标是在AWS上运行数据科学工作流，然后使用Docker发布它，从而创建一个端到端的机器学习任务。</p><p id="6add" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，我将更多地关注“如何”对数据科学项目进行分类，而不是“为什么这个项目很酷”。也就是说，使用Docker 有很多<a class="ae kv" href="https://www.microfocus.com/documentation/enterprise-developer/ed40pu5/ETS-help/GUID-F5BDACC7-6F0E-4EBB-9F62-E0046D8CCF1B.html" rel="noopener ugc nofollow" target="_blank">的好处:</a></p><ul class=""><li id="d504" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">轻便</li><li id="c355" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">表演</li><li id="f95b" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">灵活</li><li id="6490" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">隔离</li><li id="8a11" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">可量测性</li></ul><p id="1597" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一方面，AWS <a class="ae kv" href="https://studiolab.sagemaker.aws/" rel="noopener ugc nofollow" target="_blank"> SageMaker Studio Lab </a>提供了SageMaker的强大功能，无需显式定义每个子流程。</p><h1 id="33b1" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">挑选数据集</h1><p id="a250" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">对于这个项目，我们将使用来自斯坦福网络分析项目(<a class="ae kv" href="https://snap.stanford.edu/data/web-Amazon.html" rel="noopener ugc nofollow" target="_blank"> SNAP </a>)的2，441，053个产品的6，643，669个用户的34，686，770条亚马逊评论。这些数据是在BSD许可下发布的，学术和商业用途都是免费的。</p><p id="0fc2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用的数据是在Kaggle上找到的数据的子集。它包含1，800，000个训练样本，200，000个测试样本，因此每个评论要么是“正面的”，要么是“负面的”。</p><div class="nd ne gp gr nf ng"><a href="https://www.kaggle.com/datasets/kritanjalijain/amazon-reviews" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">亚马逊评论</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">6，643，669个用户对2，441，053件产品的34，686，770条亚马逊评论</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">www.kaggle.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu kp ng"/></div></div></a></div><p id="c65c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于这是一个大型数据集，并且我们正在使用AWS，因此数据存储在S3存储桶中。此外，确保您正在使用的bucket和AWS服务在同一个<a class="ae kv" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html" rel="noopener ugc nofollow" target="_blank">区域</a>中。对于这个项目，选择的地区是<strong class="ky ir">美国东部-2 </strong>(美国东俄亥俄州)。</p><h1 id="685a" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">IAM:了解你的角色</h1><p id="4f8e" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">使用AWS，一个常见的缺陷是没有所需的权限，或者不知道您的权限范围。转到<a class="ae kv" href="https://aws.amazon.com/iam/" rel="noopener ugc nofollow" target="_blank">身份和访问管理</a> (IAM)，创建一个角色，并为其附加以下策略:</p><ul class=""><li id="a662" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">亚马逊3FullAcess</li><li id="fc66" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">AmazonSageMakerFullAccess</li><li id="272c" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">awsglueconsolesagemakernotebook full access</li><li id="8428" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">AWSImageBuilderFullAccess</li><li id="8a78" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">AmazonSageMakerPipelinesIntegrations</li><li id="1e46" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">amazonseagemakergroundtrutheexecution</li></ul><h1 id="bfe9" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">为什么选择SageMaker Studio Lab？</h1><p id="126d" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">SageMaker Studio Lab提供了一个轻量级环境，可以比在SageMaker上更快地执行任务。<a class="ae kv" href="https://docs.aws.amazon.com/sagemaker/latest/dg/studio-lab.html" rel="noopener ugc nofollow" target="_blank">它也有一些缺点</a>，例如无法访问AWS Data Wrangler，也没有大规模的分布式培训。</p><p id="f51a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要开始使用SageMaker Studio Lab，您只需要一个AWS帐户，然后等待大约24小时，让您的帐户获得批准。一旦进入实验室，环境看起来就像一个Jupyter笔记本。</p><p id="2f34" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这里申请一个免费账户:【https://studiolab.sagemaker.aws/ T2】</p><h1 id="f4f8" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">开始会话</h1><p id="e2a5" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">下面的代码简介是连接到您的AWS资源的标准方式，并定义了基本资源。可以把它看作是开始使用AWS的一种<a class="ae kv" href="https://www.in-ulm.de/~mascheck/various/shebang/" rel="noopener ugc nofollow" target="_blank">方式。</a></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><h1 id="2ce0" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">预处理步骤</h1><p id="7bf8" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">在SageMaker Studio中，第一步是编写一个预处理脚本，如下所示。这个脚本和所有后续脚本需要包含所有必需的库，并且能够独立运行。</p><p id="28b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，在ML工作流中采用的思维模式是“t <em class="nx"> his将在其他人的机器上运行</em>”。因此，在Jupyter笔记本环境中编写的内容能够包含在一个简洁的python脚本中是至关重要的。</p><p id="2239" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于SageMaker的入门者，记得坚持规定的目录格式:“<strong class="ky ir"> <em class="nx"> /opt/ml/… </em> </strong>”。事实上，“/opt/ml”及其所有子目录都由SageMaker <a class="ae kv" href="https://docs.aws.amazon.com/sagemaker/latest/dg/build-your-own-processing-container.html" rel="noopener ugc nofollow" target="_blank">根据文档</a>保留。例如，“<a class="ae kv" href="https://sagemaker-examples.readthedocs.io/en/latest/advanced_functionality/scikit_bring_your_own/scikit_bring_your_own.html#:~:text=%2Fopt%2Fml%2Fmodel%2F,a%20compressed%20tar%20archive%20file." rel="noopener ugc nofollow" target="_blank"> /opt/ml/model/ </a>”是您编写算法生成的模型的目录。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><h1 id="e45e" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">培训脚本</h1><p id="30d9" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">在预处理之后是训练，就像前一部分一样包含在脚本中。特定的模型没有建立正确的工作流重要。一旦模型按预期运行，请随意插入您选择的算法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><h1 id="24aa" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">模型评估</h1><p id="5877" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">数据完全平衡:50%正，50%负。因此，精确度是一个足够的度量。精确度和召回率也包括在内，以发现预测中的任何问题。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="f90c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在任何参数优化之前，准确率徘徊在80%,精度/召回率也是如此。</p><h1 id="0638" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">使用FrameworkProcessor处理作业</h1><p id="2460" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">SageMaker处理模块允许我们使用一个<a class="ae kv" href="https://sagemaker.readthedocs.io/en/stable/api/training/processing.html#sagemaker.processing.FrameworkProcessor" rel="noopener ugc nofollow" target="_blank">框架</a>处理器来添加依赖项，该处理器允许一组Python脚本作为处理作业的一部分运行。此外，它允许处理器访问一个目录中的多个脚本，而不是只指定一个脚本。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><h1 id="f24a" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">运送到码头</h1><p id="fdfe" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">现在我们的工作流程运行顺利，是时候发货了！首先在实验室中创建一个名为docker的目录，并编写docker文件来创建处理容器:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="196d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一步是使用docker命令构建容器，这会创建一个弹性注册容器(ECR)并推送docker映像:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="b80e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">附言</strong>如果你使用的是苹果M1电脑或更新的电脑，确保在构建docker镜像时明确地调用你的平台。</p><h1 id="8517" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">运行Docker容器</h1><p id="397a" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">首先我们调用ScriptProcessor类，它允许您在容器中运行命令，现在我们可以运行以前的相同脚本，只是它们在docker容器中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="24a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就这样，我们成功地在docker容器上运行了一个处理作业。为了简洁起见，没有显示训练和评估容器，因为它们遵循相似的步骤。</p><h1 id="daa0" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">结论</h1><p id="d1a3" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">借助AWS服务和Docker，我们能够将python代码推入容器，并将数据科学工作流产品化。</p><p id="9faf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您有兴趣查看完整的代码和输出来验证您自己的工作，请查看下面的Github repo:</p><div class="nd ne gp gr nf ng"><a href="https://github.com/NadimKawwa/amazon-review-docker/blob/main/README.md" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">亚马逊-评论-docker/README.md</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">本笔记本详细介绍了如何使用AWS服务和Docker对数据科学项目进行分类。开始前，请…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">github.com</p></div></div><div class="np l"><div class="ny l nr ns nt np nu kp ng"/></div></div></a></div></div></div>    
</body>
</html>