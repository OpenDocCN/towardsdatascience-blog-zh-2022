<html>
<head>
<title>5 SQL CASE Examples That Will Make You Use CASE-WHEN Easily</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">5个SQL案例示例，让您轻松使用案例</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/5-advanced-sql-case-examples-that-will-make-you-use-case-when-easily-1040c1eb8857#2022-09-08">https://towardsdatascience.com/5-advanced-sql-case-examples-that-will-make-you-use-case-when-easily-1040c1eb8857#2022-09-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="adf2" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">数据科学</h2><div class=""/><div class=""><h2 id="2d8e" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">掌握SQL CASE-WHEN语句的实例</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/836a05b1290a2e92a1a370c90eb09280.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IMfNtRt-PuCkhEQ5"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@shmdsgn?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">斯蒂芬·莫尔特尔</a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="58ab" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">SQL案例的实际使用案例！</strong></p><p id="3748" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我之前的文章<a class="ae lh" rel="noopener" target="_blank" href="/5-advanced-sql-concepts-you-should-know-in-2022-b50efe6c99"> <strong class="lk jd"> 5个高级SQL概念</strong> </a>中，您对SQL中的<code class="fe me mf mg mh b"><strong class="lk jd">CASE..WHEN</strong></code>表达式有了一个大致的了解。这个表达式是SQL处理<em class="mi"> If-else </em>逻辑的方式。</p><p id="376d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">数据分析从来都不简单。通常，您需要根据几个条件转换提取的数据，以使其适合进一步的分析。这就是<code class="fe me mf mg mh b"><strong class="lk jd">CASE..WHEN..THEN</strong></code>表达式的应用。</p><p id="ef1b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我列举了5个<code class="fe me mf mg mh b">CASE..WHEN..THEN</code>表达的实际用例，并附有例子和解释。理解这些例子肯定会让你成为SQL中CASE的专业用户。</p><p id="7aeb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里是所有用例的快速参考—</p><pre class="ks kt ku kv gt mj mh mk ml aw mm bi"><span id="dafd" class="mn mo it mh b gy mp mq l mr ms"><strong class="mh jd">· </strong><a class="ae lh" href="#2577" rel="noopener ugc nofollow"><strong class="mh jd">Two ways to write CASE statement in SQL</strong></a></span><span id="c445" class="mn mo it mh b gy mt mq l mr ms"><strong class="mh jd">· </strong><a class="ae lh" href="#3c60" rel="noopener ugc nofollow"><strong class="mh jd">Simple CASE WHEN in SELECT statement</strong></a><strong class="mh jd"><br/>· </strong><a class="ae lh" href="#811d" rel="noopener ugc nofollow"><strong class="mh jd">Categorize the data using CASE WHEN</strong></a><strong class="mh jd"><br/>· </strong><a class="ae lh" href="#8f95" rel="noopener ugc nofollow"><strong class="mh jd">Data Standardization using SQL CASE</strong></a><strong class="mh jd"><br/>· </strong><a class="ae lh" href="#8eed" rel="noopener ugc nofollow"><strong class="mh jd">CASE WHEN with Aggregate Functions</strong></a><strong class="mh jd"><br/>· </strong><a class="ae lh" href="#5d22" rel="noopener ugc nofollow"><strong class="mh jd">CASE Statement in ORDER BY Clause</strong></a></span></pre><blockquote class="mu mv mw"><p id="438e" class="li lj mi lk b ll lm kd ln lo lp kg lq mx ls lt lu my lw lx ly mz ma mb mc md im bi translated">📍注意:我使用MySQL WorkBench &amp; self created <a class="ae lh" href="https://github.com/17rsuraj/data-curious/blob/master/TowardsDataScience/Dummy_Sales_Data_v1.csv" rel="noopener ugc nofollow" target="_blank">销售数据</a>使用<a class="ae lh" rel="noopener" target="_blank" href="/faker-an-amazing-and-insanely-useful-python-library-b313a60bdabf"> <strong class="lk jd"> Faker </strong> </a>创建。可以在我的<a class="ae lh" href="https://github.com/17rsuraj/data-curious/blob/master/TowardsDataScience/Dummy_Sales_Data_v1.csv" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd"> Github </strong> </a> repo上<a class="ae lh" href="https://github.com/17rsuraj/data-curious/blob/master/LICENSE.md" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd"> MIT License </strong> </a>下免费获得！</p></blockquote><p id="58a6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是一个简单的9999 x 11数据集，如下所示。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi na"><img src="../Images/c48c457c85396aad78f353c9df1e3c46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OdaBLPVRNJUdKlkb.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">虚拟销售数据集|作者图片</p></figure><p id="7cbd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">好了，我们开始吧…</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><p id="e699" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">从技术上讲，SQL中的CASE表达式计算WHEN子句中提到的条件。如果条件为真，则执行THEN子句中提到的代码，如果条件为假，则执行ELSE部分中提到的代码。</p><p id="8f72" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在开始举例之前，让我们快速刷新一下表达式<code class="fe me mf mg mh b"><strong class="lk jd">CASE..WHEN..THEN</strong></code>和它的写法。♻️</p><h1 id="2577" class="ni mo it bd nj nk nl nm nn no np nq nr ki ns kj nt kl nu km nv ko nw kp nx ny bi translated">用SQL编写CASE语句的两种方法</h1><p id="51ae" class="pw-post-body-paragraph li lj it lk b ll nz kd ln lo oa kg lq lr ob lt lu lv oc lx ly lz od mb mc md im bi translated">该语句最常用的形式是在一个<code class="fe me mf mg mh b">CASE</code>表达式下编写多个<code class="fe me mf mg mh b">WHEN..THEN</code>子句。</p><p id="d722" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，让我们通过在<em class="mi">销售经理</em>列中添加如下条件来创建一个新列— <em class="mi">销售经理姓名首字母</em>。</p><pre class="ks kt ku kv gt mj mh mk ml aw mm bi"><span id="586a" class="mn mo it mh b gy mp mq l mr ms">SELECT Sales_Manager,<br/>       Product_Category,<br/>       <strong class="mh jd">CASE  <br/>           WHEN Sales_Manager = 'Pablo' THEN 'P'<br/>           WHEN Sales_Manager = 'Kristen' THEN 'K'<br/>           ELSE Sales_Manager<br/>       END AS Sales_Manager_Initials </strong>   <br/>FROM sql_practice.dummy_sales_data_v1;</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/34867066f1c42be0bfd028fed3237f30.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/format:webp/1*HB1aQ8HEEjrNxGuLZ0JNUA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">SQL | Image中的简单CASE语句(按作者)</p></figure><blockquote class="mu mv mw"><p id="735b" class="li lj mi lk b ll lm kd ln lo lp kg lq mx ls lt lu my lw lx ly mz ma mb mc md im bi translated">📍注意:上面代码中的ELSE子句是可选的。如果不提及，那么所有WHEN子句中条件都为假的地方都会用<code class="fe me mf mg mh b">NULL</code>填充。</p></blockquote><p id="59e6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">另一种方式，当被测试的条件只在一列上时，就像上面的例子一样，SQL为您提供了一种简化的方式来编写如下的<code class="fe me mf mg mh b">CASE..WHEN</code>表达式。</p><pre class="ks kt ku kv gt mj mh mk ml aw mm bi"><span id="117c" class="mn mo it mh b gy mp mq l mr ms">SELECT Sales_Manager,<br/>       Product_Category,<br/>       <strong class="mh jd">CASE Sales_Manager</strong><br/>            WHEN 'Pablo' THEN 'P'<br/>            WHEN 'Kristen' THEN 'K'<br/>            ELSE Sales_Manager<br/>       END AS Sales_Manager_Initials    <br/>FROM sql_practice.dummy_sales_data_v1;</span></pre><p id="e5da" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，您可以得到完全相同的输出，而不用在每个<code class="fe me mf mg mh b">WHEN</code>子句中提到列名。只需编写关键字<code class="fe me mf mg mh b"><strong class="lk jd">CASE</strong></code>，后跟您想要应用条件的列名。</p><p id="dd48" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我没有发现这两种方法之间有任何执行时间或效率相关的差异。因此，采用哪种方法是个人的决定。</p><p id="7b2d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，既然你已经对如何写CASE-WHEN表达式有了深入的了解，让我们进入实际的用例。</p><h1 id="3c60" class="ni mo it bd nj nk nl nm nn no np nq nr ki ns kj nt kl nu km nv ko nw kp nx ny bi translated">SELECT语句中的简单情况</h1><p id="5994" class="pw-post-body-paragraph li lj it lk b ll nz kd ln lo oa kg lq lr ob lt lu lv oc lx ly lz od mb mc md im bi translated">基于现有列创建新列是最常见的数据转换之一。大多数情况下，您需要在现有列上隐含条件。</p><p id="5e65" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">正如您在上面的示例中注意到的，您可以有条件地测试单个列中的值，并基于此创建一个新列。但是，WHEN子句也为您提供了在多列上添加条件的灵活性。✅</p><p id="669e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，假设对于<em class="mi">销售经理</em>为<em class="mi"> Pablo </em>且<em class="mi">产品类别</em>为<em class="mi">办公室</em>的所有订单，您希望在<em class="mi">数量</em>中添加<em class="mi"> 50 </em>。同时，对于<em class="mi">销售经理</em>和<em class="mi">产品类别的所有其他组合，</em>您希望保持<em class="mi">数量</em>列不变。</p><p id="de0f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">理想情况下，您需要两列上的条件，分别为— <code class="fe me mf mg mh b"> Sales_Manager = ‘Pablo’</code>、<code class="fe me mf mg mh b">Product_Category = ‘Office’</code>。此外，这两个条件必须为真，才能获得新的数量值。因此，您需要使用逻辑AND连接这些条件。</p><pre class="ks kt ku kv gt mj mh mk ml aw mm bi"><span id="391c" class="mn mo it mh b gy mp mq l mr ms">SELECT Sales_Manager,<br/>       Product_Category,<br/>       Quantity,<br/>       CASE <br/>           <strong class="mh jd">WHEN Sales_Manager = 'Pablo'<br/>                AND Product_Category = 'Office'<br/>           THEN Quantity+50</strong><br/>           <strong class="mh jd">ELSE Quantity</strong><br/>       END AS New_Quantity    <br/>FROM sql_practice.dummy_sales_data_v1;</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi of"><img src="../Images/efc3f8f0b4c9b35bc71132b19f1af5f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*DTtLJJufE3jvcGpPO5xVUw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">多列条件|按作者排序的图像</p></figure><p id="6999" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">正如您所看到的，WHEN子句中的两个条件是用关键字AND连接的。只有当两个条件都为真时，才会执行THEN子句中的代码，即<em class="mi"> Quantity+50 </em>，如上图所示。</p><p id="f8e7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里，<code class="fe me mf mg mh b">ELSE Quantity</code>保持<em class="mi">销售经理</em>和<em class="mi">产品类别</em>的所有其他组合的数量列不变。</p><p id="210e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，您通常需要将数据分成不同的类别，以便进一步分析。您可以在数据提取阶段使用SQL中的CASE表达式来实现这一点。</p><p id="94d0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">由于您将使用<em class="mi"> if-else </em>逻辑来将记录分成不同的类别，<code class="fe me mf mg mh b">CASE..WHEN</code> expression是这个应用程序中的完美工具。</p><h1 id="811d" class="ni mo it bd nj nk nl nm nn no np nq nr ki ns kj nt kl nu km nv ko nw kp nx ny bi translated">在下列情况下，使用用例对数据进行分类</h1><p id="87d4" class="pw-post-body-paragraph li lj it lk b ll nz kd ln lo oa kg lq lr ob lt lu lv oc lx ly lz od mb mc md im bi translated">可以根据其他数字和非数字列将数据分成多个类别。</p><p id="bd17" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">与将行分组到不同组的GROUP BY子句相反，CASE-WHEN只是创建一个新列，并提到数据集的每一行所属的组名。✅</p><p id="f27f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，销售数据中有每个订单的数量。假设您想根据列<em class="mi">数量</em>将订单量<em class="mi">分类为“高”、“低”或“中”。您可以使用如下CASE-WHEN语句—</em></p><pre class="ks kt ku kv gt mj mh mk ml aw mm bi"><span id="a0e6" class="mn mo it mh b gy mp mq l mr ms">SELECT OrderID, <br/>       Quantity,<br/>       <strong class="mh jd">CASE <br/>           WHEN Quantity &gt; 65 THEN 'High'<br/>           WHEN Quantity &lt; 15 THEN 'Low'<br/>           ELSE 'Medium'<br/>       END AS Order_Volume </strong>   <br/>FROM sql_practice.dummy_sales_data_v1;</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi og"><img src="../Images/b3518b0e268152b2438b58af8695dcb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/format:webp/1*I7FT7vCRMzRM1AcCid4MRQ.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">使用Case语句分类|按作者分类的图像</p></figure><p id="0198" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">简单！</p><p id="85a9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您所需要做的就是提及条件，基于这些条件，您希望将数据集行分成不同的组。</p><p id="e80f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您还可以像在前面的示例中一样，在<code class="fe me mf mg mh b">WHEN</code>子句中包含多个条件。当不同表中的列有多个条件时，这种分类也是有效的。</p><p id="0346" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，假设您有两个表<em class="mi">订单</em>和<em class="mi">发货</em>，如下所示。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oh"><img src="../Images/9f60e5a4829cf21ce8ba9449c8560f7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y2RWcgUNRp2SKMhH6HNnsg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">两个示例表格|作者图片</p></figure><p id="b239" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因为我没有准备好这些表格，所以我用CTE创建了如下的表格</p><pre class="ks kt ku kv gt mj mh mk ml aw mm bi"><span id="34d6" class="mn mo it mh b gy mp mq l mr ms">WITH Orders AS<br/>(<br/>SELECT OrderID,<br/>       Sales_Manager,<br/>       Quantity<br/>FROM sql_practice.dummy_sales_data_v1<br/>LIMIT 20<br/>),</span><span id="c8bb" class="mn mo it mh b gy mt mq l mr ms">Shipments AS<br/>(<br/>SELECT OrderID,<br/>       Product_Category,<br/>       Shipping_Address,<br/>       Shipping_Cost<br/>FROM sql_practice.dummy_sales_data_v1<br/>LIMIT 20<br/>)</span></pre><p id="e8d5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可以在此了解更多关于使用<a class="ae lh" rel="noopener" target="_blank" href="/5-advanced-sql-concepts-you-should-know-in-2022-b50efe6c99"><strong class="lk jd"/></a><strong class="lk jd"/>的信息。</p><p id="f4e4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，假设您想根据列<em class="mi">数量</em>和<em class="mi">运输成本</em>中的值将<em class="mi">订单</em>表中的记录分类为“<em class="mi">高优先级</em>”、“<em class="mi">中优先级</em>”和“<em class="mi">低优先级</em>”。</p><p id="224c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这可能看起来很复杂，但是用下面的<code class="fe me mf mg mh b">CASE..WHEN</code>表达式就很简单了。</p><pre class="ks kt ku kv gt mj mh mk ml aw mm bi"><span id="26ca" class="mn mo it mh b gy mp mq l mr ms">SELECT O.OrderID,<br/>       O.Quantity,<br/>       S.Shipping_Cost,<br/>       <strong class="mh jd">CASE<br/>            WHEN O.Quantity &gt; 50<br/>            OR S.Shipping_Cost &gt; 30<br/>            THEN 'High Priority'<br/>            <br/>            WHEN O.Quantity &lt; 15<br/>            OR S.Shipping_Cost &lt; 10<br/>            THEN 'Low Priority'<br/>            <br/>            ELSE 'Medium Priority'<br/>       END AS Order_Type</strong><br/>FROM Orders O<br/>LEFT JOIN Shipments S<br/>ON O.OrderID = S.OrderID</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/0d829edbd0e84336ed54179c1d2f5f7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*3sFJpbvFM1ObGni0GPvFig.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">使用SQL | Image中的CASE按作者进行数据分类</p></figure><p id="63a4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您需要使用<code class="fe me mf mg mh b">JOIN</code>子句和列别名。剩下的部分也是同样简单的<code class="fe me mf mg mh b">CASE..WHEN</code>表情。在上图中可以看到，创建了一个新列<em class="mi"> Order_Type </em>，其中包含每个<em class="mi"> OrderID </em>的优先级值。</p><p id="b3b1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，有时您的数据集包含相同含义的不同值，这使得数据不一致且不一致。</p><p id="4ab9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最简单的例子就是——某些数据集中的性别列可以包含'<em class="mi"> W </em>'、<em class="mi"> F </em>'、<em class="mi">女</em>'、<em class="mi">女</em>'等值，都表示性别为'<em class="mi">女</em>'。那为什么我们要用不同的术语来表示同一个意思呢？</p><p id="c4c4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最好将数据集标准化，使其更加一致。</p><p id="9e92" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下一个用例将详细演示这一点。</p><h1 id="8f95" class="ni mo it bd nj nk nl nm nn no np nq nr ki ns kj nt kl nu km nv ko nw kp nx ny bi translated">使用SQL CASE的数据标准化</h1><p id="5c3c" class="pw-post-body-paragraph li lj it lk b ll nz kd ln lo oa kg lq lr ob lt lu lv oc lx ly lz od mb mc md im bi translated">数据标准化用于使数据更加一致，即确保每一列都有相同类型的内容和表示单一含义的单一术语或值。</p><p id="b4c5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">CASE-WHEN语句对于将不一致或不一致的数据转换成更加结构化和一致的数据非常有用。使用这个SQL功能，您总是可以创建一个具有标准化值的新列，并将其用于进一步的分析。</p><p id="c75e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们看一个例子。</p><p id="9891" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">假设，在该数据集中，您希望获得订单状态为<em class="mi">已完成</em>或<em class="mi">未完成</em>，即将状态标准化为这两个值。但是，您可以看到“状态”列包含诸如“已交付”、“未交付”、“未发货”和“已发货”等值。</p><p id="9a7a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">CASE WHEN语句可以用在如下的场景中</p><pre class="ks kt ku kv gt mj mh mk ml aw mm bi"><span id="2989" class="mn mo it mh b gy mp mq l mr ms">SELECT OrderID,<br/>       Status,<br/>       <strong class="mh jd">CASE<br/>           WHEN Status = 'Delivered' THEN 'Completed'<br/>           ELSE 'Not Completed'<br/>       END as Order_Status </strong> <br/>FROM sql_practice.dummy_sales_data_v1;</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/11873c9762635a39e7ee54eca3a157a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*axS7E-P62VYnTeymKrAoOg.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">SQL | Image中的数据标准化用例</p></figure><p id="95ac" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如上图所示，<em class="mi"> Order_Status </em>只包含两个值。如果<em class="mi">状态</em>为<em class="mi">交付</em>，则只有<em class="mi">订单_状态</em>为<em class="mi">完成</em>，其他情况下为<em class="mi">未完成</em>。</p><p id="78df" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">嗯，我同意，这是一个很弱的例子，但是一旦你理解了用例，你就可以在复杂的场景中使用它。</p><p id="556e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此外，没有数据聚合，数据分析是不完整的。在我的上一篇文章中，<a class="ae lh" rel="noopener" target="_blank" href="/5-pandas-group-by-tricks-you-should-know-in-python-f53246c92c94"><strong class="lk jd">Python中你应该知道的5个熊猫分组技巧</strong> </a> <strong class="lk jd"> </strong>你读到了如何在SQL中使用带有Group By的聚合函数。</p><blockquote class="mu mv mw"><p id="4e6f" class="li lj mi lk b ll lm kd ln lo lp kg lq mx ls lt lu my lw lx ly mz ma mb mc md im bi translated">在数据的条件选择上使用聚合函数怎么样？？</p></blockquote><p id="6b69" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">是的，这在SQL中是可能的&amp;总有一个“<strong class="lk jd">简单的方式</strong>”用例。</p><h1 id="8eed" class="ni mo it bd nj nk nl nm nn no np nq nr ki ns kj nt kl nu km nv ko nw kp nx ny bi translated">使用聚合函数时的情况</h1><p id="115d" class="pw-post-body-paragraph li lj it lk b ll nz kd ln lo oa kg lq lr ob lt lu lv oc lx ly lz od mb mc md im bi translated">这是CASE语句的复杂用例之一，使用聚合函数有时会很棘手。</p><p id="e154" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">所以，我们试着用一个例子来理解一下。</p><p id="07f2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">假设，您想要获得每个<em class="mi">销售经理</em>处理的订单总数，其中显示了状态<em class="mi">已交付</em>和<em class="mi">未交付</em>。</p><p id="c941" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">理想情况下，您需要计算属于<em class="mi">销售经理</em>和<em class="mi">状态</em>组合的订单。但是对于CASE语句，您不需要键入每个组合。您可以简单地使用如下的聚合函数<code class="fe me mf mg mh b">COUNT</code>。</p><pre class="ks kt ku kv gt mj mh mk ml aw mm bi"><span id="2e39" class="mn mo it mh b gy mp mq l mr ms">SELECT Sales_Manager,<br/>       <strong class="mh jd">COUNT(CASE WHEN Status = 'Delivered' THEN OrderID ELSE NULL END) AS Delivered_Orders,<br/>       COUNT(CASE WHEN Status = 'Not Delivered' THEN OrderID ELSE NULL END) AS NonDelivered_Orders</strong>        <br/>FROM sql_practice.dummy_sales_data_v1<br/>GROUP BY Sales_Manager;</span></pre><p id="21dc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如上所述，您应该在聚合函数中提到<code class="fe me mf mg mh b">CASE..WHEN..THEN</code>。这里，在<em class="mi"> Delivered_Orders一栏中，</em>你正在统计所有订单<code class="fe me mf mg mh b">WHEN</code> <em class="mi">状态</em>为<em class="mi"> Delivered </em>得到如下最终输出。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/33673a0d3a6b3fb3d25a0f3eb007c92d.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*w0SUmrNQwcy1MwmPdjwNyQ.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">SQL | Image中包含聚合函数的事例(按作者)</p></figure><p id="b7ba" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">很简单！</p><p id="451d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用另一个聚合函数<code class="fe me mf mg mh b">SUM()</code>也可以得到相同的结果。只有您需要稍微更改CASE-WHEN语句，如下所示。</p><pre class="ks kt ku kv gt mj mh mk ml aw mm bi"><span id="4a7d" class="mn mo it mh b gy mp mq l mr ms">SELECT Sales_Manager,<br/>       <strong class="mh jd">SUM(CASE WHEN Status = 'Delivered' THEN 1 ELSE 0 END) AS Delivered_Orders,<br/>       SUM(CASE WHEN Status = 'Not Delivered' THEN 1 ELSE 0 END) AS NonDelivered_Orders </strong>       <br/>FROM sql_practice.dummy_sales_data_v1<br/>GROUP BY Sales_Manager;</span></pre><p id="e13d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在上面的CASE语句中，您实际上是基于状态创建了一个中间列(<code class="fe me mf mg mh b">1</code> &amp; <code class="fe me mf mg mh b">0</code>的<em class="mi">不可见</em>)，并最终对该列的值进行加法运算以获得所需的输出。</p><p id="af55" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">同样，您也可以使用其他聚合函数。</p><p id="c075" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">到目前为止，您已经看到了SELECT语句中的CASE用法。但是，它也可以用在ORDER BY子句中。</p><h1 id="5d22" class="ni mo it bd nj nk nl nm nn no np nq nr ki ns kj nt kl nu km nv ko nw kp nx ny bi translated">ORDER BY子句中的CASE语句</h1><p id="8110" class="pw-post-body-paragraph li lj it lk b ll nz kd ln lo oa kg lq lr ob lt lu lv oc lx ly lz od mb mc md im bi translated">在SQL中，<strong class="lk jd"> ORDER BY </strong>子句用于按升序或降序排列输出数据集。在<code class="fe me mf mg mh b">ORDER BY</code>中使用<code class="fe me mf mg mh b">CASE</code>为您提供了更多的灵活性，允许您对数据进行排序，而不仅仅是标准方式。</p><p id="2740" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，假设您想将所有<em class="mi">‘已交付’</em>订单按<em class="mi">单价</em>升序排列(如果它们被运送到<em class="mi">英国</em>和<em class="mi">交付时间</em>升序排列(如果它们被运送到任何其他国家)。</p><p id="cd02" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用标准的ORDER BY子句，这似乎是一项不可能完成的任务。</p><p id="1ef0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">但是使用CASE with ORDER BY，你的生活就轻松多了。💯</p><p id="d2fd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们使用下面的查询来理解它。</p><pre class="ks kt ku kv gt mj mh mk ml aw mm bi"><span id="4f3e" class="mn mo it mh b gy mp mq l mr ms">SELECT OrderID,<br/>       Shipping_Address,<br/>       UnitPrice,<br/>       Delivery_Time<br/>FROM sql_practice.dummy_sales_data_v1<br/>WHERE Status LIKE 'Delivered'<br/>      AND Shipping_Address IN ('UK', 'India')<br/>      AND Delivery_Time &lt;19<br/>      AND UnitPrice BETWEEN 140 AND 150<br/>ORDER BY <strong class="mh jd">CASE<br/>             WHEN Shipping_Address = 'UK' THEN UnitPrice<br/>             ELSE Delivery_Time<br/>         END;</strong></span></pre><blockquote class="mu mv mw"><p id="b9d1" class="li lj mi lk b ll lm kd ln lo lp kg lq mx ls lt lu my lw lx ly mz ma mb mc md im bi translated">📍注意:WHERE子句中提到的条件绝对不是获得结果所必需的。我使用它们只是为了让结果更明显。</p></blockquote><p id="26af" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">正如上面的查询中提到的，您可以使用<code class="fe me mf mg mh b">CASE..WHEN</code>表达式在<code class="fe me mf mg mh b">ORDER BY</code>子句中指定对数据集进行排序的条件，以获得如下输出。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi gj"><img src="../Images/bddfa564c6801a8cf0000b31e156d456.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pKcti7omIxfvDJtycuepmw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">使用SQL中的案例按自定义标准排序|按作者排序图像</p></figure><p id="b73f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">所以当<em class="mi"> Shipping_Address </em>为<em class="mi"> UK </em>时，所有订单将按升序或<em class="mi">单价</em>排列。对于<em class="mi"> Shipping_Address </em>中的任何其他值，所有订单都按<em class="mi"> Delivery_Time </em>的升序排列，如上所示。</p><p id="5b61" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">类似地，要获得降序排列的所有记录，只需在上述查询中的END关键字后使用关键字— <strong class="lk jd"> DESC </strong>。</p><p id="153d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">就是这样！🏆</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><p id="f4d5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我希望您对SQL <code class="fe me mf mg mh b">CASE..WHEN..THEN</code>语句及其提供的灵活性有了宝贵的见解。</p><p id="6f14" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在现实世界中，数据转换有时很复杂。掌握SQL中的CASE语句一定会帮助你高效地实现目标。</p><p id="6c22" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你喜欢阅读这些精彩的故事，并且想支持我成为作家，</p><blockquote class="ol"><p id="9c08" class="om on it bd oo op oq or os ot ou md dk translated">💡<a class="ae lh" href="https://medium.com/@17.rsuraj/membership" rel="noopener"> <strong class="ak">成为媒介会员</strong> </a>到<strong class="ak">无限制访问</strong>媒介上的故事和每日有趣的媒介文摘。我会得到你的费用的一小部分，没有额外的费用给你。</p></blockquote><div class="ov ow ox oy oz pa"><a href="https://medium.com/@17.rsuraj/membership" rel="noopener follow" target="_blank"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd jd gy z fp pf fr fs pg fu fw jc bi translated">加入我的推荐链接- Suraj Gurav媒体</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">今天就成为中等会员吧！！！每月5美元，让你可以无限制地访问成千上万的Python指南和数据…</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">medium.com</p></div></div><div class="pj l"><div class="pk l pl pm pn pj po lb pa"/></div></div></a></div><p id="c699" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">💡此外，<a class="ae lh" href="https://medium.com/subscribe/@17.rsuraj" rel="noopener"> <strong class="lk jd">注册我的电子邮件列表</strong> </a>永远不要错过另一篇关于数据科学指南、技巧和提示、SQL和Python的文章。</p><p id="c979" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">感谢您的阅读！</strong></p></div></div>    
</body>
</html>