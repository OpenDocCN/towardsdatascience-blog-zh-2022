<html>
<head>
<title>7 Visualizations with Python to Express Changes in Rank over Time</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">7 用 Python 可视化表达等级随时间的变化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/7-visualizations-with-python-to-express-changes-in-rank-over-time-71c1f11d7e4b#2022-11-28">https://towardsdatascience.com/7-visualizations-with-python-to-express-changes-in-rank-over-time-71c1f11d7e4b#2022-11-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="43dd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 Python 可视化等级随时间的变化</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/dc0ef22499f37841b3ebe43d19bec0b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iTavpcM73G548IKw"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">澳大利亚八月在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="ed2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">排序数据是按数字顺序排列的数据位置。这是一种简单的信息交流方式，因为它有助于读者毫不费力地理解序列。排序是处理多个观察值或分类数据的好方法。</p><p id="b0f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，事情总是在变化。随着时间的推移，排名的位置可以不断改变。可视化一段时间内的等级位置有助于通知变化和进展。</p><p id="146a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章将会用一些想法来引导你想象等级随时间的变化。</p><div class="kj kk kl km gt ab cb"><figure class="lv kn lw lx ly lz ma paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/7ffffcbdaacdac51f3f59cdecdbd1a74.png" data-original-src="https://miro.medium.com/v2/resize:fit:690/1*rNG4bXBKay2StP36ZTj-vg.gif"/></div></figure><figure class="lv kn lw lx ly lz ma paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/ba0859422cdccfa1857865869a0e9130.png" data-original-src="https://miro.medium.com/v2/resize:fit:690/1*yi7Hf51lt8TFQ7i08OddvA.gif"/></div></figure><figure class="lv kn mb lx ly lz ma paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/8797e9aab9f9980b94b5c50f2776a788.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*HEV-Rgbvla4Kks7uNYBBMA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk mc di md me translated">本文中使用 Python 进行数据可视化的示例，展示了等级随时间的变化。作者提供的图片</p></figure></div><p id="6529" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们开始吧</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h2 id="9851" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">检索数据</h2><p id="f278" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">为了说明这里提到的方法可以应用于真实世界的数据集，我将使用来自 Kaggle ( <a class="ae ky" href="http://www.kaggle.com/datasets/bappekim/air-pollution-in-seoul" rel="noopener ugc nofollow" target="_blank">链接</a>)的“首尔空气污染”数据集。数据由首尔市政府提供(<a class="ae ky" href="https://data.seoul.go.kr/dataList/OA-15526/S/1/datasetView.do#" rel="noopener ugc nofollow" target="_blank">链接</a>)。这些数据是在知识共享许可<a class="ae ky" href="https://creativecommons.org/about/cclicenses/" rel="noopener ugc nofollow" target="_blank">的条款下由</a>抄送使用的。</p><p id="5e7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该数据集由 2017 年至 2019 年期间在韩国首尔 25 个区记录的空气污染数据组成:SO2、NO2、CO、O3、PM10 和 PM2.5。</p><p id="d397" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将与一氧化碳(CO)一起工作，这是一种对人类有害的常见空气污染物。测量单位为<a class="ae ky" href="https://en.wikipedia.org/wiki/Parts-per_notation" rel="noopener ugc nofollow" target="_blank">百万分率</a> (ppm)。</p><h2 id="540e" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">输入数据</h2><p id="1c44" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">下载数据集后，从导入库开始。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="c130" class="np mn it nl b be nq nr l ns nt">import numpy as np<br/>import pandas as pd<br/>import math<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/><br/>%matplotlib inline</span></pre><p id="07b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用熊猫看‘Measurement _ summary . CSV’</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="d238" class="np mn it nl b be nq nr l ns nt">df = pd.read_csv('&lt;file location&gt;/Measurement_summary.csv')<br/>df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/795ec033f00aa4202853637537047b24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*asYNYuCh-LN-7QVBQcamMQ.png"/></div></div></figure><h2 id="1d56" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">浏览数据</h2><p id="66f9" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">作为第一步，探索数据集总是一个好主意。幸运的是，下面的结果表明我们不必处理丢失的值。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="dc53" class="np mn it nl b be nq nr l ns nt">df.info()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/b4eb4f58afa41460e38b93bc6a7624c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N8wfxadg6GqU07JrHGYo1A.png"/></div></div></figure><p id="6c1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看变量“车站代码”的总数</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="0ee3" class="np mn it nl b be nq nr l ns nt">df['Station code'].nunique()<br/><br/>## output<br/>## 25</span></pre><p id="0ece" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总共有 25 个区。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="097c" class="np mn it nl b be nq nr l ns nt">set(df['Station code'])<br/><br/>## output<br/>## {101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114,<br/>## 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125}</span></pre></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h2 id="1084" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">选择和准备数据</h2><p id="1746" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">例如，我将选择车站代码 111-118。如果您想绘制其他站号，请随意修改下面的代码。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="0b85" class="np mn it nl b be nq nr l ns nt">list_stations = [111, 112, 113, 114, 115, 116, 117, 118]<br/>df_select = df[df['Station code'].isin(list_stations)]<br/>df_select.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/fc5caf9f4fb12a903a99d9400129175b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKyzdhg3J1x8muT8sc3M8g.png"/></div></div></figure><p id="c400" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">检索到的数据集尚未准备好进行绘制。有些列需要在使用前创建或修改。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="606c" class="np mn it nl b be nq nr l ns nt">## crete year_month, year and month columns<br/>year_month = [i[0:7] for i in list(df_select['Measurement date'])]<br/>df_select['year_month'] = year_month<br/>df_select['year'] = [i[0:4] for i in year_month]<br/>df_select['month'] = [i[-2:] for i in year_month]<br/><br/>## create district name column<br/>district = [i.split(', ')[2] for i in df_select['Address']]<br/>df_select['District'] = district<br/><br/>## change Station code column type<br/>df_select = df_select.astype({'Station code': str})<br/><br/>## groupby with location and point of time<br/>df_month = df_select.groupby(['Station code','District',<br/>                              'year_month','year','month']).mean()<br/>df_month.reset_index(inplace=True)<br/>df_month.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/2027ebeb270f22ab6d43405407227dd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IDhNbaycy2uwxFs2Shlo0A.png"/></div></div></figure><p id="870b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是重要的一步。本文的主要思想是为排名数据创建可视化。接下来，我们将创建一个列，用于对每个时间点的地区 CO 数(ppm)进行排名。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="f32a" class="np mn it nl b be nq nr l ns nt">keep = []<br/>for i in list(set(df_month['year_month'])):<br/>    df = df_month[df_month['year_month']==i]<br/>    order = df['CO'].rank(ascending=0)<br/>    df['rank'] = [int(i) for i in order]<br/>    keep.append(df)<br/>    <br/>df_month = pd.concat(keep)<br/>df_month.sort_values(['year_month', 'Station code'], ascending=True,<br/>                     inplace=True, ignore_index=True)<br/>df_month.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/02f904af07eb4c36ae5ff2f9dec18a17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Mx0CTazgEm7Xp_5yLOQYQ.png"/></div></div></figure><p id="14a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在继续之前，我们将定义一个颜色字典，以便于绘图过程。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="80a9" class="np mn it nl b be nq nr l ns nt">#extract color palette, the palette can be changed<br/>list_dist = list(set(df_select['District']))<br/>pal = list(sns.color_palette(palette='Spectral',<br/>                             n_colors=len(list_dist)).as_hex())<br/>dict_color = dict(zip(list_dist, pal))</span></pre></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h2 id="cd23" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">数据可视化</h2><p id="f4b5" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">本文旨在用一些可视化的思想来指导对数据进行排序。因此，获得的结果应该易于理解，同时允许读者比较不同时间点之间的数据等级。</p><p id="7ed1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在继续之前需要澄清一些事情。每张图都有它的优点和缺点。当然，没有什么是完美的。这里提出的一些想法可能只是为了一个吸引眼球的效果。但是它们都具有相同的目的，即显示数据等级随时间的变化。</p><p id="1c63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文中的图表可以分为两组:动画和图表。</p><h2 id="d115" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated"><strong class="ak">动画</strong></h2><p id="dce8" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">除了是一个吸引注意力的好主意，动画可以很容易地显示排名随时间的变化。</p><h2 id="3d88" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">1.将条形图高度与动画条形图进行比较</h2><p id="5748" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated"><a class="ae ky" href="https://plotly.com/python/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>是一个制作交互式动画图形的有用图形库。应用动画条形图的概念是固定每个地区的位置。每个条形都将标注排名数字。通过这样做，可以比较一段时间内的一氧化碳含量。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="33af" class="np mn it nl b be nq nr l ns nt">import plotly.express as px<br/>fig = px.bar(df_month, x='District', y='CO',<br/>             color='District', text='rank',<br/>             color_discrete_map= dict_color,<br/>             animation_frame='year_month',<br/>             animation_group='Station code',<br/>             range_y=[0,1.2],<br/>             labels={ 'CO': 'CO (ppm)'},<br/>            )<br/>fig.update_layout(width=1000, height=600, showlegend=False,<br/>                  xaxis = dict(tickmode = 'linear', dtick = 1))<br/>fig.update_traces(textfont_size=16, textangle=0)<br/>fig.show()</span></pre><p id="6abc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧啊。！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/1755d7d8d49c57ed1adc8928abe832bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*rNG4bXBKay2StP36ZTj-vg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">动画条形图显示地区的月度排名和 CO(ppm)量。作者图片。</p></figure><p id="e454" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面所附的结果可能看起来很快，因为这只是结果的一个例子。不用担心；有一个暂停按钮用于暂停，还有一个按钮用于选择特定的时间点。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h2 id="0cc4" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">2.带动画散点图的赛车</h2><p id="bbe8" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">现在让我们换个角度，根据各个地区在不同时间点的排名来移动它们。散布点的大小可以用来显示一氧化碳数量。</p><p id="8e04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了方便用<a class="ae ky" href="https://plotly.com/python/animations/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>绘图，我们需要在 DataFrame 中添加两列，X 轴上的位置，以及注释文本。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="b693" class="np mn it nl b be nq nr l ns nt">ym = list(set(year_month))<br/>ym.sort()<br/><br/>df_month['posi'] = [ym.index(i) for i in df_month['year_month']]<br/>df_month['CO_str'] = [str(round(i,2)) for i in df_month['CO']]<br/>df_month['CO_text'] = [str(round(i,2))+' ppm' for i in df_month['CO']]<br/>df_month.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/4f28223be0da46a28a3030d3b1196f9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lbxvazQrqnzhJAKg2RVGdg.png"/></div></div></figure><p id="0b47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，绘制动画散点图。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="642e" class="np mn it nl b be nq nr l ns nt">import plotly.express as px<br/>fig = px.scatter(df_month, x='posi', y='rank',<br/>                 size= 'CO',<br/>                 color='District', text='CO_text',<br/>                 color_discrete_map= dict_color,<br/>                 animation_frame='year_month',<br/>                 animation_group='District',<br/>                 range_x=[-2,len(ym)],<br/>                 range_y=[0.5,6.5]<br/>                )<br/>fig.update_xaxes(title='', visible=False)<br/>fig.update_yaxes(autorange='reversed', title='Rank',<br/>                 visible=True, showticklabels=True)<br/>fig.update_layout(xaxis=dict(showgrid=False),<br/>                  yaxis=dict(showgrid=True))<br/>fig.update_traces(textposition='middle left')<br/>fig.show()</span></pre><p id="4190" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哒哒…</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/bece58a84c6b47cdf279bbee2c4470d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*yi7Hf51lt8TFQ7i08OddvA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">动画散点图显示地区的月度排名和 CO(ppm)量。作者图片。</p></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h2 id="07e3" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">图表</h2><p id="fc00" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">动画图表通常受限于只能表达一个时间点。为了显示多个时间点，可以应用一些图表和方法来一次展示多个时间点。</p><h2 id="2a5f" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">3.使用凹凸图绘制线条</h2><p id="35f0" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">基本上，凹凸图应用多条线来显示排名随时间的变化。使用 Plotly 绘制凹凸图允许用户在将光标悬停在每个数据点上时过滤结果并提供更多信息，如下面的结果所示。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="372a" class="np mn it nl b be nq nr l ns nt">import plotly.express as px<br/>fig = px.line(df_month, x = 'year_month', y = 'rank',<br/>              color = 'District',<br/>              color_discrete_map= dict_color, <br/>              markers=True,<br/>              hover_name = 'CO_text')<br/>fig.update_traces(marker=dict(size=11))<br/>fig.update_yaxes(autorange='reversed', title='Rank',<br/>                 visible=True, showticklabels=True)<br/>fig.update_xaxes(title='', visible=True, showticklabels=True)<br/>fig.update_layout(xaxis=dict(showgrid=False),<br/>                  yaxis=dict(showgrid=False) )<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/661154ebf378ca9961a935ddd3fd6c12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0H-PLoSF1_aR5uWCyiEw9Q.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">凹凸图显示了各区的排名和每月的一氧化碳含量(ppm)。可以过滤结果并提供更多信息，如图所示。作者图片。</p></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h2 id="2f8c" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">4.创建条形图的照片拼贴</h2><p id="02c7" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">一个简单的柱状图可以表达一个时间点的排名。有了很多时间点，我们可以创建很多条形图，然后组合成一个照片拼贴。首先使用<a class="ae ky" href="https://seaborn.pydata.org/" rel="noopener ugc nofollow" target="_blank"> Seaborn </a>库创建一个条形图。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="9efe" class="np mn it nl b be nq nr l ns nt">df_select = df_month[df_month['year_month']=='2017-01']<br/>fig, ax = plt.subplots(figsize=(15, 6))<br/><br/>sns.set_style('darkgrid')<br/>sns.barplot(data = df_select,<br/>            x = 'District', y ='CO',<br/>            order=df_select.sort_values('CO', ascending=False)['District'],<br/>            palette=dict_color)<br/>ax.bar_label(ax.containers[0],<br/>             labels=df_select.sort_values('CO', ascending=False)['CO_str'],<br/>             label_type='edge', size=11)<br/>plt.ylabel('CO (ppm)')<br/>plt.title('2017-01')<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/577055d3d078ff061d0e13e4da0021a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D1a20oFFD8SJIdxdTHOz2w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">条形图按排名显示各区的一氧化碳含量(ppm)。作者图片。</p></figure><p id="a713" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用 for-loop 函数创建不同时间点的条形图。请注意，下面的代码会将图表导出到您的计算机，以便以后导入。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="bee8" class="np mn it nl b be nq nr l ns nt">keep_save = []<br/>for t in ym:<br/>    df_ = df_month[df_month['year_month']==t]<br/>    fig, ax = plt.subplots(figsize=(8.5, 5))<br/>    sns.set_style('darkgrid')<br/>    sns.barplot(data = df_,<br/>                x = 'District', y ='CO',<br/>                order = df_.sort_values('CO', ascending=False)['District'],<br/>                palette=dict_color)<br/>    ax.bar_label(ax.containers[0],<br/>                 labels=df_.sort_values('CO', ascending=False)['CO_str'],<br/>                 label_type='edge', size=11)<br/>    plt.ylim([0, 1.2])<br/>    plt.ylabel('CO (ppm)')<br/>    plt.title(t)<br/>    plt.tight_layout()<br/>    s_name = t + '_bar.png'<br/>    keep_save.append(s_name)<br/>    plt.savefig(s_name)<br/>    plt.show()</span></pre><p id="f845" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个函数来合并图表。我发现了一个很好的代码来组合这个<a class="ae ky" href="https://stackoverflow.com/questions/35438802/making-a-collage-in-pil" rel="noopener ugc nofollow" target="_blank">链接</a>上堆栈溢出的许多情节。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="7aca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应用函数。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="7a67" class="np mn it nl b be nq nr l ns nt">## get_collage(n_col, n_row, width, height, save_name, 'output.png')<br/># width = n_col * figure width<br/># height = n_row * figure height <br/><br/>get_collage(12, 3, 12*850, 3*500, keep_save, 'order_bar.png')</span></pre><p id="8946" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哒哒…</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/49faefedb7afa137ec5aae3bfb181076.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FTUT_-09pmLeh8xMlRWK_A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片拼贴的一部分结合了条形图，显示了各区的排名和每月的二氧化碳含量(百万分之几)。作者图片。</p></figure><p id="d147" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果显示每个地区的月度 CO 值，同时显示一段时间内的排名顺序。因此，我们可以同时比较多个时间点的区域等级和污染量。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h2 id="e743" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">5.想象有圆形条形图的条形图</h2><p id="2d8e" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">与前面的想法相同的概念，我们可以将普通的条形图变成<a class="ae ky" href="https://www.python-graph-gallery.com/circular-barplot/" rel="noopener ugc nofollow" target="_blank">圆形条形图</a>(又名赛道图)，并将它们组合成照片拼贴。</p><p id="c60a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如前所述，凡事都有利弊。由于每个条形的长度比例不相等，圆图上的每个条形可能很难比较。然而，这可以被认为是一个很好的选择，以创造一个引人注目的效果。</p><p id="35cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从创建圆形条形图的示例开始。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/56b67aac4bf410994651264b2f4a4b90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MA-Skba716EoZGOzsvkOZQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">圆形条形图按等级显示各区的一氧化碳含量(百万分之几)。作者图片。</p></figure><p id="5c88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应用 for-loop 函数获得其他圆形条形图。结果将导出到您的计算机中，以便以后导入。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="82c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用函数获取照片拼贴。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="5e67" class="np mn it nl b be nq nr l ns nt">get_collage(12, 3, 12*860, 3*810, keep_cir, 'order_cir.png')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/db2fe071252f0a88a742c45c683d6f81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*McfH2zECaT-P4_thyUQM9Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一张照片拼贴画的一部分结合了圆形条形图，显示了各区的排名和每月的二氧化碳含量(百万分之几)。作者图片。</p></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h2 id="519f" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">6.另一种用径向条形图想象条形图的方法</h2><p id="9711" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">用<a class="ae ky" href="https://www.python-graph-gallery.com/circular-barplot-basic" rel="noopener ugc nofollow" target="_blank">径向条形图</a>改变条形图的方向，从中心开始。这是另一个吸引注意力的方法。然而，可以注意到，彼此不靠近的条很难比较。</p><p id="49dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从一个放射状条形图的例子开始。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/29ba334ced68c14bcd789781ae44c124.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pxgjlAOawSoJYVKlEy5k8w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">放射状条形图按等级显示各区的一氧化碳含量(ppm)。作者图片。</p></figure><p id="9cbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应用 for-loop 函数创建其他径向条形图。结果也将导出到您的计算机，以便以后导入。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="f45f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应用该函数获得一个照片拼贴。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="c492" class="np mn it nl b be nq nr l ns nt">get_collage(12, 3, 12*800, 3*800, keep_rad, 'order_rad.png')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/1d27538d3b4d9dc489c389ef035cd3f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3w-xjHCeeObB0SdqQV-l5A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一张照片拼贴画的一部分结合了放射状的条形图，显示了各区的排名和每月的二氧化碳含量(百万分之几)。作者图片。</p></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h2 id="d8b5" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">7.在热图中使用颜色</h2><p id="9055" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">通常，热图是一种常见的图表，用于将数据呈现为二维图表，并用颜色显示值。对于我们的数据集，可以应用颜色来显示等级数。</p><p id="9fbf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先用 pd.pivot()创建一个数据透视表。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="2c1b" class="np mn it nl b be nq nr l ns nt">df_pivot = pd.pivot(data=df_month, index='District',<br/>                    columns='year_month', values='rank')<br/>df_pivot</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/ff75b3ab971ee20088c592be90c6df66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IbyzCdMTsKrIO88Q2NZ3xA.png"/></div></div></figure><p id="ad80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">获得数据透视表后，我们可以用几行代码轻松创建热图。</p><pre class="kj kk kl km gt nk nl nm bn nn no bi"><span id="329d" class="np mn it nl b be nq nr l ns nt">plt.figure(figsize=(20,9.5))<br/>sns.heatmap(df_pivot, cmap='viridis_r', annot=True, cbar=False)<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/0ead82847ec5c26d8743fd86165b7c61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WjOBk1CTWm04MJkTQNyGGw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">应用热图显示地区排名随时间的变化。作者图片。</p></figure><p id="4426" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过颜色和注释，我们可以找出 CO 值最高(黄色)和最低(深蓝色)的地区。随着时间的推移，可以注意到排名的变化。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h2 id="bc63" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">摘要</h2><p id="22a9" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">本文介绍了用 Python 代码表达数据等级随时间变化的七种可视化思想。如前所述，凡事都有利弊。重要的是找到适合数据的正确图表。</p><p id="e36a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我敢肯定，随着时间的推移，有比这里提到的更多的数据排名图。本文仅用一些思路指导。如果有什么建议或推荐，欢迎随时留言评论。我很乐意看到它。</p><p id="5dbe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><p id="ec03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些是我的数据可视化文章，您可能会感兴趣:</p><ul class=""><li id="7b87" class="ok ol it lb b lc ld lf lg li om lm on lq oo lu op oq or os bi translated">8 用 Python 处理多个时序数据的可视化(<a class="ae ky" rel="noopener" target="_blank" href="/8-visualizations-with-python-to-handle-multiple-time-series-data-19b5b2e66dd0">链接</a>)</li><li id="4a45" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated">6 可视化与 Python 技巧处理超长时间序列数据(<a class="ae ky" rel="noopener" target="_blank" href="/6-visualization-tricks-to-handle-ultra-long-time-series-data-57dad97e0fc2">链接</a>)</li><li id="d6df" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated">9 用 Python 可视化显示比例，而不是饼状图(<a class="ae ky" href="https://medium.com/p/4e8d81617451/" rel="noopener">链接</a>)</li><li id="5665" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated">9 个比条形图更引人注目的 Python 可视化(<a class="ae ky" rel="noopener" target="_blank" href="/9-visualizations-that-catch-more-attention-than-a-bar-chart-72d3aeb2e091">链接</a>)</li></ul></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h2 id="2371" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">参考</h2><ul class=""><li id="5850" class="ok ol it lb b lc nf lf ng li oy lm oz lq pa lu op oq or os bi translated">首尔市政府。(2021 年 5 月)。韩国首尔的空气污染测量信息。检索于 2022 年 11 月 23 日，来自<a class="ae ky" href="https://www.kaggle.com/datasets/bappekim/air-pollution-in-seoul" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/datasets/bappekim/air-pollution-in-Seoul</a></li><li id="c9c7" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><em class="pb"> 서울시 대기오염 측정정보 </em>。서울열린데이터광장.检索于 2022 年 11 月 26 日，来自<a class="ae ky" href="https://data.seoul.go.kr/dataList/OA-15526/S/1/datasetView.do" rel="noopener ugc nofollow" target="_blank">https://data . Seoul . go . kr/dataList/OA-15526/S/1/dataset view . do</a></li></ul></div></div>    
</body>
</html>