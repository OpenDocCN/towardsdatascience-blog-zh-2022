<html>
<head>
<title>A Comparison of GroupBy and Pivot in Python’s Pandas Module</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 熊猫模块中 GroupBy 和 Pivot 的比较</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-comparison-of-groupby-and-pivot-in-pythons-pandas-module-527909e78d6b#2022-03-11">https://towardsdatascience.com/a-comparison-of-groupby-and-pivot-in-pythons-pandas-module-527909e78d6b#2022-03-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b1bb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">有时，有多种方法来显示来自数据的相同见解。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/85e7aeb08e64f677ef3a1b4398c3b390.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*erhbjSAPQMSzQnjX"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@lukechesser?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卢克·切瑟</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="8f0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据科学家的主要工作之一是向观众展示来自数据的关键见解。在这样做的时候，数据科学家必须考虑两件重要的事情:1) <em class="lv">应该传达什么样的关于数据的主要思想，以及 2) <em class="lv">应该如何</em>分析并最终展示它们。</em></p><p id="a2e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有许多工具用于清理、处理、分析和显示数据。在本文中，我将重点介绍 Pandas，这是 Python 中一个流行的模块，包含各种不同的数据分析工具。</p><p id="e24d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过 Pandas 显示数据的一个关键方法是计算复杂数据点集合的汇总统计数据。下面，我将比较在相同数据上完成这项任务的两种不同方法:1)使用分组和聚合，2)使用数据透视表。</p><h2 id="7f77" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">数据和目标</h2><p id="3d30" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">对于这个任务，我们将使用下面的数据集[1]，称为<code class="fe mu mv mw mx b">nba_full</code>。它包含了从 1996-97 赛季开始的许多不同赛季中各种 NBA 球员的信息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi my"><img src="../Images/f91ba8d674d06e967f95a765a8742e77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*mNYFIFzMG07-Q5yBrdx8Yg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><p id="e469" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">原始数据集还有几列，但是我已经提取出了对我们最重要的几列:<code class="fe mu mv mw mx b">player_name</code>、<code class="fe mu mv mw mx b">team_abbreviation</code>、<code class="fe mu mv mw mx b">age</code>、<code class="fe mu mv mw mx b">pts</code>和<code class="fe mu mv mw mx b">season</code>。</p><p id="7d1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的目标是重新格式化这些数据，以有意义地显示下面的汇总统计:<strong class="lb iu">NBA 球队每个赛季的平均球员年龄</strong>。例如，假设有人问“2019-20 赛季洛杉矶湖人队的平均球员年龄是多少？”我们应该能够很容易地从重新格式化的数据中读出这个问题的答案。</p><p id="96f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看两种可能的方法。</p><h2 id="5c3c" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">使用 GroupBy 聚合</h2><p id="a24a" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">作为快速复习，Pandas 中的分组和聚合通常是通过使用<code class="fe mu mv mw mx b">groupby</code>函数按特定列对值进行分组，然后使用相应的<code class="fe mu mv mw mx b">agg</code>函数从不同的列中聚合值。</p><p id="1d0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们先看一个更简单的例子，然后再从上面讨论我们的目标，因为这有点高级。假设我们运行下面一行代码:</p><pre class="kj kk kl km gt mz mx na nb aw nc bi"><span id="41e1" class="lw lx it mx b gy nd ne l nf ng">nba_full.groupby('player_name')[['pts']].agg('mean')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/2712130a9517c014876b1e7e99059892.png" data-original-src="https://miro.medium.com/v2/resize:fit:474/format:webp/1*HwwC00i3zPwfNkKS_xQhbQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="e2c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个代码显示了数据中每个球员在所有赛季中的平均得分。这里有几个要点来一步一步地解释代码的作用:</p><ul class=""><li id="fa50" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">按列<code class="fe mu mv mw mx b">'player_name'</code>分组指定该列为我们的索引。然后，所有值将被聚合到由该列中的唯一值指定的组中。</li><li id="d395" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">我们选择列<code class="fe mu mv mw mx b">'pts'</code>作为我们想要计算聚合值的列，因为默认情况下<a class="ae ky" rel="noopener" target="_blank" href="/pandass-groupby-function-is-a-powerful-tool-but-can-mislead-your-audience-if-you-re-not-careful-c4491055a98e">Pandas 将聚合所有其他列</a>。我们选择带双括号的列，以便 Pandas 返回 DataFrame 而不是 Series。</li><li id="8e9e" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">我们调用<code class="fe mu mv mw mx b">.agg('mean')</code>来指定对于每个独特的球员，我们想要计算他们在表格中出现的所有不同时间的平均分数(对应于他们在 NBA 打球的所有不同赛季)。我们可以使用许多其他内置函数(如<code class="fe mu mv mw mx b">max</code>或<code class="fe mu mv mw mx b">count</code>)，如果我们愿意，我们也可以使用用户定义的函数。</li></ul><p id="f25a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们准备着手我们的主要任务。回想一下我们的目标:我们想要 NBA 球队每个赛季的平均球员年龄。如果你仔细阅读，你会发现我们实际上想要计算数据中两个列的汇总统计数据:球队和赛季。为了完成这个任务，我们将需要在对<code class="fe mu mv mw mx b">groupby</code>的调用中指定我们是按照这两个列进行分组的。</p><p id="9266" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看一下代码和输出，然后我们将一步一步地分解它:</p><pre class="kj kk kl km gt mz mx na nb aw nc bi"><span id="2f82" class="lw lx it mx b gy nd ne l nf ng">nba_full.groupby(['team_abbreviation', 'season'])[['age']].agg('mean')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/5e55b5bad4c13e73cf70432558799d3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/format:webp/1*dsUN0tEmVCG_jChD7ufMNw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><p id="9ba1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码的一些要点:</p><ul class=""><li id="52b3" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">我们按两列分组，这给了我们一个多索引的数据框架。</li><li id="b5fc" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">代码的剩余部分类似于我们的第一个例子:我们提取出感兴趣的列<code class="fe mu mv mw mx b">'age'</code>进行聚合，然后我们指定聚合函数<code class="fe mu mv mw mx b">'mean'</code>。</li><li id="09fd" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">解释代码的方式如下:对于每个独特的球队和赛季组合，计算列<code class="fe mu mv mw mx b">'player_age'</code>的平均值。例如，包含<strong class="lb iu"/><code class="fe mu mv mw mx b">ATL</code>和<code class="fe mu mv mw mx b">1996-97</code>的每一行都被识别，并且这些行中的所有年龄被平均以产生我们上面看到的最后的第一行。对其他组合重复该过程，以产生剩余的行。</li></ul><p id="e276" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为最后的美学注释，我建议在结尾处重新设置索引，以使输出更具可读性:</p><pre class="kj kk kl km gt mz mx na nb aw nc bi"><span id="b826" class="lw lx it mx b gy nd ne l nf ng">nba_full.groupby(['team_abbreviation', 'season'])[['age']].agg('mean').reset_index()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/972bc5f71e3efd2a77fd89e7544accdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*MNZcl2yWp4SQKkRmKsiwkQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><p id="8b22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你知道了！这就是我们如何使用分组和聚合来实现我们的初始目标。接下来，我们将考虑如何使用数据透视表来完成同样的任务。</p><h2 id="d38b" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">使用数据透视表</h2><p id="fc7b" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">在 Pandas 中，数据透视表在技术上仍然是一个数据框架，但它通常指的是以某种方式格式化的表。具体来说，数据透视表重新排列数据，使一列的值成为行标签，第二列的值成为列标签，第三列的值为每个组合进行聚合。</p><p id="400d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个有点复杂的句子，所以让我们把它应用到我们的目标。在我们的例子中，我们可以像下面这样做:</p><ul class=""><li id="71ab" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">让独特的 NBA 球队成为行标</li><li id="35ed" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">使独特的季节成为列标签</li><li id="6a04" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">使用<code class="fe mu mv mw mx b">'mean'</code>函数合计每个组合的年龄。</li></ul><p id="a3be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">听起来熟悉吗？这正是我们用上面的<code class="fe mu mv mw mx b">groupby</code>完成的，但是格式略有不同。让我们来看看完成这项任务的代码:</p><pre class="kj kk kl km gt mz mx na nb aw nc bi"><span id="29e1" class="lw lx it mx b gy nd ne l nf ng">nba_full.pivot_table(index='team_abbreviation', columns='season', values='age', aggfunc='mean')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/831e0aee9cb236549f6e17f119e9b7b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cr2HCFNpPqm4JxAM-4MCpw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><p id="b0e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">任务完成！现在，我们可以查看表中每个条目对应的行和列，以确定它对应的球队和赛季组合。以下是关于代码如何工作的一些要点:</p><ul class=""><li id="78a6" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated"><code class="fe mu mv mw mx b">'index'</code>指定我们想要哪个列的唯一标签作为输出数据帧的索引(或行标签)。</li><li id="af54" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><code class="fe mu mv mw mx b">'columns'</code>指定我们想要哪个列的唯一值作为输出数据帧的列标签。</li><li id="1084" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><code class="fe mu mv mw mx b">'values'</code>指定包含我们要聚合的值的列。</li><li id="b1fe" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><code class="fe mu mv mw mx b">'aggfunc'</code>指定我们想要使用的聚合函数。</li></ul><p id="7fca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，我们看到我们遇到了另一种表示相同数据的方法。</p><h2 id="70c0" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">为什么重要？</h2><p id="c37c" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">那么，使用一种技术比使用另一种技术有什么不同吗？从严格的定量角度来看，人们可能会认为这并不重要——最终，两个输出表显示的是相同的数据。</p><p id="794e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，<a class="ae ky" href="https://medium.com/mlearning-ai/human-centered-data-science-what-is-it-and-why-is-it-the-way-forward-e44e749fe4c9" rel="noopener">好的数据科学不仅仅是数字。</a>展示数据时，重要的是要考虑什么样的展示能最大限度地让观众理解。</p><p id="a937" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没有一种“更好”的技术——这取决于具体情况。例如，许多人可能通常更喜欢<code class="fe mu mv mw mx b">pivot_table</code>显示，因为他们发现匹配行和列来查找聚合值更自然。然而，当您的数据有许多唯一的标签时，数据透视表会变得混乱。即使在上面的例子中，我也只能显示输出数据帧的一部分(右边还有更多列)，因为它太大了，无法完全粘贴。相比之下，<code class="fe mu mv mw mx b">groupby</code>显示在每个单独的行中具有较少的信息，并且导致较少的信息负载。对于较小的数据集，透视显示可能更有用，因为它(可以说)更符合聚合数据的逻辑显示。</p><p id="92c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最重要的是探索多种演示，并确保最终的决策优先考虑最终将使用、解释或查看这些数据的人的利益。如果你能做到这一点，那么你正在成为一名优秀的数据科学家的路上。</p><p id="934f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下次见，伙计们！</p></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><p id="f388" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">想擅长 Python？</strong> <a class="ae ky" href="https://witty-speaker-6901.ck.page/0977670a91" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">获取独家，免费获取我简单易懂的指南</strong> </a> <strong class="lb iu">。想在介质上无限阅读故事？用我下面的推荐链接注册！</strong></p><div class="og oh gp gr oi oj"><a href="https://murtaza5152-ali.medium.com/?source=entity_driven_subscription-607fa603b7ce---------------------------------------" rel="noopener follow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd iu gy z fp oo fr fs op fu fw is bi translated">穆尔塔扎阿里培养基</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">阅读媒介上穆尔塔扎·阿里的作品。华盛顿大学的博士生。对人机感兴趣…</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">murtaza5152-ali.medium.com</p></div></div><div class="os l"><div class="ot l ou ov ow os ox ks oj"/></div></div></a></div><h2 id="59c9" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">参考</h2><p id="f3c1" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">[1]<a class="ae ky" href="https://www.kaggle.com/justinas/nba-players-data" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/justinas/nba-players-data</a></p></div></div>    
</body>
</html>