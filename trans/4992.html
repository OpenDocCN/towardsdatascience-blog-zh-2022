<html>
<head>
<title>Kruskal Wallis Test for Beginners</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">克鲁斯卡尔·沃利斯初学者测验</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/kruskal-wallis-test-for-beginners-4fe9b0333b31#2022-11-07">https://towardsdatascience.com/kruskal-wallis-test-for-beginners-4fe9b0333b31#2022-11-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="68d6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">克鲁斯卡尔沃利斯测试:目的，范围，假设，例子，Python实现</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f03a54c73c51ac3453d54ff0741a7f00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*I5SvE3_8QI5blte6"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">罗马法师在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="f8ce" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">1.目的</h1><p id="4f82" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Kruskal Wallis是一种评估样本是否来自同一分布的非参数方法。它用于两个以上独立或不相关样本的比较。单向方差分析(ANOVA)是Kruskal-Wallis检验的参数等价。</p><h2 id="e7b7" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">1.1什么是好的业务用例？</h2><p id="bda1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们来衡量一家制药公司推出的一项活动对一种新上市药物的影响，我们有1550个目标和500个抵制者。我们观察了处方行为分布，发现它是非正态的(偏斜的),但每个组(目标和抵制者)的形状相似。我们不能进行方差分析；因此，我们应用一个非参数检验，克鲁斯卡尔-沃利斯。</p><h1 id="059b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">2.范围</h1><p id="8e68" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">由于Kruskal Wallis是非参数检验，因此没有假设数据是正态分布的(与ANOVA不同)。</p><ol class=""><li id="fcd5" class="mz na it lt b lu nb lx nc ma nd me ne mi nf mm ng nh ni nj bi translated">事实上的零假设是样本来源的总体具有相同的中位数。</li><li id="1a23" class="mz na it lt b lu nk lx nl ma nm me nn mi no mm ng nh ni nj bi translated">当有一个属性变量和一个测量变量，并且测量变量不满足方差分析(正态性和同质性)的假设时，最常使用Kruskal-Wallis检验</li><li id="a20e" class="mz na it lt b lu nk lx nl ma nm me nn mi no mm ng nh ni nj bi translated">与大多数非参数测试一样，它是对分级数据执行的，因此测量观察值使用整个数据集转换为它们的等级:最小或最低值的等级为1，下一个最小值的等级为2，接下来的等级为3，依此类推。在平局的情况下，考虑平均排名。</li><li id="b690" class="mz na it lt b lu nk lx nl ma nm me nn mi no mm ng nh ni nj bi translated"><em class="np">在用等级代替原始值的过程中，信息的损失使得这种检验不如方差分析有效，因此如果数据满足假设</em>，则应使用方差分析。</li></ol><p id="c6fe" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">克鲁斯卡尔-沃利斯检验的零假设有时被认为是组中值相等。然而，只有当你相信每个群体的分布特征是相同的，这才是准确的。即使中位数相同，如果分布不同，Kruskal-Wallis检验也可以拒绝零假设。</p><h1 id="5541" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">3.假设</h1><p id="3b29" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">可以使用Kruskal-Wallis统计来检查不同大小的组。与可比的单向方差分析不同，Kruskal-Wallis检验不假设正态分布，因为它是非参数程序。然而，该测试假设每个组的分布具有相同的形状和比例，除了中位数的任何变化。</p><h1 id="cc15" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">4.方法学</h1><p id="e855" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Kruskal Wallis可用于分析试验组和对照组的表现是否不同。当数据是偏斜的(非正态分布)时，测试将告诉两组是否不同，而不建立任何因果关系。它不会暗示行为差异的原因。</p><h2 id="6d94" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">4.1测试如何进行？</h2><p id="cd4b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Kruskal Wallis从1(最次要的)开始对所有观察结果进行排序。对所有数据点进行排序，而不管它们属于哪个组。绑定值将获得未绑定时的平均排名。</p><p id="3aaa" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">当根据分析变量(处方数量)为所有观察值分配了带符号的等级后，将根据它们的目标/拒绝状态对它们进行区分/分组。之后，计算并比较每组的平均排名。</p><p id="3508" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">由于计划或促销活动是针对这一群体展开的，因此目标群体的平均排名应高于抵制者。由于具有显著的p值，Target的表现优于钉子户。这里的挑战是，在存在离群值的情况下，目标群体的平均排名可能会更高，即很少有医生比其他人写更多的脚本。因此，我们总是查看Kruskal Wallis获得的算术中位数和结果p值来验证/反驳我们的假设。</p><p id="0231" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">设Ni (i = 1，2，3，4，…，g)代表数据中每个g组的样本量(即样本，或者在这种情况下，医生的数量)。ri是第一组的等级之和，ri’是第一组的平均等级。然后，Kruskal Wallis检验统计量计算如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/a344f68dca1b7e5b596460c3f9ddf851.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*4byC59Dh8BRFlDuk6QwZjQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd nu">配方1。</strong>说明了计算测试统计的公式。图片由作者使用Markdown和Latex制作。</p></figure><p id="5652" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">如果检验统计量超过阈值卡方值，则拒绝相等总体中位数的零假设。当相等总体的零假设为真时，该统计量具有k-1个自由度，并且近似于卡方分布。近似值的ni值必须至少为5(即，一组中至少有5个观察值)，才能准确。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/efe077ed599dacc990fca20a87ba9740.png" data-original-src="https://miro.medium.com/v2/resize:fit:364/format:webp/1*z2nKo_V5Zwx5HkgMrduwrA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd nu">配方二。</strong>说明了测试的p值近似值公式。图片由作者使用Markdown和Latex制作。</p></figure><p id="5b5e" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">使用卡方概率分布表，我们可以得到g-1自由度的关键卡方值和期望的显著性水平。或者，我们可以检查p值来评价结果的显著性。</p><h2 id="0979" class="mn la it bd lb mo mp dn lf mq mr dp lj ma ms mt ll me mu mv ln mi mw mx lp my bi translated">4.2手动运行H测试</h2><p id="c80e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们假设一家制药公司想要了解三组医生是否有不同的患者量<strong class="lt iu">(斯蒂芬妮·格伦，未注明)</strong>例如，</p><p id="02f2" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">关键意见领袖/KOL(一个月的患者量):23、42、55、66、78</p><p id="2b7b" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">专家/专家(一个月的病人数量):45、56、60、70、72</p><p id="7c78" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">全科医生/全科医生(一个月的病人量):18、30、34、41、44</p><p id="64c9" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated"><strong class="lt iu"> 4.2.1将数据组合成一组后，按升序排列</strong></p><p id="694c" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi">18 23 24 30 41 42 44 45 55 56 60 66 70 72 78</p><p id="4c4f" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated"><strong class="lt iu"> 4.2.2对排序后的数据点进行排序。出现平局时使用平均值</strong></p><p id="8e82" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">值:18 23 24 30 41 42 44 45 55 56 60 66 70 72 78</p><p id="730e" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">排名:1 2 3 4 5 6 7 8 9 10 11 12 13 14 15</p><p id="653d" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated"><strong class="lt iu"> 4.2.3计算各组排名之和</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/98efee6c72e7cbe29a8474aa1e2412de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WCYWe-xirZ1SU-P-BWHxog.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd nu">图一。</strong>显示每组的排名总和。图片来源——由作者准备。</p></figure><p id="18d4" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated"><strong class="lt iu"> 4.2.4使用公式1和图1中的数字计算H统计数据</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/b4a1e32376a385d5610b51908ed9b6a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/0*EEU4FxKVc7Cp590f.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd nu">公式3。</strong>说明了计算我们处方者群体的H统计的公式。图片由作者使用Markdown和Latex制作。</p></figure><p id="d961" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">H=6.72</p><p id="104e" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated"><strong class="lt iu"> 4.2.5用<br/> an α=0.05确定g-1自由度的临界卡方值，对于我们的问题(3–1 = 2自由度)而言，该值应为5.99。请参考下表。</strong></p><div class="ny nz gp gr oa ob"><a href="https://people.richland.edu/james/lecture/m170/tbl-chi.html" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">表:卡方概率</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">顶部给出的区域是临界值右侧的区域。要在左侧查找某个区域…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">people.richland.edu</p></div></div></div></a></div><p id="60e7" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated"><strong class="lt iu"> 4.2.6将4.2.4中的H值与4.2.5中的临界值进行比较</strong></p><p id="ef43" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">如果临界卡方值小于H统计量，则应拒绝说明三个不同组的中值患者量相等的零假设。自5.99(临界值)&lt; 6.72, we can reject the null hypothesis.</p><p id="3884" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">There needs to be more evidence to infer that the medians are unequal if the chi-square value is not lower than the H statistic calculated above.</p><h1 id="8c40" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">5. Python Implementation</h1><p id="23dc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">The null hypothesis that all groups’ population medians are equal is tested using the Kruskal-Wallis H-test. It is an ANOVA variant that is non-parametric. The test utilizes two or more independent samples of varying sizes. Note that disproving the null hypothesis does not reveal how the groups differ. To identify which groups are different, post hoc comparisons between the groupings are necessary.</p><pre class="kj kk kl km gt ok ol om on aw oo bi"><span id="666b" class="mn la it ol b gy op oq l or os">from scipy import stats<br/>x = [1, 3, 5, 8, 9, 12, 17]<br/>y = [2, 6, 6, 8, 10, 15, 20, 22]<br/>stats.kruskal(x, y)</span><span id="47fd" class="mn la it ol b gy ot oq l or os">KruskalResult(statistic=0.7560483870967752, pvalue=0.3845680059797648)</span><span id="559a" class="mn la it ol b gy ot oq l or os">print(np.median(x))<br/>print(np.median(y))</span><span id="49af" class="mn la it ol b gy ot oq l or os">8.0<br/>9.0</span><span id="091a" class="mn la it ol b gy ot oq l or os">print(np.mean(x))<br/>print(np.mean(y))</span><span id="f79f" class="mn la it ol b gy ot oq l or os">7.86<br/>11.12</span></pre><p id="a538" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated">The output generated by Python is shown above. It should be noted that although a marked difference is observed in the mean of values across the two categories, this difference, when taking the median into account, is insignificant as the p-value is much greater than 5%.</p><h1 id="7640" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">6. Conclusion</h1><p id="ceaa" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Kruskal Wallis test is instrumental when dealing with particularly skewed samples. It can be used widely for a test control group during a campaign rollout or even when performing A/B testing. This is applicable for most industry use cases since each customer has different behavior when dealing with customers in a retail space or doctors in a pharmaceutical landscape. When we look at basket size or patient volume, few customers buy more, whereas few doctors have more patients. Hence for such skewed distribution, it is vital to put a Kruskal Wallis test to check if the behaviors are similar.</p><h1 id="bc20" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak"> 7。参考</strong></h1><p id="fcfb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">斯蒂芬妮·格伦。“克鲁斯卡尔·沃利斯H检验:定义、例子、假设、SPSS”来自<a class="ae ky" href="https://www.statisticshowto.com/" rel="noopener ugc nofollow" target="_blank"><strong class="lt iu"/></a>:对我们其余人的初步统计！<a class="ae ky" href="https://www.statisticshowto.com/probability-and-statistics/statistics-definitions/kruskal-wallis/" rel="noopener ugc nofollow" target="_blank">https://www . statistics show to . com/probability-and-statistics/statistics-definitions/kruskal-Wallis/</a></p><p id="c747" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi">‌</p></div><div class="ab cl ou ov hx ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="im in io ip iq"><p id="aaf9" class="pw-post-body-paragraph lr ls it lt b lu nb ju lw lx nc jx lz ma nq mc md me nr mg mh mi ns mk ml mm im bi translated"><em class="np">关于作者:高级分析专家和管理顾问，帮助公司通过对组织数据的业务、技术和数学的组合找到各种问题的解决方案。一个数据科学爱好者，在这里分享、学习、贡献；可以和我在</em> <a class="ae ky" href="https://www.linkedin.com/in/angel-das-9532bb12a/" rel="noopener ugc nofollow" target="_blank"> <em class="np">上联系</em> </a> <em class="np">和</em> <a class="ae ky" href="https://twitter.com/dasangel07_andy" rel="noopener ugc nofollow" target="_blank"> <em class="np">推特</em></a><em class="np">；</em></p></div></div>    
</body>
</html>