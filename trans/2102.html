<html>
<head>
<title>Looking for patterns in satellite image time series with python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用python在卫星影像时间序列中寻找模式</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/looking-for-patterns-in-satellite-image-time-series-with-python-de097f4065d7#2022-05-11">https://towardsdatascience.com/looking-for-patterns-in-satellite-image-time-series-with-python-de097f4065d7#2022-05-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c40c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用开放python库处理时变影像的快速指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/91e16610469f8d2b78b30aaec39e0716.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/1*Rz0ZaZ3erWZO-SiKk_1s4Q.gif"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="b287" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不久前，我在这里写了一篇文章，讲述了使用python进行遥感的一些基础知识。上次我们介绍了geopandas、rasterio和google earth engine的基础知识，以处理卫星图像和地理空间数据。</p><p id="2a14" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这一次，我们将扩展计算植被指数(NDVI)的概念，看看这些指数如何随时间变化，以及我们可以用它来做什么可视化。我们将以类似的方式开始，使用包含我们感兴趣的地块的矢量图层。</p><h1 id="8a31" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">首先是几块农村土地</h1><p id="119b" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">我们现在看到的是位于巴西最南端的卡皮瓦里多苏尔，一个以出口水稻闻名的城市。我们从巴西的CAR获得了一个包含所有地块的shapefile，这是一个国家环境和农业注册表，我们将依次通过geopandas读取它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mq"><img src="../Images/7fd32f2c11b81027f7d50ac71d08faf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yy2BuGMBT-imx_6Pn3Jyrg.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">中间的空白点是城市居民区。其他的基本都是稻作文化。(图片由作者提供)</p></figure><p id="ee27" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我们实际获取卫星图像之前，我们需要细化这个矢量数据集。其原因是，虽然这些地块仅反映了该市的农村景观，但每个农村地块实际上不仅仅有农作物:每个地块内都有保护区(由于环境立法的存在)和人们居住的房屋，因此我们不想计算这些的NDVI。</p><h1 id="36a7" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">从云中访问土地覆盖数据</h1><p id="9619" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">为了过滤掉所有不是农作物的东西，我们将使用令人惊奇的<a class="ae lq" href="https://mapbiomas.org/en" rel="noopener ugc nofollow" target="_blank">map biomass</a>项目。MapBiomas是一个基于谷歌地球引擎的项目，除其他外，该项目为整个巴西提供来自大地卫星图像的土地覆盖分类。这意味着我们可以只使用地球引擎的python API来访问文件！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mv"><img src="../Images/eb5a9aa9c85c496dbaa15621516937b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ctL7w7Kr1DABuhpJjZJCyw.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">Mapbiomas很神奇，说实话。(图片由作者提供)</p></figure><p id="1a7a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里棘手的部分是<a class="ae lq" href="https://mapbiomas.org/en/colecoes-mapbiomas-1" rel="noopener ugc nofollow" target="_blank">找到文档</a>并意识到MapBiomas项目在他们存储图像的方式上做了一些改动。每次项目团队修改土地覆盖分类算法，都会有一个新的集合可用(我们目前在集合6)。反过来，该系列只有<strong class="kw iu">一个</strong>单幅图像，有几个带，一个代表一年。因此，我们需要使用一个带通滤波器来获取2020年的图像(最新的可用图像)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mw"><img src="../Images/3299c599347c8cdcabc5a2ab6cfb3f95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VLCt2avd1tr-kzO0RAXWxg.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">值的范围从0到33，因为这是由MapBiomas指定的土地覆盖类的数量。(图片由作者提供)</p></figure><h1 id="ada5" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">使用rasterio从栅格到矢量</h1><p id="107b" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">一旦我们将图像导出到我们的本地环境中(代码片段见<a class="ae lq" rel="noopener" target="_blank" href="/automating-gis-and-remote-sensing-workflows-with-open-python-libraries-e71dd6b049ee">上一篇文章</a>，我们需要通过使用<a class="ae lq" href="https://rasterio.readthedocs.io/en/latest/topics/features.html" rel="noopener ugc nofollow" target="_blank"> rasterio特性</a>将它们转换成矢量，并隔离所有属于<strong class="kw iu">农业类别</strong> 的<a class="ae lq" href="https://mapbiomas-br-site.s3.amazonaws.com/downloads/Colecction%206/Cod_Class_legenda_Col6_MapBiomas_BR.pdf" rel="noopener ugc nofollow" target="_blank">类，如多年生作物和一年生作物。接下来，我们希望通过使用geopanda的叠加功能找到这些新获得的形状和地块之间的交点。</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mx"><img src="../Images/642643e3050ef24aabd1175754b3385d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PBMSSOCRioTCcmwYU7nLqA.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">结果是宗地的形状减去Mapbiomas未分类为农业的所有内容。(图片由作者提供)</p></figure><h1 id="4a25" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">访问多个时间戳的原始影像</h1><p id="e228" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">太好了。现在我们已经筛选出了仅用于农田的地块，我们可以开始实际的遥感工作了。我们将首先编写一个基于日历范围的元数据过滤影像的函数，该函数将用于Landsat 8集合。有趣的是，该功能可以用于任何其他传感器，例如Sentinel 2。该函数基本上按年过滤，然后按月过滤，最后计算每个时间戳中每个像素的中值。一旦我们获得了图像集合，我们就可以获取图像列表并将它们导出到我们的驱动器。这样我们可以在本地继续工作。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi my"><img src="../Images/e40bc2df0439c3645205a1d5fef3bbab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*5iVwDiJDLZLWufXRX6o3Jw.gif"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">我们刚刚下载的所有图像，一年中的每个月一张。(图片由作者提供)</p></figure><h1 id="4fda" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">栅格到数组，然后再返回</h1><p id="d035" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">手头有了所有的图像，我们终于可以计算植被指数，或NDVI。上一次我们使用Earth Engine这样做，这肯定更简单，但这里我们将使用rasterio和numpy。</p><p id="2797" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将使用一个使用rasterio的函数来隔离我们需要的波段——4个红光波段和5个NIR波段——然后将整个东西转换成一个numpy数组。归一化差值(NIR-Red/NIR+Red)的计算使用numpy内置函数执行，结果被写回到新的geoTiff中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="32a8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，该功能可以应用于地球引擎通过使用一个超级简单的循环将它们导出到的文件夹中的所有图像。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mz"><img src="../Images/fe46ea5e3150863f7476d19d59ed9efd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*5nxLF4whgfLBWIyAYXa14w.gif"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">所有生成的植被指数图像均以单波段伪彩色呈现。(图片由作者提供)</p></figure><h1 id="d577" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">全年的区域统计</h1><p id="4f29" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">太美了。接下来，我们将使用rasterstats非常类似于上次的<a class="ae lq" rel="noopener" target="_blank" href="/automating-gis-and-remote-sensing-workflows-with-open-python-libraries-e71dd6b049ee"/>-来计算每个宗地的区域统计数据。我们最感兴趣的是不同地块上植被指数的平均值，所以我们可以分别从统计角度来看它们。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi na"><img src="../Images/d4bf32286208c185812b6b8f9229f7d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Ne8k4BaIwuXs_1mH7UoUg.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">带有新列的数据框架。(图片由作者提供)</p></figure><p id="16ba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些新列现在可以像以前一样用于绘制地理数据框，但是色带范围为0到1。让我们更进一步，使用imageio将所有的图放在一个gif中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nb"><img src="../Images/2c913ec6e2a8848be482b63230f95983.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*cxb-ZO96jGtWLJiWbUgGLA.gif"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">有点像跳动的心脏，但这是米饭。(图片由作者提供)</p></figure><p id="abb4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些情节当然很有趣，但可能不是理解这些农田动态的最佳方式。因此，让我们利用将数据存储在数据框架中的优势，为每个月绘制一个箱线图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nc"><img src="../Images/76a5f445f3566888cf74d637ced465f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QnGJMtdlIGvLxaTlZwaJ_g.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">这讲述了一个更完整的故事。(图片由作者提供)</p></figure><p id="76d0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们可以更清楚地看到发生了什么。由于水稻作物每隔150天就可以收割一次，所以我们在一年中会看到两个“山谷”是有道理的，那时大部分生机勃勃的绿色植被都从地里移走，以便与谷物分离。</p><h1 id="c956" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">那是一个包裹</h1><p id="91dc" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">就是这个！我们设法从一堆包裹到一些非常整洁的时间图表。</p><p id="2e2c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里当然可以包括一些东西，但不是为了简单起见，比如遮蔽云层或选择多个传感器，但这是一个干净的版本。目前为止！</p><p id="2d38" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你有问题或建议，不要犹豫，随时给我写信。如果你喜欢这篇文章，考虑<a class="ae lq" href="https://www.buymeacoffee.com/guilhermeiablo" rel="noopener ugc nofollow" target="_blank">给我买杯咖啡</a>，这样我就能继续写更多这样的文章了！</p><p id="6ea6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> <em class="nd">如果你还不是一个媒介会员，想要支持像我这样的作家，可以通过我的推荐链接随意报名:</em> </strong></p><div class="ne nf gp gr ng nh"><a href="https://guilhermeiablonovski.medium.com/membership" rel="noopener follow" target="_blank"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd iu gy z fp nm fr fs nn fu fw is bi translated">通过我的推荐链接加入媒体——古伊列梅·m·亚布洛诺夫斯基</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">guilhermeiablonovski.medium.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv ko nh"/></div></div></a></div></div></div>    
</body>
</html>