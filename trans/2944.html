<html>
<head>
<title>Advanced Pipelines with scikit-learn</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用scikit的高级管道-了解</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/advanced-pipelines-with-scikit-learn-4204bb71019b#2022-06-28">https://towardsdatascience.com/advanced-pipelines-with-scikit-learn-4204bb71019b#2022-06-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3bff" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">整合来自imblearn的模块、管道中的功能引擎，并提取功能重要性图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9efbf07f946d5887e782633d589582e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AorPUPOerCsKI6_4"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://www.pexels.com/de-de/foto/metallrohre-mit-manometer-372796/" rel="noopener ugc nofollow" target="_blank"> Pexels </a>拍摄。</p></figure><p id="474e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您的机器学习项目中使用管道有助于为您的工作流带来更多的结构。它们使您的不同过程步骤更容易理解、重现，并防止数据泄漏。</p><p id="f1cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Scikit-learn pipeline与其变压器、模型和其他模块配合得非常好。<strong class="lb iu">然而</strong>，当一个人试图<strong class="lb iu">将</strong> scikit-learn的管道与<strong class="lb iu">来自imblearn等其他包</strong>的管道解决方案或模块进行合并或集成时(即使它是建立在scikit-learn之上的)，这可能(非常)具有挑战性。</p><p id="d219" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可能会出现这样的问题:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a99a" class="ma mb it lw b gy mc md l me mf"><strong class="lw iu">TypeError</strong>: All intermediate steps should be transformers and implement fit and transform or be the string ‘passthrough’ ‘SMOTE()’ (type &lt;class ‘imblearn.over_sampling._smote.base.SMOTE’&gt;) doesn’t</span></pre><p id="e5fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">即使完全坚持scikit-learn功能，从管道中提取最终使用的特性来创建<strong class="lb iu">特性重要性图</strong>也常常是具有挑战性的。</p><p id="c531" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文通过构建一个用于客户流失预测的集成或投票分类器的例子向您展示<strong class="lb iu">如何</strong> …</p><ul class=""><li id="1ac7" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated">从<strong class="lb iu"> scikit-learn </strong>、<strong class="lb iu"> imblearn </strong>和<strong class="lb iu"> feature-engine </strong>包中构建一个包含模块的管道<strong class="lb iu">。</strong></li><li id="b4ae" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated"><strong class="lb iu">在编码步骤之后，从你的管道中提取特征</strong>(例如，一键编码)。</li><li id="03c5" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">创建一个<strong class="lb iu">特征重要性</strong>图。</li></ul><blockquote class="mu mv mw"><p id="a42b" class="kz la mx lb b lc ld ju le lf lg jx lh my lj lk ll mz ln lo lp na lr ls lt lu im bi translated"><strong class="lb iu">重要提示</strong>:我建议安装最新版本的scikit-learn(在撰写本文时是1.1.1)以便能够从管道中提取特性。由于这个要求，代码将不能在Google Colab (1.0.2)上运行。</p></blockquote></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="3768" class="ni mb it bd nj nk nl nm nn no np nq nr jz ns ka nt kc nu kd nv kf nw kg nx ny bi translated">Outlook最终解决方案:在一个管道中组合来自不同包的几个模块</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/0067b2b5cc6217b6effc19836aa89e4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VEPfJWBWseFaLeNjaSOd6A@2x.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图一。最终管道(图片由作者提供)。</p></figure><p id="a2e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">图1显示了我们希望在本文末尾看到的内容。下面，我们将实现这些步骤中的每一个。从丢弃不相关的特征(步骤1)到应用估算器和缩放器(步骤2)和处理类别不平衡(步骤3)到我们的集成模型(步骤4)。在第5步中，我们应用超参数优化并创建一个特征重要性图。</p><blockquote class="mu mv mw"><p id="5e4c" class="kz la mx lb b lc ld ju le lf lg jx lh my lj lk ll mz ln lo lp na lr ls lt lu im bi translated">EDA、特征构建、最大化模型性能、分析和解释结果不在本文的范围之内。目标是向您展示<strong class="lb iu">如何使用集成了来自不同包的模块的管道</strong>。</p></blockquote><h1 id="61e5" class="ni mb it bd nj nk oa nm nn no ob nq nr jz oc ka nt kc od kd nv kf oe kg nx ny bi translated">步骤0:准备和数据加载</h1><p id="6a3f" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">在设置我们的管道之前，我们必须加载我们需要的包和示例数据。</p><p id="eb51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码向您展示了本文中所需的包和模块。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="2712" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码导入了常见的嫌疑人(熊猫、numpy等。)，提到的软件包scikit-learn(或sklearn)，imblearn和feature-engine。它还导入了xgboost，这是我们的集成分类器的一部分，以及用于超参数调整的scipy包中的loguniform模块。</p><blockquote class="mu mv mw"><p id="26e6" class="kz la mx lb b lc ld ju le lf lg jx lh my lj lk ll mz ln lo lp na lr ls lt lu im bi translated">如果你以前没有听说过imblearn和特性引擎包，这里有一个简短的解释。<a class="ae ky" href="https://imbalanced-learn.org/stable/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> Imblearn </strong> </a>通过提供不同的采样策略，帮助你处理<strong class="lb iu">类不平衡</strong>。<a class="ae ky" href="https://feature-engine.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">特征引擎</strong> </a>提供模块<strong class="lb iu">管理数据集中的列或特征</strong>(例如，删除不相关的)。</p></blockquote><h2 id="6619" class="ma mb it bd nj om on dn nn oo op dp nr li oq or nt lm os ot nv lq ou ov nx ow bi translated">数据集:报纸流失</h2><p id="84c1" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">所使用的数据集来自以前的<a class="ae ky" href="https://www.kaggle.com/datasets/andieminogue/newspaper-churn" rel="noopener ugc nofollow" target="_blank"> Kaggle竞赛</a>并获得<em class="mx"> CC0:公共领域</em>许可。它包含15.855条记录和19列，包括目标变量<em class="mx">订户</em>(是/否)。大多数特征都是典型的。</p><p id="db85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码加载数据并应用一些预备步骤，比如将所有列名转换成小写并将目标变量转换成布尔值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="4824" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在应用这些次要的预清理步骤后，数据应该如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/344341c665e5115fe789410fcc46bdc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x2UCxQiIsMrChVA0Q_8DGg@2x.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图二。摘录报纸资料(图片由作者提供)。</p></figure><h1 id="9820" class="ni mb it bd nj nk oa nm nn no ob nq nr jz oc ka nt kc od kd nv kf oe kg nx ny bi translated">步骤1:排除特征</h1><p id="959c" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">管道中的第一步是排除或删除对我们的预测没有帮助的列。例如，列<em class="mx"> subscriptionid，</em>每行有不同的值，这是有意义的，但是这个特性对我们的建模步骤没有好处。我们还可以排除重复的特征(例如，具有相同值的相同列两次或更多次)和包含常数值的特征。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="f13a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码创建了一个<a class="ae ky" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html" rel="noopener ugc nofollow" target="_blank">管道</a>对象(<code class="fe oy oz pa lw b">line 1</code>)，并添加了三个步骤(<code class="fe oy oz pa lw b">lines 3–5</code>)。步骤被定义为元组，第一个元素定义步骤的名称(例如，<em class="mx">‘drop _ columns’</em>)，第二个元素定义转换器(例如，<em class="mx"> DropFeatures() </em>)。</p><blockquote class="mu mv mw"><p id="6242" class="kz la mx lb b lc ld ju le lf lg jx lh my lj lk ll mz ln lo lp na lr ls lt lu im bi translated">这些都是非常简单的步骤，也可以应用到管道之外(例如，熊猫)。然而，本文的想法是在管道中集成尽可能多的功能。更多关于特性引擎包的信息可以在<a class="ae ky" href="https://feature-engine.readthedocs.io/en/latest/api_doc/index.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到<em class="it">📗</em>。</p><p id="67f5" class="kz la mx lb b lc ld ju le lf lg jx lh my lj lk ll mz ln lo lp na lr ls lt lu im bi translated">蓝色圆圈中的“步骤”(图1)和标题是指导您阅读本文的步骤。上面代码中的步骤是“真正的”管道步骤。</p></blockquote><h1 id="1ea9" class="ni mb it bd nj nk oa nm nn no ob nq nr jz oc ka nt kc od kd nv kf oe kg nx ny bi translated">步骤2:估算和转换值</h1><p id="6243" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">在我们删除了不相关的列之后，我们现在关注于处理缺失值和特性缩放。我们的数据集包含不同类型的列(<em class="mx"> integer </em>和<em class="mx"> categorial </em>)。这就是为什么我们必须定义两个独立的工作流。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="bd39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们添加了一个名为<em class="mx">清理</em>的新步骤，并创建了一个ColumnTransformer对象(<code class="fe oy oz pa lw b">line 8</code>)。在ColumnTransformer中，我们设置了两条新管道。一个用于处理数值(<code class="fe oy oz pa lw b">line 10</code>)，一个用于处理类别值(<code class="fe oy oz pa lw b">line 16</code>)。为了确保为每个步骤选择正确的列，我们使用了<em class="mx"> make_column_selector </em>方法(<code class="fe oy oz pa lw b">lines 13,19</code>)。</p><blockquote class="mu mv mw"><p id="0839" class="kz la mx lb b lc ld ju le lf lg jx lh my lj lk ll mz ln lo lp na lr ls lt lu im bi translated">我们通过使用dtype_include参数来选择相关的列。当然，我们也可以提供列名列表或regex语句。</p></blockquote><h1 id="f3e3" class="ni mb it bd nj nk oa nm nn no ob nq nr jz oc ka nt kc od kd nv kf oe kg nx ny bi translated">第三步:取样</h1><p id="8e26" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">流失或欺诈分类的一大挑战是处理类别不平衡。Imblearn提供了一系列可供您应用的采样方法。在这个例子中，我们将使用SMOTE采样方法(<code class="fe oy oz pa lw b">line 23</code>)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h2 id="f29b" class="ma mb it bd nj om on dn nn oo op dp nr li oq or nt lm os ot nv lq ou ov nx ow bi translated">从管线中提取变换和缩放的特征</h2><p id="9d1e" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">在第4步建立我们的集成分类器之前，我们要检查哪些特征通过了管道，它们看起来像什么。</p><p id="b719" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">图3显示了我们管道的当前状态。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/6b2abf6ab1f8961397d863769ac876b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*PdN7Bu96w1Jhm18cCJ2Qjw@2x.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3。步骤3后的管道(图片由作者提供)。</p></figure><p id="c92b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">pipeline对象提供了一个名为<em class="mx">get _ feature _ names _ out()</em>的方法。但是在使用它之前，我们必须在数据集上安装管道。由于步骤3 (SMOTE)只关注我们的y数据，我们可以忽略它，只关注步骤1–2。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="d73b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码(<code class="fe oy oz pa lw b">line 1</code>)提取了从<em class="mx"> DropFeatures </em> ( <code class="fe oy oz pa lw b">[0:</code>)到<em class="mx">cleaning:column transformer</em>(<code class="fe oy oz pa lw b">:4]</code>)步骤的流水线步骤，并拟合训练数据(<code class="fe oy oz pa lw b">line 2</code>)。管道拟合好后，我们可以调用<em class="mx">get _ feature _ names _ out()</em>方法。结果看起来像这样:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="84f8" class="ma mb it lw b gy mc md l me mf">0                    num__year_of_residence<br/>1                             num__zip_code<br/>2                       num__reward_program<br/>3        cat__hh_income_$  20,000 - $29,999<br/>4        cat__hh_income_$  30,000 - $39,999<br/>                        ...                <br/>12122               cat__source_channel_TMC<br/>12123            cat__source_channel_TeleIn<br/>12124           cat__source_channel_TeleOut<br/>12125               cat__source_channel_VRU<br/>12126          cat__source_channel_iSrvices<br/>Length: 12127, dtype: object</span></pre><p id="b219" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于一次热编码，产生了许多新功能(<em class="mx"> cat__XX_XX </em>)。命名约定向您显示该特征是数字特征还是类别特征(如<em class="mx"> cat__ </em>)、其名称(如<em class="mx"> source_channel_ </em>)以及相关值(<em class="mx"> TMC </em>)。</p><blockquote class="mu mv mw"><p id="2d1f" class="kz la mx lb b lc ld ju le lf lg jx lh my lj lk ll mz ln lo lp na lr ls lt lu im bi translated">为了<a class="ae ky" href="https://scikit-learn.org/stable/auto_examples/miscellaneous/plot_pipeline_display.html" rel="noopener ugc nofollow" target="_blank">像我一样显示您的管道</a>(例如，图3)，只需在调用您的管道对象(例如，<code class="fe oy oz pa lw b">ppl</code>)之前将<code class="fe oy oz pa lw b">set_config(display="diagram")</code>放在您的代码中。参见步骤0“准备和数据加载”代码行33。</p></blockquote><h1 id="1eb7" class="ni mb it bd nj nk oa nm nn no ob nq nr jz oc ka nt kc od kd nv kf oe kg nx ny bi translated">步骤4:构建集成分类器</h1><p id="52d8" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">现在是时候建立我们的集成或投票分类器。在本例中，我们想使用下面三个模型的<strong class="lb iu">均值预测</strong>(<code class="fe oy oz pa lw b">lines 2–6</code>)。这就是为什么我们将<em class="mx">投票参数</em>设置为<em class="mx">软</em> ( <code class="fe oy oz pa lw b">line 8</code>)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="db0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在定义集合模型之后，我们准备将它集成到我们的管道中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="0fe5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你已经注意到了，那么你已经看到了<code class="fe oy oz pa lw b">line 1</code>的变化。我们现在用的不是sklearn的<em class="mx"> Pipeline </em>对象，而是imblearn的<em class="mx">im Pipeline</em>。</p><p id="fd08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们不这样做，那么在拟合(<code class="fe oy oz pa lw b">ppl.fit(X_train, y_train)</code>)数据时，我们会得到以下错误:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="18f0" class="ma mb it lw b gy mc md l me mf"><strong class="lw iu">TypeError</strong>: All intermediate steps should be transformers and implement fit and transform or be the string 'passthrough' 'SMOTE()' (type &lt;class 'imblearn.over_sampling._smote.base.SMOTE'&gt;) doesn't</span></pre><p id="3181" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了！我们终于组装好了管道。结果可以在图4中看到。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/f3bfb4760c7a83dce22daf8966708b1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J8EfanIHsGdw4IvlXnxLqg@2x.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4。最终管道(图片由作者提供)。</p></figure><h1 id="7516" class="ni mb it bd nj nk oa nm nn no ob nq nr jz oc ka nt kc od kd nv kf oe kg nx ny bi translated">步骤5:超参数调整和特性重要性</h1><h2 id="af4c" class="ma mb it bd nj om on dn nn oo op dp nr li oq or nt lm os ot nv lq ou ov nx ow bi translated">超参数调谐</h2><p id="5cac" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">下面的代码显示了如何通过使用<em class="mx"> RandomizedSearchCV </em>来应用超参数调整。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="f43c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">定义的参数(<code class="fe oy oz pa lw b">lines 3-17</code>)遵循特定的命名惯例:</p><ul class=""><li id="dee5" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated">第一个参数(<em class="mx"> ensemble__ </em>):投票分类器的名称</li><li id="ad8c" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">第二个参数(<em class="mx"> lr__ </em>):我们集合中使用的模型的名称</li><li id="4d21" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">第三个参数(<em class="mx">解算器</em>):模型相关超参数的名称</li></ul><p id="a518" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们必须处理类不平衡，我们将在这个例子中使用重复分层k-fold ( <code class="fe oy oz pa lw b">line 20</code>)。更多关于其优势的信息可以在<a class="ae ky" href="https://machinelearningmastery.com/cross-validation-for-imbalanced-classification/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><blockquote class="mu mv mw"><p id="bc4c" class="kz la mx lb b lc ld ju le lf lg jx lh my lj lk ll mz ln lo lp na lr ls lt lu im bi translated">如果您<strong class="lb iu">不想使用超参数调整</strong>而想使用您自己的超参数值，您可以在模型初始化(步骤4)时设置它们，或者在之前添加一个新行<strong class="lb iu">用<code class="fe oy oz pa lw b"><em class="it">ppl.set_params(**dict_with_best_params)</em></code> <em class="it">拟合语句(<code class="fe oy oz pa lw b"><em class="it">ppl.fit()</em></code>)。</em></strong></p></blockquote><h2 id="eefa" class="ma mb it bd nj om on dn nn oo op dp nr li oq or nt lm os ot nv lq ou ov nx ow bi translated">特征重要性图</h2><p id="74d3" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">为了使用我们的管道创建一个特征重要性图，我们使用了<a class="ae ky" href="https://scikit-learn.org/stable/auto_examples/inspection/plot_permutation_importance.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">排列重要性</strong> </a>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="6064" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe oy oz pa lw b">Lines 3 to 13</code>显示一个函数，该函数稍后将绘制我们的特征重要性。<code class="fe oy oz pa lw b">lines 16 to 18</code>中的代码提取了我们管道中使用的特性名称(作为一个例子，我们在第3步结束时做了同样的事情)。在最后两行(<code class="fe oy oz pa lw b">lines 20 to 21</code>)中，我们在训练数据上使用拟合的模型/管道来计算排列重要性。</p><p id="7e44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看特征或排列重要性图(图5)，我们可以看到特征<em class="mx"> hh_income </em>主导了预测。由于该特性包含可排序的值(30–40k小于150–175k)，我们可以使用不同的编码方式(例如，使用LabelEncoding)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/f2c60ef62b951f379773312d30295cd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9u0EWccZWOE-5ycf5lxN3Q@2x.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图5。排列重要性图(图片由作者提供)。</p></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="61cf" class="ni mb it bd nj nk nl nm nn no np nq nr jz ns ka nt kc nu kd nv kf nw kg nx ny bi translated">结论</h1><p id="c1fc" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">使用管道可能会让人神经紧张。特别是如果你想提取特性，组合和使用不同包中的模块，并创建一个特性重要性图。本文通过一个带有不平衡类的分类问题的例子展示了如何创建一个高级管道并应用上面提到的所有步骤。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="abc4" class="ni mb it bd nj nk nl nm nn no np nq nr jz ns ka nt kc nu kd nv kf nw kg nx ny bi translated">来源</h1><p id="1fbc" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated"><strong class="lb iu">数据集</strong>:<a class="ae ky" href="https://www.kaggle.com/datasets/andieminogue/newspaper-churn" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/datasets/andieminogue/newspaper-churn</a>(<strong class="lb iu">CC0</strong>:公共领域)</p><p id="57f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">Scikit-learn</strong>:<a class="ae ky" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html" rel="noopener ugc nofollow" target="_blank">https://Scikit-learn . org/stable/modules/generated/sk learn . pipeline . pipeline . html</a></p><p id="43fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">不平衡学习</strong>:<a class="ae ky" href="https://imbalanced-learn.org/stable/references/generated/imblearn.pipeline.Pipeline.html" rel="noopener ugc nofollow" target="_blank">https://不平衡学习. org/stable/references/generated/imb learn . pipeline . pipeline . html</a></p><p id="3f11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">特征-引擎</strong>:【https://feature-engine.readthedocs.io/en/latest/ T2】</p><p id="2506" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">创建特征重要性图</strong>:<a class="ae ky" href="https://inria.github.io/scikit-learn-mooc/python_scripts/dev_features_importance.html" rel="noopener ugc nofollow" target="_blank">https://inria . github . io/scikit-learn-mooc/python _ scripts/dev _ features _ importance . html</a></p></div></div>    
</body>
</html>