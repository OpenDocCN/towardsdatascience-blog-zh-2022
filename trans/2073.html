<html>
<head>
<title>Why I Stopped Dumping DataFrames to a CSV and Why You Should Too</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么我停止向CSV转储数据帧，为什么您也应该这样做</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/why-i-stopped-dumping-dataframes-to-a-csv-and-why-you-should-too-c0954c410f8f#2022-05-10">https://towardsdatascience.com/why-i-stopped-dumping-dataframes-to-a-csv-and-why-you-should-too-c0954c410f8f#2022-05-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5d07" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">是时候告别pd.to_csv()和pd.read_csv()了</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5885f0faeb9c58d899178f4173b194ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UnRRF7CCQ91Uwk7t"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">米卡·鲍梅斯特在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="745f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">构建端到端的数据驱动管道极具挑战性，要求也很高。我自己也经历过，这个过程非常繁琐，最终可能不可避免地会有许多中间文件。虽然这些文件通常用作检查点或帮助管道中的其他模块，但如果没有为这些中间文件选择合适的格式，可能会不知不觉地损害运行时和提升存储要求，因为首选格式总是CSV。</p><p id="8722" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为一名数据科学家，我知道CSV在数据读取、写入、预览、探索等方面提供了巨大的灵活性。它是你、我和几乎所有使用数据框架的人的首选格式。我过去常常利用CSV格式导出数据帧<strong class="ky ir">，直到最近</strong>，我发现了一些节省时间和存储优化的CSV替代方案。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="2590" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">幸运的是，Pandas提供了多种文件格式来保存数据帧，例如:</p><ol class=""><li id="906b" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr me mf mg mh bi translated">战斗支援车</li><li id="6f4f" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">泡菜</li><li id="b5bd" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">镶木地板</li><li id="38ea" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">羽毛</li><li id="a101" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">JSON</li><li id="836d" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">HDF5</li></ol><p id="27fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这促使我根据上述形式在以下参数上的体验表现对其进行排名:</p><ol class=""><li id="d81d" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr me mf mg mh bi translated">它们在磁盘上占据的空间。</li><li id="fc5a" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">对磁盘进行读写操作所需的时间。</li></ol></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="1220" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">实验装置</h1><p id="0fa0" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">出于实验的目的，我用Python生成了一个包含一百万行三十列的随机数据集——包括字符串、浮点和整数数据类型。</p><p id="1fa9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将下面描述的每个实验重复了十次，以减少随机性，并从观察结果中得出公正的结论。下面的统计数据是十次实验的平均值。</p><h1 id="c95e" class="mn mo iq bd mp mq nk ms mt mu nl mw mx jw nm jx mz jz nn ka nb kc no kd nd ne bi translated">实验</h1><h2 id="acfc" class="np mo iq bd mp nq nr dn mt ns nt dp mx lf nu nv mz lj nw nx nb ln ny nz nd oa bi translated">实验1:保存后利用的磁盘空间</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/1e4827eb476401ca348a4646f411422f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*WKokvRUMHMLERoSg9uGhsA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">文件格式的内存利用率(图片由作者提供)</p></figure><ul class=""><li id="061f" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr oc mf mg mh bi translated">显然，如果你正在寻找一种内存优化的格式，HDF5应该<strong class="ky ir">而不是</strong>成为你的首选。这里，所利用的磁盘空间是上图中最佳格式的两倍多——JSON，它本身的大小接近其他四种格式的两倍。</li><li id="9b8e" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr oc mf mg mh bi translated">到目前为止，<em class="od"> Parquet、CSV、Feather和Pickle </em>似乎是存储我们的数据帧的合适选项，因为它们都为相同数量的数据阻塞了辅助存储的大致相同的部分。</li></ul><h2 id="7765" class="np mo iq bd mp nq nr dn mt ns nt dp mx lf nu nv mz lj nw nx nb ln ny nz nd oa bi translated">实验2:加载和保存花费的时间</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/a665f7c4b8f9af756aee8eace017b2bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eq8aSeERya4lOV4-lu7mXg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">以各自的格式加载和保存数据帧所花费的时间。(图片由作者提供)</p></figure><p id="23ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我们开始注意到使用CSV格式的缺点的地方。</p><ul class=""><li id="9139" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr oc mf mg mh bi translated">现在让我们单独考虑加载时间。读取一个CSV文件所用的时间几乎是这里最好的选择——pickle的三倍(T1)、三倍(T3)。此外，正如我们前面看到的，Pickle和CSV占用的空间相同，为什么要选择较慢的选项呢？</li><li id="a368" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr oc mf mg mh bi translated">关于节省时间，CSV是可供选择的最昂贵的选项——消耗接近羽毛的八倍。</li></ul><p id="bd40" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">显然，在将数据帧存储为特定格式时，加载时必然会再次使用相同的格式。换句话说，一旦您将数据帧存储为pickle，您就别无选择，只能将其作为pickle文件读取。因此，在上面的第三个条形图中，我们查看它们的总效率，即加载时间+保存时间。</p><ul class=""><li id="a465" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr oc mf mg mh bi translated">遗憾的是，CSV并不是我们的最佳选择。</li><li id="4171" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr oc mf mg mh bi translated">与Feather、Parquet和Pickle相比，CSV的平均速度<strong class="ky ir">是这些格式的2.5倍</strong>，这是非常高的。</li></ul><p id="583b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我看来，<em class="od"> Parquet </em>和<em class="od"> Feather </em>是我们在这篇文章中探讨的六种文件格式中最好的选择。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="9072" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">结束语</h1><p id="2270" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">我知道CSV很棒。我也爱他们，我是CSV的粉丝，原因数不胜数，比如:</p><ul class=""><li id="addc" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr oc mf mg mh bi translated">如果需要，CSV允许我只读取列的子集，从而节省RAM和读取时间。</li><li id="b82b" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr oc mf mg mh bi translated">CSV本质上是一个文本文件。因此，Pandas允许我查看top-n(比如5、10、15等。)CSV中存在的行。</li><li id="f75c" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr oc mf mg mh bi translated">Excel是我最喜欢的工具之一，我可以直接在Excel中打开一个CSV。</li></ul><p id="d731" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，CSV正在扼杀你的管道。事实上是的。仅仅因为到处都有CSV，您就要花费大量的时间进行读写操作。</p><p id="ec0a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除非您需要在非pythonic环境(如Excel)之外查看数据框架，否则根本不需要CSV。您应该更喜欢Parquet、Feather或Pickle，因为正如我们在上面观察到的，它们提供的读写操作比CSV快得多。</p><p id="9ab1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以下次当你准备执行<em class="od"> pd.to_csv() </em>的时候，想想你是否真的需要一个csv。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi of"><img src="../Images/fe555c896fbb5677de51eaed1871c0c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*m9pBZ-iFVP8WBZgODOuPEQ.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者使用memegenerator.net创建的图像</p></figure></div></div>    
</body>
</html>