<html>
<head>
<title>Improve Your Data Preprocessing with ColumnTransformer and Pipelines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用ColumnTransformer和管道改进数据预处理</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/improve-your-data-preprocessing-with-columntransformer-and-pipelines-b6ff7edd2f77#2022-06-07">https://towardsdatascience.com/improve-your-data-preprocessing-with-columntransformer-and-pipelines-b6ff7edd2f77#2022-06-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d9c7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Sklearn的ColumnTransformer创建高度定制和有组织的预处理管道</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/379f026035c8bbece5ee35610134fe88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fYO5pLGxEzXpaCOp"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">西蒙·卡杜拉在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="7ad5" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="7382" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">数据预处理可能是机器学习/数据科学管道中最耗时的步骤之一。</p><p id="f8e7" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在大多数现实场景中，可用的原始数据是无格式的、脏的，并且不适合机器学习模型/数据分析，需要几个步骤<strong class="lq ir">清理</strong>和<strong class="lq ir">特征工程</strong>。</p><p id="6f3a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在结构化数据(表)的上下文中，开发人员需要处理各种各样的问题，比如缺失值、非规范化数据、无格式字符串、重复行等。</p><p id="e06c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">他们还需要通过标准化数字特征、嵌入分类特征、创建更有意义的列以及许多其他步骤来提高ML模型性能或改进仪表板的质量，从而改进数据表示。</p><p id="fc07" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这种对数据帧实施特定规则的需求很容易导致产生错综复杂的代码，难以维护和更新，并且容易出错。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/48de252cd9a93024c4327efeb0d33437.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZgZIvASv-1O_If25jVJY1A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数据预处理。图片作者。弗里皮克的图标。</p></figure><p id="c232" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Sklearn的Pipelines with ColumnTransformer是一种以标准方式应用转换规则的简单方法，创建了一个更有组织和更干净的代码。</p><h1 id="ba60" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">了解列转换器</h1><blockquote class="mr ms mt"><p id="9ca3" class="lo lp mp lq b lr mk jr lt lu ml ju lw mu mm lz ma mv mn md me mw mo mh mi mj ij bi translated">如果您已经熟悉了来自<em class="iq"> sklearn </em>的ColumnTransformer模块，您可以跳过这一节。</p></blockquote><p id="43c4" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在处理表格数据时，通常要对不同的数据列执行几个清理步骤。</p><p id="2939" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">例如，数字特征“价格”可能需要用数据平均值替换空值的操作。正如你可能已经知道的，Sklearn提供了一个转换器来实现这个功能，即<strong class="lq ir">简单估算器</strong>。</p><p id="34ed" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">ColumnTransformer允许的是只在一组列中应用Sklearn的<strong class="lq ir">转换器</strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/cca6995994f6a9f9ef013b981b758efe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*9uNU-9vpdDO_s5ibzxOqiA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">了解ColumnTransformer。图片作者。弗里皮克的图标。</p></figure><p id="42d9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们看看这在代码中是如何工作的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="e0dc" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">ColumnTransformer对象接收一个元组列表，该列表由转换器名称(这是您的选择)、转换器本身以及要应用转换的列组成。参数<em class="mp"> remainder </em>指定需要对所有其他列做什么。</p><p id="668b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下图显示了代码输出。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/b46a87e6dc1b22e035fbd58d7cd3427e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1E1cKzEVinfu0IkqfLCgHA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">DataFrame列转换(1)。图片作者。</p></figure><p id="d88f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">替换操作只发生在指定的列中，而其余的保持不变(由<em class="mp">余数</em> =“通过”指定)。熊猫数据帧也被Numpy数组取代，因为这是Sklearn变形金刚的默认行为。</p><p id="bd96" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们看一个更复杂的例子。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="ba2e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在上面的例子中,“Price”列的空值被替换为平均值,“A”列的空值被替换为中值，所有其他列的空值被替换为值-1。下图显示了结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/304ac33ae984c80b5aedf8448f0ecc79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WhoU2a3JhrU2P--Lgzgq1A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数据帧列转换(2)。图片作者。</p></figure><p id="3d24" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><em class="mp">提示</em>:如果你正在使用Jupyter笔记本，通过在Sklearn的配置中设置display =“diagram ”,可以非常容易地在<a class="ae kv" href="https://scikit-learn.org/stable/auto_examples/miscellaneous/plot_pipeline_display.html" rel="noopener ugc nofollow" target="_blank">交互图</a>中显示评估者。</p><p id="8ae2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面的代码进行了这种配置，图像显示了前一个示例的可视化效果。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/6e4450995589300615865e0ee8c94c01.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*PXk5NGqAmwaRBiITIG2XvQ.png"/></div></figure><p id="4bb6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">希望您已经理解了ColumnTransformer类的强大功能。这是一种对许多列执行转换的简单方法，所有的逻辑都封装在一个对象中。</p><h1 id="a9e8" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">对管道使用列转换器</h1><p id="5759" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">ColumnTransformer相当有用，但还不够。在许多情况下，一个列需要分多个步骤进行处理。</p><p id="b2b1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">例如，数字特征“价格”可能需要用数据平均值替换空值的操作、更对称地分布数据的对数变换以及使其值更接近区间[-1，1]的标准化。</p><p id="72f4" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">不幸的是，sklearn中没有转换器来完成所有这些工作，这就是<strong class="lq ir">管道</strong>的用武之地。</p><p id="e153" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">通过管道，我们可以将多个变压器连接起来，形成一个复杂的流程。因为管道对象相当于一个简单的转换器(例如，它有相同的<em class="mp">)。fit() </em>和<em class="mp">。transform() </em>方法)，它可以插入到ColumnTransformer对象中。</p><p id="72eb" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">您还可以将ColumnTransformer放在管道中，因为它也是一个简单的Transformer对象，并且这个循环可以根据您的需要继续下去。</p><p id="f7c0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这就是Sklearn架构的妙处之一:所有的变形金刚模块共享同一个<em class="mp">接口</em>，因此它们可以轻松地协同工作。</p><p id="a133" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们看看这在代码上是如何工作。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="ed3b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">管道对象有一个非常直观的界面。它接受一个元组列表，每个元组代表一个转换器，带有您选择的名称和转换器对象本身。它以指定的顺序应用转换。</p><p id="c376" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下图显示了之前创建的转换器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/f70c11ce85a3875d94db3adfd8614f49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*j-OpGCycEbwOzFcJCEC86w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">带管道的柱式变压器。图片作者。</p></figure><h1 id="e7e7" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">正在做一个例子</h1><p id="64be" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">让我们通过在Sklearn上为葡萄酒分类数据集[4]制作一个分类器管道，快速探索这种技术如何在“真实案例”中有所帮助。</p><p id="d710" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">该数据集包含13个关于葡萄酒化学性质的数字特征，分为3类。下面的代码导入数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">导入数据</p></figure><p id="86ed" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">绘制特征分布图，我们可以选择每个人需要的治疗方法。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/c1d0fe49575bdc2c3fbb01c0cccaa3c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y6SvHziSd-f1FjjmbJ7jjQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">特征分布。图片作者。</p></figure><p id="5903" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们假设选择了以下处理方法:</p><ul class=""><li id="3265" class="ne nf iq lq b lr mk lu ml lx ng mb nh mf ni mj nj nk nl nm bi translated"><strong class="lq ir">苹果酸</strong> : <em class="mp">最小-最大</em>结垢</li><li id="11b0" class="ne nf iq lq b lr nn lu no lx np mb nq mf nr mj nj nk nl nm bi translated"><strong class="lq ir">镁</strong> : <em class="mp">对数</em>变换，离散化4个仓中的值</li><li id="801d" class="ne nf iq lq b lr nn lu no lx np mb nq mf nr mj nj nk nl nm bi translated"><strong class="lq ir">灰</strong>:掉落特征</li><li id="06cf" class="ne nf iq lq b lr nn lu no lx np mb nq mf nr mj nj nk nl nm bi translated"><strong class="lq ir">非类黄酮_酚类</strong>:无</li><li id="7237" class="ne nf iq lq b lr nn lu no lx np mb nq mf nr mj nj nk nl nm bi translated"><strong class="lq ir">任何其他</strong>:标准定标器</li></ul><p id="ba53" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">之后，数据需要经过PCA降维，然后到达RandomForestClassifier。</p><p id="e5a7" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面的代码显示了如何构建这个管道。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="46e7" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">管道看起来像这样:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/394a8849b4eb8e83e1955c3470e4d925.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qtGpbtLKuICDic6KqgQvLg.png"/></div></div></figure><p id="9385" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">然后，我们可以将该对象用作普通分类器:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="517a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这个练习的主要目标是展示将所有这些复杂的逻辑封装到一个单一的对象(估计器)中是可能的。最终的对象与所有其他sklearn模块兼容，这可以使生活变得容易得多。</p><p id="9013" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">例如，可以执行网格搜索，从预处理步骤到分类器本身改变超参数。由于sklearn架构，创建新模块(转换器、分类器、回归器等)相当容易..)所以，如果你需要一个非常具体的任务，创建一个新的类并使之与管道兼容是非常容易的。estimator架构也很容易序列化，所以它可以以各种格式存储，比如JSON和XML。</p><p id="9c3b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">最后，代码是干净的和标准化的，这使得更新和维护更容易。</p><h1 id="df75" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">结论</h1><p id="c1bd" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">预处理数据是任何数据科学过程中至关重要的一步。然而，当每个数据集的特殊性出现时，预处理步骤可能变得非常复杂，并且充满了特定的领域规则。</p><p id="f3a1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在这种情况下，在单个对象中维护所有的转换可能非常有用，因为单个实例可以很容易地移动、存储和更新。</p><p id="fed3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这篇文章探讨了Sklearn column transformer类如何通过将所有预处理逻辑封装在一个地方，同时保持对象之间的高度标准化，来提高代码质量和组织。</p><p id="f662" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">尽管这篇文章专门探讨了ColumnTransformer类，但是逻辑可以扩展到其他sklearn模块，因为这篇文章的主要目标是展示如何生成更健壮的代码。Sklearn的架构非常有条理，了解更高级的能力可以让你的生活轻松很多。所以，我希望这篇短文能帮到你。</p><p id="dd67" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">感谢阅读！:)</p><h2 id="88ac" class="nt kx iq bd ky nu nv dn lc nw nx dp lg lx ny nz li mb oa ob lk mf oc od lm oe bi translated">参考</h2><p id="b2fd" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">[1] Scikit-Learn，<a class="ae kv" href="https://scikit-learn.org/stable/modules/generated/sklearn.compose.ColumnTransformer.html" rel="noopener ugc nofollow" target="_blank">关于ColumnTransformer </a> <br/>的官方文档【2】Scikit-Learn，<a class="ae kv" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html" rel="noopener ugc nofollow" target="_blank">关于管道</a>的官方文档<br/>【3】géRon，A. (2019)。使用Scikit-Learn、Keras和TensorFlow进行机器学习:构建智能系统的概念、工具和技术。奥莱利媒体公司。UCI:葡萄酒数据集。<a class="ae kv" href="https://creativecommons.org/licenses/by/4.0/legalcode" rel="noopener ugc nofollow" target="_blank">知识共享署名4.0国际</a> (CC BY 4.0)许可”</p></div></div>    
</body>
</html>