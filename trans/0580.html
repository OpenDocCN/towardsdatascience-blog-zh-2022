<html>
<head>
<title>Price Recommendation System Modeling Using PyCaret and Deep Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于PyCaret和深度学习的价格推荐系统建模</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/price-recommendation-system-modeling-using-pycaret-and-deep-learning-fd05f9f80900#2022-02-23">https://towardsdatascience.com/price-recommendation-system-modeling-using-pycaret-and-deep-learning-fd05f9f80900#2022-02-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="1530" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">实践教程</h2><div class=""/><div class=""><h2 id="8cc8" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">电子商务案例研究</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/d8f358989a2834eea59c0e1381745703.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0uO9xEKe5K9823nm"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">马库斯·温克勒在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="49bc" class="ln lo it lj b gy lp lq l lr ls"><strong class="lj jd">Table of Contents</strong></span><span id="b7ea" class="ln lo it lj b gy lt lq l lr ls">· <a class="ae lh" href="#9aa7" rel="noopener ugc nofollow">The Business Problem</a><br/>· <a class="ae lh" href="#8147" rel="noopener ugc nofollow">Baseline Model</a><br/>· <a class="ae lh" href="#a593" rel="noopener ugc nofollow">Exploratory Data Analysis</a><br/>· <a class="ae lh" href="#d1e3" rel="noopener ugc nofollow">Preprocessing</a><br/>· <a class="ae lh" href="#ffc1" rel="noopener ugc nofollow">Machine Learning</a><br/>· <a class="ae lh" href="#dbe3" rel="noopener ugc nofollow">Deep Learning</a><br/>· <a class="ae lh" href="#d5c3" rel="noopener ugc nofollow">Inference</a><br/>· <a class="ae lh" href="#fd1b" rel="noopener ugc nofollow">Conclusion</a></span></pre><h1 id="9aa7" class="lu lo it bd lv lw lx ly lz ma mb mc md ki me kj mf kl mg km mh ko mi kp mj mk bi translated">商业问题</h1><p id="38f2" class="pw-post-body-paragraph ml mm it mn b mo mp kd mq mr ms kg mt mu mv mw mx my mz na nb nc nd ne nf ng im bi translated">假设你刚开始在一家真正看重用户和合作伙伴体验的电商公司实习。有一天你发现你公司的app里卖的两件类似的衣服价格相差几百块钱。它们有相同的颜色，相同的用途，只是在商标和描述等细节上有所不同。</p><p id="07ca" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">有了这个观察，你的首要任务就是为卖家建立一个定价推荐系统，让他们知道自己的产品到底值多少钱，市场愿意出多少钱。这将缓解卖家和买家之间的交易，让卖家很容易适应成为利基参与者。</p><p id="0af3" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">我不知道这种情况是否合理，但让我们假装并继续:)</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="005c" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">您将获得可用的过去交易数据，如下所示。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl no"><img src="../Images/07d6d0f7dbdc18f922fdc0d75388b6c3.png" data-original-src="https://miro.medium.com/v2/format:webp/1*0E80pUAoLGrVSWR7lZUIqA.png"/></div></figure><p id="cba6" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">它由七个特征组成，包括产品的名称、品牌和类别，谁支付了运费(买方或卖方)，产品状况和描述，以及相应的美元价格。在建立模型时，前六个特征将是你的预测因素，价格将是你的目标。</p><p id="1b90" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">您将逐步构建您的模型，从最简单的开始，一步步增加复杂性:</p><ol class=""><li id="7102" class="np nq it mn b mo nh mr ni mu nr my ns nc nt ng nu nv nw nx bi translated">基线模型:从人类会做什么来推荐价格</li><li id="b50a" class="np nq it mn b mo ny mr nz mu oa my ob nc oc ng nu nv nw nx bi translated">机器学习:经典模型，由PyCaret简化</li><li id="1936" class="np nq it mn b mo ny mr nz mu oa my ob nc oc ng nu nv nw nx bi translated">深度学习:神经网络模型，利用张量流</li></ol><h1 id="8147" class="lu lo it bd lv lw lx ly lz ma mb mc md ki me kj mf kl mg km mh ko mi kp mj mk bi translated">基线模型</h1><p id="0f90" class="pw-post-body-paragraph ml mm it mn b mo mp kd mq mr ms kg mt mu mv mw mx my mz na nb nc nd ne nf ng im bi translated">在实际应用中，选择模型时需要考虑许多因素。除了性能，我们还应该考虑模型对推理的响应速度、重新训练的时间、计算成本、内存大小、可解释性等。</p><p id="2340" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">在性能方面，我们要做的第一件事是构建一个简单的基线来比较模型。由于这是一个回归问题，我们将考虑简单的性能指标，如MAE、RMSE和RMSLE。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="1745" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">首先，我们将12/1/1比例的数据分成训练、验证和测试三部分。我们暂时不会使用验证分割来学习超参数，因为我们没有这个基线模型的任何超参数。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="586c" class="ln lo it lj b gy lp lq l lr ls">Train shape: (1200000, 7)<br/>Validation shape: (100000, 7)<br/>Test shape: (100000, 7)</span></pre><p id="5d87" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">作为基线，我们应该考虑最简单但合理的模型。如果你的朋友问你，“这要多少钱？”，你可能会回答“什么是'<em class="od"> it </em>'？”。你的朋友问你一个更合适的问题是“一部电话多少钱？”，因此你回答“嗯，大约800美元”。</p><p id="f7a4" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">现在，这800美元从哪里来？一个合乎逻辑的答案将是从许多电话价格的中心的测量，也就是说，从他们的平均或中间值(当然，品牌应该被考虑)。因此，为了估算电话价格，我们将每部电话分组，取其价格的平均值或中值。从我们的数据来看，我们实际上有这种群体:按品牌和按类别分组。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="5f24" class="ln lo it lj b gy lp lq l lr ls">name                0<br/>brand          510245<br/>category         4884<br/>shipping            0<br/>condition           0<br/>description       657<br/>price               0<br/>dtype: int64</span></pre><p id="1867" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">因为从上面来看，<code class="fe oe of og lj b">brand</code>上有许多缺失值，我们将使用<code class="fe oe of og lj b">category</code>来代替。由于一些特定的手机品牌比其他品牌贵得多，因此最好使用中位数聚合。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="4804" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">可能会有一些产品的<code class="fe oe of og lj b">category</code>是在测试部分新推出的，而在列车测试部分没有出现过。在这种情况下，模型无法预测那些产品的价格。我们将通过简单地用所有价格的中位数来估算它们来处理这个问题。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="dc55" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">这是基线模型的性能分数。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl no"><img src="../Images/81af5646020f26692e9d97b2f7bb2e21.png" data-original-src="https://miro.medium.com/v2/format:webp/1*uTLiFG-pPDp2YA4TMs3Rqw.png"/></div></figure><h1 id="a593" class="lu lo it bd lv lw lx ly lz ma mb mc md ki me kj mf kl mg km mh ko mi kp mj mk bi translated">探索性数据分析</h1><p id="aab3" class="pw-post-body-paragraph ml mm it mn b mo mp kd mq mr ms kg mt mu mv mw mx my mz na nb nc nd ne nf ng im bi translated">EDA应该回答重要的问题，并使提取洞察力变得更容易。这里，我们特别感兴趣的是<code class="fe oe of og lj b">price</code>。观察列车分裂中<code class="fe oe of og lj b">price</code>的直方图，我们直接看到其分布遵循<a class="ae lh" href="https://en.wikipedia.org/wiki/Power_law" rel="noopener ugc nofollow" target="_blank"> <strong class="mn jd">幂定律</strong> </a>，其中一个量的相对变化作为另一个量的幂而变化。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/1c0edb312b6e18692891e2471ac0b768.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*AwurnJ70xapPTVFa-rhLwA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片作者<a class="ae lh" href="https://dwiuzila.medium.com/membership" rel="noopener">作者</a></p></figure><p id="b27a" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">如果目标变量遵循正态分布，线性模型族或神经网络中的一些模型通常表现更好。因此，我们可能需要对<code class="fe oe of og lj b">price</code>进行变换，其中一个叫做<a class="ae lh" href="https://en.wikipedia.org/wiki/Power_transform#Box%E2%80%93Cox_transformation" rel="noopener ugc nofollow" target="_blank"> box-cox变换</a>。请注意，基于树的模型不受此影响。</p><p id="f130" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">请参见下面的转型实践。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/265488b42af15c1492d60c3e85908b1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*CT-PhdgurBqyU__3OSlANQ.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片作者<a class="ae lh" href="https://dwiuzila.medium.com/membership" rel="noopener">作者</a></p></figure><p id="96ae" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">最终的分布不一定是正态的，但它肯定比转换前的分布更正态。</p><h1 id="d1e3" class="lu lo it bd lv lw lx ly lz ma mb mc md ki me kj mf kl mg km mh ko mi kp mj mk bi translated">预处理</h1><p id="ddcc" class="pw-post-body-paragraph ml mm it mn b mo mp kd mq mr ms kg mt mu mv mw mx my mz na nb nc nd ne nf ng im bi translated">在进行任何建模之前，我们需要对数据进行预处理。对于预处理步骤，我们执行如下简单任务:</p><ol class=""><li id="59d1" class="np nq it mn b mo nh mr ni mu nr my ns nc nt ng nu nv nw nx bi translated">用空字符串填充任何缺少的值，</li><li id="83af" class="np nq it mn b mo ny mr nz mu oa my ob nc oc ng nu nv nw nx bi translated">将间隔开的<code class="fe oe of og lj b">name</code>和<code class="fe oe of og lj b">brand</code>连接起来，替换<code class="fe oe of og lj b">name</code>，</li><li id="aa3c" class="np nq it mn b mo ny mr nz mu oa my ob nc oc ng nu nv nw nx bi translated">通过连接由空间分隔的<code class="fe oe of og lj b">description</code>、<code class="fe oe of og lj b">name</code>和<code class="fe oe of og lj b">category</code>来创建一个新特征<code class="fe oe of og lj b">text</code>，</li><li id="be07" class="np nq it mn b mo ny mr nz mu oa my ob nc oc ng nu nv nw nx bi translated">删除除<code class="fe oe of og lj b">name</code>、<code class="fe oe of og lj b">text</code>、<code class="fe oe of og lj b">shipping</code>、<code class="fe oe of og lj b">condition</code>和<code class="fe oe of og lj b">price</code>(针对目标)之外的所有功能。</li><li id="6f25" class="np nq it mn b mo ny mr nz mu oa my ob nc oc ng nu nv nw nx bi translated">从<code class="fe oe of og lj b">name</code>和<code class="fe oe of og lj b">text</code>生成TF-IDF特征，以及</li><li id="bb07" class="np nq it mn b mo ny mr nz mu oa my ob nc oc ng nu nv nw nx bi translated">用<code class="fe oe of og lj b">text</code>和<code class="fe oe of og lj b">shipping</code>组合TF-IDF的两个特性。</li></ol><p id="ec9d" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">下面是代码，它保存在工作目录中的一个单独的<code class="fe oe of og lj b">preprocess.py</code>文件中。这很重要，因为稍后我们会隐式使用<code class="fe oe of og lj b">pickle</code>，它需要在另一个模块/文件中定义自定义类，然后导入。否则，<a class="ae lh" href="https://stackoverflow.com/questions/45335524/custom-sklearn-pipeline-transformer-giving-pickle-picklingerror" rel="noopener ugc nofollow" target="_blank"> PicklingError将被引发</a>。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="0f28" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">如前所述，从<code class="fe oe of og lj b">preprocess.py</code>导入必要的功能。注意，我们还将<code class="fe oe of og lj b">gc</code>作为垃圾收集器导入，以便在对象不再使用时释放内存(因为我们的数据很大)。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="7913" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">现在，预处理数据。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl no"><img src="../Images/ae3ccc3030d4bdce14b245f92ddbec59.png" data-original-src="https://miro.medium.com/v2/format:webp/1*tph6aZYq2pBNGiLiNcoTzQ.png"/></div></figure><h1 id="ffc1" class="lu lo it bd lv lw lx ly lz ma mb mc md ki me kj mf kl mg km mh ko mi kp mj mk bi translated">机器学习</h1><p id="7ecb" class="pw-post-body-paragraph ml mm it mn b mo mp kd mq mr ms kg mt mu mv mw mx my mz na nb nc nd ne nf ng im bi translated">作为一名实习生，假设你对机器学习算法的艺术和手艺了解不深。你需要一个低代码的机器学习库来帮助你完成大部分工作。</p><blockquote class="oj"><p id="0c76" class="ok ol it bd om on oo op oq or os ng dk translated">看哪，<a class="ae lh" href="https://pycaret.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> <strong class="ak"> PyCaret </strong> </a>。</p></blockquote><p id="9676" class="pw-post-body-paragraph ml mm it mn b mo ot kd mq mr ou kg mt mu ov mw mx my ow na nb nc ox ne nf ng im bi translated">我们在这一部分所做的事情受到了PyCaret <a class="ae lh" href="https://github.com/pycaret/pycaret/blob/master/tutorials/Regression%20Tutorial%20Level%20Intermediate%20-%20REG102.ipynb" rel="noopener ugc nofollow" target="_blank">教程</a>的启发。对Moez Ali和团队，我们感激不尽👏。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="d754" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">创建一个TF-IDF矢量器。现在，我们将使用<code class="fe oe of og lj b">max_features = 10000</code>，但以后会增加。我们用几个主题演讲建立了一个实验<code class="fe oe of og lj b">setup</code>:</p><ol class=""><li id="3aa8" class="np nq it mn b mo nh mr ni mu nr my ns nc nt ng nu nv nw nx bi translated">使用的数据仅占第一次原型设计所有观察值的0.1%，随机选择，</li><li id="e5c6" class="np nq it mn b mo ny mr nz mu oa my ob nc oc ng nu nv nw nx bi translated">对预测器不做进一步的预处理，</li><li id="14de" class="np nq it mn b mo ny mr nz mu oa my ob nc oc ng nu nv nw nx bi translated">根据EDA的建议，通过<code class="fe oe of og lj b">box-cox</code>变换对<code class="fe oe of og lj b">price</code>进行变换，并且</li><li id="e96f" class="np nq it mn b mo ny mr nz mu oa my ob nc oc ng nu nv nw nx bi translated">训练策略是简单地通过将训练拆分成训练和验证拆分。</li></ol><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl no"><img src="../Images/a4d9f36653a8c5ef9ccd8c79461a0a39.png" data-original-src="https://miro.medium.com/v2/format:webp/1*tbiDyK1S1BCjfJAoO470OA.png"/></div></figure><p id="4b46" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">通过调用<code class="fe oe of og lj b">models</code>函数，我们可以从PyCaret中看到可用的模型。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl no"><img src="../Images/8466d9c5a0442d426719b1e3e6093a72.png" data-original-src="https://miro.medium.com/v2/format:webp/1*DqB9o8p57F--A6t6CcC96w.png"/></div></figure><p id="64f6" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">接下来挑几款，对比一下。这里我们选择其中的八个。你可能想试试其他的。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl no"><img src="../Images/0ddc4f68a74bef855fa0d399cdde5f28.png" data-original-src="https://miro.medium.com/v2/format:webp/1*z_4EEwy1YWOnfYTwnWOyPQ.png"/></div></figure><p id="c5e0" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">有些模型比基线模型表现得更好，有些则更差。我们可以很容易地看到<code class="fe oe of og lj b">ridge</code>和<code class="fe oe of og lj b">huber</code>模型通过他们的指标表现得非常好，并且他们的训练时间是最快的。</p><p id="f0c7" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">删除一些无用的变量，释放一些内存。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="0e95" class="ln lo it lj b gy lp lq l lr ls">146</span></pre><p id="5c8a" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">现在，用<code class="fe oe of og lj b">max_features = 100000</code>创建另一个TF-IDF矢量器。新的实验<code class="fe oe of og lj b">setup</code>和以前一样，除了现在我们使用新的矢量器和数据中的所有观察。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl no"><img src="../Images/3d5a5879df723d342f636f77773baa17.png" data-original-src="https://miro.medium.com/v2/format:webp/1*VYtbiEl8VbfG6KqGXqSyHA.png"/></div></figure><p id="857f" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">通过这个新的设置，我们训练了两个表现最好的模型，<code class="fe oe of og lj b">ridge</code>和<code class="fe oe of og lj b">huber</code>。我们可以看到性能有所提高。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl no"><img src="../Images/0bfdcae75a3f6f26ead262e50e0b22f9.png" data-original-src="https://miro.medium.com/v2/format:webp/1*lEuqkb6VihPSqhB8h_lSdw.png"/></div></figure><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl no"><img src="../Images/5738cf71b6238a5a82d6ab66b55db18e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*4bvFt1XSt3p1scgRpFipLg.png"/></div></figure><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl no"><img src="../Images/3e8d26f82539d54a17d20a2b9f2900bb.png" data-original-src="https://miro.medium.com/v2/format:webp/1*UtaeSqCZgSbIZyuj6d5KdQ.png"/></div></figure><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl no"><img src="../Images/53864d8107ff6c34ad1cc756f195aa57.png" data-original-src="https://miro.medium.com/v2/format:webp/1*DcJbqSjepdttmlynnEESOg.png"/></div></figure><p id="e983" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">我们也可以将两种模式融合。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl no"><img src="../Images/43e30906ac63600b09ed3611090ae57f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*vaJLyL9EDVzSs67cs39_lQ.png"/></div></figure><p id="e6c3" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">混动款肯定比<code class="fe oe of og lj b">huber</code>好。此外，混合模型在所有指标上都比<code class="fe oe of og lj b">ridge</code>略差，但RMSE除外，它在该指标上明显胜出。我们将选择混合模式作为我们的冠军(目前)。</p><p id="1c59" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">PyCaret与MLflow集成在一起。您可以启动MLflow UI，通过在终端中运行下面的命令，在<a class="ae lh" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000/ </a>上查看当前实验的元数据。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="73ac" class="ln lo it lj b gy lp lq l lr ls">$ mlflow ui</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pa"><img src="../Images/c323139ae7a4e6b6658d6c9dca586cc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PBM0dtefED6G0tP1_cBx-A.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">MLflow UI，图片作者<a class="ae lh" href="https://dwiuzila.medium.com/membership" rel="noopener">作者</a></p></figure><p id="ddbd" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">让我们将结果和基线模型一起制成表格。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl no"><img src="../Images/b0059b3da5080d374495870d4a875f9c.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Mxz9EjeE250PVTdh_gs9kw.png"/></div></figure><p id="5918" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">PyCaret还有许多其他特性，比如模型调优和其他集成方法，我们在这里不做探讨。我们鼓励你自己去尝试。</p><h1 id="dbe3" class="lu lo it bd lv lw lx ly lz ma mb mc md ki me kj mf kl mg km mh ko mi kp mj mk bi translated">深度学习</h1><p id="6d15" class="pw-post-body-paragraph ml mm it mn b mo mp kd mq mr ms kg mt mu mv mw mx my mz na nb nc nd ne nf ng im bi translated">首先，让我们像以前一样矢量化训练和验证分割。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="a9e4" class="ln lo it lj b gy lp lq l lr ls">X_train: (1200000, 193754) of float32<br/>X_valid: (100000, 193754) of float32</span></pre><p id="9510" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">然后，使用之前拟合的box-cox变换对验证分割中的<code class="fe oe of og lj b">price</code>进行变换。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="5ccb" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">如上所述，我们将使用TensorFlow来帮助我们。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="93da" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">在深度学习建模中，你可以做的最简单的事情就是建立几层密集的神经网络。这里，我们建立了一个具有三个隐藏层的网络，这三个隐藏层被训练了两个时期。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="6ee5" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">让我们从<code class="fe oe of og lj b">X_train</code>和<code class="fe oe of og lj b">X_valid</code>对中训练两个模型。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="d985" class="ln lo it lj b gy lp lq l lr ls">Model 1<br/>586/586 [========] - 11s 19ms/step - loss: 0.3623 - val_loss: 0.3151<br/>293/293 [=========] - 8s 28ms/step - loss: 0.2163 - val_loss: 0.3077<br/><br/>Model 2<br/>586/586 [========] - 11s 19ms/step - loss: 0.3626 - val_loss: 0.3178<br/>293/293 [=========] - 8s 28ms/step - loss: 0.2171 - val_loss: 0.3078</span></pre><p id="1bcb" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">现在，通过将<code class="fe oe of og lj b">X_train</code>和<code class="fe oe of og lj b">X_valid</code>转换成布尔矩阵来尝试一些别的东西，也就是说，如果<code class="fe oe of og lj b">X_train</code>或<code class="fe oe of og lj b">X_valid</code>的元素不为零，那么它就变成1，如果元素为零，它就保持为0。用这些新矩阵训练两个模型。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="7e5f" class="ln lo it lj b gy lp lq l lr ls">Model 1<br/>586/586 [========] - 11s 19ms/step - loss: 0.3682 - val_loss: 0.3247<br/>293/293 [=========] - 8s 28ms/step - loss: 0.2103 - val_loss: 0.3151<br/><br/>Model 2<br/>586/586 [========] - 12s 20ms/step - loss: 0.3680 - val_loss: 0.3250<br/>293/293 [=========] - 8s 29ms/step - loss: 0.2101 - val_loss: 0.3162</span></pre><p id="9156" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">将所有四个模型收集到一个python列表中，并对所有四个验证拆分进行预测。明确地说，这四种模式是:</p><ol class=""><li id="3a0b" class="np nq it mn b mo nh mr ni mu nr my ns nc nt ng nu nv nw nx bi translated">具有TF-IDF数据的两个模型</li><li id="effb" class="np nq it mn b mo ny mr nz mu oa my ob nc oc ng nu nv nw nx bi translated">具有布尔数据的两个模型</li></ol><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="8fc7" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">我们建立一个<code class="fe oe of og lj b">score</code>函数来计算预测的质量。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="8755" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">对于一个模型，我们有以下分数。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="c022" class="ln lo it lj b gy lp lq l lr ls">{'MAE': 9.2815766537261,<br/> 'RMSE': 26.11544796731921,<br/> 'RMSLE': 0.4090026031074859}<!-- --> </span></pre><p id="806a" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">通过混合两个模型，我们得到以下分数。有明显的改善。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="2dcb" class="ln lo it lj b gy lp lq l lr ls">{'MAE': 9.052237654724122,<br/> 'RMSE': 25.90078324778221,<br/> 'RMSLE': 0.4006770676979191}<!-- --> </span></pre><p id="13db" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">最后，所有四个模型的混合给了我们最好的结果。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="13f5" class="ln lo it lj b gy lp lq l lr ls">{'MAE': 8.918359263105392,<br/> 'RMSE': 25.910815619338454,<br/> 'RMSLE': 0.39423109095498304}</span></pre><p id="8a32" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">将结果与基线和机器学习结果一起附加。我们直接看到深度学习模型是赢家。而且训练时间也快，不到80秒。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl no"><img src="../Images/3df997d07fddbe39b37e54830866c442.png" data-original-src="https://miro.medium.com/v2/format:webp/1*NNUs3XeqTuVNaA0EadVaDA.png"/></div></figure><p id="bb1a" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">当然，我们可以进一步调整该模型的超参数，甚至尝试其他神经网络架构。然而，这篇文章太长了，读不下去。但是我们鼓励你去尝试。</p><h1 id="d5c3" class="lu lo it bd lv lw lx ly lz ma mb mc md ki me kj mf kl mg km mh ko mi kp mj mk bi translated">推理</h1><p id="b8f1" class="pw-post-body-paragraph ml mm it mn b mo mp kd mq mr ms kg mt mu mv mw mx my mz na nb nc nd ne nf ng im bi translated">现在，我们将对测试分割进行预测，以确认我们的深度学习模型的最终性能。和以前一样，测试分割需要在进入模型之前进行预处理。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="0a90" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">正如所料，分数与验证分割的分数相似。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="da04" class="ln lo it lj b gy lp lq l lr ls">{'MAE': 8.916460799703598,<br/> 'RMSE': 27.392445134423518,<br/> 'RMSLE': 0.3933138510387536}</span></pre><p id="9e32" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">最后，我们保存模型以备将来使用。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="1f2f" class="ln lo it lj b gy lp lq l lr ls">INFO:tensorflow:Assets written to: model1\assets<br/>INFO:tensorflow:Assets written to: model2\assets<br/>INFO:tensorflow:Assets written to: model3\assets<br/>INFO:tensorflow:Assets written to: model4\assets</span></pre><h1 id="fd1b" class="lu lo it bd lv lw lx ly lz ma mb mc md ki me kj mf kl mg km mh ko mi kp mj mk bi translated">结论</h1><p id="7230" class="pw-post-body-paragraph ml mm it mn b mo mp kd mq mr ms kg mt mu mv mw mx my mz na nb nc nd ne nf ng im bi translated">我们已经为一个电子商务应用程序的案例研究建立了一个价格推荐系统模型。从基线模型开始，通过最少的数据预处理，我们已经取得了相当好的结果，如下所示。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl no"><img src="../Images/3df997d07fddbe39b37e54830866c442.png" data-original-src="https://miro.medium.com/v2/format:webp/1*NNUs3XeqTuVNaA0EadVaDA.png"/></div></figure><p id="269d" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">我们利用PyCaret和TensorFlow来构建模型。这些图书馆确实为我们做了艰苦的工作。</p></div><div class="ab cl pb pc hx pd" role="separator"><span class="pe bw bk pf pg ph"/><span class="pe bw bk pf pg ph"/><span class="pe bw bk pf pg"/></div><div class="im in io ip iq"><p id="ff87" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">👏<em class="od">谢谢！如果你喜欢这个故事，想支持我这个作家，可以考虑</em> <a class="ae lh" href="https://dwiuzila.medium.com/membership" rel="noopener"> <strong class="mn jd"> <em class="od">成为会员</em> </strong> </a> <em class="od">。每月只需5美元，你就可以无限制地阅读媒体上的所有报道。如果你注册使用我的链接，我会赚一小笔佣金。</em></p><p id="ba76" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">📧<em class="od">如果你是我推荐的Medium成员之一，请发送电子邮件至</em><a class="ae lh" href="mailto:geoclid.members@gmail.com" rel="noopener ugc nofollow" target="_blank"><strong class="mn jd"><em class="od">geo lid . members[at]Gmail . com</em></strong></a><em class="od">获取这个故事的完整python代码。</em></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><a href="https://dwiuzila.medium.com/membership"><div class="gh gi pi"><img src="../Images/48693ff2480b5ea5555942b625403cf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DXflX5Po45QBVlGc.png"/></div></a></figure><p id="79f1" class="pw-post-body-paragraph ml mm it mn b mo nh kd mq mr ni kg mt mu nj mw mx my nk na nb nc nl ne nf ng im bi translated">更喜欢R中的数据科学动手教程？好奇机器学习是如何工作的？看看这个:</p><div class="pj pk gp gr pl"><div role="button" tabindex="0" class="ab bv gv cb fp pm pn bn po lb ex"><div class="pp l"><div class="ab q"><div class="l di"><img alt="Albers Uzila" class="l de bw pq pr fe" src="../Images/b4f51438d99b29f789091dd239d7cfa6.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*WVCVz-tM5PW1TaWqnVXRLQ.jpeg"/><div class="fb bw l pq pr fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://dwiuzila.medium.com/?source=post_page-----fd05f9f80900--------------------------------" rel="noopener follow" target="_top">艾伯斯·乌兹拉</a></p></div></div><div class="pu pv gw l"><h2 class="bd jd ve np fp vf fr fs vg fu fw jc bi translated">R中的数据科学</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi vh au vi vj vk ro vl an eh ei vm vn vo el em eo de bk ep" href="https://dwiuzila.medium.com/list/data-science-in-r-0a8179814b50?source=post_page-----fd05f9f80900--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="vp l fo"><span class="bd b dl z dk">7 stories</span></div></div></div><div class="qh dh qi fp ab qj fo di"><div class="di pz bv qa qb"><div class="dh l"><img alt="" class="dh" src="../Images/e52e43bf7f22bfc0889cc794dcf734dd.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*10B3radiyQGAp-QA"/></div></div><div class="di pz bv qc qd qe"><div class="dh l"><img alt="" class="dh" src="../Images/945fa9100c2a00b46f8aca3d3975f288.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*o6A863Vdwq7ThlmW"/></div></div><div class="di bv qf qg qe"><div class="dh l"><img alt="" class="dh" src="../Images/3ca9e4b148297dbc4e7da0a180cf9c99.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*ekmX89TW6N8Bi8bL"/></div></div></div></div></div><div class="pj pk gp gr pl"><div role="button" tabindex="0" class="ab bv gv cb fp pm pn bn po lb ex"><div class="pp l"><div class="ab q"><div class="l di"><img alt="Albers Uzila" class="l de bw pq pr fe" src="../Images/b4f51438d99b29f789091dd239d7cfa6.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*WVCVz-tM5PW1TaWqnVXRLQ.jpeg"/><div class="fb bw l pq pr fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://dwiuzila.medium.com/?source=post_page-----fd05f9f80900--------------------------------" rel="noopener follow" target="_top">艾伯斯·乌兹拉</a></p></div></div><div class="pu pv gw l"><h2 class="bd jd ve np fp vf fr fs vg fu fw jc bi translated">从零开始的机器学习</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi vh au vi vj vk ro vl an eh ei vm vn vo el em eo de bk ep" href="https://dwiuzila.medium.com/list/machine-learning-from-scratch-b35db8650093?source=post_page-----fd05f9f80900--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="vp l fo"><span class="bd b dl z dk">8 stories</span></div></div></div><div class="qh dh qi fp ab qj fo di"><div class="di pz bv qa qb"><div class="dh l"><img alt="" class="dh" src="../Images/4b97f3062e4883b24589972b2dc45d7e.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*CWNoicci28F2TUQc-vKijw.png"/></div></div><div class="di pz bv qc qd qe"><div class="dh l"><img alt="" class="dh" src="../Images/b1f7021514ba57a443fe0db4b7001b26.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*wSRsSHYnIiGJFAqC"/></div></div><div class="di bv qf qg qe"><div class="dh l"><img alt="" class="dh" src="../Images/deb73e42c79667024a46c2c8902b81fa.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*HVEz7KwzO0tv1Q4d"/></div></div></div></div></div></div></div>    
</body>
</html>