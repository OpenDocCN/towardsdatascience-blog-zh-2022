<html>
<head>
<title>Extract PDF Text While Preserving Whitespaces Using Python and Pytesseract</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 和 Pytesseract 提取 PDF 文本，同时保留空白</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pdf-text-extraction-while-preserving-whitespaces-using-python-and-pytesseract-ec142743e805#2022-03-11">https://towardsdatascience.com/pdf-text-extraction-while-preserving-whitespaces-using-python-and-pytesseract-ec142743e805#2022-03-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a437" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 pdf2image 和 pytesseract 的 OCR PDF 和图像文件</h2></div><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/cc103bb382d956d098cf8019b2b5f968.png" data-original-src="https://miro.medium.com/v2/format:webp/0*-g3c3liUCxyU6KoI.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="a6e4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在数据科学项目中，PDF 数据可能很难处理。例如，您尝试从自然语言处理(NLP)项目的 PDF 中提取文本，您可能会遇到<strong class="kw iu">在单词</strong>之间缺少空格或者<strong class="kw iu">用随机空格分隔整个单词的情况。</strong> <em class="lq">如果单词之间没有正确的空格，你就无法开发任何有意义的自然语言处理模型。</em>在本文中，我将介绍一种在保留空白的同时从 PDF 中提取文本的替代方法:<strong class="kw iu"> pdf2image </strong>和<strong class="kw iu">pytesserac。</strong></p><p id="4710" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有许多软件包(如 PyPDF2、pdfPlumber、Textract)可以从 PDF 中提取文本。每一种都有自己的优点和缺点。一个包可能更擅长处理表格，另一个更擅长提取文本。但是没有放之四海而皆准的解决方案。</p><p id="04aa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下面的 PDF 文件为例，我们想从这一段中提取文本。这看起来很简单，但是如果不能正确指定单词之间的空格，这可能会很麻烦。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lr"><img src="../Images/e9ac50b2482504eb8758e7fe2b5f3075.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OynR6ztSL-2jIR9ywFKDcg.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">examle.pdf(作者图片)</p></figure><h2 id="3495" class="lw lx it bd ly lz ma dn mb mc md dp me ld mf mg mh lh mi mj mk ll ml mm mn mo bi translated">问题 1:缺少空白</h2><p id="213e" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">在下面的代码中，“PyPDF2”包用于提取 PDF。如您所见，空白没有保留。如果我们的机器学习模型需要理解文本的上下文，输出将是无用的。</p><pre class="ki kj kk kl gt mu mv mw mx aw my bi"><span id="66af" class="lw lx it mv b gy mz na l nb nc">import PyPDF2<br/>file = open('examle.pdf', 'rb')<br/>pdfReader = PyPDF2.PdfFileReader(file)<br/>ocr_text = pdfReader.getPage(0).extractText()</span></pre><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi nd"><img src="../Images/46e0b3eff4c415464c4f51cfb7a37f3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LMb7a9v8d62WgqMOfvFqFA.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><h2 id="ace1" class="lw lx it bd ly lz ma dn mb mc md dp me ld mf mg mh lh mi mj mk ll ml mm mn mo bi translated">问题 2:随机和无用的空白</h2><p id="3627" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">在下面的代码中，使用了“pdfplumber”包。如您所见，没有正确指定空白。并且整个单词的随机分离使得输出对于 NLP 项目毫无用处。</p><pre class="ki kj kk kl gt mu mv mw mx aw my bi"><span id="a979" class="lw lx it mv b gy mz na l nb nc">import pdfplumber<br/>file = pdfplumber.open('examle.pdf')<br/>ocr_text = file.pages[0].extract_text()</span></pre><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi ne"><img src="../Images/d19c8530cdffbc1eb73b1826de825de4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IkNNmul8640cgzfthjUqwA.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><h1 id="c28f" class="nf lx it bd ly ng nh ni mb nj nk nl me jz nm ka mh kc nn kd mk kf no kg mn np bi translated">使用<strong class="ak"> pdf2image </strong>和 Pytesseract 保留有意义的空白</h1><p id="6ab2" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">我们可以将 PDF 转换为图像，然后使用 OCR 引擎(例如，<a class="ae nq" href="https://en.wikipedia.org/wiki/Tesseract_(software)" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu"/></a>)从图像中提取文本，而不是依赖 PDF 结构来提取底层文本。</p><h2 id="79fd" class="lw lx it bd ly lz ma dn mb mc md dp me ld mf mg mh lh mi mj mk ll ml mm mn mo bi translated"><strong class="ak">所需库</strong></h2><ul class=""><li id="241a" class="nr ns it kw b kx mp la mq ld nt lh nu ll nv lp nw nx ny nz bi translated"><strong class="kw iu"> pdf2image </strong>:将 pdf 文件转换为图像</li><li id="99ca" class="nr ns it kw b kx oa la ob ld oc lh od ll oe lp nw nx ny nz bi translated"><strong class="kw iu">pytesserac</strong>:从图像中提取文本</li></ul><h2 id="239a" class="lw lx it bd ly lz ma dn mb mc md dp me ld mf mg mh lh mi mj mk ll ml mm mn mo bi translated">安装库</h2><pre class="ki kj kk kl gt mu mv mw mx aw my bi"><span id="1f16" class="lw lx it mv b gy mz na l nb nc">pip install <strong class="mv iu">pdf2image</strong><br/>pip install <strong class="mv iu">pytesseract</strong></span></pre><h2 id="fc4e" class="lw lx it bd ly lz ma dn mb mc md dp me ld mf mg mh lh mi mj mk ll ml mm mn mo bi translated">下载并安装附加软件</h2><p id="7ddd" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">我们需要额外的软件来使用这些库。</p><ul class=""><li id="6a33" class="nr ns it kw b kx ky la lb ld of lh og ll oh lp nw nx ny nz bi translated">对于<strong class="kw iu"> pdf2image，</strong>我们必须为 windows 用户下载<a class="ae nq" href="http://poppler for windows users. https://github.com/oschwartz10612/poppler-windows/releases/" rel="noopener ugc nofollow" target="_blank"> poppler </a>。</li><li id="0242" class="nr ns it kw b kx oa la ob ld oc lh od ll oe lp nw nx ny nz bi translated">对于<strong class="kw iu">宇宙魔方，</strong>我们将需要安装<a class="ae nq" href="https://tesseract-ocr.github.io/tessdoc/Downloads.html" rel="noopener ugc nofollow" target="_blank">宇宙魔方-OCR 引擎</a>。</li></ul><h2 id="9754" class="lw lx it bd ly lz ma dn mb mc md dp me ld mf mg mh lh mi mj mk ll ml mm mn mo bi translated">导入库</h2><pre class="ki kj kk kl gt mu mv mw mx aw my bi"><span id="6d09" class="lw lx it mv b gy mz na l nb nc">import pytesseract<br/>from pdf2image import convert_from_path</span></pre><h2 id="15b4" class="lw lx it bd ly lz ma dn mb mc md dp me ld mf mg mh lh mi mj mk ll ml mm mn mo bi translated"><strong class="ak">初始化 pytesseract 和 pdf2image </strong></h2><p id="88c9" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">下载并安装软件后，可以将它们的可执行路径添加到<strong class="kw iu">环境变量</strong>中。或者，您可以在程序中直接包含它们的路径。</p><pre class="ki kj kk kl gt mu mv mw mx aw my bi"><span id="5524" class="lw lx it mv b gy mz na l nb nc">poppler_path = '...\pdf2image_poppler\Release-22.01.0-0\poppler-22.01.0\Library\bin'<br/>pytesseract.pytesseract.tesseract_cmd = r'C:\Program Files\Tesseract-OCR\tesseract.exe'</span></pre><p id="9e41" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">实现很简单。“convert_from_path”用于将 PDF 转换为图像。“pytesseract.image_to_string”用于从图像中提取文本。正如您所看到的，在这个例子中，单词之间的空格被正确地指定。</p><pre class="ki kj kk kl gt mu mv mw mx aw my bi"><span id="7e53" class="lw lx it mv b gy mz na l nb nc"># convert PDF to image<br/>images = convert_from_path('examle.pdf', poppler_path=poppler_path)<br/># Extract text from image<br/>ocr_text = pytesseract.image_to_string(images[0])</span></pre><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi oi"><img src="../Images/121c4a82fae67f7dee319339d9a6f697.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1lQ0TVObHPEUOAQfbX6j7w.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><h2 id="3409" class="lw lx it bd ly lz ma dn mb mc md dp me ld mf mg mh lh mi mj mk ll ml mm mn mo bi translated">处理 PDF 中的多个页面</h2><p id="7c65" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">如果一个 PDF 中有多个页面，我们可以简单地使用一个循环函数来合并所有页面的文本。</p><pre class="ki kj kk kl gt mu mv mw mx aw my bi"><span id="2728" class="lw lx it mv b gy mz na l nb nc">images = convert_from_path('example.pdf', poppler_path=poppler_path)<br/>ocr_text = ''<br/>for i in range(len(images)):        <br/>    page_content = pytesseract.image_to_string(images[i])<br/>    page_content = '***PDF Page {}***\n'.format(i+1) + page_content<br/>    ocr_text = ocr_text + ' ' + page_content</span></pre><h2 id="f80e" class="lw lx it bd ly lz ma dn mb mc md dp me ld mf mg mh lh mi mj mk ll ml mm mn mo bi translated">不仅仅是 PDF，Pytesseract 也适用于图像文件</h2><p id="0120" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">使用<strong class="kw iu">pytesserac</strong>而不是其他包的另一个优点是<em class="lq">它可以直接从图像文件</em>中提取文本。</p><pre class="ki kj kk kl gt mu mv mw mx aw my bi"><span id="5db3" class="lw lx it mv b gy mz na l nb nc">pytesseract.image_to_string('example.tif')<br/>pytesseract.image_to_string('example.jpg')<br/>pytesseract.image_to_string('example.png')</span></pre><h2 id="7531" class="lw lx it bd ly lz ma dn mb mc md dp me ld mf mg mh lh mi mj mk ll ml mm mn mo bi translated">将图像转换为可搜索的 PDF</h2><p id="dbe3" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">如果您想将图像格式(如 tif、png、jpg)的扫描文件转换为可搜索的 PDF。过程很简单。</p><pre class="ki kj kk kl gt mu mv mw mx aw my bi"><span id="5d11" class="lw lx it mv b gy mz na l nb nc">PDF = pytesseract.<strong class="mv iu">image_to_pdf_or_hocr</strong>('Receipt.PNG', extension='pdf')<br/># export to searchable.pdf<br/>with open("searchable.pdf", "w+b") as f:<br/>    f.write(bytearray(PDF))</span></pre><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/cc103bb382d956d098cf8019b2b5f968.png" data-original-src="https://miro.medium.com/v2/format:webp/0*-g3c3liUCxyU6KoI.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><h2 id="a1bd" class="lw lx it bd ly lz ma dn mb mc md dp me ld mf mg mh lh mi mj mk ll ml mm mn mo bi translated">将同一文件夹中的多个图像转换为单个可搜索的 PDF</h2><p id="ef97" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">如果您想将同一文件夹中的大量<strong class="kw iu">图像转换为单个可搜索的 PDF 文件，您可以使用<strong class="kw iu"> os.walk </strong>为同一文件夹中的所有图像文件创建一个路径列表，然后使用上述相同的功能处理图像并导出为单个可搜索的 PDF 文件。</strong></p><pre class="ki kj kk kl gt mu mv mw mx aw my bi"><span id="f69a" class="lw lx it mv b gy mz na l nb nc">all_files = []<br/>for (path,dirs,files) in <strong class="mv iu">os.walk</strong>('images_folder'):<br/>    for file in files:<br/>        file = os.path.join(path, file)<br/>        all_files.append(file)pdf_writer = PyPDF2.PdfFileWriter()<br/>for file in all_files:<br/>    page = pytesseract.image_to_pdf_or_hocr(file, extension='pdf')<br/>    pdf = PyPDF2.PdfFileReader(io.BytesIO(page))<br/>    pdf_writer.addPage(pdf.getPage(0))<br/>    <br/>with open("searchable.pdf", "wb") as f:<br/>    pdf_writer.write(f)</span></pre><p id="67c3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你想继续探索 PDF 抓取，请查看我的其他文章:</p><ul class=""><li id="d7d2" class="nr ns it kw b kx ky la lb ld of lh og ll oh lp nw nx ny nz bi translated"><a class="ae nq" rel="noopener" target="_blank" href="/scrape-data-from-pdf-files-using-python-and-pdfquery-d033721c3b28"> <strong class="kw iu">使用 Python 和 PDFQuery 从 PDF 文件中抓取数据</strong> </a></li><li id="3a3a" class="nr ns it kw b kx oa la ob ld oc lh od ll oe lp nw nx ny nz bi translated"><a class="ae nq" rel="noopener" target="_blank" href="/scrape-data-from-pdf-files-using-python-fe2dc96b1e68"> <strong class="kw iu">使用 Python 和 tabula-py 从 PDF 文件中抓取数据</strong> </a></li><li id="c08b" class="nr ns it kw b kx oa la ob ld oc lh od ll oe lp nw nx ny nz bi translated"><a class="ae nq" href="https://python.plainenglish.io/convert-scanned-files-to-searchable-pdf-using-python-and-pytesseract-3ee31ee6f01f" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">如何使用 Python 和 Pytesseract 将扫描文件转换为可搜索的 PDF</strong></a></li><li id="97ec" class="nr ns it kw b kx oa la ob ld oc lh od ll oe lp nw nx ny nz bi translated"><a class="ae nq" rel="noopener" target="_blank" href="/pdf-text-extraction-while-preserving-whitespaces-using-python-and-pytesseract-ec142743e805"> <strong class="kw iu">使用 Python 和 Pytesseract </strong> </a>提取 PDF 文本，同时保留空白</li></ul><h1 id="bd69" class="nf lx it bd ly ng nh ni mb nj nk nl me jz nm ka mh kc nn kd mk kf no kg mn np bi translated">感谢您的阅读！！！</h1><p id="4110" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">如果你喜欢这篇文章，并且想<strong class="kw iu">请我喝杯咖啡，</strong>请<a class="ae nq" href="https://ko-fi.com/aaronzhu" rel="noopener ugc nofollow" target="_blank">点击这里</a>。</p><p id="3e59" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以注册一个<a class="ae nq" href="https://aaron-zhu.medium.com/membership" rel="noopener"> <strong class="kw iu">会员</strong> </a>来解锁我的文章的全部访问权限，并且可以无限制地访问介质上的所有内容。如果你想在我发表新文章时收到电子邮件通知，请订阅。</p></div></div>    
</body>
</html>