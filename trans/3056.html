<html>
<head>
<title>Getting hands-on with DBT — Data Build Tool</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">动手使用DBT —数据构建工具</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/getting-hands-on-with-dbt-data-build-tool-a157d4151bbc#2022-07-05">https://towardsdatascience.com/getting-hands-on-with-dbt-data-build-tool-a157d4151bbc#2022-07-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c662" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">与DBT一起运行您的第一个项目的分步指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/344ca23640cbc8bc71b3ddb0a54dfb52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x_0niDS61Sxqq6MV0fOaOg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Volodymyr Hryshchenko 在<a class="ae kv" href="https://unsplash.com/s/photos/build?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="1e25" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">DBT现在风靡一时！当我第一次<a class="ae kv" href="https://medium.com/fishtown-analytics/what-exactly-is-dbt-47ba57309068" rel="noopener">读到</a>关于它的时候，我想好吧，这是一个<em class="ls">配置驱动的ETL </em>，还有什么新的吗？</p><p id="b387" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">后来我读了更多，我就像嗯..多适配器支持这很好，我们不必再编写通用库并与他人共享。</p><p id="0972" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">阅读越来越多，我喜欢哇！这是一个与云捆绑在一起的完整平台，测试基本上使我们的生活更加轻松。</p><p id="5574" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">好了，赞够了！让我们用<code class="fe lt lu lv lw b">dbt</code>来运行我们的第一个项目</p><h1 id="fe75" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">安装指南</h1><h2 id="d008" class="mp ly iq bd lz mq mr dn md ms mt dp mh lf mu mv mj lj mw mx ml ln my mz mn na bi translated">步骤1:设置Postgres</h2><p id="6f91" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">DBT支持<a class="ae kv" href="https://docs.getdbt.com/docs/available-adapters" rel="noopener ugc nofollow" target="_blank">多适配器</a>如红移、雪花、BigQuery、Spark、Postgres等。因为这是我们的项目，让我们从简单的<code class="fe lt lu lv lw b">postgres</code>开始，但是如果你有任何其他列出的适配器的连接器，请随意对特定的适配器进行适当的修改。</p><p id="07b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">回到<code class="fe lt lu lv lw b">postgres</code>，如果你已经有了<code class="fe lt lu lv lw b">postgres</code>设置，你可以跳过这一步，否则你可以按照<a class="ae kv" href="https://www.codecademy.com/article/installing-and-using-postgresql-locally" rel="noopener ugc nofollow" target="_blank">这个</a>指南来设置。设置完成后，验证它是否已设置。</p><pre class="kg kh ki kj gt ng lw nh ni aw nj bi"><span id="9849" class="mp ly iq lw b gy nk nl l nm nn">~ % postgres -V<br/>postgres (PostgreSQL) 13.3</span></pre><h2 id="6121" class="mp ly iq bd lz mq mr dn md ms mt dp mh lf mu mv mj lj mw mx ml ln my mz mn na bi translated">步骤2:创建一个新的虚拟env并激活它</h2><p id="f752" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">DBT运行在一个python生态系统上，如果你没有本地的<code class="fe lt lu lv lw b">python</code>设置，先这样做(python设置指南<a class="ae kv" href="https://realpython.com/installing-python/" rel="noopener ugc nofollow" target="_blank"/>)！(<em class="ls">拜托，没有Python，真的？</em>)</p><p id="36b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为<code class="fe lt lu lv lw b">dbt</code>创建一个新的虚拟环境</p><pre class="kg kh ki kj gt ng lw nh ni aw nj bi"><span id="1e0d" class="mp ly iq lw b gy nk nl l nm nn">~ % virtualenv dbt</span><span id="9f14" class="mp ly iq lw b gy no nl l nm nn">~ % source dbt/bin/activate<br/>(dbt) ~ %</span></pre><h2 id="5a23" class="mp ly iq bd lz mq mr dn md ms mt dp mh lf mu mv mj lj mw mx ml ln my mz mn na bi translated">步骤3:设置Postgres dbt适配器</h2><p id="be8c" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">这将为使用<code class="fe lt lu lv lw b">postgres</code>作为适配器安装必要的包+为<code class="fe lt lu lv lw b">dbt</code>安装核心包。</p><pre class="kg kh ki kj gt ng lw nh ni aw nj bi"><span id="7e98" class="mp ly iq lw b gy nk nl l nm nn">pip install dbt-postgres</span></pre><p id="430e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将只安装<code class="fe lt lu lv lw b">dbt-core</code>和<code class="fe lt lu lv lw b">dbt-postgres</code>和<em class="ls"/>:</p><pre class="kg kh ki kj gt ng lw nh ni aw nj bi"><span id="26f9" class="mp ly iq lw b gy nk nl l nm nn">$ dbt --version<br/>installed version: 1.0.0<br/>   latest version: 1.0.0<br/>Up to date!<br/>Plugins:<br/>  - postgres: 1.0.0</span></pre><p id="616d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">出于某种原因，如果你没有使用<code class="fe lt lu lv lw b">postgres</code>作为适配器，例如为<code class="fe lt lu lv lw b">dbt-&lt;youradaptor&gt;</code>安装软件包，你想为spark安装<code class="fe lt lu lv lw b">dbt</code>适配器，你可以</p><pre class="kg kh ki kj gt ng lw nh ni aw nj bi"><span id="36a0" class="mp ly iq lw b gy nk nl l nm nn">pip install dbt-spark</span></pre><h1 id="585d" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">运行您的第一个项目</h1><h2 id="59c6" class="mp ly iq bd lz mq mr dn md ms mt dp mh lf mu mv mj lj mw mx ml ln my mz mn na bi translated">步骤1:初始化您的第一个dbt项目</h2><p id="104f" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">好了，所有东西都装好了。选择你最喜欢的文件夹并运行<code class="fe lt lu lv lw b">dbt init</code>，它会要求你输入项目名称，添加相同的项目并选择你的适配器。既然我们用的是<code class="fe lt lu lv lw b">postgres</code>，我们可以选择【1】</p><pre class="kg kh ki kj gt ng lw nh ni aw nj bi"><span id="0eb0" class="mp ly iq lw b gy nk nl l nm nn">(dbt) % dbt init<br/>16:43:39  Running with dbt=1.1.1<br/>Enter a name for your project (letters, digits, underscore): dbt_for_medium<br/>Which database would you like to use?<br/>[1] postgres<br/>[2] spark</span><span id="685e" class="mp ly iq lw b gy no nl l nm nn">Enter a number: 1<br/>16:43:46<br/>Your new dbt project "dbt_for_medium" was created!</span><span id="242b" class="mp ly iq lw b gy no nl l nm nn">Happy modeling!</span></pre><h2 id="5a9b" class="mp ly iq bd lz mq mr dn md ms mt dp mh lf mu mv mj lj mw mx ml ln my mz mn na bi translated">步骤2:为dbt配置概要文件</h2><p id="d80f" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">很好，看看这个！DBT维护环境的细节，如<code class="fe lt lu lv lw b">this</code>项目，<code class="fe lt lu lv lw b">this</code>环境与此相关。</p><p id="0179" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些配置文件需要在<code class="fe lt lu lv lw b">/Users/jyotidhiman/.dbt/profiles.yml</code>更新，请在此配置您的适配器详情:</p><pre class="kg kh ki kj gt ng lw nh ni aw nj bi"><span id="4e25" class="mp ly iq lw b gy nk nl l nm nn">dbt_for_medium:<br/>  outputs:</span><span id="df47" class="mp ly iq lw b gy no nl l nm nn">dev:<br/>      type: postgres<br/>      threads: 1<br/>      host: localhost<br/>      port: 5432<br/>      user: dbt<br/>      pass: dbtpass<br/>      dbname: postgres<br/>      schema: postgres<br/>    prod:<br/>      type: postgres<br/>      threads: 1<br/>      host: localhost<br/>      port: 5432<br/>      user: dbt<br/>      pass: dbtpass<br/>      dbname: postgres<br/>      schema: postgres</span><span id="f99c" class="mp ly iq lw b gy no nl l nm nn">target: dev</span></pre><h2 id="8662" class="mp ly iq bd lz mq mr dn md ms mt dp mh lf mu mv mj lj mw mx ml ln my mz mn na bi translated">步骤3:验证配置文件设置是否正确</h2><p id="60a5" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">配置文件配置完成后，转到您的<code class="fe lt lu lv lw b">dbt</code>文件夹并运行以下命令来验证设置是否已正确完成。如果出现任何适配器问题，此处会突出显示一个错误。</p><pre class="kg kh ki kj gt ng lw nh ni aw nj bi"><span id="e412" class="mp ly iq lw b gy nk nl l nm nn">(dbt) dbt_for_medium % dbt debug<br/>16:50:06  Running with dbt=1.1.1</span><span id="6378" class="mp ly iq lw b gy no nl l nm nn">All checks passed!</span></pre><h2 id="4522" class="mp ly iq bd lz mq mr dn md ms mt dp mh lf mu mv mj lj mw mx ml ln my mz mn na bi translated">第四步:运行你的DBT项目！！</h2><p id="6ef9" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">DBT init附带了一些虚拟模型和SQL，可用于验证和运行设置，可以使用以下命令调用它:</p><pre class="kg kh ki kj gt ng lw nh ni aw nj bi"><span id="e33b" class="mp ly iq lw b gy nk nl l nm nn">(dbt) dbt_for_medium % dbt run<br/>16:51:02  Completed successfully<br/>16:51:02<br/>16:51:02  Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2</span></pre><h2 id="5472" class="mp ly iq bd lz mq mr dn md ms mt dp mh lf mu mv mj lj mw mx ml ln my mz mn na bi translated">步骤5:验证Postgres中是否创建了数据</h2><p id="9d78" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">由于我们在仓库中使用了<code class="fe lt lu lv lw b">postgres</code>，虚拟模型(我们的转换)创建的数据可以在<code class="fe lt lu lv lw b">postgres</code>中得到验证。要了解它是如何创建的，请查看项目中的<code class="fe lt lu lv lw b">my_first_dbt_model.sql</code>。</p><pre class="kg kh ki kj gt ng lw nh ni aw nj bi"><span id="1b6b" class="mp ly iq lw b gy nk nl l nm nn">postgres=# select * from my_first_dbt_model;<br/> id<br/> — — <br/> 1<br/>(1 row)</span></pre><h2 id="2077" class="mp ly iq bd lz mq mr dn md ms mt dp mh lf mu mv mj lj mw mx ml ln my mz mn na bi translated">步骤5:运行测试</h2><p id="65a2" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">DBT提供了开箱即用的测试集成，并附带了一些可以使用命令<code class="fe lt lu lv lw b">dbt test</code>调用的虚拟测试</p><pre class="kg kh ki kj gt ng lw nh ni aw nj bi"><span id="bb1f" class="mp ly iq lw b gy nk nl l nm nn">(dbt) dbt_for_medium % dbt test<br/>16:52:00  Running with dbt=1.1.1<br/>16:52:00  Found 2 models, 4 tests, 0 snapshots, 0 analyses, 167 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics<br/>16:52:00<br/>16:52:00  Concurrency: 1 threads (target='dev')<br/>16:52:00  Finished running 4 tests in 0.16s.<br/>16:52:00<br/>16:52:00  Completed with 1 error and 0 warnings:<br/>16:52:00<br/>16:52:00  Failure in test not_null_my_first_dbt_model_id (models/example/schema.yml)<br/>16:52:00    Got 1 result, configured to fail if != 0<br/>16:52:00<br/>16:52:00    compiled SQL at target/compiled/dbt_for_medium/models/example/schema.yml/not_null_my_first_dbt_model_id.sql<br/>16:52:00</span></pre><p id="ac67" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在你看到一个测试失败了，这是DBT故意弄脏你的手。要修复测试，取消<code class="fe lt lu lv lw b">my_first_dbt_model.sql</code>中该行的注释</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/55241caca91fd88531dee6429b3898ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o5gMYd15i6A8kqLgOWrEXg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="d5be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">再次运行<code class="fe lt lu lv lw b">dbt run</code>和<code class="fe lt lu lv lw b">dbt test</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/38fe2be7565a10399f8ae5e72351736a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rj-RPwwV-fDZWDCQhmwkow.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="0af5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">嗯，就这样吧！！全部成功完成:)</p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><p id="b62b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您的基本DBT设置已经准备就绪，可以工作了！耶！！</p><p id="9fb5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您可以开始在它的基础上构建您的DBT项目了。关于DBT的更多细节，请查看这篇令人惊叹的<a class="ae kv" href="https://medium.com/fishtown-analytics/what-exactly-is-dbt-47ba57309068" rel="noopener">文章</a>。</p><p id="0bba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你在设置上遇到任何问题或者有任何疑问，请告诉我。</p><p id="d9be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">希望这有所帮助！<br/> JD</p></div></div>    
</body>
</html>