<html>
<head>
<title>Making a chat bot to search for eating places nearby</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">制作一个聊天机器人来搜索附近的餐馆</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/making-a-chat-bot-to-search-for-eating-places-nearby-64df233ce48a#2022-02-14">https://towardsdatascience.com/making-a-chat-bot-to-search-for-eating-places-nearby-64df233ce48a#2022-02-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/8dc38693b50acca78b0275e5eb43babd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RsqtlmsdNNzGs0R-"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">雅各布·卡普斯纳克在<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><div class=""/><div class=""><h2 id="5aa4" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">我们使用Rasa框架和FOURSQUARE Places API来制作一个搜索餐馆和咖啡馆的聊天机器人</h2></div><p id="1fc6" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">饿吗？想找家餐馆吗？在这个示例项目中，我们制作了一个简单的聊天机器人，可以帮助您做到这一点。</p><p id="7937" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将使用Rasa制作聊天机器人。它是一个用于制作基于任务的对话聊天机器人的开源框架。Rasa使用机器学习模型来理解用户输入，并保持对话。</p><p id="4802" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用FOURSQUARE Places API，我们可以在任何地点搜索感兴趣的地方。</p><p id="643a" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">结合这两者，我们得到了我们项目的聊天机器人。所以让我们开始吧。</p><h1 id="57d3" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">目录:</h1><ol class=""><li id="808f" class="mj mk jg kx b ky ml lb mm le mn li mo lm mp lq mq mr ms mt bi translated"><a class="ae jd" href="#8f1d" rel="noopener ugc nofollow"> <strong class="kx jh">入门</strong> </a></li><li id="87ac" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq mq mr ms mt bi translated"><a class="ae jd" href="#7a14" rel="noopener ugc nofollow"> <strong class="kx jh">获取四方位置API </strong> </a></li><li id="eb2a" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq mq mr ms mt bi translated"><a class="ae jd" href="#5626" rel="noopener ugc nofollow"> <strong class="kx jh">生成NLU训练数据</strong> </a></li><li id="10f5" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq mq mr ms mt bi translated"><a class="ae jd" href="#8266" rel="noopener ugc nofollow"> <strong class="kx jh">自定义动作</strong> </a></li><li id="6386" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq mq mr ms mt bi translated"><a class="ae jd" href="#c123" rel="noopener ugc nofollow"> <strong class="kx jh">域，规则和故事</strong> </a></li><li id="aebb" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq mq mr ms mt bi translated"><a class="ae jd" href="#b292" rel="noopener ugc nofollow"> <strong class="kx jh">聊天机器人-UI </strong> </a></li></ol><p id="30f6" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="mz">文章中用到的所有代码都可以在</em> <a class="ae jd" href="https://github.com/AhmedFahim-git/restaurant_bot" rel="noopener ugc nofollow" target="_blank"> <em class="mz"> GitHub资源库</em> </a> <em class="mz">中找到。</em></p><h1 id="8f1d" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">入门指南</h1><p id="1df9" class="pw-post-body-paragraph kv kw jg kx b ky ml kh la lb mm kk ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">首先，我们需要创建一个安装Rasa的虚拟环境。如果我们安装了Anaconda，我们可以使用下面列出的命令。我们应该确保使用Python版本3.7或3.8。这个命令列表还会安装一些我们需要的额外的库。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="471f" class="nm ls jg ni b gy nn no l np nq"># This command creates the virtual environment<br/>conda create --name env_name python=3.8</span><span id="ad15" class="nm ls jg ni b gy nr no l np nq"># This command activates the virtual environment<br/>conda activate env_name</span><span id="58c9" class="nm ls jg ni b gy nr no l np nq"># This command installs pip in the virtual environment<br/>conda install pip</span><span id="1ea6" class="nm ls jg ni b gy nr no l np nq"># And this command installs Rasa in the virtual environment<br/>pip install rasa</span><span id="0ca1" class="nm ls jg ni b gy nr no l np nq"># We also need to install some additional libraries for the project, which may be done using the command given below.</span><span id="53e5" class="nm ls jg ni b gy nr no l np nq">conda install pandas<br/>pip install python-dotenv<br/>pip install geopy<br/>pip install word2number</span></pre><p id="ce48" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们也可以在<a class="ae jd" href="https://rasa.com/docs/rasa/installation" rel="noopener ugc nofollow" target="_blank"> Rasa开源</a>上找到安装说明。</p><p id="82ee" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将在这个项目中使用的库是:</p><ul class=""><li id="fd2a" class="mj mk jg kx b ky kz lb lc le ns li nt lm nu lq nv mr ms mt bi translated"><a class="ae jd" href="https://docs.python-requests.org/en/latest/" rel="noopener ugc nofollow" target="_blank"> <strong class="kx jh">请求</strong> </a>:是一个处理HTTP请求的简单库。</li><li id="f871" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated"><a class="ae jd" href="https://geopy.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> <strong class="kx jh"> geopy </strong> </a>:这是一个简单的Python接口，用于许多地理编码web服务，如Google Maps、nomim、MapBox等。</li><li id="b39f" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated"><a class="ae jd" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="kx jh">熊猫</strong> </a>:它是一个数据操作库，特别针对表格数据</li><li id="7e97" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated"><a class="ae jd" href="https://pypi.org/project/word2number/" rel="noopener ugc nofollow" target="_blank"> <strong class="kx jh"> word2number </strong> </a>:用于将数字字如“五”或“五十五”转换成相应的数字。</li><li id="fddf" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated"><a class="ae jd" href="https://pypi.org/project/python-dotenv/" rel="noopener ugc nofollow" target="_blank"><strong class="kx jh">-python-dotenv</strong></a>:用于从项目根目录下的. env文件中读入环境变量。稍后当我们讨论FOURSQUARE API时会有更多的介绍。</li></ul><p id="14fc" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一切就绪后，我们现在准备初始化我们的Rasa项目。首先激活虚拟环境(我的命名为rasa)，然后制作一个空目录并移入其中，最后输入命令<code class="fe nw nx ny ni b">rasa init</code>。Rasa会在过程中要求一些提示；我们可以接受默认值。</p><figure class="nd ne nf ng gt is gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/d7047d5e4c91588cadbe2f74f522cfa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*0F8WhJQsO74HsUOhLxsrkw.gif"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">Rasa入门(图片由作者提供)</p></figure><p id="d2db" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这个阶段，我们应该有一个目录，其结构如下所示。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="923a" class="nm ls jg ni b gy nn no l np nq">.<br/>├── actions<br/>│   ├── actions.py<br/>│   ├── __init__.py<br/>│   └── __pycache__<br/>│       ├── actions.cpython-38.pyc<br/>│       └── __init__.cpython-38.pyc<br/>├── config.yml<br/>├── credentials.yml<br/>├── data<br/>│   ├── nlu.yml<br/>│   ├── rules.yml<br/>│   └── stories.yml<br/>├── domain.yml<br/>├── endpoints.yml<br/>├── models<br/>│   └── 20220210-173055-ambitious-agate.tar.gz<br/>└── tests<br/>    └── test_stories.yml</span><span id="9a57" class="nm ls jg ni b gy nr no l np nq">5 directories, 13 files</span></pre><p id="2024" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">重要的文件和目录有:</p><ul class=""><li id="9c6f" class="mj mk jg kx b ky kz lb lc le ns li nt lm nu lq nv mr ms mt bi translated"><strong class="kx jh">。/actions/ </strong>目录:该目录下的主要文件有:<br/> - <strong class="kx jh"> actions.py </strong>文件:Rasa允许聊天机器人运行自定义Python代码，称为自定义‘自定义动作’。这些在这个文件中定义。<br/> - <strong class="kx jh"> __init__。py </strong>文件:这个文件告诉Python把目录当作一个包</li><li id="b235" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated"><strong class="kx jh"> config.yml </strong>文件:这是配置文件；它定义了模型的各个部分、它们之间的关系以及它们的参数。</li><li id="998d" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated"><strong class="kx jh"> credentials.yml </strong>文件:包含了连接到slack、脸书等各种渠道的凭证。</li><li id="bacc" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated"><strong class="kx jh">。/data/ </strong>目录:包含训练数据的目录。有关培训数据格式的详细信息可在处找到<a class="ae jd" href="https://rasa.com/docs/rasa/training-data-format" rel="noopener ugc nofollow" target="_blank">。它包含三个文件:<br/> - <strong class="kx jh"> nlu.yml </strong>文件:它包含可能的用户输入的标记样本。<br/> - <strong class="kx jh"> stories.yml </strong>文件:这包含了机器人和用户之间的对话示例。<br/> - <strong class="kx jh"> rules.yml </strong>文件:它包含应该总是遵循相同路径的用户-机器人对话的小段。</a></li><li id="62f4" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated"><strong class="kx jh"> domain.yml </strong>文件:这个文件定义了bot的环境，它看到什么，它知道什么，以及用什么来响应。</li><li id="70dc" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated"><strong class="kx jh"> endpoints.yml </strong>文件:它定义了机器人可以用于各种内部任务的各种端点。</li><li id="502a" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated"><strong class="kx jh">。/models/ </strong>目录:包含训练好的模型。默认情况下，推理过程中使用最新的模型。</li><li id="e617" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated"><strong class="kx jh">。/tests/ </strong>目录:它包含test_stories.yml文件，该文件包含用于评估bot性能的示例用户-bot对话。</li></ul><p id="1d02" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于这个项目，我们将在数据文件夹的三个文件中添加训练数据。我们将在actions文件夹的actions.py文件中编写一些自定义操作。我们还需要修改domain.yml文件。</p><p id="eccb" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">完成基本的设置后，是时候设置下一个组件了，FOURSQUARE API。</p><h1 id="7a14" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">获取FOURSQUARE Places API</h1><p id="eee7" class="pw-post-body-paragraph kv kw jg kx b ky ml kh la lb mm kk ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">要使用任何一个FOURSQUARE APIs，首先我们需要在<a class="ae jd" href="https://foursquare.com/developers/signup" rel="noopener ugc nofollow" target="_blank"> FOURSQUARE </a>上创建一个开发者账户。然后我们创建一个<a class="ae jd" href="https://foursquare.com/developers/projects" rel="noopener ugc nofollow" target="_blank">新项目</a>并生成一个新的API密匙。我们可以在FOURSQUARE网站上找到这个过程。</p><div class="ip iq gp gr ir oa"><a href="https://developer.foursquare.com/docs/places-api-getting-started" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd jh gy z fp of fr fs og fu fw jf bi translated">开始</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">Foursquare Places API的新功能？别担心，我们会掩护你的。只需几个简单的步骤，您就可以开始…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">developer.foursquare.com</p></div></div></div></a></div><p id="a237" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们需要对API密钥保密，所以通常的做法是将其作为环境变量来检索。为此，我们创建一个名为'的文件。env '(是的，。env是项目根目录中的文件名，而不仅仅是扩展名。的内容。env文件将类似于如下所示。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="b0c1" class="nm ls jg ni b gy nn no l np nq">API_KEY=replace_this_with_your_api_key</span></pre><p id="de26" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">之后，我们可以使用python-dotenv库检索这个值，如下所示。确保包括。env在。gitignore文件。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="d88c" class="nm ls jg ni b gy nn no l np nq">from dotenv import dotenv_values</span><span id="6d98" class="nm ls jg ni b gy nr no l np nq">API_KEY = dotenv_values()["API_KEY"]</span></pre><p id="b8d2" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">FOURSQUARE有许多API，但我们将只在项目中使用Places API的搜索端点。我们可以在下面给出的页面中试用API。</p><div class="ip iq gp gr ir oa"><a href="https://developer.foursquare.com/reference/place-search" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd jh gy z fp of fr fs og fu fw jf bi translated">地点搜索</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">让https://api.foursquare.com/v3/places/search搜索的地方在FSQ的地方数据库使用位置和…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">developer.foursquare.com</p></div></div></div></a></div><p id="9d16" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">FOURSQUARE支持许多不同类别的名胜古迹。在我们的例子中，我们希望将搜索范围限制在餐馆和咖啡馆。为此，我们需要在categories参数中传递相关的类别ID。类别id及其相应类别名称的完整列表在<a class="ae jd" href="https://developer.foursquare.com/docs/categories" rel="noopener ugc nofollow" target="_blank">这里</a>给出。</p><h1 id="5626" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">生成NLU数据</h1><p id="ed2d" class="pw-post-body-paragraph kv kw jg kx b ky ml kh la lb mm kk ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated"><strong class="kx jh"> NLU </strong>代表<strong class="kx jh"> N </strong>自然<strong class="kx jh"> L </strong>语言<strong class="kx jh"> U </strong>理解，nlu.yml文件将包含用户输入的标签示例，模型将使用这些示例来理解用户输入。模型需要从用户输入中学习两件事:</p><ul class=""><li id="e4ad" class="mj mk jg kx b ky kz lb lc le ns li nt lm nu lq nv mr ms mt bi translated">用户所说的，叫做意图</li><li id="483d" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated">以及从用户输入中提取的信息，称为实体。</li></ul><p id="16a0" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">关于如何写训练数据的细节可以在<a class="ae jd" href="https://rasa.com/docs/rasa/training-data-format" rel="noopener ugc nofollow" target="_blank">这里</a>和<a class="ae jd" href="https://rasa.com/docs/rasa/nlu-training-data" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="d022" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我们的聊天机器人中，我们将在API调用中指定三个参数:ll(纬度、经度)、半径和类别。使用categories参数而不是query参数有三个好处:</p><ul class=""><li id="2cb8" class="mj mk jg kx b ky kz lb lc le ns li nt lm nu lq nv mr ms mt bi translated">从用户输入中提取查询字符串很麻烦</li><li id="129d" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated">确保结果与我们的用例相关</li><li id="0ece" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated">我们可以在我们这边执行数据验证，而不依赖于API</li></ul><p id="23eb" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了填充这三个参数，我们需要从用户输入中提取三个实体:</p><ul class=""><li id="591b" class="mj mk jg kx b ky kz lb lc le ns li nt lm nu lq nv mr ms mt bi translated">place_type:这将被映射到category参数。</li><li id="f186" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated">地址:这将被映射到ll参数。</li><li id="17a5" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated">半径:这将被映射到半径参数。</li></ul><p id="a3e8" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Rasa有一个叫做Forms的有用特性，可以从用户输入中提取所需的信息。关于如何使用表格的详细信息可以在<a class="ae jd" href="https://rasa.com/docs/rasa/forms/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="6756" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面是nlu.yml文件的一个示例。完整的数据可以在<a class="ae jd" href="https://github.com/AhmedFahim-git/restaurant_bot/blob/master/data/nlu.yml" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="1a37" class="nm ls jg ni b gy nn no l np nq">version: "3.0"<br/>nlu:</span><span id="bfc8" class="nm ls jg ni b gy nr no l np nq">- intent: greet<br/>  examples: |<br/>  - hey<br/>  - hello<br/>  - hi<br/>  - hello there</span><span id="81f7" class="nm ls jg ni b gy nr no l np nq">- intent: goodbye<br/>  examples: |<br/>  - bye<br/>  - goodbye<br/>  - have a nice day</span><span id="9197" class="nm ls jg ni b gy nr no l np nq">- intent: mood_great<br/>  examples: |<br/>  - perfect<br/>  - great<br/>  - amazing<br/>  - feeling like a king</span><span id="73d6" class="nm ls jg ni b gy nr no l np nq">- intent: mood_unhappy<br/>  examples: |<br/>  - my day was horrible<br/>  - I am sad<br/>  - I don't feel very well <br/>  - sad</span><span id="1343" class="nm ls jg ni b gy nr no l np nq">- intent: giving_place_type<br/>  examples: |<br/>  - I want to look for [restaurants](place_type)<br/>  - I would like to make a search for [restaurants](place_type)<br/>  - Look for [both restaurants and coffee houses](place_type)<br/>  - Search for them [both](place_type)</span><span id="e4f4" class="nm ls jg ni b gy nr no l np nq">- intent: giving_address<br/>  examples: |<br/>  - I live in [Scarborough](address), [Toronto](address), [ON](address), [Canada](address)<br/>  - [317 Dundas St W](address), [Toronto](address), [ON M5T 1G4](address), [Canada](address)<br/>  - [Dhaka](address), [Bangladesh](address)<br/>  - [London](address)</span><span id="2137" class="nm ls jg ni b gy nr no l np nq">- intent: giving_radius<br/>  examples: |<br/>  - [20](radius)<br/>  - [ninety one](radius)<br/>  - [fifty](radius) kilometers<br/>  - Search within [15](radius) km</span></pre><h1 id="8266" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">自定义操作</h1><p id="9587" class="pw-post-body-paragraph kv kw jg kx b ky ml kh la lb mm kk ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">定制操作是Rasa灵活性背后的主要动力。它们使机器人能够根据用户输入在对话期间运行定制的python代码。</p><p id="a308" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要使用自定义操作，我们需要做四件事:</p><ul class=""><li id="2916" class="mj mk jg kx b ky kz lb lc le ns li nt lm nu lq nv mr ms mt bi translated">在actions文件夹的actions.py文件中编写python代码。关于如何编写自定义函数的详细信息可以在<a class="ae jd" href="https://rasa.com/docs/action-server/" rel="noopener ugc nofollow" target="_blank"> Rasa操作服务器文档</a>中找到。</li><li id="df5d" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated">通过在domain.yml文件中列出自定义操作，让bot知道这些操作。</li><li id="def5" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated">取消对endpoints.yml文件中以下行的注释。</li></ul><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="bca8" class="nm ls jg ni b gy nn no l np nq">action_endpoint:</span><span id="8ce9" class="nm ls jg ni b gy nr no l np nq">  url: "http://localhost:5055/webhook"</span></pre><ul class=""><li id="a79b" class="mj mk jg kx b ky kz lb lc le ns li nt lm nu lq nv mr ms mt bi translated">最后，当我们想要使用定制动作时，我们需要在单独的终端中运行命令<code class="fe nw nx ny ni b">rasa run actions</code>。</li></ul><p id="e873" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将在以下任务中使用自定义操作:</p><ul class=""><li id="263a" class="mj mk jg kx b ky kz lb lc le ns li nt lm nu lq nv mr ms mt bi translated">地址验证:我们将用户的位置提取为一个地名列表，如['纽约'，'美国']。然后我们使用。join()字符串运算符来生成完整的地址字符串。然后，我们使用geopy Nominatim对地址进行地理编码，即将地址映射到一个准确的位置。如果地址无效，则不返回任何结果。如果返回一个结果，我们还存储纬度和经度值，以便传递给API调用。</li></ul><div class="ip iq gp gr ir oa"><a rel="noopener follow" target="_blank" href="/things-to-do-with-latitude-longitude-data-using-geopy-python-1d356ed1ae30"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd jh gy z fp of fr fs og fu fw jf bi translated">Geopy简介:在Python中使用纬度和经度数据</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">获取地址、邮政编码、距离等等…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">towardsdatascience.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo ix oa"/></div></div></a></div><ul class=""><li id="ca10" class="mj mk jg kx b ky kz lb lc le ns li nt lm nu lq nv mr ms mt bi translated">半径验证:半径应该是一个数字或一个可以转换成数字的单词，如“六”。我们使用word2number Python库来检查这种情况。</li><li id="9fcb" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated">发出API调用:我们使用Python请求库发出get请求。用于授权的API密钥在头中传递，而参数作为url的一部分传递。该调用返回一个json对象，我们解析该对象以获得所需的值。</li></ul><p id="ce1f" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这些功能可以在<a class="ae jd" href="https://github.com/AhmedFahim-git/restaurant_bot/blob/master/actions/actions.py" rel="noopener ugc nofollow" target="_blank"> Github </a>页面中找到。</p><h1 id="c123" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">领域、规则和故事</h1><p id="9449" class="pw-post-body-paragraph kv kw jg kx b ky ml kh la lb mm kk ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">domain.yml文件描述了聊天机器人的环境。它包含所有意图、实体、动作、响应、插槽以及表单的列表。可以在<a class="ae jd" href="https://rasa.com/docs/rasa/domain" rel="noopener ugc nofollow" target="_blank">这里</a>找到该文件中包含的内容和形式的详细信息。</p><p id="76cd" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">到目前为止，我们所做的一切都必须列在这个文件中，聊天机器人才能知道它们。而且，我们还需要做槽和bot响应。这个项目的domain.yml文件可以在<a class="ae jd" href="https://github.com/AhmedFahim-git/restaurant_bot/blob/master/domain.yml" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="7f13" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">rules.yml文件描述了应该总是以相同方式进行的简短对话。“激活表单”和“提交表单”是我们项目中的两个主要规则。关于编写规则的详细信息可以在这里找到<a class="ae jd" href="https://rasa.com/docs/rasa/rules" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="5d84" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">故事是用户与机器人互动的例子。它们帮助模型响应用户输入，即使是长时间的对话。关于如何为Rasa写故事的细节可以在<a class="ae jd" href="https://rasa.com/docs/rasa/stories" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="5c10" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们从命令行运行命令<code class="fe nw nx ny ni b">rasa train</code>。</p><h1 id="b292" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">聊天机器人用户界面</h1><p id="525b" class="pw-post-body-paragraph kv kw jg kx b ky ml kh la lb mm kk ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">测试聊天机器人最简单的方法是在一个终端使用命令<code class="fe nw nx ny ni b">rasa shell</code>，在另一个终端运行命令<code class="fe nw nx ny ni b">rasa run actions</code>。</p><figure class="nd ne nf ng gt is gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/20e3a439d1f57eb63f71524fac79facc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*3ZLs2F_AvgKzMcPfJkHFDQ.gif"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">从终端与聊天机器人互动(图片由作者提供)</p></figure><p id="0794" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是可行的，但是我们可以通过使用下面显示的聊天机器人UI来获得一个更好的界面。</p><div class="ip iq gp gr ir oa"><a href="https://elysian01.github.io/Rasa-Chatbot-UI/" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd jh gy z fp of fr fs og fu fw jf bi translated">聊天机器人UI</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">正在为您的rasa聊天机器人寻找具有迷人色彩和响应功能的用户界面设计吗？不要再看了！探索…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">elysian01.github.io</p></div></div><div class="oj l"><div class="op l ol om on oj oo ix oa"/></div></div></a></div><p id="7e83" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，我们下载文件，提取其内容，然后在web浏览器中打开index.html文件。关于如何修改聊天机器人设计的说明可以在<a class="ae jd" href="https://elysian01.github.io/Rasa-Chatbot-UI/" rel="noopener ugc nofollow" target="_blank">网站</a>上找到。</p><p id="2dde" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">将所有这些放在一起，在一个终端中我们运行下面的命令。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="2be6" class="nm ls jg ni b gy nn no l np nq">rasa run actions</span></pre><p id="1ae4" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后在另一个终端中，我们运行下面的命令:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="2c43" class="nm ls jg ni b gy nn no l np nq">rasa run --enable-api --cors='*'</span></pre><p id="c57d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，我们运行index.html文件。</p><figure class="nd ne nf ng gt is gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/7ec40eda8c7b2b862b6104b468092261.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*5Mo1iSjSzgWcQbhwkzqKGQ.gif"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">使用聊天机器人用户界面在浏览器中与聊天机器人互动(图片由作者提供)</p></figure></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><h1 id="a11f" class="lr ls jg bd lt lu ox lw lx ly oy ma mb km oz kn md kp pa kq mf ks pb kt mh mi bi translated">结论</h1><p id="516f" class="pw-post-body-paragraph kv kw jg kx b ky ml kh la lb mm kk ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">我们结束了。我们刚刚制作了一个聊天机器人，可以搜索附近的餐馆和咖啡馆。</p><p id="f209" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于进一步的工作，我们可以:</p><ul class=""><li id="bf89" class="mj mk jg kx b ky kz lb lc le ns li nt lm nu lq nv mr ms mt bi translated">我们可以添加另一个功能，可以帮助查找场馆的细节。</li><li id="bb79" class="mj mk jg kx b ky mu lb mv le mw li mx lm my lq nv mr ms mt bi translated">我们还可以尝试部署应用程序，并使其为生产做好准备。</li></ul><p id="0722" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">目前就这些。感谢您的阅读。</p><div class="ip iq gp gr ir oa"><a href="https://rasa.com/" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd jh gy z fp of fr fs og fu fw jf bi translated">开源对话式人工智能</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">网上研讨会系列观看重播⟶报告获取报告⟶研讨会参加研讨会⟶分析报告Gartner已…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">rasa.com</p></div></div><div class="oj l"><div class="pc l ol om on oj oo ix oa"/></div></div></a></div><div class="ip iq gp gr ir oa"><a href="https://developer.foursquare.com/" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd jh gy z fp of fr fs og fu fw jf bi translated">开发者</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">从超过100，000个可信来源获得全球POI数据和丰富的内容，并由数百万消费者推动…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">developer.foursquare.com</p></div></div><div class="oj l"><div class="pd l ol om on oj oo ix oa"/></div></div></a></div><div class="ip iq gp gr ir oa"><a href="https://github.com/AhmedFahim-git/simple_chatbot" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd jh gy z fp of fr fs og fu fw jf bi translated">GitHub-AhmedFahim-git/simple _ chatbot:这是为了练习chatbot部署</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">github.com</p></div></div><div class="oj l"><div class="pe l ol om on oj oo ix oa"/></div></div></a></div></div></div>    
</body>
</html>