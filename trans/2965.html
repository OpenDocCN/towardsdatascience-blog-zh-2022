<html>
<head>
<title>4 FAQ About Date-Time Manipulation with Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">4关于熊猫日期时间操作的常见问题</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/4-faq-about-date-time-manipulation-with-pandas-eecedcf111e3#2022-06-28">https://towardsdatascience.com/4-faq-about-date-time-manipulation-with-pandas-eecedcf111e3#2022-06-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b014" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">举例说明</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/46d9ff42235375bef44c3565c147f3d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OpAgyhPq1qG4aAfLavmTLA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="0f3b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">熊猫图书馆是非常有效的时间序列数据。事实上，它是由Wes McKinney创建的，用于处理基本上由时间序列数据组成的金融数据。</p><p id="b1bc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当处理时间序列数据时，大量的时间花费在日期和时间操作上。在本文中，我们将讨论这方面的4个常见问题。</p><p id="c3d8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可能遇到过这些问题。除了最后一个问题，它们都可以通过简单的操作来解决，最后一个问题有点棘手，需要多个步骤来解决。</p><p id="7e9e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们从创建一个示例数据帧开始。</p><pre class="kj kk kl km gt lu lv lw lx aw ly bi"><span id="73c2" class="lz ma it lv b gy mb mc l md me">df = pd.DataFrame({</span><span id="4acd" class="lz ma it lv b gy mf mc l md me">    "booking_id": [1001, 1002, 1003, 1004, 1005],<br/>    "property" : ["A", "A", "B", "B", "C"],<br/>    "created_at": ["2022-03-01", "2022-02-10", "2022-04-12",<br/>                   "2022-04-11", "2022-06-05"],<br/>    "checkin_date": ["2022-06-01", "2022-06-10", "2022-06-02",<br/>                     "2022-06-20", "2022-08-10"],<br/>    "checkout_date": ["2022-06-06", "2022-06-15", <br/>                      "2022-06-06","2022-06-28", "2022-08-16"],<br/>    "amount": [5400, 5600, 4800, 9000, 6500]</span><span id="81d7" class="lz ma it lv b gy mf mc l md me">})</span><span id="4e47" class="lz ma it lv b gy mf mc l md me"># change the data type <br/>date_cols = ["created_at","checkin_date","checkout_date"]<br/>df[date_cols] = df[date_cols].astype("datetime64[ns]")</span><span id="c581" class="lz ma it lv b gy mf mc l md me"># display the DataFrame<br/>df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mg"><img src="../Images/b69555d9394dfbd701b533810fb84fb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GRTZNoNaDSxXqoKCr9xxsg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure><p id="6dbf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了能够使用Pandas的日期操作功能，我们需要将日期放在适当的数据类型中。这就是我们将数据类型更改为“datetime64[ns]”的原因。</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h2 id="fad5" class="lz ma it bd mo mp mq dn mr ms mt dp mu lh mv mw mx ll my mz na lp nb nc nd ne bi translated">1.如何提取年月？</h2><p id="643f" class="pw-post-body-paragraph ky kz it la b lb nf ju ld le ng jx lg lh nh lj lk ll ni ln lo lp nj lr ls lt im bi translated">日期包含不同的信息，如年、星期、月等。使用dt访问器提供的方法，可以从日期中提取所有不同的信息。</p><p id="0774" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，我们可以使用month方法获得月份。其中一个不太明显的是年月组合。我们可以借助to_period方法提取这些信息。</p><pre class="kj kk kl km gt lu lv lw lx aw ly bi"><span id="1cb1" class="lz ma it lv b gy mb mc l md me"># create the year_month column<br/>df["year_month"] = df["created_at"].dt.to_period("M")</span><span id="d252" class="lz ma it lv b gy mf mc l md me"># display the DataFrame<br/>df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/4e5fbf6a750f5b5349af3a42528f3980.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kVlmuVRU50Mp-BzP_tvjug.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h2 id="1b10" class="lz ma it bd mo mp mq dn mr ms mt dp mu lh mv mw mx ll my mz na lp nb nc nd ne bi translated">2.如何给日期加上时间间隔？</h2><p id="f7cd" class="pw-post-body-paragraph ky kz it la b lb nf ju ld le ng jx lg lh nh lj lk ll ni ln lo lp nj lr ls lt im bi translated">给日期加上或减去时间间隔通常在日期操作中执行。我们可以使用“DateOffset”或“Timedelta”函数来执行这项任务。</p><p id="6f95" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们将id为1001的预订的退房日期增加1天。</p><pre class="kj kk kl km gt lu lv lw lx aw ly bi"><span id="39be" class="lz ma it lv b gy mb mc l md me">df.loc[df["booking_id"]==1001, "checkout_date"] = \<br/>df.loc[df["booking_id"]==1001, "checkout_date"] + \<br/>pd.DateOffset(days=1)</span><span id="7d8a" class="lz ma it lv b gy mf mc l md me"># check the result<br/>print(df.loc[df["booking_id"]==1001, "checkout_date"])</span><span id="c2f9" class="lz ma it lv b gy mf mc l md me"><strong class="lv iu"># output</strong><br/>0   2022-06-07<br/>Name: checkout_date, dtype: datetime64[ns]</span></pre></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h2 id="a090" class="lz ma it bd mo mp mq dn mr ms mt dp mu lh mv mw mx ll my mz na lp nb nc nd ne bi translated">3.如何求两个日期的天数差？</h2><p id="b751" class="pw-post-body-paragraph ky kz it la b lb nf ju ld le ng jx lg lh nh lj lk ll ni ln lo lp nj lr ls lt im bi translated">我们可以通过从两个日期中减去一个来找出两个日期之间的差异。但是，此操作的结果是一个Timedelta对象，如下所示:</p><pre class="kj kk kl km gt lu lv lw lx aw ly bi"><span id="915d" class="lz ma it lv b gy mb mc l md me">df["checkout_date"][0] - df["checkin_date"][0]</span><span id="814e" class="lz ma it lv b gy mf mc l md me"><strong class="lv iu"># output</strong><br/>Timedelta('6 days 00:00:00')</span></pre><p id="bed1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以使用days方法提取整数形式的天数。让我们创建一个列，显示入住日期和预订创建日期之间的天数。</p><pre class="kj kk kl km gt lu lv lw lx aw ly bi"><span id="ae73" class="lz ma it lv b gy mb mc l md me"># difference in days<br/>df["days_to_checkin"] = \<br/>(df["checkin_date"] - df["created_at"]).dt.days</span><span id="19fa" class="lz ma it lv b gy mf mc l md me"># display the DataFrame<br/>df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/da789253383a4a4f50bf227819a0ff61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8fdlTSPSdfPXlGaWiIIfZQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h2 id="73b5" class="lz ma it bd mo mp mq dn mr ms mt dp mu lh mv mw mx ll my mz na lp nb nc nd ne bi translated">4.如何扩展开始日期和结束日期之间的日期？</h2><p id="63f8" class="pw-post-body-paragraph ky kz it la b lb nf ju ld le ng jx lg lh nh lj lk ll ni ln lo lp nj lr ls lt im bi translated">假设我们需要一个日历来显示房产的预订天数。例如，数据框第一行中的预订告诉我们，房产A的预订时间是2022年6月1日至2022年6月7日。因此，酒店A的预订日期为2022年6月1日、2022年6月2日、2022年6月3日、2022年6月4日、2022年6月5日、2022年6月6日(假设退房时间为2022年6月7日上午10点)。</p><p id="9ba4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以通过查找入住日期和退房日期之间的日期来创建这样一个日历，然后基于这些日期展开数据框架。</p><p id="1ee6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我们创建一个包含property、checkin_date和checkout_date列的日历数据帧。</p><pre class="kj kk kl km gt lu lv lw lx aw ly bi"><span id="a71d" class="lz ma it lv b gy mb mc l md me"># create a calendar DataFrame<br/>calendar = df[["property","checkin_date","checkout_date"]]</span></pre><p id="d93d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">date_range函数给出了开始日期和结束日期之间的日期。这是第一次预订时的样子:</p><pre class="kj kk kl km gt lu lv lw lx aw ly bi"><span id="67ca" class="lz ma it lv b gy mb mc l md me">pd.date_range(calendar["checkin_date"][0], calendar["checkout_date"][0])</span><span id="d06a" class="lz ma it lv b gy mf mc l md me"><strong class="lv iu"># output</strong><br/>DatetimeIndex(['2022-06-01', '2022-06-02', '2022-06-03', <br/>               '2022-06-04', '2022-06-05', '2022-06-06', <br/>               '2022-06-07'],<br/>              dtype='datetime64[ns]', freq='D')</span></pre><p id="c5bd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里的问题是，我们不希望退房日期显示为已预订。因此，我们将从退房日期中减去1天，然后找出两者之间的日期。</p><p id="94d9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了对所有的行执行这个操作，我们需要使用apply函数。我们还将使用list构造函数将date_range函数的输出转换为一个列表。</p><pre class="kj kk kl km gt lu lv lw lx aw ly bi"><span id="5376" class="lz ma it lv b gy mb mc l md me"># create the booked_days column<br/>calendar.loc[:, "booked_days"] = calendar.apply(<br/>    <br/>    lambda x: list(<br/>        pd.date_range(<br/>            x.checkin_date, <br/>            x.checkout_date + pd.DateOffset(days=1)<br/>        ).date<br/>    ),<br/>    axis = 1<br/>    <br/>)</span><span id="01d6" class="lz ma it lv b gy mf mc l md me"># display the DataFrame<br/>calendar</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/1d72e1bbbe4a67ec973bf6ceef034893.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BP1ZLzSjZOdSoKs_4l6Yog.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">日历(图片由作者提供)</p></figure><p id="4bcf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下一步是根据booked_days列中的日期展开数据框架。explode函数就是做这个操作的。</p><pre class="kj kk kl km gt lu lv lw lx aw ly bi"><span id="acfa" class="lz ma it lv b gy mb mc l md me"># explode <br/>calendar = calendar.explode(<br/>    column="booked_days", ignore_index=True<br/>)[["property","booked_days"]]</span><span id="733d" class="lz ma it lv b gy mf mc l md me"># display the first 5 rows<br/>calendar.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/a45c1f474d0de30034d7ff885cb471a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Urls5nbL6TpbfhDbREyDg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">日历(图片由作者提供)</p></figure><p id="77a9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们现在有一个已预订天数的日历。</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><p id="bc4a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们已经解决了您在处理时间序列数据时可能会遇到的4个问题。最后一个不像前三个那样常见，但我想把它包括进来，因为解决起来有点棘手。</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><p id="ec37" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="no">你可以成为</em> <a class="ae np" href="https://sonery.medium.com/membership" rel="noopener"> <em class="no">媒介会员</em> </a> <em class="no">解锁我的全部写作权限，外加其余媒介。如果你已经是了，别忘了订阅</em><a class="ae np" href="https://sonery.medium.com/subscribe" rel="noopener"><em class="no"/></a><em class="no">如果你想在我发表新文章时收到电子邮件。</em></p><div class="nq nr gp gr ns nt"><a href="https://sonery.medium.com/membership" rel="noopener follow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd iu gy z fp ny fr fs nz fu fw is bi translated">通过我的推荐链接加入Medium-Soner yl DRM</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">sonery.medium.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh ks nt"/></div></div></a></div><p id="8f1c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>