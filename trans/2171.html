<html>
<head>
<title>Train XGBoost Models in Amazon SageMaker in 4 Simple Steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用4个简单的步骤在Amazon SageMaker中训练XGBoost模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/train-xgboost-models-in-amazon-sagemaker-in-4-simple-steps-4eb3e104ee61#2022-05-15">https://towardsdatascience.com/train-xgboost-models-in-amazon-sagemaker-in-4-simple-steps-4eb3e104ee61#2022-05-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fd6a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何使用SageMaker训练和部署XGBoost模型作为端点</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/471f51af7d31a5eac5c13d39b21fc030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fpZTeUFZo135xvbC"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@lazizli?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">拉拉·阿兹利</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="85cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开始使用Amazon SageMaker可能具有挑战性，因为AWS希望您知道许多技巧……反过来，一旦您掌握了这些技巧，您就可以显著加快ML模型的部署，而不必担心Docker和设置计算资源。</p><p id="e5ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这篇文章的目标是尽可能简化SageMaker的入门，并向您快速展示部署XGBoost分类器需要什么，就像您在行业设置中通常会做的那样。大多数教程都是对AWS文档的直接背诵，如果您想根据实际问题定制模型，这些教程并不太适用。例如，使用样本<a class="ae kv" href="https://sagemaker-examples.readthedocs.io/en/latest/introduction_to_applying_machine_learning/xgboost_customer_churn/xgboost_customer_churn.html" rel="noopener ugc nofollow" target="_blank"> XGBoost客户流失笔记本</a>只能预测一个类别的概率，而不能预测单个类别(0或1)本身。</p><h2 id="14ea" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">我们要建造什么</h2><p id="0497" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">如果你像我一样，想要一只小狗，但由于空间的限制，现在还不能，我们至少可以做一些有它们参与的项目，对吗？让我们构建一个简单的XGBoost模型，告诉人们应该根据他们的家有多大来选择小猎犬还是德国牧羊犬。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/4cc6c7f758180732abac5acc1a4f00d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F8arjoOvxw7glXGj_XnWhA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:左[1]和右[2]</p></figure><p id="27eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更具体地说，我们将使用一个虚拟数据集，它由代表<strong class="ky ir">房屋面积</strong>平方英尺的<strong class="ky ir"> X </strong>变量和为0(小猎犬)或1(德国牧羊犬)的<strong class="ky ir"> y </strong>目标变量组成。为简单起见，我们将Beagle设定为最适合小于500平方英尺的住宅，将德国牧羊犬设定为最适合大于500平方英尺的住宅</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/3b404d9249d957f24853d50dd4beb5bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*g81HBlW4tnYi6LSgWcfqCA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:左[1]和右[2]</p></figure><p id="b8e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们开始之前，你可能想知道这个SageMaker学习要花我多少钱？根据<a class="ae kv" href="https://aws.amazon.com/sagemaker/pricing/?nc=sn&amp;loc=3" rel="noopener ugc nofollow" target="_blank"> AWS定价页面</a>，假设您将在美国东部1区工作，编写培训脚本需要大约<strong class="ky ir">4小时</strong>，模型培训需要<strong class="ky ir">0.5小时</strong>，测试终端需要<strong class="ky ir">1小时</strong>，那么最终花费将少于<strong class="ky ir"> $1 </strong>！</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="8e4f" class="ls lt iq mt b gy mx my l mz na"><strong class="mt ir">On-demand Notebook Instance</strong><br/>(ml.t2.medium): $0.0464/hr * 4hr  = $0.2</span><span id="009b" class="ls lt iq mt b gy nb my l mz na"><strong class="mt ir">Training Instance</strong><br/>(ml.m4.xlarge): $0.24/hr * 0.5hr  = $0.12</span><span id="fc40" class="ls lt iq mt b gy nb my l mz na"><strong class="mt ir">Real-time Inference</strong><br/>(ml.m4.xlarge): $0.24/hr * 1hr    = $0.24</span><span id="2e1b" class="ls lt iq mt b gy nb my l mz na"><strong class="mt ir">Total</strong>                               <strong class="mt ir">&lt;$1</strong></span></pre><p id="6d8c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一件有趣的事情是，大多数SageMaker教程希望您神奇地知道他们的基础设施是如何建立的。为了减轻这种情况，这里有一个简化版的<a class="ae kv" href="https://docs.aws.amazon.com/sagemaker/latest/dg/how-it-works-training.html" rel="noopener ugc nofollow" target="_blank">一般工作流程</a>，以及它将如何应用到我们的项目中:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/57f8378cde3423c70b89be421bde840c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*qzarFev1zKWvANGrnn7x3A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h2 id="d1b7" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">👉步伐</h2><ol class=""><li id="4358" class="nd ne iq ky b kz ml lc mm lf nf lj ng ln nh lr ni nj nk nl bi translated">需要供应笔记本电脑实例</li><li id="9d8d" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">将培训/验证数据存储在S3存储桶中</li><li id="121b" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">训练和输出ML模型工件到S3桶</li><li id="9123" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">部署和测试SageMaker推理端点</li></ol></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><h2 id="0aeb" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">1.创建SageMaker (SM) Jupyter笔记本实例</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/8b07f5cc6cd87b57ba19fb2827722b4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CFvO1G5Ug3d5zwEQ3QNCTw.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/8e07d82fd2d3103aaa72b8a9a44bb36b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M7ZZkrCWgPioe9LovuQuhg.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/ed8b77b416175b60a39aa9acd2526798.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AIv0hG0Q6KV1SU6DexTkCg.png"/></div></div></figure><p id="bca3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">给它起个名字:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/a34f91862f77401f79de6b5d58f1716d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-qQr_4ZuW67E9BtoOWhvFA.png"/></div></div></figure><p id="99e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以保留默认的IAM角色，以允许SM访问您的S3存储桶:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/29dd395a822d634ae82ecc55ef541c21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PLUHwI83f4mgZsU-iSbejA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/109f3d4c069355079c34bfd489f237ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0u5ZJGAkQJfKztuFFTLzSw.png"/></div></div></figure><p id="d6d5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦提供了笔记本实例，您就可以启动Jupyter实验室并启动一个<strong class="ky ir"> Conda Python 3 </strong>环境。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/5db0fd90fa49d682b5d6615aab43dae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5YyoHU--q7U5COSYldc99w.png"/></div></div></figure><h2 id="41de" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">旁注(如果生活只有这么简单)</h2><p id="cbdb" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我们通常如何在本地训练XGBoost</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><blockquote class="oh oi oj"><p id="6ca7" class="kw kx ok ky b kz la jr lb lc ld ju le ol lg lh li om lk ll lm on lo lp lq lr ij bi translated">然而，这在SageMaker中不起作用，因为他们希望我们使用他们自己的估计器类，而不是直接导入XGBoost库，并且必须将我们的训练和测试数据集存储在S3中，作为SageMaker工作流的一部分。但是一定要在笔记本内部运行上面的代码片段来查看输出。</p></blockquote><h2 id="d01d" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">2.在S3存储数据</h2><p id="384f" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">对于这一步，我们将重用我们的<strong class="ky ir">df _ train</strong>&amp;<strong class="ky ir">df _ test</strong>(来自上面)并将其存储在默认的S3桶中，该桶将与我们的笔记本实例相关联。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="bb8b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们转到S3存储区，以确保我们的培训和验证数据集已正确存储:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/b40444081884b36bfdb794ed78632e92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SE30s9Ur7BMeaI4GRw2i1w.png"/></div></div></figure><p id="2483" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太棒了，数据集已经成功加载到S3，我们已经为下一步做好了准备。</p><h2 id="4dc7" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">3.训练和存储ML模型工件</h2><p id="043d" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我们可以检索预配置的SageMaker容器，其中包含XGBoost(而不是直接导入XGBoost ),并使用<strong class="ky ir"> TrainingInput </strong>类加载数据集。</p><p id="3dd1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在超参数中，我们必须使用目标函数<strong class="ky ir">“multi:soft max”</strong>而不是“binary:logistic”，因为它只产生概率，而不是二进制值本身(0或1)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><h2 id="2ae0" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">4.部署和测试端点</h2><p id="20b9" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我们准备将XGBoost模型部署为一个端点，然后它可以进行预测。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="c4ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果一切顺利，应该会看到这样的输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/ad16e7d7c70e6b29501f7133926768ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2IjOtybZRHYFGBr18QmqWA.png"/></div></div></figure><p id="8403" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这里找到完整的Jupyter笔记本代码<a class="ae kv" href="https://github.com/kuzmicni/sagemaker-demo/blob/main/xgb-simple.ipynb" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="c12f" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">最后的话</h2><p id="839e" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">像这样部署ML模型是非常好的，但是我们现在如何让互联网上的每个人都能够调用该端点，并找出适合他们特定房子的完美小狗呢？</p><p id="6127" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">简答:</strong>使用Lambda &amp; API网关。</p><p id="5389" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您想了解更多信息，请阅读我的下一篇文章，我们将详细介绍如何编写Lambda函数来处理输入请求(即房屋面积)并使用API Gateway创建一个REST API来接受来自客户端的请求。</p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><p id="ec1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是如果你只是想测试SageMaker，请遵循下面的清理步骤。</p><h2 id="46f7" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated"><strong class="ak">清理以停止产生费用！</strong></h2><blockquote class="oq"><p id="649d" class="or os iq bd ot ou ov ow ox oy oz lr dk translated"><strong class="ak"> 1。通过运行</strong>删除已部署的端点</p></blockquote><pre class="pa pb pc pd pe ms mt mu mv aw mw bi"><span id="2a81" class="ls lt iq mt b gy mx my l mz na">xgb_predictor.delete_endpoint()</span></pre><blockquote class="oq"><p id="6ef5" class="or os iq bd ot ou pf pg ph pi pj lr dk translated"><strong class="ak"> 2。停止SageMaker笔记本实例</strong></p></blockquote><blockquote class="oh oi oj"><p id="f9ef" class="kw kx ok ky b kz pk jr lb lc pl ju le ol pm lh li om pn ll lm on po lp lq lr ij bi translated">感谢您的阅读，如果这篇文章帮助您节省了时间或解决了问题，请务必点击下面的按钮！总是非常感谢。</p></blockquote><h2 id="3307" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">图像来源</h2><p id="8701" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">[1]<a class="ae kv" href="https://commons.wikimedia.org/wiki/File:Beagle_puppy_Cadet.jpg" rel="noopener ugc nofollow" target="_blank">https://commons . wikimedia . org/wiki/File:Beagle _ puppy _ cadet . jpg</a></p><p id="9204" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[2]<a class="ae kv" href="https://pxhere.com/en/photo/1003603" rel="noopener ugc nofollow" target="_blank">https://pxhere.com/en/photo/1003603</a></p></div></div>    
</body>
</html>