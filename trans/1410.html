<html>
<head>
<title>If You Work With Textual Data, Learn These Pandas Methods</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如果您处理文本数据，请学习这些Pandas方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/if-you-work-with-textual-data-learn-these-pandas-methods-3f224122ebaf#2022-04-07">https://towardsdatascience.com/if-you-work-with-textual-data-learn-these-pandas-methods-3f224122ebaf#2022-04-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c6f2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">文本数据比数字携带更多的信息</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/693a75b2a0ca8a53281c5d6679f3c2b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S_FScuRVWTITaOvFg0FdsA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">乌列尔·索伯兰斯在<a class="ae ky" href="https://unsplash.com/s/photos/textual?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="6746" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管我喜欢与数字打交道，但文本数据仍然存在于我的工作流程中。我没有测量或分析它，但我感觉我拥有的文本数据量超过了数字数据量。</p><p id="fa19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">文本数据和数字数据之间最显著的区别是它们需要的清理和预处理的数量。</p><p id="e44a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数字通常采用可以直接用于分析或建模的格式。如果没有，他们需要一些小的接触来准备好。</p><p id="6945" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，文本数据可能有多种格式。此外，同一属性的不同观察结果可能不会以标准格式表示。</p><p id="539c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Python中，文本数据被表示为字符串。字符串是一系列unicode字符。与其他一些编程语言不同，Python没有字符数据类型，所以单个字符是长度为1的字符串。</p><p id="549c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谢天谢地，Pandas简化并加速了文本数据的处理。在这篇文章中，我们将回顾熊猫用于这一目的的方法。</p><p id="d204" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先创建一个填充了模拟文本数据的样本数据帧。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="06fd" class="ma mb it lw b gy mc md l me mf">import pandas as pd</span><span id="ec95" class="ma mb it lw b gy mg md l me mf">df = pd.DataFrame({<br/>    "first_name": ["John","jane","emily","Matt","Alex"],<br/>    "last_name": ["Doe","doe","uth","Dan","mir"],<br/>    "group": ["A-1B","B-1B","A-1C","A-1B","C-1C"],<br/>    "salary": ["$75000","$72000","£45000","$77000","£58,000"]<br/>})</span><span id="eed8" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/380ca84094d4f1f39f827f3dc175d832.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GUUSOgN6AjaQGJVEz_F6xQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="a501" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">字符串数据类型</h2><p id="b93b" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">默认情况下，字符串以“对象”数据类型存储。这可能会导致一些缺点，因为非字符串数据也可以用这种数据类型存储。因此，在Pandas版本中，引入了一种新的字符串数据类型:“string type<strong class="lb iu">”。</strong></p><p id="ce2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，使用“StringDtype”是可选的，但将来可能会要求这样做。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><blockquote class="nl"><p id="5bb8" class="nm nn it bd no np nq nr ns nt nu lu dk translated">Pandas字符串方法可以通过str访问器来访问。</p></blockquote></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="aeb5" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">裂开</h2><p id="52d7" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">一个字符串可能包含多条信息。例如，典型的地址显示街道、城市和州的信息。在我们的模拟数据帧中，group列由两部分组成，并用连字符连接。如果我们想在两个单独的列中表示组，我们可以拆分它。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6df5" class="ma mb it lw b gy mc md l me mf">df["group"].str.split("-")</span><span id="ded4" class="ma mb it lw b gy mg md l me mf"><strong class="lw iu"># output</strong><br/>0    [A, 1B]<br/>1    [B, 1B]<br/>2    [A, 1C]<br/>3    [A, 1B]<br/>4    [C, 1C]<br/>Name: group, dtype: object</span></pre><p id="806f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出值是包含拆分后创建的每个项目的列表。我们可以使用expand参数创建单独的列。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="941d" class="ma mb it lw b gy mc md l me mf">df["group"].str.split("-", expand=True)</span><span id="6a7d" class="ma mb it lw b gy mg md l me mf"><strong class="lw iu"># output</strong></span><span id="6425" class="ma mb it lw b gy mg md l me mf"><strong class="lw iu">     0   1<br/></strong>0    A  1B<br/>1    B  1B<br/>2    A  1C<br/>3    A  1B<br/>4    C  1C<br/>Name: group, dtype: object</span></pre><p id="91f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在输出是一个DataFrame，所以我们可以用它来创建新的列。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="5bc1" class="ma mb it lw b gy mc md l me mf">df["group1"] = df["group"].str.split("-", expand=True)[0]<br/>df["group2"] = df["group"].str.split("-", expand=True)[1]</span><span id="e0c0" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/2ab5418c05653bbee616bc8025a48eaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n19dZL3ahTrb8rLhH3dciw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="cf4b" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">结合</h2><p id="00aa" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">就像我们拆分字符串一样，我们有时也需要组合它们。让我们创建一个包含名字和姓氏的姓名列。我们有两个选择:</p><ul class=""><li id="ce4a" class="nw nx it lb b lc ld lf lg li ny lm nz lq oa lu ob oc od oe bi translated">Cat方法</li><li id="6abd" class="nw nx it lb b lc of lf og li oh lm oi lq oj lu ob oc od oe bi translated">+运算符</li></ul><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8fd1" class="ma mb it lw b gy mc md l me mf"><strong class="lw iu"># method 1</strong><br/>df["first_name"].str.cat(df["last_name"], sep=" ")</span><span id="72cd" class="ma mb it lw b gy mg md l me mf"><strong class="lw iu"># method 2</strong><br/>df["first_name"] + " " + df["last_name"]</span><span id="5288" class="ma mb it lw b gy mg md l me mf"><strong class="lw iu"># output of both 1 and 2</strong><br/>0     John Doe<br/>1     jane doe<br/>2    emily uth<br/>3     Matt Dan<br/>4     Alex mir<br/>dtype: object</span></pre><p id="8bed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里需要注意的一点是，这些列中的字符是大小写混合的。Python认为“doe”和“Doe”不是一回事。因此，在组合它们之前，我们需要将它们全部变成小写或大写。另一种选择是将它们大写，这意味着只有第一个字母是大写的。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="bca9" class="ma mb it lw b gy mc md l me mf"><strong class="lw iu"># lowercase</strong><br/>df["first_name"].str.lower() + " " + df["last_name"].str.lower()</span><span id="4bf5" class="ma mb it lw b gy mg md l me mf"><strong class="lw iu"># output</strong><br/>0     john doe<br/>1     jane doe<br/>2    emily uth<br/>3     matt dan<br/>4     alex mir<br/>dtype: object</span><span id="3889" class="ma mb it lw b gy mg md l me mf">----------------------------------------------------------------<br/><strong class="lw iu"># capitalize<br/></strong>df["first_name"].str.capitalize() + " " + df["last_name"].str.capitalize()</span><span id="fe50" class="ma mb it lw b gy mg md l me mf"><strong class="lw iu"># output</strong><br/>0     John Doe<br/>1     Jane Doe<br/>2    Emily Uth<br/>3     Matt Dan<br/>4     Alex Mir<br/>dtype: object</span></pre><p id="9a98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用上面的输出来创建一个新的列。我希望name列是第一列，所以我将使用insert函数，该函数允许在特定位置创建一列。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="05fc" class="ma mb it lw b gy mc md l me mf">name = df["first_name"].str.lower() + " " + df["last_name"].str.lower()</span><span id="075d" class="ma mb it lw b gy mg md l me mf">df.insert(0, "name", name)</span><span id="7384" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/e2a390a40faee1e88eac714ee7133f2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6fkhR2B79RZ8nI8hhm_3_Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="8ac8" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">索引</h2><p id="c68c" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我们有时需要从字符串中提取数字数据。薪水栏是这种情况的典型例子。我们需要的是去掉货币符号和逗号。</p><p id="c658" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经提到字符串是字符序列，所以我们可以使用索引来访问字符。由于货币符号是第一个字符，我们可以通过选择从第二个字符开始的字符来删除它们。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="60f3" class="ma mb it lw b gy mc md l me mf">df["salary"].str[1:]</span><span id="f797" class="ma mb it lw b gy mg md l me mf"><strong class="lw iu"># output</strong><br/>0     75000<br/>1     72000<br/>2     45000<br/>3     77000<br/>4    58,000<br/>Name: salary, dtype: object</span></pre><p id="f18a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在其中一个值中，逗号被用作千位分隔符。我们可以使用replace方法删除它。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a746" class="ma mb it lw b gy mc md l me mf">df["salary"].str[1:].str.replace(",","")</span><span id="6694" class="ma mb it lw b gy mg md l me mf"><strong class="lw iu"># output</strong><br/>0     75000<br/>1     72000<br/>2     45000<br/>3     77000<br/>4     58000<br/>Name: salary, dtype: object</span></pre><p id="413a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">逗号已被空字符串替换，这相当于删除了它。我们在上面的例子中看到的另一个很酷的事情是，多个字符串操作可以在一个步骤中完成。</p><p id="2ec7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们想使用这些清理后的薪水值来创建一个数字列，我们还需要更改它的数据类型。让我们一步到位。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6a97" class="ma mb it lw b gy mc md l me mf">df["salary_numeric"] = df["salary"].str[1:].str.replace(",","").astype("int")</span><span id="962b" class="ma mb it lw b gy mg md l me mf">df.dtypes</span><span id="2432" class="ma mb it lw b gy mg md l me mf"><strong class="lw iu"># output</strong><br/>name              object<br/>first_name        object<br/>last_name         object<br/>group             object<br/>salary            object<br/>group1            object<br/>group2            object<br/>salary_numeric     int64<br/>dtype: object</span></pre></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="2d39" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">编码分类值</h2><p id="cb21" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我们已经清理了字符串列，但如果我们要在机器学习模型中使用它们，这可能还不够。一些算法不接受字符串值，所以我们需要通过标签编码或一键编码将它们转换成数值。</p><p id="727d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">标签编码只是用数字替换字符串。让我们对“group1”列执行标签编码。我们可以手动用数字替换数值，但这是一项繁琐的工作。此外，不同值的数量很大，因此这种方法肯定不实用。</p><p id="8e86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更好的选择是将该列的数据类型更改为category，然后使用类别代码。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="22d5" class="ma mb it lw b gy mc md l me mf">df["group1"] = df["group1"].astype("category")</span><span id="c415" class="ma mb it lw b gy mg md l me mf">df["group1_numeric"] = df['group1'].cat.codes</span><span id="5d81" class="ma mb it lw b gy mg md l me mf">df[["group1", "group1_numeric"]]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/d60a483573f0c24c3040e3a4c89faec4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tVol-ySxSxqAzqINGdo6Qw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="b8c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个类别由一个数字代替。然而，除非在类别之间存在层次，否则标签编码不适用于某些算法。在上面的例子中，类别C可能被赋予更高的重要性。</p><p id="e141" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，我们应该进行一次性编码，这意味着为每个不同的值创建一个新列。get_dummies函数可用于对一列或多列进行一次性编码。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="fc15" class="ma mb it lw b gy mc md l me mf">pd.get_dummies(df["group1"])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/9f2b29ec9783c80d7a370be339b9d45a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SdcqSn7PofBNUVn8lkROAg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一键编码(图片由作者提供)</p></figure><p id="dd89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“group1”列中的值是A，然后A列中的值变成1，依此类推。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="8d92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="om">你可以成为</em> <a class="ae ky" href="https://sonery.medium.com/membership" rel="noopener"> <em class="om">媒介会员</em> </a> <em class="om">解锁我的全部写作权限，外加其余媒介。如果你已经是了，别忘了订阅</em><a class="ae ky" href="https://sonery.medium.com/subscribe" rel="noopener"><em class="om"/></a><em class="om">如果你想在我发表新文章时收到电子邮件。</em></p><div class="on oo gp gr op oq"><a href="https://sonery.medium.com/membership" rel="noopener follow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd iu gy z fp ov fr fs ow fu fw is bi translated">通过我的推荐链接加入Medium-Soner yl DRM</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">sonery.medium.com</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe ks oq"/></div></div></a></div><p id="584c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>