<html>
<head>
<title>Setting up an Environment for Machine Learning with Conda &amp; Pip-Tools</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Conda &amp; Pip-Tools建立机器学习环境</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/setting-up-an-environment-for-machine-learning-with-conda-pip-tools-9e163cb13b92#2022-02-02">https://towardsdatascience.com/setting-up-an-environment-for-machine-learning-with-conda-pip-tools-9e163cb13b92#2022-02-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/3b6df094375e05d64dcd4dd60c3079af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*g9VTnmNF7EHn70im"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@raminix?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">拉明·哈蒂比</a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><div class=""/><div class=""><h2 id="5340" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">用conda和pip工具创建一个健壮和确定的机器学习环境</h2></div><p id="6846" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们在开始时没有设置一些基本规则，为机器学习项目设置一致和确定的环境有时会有点混乱。</p><p id="84a2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> <em class="lu">在本文中，我想介绍一下如何为机器学习建立一个健壮的开发环境，以便于管理依赖关系，并保证项目整个生命周期中开发和生产阶段之间的兼容性。</em> </strong></p><p id="907a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们的想法是从头开始，以包含以下内容的文件夹结束:</p><ul class=""><li id="6f55" class="lv lw jj la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">一个指定我们的Python和<code class="fe me mf mg mh b">cuda/cudnn</code>版本的<code class="fe me mf mg mh b">environment.yml</code>文件</li><li id="de02" class="lv lw jj la b lb mi le mj lh mk ll ml lp mm lt ma mb mc md bi translated">分别规定开发和生产包要求的<code class="fe me mf mg mh b">dev.in</code>和<code class="fe me mf mg mh b">prod.in</code>文件</li><li id="0f2d" class="lv lw jj la b lb mi le mj lh mk ll ml lp mm lt ma mb mc md bi translated">一个包含命令的<code class="fe me mf mg mh b">Makefile</code>在我们每次修改<code class="fe me mf mg mh b">environment.yml</code>文件或者改变<code class="fe me mf mg mh b">.in</code>文件中的包时自动更新我们的环境</li></ul><p id="4975" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> <em class="lu">免责声明:</em> </strong>本文内容使用以下主要资源编写:</p><ul class=""><li id="88b8" class="lv lw jj la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated"><a class="ae jg" href="https://github.com/full-stack-deep-learning/conda-piptools" rel="noopener ugc nofollow" target="_blank">https://github.com/full-stack-deep-learning/conda-piptools</a></li><li id="2d68" class="lv lw jj la b lb mi le mj lh mk ll ml lp mm lt ma mb mc md bi translated"><a class="ae jg" href="https://github.com/full-stack-deep-learning/fsdl-text-recognizer-project" rel="noopener ugc nofollow" target="_blank">https://github . com/full-stack-deep-learning/fsdl-text-recognizer-project</a></li><li id="27e6" class="lv lw jj la b lb mi le mj lh mk ll ml lp mm lt ma mb mc md bi translated"><a class="ae jg" href="https://github.com/jazzband/pip-tools" rel="noopener ugc nofollow" target="_blank">https://github.com/jazzband/pip-tools</a></li></ul><p id="321d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">主要是我从<a class="ae jg" href="https://fullstackdeeplearning.com/" rel="noopener ugc nofollow" target="_blank">“全栈深度学习课程</a>教授的课程中学到了很多，它除了是学习这个设置的主要资源之外，还是我所有与实用机器学习相关的主题的参考指南，所以我强烈建议你去看看！</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="f792" class="mu mv jj bd mw mx my mz na nb nc nd ne kp nf kq ng ks nh kt ni kv nj kw nk nl bi translated">步伐</h1><ol class=""><li id="ef2d" class="lv lw jj la b lb nm le nn lh no ll np lp nq lt nr mb mc md bi translated"><strong class="la jk">设置蟒蛇</strong></li><li id="afbd" class="lv lw jj la b lb mi le mj lh mk ll ml lp mm lt nr mb mc md bi translated"><strong class="la jk">创建虚拟环境并安装依赖项</strong></li><li id="e5d8" class="lv lw jj la b lb mi le mj lh mk ll ml lp mm lt nr mb mc md bi translated"><strong class="la jk">将环境导出到一个</strong> <code class="fe me mf mg mh b"><strong class="la jk">environment.yml</strong></code> <strong class="la jk">文件</strong></li><li id="aa93" class="lv lw jj la b lb mi le mj lh mk ll ml lp mm lt nr mb mc md bi translated"><strong class="la jk">创建需求文件，并为开发和生产添加我们的依赖关系</strong></li><li id="c064" class="lv lw jj la b lb mi le mj lh mk ll ml lp mm lt nr mb mc md bi translated"><strong class="la jk">编写一个MakeFile文件</strong></li></ol></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="8e52" class="ns mv jj bd mw nt nu dn na nv nw dp ne lh nx ny ng ll nz oa ni lp ob oc nk od bi translated">1.设置Anaconda</h2><ul class=""><li id="7371" class="lv lw jj la b lb nm le nn lh no ll np lp nq lt ma mb mc md bi translated"><a class="ae jg" href="https://docs.conda.io/projects/conda/en/latest/user-guide/getting-started.html#starting-conda" rel="noopener ugc nofollow" target="_blank">设置蟒蛇</a></li><li id="5e16" class="lv lw jj la b lb mi le mj lh mk ll ml lp mm lt ma mb mc md bi translated">用<code class="fe me mf mg mh b">conda -V</code>确认conda版本，在我的情况下，我得到:<code class="fe me mf mg mh b">conda 4.10.3</code></li><li id="5e82" class="lv lw jj la b lb mi le mj lh mk ll ml lp mm lt ma mb mc md bi translated">将conda更新至当前版本:<code class="fe me mf mg mh b">conda update conda</code></li></ul><p id="0997" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我的情况下我得到:<code class="fe me mf mg mh b">conda 4.11.0</code></p><h2 id="dc90" class="ns mv jj bd mw nt nu dn na nv nw dp ne lh nx ny ng ll nz oa ni lp ob oc nk od bi translated">2.创建虚拟环境并安装依赖项</h2><p id="a2b6" class="pw-post-body-paragraph ky kz jj la b lb nm kk ld le nn kn lg lh oe lj lk ll of ln lo lp og lr ls lt im bi translated">在这个项目中，我将使用一个<code class="fe me mf mg mh b">pytorch</code>示例，因此我将首先使用必要的<code class="fe me mf mg mh b">cudatoolkit</code>创建环境，如下所示:</p><pre class="oh oi oj ok gt ol mh om on aw oo bi"><span id="dc76" class="ns mv jj mh b gy op oq l or os">conda create -n setup_ml_env python==3.7 cudatoolkit=10.2 cudnn=7.6</span></pre><p id="4aa8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，我们通过运行以下命令来激活环境:</p><pre class="oh oi oj ok gt ol mh om on aw oo bi"><span id="fd2e" class="ns mv jj mh b gy op oq l or os">conda activate setup_ml_env</span></pre><p id="7366" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">并且，我们通过运行以下命令来测试安装:</p><pre class="oh oi oj ok gt ol mh om on aw oo bi"><span id="c61a" class="ns mv jj mh b gy op oq l or os">python -V</span></pre><p id="6870" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">预期产出:</p><pre class="oh oi oj ok gt ol mh om on aw oo bi"><span id="96ac" class="ns mv jj mh b gy op oq l or os">Python 3.7.11</span></pre><h2 id="85b8" class="ns mv jj bd mw nt nu dn na nv nw dp ne lh nx ny ng ll nz oa ni lp ob oc nk od bi translated">3.将环境导出到一个<code class="fe me mf mg mh b">environment.yml</code>文件</h2><pre class="oh oi oj ok gt ol mh om on aw oo bi"><span id="7f18" class="ns mv jj mh b gy op oq l or os">conda env export --from-history &gt; environment.yml</span></pre><p id="99b4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe me mf mg mh b">--from-history</code>命令确保您只向<code class="fe me mf mg mh b">environment.yml</code>文件添加目前为止您实际安装的包(在本例中只有<code class="fe me mf mg mh b">cudatoolkit</code>和<code class="fe me mf mg mh b">cudnn</code>包)。</p><p id="1eaa" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们将<code class="fe me mf mg mh b">pip</code>和<code class="fe me mf mg mh b">pip-tools</code>添加到这个文件中，以便稍后用于安装我们的Python包，然后我们可以打印出文件的内容以供检查:</p><pre class="oh oi oj ok gt ol mh om on aw oo bi"><span id="c0e4" class="ns mv jj mh b gy op oq l or os">cat environment.yml</span></pre><p id="e39c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">预期产出:</p><pre class="oh oi oj ok gt ol mh om on aw oo bi"><span id="18a1" class="ns mv jj mh b gy op oq l or os">name: setup_ml_env<br/>channels:<br/>  - defaults<br/>dependencies:<br/>  - python=3.7<br/>  - cudatoolkit=10.2<br/>  - cudnn=7.6<br/>  - pip<br/>  - pip:<br/>    - pip-tools<br/>prefix: path/to/setup_ml_env</span></pre><h2 id="e467" class="ns mv jj bd mw nt nu dn na nv nw dp ne lh nx ny ng ll nz oa ni lp ob oc nk od bi translated">4.创建需求文件，并为开发和生产添加依赖性</h2><p id="4361" class="pw-post-body-paragraph ky kz jj la b lb nm kk ld le nn kn lg lh oe lj lk ll of ln lo lp og lr ls lt im bi translated">在Linux终端中:</p><pre class="oh oi oj ok gt ol mh om on aw oo bi"><span id="c010" class="ns mv jj mh b gy op oq l or os">mkdir requirements<br/>touch requirements/dev.in<br/>touch requirements/prod.in</span></pre><p id="ea5e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe me mf mg mh b">dev.in</code>文件中我们写道:</p><pre class="oh oi oj ok gt ol mh om on aw oo bi"><span id="af03" class="ns mv jj mh b gy op oq l or os">-c prod.txt<br/>mypy<br/>black</span></pre><p id="78f5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里<code class="fe me mf mg mh b">-c prod.txt</code>将开发包约束到生产需求文件<code class="fe me mf mg mh b">prod.txt</code>中指定的包，这些包将从<code class="fe me mf mg mh b">prod.in</code>文件生成。</p><p id="99f4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe me mf mg mh b">prod.in</code>文件里面写着:</p><pre class="oh oi oj ok gt ol mh om on aw oo bi"><span id="85d8" class="ns mv jj mh b gy op oq l or os">torch<br/>numpy</span></pre><p id="3ca3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这只是一个使用<code class="fe me mf mg mh b">torch</code>和<code class="fe me mf mg mh b">numpy</code>包的玩具项目的示例。</p><h2 id="bfc3" class="ns mv jj bd mw nt nu dn na nv nw dp ne lh nx ny ng ll nz oa ni lp ob oc nk od bi translated">5.编写MakeFile</h2><p id="2287" class="pw-post-body-paragraph ky kz jj la b lb nm kk ld le nn kn lg lh oe lj lk ll of ln lo lp og lr ls lt im bi translated">我们项目的makefile将包含:</p><pre class="oh oi oj ok gt ol mh om on aw oo bi"><span id="7614" class="ns mv jj mh b gy op oq l or os"># Command to print all the other targets, from https://stackoverflow.com/a/26339924<br/>help:<br/>	@$(MAKE) -pRrq -f $(lastword $(MAKEFILE_LIST)) : 2&gt;/dev/null | awk -v RS= -F: '/^# File/,/^# Finished Make data base/ {if ($$1 !~ "^[#.]") {print $$1}}' | sort | egrep -v -e '^[^[:alnum:]]' -e '^$@$$'</span></pre><p id="b4bf" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe me mf mg mh b">help</code>命令打印makefile的所有可用命令。</p><pre class="oh oi oj ok gt ol mh om on aw oo bi"><span id="bbd2" class="ns mv jj mh b gy op oq l or os"># Install exact Python and CUDA versions<br/>conda-update:<br/>	conda env update --prune -f environment.yml<br/>	echo "Activate your environment with: conda activate setup_ml_env"</span></pre><p id="9c13" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是makefile命令，用于在我们每次修改<code class="fe me mf mg mh b">environment.yml</code>文件时更新我们的环境。</p><pre class="oh oi oj ok gt ol mh om on aw oo bi"><span id="1cd6" class="ns mv jj mh b gy op oq l or os"># Compile and install exact pip packages<br/>pip-tools:<br/>	pip install pip-tools<br/>	pip-compile requirements/prod.in &amp;&amp; pip-compile requirements/dev.in<br/>	pip-sync requirements/prod.txt requirements/dev.txt</span></pre><p id="6a44" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe me mf mg mh b"><a class="ae jg" href="https://github.com/jazzband/pip-tools" rel="noopener ugc nofollow" target="_blank">pip-tools</a></code>命令编译和安装所有需求的相互兼容的版本。</p><p id="6f79" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如全栈深度学习课程的<a class="ae jg" href="https://github.com/full-stack-deep-learning/fsdl-text-recognizer-project/blob/master/setup.md" rel="noopener ugc nofollow" target="_blank">报告中所述，使用pip-tools使我们能够:</a></p><ul class=""><li id="599e" class="lv lw jj la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">将开发从生产依赖中分离出来(<code class="fe me mf mg mh b">dev.in</code> vs <code class="fe me mf mg mh b">prod.in</code>)。</li><li id="2756" class="lv lw jj la b lb mi le mj lh mk ll ml lp mm lt ma mb mc md bi translated">为所有依赖项(自动生成的<code class="fe me mf mg mh b">dev.txt</code>和<code class="fe me mf mg mh b">prod.txt</code>)准备一个精确版本的锁定文件。</li><li id="7c28" class="lv lw jj la b lb mi le mj lh mk ll ml lp mm lt ma mb mc md bi translated">允许我们轻松部署到可能不支持conda环境的目标。</li></ul><p id="d135" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您添加、删除或需要更新某些需求的版本，请编辑。在文件中，只需再次运行<code class="fe me mf mg mh b">make pip-tools</code>。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="03be" class="ns mv jj bd mw nt nu dn na nv nw dp ne lh nx ny ng ll nz oa ni lp ob oc nk od bi translated">总结想法</h2><p id="1274" class="pw-post-body-paragraph ky kz jj la b lb nm kk ld le nn kn lg lh oe lj lk ll of ln lo lp og lr ls lt im bi translated">在我的机器学习生涯之初，我只是安装软件包和运行代码，没有考虑依赖问题等事情的负面影响。</p><p id="34e9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，即使可能仍然有我遗漏的东西，我觉得这种方法试图覆盖开发机器学习项目的天真方法中的漏洞。</p><p id="ba6f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">总之:</strong></p><ul class=""><li id="f4eb" class="lv lw jj la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated"><code class="fe me mf mg mh b">environment.yml</code>指定Python和可选的<code class="fe me mf mg mh b">cuda/cudnn</code></li><li id="e3ae" class="lv lw jj la b lb mi le mj lh mk ll ml lp mm lt ma mb mc md bi translated"><code class="fe me mf mg mh b">make conda-update</code>创建/更新conda环境</li><li id="67b1" class="lv lw jj la b lb mi le mj lh mk ll ml lp mm lt ma mb mc md bi translated"><code class="fe me mf mg mh b">requirements/prod.in</code>和<code class="fe me mf mg mh b">requirements/dev.in</code>指定python包需求</li><li id="a5a7" class="lv lw jj la b lb mi le mj lh mk ll ml lp mm lt ma mb mc md bi translated"><code class="fe me mf mg mh b">make pip-tools</code>解析并安装所有Python包</li></ul></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="28a6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你喜欢视频，可以看看我在Youtube上关于这个主题的视频:</p><figure class="oh oi oj ok gt iv"><div class="bz fp l di"><div class="ot ou l"/></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="c430" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你喜欢这篇文章，可以考虑加入我的<a class="ae jg" href="https://lucas-soares.medium.com/membership" rel="noopener"> Medium </a>。另外，<a class="ae jg" href="https://www.youtube.com/channel/UCu8WF59Scx9f3H1N_FgZUwQ" rel="noopener ugc nofollow" target="_blank">订阅我的Youtube频道</a>。谢谢，下次再见！:)</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="8298" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="lu">来自https://enkrateialucca.github.io/lucas_soares_learning/</em>的博客<a class="ae jg" href="https://enkrateialucca.github.io/lucas_soares_learning/" rel="noopener ugc nofollow" target="_blank"/></p></div></div>    
</body>
</html>