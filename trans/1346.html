<html>
<head>
<title>Build a Collaborative Filtering Music Recommendation System in SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用SQL构建协同过滤音乐推荐系统</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-a-collaborative-filtering-music-recommendation-system-in-sql-d9d955cfde6c#2022-04-04">https://towardsdatascience.com/build-a-collaborative-filtering-music-recommendation-system-in-sql-d9d955cfde6c#2022-04-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3d18" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用SQL实现用户项目协同过滤推荐引擎</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1a1c69492d30975e4682878aca73439f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gDNuLXEs7UI52Vmt4hsWdA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://unsplash.com/@arstyy" rel="noopener ugc nofollow" target="_blank">奥斯汀·尼尔</a>从<a class="ae ky" href="https://unsplash.com/photos/hgO1wFPXl3I" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="a707" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文将用SQL在关系数据库中构建一个简单的用户项目协同过滤推荐系统。以下是文章提纲:</p><p id="6afe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">目录</strong></p><ul class=""><li id="77a6" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">协同过滤概述<br/> -示例</li><li id="7146" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">问题陈述</li><li id="d6f9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">数据概述</li><li id="db5b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">履行</li><li id="7020" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">结束语</li><li id="a0be" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">资源</li></ul><h1 id="dde2" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">协作过滤概述</h1><p id="7219" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">协同过滤旨在通过用户的偏好来预测用户的兴趣。这可以通过过滤不同用户、数据源等之间的模式来实现。协同过滤如何工作背后的主要直觉如下，如果用户A和B对产品X有相似的品味，那么用户A和B很可能对其他产品也有相似的品味。</p><p id="01f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在协同过滤中有两种常见的方法，基于记忆的方法和基于模型的方法。本文的重点将是基于内存的方法。我们将查看用户项目组合的评级，以便为其他用户提供推荐。在我们示例的上下文中，项目将是音乐。基于用户的协同过滤本质上意味着志同道合的用户会产生强烈的相似的推荐。基于项目的协同过滤基于项目之间的相似性来推荐项目，该相似性是使用那些项目的用户评级来计算的。</p><p id="c30d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种协同过滤模型的主要缺点是它对推荐新项目不友好，这是因为没有用户/项目与之交互。这被称为<a class="ae ky" href="https://en.wikipedia.org/wiki/Cold_start_(recommender_systems)" rel="noopener ugc nofollow" target="_blank">冷启动问题</a>。另一个问题来自高度稀疏的数据，特别是基于内存的模型，当数据集非常稀疏时，性能会很差。</p><p id="c08d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">例题</strong></p><p id="e2d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">协作过滤算法的一些例子:</p><ul class=""><li id="eb21" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">向用户推荐亚马逊产品——根据购买/评论过该产品或其他类似产品的其他用户向您推荐产品。</li><li id="d622" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">Udemy课程推荐——根据其他已经完成并喜欢你已经完成的现有课程的人向你推荐课程。</li></ul><p id="888b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想了解更多关于推荐系统以及使用推荐系统解决问题的各种方法和实现的信息，请查看我的文章<a class="ae ky" rel="noopener" target="_blank" href="/recommendation-systems-explained-a42fc60591ed#:~:text=Loosely%20defined%2C%20a%20recommender%20system,Amazon%2C%20Reddit%2C%20Netflix%20etc."> <em class="ng">推荐系统解释</em> </a> <em class="ng"> </em>，了解推荐系统解决方案在Python中的直觉和实现，以及推荐系统的协作过滤、基于内容和混合方法。我还写了另一篇关于Node2Vec  的<a class="ae ky" rel="noopener" target="_blank" href="/link-prediction-recommendation-engines-with-node2vec-c97c429351a8"> <em class="ng">链接预测推荐系统的文章，其中也提到了您可能感兴趣的推荐系统中的问题和解决方案。</em></a></p><h1 id="0daf" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">问题陈述</h1><p id="8fe4" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">这个问题比较容易理解。假设你目前在Spotify、Apple Music或Tidal等音乐流媒体平台工作。你有一个庞大而活跃的用户群，他们有能力关注其他用户，喜欢他们喜欢的歌曲。我们希望设计一个推荐引擎，推荐用户还没有听过，但这个用户正在关注的用户已经听过并喜欢的歌曲。</p><h1 id="073f" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">数据概述</h1><p id="bbcf" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">以下架构概述了可供用户使用的表、列和数据。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="8280" class="nm mk it ni b gy nn no l np nq">Table : Followers<br/>+---------------+---------+<br/>| Column Name   | Type    |<br/>+---------------+---------+<br/>| user1_id      | int     |<br/>| user2_id      | int     |<br/>+---------------+---------+</span><span id="54a8" class="nm mk it ni b gy nr no l np nq">The Followers table consists of two columns, user1_id and user2_id where the fields would be populated if user1 follows user2. The id's are unique identifiers associated with this table and can be mapped to the activity table by merging on user_id.</span><span id="905c" class="nm mk it ni b gy nr no l np nq">Table : Likes<br/>+---------------+---------+<br/>| Column Name   | Type    |<br/>+---------------+---------+<br/>| user_id       | int     |<br/>| song_id       | int     |<br/>+---------------+---------+</span><span id="4290" class="nm mk it ni b gy nr no l np nq">The Likes table also consists of two columns, user_id and song_id. The id's are unique identifiers associated with the user and song respectively. This table implies that the user under the user_id column has liked the song under the song_id column. The song_id from the Likes table can be mapped to the song_id from the Songs table to get the song name.</span><span id="43c9" class="nm mk it ni b gy nr no l np nq">Table : Songs<br/>+-----------------+-------------+<br/>| Column Name     | Type        |<br/>+-----------------+-------------+<br/>| song_id         | int         |<br/>| name            | varchar     |<br/>| artist          | varchar     |<br/>+-----------------+-------------+</span><span id="6a43" class="nm mk it ni b gy nr no l np nq">The Songs table consists of three columns, song_id, artist and name. Each song_id is mapped to a name associated with that song and an artist which created that song. </span></pre><p id="462e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图显示了与上述数据库相关联的模式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/d0c1521138f041ef530cec4c0bdb2ca4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zpjWSeMyZYJj8glgerDXoA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据库模式概述。图片由作者提供。</p></figure><h1 id="f693" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">履行</h1><p id="5f05" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">您可以使用下面的<a class="ae ky" href="https://dbfiddle.uk/?rdbms=postgres_9.5&amp;fiddle=42837d39e721d6a0224b7d4944cf8a2c" rel="noopener ugc nofollow" target="_blank"> DB Fiddle </a>或通过我的<a class="ae ky" href="https://github.com/vatsal220/medium_articles/tree/main/music_sql_rec_sys" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上的相应查询来实现。</p><p id="ac9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先将一些有用的数据插入数据库。可以执行下面的代码片段，将几行数据添加到每个适当的表中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="6c6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以建立推荐系统了。我们可以将其分为3个步骤，首先创建一个包含所有user _ ids的CTE。其次，创建另一个CTE，显示他们的追随者喜欢的所有歌曲。最后，通过likes表，我们可以合并来自步骤2的CTE，以找到朋友喜欢但用户不喜欢的歌曲。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="6678" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基于我们插入到数据库中的数据，上面的查询应该产生以下结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/67198c3f81e4b01307425dae4a619986.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PHIe-u7ayNEbHfLbn536lA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">每个用户推荐的歌曲，该用户还没有听过，但是该用户的追随者已经喜欢了。图片由作者提供。</p></figure><p id="a6c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据我们插入的数据，我们注意到没有听过<code class="fe nw nx ny ni b">song_id = 3</code>的<code class="fe nw nx ny ni b">user_1</code>正在关注听过<code class="fe nw nx ny ni b">song_id =3</code>的<code class="fe nw nx ny ni b">user_2</code>、<code class="fe nw nx ny ni b">user_3</code>和<code class="fe nw nx ny ni b">user_4</code>。因此建议用户1可能也喜欢<code class="fe nw nx ny ni b">song_id = 3</code>。相同的逻辑可以应用于对其余用户的其余推荐。</p><h1 id="100d" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">结束语</h1><p id="1f8c" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">本教程的目的是展示如何通过SQL解决相对困难的问题。请注意，这个问题和解决方案有许多缺陷和警告。它可以通过处理各种边缘情况得到极大的改善，例如新用户没有关注任何人，新歌很少或没有参与，因此无法推荐给其他人，新发行的优先顺序等。这种解决方案的许多缺陷与推荐系统的冷启动问题有关。</p><p id="8977" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用下面的<a class="ae ky" href="https://dbfiddle.uk/?rdbms=postgres_9.5&amp;fiddle=42837d39e721d6a0224b7d4944cf8a2c" rel="noopener ugc nofollow" target="_blank"> DB Fiddle </a>或通过我的<a class="ae ky" href="https://github.com/vatsal220/medium_articles/tree/main/music_sql_rec_sys" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上的相应查询来实现。</p><p id="3359" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想转型进入数据行业，并希望得到经验丰富的导师的指导和指引，那么你可能想看看最敏锐的头脑。Sharpest Minds是一个导师平台，导师(他们是经验丰富的实践数据科学家、机器学习工程师、研究科学家、首席技术官等。)将有助于你的发展和学习在数据领域找到一份工作。点击查看它们<a class="ae ky" href="https://www.sharpestminds.com/?r=vatsal-patal" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="a587" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">资源</h1><ul class=""><li id="9288" class="lv lw it lb b lc nb lf nc li nz lm oa lq ob lu ma mb mc md bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/recommendation-systems-explained-a42fc60591ed">https://towards data science . com/re commendation-systems-explained-a 42fc 60591 ed</a></li></ul></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><p id="f170" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢这篇文章，你可能也会喜欢我写的其他文章。请随意查看下面的内容。</p><div class="oj ok gp gr ol om"><a rel="noopener follow" target="_blank" href="/recommendation-systems-explained-a42fc60591ed"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">推荐系统解释</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">用Python解释和实现基于内容的协同过滤和混合推荐系统</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">towardsdatascience.com</p></div></div><div class="ov l"><div class="ow l ox oy oz ov pa ks om"/></div></div></a></div><div class="oj ok gp gr ol om"><a rel="noopener follow" target="_blank" href="/active-learning-in-machine-learning-explained-777c42bd52fa"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">机器学习中的主动学习解释</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">Python中主动学习管道的直觉和实现</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">towardsdatascience.com</p></div></div><div class="ov l"><div class="pb l ox oy oz ov pa ks om"/></div></div></a></div><div class="oj ok gp gr ol om"><a rel="noopener follow" target="_blank" href="/link-prediction-recommendation-engines-with-node2vec-c97c429351a8"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">使用Node2Vec的链接预测推荐引擎</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">在Python中使用节点嵌入进行链接预测</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">towardsdatascience.com</p></div></div><div class="ov l"><div class="pc l ox oy oz ov pa ks om"/></div></div></a></div><div class="oj ok gp gr ol om"><a rel="noopener follow" target="_blank" href="/louvains-algorithm-for-community-detection-in-python-95ff7f675306"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">Python中社区发现的Louvain算法</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">在Python中应用Louvain算法进行社区发现</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">towardsdatascience.com</p></div></div><div class="ov l"><div class="pd l ox oy oz ov pa ks om"/></div></div></a></div><div class="oj ok gp gr ol om"><a rel="noopener follow" target="_blank" href="/text-similarity-w-levenshtein-distance-in-python-2f7478986e75"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">Python中带Levenshtein距离的文本相似度</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">用Python构建抄袭检测管道</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">towardsdatascience.com</p></div></div><div class="ov l"><div class="pe l ox oy oz ov pa ks om"/></div></div></a></div><div class="oj ok gp gr ol om"><a rel="noopener follow" target="_blank" href="/text-summarization-in-python-with-jaro-winkler-and-pagerank-72d693da94e8"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">用Jaro-Winkler和PageRank实现Python中的文本摘要</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">用Jaro-Winkler和PageRank构建一个文本摘要器</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">towardsdatascience.com</p></div></div><div class="ov l"><div class="pf l ox oy oz ov pa ks om"/></div></div></a></div><div class="oj ok gp gr ol om"><a rel="noopener follow" target="_blank" href="/word2vec-explained-49c52b4ccb71"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">Word2Vec解释道</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">解释Word2Vec的直观性&amp;用Python实现它</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">towardsdatascience.com</p></div></div><div class="ov l"><div class="pg l ox oy oz ov pa ks om"/></div></div></a></div></div></div>    
</body>
</html>