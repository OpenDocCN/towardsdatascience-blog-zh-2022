<html>
<head>
<title>DASH101 — Part 3: Add interactivity with Dash callback</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DASH101 —第 3 部分:通过 DASH 回调增加交互性</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/dash101-part-3-add-interactivity-with-dash-callback-420f564ad622#2022-03-15">https://towardsdatascience.com/dash101-part-3-add-interactivity-with-dash-callback-420f564ad622#2022-03-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="9b19" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">数据可视化</h2><div class=""/><div class=""><h2 id="88f6" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">学习在 Python 中嵌入仪表板的交互性</h2></div><p id="0415" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">向 dashboard 添加交互性增强了它的可用性，并帮助用户轻松地更深入地探索和分析数据。在这篇文章中，我们将学习 Dash 回调的基础知识，并为我们之前构建的示例仪表板添加交互性。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ln"><img src="../Images/182371d47d93922cfc442e2bdf26efef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8raYvmlnPccD9kLd"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">照片由<a class="ae md" href="https://unsplash.com/@sharonp?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">莎伦·皮特韦</a>在<a class="ae md" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="c596" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我们将从上一篇文章中<a class="ae md" rel="noopener" target="_blank" href="/dash101-part-2-prettify-dash-dashboard-with-css-and-python-3866c069a3b6">停止的地方继续。如果你想赶上我们在系列中学到的东西，这里有链接:<br/> ◼ </a><a class="ae md" rel="noopener" target="_blank" href="/dash101-part-1-introduction-to-dash-layout-810ec449ad43"> <em class="me"> DASH101 —第 1 部分:DASH 布局介绍</em></a><em class="me"><br/></em>◼<a class="ae md" rel="noopener" target="_blank" href="/dash101-part-2-prettify-dash-dashboard-with-css-and-python-3866c069a3b6"><em class="me">dash 101—第 2 部分:用 CSS 和 Python 美化 dash dash 仪表板</em> </a></p><p id="1d2a" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">📌请注意，本文中显示的代码不是独立的。参考前一篇文章的代码片段是这篇文章的先决条件。为了避免重复，这些片段被省略了。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="4bc8" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">🔧回拨基础</h1><p id="d0a9" class="pw-post-body-paragraph kr ks it kt b ku ne kd kw kx nf kg kz la ng lc ld le nh lg lh li ni lk ll lm im bi translated">在 Dash 中，我们使用<code class="fe nj nk nl nm b">@app.callback</code> decorator 来增加仪表板的交互性。语法结构如下所示:</p><pre class="lo lp lq lr gt nn nm no np aw nq bi"><span id="b56f" class="nr mn it nm b gy ns nt l nu nv">app = dash.Dash(__name__)<br/>app.layout = ...</span><span id="7e2a" class="nr mn it nm b gy nw nt l nu nv"><a class="ae md" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.callback(Output(...), [Input(...), Input(...)])<br/>def update_output(input1, input2):<br/>    ...<br/>    return output1</span><span id="971a" class="nr mn it nm b gy nw nt l nu nv">if __name__ == '__main__':<br/>    app.run_server(debug=True)</span></pre><p id="fb7a" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在这个例子中，我们有两个输入和一个输出。装饰器中的输入数量应该与函数的参数数量相同。输出的数量应该与函数返回的输出数量相同。当任何输入发生变化时，Dash 会自动更新输出。</p><p id="ec8b" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">目前，我们的仪表板中的下拉菜单、按钮、滑块和开关仅仅是装饰，因为它们没有功能。在下一节中，我们将使用<code class="fe nj nk nl nm b">@app.callback</code>装饰器为这些仪表板元素添加交互性。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="d3d5" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">🔨向仪表板添加交互性</h1><p id="d3ea" class="pw-post-body-paragraph kr ks it kt b ku ne kd kw kx nf kg kz la ng lc ld le nh lg lh li ni lk ll lm im bi translated">让我们将图表设置为每次下拉列表值改变时更新:</p><pre class="lo lp lq lr gt nn nm no np aw nq bi"><span id="8a69" class="nr mn it nm b gy ns nt l nu nv"># ********************* Dash app *********************<br/>app = dash.Dash(__name__)<br/>app.layout = html.Div([<br/>    html.Div([<br/>        html.H1("Titanic predictions"),<br/>        html.P("Summary of predicted probabilities for Titanic test dataset."),<br/>        html.Img(src="assets/left_pane.png"),<br/>        html.Label("Passenger class", className='dropdown-labels'), <br/>        dcc.Dropdown(<br/>            id='class-dropdown', className='dropdown', multi=True,<br/>            options=create_dropdown_options(test['Class']),<br/>            value=create_dropdown_value(test['Class'])),<br/>        html.Label("Gender", className='dropdown-labels'), <br/>        dcc.Dropdown(<br/>            id='gender-dropdown', className='dropdown', multi=True,<br/>            options=create_dropdown_options(test['Gender']),<br/>            value=create_dropdown_value(test['Gender'])),<br/>        html.Button(id='update-button', children="Update")<br/>        ], id='left-container'),<br/>    html.Div([<br/>        html.Div([<br/>            dcc.Graph(id="histogram"),<br/>            dcc.Graph(id="barplot")<br/>        ], id='visualisation'),<br/>        html.Div([<br/>            dcc.Graph(id='table'),<br/>            html.Div([<br/>                html.Label("Survival status", <br/>                           className='other-labels'), <br/>                daq.BooleanSwitch(id='target_toggle', <br/>                                  className='toggle', <br/>                                  on=True, color="#FFBD59"),<br/>                html.Label("Sort probability in ascending order", <br/>                           className='other-labels'),<br/>                daq.BooleanSwitch(id='sort_toggle', <br/>                                  className='toggle', <br/>                                  on=True, color="#FFBD59"),<br/>                html.Label("Number of records", <br/>                           className='other-labels'), <br/>                dcc.Slider(id='n-slider', min=5, max=20, <br/>                           step=1, value=10, <br/>                           marks=create_slider_marks([5, 10, <br/>                                                      15, 20])),<br/>            ], id='table-side'),<br/>        ], id='data-extract')<br/>    ], id='right-container')<br/>], id='container')<br/><a class="ae md" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.callback(<br/>    [Output(component_id='histogram', <br/>            component_property='figure'),<br/>     Output(component_id='barplot', <br/>            component_property='figure'),<br/>     Output(component_id='table', <br/>            component_property='figure')],<br/>    [Input(component_id='class-dropdown', <br/>           component_property='value'),<br/>     Input(component_id='gender-dropdown', <br/>           component_property='value')]<br/>)<br/>def update_output(class_value, gender_value):<br/>    # Update data to dropdown values without overwriting test<br/>    dff = test.copy()<br/>    dff = dff[dff['Class'].isin(class_value)]<br/>    dff = dff[dff['Gender'].isin(gender_value)]<br/>    # Visual 1: Histogram<br/>    histogram = px.histogram(<br/>        dff, x='Probability', color=TARGET, marginal="box", <br/>        nbins=30, opacity=0.6,  <br/>        color_discrete_sequence=['#FFBD59', '#3BA27A']<br/>    )<br/>    histogram.update_layout(<br/>        title_text=f'Distribution of probabilities by class (n={len(dff)})',<br/>        font_family='Tahoma', plot_bgcolor='rgba(255,242,204,100)'<br/>    )<br/>    histogram.update_yaxes(title_text="Count")<br/>    # Visual 2: Barplot<br/>    barplot = px.bar(<br/>        dff.groupby('Binned probability', as_index=False)['Target'].mean(), <br/>        x='Binned probability', y='Target', <br/>        color_discrete_sequence=['#3BA27A']<br/>    )<br/>    barplot.update_layout(<br/>        title_text=f'Survival rate by binned probabilities (n={len(dff)})', <br/>        font_family='Tahoma', xaxis = {'categoryarray': labels}, <br/>        plot_bgcolor='rgba(255,242,204,100)'<br/>    )<br/>    barplot.update_yaxes(title_text="Percentage survived")<br/>    # Visual 3: Table<br/>    columns = ['Age', 'Gender', 'Class', 'Embark town', TARGET, 'Probability']<br/>    table = go.Figure(data=[go.Table(<br/>        header=dict(values=columns, fill_color='#FFBD59', <br/>                    line_color='white', align='center',<br/>                    font=dict(color='white', size=13)),<br/>        cells=dict(values=[dff[c] for c in columns], <br/>                   format=["d", "", "", "", "", ".2%"],<br/>                   fill_color=[['white', '#FFF2CC']*(len(dff)-1)], <br/>                   align='center'))<br/>    ])<br/>    table.update_layout(title_text=f'Sample records (n={len(dff)})', <br/>    font_family='Tahoma')<br/>    <br/>    return histogram, barplot, table<br/>    <br/>if __name__ == '__main__':<br/>    app.run_server(debug=True)</span></pre><p id="39bc" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">这里，我们定义了 2 个输入:下拉菜单和 3 个输出:图形。使用<code class="fe nj nk nl nm b">@app.callback</code>装饰器和<code class="fe nj nk nl nm b">update_output()</code>函数，每次下拉列表值改变时，图形都会更新。当在函数中使用选中的下拉值过滤数据时，我们确保没有覆盖原始数据<code class="fe nj nk nl nm b">test</code>。</p><p id="bf00" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">下拉列表值的变化现在会触发仪表板的更新。但是，如果我们不希望在选择下拉列表值时更新图表，而只希望在按下按钮时更新图表，那该怎么办呢？让我们调整我们的仪表板，使其以这种方式运行。对于这种行为，<code class="fe nj nk nl nm b">State</code>将会派上用场。</p><pre class="lo lp lq lr gt nn nm no np aw nq bi"><span id="c143" class="nr mn it nm b gy ns nt l nu nv"># ********************* Dash app *********************<br/>app = dash.Dash(__name__)<br/>app.layout = html.Div([<br/>    html.Div([<br/>        html.H1("Titanic predictions"),<br/>        html.P("Summary of predicted probabilities for Titanic test dataset."),<br/>        html.Img(src="assets/left_pane.png"),<br/>        html.Label("Passenger class", className='dropdown-labels'), <br/>        dcc.Dropdown(<br/>            id='class-dropdown', className='dropdown', multi=True,<br/>            options=create_dropdown_options(test['Class']),<br/>            value=create_dropdown_value(test['Class'])),<br/>        html.Label("Gender", className='dropdown-labels'), <br/>        dcc.Dropdown(<br/>            id='gender-dropdown', className='dropdown', multi=True,<br/>            options=create_dropdown_options(test['Gender']),<br/>            value=create_dropdown_value(test['Gender'])),<br/>        html.Button(id='update-button', children="Update", n_clicks=0)<br/>        ], id='left-container'),<br/>    html.Div([<br/>        html.Div([<br/>            dcc.Graph(id="histogram"),<br/>            dcc.Graph(id="barplot")<br/>        ], id='visualisation'),<br/>        html.Div([<br/>            dcc.Graph(id='table'),<br/>            html.Div([<br/>                html.Label("Survival status", <br/>                           className='other-labels'), <br/>                daq.BooleanSwitch(id='target_toggle', <br/>                                  className='toggle', <br/>                                  on=True, color="#FFBD59"),<br/>                html.Label("Sort probability in ascending order", <br/>                           className='other-labels'),<br/>                daq.BooleanSwitch(id='sort_toggle', <br/>                                  className='toggle', <br/>                                  on=True, color="#FFBD59"),<br/>                html.Label("Number of records", <br/>                           className='other-labels'), <br/>                dcc.Slider(id='n-slider', min=5, max=20, <br/>                           step=1, value=10, <br/>                           marks=create_slider_marks([5, 10, <br/>                                                      15, 20])),<br/>            ], id='table-side'),<br/>        ], id='data-extract')<br/>    ], id='right-container')<br/>], id='container')</span><span id="96ca" class="nr mn it nm b gy nw nt l nu nv"><a class="ae md" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.callback(<br/>    [Output(component_id='histogram', <br/>            component_property='figure'),<br/>     Output(component_id='barplot', <br/>            component_property='figure'),<br/>     Output(component_id='table', <br/>            component_property='figure')],<br/>    [State(component_id='class-dropdown', <br/>           component_property='value'),<br/>     State(component_id='gender-dropdown', <br/>           component_property='value'),<br/>     Input(component_id='update-button', <br/>           component_property='n_clicks')]</span><span id="a233" class="nr mn it nm b gy nw nt l nu nv">)<br/>def update_output(class_value, gender_value, n_clicks):<br/>    # Update data to dropdown values without overwriting test<br/>    dff = test.copy()</span><span id="6de0" class="nr mn it nm b gy nw nt l nu nv">if n_clicks&gt;0:<br/>        if len(class_value)&gt;0:<br/>            dff = dff[dff['Class'].isin(class_value)]<br/>        elif len(class_value)==0:<br/>            raise dash.exceptions.PreventUpdate<br/>        <br/>        if len(gender_value)&gt;0:<br/>            dff = dff[dff['Gender'].isin(gender_value)]<br/>        elif len(gender_value)==0:<br/>            raise dash.exceptions.PreventUpdate</span><span id="8089" class="nr mn it nm b gy nw nt l nu nv"># Visual 1: Histogram<br/>    histogram = px.histogram(<br/>        dff, x='Probability', color=TARGET, marginal="box", <br/>        nbins=30, opacity=0.6,  <br/>        color_discrete_sequence=['#FFBD59', '#3BA27A']<br/>    )<br/>    histogram.update_layout(<br/>        title_text=f'Distribution of probabilities by class (n={len(dff)})',<br/>        font_family='Tahoma', plot_bgcolor='rgba(255,242,204,100)'<br/>    )<br/>    histogram.update_yaxes(title_text="Count")</span><span id="335f" class="nr mn it nm b gy nw nt l nu nv"># Visual 2: Barplot<br/>    barplot = px.bar(<br/>        dff.groupby('Binned probability', as_index=False)['Target'].mean(), <br/>        x='Binned probability', y='Target', <br/>        color_discrete_sequence=['#3BA27A']<br/>    )<br/>    barplot.update_layout(<br/>        title_text=f'Survival rate by binned probabilities (n={len(dff)})', <br/>        font_family='Tahoma', xaxis = {'categoryarray': labels}, <br/>        plot_bgcolor='rgba(255,242,204,100)'<br/>    )<br/>    barplot.update_yaxes(title_text="Percentage survived")</span><span id="f57e" class="nr mn it nm b gy nw nt l nu nv"># Visual 3: Table<br/>    columns = ['Age', 'Gender', 'Class', 'Embark town', TARGET, 'Probability']<br/>    table = go.Figure(data=[go.Table(<br/>        header=dict(values=columns, fill_color='#FFBD59', <br/>                    line_color='white', align='center',<br/>                    font=dict(color='white', size=13)),<br/>        cells=dict(values=[dff[c] for c in columns], <br/>                   format=["d", "", "", "", "", ".2%"],<br/>                   fill_color=[['white', '#FFF2CC']*(len(dff)-1)], <br/>                   align='center'))<br/>    ])<br/>    table.update_layout(title_text=f'Sample records (n={len(dff)})', <br/>    font_family='Tahoma')<br/>    <br/>    return histogram, barplot, table</span><span id="83d0" class="nr mn it nm b gy nw nt l nu nv">if __name__ == '__main__':<br/>    app.run_server(debug=True)</span></pre><p id="9de1" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><code class="fe nj nk nl nm b">State</code>保存下拉列表中的信息，但不会触发更新。所以现在当我们改变下拉列表值时，图形保持不变。只有当我们单击“更新”按钮时，图表才会更新为下拉列表中的选定值。此外，我们还以另一种方式改变了下拉列表的行为:当两个下拉列表中没有选择任何值时，我们禁止使用<code class="fe nj nk nl nm b">dash.exceptions.PreventUpdate</code>进行更新。</p><p id="c787" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">每点击一次按钮，<code class="fe nj nk nl nm b">n_clicks</code>递增。这意味着单击按钮会触发图形的刷新。在布局中，我们还将<code class="fe nj nk nl nm b">n_clicks</code>初始化为 0，这样 if 条件:<code class="fe nj nk nl nm b">if n_clicks&gt;0</code>就不会出错。</p><p id="14ea" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">最后，让我们为表格的切换和滑块添加交互性:</p><figure class="lo lp lq lr gt ls"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="54f5" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">瞧啊。我们已经完成了向仪表板添加交互性。完整仪表板的代码也可以在<a class="ae md" href="https://github.com/zluvsand/dash_dashboard/tree/main/titanic_dashboard" rel="noopener ugc nofollow" target="_blank">这里</a>找到。希望这一系列的三篇文章已经让你尝到了 Dash 的滋味，并激发了你创建自己的仪表板来巩固你的学习的兴趣。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi nz"><img src="../Images/36df37da79c11b755228d9e4af1f44dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8u9WgVhXuUou4uBH"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">罗纳德·库扬在<a class="ae md" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="b2c0" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><em class="me">您想访问更多这样的内容吗？媒体会员可以无限制地访问媒体上的任何文章。如果您使用</em> <a class="ae md" href="https://zluvsand.medium.com/membership" rel="noopener"> <em class="me">我的推荐链接</em></a><em class="me">成为会员，您的一部分会费将直接用于支持我。</em></p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><p id="b6f6" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">谢谢你看我的帖子。如果你感兴趣，这里有我的一些帖子的链接:<br/> ◼️️ <a class="ae md" rel="noopener" target="_blank" href="/enrich-your-github-profile-with-these-tips-272fa1eafe05">用这些技巧丰富你的 GitHub 个人资料</a> <br/> ◼️️ <a class="ae md" rel="noopener" target="_blank" href="/enrich-your-jupyter-notebook-with-these-tips-55c8ead25255">用这些技巧丰富你的 Jupyter 笔记本</a> <br/> ◼️ <a class="ae md" rel="noopener" target="_blank" href="/organise-your-jupyter-notebook-with-these-tips-d164d5dcd51f">用这些技巧组织你的 Jupyter 笔记本</a> <br/> ◼️ <a class="ae md" rel="noopener" target="_blank" href="/simple-data-visualisations-in-python-that-you-will-find-useful-5e42c92df51e">用 Python 实现简单的数据可视化，你会发现有用的</a> <br/> ◼️ <a class="ae md" rel="noopener" target="_blank" href="/6-simple-tips-for-prettier-and-customised-plots-in-seaborn-python-22f02ecc2393"> 6 个简单的技巧，让你在 Seaborn (Python)中有更漂亮和定制的情节</a></p><p id="09b6" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">再见🏃💨</p></div></div>    
</body>
</html>