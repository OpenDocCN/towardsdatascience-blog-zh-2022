<html>
<head>
<title>5 Rookie Mistakes to Avoid when Using Dask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Dask时要避免的5个新手错误</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/5-rookie-mistakes-to-avoid-when-using-dask-592e4a909de6#2022-02-10">https://towardsdatascience.com/5-rookie-mistakes-to-avoid-when-using-dask-592e4a909de6#2022-02-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5bb9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Python中成功的分布式计算策略</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f9c2a9b389299f59ad0c2e81533fe66c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*omZHp_hhe-CICEoEsAMDKg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由unsplash.com的梅廷·奥泽尔拍摄</p></figure><p id="24e4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第一次使用Dask可能是一个陡峭的学习曲线。这篇文章介绍了人们在使用Dask时最常犯的5个错误，以及如何避免犯这些错误的策略。</p><p id="0fd7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们跳进来。</p><h1 id="1858" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">1.“Dask基本就是熊猫吧？”</h1><p id="e7ef" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在开始用Dask构建东西之前，最重要的一件事是<strong class="la iu">花时间了解</strong> <a class="ae mr" rel="noopener" target="_blank" href="/the-beginners-guide-to-distributed-computing-6d6833796318"> <strong class="la iu">分布式计算的基本原理</strong> </a> <strong class="la iu">首先</strong>。</p><p id="56b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Dask API尽可能地遵循pandas API，这意味着您可以很快开始使用Dask。但是“尽可能”听起来似乎很简单。这没有告诉你的是，当你从熊猫转移到Dask时，你实际上进入了一个完全不同的宇宙——有不同的语言，不同的基本物理定律和不同的时间概念。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自gifbin.com</p></figure><p id="358f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要想在Dask中取得成功，你需要知道一些事情，比如Dask为什么“懒惰”，哪些类型的问题是“令人尴尬的并行”，以及“将分区持久化到集群内存”意味着什么。如果这些对你来说听起来像是胡言乱语，请阅读这篇<a class="ae mr" rel="noopener" target="_blank" href="/the-beginners-guide-to-distributed-computing-6d6833796318">基本分布式计算概念介绍</a>。如果这让你感到有些不知所措，也不要担心——深呼吸，记住几个月前我对这一切也几乎一无所知😉</p><p id="0aa6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好消息是，你不需要掌握任何这些新的语言或法律或概念——在大多数情况下，你可以通过对基本概念的基本理解来导航。这有点像去一个你不会说那种语言的地方度假。你不需要就当地错综复杂的政治体系进行完整的对话，就能玩得开心。但是如果你能要一部电话或者如果你需要的话问一下去你的酒店的方向，那会很有帮助。</p><h1 id="127a" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">2.“我就打电话。每当我想看到结果时，就使用compute()。</h1><p id="f7d6" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">pandas和Dask之间最明显的区别之一是，当你调用pandas数据帧时，你得到的数据帧是:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="d492" class="mz lv it mv b gy na nb l nc nd">import pandas as pd <br/>df = pd.DataFrame({ <br/>  "Name": ["Mercutio", "Tybalt", "Lady Montague"], <br/>  "Age": [3, 2, 4], <br/>  "Fur": ["Grey", "Grey", "White"] }<br/>) </span><span id="465d" class="mz lv it mv b gy ne nb l nc nd">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/b6050384a6af8c1a7450652d49852056.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/0*XxIUMC6ecf1LrsEU"/></div></figure><p id="4650" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">..然而，当您调用Dask数据帧时，您得到的是塑料包装的等价物，而不是糖果:您将看到一些关于内部内容的描述性信息，而不是数据帧的实际内容:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="de49" class="mz lv it mv b gy na nb l nc nd">import dask.dataframe as dd <br/>dask_df = dd.from_pandas(df) </span><span id="cf1d" class="mz lv it mv b gy ne nb l nc nd">dask_df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/e562d7643b8609b901d0868a57e920eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/0*bvEGuYEKpFvwzHed"/></div></figure><p id="031b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你会很快发现这是因为Dask的“懒惰评估”,如果你把<code class="fe nh ni nj mv b">.compute()</code>加到你的df调用中，你会得到你在熊猫身上习惯看到的结果。</p><p id="d94f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是你在这里要小心。达斯克懒洋洋地评价是有原因的。惰性评估允许Dask将如何得到结果的计算推迟到最后一刻——也就是说，当它拥有尽可能多的关于数据的知识以及你想从数据中得到什么的时候。然后它可以计算出最有效的方法来得到你的结果。调用<code class="fe nh ni nj mv b">.compute()</code>太频繁或太早会中断这个优化过程。这有点像在烹饪过程中吃了所有半生不熟的食材——味道不会那么好，如果你还想要最终的结果，你就必须从头再来。</p><p id="ada9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里的经验法则是:少用<code class="fe nh ni nj mv b">.compute()</code>。仅使用它来具体化您确信的结果:1)将适合您的本地内存，2)是“完全煮熟的”——换句话说，不要中途中断Dask的优化，以及3)理想情况下将在以后重用。关于<code class="fe nh ni nj mv b">compute</code>的更多细节见<a class="ae mr" href="https://coiled.io/blog/dask-compute/" rel="noopener ugc nofollow" target="_blank">本帖</a>。</p><h1 id="68da" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">3.“既然如此，咱们就。坚持()一切！”</h1><p id="a175" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">发现<code class="fe nh ni nj mv b">.compute()</code>后不久，你将了解<code class="fe nh ni nj mv b">.persist()</code>。</p><p id="1258" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">起初可能很难理解这两个命令之间的区别:这两个命令都是通过触发Dask计算来实现结果的。这个定义将帮助你区分它们:<code class="fe nh ni nj mv b">.persist()</code> <strong class="la iu">与</strong> <code class="fe nh ni nj mv b"><strong class="la iu">.compute()</strong></code> <strong class="la iu">基本相同——除了它将结果加载到集群内存而不是本地内存</strong>。如果您需要复习一下本地内存和集群内存之间的区别，请查看本文的“集群”一节。</p><p id="8f1d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可能会想——嗯，在这种情况下，我不应该什么都做吗？尤其是如果我在一个几乎无限内存的基于云的集群上工作，难道坚持不会让一切运行得更快吗？</p><p id="bdda" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">是的…直到它不存在。就像<code class="fe nh ni nj mv b">.compute()</code>一样，调用<code class="fe nh ni nj mv b">.persist()</code>告诉Dask开始计算结果(烹饪食谱)。这意味着这些结果可以在您下次需要时直接使用。但是你只有两只手，有限的工具，而且是在赶时间。仅仅在你所有的盘子里装满你以后可能需要(或者可能不需要)的烹饪原料并不一定是在正确的时间把你所有准备好的菜送到所有用餐者面前的好策略。</p><p id="2202" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当处理大量数据时，远程集群是一个很好的资源。但是即使是集群也有极限。尤其是当在生产环境中运行Dask时——集群不是免费的，而是受到严密的成本监控——您将开始更加关心如何尽可能有效地使用集群内存。</p><p id="0484" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以这里的建议和上面的相似:谨慎使用<code class="fe nh ni nj mv b">.persist()</code>。仅使用它来具体化您确信的结果:1)将适合您的集群内存，2)是“完全成熟的”——换句话说，不要中途中断Dask的优化，以及3)以后将被重用。将一个<code class="fe nh ni nj mv b">.persist()</code>调用分配给一个新变量也是最佳实践，因为调用<code class="fe nh ni nj mv b">.persist()</code>会返回新的Dask对象，由内存数据支持。</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="30c7" class="mz lv it mv b gy na nb l nc nd"># assign persisted objects to a new variable <br/>df = dd.read_parquet("s3://bucket/file.parquet") </span><span id="b927" class="mz lv it mv b gy ne nb l nc nd">df_p = df.persist()</span></pre><p id="b6ff" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">更多关于<code class="fe nh ni nj mv b">persist</code>的细节见<a class="ae mr" href="https://coiled.io/blog/dask-persist-dataframe/" rel="noopener ugc nofollow" target="_blank">本帖</a>。</p><h1 id="45b7" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">4."让我们将所有数据转储到CSV文件中！"</h1><p id="d5b4" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我们都爱我们的CSV文件。在过去的几十年里，他们为我们提供了很好的服务，我们很感激他们的服务…但是现在是让他们走的时候了。</p><p id="84bb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，您已经大胆地向分布式计算领域迈进，这意味着您可以获得全新的可能性，比如并行读取和写入文件。CSV不适合这些高级处理功能，当使用Dask时，强烈建议使用Apache Parquet文件格式。它是一种具有高压缩选项的列格式，允许您执行诸如列修剪、谓词下推过滤等操作，并避免昂贵且容易出错的模式推断。</p><p id="12f2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Dask允许您使用以下工具轻松地将CSV文件转换为拼花文件:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="c084" class="mz lv it mv b gy na nb l nc nd"># convert CSV file to Parquet using Dask <br/>df = dd.read_csv("file.csv") <br/>df.to_parquet("file.parquet")</span></pre><p id="2431" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">阅读这篇关于针对Dask分析的Parquet的优势的博客。</p><h1 id="1585" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">5.“Dask仪表板？那是什么？”</h1><p id="f1fe" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">如果你来自熊猫，你可能习惯于在等待一个单元完成时，对正在运行的代码看得很少。耐心地观察你正在运行的Jupyter笔记本电池旁边的星号是你的一个日常习惯——也许辅以进度条或<a class="ae mr" href="https://calmcode.io/chime/introduction.html" rel="noopener ugc nofollow" target="_blank">通知铃声</a>。</p><p id="6716" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Dask在这里完全改变了游戏。Dask为您提供了关于它为您运行的计算的强大而详细的可见性和诊断。您可以检查正在运行的任务的数量和类型、集群中工作器之间的数据传输、特定任务占用的内存量等等。</p><p id="ff39" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦您对Dask有了更多的了解，您将会经常使用仪表板来找出使您的代码运行得更快、更可靠的方法。例如，需要注意的一件事是出现的红色空间(数据传输)和白色空间(空闲时间)的数量——您需要最小化这两者。</p><p id="aabc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以通过以下方式获得Dask仪表板的链接:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="fad3" class="mz lv it mv b gy na nb l nc nd"># launch a local Dask cluster using all available cores <br/>from dask.distributed import Client <br/>client = Client() <br/>client.dashboard_link</span><span id="7667" class="mz lv it mv b gy ne nb l nc nd">&gt;&gt; 'http://127.0.0.1:8787/status'</span></pre><p id="9f22" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">或者使用Dask Dashboard extension for JupyterLab，<a class="ae mr" href="https://coiled.io/blog/dask-jupyterlab-workflow/" rel="noopener ugc nofollow" target="_blank">，如本文</a>所述。</p><p id="6b68" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">观看Dask的原作者Matt Rocklin的视频，了解如何更好地使用Dask Dashboard。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk mt l"/></div></figure><h1 id="2ace" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">6.“我不需要寻求帮助”</h1><p id="c0e0" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我知道我说的是5…但是这里有一个“额外的错误”,这可能是成功学习如何使用Dask的最重要的关键之一。</p><p id="a3f4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">想要自己先尝试一些事情是令人钦佩的(也是很好的实践)。但是当你需要帮助的时候，不要害怕伸出手去寻求帮助。无论何时，只要你想更详细地讨论任何事情，并从多年来一直在构建和维护Dask的工程师那里获得信息，Dask话语就是你要去的地方。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/a9cf1c3f5b8d1ddb6a6cad3d32457493.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Iwrq1hHKv6UMKRlz.png"/></div></figure><h1 id="ac9f" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">下一步是什么？</h1><p id="f662" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">现在，您已经很好地避免了人们在加入Dask时最常犯的错误。对于任何认真探索分布式计算可能性的人来说，公开的<a class="ae mr" href="https://github.com/coiled/dask-mini-tutorial" rel="noopener ugc nofollow" target="_blank"> Dask教程</a>是一个很好的下一步。</p><p id="3968" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦你掌握了基础知识，你可以在下面找到使用Dask完成更高级的ETL、数据分析和机器学习任务的资源:</p><ul class=""><li id="0e06" class="nm nn it la b lb lc le lf lh no ll np lp nq lt nr ns nt nu bi translated">将Dask数据帧转换成pandas数据帧，或者反过来转换</li><li id="6dec" class="nm nn it la b lb nv le nw lh nx ll ny lp nz lt nr ns nt nu bi translated"><a class="ae mr" href="https://coiled.io/blog/dask-dataframe-merge-join/" rel="noopener ugc nofollow" target="_blank">合并</a> Dask数据帧</li><li id="e81a" class="nm nn it la b lb nv le nw lh nx ll ny lp nz lt nr ns nt nu bi translated"><a class="ae mr" href="https://coiled.io/blog/dask-xgboost-python-example/" rel="noopener ugc nofollow" target="_blank">与Dask并行训练XG boost</a></li></ul><p id="8688" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">祝你Dask之旅好运！</p></div><div class="ab cl oa ob hx oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="im in io ip iq"><p id="55b6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢您的阅读！<a class="ae mr" href="https://www.linkedin.com/in/richard-pelgrim/" rel="noopener ugc nofollow" target="_blank">在LinkedIn上关注我</a>,了解定期的分布式计算更新和技巧。</p><p id="fbc1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请考虑成为支持写作社区的媒体成员:</p><div class="oh oi gp gr oj ok"><a href="https://richardpelgrim.medium.com/membership" rel="noopener follow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">使用此推荐链接加入媒体</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">richardpelgrim.medium.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy ks ok"/></div></div></a></div></div><div class="ab cl oa ob hx oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="im in io ip iq"><p id="24a6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="oz">原载于2022年2月10日</em><a class="ae mr" href="https://coiled.io/blog/common-dask-mistakes/" rel="noopener ugc nofollow" target="_blank"><em class="oz">https://coiled . io</em></a><em class="oz">。</em></p></div></div>    
</body>
</html>