<html>
<head>
<title>Run Your Python App Anywhere With Dynamic Settings</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用动态设置在任何地方运行Python应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/run-your-python-app-anywhere-with-dynamic-settings-aafd27e04b8e#2022-05-30">https://towardsdatascience.com/run-your-python-app-anywhere-with-dynamic-settings-aafd27e04b8e#2022-05-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/abe59f13c97dbf934d60cb39348b8d05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2uDicmdib76WMkPWchCd_w.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图片来自<a class="ae jg" href="https://pixabay.com/users/pavlofox-514753/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1452987" rel="noopener ugc nofollow" target="_blank"> Pavlofox </a>来自<a class="ae jg" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1452987" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure><div class=""/><div class=""><h2 id="1bb9" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">使用配置文件参数化您的应用程序，并使用ConfigParser读取</h2></div><p id="da27" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当我们使用Python编写应用程序时，我们可能希望它能够在不同的环境中运行。或者，我们希望它在运行时有不同的行为。也就是说，参数化这个应用程序，而不是硬编码一切，因为我们不想改变代码来适应情况。</p><p id="910b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这可以通过多种方式实现。一种常见的方法是给程序添加参数。这是我以前的一篇文章，详细介绍了这种方法。</p><div class="is it gp gr iu lu"><a rel="noopener follow" target="_blank" href="/typer-probably-the-simplest-to-use-python-command-line-interface-library-17abf1a5fd3e"><div class="lv ab fo"><div class="lw ab lx cl cj ly"><h2 class="bd jk gy z fp lz fr fs ma fu fw ji bi translated">typer——可能是最容易使用的Python命令行接口库</h2><div class="mb l"><h3 class="bd b gy z fp lz fr fs ma fu fw dk translated">它站在一个巨人的肩膀上——点击</h3></div><div class="mc l"><p class="bd b dl z fp lz fr fs ma fu fw dk translated">towardsdatascience.com</p></div></div><div class="md l"><div class="me l mf mg mh md mi ja lu"/></div></div></a></div><p id="8a14" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，使用参数的局限性也是显而易见的。</p><ul class=""><li id="0d71" class="mj mk jj la b lb lc le lf lh ml ll mm lp mn lt mo mp mq mr bi translated">当我们运行程序时，添加大量的参数是不实际的。</li><li id="9f42" class="mj mk jj la b lb ms le mt lh mu ll mv lp mw lt mo mp mq mr bi translated">运行时不能更改初始化参数。我们必须重新运行程序来改变参数。</li><li id="af68" class="mj mk jj la b lb ms le mt lh mu ll mv lp mw lt mo mp mq mr bi translated">保留值或参数对用户不友好。所以，不容易和别人分享。</li></ul><p id="4e51" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当我们至少满足上面的一个约束时，值得考虑使用配置文件。所以，所有的参数都可以物理化成一个文本文件。</p><p id="c757" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我将介绍Python内置模块之一，名为<code class="fe mx my mz na b">configparser</code>。它将使我们能够开箱即用地读取和写入配置文件。</p><h1 id="a916" class="nb nc jj bd nd ne nf ng nh ni nj nk nl kp nm kq nn ks no kt np kv nq kw nr ns bi translated">1.写入配置文件</h1><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/dac08f2db51000cf6de22494692e4c45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZEPlpco_QABkkYHOiVVlmA.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图片来自<a class="ae jg" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2291916" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure><p id="6e2d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从读取配置文件开始会更有意义。但是，如果你熟悉我的写作风格，你就会知道，我总是尽量写出可以按顺序进行的文章。因此，我们可以从这个实验开始，首先将配置写入文件。</p><p id="568c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于<code class="fe mx my mz na b">configparser</code>是Python 3内置的，所以我们只需要导入它并开始使用它。不需要下载和安装任何东西。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="d942" class="ob nc jj na b gy oc od l oe of">import configparser</span><span id="c27c" class="ob nc jj na b gy og od l oe of">config = configparser.ConfigParser()</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oh"><img src="../Images/14c08b6942e241cd8a305b0ce53c2457.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*oZopkD2HhghGZD7hLpFApg.png"/></div></div></figure><p id="7e38" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里，我们使用模块中的<code class="fe mx my mz na b">ConfigParser</code>类初始化一个名为<code class="fe mx my mz na b">config</code>的对象。因此，我们得到了一个配置对象。</p><h2 id="537d" class="ob nc jj bd nd oi oj dn nh ok ol dp nl lh om on nn ll oo op np lp oq or nr os bi translated">1.1建立一个配置对象</h2><p id="d7a9" class="pw-post-body-paragraph ky kz jj la b lb ot kk ld le ou kn lg lh ov lj lk ll ow ln lo lp ox lr ls lt im bi translated">当我们使用一个<code class="fe mx my mz na b">config</code>物体时，和使用字典没有太大的区别。当我们想给对象添加一些配置项时，可以像这样添加。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="b744" class="ob nc jj na b gy oc od l oe of">config['PERSON'] = {<br/>    'name': 'Christopher Tao',<br/>    'age': '34'<br/>}</span></pre><p id="613a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">“顶层”键<code class="fe mx my mz na b">PERSON</code>将被视为配置文件的一部分。对于<code class="fe mx my mz na b">PERSON</code>部分，我们定义了一个包含两个条目的字典。然后，我们可以尝试将这个配置对象写入一个文本文件，如下所示。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="ce76" class="ob nc jj na b gy oc od l oe of">with open('settings.cfg', 'w') as configfile:<br/>    config.write(configfile)</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oy"><img src="../Images/29e20af6e4b8eeb6868b35e118bb2383.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hDJjrAHKsOIlIRNXefymhw.png"/></div></div></figure><p id="c32c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是我们刚刚写好的文件。</p><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/67772d443982c195ea1adc61dbb783d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*jJqBfGTRKmDhe3OJjcfjLA.png"/></div></figure><p id="2438" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就是这样！当然，我们不必一次性提供整个词典。按如下方式逐步构建配置部分是完全没问题的。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="3f5c" class="ob nc jj na b gy oc od l oe of">config['RUN_PARAMETERS'] = {}<br/>config['RUN_PARAMETERS']['start_time'] = '2020-05-01 00:00:00'<br/>config['RUN_PARAMETERS']['end_time'] = '2020-05-31 00:00:00'<br/>config['RUN_PARAMETERS']['frequency_min'] = '10'<br/>config['RUN_PARAMETERS']['is_active'] = 'True'</span><span id="46c5" class="ob nc jj na b gy og od l oe of">with open('settings.cfg', 'w') as configfile:<br/>    config.write(configfile)</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pa"><img src="../Images/a04f23d37093303f0cca1f4f35b01d0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Fn6ll69sMP3pQ9wDPryTQ.png"/></div></div></figure><p id="70d1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，该文件将被追加新的部分。</p><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/3587931cae505599d566c4f139afa8f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*LGlBY6b7OziZaNU7ygacPg.png"/></div></figure><h2 id="2a4d" class="ob nc jj bd nd oi oj dn nh ok ol dp nl lh om on nn ll oo op np lp oq or nr os bi translated">1.2配置值必须是字符串</h2><p id="b28b" class="pw-post-body-paragraph ky kz jj la b lb ot kk ld le ou kn lg lh ov lj lk ll ow ln lo lp ox lr ls lt im bi translated">然而，与实际的字典相比，一些约束是有目的地添加到配置对象中的。例如，值得一提的是，所有的配置值都必须是字符串。如果我们试图给一个非字符串值如下，它会抱怨。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="2422" class="ob nc jj na b gy oc od l oe of"># Must be string<br/>config['RUN_PARAMETERS']['is_active'] = True</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pc"><img src="../Images/af3d4f4db7b0f82f7b592d99f83f250b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8m0BUYyqJ4aRmegHxfucQw.png"/></div></div></figure><p id="dd8a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是有意义的，因为所有的配置值稍后将被写入一个文本文件。强制使用字符串值会降低出错的可能性，保持一致性。</p><h1 id="4797" class="nb nc jj bd nd ne nf ng nh ni nj nk nl kp nm kq nn ks no kt np kv nq kw nr ns bi translated">2.从配置文件中读取</h1><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/079d3d67a04e1627bd9ae511c11130b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lbE6G4g2VVny9ZJspkQYSA.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图片来自<a class="ae jg" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1236578" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae jg" href="https://pixabay.com/users/mustangjoe-2162920/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1236578" rel="noopener ugc nofollow" target="_blank"> MustangJoe </a></p></figure><p id="7702" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们可以进入今天的主题了。从配置文件中读取。请注意，文本文件的扩展名并不重要，甚至作为内容的键值对的格式也不重要，这将在本节中详细介绍。</p><h2 id="b3ee" class="ob nc jj bd nd oi oj dn nh ok ol dp nl lh om on nn ll oo op np lp oq or nr os bi translated">2.1读取配置对象的参数</h2><p id="6c7e" class="pw-post-body-paragraph ky kz jj la b lb ot kk ld le ou kn lg lh ov lj lk ll ow ln lo lp ox lr ls lt im bi translated">在我们想从配置文件中读取之前，我们还需要一个<code class="fe mx my mz na b">config</code>对象。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="596c" class="ob nc jj na b gy oc od l oe of">config = configparser.ConfigParser()</span><span id="d1e5" class="ob nc jj na b gy og od l oe of">config.read('settings.cfg')</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pd"><img src="../Images/a04da5ffa832291f57c31c57f53abd18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wYM3Sa7QCaxkbX7z_FaaKA.png"/></div></div></figure><p id="e0c5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">函数将返回一个列表中的配置文件名。这是因为<code class="fe mx my mz na b">configparser</code>可以将多个配置文件读入一个对象。一旦我们已经阅读了项目，我们也可以使用<code class="fe mx my mz na b">sections()</code>功能检查所有部分。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="f463" class="ob nc jj na b gy oc od l oe of">config.sections()</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/f60bd91f407a7af0fc01956befbba178.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*weSII24RH0lUjx3lkpGGxw.png"/></div></figure><p id="ad41" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您没有跳过前面的部分，您可以很容易地获得我们已经写入配置文件的参数。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="260f" class="ob nc jj na b gy oc od l oe of">print(config['PERSON']['name'])<br/>print(config['PERSON']['age'])<br/>print(config['RUN_PARAMETERS']['start_time'])<br/>print(config['RUN_PARAMETERS']['is_active'])</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pf"><img src="../Images/e77e260555987e316c763a940042190f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fiMUI3A-WLPE58ZSeSa5fQ.png"/></div></div></figure><h2 id="74d9" class="ob nc jj bd nd oi oj dn nh ok ol dp nl lh om on nn ll oo op np lp oq or nr os bi translated">2.2读取数据类型的参数</h2><p id="f5f7" class="pw-post-body-paragraph ky kz jj la b lb ot kk ld le ou kn lg lh ov lj lk ll ow ln lo lp ox lr ls lt im bi translated">配置文件中有一些非字符串参数是很常见的，比如integer、float或boolean。没有什么可以阻止您将它们读入字符串，然后将它们转换成应该的数据类型。类似下面的内容。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="5dc3" class="ob nc jj na b gy oc od l oe of">int(config['PERSON']['age'])</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pg"><img src="../Images/1f0472ed20d75de11392b7488bd9db47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CxhiMwCLppXGU2BkunFwsw.png"/></div></div></figure><p id="cb54" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，<code class="fe mx my mz na b">configparser</code>允许我们将值读入特定的数据类型，而不需要额外的转换步骤。例如，<code class="fe mx my mz na b">getint()</code>方法将读取整数形式的值，而<code class="fe mx my mz na b">getboolean()</code>方法将它们读入bool类型。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="5e50" class="ob nc jj na b gy oc od l oe of">print(config['PERSON'].getint('age'))<br/>type(config['PERSON'].getint('age'))</span><span id="1cbb" class="ob nc jj na b gy og od l oe of">print(config['RUN_PARAMETERS'].getboolean('is_active'))<br/>type(config['RUN_PARAMETERS'].getboolean('is_active'))</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ph"><img src="../Images/052efa43480f46683338e332ccc2e552.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nu-Hk-wuTkpu-z5PzZ9EeQ.png"/></div></div></figure><h2 id="291d" class="ob nc jj bd nd oi oj dn nh ok ol dp nl lh om on nn ll oo op np lp oq or nr os bi translated">2.3回退值</h2><p id="f805" class="pw-post-body-paragraph ky kz jj la b lb ot kk ld le ou kn lg lh ov lj lk ll ow ln lo lp ox lr ls lt im bi translated">有时，配置文件本身也可能是动态的。期望的功能之一是，我们可能希望用户只需要添加必要的参数，而不是一切。但是，对于那些不存在的参数，它会引发一个<code class="fe mx my mz na b">KeyError</code>。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="719e" class="ob nc jj na b gy oc od l oe of"># Fallback Values<br/>config['PERSON']['middle_name']</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pc"><img src="../Images/0a6d3e22b40de5ec8ae0f5e29d3ac696.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BppFhDKBZurE_xvlfgmA-Q.png"/></div></div></figure><p id="99e2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">解决方案与普通词典非常相似。我们可以使用<code class="fe mx my mz na b">get()</code>函数来获取键的值，并在没有值时提供一个后备值。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="845b" class="ob nc jj na b gy oc od l oe of">config['PERSON'].get('name', '')<br/>config['PERSON'].get('middle_name', '')</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pi"><img src="../Images/b9aa3127cb6b9cc4c84e36321524c985.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SjBI2gABwKOJ_eCO6jc3Sw.png"/></div></div></figure><p id="4139" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上面的例子中，当我们试图获取<code class="fe mx my mz na b">name</code>时，它存在，因此我们可以取回值，而键<code class="fe mx my mz na b">middle_name</code>不存在，因此空字符串将被用作回退值。</p><h2 id="8371" class="ob nc jj bd nd oi oj dn nh ok ol dp nl lh om on nn ll oo op np lp oq or nr os bi translated">2.4多级价值获取</h2><p id="8b67" class="pw-post-body-paragraph ky kz jj la b lb ot kk ld le ou kn lg lh ov lj lk ll ow ln lo lp ox lr ls lt im bi translated">我们还可以使用<code class="fe mx my mz na b">get()</code>方法直接从config对象中获取键值，这意味着我们也可以将节名放入方法中。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="63d7" class="ob nc jj na b gy oc od l oe of"># Multilevel<br/>config.get('PERSON', 'name')</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/88268294098912f40bca5f8e369b3b1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*6GjOF4G_1PwZiLB7zgT1rQ.png"/></div></figure><p id="30ac" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当我们使用上面的<code class="fe mx my mz na b">get()</code>方法时，我们也可以显式地定义fallback值，如下所示。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="a78e" class="ob nc jj na b gy oc od l oe of">config.get('PERSON', 'middle_name', fallback='I do not have middle name')</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pk"><img src="../Images/ac75f6c14d1e730dc2a232c08366e0ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VLUU792DVJm5FG-8x7yF5g.png"/></div></div></figure><p id="5551" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">值得一提的是，多级特性也可以与“获取数据类型”方法一起使用。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="fb52" class="ob nc jj na b gy oc od l oe of">print(config.getint('PERSON', 'age'))<br/>type(config.getint('PERSON', 'age'))</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pl"><img src="../Images/1f6a2f97af1a6a173e8f4a5050594810.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5rJsN_HhYOzou9l90Grh8Q.png"/></div></div></figure><h2 id="76d0" class="ob nc jj bd nd oi oj dn nh ok ol dp nl lh om on nn ll oo op np lp oq or nr os bi translated">2.5检查密钥是否存在</h2><p id="ad24" class="pw-post-body-paragraph ky kz jj la b lb ot kk ld le ou kn lg lh ov lj lk ll ow ln lo lp ox lr ls lt im bi translated">最后，就像Python字典一样，我们也可以检查一个键是否存在于一个节中，如下所示。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="a24b" class="ob nc jj na b gy oc od l oe of"># Check key<br/>'name' in config['PERSON']<br/>'middle_name' in config['PERSON']</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/544825847c5066ebee57a7cdfc4c462a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*lu7P3NP_jJMMd_J8TSH8sQ.png"/></div></figure><h1 id="432c" class="nb nc jj bd nd ne nf ng nh ni nj nk nl kp nm kq nn ks no kt np kv nq kw nr ns bi translated">3.默认部分</h1><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/17bb77b8376cbba2cb06da444c37599b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ah-mfevVPKoBOpSA6qD4fw.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图片来自<a class="ae jg" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=444493" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae jg" href="https://pixabay.com/users/blickpixel-52945/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=444493" rel="noopener ugc nofollow" target="_blank">迈克尔·施瓦森伯格</a></p></figure><p id="26f3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe mx my mz na b">configparser</code>中有一个神奇的版块，就是<code class="fe mx my mz na b">DEFAULT</code>版块。当配置文件有默认节时，可以从任何节访问该值。</p><p id="d102" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们通过将<code class="fe mx my mz na b">DEFAULT</code>部分写入配置文件来构建一个示例。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="fa31" class="ob nc jj na b gy oc od l oe of">config['DEFAULT'] = {<br/>    'version': '1.0',<br/>    'author': 'Christopher Tao'<br/>}</span><span id="a416" class="ob nc jj na b gy og od l oe of">with open('settings.cfg', 'w') as configfile:<br/>    config.write(configfile)</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/ee917b442a60be532883dce1649936bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*51UiFqM3glQcKHW1TI2Jyg.png"/></div></figure><p id="e4d8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，如果我们试图列出config对象中的所有部分，我们会发现默认部分不会在那里。</p><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div class="gh gi po"><img src="../Images/a428bcaf6bb7bae51e8712de28c384ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*iqNx8XKjhHbojhJbCMb_yw.png"/></div></figure><p id="15fe" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是，可以证明它肯定是存在的。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="e7a5" class="ob nc jj na b gy oc od l oe of">for key in config['DEFAULT']:<br/>    print(key, '=', config['DEFAULT'][key])</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pp"><img src="../Images/c018955d687363a6f2bd36f09a92a9a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Snt-dNUJkCLJl1bMlrXWoQ.png"/></div></div></figure><p id="ec7b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是<code class="fe mx my mz na b">configparser</code>默认部分的特性，正如我之前所说的，默认部分中的项目可以从任何其他部分访问。如果我们尝试在其他两个部分列出所有的键值对，我们会发现它们都存在。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="3f1c" class="ob nc jj na b gy oc od l oe of">for key in config['PERSON']:<br/>    print(key, '=', config['PERSON'][key])</span><span id="889c" class="ob nc jj na b gy og od l oe of">for key in config['RUN_PARAMETERS']:<br/>    print(key, '=', config['RUN_PARAMETERS'][key])</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pq"><img src="../Images/c0494b921b57059315d9c3781bec88d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YwCijbsKe-A4Ztq5eO9J0w.png"/></div></div></figure><h1 id="329d" class="nb nc jj bd nd ne nf ng nh ni nj nk nl kp nm kq nn ks no kt np kv nq kw nr ns bi translated">4.支持的键值对格式</h1><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/017b4c0d3b58e48d78bde7e372c63435.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_tYSdBmaAYn-WWdplD1OJw.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图片来自<a class="ae jg" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=444499" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae jg" href="https://pixabay.com/users/blickpixel-52945/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=444499" rel="noopener ugc nofollow" target="_blank">迈克尔·施瓦森伯格</a></p></figure><p id="d5f3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对键值属性使用等号<code class="fe mx my mz na b">=</code>在配置文件中很常见。然而，在不同的标准中确实使用了其他格式。<code class="fe mx my mz na b">configparser</code>模块的美妙之处在于我们可以发现它支持几乎所有的流行风格。</p><p id="ac9a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们如下定义另一个配置文件。然后，命名为<code class="fe mx my mz na b">examples.cfg</code>。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="a62b" class="ob nc jj na b gy oc od l oe of">[Equal With Padding]<br/>name = Christopher Tao</span><span id="dc68" class="ob nc jj na b gy og od l oe of">[Equal]<br/>name=Christopher Tao</span><span id="1d8f" class="ob nc jj na b gy og od l oe of">[Colon]<br/>name: Christopher Tao</span><span id="e3a0" class="ob nc jj na b gy og od l oe of">[Multiline]<br/>name = Christopher <br/>Tao</span><span id="d937" class="ob nc jj na b gy og od l oe of">[No Values]<br/>key_without_value<br/>empty key =</span><span id="17ed" class="ob nc jj na b gy og od l oe of">[Comments]<br/># This is comment<br/>; This is comment, too</span><span id="79f0" class="ob nc jj na b gy og od l oe of"># Empty line is OK</span><span id="96eb" class="ob nc jj na b gy og od l oe of">    [Indented Section]<br/>        name=Christopher Tao</span></pre><p id="3c33" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这个示例配置文件中，混合了多种不同的样式。如果我们尝试读取文件，所有的场景都可以处理得很好。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="ac2f" class="ob nc jj na b gy oc od l oe of">config = configparser.ConfigParser()<br/>config.read('examples.cfg')<br/>config.sections()</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pr"><img src="../Images/e69b0676f9c0e86792b069025ca13534.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HG6mbupBGMpNnkCX-cV22A.png"/></div></div></figure><p id="69fe" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">等号和冒号都可以。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="ceca" class="ob nc jj na b gy oc od l oe of"># name=Christopher Tao<br/>config['Equal']['name']</span><span id="6dcc" class="ob nc jj na b gy og od l oe of"># name: Christopher Tao<br/>config['Colon']['name']</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/0e8aa32dce247737aa5f915c13b0eb1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*Tm1Yzg4rTmoHDBVmg8ygkQ.png"/></div></figure><p id="293c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当值中存在换行符时，可以正确捕获。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="2ffc" class="ob nc jj na b gy oc od l oe of"># name = Christopher <br/># Tao<br/>config['Multiline']['name']</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div class="gh gi pt"><img src="../Images/b8c8561e044f04e51427b218b105b85e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*C8YgOB6HviWmHu3lM8OueA.png"/></div></figure><p id="c778" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有评论的时候会忽略。因此，对于[Comments]部分，不存在键值对。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="77ca" class="ob nc jj na b gy oc od l oe of"># [Comments]<br/># # This is comment<br/># ; This is comment, too<br/># # Empty line is OK<br/>len(config['Comments'])</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div class="gh gi pu"><img src="../Images/2b0d60116f15153f3992909e22d04002.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*rLS2hHT3rxRfR72RaoEsfA.png"/></div></figure><p id="5129" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果一个节是缩进的，或者在节头或键的前面有意外的空格，就不会有任何问题。</p><pre class="nt nu nv nw gt nx na ny nz aw oa bi"><span id="566c" class="ob nc jj na b gy oc od l oe of">#     [Indented Section]<br/>#         name=Christopher Tao<br/>config['Indented Section']['name']</span></pre><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pv"><img src="../Images/d2a924cf18f84ea6286a5e8fe30cf14c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*HMh-D-DmpnpiqmijfgzVqQ.png"/></div></div></figure><h1 id="08ff" class="nb nc jj bd nd ne nf ng nh ni nj nk nl kp nm kq nn ks no kt np kv nq kw nr ns bi translated">摘要</h1><figure class="nt nu nv nw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/b03d1f0d0eb826beb73567b51198616f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ys9uGOIBpYoXbScdy5mEHA.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图片来自<a class="ae jg" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1197800" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae jg" href="https://pixabay.com/users/noel_bauza-2019050/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1197800" rel="noopener ugc nofollow" target="_blank">诺尔·包萨</a></p></figure><p id="2ab0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我介绍了一个名为<code class="fe mx my mz na b">configparser</code>的Python内置库。它允许我们动态地从文本文件中读取和写入参数。它还提供了许多现成的特性，例如将值读入某些数据类型和回退值。它还支持多种键值对格式，可以很好地处理注释、空键和无用的缩进。</p><div class="is it gp gr iu lu"><a href="https://medium.com/@qiuyujx/membership" rel="noopener follow" target="_blank"><div class="lv ab fo"><div class="lw ab lx cl cj ly"><h2 class="bd jk gy z fp lz fr fs ma fu fw ji bi translated">通过我的推荐链接加入灵媒-陶</h2><div class="mb l"><h3 class="bd b gy z fp lz fr fs ma fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="mc l"><p class="bd b dl z fp lz fr fs ma fu fw dk translated">medium.com</p></div></div><div class="md l"><div class="pw l mf mg mh md mi ja lu"/></div></div></a></div><p id="7f4a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你觉得我的文章有帮助，请考虑加入Medium会员来支持我和成千上万的其他作者！(点击上面的链接)</p><blockquote class="px"><p id="717c" class="py pz jj bd qa qb qc qd qe qf qg lt dk translated"><em class="qh">除非另有说明，所有图片均出自作者之手</em></p></blockquote></div></div>    
</body>
</html>