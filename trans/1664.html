<html>
<head>
<title>How to Develop and Test Your Google Cloud Function Locally</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在本地开发和测试您的谷歌云功能</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-develop-and-test-your-google-cloud-function-locally-96a970da456f#2022-04-20">https://towardsdatascience.com/how-to-develop-and-test-your-google-cloud-function-locally-96a970da456f#2022-04-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="31ec" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">因此，您已经编写了无服务器云功能，但不想浪费时间部署它并希望它能工作。让我向您展示如何在本地开发和测试您的云功能。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c58e482dfdff6a9ef6e93ce150d6828a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XOjpR53RPAD_9EQk"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">托马斯·索贝克在Unsplash<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">拍摄的照片</a></p></figure><h1 id="cb09" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">快速介绍:云函数</h1><p id="ee28" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果你正在阅读这篇文章，我相信你已经知道什么是谷歌云功能。但以防万一，这是一个无服务器的计算产品，它允许你编写函数，当附加到它的事件被触发时，这些函数就会被触发。</p><p id="acfe" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">由于这是一项无服务器服务，我们不必担心设置或管理服务器或任何基础设施。这种产品也被称为功能即服务(FaaS)。查看以下文章，了解更多信息，并了解如何在生产中使用它:</p><div class="ms mt gp gr mu mv"><a rel="noopener follow" target="_blank" href="/machine-learning-model-as-a-serverless-endpoint-using-google-cloud-function-a5ad1080a59e"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">使用谷歌云功能作为无服务器端点的机器学习模型</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">因此，你已经建立了一个模型，并希望将其生产为谷歌云平台(GCP)上的无服务器解决方案。让我…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">towardsdatascience.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj ks mv"/></div></div></a></div><p id="c35c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">绕远路之后，让我们回到我们为什么在这里。</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="0d34" class="kz la it bd lb lc nr le lf lg ns li lj jz nt ka ll kc nu kd ln kf nv kg lp lq bi translated">本地开发设置</h1><p id="07bd" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要在本地开发云功能，我们需要安装<a class="ae ky" href="https://cloud.google.com/functions/docs/functions-framework" rel="noopener ugc nofollow" target="_blank">功能框架</a>。functions框架允许我们快速启动本地开发服务器进行测试。您可以在本地调用该函数，它会像在生产环境中一样做出响应。</p><p id="56d2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">唯一的区别是在本地完成它允许我们快速调试和迭代，而不是等待很长时间来部署它，然后发现是否有错误！是的，部署需要很长时间！😅</p><p id="5879" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在我们安装之前，请确保创建一个虚拟环境来处理项目。为什么？因为这是一个很好的实践，尤其是当你打算生产它的时候。这适用于任何python项目，而不仅仅是这个项目。</p><p id="cb5d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如您所知，云功能需要两个文件:</p><ul class=""><li id="c7f1" class="nw nx it lt b lu mn lx mo ma ny me nz mi oa mm ob oc od oe bi translated"><strong class="lt iu"> main.py: </strong>其中函数的主代码是。</li><li id="49ed" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated"><strong class="lt iu"> requirements.txt: </strong>需要安装的所有库的列表，以使函数工作。</li></ul><p id="5bc6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一旦我们的功能为生产做好准备，创建虚拟环境将允许我们轻松地创建<em class="ok">需求</em>文件。例如，在conda虚拟环境中，我可以运行以下代码来生成需求文件:<code class="fe ol om on oo b">pip list --format=freeze &gt; requirements.txt</code></p><p id="df02" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">说完这些，让我们从一些代码开始。💻</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="c8f3" class="kz la it bd lb lc nr le lf lg ns li lj jz nt ka ll kc nu kd ln kf nv kg lp lq bi translated">地方发展步骤</h1><p id="df5b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">按照以下步骤在本地开发和测试云功能:</p><h2 id="fad4" class="op la it bd lb oq or dn lf os ot dp lj ma ou ov ll me ow ox ln mi oy oz lp pa bi translated">步骤0:目录和虚拟环境</h2><p id="5c3d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为云功能项目创建一个虚拟环境和一个目录。我在虚拟环境中使用conda作为Anaconda安装的一部分。</p><ul class=""><li id="04e6" class="nw nx it lt b lu mn lx mo ma ny me nz mi oa mm ob oc od oe bi translated">在Windows机器上，在命令行中使用<code class="fe ol om on oo b">mkdir YOUR_DIRECTORY_NAME</code>创建目录。</li><li id="aa11" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated">对于公寓虚拟环境，使用<code class="fe ol om on oo b">conda create --name YOUR_ENV_NAME python=3.8</code>用python版创建一个虚拟环境。</li><li id="4566" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated">要激活环境，使用<code class="fe ol om on oo b">conda activate YOUR_ENV_NAME</code>。</li></ul><p id="0b47" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> ⚠️ <em class="ok">注:</em> </strong> <em class="ok">如果你不关心虚拟环境和项目间的分隔，忽略步骤0。第一步是导入的开始！</em></p><h2 id="fc16" class="op la it bd lb oq or dn lf os ot dp lj ma ou ov ll me ow ox ln mi oy oz lp pa bi translated">步骤1:安装功能框架</h2><p id="47e9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">使用以下内容安装函数框架:</p><p id="e16e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe ol om on oo b">pip install functions-framework</code></p><h2 id="afb7" class="op la it bd lb oq or dn lf os ot dp lj ma ou ov ll me ow ox ln mi oy oz lp pa bi translated"><strong class="ak">第二步:功能代码主文件</strong></h2><p id="62a1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">像平常一样，在工作目录中为云函数创建一个<em class="ok"> main.py </em>文件。出于本文的目的，我创建了一个示例文件<em class="ok"> main.py </em>。</p><p id="2185" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">它所做的只是检查是否发送了任何JSON有效载荷，并尝试提取作为有效载荷一部分发送的名称。然后它会对名字打招呼。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pb pc l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用hello响应JSON有效负载的云函数。(来源:作者)</p></figure><h2 id="87cf" class="op la it bd lb oq or dn lf os ot dp lj ma ou ov ll me ow ox ln mi oy oz lp pa bi translated">步骤3:启动本地开发服务器</h2><p id="94cc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在与<em class="ok"> main.py </em>文件相同的目录下，在命令行/终端中运行以下命令来启动一个开发服务器，为您的云功能服务:<code class="fe ol om on oo b">functions_framework --target=say_hello</code></p><p id="6ba8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">上面的代码将main.py文件加载到开发服务器中，并指向<em class="ok"> say_hello </em>作为入口点函数。</p><p id="0d9f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您现在应该能够调用这个函数了，它在您的本地主机上可用，很可能在端口8080上。(http://localhost:8080)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/fc4109735cada6b674d46ef31db68cdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UIzjkeZWJ1haFi8jiWYMbQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">本地机器上运行的云函数。使用虚拟环境(func_local)。(来源:作者)</p></figure><p id="b3cc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">请注意，这类似于在云中部署该功能。如果有一个库没有安装在本地环境中(类似于在生产环境中requirements.txt文件中没有它)，服务器将抛出一个错误，就像在生产环境中一样。</p><p id="a009" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">例如，我知道在我的虚拟环境中没有安装XGBoost库。如果我现在编辑<em class="ok"> main.py </em>来添加<code class="fe ol om on oo b">import xgboost</code>，保存文件，并通过重新运行上面的代码来重启服务器，它应该会抛出一个错误。为了本地部署成功，我需要在我的虚拟环境中安装这个库。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/8b908c43ad9800a2e374ea7fe497f3fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nD_b54jjXNeG4Vleke0_6A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在编辑main.py文件以导入XGBoost后，当我尝试再次启动服务器时出错。(来源:作者)</p></figure><p id="e7c0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">好了，现在我们已经运行了开发服务器，我们需要调用这个函数。</p><h2 id="93a2" class="op la it bd lb oq or dn lf os ot dp lj ma ou ov ll me ow ox ln mi oy oz lp pa bi translated">步骤4:调用本地部署的函数</h2><p id="6708" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">调用该函数类似于您通常会做的事情。您所要做的就是指向正确的HTTP端点。在这种情况下，端点位于本地主机上。您可以使用cURL或python中的请求库来调用该函数。</p><p id="54b9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">出于本文的目的，我编写了一个调用本地部署的云函数的invoker函数。它只传递我的名字作为键<em class="ok"> hello的值。</em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="0f7b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当您运行上面的代码(<code class="fe ol om on oo b">&gt; python local_func_invoker.py</code>)时，您应该会看到它打印出<code class="fe ol om on oo b">hello saed</code>，这是来自本地部署的云函数的响应。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/8b61e71864e491de724dfd42f90222a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*tTmTf_DMOhxI1MGhJo3pFg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">调用本地部署的云函数并打印其响应。(来源:作者)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/ec3da558dfac7b2a7dd56f80f2a84dc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*klD6af0DcJFGmhITdKVEgA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">函数框架开发服务器响应传入的请求。(来源:作者)</p></figure><p id="f78e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">瞧！现在，您已经了解了在本地开发和测试Google Cloud功能所需的一切。</p><p id="beb4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> ⚠️ <em class="ok">注意:</em> </strong> <em class="ok">如果您使用前面提到的方法从虚拟环境中生成requirments.txt文件，请确保删除functions_framework库，因为我们不需要在生产中安装它。Google Cloud Functions产品就是建立在这个框架之上的！</em>😄</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="305e" class="kz la it bd lb lc nr le lf lg ns li lj jz nt ka ll kc nu kd ln kf nv kg lp lq bi translated">最后的想法</h1><p id="9a16" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">至少可以说，在等待谷歌云部署很长时间之后，试图在生产中调试它是令人沮丧的。在本文中，我们学习了如何在本地机器上开发和测试Google Cloud功能。</p><p id="2b47" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">有很多方法可以定制函数框架，为了简洁起见，我没有介绍。我强烈推荐查看这个框架的<a class="ae ky" href="https://cloud.google.com/functions/docs/functions-framework" rel="noopener ugc nofollow" target="_blank">页面</a>和这个框架的python版本的<a class="ae ky" href="https://github.com/GoogleCloudPlatform/functions-framework-python" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>。</p><p id="f52c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们简要介绍了在任何本地开发中使用虚拟环境的最佳实践。这非常有用，尤其是对于生成生产中需要的<em class="ok"> requirements.txt </em>文件。</p><p id="330a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">恭喜你！！您现在知道如何在本地开发和测试您的Google Cloud功能，并在转移到生产时节省大量时间和麻烦。🎊</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><p id="bd17" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">🚀希望这篇文章对你有用。</strong> <strong class="lt iu">如果你愿意支持我，可以考虑使用我的</strong> <a class="ae ky" href="https://saedhussain.medium.com/membership" rel="noopener"> <strong class="lt iu">推荐链接</strong> </a> <strong class="lt iu">加入medium。</strong></p><p id="bb1a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">这样你就可以在这个平台上看到我所有的文章以及更多来自其他优秀作者的文章！😄</strong></p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><p id="9da0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><em class="ok">您可能喜欢的其他文章:</em></p><div class="ms mt gp gr mu mv"><a rel="noopener follow" target="_blank" href="/how-to-extract-and-convert-tables-from-pdf-files-to-pandas-dataframe-cb2e4c596fa8"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">如何从PDF文件中提取表格并转换成Pandas Dataframe？</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">因此，您有一些包含表格的pdf文件，并希望将它们读入熊猫数据框。让我告诉你怎么做。</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">towardsdatascience.com</p></div></div><div class="ne l"><div class="pg l ng nh ni ne nj ks mv"/></div></div></a></div><div class="ms mt gp gr mu mv"><a rel="noopener follow" target="_blank" href="/machine-learning-model-as-a-serverless-endpoint-using-google-cloud-function-a5ad1080a59e"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">使用谷歌云功能作为无服务器端点的机器学习模型</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">因此，你已经建立了一个模型，并希望将其生产为谷歌云平台(GCP)上的无服务器解决方案。让我…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">towardsdatascience.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj ks mv"/></div></div></a></div><div class="ms mt gp gr mu mv"><a rel="noopener follow" target="_blank" href="/machine-learning-model-as-a-serverless-app-using-google-app-engine-b760de59156"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">使用谷歌应用引擎的无服务器应用的机器学习模型</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">因此，您构建了一个模型，并希望将其部署为一个无服务器应用程序。让我告诉你如何使用Docker来做这件事…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">towardsdatascience.com</p></div></div><div class="ne l"><div class="ph l ng nh ni ne nj ks mv"/></div></div></a></div><div class="ms mt gp gr mu mv"><a rel="noopener follow" target="_blank" href="/documenting-your-python-code-9e69671f046a"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">记录您的Python代码</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">正确记录python代码需要练习的3件事</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">towardsdatascience.com</p></div></div><div class="ne l"><div class="pi l ng nh ni ne nj ks mv"/></div></div></a></div></div></div>    
</body>
</html>