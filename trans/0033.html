<html>
<head>
<title>2D Rotorcopter Mechanics and PID Control with Unity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">2D 旋翼直升机机械和 PID 控制一体化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/2d-rotorcopter-mechanics-and-pid-control-with-unity-a3d9a3951a8a#2022-02-01">https://towardsdatascience.com/2d-rotorcopter-mechanics-and-pid-control-with-unity-a3d9a3951a8a#2022-02-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="69d1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">模拟二维飞行，并在 Unity 引擎的帮助下学习 PID 控制回路</h2></div><p id="46e2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇文章介绍了如何使用 Unity 游戏引擎和 PID 控制器来实现一个二维四轴飞行器的飞行控制。这是最近实现的，这里记录了细节，希望对其他人有所帮助。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/11b412c8e45c3cd8f1c0a1e5c7afb577.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RErCu42cJuLlM3mxh4Xl6Q.jpeg"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">阿莱西奥·索格蒂在<a class="ae lr" href="https://unsplash.com/s/photos/drone?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="5434" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">预期成果</h1><p id="b2ff" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">遵循本教程中的演练应该<em class="mp">希望</em>提供以下内容:</p><ol class=""><li id="e444" class="mq mr iq kh b ki kj kl km ko ms ks mt kw mu la mv mw mx my bi translated">模拟二维四轴飞行器飞行的统一环境，准备进行实验。</li><li id="23d9" class="mq mr iq kh b ki mz kl na ko nb ks nc kw nd la mv mw mx my bi translated">对 PID 控制器如何在 Unity(和其他地方)中作为控制系统使用有一个基本的了解。</li><li id="b86e" class="mq mr iq kh b ki mz kl na ko nb ks nc kw nd la mv mw mx my bi translated">旋翼机二维动力学基础。</li></ol><p id="9bf7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所有覆盖的代码以及工作项目都可以在这个 GitHub 的资源库中找到。如果您不关心如何以及为什么获取代码的演练，可以直接跳到<strong class="kh ir">模拟</strong>部分。</p><h1 id="0591" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">开始之前</h1><p id="d960" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">为这个模拟做了一些决定。</p><p id="06c6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">为什么统一？</strong> <a class="ae lr" href="https://unity.com/" rel="noopener ugc nofollow" target="_blank"> Unity </a>配备了一个复杂的物理引擎，使快速开发和实验变得快速简单。</p><p id="62c0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">为什么只有二维？</strong>旋翼机控制的问题很复杂，去除一个维度可以显著简化。一旦掌握了二维的控制，三维就能被解决。</p><p id="08ef" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">为什么把</strong> <a class="ae lr" href="https://en.wikipedia.org/wiki/PID_controller" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> PID 控制器</strong> </a> <strong class="kh ir">？有经验的 Unity 开发者可能想知道为什么使用 PID 控制而不是传统的路径技术。我们的目标是使用一个可以转化为现实世界的控制器。PID 控制器是自动调节系统的首选控制回路。</strong></p><h1 id="7bb0" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">2D 四轴飞行器的基本知识</h1><p id="0097" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">通过以 2 维而不是 3 维开始模拟，复杂性显著降低。</p><p id="f621" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> <em class="mp">重要:</em> </strong> <em class="mp">本文中，纵轴称为</em> <strong class="kh ir"> <em class="mp"> y </em> </strong> <em class="mp">，横轴称为</em><strong class="kh ir"><em class="mp"/></strong><em class="mp"/><strong class="kh ir"><em class="mp">【x</em></strong><em class="mp">。这样做是为了保持与</em><strong class="kh ir"><em class="mp">x-y</em></strong><em class="mp">2D 轴的一致性。在标准符号中，水平轴将被称为</em> <strong class="kh ir"> <em class="mp"> y </em> </strong> <em class="mp">，垂直轴将被称为</em> <strong class="kh ir"> <em class="mp"> z </em> </strong> <em class="mp">(或</em><strong class="kh ir"><em class="mp">x =&gt;</em></strong><em class="mp">和</em><strong class="kh ir">y =&gt;</strong><em class="mp">)。</em></p><p id="cd61" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">现役部队</strong></p><p id="f3dc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无人机在任何给定时间都有三个合力作用于其上:</p><ol class=""><li id="95d6" class="mq mr iq kh b ki kj kl km ko ms ks mt kw mu la mv mw mx my bi translated"><strong class="kh ir">每个</strong>推进器垂直于机架向上的可变向上力</li><li id="e520" class="mq mr iq kh b ki mz kl na ko nb ks nc kw nd la mv mw mx my bi translated">恒定的重力直接向下，与框架的方向无关。</li></ol><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/f79d624fb875a747faa26da07888c03e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*2JzXS-XBHqWylg6zhRY3mA.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">作者图片</p></figure><p id="4398" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">只要四轴飞行器被定义为有质量的刚体，Unity 就照顾到了引力。转子的力(或推力)是控制系统必须管理的。</p><p id="1ba5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">控制</strong></p><p id="cf07" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">模拟四轴飞行器的加速可以通过改变旋翼的推力来控制。</p><p id="be8d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当四轴飞行器与地面水平时，加速度仅沿<strong class="kh ir"> y </strong>轴施加。在这个方向上增加旋翼的推力会使四轴飞行器加速上升，而减少推力会使其加速下降。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nf"><img src="../Images/c796c6d3320705b1c1e6686397cfa6a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*iaSssH8zS4sBRippcILbAQ.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">作者图片</p></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="ab gu cl ng"><img src="../Images/21eeb14ba80227267635c5fa946c005a.png" data-original-src="https://miro.medium.com/v2/format:webp/1*jJ20y45Ek-pMrza2KYC-_g.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">作者图片</p></figure><p id="2a12" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当四轴飞行器相对于地面倾斜一个角度(我们将这个角度称为<strong class="kh ir">φ</strong>或<strong class="kh ir"> 𝜙 </strong>)时，来自螺旋桨的力开始施加水平和垂直加速度。保持这个方向的推力增加了水平速度(y 轴)。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nh"><img src="../Images/d662f909c72ec66aba601b2cfa2aefb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g7Hqkvzo21XfiIoLJnEVZQ.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">作者图片</p></figure><p id="aa41" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者…</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="ab gu cl ng"><img src="../Images/25fb71dc9c3f4697f059b9d85df988e6.png" data-original-src="https://miro.medium.com/v2/format:webp/1*sH4uMk7n4u0DP3xS1stLpg.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">作者图片</p></figure><p id="1f70" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，为了改变四轴飞行器(或<strong class="kh ir">滚转</strong>)的角度方向，转子之间的推力需要变化，以产生扭矩(或<a class="ae lr" href="https://en.wikipedia.org/wiki/Moment_%28physics%29" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir">力矩</strong> </a> <strong class="kh ir"> ) </strong>。该力矩与力和转子之间的距离之差成比例。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ni"><img src="../Images/315babaa0da3112c6aa0d99395da07b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gRlKutl_xLgv-rat6gN-WA.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">作者图片</p></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="ab gu cl ng"><img src="../Images/d54f17e4283f12133d63d6d7349e29f8.png" data-original-src="https://miro.medium.com/v2/format:webp/1*TXJ0-EeAyq8fU6mjDSI1Qw.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">作者图片</p></figure><p id="a455" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> <em class="mp">注:</em> </strong> <em class="mp">三维四轴飞行器还需要控制</em><strong class="kh ir"><em class="mp"/></strong><em class="mp">即电机旋转产生的扭矩(或力矩)。幸好只有 2D 没有第三次元让无人机向</em> <strong class="kh ir"> <em class="mp">左右偏航</em> </strong> <em class="mp">。</em></p><p id="066d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上述动力学允许一个相当简单的控制系统，其中只需要确定四轴飞行器线性加速度的总推力和转子之间的旋转力差。这通常用<strong class="kh ir"> u1 </strong>和<strong class="kh ir"> u2 </strong>来表示，其中<strong class="kh ir"> u1 </strong>表示总推力，而<strong class="kh ir"> u2 </strong>表示总力矩。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/15a71c40b7622e00987634986832f18d.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*Py98x3kO1fjOqvpScMvCWQ.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">作者图片</p></figure><p id="6a43" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些是 PID 控制器需要确定的值。</p><h1 id="c46e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">该控制系统</h1><p id="bd31" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated"><a class="ae lr" href="https://en.wikipedia.org/wiki/PID_controller" rel="noopener ugc nofollow" target="_blank"> PID 控制器</a>是一种控制回路方法，持续向系统提供输入(如推力、电压、电阻等)。)并基于系统随时间的表现来调整该输入。</p><p id="aaeb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">总体思路是为 PID 控制器提供 3 个系数——位置、积分和微分。算法使用这些系数来确定当系统接近或远离其目标时如何缩放输出控制值。我们不会深入研究 PID 控制器工作原理背后的细节，但是强烈建议获得更多关于这个主题的知识。我发现这里的<a class="ae lr" href="https://www.youtube.com/watch?v=wkfEZmsQqiA" rel="noopener ugc nofollow" target="_blank">系列</a>是一个很好的介绍。</p><p id="73ad" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">系统采用 2 个 PID 控制器来解决 2D 四轴飞行器的控制问题；</p><p id="b066" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">高度控制器</strong>——为无人机提供将四轴飞行器驱动到所需高度所需的推力值。</p><p id="d2ed" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">姿态控制器</strong>——为无人机提供力矩值，帮助稳定飞机。</p><p id="5c6b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是控制循环的样子。注意，只有所需的高度(y 轴)被提供作为整个系统的输入。控制器的工作是驾驶四轴飞行器到那个高度，同时确保平衡的方向。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nk"><img src="../Images/e40e945c9bbbd305d52585089cf3d7b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CMXOa6x3URQslPK2SXed_A.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">作者图片</p></figure><p id="d300" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">位置驱动</strong>——代表总控制回路输入——<strong class="kh ir">高度。</strong></p><p id="06ab" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">误差估计器</strong> —负责向 PID 控制器提供期望状态(<strong class="kh ir">高度</strong>和<strong class="kh ir">中性方位</strong>)和实际值之间的偏差的组件。</p><p id="373f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> PID 高度控制器</strong> —该 PID 控制器使用来自<strong class="kh ir">误差估计器</strong>的位置误差来导出一个<strong class="kh ir"> u1 </strong>值或总体期望的<strong class="kh ir">垂直推力</strong>。</p><p id="b62c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> PID 姿态控制器</strong> —该 PID 控制器使用来自<strong class="kh ir">误差估计器</strong>的方位误差来导出<strong class="kh ir"> u2 </strong>值或所需的<strong class="kh ir">扭矩</strong>。</p><p id="1c12" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">马达混合算法(MMA) </strong> —该算法使用<strong class="kh ir"> u1、u2 </strong>并将它们与无人机的<strong class="kh ir">当前方位</strong>相结合，以确定每个旋翼所需的总推力。</p><p id="e873" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">工厂/无人机</strong> —与环境交互并向系统提供实际状态值反馈的物理(或虚拟)无人机。</p><h1 id="fea9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">代码</h1><p id="d486" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">所有这些都完成后，让我们开始构建实际的模拟。<a class="ae lr" href="https://unity.com/" rel="noopener ugc nofollow" target="_blank">使用 Unity </a>是由于其内置的物理引擎。GitHub 库可以在这里找到，包含了一个模拟的工作实例。</p><p id="90a0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一个人可能没有任何 Unity 的经验，但是强烈建议你至少熟悉一下，即使你没有任何游戏开发的愿望。Brackeys 有一些奇妙的资源，比如这个<a class="ae lr" href="https://www.youtube.com/watch?v=on9nwbZngyw" rel="noopener ugc nofollow" target="_blank">一个</a>可以让你开始。</p><h2 id="04e4" class="nl lt iq bd lu nm nn dn ly no np dp mc ko nq nr me ks ns nt mg kw nu nv mi nw bi translated">文件夹结构</h2><p id="08da" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">该项目被组织成以下文件结构。</p><pre class="lc ld le lf gt nx ny nz oa aw ob bi"><span id="66c7" class="nl lt iq ny b gy oc od l oe of">├───<strong class="ny ir">Prefabs</strong><br/>│   ├───<!-- -->Quadcopter - prefab of the complete quadcopter<br/>│   └───<!-- -->Thruster - prefab for a thruster object<br/>├───<strong class="ny ir">Scenes</strong><br/>│   └───Main - the only scene in the project<br/>├───<strong class="ny ir">Scripts</strong><br/>│   ├───<!-- -->PIDController - PID script obejcts<br/>│   ├───<!-- -->Quadcopter - script for the quadcopter object<br/>│   ├───<!-- -->FlightController - script to bring everything together<br/>│   └───<!-- -->Thruster - script containing control for rotor objects</span></pre><h2 id="f878" class="nl lt iq bd lu nm nn dn ly no np dp mc ko nq nr me ks ns nt mg kw nu nv mi nw bi translated">现场</h2><p id="85dc" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">所有场景和摄影机默认值都将保留，场景仅使用以下对象进行更新:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="ab gu cl ng"><img src="../Images/8bc15237129d208e352df2d70ff8e1eb.png" data-original-src="https://miro.medium.com/v2/format:webp/1*XqUHZntkaziFVyRI_OEo1A.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">作者图片</p></figure><p id="f4d0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">四轴飞行器</strong>——四轴飞行器，包含一个飞行控制器、一个刚体框架和两个推进器。</p><p id="b02c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">平台</strong>——为四轴飞行器提供稳定起飞面的静态刚体。</p><p id="7057" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">事件系统</strong> —默认事件系统对象，由于未使用而被禁用。</p><p id="a25c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">主摄像机</strong> —默认摄像机对象。</p><h2 id="4df0" class="nl lt iq bd lu nm nn dn ly no np dp mc ko nq nr me ks ns nt mg kw nu nv mi nw bi translated">代码</h2><p id="593f" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">这里可以找到<a class="ae lr" href="https://github.com/adidinchuk/2d-unity-quadcopter-sim" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir"/></a><strong class="kh ir">。</strong>脚本对象是用几行值得注意的代码进行高级描述的。</p><p id="38f6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">推进器. cs </strong></p><p id="fed6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该脚本与每个旋翼相关联，并为四轴飞行器提供推力。在每个物理引擎滴答时，转子脚本使用<strong class="kh ir">推力系数</strong>和<strong class="kh ir">模拟叶片速度</strong>计算它应该产生的力。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="fec1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可以通过调用<strong class="kh ir"> setRevolutionTarget() </strong>函数并传递所需的 RPM 值来更新转子推力。然后，推进器使用<strong class="kh ir"> updateRevolutionRate() </strong>功能不断更新 RPM 值，直到达到目标值。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="c40b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">四轴飞行器. cs </strong></p><p id="5dbb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该脚本代表四轴飞行器对象，它被映射到附加的转子对象，并包含<strong class="kh ir">马达混合器算法</strong>代码<strong class="kh ir">。</strong></p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="og oh l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi oi"><img src="../Images/d08c674678f7034283ad5ace1f0509fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/0*oycbfPVN-M77T_ZL.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">作者图片</p></figure><p id="01ad" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过乘以<strong class="kh ir">Cos(φ)</strong>来调整<strong class="kh ir"> u1 </strong>值，以说明重力，其中<strong class="kh ir">φ</strong>是无人机当前的<strong class="kh ir">角度方位角</strong>。<strong class="kh ir"> u2 </strong>值(力矩输入)正施加于左侧转子，负施加于右侧，以产生所需的力矩。</p><p id="6d17" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">注意，这些值作为力的单位直接传递给转子。这是可以做到的，因为 PID 控制系统的一般灵活性。</strong>控制回路根据系统的反应调整输入的大小。</p><p id="27d9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> PIDController.cs </strong></p><p id="ad0e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是主 PID 控制脚本，核心逻辑打包到<strong class="kh ir"> GetPIDOutput() </strong>函数中。每次需要估计新值时，都会调用此方法。<strong class="kh ir"> p </strong>、<strong class="kh ir"> i </strong>和<strong class="kh ir"> d </strong>是增益幅度，<strong class="kh ir"> kP </strong>、<strong class="kh ir"> kI </strong>和<strong class="kh ir"> kD </strong>是可以通过<strong class="kh ir"> FlightController.cs </strong>脚本调整的系数，以改变 PID 控制器的性能。</p><p id="47f1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae lr" href="https://www.youtube.com/watch?v=wkfEZmsQqiA" rel="noopener ugc nofollow" target="_blank">这里的</a>是学习 PID 控制逻辑的绝佳资源。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="60cc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用模型的先前积分值更新积分项，并且旨在为模型提供一种“记忆”。这有助于系统适应未知的变量，但也会给我们带来麻烦。例如，如果无人驾驶飞机离目标目的地仍有一段距离，但已经达到其最大速度，则积分项将继续增长超过最大值。这将导致次优减速，因为系统将不得不撤销卷起的过剩。更详细的解释可以在<a class="ae lr" href="https://youtu.be/NVLXCwc8HzM?t=163" rel="noopener ugc nofollow" target="_blank">这里</a>找到，它讨论了如果 PID 输出超过系统能力阈值，通过箝位(或停止累加)积分项来防止这种过饱和的概念。</p><p id="f739" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> FlightController.cs </strong></p><p id="fea3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是将所有内容整合在一起的脚本。期望的位置和推力，以及滚转 PID 系数都可以通过这个对象来设置。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/61b9430147b2c6939db6efb478c7658a.png" data-original-src="https://miro.medium.com/v2/resize:fit:796/format:webp/1*rTZcTlIIseMxesU3X_DSUw.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">作者图片</p></figure><p id="3a9a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在每次物理引擎更新时，该脚本计算当前的错误状态，将错误传递给 PID 控制器，并将产生的<strong class="kh ir"> u1 </strong>和<strong class="kh ir"> u2 </strong>值传递给无人机马达混合器算法。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="og oh l"/></div></figure><h1 id="8159" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">模拟</h1><p id="d7da" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated"><a class="ae lr" href="https://github.com/adidinchuk/2d-unity-quadcopter-sim" rel="noopener ugc nofollow" target="_blank"> repo </a>中的代码应该按原样运行，但是如何操作模拟的参数将在下面介绍。</p><h2 id="a335" class="nl lt iq bd lu nm nn dn ly no np dp mc ko nq nr me ks ns nt mg kw nu nv mi nw bi translated">推进器</h2><p id="c118" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">无人机有左和右推进器，它们可以单独操纵，但是为了获得最佳效果，它们的参数应该是相同的。每个推进器也有一个具有规定质量<strong class="kh ir"/>(0.3)的刚体，这个刚体通过一个<strong class="kh ir"> 2D 固定接头</strong>连接到主无人机机身上。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/6b81faa55ce548e0313c42ccb86c18a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*9xIpEFJhUD_xvHlHsjfBVg.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">作者图片</p></figure><p id="00fe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要配置的主推进器. cs 参数将是<strong class="kh ir">推力系数</strong>、<strong class="kh ir">最大 RPM、</strong>和<strong class="kh ir">旋转速率</strong>。</p><h2 id="84cf" class="nl lt iq bd lu nm nn dn ly no np dp mc ko nq nr me ks ns nt mg kw nu nv mi nw bi translated">四轴飞行器</h2><p id="8858" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">四轴飞行器还有一个质量确定的刚体<strong class="kh ir"/>(1)以及一个简单的碰撞器，以防止它穿过地表平台。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/f4a57fa360ceb609c66a225d21764161.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*oW0ooqAlULV2XLiezIKKQg.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">作者图片</p></figure><p id="9e87" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">旋翼和旋翼数在<strong class="kh ir"> Quadcopter.cs </strong>脚本中设置，目标位置和 PID 控制系数在<strong class="kh ir"> FlightControl.cs </strong>脚本中设置。</p><h2 id="211d" class="nl lt iq bd lu nm nn dn ly no np dp mc ko nq nr me ks ns nt mg kw nu nv mi nw bi translated">运行代码</h2><p id="7b0e" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">当场景运行时，四轴飞行器离开地面，向指定的高度移动，并停留在那里。</p><p id="31a5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mp">*红色的</em> <strong class="kh ir"> <em class="mp">线</em> </strong> <em class="mp">是显示推力的调试线。</em></p><p id="f61b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可以修改<strong class="kh ir"> P </strong>推力值，以改变无人机达到所需高度的速度。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi om"><img src="../Images/1f99d6b2a4c0732333a906ea8fa39ff2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*1KdD_3Bd491HiFm0docCoA.gif"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">比例项= 25，积分项= 2.5，导数项= 4 —图片由作者提供</p></figure><p id="a297" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> D </strong>推力值决定了我们的轨迹有多平滑，可以用来以收敛速度较慢为代价最小化超调。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi om"><img src="../Images/b0eb67b068bed80b62693e05bd96ceec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*vXg3tDCL6xiAZrF-p273_w.gif"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">比例项= 25，积分项= 2.5，导数项= 11 —图片由作者提供</p></figure><p id="9f7f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> I </strong>推力值允许系统克服环境中不可预见的干扰，实现更平稳的恢复。无人机使用积分项值 2.5，这允许它考虑模型中完全忽略的重力。这是积分项设置为 0 时的情况——无人机未能达到目标高度 10。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi om"><img src="../Images/301f1f30e8ad2116ab1e38dbdf0ef2f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*R50RA8RYwKaHKQJ9IVoBkA.gif"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">比例项= 25，积分项= 0，导数项= 11 —图片由作者提供</p></figure><p id="cca0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">除了俯仰之外，滚转 PID 系数提供相同的作用。这是当无人机的方向和位置受到干扰时的样子。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi om"><img src="../Images/db2741121038cddd52ea178fea5431ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*V7BhEO7Mnhq16XsBemDNug.gif"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">作者图片</p></figure><h1 id="7578" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="fe3e" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">如果你走到这一步，你应该有一个工作的 2D 四轴飞行器 Unity 模拟，或者至少知道如何创建一个。在未来的文章中，我希望增加这种模拟的复杂性，包括自动运动规划和适应 3 维。</p><p id="ada0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我有任何错误或遗漏了什么，请让我知道。也可以随意发表任何问题作为评论。</p><p id="7e7f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">编码快乐！</p></div><div class="ab cl on oo hu op" role="separator"><span class="oq bw bk or os ot"/><span class="oq bw bk or os ot"/><span class="oq bw bk or os"/></div><div class="ij ik il im in"><p id="f992" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mp">原载于 2022 年 2 月 1 日 https://theappliedarchitect.com</em><a class="ae lr" href="https://theappliedarchitect.com/learning-2d-rotorcopter-mechanics-and-control-with-unity/" rel="noopener ugc nofollow" target="_blank"><em class="mp"/></a><em class="mp">。</em></p></div></div>    
</body>
</html>