<html>
<head>
<title>Use Pandas Query to Filter or Select Data in Pandas DataFrame</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Pandas 查询来过滤或选择 Pandas 数据框架中的数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/use-pandas-query-to-filter-or-select-data-in-pandas-dataframe-82ae3a3683a1#2022-03-10">https://towardsdatascience.com/use-pandas-query-to-filter-or-select-data-in-pandas-dataframe-82ae3a3683a1#2022-03-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bb58" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Pandas query()函数语法是在 Pandas 数据帧中过滤或选择数据的一种更简洁的方式</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/358a28f7ed0d89acc1d7f83d943dbd92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*i2OV58muOYZ1X4O7"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@itookthose?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">希德·巴拉钱德朗</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="37dd" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">概观</h1><p id="d80b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">作为一名数据科学家，我通常依靠使用布尔屏蔽来过滤或选择熊猫数据框架中的数据。我以前听说过熊猫<code class="fe mn mo mp mq b">query()</code>功能，但从未真正尝试过。几周前，当我决定真正尝试一下时，这种情况发生了变化😎</p><p id="e6cf" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">现在，这个功能已经成为我选择或过滤数据的首选方法。这是因为一个简单的原因:代码可读性的提高。</p><p id="1de3" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">查询函数有一个非常简单的语法，它接受引号内的布尔表达式(例如'<em class="mw">表达式'</em>)，并过滤表达式为<em class="mw">真</em>的数据帧行。</p><p id="1965" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">在本文中，我将快速向您展示如何使用<code class="fe mn mo mp mq b">df.query('expression')</code>函数来代替标准的布尔屏蔽语法方法。希望你们中的一些人能够改变自己喜欢的方法！😄</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><p id="95c4" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><strong class="lt iu"> <em class="mw">边注:本文的示例代码可以在 Jupyter 笔记本</em> </strong> <a class="ae ky" href="https://github.com/saedhussain/medium-pandas_query/blob/3bd0b28b82d97915e9675eed88cffdc1e861f730/medium-pandas_query.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> <em class="mw">这里</em> </strong> </a> <strong class="lt iu"> <em class="mw">找到。</em>T25】</strong></p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="61e0" class="kz la it bd lb lc ne le lf lg nf li lj jz ng ka ll kc nh kd ln kf ni kg lp lq bi translated">先来点数据</h1><p id="1aeb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">开始之前，我们需要一些数据。出于演示的目的，本文将使用 Iris 数据集。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/33b017b8e16eeae6dc1a856ce1727277.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*twuizB4fUX_l1A2N"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@_esther_?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">埃斯特·刘易斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="ac5d" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">该数据集使用鸢尾属植物花的四列测量值(萼片长度、萼片宽度、花瓣长度和以厘米为单位的花瓣宽度)来预测花的种类。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/7532b8bff9fd19ee6f5bc2e532dd537a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*8LiIzpBkb8sInzxLg4rPNg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从 scikit-learn 加载的虹膜数据集。(来源:作者)</p></figure><p id="49b1" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">现在让我们开始一些语法比较！🚀</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="5ba8" class="kz la it bd lb lc ne le lf lg nf li lj jz ng ka ll kc nh kd ln kf ni kg lp lq bi translated">语法:普通布尔掩码 Vs 查询函数</h1><p id="a2b9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了显示这两种语法之间的一些比较，并强调为什么查询功能更好，让我们尝试从 Iris 数据集回答这个简单的问题:<em class="mw">有多少“setosa”物种样本的萼片长度小于 5cm？</em></p><p id="6a0f" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">使用通常的布尔屏蔽语法，我可以快速得到如下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/10b26472f6ea172e6705459027a8d390.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lioz9-28pRAipbglwJeSWA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用通常的布尔掩码过滤方法。(来源:作者)</p></figure><p id="5e07" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">使用如下查询函数可以获得相同的结果 20:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/07e8558f3dc3475f90b1825b23b92210.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*16kIkIniIdXYTlsdAYsqag.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用查询功能得到相同的答案。(来源:作者)</p></figure><p id="6167" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">你注意到两者的不同了吗？为了以防万一，这里有两个要注意的主要观察结果:</p><ol class=""><li id="dd3a" class="nm nn it lt b lu mr lx ms ma no me np mi nq mm nr ns nt nu bi translated">我只需在查询函数表达式中写入列名<code class="fe mn mo mp mq b">species</code>,而不必在过滤器中多次写入<code class="fe mn mo mp mq b">iris_df.species</code>。</li><li id="a1f9" class="nm nn it lt b lu nv lx nw ma nx me ny mi nz mm nr ns nt nu bi translated">看看这个查询方法是多么的清晰易读。</li></ol><p id="85b0" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">是只有我觉得这样看起来更舒服吗？</p><p id="1f00" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">此外，我可以很容易地在查询函数中使用一个带有“@”符号的变量来获得相同的结果，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/b9d3ed4445e97ff3ee5fdcba89a3895f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7cEMDXB6BF4sUyOm6Kxx2g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用“@”符号在查询函数表达式中包含变量。(来源:作者)</p></figure><p id="6f57" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">我希望这个简单的示例问题能激发您尝试 Pandas 中的查询功能的兴趣。可能性是无穷的！</p><p id="98d7" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">我不打算在这里继续举更多的例子。我建议出去试试！学习的最好方法就是走出去打破一些东西。😄</p><p id="fec4" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">只要查询函数中的表达式包含有效的数据字段、变量、布尔符号和 pythonic 布尔运算符，就应该没问题。👍</p><p id="6454" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">如果你还想知道更多关于如何使用查询功能的例子，我推荐你点击这里查看这篇文章<a class="ae ky" href="https://medium.com/gustavorsantos/pandas-query-the-easiest-way-to-filter-data-39e0163ef35a" rel="noopener"/>。</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="8e17" class="kz la it bd lb lc ne le lf lg nf li lj jz ng ka ll kc nh kd ln kf ni kg lp lq bi translated">最后的想法</h1><p id="9921" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">找到有效的代码并不罕见，但是乍一看，很难理解发生了什么。这通常被称为代码可读性问题。比较这里讨论的两种方法的语法，很明显，Pandas 查询函数方法产生了可读性更好的代码。此外，它也有一些<a class="ae ky" href="https://jakevdp.github.io/PythonDataScienceHandbook/03.12-performance-eval-and-query.html" rel="noopener ugc nofollow" target="_blank">性能优势</a>。</p><p id="928c" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">我希望这篇文章能引起您的兴趣，让您尝试一下查询功能。😄</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><p id="d7c8" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><em class="mw">感谢您花时间阅读本文。希望你觉得有用。请随时伸出手来连接！👋</em></p><p id="7b07" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><strong class="lt iu">🚀🚀<em class="mw">如果你愿意支持我，阅读更多来自我和其他了不起的 medium 作者的文章，考虑使用我的</em> </strong> <a class="ae ky" href="https://saedhussain.medium.com/membership" rel="noopener"> <strong class="lt iu"> <em class="mw">推荐链接</em> </strong> </a> <strong class="lt iu"> <em class="mw">注册 medium。</em>🙏</strong></p><p id="7cef" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">以下是我的一些其他文章，你可能会感兴趣</p><div class="oa ob gp gr oc od"><a rel="noopener follow" target="_blank" href="/documenting-your-python-code-9e69671f046a"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">记录您的 Python 代码</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">正确记录 python 代码需要练习的 3 件事</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">towardsdatascience.com</p></div></div><div class="om l"><div class="on l oo op oq om or ks od"/></div></div></a></div><div class="oa ob gp gr oc od"><a rel="noopener follow" target="_blank" href="/machine-learning-model-as-a-serverless-app-using-google-app-engine-b760de59156"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">使用谷歌应用引擎的无服务器应用的机器学习模型</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">因此，您构建了一个模型，并希望将其部署为一个无服务器应用程序。让我告诉你如何使用 Docker 来做这件事…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">towardsdatascience.com</p></div></div><div class="om l"><div class="os l oo op oq om or ks od"/></div></div></a></div><div class="oa ob gp gr oc od"><a rel="noopener follow" target="_blank" href="/how-to-schedule-a-serverless-google-cloud-function-to-run-periodically-249acf3a652e"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">如何安排无服务器谷歌云功能定期运行</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">你有一些需要定期运行的代码吗？</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">towardsdatascience.com</p></div></div><div class="om l"><div class="ot l oo op oq om or ks od"/></div></div></a></div><div class="oa ob gp gr oc od"><a rel="noopener follow" target="_blank" href="/machine-learning-model-as-a-serverless-endpoint-using-google-cloud-function-a5ad1080a59e"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">使用谷歌云功能作为无服务器端点的机器学习模型</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">因此，你已经建立了一个模型，并希望将其生产为谷歌云平台(GCP)上的无服务器解决方案。让我…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">towardsdatascience.com</p></div></div><div class="om l"><div class="ou l oo op oq om or ks od"/></div></div></a></div></div></div>    
</body>
</html>