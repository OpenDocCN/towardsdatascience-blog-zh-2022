<html>
<head>
<title>G.O.A.T Way to Store Images in SQL Database Using Multi-Threading</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">G.使用多线程在SQL数据库中存储图像的方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/g-o-a-t-way-to-store-images-in-sql-database-using-multi-threading-3ef7281b6247#2022-02-08">https://towardsdatascience.com/g-o-a-t-way-to-store-images-in-sql-database-using-multi-threading-3ef7281b6247#2022-02-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0d58" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在几分钟内处理数千张图像！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3199537e4e3871fa8fdc03cd987ef54c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DJKMHnfz3e5pncms"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">罗宾·盖洛特-德勒冯在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="e894" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你在spark中有没有遇到过不能使用Spark的执行器并行处理能力的用例？在本文中，我们将探索使用Python中的多线程在SQL数据库中存储图像的一种很酷的方法。这种用例在Spark中无法实现，因为除非将数据框转换为pandas格式，否则无法可视化数据。一旦转换成熊猫，就失去了spark的所有优势。因此，为了达到相似的执行速度(可能没有spark快)，我们可以利用Python中的多线程技术。</p><p id="497a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">阅读本文后，您将了解到:</p><p id="7a9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">-如何在Python中多线程？</p><p id="10bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">-如何在SQL数据库中高效存储图片？</p><h1 id="64a2" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用案例</h1><p id="f2db" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们将查看一个每小时的能耗数据集，我们需要保存3个月内每天的能耗图。让我们看看我从<a class="ae ky" href="https://www.kaggle.com/robikscube/hourly-energy-consumption/version/3" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>下载的数据集:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/ac2848f27166c20be751375cfa009739.png" data-original-src="https://miro.medium.com/v2/resize:fit:496/format:webp/1*EjgUD5X-ltC7NSXwqKXoLA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/9afb1af06d556239872c5eb9face3a55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1rCm0KfOAVUbJrKgw3zTmA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="d596" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">准备</h1><h2 id="c857" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">1.安装库</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/14f394993a37d796c25087eb4f0cd455.png" data-original-src="https://miro.medium.com/v2/resize:fit:566/format:webp/1*RUFHnN_jQsrXszaYcHnAYw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="c07e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你们一定都知道上面提到的大多数库。我来看看不常用的:</p><ol class=""><li id="3dcf" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated"><a class="ae ky" href="https://docs.python.org/3/library/concurrent.futures.html" rel="noopener ugc nofollow" target="_blank"> Concurrent.futures </a> —用于在python中启动并行线程</li><li id="8878" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><a class="ae ky" href="https://docs.python.org/3/library/itertools.html#itertools.repeat" rel="noopener ugc nofollow" target="_blank">重复</a> —用于提供一串常量值</li><li id="f592" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><a class="ae ky" href="https://docs.microsoft.com/en-us/sql/connect/python/pyodbc/python-sql-driver-pyodbc?view=sql-server-ver15" rel="noopener ugc nofollow" target="_blank"> Pyodbc </a> —用于为Python安装odbc驱动程序以连接SQL server。下图显示了如何连接到需要所有凭据的SQL server:</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/787ec8e0045737806f0df13ab9d822a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gVF7Ih_UKPxQvR-Fb6TCag.png"/></div></div></figure><h2 id="760e" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">2.在您的目录中创建一个文件夹来存储图像</h2><p id="2dae" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了在SQL数据库中存储图像，首先需要以. png格式保存每个打印图像。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/3a265da4753bc45f7630865c0e2e4eff.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*kc7RMeB7fRiSA-GYNi0Ixg.png"/></div></figure><h2 id="641a" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">3.生成和存储图像</h2><p id="668f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">现在您已经安装了库并连接到SQL server，您可以开始存储图像的过程。有两种不同的方法可以实现这一点:</p><ol class=""><li id="3a6e" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated">我们的至爱，“For loop”:</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/0f4e2a6e0f3791b531dd580616ac9cb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*15wjWVnJaFPB3fJ2cY6z5A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><ul class=""><li id="9f66" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu ny nn no np bi translated">上面的代码使用了一个for循环来遍历所有不同的日子，并为每一天创建一个绘图，然后将它保存在我们之前创建的文件夹中</li><li id="59fb" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu ny nn no np bi translated">之后，我们打开每个创建的图像，并将其存储在SQL数据库中已经创建的表中</li><li id="4141" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu ny nn no np bi translated">如果你有成千上万的图片要处理，这个过程将会花费很多时间。因此，这不是一种可扩展的前进方式</li></ul><p id="3676" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.使用多线程:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/e2d9ab64565fa3d83cfe2d6193429107.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b0CfVvO6y7CGtnhxj5EpaA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="f53d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以上代码使用concurrent.futures库实现多线程。在map函数中，您传递'<em class="oa"> plot_consumption </em>'函数，该函数将为`<em class="oa"> list_dates` </em>中的每个日期生成图像，而<em class="oa"> </em>也作为参数之一传递。此外，您可以看到我是如何在repeat函数中传递数据帧的，这有助于为每天处理的所有并发线程提供恒定的数据帧流。</p><h2 id="9571" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">这是一个总结！我希望你今天学到了一些新东西，并能在你的项目和/或工作场所中实施。</h2><h1 id="bfbf" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">感谢您的阅读！</h1></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><ul class=""><li id="2f19" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu ny nn no np bi translated"><em class="oa">如果你喜欢我的文字，那么请订阅我的</em> <a class="ae ky" href="https://medium.com/subscribe/@mrinalgupta1704" rel="noopener"> <em class="oa">列表</em> </a></li><li id="f52a" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu ny nn no np bi translated"><em class="oa">如果你喜欢，</em> <a class="ae ky" href="https://medium.com/@mrinalgupta1704" rel="noopener"> <em class="oa">在Medium上关注我</em> </a></li><li id="8e11" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu ny nn no np bi translated"><em class="oa">在</em><a class="ae ky" href="https://www.linkedin.com/in/mrinal-gupta-5319a9ab/" rel="noopener ugc nofollow" target="_blank"><em class="oa">LinkedIn</em></a>上保持联系</li></ul><h1 id="c259" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">参考</h1><ul class=""><li id="3494" class="nh ni it lb b lc mn lf mo li oi lm oj lq ok lu ny nn no np bi translated"><a class="ae ky" href="https://www.pjm.com/Search%20Results.aspx?#q=hourly%20data&amp;sort=relevancy&amp;f:_E50F7924-B7B4-46B5-BA96-7E2D0F3D7882=[Csv]" rel="noopener ugc nofollow" target="_blank"> PJM —搜索结果</a> —数据来源</li><li id="1ce7" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu ny nn no np bi translated"><a class="ae ky" href="https://www.kaggle.com/robikscube/hourly-energy-consumption" rel="noopener ugc nofollow" target="_blank">每小时能耗| Kaggle </a></li><li id="973f" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu ny nn no np bi translated">许可使用数据集</li></ul></div></div>    
</body>
</html>