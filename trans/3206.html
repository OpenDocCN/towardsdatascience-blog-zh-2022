<html>
<head>
<title>Pushing Docker Images to Amazon Elastic Container Registry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Docker图像推送到Amazon弹性容器注册中心</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pushing-docker-images-to-amazon-elastic-container-registry-830c301b8971#2022-07-15">https://towardsdatascience.com/pushing-docker-images-to-amazon-elastic-container-registry-830c301b8971#2022-07-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4871" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">逐步指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/76f21e116b8e4f12990a856fd6658488.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gXW7McpFnDwGaUGa"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://unsplash.com/photos/SInhLTQouEk" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>作者<br/>T3】张秀坤·吕克曼</p></figure><p id="4596" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/what-is-ecr.html" rel="noopener ugc nofollow" target="_blank">亚马逊弹性容器注册中心(ECR) </a>是一个容器图像注册中心，我们可以在AWS上使用push Docker图像。为什么要使用<a class="ae ky" href="https://www.aquasec.com/cloud-native-academy/docker-container/docker-registry/#:~:text=A%20Docker%20registry%20is%20a,versions%20of%20a%20specific%20image." rel="noopener ugc nofollow" target="_blank">容器注册表</a>？它有助于轻松管理您的各种图像和单独的项目。例如，当我第一次开始在本地使用Docker时，我并没有意识到我已经创建了多少图像。我很难为不同的项目跟踪我的图像，我需要一个中心资源，ECR是我的首选注册表，因为我经常与AWS一起工作。</p><p id="65d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就引出了我使用ECR的第二个原因。有不同的容器注册中心可用，但是如果您是AWS的大用户，ECR可以直接与平台上的许多其他服务集成。这方面的例子包括为你的<a class="ae ky" rel="noopener" target="_blank" href="/building-aws-lambda-container-images-5c4a9a15e8a2"> Lambda函数</a>提供定制图像，为<a class="ae ky" rel="noopener" target="_blank" href="/bring-your-own-container-with-amazon-sagemaker-37211d8412f4"> SageMaker训练和推理</a>构建你自己的容器。在本文中，我们将快速了解如何将图像推送到ECR上的存储库中。</p><p id="cb2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意</strong>:对于刚接触AWS的人来说，如果你想继续学习，请确保在下面的<a class="ae ky" href="https://aws.amazon.com/console/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">链接</strong> </a>中注册账户。本文还假设读者对Docker、AWS和使用<a class="ae ky" href="https://aws.plainenglish.io/an-introduction-to-the-aws-cli-54539f5e5fe7" rel="noopener ugc nofollow" target="_blank"> AWS CLI </a>有基本的了解。</p><h2 id="84be" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">本地提取Docker图像</h2><p id="e613" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">首先，确保你已经安装了<a class="ae ky" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank">Docker</a>并且正在运行。在AWS端，确保您安装了<a class="ae ky" href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html" rel="noopener ugc nofollow" target="_blank">AWS CLI</a>，以便我们使用ECR等服务。</p><p id="328d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了简单起见，我们不担心构建我们自己的定制图像，我们可以从Docker Hub中为本文抓取一个现有的图像。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">拉式Docker图像</p></figure><p id="efd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果运行以下命令，您应该能够看到hello-world图像。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">列出Docker图像</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/79724586f8ec45f09775c7176a05043f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*faKHs8RlU5g-qEkii0wC7A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Hello World Image(作者截图)</p></figure><p id="4118" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们将此图像推送到ECR。</p><h2 id="b504" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">创建ECR存储库</h2><p id="a2e3" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在推送我们的映像之前，我们需要创建一个ECR存储库。所有这些与ECR的交互都可以通过AWS CLI进行管理。要进一步了解CLI的设置和配置，请参考这篇<a class="ae ky" href="https://aws.plainenglish.io/an-introduction-to-the-aws-cli-54539f5e5fe7" rel="noopener ugc nofollow" target="_blank">文章</a>。</p><p id="0962" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在创建存储库之前，我们需要登录到我们的ECR注册中心，这可以通过下面的<a class="ae ky" href="https://docs.aws.amazon.com/cli/latest/reference/ecr/get-login-password.html" rel="noopener ugc nofollow" target="_blank">命令</a>来完成。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">登录到ECR</p></figure><p id="e8f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保提供正确的帐户ID，如果你遇到一个错误说“没有认证证书”，这将取决于你所在的地区。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/77578ecf3b18533c8b75bf35e01f0a93.png" data-original-src="https://miro.medium.com/v2/resize:fit:448/format:webp/1*Pc9wkmEI8Ihl6YwZgTpDVw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">登录到ECR</p></figure><p id="e334" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">登录后，我们可以通过“<a class="ae ky" href="https://docs.aws.amazon.com/cli/latest/reference/ecr/create-repository.html" rel="noopener ugc nofollow" target="_blank"> create repository </a>”调用来创建我们的存储库。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建存储库</p></figure><p id="de4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">成功创建后，您应该会在终端中看到您的存储库元数据，我们也可以在控制台中确认这一点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mx"><img src="../Images/95f296c59fb4c439a895327785b932b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D6O391mjqVQpErH_lF-5ug.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">hello-world知识库已创建(作者截图)</p></figure><p id="61d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来是获取我们的本地映像，并将其推送到我们创建的hello-world存储库中。</p><h2 id="211e" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">将图像推送到ECR</h2><p id="c5c8" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在推送我们的图像之前，我们需要对其进行标记，以识别我们的存储库。预期格式如下:<code class="fe my mz na nb b"><em class="nc">aws_account_id</em>.dkr.ecr.<em class="nc">region</em>.amazonaws.com/my-repository:tag</code></p><p id="e349" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以将这种格式应用于您的“hello-world”图像，方法是使用以下命令对其进行标记。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">标记本地图像</p></figure><p id="8ae6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以通过运行另一个“docker images”命令来列出并搜索新标记的图像，从而验证该图像是否已被正确标记。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/06289256ed39174e9fa2e2323a9fdccb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XFDwt74uNwmQNQ9gYh14Sg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">标签图片(作者截图)</p></figure><p id="19a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以用下面的命令将这个映像推送到ECR。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将Docker图像推送到ECR</p></figure><p id="1e01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过再次检查控制台来验证repo中是否存在该映像。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/34f13902f57b97c548bdc455cad231dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bQpnEJjHuZAjiwD52zZsyw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片推送(作者截图)</p></figure><p id="02f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然您的映像已经在存储库中，您就可以提取它，推送多个版本，就像您在本地使用Docker一样。这里的主要好处是你可以用注册表来组织和跟踪所有这些不同的项目和图像。</p><h2 id="c2dc" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">其他资源和结论</h2><div class="nf ng gp gr nh ni"><a href="https://github.com/RamVegiraju/AWS-CLI-Cheatsheet/blob/master/ecr.sh" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">主RamVegiraju上的AWS-CLI-cheat sheet/ECR . sh/AWS-CLI-cheat sheet</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">此文件包含双向Unicode文本，其解释或编译可能与下面显示的不同…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">github.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw ks ni"/></div></div></a></div><p id="0933" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过上面的链接访问所有ECR AWS CLI命令，还有用于Lambda等其他流行AWS服务的CLI命令。当您熟悉Docker和CLI时，使用ECR相当简单。如果你对Docker with AWS更感兴趣，请点击这里查看你在<a class="ae ky" href="https://aws.amazon.com/docker/" rel="noopener ugc nofollow" target="_blank">上运行Docker的其他服务。</a></p><p id="732a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇文章是将你的Docker图片推送到ECR的好入门，你可以在这里参考官方文档<a class="ae ky" href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/docker-push-ecr-image.html" rel="noopener ugc nofollow" target="_blank">。请随意查看下面的</a><a class="ae ky" href="https://ram-vegiraju.medium.com/list/aws-42b81fcfe143" rel="noopener">列表</a>了解其他AWS内容。</p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><p id="f5b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nc">如果你喜欢这篇文章，请在</em><a class="ae ky" href="https://www.linkedin.com/in/ram-vegiraju-81272b162/" rel="noopener ugc nofollow" target="_blank"><em class="nc">LinkedIn</em></a><em class="nc">上与我联系，并订阅我的媒体</em> <a class="ae ky" href="https://ram-vegiraju.medium.com/subscribe" rel="noopener"> <em class="nc">简讯</em> </a> <em class="nc">。如果你是新来的中号，用我的</em> <a class="ae ky" href="https://ram-vegiraju.medium.com/membership" rel="noopener"> <em class="nc">会员推荐</em> </a> <em class="nc">报名吧。</em></p></div></div>    
</body>
</html>