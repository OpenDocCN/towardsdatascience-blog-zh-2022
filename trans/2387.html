<html>
<head>
<title>Top 12 advice on BigQuery and SQL for beginners</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">给初学者的关于BigQuery和SQL的12条建议</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/top-12-advice-on-bigquery-and-sql-for-beginners-cc82924ca60b#2022-05-25">https://towardsdatascience.com/top-12-advice-on-bigquery-and-sql-for-beginners-cc82924ca60b#2022-05-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ade2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">以正确的方式使用BigQuery开始您的数据仓库项目</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8e483848f6ccf709be95b819fdaa55f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*u0jSWKul8AFGAgS9"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">凯瑟琳·拉威利在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="9ffc" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="57bf" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">BigQuery是众多数据仓库解决方案中的一个，但却是最受欢迎的一个。在对不同公司使用的四种相互竞争且熟悉的解决方案进行快速研究比较后，<strong class="lq ir"> BigQuery似乎在领奖台上排名第二。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mk"><img src="../Images/8bfacb6ffdacfb7a40d3efc59b6ff1d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*WtqXCAG5LWvHiWLuCZWR1g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">每个解决方案的采用量。来源:<a class="ae kv" href="https://discovery.hgdata.com/" rel="noopener ugc nofollow" target="_blank">https://discovery.hgdata.com</a>(图片由<a class="ae kv" href="https://romaingranger.medium.com/" rel="noopener">作者</a>)</p></figure><p id="2a87" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">为了分析数据，Google BigQuery以及许多其他数据仓库系统使用SQL作为编程语言。</p><p id="5e5b" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">所以，无论你是想学习SQL，启动一个数据仓库项目，还是想在顶级数据仓库平台上实践，这里有一些建议我很乐意与你分享！</p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h1 id="4702" class="kw kx iq bd ky kz mx lb lc ld my lf lg jw mz jx li jz na ka lk kc nb kd lm ln bi translated">建议1:免费使用BigQuery</h1><p id="fa68" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">您可以在一定程度上免费使用BigQuery。通常需要考虑两个问题:<strong class="lq ir">数据存储</strong>和<strong class="lq ir">数据分析(查询)</strong>。</p><p id="05fe" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">您每月可以免费获得:</p><ul class=""><li id="b89e" class="nc nd iq lq b lr ml lu mm lx ne mb nf mf ng mj nh ni nj nk bi translated"><strong class="lq ir"> 10 GB存储空间</strong></li><li id="c6f2" class="nc nd iq lq b lr nl lu nm lx nn mb no mf np mj nh ni nj nk bi translated"><strong class="lq ir"> 1 TB的查询</strong></li></ul><p id="7ebe" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">其他操作，如批量加载数据(流接收将收费)、复制数据、删除数据或导出数据，通常是免费的。所以，如果你的数据量允许，就不要再等着开始了！</p><p id="cd23" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">您可以在此找到所有BigQuery定价详情:</p><div class="nq nr gp gr ns nt"><a href="https://cloud.google.com/bigquery/pricing" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">定价| BigQuery:云数据仓库|谷歌云</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">BigQuery是一个无服务器的数据分析平台。您不需要调配单个实例或虚拟机…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">cloud.google.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh kp nt"/></div></div></a></div><p id="c7f9" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">关于所有谷歌云平台服务(BigQuery和其他)的免费层和免费层的更多细节可以在这里找到:</p><div class="nq nr gp gr ns nt"><a href="https://cloud.google.com/free" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">免费试用和免费等级|谷歌云</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">使用300美元的免费积分和20多种免费产品，开始在Google Cloud上运行工作负载。告诉我们你在…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">cloud.google.com</p></div></div><div class="oc l"><div class="oi l oe of og oc oh kp nt"/></div></div></a></div><h1 id="b541" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">建议2:理解查询定价</h1><p id="aeea" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">BigQuery的主要用例是对数据进行查询，以便提取有用的信息。有两大类成本:</p><ul class=""><li id="2835" class="nc nd iq lq b lr ml lu mm lx ne mb nf mf ng mj nh ni nj nk bi translated">保管费用</li><li id="b6f5" class="nc nd iq lq b lr nl lu nm lx nn mb no mf np mj nh ni nj nk bi translated">查询成本(分析)</li></ul><p id="a9b8" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">从前面的建议中，我们看到有一个免费层，但在此之后，对于分析统一费率(这是最常见的一种)<strong class="lq ir">您将对每TB查询的数据收取5美元。</strong></p><p id="4b41" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">要估计一个查询需要解析多少数据，您可以查看您的web浏览器代码编辑器，其中有一个通知说:</p><p id="1c41" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated"><strong class="lq ir">该查询在运行时将处理“10 GB”。</strong></p><p id="ba01" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">其中“10”将根据您的查询进行调整，“GB”也是如此(<em class="oj">这个</em> <em class="oj">可以是24 MB、102 KB、14TB等等……</em>)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/6a9dab509359356e0932563bf2421f6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*seFxyRd8JHfjqzqN3y3XPA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">运行该查询将处理的字节数(这里是1.2GB)</p></figure><p id="2161" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">为了了解成本，您可以将查询中处理的数据量转换为兆字节，然后乘以5美元。</p><p id="8d04" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">在我们的示例中，我们有1.2GB，相当于0.0012 TB，然后乘以5等于0.006美元。</p><p id="be35" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">正如你所看到的，我们将为这个查询支付一个非常适中的金额，但我相信你会运行不止一个！</p><p id="e71a" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">一般来说，控制查询成本是一个好的做法。你可以通过这个链接来学习。</p><div class="nq nr gp gr ns nt"><a href="https://cloud.google.com/bigquery/docs/best-practices-costs" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">在BigQuery | Google Cloud中控制成本</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">本页描述了在BigQuery中控制成本的最佳实践。BigQuery有两种定价模式来运行…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">cloud.google.com</p></div></div><div class="oc l"><div class="ol l oe of og oc oh kp nt"/></div></div></a></div><h1 id="407e" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">建议3:探索BigQuery免费数据集</h1><p id="e7d1" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果您没有加载数据，并且想要练习您的技能，BigQuery通过<a class="ae kv" href="https://cloud.google.com/public-datasets" rel="noopener ugc nofollow" target="_blank"> Google Cloud公共数据集计划</a>向公众提供了许多可用的数据集。</p><p id="215c" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">稍后，如果您想要合并/丰富您自己的数据，这些数据集也会很有用。(例如，地理数据等)</p><p id="77f6" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">你可以上<a class="ae kv" href="https://console.cloud.google.com/marketplace/browse?filter=solution-type:dataset" rel="noopener ugc nofollow" target="_blank">数据集市场</a>。这就是市场的样子，当点击一个可用的数据集时，您会看到详细信息(数据的描述和每个字段的描述)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/f22a06084ca6b353a81397c6cd330517.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IYQH6PSdVjKyEQ-Pe-wugw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">谷歌大查询数据集市场(图片由<a class="ae kv" href="https://romaingranger.medium.com/" rel="noopener">作者</a>提供)</p></figure><p id="d221" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">我个人使用以下数据集:</p><ul class=""><li id="1d7e" class="nc nd iq lq b lr ml lu mm lx ne mb nf mf ng mj nh ni nj nk bi translated">Google分析示例</li><li id="30da" class="nc nd iq lq b lr nl lu nm lx nn mb no mf np mj nh ni nj nk bi translated">秘密党员</li><li id="4e66" class="nc nd iq lq b lr nl lu nm lx nn mb no mf np mj nh ni nj nk bi translated">公用事业_欧盟</li></ul><p id="edb6" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated"><strong class="lq ir">费用警告:</strong>谷歌为这些数据集的存储付费，但你将为你执行的查询付费。(参见<strong class="lq ir"> <em class="oj">建议# 1</em></strong><em class="oj">——免费使用big query</em>)。</p><p id="d4c3" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">您可以在SQL FROM语句中使用项目前缀<code class="fe on oo op oq b">bigquery-public-data</code>来查询它们，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="or os l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">查询Google BigQuery公共数据集</p></figure><h1 id="5737" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">建议4:在同一地区创建数据集</h1><p id="b0ae" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">创建数据集时，您必须填写以下信息:</p><ul class=""><li id="192e" class="nc nd iq lq b lr ml lu mm lx ne mb nf mf ng mj nh ni nj nk bi translated"><strong class="lq ir">数据集Id </strong>:您想要给数据集起的名字</li><li id="9732" class="nc nd iq lq b lr nl lu nm lx nn mb no mf np mj nh ni nj nk bi translated"><strong class="lq ir">数据位置</strong>:决定你的数据存储在哪里(欧洲、美国、亚洲等)</li><li id="c225" class="nc nd iq lq b lr nl lu nm lx nn mb no mf np mj nh ni nj nk bi translated"><strong class="lq ir">默认表过期:</strong>如果<strong class="lq ir"> </strong>您希望在指定的天数后自动删除该数据集中的表，或者从不删除</li><li id="5596" class="nc nd iq lq b lr nl lu nm lx nn mb no mf np mj nh ni nj nk bi translated"><strong class="lq ir">加密:</strong>您希望数据如何加密(默认情况下是加密的)</li></ul><p id="c4b1" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">重要的是在你的项目中选择三个可用位置中的一个:美国、欧洲或亚太地区</p><p id="2b37" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">主要原因是，如果您在欧盟有一个数据集，并且您正尝试对美国的数据集进行联接/合并，BigQuery将返回如下错误:</p><blockquote class="ot ou ov"><p id="3de8" class="lo lp oj lq b lr ml jr lt lu mm ju lw ow mn lz ma ox mo md me oy mp mh mi mj ij bi translated">运行查询时出错</p><p id="d61e" class="lo lp oj lq b lr ml jr lt lu mm ju lw ow mn lz ma ox mo md me oy mp mh mi mj ij bi translated">未找到:在位置US中未找到数据集datastic:crypto</p></blockquote><p id="8d8b" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">如果您试图连接来自不同位置的数据，这也适用于其他服务(云SQL等)。</p><p id="5879" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">还要记住，数据集一旦创建，其位置就不能更改。(但是您可以将数据集复制/移动到另一个位置，这需要额外的工作)</p><p id="1a7b" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">此外，不同的地区和位置有不同的定价和特性，您可以在Google文档中找到更多信息。</p><div class="nq nr gp gr ns nt"><a href="https://cloud.google.com/bigquery/docs/locations" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">数据集位置|大查询|谷歌云</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">本页解释了数据位置的概念和可以创建数据集的不同位置。要了解如何…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">cloud.google.com</p></div></div><div class="oc l"><div class="oz l oe of og oc oh kp nt"/></div></div></a></div><h1 id="9a1e" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">建议5:极限陈述不会降低成本</h1><p id="d0e4" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">运行查询时，BigQuery会评估需要处理多少字节(比较<strong class="lq ir"> <em class="oj">建议#2 </em> </strong> <em class="oj"> —了解查询价格)</em>。</p><div class="kg kh ki kj gt ab cb"><figure class="pa kk pb pc pd pe pf paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/0eaf1072a04ccf338613ffc2c8e25385.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*nrzdsCC_KWPUA0HByz-JHQ.png"/></div></figure><figure class="pa kk pg pc pd pe pf paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/846c8f73e9cac7a20f1c30c35bc4a468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*t5i9MSI4I7mP4B054chJ-w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk ph di pi pj translated">使用或不使用LIMIT子句的每个查询处理的字节数(图片由<a class="ae kv" href="https://romaingranger.medium.com/" rel="noopener">作者</a>提供)</p></figure></div><p id="e066" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">在左边，我们观察到这个查询将使用1.2 GB的数据，而没有使用<code class="fe on oo op oq b">LIMIT</code>子句。在右边，我们看到这个查询将使用子句处理完全相同的数据量。</p><p id="6a29" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated"><strong class="lq ir">那么这个条款有什么好处呢？</strong></p><p id="9163" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">优点是它减少了用户界面中显示的数据量，使得显示速度更快。</p><p id="891d" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">此外，当您有一个聚集表时，<code class="fe on oo op oq b">LIMIT</code>子句可以减少扫描的字节数，并且确实减少了查询的成本。</p><h1 id="06a2" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">建议6:只选择你需要的列</h1><p id="259b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">BigQuery是一个<strong class="lq ir">面向列的数据库，</strong>简而言之，在大型数据库中扫描和聚合(求和或平均等)数据非常有效。</p><p id="1919" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">它是高效的，因为它不必从整个行中读取数据。想象一下需要处理的数据，如果您有10亿行40列，您需要读取每行所有40列中包含的数据，而您只需要两三列。</p><p id="73db" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">作为一个良好的实践，建议尽可能不要使用通配符<em class="oj"> SELECT * FROM table </em>，而是实际上只选择您需要的列，例如:</p><p id="01e4" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated"><code class="fe on oo op oq b">SELECT col_1,col_2 FROM table;</code></p><p id="649e" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">这将极大地降低您的查询成本。</p><p id="f650" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">您可以在下面的BigQuery中找到关于数据如何存储和表示的更多细节。</p><div class="nq nr gp gr ns nt"><a href="https://cloud.google.com/bigquery/docs/storage_overview" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">BigQuery存储概述|谷歌云</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">本页描述了BigQuery的存储组件。BigQuery存储针对在…上运行分析查询进行了优化</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">cloud.google.com</p></div></div><div class="oc l"><div class="pk l oe of og oc oh kp nt"/></div></div></a></div><h1 id="28f2" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">建议7:在末尾排序，在使用a <code class="fe on oo op oq b">JOIN</code>之前减少数据</h1><p id="34a1" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">编写查询的方式对成本和执行性能都有影响。这可以通过避免SQL反模式和使用正确的语法来避免。</p><p id="295c" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">以下是我可以分享的一些优化:</p><ul class=""><li id="e77b" class="nc nd iq lq b lr ml lu mm lx ne mb nf mf ng mj nh ni nj nk bi translated">当你之前不需要的时候，在最后订购一次结果</li><li id="4975" class="nc nd iq lq b lr nl lu nm lx nn mb no mf np mj nh ni nj nk bi translated">在执行连接之前减少数据量</li><li id="fc17" class="nc nd iq lq b lr nl lu nm lx nn mb no mf np mj nh ni nj nk bi translated">在查询开始时使用WHERE和DISTINCT语句，以减少所需的数据量。</li><li id="d748" class="nc nd iq lq b lr nl lu nm lx nn mb no mf np mj nh ni nj nk bi translated">使用近似聚合函数</li></ul><p id="b717" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">除了本文中的其他建议(参见<strong class="lq ir"> <em class="oj">建议# 5</em></strong><em class="oj">——仅选择您需要的列</em>)之外，另一个优秀的实践是在早期减少必要的数据量，以减轻后续查询步骤的负担。</p><p id="86a8" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">一般来说，避免<strong class="lq ir"> SQL反模式是最佳实践</strong>。SQL反模式只是开发SQL代码时的一个常见错误。</p><div class="nq nr gp gr ns nt"><a href="https://cloud.google.com/bigquery/docs/best-practices-performance-patterns" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">避免SQL反模式| BigQuery | Google Cloud</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">以下最佳实践为避免影响BigQuery性能的查询反模式提供了指导。最佳…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">cloud.google.com</p></div></div><div class="oc l"><div class="pl l oe of og oc oh kp nt"/></div></div></a></div><div class="nq nr gp gr ns nt"><a href="https://github.com/boralp/sql-anti-patterns" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">GitHub-boralp/sql-反模式:SQL中的反模式列表</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">将id列表存储为VARCHAR/TEXT列会导致性能和数据完整性问题。查询此类…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">github.com</p></div></div><div class="oc l"><div class="pm l oe of og oc oh kp nt"/></div></div></a></div><p id="99bc" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">您还可以更深入地了解SQL查询优化和性能。</p><div class="nq nr gp gr ns nt"><a href="https://cloud.google.com/bigquery/docs/best-practices-performance-overview" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">优化查询性能简介| BigQuery | Google Cloud</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">一般来说，工作量少的查询性能更好。性能更好的查询消耗的资源更少，这可能…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">cloud.google.com</p></div></div><div class="oc l"><div class="pn l oe of og oc oh kp nt"/></div></div></a></div><h1 id="5acc" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">建议8:格式化你的查询</h1><p id="6cff" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">格式化你的查询将会对你的读者或者在完成代码审查时产生影响，这是我鼓励从一开始就养成的习惯。</p><p id="cf9b" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">对于mac用户，可以在BigQuery浏览器编辑器中使用以下快捷键:<strong class="lq ir"> cmd+shift+f </strong></p><p id="6b32" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">它将改变您的查询的外观:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="or os l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">非格式化查询</p></figure><p id="3786" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">更易读、更清晰的格式，突出显示函数、名称、子句和语句，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="or os l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用BigQuery自动格式化cmd+shift+f的SQL格式化查询</p></figure><h1 id="1d59" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">建议9:跟上时代</h1><p id="c38f" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">谷歌开发人员不断地给他们的产品添加新功能，BigQuery也是如此。这可以是<strong class="lq ir">新功能</strong>、<strong class="lq ir">公告</strong>、<strong class="lq ir"> bug修复</strong>、<strong class="lq ir">或者简单的改动。了解这些变化是值得的。</strong></p><p id="3851" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">这些说明包括对BigQuery、BigQuery ML、BigQuery数据传输服务和BigQuery Omni的更改。</p><div class="nq nr gp gr ns nt"><a href="https://cloud.google.com/bigquery/docs/release-notes" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">发布说明| BigQuery |谷歌云</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">本页记录了BigQuery的产品更新。我们建议BigQuery开发人员定期检查这个列表…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">cloud.google.com</p></div></div><div class="oc l"><div class="po l oe of og oc oh kp nt"/></div></div></a></div><p id="0de6" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">您可以在BigQuery中以编程方式访问发布说明，这也将使您能够灵活地通过日期和<strong class="lq ir">以及说明类型</strong>(修复、问题、特性、服务、重大变更等)对<strong class="lq ir">进行排序</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="or os l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">查询BigQuery的Google发行说明</p></figure><h1 id="cfb6" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">建议10:在你的查询中添加评论</h1><p id="04b1" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">不管使用什么语言(SQL、Python、R、C++、Javascript等)，注释代码都是一个好习惯。</p><p id="d25a" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated"><strong class="lq ir">它解释了代码做什么</strong>，SQL查询也不例外。</p><p id="9462" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">在BigQuery以及许多其他系统中，可以使用双破折号(连字符)进行注释，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="or os l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用双破折号插入注释</p></figure><p id="9b30" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">对于mac用户，可以使用键盘快捷键<strong class="lq ir"> cmd+/ </strong>来自动注释查询的每一行。</p><h1 id="1c03" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">建议11:学会调试你的查询</h1><p id="a1ba" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">调试和改进您的查询可能需要一些练习。但是，如果您发现您的查询过于缓慢或过于昂贵，您可以阅读查询编辑器中的查询执行细节选项卡。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pp"><img src="../Images/4218e2b96e26c4dfb047ef6015cbc439.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-K4CEZLNwRAPkLyLycvomg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">查询的执行细节(图片由<a class="ae kv" href="https://romaingranger.medium.com/" rel="noopener">作者</a>提供)</p></figure><p id="2c92" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">一篇很好的帖子讨论了BQvisualiser，这是一个可以用来评估你的查询哪里可以改进的工具。此工具直接连接到您的项目。</p><div class="nq nr gp gr ns nt"><a href="https://medium.com/google-cloud/visualising-bigquery-41bf6833b98" rel="noopener follow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">可视化BigQuery查询计划</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">Tldr:可视化https://bqvisualiser.appspot.com上的BigQuery执行</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">medium.com</p></div></div><div class="oc l"><div class="pq l oe of og oc oh kp nt"/></div></div></a></div><p id="6536" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">有关查询执行的更多信息，请访问:</p><div class="nq nr gp gr ns nt"><a href="https://cloud.google.com/bigquery/query-plan-explanation?_ga=2.124063242.-1866349659.1650452569" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">查询计划和时间表| BigQuery | Google Cloud</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">BigQuery嵌入在查询作业中，包括诊断查询计划和计时信息。这类似于…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">cloud.google.com</p></div></div><div class="oc l"><div class="pr l oe of og oc oh kp nt"/></div></div></a></div><h1 id="264e" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">建议#12:社区UDF</h1><p id="cf3b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">尽管UDF(用户定义函数)已经是一个比较复杂的主题，但是有一些社区资源可以帮助您入门，或者至少在您自己的项目中重用它们！</p><div class="nq nr gp gr ns nt"><a href="https://github.com/GoogleCloudPlatform/bigquery-utils" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">GitHub-GoogleCloudPlatform/big query-utils:有用的脚本、UDF、视图和其他实用工具，用于…</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">BigQuery是一个无服务器的、高度可扩展的、经济高效的云数据仓库，具有内存BI引擎和…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">github.com</p></div></div><div class="oc l"><div class="ps l oe of og oc oh kp nt"/></div></div></a></div><p id="0a7d" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">UDF是允许您将Javascript或SQL代码作为函数运行的函数。例如，假设您的表中有一个包含城市名称的字段，并且您希望对它们进行整理，那么您可以使用Javascript库编写一个函数，并将它一次性应用到整个表中。</p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h1 id="2660" class="kw kx iq bd ky kz mx lb lc ld my lf lg jw mz jx li jz na ka lk kc nb kd lm ln bi translated">让我们付诸行动吧。✨</h1><p id="b832" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我希望这十二条建议能够帮助您在BigQuery上有一个良好的开端，或者只是探索并熟悉这项技术。</p><p id="3f36" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">许多数据仓库技术都有类似的品质，肯定会是您的应用程序的绝佳选择。我要说的是，根据您的特殊要求仔细检查规格和细节仍然很重要。</p><p id="784c" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">请让我知道你是否觉得这篇文章内容丰富，是否在评论中对你有所帮助！🤓</p></div></div>    
</body>
</html>