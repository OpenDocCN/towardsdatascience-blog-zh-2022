<html>
<head>
<title>How To Group By Columns With Missing Values in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 Pandas 中按缺少值的列分组</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/groupby-with-nan-values-pandas-a05e53f410b#2022-11-14">https://towardsdatascience.com/groupby-with-nan-values-pandas-a05e53f410b#2022-11-14</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="1398" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">在 pandas 列中分组时合并空值</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/7bc17eee805c2c4281ac65c0df20fd6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BsvTpFiWwnVw3PnxVDbaOg.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@firmbee?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Firmbee.com</a>在<a class="ae kz" href="https://unsplash.com/s/photos/graph?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="0c4a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">使用 group by 子句执行聚合可能是您在日常工作中遇到的事情。Python 中的 Pandas 也不例外，因为这是一个你肯定会在库的许多不同地方看到的操作。</p><p id="e0e2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然而，pandas 的默认行为是从结果中排除空值/缺失值。在今天的简短教程中，我们将演示这种默认行为以及将缺失值合并到结果聚合中的方法。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><p id="55e0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">首先，让我们创建一个示例</p><pre class="kk kl km kn gu md me mf bn mg mh bi"><span id="dd9b" class="mi mj iu me b be mk ml l mm mn">import numpy as np<br/>import pandas as pd <br/><br/>df = pd.DataFrame(<br/>    [ <br/>        (1, 'B', 121, 10.1, True),<br/>        (2, 'C', 145, 5.5, False),<br/>        (3, 'A', 345, 4.5, False),<br/>        (4, 'A', 112, np.nan, True),<br/>        (5, 'C', 105, 2.1, False),<br/>        (6, np.nan, 435, 7.8, True),<br/>        (7, np.nan, 521, np.nan, True),<br/>        (8, 'B', 322, 8.7, True),<br/>        (9, 'C', 213, 5.8, True),<br/>        (10, 'B', 718, 9.1, False),<br/>    ],<br/>    columns=['colA', 'colB', 'colC', 'colD', 'colE']<br/>)<br/><br/><br/>print(df)<br/>   colA colB  colC  colD   colE<br/>0     1    B   121  10.1   True<br/>1     2    C   145   5.5  False<br/>2     3    A   345   4.5  False<br/>3     4    A   112   NaN   True<br/>4     5    C   105   2.1  False<br/>5     6  NaN   435   7.8   True<br/>6     7  NaN   521   NaN   True<br/>7     8    B   322   8.7   True<br/>8     9    C   213   5.8   True<br/>9    10    B   718   9.1  False</span></pre></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="ba59" class="mo mj iu bd mp mq mr dn ms mt mu dp mv lj mw mx my ln mz na nb lr nc nd ne nf bi translated">默认行为</h2><p id="996d" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">现在让我们假设我们想要计算<code class="fe nl nm nn me b">colB</code>中每个值的总和。这很简单，可以用下面的表达式来完成</p><pre class="kk kl km kn gu md me mf bn mg mh bi"><span id="2c1c" class="mi mj iu me b be mk ml l mm mn">df.groupby('colB')['colD'].sum()</span></pre><p id="f693" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这将返回以下结果:</p><pre class="kk kl km kn gu md me mf bn mg mh bi"><span id="f6ad" class="mi mj iu me b be mk ml l mm mn">&gt;&gt;&gt; df.groupby('colB')['colD'].sum()<br/>colB<br/>A     4.5<br/>B    27.9<br/>C    13.4<br/>Name: colD, dtype: float64</span></pre><p id="b30e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是我们可以注意到，输出中缺少值(<code class="fe nl nm nn me b">None</code>)。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="8244" class="mo mj iu bd mp mq mr dn ms mt mu dp mv lj mw mx my ln mz na nb lr nc nd ne nf bi translated">在聚合中合并空值</h2><p id="4209" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">您可能仍然希望将缺失的值合并到聚合中。为了做到这一点，您需要做的就是在调用<code class="fe nl nm nn me b">groupby</code>函数时显式指定<code class="fe nl nm nn me b">dropna=False</code>——该值默认为<code class="fe nl nm nn me b">True</code>。请注意，这对于<strong class="lc iv"> pandas 版本≥ 1.1 </strong>是可能的。</p><pre class="kk kl km kn gu md me mf bn mg mh bi"><span id="b0a2" class="mi mj iu me b be mk ml l mm mn">df.groupby('colB', dropna=False)['colD'].sum()</span></pre><p id="8229" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">并且结果序列还将包括缺失值的计数:</p><pre class="kk kl km kn gu md me mf bn mg mh bi"><span id="d978" class="mi mj iu me b be mk ml l mm mn">&gt;&gt;&gt; df.groupby('colB', dropna=False)['colD'].sum()<br/>colB<br/>A       4.5<br/>B      27.9<br/>C      13.4<br/>NaN     7.8<br/>Name: colD, dtype: float64</span></pre><p id="7209" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">显然，同样的概念也适用于其他聚合类型，比如 count。举个例子，</p><pre class="kk kl km kn gu md me mf bn mg mh bi"><span id="baa0" class="mi mj iu me b be mk ml l mm mn">&gt;&gt;&gt; df.groupby('colB').count()<br/>      colA  colC  colD  colE<br/>colB                        <br/>A        2     2     1     2<br/>B        3     3     3     3<br/>C        3     3     3     3</span></pre><p id="2eb3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">而不是</p><pre class="kk kl km kn gu md me mf bn mg mh bi"><span id="d5db" class="mi mj iu me b be mk ml l mm mn">&gt;&gt;&gt; df.groupby('colB', dropna=False).count()<br/>      colA  colC  colD  colE<br/>colB                        <br/>A        2     2     1     2<br/>B        3     3     3     3<br/>C        3     3     3     3<br/>NaN      2     2     1     2</span></pre></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="78f3" class="mo mj iu bd mp mq mr dn ms mt mu dp mv lj mw mx my ln mz na nb lr nc nd ne nf bi translated">最后的想法</h2><p id="f311" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">使用最新的 pandas 版本，您现在可以在对 pandas 数据帧执行聚合时合并缺失值。但是请注意，如果您运行的是不支持<code class="fe nl nm nn me b">groupby</code>方法中的<code class="fe nl nm nn me b">dropna</code>的旧版本，那么(除了升级到最新版本之外，这总是一个好的做法！)您也可以找到一些解决方法，如下所示:</p><pre class="kk kl km kn gu md me mf bn mg mh bi"><span id="2d5c" class="mi mj iu me b be mk ml l mm mn"># Fill the missing values with a particular placeholder value<br/># Note though that you must be careful when selecting such <br/># value in order to avoid any collisions with pre-existing values<br/># in the dataframe<br/># In the example below I'll use -1, but make sure to amend if needed<br/>&gt;&gt;&gt; df.fillna(-1).groupby('colB').sum()</span></pre></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><p id="1b77" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://gmyrianthous.medium.com/membership" rel="noopener"> <strong class="lc iv">成为会员</strong> </a> <strong class="lc iv">阅读介质上的每一个故事。你的会员费直接支持我和你看的其他作家。你也可以在媒体上看到所有的故事。</strong></p><div class="no np gq gs nq nr"><a href="https://gmyrianthous.medium.com/membership" rel="noopener follow" target="_blank"><div class="ns ab fp"><div class="nt ab nu cl cj nv"><h2 class="bd iv gz z fq nw fs ft nx fv fx it bi translated">通过我的推荐链接加入 Medium-Giorgos Myrianthous</h2><div class="ny l"><h3 class="bd b gz z fq nw fs ft nx fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nz l"><p class="bd b dl z fq nw fs ft nx fv fx dk translated">gmyrianthous.medium.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of kt nr"/></div></div></a></div></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><p id="676e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">相关文章你可能也喜欢</strong></p><div class="no np gq gs nq nr"><a rel="noopener follow" target="_blank" href="/how-to-merge-pandas-dataframes-221e49c41bec"><div class="ns ab fp"><div class="nt ab nu cl cj nv"><h2 class="bd iv gz z fq nw fs ft nx fv fx it bi translated">如何合并熊猫数据帧</h2><div class="ny l"><h3 class="bd b gz z fq nw fs ft nx fv fx dk translated">对熊猫数据帧执行左、右、内和反连接</h3></div><div class="nz l"><p class="bd b dl z fq nw fs ft nx fv fx dk translated">towardsdatascience.com</p></div></div><div class="oa l"><div class="og l oc od oe oa of kt nr"/></div></div></a></div></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu nr"><a rel="noopener follow" target="_blank" href="/data-engineer-tools-c7e68eed28ad"><div class="ns ab fp"><div class="nt ab nu cl cj nv"><h2 class="bd iv gz z fq nw fs ft nx fv fx it bi translated">数据工程师的工具</h2><div class="ny l"><h3 class="bd b gz z fq nw fs ft nx fv fx dk translated">数据工程工具箱的基础</h3></div><div class="nz l"><p class="bd b dl z fq nw fs ft nx fv fx dk translated">towardsdatascience.com</p></div></div><div class="oa l"><div class="oh l oc od oe oa of kt nr"/></div></div></a></div></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu nr"><a rel="noopener follow" target="_blank" href="/visual-sql-joins-4e3899d9d46c"><div class="ns ab fp"><div class="nt ab nu cl cj nv"><h2 class="bd iv gz z fq nw fs ft nx fv fx it bi translated">SQL 连接的直观解释</h2><div class="ny l"><h3 class="bd b gz z fq nw fs ft nx fv fx dk translated">用维恩图和实际例子理解 SQL 连接</h3></div><div class="nz l"><p class="bd b dl z fq nw fs ft nx fv fx dk translated">towardsdatascience.com</p></div></div><div class="oa l"><div class="oi l oc od oe oa of kt nr"/></div></div></a></div></div></div>    
</body>
</html>