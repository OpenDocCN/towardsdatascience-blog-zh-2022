<html>
<head>
<title>5 Window Function Examples to Take Your SQL Skills to the Next Level</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">5 个窗口函数示例，让您的 SQL 技能更上一层楼</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/5-window-function-examples-to-take-your-sql-skills-to-the-next-level-2b3306650bb6#2022-03-09">https://towardsdatascience.com/5-window-function-examples-to-take-your-sql-skills-to-the-next-level-2b3306650bb6#2022-03-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="eb74" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">数据科学</h2><div class=""/><div class=""><h2 id="badd" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">如果你想掌握 SQL 中的数据操作，你需要理解窗口函数</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/439e5ca16aa6debead467f92f87093b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PvojTFSTVukos0dG9CqXfg.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://www.pexels.com/photo/person-sitting-on-mountain-cliff-1659438/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae lh" href="https://www.pexels.com/@m-venter-792254?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> M Venter </a>拍摄</p></figure><p id="1112" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了达到 SQL 的下一个专业水平，理解窗口函数是很重要的。窗口函数起初看起来令人生畏，但是一旦你理解了它们，你会发现它们有许多不同的应用。在我分享我的例子之前，我想为那些可能不熟悉的人解释一下它们是什么。我希望在这篇文章结束时，你将会探索在你自己的工作中使用窗口函数的方法。如果你已经熟悉了窗口函数，可以直接跳到第三个例子。</p><p id="1a5f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我分享的例子是我职业生涯中最常用的窗口函数，所以希望它们也适用于你的工作。</p><p id="72d6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我将使用这个 SQLite 沙盒数据库作为我的代码示例:【https://www.sql-practice.com/ T4】</p><h2 id="4a32" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated"><strong class="ak">什么是窗口功能？</strong></h2><p id="84bd" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">窗口函数是对数据集的多行执行计算，同时保持原始表的相同行数和行数的函数。</p><h2 id="677e" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated"><strong class="ak"> 1。你的第一个窗口函数</strong></h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="6e48" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在试图理解窗口函数时要记住的主要事情是，窗口函数维护表的原始行。对于我的第一个例子，我使用的查询与我在<a class="ae lh" rel="noopener" target="_blank" href="/10-quick-sql-tips-after-writing-daily-in-sql-for-3-years-37bdba0637d0">上一篇文章</a>中写的关于在您的数据生涯中使用 SQL 技巧的查询相同。</p><p id="e5a1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这个例子是我想象的窗口函数的一个简单的用例。也就是说，如果你能掌握第一个例子，你就能把这个模式应用到很多不同的用例中。你掌握 SQL 中数据操作的能力一定会向前迈进一大步。</p><p id="0cde" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，我将解释上述窗口函数的输出是什么。输出将为您提供相同数量的行，并且您的最终列将是城市的最大权重。这意味着如果一个城市出现不止一次，那么权重值将会重复。这种重复经常发生在窗口函数中，因为我们在执行聚合时没有折叠表中的任何行。</p><p id="536b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面是另一个查询，它给出了与上面完全相同的结果，只是时间更长，计算量更大。希望这能帮助你理解窗口函数的作用。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="8d91" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">具体来说，一个典型的窗口子句将如下所示:</p><p id="0b68" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><window function="">结束(<window definition=""/></window></p><p id="ddde" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">窗口函数可以是聚合窗口函数，也可以是内置窗口函数。下面是您可以使用的<a class="ae lh" href="https://www.sqlite.org/lang_aggfunc.html" rel="noopener ugc nofollow" target="_blank">聚合函数</a>的列表。你很可能已经熟悉这些。</p><p id="43ac" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下一部分是增加“T4”条款。 <strong class="lk jd">如果它没有 over 子句，那么它就不是窗口函数。</strong></p><p id="b0d0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">over 子句位于窗口定义之前。在这种情况下，我们使用 partition by。现在不要担心其他的窗口定义。最常见的两种是按划分的<em class="nd">和按</em>排序的<em class="nd">，这就是我在本文中要介绍的全部内容。您可能已经猜到了，<em class="nd"> partition by </em>指定了聚合的级别。在这种情况下，我们告诉查询我们想要城市的最大权重。</em></p><p id="2dbc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">就这样，这是你的第一个窗口函数🙌</p><h2 id="c0e2" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">2.<strong class="ak">真正最简单的窗口功能</strong></h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="ba7d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">好了，现在我们已经完成了你的第一个窗口函数，我想让你的大脑休息一下，让第二个例子变得非常简单。</p><p id="fc10" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当您不包括窗口定义时，您将对整个表进行聚合。这在特殊情况下会派上用场，所以我想我会快速展示一下，这样它就在你的脑海中，供你以后工作时使用。</p><p id="d0e9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面是不带窗口函数的等效查询。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="3984" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">3.介绍“按窗口排序”定义</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="aeb2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">既然我们已经介绍了窗口函数的基本知识，我想介绍第二个窗口定义:ORDER BY。这正如它的名字所暗示的；它根据您选择的列对表格行中的数据进行排序。</p><p id="7d56" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在上面的例子中，这个窗口函数是按日期计算入院人数的累计。我不会为此包含一个等价的，因为我不认为不使用窗口函数就能做到这一点。这就是为什么我在文章的开头说窗口函数会让你在 SQL 中的数据操作技巧更上一层楼。</p><h2 id="c2bf" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">4.ROW_NUMBER 窗口函数</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="0bff" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于第四个例子，我想结合您到目前为止所学的一些内容，同时还添加了行号窗口功能。到目前为止，我只为第一个函数包含了聚合窗口函数，因为这是最简单的窗口函数子句类型，但是也有内置的窗口函数可用(确切地说有 11 个)。</p><p id="898f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">本例中唯一的新概念是窗口函数开头的 row_number()函数。这将根据窗口定义分配一个连续的数字。在这种情况下，我们的定义是希望按城市分区，按出生日期降序排序。</p><p id="24ad" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你仍然不确定如何形象化这一点，这里是我在开始链接的 sql 实践网站的链接:<a class="ae lh" href="https://www.sql-practice.com/" rel="noopener ugc nofollow" target="_blank">https://www.sql-practice.com/</a>。在该网站中键入删除了 where 子句的 SQL 代码，以了解发生了什么。</p><p id="2282" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">该查询回答的问题是，“每个城市中第二年轻的患者是谁？”。您也许能够轻松地编写一个等价的查询来查找每个城市中最年轻的患者，但是第二个或第三个呢？窗口函数使得一些困难的问题变得简单得多。</p><h2 id="eaab" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated"><strong class="ak"> 5。滞后和超前窗口功能</strong></h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="a0dd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">该窗口函数回答以下问题，“每个患者与下一个最高的人相比，身高有什么不同？”。</p><p id="1da9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">显然，这只是一个例子，寻找高度差异可能不是一个现实的问题，但有很多使用情况下，与数据集中的前一行进行比较是有用的-股票是一个常见的例子。</p><p id="10b6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Lag 获取前一行的值并将其放在当前行上。默认的滞后是 1 行，但是您可以在 lag 函数中选择列之后立即指定该参数。</p><p id="0b84" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">超前和滞后类似，只是作用方向相反。它获取下一行并将值放入当前行进行比较。</p><h2 id="4ca6" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">结论</h2><p id="4559" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">这是窗口功能的概述。我希望它对您提高 SQL 技能有所帮助。如果你想要一个更高级的关于窗口功能或者我在这里没有提到的东西的教程，请在评论中告诉我。此外，如果你觉得有一个 SQL 主题你想了解更多，也请让我知道。</p><p id="7c9e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要阅读关于窗口函数的其他详细信息，请参考 SQLite 窗口函数文档。</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><div class="ks kt ku kv gt nl"><a href="https://medium.com/@andreasmartinson/membership" rel="noopener follow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd jd gy z fp nq fr fs nr fu fw jc bi translated">加入 Medium 并通过我的推荐链接支持我</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">medium.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz lb nl"/></div></div></a></div><p id="3754" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你喜欢这篇文章，请在<a class="ae lh" href="https://www.linkedin.com/in/aem193/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系我，或者看看我的另一个故事:</p><div class="oa ob gp gr oc nl"><a rel="noopener follow" target="_blank" href="/why-is-nobody-talking-about-sql-anti-joins-f970a5f6cb54"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd jd gy z fp nq fr fs nr fu fw jc bi translated">如何在您的数据科学职业生涯中使用 SQL 反连接</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">为什么你应该知道他们</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">towardsdatascience.com</p></div></div><div class="nu l"><div class="od l nw nx ny nu nz lb nl"/></div></div></a></div><div class="oa ob gp gr oc nl"><a rel="noopener follow" target="_blank" href="/10-quick-sql-tips-after-writing-daily-in-sql-for-3-years-37bdba0637d0"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd jd gy z fp nq fr fs nr fu fw jc bi translated">三年来每天用 SQL 写作的 10 个快速 SQL 技巧</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">这些技巧解决了您作为数据专业人员将会遇到的常见 SQL 问题</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">towardsdatascience.com</p></div></div><div class="nu l"><div class="oe l nw nx ny nu nz lb nl"/></div></div></a></div></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><p id="8452" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">参考文献</strong></p><ol class=""><li id="0ccd" class="of og it lk b ll lm lo lp lr oh lv oi lz oj md ok ol om on bi translated"><a class="ae lh" href="https://www.sql-practice.com/" rel="noopener ugc nofollow" target="_blank">sql-practice.com</a>，SQL Practice.com</li><li id="e538" class="of og it lk b ll oo lo op lr oq lv or lz os md ok ol om on bi translated"><a class="ae lh" href="https://www.sqlite.org/lang_aggfunc.html" rel="noopener ugc nofollow" target="_blank">内置聚合函数</a>，SQLite 文档</li><li id="d7e1" class="of og it lk b ll oo lo op lr oq lv or lz os md ok ol om on bi translated"><a class="ae lh" href="https://www.sqlite.org/windowfunctions.html" rel="noopener ugc nofollow" target="_blank">窗口功能</a>，SQLite 文档</li></ol></div></div>    
</body>
</html>