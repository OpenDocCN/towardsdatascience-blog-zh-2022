<html>
<head>
<title>Who emits the most Co2?A treemap animation with Plotly.graph_object</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谁排放的二氧化碳最多？带有Plotly.graph_object的树状图动画</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/who-emits-the-most-co2-a-treemap-animation-with-plotly-graph-object-1f3c0e4918cc#2022-08-16">https://towardsdatascience.com/who-emits-the-most-co2-a-treemap-animation-with-plotly-graph-object-1f3c0e4918cc#2022-08-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ac40" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Plotly Gragh_object制作一个带有滑块的动画树形图，用于更改数据显示</h2></div><p id="e211" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">【找到本文代码</em> <a class="ae lf" href="https://github.com/lanchuhuong/Plotly-Dash/blob/master/Plotly_Dash_Emission_Viz.ipynb" rel="noopener ugc nofollow" target="_blank"> <em class="le">这里</em> </a> <em class="le">。] </em></p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/ca82808a4bf57cfd32e646c2ec62422f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6N2vQkjrj7bYoVmneuLEVw.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">作者图片</p></figure><p id="809d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将学习如何使用Plotly库的Graph_object模块，通过“树形图”可视化来可视化分层数据。</p><p id="ed2f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">Plotly Express vs . Plotly Graph _ object</strong></p><p id="a3e1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Plotly Python库是一个用于交互式可视化的开源库。Plotly Express模块提供了一个快速简单的实现，作为使用简单语法创建最常见图形的起点，但在涉及更高级的图表类型或自定义时，它缺乏功能性和灵活性。</p><p id="9c2e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">与Plotly Express相比，Plotly Graph Objects (Go)需要更多的编码，但更具可定制性和灵活性。用Plotly库生成的每个图形实际上都使用了图形对象，除非是用字典手工构造的。</p><p id="7de7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以在一次函数调用中使用Plotly Express模块，用几行代码创建一个树形图。然而，Plotly Express不提供添加更多类似滑块动画的交互式功能。在本教程中，我将向你展示如何使用Go来创建带有滑块动画的动画树状图。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="3e18" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">得到💬任何数据科学或编程问题的GPT式答案。为成千上万的人生成摘要和学习笔记📚只需一次点击即可获得学习资源。👉</p><div class="md me gp gr mf mg"><a href="https://aigents.co/learn" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab fo"><div class="mi ab mj cl cj mk"><h2 class="bd iu gy z fp ml fr fs mm fu fw is bi translated">面向数据科学家和开发人员的免费学习资源。精选的博客、教程、书籍和…</h2><div class="mn l"><h3 class="bd b gy z fp ml fr fs mm fu fw dk translated">机器学习和人工智能工程师的培训课程、黑客马拉松、活动和工作</h3></div><div class="mo l"><p class="bd b dl z fp ml fr fs mm fu fw dk translated">aigents.co</p></div></div><div class="mp l"><div class="mq l mr ms mt mp mu lq mg"/></div></div></a></div></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="d358" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">准备数据</h1><p id="719d" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">本文使用了1947-2020年的CO2排放数据，这些数据是开放数据，可以从数据【1】中的<a class="ae lf" href="https://github.com/owid/co2-data" rel="noopener ugc nofollow" target="_blank">我们的世界免费获取。数据集包含温室气体排放属性，如二氧化碳、甲烷、一氧化二氮...等等。</a></p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ns"><img src="../Images/74c511d3b897209a081486cdf1e8c59b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PIbsHJbKv2kEAwzsRov2kw.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">数据集中的一些属性。图片作者。</p></figure><p id="e9fb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">树形图使用嵌套的矩形可视化分层数据。分级数据通常存储为矩形数据框，不同的列对应于分级结构的不同级别。</p><p id="f75c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要创建树形图，在正确的层次结构中创建数据集是非常重要的，否则，它将不起作用。该顺序从层级的底部到顶部开始，底部级别是指“<em class="le">子代”</em>，顶部级别对应于“<em class="le">根父代</em>”。</p><p id="53d5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，我的数据集包含每个国家和每年的排放量，我们称之为df_ghg_country。由于每个国家/孩子属于一个洲，每个国家的“<em class="le">中间父</em>将是洲。因此,“大陆”列将是df_ghg_country中子“国家”的父列。接下来，所有的大陆将组成“<em class="le">世界</em>”。因此，在大陆级别，大陆将是孩子，而"<em class="le">世界</em>"将是"<em class="le">根父"</em>。</p><p id="8060" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了使树形图工作，每个父矩形的总值/大小需要等于所有嵌套子矩形的总和。要获得每个中间父/洲矩形的大小，将所有相应子/国家的值相加。这可以通过创建一个新的数据框架来获得各大洲每年的二氧化碳排放总量来实现。然后，在这个新数据框中创建父列，它应该接收值“world”。我们姑且称这个数据框为df _ GHG _ continental。下面的代码将完成这项工作:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="c548" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要获得每年根父/世界矩形的大小，只需将所有国家每年的所有人均二氧化碳值相加，即可创建一个新的数据框。这个就叫df_ghg_world吧。由于“world”本身是最终的父项，它没有父项，因此该数据集的父列将接收空值。创建df_ghg_world可以通过下面的代码实现:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="9f63" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要制作包含所有等级的最终数据集，只需连接所有上述数据框df_ghg_country、df _ GHG _ continental和df_ghg_world。最终的数据集将如下所示:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nt nu l"/></div></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/76a41863d5513e1d305d4557bdcf593b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*ySgBSNKb_XaZXL-j4HT4ww.png"/></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">作者图片</p></figure><h1 id="1592" class="mv mw it bd mx my nw na nb nc nx ne nf jz ny ka nh kc nz kd nj kf oa kg nl nm bi translated">用滑块动画创建树形图</h1><p id="9bf8" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated"><strong class="kk iu">做一年的树状图地块</strong></p><p id="6200" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要使用Plotly Graph_Objects制作树形图，我们需要使用Go。图，并至少提供以下参数:</p><ol class=""><li id="ab76" class="ob oc it kk b kl km ko kp kr od kv oe kz of ld og oh oi oj bi translated">每个矩形的标签</li><li id="8897" class="ob oc it kk b kl ok ko ol kr om kv on kz oo ld og oh oi oj bi translated">每个矩形的大小/值:设置与每个矩形相关的值。该值用于指定每个矩形的大小。</li><li id="9cb0" class="ob oc it kk b kl ok ko ol kr om kv on kz oo ld og oh oi oj bi translated">父母</li></ol><p id="34a4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">随着更多关于外观改进的争论，动画树状图来了！</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nt nu l"/></div></figure><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="op nu l"/></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">2020年人均二氧化碳排放量。作者图片</p></figure><p id="6221" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">添加滑块动画:</strong></p><p id="df19" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的数据是一个时间序列数据集。为了了解每个国家对全球二氧化碳排放量的贡献如何随着时间的推移而变化，我们将添加一个动画，自动向前移动一个滑块，该滑块负责改变我们想要可视化的显示数据。</p><p id="1f2a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以使用go.layout和go.Figure中的滑块和帧参数来实现这一点。通过创建一个帧列表，其中每个帧都对应于特定年份的树形图，每个帧都将在动画中逐一显示。详细步骤和代码如下:</p><ol class=""><li id="99ac" class="ob oc it kk b kl km ko kp kr od kv oe kz of ld og oh oi oj bi translated">使用plotly.go创建一个图表列表，其中包括数据中每年的树形图。</li><li id="d419" class="ob oc it kk b kl ok ko ol kr om kv on kz oo ld og oh oi oj bi translated">使用Plotly.go.frame将步骤1中的每个图形转换为一个框架，从而创建一个框架列表。</li></ol><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="fb24" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">3.制作一个滑动条列表，列表中的每个元素都是每个滑动条外观的字典。</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="65e1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意，在步骤2中为每个框架指定的名称应该与上面代码片段中第8行args内部指定的名称相同。</p><p id="2ca5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">4.创建布局对象，它是一个字典，其中滑块(在步骤3中)是一个参数，播放按钮包含在“updatemenus”键中</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="df56" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">5.使用带有布局和框架参数的Go.figure创建图形。框架(在步骤2中)被添加为图形对象中的关键点。这些帧指向一个图形列表，当动画被触发时，每个图形都将被循环显示。布局对象(在步骤4中创建)被传递给Go.Figure中的布局构造函数。</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="acae" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你现在可以和这张地图互动，看看在过去的60年里，每个国家的二氧化碳排放量是如何变化的。每个矩形的大小与特定国家的人均二氧化碳份额成正比。</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="op nu l"/></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">1960-2020年期间每个国家的人均二氧化碳排放量。图片作者。</p></figure><p id="750a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在你有了它，一个令人惊叹的使用Plotly的Graph_objects模块的动画树形图可视化。请在评论中告诉我你的想法！</p><p id="f284" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[1]公开数据:数据中关于我们世界的二氧化碳和温室气体排放的数据。<a class="ae lf" href="https://github.com/owid/co2-data" rel="noopener ugc nofollow" target="_blank">访问链接。</a></p><p id="eb92" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[2] <a class="ae lf" href="https://plotly.com/python-api-reference/generated/plotly.graph_objects.Figure.html" rel="noopener ugc nofollow" target="_blank">阴谋地文档</a></p><p id="a7b5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">感谢您的阅读。如果你觉得我的帖子有用，并且正在考虑成为中级会员，你可以考虑通过这个</em> <a class="ae lf" href="https://medium.com/@huonglanchu0712/membership" rel="noopener"> <em class="le">推荐会员链接</em> </a> <em class="le">:)来支持我，我将收取你的一部分会员费，不需要你额外付费。如果你决定这样做，非常感谢你！</em></p></div></div>    
</body>
</html>