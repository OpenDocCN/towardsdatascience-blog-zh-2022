<html>
<head>
<title>Have You Ever “Tested” Your Data Pipelines?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">您曾经“测试”过您的数据管道吗？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/have-you-ever-tested-your-data-pipelines-165e31fd87d8#2022-12-17">https://towardsdatascience.com/have-you-ever-tested-your-data-pipelines-165e31fd87d8#2022-12-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="071b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使您的数据管道可测试、可维护且可靠的综合指南</h2></div><h2 id="a2cc" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">为什么有必要测试您的数据管道？</h2><p id="1951" class="pw-post-body-paragraph le lf it lg b lh li ju lj lk ll jx lm kr ln lo lp kv lq lr ls kz lt lu lv lw im bi translated">在您的数据管道中嵌入适当的测试使它们不容易出错，并且还确保数据在流向最终数据消费者之前通过适当的数据质量检查。</p><p id="0437" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">任何数据管道的两个关键组成部分是“代码”和“数据”。代码被用作管理如何提取、转换和加载(ETL)数据的工具，而数据是数据管道的组成部分。老实说，大多数数据管道的复杂性存在于数据中，而不是代码中。为了构建和运行可靠的数据管道，仅仅进行标准代码测试是不够的。因此，当我们谈论测试数据管道时，我们需要确保代码和数据都得到正确的测试。</p><p id="71ea" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">因此，今天的文章将分为两部分:</p><ul class=""><li id="f562" class="mc md it lg b lh lx lk ly kr me kv mf kz mg lw mh mi mj mk bi translated"><strong class="lg iu"> <em class="ml">代码测试</em></strong>——类似于传统软件/应用的测试。代码测试包括单元测试、集成测试和端到端系统测试。代码测试通常作为持续集成(CI)管道的一部分进行，以确保代码质量良好，数据接收、数据转换和数据加载的功能符合预期。</li><li id="9482" class="mc md it lg b lh mm lk mn kr mo kv mp kz mq lw mh mi mj mk bi translated"><strong class="lg iu"> <em class="ml">数据测试</em> </strong> —设定对关键数据元素的期望，并确保数据在向消费者提供最终数据之前通过这些期望检查。数据测试需要持续的努力，一旦数据管道被部署到生产环境中，数据测试就变得更加重要。除了测试数据质量之外，监控测试结果以确保任何违反数据质量的问题都可以立即得到解决也是非常必要的。</li></ul><p id="04a7" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">我先讲代码测试，再讲数据测试。最后，我将分享一些开源工具和框架，您可以利用它们开始向您的数据管道添加必要的测试。</p><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mr"><img src="../Images/0c5a9d9a36fadd8f5a594929f1215c9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xQqA0PXONMJUmvxn"/></div></div><p class="nd ne gj gh gi nf ng bd b be z dk translated">由<a class="ae nh" href="https://unsplash.com/@dtravisphd?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">大卫·特拉维斯</a>在<a class="ae nh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h2 id="018d" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">代码测试</h2><p id="5e40" class="pw-post-body-paragraph le lf it lg b lh li ju lj lk ll jx lm kr ln lo lp kv lq lr ls kz lt lu lv lw im bi translated">数据管道的代码测试与软件的代码测试没有太大区别。它通常包括单元测试、集成测试以及端到端的系统测试。然而，数据管道有几个特性，使得在数据管道上进行代码测试更具挑战性。</p><ul class=""><li id="9711" class="mc md it lg b lh lx lk ly kr me kv mf kz mg lw mh mi mj mk bi translated">首先，数据管道非常依赖于数据，因此您需要生成样本数据——有时是大量的样本数据——用于测试目的。</li><li id="2dfe" class="mc md it lg b lh mm lk mn kr mo kv mp kz mq lw mh mi mj mk bi translated">其次，执行数据管道需要严重依赖外部系统，包括 Spark 和 Databricks 等处理系统，以及雪花、红移和 Databricks SQL 等数据仓库。因此，您需要找到独立进行测试的方法——将测试数据处理逻辑的功能与测试与这些外部系统的连接和交互分开。</li></ul><p id="1f49" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">让我们分别讨论单元测试和集成测试，并理解它们是如何专门为数据管道工作的。</p><ul class=""><li id="ea85" class="mc md it lg b lh lx lk ly kr me kv mf kz mg lw mh mi mj mk bi translated"><strong class="lg iu"> <em class="ml">单元测试</em> </strong> —单元测试是非常低级的，接近应用程序的源代码。它们包括测试数据管道中使用的各个方法和函数。数据管道的单元测试的目的是在不提供繁重的外部环境的情况下捕捉错误。这些错误可能包括重构错误、解释语言中的语法错误、配置错误、图形结构错误等等。例如，为了得到最终结果，您可能需要相当多的数据转换函数。您可以对这些转换函数执行单元测试，以确保它们按照预期生成数据。正如我们在本文开头所讨论的，数据是任何数据管道的组成部分。因此，要对数据管道中使用的函数执行单元测试，您还需要确保有可用于测试的数据。因此，有两种流行的方法可以获得足够的数据来测试您的管道代码。第一种是根据真实数据的分布和统计特性来模拟虚假的测试数据。第二种方法是将真实数据的样本复制到开发或试运行环境中进行测试。对于第二个问题，将数据复制到不如生产环境严格的环境中时，确保不违反数据隐私、安全性或合规性非常重要。</li><li id="781e" class="mc md it lg b lh mm lk mn kr mo kv mp kz mq lw mh mi mj mk bi translated"><strong class="lg iu"> <em class="ml">集成测试</em> </strong> —集成测试验证您的数据管道所使用的不同模块或服务能够很好地协同工作。数据管道最必要的集成测试是测试与数据平台的交互，如数据仓库、数据湖(主要是云存储位置)和数据源应用程序(OLTP 数据库应用程序和 SaaS 应用程序，如 Salesforce 和 Workday)。众所周知，数据管道的三个关键步骤是提取、转换和加载。至少其中两个(提取和加载)，有时三个都需要与上面提到的数据平台进行交互。此外，您的数据管道还需要与消息传递系统进行交互，例如 Slack 或团队，以便为您的数据管道上发生的关键事件发送通知或警报。因此，对您的管道大量交互的所有外部平台和系统进行集成测试至关重要。</li></ul><p id="d919" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">大多数数据管道都是用 Python 编写的。为了自动化数据管道的代码测试，您需要利用 Python 测试框架，例如<a class="ae nh" href="https://docs.pytest.org/en/7.2.x/" rel="noopener ugc nofollow" target="_blank"> pytest </a>，这可能是使用最广泛的 Python 测试框架。它可以用来编写各种类型的软件测试，包括单元测试、集成测试、端到端测试和功能测试。</p><p id="d64d" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">除了测试框架，还可以利用数据管道编排工具来简化数据管道的代码测试。据我所知，<a class="ae nh" href="https://dagster.io/" rel="noopener ugc nofollow" target="_blank">Dagster</a>—pipeline orchestrator 工具—提供了数据管道工作流和相关功能，允许您对您的数据应用程序进行单元测试，将业务逻辑与环境分离，并对不受控制的输入设置明确的预期。如果您知道其他高质量的编排工具，它们也提供了使代码测试更容易的能力，请随时告诉我。我总是渴望了解更多。</p><p id="0971" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">现在我们已经讨论了代码测试部分，让我们转到数据测试部分，它更有趣，更动态，也许更有挑战性。</p><p id="c9a5" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">我们开始吧！</p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h2 id="506b" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">数据测试</h2><p id="7eb4" class="pw-post-body-paragraph le lf it lg b lh li ju lj lk ll jx lm kr ln lo lp kv lq lr ls kz lt lu lv lw im bi translated">如上所述，数据测试是关于设置对关键数据元素的期望，并确保流经数据管道的数据在服务于最终数据消费者之前通过这些期望检查。如果存在任何违反这些数据质量预期的情况，则应采取相关的通知/警报和相应的修复措施。</p><p id="1505" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">与通常在编译/部署时进行的代码测试不同，数据测试是在每次有新的数据流/数据批次被接收和处理时连续进行的。您可以将数据测试视为一系列连续的验收测试。您对新到达的数据做出假设和期望，并进行实时测试以确保这些假设和期望得到满足。</p><p id="9cba" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">数据测试绝对必要的原因如下:</p><ul class=""><li id="4194" class="mc md it lg b lh lx lk ly kr me kv mf kz mg lw mh mi mj mk bi translated">首先，数据是许多关键业务决策的基础。随着越来越多的组织转向数据驱动的决策，数据在现代组织的运营中扮演着越来越重要的角色。因此，拥有高质量的数据也将提高业务决策的质量和相关性。</li><li id="2d40" class="mc md it lg b lh mm lk mn kr mo kv mp kz mq lw mh mi mj mk bi translated">其次，数据总是变化的。与通常静态且干净的代码不同，数据是极其动态的。有许多因素会给你的数据带来变化，如业务运营变化、宏观经济变化以及最近的疫情(新冠肺炎)。所有这些都给底层数据带来了显著的变化。此外，在大多数情况下，数据是脏的，需要一些清理工作才能使用。因此，进行数据测试可确保及时检测到重大变化/漂移，并适当过滤和拒绝损坏的数据。</li></ul><p id="2016" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">数据测试可以大致分为以下几类:</p><ul class=""><li id="8b52" class="mc md it lg b lh lx lk ly kr me kv mf kz mg lw mh mi mj mk bi translated"><strong class="lg iu"> <em class="ml">表格级测试</em> </strong>:表格级测试侧重于了解一个表格的整体形态。下面是一些示例表级测试:</li></ul><pre class="ms mt mu mv gt np nq nr bn ns nt bi"><span id="1f2c" class="nu kj it nq b be nv nw l nx ny">#row-wise<br/>expect_table_row_count_to_equal<br/>expect_table_row_count_to_equal_other_table<br/>expect_table_row_count_to_be_between<br/>#column-wise<br/>expect_table_column_count_to_equal<br/>expect_table_column_count_to_be_between<br/>expect_table_columns_to_match_ordered_list<br/>expect_table_columns_to_match_set</span></pre><ul class=""><li id="a188" class="mc md it lg b lh lx lk ly kr me kv mf kz mg lw mh mi mj mk bi translated"><strong class="lg iu"> <em class="ml">列级测试</em> </strong>:一般来说，列级测试有两种——一种是单列测试，一种是多列测试。<br/>单列测试往往侧重于设置单个列的统计属性的期望值。对于数字列，单列测试将检查列最大值、列最小值、列平均值、列分布等。对于分类列，单列测试将检查列中最常见的值、列中不同的值等等。多列测试更多的是检查列之间的关系。例如，多列测试期望 A 列中的值大于 b 列中的值。下面是一些列级测试:</li></ul><pre class="ms mt mu mv gt np nq nr bn ns nt bi"><span id="983b" class="nu kj it nq b be nv nw l nx ny">#Single column tests<br/>expect_column_average_to_be_within_range_of_given_point<br/>expect_column_max_to_be_between<br/>expect_column_min_to_be_between<br/>expect_column_mean_to_be_between<br/>expect_column_median_to_be_between<br/>expect_column_distinct_values_to_be_in_set<br/>expect_column_most_common_value_to_be_in_set<br/>#Multi-coumns tests<br/>expect_column_pair_values_to_be_equal<br/>expect_column_pair_values_a_to_be_greater_than_b<br/>expect_column_pair_values_to_have_diff</span></pre><p id="b05a" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">当然，您可以根据您的业务领域知识定制特定的数据测试，以确保所有的测试都与您的数据和数据运行的业务环境相关。</p><p id="deca" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">有几个开源库是为支持数据团队实现数据质量测试而设计的，比如<a class="ae nh" href="https://greatexpectations.io/" rel="noopener ugc nofollow" target="_blank">远大前程(GX) </a>、<a class="ae nh" href="https://github.com/awslabs/deequ" rel="noopener ugc nofollow" target="_blank"> Deequ </a>和<a class="ae nh" href="https://github.com/awslabs/python-deequ" rel="noopener ugc nofollow" target="_blank"> PyDeequ </a>。</p><p id="7b63" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">我已经发表了另一篇文章，专门讨论如何利用<a class="ae nh" href="https://greatexpectations.io/" rel="noopener ugc nofollow" target="_blank">远大前程(GX) </a>、<a class="ae nh" href="https://github.com/awslabs/deequ" rel="noopener ugc nofollow" target="_blank"> Deequ </a>和<a class="ae nh" href="https://github.com/awslabs/python-deequ" rel="noopener ugc nofollow" target="_blank"> PyDeequ </a>将可靠性嵌入您的数据管道。你可以在这里找到这篇文章:</p><blockquote class="nz oa ob"><p id="01fa" class="le lf ml lg b lh lx ju lj lk ly jx lm oc lz lo lp od ma lr ls oe mb lu lv lw im bi translated"><a class="ae nh" rel="noopener" target="_blank" href="/data-engineering-best-practice-embedding-reliability-and-integrity-into-your-data-pipelines-45d72bda832f?sk=7e3cdfee2549539ad135445d0925010d">数据工程最佳实践——将可靠性和完整性嵌入您的数据管道</a></p></blockquote></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h2 id="11e8" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">摘要</h2><p id="511e" class="pw-post-body-paragraph le lf it lg b lh li ju lj lk ll jx lm kr ln lo lp kv lq lr ls kz lt lu lv lw im bi translated">为了完成本文，有必要重申测试数据管道的目标是构建高度可靠和值得信赖的数据管道，这样您就可以为下游数据消费者提供高质量的数据和信息。同时，您还应该避免过度测试的情况，这意味着您只测试与您的数据管道质量和您的数据管道所服务的业务用例相关的代码、特性和数据。因此，在您编写测试之前，您需要了解什么样的测试是必要的，并且还建议与您的业务利益相关者交谈，以获得他们关于什么数据测试和期望对他们最相关和最必要的领域知识。</p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><p id="492c" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">如果你想在这些文章发表时得到通知，请随时关注我。我一般每周都会发表 1-2 篇关于数据和 AI 的文章。</p><p id="050e" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">如果想看到更多围绕现代高效数据+AI 栈的指南、深度潜水、见解，请订阅我的免费简讯— <a class="ae nh" href="https://yunnawei.substack.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu"> <em class="ml">高效数据+AI 栈</em> </strong> </a>，谢谢！</p><p id="35ed" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">注:万一你还没有成为媒介会员，而你想无限制地接触媒介，你可以使用我的<a class="ae nh" href="https://medium.com/@weiyunna91/membership" rel="noopener">推荐链接</a>来注册！</p><p id="7fe1" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">非常感谢你的支持！</p></div></div>    
</body>
</html>