<html>
<head>
<title>Register and Deploy Models with SageMaker Model Registry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 SageMaker 模型注册中心注册和部署模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/register-and-deploy-models-with-sagemaker-model-registry-5af42d678912#2022-03-25">https://towardsdatascience.com/register-and-deploy-models-with-sagemaker-model-registry-5af42d678912#2022-03-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6e40" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">SageMaker 模型注册中心介绍</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/740e9d96229c625e8eb8f53d975be59e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*u149HiAZNz9z1fcD"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://unsplash.com/@unarchive" rel="noopener ugc nofollow" target="_blank">杰瑞米·贝赞格</a>拍摄的<a class="ae ky" href="https://unsplash.com/photos/g_QfZECYmno" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="5221" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在 ML 生命周期中管理模型的不同版本是很重要的。当您训练各种模型时，您将需要在各种注册表中对它们进行分类。<a class="ae ky" href="https://docs.aws.amazon.com/sagemaker/latest/dg/model-registry.html" rel="noopener ugc nofollow" target="_blank"> SageMaker 模型注册中心</a>帮助您管理不同的模型版本及其元数据。</p><p id="f399" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用 Model Registry，您可以创建包含模型不同版本的<a class="ae ky" href="https://docs.aws.amazon.com/sagemaker/latest/dg/model-registry-model-group.html" rel="noopener ugc nofollow" target="_blank">模型包组</a>。您可以为您可能处理的特定模型集创建各种模型包组。在本文中，我们将探索一个训练样本<a class="ae ky" href="https://docs.aws.amazon.com/sagemaker/latest/dg/xgboost.html" rel="noopener ugc nofollow" target="_blank"> SageMaker XGBoost </a>回归模型的例子，然后为模型注册中心创建一个模型包组。使用这个设置，我们将演示如何直接从模型注册中心将模型部署到一个<a class="ae ky" href="https://docs.aws.amazon.com/sagemaker/latest/dg/realtime-endpoints.html" rel="noopener ugc nofollow" target="_blank"> SageMaker 实时端点</a>。</p><p id="997d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意</strong>:对于刚接触 AWS 的人来说，如果你想继续学习，请确保在下面的<a class="ae ky" href="https://aws.amazon.com/console/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">链接</strong> </a>中注册账户。<strong class="lb iu">本文将假设一个新手对 AWS 和 SageMaker 有中级的了解。</strong></p><h1 id="73c1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">目录</h1><ol class=""><li id="eace" class="mn mo it lb b lc mp lf mq li mr lm ms lq mt lu mu mv mw mx bi translated">设置和模型培训</li><li id="6d4b" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">模型注册和部署</li><li id="b873" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">其他资源和结论</li></ol><h1 id="455f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">1.设置和模型培训</h1><p id="863c" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">对于这个例子，我们将在<a class="ae ky" href="https://aws.amazon.com/sagemaker/studio/" rel="noopener ugc nofollow" target="_blank"> SageMaker 工作室</a>工作，这是 SageMaker 提供的 IDE。Studio 将是我们超越经典笔记本实例的选择，因为它为我们将要使用的工具提供 UI 支持，例如模型注册。要全面了解 SageMaker Studio 的设置，请遵循此<a class="ae ky" href="https://docs.aws.amazon.com/sagemaker/latest/dg/onboard-quick-start.html" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="3317" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在 Studio 中，我们将使用一个基本的数据科学内核和一个简单的计算实例(ml.c5.large)作为我们的笔记本实例。启动笔记本后，我们将快速进行一些设置步骤。首先，我们有与 SageMaker 一起工作的 AWS SDK Python 客户端。利用这些，我们将协调从培训到模型注册再到部署的整个过程。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">设置</p></figure><p id="91f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以检索公共的<a class="ae ky" href="https://archive.ics.uci.edu/ml/datasets/abalone" rel="noopener ugc nofollow" target="_blank">回归鲍鱼数据集</a>，并将其上传到我们的工作室环境。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">访问鲍鱼数据集</p></figure><p id="5081" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经设置好了，我们将继续进行模型训练。对于这篇文章，我们不会关注训练的深度，但如果你想要一篇关于在 SageMaker 上训练 XGBoost 算法的文章，请查看我的另一篇文章<a class="ae ky" href="https://aws.plainenglish.io/end-to-end-example-of-sagemaker-xgboost-eb9eae8a5207" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="5fe7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以用鲍鱼数据集设置我们的训练输入，并为我们正在检索的 SageMaker XGBoost 算法配置我们的<a class="ae ky" href="https://docs.aws.amazon.com/sagemaker/latest/dg/xgboost_hyperparameters.html" rel="noopener ugc nofollow" target="_blank">超参数</a>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">培训设置</p></figure><p id="37f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的关键部分是我们检索到的<strong class="lb iu">图像</strong>。这个图像将在我们的模型注册中使用，以正确地对我们训练过的模型进行分类。带有我们的<strong class="lb iu">模型数据</strong>和图像的元数据对于稍后的端点创建至关重要。使用它，我们现在可以训练 XGBoost 估计器，并从训练作业中检索模型数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从培训作业中检索模型数据</p></figure><h1 id="55d4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">2.模型注册和部署</h1><p id="0b34" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我们使用模型注册中心的第一步是创建一个模型组。这个模型组包含一组版本化的模型，我们将为我们的案例处理这些模型。我们可以使用之前用 SageMaker 定义的 boto3 客户机创建一个模型组。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">模型组创建</p></figure><p id="6f2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个模型组中，我们还没有定义任何特定于我们模型的信息。这是我们传入正在处理的 XGBoost 图像和模型数据的地方。这有助于为部署提供必要的元数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将图像和模型数据传递给模型组</p></figure><p id="e5a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个调用中，我们还可以指定输入数据的类型(CSV、JSON ),以便我们的端点知道在创建时会发生什么。我们可以通过<a class="ae ky" href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sagemaker.html#SageMaker.Client.list_model_packages" rel="noopener ugc nofollow" target="_blank">list _ Model _ packages</a>API 调用看到这个模型组的资源 arn 和版本。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ARN 车型套装</p></figure><p id="62f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<a class="ae ky" href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sagemaker.html#SageMaker.Client.describe_model_package" rel="noopener ugc nofollow" target="_blank">describe _ model _ package</a>API 调用，我们可以看到我们指定的所有细节。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">模型包详细信息</p></figure><p id="ee7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以使用检索到的 model_package arn 来批准这个模型。我们可以通过更新模型包状态来做到这一点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">批准模型包</p></figure><p id="8802" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">令人惊叹的是，您现在还应该能够在 Studio 的 Model Registry 选项卡中看到这个模型包。如果您在 Studio 的左侧面板中选择了最底部的图标，您应该能够选择 Model Registry 来查看您的模型包组。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/04aae06a6c6a1d93f6a6ab3651b211d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*Y0WNR5Yca8qHDVdvJEEEAw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">模型注册用户界面(作者截图)</p></figure><p id="1a56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们仔细观察，可以看到我们的特定组和我们刚刚批准的版本。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/312f428b750af8cf07a6597d3736119d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QBGLHb7HpRTtQ1R7JYCfxA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">已批准的包(作者截图)</p></figure><p id="ed05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过批准模型包，我们现在已经准备好创建端点了。这通过一系列三个步骤来实现:<a class="ae ky" href="https://sagemaker.readthedocs.io/en/stable/api/inference/model.html" rel="noopener ugc nofollow" target="_blank"> SageMaker 模型</a>创建、<a class="ae ky" href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateEndpointConfig.html" rel="noopener ugc nofollow" target="_blank">端点配置</a>创建和<a class="ae ky" href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateEndpoint.html" rel="noopener ugc nofollow" target="_blank">端点</a>创建。我们可以通过类似地使用 boto3 客户端来完成所有这些步骤。</p><p id="d002" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先创建一个 SageMaker 模型实体，在这里我们可以传递我们的 model_package arn，而不必指定任何关于模型数据或所用图像的细节。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">SageMaker 模型创建</p></figure><p id="39fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这个 SageMaker 模型，我们可以创建一个端点配置，它包含关于实例类型和端点后面的计数的细节。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">端点配置创建</p></figure><p id="0026" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这个端点配置，我们可以将它输入到我们的端点中，并监控它的创建，直到它成功投入使用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">端点创建</p></figure><p id="0ac7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以看到这个端点在我们的 Model Registry UI 中成功创建。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/9391779a24da8a627d611c1c26e41102.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4KW_n7hZ5aM3edvG3Ovjow.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从模型包成功创建端点(作者截图)</p></figure><p id="33a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦创建了您的端点，我们就可以用一个示例负载来调用它，并查看调用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">祈祷</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/7ecf8943ec1f4ea6a3ee0f19496a373f.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*RiJrtdiQhvMkDUvEXwPXqg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">结果(作者截图)</p></figure><h1 id="0c6b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">3.其他资源和结论</h1><h2 id="5e29" class="nm lw it bd lx nn no dn mb np nq dp mf li nr ns mh lm nt nu mj lq nv nw ml nx bi translated">额外资源</h2><div class="ny nz gp gr oa ob"><a href="https://github.com/RamVegiraju/SM-Model-Registry" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">GitHub-RamVegiraju/SM-Model-Registry:使用 SageMaker 模型注册表和 XGBoost…</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">github.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op ks ob"/></div></div></a></div><p id="332e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于示例的完整代码，请查看上面的资源库。我在下面附上了额外的例子和资源。</p><ul class=""><li id="6974" class="mn mo it lb b lc ld lf lg li oq lm or lq os lu ot mv mw mx bi translated"><a class="ae ky" href="https://github.com/aws/amazon-sagemaker-examples/blob/main/sagemaker-pipelines/tabular/train-register-deploy-pipeline-model/train%20register%20and%20deploy%20a%20pipeline%20model.ipynb" rel="noopener ugc nofollow" target="_blank">管道+注册表示例</a></li><li id="c614" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu ot mv mw mx bi translated"><a class="ae ky" href="https://aws.amazon.com/about-aws/whats-new/2021/12/sagemaker-model-registry-endpoint-visibility-custom-metadata-model-metrics/" rel="noopener ugc nofollow" target="_blank">模式注册公告</a></li></ul><h2 id="981f" class="nm lw it bd lx nn no dn mb np nq dp mf li nr ns mh lm nt nu mj lq nv nw ml nx bi translated">结论</h2><p id="7d17" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">SageMaker Model Registry 是一个极其可扩展和强大的工具。对于这个用例，我们只经历了一次训练迭代和一个模型。但是，当你有一个模型，你可能是针对多个数据集进行训练，它的真正威力会多次显现出来。使用 boto3 客户端与 Model Registry 进行交互，可以非常容易地对不同的模型集合进行分组和编目。</p><p id="5a3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇文章是关于模型注册中心、SageMaker 和 MLOps 的好入门。在以后的文章中，我们将探讨如何使用 SageMaker 管道将 SageMaker 模型注册中心整合到整个 MLOps 生命周期中。</p></div><div class="ab cl ou ov hx ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="im in io ip iq"><p id="ae33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="pb">如果你喜欢这篇文章，请在</em><a class="ae ky" href="https://www.linkedin.com/in/ram-vegiraju-81272b162/" rel="noopener ugc nofollow" target="_blank"><em class="pb">LinkedIn</em></a><em class="pb">上联系我，订阅我的媒体</em> <a class="ae ky" href="https://ram-vegiraju.medium.com/subscribe" rel="noopener"> <em class="pb">简讯</em> </a> <em class="pb">。如果你是新手，使用我的</em> <a class="ae ky" href="https://ram-vegiraju.medium.com/membership" rel="noopener"> <em class="pb">会员推荐</em> </a> <em class="pb">报名。</em></p></div></div>    
</body>
</html>