<html>
<head>
<title>Your Anomaly Detection Model Is Smarter than You Think</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你的异常检测模型比你想象的要聪明</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/your-anomaly-detection-model-is-smarter-than-you-think-c1cade5fcabe#2022-05-04">https://towardsdatascience.com/your-anomaly-detection-model-is-smarter-than-you-think-c1cade5fcabe#2022-05-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d8aa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">多变量时间序列异常检测模型可以提供丰富的见解，如果你投资一些时间在后处理他们的结果…</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6cbed2cde477ae645a2237b3948947e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*M9jU9QgRnVE61KB-"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马库斯·斯皮斯克在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="17a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在处理工业传感器数据时，我经常处理异常检测用例。在过去的十年里，我一直在和几十个客户研究这个话题，在过去的五年里几乎每天都在研究。我接触的典型终端用户是工厂经理、工艺工程师或生产线上的操作员。大多数过程工程师都非常精通统计学，有些甚至是优秀的工业数据科学家。不过，这是一个例外，而不是常规，你最终会陷入必须回答棘手问题的讨论中:</p><blockquote class="lv lw lx"><p id="38f5" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">“我需要知道为什么你的模型检测到异常。在调整制造流程之前，我需要可靠的根本原因分析。”</p><p id="f127" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">“异常检测是不够的:当模型检测到异常时，已经太晚了。我需要预测来证明在这种方法上投入时间和精力的合理性。”</p><p id="b8a6" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">"我需要处方:告诉我应该怎么做才能防止失败的发生."</p></blockquote><p id="48a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">诸如此类……前段时间我在LinkedIn上发布了几个简短的演示来揭开异常检测的神秘面纱(见<a class="ae ky" href="https://www.linkedin.com/posts/michaelhoarau_from-anomaly-detection-to-anomaly-prediction-activity-6907075565065805824-ICCP/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">本帖</strong> </a>和<a class="ae ky" href="https://www.linkedin.com/posts/michaelhoarau_root-cause-investigation-with-anomaly-detection-activity-6907577865614032896-TwgY/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">本帖</strong> </a>)。在这篇博文中，我将详细介绍如何为您自己的模型生成类似的输出，并使它们更加智能。这样你就能更好地应对上述问题了！简而言之，到本文结束时，您将拥有:</p><ul class=""><li id="936c" class="mc md it lb b lc ld lf lg li me lm mf lq mg lu mh mi mj mk bi translated">用Amazon SageMaker在云中建立一个Jupyter环境，</li><li id="4e77" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">克隆了GitHub repo，其中包含了遵循本文的所有代码。</li><li id="f090" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">发现一个好的数据集，下载并探索它</li><li id="a612" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">使用Amazon Lookout for Equipment(AWS专门用于异常检测的托管服务)训练异常检测模型</li><li id="a54a" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">可视化异常检测模型的原始结果</li><li id="1a5e" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">对结果进行后处理，以获得更有意义的见解</li></ul><p id="b290" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，我们开始第一步吧！</p><h1 id="4fe3" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">让我们舒适:准备您的环境！</h1><p id="a91e" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我鼓励你跟随这篇博文，浏览GitHub，获取<a class="ae ky" href="https://github.com/michaelhoarau/smarter-anomaly-detection" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">这一系列的Jupyter笔记本</strong> </a>。你可以使用你常用的Jupyter环境，或者用Amazon SageMaker创建一个。</p><ul class=""><li id="4852" class="mc md it lb b lc ld lf lg li me lm mf lq mg lu mh mi mj mk bi translated">如果您想使用<em class="ly">您通常的Jupyter环境</em>，已经有了一个<em class="ly">训练过的异常检测模型</em>，并且已经在一些测试数据上对其进行了回测，以获得一些结果，那么您已经可以进入下一段了！</li><li id="4a00" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">如果你想使用<em class="ly">你通常的Jupyter环境</em>，有一些数据，并想尝试Amazon Lookout的设备来训练一个异常检测模型，你将需要创建一个AWS帐户，并确保你的帐户凭证可以从你的环境中访问。</li><li id="6eb1" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">如果你想留在AWS环境中，你可以创建一个AWS账户，启动一个Amazon SageMaker环境，让它访问Amazon Lookout for Equipment API。您可以使用与本文相同的数据集，也可以自带数据集。</li></ul><p id="68d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我现在认为您的环境已经准备好了:第一步是在其中克隆这个GitHub库:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="543e" class="ns mr it no b gy nt nu l nv nw">git clone <a class="ae ky" href="https://github.com/michaelhoarau/smarter-anomaly-detection.git" rel="noopener ugc nofollow" target="_blank">https://github.com/michaelhoarau/smarter-anomaly-detection.git</a></span></pre><p id="f1d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该资料库中的笔记本将引导您完成从数据准备到结果后处理的整个过程。可以从第一个<code class="fe nx ny nz no b"><a class="ae ky" href="https://github.com/michaelhoarau/smarter-anomaly-detection/blob/main/notebooks/1_data_preparation.ipynb" rel="noopener ugc nofollow" target="_blank">1_data_preparation.ipynb</a></code>开始。</p><h1 id="454a" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">数据概述</h1><h2 id="a537" class="ns mr it bd ms oa ob dn mw oc od dp na li oe of nc lm og oh ne lq oi oj ng ok bi translated">等一下…你把异常现象叫做什么？</h2><p id="74ed" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">你可能会觉得这很奇怪，但是这个问题经常被忽视！要从机器学习的角度构建您的业务问题，理解以下内容至关重要:</p><ul class=""><li id="a1ef" class="mc md it lb b lc ld lf lg li me lm mf lq mg lu mh mi mj mk bi translated">你感兴趣的异常的形状</li><li id="568a" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">他们如何积累加班时间</li><li id="53f9" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">当它们被触发时会发生什么</li></ul><p id="3a9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，如果您想了解构建异常检测系统的潜在投资回报，您还需要了解:</p><ul class=""><li id="307d" class="mc md it lb b lc ld lf lg li me lm mf lq mg lu mh mi mj mk bi translated">谁是潜在用户</li><li id="c0d0" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">他们需要做出什么样的决定</li><li id="9c3c" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">哪些见解可以使这些决定更容易做出</li><li id="3e17" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">这些见解应该如何传达</li></ul><p id="e370" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">收集这些知识将确保您的系统被最终用户实际采用。</p><p id="8b26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也就是说，让我们看看可以从时间序列数据中捕捉到的不同类型的异常:</p><ul class=""><li id="7f6b" class="mc md it lb b lc ld lf lg li me lm mf lq mg lu mh mi mj mk bi translated"><strong class="lb iu">突变:</strong>这是最容易发现的。变化(单变量或多变量，当它发生在多个时间序列时)是突然的，并且值的变化是明显的。在工业环境中，这些突然的变化经常在边缘水平被注意。特定的软件组件监控这些过程和设备。</li><li id="9690" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated"><strong class="lb iu">水平变化:</strong>当一个给定的时间序列在基于基本条件或运行模式的数值范围之间变化时，这种情况就会发生。如果您想在检测异常时考虑所有操作模式，您需要注意将它们全部包含在您的训练数据中。否则，在推理时，一个新的操作模式可能会被认为是一个异常，您最终会有许多误报要处理。</li><li id="923a" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated"><strong class="lb iu">趋势:</strong>一组信号可以随时间变化(不一定同向)。当您想要评估一个过程或一件设备的状况时，这些趋势异常将是搜索的很好的前兆事件。它们将帮助你在实际故障可能发生之前建立预警信号。</li></ul><p id="1aad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们已经从定义的角度对该领域进行了阐述，让我们通过查看一个实际的工业多元数据集来将其付诸实践…</p><h2 id="71bd" class="ns mr it bd ms oa ob dn mw oc od dp na li oe of nc lm og oh ne lq oi oj ng ok bi translated">数据集概述</h2><p id="3aaa" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">搜索带有注释异常和足够历史数据的工业多元时间序列数据集本身就是一个挑战。我见过的唯一有相关异常的公开数据集是Kaggle提供的一个工业水泵数据集。你可以从<a class="ae ky" href="https://www.kaggle.com/datasets/nphantawee/pump-sensor-data" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">这个链接</strong> </a> <strong class="lb iu">下载这个数据集。</strong>该数据集包含2018年4月1日至2018年8月31日(5个月)的52个传感器，采样率为1分钟。但是，由于没有与此数据集相关联的许可，因此您不能将其用于任何商业用途。</p><p id="a71a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了帮助您入门，前面提到的repo中的第一个笔记本(<code class="fe nx ny nz no b"><a class="ae ky" href="https://github.com/michaelhoarau/smarter-anomaly-detection/blob/main/notebooks/synthetic_0_data_generation.ipynb" rel="noopener ugc nofollow" target="_blank">synthetic_0_data_generation.ipynb</a></code>)将生成一个合成的多变量timeseries数据集，并在其上添加不同类型的异常:这不像真实的东西，但它将足够接近于在这里暴露我的思想过程。我用20个信号、1年的数据和10分钟的采样率生成了一个数据集。</p><p id="eaf0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们加载这些数据，看看一些信号:</p><ul class=""><li id="69e8" class="mc md it lb b lc ld lf lg li me lm mf lq mg lu mh mi mj mk bi translated">确定故障时间(下面的红点)</li><li id="e609" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">突出显示该虚拟资产被破坏或从故障中恢复的时间段(在下面用黄色标出):</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/f76bcc9e0726fa2b19fdeae7d42bd84a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*98b6-GxeBzVmrSQ6U3cvfg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">综合数据时间序列概览(图片由作者提供)</p></figure><p id="477c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用该数据集的前五个月来训练模型(从2021年1月到2021年5月)，将为我们提供至少2个异常范围来评估我们的模型。</p><ul class=""><li id="05df" class="mc md it lb b lc ld lf lg li me lm mf lq mg lu mh mi mj mk bi translated">其中之一是2021年11月可见的黄色带</li><li id="1429" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">另一个将是2021年9月初绿色信号上可见的奇怪尖峰</li></ul><p id="f690" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们为这20个时间序列绘制一个带状图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/3e9a049e979c9d78732b99c5696afebe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ifvTLRyv8SCBcOhPsOS21g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">时间序列带状图(图片由作者提供)</p></figure><p id="4be6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我使用带状图来压缩时间序列信号信息。压缩后，每个时间序列都变成一条彩色带，其中:</p><ul class=""><li id="7c71" class="mc md it lb b lc ld lf lg li me lm mf lq mg lu mh mi mj mk bi translated">信号的低值为绿色</li><li id="ef33" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">中等值为橙色</li><li id="fd75" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">高值为红色</li></ul><p id="fadd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个简单的条形带非常便于显示何时出现低值或高值。当把我们数据集的20个信号的所有条带放在一起时，我们得到上图。你可以看到一些可能感兴趣的垂直红色区域。其中一些与资产被标记为损坏的已知时期相匹配(大约在11月)。</p><p id="7566" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在某些情况下，我们还可以看到许多信号从左到右从红色变为绿色:这可能是某个日期后数据集发生漂移的迹象。这是我之前遇到的一个数据集示例，您可以看到2017年12月后发生的转变:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/dfb0ca52793d925ca906e6e44b2f5079.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hlMumRn0MBT6GMhJy6LPpA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">沿时间轴移动的带状图(图片由作者提供)</p></figure><p id="e373" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在进一步调查后，这种类型的信息对于为您训练的任何异常检测模型设置再训练触发器将是至关重要的。如果不知道这一点，您将逐渐看到您的模型发布越来越多的误报，使您的模型不可用，并可能失去模型最终用户的信任。</p><p id="b98b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了生成带状图，我使用了我的<code class="fe nx ny nz no b">tsia</code>包(<code class="fe nx ny nz no b">pip install tsia</code>)和下面的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带状图生成(由作者编写代码)</p></figure><p id="55c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想了解更多关于带状图的知识，可以看看我之前的文章，在这篇文章中我深入探讨了带状图是如何产生的:</p><div class="op oq gp gr or os"><a rel="noopener follow" target="_blank" href="/using-strip-charts-to-visualize-dozens-of-time-series-at-once-a983baabb54f"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">使用带状图一次可视化几十个时间序列</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">带状图对于从几十个(甚至几百个)时间序列中得出头部或尾部非常有用…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">towardsdatascience.com</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg ks os"/></div></div></a></div><p id="0804" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你的合成数据集生成，你可以使用第二个配套笔记本(<code class="fe nx ny nz no b"><a class="ae ky" href="https://github.com/michaelhoarau/smarter-anomaly-detection/blob/main/notebooks/synthetic_1_data_preparation.ipynb" rel="noopener ugc nofollow" target="_blank">synthetic_1_data_preparation.ipynb</a></code>)为亚马逊寻找设备准备数据。请随意更新它，以便将数据准备成适合您自己的异常检测模型的格式。您已经准备好训练您的模型了！</p><h1 id="7d74" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">训练异常检测模型</h1><p id="10bd" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我将使用Amazon Lookout for Equipment在之前的数据集上训练一个异常检测模型。为此，您需要一个AWS帐户。然后，在已经提到的GitHub repo中，您可以运行第三个配套笔记本(称为<code class="fe nx ny nz no b"><a class="ae ky" href="https://github.com/michaelhoarau/smarter-anomaly-detection/blob/main/notebooks/synthetic_2_model_training.ipynb" rel="noopener ugc nofollow" target="_blank">synthetic_2_model_training.ipynb</a></code>的笔记本):这将把数据推送到亚马逊S3(大多数托管AWS AI/ML服务用于输入数据集的AWS块存储服务)，摄取数据并训练异常检测模型。</p><p id="3e30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想了解更多关于Amazon Lookout for Equipment的信息，在我的书《AWS上的时间序列分析》中有六个章节专门介绍这项服务:</p><div class="op oq gp gr or os"><a href="https://www.amazon.com/Time-Analysis-AWS-forecasting-anomalies-ebook/dp/B09MMLLWDY" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">AWS上的时间序列分析:学习如何建立预测模型和检测你的…</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">AWS上的时间序列分析:了解如何建立预测模型和检测时间序列数据中的异常…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">www.amazon.com</p></div></div><div class="pb l"><div class="ph l pd pe pf pb pg ks os"/></div></div></a></div><p id="39a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随意看看<a class="ae ky" href="https://michoara.medium.com/time-series-analysis-on-aws-book-presentation-36dc05a9c7ad" rel="noopener"> <strong class="lb iu">这篇博文</strong> </a>和<a class="ae ky" href="https://michoara.medium.com/time-series-analysis-on-aws-part-2-presentation-multivariate-anomaly-detection-26325bc0b4a7" rel="noopener"> <strong class="lb iu">这篇另一篇</strong> </a>以获得更多关于这些章节的详细信息:</p><div class="op oq gp gr or os"><a href="https://michoara.medium.com/time-series-analysis-on-aws-part-2-presentation-multivariate-anomaly-detection-26325bc0b4a7" rel="noopener follow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">自动气象站的时间序列分析——第2讲——多元异常检测</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">3月4日，我的第一本书《AWS上的时间序列分析》出版了！我在这个帖子里宣布了，也给了一些…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">michoara.medium.com</p></div></div><div class="pb l"><div class="pi l pd pe pf pb pg ks os"/></div></div></a></div><p id="e7f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">训练过程包括对历史数据的回溯测试评估，在这种情况下，如果服务当时正在运行，您可以检测到它应该检测到的事件。与其他异常检测模型一样，Amazon Lookout for Equipment的原始结果如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/e80ccb0528da64f7d6576496e73038de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G_2m9BhXnuLUySflFKyO0Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">亚马逊寻找设备原始结果(图片由作者提供)</p></figure><p id="5ecf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在顶部，我绘制了一些传感器的时间序列。下方绿色部分是虚拟资产从故障中恢复的已知时间段。在底部，红色的，是由Lookout for Equipment检测到的事件。当看到这些结果时，有人可能会指出:</p><blockquote class="lv lw lx"><p id="0b24" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">“有些误报，我没时间去调查每个事件！”</p><p id="66ec" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">“你的模型只检测已经发生的异常情况，没有用！”</p><p id="4a2d" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">“我有数百个传感器:当你的模型检测到异常时，我仍然必须调查我的整个操作，我不会在这里节省任何时间！”</p></blockquote><p id="5cc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">听起来很熟悉？让我们看看如何从您的异常检测模型中获得更多见解，并开始赢得您的最终用户的更多信任…</p><h1 id="564f" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">后处理模型的原始输出</h1><p id="7219" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">如前所示，最基本的异常检测模型能够从您的时间序列数据集中标记出它认为异常的时间戳。现在让我们打开回购 的<a class="ae ky" href="https://github.com/michaelhoarau/smarter-anomaly-detection/blob/main/notebooks/synthetic_3_model_evaluation.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">第四笔记本，开始对这些结果进行更详细的后处理。</strong></a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/e80ccb0528da64f7d6576496e73038de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G_2m9BhXnuLUySflFKyO0Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">亚马逊寻找设备原始结果(图片由作者提供)</p></figure><p id="dafc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对这个异常检测模型进行字面解释，你可能会说你有太多的误报(所有红色事件都发生在2021年11月故障之前)。您可能希望模型标记失败周期，而不标记之前或之后的任何内容。但这与许多假设有关:</p><ul class=""><li id="8bd7" class="mc md it lb b lc ld lf lg li me lm mf lq mg lu mh mi mj mk bi translated">你有失败的确切日期</li><li id="0b26" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">您实际上知道这是一个故障，而不是维护事件</li><li id="96e1" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">您知道在故障发生之前，您的设备或过程不会触发任何前兆事件</li></ul><p id="c5a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这有很多假设，大多数时候你不会处于这种确切的情况:在你的时间序列中任何可见的异常事件要么是前兆事件，要么是可检测的异常(对未来事件的预警)，要么是故障，要么是维护活动，要么是你的工业过程在问题后恢复的愈合期。</p><p id="cbf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这一事实实际上给了我们一些余地来对我们的异常检测模型原始输出进行后处理，尤其是当您想要了解您的资产/流程所处的条件时(用于基于条件的维护方法的条件监控)。</p><h2 id="f3f8" class="ns mr it bd ms oa ob dn mw oc od dp na li oe of nc lm og oh ne lq oi oj ng ok bi translated">测量事件率</h2><p id="f439" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">异常检测模型触发事件，作为用户，您必须决定某个事件实际上是您关注的异常、您不想捕获的异常、预先警告失败即将到来的前兆事件还是误报。过滤掉最后一个可以通过测量你在感兴趣的一段时间内有多少事件来实现。例如，测量与我从另一个数据集获得的类似结果相对应的日常事件的数量，产生了类似于下图的图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/1a1a1d82a0be1c3511b6bdc3fac48fc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X1pTyyPhi0hl-CiIROWfeQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">测量异常检测模型发布的事件率(图片由作者提供)</p></figure><p id="9b39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基于此，您可以决定仅在每日事件率达到每天至少200次后才通知操作员。这将允许您只对在此期间检测到的41个事件中的3个事件做出反应。我的异常检测模型输出一个数据帧，每个时间戳都有一个状态(0表示没有检测到异常，1表示发现了异常)。我的数据采样率为5分钟，因此如果我在<code class="fe nx ny nz no b">12 x 24 = 288 periods</code>上使用滚动窗口，我将覆盖一整天的数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="11c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这个简单的技术，您可以解决(至少部分解决)前面提到的一些问题。当事件发生率开始变大时，您可以使用它来做出实际反应(允许您从检测到预测)，并过滤掉误报(当检测到稀少事件时)。</p><p id="9a6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们尝试解决最后一个问题，即在帮助进行根本原因分析时，异常检测模型缺乏精确性会浪费时间…</p><h2 id="6a6f" class="ns mr it bd ms oa ob dn mw oc od dp na li oe of nc lm og oh ne lq oi oj ng ok bi translated">测量和绘制变量贡献</h2><p id="14e3" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">许多异常检测模型也产生一些可解释的细节，例如每个变量对任何检测到的给定事件的贡献。Amazon Lookout for Equipment也不例外，每个模型结果都会在检测到的每个事件的JSON输出中包含以下字段:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="1328" class="ns mr it no b gy nt nu l nv nw">'predicted_ranges': [<br/>    {<br/>        'start': '2019-08-08T00:42:00.000000',<br/>        'end': '2019-08-08T01:48:00.000000',<br/>        'diagnostics': [<br/>            {'name': 'synthetic\\signal_00', 'value': 0.052},<br/>            {'name': 'synthetic\\signal_01', 'value': 0.023},<br/>            {'name': 'synthetic\\signal_02', 'value': 0.038},<br/>            {'name': 'synthetic\\signal_03', 'value': 0.023},</span><span id="15e2" class="ns mr it no b gy pk nu l nv nw">            ...</span><span id="4c2d" class="ns mr it no b gy pk nu l nv nw">            {'name': 'synthetic\\signal_17', 'value': 0.049},<br/>            {'name': 'synthetic\\signal_18', 'value': 0.033},<br/>            {'name': 'synthetic\\signal_19', 'value': 0.046},<br/>            {'name': 'synthetic\\signal_20', 'value': 0.044}<br/>        ]<br/>    },</span><span id="d7e9" class="ns mr it no b gy pk nu l nv nw">    ...</span><span id="abf0" class="ns mr it no b gy pk nu l nv nw">]</span></pre><p id="e544" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你在看我的配套笔记本，你会看到我如何重新格式化这种类型的输出。我使用了适合进一步绘图和处理的扩展数据框架:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/77d775acf7a18b309527b6275e8dfd2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uhb6BSBwO1gTwt-oS2lLhw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">每个时间戳的可变贡献的扩展结果数据框架(图片由作者提供)</p></figure><p id="04f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们绘制变量重要性随时间的演变图，而不是事件率:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pm"><img src="../Images/feaaab41475a33201450b8085cae8890.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zx6sfDXnLUxPZLMxQwf50A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">可变重要性演变(图片由作者提供)</p></figure><p id="a957" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我给每个传感器分配了不同的颜色，这个图还不可读。看起来其中一个绿色信号是左边第一个大事件的关键因素。另一个信号，红色的，对右边的事件来说有上升的趋势。让我们使用累积条形图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/f9971c812ba5c9c635f87a1fff488906.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AiQgY7ZY3MbKMYdx5-TSqw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用条形图的可变重要性演变(图片由作者提供)</p></figure><p id="4aeb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这有点好，我们实际上可以更好地跟踪趋势，并确定多个信号可能是给定事件中最有贡献的信号。然而，当试图理解“最重要”的信号时，我们不需要绘制所有的50+信号。让我们试着把重点放在前5位，并把所有其他的放在“其他信号”类别中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/c2b91b06e953ec4221eb115c90371a71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-cpQNiLGOBxSWftqLA4fhQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">关注前5个信号的可变重要性演变(图片由作者提供)</p></figure><p id="46c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它的绘图速度更快，可读性更强。对于20个信号，如果每个信号对给定事件的贡献相同，则每个信号的贡献为5%，5个信号的贡献为25%。我们可以从上面看到，前5名传感器始终达到30%到60%的贡献，这意味着这可能是非常有趣的进一步调查…</p><p id="0822" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们添加一些信号和事件(已知的或检测到的),为这个柱状图添加一些额外的上下文:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/d6f400f6adc0fc265016c1aeec595e74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x9wbLjOpCCPq4DfEcvYLuw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">最终变量演化图(图片由作者提供)</p></figure><p id="9258" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你会在<code class="fe nx ny nz no b"><a class="ae ky" href="https://github.com/michaelhoarau/smarter-anomaly-detection/blob/main/notebooks/synthetic_3_model_evaluation.ipynb" rel="noopener ugc nofollow" target="_blank">synthetic_3_model_evaluation.ipynb</a> </code>笔记本里找到所有的详细代码。从上面显示的扩展结果数据框架(我们称之为<code class="fe nx ny nz no b">df</code>)中，前面的条形图是用以下代码生成的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">变量演变条形图生成(作者代码)</p></figure><h1 id="45ee" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">下一步是什么？</h1><p id="33b2" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">在本文中，您了解了如何利用事件率将您的模型从单纯的检测提升到某种程度的预测，以及如何开始更好地了解哪些信号是应该首先研究的。</p><p id="1b54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我的下一篇文章中，我将详细介绍如何更深入地理解我的异常检测模型的结果:</p><div class="op oq gp gr or os"><a rel="noopener follow" target="_blank" href="/top-3-ways-your-anomaly-detection-models-can-earn-your-trust-f59072a6199c"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">异常检测模型赢得您信任的三大方法</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">将异常检测模型结果连接回原始信号</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">towardsdatascience.com</p></div></div><div class="pb l"><div class="po l pd pe pf pb pg ks os"/></div></div></a></div><p id="20e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你觉得这篇文章很有见地:如果你不想错过我即将发布的帖子，请随时在这里给我留下评论，并不要犹豫订阅我的<a class="ae ky" href="https://michoara.medium.com/subscribe" rel="noopener"> <strong class="lb iu">中型电子邮件源</strong> </a>！想支持我和以后的工作？<strong class="lb iu">通过我的推荐链接加入Medium </strong>:</p><div class="op oq gp gr or os"><a href="https://michoara.medium.com/membership" rel="noopener follow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">通过我的推荐链接加入Medium—Michal Hoa RAU</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">michoara.medium.com</p></div></div><div class="pb l"><div class="pp l pd pe pf pb pg ks os"/></div></div></a></div></div></div>    
</body>
</html>