<html>
<head>
<title>Basic to Advanced Logging with Python in 10 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python在10分钟内完成从基础到高级的日志记录</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/basic-to-advanced-logging-with-python-in-10-minutes-631501339650#2022-10-18">https://towardsdatascience.com/basic-to-advanced-logging-with-python-in-10-minutes-631501339650#2022-10-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6d75" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">日志速成班，解决常见日志问题</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6960211af3ebd6841d9ef01991716a74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rFAUL8hERx_CqCgw"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@adityaries?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Aditya Saxena </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="0b37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Python项目中，很容易使用打印语句和堆栈跟踪来跟踪代码进度和调试。但是，日志记录提供了跟踪和调试时间戳、文件名、代码行号等附加功能，区分不同类型的打印语句，甚至可以选择将打印语句保存到日志文件或其他位置，而不仅仅是在控制台或命令行上查看！</p><p id="fee0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文将介绍日志记录的组件，如何在一个文件中执行日志记录，以及如何使用配置以可重用和可伸缩的方式跨多个文件执行日志记录。</p><p id="8cf2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">更新</em> </strong> <em class="lv">:本文是一个系列的一部分。查看其他“10分钟内”话题</em> <a class="ae ky" href="https://medium.com/@kayjanwong/list/in-10-minutes-eeaa9aa67055" rel="noopener"> <em class="lv">此处</em> </a> <em class="lv">！</em></p><h1 id="6806" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">目录</h1><ul class=""><li id="aeb0" class="mo mp it lb b lc mq lf mr li ms lm mt lq mu lu mv mw mx my bi translated"><a class="ae ky" href="https://medium.com/p/631501339650/#ff3f" rel="noopener">日志记录的组成部分:文件、级别、格式</a></li><li id="38fe" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><a class="ae ky" href="https://medium.com/p/631501339650/#c1dd" rel="noopener">文件内的基本记录</a></li><li id="c1c9" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><a class="ae ky" href="https://medium.com/p/631501339650/#0ce9" rel="noopener">日志记录的高级组件:记录器、处理器、过滤器、格式化器</a></li><li id="5efb" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><a class="ae ky" href="https://medium.com/p/631501339650/#bd1f" rel="noopener">使用配置文件进行高级日志记录</a></li><li id="57ca" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><a class="ae ky" href="https://medium.com/p/631501339650/#9202" rel="noopener">常见问题:覆盖、继承</a></li></ul><h1 id="ff3f" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">日志记录的组成部分</h1><p id="b004" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在深入研究代码实现之前，有几个组件是有效使用日志记录不可或缺的。</p><h2 id="80b2" class="nh lx it bd ly ni nj dn mc nk nl dp mg li nm nn mi lm no np mk lq nq nr mm ns bi translated">日志文件—在哪里记录？</h2><p id="c543" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">建议将日志保存到日志文件中，而不是在控制台或命令行中查看，因为一旦控制台或终端关闭，信息就会消失。我们可以指定我们想要存储日志的项目的相对路径。</p><p id="6c91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以定义保存模式。默认情况下，日志以追加模式保存，但可以更改为写入模式以覆盖以前的日志。</p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><h2 id="7ddb" class="nh lx it bd ly ni nj dn mc nk nl dp mg li nm nn mi lm no np mk lq nq nr mm ns bi translated">日志级别—何时记录？</h2><p id="f5d8" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">根据所跟踪事件的任务和严重性，有5个级别的日志记录。按照严重性的递增顺序，</p><ul class=""><li id="1652" class="mo mp it lb b lc ld lf lg li oa lm ob lq oc lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">DEBUG</strong></code>:记录详细信息，用于诊断问题，即故障调查</li><li id="a16e" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">INFO</strong></code>:记录详细信息，用于程序的正常运行，即状态监控</li><li id="eb73" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">WARN</strong></code>:记录未来的意外事件或潜在问题，当代码在意外事件发生后仍能正常工作时使用</li><li id="0cfc" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">ERROR</strong></code>:记录严重的问题，当代码不能执行某些功能时使用</li><li id="bf3a" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">CRITICAL</strong></code>:记录严重错误，在代码无法继续运行时使用</li></ul><p id="6f41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当有疑问时，我总是在正常操作时使用<code class="fe od oe of og b">INFO</code>级别，而在分别面临次要和主要问题时使用<code class="fe od oe of og b">WARN</code>或<code class="fe od oe of og b">ERROR</code>级别。</p><p id="b9bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，日志级别为<code class="fe od oe of og b">WARN</code>，这意味着低于该级别的日志级别，即<code class="fe od oe of og b">DEBUG</code>和<code class="fe od oe of og b">INFO</code>，将不会被记录，除非更改默认日志级别。</p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><h2 id="8103" class="nh lx it bd ly ni nj dn mc nk nl dp mg li nm nn mi lm no np mk lq nq nr mm ns bi translated">日志格式—记录什么？</h2><p id="3cd8" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">可以设置日志的格式，这种格式适用于所有日志条目——这意味着您不必为每个日志调用手动标准化相同的格式！默认情况下，日志条目遵循格式<code class="fe od oe of og b"><strong class="lb iu">levelname:name:message</strong></code>，比如<code class="fe od oe of og b">DEBUG:root:This is a log entry</code>，但是可以对其进行定制以包含更多信息，</p><ul class=""><li id="ad93" class="mo mp it lb b lc ld lf lg li oa lm ob lq oc lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">asctime</strong></code>:日志时间，具有默认格式<code class="fe od oe of og b">%Y-%m-%d %H:%M:%S,%f</code>，但是可以根据Python日期时间模块<a class="ae ky" href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-format-codes" rel="noopener ugc nofollow" target="_blank">格式代码</a>进行更改</li><li id="9771" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">levelname</strong></code>:日志级别，即<code class="fe od oe of og b">DEBUG</code>、<code class="fe od oe of og b">INFO</code></li><li id="8e95" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">name</strong></code>:记录仪名称，默认为<code class="fe od oe of og b">root</code></li><li id="5c6e" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">filename</strong></code>:包含日志调用的文件名，即<code class="fe od oe of og b">file.py</code></li><li id="e105" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">module</strong></code>:文件名的名称部分，即<code class="fe od oe of og b">file</code></li><li id="d94c" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">funcName</strong></code>:包含日志调用的函数名，即<code class="fe od oe of og b">function_name</code></li><li id="4a35" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">lineno</strong></code>:发出日志调用的文件的行号</li><li id="10cf" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">message</strong></code>:日志消息，如<code class="fe od oe of og b">This is a log entry</code></li><li id="6077" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">更多格式属性可以在找到<a class="ae ky" href="https://docs.python.org/3/library/logging.html#logrecord-attributes" rel="noopener ugc nofollow" target="_blank"/></li></ul><p id="f2d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了指定格式，我们使用<code class="fe od oe of og b">"%(component)s"</code>约定，比如<code class="fe od oe of og b">"%(levelname)s"</code>。例如，默认格式表示为<code class="fe od oe of og b">"%(levelname)s:%(name)s:%(message)s"</code>。这将在下一节详细阐述。</p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><h1 id="c1dd" class="lw lx it bd ly lz oh mb mc md oi mf mg jz oj ka mi kc ok kd mk kf ol kg mm mn bi translated">文件内的基本日志记录</h1><p id="7b8d" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">理解了日志组件之后，我们就可以记录一些信息了！日志记录可以这样进行，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="ba45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的例子中，我们使用<code class="fe od oe of og b"><strong class="lb iu">basicConfig</strong></code>来指定日志配置，</p><ul class=""><li id="1979" class="mo mp it lb b lc ld lf lg li oa lm ob lq oc lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">filename</strong></code>:日志文件，<em class="lv">相对于</em>项目的路径</li><li id="f523" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">filemode</strong></code>:保存模式，<code class="fe od oe of og b">"a"</code>追加(默认)，<code class="fe od oe of og b">"w"</code>写入</li><li id="af4a" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">level</strong></code>:日志级别，<code class="fe od oe of og b">DEBUG</code>表示将记录等于或高于<code class="fe od oe of og b">DEBUG</code>级别的每个项目</li><li id="0e78" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">format</strong></code>:日志格式</li><li id="8662" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">datefmt</strong></code>:日志格式中<code class="fe od oe of og b">asctime</code>的日期格式</li><li id="5d46" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">encoding</strong></code>:指定编码，仅在Python版本中可用</li></ul><p id="296c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">指定配置后，我们可以在代码中插入日志调用，如<code class="fe od oe of og b">logging.info()</code>来执行日志记录。默认情况下，只记录日志消息，但是我们可以设置<code class="fe od oe of og b">exc_info=True</code>来捕获堆栈跟踪，如第19行所示。</p><p id="d162" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也就是说，使用<code class="fe od oe of og b">basicConfig</code>实现日志记录需要在不同的文件中定义配置，这会导致重复的代码。在下一节中，我们将利用配置文件以可重用和可伸缩的方式实现日志记录。</p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><h1 id="0ce9" class="lw lx it bd ly lz oh mb mc md oi mf mg jz oj ka mi kc ok kd mk kf ol kg mm mn bi translated">日志记录的高级组件</h1><p id="6d0c" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">对于日志记录的高级用法，我们可以在一个配置文件中定义日志配置，使其可在多个Python文件中重复使用。如果以这种方式实现日志记录，可以完成更多的项目和定制，并且它建立在上一节中的基本组件之上。</p><h2 id="8d10" class="nh lx it bd ly ni nj dn mc nk nl dp mg li nm nn mi lm no np mk lq nq nr mm ns bi translated">记录器</h2><blockquote class="oo op oq"><p id="856e" class="kz la lv lb b lc ld ju le lf lg jx lh or lj lk ll os ln lo lp ot lr ls lt lu im bi translated">记录器公开应用程序代码直接使用的接口</p></blockquote><p id="ca3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记录器对应于日志条目中的<code class="fe od oe of og b">name</code>属性。默认选择<code class="fe od oe of og b">root</code>记录器及其保存路径、保存模式、格式等设置。由<em class="lv">处理程序</em>处理(下一节)。</p><p id="f595" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用模块级日志记录器是一个很好的习惯，这样模块名而不是<code class="fe od oe of og b">root</code>将作为日志条目的<code class="fe od oe of og b">name</code>属性出现。</p><p id="c8fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果需要一个以上的设置，可以定义并使用自定义记录器来代替<code class="fe od oe of og b">root</code>记录器。</p><p id="1262" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">模块级记录器和自定义记录器可以这样实现，</p><pre class="kj kk kl km gt ou og ov bn ow ox bi"><span id="5d9c" class="oy lx it og b be oz pa l pb pc"># Within Python file<br/>import logging<br/>logging.basicConfig(...)<br/><br/># Module-level logger<br/>logger = logging.getLogger(__name__)<br/><br/># Custom logger<br/>logger = logging.getLogger("custom_logger")<br/><br/># Log call<br/>logger.info("Log with info-level severity")</span></pre><p id="7860" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意日志调用现在用<code class="fe od oe of og b">logger.info()</code>代替<code class="fe od oe of og b">logging.info()</code>！</p><h2 id="bb0b" class="nh lx it bd ly ni nj dn mc nk nl dp mg li nm nn mi lm no np mk lq nq nr mm ns bi translated">经理人</h2><blockquote class="oo op oq"><p id="22fa" class="kz la lv lb b lc ld ju le lf lg jx lh or lj lk ll os ln lo lp ot lr ls lt lu im bi translated">处理程序将日志记录发送到适当的目的地(类似于日志文件)</p></blockquote><p id="634d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">处理程序指定如何保存日志。在前面的部分中，我们只将日志保存到一个日志文件中，但是有更多的方法来处理日志。这可以通过使用已经为您实现的相关处理程序类来完成。常见的处理程序类包括:</p><ul class=""><li id="eb21" class="mo mp it lb b lc ld lf lg li oa lm ob lq oc lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">StreamHandler</strong></code>:发送消息到流，即控制台</li><li id="3ae0" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">FileHandler</strong></code>:发送消息到磁盘文件</li><li id="a673" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">RotatingFileHandler</strong></code>:支持最大日志文件大小和日志文件循环的FileHandler</li><li id="675c" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">更多的处理器类型可以在<a class="ae ky" href="https://docs.python.org/3/howto/logging.html#useful-handlers" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</li></ul><p id="722a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">模块化</strong>:处理程序是以模块化的方式实现的，这样就可以定义一个处理程序名，并在不同的记录器(<code class="fe od oe of og b">root</code>或自定义记录器)之间重用。</p><p id="c17b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">多对一</strong>:一个日志记录器可以由多个处理程序组成，例如，如果我们希望日志使用<code class="fe od oe of og b">StreamHandler</code>同时出现在控制台上，并使用<code class="fe od oe of og b">FileHandler</code>保存到一个日志文件中。</p><h2 id="9527" class="nh lx it bd ly ni nj dn mc nk nl dp mg li nm nn mi lm no np mk lq nq nr mm ns bi translated">过滤</h2><blockquote class="oo op oq"><p id="0d9c" class="kz la lv lb b lc ld ju le lf lg jx lh or lj lk ll os ln lo lp ot lr ls lt lu im bi translated">过滤器根据严重性(类似于日志级别)确定输出哪些日志记录</p></blockquote><p id="59c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">过滤器设置日志严重级别，并记录指定严重级别及以上的所有内容。在字段<code class="fe od oe of og b"><strong class="lb iu">level</strong></code>下，过滤器与处理程序一起定义。</p><p id="63af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果需要更多的定制，例如只过滤一个特定的严重性级别，必须编写一个Python类，这个过滤器将与处理程序一起定义，但现在在字段<code class="fe od oe of og b"><strong class="lb iu">filters</strong></code>下。</p><p id="d422" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">模块化</strong>:过滤器是以模块化的方式实现的，这样就可以定义一个过滤器名称，并在不同的处理程序中重用。</p><p id="9aab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">多对一</strong>:一个处理器可以由多个过滤器组成。</p><h2 id="eef7" class="nh lx it bd ly ni nj dn mc nk nl dp mg li nm nn mi lm no np mk lq nq nr mm ns bi translated">格式化程序</h2><blockquote class="oo op oq"><p id="7cad" class="kz la lv lb b lc ld ju le lf lg jx lh or lj lk ll os ln lo lp ot lr ls lt lu im bi translated">格式化程序指定日志记录的格式(类似于日志格式)</p></blockquote><p id="e546" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">格式化程序设置日志条目的格式。在字段<code class="fe od oe of og b"><strong class="lb iu">formatter</strong></code>下，格式化程序与处理程序一起定义。</p><p id="db5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">模块化:格式化程序是以模块化的方式实现的，这样就可以定义一个格式化程序名，并在不同的处理程序中重用。</p><p id="ddf3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">一对一</strong>:每个处理程序只能有一种日志格式。</p><blockquote class="pd"><p id="39d5" class="pe pf it bd pg ph pi pj pk pl pm lu dk translated">每个处理程序都有一个独特的文件过滤格式设置</p></blockquote><p id="9e69" class="pw-post-body-paragraph kz la it lb b lc pn ju le lf po jx lh li pp lk ll lm pq lo lp lq pr ls lt lu im bi translated">因为过滤器和格式化程序是与处理程序一起定义的，所以每个处理程序都有一个唯一的文件过滤器格式设置。如果需要另一个文件(<code class="fe od oe of og b">StreamHandler</code>或<code class="fe od oe of og b">FileHandler</code>)、过滤器(<code class="fe od oe of og b">DEBUG</code>或<code class="fe od oe of og b">WARN</code>级)或格式，应该定义一个单独的处理程序。</p><h1 id="bd1f" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">使用配置文件进行高级日志记录</h1><p id="3f9e" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们现在将使用配置文件实现日志记录——这比使用<code class="fe od oe of og b">basicConfig</code>更具可重用性和可伸缩性。配置可以在<code class="fe od oe of og b">.py</code>或<code class="fe od oe of og b">.yml</code>文件中的<code class="fe od oe of og b">.conf</code>文件或字典中定义</p><p id="d4c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">字典配置可以这样定义，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="37d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到字典配置被分成几个部分</p><ul class=""><li id="4f66" class="mo mp it lb b lc ld lf lg li oa lm ob lq oc lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">version</strong></code>(第13行):用整数表示版本号</li><li id="fc80" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">loggers</strong></code>(第14–25行):定义根和自定义记录器，由一个或多个处理程序组成</li><li id="2de4" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">handlers</strong></code>(第26–41行):定义在记录器中使用的自定义处理程序，包括特定的文件过滤格式设置</li><li id="5803" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">filters</strong></code>(第42–47行):定义在处理程序中使用的自定义过滤器</li><li id="460b" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b"><strong class="lb iu">formatters</strong></code>(第48–52行):定义在处理程序中使用的自定义格式化程序</li></ul><p id="eb8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe od oe of og b">.conf</code>文件的等效实现可以是这样的，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="36e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用<code class="fe od oe of og b">logging.conf</code>中定义的配置初始化记录器，</p><pre class="kj kk kl km gt ou og ov bn ow ox bi"><span id="d64a" class="oy lx it og b be oz pa l pb pc">import logging.config<br/>logging.config.fileConfig("logging.conf")<br/>logger = logging.getLogger(__name__)</span></pre><p id="920d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">比较<code class="fe od oe of og b">dictConfig</code>和<code class="fe od oe of og b">fileConfig</code>，字典实现是首选，因为它更新，能够支持更多功能，如使用自定义过滤器。</p><p id="e7d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">比较<code class="fe od oe of og b">logging.config</code>和<code class="fe od oe of og b">logging.basicConfig</code>，使用配置文件减少了重复代码的数量，并将配置抽象到单独的字典或配置文件中，这是跨多个文件执行日志记录的首选方式。</p><h1 id="9202" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">常见问题</h1><p id="7bdd" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在这一节中，我将涉及一些使用配置文件实现日志记录的常见问题和注意事项。</p><h2 id="fa89" class="nh lx it bd ly ni nj dn mc nk nl dp mg li nm nn mi lm no np mk lq nq nr mm ns bi translated">最重要的</h2><p id="ef60" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">有几种方法可以覆盖日志配置。</p><p id="a55a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">№1:同时使用<code class="fe od oe of og b">logging.basicConfig</code>和<code class="fe od oe of og b">logging.config</code></p><p id="e5be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果不同的文件使用不同的方法实例化记录器，并且在这些文件之间进行了一些导入，使得日志配置中存在冲突，<code class="fe od oe of og b">logging.config</code>实现优先，<code class="fe od oe of og b">logging.basicConfig</code>被覆盖。</p><p id="6736" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">№2:日志级别是在日志程序级别与处理程序级别定义的</p><p id="5528" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您注意到在字典和<code class="fe od oe of og b">logging.conf</code>文件中，日志级别被定义了两次，一次在记录器定义中，另一次在处理程序定义中。严重性级别越高，优先级越高，其次是记录器级别优先于处理程序级别。</p><p id="cd4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使这项工作对您有利，我们可以将日志记录级别设置为最低严重性<code class="fe od oe of og b">DEBUG</code>，并使用处理程序级别来控制级别。如果一个级别应该跨多个处理程序进行标准化，那么可以在logger定义中随意定义这个级别。</p><h2 id="ad7e" class="nh lx it bd ly ni nj dn mc nk nl dp mg li nm nn mi lm no np mk lq nq nr mm ns bi translated">遗产</h2><p id="a14c" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在继承期间，日志将被传递给记录器及其高级(祖先)记录器，导致日志条目被复制。默认情况下，所有自定义记录器都继承自<code class="fe od oe of og b">root</code>记录器。</p><p id="50a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了防止继承导致重复的日志，我们可以在配置中定义记录器时将<code class="fe od oe of og b">propagate</code>字段指定为<code class="fe od oe of og b">False</code>。</p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><p id="478b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望您已经更多地了解了日志记录的组件，以及如何使用配置文件以可重用和可伸缩的方式实现它！与普通的打印语句相比，日志记录有助于开发人员更好地控制和理解代码库，在大型项目中调试代码时尤其有用。</p><p id="94da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">感谢您的阅读！如果你喜欢这篇文章，请随意分享。</strong></p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><h1 id="94b8" class="lw lx it bd ly lz oh mb mc md oi mf mg jz oj ka mi kc ok kd mk kf ol kg mm mn bi translated">相关链接</h1><p id="1327" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">记录文档:<a class="ae ky" href="https://docs.python.org/3/library/logging.html" rel="noopener ugc nofollow" target="_blank">https://docs.python.org/3/library/logging.html</a></p><p id="4914" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">伐木食谱:<a class="ae ky" href="https://docs.python.org/3/howto/logging-cookbook.html" rel="noopener ugc nofollow" target="_blank">https://docs.python.org/3/howto/logging-cookbook.html</a></p></div></div>    
</body>
</html>