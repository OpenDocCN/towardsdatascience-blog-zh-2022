<html>
<head>
<title>A deep dive into Power BI incremental refresh feature</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深入了解Power BI增量更新功能</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-deep-dive-into-power-bi-incremental-refresh-feature-a5fc8af781ee#2022-08-29">https://towardsdatascience.com/a-deep-dive-into-power-bi-incremental-refresh-feature-a5fc8af781ee#2022-08-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7c44" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">它是什么，它是如何工作的，它到底是如何工作的？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4d6f0383d121bc9badb81e2bc99b772d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VHajT-4n_tu5V0QAIMO1mw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由作者提供。这张图片中的名字是虚构的，由电脑生成。</p></figure><p id="99dc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你正在读这篇文章，你很可能知道什么是力量比(PBI)和它的用途。在本文中，我想更深入地探讨一下他们的增量更新，这无疑给社区和我认识的人带来了很多困惑。</p><p id="ee33" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在PBI，有一个叫做<a class="ae lr" href="https://docs.microsoft.com/en-us/power-bi/connect-data/incremental-refresh-overview" rel="noopener ugc nofollow" target="_blank">增量刷新</a>的特性，它允许你的数据集被增量刷新。微软也谈到了增量更新的好处，所以<a class="ae lr" href="https://docs.microsoft.com/en-us/power-bi/connect-data/incremental-refresh-overview" rel="noopener ugc nofollow" target="_blank">在这里继续之前先读一下</a>。与传统的ETL/ELT不同，PBI有一种相当独特的增量刷新数据的方式，这将在后面讨论。</p><p id="8962" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">*我只想强调，此增量刷新仅适用于发布到PBI web服务的数据集。</p><h1 id="ca00" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">入口</h1><ul class=""><li id="b430" class="mk ml iq kx b ky mm lb mn le mo li mp lm mq lq mr ms mt mu bi translated"><a class="ae lr" href="#133d" rel="noopener ugc nofollow"> ETL/ELT基础知识</a></li><li id="87da" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi translated"><a class="ae lr" href="#e3ab" rel="noopener ugc nofollow">微软增量刷新理论基础</a></li><li id="d4a9" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi translated"><a class="ae lr" href="#ecbb" rel="noopener ugc nofollow">最佳情况和最坏情况场景</a></li><li id="ea03" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi translated"><a class="ae lr" href="#9de4" rel="noopener ugc nofollow">真实世界测试— Power BI数据集</a></li><li id="a393" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi translated"><a class="ae lr" href="#14f9" rel="noopener ugc nofollow">真实世界测试— Power BI数据集市(预览)服务</a></li><li id="3b1a" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi translated"><a class="ae lr" href="#e20b" rel="noopener ugc nofollow">与数据集市的问题</a></li><li id="c05b" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi translated"><a class="ae lr" href="#d5b5" rel="noopener ugc nofollow">结论</a></li></ul><h1 id="133d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">ETL/ELT基础</h1><p id="3ce0" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">Stitchdata写了一篇关于ETL过程基础的详细文章，可以在这里找到<a class="ae lr" href="https://www.stitchdata.com/etldatabase/etl-process/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="67dd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">总而言之，ETL工具通常会使用<a class="ae lr" href="https://docs.microsoft.com/en-us/sql/relational-databases/track-changes/about-change-data-capture-sql-server?view=sql-server-ver16" rel="noopener ugc nofollow" target="_blank">变更数据捕获</a> (CDC)来检查新数据。但是，由于各种原因，并非所有数据库都启用了CDC，在这种情况下，将使用最新的行更新时间戳。然后，新的和更改的数据将被追加到数据仓库中，或者根据业务案例覆盖旧的数据。</p><h1 id="e3ab" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">微软增量更新理论基础</h1><p id="c72c" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">回头看看微软提供的文档<a class="ae lr" href="https://docs.microsoft.com/en-us/power-bi/connect-data/incremental-refresh-overview" rel="noopener ugc nofollow" target="_blank">，增量刷新被分解为</a><a class="ae lr" href="https://docs.microsoft.com/en-us/power-bi/connect-data/incremental-refresh-overview#define-policy" rel="noopener ugc nofollow" target="_blank">几个组件</a>，它们是:</p><ol class=""><li id="e61d" class="mk ml iq kx b ky kz lb lc le nd li ne lm nf lq ng ms mt mu bi translated">存档数据</li><li id="8634" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq ng ms mt mu bi translated">增量数据范围</li><li id="5807" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq ng ms mt mu bi translated">检测数据更改</li></ol><p id="fa6c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">而且文档中也写明了微软基于分区刷新数据。</p><p id="2815" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了帮助你，我在Excel中创建了一个简单的表格来演示理论上的工作方法。让我们假设今天是2022年8月2日。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/bac372808daec459f43d660b4dd0f554.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*YT94LsTN65Twv9BJSsh4hA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由作者提供的图像数据集</p></figure><p id="5428" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上面是我们第一次将数据加载到PBI服务时，初始数据集的一个小样本集。将自动创建几个分区，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/431b1c8011a6f3226c44d0cba4fffec8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ntML1poobuWZlAb6QaXOvg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">初始分区数据集:图片由作者提供</p></figure><h2 id="e97f" class="nj lt iq bd lu nk nl dn ly nm nn dp mc le no np me li nq nr mg lm ns nt mi nu bi translated">1.存档数据</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/f7753b8c98189d41dfce1f14645bcf5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*bAdIGKfvlSmWyzVWFTrzQQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由作者提供:Power BI增量弹出存档选项截图</p></figure><p id="f9d7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在不更新任何数据并将存档数据范围设置为1年的情况下，PBI服务将在1年前的今天(2022年8月2日)删除所有数据分区。在上面的例子中，分区2020将被删除。</p><h2 id="3978" class="nj lt iq bd lu nk nl dn ly nm nn dp mc le no np me li nq nr mg lm ns nt mi nu bi translated">2.增量数据范围</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/0527b89e8fe2f246f1ff69f2f9d095bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*PPBW_gHZwFqvaIBqenjWdw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由作者提供:Power BI增量弹出增量选项截图</p></figure><p id="2d71" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我们将增量数据设置为刷新日期前7天的范围，实质上PBI服务将删除今天之前7天的数据，并重新加载所有7天的数据。在我们上面的样本数据集中，“Partition 2022–08-xx”中的所有内容都将被删除，并从源中重新加载。</p><h2 id="2f80" class="nj lt iq bd lu nk nl dn ly nm nn dp mc le no np me li nq nr mg lm ns nt mi nu bi translated">3.检测数据更改</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/123889b526fa4216ac0de9cd7194466e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*7N3KqDSe4X_0JL65Nve0JA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由作者提供:Power BI增量弹出检测数据更改选项截图</p></figure><p id="85d7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，当我们选择detect data changes时，PBI服务将只刷新增量范围(在我们的示例中是最后7天)的<strong class="kx ir">分区，其中最大<em class="ny">更新日期</em>被更改。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/17c0e8d8ef6df4b64d8ffad66d280aac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*JSpIou-Bw0ML1pVaBTvqgQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由作者提供</p></figure><p id="2350" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我们的数据集示例中，如果F数据被更改，<strong class="kx ir">不会发生刷新</strong>，因为分区2022-Q1不在我们过去7天的增量范围内。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/e867f1cf9d6a85b78980d0725311affe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*Wg-iiRt3Po49DELYVajAFQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">更新的增量刷新范围:图片由作者提供</p></figure><p id="4b5f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是，如果我们在刷新日期之前将增量范围从7天更改为12个月，分区2022-Q1数据(E和F)将被删除并重新加载。</p><h1 id="ecbb" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">最好和最坏的情况</h1><p id="d2ba" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">最好的情况看起来像一个事务表，其中添加了新行，旧行没有更新。</p><p id="5971" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">正常的情况是，通常添加新行，更新的行在一个分区内。这可能是一个简单的音乐会事件表，其中在很短的时间内发生门票购买和取消。事件发生1个月后，数据将不再更新。</p><p id="7895" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最坏的情况是每个分区至少有一次更新。这将导致几乎整个表被重新加载，因为PBI增量刷新将重新加载整个分区，可能会重新加载整个表。一个用例可能是一个库存系统，其中项目在几个月或几年前被检入，并且每天被检出。</p><h1 id="9de4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">真实世界测试— Power BI数据集</h1><p id="9d7d" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">现在我们知道了PBI服务是如何增量刷新数据集的，那么它在部署时实际上也是这样吗？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/2b3fdc96370d24e243b49392e26b62f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*_yxeHBkSK_FkNTEuXPZvKQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="e061" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了测试这一点，我建立了一个包含500行虚拟数据的MySQL数据库。<em class="ny">创建日期和更新日期</em>，范围从<em class="ny">2021–08–15</em>到<em class="ny">2022–08–08</em>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/90bb58ce8de9c9a35ab86c1f993f52ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*e1ZmocmxYZkjeVDc6n7eBg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片:增量刷新配置</p></figure><p id="8c95" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">PBI增量刷新配置如上截图。</p><p id="c3e5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我在MySQL上启用了查询日志来记录运行的查询。</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="6e29" class="nj lt iq oe b gy oi oj l ok ol">SET global general_log = 1;<br/>SET global log_output = 'table';</span></pre><p id="70f4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，我将包含该数据集的数据集/Power BI报告发布到高级工作区，并通过安装在我电脑上的Power BI Gateway刷新数据集。</p><h2 id="3baa" class="nj lt iq bd lu nk nl dn ly nm nn dp mc le no np me li nq nr mg lm ns nt mi nu bi translated">测试用例PBI01:刷新而不更新任何数据</h2><p id="c863" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">对于第一个测试用例，我只是再次刷新了数据，而没有更新数据库中的任何数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/c39149fa5ff145efa61b4f92ae56ad06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HorhHdw0ltvBMI45_O2RfA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由作者提供</p></figure><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="7973" class="nj lt iq oe b gy oi oj l ok ol">select max(`rows`.`update_timestamp`) as `update_timestamp`<br/>from <br/>(<br/>    select `_`.`update_timestamp`<br/>    from `test`.`inc_t` `_`<br/>    where `_`.`create_timestamp` &gt;= '2022-05-01 00:00:00' and `_`.`create_timestamp` &lt; '2022-06-01 00:00:00'<br/>) `rows`</span></pre><p id="f7d2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从日志中，PBI服务检查每个分区的最大更新，在我们的例子中:</p><ul class=""><li id="a549" class="mk ml iq kx b ky kz lb lc le nd li ne lm nf lq mr ms mt mu bi">2022–03–01 &gt; 2022–04–01</li><li id="084f" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi">2022–04–01 &gt; 2022–05–01</li><li id="59f5" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi">2022–05–01 &gt; 2022–06–01</li><li id="bcc4" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi">2022–06–01 &gt; 2022–07–01</li><li id="0230" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi">2022–07–01 &gt; 2022–08–01</li><li id="44bb" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi">2022–08–01 &gt; 2022–09–01</li></ul><p id="f673" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我们的例子中，因为没有更新数据，所以没有发生刷新，也没有运行额外的查询。第一个测试用例通过了。</p><h2 id="0032" class="nj lt iq bd lu nk nl dn ly nm nn dp mc le no np me li nq nr mg lm ns nt mi nu bi translated">测试用例PBI02:在增量范围内更新行</h2><p id="4db7" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">在第二个测试案例中，我将在MySQL源数据库上从创建日期<em class="ny">2022–06–01</em>更新2行到<em class="ny">2022–08–28</em>(需要更新2行)。</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="3052" class="nj lt iq oe b gy oi oj l ok ol">UPDATE INC_t<br/>SET UPDATE_TIMESTAMP = '2022-08-08 09:29:23'<br/>WHERE DATE(CREATE_TIMESTAMP) = '2022-06-01';</span><span id="d9e9" class="nj lt iq oe b gy on oj l ok ol">-- 2 row(s) affected Rows matched: 2  Changed: 2  Warnings: 0 0.015 sec</span></pre><p id="35c4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，当然，手动触发计划的刷新。</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="3bed" class="nj lt iq oe b gy oi oj l ok ol">select `$Ordered`.`id`,<br/>    `$Ordered`.`name`,<br/>    `$Ordered`.`alphanumeric`,<br/>    `$Ordered`.`phrase`,<br/>    `$Ordered`.`country`,<br/>    `$Ordered`.`update_timestamp`,<br/>    `$Ordered`.`create_timestamp`<br/>from <br/>(<br/>    select `_`.`id`,<br/>        `_`.`name`,<br/>        `_`.`alphanumeric`,<br/>        `_`.`phrase`,<br/>        `_`.`country`,<br/>        `_`.`update_timestamp`,<br/>        `_`.`create_timestamp`<br/>    from `test`.`inc_t` `_`<br/>    where `_`.`create_timestamp` &gt;= '2022-06-01 00:00:00' and `_`.`create_timestamp` &lt; '2022-07-01 00:00:00'<br/>) `$Ordered`<br/>order by `$Ordered`.`id`</span></pre><p id="d457" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对每个分区运行最大更新的初始检查，然后如上所述运行新的查询。该查询将重新加载从<em class="ny">2022–06–01</em>到<em class="ny">2022–07–01</em>的所有数据。</p><p id="14bb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这表明增量刷新符合文档，并且没有加载整个数据集。</p><h1 id="14f9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">真实世界测试— Power BI数据集市(预览)服务</h1><p id="b8b1" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">就在最近，微软推出了数据集市，你可以在这里阅读更多的信息。在数据集市内部，有一个增量刷新选项。为了进行测试，我通过设置的同一个Power BI网关将数据集市连接到同一个MySQL数据库。</p><p id="78f6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是在初始数据加载时运行的查询。如图所示，加载所有数据时没有任何<em class="ny"> WHERE </em>子句。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/f4b6f232cac372dbabc587bf3ae8daf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*IT8ntJON1UtmIS9bAGhO8Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="d634" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在装载了初始数据之后，就该在datamart中对该表设置增量刷新了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi op"><img src="../Images/50de6375425f77d9700f90fe880b8379.png" data-original-src="https://miro.medium.com/v2/resize:fit:796/format:webp/1*1SBFhMxtn0FpNVVdyAV93g.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/c5272caab8528e86f230543a7bae294d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NoydNkJqDonad5ANALFO9w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者:增量刷新配置</p></figure><p id="cdf6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">配置设置类似于我在Power BI Desktop中做的第一个测试用例。然而，使用数据集市，<strong class="kx ir">不需要</strong>创建RangeStart和RangeEnd参数，因为它们是自动创建的。</p><p id="1c49" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当然，手动触发数据集市的计划刷新。</p><h2 id="0f98" class="nj lt iq bd lu nk nl dn ly nm nn dp mc le no np me li nq nr mg lm ns nt mi nu bi translated">测试用例D01:刷新而不更新任何数据</h2><p id="a37c" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">从运行的查询来看，它们是用于检查MAX update的<strong class="kx ir"> no </strong>查询。相反，<strong class="kx ir">查询并加载了过去6个月的所有分区。</strong></p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="54a0" class="nj lt iq oe b gy oi oj l ok ol">select `_`.`id`,<br/>    `_`.`name`,<br/>    `_`.`alphanumeric`,<br/>    `_`.`phrase`,<br/>    `_`.`country`,<br/>    `_`.`update_timestamp`,<br/>    `_`.`create_timestamp`<br/>from <br/>(<br/>    select `_`.`id`,<br/>        `_`.`name`,<br/>        `_`.`alphanumeric`,<br/>        `_`.`phrase`,<br/>        `_`.`country`,<br/>        `_`.`update_timestamp`,<br/>        `_`.`create_timestamp`<br/>    from `test`.`inc_t` `_`<br/>    where `_`.`create_timestamp` &gt;= '2022-05-01 00:00:00' and `_`.`create_timestamp` &lt; '2022-06-01 00:00:00'<br/>) `_`<br/>order by `_`.`update_timestamp` desc<br/>limit 4096</span></pre><p id="21de" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这表明数据集市中刷新更改的数据的行为与PBI增量刷新中检测数据更改的行为不同。</p><p id="30a4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了进一步测试，我将更新我的配置以刷新最近1个月的数据，并跳转到第二个测试用例。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi or"><img src="../Images/01abc7ef49cb8d0038d7259bd479aaef.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/format:webp/1*1nDRXYiphdWCZDZjKC8xXA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="4f00" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">和预期的一样，1个月的数据被查询和刷新。</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="5d28" class="nj lt iq oe b gy oi oj l ok ol">select `_`.`id`,<br/>    `_`.`name`,<br/>    `_`.`alphanumeric`,<br/>    `_`.`phrase`,<br/>    `_`.`country`,<br/>    `_`.`update_timestamp`,<br/>    `_`.`create_timestamp`<br/>from <br/>(<br/>    select `_`.`id`,<br/>        `_`.`name`,<br/>        `_`.`alphanumeric`,<br/>        `_`.`phrase`,<br/>        `_`.`country`,<br/>        `_`.`update_timestamp`,<br/>        `_`.`create_timestamp`<br/>    from `test`.`inc_t` `_`<br/>    where `_`.`create_timestamp` &gt;= '2022-08-01 00:00:00' and `_`.`create_timestamp` &lt; '2022-09-01 00:00:00'<br/>) `_`<br/>order by `_`.`update_timestamp` desc<br/>limit 4096</span></pre><h2 id="8335" class="nj lt iq bd lu nk nl dn ly nm nn dp mc le no np me li nq nr mg lm ns nt mi nu bi translated">测试案例D02:更新2022–06–05的行</h2><p id="c228" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">鉴于刷新更改的数据与PBI服务检测数据更改的行为不同，我将更新<em class="ny">创建日期</em>落在<em class="ny">2022–06–05</em>的行。</p><pre class="kg kh ki kj gt od oe of og aw oh bi"><span id="b4de" class="nj lt iq oe b gy oi oj l ok ol">UPDATE INC_t<br/>SET UPDATE_TIMESTAMP = '2022-08-28 23:00:00'<br/>WHERE DATE(CREATE_TIMESTAMP) = '2022-06-05';<br/>-- 4 row(s) affected Rows matched: 4  Changed: 4  Warnings: 0 0.000 sec</span></pre><p id="7a18" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">运行刷新后，只运行了1个查询，即只刷新本月的数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi os"><img src="../Images/905de560d659c433e8d241042704ef3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*7NdzYpycbedEoPzP8232Iw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="f82f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">检查update timestamp列，很明显最新的更新没有被刷新到数据集市中。因此，数据集市增量刷新的第二个测试用例被认为是失败的。</p><h2 id="e20b" class="nj lt iq bd lu nk nl dn ly nm nn dp mc le no np me li nq nr mg lm ns nt mi nu bi translated">数据集市的问题</h2><p id="2ac9" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">我用其他变量和数据源(如Oracle DB)在数据集市上重复了这个测试，但是，结果总是相同的，刷新更改的数据<strong class="kx ir">从不</strong>考虑。所有增量范围分区的完全刷新总是在发生。</p><h1 id="d5b5" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="580d" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">增量刷新对于优化源数据库的数据加载至关重要，可以减少源数据库的开销，同时确保报告数据是最新的。随着Microsoft datamart的引入，在不久的将来，一旦超出预览范围，统一各种来源的数据将变得更加容易。希望这篇文章能澄清一些关于增量刷新如何工作的困惑。</p><p id="c69a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Power BI桌面增量刷新按预期工作，但不幸的是，datamart增量刷新没有。由于数据集市仍在预览中，我确信微软将很快修复它，这只是数据集市可能暂时影响你的生产数据库的一个PSA。一旦我再次测试并确认它被修复，或者如果我遗漏了什么，这篇文章也会被更新。我还将测试<a class="ae lr" href="https://docs.microsoft.com/en-us/power-bi/transform-model/dataflows/dataflows-introduction-self-service" rel="noopener ugc nofollow" target="_blank">微软数据流</a>，它应该很快就会被弃用。但是，如果它确实是到数据集市的更好的连接器，我将写另一篇关于设置的文章！</p></div></div>    
</body>
</html>