<html>
<head>
<title>CSVs: Why I Gave Up Some of Their Benefits to Gain Others</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CSV:为什么我放弃了他们的一些利益来获得其他利益</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/best-file-format-to-store-large-data-dfa47701929f#2022-05-21">https://towardsdatascience.com/best-file-format-to-store-large-data-dfa47701929f#2022-05-21</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="ba12" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">我使用的替代方案允许更小的文件大小和更好的性能。</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/9a444a97987ea3828fcf57e657bc866a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eD1MhLXjyBEa29uP"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">何塞·阿拉贡内塞斯在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="8355" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">CSV很好，但被高估了。</p><p id="7447" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我使用CSV已经很长时间了。就像数据科学社区的其他人一样。然后<a class="ae kz" href="https://docs.python.org/3/library/pickle.html" rel="noopener ugc nofollow" target="_blank">腌制</a>一段时间。</p><p id="5b06" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">CSV可以在任何系统上工作，无需安装任何东西。毕竟，它们是一种带有逗号分隔符的纯文本文件。这个事实也让它们超级简单易懂。</p><p id="4a0a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是我们已经在这个舒适区待了太久了。</p><p id="c95d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">大多数数据应用程序受益于放弃一点灵活性。我们可以通过多安装一个包来大大加快数据的读写速度。</p><p id="9489" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本帖中，我们将讨论…</p><p id="d955" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="#b910" rel="noopener ugc nofollow">数据科学家的CSV问题；</a> <br/>我对<a class="ae kz" href="#2e7d" rel="noopener ugc nofollow">用泡菜文件代替的想法；</a><br/><a class="ae kz" href="#1b59" rel="noopener ugc nofollow">CSV和泡菜的更好替代品</a>；<br/> <a class="ae kz" href="#a2c7" rel="noopener ugc nofollow">对存储数据集的不同文件格式进行基准测试</a></p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/python-3-11-is-indeed-faster-than-3-10-1247531e771b"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">Python 3.11确实比3.10快</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">与冒泡排序和递归函数并排比较证实了这一点。</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn kt lz"/></div></div></a></div><p id="5a09" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可以访问我在这篇文章中使用的用于基准测试的<a class="ae kz" href="https://colab.research.google.com/drive/1te6F2RCGohF-nQuOJ9jTxYRETJg5LOpJ?usp=sharing" rel="noopener ugc nofollow" target="_blank"> Colab笔记本</a>。</p><h1 id="b910" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">数据科学家的CSV问题。</h1><p id="dff2" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">自从我们开始存储数据以来，CSV就一直存在。它们与文本文件没有什么不同，只是CSV遵循可预测的逗号模式。</p><p id="8d0e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">软件使用这些信息将数据集分成几列。专栏不是CSV文件本身的奇迹。</p><p id="6523" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">即使列标题和行在CSV文件中也没有区别。我们需要配置读取CSV的软件来选择标题和行号。</p><p id="bbd7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果列的其余部分遵循不同的数据类型，一些软件足够智能地选择标题。但它们只是由某人编程的有根据的猜测。</p><p id="54e9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">简单在很多情况下都很有效。尤其是如果你不知道客户使用的是什么软件，CSV是非常好的。分享然后忘记！</p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/image-data-augmentation-pipeline-9841bc7bb56d"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">这个微小的Python包创建了巨大的扩充数据集</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">如何创建图像数据扩充管道来生成大量合成数据点。</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="nl l mk ml mm mi mn kt lz"/></div></div></a></div><p id="affa" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是CSV并没有针对存储或性能进行优化。</p><p id="122a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们可以把可访问性性能和文件大小想象成一个三角形的三个角。你调一个；另外两个自我调整。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nm"><img src="../Images/4e169861329adfee44e4018d4613e1fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*zD45z3RVkG0fOwx8cdRbvQ.gif"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">图片由<a class="ae kz" href="https://thuwarakesh.medium.com" rel="noopener">作者提供。</a></p></figure><p id="d421" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">CSV已经将可访问性节点提升到最大。它会降低性能和文件质量。在这篇文章的后面，我们将比较CSV和其他格式的文件大小、保存和加载时间。</p><p id="dde5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">CSV的另一个缺点是当文本包含Unicode字符时。您可能需要显式地将编码参数设置为<a class="ae kz" href="https://docs.python.org/3/library/codecs.html#standard-encodings" rel="noopener ugc nofollow" target="_blank">众多支持值</a>中的一个。</p><p id="5747" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这里有一个例子告诉你如何<a class="ae kz" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html" rel="noopener ugc nofollow" target="_blank">在熊猫身上设置编码。</a></p><pre class="kk kl km kn gu nn no np nq aw nr bi"><span id="b479" class="ns mp iu no b gz nt nu l nv nw">df = read_csv('/path/to/file.csv', encoding = "ISO-8859-1")</span></pre><p id="d66c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您的数据集很大，而您不知道使用哪种编码器，那么您就有麻烦了。</p><p id="1f5d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们需要一种存储文件元数据(如头和编码)的文件格式，它从磁盘读取和写入的时间最少，并且大小更小。</p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/become-a-data-scientist-or-data-engineer-without-coding-skills-fbf11ac8e278"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">如何在不编码的情况下成为一名出色的数据科学家(+工程师)</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">从数据中获得意义是常识。编码技能不是数据科学家或数据工程师的超能力。</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="nx l mk ml mm mi mn kt lz"/></div></div></a></div><h1 id="2e7d" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">用泡菜代替怎么样？</h1><p id="3b5b" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">Pickle是一种Python对象存储格式。它不是为存储数据帧而设计的，但在数据帧上运行良好。</p><p id="02fa" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Pickle还可以存储数据帧的头、行号和其他元信息。因此，如果您使用Pandas读取数据帧，引擎不需要花费太多时间来确定数据类型和标题。</p><p id="c47f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Pickle到磁盘和磁盘到pickle与内存到磁盘和磁盘到内存几乎相同。</p><p id="5d6c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">磁盘上Pickle文件的大小可能会有所不同。在大多数情况下，它比CSV略大，因为它们存储了更多关于数据集的信息。但是，Pickle也存储转换成字节流的数据。它可能会使大小小于基于文本的CSV。</p><p id="a1f6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">此外，当您使用Python时，您不需要其他安装就可以从Pickle中获益。</p><pre class="kk kl km kn gu nn no np nq aw nr bi"><span id="39b5" class="ns mp iu no b gz nt nu l nv nw">df.to_pickle("./path/to/file.pkl") # to write a dataframe as pickle</span><span id="fa10" class="ns mp iu no b gz ny nu l nv nw">df = pd.read_pickle("./path/to/file.pkl") # to read a pickled dataframe</span></pre><p id="7d86" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在我们的出发三角中，pickle文件放弃了一点可访问性，以获得性能和文件大小方面的好处。因为您只能从Python程序中读取pickle文件。如果您组织中的其他人正在使用R、Excel或其他软件，它们可能无法很好地工作。</p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/how-to-serve-massive-computations-using-python-web-apps-590e51624bc6"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">如何使用Python Web应用服务于大规模计算？</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">克服Python的局限性，并通过web请求将其用于繁重的数据分析和机器学习。</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="nz l mk ml mm mi mn kt lz"/></div></div></a></div><p id="287b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">酸洗可以解决文件存储的许多问题。但是，如果您愿意进一步缩小可访问性特征的范围，还有一个更好的方法。</p><h2 id="2f9e" class="ns mp iu bd mq oa ob dn mu oc od dp my lj oe of na ln og oh nc lr oi oj ne ok bi translated">对于数据科学家来说，Pickle文件是一个理想的用例。</h2><p id="e1f4" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">我们将在接下来的几节中讨论CSV和Pickle的强大替代方案。</p><p id="5d43" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然而，它们不能被完全抛弃。还没有！</p><p id="d4de" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因为Pickle文件是内存中对象的快照，所以存储经过训练的ML模型非常好。</p><p id="eaf6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">例如，我们将机器学习模型及其权重存储为pickle文件。流行的库如<a class="ae kz" href="https://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank"> scikit-learn </a>和<a class="ae kz" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"> Tensorflow </a>创建可选择的模型。</p><p id="d6d4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这里有一个张量流的例子。</p><pre class="kk kl km kn gu nn no np nq aw nr bi"><span id="0693" class="ns mp iu no b gz nt nu l nv nw">import joblib<br/>import tensorflow as tf<br/><br/>model = tf.keras.Sequential([<br/>            tf.keras.layers.Input(shape=(5,)),<br/>            tf.keras.layers.Dense(units=16, activation='elu'),<br/>            tf.keras.layers.Dense(units=16, activation='elu'),<br/>            tf.keras.layers.Dense(units=8, activation='elu'),<br/>            tf.keras.layers.Dense(units=8, activation='elu'),<br/>            tf.keras.layers.Dense(units=5, activation='softmax'),<br/>        ])<br/><br/>model.compile(optimizer='adam', loss='categorical_crossentropy', metrics=['accuracy'])</span><span id="4d51" class="ns mp iu no b gz ny nu l nv nw">model.fit(df['predictorrs'], df['labels'], epochs=200, batch_size=8)</span><span id="a964" class="ns mp iu no b gz ny nu l nv nw">joblib.dump(model, 'classifier.pkl')</span></pre><h1 id="1b59" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">CSV和泡菜的更好替代品</h1><p id="9460" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">我使用CSV已经很长时间了。就像数据科学社区的其他人一样。然后腌制一段时间。如今，我更喜欢用其他二进制文件格式来存储数据。</p><p id="4526" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">尤其是其中的两个。<a class="ae kz" href="https://arrow.apache.org/docs/python/feather.html" rel="noopener ugc nofollow" target="_blank">羽毛</a> &amp; <a class="ae kz" href="https://parquet.apache.org/" rel="noopener ugc nofollow" target="_blank">拼花</a>。</p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/how-to-speed-up-python-data-pipelines-up-to-91x-80d7accfe7ec"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">如何将Python数据管道加速到91X？</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">一个5分钟的教程可以为您的大数据项目节省数月时间。</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="ol l mk ml mm mi mn kt lz"/></div></div></a></div><h2 id="9ad3" class="ns mp iu bd mq oa ob dn mu oc od dp my lj oe of na ln og oh nc lr oi oj ne ok bi translated">羽毛文件格式</h2><p id="52e4" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">feather文件格式是一种快速的、与语言无关的数据帧存储，适用于Python (pandas)和r。</p><p id="9802" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Feather针对低存储空间和高性能进行了优化。这使得它比CSV更难访问。</p><p id="1360" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">虽然CSV可以在任何能够理解文本的机器上运行，但Feather只能在Python和r上运行。我们需要手动安装它。</p><p id="2be3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您使用Python，可以从PyPI存储库中获取它。</p><pre class="kk kl km kn gu nn no np nq aw nr bi"><span id="b5d4" class="ns mp iu no b gz nt nu l nv nw">pip install feather-format</span></pre><p id="3cee" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">r程序员可以使用下面的命令直接从Git库安装Feather。</p><pre class="kk kl km kn gu nn no np nq aw nr bi"><span id="7fa3" class="ns mp iu no b gz nt nu l nv nw">devtools::install_github("wesm/feather/R")</span></pre><p id="a0fa" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">一旦你安装了这个包，对你现有代码库的改变是最小的。</p><p id="c8de" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">使用羽化格式相当简单。</p><p id="8526" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Pandas库内置了羽毛格式的方法。您可以使用<a class="ae kz" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.to_feather.html" rel="noopener ugc nofollow" target="_blank"> to_feather </a>和<a class="ae kz" href="https://pandas.pydata.org/docs/reference/api/pandas.read_feather.html" rel="noopener ugc nofollow" target="_blank"> read_feather </a>在磁盘上保存和加载数据。</p><pre class="kk kl km kn gu nn no np nq aw nr bi"><span id="a437" class="ns mp iu no b gz nt nu l nv nw"># Change this<br/>df = pd.read_csv(...)</span><span id="ec45" class="ns mp iu no b gz ny nu l nv nw"># To this<br/>df = pd.read_feather(...)</span><span id="9b08" class="ns mp iu no b gz ny nu l nv nw"><br/># Change this<br/>df.to_csv(...)</span><span id="b799" class="ns mp iu no b gz ny nu l nv nw">#To this<br/>df.to_feather(...)</span></pre><h2 id="1a35" class="ns mp iu bd mq oa ob dn mu oc od dp my lj oe of na ln og oh nc lr oi oj ne ok bi translated">拼花文件格式</h2><p id="fb88" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">Parquet是另一种二进制文件格式，它比使用文本文件更有优势。</p><p id="94cd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Parquet使用在<a class="ae kz" href="https://research.google/pubs/pub36632/" rel="noopener ugc nofollow" target="_blank"> Dremel论文</a>中描述的记录粉碎和组装算法。它在列存储中高效地表示嵌套结构。</p><p id="a7ee" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因此，处理大量嵌套的查询比基于文本格式的查询执行速度更快。</p><p id="d0d6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">拼花地板的文件大小通常小于文本格式。</p><p id="932e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在熊猫身上使用拼花地板就像羽毛一样简单。</p><pre class="kk kl km kn gu nn no np nq aw nr bi"><span id="67a2" class="ns mp iu no b gz nt nu l nv nw"># Change this<br/>df = pd.read_csv(...)</span><span id="e9af" class="ns mp iu no b gz ny nu l nv nw"># To this<br/>df = pd.read_parquet(...)</span><span id="e9bc" class="ns mp iu no b gz ny nu l nv nw"># Change this<br/>df.to_csv(...)</span><span id="4e93" class="ns mp iu no b gz ny nu l nv nw">#To this<br/>df.to_parquet(...)</span></pre><h1 id="a2c7" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">对存储数据集的不同文件格式进行基准测试</h1><p id="8a55" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">我想亲眼看看。我想测试每种文件格式的各个方面。</p><p id="0af2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">所以我写了一个小剧本。它从公开可用的数据集中获取数据。然后，它从原始文件创建1000个不同的10，000行的文件。为此，脚本在熊猫数据帧上使用随机抽样。</p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/how-to-detect-memory-leakage-in-your-python-application-f83ae1ad897d"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">如何检测Python应用程序中的内存泄漏</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">标准的Python库，可以显示每一行的内存使用和执行时间</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="om l mk ml mm mi mn kt lz"/></div></div></a></div><p id="2e5d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然后，我们记录将所有这些文件写入磁盘所需的时间、磁盘上的文件大小，以及将所有这些文件读回内存所需的时间。</p><p id="f24b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们测量所有文件格式的上述三个值。这是结果。</p><h2 id="31a1" class="ns mp iu bd mq oa ob dn mu oc od dp my lj oe of na ln og oh nc lr oi oj ne ok bi translated">拼花是最小型的文件格式。</h2><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj on"><img src="../Images/9d1ee3e8d10c15b845a4df708457bfba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*cDHzhQSqWVN6vea6wdnrgw.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">不同文件格式的文件大小基准测试—图片由作者<a class="ae kz" href="https://thuwarakesh.medium.com" rel="noopener">提供。</a></p></figure><p id="c6bb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">拼花文件比CSV小得多。它们甚至比羽毛锉还要小。</p><p id="2265" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">另一方面，JSON是在磁盘上存储文件的最差格式。它占用的文件格式空间是CSV的两倍多。</p><p id="06d5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">就文件大小而言，Feather略小，Pickle比CSV占用更多的空间。</p><h2 id="1681" class="ns mp iu bd mq oa ob dn mu oc od dp my lj oe of na ln og oh nc lr oi oj ne ok bi translated">羽毛是读写最快的。</h2><div class="kk kl km kn gu ab cb"><figure class="oo ko op oq or os ot paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><img src="../Images/61f5b121e18448802a76c3d41020b001.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*VgdpqBmb6FynKJ-LXlCRhA.png"/></div></figure><figure class="oo ko op oq or os ot paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><img src="../Images/72c9f46374e5c987280a81781169b30f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*ImwjdopnNluTEuU6DSd0WA.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk ou di ov ow translated">比较不同文件格式存储数据集的文件读/写性能—图片由<a class="ae kz" href="https://thuwarakesh.medium.com" rel="noopener">作者提供。</a></p></figure></div><p id="38d0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">羽毛的阅读表现令人印象深刻。它只需要CSV加载时间的一半。与Feather相比，即使是Pickle文件也要慢得多。</p><p id="f4d5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">同样，JSONs需要花费太多时间加载到内存中，因为它需要很大的磁盘存储空间。</p><p id="225e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">羽毛在写作表现上也远胜CSV。只有泡菜和羽毛的数量相对相似(仍然缓慢)。</p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/python-web-apps-are-a-terrible-idea-for-analytics-projects-36f1bd33e84b"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">Python Web应用对于分析项目来说是一个糟糕的想法。</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">纯Python栈忽略了严重的缺点。以下是如何弥补的方法。</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="ox l mk ml mm mi mn kt lz"/></div></div></a></div><h1 id="22d2" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">最终考虑</h1><p id="f4c2" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">如果你和其他人共享数据，并且你不确定他们是否安装了Python或者任何兼容的软件，那么使用CSV是可以的。</p><p id="5eb8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但在所有其他情况下，CSV会严重伤害你。</p><p id="c4ca" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您的主要目标是以非常低的成本存储数据，请使用Parquet。它占用很少的磁盘空间，其读/写性能令人印象深刻。</p><p id="e052" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您正在使用Python或R，并且读/写性能是您的主要关注点，那么Feather要比CSV和Pickle好得多。它的体积也更小。</p></div><div class="ab cl oy oz hy pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="in io ip iq ir"><blockquote class="pf pg ph"><p id="7518" class="la lb pi lc b ld le jv lf lg lh jy li pj lk ll lm pk lo lp lq pl ls lt lu lv in bi translated">感谢阅读，朋友！在<a class="ae kz" href="https://www.linkedin.com/in/thuwarakesh/" rel="noopener ugc nofollow" target="_blank"><strong class="lc iv">LinkedIn</strong></a><a class="ae kz" href="https://twitter.com/Thuwarakesh" rel="noopener ugc nofollow" target="_blank"><strong class="lc iv">Twitter</strong></a><a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener"><strong class="lc iv">Medium</strong></a>上跟我打招呼。</p><p id="3bfb" class="la lb pi lc b ld le jv lf lg lh jy li pj lk ll lm pk lo lp lq pl ls lt lu lv in bi translated">还不是中等会员？请使用此链接使<a class="ae kz" href="https://thuwarakesh.medium.com/membership" rel="noopener"> <strong class="lc iv">成为</strong> </a>的会员，因为，在不为你额外付费的情况下，我为你引荐赚取一小笔佣金。</p></blockquote></div></div>    
</body>
</html>