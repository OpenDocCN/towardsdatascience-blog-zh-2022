<html>
<head>
<title>How to Deploy Tensorflow Models in C++ in 3 different ways</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何以3种不同的方式在C++中部署张量流模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-deploy-tensorflow-models-in-c-in-3-different-ways-f7e25046be29#2022-02-10">https://towardsdatascience.com/how-to-deploy-tensorflow-models-in-c-in-3-different-ways-f7e25046be29#2022-02-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b659" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这是我过去4年来做这件事的总结</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5a069df0efe1e8c6b9a40a02bf90fef3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R0Kz3KZk6eiVqDvTIcc6lQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者制作</p></figure><h1 id="b055" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">介绍</h1><p id="3dc4" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">在机器学习项目中，有几种方法可以部署您的最终模型。可以是云部署、移动设备上的部署、嵌入式系统上的部署等。</p><p id="cb47" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">为此，根据您在日常工作或项目中使用的技术，您可以利用几种编程语言。</p><p id="d056" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">在我工作的一些公司中，我们需要在C++环境中部署我们的深度学习模型。这些模型主要处理图像分类和目标检测。</p><p id="3ed9" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">我记得大约4年前在stackoverflow上问了一个问题，关于我如何在C++环境中部署tensorflow模型。在这4年的时间里，我只收到了2个答案！</p><p id="8c59" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">那是我第一次开始研究在C++环境中部署tensorflow模型的不同选项。</p><p id="93ab" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">我主要尝试了3个选项，因为它们看起来最有希望:</p><ol class=""><li id="61dc" class="mr ms it ls b lt mm lw mn lz mt md mu mh mv ml mw mx my mz bi translated">使用OpenCV DNN模块部署模型。</li><li id="f5c6" class="mr ms it ls b lt na lw nb lz nc md nd mh ne ml mw mx my mz bi translated">使用Tensorflow C++ API部署模型。</li><li id="563e" class="mr ms it ls b lt na lw nb lz nc md nd mh ne ml mw mx my mz bi translated">使用ONNX运行时部署模型。</li></ol><p id="f314" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">在我告诉你每个选项发生了什么之前，让我问你这个问题。您目前是否想学习如何将Tensorflow用于计算机视觉？如果有，那就来看看我的<a class="ae nf" href="https://aifee.teachable.com/p/introduction-to-tensorflow-2-for-computer-vision" rel="noopener ugc nofollow" target="_blank"> <strong class="ls iu"> <em class="ng">免费tensorflow课程</em> </strong> </a>。</p><p id="2963" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">现在，这里是我上面提到的每一个选项的结果。</p><h1 id="5c0d" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">使用OpenCV DNN模块在C++中部署张量流模型</h1><p id="aeb6" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi">​</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/782cf912bab1fbecdaa843b429903d35.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/0*jqi3QTuBnSCshvYH"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">opencv徽标</p></figure><p id="335d" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">我记得尝试的第一个选项是OpenCV DNN模块。这要追溯到2018年。</p><p id="346d" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">DNN代表深度神经网络，这是OpenCV开发人员推出的一个模块，用于将深度神经网络集成到已经运行OpenCV代码的进程中。</p><p id="f760" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">这被证明是对我们目标的快速修复，但这是一种非常有限的方法，因为这个模块当时还是新的，它为部署深度神经网络提供了有限的选择。</p><p id="dea3" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">例如，我需要部署InceptionV2模型，但是我不能，因为OpenCV DNN模块只支持InceptionV1架构。</p><p id="dc6d" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">DNN模块在最近几年得到了发展，它似乎为分类和对象检测 部署模型提供了更多的灵活性。</p><p id="1118" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">我尝试过的另外两个选项是Tensorflow C++ API和ONNX运行时。</p><h1 id="9df6" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">使用Tensorflow C++ API部署模型</h1><p id="b0d7" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi">​</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/61be84a50381ef260a1d30728716d1fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_oYB1qrmWGk0aKnx"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">tensorflow徽标</p></figure><p id="0a48" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">Tensorflow是使用C++构建的，它提供了一个API，使得在C++中部署模型(甚至训练模型，如果您愿意的话)变得相对容易。这听起来很棒，直到你开始尝试实现一个使用这个API的程序。</p><p id="b46e" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">作为一名开发人员，你知道文档非常重要，但是Tensorflow的C++ API非常非常有限。仅仅通过阅读文档很难找到您想要的信息。</p><p id="e473" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">其次，不支持Windows 32bits。因此，如果你(或你的客户)有这样一个系统，那么你在这里面临一堵墙，最好尝试寻找其他选择。</p><p id="9553" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">但是这个API的伟大之处在于，您不必担心您用Python训练的模型的兼容性，并且您希望使用C++ API来部署它。尤其是在Python和C++中使用相同版本的Tensorflow的情况下。</p><p id="da26" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">我个人已经使用这个API部署了图像分类模型和对象检测模型，除了我上面提到的限制因素之外，这些模型完全按照预期工作。</p><p id="1097" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">在C++中部署Tensorflow模型时，我个人尝试的最后一个选项是ONNX运行时。</p><h1 id="6265" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">使用ONNX运行时部署模型</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/e66f9fc6bb03178f5b6ca421833362d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*W962mPUDYKOvgDR4.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自维基百科</p></figure><p id="172c" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">ONNX代表开放神经网络交换，它是一个完整的生态系统，旨在标准化机器学习模型的表示。它是由微软开发的。</p><p id="9cba" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">ONNX的目标是更容易部署任何类型的机器学习模型，这些模型来自任何类型的ML框架，包括Tensorflow。</p><p id="cd97" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">要在C++中使用ONNX部署Tensorflow模型，您需要做两件事:</p><ol class=""><li id="211a" class="mr ms it ls b lt mm lw mn lz mt md mu mh mv ml mw mx my mz bi translated">将Tensorflow模型转换为ONNX格式。有一个开源工具叫做tf2onnx。</li><li id="7ddc" class="mr ms it ls b lt na lw nb lz nc md nd mh ne ml mw mx my mz bi translated">使用ONNX运行时来部署转换后的模型。</li></ol><p id="f061" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">我亲自在这么多深度学习模型上测试了这种方法，效果非常好。例如，我将tensorflow对象检测API中的几乎所有模型都转换为ONNX格式，并且能够毫无问题地使用它们进行推理。</p><p id="b0e7" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">在一个朋友向我推荐这个工具并看到它的所有功能后，我爱上了它。</p><h1 id="33c0" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">您希望我帮助您构建Python/C++ ML管道吗？</h1><p id="f0e8" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">如果您目前正在尝试构建一个完整的机器学习管道，其中:</p><ul class=""><li id="5d35" class="mr ms it ls b lt mm lw mn lz mt md mu mh mv ml nk mx my mz bi translated">你用Python训练和评估深度学习模型。</li><li id="ef93" class="mr ms it ls b lt na lw nb lz nc md nd mh ne ml nk mx my mz bi translated">用C++部署这些模型。</li><li id="76ab" class="mr ms it ls b lt na lw nb lz nc md nd mh ne ml nk mx my mz bi translated">你的模型仅仅基于计算机视觉(图像识别、物体检测、实例分割、语义分割等等)。</li></ul><p id="d6f1" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">然后随时联系我，在<a class="ae nf" href="https://www.linkedin.com/in/nour-islam-mokhtari-07b521a5/" rel="noopener ugc nofollow" target="_blank"><strong class="ls iu">LinkedIn</strong>T5】或</a><a class="ae nf" href="https://twitter.com/NourIslamMo" rel="noopener ugc nofollow" target="_blank"><strong class="ls iu">Twitter</strong></a><strong class="ls iu"/>或通过电子邮件<strong class="ls iu">(nourislam.mokhtari@gmail.com)</strong>。我将帮助您在短时间内设置管道，并提供符合您要求的选择！</p><h1 id="c0c2" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">关于作者</h1><p id="3db0" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">我是一名机器学习工程师，致力于解决具有挑战性的计算机视觉问题。在<a class="ae nf" href="https://www.linkedin.com/in/nour-islam-mokhtari-07b521a5/" rel="noopener ugc nofollow" target="_blank"> <strong class="ls iu"> LinkedIn </strong> </a>和<a class="ae nf" href="https://twitter.com/NourIslamMo" rel="noopener ugc nofollow" target="_blank"> <strong class="ls iu"> Twitter </strong> </a> <strong class="ls iu"> </strong>上关注我的每日内容。此外，通过加入我的<a class="ae nf" href="https://nourislam.ck.page/dc3e8b7e12" rel="noopener ugc nofollow" target="_blank"> <strong class="ls iu">时事通讯</strong> </a> <strong class="ls iu">，让这样的文章直接进入你的收件箱。</strong></p></div></div>    
</body>
</html>