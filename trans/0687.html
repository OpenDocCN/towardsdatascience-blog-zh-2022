<html>
<head>
<title>Data Augmentation in NLP Using Back Translation With MarianMT</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于反向翻译和 MarianMT 的自然语言处理数据增强</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-augmentation-in-nlp-using-back-translation-with-marianmt-a8939dfea50a#2022-02-28">https://towardsdatascience.com/data-augmentation-in-nlp-using-back-translation-with-marianmt-a8939dfea50a#2022-02-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="041f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用拥抱面部变形金刚的神经机器翻译框架增加你的训练数据的大小</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/65e05c6a95574fe1a69db4b67acb8d1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AXPOhRRzchja-u1VXtOcWA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">文章标题(作者图片)</p></figure><h1 id="efae" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">介绍</h1><p id="15dc" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">获得准确的模型不是一条简单的道路。事实上，已经确定了不同的方法来帮助改善模型的性能，其中一种方法是获得更多高质量的数据，这确实不是一个容易的过程。在本文中，我们将探讨数据扩充，这是一种从原始数据中创建新数据的方法。</p><p id="7433" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">存在不同的技术，但是我们将通过理解它如何工作和实现它来关注<code class="fe mr ms mt mu b"><strong class="ls iu">back translation</strong></code>这一个。</p><h1 id="4d7b" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">什么是反向翻译——为什么是马里亚姆特？</h1><p id="020f" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">本节的目标是理解反向翻译的概念，并弄清楚<a class="ae mv" href="https://huggingface.co/docs/transformers/model_doc/marian" rel="noopener ugc nofollow" target="_blank">玛丽安娜特</a>如何有用。</p><h2 id="4433" class="mw kz it bd la mx my dn le mz na dp li lz nb nc lk md nd ne lm mh nf ng lo nh bi translated">回译</h2><p id="4f9b" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">反向翻译的概念很简单，由三个主要步骤组成。</p><ol class=""><li id="b1a0" class="ni nj it ls b lt mm lw mn lz nk md nl mh nm ml nn no np nq bi translated"><strong class="ls iu">临时翻译</strong>:将每个原始的训练标注数据翻译成不同的语言。在我们的例子中，是从英语到法语。</li><li id="ac5d" class="ni nj it ls b lt nr lw ns lz nt md nu mh nv ml nn no np nq bi translated"><strong class="ls iu">反向翻译</strong>:将这些翻译后的数据翻译回原始语言，也就是从法语翻译成英语。</li><li id="8b52" class="ni nj it ls b lt nr lw ns lz nt md nu mh nv ml nn no np nq bi translated"><strong class="ls iu">去重</strong>:在这个过程的最后，我们将会得到每一个原始文本数据对应的回译。这里的目标是让每个副本只出现一次。</li></ol><h2 id="451b" class="mw kz it bd la mx my dn le mz na dp li lz nb nc lk md nd ne lm mh nf ng lo nh bi translated">玛丽安山</h2><p id="fc42" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">如前一节的前两步所述，这是用于将原文翻译成目标语言的框架，反之亦然。</p><p id="182d" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">MariamMT 是一个高效的机器翻译框架。它使用了引擎盖下的<a class="ae mv" href="https://marian-nmt.github.io/" rel="noopener ugc nofollow" target="_blank"> MarianNMT </a>引擎，这是由微软和许多学术机构如爱丁堡大学、波兹南的 Adam Mickiewicz 大学纯粹用 C++开发的。同样的引擎目前也在微软翻译服务的背后。</p><p id="2dcb" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">赫尔辛基大学的 NLP 小组在拥抱脸变形金刚上开源了多种翻译模型。MarianMT 是之前使用 Marian 在 Opus 收集的平行数据上训练的那些模型之一。</p><h1 id="1c08" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">反向翻译的实施</h1><p id="1127" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">在开始实现之前，理解以下先决条件是很重要的。</p><p id="889d" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">如果您喜欢视频，可以观看本文的视频演示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><h2 id="9125" class="mw kz it bd la mx my dn le mz na dp li lz nb nc lk md nd ne lm mh nf ng lo nh bi translated">先决条件和助手函数</h2><p id="90b7" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">本节的目标是安装、导入所有的库，设置所有的候选模型，并实现实验所需的辅助函数。</p><p id="a58f" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated"><strong class="ls iu">有用的库</strong></p><p id="0694" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">总共有两个重要的库</p><ul class=""><li id="4fac" class="ni nj it ls b lt mm lw mn lz nk md nl mh nm ml ny no np nq bi translated"><code class="fe mr ms mt mu b">transformers</code>为了使用 MarianMTModel 和 MarianTokenizer</li><li id="8450" class="ni nj it ls b lt nr lw ns lz nt md nu mh nv ml ny no np nq bi translated"><code class="fe mr ms mt mu b">sentencepiece</code>Marian mt 工作所需。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae mv" href="https://gist.github.com/keitazoumana/31dc2b0c4c5417f9d4e22909dbc0aa1f#file-marianmt_prerequisites-py" rel="noopener ugc nofollow" target="_blank">Marian mt _ prerequisites . py</a></p></figure><p id="ba50" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated"><strong class="ls iu">注意</strong>:安装完这些库后，请务必重启笔记本，以便所有更改生效。</p><p id="9c13" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated"><strong class="ls iu">候选车型</strong></p><p id="d63a" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">《拥抱脸》中的所有模特名字都使用以下格式<code class="fe mr ms mt mu b">Helsinki-NLP/opus-mt-{src}-{tgt}</code>，其中<code class="fe mr ms mt mu b">{src}</code>和<code class="fe mr ms mt mu b">{tgt}</code>分别对应源语言和目标语言。它们的值是代表语言的两位数代码。你可以在这里找到语言代码列表。对于我们的例子，我们将有两个候选模型。</p><p id="ef2c" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">每个模型的配置需要两个主要的类，<code class="fe mr ms mt mu b">MarianTokenizer </code>用于加载正确的标记器，<code class="fe mr ms mt mu b">MarianMTModel</code>用于加载预训练的模型。</p><ul class=""><li id="3f03" class="ni nj it ls b lt mm lw mn lz nk md nl mh nm ml ny no np nq bi translated"><code class="fe mr ms mt mu b">Helsinki-NLP/opus-mt-en-fr</code> <strong class="ls iu">第一个将法语翻译成英语的模型</strong>。</li><li id="b366" class="ni nj it ls b lt nr lw ns lz nt md nu mh nv ml ny no np nq bi translated"><code class="fe mr ms mt mu b">Helsinki-NLP/opus-mt-en-fr</code>、<strong class="ls iu">、</strong>第一个将英语翻译成法语的模式。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">marianMT_first_model.py</p></figure><ul class=""><li id="8871" class="ni nj it ls b lt mm lw mn lz nk md nl mh nm ml ny no np nq bi translated"><code class="fe mr ms mt mu b">Helsinki-NLP/opus-mt-fr-en</code> <strong class="ls iu">，</strong> <strong class="ls iu">第二种模式</strong>将法语翻译成英语。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">marianMT_second_model.py</p></figure><p id="40f6" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">现在我们已经完成了两个模型的配置，我们可以继续实现反向翻译特性了。</p><p id="4e87" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">下面是将用于执行翻译的文本列表。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">back_trans_texts.py</p></figure><p id="7bdd" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">但是，为了能够正确地实现翻译特性，我们需要在每个需要翻译的文本前面添加特殊的标记<code class="fe mr ms mt mu b">&gt;&gt;{tgt}&lt;&lt;</code> <strong class="ls iu"> </strong>。记住<code class="fe mr ms mt mu b">{tgt}</code> <strong class="ls iu"> </strong>不是<strong class="ls iu"> fr </strong>就是<strong class="ls iu"> en </strong>。对于我们之前的列表，它看起来像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">back_trans_formated_texts.py</p></figure><p id="e1ab" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">下面是完成这样一个任务的 helper 函数。它将原始文本作为输入，并在每个文本的开头添加特殊标记，如前所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">marianMT_format_texts.py</p></figure><p id="ab65" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">下面是我们执行函数后得到的结果。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">测试 _ 批处理 _ 格式化. py</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/3b459aaac5381a8971b94beddc635229.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sW_1Lfcjc-7P0Z78Jh7HmQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带有特殊标记的格式化文本(图片由作者提供)</p></figure><p id="5320" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">我们可以继续执行负责翻译该批文本的功能。它将待翻译的文本批次、目标语言模型和语言代码作为参数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">marian_perform_translation.py</p></figure><p id="0292" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">这是由第<strong class="ls iu"> 14 </strong>和第<strong class="ls iu"> 15 </strong>行生成的从英语到法语的翻译结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/4de7ceb187a569e3cd2391df5c8eddec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5xS92c5fkdXJT_Itex6otw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从英语到法语的翻译(图片由作者提供)</p></figure><p id="2db8" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">完全相同的函数<code class="fe mr ms mt mu b">perform_translation</code>可用于将之前的结果(法语)翻译回英语。我们只需要提供正确的参数，对应第二个模型的信息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">translate_back_fr_to_en.py</p></figure><p id="11c2" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">这是从英语翻译成法语的结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/d9c054c724078f5db5b52c480ce81b57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qAWHy_KjJa-d1anXnSS1GQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">反向翻译从法语到英语(图片作者)</p></figure><p id="e901" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated"><strong class="ls iu">我做了反向翻译，那又怎样？</strong></p><p id="129f" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">这里发生了一些有趣的事情。从反向翻译的结果可以看出，第三个文本的翻译和原文的完全一样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/f960955937937f8fc72e7ca356487b47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IBHKzv72eCKMuOjIqi9ETQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">原文及其回译(图片由作者提供)</p></figure><p id="52e5" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">这里是重复抑制功能出现的地方。它将两个列表(原始文本)作为参数，然后它们的反向翻译通过只保留重复文本的一次出现来组合它们。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">marian_combine_two_lists.py</p></figure><p id="a42a" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated"><strong class="ls iu">最终增强功能</strong></p><p id="c9f4" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">我们可以将前面所有的辅助函数组合起来，创建一个返回扩充文本的函数，对应于原始文本和它们的反向翻译。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">marian_augmentation.py</p></figure><p id="4a0c" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">下面你可以看到相应于原始文本的增强的最终结果。我们将文本从 4 个增加到 7 个，相当于增加了 70%,这在大数据规模下是非常显著的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/50677bdfbb09eafb81cbd6ebdcec2a3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eyARowHXvyorH7gJ3YhVJw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">原始文本和最终增强文本(图片由作者提供)</p></figure><h1 id="9d1b" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">结论</h1><p id="9799" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">恭喜你！🎉 🍾你刚刚学会了如何增加你的原始训练数据。我希望您喜欢阅读这篇文章，并且它给了您提高模型性能所需的技能。请在下面找到更多资源来帮助您进一步学习。</p><p id="b3d0" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">欢迎在 LinkedIn 上添加我，或者在 Twitter 和 YouTube<a class="ae mv" href="https://www.youtube.com/channel/UC9xKdy8cz6ZuJU5FTNtM_pQ" rel="noopener ugc nofollow" target="_blank">上关注我。讨论人工智能，人工智能，数据科学，自然语言处理的东西总是令人愉快的！</a></p><p id="b3e8" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated"><a class="ae mv" href="https://github.com/keitazoumana/NLP-Data-Augmentation/blob/main/Data_Augmentation_in_NLP_Using_Back_Translation.ipynb" rel="noopener ugc nofollow" target="_blank">Github 上文章的源代码</a></p><p id="14f2" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated"><a class="ae mv" href="https://huggingface.co/docs/transformers/model_doc/marian" rel="noopener ugc nofollow" target="_blank"> MarianMT 关于拥抱脸的文档</a></p><p id="826c" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated"><a class="ae mv" href="https://marian-nmt.github.io/" rel="noopener ugc nofollow" target="_blank"> MarianNMT 文档</a></p><p id="952c" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">再见🏃🏾</p></div></div>    
</body>
</html>