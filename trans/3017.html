<html>
<head>
<title>Exploring the Filter Context with DAX functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用DAX函数探索过滤器上下文</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/exploring-the-filter-context-with-dax-functions-422211c1118e#2022-07-01">https://towardsdatascience.com/exploring-the-filter-context-with-dax-functions-422211c1118e#2022-07-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f582" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在查看当前过滤器上下文时，您可以在DAX中找到几个有用的函数。以下是这些功能的一些例子</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/2e52db1d1e108faf38266bbb69add86e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7o8THK1oGwa2hisW"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@berko?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">冉贝尔科维奇</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><h1 id="bbf6" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">我们将研究哪些DAX函数？</h1><p id="f89f" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">有几个DAX函数可以查看当前的过滤器上下文。</p><p id="b0a6" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在本文中，我们将研究以下函数(按字母顺序排列):</p><ul class=""><li id="7145" class="mt mu it lu b lv mo ly mp mb mv mf mw mj mx mn my mz na nb bi translated">全部选定</li><li id="4571" class="mt mu it lu b lv nc ly nd mb ne mf nf mj ng mn my mz na nb bi translated">过滤</li><li id="c0e0" class="mt mu it lu b lv nc ly nd mb ne mf nf mj ng mn my mz na nb bi translated">HASONEFILTER</li><li id="0420" class="mt mu it lu b lv nc ly nd mb ne mf nf mj ng mn my mz na nb bi translated">HASONEVALUE</li><li id="280e" class="mt mu it lu b lv nc ly nd mb ne mf nf mj ng mn my mz na nb bi translated">ISCROSSFILTERED</li><li id="99f4" class="mt mu it lu b lv nc ly nd mb ne mf nf mj ng mn my mz na nb bi translated">被过滤</li><li id="7e27" class="mt mu it lu b lv nc ly nd mb ne mf nf mj ng mn my mz na nb bi translated">ISINSCOPE</li><li id="9281" class="mt mu it lu b lv nc ly nd mb ne mf nf mj ng mn my mz na nb bi translated">选定值</li></ul><p id="2154" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我将提供一个链接，链接到DAX Guide 上的相应文章，以及关于如何使用它们以及它们如何相互比较的每个函数的例子。</p><h1 id="d8ec" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">什么是过滤器上下文？</h1><p id="696e" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">如果你已经知道过滤器的内容，请跳到下一章。</p><p id="6137" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">一句话:</p><p id="b024" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated"><em class="nh">过滤器上下文是影响计算结果的所有过滤器的总和</em></p><p id="c85b" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在下图中，您可以看到标记单元格上的筛选器上下文由以下值组成:</p><ul class=""><li id="acf1" class="mt mu it lu b lv mo ly mp mb mv mf mw mj mx mn my mz na nb bi translated">制造商= Contoso有限公司和Fabrikam公司</li><li id="efae" class="mt mu it lu b lv nc ly nd mb ne mf nf mj ng mn my mz na nb bi translated">国家=美国</li><li id="e41c" class="mt mu it lu b lv nc ly nd mb ne mf nf mj ng mn my mz na nb bi translated">年份= 2008年</li><li id="256f" class="mt mu it lu b lv nc ly nd mb ne mf nf mj ng mn my mz na nb bi translated">类别=计算机</li><li id="b958" class="mt mu it lu b lv nc ly nd mb ne mf nf mj ng mn my mz na nb bi translated">月份=六月</li></ul><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ni"><img src="../Images/b5b7b63d92213ac49225aaa322feb123.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qgmY1FwKhLBCu_yc9u6uVg.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图1 —过滤上下文(作者提供的图片)</p></figure><p id="697e" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在浏览过滤器上下文时，您希望检查过滤器是否存在，以及过滤器在一列上的内容是什么。</p><p id="ba4d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这就是这里提到的函数的用途。</p><h1 id="2dad" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">基本查询</h1><p id="31a3" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">对于本文，我将在Contoso数据模型上使用以下DAX-Query:</p><pre class="kk kl km kn gt nj nk nl nm aw nn bi"><span id="b0c9" class="no lb it nk b gy np nq l nr ns">DEFINE<br/> VAR FilterTable = <br/>      TREATAS({2008}, ‘Date’[Year])<br/> <br/>EVALUATE<br/>  CALCULATETABLE(<br/>    FILTER(<br/>      ADDCOLUMNS(<br/>         SUMMARIZECOLUMNS(‘Geography’[Region Country]<br/>                          ,’Geography’[City]<br/>                          ,’Store’[Store])<br/>                          ,”Online Sales (By Order Date)”<br/>                                ,[Online Sales (By Order Date)]<br/>                  )<br/>              ,NOT ISBLANK([Online Sales (By Order Date)])<br/>            )<br/>            ,FilterTable<br/>          )<br/> <br/>ORDER BY<br/> ‘Geography’[Region Country],<br/> ‘Geography’[City],<br/> ‘Store’[Store]</span></pre><p id="76d2" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">下图显示了DAX Studio中该查询的结果:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/7d0eb4aad9f430f64199f2db586ed511.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*JCyd5WcqENWAcZEp-cZDIw.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图2 —基本查询的结果(作者提供的图)</p></figure><h1 id="4bdc" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">全部选定</h1><p id="f6df" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated"><a class="ae kz" href="https://dax.guide/allselected/" rel="noopener ugc nofollow" target="_blank"> ALLSELECTED() </a>用于获取列中所有值的列表，同时考虑所有外部过滤器，但不考虑查询中现有的过滤器。</p><p id="2b50" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在，我向基本查询添加两个度量:</p><pre class="kk kl km kn gt nj nk nl nm aw nn bi"><span id="0221" class="no lb it nk b gy np nq l nr ns">[CountOfCountries] = COUNTROWS(<br/>                          ALLSELECTED(<br/>                                ‘Geography’[Region Country]<br/>                                )<br/>                             )</span></pre><p id="64ef" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">和</p><pre class="kk kl km kn gt nj nk nl nm aw nn bi"><span id="c020" class="no lb it nk b gy np nq l nr ns">[CountOfYears] = COUNTROWS(ALLSELECTED(‘Date’[Year]))</span></pre><p id="f025" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">通过这两个度量，我可以计算ALLSELECTED()为每一列返回多少行。</p><p id="f1b5" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">请记住:</p><ul class=""><li id="1d1d" class="mt mu it lu b lv mo ly mp mb mv mf mw mj mx mn my mz na nb bi translated">结果中的每一行都有一个国家</li><li id="7d50" class="mt mu it lu b lv nc ly nd mb ne mf nf mj ng mn my mz na nb bi translated">使用FilterTable变量过滤年份</li></ul><p id="088e" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">下面是修改后的查询(ORDER BY被省略):</p><pre class="kk kl km kn gt nj nk nl nm aw nn bi"><span id="d603" class="no lb it nk b gy np nq l nr ns">DEFINE<br/> MEASURE ‘All Measures’[CountOfCountries] =<br/>                        COUNTROWS(<br/>                            ALLSELECTED(<br/>                                  ‘Geography’[Region Country]<br/>                                  )<br/>                                )<br/> <br/> MEASURE ‘All Measures’[CountOfYears] =<br/>                       COUNTROWS(ALLSELECTED(‘Date’[Year]))<br/> <br/> VAR FilterTable = <br/>    TREATAS({2008}, ‘Date’[Year])<br/> <br/>EVALUATE<br/>  CALCULATETABLE(<br/>    FILTER(<br/>      ADDCOLUMNS(<br/>         SUMMARIZECOLUMNS(‘Geography’[Region Country]<br/>                          ,’Geography’[City]<br/>                          ,’Store’[Store]<br/>                      )<br/>                      ,”Online Sales (By Order Date)”<br/>                          ,[Online Sales (By Order Date)]<br/>                      ,”CountOfCountries”<br/>                          ,[CountOfCountries]<br/>                      ,”CountOfYears”<br/>                          ,[CountOfYears]<br/>                    )<br/>               ,NOT ISBLANK([Online Sales (By Order Date)]<br/>               )<br/>           )<br/>           ,FilterTable<br/>)</span></pre><p id="341f" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">该查询返回以下结果:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nu"><img src="../Images/093df20db9fe7a55090f5d341bfcc433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dg7jIinT39fQRbzVyRCasQ.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图ALLSELECTED()的查询结果(作者提供的图)</p></figure><p id="5d72" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">为什么我们会看到这样的结果？</p><p id="ccad" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">该查询选择一年，每行只有一个国家。</p><p id="82db" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这个问题的关键是在线<a class="ae kz" href="docs.microsoft.com/en-us/dax/allselected-function-dax" rel="noopener ugc nofollow" target="_blank">文档</a>中的这句话:</p><p id="6c13" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">ALLSELECTED()从当前查询的列和行中删除上下文过滤器，同时保留所有其他上下文过滤器或显式过滤器。</p><p id="e118" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">因此，ALLSELECTED()返回34个国家，认为Region Country列上的实际筛选上下文是内部的。但是查询只返回一年，因为这一年的筛选器被视为“外部”筛选器。</p><p id="7131" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">让我们尝试一些不同的东西。</p><p id="537d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">请看下面的查询:</p><pre class="kk kl km kn gt nj nk nl nm aw nn bi"><span id="9614" class="no lb it nk b gy np nq l nr ns">DEFINE<br/> MEASURE ‘All Measures’[CountOfCountries] =<br/>                        COUNTROWS(<br/>                           ALLSELECTED(‘Geography’[Region Country]<br/>                           )<br/>                         )<br/> <br/> MEASURE ‘All Measures’[CountOfYears] =<br/>                        COUNTROWS(ALLSELECTED(‘Date’[Year]))<br/> <br/> VAR FilterTable =<br/>          TREATAS({2008}, ‘Date’[Year])<br/> <br/>EVALUATE<br/>  FILTER(<br/>    ADDCOLUMNS(<br/>       CALCULATETABLE(<br/>                  SUMMARIZECOLUMNS(‘Geography’[Region Country]<br/>                                   ,’Geography’[City]<br/>                                   ,’Store’[Store]<br/>                                   )<br/>                       ,FilterTable<br/>                   )<br/>                   ,”Online Sales (By Order Date)”<br/>                         ,[Online Sales (By Order Date)]<br/>                   ,”CountOfCountries”<br/>                         ,[CountOfCountries]<br/>                   ,”CountOfYears”<br/>                         ,[CountOfYears]<br/>                  )<br/>        ,NOT ISBLANK([Online Sales (By Order Date)])<br/>        )</span></pre><p id="35cc" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在，我更改了将年份过滤器添加到<a class="ae kz" href="https://dax.guide/calculatetable/" rel="noopener ugc nofollow" target="_blank"> CALCULATETABLE() </a>中的过滤器上下文的顺序，用<a class="ae kz" href="https://dax.guide/filter/" rel="noopener ugc nofollow" target="_blank"> FILTER() </a>括起来。</p><p id="4de3" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在看看结果:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nv"><img src="../Images/41ba517631fdce83dc96a662ede04eb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zT7GXvytu6pWEBDAEkKJjw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图4 —用ALLSELECTED()进行第二次查询的结果(图由作者提供)</p></figure><p id="daa3" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">为什么我们现在看到的是六年而不是一年？</p><p id="d60a" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我们必须看这两个度量在哪里被评估。</p><p id="3c76" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">两者都在CALCULATETABLE()函数中进行计算。</p><p id="ae33" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">因此，ALLSELECTED()将由CALCULATETABLE()注入的筛选器视为内部筛选器并将其移除。因此，CountOfYears度量值返回6。</p><p id="d8cb" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">当使用ALLSELECTED()时，我们必须了解这个函数是如何工作的，以及它是如何操作过滤器上下文来返回结果的。</p><h1 id="bdd8" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">过滤</h1><p id="5aba" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated"><a class="ae kz" href="https://dax.guide/filters/" rel="noopener ugc nofollow" target="_blank"> FILTERS() </a>函数返回一个表，其中包含当前过滤器上下文中指定列的过滤值。</p><p id="48a5" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我在基本查询中添加了一个新的度量[过滤的国家]:</p><pre class="kk kl km kn gt nj nk nl nm aw nn bi"><span id="c118" class="no lb it nk b gy np nq l nr ns">DEFINE<br/> MEASURE ‘All Measures’[Filtered Country] =<br/>                      FILTERS(‘Geography’[Region Country])</span><span id="3cd6" class="no lb it nk b gy nw nq l nr ns">— Parts omitted —</span><span id="4369" class="no lb it nk b gy nw nq l nr ns">EVALUATE<br/> CALCULATETABLE(<br/>     FILTER(<br/>         ADDCOLUMNS(<br/>             SUMMARIZECOLUMNS(‘Geography’[Region Country]<br/>                              ,’Geography’[City]<br/>                              ,’Store’[Store])<br/>                              ,”Online Sales (By Order Date)”<br/>                                    ,[Online Sales (By Order Date)]<br/>                              ,”Filtered Country”<br/>                                    ,[Filtered Country]<br/>                              )<br/>                      ,NOT ISBLANK([Online Sales (By Order Date)]<br/>                     )<br/>             )<br/>             ,FilterTable<br/>             )</span></pre><p id="9553" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">以下是查询的结果:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nx"><img src="../Images/f6c02cbdf8af40675fc78b897533b0a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h-3dH4ym3o8xJG7BK5181Q.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图5 —使用过滤器()的查询结果(由作者提供)</p></figure><p id="5b7f" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在，让我们看看在查询中添加以下度量时会发生什么:</p><pre class="kk kl km kn gt nj nk nl nm aw nn bi"><span id="4c9e" class="no lb it nk b gy np nq l nr ns">[Filtered Months] = FILTERS(‘Date’[EnglishMonthName])</span></pre><p id="39f3" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在这种情况下，我们会收到一条错误消息，指出在需要单个值的地方提供了一个包含多个值的表。</p><p id="2430" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">为什么？</p><p id="4936" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">因为我们只从日期表中筛选年，所以筛选器检测12个月，按年筛选。出于这个原因，我们从FILTERS()中得到一个有12行的表。</p><p id="e0ec" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">当我们将测量值更改为以下值时:</p><pre class="kk kl km kn gt nj nk nl nm aw nn bi"><span id="4707" class="no lb it nk b gy np nq l nr ns">MEASURE ‘All Measures’[Filtered Months] =<br/>   CONCATENATEX(<br/>          FILTERS(‘Date’[EnglishMonthName])<br/>          , ‘Date’[EnglishMonthName]<br/>          , ”, “<br/>          )</span></pre><p id="4ad5" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我们得到所有过滤月份的列表:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ny"><img src="../Images/8c53eaeabd4ca6b0b98389957f66ada4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cvp0dYtqpYv3Pof3BMTP8g.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图6 —使用过滤器()的第二个查询的结果(由作者提供)</p></figure><p id="41d9" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">FILTERS()函数比ALLSELECTED()简单得多，因为它使用当前的过滤器上下文，我们不必考虑内部和外部过滤器。</p><h1 id="d407" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">HASONEFILTER</h1><p id="0080" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated"><a class="ae kz" href="https://dax.guide/hasonefilter/" rel="noopener ugc nofollow" target="_blank"> HASONEFILTER() </a>函数只返回TRUE或FALSE。</p><p id="0fc8" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">只要当前筛选器上下文只为一列返回一个筛选器，该函数就返回TRUE。</p><p id="513d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">让我们更改带有过滤器()的示例中的度量，以检查它是如何工作的:</p><pre class="kk kl km kn gt nj nk nl nm aw nn bi"><span id="8606" class="no lb it nk b gy np nq l nr ns">MEASURE ‘All Measures’[Filtered Country] =<br/>   HASONEFILTER(‘Geography’[Region Country])<br/> <br/>MEASURE ‘All Measures’[Filtered Months] =<br/>   HASONEFILTER(‘Date’[EnglishMonthName])</span></pre><p id="7051" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">您可以在下图中看到这两种测量的结果:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nz"><img src="../Images/a8dfa4a4ce263e26492cc981d96de023.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JfM_0SayTAfuU83_e5EBdw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图7 —使用HASONEFILTER()查询的结果(作者提供的图)</p></figure><p id="f9e8" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">虽然列“Geography”[Region Country]在实际的筛选器上下文中只有一个筛选器，但HASONEFILTER()返回TRUE。但是，由于列“Date”[EnglishMonthName]在查询时不包含过滤器，因此结果为FALSE。</p><p id="5e6a" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">让我们看另一个例子:</p><p id="8ab5" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我将该年的筛选器更改为以下内容:</p><pre class="kk kl km kn gt nj nk nl nm aw nn bi"><span id="34ed" class="no lb it nk b gy np nq l nr ns">VAR FilterTable = <br/> TREATAS({2007, 2008}, ‘Date’[Year])</span></pre><p id="72f5" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">并在Year列上添加一个带有HASONEFILTER()的度量值。</p><p id="0c54" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">结果看起来像这样:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oa"><img src="../Images/1b71228ff9dec8f4f913867e9615935e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YiCpyYso2005Bov-JzzfsA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图8 —使用HASONEFILTER进行第二次查询的结果(作者提供的图)</p></figure><p id="394b" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">由于我们在year列上引入了第二个过滤器，HASONEFILTER()返回FALSE。</p><h1 id="500f" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">HASONEVALUE</h1><p id="38d5" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">当我们用HASONEVALUE()替换HASONEFILTER()时，会得到相同的结果。但是功能不同。</p><p id="0566" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">当HASONEFILTER()检查过滤器是否存在时，HASONEVALUE()计算当前过滤器上下文中某一列的可用值。</p><p id="d761" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我写过一篇关于如何使用HASONEVALUE()的真实场景的文章:</p><div class="ob oc gp gr od oe"><a rel="noopener follow" target="_blank" href="/dynamic-time-intelligence-in-dax-made-easy-640b4e531ca8"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">DAX中的动态时间智能变得简单</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">什么是，当您必须创建一个动态时间智能度量来返回不同的值，取决于…</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">towardsdatascience.com</p></div></div><div class="on l"><div class="oo l op oq or on os kt oe"/></div></div></a></div><h1 id="dd7c" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">ISCROSSFILTERED</h1><p id="06a9" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">对我来说，<a class="ae kz" href="https://dax.guide/iscrossfiltered/" rel="noopener ugc nofollow" target="_blank"> ISCROSSFILTERED() </a>是所有DAX函数中不太直观的一个。</p><p id="6765" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">如果指定的列或表是直接筛选的、由同一表中的另一列筛选的或由应用于相关表的筛选器筛选的，则ISCROSSFILTERED()返回TRUE。</p><p id="f0e8" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">当我们用ISCROSSFILTERED()替换前面查询中的HASONEVALUE()时，我们得到以下结果:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ot"><img src="../Images/f58e22a1e25243b6b28f674931c73022.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YXzWhYk2sURn04lFNJixTQ.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图9 —用ISCROSSFILTERED()查询的结果(作者提供的图)</p></figure><p id="7d55" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这三个度量值都返回TRUE。</p><p id="5c93" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">原因是在查询中直接筛选了“年份”和“地区国家”列。但是“月”列是通过“年”列上的筛选器交叉筛选的。</p><p id="5945" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">阿尔贝托·法拉利在<a class="ae kz" href="https://dax.guide" rel="noopener ugc nofollow" target="_blank"> https://dax.guide </a>的视频中做了很好的解释。</p><p id="809f" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">推荐看视频了解ISCROSSFILTERED()的工作原理。</p><h1 id="f246" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">被过滤</h1><p id="8cb1" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated"><a class="ae kz" href="https://dax.guide/isfiltered/" rel="noopener ugc nofollow" target="_blank"> ISFILTERED() </a>函数类似于ISCROSSFILTERED()函数，但它仅在直接筛选列或表时返回TRUE。</p><p id="d061" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">当我们用ISFILTERED()替换ISCROSSFILTERED()时，结果如下:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ou"><img src="../Images/69522f6389140d5710a5b450f13b6c69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fiz6aTEksz3vC63WCp2bDA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图10 —使用ISFILTERED()的查询结果(作者提供的图)</p></figure><p id="6edf" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">ISCROSSFILTERED()与ISFILTERED()的区别在于，仅当给定的列或表被直接筛选时，is filtered()才返回true。</p><p id="f459" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">由于Month列上没有显式筛选器，ISFILTERED()返回FALSE。</p><h1 id="6625" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">ISINSCOPE</h1><p id="8db1" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">您可以使用<a class="ae kz" href="https://dax.guide/isinscope/" rel="noopener ugc nofollow" target="_blank"> ISINSCOPE() </a>函数来检查和导航DAX中的层次结构，即使DAX没有层次结构的概念。</p><p id="2e4f" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">该函数使用一个技巧来确定层次结构在当前过滤器上下文中是否是活动的:</p><p id="ba1a" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">1.该函数检查指定列是否只有一个值</p><p id="3157" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">2.然后，它检查另一列中是否存在过滤器</p><p id="a082" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">ISINSCOPE()主要与<a class="ae kz" href="dax.guide/summarizecolumns/" rel="noopener ugc nofollow" target="_blank">summary zecolumns()</a>函数一起工作。</p><p id="5160" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">例如，当给定的列由SUMMARIZECOLUMNS()汇总时，ISINSCOPE()返回true。</p><p id="6cce" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我将基本查询更改为以下查询:</p><pre class="kk kl km kn gt nj nk nl nm aw nn bi"><span id="626d" class="no lb it nk b gy np nq l nr ns">DEFINE<br/> MEASURE ‘All Measures’[ISINSCOPE Country] =<br/>                             ISINSCOPE(‘Geography’[Region Country])<br/> <br/> MEASURE ‘All Measures’[ISINSCOPE City] = <br/>                             ISINSCOPE(‘Geography’[City])<br/> <br/> MEASURE ‘All Measures’[ISINSCOPE Months] =<br/>                             ISINSCOPE(‘Date’[EnglishMonthName])<br/> <br/> MEASURE ‘All Measures’[ISINSCOPE Years] =<br/>                             ISINSCOPE(‘Date’[Year])<br/> <br/> VAR FilterTable = <br/> TREATAS({2008}, ‘Date’[Year])<br/> <br/> EVALUATE<br/> CALCULATETABLE(<br/>   FILTER(<br/>     ADDCOLUMNS(<br/>       SUMMARIZECOLUMNS(‘Geography’[Region Country]<br/>                        ,’Geography’[City]<br/>                        ,’Store’[Store])<br/>                        ,”Online Sales (By Order Date)”<br/>                                 ,[Online Sales (By Order Date)]<br/>                        ,”ISINSCOPE Years”, [ISINSCOPE Years]<br/>                        ,”ISINSCOPE Months”, [ISINSCOPE Months]<br/>                        ,”ISINSCOPE Country”, [ISINSCOPE Country]<br/>                        ,”ISINSCOPE City”, [ISINSCOPE City]<br/>                        )<br/>                 ,NOT ISBLANK([Online Sales (By Order Date)])<br/>            )<br/>           ,FilterTable<br/>      )</span></pre><p id="1274" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">该查询的结果如下:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ov"><img src="../Images/b40a8f6f36ed92c0e7f2266a492d4711.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8usj0_wTF4VMyLuPt2BKDQ.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图11 —用ISINSCOPE()查询的结果(由作者提供)</p></figure><p id="22db" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">因为年份和月份不是按SUMMARIZECOLUMNS()分组的，所以ISINSCOPE返回FALSE，</p><p id="58ce" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">而且，由于Region Country和City是按SUMMARIZCOLUMN()分组的，因此ISINSCOPE对这两列返回TRUE。</p><p id="564c" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">至于ISCROSSFILTERED()，我推荐看一下<a class="ae kz" href="https://dax.guide" rel="noopener ugc nofollow" target="_blank"> https://dax.guide </a>上对ISINSCOPE()的描述，里面有一个视频，完整的描述了ISINSCOPE()的工作原理。</p><h1 id="292b" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">选定值</h1><p id="cf49" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">我们可以使用<a class="ae kz" href="https://dax.guide/selectedvalue/" rel="noopener ugc nofollow" target="_blank"> SELECTEDVALUE() </a>来检查一个列在当前过滤器上下文中是否正好包含一个值，以及我们拥有哪个值。</p><p id="0828" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">此外，如果没有值或多个值可见，我们可以传递一个替换值。</p><p id="5d5f" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">SELECTEDVALUE()类似于HASONEVALUE()。但是SELECTEDVALUE()返回实际值，而HASONEVALUE()仅在当前筛选器上下文中只有一个值可见时返回TRUE。</p><p id="2184" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我复制了用于解释HASONEVALUE()的查询，并将度量值更改为SELECTEDVALUE()。我添加文本“_Multiple Values_”作为替换值的第二个参数。</p><p id="ea3a" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">你可以在下图中看到结果:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ow"><img src="../Images/218902175c5b7b4e667877c77d3397d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8_CcQsUb8AmfhifeyKv3xA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图12 —带有SELECTEDVALUE()的查询结果(作者提供的图)</p></figure><p id="00dc" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">如您所见，Years和Region Country只有一个值，SELECTEDVALUE()返回这个值。</p><p id="0d32" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">由于我们在当前筛选器上下文中有12个月(见上文)，因此该月的SELECTEDVALUE()返回替换值。</p><p id="03e7" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">SELECTEDVALUE()非常强大，因为我们可以使用它从切片器甚至从实际查询中获取选定的值，并更改查询的行为。</p><h1 id="e9de" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">结论</h1><p id="1056" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">这里显示的所有函数对于导航过滤器上下文和确定其内容都是必不可少的。</p><p id="f342" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">如果没有这个函数，我们作为DAX开发人员的工作将会更加困难，因为我们将无法对查询中的过滤值做出反应。</p><p id="19dc" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在写这篇文章的时候，我学到了很多，因为我没有意识到这些函数的复杂性。</p><p id="1b71" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">但是我希望这些描述可以帮助你更好地使用DAX。</p><p id="0ab8" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">感谢阅读。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ox"><img src="../Images/8412aa762bfcd4f2e37b5dacd458a544.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*h73ttdVMuowWrR5S"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@ryunosuke_kikuno?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">龙之介·菊野</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="f518" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">参考</h1><p id="754a" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">我使用Contoso样本数据集，就像我以前的文章一样。你可以从微软<a class="ae kz" href="https://www.microsoft.com/en-us/download/details.aspx?id=18279" rel="noopener ugc nofollow" target="_blank">这里</a>免费下载ContosoRetailDW数据集。</p><p id="02e1" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">Contoso数据可以在MIT许可下自由使用，如这里的<a class="ae kz" href="https://github.com/microsoft/Power-BI-Embedded-Contoso-Sales-Demo" rel="noopener ugc nofollow" target="_blank">所述</a>。</p><div class="ob oc gp gr od oe"><a href="https://medium.com/@salvatorecagliari/membership" rel="noopener follow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">通过我的推荐链接加入Medium-Salvatore Cagliari</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">阅读萨尔瓦托勒·卡利亚里的每一个故事(以及媒体上成千上万的其他作家)。您的会员费直接…</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">medium.com</p></div></div><div class="on l"><div class="oy l op oq or on os kt oe"/></div></div></a></div></div></div>    
</body>
</html>