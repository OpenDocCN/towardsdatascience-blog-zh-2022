<html>
<head>
<title>Why and How to ‘Explode’ a List-Like Column to Rows in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么以及如何在 Pandas 中将类似列表的列“展开”为行</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/why-and-how-to-explode-a-list-like-column-to-rows-in-pandas-b69c3391c01c#2022-03-23">https://towardsdatascience.com/why-and-how-to-explode-a-list-like-column-to-rows-in-pandas-b69c3391c01c#2022-03-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6089" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个非常酷的熊猫把戏，你应该看看</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/36a6750c6c81953a7881afcf7cb23775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_rafzMnp1K4vkZBTENexcg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://pixabay.com/vectors/panda-little-panda-baby-panda-baby-1454629/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>提供(作者修改)</p></figure><p id="7564" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">什么是列表式列？在 pandas dataframe 中，我所说的将一个类似列表的列“分解”成行是什么意思？为什么我们需要这样做？这听起来像是一个罕见的数据争论问题，但在数据世界中并不罕见(记住，数据以各种形式和格式出现在我们面前)。</p><p id="0fe6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">解释它的最好方式是给你看一个真实世界的例子。假设我们想对以下 TED 演讲数据(2006 年至 2021 年)进行一些分析，并使用单词云来可视化“教育”标签类别中最受欢迎的 TED 演讲。你可以在<a class="ae ky" href="http://kaggle.com" rel="noopener ugc nofollow" target="_blank">Kaggle.com</a>上这里<a class="ae ky" href="https://www.kaggle.com/datasets/thedatabeast/ted-talk-transcripts-2006-2021" rel="noopener ugc nofollow" target="_blank">下载数据。</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lx"><img src="../Images/eed7d7c9173865e24f600db4381d50e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zq49nz33VOuNFP5wQikcng.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a243" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个数据框架中，我们有每个 TED 演讲的名字，总浏览量，以及它所属的标签。请注意“tags”列与典型的列(例如，string、integer、float 等)有何不同。)你会看到的。“tags”列由一组用逗号分隔并用方括号括起来的标记组成——看起来就像一个 python 列表！我们称之为类似列表的列(这个列的实际数据类型是 object/string)。</p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><p id="3ffd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嗯，虽然在一个列表式的列(即标签列)中显示 TED talk 所属的所有标签很简洁，但用这种格式分析数据并不方便。例如，如果我们想从数据帧中过滤掉所有带有“教育”标签的 TED 演讲，我们该怎么做呢？</p><p id="8321" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，有一个非常简单明了的<code class="fe mf mg mh mi b">Pandas</code>方法叫做<code class="fe mf mg mh mi b">DataFrame.explode()</code> <strong class="lb iu"> </strong>，可以用<strong class="lb iu"> </strong>来专门解决这个问题。它将把类似列表的列的每个元素转换成一行，复制索引值。让我们通过例子来看看它是如何工作的。</p><p id="7993" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我前面提到的，“标签”列只是一个列表的字符串表示(dtype: object)，因此我们需要首先使用 python 的<code class="fe mf mg mh mi b">ast.literal_eval()</code>方法将“标签”列从字符串转换为列表。</p><pre class="kj kk kl km gt mj mi mk ml aw mm bi"><span id="1c2e" class="mn mo it mi b gy mp mq l mr ms">from ast import literal_eval<br/>df['tags'] = df['tags'].apply(literal_eval)</span></pre><p id="bbea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们使用 Pandas 的<code class="fe mf mg mh mi b">dataframe.explode()</code>方法将列表分解成行。在<code class="fe mf mg mh mi b">explode</code>程序之后，我们还可以使用<code class="fe mf mg mh mi b">drop_duplicates()</code>来删除任何可能的重复。</p><pre class="kj kk kl km gt mj mi mk ml aw mm bi"><span id="a145" class="mn mo it mi b gy mp mq l mr ms">df = df.explode('tags').drop_duplicates()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/df5826160339fb326cfbd219984912cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*nMmdQL2bnd5fw77kcoMPmg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6af8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不错！现在我们有了一个更容易处理的数据框架！有了重塑后的数据框架，我们可以快速创建一个单词云，只需几行代码就可以将“教育”标签类别中最受欢迎的 TED 演讲可视化。</p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h2 id="e460" class="mn mo it bd mu mv mw dn mx my mz dp na li nb nc nd lm ne nf ng lq nh ni nj nk bi translated">额外收获:为 TED 演讲创建一个单词云</h2><p id="e6f1" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">让我们创建一个单词云，将 2006 年至 2021 年最受欢迎的 TED 演讲可视化在标签类别“教育”中。创建单词云的方法有很多。这里我们将使用<code class="fe mf mg mh mi b">matplotlib</code>来做这件事。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/4323356a6c8d0a5d5c6bb8daeb21d03f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3BgxnXARx-oYDr-kVA4BaA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="e1c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有很多方法可以美化如上图所示的基本单词云，包括改变背景颜色、调整字体大小、使用定制的遮罩图像等。如果你想做一个比我们在这篇文章中创建的基本视觉效果更好的视觉效果，你可以在这里阅读我关于文字云<a class="ae ky" href="https://medium.com/@insightsbees/let-your-artistic-creativity-shine-with-advanced-python-visualization-d4fcccd78848" rel="noopener">的另一篇文章。</a></p><div class="nr ns gp gr nt nu"><a href="https://medium.com/@insightsbees/let-your-artistic-creativity-shine-with-advanced-python-visualization-d4fcccd78848" rel="noopener follow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd iu gy z fp nz fr fs oa fu fw is bi translated">借助先进的 Python 可视化技术，让您的艺术创造力大放异彩</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">使用自定义图像、形状和颜色创建首个 Word Cloud 可视化的分步指南</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">medium.com</p></div></div><div class="od l"><div class="oe l of og oh od oi ks nu"/></div></div></a></div><p id="c8a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总的来说，如果您的数据帧有一个类似列表的列，并且您需要通过解包列表并将每个元素分解为一行来重塑数据帧，您可以使用下面的代码片段轻松实现您的目标。</p><pre class="kj kk kl km gt mj mi mk ml aw mm bi"><span id="9b79" class="mn mo it mi b gy mp mq l mr ms">from ast import literal_eval<br/>df['column_name'] = df['column_name'].apply(literal_eval)<br/>df = df.explode('column_name').drop_duplicates()</span></pre></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h2 id="c4d3" class="mn mo it bd mu mv mw dn mx my mz dp na li nb nc nd lm ne nf ng lq nh ni nj nk bi translated">数据源:</h2><p id="23e8" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">本文中用于演示的数据集是一个免费的开放数据集，可以从 Kaggle 的网站<a class="ae ky" href="https://www.kaggle.com/datasets/thedatabeast/ted-talk-transcripts-2006-2021" rel="noopener ugc nofollow" target="_blank">这里</a>下载。这个数据集是由 Ramshankar Yadhunath 创建的。</p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><p id="682e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以通过这个<a class="ae ky" href="https://medium.com/@insightsbees/membership" rel="noopener">推荐链接</a>注册 Medium 会员(每月 5 美元)来获得我的作品和 Medium 的其他内容。通过这个链接注册，我将收到你的会员费的一部分，不需要你额外付费。谢谢大家！</p></div></div>    
</body>
</html>