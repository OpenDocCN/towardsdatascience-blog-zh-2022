<html>
<head>
<title>Visualizing Polars DataFrames using Plotly Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Plotly Express可视化Polars数据帧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualizing-polars-dataframes-using-plotly-express-8da4357d2ee0#2022-07-19">https://towardsdatascience.com/visualizing-polars-dataframes-using-plotly-express-8da4357d2ee0#2022-07-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8828" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何绘制极坐标数据帧</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/412b9f6d74e96e25bfd44481b9e5b29f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RklJmWsYgurr0W9M"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@matteocatanese?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马泰奥·卡塔内塞</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="9d0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我的上一篇文章中，我谈到了新的DataFrame库，它的速度比熊猫还要快。</p><div class="lv lw gp gr lx ly"><a rel="noopener follow" target="_blank" href="/getting-started-with-the-polars-dataframe-library-6f9e1c014c5c"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">Polars数据帧库入门</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">了解如何使用Polars dataframe库操作表格数据(并替换Pandas)</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">towardsdatascience.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><p id="1e73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随之而来的一个很自然的问题是:<em class="mn">可视化</em>怎么样？Polars内置可视化功能吗？因此，在本文中，我将向您展示如何使用Polars DataFrame进行可视化。</p><p id="d6d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是在我继续之前，让我先告诉你一个坏消息— <strong class="lb iu"> Polars没有内置的绘图功能</strong>。</p><blockquote class="mo mp mq"><p id="4909" class="kz la mn lb b lc ld ju le lf lg jx lh mr lj lk ll ms ln lo lp mt lr ls lt lu im bi translated">至少在当前版本(0.13.51)中没有。希望在未来的版本中，它能集成流行的绘图库。</p></blockquote><p id="0502" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也就是说，您必须使用绘图库(如matplotlib、Seaborn或Plotly Express)显式绘制您的Polars数据帧。在这篇文章中，我想把重点放在使用带有<strong class="lb iu"> Plotly Express </strong>的Polars来完成我们的可视化任务。</p><h1 id="9e66" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">Plotly和Plotly表达的是什么？</h1><p id="f000" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated"><strong class="lb iu">plottly</strong><a class="ae ky" href="https://plotly.com/python/" rel="noopener ugc nofollow" target="_blank">Python库</a>是一个交互式的开源绘图库。它支持不同的图表类型，涵盖广泛的统计、金融、地理、科学和三维用例。<strong class="lb iu">另一方面，Plotly Express </strong>是Plotly库的一个包装器，让你不用写太多代码就能更容易地创建好看的图表。Plotly和Plotly Express的关系类似于<strong class="lb iu"> matplotlib </strong>和<strong class="lb iu"> Seaborn </strong>的关系:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/74390dce14417eda499c607114e3d8b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JgZQyiQEep2ZUxvOYSSPgg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="4da9" class="ns mv it bd mw nt nu dn na nv nw dp ne li nx ny ng lm nz oa ni lq ob oc nk od bi translated">安装Plotly Express</h2><p id="8011" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">要安装plotly，您可以使用<code class="fe oe of og oh b">pip</code>:</p><pre class="kj kk kl km gt oi oh oj ok aw ol bi"><span id="8dbc" class="ns mv it oh b gy om on l oo op">pip install plotly</span></pre><p id="8e40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者<code class="fe oe of og oh b">conda</code>:</p><pre class="kj kk kl km gt oi oh oj ok aw ol bi"><span id="b9bd" class="ns mv it oh b gy om on l oo op">conda install plotly</span></pre><h1 id="cc7e" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">创建我们的样品极化数据框架</h1><p id="6a4a" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">让我们从字典中创建我们的示例极坐标数据帧:</p><pre class="kj kk kl km gt oi oh oj ok aw ol bi"><span id="8601" class="ns mv it oh b gy om on l oo op">import polars as pl</span><span id="4ed3" class="ns mv it oh b gy oq on l oo op">df = pl.DataFrame(<br/>     {<br/>         'Model': ['iPhone X','iPhone XS','iPhone 12',<br/>                   'iPhone 13','Samsung S11','Samsung S12',<br/>                   'Mi A1','Mi A2'],<br/>         'Sales': [80,170,130,205,400,30,14,8],     <br/>         'Company': ['Apple','Apple','Apple','Apple',<br/>                     'Samsung','Samsung','Xiao Mi','Xiao Mi'],<br/>     }<br/>)<br/>df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/24159ae4dbeeb91a3f828c8e9be97f9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:464/format:webp/1*GNNlG5cDbfS5BlgeIGCQyQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="cb55" class="ns mv it bd mw nt nu dn na nv nw dp ne li nx ny ng lm nz oa ni lq ob oc nk od bi translated">使用matplotlib绘图</h2><p id="3713" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">首先，画一个柱状图展示每种型号的销售情况是很有用的。大多数数据分析师/科学家都熟悉matplotlib，所以让我们先尝试使用它:</p><pre class="kj kk kl km gt oi oh oj ok aw ol bi"><span id="88db" class="ns mv it oh b gy om on l oo op">plt.bar(df['Model'], df['Sales'])</span></pre><p id="e2c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该会看到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/243752a01801d8b5856cbd99c3870f19.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*Bnrl8MyX8VEM5R_4veCOsw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="439b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的工作是因为<code class="fe oe of og oh b">df[‘Model’]</code>和<code class="fe oe of og oh b">df[‘Sales’]</code>各自返回一个极坐标序列，这是matplotlib的<code class="fe oe of og oh b">bar()</code>方法可以接受的。然而，由于方括号索引是Polars中的反模式，您应该使用<code class="fe oe of og oh b">select()</code>方法来选择您想要绘制的列:</p><pre class="kj kk kl km gt oi oh oj ok aw ol bi"><span id="df19" class="ns mv it oh b gy om on l oo op">import matplotlib.pyplot as plt</span><span id="33d6" class="ns mv it oh b gy oq on l oo op">plt.bar(<br/>    df.<strong class="oh iu">select('Model').to_series()</strong>, <br/>    df.<strong class="oh iu">select('Sales').to_series()</strong><br/>)</span></pre><blockquote class="mo mp mq"><p id="7a6b" class="kz la mn lb b lc ld ju le lf lg jx lh mr lj lk ll ms ln lo lp mt lr ls lt lu im bi translated">注意，您必须使用<code class="fe oe of og oh b">to_series()</code>方法将<code class="fe oe of og oh b">select()</code>方法的结果显式转换为一个序列。这是因为<code class="fe oe of og oh b">select()</code>方法返回一个数据帧。</p></blockquote><h2 id="c92c" class="ns mv it bd mw nt nu dn na nv nw dp ne li nx ny ng lm nz oa ni lq ob oc nk od bi translated">使用Plotly Express绘图</h2><p id="20bf" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">现在让我们使用Plotly Express绘制条形图:</p><pre class="kj kk kl km gt oi oh oj ok aw ol bi"><span id="e480" class="ns mv it oh b gy om on l oo op">import plotly.express as px</span><span id="5a5b" class="ns mv it oh b gy oq on l oo op">px.bar(x = df.select('Model').to_series(), <br/>       y = df.select('Sales').to_series())</span></pre><p id="76ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就像使用matplotlib一样，您需要显式地将列作为一个序列传递给Plotly Express的方法，在本例中是<code class="fe oe of og oh b">bar()</code>方法。</p><p id="0be5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Plotly Express以交互方式显示条形图，您可以将鼠标悬停在条形上，弹出窗口将显示条形的详细信息，您还可以使用工具栏中的各种项目放大图表、将图表另存为PNG等:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/0dcf33241dab0ed3fe23044adc97f6bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zfYvUmLlOlC4fPz0QPoJ6w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="71c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用Polars数据框架绘制图表的另一种方法是将其转换为Pandas数据框架，然后在Plotly Express中直接使用Pandas数据框架:</p><pre class="kj kk kl km gt oi oh oj ok aw ol bi"><span id="dd33" class="ns mv it oh b gy om on l oo op">px.bar(df.to_pandas(),     <strong class="oh iu"># convert from Polars to Pandas DataFrame</strong><br/>       x = 'Model', <br/>       y = 'Sales')</span></pre><blockquote class="mo mp mq"><p id="0392" class="kz la mn lb b lc ld ju le lf lg jx lh mr lj lk ll ms ln lo lp mt lr ls lt lu im bi translated">只要方便，我就会使用这种方法。</p></blockquote><p id="5e2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果上面的语句出错，您需要安装<strong class="lb iu"> pyarrow </strong>库:</p><pre class="kj kk kl km gt oi oh oj ok aw ol bi"><span id="bffb" class="ns mv it oh b gy om on l oo op">pip install pyarrow</span></pre><h2 id="2c3a" class="ns mv it bd mw nt nu dn na nv nw dp ne li nx ny ng lm nz oa ni lq ob oc nk od bi translated">绘制饼图</h2><p id="0286" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">要在Plotly Express中绘制饼图，请使用<code class="fe oe of og oh b">pie()</code>方法:</p><pre class="kj kk kl km gt oi oh oj ok aw ol bi"><span id="04bf" class="ns mv it oh b gy om on l oo op">px.pie(df,                                   <strong class="oh iu"># Polars DataFrame</strong><br/>       names = df.select('Model').to_series(),<br/>       values = df.select('Sales').to_series(), <br/>       hover_name = df.select('Model').to_series(),<br/>       color_discrete_sequence= px.colors.sequential.Plasma_r)</span></pre><p id="0c20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，如果您使用的是熊猫数据框架:</p><pre class="kj kk kl km gt oi oh oj ok aw ol bi"><span id="7592" class="ns mv it oh b gy om on l oo op">px.pie(<strong class="oh iu">df.to_pandas()</strong>,                      <strong class="oh iu"># Pandas DataFrame</strong><br/>       names = 'Model',<br/>       values = 'Sales', <br/>       hover_name = 'Model',<br/>       color_discrete_sequence= px.colors.sequential.Plasma_r)</span></pre><p id="4e93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论哪种情况，您都会看到下面的饼图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/ce3146805a3f90ebb0532203df7d3106.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aDlhpWvSuCDd5PoUkl99nQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="ad8c" class="ns mv it bd mw nt nu dn na nv nw dp ne li nx ny ng lm nz oa ni lq ob oc nk od bi translated">绘制折线图</h2><p id="fc42" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">对于这个例子，我将使用来自<a class="ae ky" href="https://www.kaggle.com/datasets/meetnagadia/apple-stock-price-from-19802021" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/datasets/meet nagadia/apple-stock-price-from-1980 2021</a>的<strong class="lb iu"> AAPL-10.csv </strong>文件</p><blockquote class="mo mp mq"><p id="70bd" class="kz la mn lb b lc ld ju le lf lg jx lh mr lj lk ll ms ln lo lp mt lr ls lt lu im bi translated"><strong class="lb iu">许可证</strong> —开放数据共享开放数据库许可证(ODbL) v1.0. <strong class="lb iu">描述</strong> —这是一个关于苹果公司股票预测的数据集，这个数据集从1980年开始到2021年。它是从雅虎财经收集来的。</p></blockquote><p id="66ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要绘制显示<strong class="lb iu">开盘</strong>、<strong class="lb iu">收盘</strong>、<strong class="lb iu">高</strong>和<strong class="lb iu">低</strong>价格的折线图，将Polars数据帧直接转换为Pandas数据帧并在Plotly Express的<code class="fe oe of og oh b">line()</code>方法中使用会更容易:</p><pre class="kj kk kl km gt oi oh oj ok aw ol bi"><span id="1937" class="ns mv it oh b gy om on l oo op">df = (<br/>    pl.scan_csv('AAPL-10.csv')<br/>).collect()</span><span id="a296" class="ns mv it oh b gy oq on l oo op">px.line(df.to_pandas(),               <strong class="oh iu"># covert to Pandas DataFrame</strong><br/>        x = 'Date', <br/>        y = ['Open','Close','High','Low']<br/>)</span></pre><p id="f484" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/ed23339b7fe23be8efb1acc68f2acb3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zL4Ql56hdhXCLmmVNRMU8w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="5a67" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">执行探索性数据分析(EDA)</h1><p id="975a" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">在下一个例子中，让我们对保险数据集进行一些EDA。对于这个例子，我们将使用位于<a class="ae ky" href="https://www.kaggle.com/datasets/teertha/ushealthinsurancedataset?resource=download." rel="noopener ugc nofollow" target="_blank">的数据集https://www . ka ggle . com/datasets/teer tha/ushealthsiicedataset？资源=下载。</a></p><blockquote class="mo mp mq"><p id="e866" class="kz la mn lb b lc ld ju le lf lg jx lh mr lj lk ll ms ln lo lp mt lr ls lt lu im bi translated"><strong class="lb iu">许可</strong> : <a class="ae ky" href="https://creativecommons.org/publicdomain/zero/1.0/" rel="noopener ugc nofollow" target="_blank"> CC0:公共领域</a>。<strong class="lb iu">描述</strong> —该数据集包含1338行被保险人数据，其中根据被保险人的以下属性给出保险费用:年龄、性别、身体质量指数、子女数、吸烟者和地区。属性是数字和分类变量的混合。</p></blockquote><p id="b02a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，将CSV文件作为Polars数据帧加载:</p><pre class="kj kk kl km gt oi oh oj ok aw ol bi"><span id="eafb" class="ns mv it oh b gy om on l oo op">import polars as pl</span><span id="1f0d" class="ns mv it oh b gy oq on l oo op">q = (<br/>    pl.scan_csv('insurance.csv')<br/>)</span><span id="575e" class="ns mv it oh b gy oq on l oo op">df = q.collect()<br/>df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/21035350767ec0225ff65766a4e52a24.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*RXaxiD_rXVkQOgtnUfsZQw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="b604" class="ns mv it bd mw nt nu dn na nv nw dp ne li nx ny ng lm nz oa ni lq ob oc nk od bi translated">分析吸烟者的性别分布</h2><p id="0bc5" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">让我们分析一下不同性别吸烟者的分布情况:</p><pre class="kj kk kl km gt oi oh oj ok aw ol bi"><span id="1251" class="ns mv it oh b gy om on l oo op">import plotly.express as px</span><span id="14be" class="ns mv it oh b gy oq on l oo op">px.histogram(df.to_pandas(),<br/>             x = 'sex', <br/>             color = 'smoker',<br/>             barmode = 'group',<br/>             color_discrete_sequence = px.colors.qualitative.D3)</span></pre><p id="a1de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像往常一样，我发现在我绘图之前，把极地数据帧转换成熊猫数据帧更容易。对于绘图，我使用Plotly Express中的<code class="fe oe of og oh b">histogram()</code>方法。下面是上述语句的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/02c0869a94f84a7f7f90354800b012c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i_9v74-8Mnc2NdSsclS-xQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a21d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，对于每个性别，不吸烟的人比吸烟的人多。</p><h2 id="6f27" class="ns mv it bd mw nt nu dn na nv nw dp ne li nx ny ng lm nz oa ni lq ob oc nk od bi translated">吸烟者的性别分布分析</h2><p id="b498" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">接下来，我们有兴趣看看男性吸烟者多还是女性吸烟者多:</p><pre class="kj kk kl km gt oi oh oj ok aw ol bi"><span id="8816" class="ns mv it oh b gy om on l oo op">px.histogram(df.to_pandas(),<br/>             x = 'smoker',<br/>             color = 'sex',<br/>             barmode = 'group',<br/>             color_discrete_sequence = px.colors.qualitative.Safe)</span></pre><p id="534c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的结果表明，男性吸烟者比女性吸烟者多:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/b41882b87800f56226210e4318c4e40a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Svd_jOZawXDYUkuH91v8QA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="2528" class="ns mv it bd mw nt nu dn na nv nw dp ne li nx ny ng lm nz oa ni lq ob oc nk od bi translated">分析费用如何取决于年龄</h2><p id="9b46" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">我想对这个数据集做的最后一个分析是，电荷如何依赖于年龄。由于<strong class="lb iu"> age </strong>列是一个连续变量，如果能够将值绑定到不同的组中，然后将其转换为分类字段，将会非常有用。在Polars中，您可以使用<code class="fe oe of og oh b">apply()</code>和<code class="fe oe of og oh b">cast()</code>方法:</p><pre class="kj kk kl km gt oi oh oj ok aw ol bi"><span id="a8f1" class="ns mv it oh b gy om on l oo op">def age_group(x):<br/>    if x&gt;0 and x&lt;=20:<br/>        return '20 and below'<br/>    if x&gt;20 and x&lt;=30:<br/>        return '21 to 30'<br/>    if x&gt;30 and x&lt;=40:<br/>        return '31 to 40'<br/>    if x&gt;40 and x&lt;=50:<br/>        return '41 to 50'<br/>    if x&gt;50 and x&lt;=60:<br/>        return '51 to 60'<br/>    if x&gt;60 and x&lt;=70:<br/>        return '61 to 70'<br/>    return '71 and above'</span><span id="0d15" class="ns mv it oh b gy oq on l oo op">df = df.select(    <br/>    [<br/>        pl.col('*'),        <br/>        <strong class="oh iu">pl.col('age').apply(age_group).cast(pl.Categorical)<br/>            .alias('age_group')</strong><br/>    ]<br/>)<br/>df</span></pre><blockquote class="mo mp mq"><p id="1bbd" class="kz la mn lb b lc ld ju le lf lg jx lh mr lj lk ll ms ln lo lp mt lr ls lt lu im bi translated">在熊猫身上，你可以用<code class="fe oe of og oh b">pd.cut()</code>的方法来表演宁滨。不幸的是，在Polars中没有等效的方法。</p></blockquote><p id="361d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将获得以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/bf7a7fa3fb8707a40d7232e4042c8014.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*H6ZBTOlwO7Qq_EPezPwebA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a27f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以根据<strong class="lb iu"> age_group </strong>字段对数据帧进行分组，然后计算所有男性和女性的平均费用:</p><pre class="kj kk kl km gt oi oh oj ok aw ol bi"><span id="c5bc" class="ns mv it oh b gy om on l oo op">df = df.<strong class="oh iu">groupby</strong>('age_group').<strong class="oh iu">agg</strong>(  <br/>        [<br/>           (pl.col('charges')<br/>                 .filter(pl.col('sex')== 'male'))<br/>                .mean()<br/>                .alias('male_mean_charges'),<br/>           (pl.col('charges')<br/>                 .filter(pl.col('sex')== 'female'))<br/>                .mean()<br/>                .alias('female_mean_charges'),        <br/>        ]<br/>    ).sort(by='age_group')<br/>df</span></pre><p id="6ff6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将看到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/0557c093a506e9e9bc7f19f14667a8c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*ou6AY9NCFgcxImFhZkpcoQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="fd8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，您现在可以绘制图表，显示每个年龄组的平均费用如何变化:</p><pre class="kj kk kl km gt oi oh oj ok aw ol bi"><span id="007d" class="ns mv it oh b gy om on l oo op">px.bar(<br/>    df.to_pandas(),<br/>    x = "age_group",<br/>    y = ['male_mean_charges','female_mean_charges'],<br/>    barmode = 'group',<br/>    color_discrete_sequence=px.colors.colorbrewer.Accent,<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/4ce7b4f4dbf6f2f2e4ddd4d76fd8f5ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hyF1L1SyzjZgY4N6GN7g_A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7edd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们使用了Polars，所以让我们利用惰性评估，将上面的所有代码片段合并到一个查询中:</p><pre class="kj kk kl km gt oi oh oj ok aw ol bi"><span id="abcf" class="ns mv it oh b gy om on l oo op">import polars as pl</span><span id="868b" class="ns mv it oh b gy oq on l oo op">def age_group(x):<br/>    if x&gt;0 and x&lt;=20:<br/>        return '20 and below'<br/>    if x&gt;20 and x&lt;=30:<br/>        return '21 to 30'<br/>    if x&gt;30 and x&lt;=40:<br/>        return '31 to 40'<br/>    if x&gt;40 and x&lt;=50:<br/>        return '41 to 50'<br/>    if x&gt;50 and x&lt;=60:<br/>        return '51 to 60'<br/>    if x&gt;60 and x&lt;=70:<br/>        return '61 to 70'<br/>    return '71 and above'</span><span id="e5a6" class="ns mv it oh b gy oq on l oo op"><strong class="oh iu">q = (<br/>    pl.scan_csv('insurance.csv')<br/>    .select(    <br/>        [<br/>            pl.col('*'),        <br/>            pl.col('age').apply(age_group).cast(pl.Categorical)<br/>                .alias('age_group')<br/>        ]<br/>    )<br/>    .groupby('age_group').agg(  <br/>        [<br/>           (pl.col('charges')<br/>                 .filter(pl.col('sex')== 'male'))<br/>                .mean()<br/>                .alias('male_mean_charges'),<br/>           (pl.col('charges')<br/>                 .filter(pl.col('sex')== 'female'))<br/>                .mean()<br/>                .alias('female_mean_charges'),        <br/>        ]<br/>    ).sort(by='age_group')<br/>)</strong></span><span id="23a7" class="ns mv it oh b gy oq on l oo op">px.bar(<br/>    q.collect().to_pandas(),<br/>    x = "age_group",<br/>    y = ['male_mean_charges','female_mean_charges'],<br/>    barmode = 'group',<br/>    color_discrete_sequence=px.colors.colorbrewer.Accent,<br/>)</span></pre><div class="lv lw gp gr lx ly"><a href="https://weimenglee.medium.com/membership" rel="noopener follow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">加入媒介与我的介绍链接-李伟孟</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">阅读李维孟(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">weimenglee.medium.com</p></div></div><div class="mh l"><div class="pb l mj mk ml mh mm ks ly"/></div></div></a></div><blockquote class="mo mp mq"><p id="ec01" class="kz la mn lb b lc ld ju le lf lg jx lh mr lj lk ll ms ln lo lp mt lr ls lt lu im bi translated">我将在即将到来的新加坡ML会议(2022年11月22-24日)上主持一个关于Polars的研讨会。如果你想在Polars数据框架上快速起步，请在<a class="ae ky" href="https://mlconference.ai/machine-learning-advanced-development/using-polars-for-data-analytics-workshop/" rel="noopener ugc nofollow" target="_blank">https://ml conference . ai/machine-learning-advanced-development/using-Polars-for-data-analytics-workshop/</a>上注册我的研讨会。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/b1bb1beb7127f109628516f77a2b9338.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*3mrWppY0VhWWEoBm5A4qHA.png"/></div></figure><h1 id="17bd" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">摘要</h1><p id="d05e" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">在本文中，您了解了Polars没有自己的可视化API。而是要在自己的绘图库比如matplotlib和Plotly Express上回复。虽然您可以将Polars数据帧作为系列直接传递到各种绘图库，但有时如果您只是将Polars数据帧转换为Pandas数据帧会更容易，因为大多数绘图库都具有对Pandas的固有支持。</p><p id="c108" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将来，Polars很有可能会有自己的绘图API，但是现在，你必须用你现有的来凑合。</p></div></div>    
</body>
</html>