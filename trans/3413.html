<html>
<head>
<title>Machine Learning with the Modern Data Stack: A Case Study</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于现代数据堆栈的机器学习:案例研究</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/machine-learning-with-the-modern-data-stack-a-case-study-50f0c2e1fbb#2022-07-28">https://towardsdatascience.com/machine-learning-with-the-modern-data-stack-a-case-study-50f0c2e1fbb#2022-07-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/20771f9efb56427358c4958d17697a78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*caTlEJc6bbFvbbs6MPvShg.jpeg"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">在<a class="ae kc" href="https://unsplash.com/s/photos/machine-learning?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kc" href="https://unsplash.com/@hiteshchoudhary?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Hitesh Choudhary </a>拍摄的照片</p></figure><p id="5b99" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于<a class="ae kc" href="https://towardsdatascience.com/tagged/modern-data-stack" rel="noopener" target="_blank">现代数据栈</a> (MDS)已经说了很多，但情况明显更分散在机器学习这一边:<em class="lb">一旦数据被适当地转换，它如何在下游被消费以产生商业价值？</em></p><p id="ba11" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇文章是为那些想在处理数据和使用机器学习实际交付商业价值之间架起一座桥梁的人而写的。</p><p id="1c48" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">TL；博士</strong></p><ul class=""><li id="d84a" class="lc ld iq kf b kg kh kk kl ko le ks lf kw lg la lh li lj lk bi translated">在采用现代数据堆栈(MDS)后，各组织仍处于成为“数据驱动型”的早期阶段，MDS需要与MLOps和实际数据驱动型软件相结合才能取得成功；</li><li id="6baf" class="lc ld iq kf b kg ll kk lm ko ln ks lo kw lp la lh li lj lk bi translated">您将了解在一个不断发展的组织中处理数据所面临的挑战以及如何克服这些挑战，包括<a class="ae kc" href="https://github.com/jacopotagliabue/post-modern-data-stack" rel="noopener ugc nofollow" target="_blank">端到端代码</a>展示如何将DataOps和MLOps与最先进的开源工具相结合，如<a class="ae kc" href="https://metaflow.org/" rel="noopener ugc nofollow" target="_blank"> Metaflow </a>和dbt</li><li id="1700" class="lc ld iq kf b kg ll kk lm ko ln ks lo kw lp la lh li lj lk bi translated">一个关键点是操作的抽象级别:从数据到服务，整个管道不需要任何特殊的DevOps人员、基础设施工作或yaml文件。SQL和Python是存储库中仅有的语言。</li><li id="63c0" class="lc ld iq kf b kg ll kk lm ko ln ks lo kw lp la lh li lj lk bi translated">在后续的帖子中，我们将展示好的工具如何提供一种更好的方式来思考工作和生产力的划分，从而为经理和数据领导者提供一个组织模板。</li></ul><h1 id="a119" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">从现代数据堆栈到MLOps</h1><p id="5b74" class="pw-post-body-paragraph kd ke iq kf b kg mo ki kj kk mp km kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">现代数据堆栈(MDS)已被整合为围绕数据收集、存储和转换的一系列最佳实践。特别是，MDS包括三大支柱:</p><ul class=""><li id="7125" class="lc ld iq kf b kg kh kk kl ko le ks lf kw lg la lh li lj lk bi translated">可扩展的摄取机制，通过工具(例如Fivetran、Airbyte)或<a class="ae kc" href="https://github.com/jacopotagliabue/paas-data-ingestion" rel="noopener ugc nofollow" target="_blank">基础设施</a>；</li><li id="f875" class="lc ld iq kf b kg ll kk lm ko ln ks lo kw lp la lh li lj lk bi translated">将所有数据源存储在一起的数据仓库(例如雪花);</li><li id="7bc7" class="lc ld iq kf b kg ll kk lm ko ln ks lo kw lp la lh li lj lk bi translated">一种转换工具(如dbt)，确保使用SQL对原始数据进行版本化的DAG式操作。</li></ul><p id="d383" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于这种MDS已经说了很多，但是栅栏另一边的情况更加“分散”:<em class="lb">一旦数据被适当地转换，下游如何消费这些数据以产生商业价值</em>？归根结底，吸收和转换数据(对大多数公司来说)本身并不是目的:虽然科技巨头们不久前就想出了如何“将模型投入生产”，但大多数公司仍在努力在不到<a class="ae kc" href="https://algorithmia.com/state-of-ml" rel="noopener ugc nofollow" target="_blank"> 3个月</a>的时间内将模型投入生产。</p><p id="9695" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们采取的方法是接受这样一个事实，即不是每个公司都需要像Googles和Metas部署的那样复杂和无限可扩展的基础设施，而<a class="ae kc" href="https://www.youtube.com/watch?v=SAal0hqqE74" rel="noopener ugc nofollow" target="_blank">这完全没问题</a> : <a class="ae kc" rel="noopener" target="_blank" href="/ml-and-mlops-at-a-reasonable-scale-31d2c0782d9c">以“合理的规模”进行ML比以往任何时候都更有价值和有效，这要归功于供应商和开源解决方案的伟大生态系统。在</a><a class="ae kc" href="https://github.com/jacopotagliabue/post-modern-stack" rel="noopener ugc nofollow" target="_blank">的配套知识库</a>中，我们使用深度学习管道来训练一个用于顺序推荐的模型:如果你看到一个购物者正在与<em class="lb"> k </em>产品进行交互，她接下来会做什么？我们…</p><ul class=""><li id="bbf6" class="lc ld iq kf b kg kh kk kl ko le ks lf kw lg la lh li lj lk bi translated">有目的地避免玩具数据集和仅本地部署；</li><li id="5bd1" class="lc ld iq kf b kg ll kk lm ko ln ks lo kw lp la lh li lj lk bi translated">提供一个云就绪、“合理规模”的项目；</li><li id="32cb" class="lc ld iq kf b kg ll kk lm ko ln ks lo kw lp la lh li lj lk bi translated">展示培训、测试和服务(<em class="lb"> MLOps </em>步骤)如何自然地嵌入到以数据和功能(<em class="lb">数据操作</em>步骤)开始的管道中。</li></ul><p id="2fbe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这项工作的主干由Metaflow提供，这是我们的开源框架，它(除其他外)降低了数据科学家从原型到生产的机器学习的门槛，一般堆栈看起来是这样的，尽管Metaflow允许您切换任何其他组件:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/5e65a1b195811283f8bddfb19d9cb638.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RVpSZfIgnUO14S8b.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">作者图片</p></figure><p id="08ee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章和后续文章中，我们讲述了我们在Coveo任职期间工具和文化如何一起改变的故事，并分享了在工作代码中体现我们数据协作原则的开源存储库:根据我们的经验，DataOps和MLOps在相同的原则下做得更好，而不是将工件“移交”给围栏另一边的团队。特别是，我们的目标是双重的:</p><ul class=""><li id="761a" class="lc ld iq kf b kg kh kk kl ko le ks lf kw lg la lh li lj lk bi translated">基于我们的经验，我们为刚起步的团队提供了一个<em class="lb">技术</em>模板，并想知道如何有效地加入DataOps和MLOps</li><li id="97cb" class="lc ld iq kf b kg ll kk lm ko ln ks lo kw lp la lh li lj lk bi translated">我们展示了好的工具如何提供一种更好的方式来思考工作和生产力的分工，从而为经理和数据领导者提供一个<em class="lb">组织</em>模板。我们将在后续文章中讨论这个问题。</li></ul><p id="4297" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">总而言之，虽然我们对空间的<a class="ae kc" href="https://www.mihaileric.com/posts/mlops-is-a-mess/" rel="noopener ugc nofollow" target="_blank">增长感到兴奋，但我们也知道可供选择的数量可能会让<em class="lb">和</em>感到害怕，因为这个领域仍然是混乱的，并且在快速发展。我们在此提出的解决方案是一个实用的堆栈，它不仅为测试MLOps waters的团队提供了可靠的第一步，还详细展示了简单的部分如何在构建可扩展的ML系统方面发挥重要作用。</a></p><p id="1009" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以在这里找到指导这篇文章的视频教程:</p><figure class="mu mv mw mx gt jr"><div class="bz fp l di"><div class="my mz l"/></div></figure><h1 id="d169" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">利用现代数据堆栈进行机器学习</h1><p id="0cc9" class="pw-post-body-paragraph kd ke iq kf b kg mo ki kj kk mp km kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">这个堆栈如何将良好的数据文化转化为大规模的工作软件？隔离(和降低)复杂性的一个有用的方法是通过理解<em class="lb">计算发生的地方</em>。在我们的管道和我们在组织间看到的模式中，有几个计算步骤和多个提供商:</p><ul class=""><li id="fd97" class="lc ld iq kf b kg kh kk kl ko le ks lf kw lg la lh li lj lk bi translated">数据在雪花中存储和转换，雪花为SQL提供底层计算，包括由dbt这样的工具管理的数据转换；</li><li id="c141" class="lc ld iq kf b kg ll kk lm ko ln ks lo kw lp la lh li lj lk bi translated">训练在AWS Batch上进行，利用Metaflow提供的抽象；</li><li id="684a" class="lc ld iq kf b kg ll kk lm ko ln ks lo kw lp la lh li lj lk bi translated">服务在SageMaker上，利用AWS的PaaS产品；</li><li id="b1a3" class="lc ld iq kf b kg ll kk lm ko ln ks lo kw lp la lh li lj lk bi translated">调度基于AWS步骤函数，再次利用元流(未在回购中显示，但<a class="ae kc" href="https://docs.metaflow.org/going-to-production-with-metaflow/scheduling-metaflow-flows" rel="noopener ugc nofollow" target="_blank">可以直接实现</a>)。</li></ul><p id="eda9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">设计中的一个关键点是我们选择操作的抽象层次:整个管道不需要任何特殊的DevOps人员、基础设施工作或yaml文件。SQL和Python是存储库中仅有的语言:基础设施要么是不可见的(如Snowflake透明地运行我们的dbt查询)，要么是<em class="lb">声明性的</em>(例如，您指定您需要的计算类型，如GPU，Metaflow使它发生)。</p><p id="8c8b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">虽然您可能对DataOps部分比较熟悉，但还是有必要对MLOps部分做一个高层次的概述。请记住:<em class="lb">转换和规范化数据本身很少是目的——只有当你从中获得一些东西，从可视化中获得洞察力或从机器学习模型中获得预测时，数据才有价值。</em></p><p id="ac43" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae kc" href="https://github.com/jacopotagliabue/post-modern-stack/blob/fa94da5a131f6b3548f0dd1b9454d3d05dd9166e/src/dbt/models/metaflow/nep_session_events.sql#L7" rel="noopener ugc nofollow" target="_blank">我们的堆栈利用由dbt构建的SQL DAG </a>,为我们的推荐模型运行从原始购物事件到产品交互序列的必要转换，通过使用SQL，我们实现了两个重要目标:</p><ul class=""><li id="26e1" class="lc ld iq kf b kg kh kk kl ko le ks lf kw lg la lh li lj lk bi translated"><em class="lb">首先</em>，ML团队可以在一个统一的环境中直接在分析工程师下班后工作(可以说SQL是数据的<em class="lb">通用语</em>)；</li><li id="347c" class="lc ld iq kf b kg ll kk lm ko ln ks lo kw lp la lh li lj lk bi translated"><em class="lb">第二个</em>，我们将所有(分布式)计算下推到雪花，使Python方面的事情变得相当轻量级，因为我们不会真正受到机器内存的限制来聚合和过滤数据行。</li></ul><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/2af76571e3bfb112ab988bbc58dad495.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FtXQcZ-J5H8hdMEI.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">这段代码显示，由于数据已经被转换，所以只需要一个简单的查询就可以让数据集为下游建模做好准备</p></figure><p id="f125" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">培训部分本身是一个典型的深度模型<a class="ae kc" href="https://arxiv.org/abs/2007.14906" rel="noopener ugc nofollow" target="_blank">用于会议建议</a>，没有任何细节依赖于它:同样的原则适用于更复杂的模型。令人兴奋的是，一个简单的SQL查询，易于阅读和维护，是连接云中GPU上的功能准备和深度学习训练所需要的一切。训练一个模型产生一个工件(也就是一个现成的模型！)，它现在可以生成预测:由于在将模型部署到实际交通之前，在看不见的数据上测试模型是一个好的做法，我们在<em class="lb"> test_model </em>中展示了一种先进技术的草案，<a class="ae kc" href="https://github.com/jacopotagliabue/reclist" rel="noopener ugc nofollow" target="_blank">行为测试</a>。</p><p id="1af2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，管道以部署结束，也就是说，将通过培训产生并通过测试验证的工件运送到像任何其他API一样可以到达的公共端点的过程；根据我们训练的模型，通过提供购物会话，端点将以最可能的延续进行响应。</p><p id="41ed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于数据科学家、经验丰富的ML工程师、刚刚开始使用Python的分析工程师，甚至监控项目的PM来说，这是一个舒适的堆栈:鼓励协作和有原则的分工。虽然我们提出了一个RecSys用例，但上述考虑因素大部分(如果不是全部的话)适用于许多其他行业的类似管道:<a class="ae kc" href="https://github.com/jacopotagliabue/you-dont-need-a-bigger-boat" rel="noopener ugc nofollow" target="_blank">毕竟，你不需要更大的船</a>来做尖端的ML。</p><p id="0469" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个堆栈还可以在越来越复杂的配置中运行，这取决于您想要包含多少工具/功能:即使在“完全复杂”的情况下，它也是一个非常简单的、无需干预的万亿字节级处理堆栈；此外，一切都是相当解耦的，所以如果你想用<a class="ae kc" href="https://outerbounds.com/blog/machine-learning-pipelines-from-prototype-to-production" rel="noopener ugc nofollow" target="_blank">塞尔顿</a>交换SageMaker，或者用权重&amp;偏差交换Comet，你可以轻而易举地做到。</p><p id="6979" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">整个堆栈包含到实验跟踪平台的现成连接和一个定制DAG卡(的存根),根据雅格布团队的行为测试开源框架<a class="ae kc" href="https://github.com/jacopotagliabue/reclist" rel="noopener ugc nofollow" target="_blank"> RecList </a>显示推荐系统的表现。我们可以就此写一篇文章(实际上，我们<a class="ae kc" rel="noopener" target="_blank" href="/ndcg-is-not-all-you-need-24eb6d2f1227">确实写了</a>，加上<a class="ae kc" href="https://arxiv.org/abs/2111.09963" rel="noopener ugc nofollow" target="_blank">两篇学术论文</a><a class="ae kc" href="https://arxiv.org/abs/2110.13601" rel="noopener ugc nofollow" target="_blank"/>):即使作为一个非常小的测试例程，我们也希望确保将它作为一个通用的提示，提醒人们在部署之前理解模型行为是多么重要，以及可读、可共享、低接触的文档对于生产中的ML管道是多么重要。</p><p id="99ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个堆栈很简单，但是很有效，而且是模块化的:它可能不是旅程的终点，但是它肯定是一个很好的开始。</p><p id="1fd2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在后续的帖子中，我们将展示好的工具如何提供一种更好的方式来思考工作和生产力的划分，从而为经理和数据领导者提供一个组织模板。如果您对这些话题感兴趣，请在<a class="ae kc" href="http://slack.outerbounds.co/" rel="noopener ugc nofollow" target="_blank">我们的社区slack here </a>上与我们聊天。</p><p id="056c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">注:</strong></p><p id="7dbf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇博文是Metaflow的长期用户<a class="ae kc" href="http://coveo.com" rel="noopener ugc nofollow" target="_blank"> Coveo </a>和Outerbounds的合作。在外部，我们已经与Coveo合作过几次，合作项目包括<a class="ae kc" href="https://outerbounds.com/blog/integrating-pythonic-visual-reports-into-ml-pipelines" rel="noopener ugc nofollow" target="_blank">元流卡</a>和最近关于<a class="ae kc" href="https://www.youtube.com/watch?v=SAal0hqqE74" rel="noopener ugc nofollow" target="_blank">合理规模机器学习的炉边谈话——你不是谷歌，这完全没问题</a>。在这篇文章中，我们与来自Coveo的Jacopo坐在一起，思考他们如何使用Metaflow将DataOps与MLOps连接起来，以回答这个问题:<em class="lb">一旦数据被适当地转换，它如何在下游被消费以产生商业价值？</em></p><p id="074f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">致谢</strong></p><p id="d30c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">特别鸣谢:dbt Labs的Sung Won Chung、Coveo的Patrick John Chia、Luca Bigon、Andrea Polonioli和Ciro Greco。如果没有Coveo去年发布的神奇数据集<a class="ae kc" href="https://github.com/coveooss/SIGIR-ecom-data-challenge" rel="noopener ugc nofollow" target="_blank">，这一切都是不可能的，该数据集包含了数百万真实世界的匿名购物事件。</a></p><p id="d17c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您喜欢这篇文章，请花点时间支持我们的开源计划，为我们的<a class="ae kc" href="https://github.com/jacopotagliabue/reclist" rel="noopener ugc nofollow" target="_blank"> RecList包</a>、<a class="ae kc" href="https://github.com/jacopotagliabue/post-modern-data-stack" rel="noopener ugc nofollow" target="_blank"> this repo </a>和<a class="ae kc" href="https://github.com/netflix/metaflow" rel="noopener ugc nofollow" target="_blank"> Metaflow </a>添加一颗星。</p></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><p id="4c65" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">原载于2022年7月28日https://outerbounds.com</em><em class="lb">T21</em><a class="ae kc" href="https://outerbounds.com/blog/modern-data-stack-mlops" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>