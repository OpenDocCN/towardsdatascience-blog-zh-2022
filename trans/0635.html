<html>
<head>
<title>Elasticsearch Python workshop #2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Elasticsearch Python研讨会#2</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/elasticsearch-python-workshop-2-37447f8d2845#2022-02-25">https://towardsdatascience.com/elasticsearch-python-workshop-2-37447f8d2845#2022-02-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b502" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">API、类以及如何调用它们</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/daa065c05cae1f10e1fa1075684ca145.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GHbdHR1CqR2snlaM"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">戴维·克洛德在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="b5b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">欢迎来到Elasticsearch Python研讨会的第二部分。本系列将从Python程序员的角度来关注这个问题，我希望我能对这个小型生态系统有所了解，这个生态系统是用Python客户端和工具从Elasticsearch集群中获取额外数据而构建起来的。特别是当你是一个数据科学家时，这个系列可能会节省你一些时间。像所有的研讨会一样:为了保持文章简洁，我把代码剪成了片段。但是你可以从<a class="ae kv" href="https://github.com/PascalThalmann/ElasticPythonWorkshop/tree/master/2_classes_and_api" rel="noopener ugc nofollow" target="_blank"> GitHub repo下载这个工作坊的完整代码。话虽如此，我们还是开始吧。</a></p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="f47e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们创建一个简单的连接。如果您使用的是Elasticsearch版本8.0.0及以上，请检查<a class="ae kv" href="https://cdax.ch/2022/02/20/elasticsearch-python-workshop-1-the-basics/" rel="noopener ugc nofollow" target="_blank">首次研讨会</a>以创建安全连接。</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="c70e" class="me mf iq ma b gy mg mh l mi mj">from elasticsearch import Elasticsearch<br/>es = Elasticsearch(["<a class="ae kv" href="https://username:password@srvelk:9200" rel="noopener ugc nofollow" target="_blank">https://username:password@srvelk:9200</a>"], verify_certs=False)</span></pre><h1 id="5151" class="mk mf iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">弹性搜索类</h1><p id="f6c3" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">因为我们的连接是用Elasticsearch类创建的，所以最基本的API调用可以作为方法直接从这个类中获得。这些方法直接列在模块<a class="ae kv" href="https://elasticsearch-py.readthedocs.io/en/v8.0.0/api.html#module-elasticsearch" rel="noopener ugc nofollow" target="_blank">弹性搜索</a>下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/748ec13eda657ca31bd12c677d19fde8.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/0*oLmjwYlXgMwb49bP.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="167f" class="mk mf iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">创建索引和文档</h1><p id="1b06" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">让我们用“create”方法创建一个索引和一个文档。来自<a class="ae kv" href="https://elasticsearch-py.readthedocs.io/en/v8.0.0/api.html#module-elasticsearch" rel="noopener ugc nofollow" target="_blank">官方文件</a>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/283586e35aaaaaae5d8ce25492e80e56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/0*yj-j_x6PI2RTCeUh.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">弹性搜索图片</p></figure><p id="2b77" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个调用看起来像这样:</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="7811" class="me mf iq ma b gy mg mh l mi mj">response = es.create(index='testidx', id=1, document='{"item": "content"}')</span></pre><p id="7490" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看API调用的响应:</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="210f" class="me mf iq ma b gy mg mh l mi mj">print(json.dumps(response, indent=4))<br/>{<br/>    "_index": "testidx",<br/>    "_id": "1",<br/>    "_version": 1,<br/>    "result": "created",<br/>    "_shards": {<br/>        "total": 2,<br/>        "successful": 1,<br/>        "failed": 0<br/>    },<br/>    "_seq_no": 0,<br/>    "_primary_term": 1<br/>}</span></pre><p id="7a29" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以测试状态:</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="b052" class="me mf iq ma b gy mg mh l mi mj">if response['result'] == 'created':<br/>   print("document created")</span></pre><h1 id="febb" class="mk mf iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">得到一份文件</h1><p id="e116" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">让我们使用get方法来读取文档:</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="0350" class="me mf iq ma b gy mg mh l mi mj">response = es.get(index='testidx', id=1)<br/>print(json.dumps(response, indent=4))<br/>{<br/>    "_index": "testidx",<br/>    "_id": "1",<br/>    "_version": 1,<br/>    "_seq_no": 0,<br/>    "_primary_term": 1,<br/>    "found": true,<br/>    "_source": {<br/>        "item": "content"<br/>    }<br/>}</span></pre><p id="5c60" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这与你在curl或Kibana中得到的结果是一样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/37978be046cc5b22e5d87f0ce5979763.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/0*dLA8XazHGWHeJjkc.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="8992" class="mk mf iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">搜索文档</h1><p id="bb54" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">搜索API的调用如下所示:</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="a11e" class="me mf iq ma b gy mg mh l mi mj">es.search(index="testidx", body={<br/>  "query": {<br/>     "match_all": {}<br/>   }<br/> })</span></pre><h1 id="2b14" class="mk mf iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">使用CatClient类(和任何其他类)</h1><p id="57ab" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">当你看一看官方文档时，你会发现这个图书馆有丰富的课程。然而，对于初学者来说，如何调用它们可能会有点困惑。</p><p id="6487" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，CatClient(或弹性术语中的“_ cat”API)的调用是:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/0c77f6afa348ff4a28e4a3668b03f59e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/0*zTVlW_ylViO9xFRb.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/c173f152baef9e2d2cc26de5738e61ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/0*sUncBC2YrCA9odsi.png"/></div></figure><p id="a977" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以导入整个elasticsearch库，并使用现有的“es”对象(您已经建立的连接)作为参数。然后调用方法，在本例中是node()方法:</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="ab8f" class="me mf iq ma b gy mg mh l mi mj">&gt;&gt;&gt; elasticsearch.client.cat.CatClient(es).nodes()<br/>'192.168.1.68 44 85 1 0.07 0.04 0.01 cdfhilmrstw * srvelk8\n'</span></pre><p id="7885" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看起来很奇怪，对吧？还有一个更好的方法:导入类“elasticsearch。Elasticsearch”包括elasticsearch-library的所有类作为对象。让我们看看在该类的__dict__属性中发现了什么:</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="b4b7" class="me mf iq ma b gy mg mh l mi mj">print(es.__dict__['cat'])<br/>&lt;elasticsearch.client.cat.CatClient object at 0x7ff874e24160&gt;</span></pre><p id="560a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果用参数“cat”调用Elasticsearch类，基本上就是调用CatClient类。这样，您可以用相当短的语法调用CatClient类的nodes方法。</p><pre class="kg kh ki kj gt lz ma mb mc aw md bi"><span id="483d" class="me mf iq ma b gy mg mh l mi mj">&gt;&gt;&gt; es.cat.nodes()<br/>'192.168.1.68 44 85 1 0.49 0.22 0.08 cdfhilmrstw * srvelk\n'</span></pre><h1 id="b7f0" class="mk mf iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">代表弹性搜索API的弹性搜索属性表</h1><p id="28df" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">以下是作为对象存储在__dict__中的属性(左)和类(右)的汇编:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/349b4899576176f5528ba04c6061629c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TpCMsnJ9TxhDH18q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="6206" class="mk mf iq bd ml mm nm mo mp mq nn ms mt jw no jx mv jz np ka mx kc nq kd mz na bi translated">结论</h1><p id="feeb" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">如果你成功了，恭喜你！现在，您应该能够使用Python Elasticsearch客户端的所有类，因此也能够使用最常用的Elasticsearch APIs。如有问题，请查阅官方文档或给我留言。你也可以和我联系或者关注<a class="ae kv" href="https://www.linkedin.com/in/pascal-thalmann/" rel="noopener ugc nofollow" target="_blank">链接。</a></p><p id="fcbd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果谷歌把你带到这里，你可能也会检查<a class="ae kv" href="https://pascalth.medium.com/list/python-elasticsearch-workshop-947054f07bd9" rel="noopener">系列</a>的其他部分。下一部分再见！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="0190" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nr">原发布于</em><a class="ae kv" href="https://cdax.ch/2022/02/24/elasticsearch-python-workshop-2-objects-classes-and-how-to-call-them/" rel="noopener ugc nofollow" target="_blank"><em class="nr">https://cdax . ch</em></a><em class="nr">。</em></p></div></div>    
</body>
</html>