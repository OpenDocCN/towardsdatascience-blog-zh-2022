<html>
<head>
<title>Modeling Marketing Mix Using Smoothing Splines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用平滑样条建模营销组合</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/modeling-marketing-mix-using-smoothing-splines-98dc8e84c367#2022-07-15">https://towardsdatascience.com/modeling-marketing-mix-using-smoothing-splines-98dc8e84c367#2022-07-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2d09" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在不明确转换媒体变量的情况下捕捉非线性广告饱和度和收益递减</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c5c5501e7b016cb82202342bd9410c30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cf7bd5ZrpdOe7rfjg7_wbw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Pawel Czerwinski 在<a class="ae kv" href="https://unsplash.com/s/photos/mix-blue?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="2b3d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi ls translated"><span class="l lt lu lv bm lw lx ly lz ma di"> T </span>营销人员建立营销组合模型的方法是应用线性回归模型，该模型假设广告支出等营销活动与响应变量(销售额、收入)之间的关系是线性的。在建模之前，媒体支出变量应该经过两个必要的转换，以正确捕捉广告支出的结转效应和饱和效应。众所周知，广告支出相对于响应变量不是线性的，而是遵循收益递减规律。然而，饱和曲线的函数形式事先并不知道。因此，建模者应该首先假设应用于每个媒体活动渠道的可能转换函数，以匹配真实的花费-响应关系。在本文中，我展示了一种使用平滑样条对营销组合进行建模的替代方法，这是在线性模型框架内对自变量和因变量之间的非线性关系进行建模的方法。通过遵循这种方法，该模型将建立媒体活动变量和响应变量之间的非线性关系，而不需要转换那些独立变量来说明非线性关系。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h2 id="b752" class="mi mj iq bd mk ml mm dn mn mo mp dp mq lf mr ms mt lj mu mv mw ln mx my mz na bi translated">媒体活动变量转换背后的直觉</h2><p id="dce0" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">让我们通过例子来理解为什么媒体活动变量的转换是线性模型框架中的必要步骤。</p><p id="4b79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我生成一个包含广告支出的媒体变量，其饱和效应由hill函数描述，该函数包含两个参数<strong class="ky ir"> γ、</strong>控制拐点，以及<strong class="ky ir"> α </strong>曲线的形状。</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="ef06" class="mi mj iq nh b gy nl nm l nn no">import numpy as np<br/>spend = np.random.rand(1000, 1).reshape(-1)<br/>noise = np.random.normal(size = 1000, scale = 0.2)</span><span id="1bac" class="mi mj iq nh b gy np nm l nn no">#hill transformation<br/>alpha = 2<br/>gamma = 0.1</span><span id="1172" class="mi mj iq nh b gy np nm l nn no">spend_transformed = spend**alpha / (spend ** alpha + gamma ** alpha)</span><span id="a785" class="mi mj iq nh b gy np nm l nn no">response = 1 + 3 * spend_transformed  +  noise</span></pre><p id="2ae7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有关可用于建模饱和效应和收益递减的不同转换函数的概述，您可以查看以下文章:</p><div class="nq nr gp gr ns nt"><a rel="noopener follow" target="_blank" href="/modeling-marketing-mix-using-pymc3-ba18dd9e6e68"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">使用PyMC3建模营销组合</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">实验先验，数据规范化，并比较贝叶斯建模与罗宾，脸书的开源MMM…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">towardsdatascience.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh kp nt"/></div></div></a></div><p id="19b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们绘制支出与响应的关系图:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/e962bc29cc2a5eff0edb6c089c3afbf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*9HI9MkkPVzWiB_8qUNaaEQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="653d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，当我们拟合一个线性回归模型而没有首先转换我们的自变量时，会发生什么？</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="842f" class="mi mj iq nh b gy nl nm l nn no">import statsmodels.api as sm<br/>spend_with_intercept = sm.add_constant(spend)<br/>ols_model = sm.OLS(response, spend_with_intercept)<br/>ols_results = ols_model.fit()<br/>ols_results.params</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/cc2f0f3fe17231ad38574eae7ef3806a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1094/format:webp/1*PsvfUyNmpwpShiQcd2JYZg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="dfe2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如所料，线性回归不能捕捉非线性关系。现在，在现实生活中，此时此刻，我们必须决定转换函数及其参数。让我们使用hill函数来转换我们的支出变量，该函数具有用于模拟响应变量和拟合线性回归模型的略微不同的参数。</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="0ede" class="mi mj iq nh b gy nl nm l nn no"><strong class="nh ir">alpha </strong>= 2<br/><strong class="nh ir">gamma </strong>= 0.3</span><span id="47f3" class="mi mj iq nh b gy np nm l nn no">#hill transformation<br/><strong class="nh ir">spend_transformed </strong>= spend**alpha / (spend ** alpha + gamma ** alpha)</span><span id="1b24" class="mi mj iq nh b gy np nm l nn no">X_hill_transformed = sm.add_constant(spend_transformed)<br/>ols_model_hill_transformed = sm.OLS(response, X_hill_transformed)<br/>ols_results_hill_transformed = ols_model_hill_transformed.fit()<br/>ols_results_hill_transformed.params</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/8648bffcf61923ae035f8cc280bbc82d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*doXL94WG2D8ht-76nLOaZg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="74de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该模型现在捕捉到了非线性，但在支出较低的地区，存在明显的不匹配。让我们用不同的参数值再试一次。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/aaa1517bf202a9879adefbee59d412cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*NfXEDuSLX4XiGeMXJTNj2A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="6d45" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们将gamma值移至更接近用于生成响应的原始值时，我们会得到越来越好的拟合。当然，建模者不会手动尝试不同的参数。相反，这个过程是由超参数优化框架自动完成的。然而，变换步骤仍然需要努力就适当的变换函数和计算时间达成一致，以找到近似的变换参数，从而更好地将模型拟合到数据。</p><p id="09a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有没有办法省略转换步骤，让模型找到非线性关系？是的。在我以前的一篇文章中，我描述了一种实现这一目标的机器学习方法:</p><div class="nq nr gp gr ns nt"><a rel="noopener follow" target="_blank" href="/improving-marketing-mix-modeling-using-machine-learning-approaches-25ea4cd6994b"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">使用机器学习方法改进营销组合建模</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">使用基于树的集合构建MMM模型，并使用SHAP解释媒体通道性能</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">towardsdatascience.com</p></div></div><div class="oc l"><div class="ol l oe of og oc oh kp nt"/></div></div></a></div><p id="a263" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尽管使用基于任意树的机器学习算法的优点是提高了线性回归方法的准确性并处理了非线性，但是一个重要的缺点是这些算法不能像线性模型那样保持很好的可解释性。因此，需要像SHAP这样的额外方法来解释媒体表现，这对营销人员来说可能不是直观的。第二种方法是扩展线性模型，以允许:</p><ul class=""><li id="cbb9" class="om on iq ky b kz la lc ld lf oo lj op ln oq lr or os ot ou bi translated">保持可解释性</li><li id="533d" class="om on iq ky b kz ov lc ow lf ox lj oy ln oz lr or os ot ou bi translated">模拟非线性效应</li></ul><p id="eb50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种扩展被称为广义加法模型，其中非线性效应的建模是通过使用所谓的平滑样条来实现的。</p><h2 id="44bf" class="mi mj iq bd mk ml mm dn mn mo mp dp mq lf mr ms mt lj mu mv mw ln mx my mz na bi translated">广义可加模型(GAM)和光滑样条综述</h2><p id="1462" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">标准(加性)线性模型采用以下形式</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/cabe38860127512728f70ff98747e376.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fHHSkQ8-mA6jTwPj9CEQGw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="6283" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其中，β是系数，ε是误差项。</p><p id="6f84" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">广义加性模型用以下形式扩展了线性回归:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pb"><img src="../Images/63f6e9907141d88bfa9d9d7a99385097.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-qguZVf5zNWwLDRoDdQ3kg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="4512" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其中<em class="pc"> f </em>是一个光滑函数。本质上，GAM将平滑项的和与线性项的和相加。有很多<a class="ae kv" href="https://www.rdocumentation.org/packages/mgcv/versions/1.8-40/topics/smooth.terms" rel="noopener ugc nofollow" target="_blank">平滑函数的方法</a>，其中惩罚平滑样条因其计算效率而被推荐。</p><p id="0f74" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">惩罚平滑样条线的工作方式如下:</p><p id="61de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，数据变量的范围被分成K个不同的区域，具有K个区域边界，称为<em class="pc">结</em>。第二，在每个区域内，低次多项式函数拟合数据。这些低次多项式被称为<em class="pc">基函数。</em>样条是加权基函数的总和，根据数据值进行评估。向最小平方损失函数添加惩罚来控制模型的平滑度。平滑参数<em class="pc">λ</em>控制估计平滑函数<em class="pc"> f </em>的平滑度和波动度之间的权衡。<em class="pc">λ</em>的低值产生未补偿的样条，而<em class="pc">λ</em>的高值产生线性线估计。</p><h2 id="2808" class="mi mj iq bd mk ml mm dn mn mo mp dp mq lf mr ms mt lj mu mv mw ln mx my mz na bi translated">Python中的广义加性模型</h2><p id="9e71" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">让我们回到上一个例子，用惩罚平滑样条拟合支出响应数据。</p><p id="5edf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Python中，<a class="ae kv" href="https://pygam.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> pyGAM </a>是用于构建广义加法模型的包</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="b50d" class="mi mj iq nh b gy nl nm l nn no">pip install pygam</span></pre><p id="25b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我使用<em class="pc"> LinearGAM </em>函数对线性GAM建模。样条项通过使用期望变量索引的<em class="pc"> s </em>函数来定义。<em class="pc"> n_splines </em>控制应该安装多少个<em class="pc">基函数</em>。我将lambda设置为非常低的值0.1，这意味着我几乎不会惩罚样条曲线的摆动</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="46ce" class="mi mj iq nh b gy nl nm l nn no">from pygam import LinearGAM, s<br/>gam_hill = LinearGAM(s(0, n_splines=10), lam = 0.1).fit(spend, response)</span></pre><p id="9cc3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们来理解模型的输出:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="646b" class="mi mj iq nh b gy nl nm l nn no">gam_hill.summary()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pd"><img src="../Images/7edffea0e1377e4e16df5b8607c3b133.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6lboa1vcetoDRu4ytIEA3g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="3942" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">值得一提的重要部分是:</p><ul class=""><li id="f36c" class="om on iq ky b kz la lc ld lf oo lj op ln oq lr or os ot ou bi translated">秩-样条或基函数的数量</li><li id="f50c" class="om on iq ky b kz ov lc ow lf ox lj oy ln oz lr or os ot ou bi translated">λ-平滑参数</li><li id="e46f" class="om on iq ky b kz ov lc ow lf ox lj oy ln oz lr or os ot ou bi translated">EDoF——有效自由度。更高的EDoF意味着更复杂的样条。当EDoF接近1时，表明下划线项是线性的。R(pyGAM的等价物)中的mgcv包的<a class="ae kv" href="https://stat.ethz.ch/R-manual/R-patched/library/mgcv/html/choose.k.html" rel="noopener ugc nofollow" target="_blank">文档建议了以下选择若干样条的经验法则:<br/> <em class="pc">与所有模型假设一样，非正式地检查</em> <code class="fe pe pf pg nh b"><em class="pc">n_splines</em></code> <em class="pc">的选择是有用的。如果模型项的有效自由度估计比</em> <code class="fe pe pf pg nh b"><em class="pc">n_splines-1</em></code> <em class="pc">小得多，那么这不太可能是非常值得的，但是随着EDoF接近</em> <code class="fe pe pf pg nh b"><em class="pc">n_splines-1</em></code> <em class="pc">，检查可能是重要的:增加</em> <code class="fe pe pf pg nh b"><em class="pc">n_splines</em></code> <em class="pc">并改装原始模型。如果这样做没有统计上的重要变化，那么</em> <code class="fe pe pf pg nh b"><em class="pc">n_splines</em></code> <em class="pc">就足够大了。当</em> <code class="fe pe pf pg nh b"><em class="pc">n_splines</em></code> <em class="pc">增加时，平滑度选择标准和/或有效自由度的变化，为拟合是否发生实质性变化提供了明显的数字度量。</em></a></li></ul><p id="6006" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们提取支出部分:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="9b19" class="mi mj iq nh b gy nl nm l nn no">XX = gam_hill.generate_X_grid(term=0, n = len(response))<br/>YY = gam_hill.partial_dependence(term=0, X=XX)</span></pre><p id="dda9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">响应的期望值是包括截距在内的所有单项的总和:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="c633" class="mi mj iq nh b gy nl nm l nn no">intercept_ = gam_hill.coef_[-1]<br/>response_prediction = intercept_ + YY</span></pre><p id="595f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们绘制最终的花费-响应关系图:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/31c4e4cc44d30dc4076738479deb540a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*fFuIdnhwr6a8v4NGWCfz7A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="727b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该模型可以在不转换自变量的情况下捕捉非线性花费-响应关系。</p><p id="cf3e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了完整起见，让我们来看看样条的基函数:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="1b2e" class="mi mj iq nh b gy nl nm l nn no">basis_functions = pd.DataFrame(gam_hill._modelmat(spend).toarray())<br/>basis_functions["spend"] = spend</span><span id="4d2c" class="mi mj iq nh b gy np nm l nn no">#plot<br/>ggplot(pd.melt(basis_functions, id_vars="spend"), aes("spend", "value", group="variable", color = "variable")) + geom_line() + ggtitle(f"{len(basis_functions.columns) - 2} Basis Functions plus Intercept")</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/654fb69e54de616238edc07a076b41fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*E7aU-113OCEmuWQ3z3zkVg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="dcd1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">生成的样条是基函数乘以相应系数的加权和:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="3ac8" class="mi mj iq nh b gy nl nm l nn no">basis = gam_hill._modelmat(spend).toarray()  <br/>coefficients = gam_hill.coef_</span><span id="648e" class="mi mj iq nh b gy np nm l nn no">#omit intercept<br/>spline = basis[:,:-1] @ coefficients[:-1]</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/2bef4ae5c43bfd5651eb0c401c9274db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*vBIeBHJuoAjfSRjPsfe-eA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="d5f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我省略了截距的添加，因此该图显示了支出变量的分解平滑效果。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="0ead" class="pk mj iq bd mk pl pm pn mn po pp pq mq jw pr jx mt jz ps ka mw kc pt kd mz pu bi translated">用广义加法模型模拟营销组合</h1><p id="a414" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">现在，当我们理解了GAM是如何工作的，我将展示如何将它整合到MMM框架中。我将重用我在下面的文章中介绍的框架:</p><div class="nq nr gp gr ns nt"><a rel="noopener follow" target="_blank" href="/improving-marketing-mix-modeling-using-machine-learning-approaches-25ea4cd6994b"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">使用机器学习方法改进营销组合建模</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">使用基于树的集合构建MMM模型，并使用SHAP解释媒体通道性能</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">towardsdatascience.com</p></div></div><div class="oc l"><div class="ol l oe of og oc oh kp nt"/></div></div></a></div><p id="4387" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">变化很小。我用的是GAM，而不是随机森林。解释黑箱模型所必需的SHAP成分不再需要了。由于GAM中成分的线性可加性，我们分析每个平滑媒体变量的影响几乎类似于线性回归模型。</p><h2 id="372c" class="mi mj iq bd mk ml mm dn mn mo mp dp mq lf mr ms mt lj mu mv mw ln mx my mz na bi translated">数据</h2><p id="0074" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">正如在我以前关于MMM的文章中一样，我继续使用由<a class="ae kv" href="https://github.com/facebookexperimental/Robyn" rel="noopener ugc nofollow" target="_blank"> Robyn </a>在麻省理工学院许可下提供的数据集进行基准测试，并通过应用Prophet来分解趋势、季节性和假日，遵循相同的数据准备步骤。</p><p id="d104" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该数据集包含208周的收入(从2015年11月23日到2019年11月11日),包括:</p><ul class=""><li id="2128" class="om on iq ky b kz la lc ld lf oo lj op ln oq lr or os ot ou bi translated">5个媒体消费渠道:电视、网络、印刷品、facebook、搜索</li><li id="36a5" class="om on iq ky b kz ov lc ow lf ox lj oy ln oz lr or os ot ou bi translated">2个也有曝光信息(印象，点击)的媒体渠道:facebook_I，search_clicks_P(本文未使用)</li><li id="9263" class="om on iq ky b kz ov lc ow lf ox lj oy ln oz lr or os ot ou bi translated">无支出有机媒体:时事通讯</li><li id="c8f4" class="om on iq ky b kz ov lc ow lf ox lj oy ln oz lr or os ot ou bi translated">控制变量:事件、假期、竞争对手销售额(competitor_sales_B <strong class="ky ir"> ) </strong></li></ul><p id="d6a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">分析窗口为2016年11月21日至2018年8月20日的92周。</p><h2 id="5953" class="mi mj iq bd mk ml mm dn mn mo mp dp mq lf mr ms mt lj mu mv mw ln mx my mz na bi translated">建模</h2><p id="528e" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">建模步骤与我在上一篇文章中描述的完全相同:</p><div class="nq nr gp gr ns nt"><a rel="noopener follow" target="_blank" href="/improving-marketing-mix-modeling-using-machine-learning-approaches-25ea4cd6994b"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">使用机器学习方法改进营销组合建模</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">使用基于树的集合构建MMM模型，并使用SHAP解释媒体通道性能</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">towardsdatascience.com</p></div></div><div class="oc l"><div class="ol l oe of og oc oh kp nt"/></div></div></a></div><p id="3791" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将提到关于GAM的重要变化。</p><p id="92e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">pyGAM期望输入特性有一个非常非标准的定义。我已经编写了一个助手函数，它采用两种类型的特征:应该建模为线性的特征和应该建模为平滑样条的特征。此外，样条线的数量作为参数提供</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="832c" class="mi mj iq nh b gy nl nm l nn no">def build_gam_formula(data, <br/>                      base_features, <br/>                      smooth_features, <br/>                      n_splines = 20):<br/>    <br/>    #set the first spline term<br/>    channel_index = data.columns.get_loc(smooth_features[0])<br/>    formula = s(<strong class="nh ir">channel_index</strong>, <br/>                <strong class="nh ir">n_splines</strong>, <br/>                <strong class="nh ir">constraints</strong>='monotonic_inc')<br/>    <br/>    for smooth_channel in <strong class="nh ir">smooth_features</strong>[1:]:<br/>        channel_index = data.columns.get_loc(smooth_channel)</span><span id="d8e4" class="mi mj iq nh b gy np nm l nn no">        #smooth term<br/>        formula = formula + s(channel_index, <br/>                              n_splines, <br/>                              <strong class="nh ir">constraints</strong>='monotonic_inc')</span><span id="0809" class="mi mj iq nh b gy np nm l nn no">    for base_feature in <strong class="nh ir">base_features</strong>:<br/>        feature_index = data.columns.get_loc(base_feature)</span><span id="c8c9" class="mi mj iq nh b gy np nm l nn no">        #linear term<br/>        formula = formula + l(feature_index)</span><span id="4c28" class="mi mj iq nh b gy np nm l nn no">return formula</span></pre><p id="daca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">应用于6个媒体通道和5个控制变量的结果公式如下所示:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="ad95" class="mi mj iq nh b gy nl nm l nn no">s(5) + s(6) + s(7) + s(8) + s(9) + s(10) + l(0) + l(1) + l(2) + l(3) + l(4)</span></pre><p id="a6cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，s(5)意味着对数据集中列索引为5的变量应用平滑样条。</p><p id="df02" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意值为<em class="pc"> monotonic_inc. </em>的<em class="pc">约束</em>参数在线性回归的情况下，我们通过将线性系数约束为正来应用一些与饱和效应和收益递减相关的商定业务逻辑，以便广告支出的增加不会导致响应的减少。</p><p id="0e30" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">查看这篇文章了解更多细节:</p><div class="nq nr gp gr ns nt"><a rel="noopener follow" target="_blank" href="/modeling-marketing-mix-with-constrained-coefficients-234b23190ee2"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">用约束系数模拟营销组合</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">如何拟合一个SciPy线性回归并使用RPy2接口从Python调用R岭回归</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">towardsdatascience.com</p></div></div><div class="oc l"><div class="pv l oe of og oc oh kp nt"/></div></div></a></div><p id="9ad0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在GAM的上下文中，我将平滑样条约束为单调递增。</p><h2 id="1627" class="mi mj iq bd mk ml mm dn mn mo mp dp mq lf mr ms mt lj mu mv mw ln mx my mz na bi translated">参数最优化</h2><p id="f273" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">连同5个adstock参数，我为所有变量在0.1和1000之间的范围内优化平滑参数lambda。注意:我不太清楚为什么pyGAM需要为明确定义为线性的变量设置平滑参数。</p><h2 id="3fb6" class="mi mj iq bd mk ml mm dn mn mo mp dp mq lf mr ms mt lj mu mv mw ln mx my mz na bi translated">最终模型</h2><p id="bd72" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">我用92周的时间建立了最终模型。该模型的摘要如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pw"><img src="../Images/43e29a9511dd28867269c67656c98560.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3F64bymbWls2p2GY9eSl3Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="4839" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该摘要示出了6个媒体频道中的3个获得了高平滑λ，并且它们对应的接近1的EDoF表明了几乎线性的关系。</p><p id="e9d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果将误差指标与评估进行比较，GAM获得了比<a class="ae kv" rel="noopener" target="_blank" href="/modeling-marketing-mix-using-pymc3-ba18dd9e6e68">贝叶斯方法</a>更高的准确性，但略低于<a class="ae kv" rel="noopener" target="_blank" href="/improving-marketing-mix-modeling-using-machine-learning-approaches-25ea4cd6994b">随机森林</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi px"><img src="../Images/c2a496ff1f4c335a201fc7c8bad5570d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YEoFDYznE98GLslukhgx1Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h2 id="19a8" class="mi mj iq bd mk ml mm dn mn mo mp dp mq lf mr ms mt lj mu mv mw ln mx my mz na bi translated">收益递减/饱和效应</h2><p id="3dcf" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">让我们画出由此产生的花费-反应关系图。垂直线对应于渠道中的平均花费。x轴是媒体支出。y轴是支出对响应变量的影响</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi py"><img src="../Images/ee73544eb3e0de1401bd833eca196fd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vv_lDrzi2TfYGTyI1OyxjQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi py"><img src="../Images/48d6ec188870b03bc27e6c6d5f9b883f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4swMX2ca5WnHuhztCfmJcg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pz"><img src="../Images/667b3642910748b71d5bf098a3c060e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mNc7eq2HkAOsSqm13-Uc1w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pz"><img src="../Images/a1bb69673c2ea55eb2077beafe93730b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DKKhvDdiNRqf3UGktu6Q-A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pz"><img src="../Images/6aebeab6f1b6f4d93d937d1eabe0baf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BurmeVizlSzpSCqgSEynlw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="fd69" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如在审查最终模型后所预期的那样，几个媒体渠道(search_S，ooh_S)具有线性效应。</p><p id="cbee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以<em class="pc"> facebook_S，</em>为例，我们观察到收益递减的强烈S形，这表明广告支出从接近20万美元开始不会带来任何额外的反应增加。</p><p id="15b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">取<em class="pc"> print_S，</em>其<em class="pc"> </em>响应速度在大约125K花费时下降</p><p id="9e89" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">观察<em class="pc"> search_S，</em>它的响应率几乎线性增加，但速度非常慢。</p><h1 id="609c" class="pk mj iq bd mk pl qa pn mn po qb pq mq jw qc jx mt jz qd ka mw kc qe kd mz pu bi translated">结论</h1><p id="4fe7" class="pw-post-body-paragraph kw kx iq ky b kz nb jr lb lc nc ju le lf nd lh li lj ne ll lm ln nf lp lq lr ij bi translated">在本文中，我展示了另一种营销组合建模方法，即在媒体渠道上应用惩罚平滑样条。这种方法不需要转换媒体支出变量来解释收益递减的非线性。最后，与线性回归模型相比，平滑样条导致更好的模型拟合，这增加了分解效果的可信度。</p><p id="7cf8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完整的代码可以从我的<a class="ae kv" href="https://github.com/slavakx/medium_posts" rel="noopener ugc nofollow" target="_blank"> Github repo </a>下载</p><p id="4ac8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>