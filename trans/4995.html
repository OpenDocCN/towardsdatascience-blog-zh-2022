<html>
<head>
<title>Benchmark your AI’s real-world impact with decision curves</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用决策曲线来衡量你的人工智能对现实世界的影响</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/benchmark-your-ais-real-world-impact-with-decision-curves-7d369a8a6832#2022-11-07">https://towardsdatascience.com/benchmark-your-ais-real-world-impact-with-decision-curves-7d369a8a6832#2022-11-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/2c57c6d0569dd6e6b4fce4da6a33917f.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*Qc3sam3F3MbmtsRZgOQo-Q.jpeg"/></div><p class="ju jv gj gh gi jw jx bd b be z dk translated">图1:用人工智能做决策。图片作者。</p></figure><p id="b517" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">行动是有后果的。人工智能的进步让我们在数据驱动的预测方面表现出色。但是没有行动的预测有什么用呢？人工智能以预测为中心的焦点为现实世界的影响和后果创造了一个盲点。但是有了做决定的权力，就有了权衡自己行为后果的责任。这就是决策曲线分析[1–4]发挥作用的地方。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="3a5b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">决策曲线分析是一种图形方法，最初是为病人和医生设计的[1]。它将医学干预的好处和坏处——后果<em class="ld"/>——与医学测试的不确定性——预测<em class="ld"/>联系起来。决策曲线分析背后的关键创新在于，我们不必详尽地量化所有后果。我们需要问的是:在多大的可能性下，你会选择干预而不是不干预？</p><h1 id="ae34" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">例子</h1><figure class="md me mf mg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mc"><img src="../Images/eadf9057ce5b295fab97d2841babd473.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ipw19INseZ69RMLNFQVY6Q.png"/></div></div><p class="ju jv gj gh gi jw jx bd b be z dk translated">图2:提供抵押贷款的决策树。借款人偿还贷款的概率为<em class="ml"> p，</em>。图片作者。</p></figure><p id="b306" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">决策曲线分析并不局限于医学领域。它适用于我们基于二元预测任务采取行动的任何情况。例如，考虑一家提供抵押贷款的银行。为了实现利润最大化，银行不会向所有人发放抵押贷款。相反，它估计违约的可能性(<em class="ld">预测</em>)，以决定客户是否会获得抵押贷款(<em class="ld">行动</em>)。如果银行太严格，它会错过有利可图的客户。而过于宽容的银行家会招致更多的违约。使用如图2所示的决策树，我们可以遍历所有场景。通过估计每项成本，我们可以确定最佳策略。</p><p id="8e81" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在许多情况下，很难确定每种情况的利弊，或者成本很高。例如，当CT扫描本身可以在健康个体中导致癌症时，我们应该如何权衡癌症筛查的阳性检测？此外，每种情况的相对优点都是主观的:一个脆弱的老人可能会权衡癌症检测的后果，这不同于一个有年幼孩子的精力充沛的母亲。</p><p id="ce67" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们通过绘制你的第一条净收益曲线来应用这些概念！</p><h1 id="7169" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">如何用Python绘制决策曲线</h1><p id="28b9" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">想象一下，你在银行工作。你的目标是预测哪些客户会偿还抵押贷款，哪些会违约。我们给出了20个带有两个特征的训练例子:收入和年龄。</p><pre class="md me mf mg gt mr ms mt mu aw mv bi"><span id="d9bb" class="mw lf iq ms b gy mx my l mz na"><strong class="ms ir">from</strong> matplotlib <strong class="ms ir">import</strong> pyplot as plt<br/><strong class="ms ir">from</strong> sklearn.datasets <strong class="ms ir">import</strong> make_blobs</span><span id="41b7" class="mw lf iq ms b gy nb my l mz na">centers = [[0, 0], [1, 1]]<br/>X_train, y_train = make_blobs(<br/>    centers=centers, cluster_std=1, n_samples=20, random_state=5<br/>)<br/>X_test, y_test = make_blobs(<br/>    centers=centers, cluster_std=1, n_samples=20, random_state=1005<br/>)</span></pre><p id="fa0f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">查看数据(图3)，我们发现我们无法用一条直线完美地将十字和圆圈分开。我们的预测器可能不错，但并不完美。</p><figure class="md me mf mg gt jr gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/9ab542bfb2f7b484e3857ecac1fd18a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*0Wx7p0MOn_6m4LyGeKolFQ.png"/></div><p class="ju jv gj gh gi jw jx bd b be z dk translated">图3:训练数据来预测将拖欠抵押贷款的客户。阳性标签用红叉表示，阴性标签用蓝圈表示。图片作者。</p></figure><p id="700e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了展示模型在优势上的差异，让我们训练两个模型。作为简单基线的逻辑回归模型和梯度增强树模型。</p><pre class="md me mf mg gt mr ms mt mu aw mv bi"><span id="e02d" class="mw lf iq ms b gy mx my l mz na"><strong class="ms ir">from</strong> sklearn.ensemble <strong class="ms ir">import</strong> GradientBoostingClassifier<br/><strong class="ms ir">from</strong> sklearn.linear_model <strong class="ms ir">import</strong> LogisticRegression</span><span id="0721" class="mw lf iq ms b gy nb my l mz na">baseline_model = LogisticRegression(random_state=5)<br/>baseline_model.fit(X_train, y_train)<br/>tree_model = GradientBoostingClassifier(random_state=5)<br/>tree_model.fit(X_train, y_train)</span></pre><p id="ebfe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">比较这两个模型，我们发现梯度增强树在测试集(90 %的准确度)上比逻辑回归模型(85 %的准确度)做得稍好。</p><p id="c420" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们使用<a class="ae ng" href="https://gitlab.com/hylkedonker/statkit" rel="noopener ugc nofollow" target="_blank"> statkit </a>包中的<code class="fe nd ne nf ms b"><a class="ae ng" href="https://hylkedonker.gitlab.io/statkit/decision.html#statkit.decision.NetBenefitDisplay" rel="noopener ugc nofollow" target="_blank">NetBenefitDisplay</a></code>类来绘制净收益图。(要在Linux上安装statkit，运行<code class="fe nd ne nf ms b">pip3 install statkit</code>)。类似于sci-kit learn，它有一个<code class="fe nd ne nf ms b">from_predictions</code>方法来实例化来自地面真相标签(<code class="fe nd ne nf ms b">y_test</code>)和预测的正类概率的情节。</p><pre class="md me mf mg gt mr ms mt mu aw mv bi"><span id="3ef4" class="mw lf iq ms b gy mx my l mz na"><strong class="ms ir">from</strong> statkit.decision <strong class="ms ir">import</strong> NetBenefitDisplay</span><span id="24d3" class="mw lf iq ms b gy nb my l mz na">y_pred_base = baseline_model.predict_proba(X_test)[:, 1]<br/>y_pred_tree = tree_model.predict_proba(X_test)[:, 1]</span><span id="a33f" class="mw lf iq ms b gy nb my l mz na">NetBenefitDisplay.from_predictions(y_test, y_pred_base, name='Baseline model')<br/>NetBenefitDisplay.from_predictions(y_test, y_pred_tree, name='Gradient boosted trees', show_references=False, ax=plt.gca())</span></pre><p id="191e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一个相当忙碌的数字，所以让我们把它分成四个要点。</p><figure class="md me mf mg gt jr gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/b0a86b395682850a37c919c4a20d3033.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*8Ui2oItWIoXTFeyypun-ZA.png"/></div><p class="ju jv gj gh gi jw jx bd b be z dk translated">图4:比较逻辑回归与梯度提升树模型和完美预测器(Oracle)的净收益曲线。为了比较，示出了对应于总是或从不行动/干预政策的净收益。图片作者。</p></figure><p id="0220" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">越高越好</strong>:排名比差距大小更重要【2】。由<strong class="ka ir"> Oracle </strong>指示的线是可达到的最大净收益，对应于一个完美的预测值。现在看看蓝色逻辑回归和紫色梯度增强树曲线之间的排序。对于大多数可能的利益/危害偏好，梯度提升树优于逻辑回归模型。</p><p id="b450" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">净收益应该是正的</strong>:理论上净收益可以是负的，意味着弊大于利。但是请注意<strong class="ka ir">永不行动</strong>政策(绿点虚线)的净收益为零。所以我们总是可以决定不行动(忽略模型)并获得至少零净收益。</p><p id="41bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">更精确的模型可能会逊色</strong>:对于银行来说，相对于付费客户的收益，房贷违约的危害很大。假设银行希望每十个客户中不超过一个违约。这对应于曲线的最右侧，概率阈值在0.9和1之间。记住梯度推进树比逻辑回归模型更准确。然而，看图4，我们看到在这个范围内，逻辑回归实际上有更多的净效益。越不精确的模型对银行越有利可图！</p><p id="7ccf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">模型可能是无用的</strong>:在0到0.1的概率阈值范围内(图4)，逻辑回归模型的净收益类似于<strong class="ka ir">总是行动</strong>策略。因此，如果你的“金发女孩”偏好恰好在这个范围内，那么逻辑回归模型就没有现实世界的影响。因此，净收益曲线有助于澄清你的模型是否有实际价值，考虑到人工智能产生的大量技术债务，这一点很重要[5]。</p><h1 id="71a2" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">理论</h1><p id="2809" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">再次重申，决策曲线分析消除了详尽量化所有方案的优点的需要[1]。我们需要引出的只是一个<strong class="ka ir">偏好</strong> <em class="ld"> π </em>:为了一个真正的阳性(癌症检测、抵押贷款支付)，我们愿意采取多少行动/干预(癌症筛查、抵押贷款)？这个概率阈值<em class="ld"> π </em> — <em class="ld">偏好</em> —就是我们放在决策曲线的<em class="ld"> x </em>轴上的值。隐含地，preference <em class="ld"> π </em>将假阳性与假阴性的相对危害编成法典[1]。在医疗保健和金融等监管部门，这种偏好也可能受到法规遵从性和/或协议的限制。</p><p id="9200" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">给定一个偏好<em class="ld"> π </em>，我们可以计算出<em class="ld"> m个</em>样本的<strong class="ka ir">净收益</strong>如下[1–4]:</p><p id="23bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">净收益=真阳性/ <em class="ld"> m </em> —假阳性/<em class="ld">m</em><em class="ld">π</em>/(1-<em class="ld">π</em>)。</p><p id="237b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">也就是说，从行动/干预中获利的个人减去从行动/干预中损失的个人乘以<em class="ld">汇率</em>【1–3】。汇率<em class="ld"> π </em> /(1- <em class="ld"> π </em>)量化了我们如何评估从假阳性到真阳性的转换[2，3]。接下来是简洁的部分:通过追踪作为偏好<em class="ld"> π </em>的函数的净收益，我们在所有可能的后果评估中评估模型的收益。结果的每个具体损益分配(如图2中的决策树)现在对应于<em class="ld"> π </em>的值。单一图形中所有可能性的空间！</p><h1 id="27d4" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="4e1d" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">当你使用AI做决定时，重要的是权衡其后果的好处和坏处。这就是决策曲线分析的用武之地。净收益曲线作为一座桥梁，将模型世界和(校准的)预测与行动和结果连接起来，无需详尽量化所有情景。</p><p id="c758" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">矛盾的是，更精确的模型在现实世界的影响方面可能是劣势的。而且有时候还不如完全没有AI！决策曲线帮助您在部署到生产环境之前，而不是之后，识别并避免这些常见的陷阱。因此，我们认为决策曲线分析应该是每个数据科学家工作流程的一部分。</p><h2 id="5c5c" class="mw lf iq bd lg ni nj dn lk nk nl dp lo kj nm nn ls kn no np lw kr nq nr ma ns bi translated">承认</h2><p id="f9db" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">感谢<a class="nt nu ep" href="https://medium.com/u/6eef7d9a8ac6?source=post_page-----7d369a8a6832--------------------------------" rel="noopener" target="_blank">布拉姆·范·埃斯</a>、<a class="ae ng" href="https://huijzer.xyz/" rel="noopener ugc nofollow" target="_blank">里克·胡伊泽</a>和迪娜·波尔的校对。</p><h2 id="dcb1" class="mw lf iq bd lg ni nj dn lk nk nl dp lo kj nm nn ls kn no np lw kr nq nr ma ns bi translated">参考</h2><p id="e6de" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">[1]:维克斯、安德鲁j和埃琳娜b埃尔金。<a class="ae ng" href="https://journals.sagepub.com/doi/abs/10.1177/0272989x06295361?casa_token=PxrNVdoM_ZIAAAAA:GlIx5SvTvEFWBUTVLAnadpnN5FVMllEk5EizCqjAaJCI7wa5YxzrAnFsFGiy75nL10AnvR8SMhQ" rel="noopener ugc nofollow" target="_blank">决策曲线分析:评估预测模型的新方法</a>医疗决策26.6(2006):565–574。</p><p id="f66e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[2]:维克斯、安德鲁·j、本·范·卡尔斯特和埃沃特·w·斯特耶伯格。<a class="ae ng" href="https://diagnprognres.biomedcentral.com/articles/10.1186/s41512-019-0064-7" rel="noopener ugc nofollow" target="_blank">解释决策曲线分析的简单、逐步指南</a>。<em class="ld">诊断和预后研究</em>3.1(2019):1–8。</p><p id="8f8f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[3]:维克斯、安德鲁·j、本·范·卡尔斯特和埃沃特·w·斯特耶伯格。<a class="ae ng" href="https://www.bmj.com/content/352/bmj.i6.short" rel="noopener ugc nofollow" target="_blank">评估预测模型、分子标记和诊断测试的净效益方法</a><em class="ld"> bmj </em> 352 (2016)。</p><p id="5370" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[4]:鲁松、瓦伦丁和托马斯·宗布伦。<a class="ae ng" href="https://bmcmedinformdecismak.biomedcentral.com/articles/10.1186/1472-6947-11-45" rel="noopener ugc nofollow" target="_blank">重新审视决策曲线分析:总体净收益、与ROC曲线分析的关系以及在病例对照研究中的应用</a>。<em class="ld"> BMC医学信息学和决策</em>11.1(2011):1–9。</p><p id="4c58" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[5]:斯卡利、大卫等.<a class="ae ng" href="https://proceedings.neurips.cc/paper/2015/file/86df7dcfd896fcaf2674f757a2463eba-Paper.pdf" rel="noopener ugc nofollow" target="_blank">机器学习系统中隐藏的技术债务</a><em class="ld">神经信息处理系统进展</em> 28 (2015)。</p></div></div>    
</body>
</html>