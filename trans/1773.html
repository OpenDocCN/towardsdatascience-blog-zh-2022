<html>
<head>
<title>Interacting With Environment Variables in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Python中与环境变量交互</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/environment-variables-python-aecb9bf01b85#2022-04-26">https://towardsdatascience.com/environment-variables-python-aecb9bf01b85#2022-04-26</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="26ec" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">使用Python访问、导出和取消设置环境变量</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/8a556474ca5ba5df54a25bb485e2d9a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D6u4dAd74_iHgzGn_CPKyw.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@clarissemeyer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Clarisse Meyer </a>在<a class="ae kz" href="https://unsplash.com/s/photos/access?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h2 id="29cc" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">介绍</h2><p id="26a7" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">某些应用程序可能不得不使用已经在程序本身之外初始化的变量，而是在源代码应该被执行的环境中。</p><p id="4d79" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">环境变量被指定为执行流程(如Python应用程序)的环境的一部分。它由一个名称/值对组成，可以在任何给定时间被访问、覆盖和取消设置。这种变量通常直接在命令行界面上定义，或者用bash脚本定义(例如，在操作系统启动时)。然而，甚至软件程序本身也可以与它们进行交互。</p><p id="3961" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">在今天的简短教程中，我们将展示<strong class="ly iv">如何以编程方式访问覆盖和取消设置现有的环境变量，以及如何导出新的环境变量</strong>。最后，我们还将演示几种检查环境变量是否存在的方法。</p></div><div class="ab cl mu mv hy mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="in io ip iq ir"><h2 id="2148" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">访问环境变量</h2><p id="e8cb" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">首先，我们将演示如何以编程方式访问已经作为执行Python应用程序的环境的一部分导出的环境变量。</p><p id="8048" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">假设系统管理员已经用值<code class="fe nb nc nd ne b">dev</code>初始化了一个名为<code class="fe nb nc nd ne b">ENV</code>的环境变量:</p><pre class="kk kl km kn gu nf ne ng nh aw ni bi"><span id="25e9" class="la lb iu ne b gz nj nk l nl nm">$ export ENV=dev</span></pre><p id="1c0f" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">我们可以通过命令行回显该值来验证环境变量是否已经初始化:</p><pre class="kk kl km kn gu nf ne ng nh aw ni bi"><span id="065d" class="la lb iu ne b gz nj nk l nl nm">$ echo ENV<br/>dev</span></pre><p id="efcf" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">现在，如果我们想用Python编程访问环境变量，我们需要使用<code class="fe nb nc nd ne b"><strong class="ly iv">os.environ</strong></code>映射对象:</p><blockquote class="nn no np"><p id="8dea" class="lw lx nq ly b lz mp jv mb mc mq jy me nr mr mg mh ns ms mj mk nt mt mm mn mo in bi translated">一个<a class="ae kz" href="https://docs.python.org/3/glossary.html#term-mapping" rel="noopener ugc nofollow" target="_blank">映射</a>对象，其中键和值是表示流程环境的字符串。例如，<code class="fe nb nc nd ne b">environ['HOME']</code>是你的主目录的路径名(在某些平台上)，相当于c中的<code class="fe nb nc nd ne b">getenv("HOME")</code></p><p id="414a" class="lw lx nq ly b lz mp jv mb mc mq jy me nr mr mg mh ns ms mj mk nt mt mm mn mo in bi translated">这个映射是在第一次导入<code class="fe nb nc nd ne b"><a class="ae kz" href="https://docs.python.org/3/library/os.html#module-os" rel="noopener ugc nofollow" target="_blank">os</a></code>模块时捕获的，通常是在Python启动时作为处理<code class="fe nb nc nd ne b">site.py</code>的一部分。除了通过直接修改<code class="fe nb nc nd ne b">os.environ</code>所做的更改外，在此时间之后对环境所做的更改不会反映在<code class="fe nb nc nd ne b">os.environ</code>中。</p><p id="b741" class="lw lx nq ly b lz mp jv mb mc mq jy me nr mr mg mh ns ms mj mk nt mt mm mn mo in bi translated">- <a class="ae kz" href="https://docs.python.org/3/library/os.html#os.environ" rel="noopener ugc nofollow" target="_blank"> Python文档</a></p></blockquote><p id="518b" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">你可以使用环境变量名作为<code class="fe nb nc nd ne b">os.environ</code>对象的键来推断值:</p><pre class="kk kl km kn gu nf ne ng nh aw ni bi"><span id="7c29" class="la lb iu ne b gz nj nk l nl nm">import os</span><span id="ab5a" class="la lb iu ne b gz nu nk l nl nm"><strong class="ne iv">env_var = os.environ['ENV']</strong><br/>print(f'Currently working in {env_var} environment'.</span></pre><p id="6173" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">上面表达式的问题是，如果环境变量<code class="fe nb nc nd ne b">ENV</code>不在环境中，它将会以<code class="fe nb nc nd ne b">KeyError</code>失败。因此，最好使用<code class="fe nb nc nd ne b">os.environ.get()</code>来访问它。如果不存在，它会简单地返回<code class="fe nb nc nd ne b">None</code>而不是抛出一个<code class="fe nb nc nd ne b">KeyError</code>。</p><pre class="kk kl km kn gu nf ne ng nh aw ni bi"><span id="51dd" class="la lb iu ne b gz nj nk l nl nm">import os</span><span id="15d9" class="la lb iu ne b gz nu nk l nl nm"><strong class="ne iv">env_var = </strong><strong class="ne iv">os.environ.get('</strong><strong class="ne iv">ENV</strong><strong class="ne iv">')</strong><br/>print(f'Currently working in {env_var} environment'.</span></pre><p id="00dc" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">接下来，如果环境变量尚未初始化，您甚至可能需要设置一个默认值:</p><pre class="kk kl km kn gu nf ne ng nh aw ni bi"><span id="412b" class="la lb iu ne b gz nj nk l nl nm">import os</span><span id="ed18" class="la lb iu ne b gz nu nk l nl nm"><strong class="ne iv">env_var = </strong><strong class="ne iv">os.environ.get('</strong><strong class="ne iv">ENV</strong><strong class="ne iv">', 'DEFAULT_VALUE')</strong><br/>print(f'Currently working in {env_var} environment'.</span></pre><p id="cf23" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">显然，另一种选择是捕捉<code class="fe nb nc nd ne b">KeyError</code>，但是我认为这对于这种操作来说可能是一种过度的破坏:</p><pre class="kk kl km kn gu nf ne ng nh aw ni bi"><span id="7acc" class="la lb iu ne b gz nj nk l nl nm">import os</span><span id="832b" class="la lb iu ne b gz nu nk l nl nm">try:<br/>    env_var = os.environ['ENV']<br/>except KeyError:<br/>    # Do something<br/>    ...</span></pre></div><div class="ab cl mu mv hy mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="in io ip iq ir"><h2 id="c0ad" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">导出或覆盖环境变量</h2><p id="fd1d" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">如果您想要导出或者甚至覆盖一个现有的环境变量，那么您可以在<code class="fe nb nc nd ne b">os.environ</code>对象上使用一个简单的赋值:</p><pre class="kk kl km kn gu nf ne ng nh aw ni bi"><span id="4a02" class="la lb iu ne b gz nj nk l nl nm">import os</span><span id="3bba" class="la lb iu ne b gz nu nk l nl nm">os.environ['ENV'] = 'dev'</span></pre><p id="2bc5" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">现在使用<code class="fe nb nc nd ne b">try-except</code>符号可能更有意义:</p><pre class="kk kl km kn gu nf ne ng nh aw ni bi"><span id="c906" class="la lb iu ne b gz nj nk l nl nm">import os</span><span id="fdf6" class="la lb iu ne b gz nu nk l nl nm">try:<br/>    env_var = os.environ['ENV']<br/>except KeyError:<br/>    os.environ['ENV'] = 'dev'</span></pre></div><div class="ab cl mu mv hy mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="in io ip iq ir"><h2 id="eec6" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">检查环境变量是否存在</h2><p id="45c8" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">我们已经部分介绍了这一部分，但是我还将演示一些检查环境变量是否存在的其他方法。</p><p id="c4d8" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">第一种方法是简单地使用变量名作为关键字访问<code class="fe nb nc nd ne b">os.environ</code>对象，并捕获表示环境变量不存在的<code class="fe nb nc nd ne b">KeyError</code>:</p><pre class="kk kl km kn gu nf ne ng nh aw ni bi"><span id="a06d" class="la lb iu ne b gz nj nk l nl nm">import os</span><span id="a566" class="la lb iu ne b gz nu nk l nl nm">try:<br/>    env_var = os.environ['ENV']<br/>    print('ENV environment variable exists')<br/>except KeyError:<br/>    print('ENV environment variable does not exist')</span></pre><p id="2867" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">另一种方法是简单地检查环境变量是否是<code class="fe nb nc nd ne b">os.environ</code>对象的成员:</p><pre class="kk kl km kn gu nf ne ng nh aw ni bi"><span id="252a" class="la lb iu ne b gz nj nk l nl nm">import os </span><span id="61f8" class="la lb iu ne b gz nu nk l nl nm">env_var_exists = 'ENV' in os.environ</span></pre><p id="148f" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">第三种方法是检查<code class="fe nb nc nd ne b">os.environ.get()</code>方法是否返回<code class="fe nb nc nd ne b">None</code>(没有指定默认值):</p><pre class="kk kl km kn gu nf ne ng nh aw ni bi"><span id="95f1" class="la lb iu ne b gz nj nk l nl nm">import os</span><span id="9074" class="la lb iu ne b gz nu nk l nl nm">env_var = os.environ.get('ENV')</span><span id="8683" class="la lb iu ne b gz nu nk l nl nm">if not env_var:<br/>    print('ENV environment variable does not exist')</span></pre><p id="9fe7" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">最后，您甚至可以使用<code class="fe nb nc nd ne b">has_key()</code>方法来检查环境变量名是否作为关键字包含在<code class="fe nb nc nd ne b">os.environ</code>映射对象中:</p><pre class="kk kl km kn gu nf ne ng nh aw ni bi"><span id="38d6" class="la lb iu ne b gz nj nk l nl nm">import os</span><span id="d2e4" class="la lb iu ne b gz nu nk l nl nm">env_var_exists = <!-- -->os.environ.has_key('ENV')</span></pre></div><div class="ab cl mu mv hy mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="in io ip iq ir"><h2 id="db64" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">取消设置环境变量</h2><p id="8b0e" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">现在为了取消设置环境变量，您可以调用<code class="fe nb nc nd ne b">del</code>操作:</p><pre class="kk kl km kn gu nf ne ng nh aw ni bi"><span id="6c9b" class="la lb iu ne b gz nj nk l nl nm">del os.environ['ENV']</span></pre><p id="8515" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">同样，如果<code class="fe nb nc nd ne b">ENV</code>没有初始化，上面的表达式将失败，因此它从<code class="fe nb nc nd ne b">os.environ</code>映射对象中丢失。</p><p id="3b1c" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">为了避免这种情况，您可以使用if语句</p><pre class="kk kl km kn gu nf ne ng nh aw ni bi"><span id="2943" class="la lb iu ne b gz nj nk l nl nm">import os</span><span id="7185" class="la lb iu ne b gz nu nk l nl nm">if 'ENV' in os.environ:<br/>    <!-- -->del os.environ['ENV']</span></pre><p id="789a" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">或者，一种更优雅的方式是从映射对象中调用<code class="fe nb nc nd ne b">pop</code>环境变量，如下所示。</p><pre class="kk kl km kn gu nf ne ng nh aw ni bi"><span id="f979" class="la lb iu ne b gz nj nk l nl nm">os.environ.pop('ENV', None)</span></pre></div><div class="ab cl mu mv hy mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="in io ip iq ir"><h2 id="78f3" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">最后的想法</h2><p id="f311" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">在今天的文章中，我们讨论了环境变量的重要性，以及它们如何与正在运行的Python应用程序进行交互。更具体地说，我们展示了如何用Python编程访问、取消设置甚至导出环境变量。</p><p id="179c" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">同样重要的是要提到，环境变量通常不会只被您自己的Python应用程序使用，因此您要确保以一种不会使环境处于可能中断其他应用程序甚至更糟的状态的方式与它们交互，从而错误地影响其他进程的执行流程。</p></div><div class="ab cl mu mv hy mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="in io ip iq ir"><p id="1b77" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated"><a class="ae kz" href="https://gmyrianthous.medium.com/membership" rel="noopener"> <strong class="ly iv">成为会员</strong> </a> <strong class="ly iv">阅读媒介上的每一个故事。你的会员费直接支持我和你看的其他作家。你也可以在媒体上看到所有的故事。</strong></p><div class="nv nw gq gs nx ny"><a href="https://gmyrianthous.medium.com/membership" rel="noopener follow" target="_blank"><div class="nz ab fp"><div class="oa ab ob cl cj oc"><h2 class="bd iv gz z fq od fs ft oe fv fx it bi translated">通过我的推荐链接加入Medium-Giorgos Myrianthous</h2><div class="of l"><h3 class="bd b gz z fq od fs ft oe fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="og l"><p class="bd b dl z fq od fs ft oe fv fx dk translated">gmyrianthous.medium.com</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om kt ny"/></div></div></a></div></div><div class="ab cl mu mv hy mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="in io ip iq ir"><p id="676e" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated"><strong class="ly iv">相关文章你可能也喜欢</strong></p><div class="nv nw gq gs nx ny"><a rel="noopener follow" target="_blank" href="/16-must-know-bash-commands-for-data-scientists-d8263e990e0e"><div class="nz ab fp"><div class="oa ab ob cl cj oc"><h2 class="bd iv gz z fq od fs ft oe fv fx it bi translated">数据科学家必须知道的16个Bash命令</h2><div class="of l"><h3 class="bd b gz z fq od fs ft oe fv fx dk translated">探索一些最常用的bash命令</h3></div><div class="og l"><p class="bd b dl z fq od fs ft oe fv fx dk translated">towardsdatascience.com</p></div></div><div class="oh l"><div class="on l oj ok ol oh om kt ny"/></div></div></a></div></div><div class="ab cl mu mv hy mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu ny"><a rel="noopener follow" target="_blank" href="/setuptools-python-571e7d5500f2"><div class="nz ab fp"><div class="oa ab ob cl cj oc"><h2 class="bd iv gz z fq od fs ft oe fv fx it bi translated">Python中的setup.py与setup.cfg</h2><div class="of l"><h3 class="bd b gz z fq od fs ft oe fv fx dk translated">使用setuptools管理依赖项和分发Python包</h3></div><div class="og l"><p class="bd b dl z fq od fs ft oe fv fx dk translated">towardsdatascience.com</p></div></div><div class="oh l"><div class="oo l oj ok ol oh om kt ny"/></div></div></a></div></div><div class="ab cl mu mv hy mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu ny"><a href="https://betterprogramming.pub/kafka-cli-commands-1a135a4ae1bd" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fp"><div class="oa ab ob cl cj oc"><h2 class="bd iv gz z fq od fs ft oe fv fx it bi translated">用于日常编程的15个Kafka CLI命令</h2><div class="of l"><h3 class="bd b gz z fq od fs ft oe fv fx dk translated">演示最常用的Kafka命令行界面命令的使用</h3></div><div class="og l"><p class="bd b dl z fq od fs ft oe fv fx dk translated">better编程. pub</p></div></div><div class="oh l"><div class="op l oj ok ol oh om kt ny"/></div></div></a></div></div></div>    
</body>
</html>