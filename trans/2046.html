<html>
<head>
<title>How to Use Hamilton with Pandas in 5 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在5分钟内将汉密尔顿用于熊猫</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-use-hamilton-with-pandas-in-5-minutes-89f63e5af8f5#2022-05-09">https://towardsdatascience.com/how-to-use-hamilton-with-pandas-in-5-minutes-89f63e5af8f5#2022-05-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/0e50d53894669ed7e47459301131a095.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*R0Mm7UErBX3N-DeN5hv5Wg.png"/></div><p class="ju jv gj gh gi jw jx bd b be z dk translated">这个帖子的感悟(非真实代码)。图片作者。</p></figure><p id="b129" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">汉密尔顿是一个开源的、声明性的Python数据流微框架。在这篇文章中，我将尝试快速解释它是什么以及如何在熊猫身上使用它；阅读这篇文章不会花费你超过五分钟的时间。关于背景故事和更长的介绍，我们邀请你阅读这篇<a class="ae kw" rel="noopener" target="_blank" href="/functions-dags-introducing-hamilton-a-microframework-for-dataframe-generation-more-8e34b84efc1d"> TDS帖子</a>。</p><h1 id="4c18" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">什么是汉密尔顿？</h1><p id="fab8" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Hamilton是一种自以为是的编写python数据转换函数的方式。它迫使两件事:</p><ol class=""><li id="f2ec" class="ma mb iq ka b kb kc kf kg kj mc kn md kr me kv mf mg mh mi bi translated">您编写声明性的python函数来封装您的数据转换逻辑。</li><li id="0124" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">从运行时逻辑中分离出转换逻辑。</li></ol><h2 id="487b" class="mo ky iq bd kz mp mq dn ld mr ms dp lh kj mt mu ll kn mv mw lp kr mx my lt mz bi translated">这到底是什么意思？</h2><p id="2310" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">对于上面的第(1)点，不要编写操作数据帧的Pandas代码，它看起来像这样:</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="d047" class="mo ky iq nf b gy nj nk l nl nm">df['age_mean'] = df['age'].mean()<br/>df['age_zero_mean'] = df['age'] - df['age_mean']<br/>df['age_std_dev'] = df['age'].std()<br/>df['age_zero_mean_unit_variance'] = df['age_zero_mean'] / df['age_std_dev']</span></pre><p id="10e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你应该这样写:</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="20fa" class="mo ky iq nf b gy nj nk l nl nm"># a_function_module.py<br/>def age_mean(age: pd.Series) -&gt; float:<br/>    <em class="nn">"""Average of age"""<br/>    </em>return age.mean()<br/><br/><br/>def age_zero_mean(age: pd.Series<strong class="nf ir">, </strong>age_mean: float) -&gt; pd.Series:<br/>    <em class="nn">"""Zero mean of age"""<br/>    </em>return age - age_mean<br/><br/><br/>def age_std_dev(age: pd.Series) -&gt; pd.Series:<br/>    <em class="nn">"""Standard deviation of age."""<br/>    </em>return age.std()<br/><br/><br/>def age_zero_mean_unit_variance(age_zero_mean: pd.Series<strong class="nf ir">, </strong>age_std_dev: pd.Series) -&gt; pd.Series:<br/>    <em class="nn">"""Zero mean unit variance value of age"""<br/>    </em>return age_zero_mean / age_std_dev</span></pre><p id="5bed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">没有要操作的中心dataframe对象。相反，你在“专栏”中思考，并且只思考你需要表达什么来创建一个特定的专栏。</p><p id="8edb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">更具体地说，函数使用<em class="nn">函数名</em>声明它们输出的内容，并使用<em class="nn">函数参数</em>声明它们需要的输入内容。计算的逻辑完全包含在函数中，这就是我们所说的封装。函数名很重要，因为它映射到您可以<em class="nn">请求</em>输出的内容。</p><p id="310f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nn">记住函数如何映射到Pandas数据帧的一个快速方法是，函数名映射到列，函数参数映射到其他列或其他输入。</em></p><p id="060b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于第(2)点，您的变换函数位于python模块中，该模块独立于用于获取数据帧的脚本。也就是说，要实际计算上述内容，您需要编写一个如下所示的文件:</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="b94d" class="mo ky iq nf b gy nj nk l nl nm">import pandas as pd<br/>from hamilton import driver</span><span id="66d2" class="mo ky iq nf b gy no nk l nl nm">import a_function_module # where your transforms live<br/><br/>dr = driver.Driver({'age': pd.Series([...])}<strong class="nf ir">, </strong>a_function_module)</span><span id="7a62" class="mo ky iq nf b gy no nk l nl nm"># Here we're only requesting two outputs, but you could additionally <br/># request `age_mean`, `age_zero_mean`, `age_std_dev` ...<br/>df = dr.execute(['age', 'age_zero_mean_unit_variance'])</span></pre><p id="48ee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这迫使你遵循一个被称为解耦的软件工程原则。解耦对于数据工作来说是一个好主意，因为这意味着你的转换函数不关心你如何加载或获取数据，它们只关心计算。这意味着在其他上下文中重用您的Hamilton数据转换函数非常、非常、容易——而且不会影响任何人。</p><h2 id="293c" class="mo ky iq bd kz mp mq dn ld mr ms dp lh kj mt mu ll kn mv mw lp kr mx my lt mz bi translated">使用汉密尔顿的好处</h2><p id="e483" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">无需深究细节，只要仔细想想就会明白，以下是汉密尔顿做事方式带来的一些好处:</p><ol class=""><li id="da8c" class="ma mb iq ka b kb kc kf kg kj mc kn md kr me kv mf mg mh mi bi translated">所有Hamilton数据转换函数都是100%单元可测试的。函数的声明性意味着传递测试数据非常容易！</li><li id="2c6c" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">所有汉密尔顿数据转换函数都是100%文档友好的。每个功能都有一个有目的的位置来放置文档。想象一个拥有良好文档的数据工程/科学代码库😲？！</li><li id="de1c" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">可重用的转换代码。因为从一开始就存在强制解耦，这意味着作为用户，您用自己的转换函数来管理python模块。因为它们驻留在模块中，所以很容易在其他上下文中重用这些代码，无论是用于不同的“驱动程序”脚本，还是简单地用作库。</li><li id="aa1e" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">代码基础一致性。根据以上几点，用Hamilton编写的特征工程代码库看起来非常标准化，因此易于维护和保养。</li></ol><h1 id="7fc7" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">我如何使用汉密尔顿？</h1><h2 id="9e07" class="mo ky iq bd kz mp mq dn ld mr ms dp lh kj mt mu ll kn mv mw lp kr mx my lt mz bi translated">第一步。安装汉密尔顿</h2><p id="2129" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">要开始安装Hamilton:</p><p id="6d14" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe np nq nr nf b">pip install sf-hamilton</code></p><p id="7c37" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你正在使用笔记本环境，请看这篇关于<a class="ae kw" rel="noopener" target="_blank" href="/how-to-iterate-with-hamilton-in-a-notebook-8ec0f85851ed">如何在笔记本</a>上使用Hamilton的文章。</p><h2 id="1a8f" class="mo ky iq bd kz mp mq dn ld mr ms dp lh kj mt mu ll kn mv mw lp kr mx my lt mz bi translated">第二步。编写您的python转换</h2><p id="711f" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">创建一个python文件，例如my_module.py，并用您的转换函数填充它。记住<em class="nn">函数名</em>映射到您<em class="nn">可以</em>作为输出请求的列，并且<em class="nn">函数参数</em>映射到其他列，或者您在运行时提供的输入。</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="7a2b" class="mo ky iq nf b gy nj nk l nl nm">import pandas as pd<br/><br/><br/>def age_mean(age: pd.Series) -&gt; float:<br/>    <em class="nn">"""Average of age"""<br/>    </em>return age.mean()<br/><br/><br/>def age_zero_mean(age: pd.Series<strong class="nf ir">, </strong>age_mean: float) -&gt; pd.Series:<br/>    <em class="nn">"""Zero mean of age"""<br/>    </em>return age - age_mean<br/><br/><br/>def age_std_dev(age: pd.Series) -&gt; pd.Series:<br/>    <em class="nn">"""Standard deviation of age."""<br/>    </em>return age.std()<br/><br/><br/>def age_zero_mean_unit_variance(age_zero_mean: pd.Series<strong class="nf ir">, </strong>age_std_dev: pd.Series) -&gt; pd.Series:<br/>    <em class="nn">"""Zero mean unit variance value of age"""<br/>    </em>return age_zero_mean / age_std_dev</span></pre><h2 id="5b6d" class="mo ky iq bd kz mp mq dn ld mr ms dp lh kj mt mu ll kn mv mw lp kr mx my lt mz bi translated">第三步。编写一个“驱动程序”脚本，将所有东西整合在一起</h2><p id="97f2" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">创建一个python文件，例如my_driver.py。</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="e8d2" class="mo ky iq nf b gy nj nk l nl nm">import pandas as pd<br/>from hamilton import driver<br/>import my_module<br/><br/>dr = driver.Driver({'age': pd.Series([...])}<strong class="nf ir">, </strong>my_module)<br/># execute() returns a dataframe by default<br/>df = dr.execute(['age_zero_mean_unit_variance'])<br/> <br/># do something with the dataframe</span></pre><h2 id="38f6" class="mo ky iq bd kz mp mq dn ld mr ms dp lh kj mt mu ll kn mv mw lp kr mx my lt mz bi translated">第四步。运行“驱动程序”脚本</h2><p id="0c13" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated"><code class="fe np nq nr nf b">python my_driver.py</code>是运行一切所需的一切！</p><p id="f7e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你正在使用一个编排/调度系统，比如airflow、metaflow、kubeflow pipelines、prefect等。您可以将驱动程序脚本的内容放入要执行的ETL的“步骤”中。</p><h1 id="3797" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">你可以用汉密尔顿做的其他事情</h1><p id="bb67" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">因为这是一个快速的帖子，我们不打算在这里深入细节。但是，为了激起您的兴趣，在使用Pandas时，汉密尔顿为您提供了以下开箱即用的功能:</p><ol class=""><li id="5b77" class="ma mb iq ka b kb kc kf kg kj mc kn md kr me kv mf mg mh mi bi translated">扩展到“大数据”规模，因为Hamilton几乎免费支持Dask、Pandas on Spark和Ray。参见汉密尔顿<a class="ae kw" href="https://github.com/stitchfix/hamilton/tree/main/examples" rel="noopener ugc nofollow" target="_blank">示例文件夹</a>中的代码&amp; <a class="ae kw" href="https://hamilton-docs.gitbook.io/docs/extensions" rel="noopener ugc nofollow" target="_blank">这里有一些文档</a>。</li><li id="1648" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">数据血统。你可以把计算的步骤形象化，并且很容易地用哈密尔顿问你的图的问题。尝试使用<code class="fe np nq nr nf b">dr.visualize_execution(...).</code></li><li id="ba9c" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">修饰功能的能力，例如有条件地包括基于配置的功能。不要用<code class="fe np nq nr nf b">if else</code>语句(例如<code class="fe np nq nr nf b">if region == 'US'</code>)来点缀你的代码，相反，你可以通过用<code class="fe np nq nr nf b">@config.when</code>来装饰一个函数来捕捉这种逻辑。这只是用Hamilton提供功能和额外能力的几个装饰者之一。更多信息请见我们的<a class="ae kw" href="https://hamilton-docs.gitbook.io/docs/reference/api-reference/available-decorators" rel="noopener ugc nofollow" target="_blank">文档</a>。</li><li id="c84b" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">汉密尔顿的用途不仅限于熊猫。您可以使用它来创建numpy矩阵、scikit-learn模型、任何python对象等。！查看<a class="ae kw" href="https://github.com/stitchfix/hamilton/tree/main/examples" rel="noopener ugc nofollow" target="_blank">我们的示例文件夹</a>了解想法。</li></ol><h1 id="8a10" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">最后</h1><p id="3f51" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">感谢你阅读这篇文章。我们很乐意帮助您成功使用汉密尔顿。欢迎在我们的<a class="ae kw" href="https://github.com/stitchfix/hamilton" rel="noopener ugc nofollow" target="_blank"> github知识库</a>中留下问题/评论(我们也很喜欢⭐️！)，或者加入我们的<a class="ae kw" href="https://join.slack.com/t/hamilton-opensource/shared_invite/zt-1bjs72asx-wcUTgH7q7QX1igiQ5bbdcg" rel="noopener ugc nofollow" target="_blank"> slack服务器</a>寻求帮助，或者提供建议/改进。</p><h2 id="a228" class="mo ky iq bd kz mp mq dn ld mr ms dp lh kj mt mu ll kn mv mw lp kr mx my lt mz bi translated">您可能感兴趣的其他汉密尔顿帖子:</h2><ul class=""><li id="4e7c" class="ma mb iq ka b kb lv kf lw kj ns kn nt kr nu kv nv mg mh mi bi translated"><a class="ae kw" rel="noopener" target="_blank" href="/how-to-iterate-with-hamilton-in-a-notebook-8ec0f85851ed">如何在笔记本环境中使用Hamilton</a></li><li id="c7db" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv nv mg mh mi bi translated"><a class="ae kw" rel="noopener" target="_blank" href="/functions-dags-introducing-hamilton-a-microframework-for-dataframe-generation-more-8e34b84efc1d">一般背景故事&amp;汉密尔顿简介</a></li></ul></div></div>    
</body>
</html>