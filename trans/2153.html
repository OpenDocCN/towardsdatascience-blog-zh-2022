<html>
<head>
<title>Mixed Integer Linear Programming: Introduction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">混合整数线性规划:简介</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/mixed-integer-linear-programming-1-bc0ef201ee87#2022-05-13">https://towardsdatascience.com/mixed-integer-linear-programming-1-bc0ef201ee87#2022-05-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="cc0d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何解决具有离散变量的复杂约束优化问题</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a8f29336c47dd047664744fdc9e28621.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5LIqM-xmVHe6rR36"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@mitchel3uo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">米切尔罗</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="e633" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为复杂问题设计和实现算法是困难的。有趣，但很难。如果我告诉你，你可以解决某些优化问题只使用他们的数学规格？和我一起踏上混合整数线性规划的奇妙世界之旅，它在<a class="ae kv" href="https://www.researchgate.net/publication/220366435_The_State_of_the_Art_of_Nurse_Rostering" rel="noopener ugc nofollow" target="_blank">护士排班</a>、<a class="ae kv" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4311855/" rel="noopener ugc nofollow" target="_blank">换肾程序</a>、<a class="ae kv" href="http://egon.cheme.cmu.edu/Papers/HaderaHarjunkoski_SteelProdElec.pdf" rel="noopener ugc nofollow" target="_blank">生产调度</a>、<a class="ae kv" href="https://arxiv.org/pdf/1802.05925.pdf" rel="noopener ugc nofollow" target="_blank">机器人细胞能量优化</a>、<a class="ae kv" rel="noopener" target="_blank" href="/using-integer-linear-programming-to-solve-sudoku-puzzles-15e9d2a70baa">自动数独求解</a>以及许多许多其他程序中都有应用！这些问题的一个共同特性是它们有离散的解空间。通常，解空间也受到约束的限制，因此只有值的子集表示有效的解。因此，广为人知的人工智能优化算法(如梯度下降)不适合这类问题。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/81577097ebf94e43b30de45042ecdbd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*yLUQ-TPjvE3UOY1_xNoHiw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">混合整数线性规划的解空间及其线性松弛和最优解。这些线对应于约束，这些约束对解空间进行编码。填充的蓝点代表可行的解决方案，而填充的绿色点是最优的解决方案。</p></figure><p id="c291" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这一系列的文章中，我们将涵盖Python中离散优化问题的实际建模和幕后的理论机器。本系列面向没有深厚计算机科学背景的程序员和机器学习人员，对于他们来说，混合整数线性编程可能是他们熟悉的数据驱动方法的替代工具。为了能够理解内容，火箭科学的博士学位不是必要的，尽管关于数学(矩阵代数)和Python编程的基础知识是假定的。</p><p id="4cbe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这第一篇介绍性的文章中，我们将遇到一个经典的优化问题，我们使用Python中的混合整数线性编程来解决这个问题。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="1033" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">最优化问题</h1><p id="1acb" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">想象你是一家公司的经理。公司积累了大量预算，你想把它投资到各种资产中，以最大化未来利润。有不同种类的资产，如机器或车辆，如果资产被购买，每种资产都有一个<em class="mx">固定成本</em>和一个<em class="mx">估计未来利润</em>。你可能会问的问题是:你今天应该购买哪些资产来<em class="mx">最大化预计未来利润</em>，这样你就不会超出预算(假设你不能购买资产的一部分)？</p><p id="6a62" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为一个聪明的程序员，你想出了一个简单明了的<em class="mx">贪婪的</em>算法:根据资产的预计未来单位成本利润(即每项资产的利润除以其固定成本)对资产进行递减排序，并按照这个排序列表购买资产，直到预算用完。容易，虽然不能保证这样选择的资产就是未来总利润最大化的资产。你损失了多少？自然，你可能想知道你可以购买的资产的最优选择是什么，这样就不会有其他集团产生更高的利润。</p><p id="23c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以你决定实现一个更复杂的启发式算法，例如，基于<a class="ae kv" href="https://mpatacchiola.github.io/blog/2017/03/14/dissecting-reinforcement-learning-5.html" rel="noopener ugc nofollow" target="_blank">遗传算法</a>。经过几天的代码编写和调试，你想出了一个具有不错性能的算法，它所获得的解将比那些由贪婪算法构造的解有更高的利润。但是如果问题需求发生变化，比如有些资产不能一起买，会怎么样呢？你将不得不回去编码和调试。如此循环往复…</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi my"><img src="../Images/e22a44986b38ab850d7ddd82ca4fb0a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*RI_xqBupZjigrHaIKlHQog.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">开发努力与解决方案质量(例如，利润):从很差的解决方案到一般的解决方案需要一点努力，但是改进一个高质量的解决方案需要更多的努力。</p></figure><p id="ff57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">混合整数线性规划解决了这个问题。你不用编写算法，而是用一种兼容的数学语言来描述你的问题。一旦问题被数学形式化，你就把它传递给现成的混合整数线性规划<em class="mx"> </em>求解器库来获得解。因为这些解算器是由非常聪明的人编写的，他们有很深的数学背景，所以很有可能你会得到一个比手工算法更好的解。如果问题需求发生变化，您只需修改问题描述，然后重新运行同一个求解器。听起来好得难以置信，对吧？所以让我们调查一下。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="8fcb" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">问题的数学形式化</h1><p id="f879" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">混合整数线性规划(简称MILP)被称为<em class="mx">线性</em>是有原因的。那就是:一个问题的数学描述就是一堆线性不等式和线性表达式。例如，线性不等式</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/eb08d63f048ccefbf0f9fc16dcff87e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:316/format:webp/1*8ySF_752MLow_2Tozzb8Pw.png"/></div></figure><p id="0ccf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有了变量<em class="mx"> x₁、x₂ </em>和固定参数<em class="mx"> a₁、a₂、b₁ </em>就是出现在MILP公式中的野兽之一。另一方面，</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi na"><img src="../Images/c10e3d83b55945847164ee61c086897c.png" data-original-src="https://miro.medium.com/v2/resize:fit:172/format:webp/1*zs-8ptrTcfCATL2elnqL4Q.png"/></div></figure><p id="4a61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在MILP中不是有效的公式，因为有二次项<em class="mx"> x₁x₂ </em>。</p><p id="81f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以我们知道MILP由线性不等式组成，这些不等式以某种方式编码了手头的问题:我们称这些不等式为<em class="mx">约束</em>。给定固定参数，MILP求解器将尝试将值插入变量中，以满足约束条件。满足约束的变量值统称为<em class="mx">可行解</em>。然而，MILP远远不止找到任何满足约束的解决方案。我们可以寻找一个优化目标<em class="mx">的可行解，目标</em>是变量的线性函数:优化是根据目标值找到一个最佳可行解。</p><p id="b7c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">MILP中的变量可以是有理数、整数或二进制数(实际上是整数，但被限制为0或1)；这就是为什么名字里有<em class="mx">混</em>的原因。如果一个公式中的所有变量都是合理的，我们得到线性规划，它有很好的计算特性(但在另一篇文章中会有更多)。</p><p id="1eaa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了更好地理解我们的预算问题，让我们将它形式化。首先，考虑固定参数。假设有<em class="mx"> 𝑛 </em> ≥1种不同的资产可供选择。每项资产<em class="mx"> i∈{0,1,2,…,𝑛-1} </em>都有固定成本<em class="mx"> 𝑐ᵢ </em>和预计未来利润<em class="mx"> pᵢ </em>。最后，我们还得到了可用于资产的预算<em class="mx"> 𝐵 </em>。</p><p id="aa65" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，考虑解决方案。资产<em class="mx"> 𝑖 </em>可以购买也可以不购买，决定资产<em class="mx"> 𝑖 </em>是否购买应该是MILP求解者的工作。因此，我们将为每项资产<em class="mx"> 𝑖 </em>设置一个二元变量<em class="mx"> 𝑥ᵢ </em>，如果资产<em class="mx"> 𝑖 </em>被购买，则该变量为1，如果没有被购买，则该变量为0。模型中变量值的解释是由我们决定的，这种解释决定了问题形式化的其余部分应该是什么样子。</p><p id="9d23" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的问题中的约束是什么？我们只有一个，即解决方案中购买的资产的总成本不能超过预算。我们可以用不等式来写这个</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/24eda6e4f310f8f76cb9569430fff214.png" data-original-src="https://miro.medium.com/v2/resize:fit:220/format:webp/1*2urgeC21bj68kPDbwJ8eHA.png"/></div></figure><p id="f9fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个约束的解释如下:如果资产<em class="mx"> 𝑖 </em>没有被购买，那么它的成本<em class="mx"> 𝑐ᵢ </em>将不被包括在总成本中(不等式的左手边)，因为<em class="mx"> 𝑐ᵢ𝑥ᵢ=𝑐ᵢ0=0 </em>。另一方面，如果资产<em class="mx"> 𝑖 </em>被购买，那么它的成本包括在总成本中。</p><p id="ea72" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们指定我们的目标，即从购买的资产中获得的估计总利润的最大化</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/c8ee515624ad5506fb281574cfae8217.png" data-original-src="https://miro.medium.com/v2/resize:fit:216/format:webp/1*5ppIXPGFBhFnG4pf9L5D7w.png"/></div></figure><p id="d9e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是你的第一个MILP公式！</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="664f" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">用Python解决MILP问题</h1><p id="4629" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">一旦有了MILP公式，就可以将其传递给现有的MILP求解器来获得解。现在，有一些商业甚至开源的MILP解算器，我将在以后的文章中介绍它们的不同之处。现在我将使用Python包<a class="ae kv" href="https://www.python-mip.com/" rel="noopener ugc nofollow" target="_blank"> Python-MIP </a>，它捆绑了<a class="ae kv" href="https://github.com/coin-or/Cbc" rel="noopener ugc nofollow" target="_blank"> CBC开源解算器</a>。您可以使用下面的命令从PyPi安装它(有针对Windows、MacOS和Linux的预构建包)</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="5334" class="ni mb iq ne b gy nj nk l nl nm">pip3 install mip --user</span></pre><p id="d98e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mx">Mac M1用户注意:你可能需要做一些</em> <a class="ae kv" href="https://github.com/coin-or/python-mip/issues/165#issuecomment-1058946026" rel="noopener ugc nofollow" target="_blank"> <em class="mx">额外的步骤</em> </a> <em class="mx">。</em></p><p id="b314" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后，开除你最喜欢的代码编辑器，开始写吧！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="5b3b" class="ni mb iq ne b gy nj nk l nl nm">MILP solution<br/>Solver status: OptimizationStatus.OPTIMAL<br/>Bought assets: [3, 4]<br/>Total cost of the bought assets: 10<br/>Estimated future profit: 180</span></pre><p id="dca8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里，我们创建了一个有5个资产可供选择的问题实例。在解决了MILP模型之后，我们得到了一个最优解，估计未来利润为180英镑。相比之下，贪婪算法会给我们160英镑的小利润。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="933d" class="ni mb iq ne b gy nj nk l nl nm">Greedy algorithm solution<br/>Bought assets: [0]<br/>Total cost of the bought assets: 8<br/>Estimated future profit: 160</span></pre><p id="0887" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看起来180–160 = 20是一个很小的利润差额，但是考虑到利润是以百万美元计的，这就开始变得有趣了，不是吗？还要注意，在MILP解决方案中没有选择利润成本比最高的资产<em class="mx"> 𝑖 </em> =0(有更好的资产组合可以带来更高的利润)。</p><p id="3879" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">顺便问一下，我们如何合并两项资产<em class="mx"> 𝑖 </em>、<em class="mx"> 𝑗 </em>不能一起购买的附加要求？通过包含附加约束</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="fc2b" class="ni mb iq ne b gy nj nk l nl nm">m += x[i]+x[j] &lt;= 1</span></pre><p id="fb83" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在模型中。只有当两个<em class="mx"> 𝑖 </em>、<em class="mx"> 𝑗 </em>一起买的时候，你才能检查出这个约束被违反了，因为这时左手边是2，明显大于1。就这样，只有一行代码，你就能适应这个问题的额外需求。唷。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="ac83" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">总结</h1><p id="f31d" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">在这第一篇介绍性的文章中，我们简要讨论了什么是混合整数线性规划(MILP)以及它为什么有用。它允许我们不用写算法就能解决最优化问题。相反，我们将问题描述写成数学公式，然后由众多可用的MILP求解器中的一个来求解。与机器学习方法相比，求解MILP不是数据驱动的，因为它利用了组合优化的理论基础。我们探索了一个购买资产的简单优化问题，并用Python建模(顺便说一句:这个问题其实叫<a class="ae kv" href="http://www.or.deis.unibo.it/kp/Chapter2.pdf" rel="noopener ugc nofollow" target="_blank">背包问题</a>！).</p><p id="6d4c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在下一篇文章中，我想更正式地定义什么是MILP，它的解空间看起来是什么样的，计算复杂性是什么(MILP是一个强大的工具，但它有其局限性)。</p><p id="2756" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mx">所有图片，除非特别注明，均为作者所有。</em></p></div></div>    
</body>
</html>