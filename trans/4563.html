<html>
<head>
<title>How To Test If a Function Throws An Exception in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中测试函数是否抛出异常</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-exception-test-290366618e7d#2022-10-11">https://towardsdatascience.com/python-exception-test-290366618e7d#2022-10-11</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="ef69" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">编写测试用例来验证函数是否会用预期的消息引发异常</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/29abbd481d2d77460cf173b23acf4075.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6XK9WML8K65araT8blnGwA.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">杰里米·珀金斯在<a class="ae kz" href="https://unsplash.com/s/photos/error?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="5f52" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">软件工程中最基本的方面之一是错误处理。软件应用程序可能由于许多不同的原因而中断，因此能够以一种能够有效处理和报告异常的方式编写代码是非常重要的。</p><p id="bd2f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然而，在源代码中处理异常是不够的。测试您的代码是否按预期处理和报告异常更加重要。测试可确保在适当的时候引发异常，并给出正确的消息。</p><p id="e030" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在今天的文章中，我们将演示如何编写测试用例来测试某个函数在某个事件发生时是否会引发预期的异常。更具体地说，我们将使用Python中最流行的两个测试包，即<code class="fe lw lx ly lz b">unittest</code>和<code class="fe lw lx ly lz b">pytest</code>，展示如何做到这一点。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><p id="18d2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">首先，让我们创建一个在特定事件发生时引发异常的示例函数。然后，我们将通过一步一步的指导，最终帮助您测试异常处理。</p><pre class="kk kl km kn gu mh lz mi mj aw mk bi"><span id="2d11" class="ml mm iu lz b gz mn mo l mp mq">def greet(greeting):<br/>    if greeting not in ('hello', 'hi'):<br/>        raise ValueError(f'{greeting} is not allowed')<br/>    <br/>    print(greeting + ' world!')</span></pre><p id="972d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果输入的<code class="fe lw lx ly lz b">greeting</code>参数不等于<code class="fe lw lx ly lz b">hello</code>或<code class="fe lw lx ly lz b">hi</code>，我们的<code class="fe lw lx ly lz b">greet</code>函数将引发一个<code class="fe lw lx ly lz b">ValueError</code>。现在让我们在实践中看看如何正确地测试函数使用<code class="fe lw lx ly lz b">unittest</code>和<code class="fe lw lx ly lz b">pytest</code>引发了预期的异常。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h2 id="5ac5" class="ml mm iu bd mr ms mt dn mu mv mw dp mx lj my mz na ln nb nc nd lr ne nf ng nh bi translated">用unittest测试异常处理</h2><p id="3476" class="pw-post-body-paragraph la lb iu lc b ld ni jv lf lg nj jy li lj nk ll lm ln nl lp lq lr nm lt lu lv in bi translated">为了创建一个测试用例来测试当输入参数不包含预期值时<code class="fe lw lx ly lz b">greet()</code>是否正在引发<code class="fe lw lx ly lz b">ValueError</code>，我们可以利用下面概述的<code class="fe lw lx ly lz b">assertRaises</code>方法:</p><pre class="kk kl km kn gu mh lz mi mj aw mk bi"><span id="1a82" class="ml mm iu lz b gz mn mo l mp mq">import unittest</span><span id="06e2" class="ml mm iu lz b gz nn mo l mp mq">class MyTestCase(unittest.TestCase):</span><span id="f12e" class="ml mm iu lz b gz nn mo l mp mq">    def test_greet_raises(self):<br/>        self.assertRaises(ValueError, greet, 'bye')</span><span id="b729" class="ml mm iu lz b gz nn mo l mp mq">if __name__ == '__main__':<br/>    unittest.main()</span></pre><p id="a43b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">或者，您甚至可以使用上下文管理器，如下例所示:</p><pre class="kk kl km kn gu mh lz mi mj aw mk bi"><span id="9f1c" class="ml mm iu lz b gz mn mo l mp mq">import unittest</span><span id="ea60" class="ml mm iu lz b gz nn mo l mp mq">class MyTestCase(unittest.TestCase):</span><span id="9d02" class="ml mm iu lz b gz nn mo l mp mq">def test_greet_raises(self):<br/>        with self.assertRaises(ValueError) as context:<br/>            greet('bye')</span><span id="3b24" class="ml mm iu lz b gz nn mo l mp mq">if __name__ == '__main__':<br/>    unittest.main()</span></pre><p id="33f9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们甚至可以使用下面的方法测试异常所报告的实际消息:</p><pre class="kk kl km kn gu mh lz mi mj aw mk bi"><span id="294c" class="ml mm iu lz b gz mn mo l mp mq">import unittest</span><span id="c1ea" class="ml mm iu lz b gz nn mo l mp mq">class MyTestCase(unittest.TestCase):</span><span id="bbc6" class="ml mm iu lz b gz nn mo l mp mq">def test_greet_raises(self):<br/>    with self.assertRaises(ValueError) as context :<br/>        greet('bye')<br/>    self.assertEqual('bye is not allowed', str(context.exception))</span><span id="7b45" class="ml mm iu lz b gz nn mo l mp mq">if __name__ == '__main__':<br/>    unittest.main()</span></pre></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h2 id="43fe" class="ml mm iu bd mr ms mt dn mu mv mw dp mx lj my mz na ln nb nc nd lr ne nf ng nh bi translated">用pytest测试异常处理</h2><p id="2095" class="pw-post-body-paragraph la lb iu lc b ld ni jv lf lg nj jy li lj nk ll lm ln nl lp lq lr nm lt lu lv in bi translated">同样，我们可以使用<code class="fe lw lx ly lz b">pytest</code>来断言一个函数引发了一个异常。</p><pre class="kk kl km kn gu mh lz mi mj aw mk bi"><span id="2e80" class="ml mm iu lz b gz mn mo l mp mq">import pytest</span><span id="a86e" class="ml mm iu lz b gz nn mo l mp mq">def test_greet():<br/>    <!-- -->with pytest.raises(ValueError):<br/>        greet('bye')</span></pre><p id="5178" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">同样，我们也可以测试我们预期会引发的异常所报告的错误消息:</p><pre class="kk kl km kn gu mh lz mi mj aw mk bi"><span id="6c3c" class="ml mm iu lz b gz mn mo l mp mq">import pytest</span><span id="8fa9" class="ml mm iu lz b gz nn mo l mp mq">def test_greet():<br/>    <!-- -->with pytest.raises(ValueError, match=<!-- -->'bye is not allowed'<!-- -->):<br/>        greet('bye')</span></pre></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h2 id="78f3" class="ml mm iu bd mr ms mt dn mu mv mw dp mx lj my mz na ln nb nc nd lr ne nf ng nh bi translated">最后的想法</h2><p id="f311" class="pw-post-body-paragraph la lb iu lc b ld ni jv lf lg nj jy li lj nk ll lm ln nl lp lq lr nm lt lu lv in bi translated">测试覆盖率是最重要的指标之一，您可以用它来判断源代码测试的好坏。除了良好的设计和高效的代码，确保代码的每个方面都按预期运行也很重要，这样你就可以将错误减到最少。这只能通过彻底的测试来实现。</p><p id="3818" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在今天的简短教程中，我们演示了如何测试引发异常的函数。除了测试流程的“良好路径”，确保在源代码中正确处理错误也很重要。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><p id="1b77" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://gmyrianthous.medium.com/membership" rel="noopener"> <strong class="lc iv">成为会员</strong> </a> <strong class="lc iv">阅读介质上的每一个故事。你的会员费直接支持我和你看的其他作家。你也可以在媒体上看到所有的故事。</strong></p><div class="no np gq gs nq nr"><a href="https://gmyrianthous.medium.com/membership" rel="noopener follow" target="_blank"><div class="ns ab fp"><div class="nt ab nu cl cj nv"><h2 class="bd iv gz z fq nw fs ft nx fv fx it bi translated">通过我的推荐链接加入Medium-Giorgos Myrianthous</h2><div class="ny l"><h3 class="bd b gz z fq nw fs ft nx fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nz l"><p class="bd b dl z fq nw fs ft nx fv fx dk translated">gmyrianthous.medium.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of kt nr"/></div></div></a></div></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><p id="676e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">相关文章你可能也喜欢</strong></p><div class="no np gq gs nq nr"><a rel="noopener follow" target="_blank" href="/diagrams-as-code-python-d9cbaa959ed5"><div class="ns ab fp"><div class="nt ab nu cl cj nv"><h2 class="bd iv gz z fq nw fs ft nx fv fx it bi translated">Python中作为代码的图</h2><div class="ny l"><h3 class="bd b gz z fq nw fs ft nx fv fx dk translated">用Python创建云系统架构图</h3></div><div class="nz l"><p class="bd b dl z fq nw fs ft nx fv fx dk translated">towardsdatascience.com</p></div></div><div class="oa l"><div class="og l oc od oe oa of kt nr"/></div></div></a></div></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu nr"><a rel="noopener follow" target="_blank" href="/big-o-notation-32fb458e5260"><div class="ns ab fp"><div class="nt ab nu cl cj nv"><h2 class="bd iv gz z fq nw fs ft nx fv fx it bi translated">大O符号</h2><div class="ny l"><h3 class="bd b gz z fq nw fs ft nx fv fx dk translated">用Big-O符号计算算法的时间和空间复杂度</h3></div><div class="nz l"><p class="bd b dl z fq nw fs ft nx fv fx dk translated">towardsdatascience.com</p></div></div><div class="oa l"><div class="oh l oc od oe oa of kt nr"/></div></div></a></div></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu nr"><a rel="noopener follow" target="_blank" href="/how-to-merge-pandas-dataframes-221e49c41bec"><div class="ns ab fp"><div class="nt ab nu cl cj nv"><h2 class="bd iv gz z fq nw fs ft nx fv fx it bi translated">如何合并熊猫数据帧</h2><div class="ny l"><h3 class="bd b gz z fq nw fs ft nx fv fx dk translated">对熊猫数据帧执行左、右、内和反连接</h3></div><div class="nz l"><p class="bd b dl z fq nw fs ft nx fv fx dk translated">towardsdatascience.com</p></div></div><div class="oa l"><div class="oi l oc od oe oa of kt nr"/></div></div></a></div></div></div>    
</body>
</html>