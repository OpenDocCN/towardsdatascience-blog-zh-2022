<html>
<head>
<title>An Illustrated Guide to the Variance-Covariance Matrices Used in Regression Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">回归分析中使用的方差-协方差矩阵图解指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/an-illustrated-guide-to-the-variance-covariance-matrices-used-in-regression-analysis-3eb5a5dd2cff#2022-03-21">https://towardsdatascience.com/an-illustrated-guide-to-the-variance-covariance-matrices-used-in-regression-analysis-3eb5a5dd2cff#2022-03-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/d3e57ac66cacce09052ec246464dcf2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dm-bxo0pnJE4k64CziEsPA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">系数估计的概率分布(图片由作者提供)</p></figure><div class=""/><div class=""><h2 id="b947" class="pw-subtitle-paragraph kc je jf bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">使用真实世界的数据集，说明回归建模的基础工件是如何构建的</h2></div><p id="d4a5" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">方差-协方差矩阵</strong>形成了回归模型的梯形失真。回归模型误差的方差-协方差矩阵用于确定模型的误差项是否为<a class="ae lq" rel="noopener" target="_blank" href="/heteroscedasticity-is-nothing-to-be-afraid-of-730dd3f7ca1f"> <strong class="kw jg">【同方差】</strong> </a>(常方差)<a class="ae lq" rel="noopener" target="_blank" href="/the-intuition-behind-correlation-62ca11a3c4a"><strong class="kw jg"/></a>。拟合回归模型系数的方差-协方差矩阵用于导出拟合模型系数估计值的<strong class="kw jg">标准误差</strong>和<strong class="kw jg">置信区间</strong>。两个矩阵都用于形成模型预测的<strong class="kw jg">预测区间</strong>。</p><p id="6968" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">方差-协方差矩阵是一个方阵，即它具有相同数量的行和列。沿着矩阵主对角线的元素，即从左上到右下的元素，包含方差，而所有其他元素包含协方差。因此，回归模型的拟合系数的方差-协方差矩阵包含拟合模型的系数估计的方差和系数估计之间的成对协方差。</p><p id="a063" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">类似地，回归模型的误差项的方差-协方差矩阵包含每个误差项沿其主对角线的方差以及所有误差项对之间的协方差。</p><p id="a1ee" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">话虽如此，为什么拟合模型的系数或误差项首先会有方差，以及这些矩阵在回归建模中扮演什么角色是我们将在本文中深入探讨的主题。</p><p id="39a3" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们将使用经典的线性回归模型作为我们的范例模型。我们将学习的概念同样适用于各种常用的回归模型。</p><p id="1a8b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">本文是以下两部分系列的第 1 部分:</p><p id="c645" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">第 1 部分:回归分析中使用的方差-协方差矩阵的图解指南</strong> <br/>第 2 部分:深入探究经典线性回归模型的方差-协方差矩阵</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="e744" class="ly lz jf bd ma mb mc md me mf mg mh mi kl mj km mk ko ml kp mm kr mn ks mo mp bi translated">汽车数据集作为我们的样本数据集</h1><p id="b817" class="pw-post-body-paragraph ku kv jf kw b kx mq kg kz la mr kj lc ld ms lf lg lh mt lj lk ll mu ln lo lp ij bi translated">以下数据包含 205 辆汽车的规格，摘自 1985 年版的沃德汽车年鉴。每行包含一组 26 个关于单个车辆的规格。</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mv"><img src="../Images/3a267171b220510400c8104ce37d4a7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_wc0IJBq2-DEoeXlOn9hZg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">汽车数据集(来源:<a class="ae lq" href="https://archive.ics.uci.edu/ml/datasets/automobile" rel="noopener ugc nofollow" target="_blank">加州大学欧文分校</a>)</p></figure><p id="78a2" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们将考虑这个数据集的一个子集，它只包含三个变量:<br/>City _ MPG<br/>Engine _ Size<br/>Curb _ Weight</p><p id="7416" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">三变量版本可从这里 下载<a class="ae lq" href="https://gist.github.com/sachinsdate/fd97d74979c4febf6746c153ea1b7668" rel="noopener ugc nofollow" target="_blank"> <strong class="kw jg">。</strong></a></p><p id="de41" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">以下是三个变量数据集的前几行:</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi na"><img src="../Images/bb1bec16202b003fb5001d05d002afdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*8GcJ3au4tMekHqlznPRD2Q.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">汽车数据集的子集(来源:<a class="ae lq" href="https://archive.ics.uci.edu/ml/datasets/automobile" rel="noopener ugc nofollow" target="_blank">加州大学欧文分校</a>)</p></figure><h2 id="a628" class="nb lz jf bd ma nc nd dn me ne nf dp mi ld ng nh mk lh ni nj mm ll nk nl mo nm bi translated">回归目标</h2><p id="462c" class="pw-post-body-paragraph ku kv jf kw b kx mq kg kz la mr kj lc ld ms lf lg lh mt lj lk ll mu ln lo lp ij bi translated">我们的回归目标是使用<strong class="kw jg">线性回归模型</strong>回归<strong class="kw jg">发动机尺寸</strong>和<strong class="kw jg">整备质量</strong>的<strong class="kw jg">城市行驶里程</strong>。模型方程为:</p><p id="9797" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><em class="nn">city _ mpg =β_ 1</em><strong class="kw jg"><em class="nn">+</em></strong><em class="nn">β_ 2 *发动机 _ 尺寸+β_ 3 *整备 _ 重量+ ϵ </em></p><p id="666e" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">其中<em class="nn"> ϵ </em> <strong class="kw jg"> </strong>是模型的误差项。回归模型的误差项<em class="nn"> ϵ </em>代表建模者没有或不能测量的所有因素的影响。</p><p id="45e7" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">上述方程的矩阵形式如下:</p><p id="ee37" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"><em class="nn">y</em></strong><em class="nn">=</em><strong class="kw jg"><em class="nn">xβ</em></strong><em class="nn">+</em><strong class="kw jg"><em class="nn">ϵ</em></strong></p><p id="e80d" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><em class="nn">凡，</em></p><ul class=""><li id="994a" class="no np jf kw b kx ky la lb ld nq lh nr ll ns lp nt nu nv nw bi translated"><strong class="kw jg"> <em class="nn"> y </em> </strong>是一个<em class="nn">【n×1】</em>大小的列向量，包含<em class="nn"> City_MPG 的观测值。我们假设</em></li><li id="54e4" class="no np jf kw b kx nx la ny ld nz lh oa ll ob lp nt nu nv nw bi translated"><strong class="kw jg"><em class="nn"/></strong>是一个<em class="nn">【3×1】</em>大小的回归模型系数列向量<em class="nn"> β_1、β_2、β_3 </em>对应的<em class="nn">截距、</em>引擎 _ 大小和<em class="nn">整备 _ 重量。</em></li><li id="622d" class="no np jf kw b kx nx la ny ld nz lh oa ll ob lp nt nu nv nw bi translated"><strong class="kw jg"><em class="nn"/></strong>是一个<em class="nn">【n×3】</em>大小的矩阵，包含回归变量的值。该矩阵的第一列是一列 1，它充当截距<em class="nn"> β_1 的占位符。</em></li><li id="9148" class="no np jf kw b kx nx la ny ld nz lh oa ll ob lp nt nu nv nw bi translated"><strong class="kw jg"><em class="nn"/></strong>是模型的回归误差的一个<em class="nn">【n×1】</em>大小的列向量。</li></ul><p id="c914" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">当模型拟合在尺寸为<em class="nn"> n </em>的样本上时，拟合模型的方程可以写成:</p><p id="e830" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"><em class="nn">y</em></strong><em class="nn">=</em><strong class="kw jg"><em class="nn">xβ_ cap</em></strong><em class="nn">+</em><strong class="kw jg"><em class="nn">e</em></strong></p><p id="748d" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在哪里，</p><ul class=""><li id="6623" class="no np jf kw b kx ky la lb ld nq lh nr ll ns lp nt nu nv nw bi translated"><strong class="kw jg"> <em class="nn"> y </em> </strong>和<strong class="kw jg"> <em class="nn"> X </em> </strong>的含义与之前相同。</li><li id="3e59" class="no np jf kw b kx nx la ny ld nz lh oa ll ob lp nt nu nv nw bi translated"><strong class="kw jg"> <em class="nn"> β_cap </em> </strong>是一个<em class="nn">【3×1】</em>大小的列向量，包含了回归模型的系数<em class="nn"> β_1，β_2，β_3 的<em class="nn">估计值</em>。</em> <strong class="kw jg"> <em class="nn"> β_cap </em> </strong>有时被称为拟合系数。</li><li id="a7fc" class="no np jf kw b kx nx la ny ld nz lh oa ll ob lp nt nu nv nw bi translated"><strong class="kw jg"> <em class="nn"> e </em> </strong>是拟合模型的<strong class="kw jg">残差</strong>的<em class="nn">【n×1】</em>大小的列向量。残差是<strong class="kw jg"> <em class="nn"> y </em> </strong>的观测值与预测值之差。<strong class="kw jg"><em class="nn">e</em></strong><em class="nn">=</em><strong class="kw jg"><em class="nn">y</em></strong><em class="nn">——</em><strong class="kw jg"><em class="nn">xβ_ cap</em></strong></li></ul><h2 id="633f" class="nb lz jf bd ma nc nd dn me ne nf dp mi ld ng nh mk lh ni nj mm ll nk nl mo nm bi translated">回归策略</h2><p id="80b8" class="pw-post-body-paragraph ku kv jf kw b kx mq kg kz la mr kj lc ld ms lf lg lh mt lj lk ll mu ln lo lp ij bi translated">通常，我们会在 75–85%的数据集上训练这个模型，并在剩下的 15–25%的数据集上测试它。因此，给定的数据集可能是从一个大得多(理论上无限大小)的群体中抽取的样本。</p><p id="8f46" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">为了说明方差-协方差矩阵是如何构建的，我们将遵循一个稍微不同的策略，称为<strong class="kw jg">自举</strong>。我们将假设 205 辆车的数据集是<em class="nn">人口</em>，我们将遵循以下回归策略:</p><ol class=""><li id="e070" class="no np jf kw b kx ky la lb ld nq lh nr ll ns lp oc nu nv nw bi translated">我们将从该人群中随机抽取 100 辆大小为 50 的车辆，<em class="nn">替换</em>。“替换”意味着在使用样本后，我们将把它放回总体中，以便在进行下一次抽取时可以使用这些数据。with-replacement 策略在许多现实环境中可能不太现实，但是它使数学变得非常简单，并且在汽车数据集的情况下不会导致任何实际困难。</li><li id="b047" class="no np jf kw b kx nx la ny ld nz lh oa ll ob lp oc nu nv nw bi translated">我们将使用 OLS 技术对这 50 个车辆样本中的每一个样本训练(也称为拟合)一个线性回归模型。这种模型被称为副<strong class="kw jg">O</strong>L 东<strong class="kw jg"> S </strong>方<strong class="kw jg"> R </strong>出(<strong class="kw jg"> OLSR </strong>)模型。</li><li id="49cb" class="no np jf kw b kx nx la ny ld nz lh oa ll ob lp oc nu nv nw bi translated">在对每个样本进行训练后，我们将记下拟合模型的系数值<em class="nn"> β_0_cap、β_1_cap 和β_2_cap。</em><em class="nn">‘cap’</em>表示这些是相应系数的总体水平值的<em class="nn">估计值</em>。</li><li id="463d" class="no np jf kw b kx nx la ny ld nz lh oa ll ob lp oc nu nv nw bi translated">我们还将为每个样本记下回归的残差'<strong class="kw jg"> <em class="nn"> e </em> </strong>'。回归的残差是因变量(<em class="nn"> City_MPG </em>)的观测值与拟合回归模型预测值之差。</li></ol><p id="a5bf" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">下面是实现上述<strong class="kw jg">自举算法</strong>的 Python 代码:</p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="edd2" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">让我们来看看我们的引导实验的结果。</p><h1 id="884c" class="ly lz jf bd ma mb of md me mf og mh mi kl oh km mk ko oi kp mm kr oj ks mo mp bi translated">培训结果</h1><p id="0d2c" class="pw-post-body-paragraph ku kv jf kw b kx mq kg kz la mr kj lc ld ms lf lg lh mt lj lk ll mu ln lo lp ij bi translated">让我们打印出使用上述程序对 100 个数据样本运行 OLSR 模型得出的回归系数表(包括截距)。</p><pre class="mw mx my mz gt ok ol om on aw oo bi"><span id="3498" class="nb lz jf ol b gy op oq l or os"><strong class="ol jg">print</strong>(df_sample_beta)</span></pre><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/63c33879e206f4626848970484c49630.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*wtRdRNstI_f8dm2ZnTiA1Q.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">拟合 OLSR 模型的回归系数表，对模型进行 100 次拟合，每次对随机选择的 50 辆车进行采样(图片由作者提供)</p></figure><p id="ca88" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">该表中的每一行都对应于回归系数的拟合值，这些回归系数是通过在随机选择的 50 辆汽车样本上拟合 OLSR 模型而获得的。</p><p id="5757" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">从该表可以看出，拟合模型的回归系数表现得像随机变量。的确，它们<em class="nn">是</em>随机变量。每个估计的系数遵循某种概率分布，它有一个<strong class="kw jg">均值</strong>和<strong class="kw jg">方差</strong>。</p><p id="10cd" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">使用上表中的数据，让我们画出三个回归系数的概率密度函数。下面是它的 Python 代码:</p><pre class="mw mx my mz gt ok ol om on aw oo bi"><span id="0f83" class="nb lz jf ol b gy op oq l or os"><strong class="ol jg">def </strong>draw_pdf(data, min_X, max_X, var_name):<br/>    hist = np.histogram(data)<br/>    hist_dist = scipy.stats.rv_histogram(hist)<br/>    X = np.linspace(min_X, max_X, 20)<br/>    fig = plt.figure()<br/>    fig.suptitle(<strong class="ol jg">'PDF of ' </strong>+ var_name)<br/>    plt.plot(X, hist_dist.pdf(X), label=<strong class="ol jg">'PDF'</strong>)<br/>    plt.xlabel(var_name)<br/>    plt.ylabel(<strong class="ol jg">'Density'</strong>)<br/>    plt.show()</span><span id="355f" class="nb lz jf ol b gy ou oq l or os"><em class="nn">#Plot the PDFs of the three coefficient estimates<br/></em>draw_pdf(df_sample_beta[<strong class="ol jg">'Intercept'</strong>], 0, 100, <strong class="ol jg">'estimated Intercept '</strong>)</span><span id="0481" class="nb lz jf ol b gy ou oq l or os">data=df_sample_beta[<strong class="ol jg">'Curb_Weight'</strong>]<br/>draw_pdf(data, min(data)*0.9, max(data)*1.1, <strong class="ol jg">'estimated coefficient for Curb_Weight'</strong>)</span><span id="5bd0" class="nb lz jf ol b gy ou oq l or os">data=df_sample_beta[<strong class="ol jg">'Engine_Size'</strong>]<br/>draw_pdf(data, min(data)*0.9, max(data)*1.1, <strong class="ol jg">'estimated coefficient for Engine_Size'</strong>)</span></pre><p id="5045" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们得到以下三幅图:</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ov"><img src="../Images/9fe75727c31235369e9e962220addf3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RpA58uVjnrHpKMPfS24MSw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">回归系数估计值的 pdf(图片由作者提供)</p></figure><h1 id="49ed" class="ly lz jf bd ma mb of md me mf og mh mi kl oh km mk ko oi kp mm kr oj ks mo mp bi translated">构建回归系数的方差-协方差矩阵</h1><p id="c1bd" class="pw-post-body-paragraph ku kv jf kw b kx mq kg kz la mr kj lc ld ms lf lg lh mt lj lk ll mu ln lo lp ij bi translated">我们可以使用回归系数值表来计算每个系数的方差以及三个系数的成对协方差。</p><p id="8829" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">让我们回忆一下方差和协方差的公式。</p><p id="b28c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">给定在大小为<em class="nn"> n </em>的样本上实现的随机变量<strong class="kw jg"> <em class="nn"> x </em> </strong>，以下<strong class="kw jg"> <em class="nn"> x </em> </strong>的样本方差形成了对 a <strong class="kw jg"> <em class="nn"> x </em> </strong>的总体方差的无偏估计:</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ow"><img src="../Images/a67034714cf8a5d8f1e709db4dce6d41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fEWIUOMEJyHmEyHgRTfiLw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">随机变量的总体方差的无偏估计量<strong class="bd ox"> <em class="oy"> x </em> </strong> <em class="oy">(图片由作者提供)</em></p></figure><p id="05b9" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这里，<em class="nn"> x_bar </em>是<strong class="kw jg"> <em class="nn"> x </em> </strong>的均值，分母中的<em class="nn"> -1 </em>代表因包含均值而损失的单自由度。</p><p id="6684" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">两个随机变量<strong class="kw jg"> <em class="nn"> x </em> </strong>和<strong class="kw jg"> <em class="nn"> z </em> </strong>之间总体水平协方差的类似无偏估计量如下:</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oz"><img src="../Images/dc4d12507fe0cc0cb41b6a1a7b2f1954.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HJt87pLRb7Ma5FBoaSWldA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">总体的无偏估计量<strong class="bd ox">随机变量的协方差<strong class="bd ox"> <em class="oy"> x </em> </strong> <em class="oy">和</em> <strong class="bd ox"> <em class="oy"> z </em> </strong> <em class="oy">(图片由作者提供)</em></strong></p></figure><p id="a193" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">使用这些公式，我们将计算回归系数值的方差和成对协方差。</p><p id="fa2b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">系数的含义如下:</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pa"><img src="../Images/99fd6d8bf5b15e91484dca77465c892f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NCKsoxO9knglZJQpmcLitg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">回归模型系数的平均估计值(图片由作者提供)</p></figure><p id="ea7c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">方差和协方差如下:</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pb"><img src="../Images/c4fe38136a5ebe771c371a3bc884d396.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pXWQC438RAX8kQNDmvoW_A.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">回归系数的方差和协方差(图片由作者提供)</p></figure><p id="dd98" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">以下 Python 代码可用于计算系数估计值的平均值和回归系数的方差-协方差矩阵:</p><pre class="mw mx my mz gt ok ol om on aw oo bi"><span id="cad4" class="nb lz jf ol b gy op oq l or os"><strong class="ol jg"><em class="nn">#Calculate the mean estimate for each coefficient</em></strong><em class="nn"><br/></em>coeff_means = df_sample_beta.<strong class="ol jg">mean</strong>()<br/><br/><strong class="ol jg"><em class="nn">#Calculate the variance-covariance matrix for each coefficient</em></strong><em class="nn"><br/></em>coeff_covs = df_sample_beta.<strong class="ol jg">cov</strong>()</span></pre><p id="121e" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们会把它们打印出来:</p><pre class="mw mx my mz gt ok ol om on aw oo bi"><span id="bbbc" class="nb lz jf ol b gy op oq l or os">print(coeff_means)</span></pre><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/d93d22f4e2c7e093064a203e587c1c27.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*0y7otb2EpRy_fRZdxlfZbg.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">系数的平均估计值(图片由作者提供)</p></figure><pre class="mw mx my mz gt ok ol om on aw oo bi"><span id="fb1f" class="nb lz jf ol b gy op oq l or os"><strong class="ol jg">print</strong>(coeff_covs)</span></pre><figure class="mw mx my mz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pd"><img src="../Images/ad9486ecf417c021c63b465803b5f690.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MNJjAXKhIYtA3VwvoKmNdw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">回归系数的方差-协方差矩阵(图片由作者提供)</p></figure><p id="c9fa" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在上面的矩阵中，由红框指示的沿主对角线的元素包含相应系数估计的方差，而非对角线元素包含成对协方差。</p><p id="4325" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">发动机尺寸和整备质量之间的负系数可能看起来是反直觉的，但是这个值是如此之小，以至于人们应该忽略这个符号。事实上，考虑到抽样技术的性质，每次我们进行 1000 个样本的实验时，我们将得到方差和协方差的稍微不同的值。</p><p id="500c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">上述推导模型系数协方差矩阵的过程被称为<strong class="kw jg"> bootstrap </strong>技术。重要的是要记住，回归系数的协方差是相应真实总体水平协方差的有限样本估计值(通常假设未知)。</p><p id="4ed4" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">当使用 bootstrap 技术时，当抽取次数很少时，需要使用因子(D+1)/D 向上调整估计的协方差，其中 D 是抽取次数。在我们的实验中，D=100，这个调整因子只有 1.01，可以忽略不计。</p><h1 id="c486" class="ly lz jf bd ma mb of md me mf og mh mi kl oh km mk ko oi kp mm kr oj ks mo mp bi translated">模型系数的标准误差</h1><p id="a459" class="pw-post-body-paragraph ku kv jf kw b kx mq kg kz la mr kj lc ld ms lf lg lh mt lj lk ll mu ln lo lp ij bi translated">系数估计值的标准误差就是代表系数估计值的随机变量的标准偏差。</p><p id="1e5a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">符号方面，</p><p id="21ec" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><em class="nn">SE(</em><strong class="kw jg"><em class="nn">【β_ cap | X】</em></strong><em class="nn">= STDEV(</em><strong class="kw jg"><em class="nn">β_ cap | X)=</em></strong><em class="nn">SQRT(Var(</em><strong class="kw jg"><em class="nn">β_ cap</em></strong><em class="nn">|</em><strong class="kw jg"><em class="nn">X</em></strong><em class="nn">)</em></p><p id="4070" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">回想一下方差-协方差矩阵的对角元素包含系数的方差。因此，每个系数的标准误差可以通过取协方差矩阵的相应对角元素的平方根来计算。</p><p id="1653" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">让我们计算并打印出标准偏差:</p><pre class="mw mx my mz gt ok ol om on aw oo bi"><span id="42b7" class="nb lz jf ol b gy op oq l or os">coeff_std_errors = np.<strong class="ol jg">sqrt</strong>(coeff_covs)<br/><strong class="ol jg">print</strong>(coeff_std_errors)</span></pre><p id="addd" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">以下是红框中显示的三个系数的标准误差:</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pe"><img src="../Images/dc4a999a7ee4f31765b80d0ffe6ad681.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VUjeo8Bs5USoGGytMIK4Qg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">使用 bootstrapping 技术计算的系数估计的标准误差(图片由作者提供)</p></figure><p id="42fb" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">上述计算系数标准误差的技术被称为标准误差的<strong class="kw jg">自举</strong>，并且如此获得的标准误差被称为系数估计的<strong class="kw jg">自举标准误差</strong>。</p><h2 id="fe8f" class="nb lz jf bd ma nc nd dn me ne nf dp mi ld ng nh mk lh ni nj mm ll nk nl mo nm bi translated">模型系数的置信区间</h2><p id="3109" class="pw-post-body-paragraph ku kv jf kw b kx mq kg kz la mr kj lc ld ms lf lg lh mt lj lk ll mu ln lo lp ij bi translated">使用以下公式计算每个系数的(1-α)*100%置信区间:</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/3e8e078e2d1516e296b36de32a59ef92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*Y58etoD2etRvPk25RYoWTA.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">回归系数置信区间公式(图片由作者提供)</p></figure><p id="2117" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在上面的公式中:</p><ul class=""><li id="d746" class="no np jf kw b kx ky la lb ld nq lh nr ll ns lp nt nu nv nw bi translated"><em class="nn"> β_cap_i </em>是模型对数据样本拟合后上报的第 I 个系数的拟合值。</li><li id="90b8" class="no np jf kw b kx nx la ny ld nz lh oa ll ob lp nt nu nv nw bi translated">方括号内的<em class="nn"> t </em>值是从具有<em class="nn"> (n-k) </em>自由度的双边<em class="nn"> t </em>分布返回的临界值，其中<em class="nn"> n </em>是样本大小，<em class="nn"> k </em>是包括截距在内的回归系数的数量。</li><li id="7b16" class="no np jf kw b kx nx la ny ld nz lh oa ll ob lp nt nu nv nw bi translated"><em class="nn"> se_i_i </em>是<strong class="kw jg"> <em class="nn"> β_cap </em> </strong>的方差-协方差矩阵中第<em class="nn">个</em>对角元素的平方根。</li></ul><p id="87d6" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">为了计算置信区间，我们需要在随机抽取的 50 个样本上拟合 OLSR 模型:</p><pre class="mw mx my mz gt ok ol om on aw oo bi"><span id="ccc7" class="nb lz jf ol b gy op oq l or os"><strong class="ol jg"><em class="nn"># Select a random sample of size SAMPLE_SIZE</em></strong><em class="nn"><br/></em>df_sample = df.<strong class="ol jg">sample</strong>(<strong class="ol jg">n</strong>=SAMPLE_SIZE)</span><span id="8248" class="nb lz jf ol b gy ou oq l or os"><strong class="ol jg"><em class="nn"># carve out the X and y matrices using Patsy</em></strong><em class="nn"><br/></em>y_train, X_train = <strong class="ol jg">dmatrices</strong>(model_expr, df_sample, <strong class="ol jg">return_type</strong>=<strong class="ol jg">'</strong>dataframe<strong class="ol jg">'</strong>)</span><span id="67d1" class="nb lz jf ol b gy ou oq l or os"><strong class="ol jg"><em class="nn"># Build an OLS regression model using Statsmodels</em></strong><em class="nn"><br/></em>olsr_model = sm.<strong class="ol jg">OLS</strong>(<strong class="ol jg">endog</strong>=y_train, <strong class="ol jg">exog</strong>=X_train)</span><span id="3683" class="nb lz jf ol b gy ou oq l or os"><strong class="ol jg"><em class="nn"># Fit the model on (y, X)<br/></em></strong>olsr_results = olsr_model.<strong class="ol jg">fit</strong>()</span><span id="e218" class="nb lz jf ol b gy ou oq l or os"><strong class="ol jg"><em class="nn">#Print the training summary of the fitted model<br/></em>print</strong>(olsr_results.<strong class="ol jg">summary</strong>())</span></pre><p id="67d2" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们得到以下培训总结输出:</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pg"><img src="../Images/6e4cfb67758f4666016d3ce78d3076fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qDy3S4DHIMTH85Hi4F5KQw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">OLSR 模式的培训总结(图片由作者提供)</p></figure><p id="8577" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">拟合系数<strong class="kw jg"> <em class="nn"> β_cap </em> </strong>如下:</p><pre class="mw mx my mz gt ok ol om on aw oo bi"><span id="72c1" class="nb lz jf ol b gy op oq l or os"><strong class="ol jg">print</strong>(olsr_results.params)</span><span id="f973" class="nb lz jf ol b gy ou oq l or os"><strong class="ol jg">Intercept      </strong>49.987734<br/><strong class="ol jg">Curb_Weight    </strong>-0.009330<br/><strong class="ol jg">Engine_Size    </strong>-0.001189</span></pre><p id="c542" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">样本量<em class="nn"> n </em>为 50，包括截距在内有 3 个回归变量。所以，<em class="nn">(n-k)= 50–3 = 47</em>。在<em class="nn"> α=0.05 </em>处的双边<em class="nn"> t 值</em>为 2.012。</p><p id="c436" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><em class="nn">整备质量的</em>系数估计值的 95%置信区间计算如下:</p><p id="85cb" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><em class="nn">整备质量的 95%置信区间<br/>=(-0.009330)+/-(2.012 * 0.002586)<br/>=(-0.009330)+/-(0.005203032)<br/>=</em><strong class="kw jg"><em class="nn">[-0.014533032，-0.004126968】</em></strong></p><p id="8ac9" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这与 statsmodels 在培训总结中报告的<em class="nn">整备质量</em>的 95%置信区间非常接近:</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/c7af21a001293ac039c273acba50d399.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*cF0X2E9Ibq2tU0UBgjKtwA.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">95%的 CI 由 Statsmodels 报告(图片由作者提供)</p></figure><p id="c5aa" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">让我们也比较一下 Statsmodels 报告的标准误差和我们使用 Bootstrapping 技术计算的相应误差:</p><p id="e892" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">以下是 Statsmodels 报道的几个:</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/648307c57a559d41fabf92c40eff5a67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*rzvBMJD737FvoO4vkDhgNw.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">Statsmodels 报告的标准误差(图片由作者提供)</p></figure><p id="baae" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">以下是我们已经引导的一些:</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pe"><img src="../Images/dc4a999a7ee4f31765b80d0ffe6ad681.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VUjeo8Bs5USoGGytMIK4Qg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">使用 bootstrapping 技术计算的系数估计的标准误差(图片由作者提供)</p></figure><p id="a486" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们可以看到，虽然<em class="nn">整备质量</em>和<em class="nn">发动机尺寸</em>的标准误差与 Statsmodels 报告的误差非常接近，但是<em class="nn">截距</em>的标准误差相差很小(3.731 比 3.915)。那么我们应该使用自举的标准误差还是应该使用统计软件包报告的误差呢？毕竟，如果方差-协方差矩阵未指定，系数估计的标准误差将是不正确的，置信区间也将是不正确的。</p><p id="1a0c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我将在下周的<strong class="kw jg">第 2 部分中解决这个重要的问题:深入探究经典线性回归模型的方差-协方差矩阵。</strong></p><p id="bf8c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">敬请期待，造型快乐！</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="2aae" class="ly lz jf bd ma mb mc md me mf mg mh mi kl mj km mk ko ml kp mm kr mn ks mo mp bi translated">参考文献、引文和版权</h1><h2 id="e17b" class="nb lz jf bd ma nc nd dn me ne nf dp mi ld ng nh mk lh ni nj mm ll nk nl mo nm bi translated">数据集</h2><p id="2666" class="pw-post-body-paragraph ku kv jf kw b kx mq kg kz la mr kj lc ld ms lf lg lh mt lj lk ll mu ln lo lp ij bi translated"><a class="ae lq" href="https://archive.ics.uci.edu/ml/datasets/automobile" rel="noopener ugc nofollow" target="_blank"> <strong class="kw jg">汽车数据集</strong> </a> <strong class="kw jg">引用:</strong> Dua，d .和 Graff，C. (2019)。UCI 机器学习知识库[http://archive . ics . UCI . edu/ml]。加州欧文:加州大学信息与计算机科学学院。<a class="ae lq" href="https://gist.github.com/sachinsdate/fd97d74979c4febf6746c153ea1b7668" rel="noopener ugc nofollow" target="_blank"> <strong class="kw jg">下载链接</strong> </a></p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><p id="b02b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><em class="nn">如果您喜欢这篇文章，请关注我的</em><a class="ae lq" href="https://timeseriesreasoning.medium.com" rel="noopener"><strong class="kw jg"><em class="nn">Sachin Date</em></strong></a><em class="nn">以获得关于回归、时间序列分析和预测主题的提示、操作方法和编程建议。</em></p></div></div>    
</body>
</html>