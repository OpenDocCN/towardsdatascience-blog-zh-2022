<html>
<head>
<title>Incremental refresh in Power BI — everything you need to know</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Power BI中的增量更新—您需要知道的一切</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/incremental-refresh-in-power-bi-everything-you-need-to-know-857183895464#2022-11-07">https://towardsdatascience.com/incremental-refresh-in-power-bi-everything-you-need-to-know-857183895464#2022-11-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9228" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">厌倦了缓慢而低效的数据刷新过程？了解如何利用增量刷新功能来加速和优化数据刷新</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d4abc0e5e790a4f2d0936775eb5a76df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6RGIeZhLbI9XOuK09th9_A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0c02" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你有多少次吹嘘过这样的事情:哦，不，我需要刷新我的事实表，但是花的时间太长了…可能是因为你没有使用数据刷新过程中的一个关键性能特性。</p><p id="28af" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们试着简单解释一下增量刷新的概念。如果你认为增量刷新是Power BI独有的东西，那你就大错特错了！这种方法已经存在了几十年，基本上在每个传统的数据仓库解决方案中都有实现。</p><h1 id="f9b9" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">增量刷新是在上一个数据加载周期之后加载新数据或更新数据的过程！</h1><p id="dd09" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在这个定义的背后，有各种重要的方面需要理解。首先，为什么增量刷新如此重要？假设您有一个巨大的事务数据库，其中主表包含数百万行。为了使您的分析工作负载保持同步，您需要将数据从事务数据库加载到数据仓库中。所以，想象一下，如果每次都加载整个巨大的表，会发生什么？！确切地说，它将消耗大量资源，还可能对事务数据库产生影响:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c619e0bfac3a39f90866bc734c41154c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n6a05XOfLL5-YDyLDuqIrg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="9478" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，您应该只检查和消耗那些在最后一次刷新过程之后到达或更改<strong class="la iu">的记录！这大大减轻了事务数据库的压力，因为只需要处理一小部分数据。</strong></p><p id="b355" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">假设您在昨天午夜同步了数据。我们将只检查同时更新或插入的记录(可能有几千行),然后只同步这一小部分，而不是再次提取整个数百万的表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e5fcee45f54d1ab2016822e1854be746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1TEXHmGp11NyMnu2BKGwtg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="13b1" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">增量更新的优势</h1><p id="b252" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在您的Power BI解决方案中实施增量更新有多种优势:</p><ul class=""><li id="3e41" class="mr ms it la b lb lc le lf lh mt ll mu lp mv lt mw mx my mz bi translated">刷新速度更快——显然，随着数据量的减少，数据加载过程会运行得更快</li><li id="e0cc" class="mr ms it la b lb na le nb lh nc ll nd lp ne lt mw mx my mz bi translated">降低资源消耗—同样，处理较小的数据块将有助于您降低内存消耗，并更高效地使用其他电源BI和数据源系统资源</li><li id="b631" class="mr ms it la b lb na le nb lh nc ll nd lp ne lt mw mx my mz bi translated">可靠的更新流程—如果您决定“全包”并反对增量更新，长时间运行的连接可能会变得脆弱和不可靠。增量刷新消除了这一挑战</li><li id="58d2" class="mr ms it la b lb na le nb lh nc ll nd lp ne lt mw mx my mz bi translated">设置简单—只需点击几下鼠标，您就可以为数据集定义增量刷新策略</li></ul><h1 id="b8e4" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">电源BI中的增量刷新</h1><p id="6e73" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">一旦您将数据模型发布到Power BI Service，每个表都包含一个分区。该分区包含所有的行，正如我们已经解释过的那样，对于大型表来说，数据刷新可能会非常困难。</p><p id="66c6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当您配置增量刷新时，Power BI将自动对您的表进行分区—一个分区将包含必须频繁刷新的数据，而另一个分区将保存不变的行。</p><p id="eb2a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">用最简单的方式来说，这就是增量刷新后工作流的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/217a6e83c7823e40c7d6220dd468fe56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hXv70VNIoDgpze5sPOKB8g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="cffe" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可能会注意到，比较前一个和当前数据窗口，窗口是滚动的，在前一个窗口中被视为实时的数据现在成为增量刷新分区的一部分。这是一个持续的过程，被称为“滚动窗口模式”。</p><h1 id="10f9" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">增量刷新的先决条件</h1><p id="e343" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">为了能够在您的Power BI解决方案中实施增量更新功能，需要具备一些先决条件:</p><ul class=""><li id="957b" class="mr ms it la b lb lc le lf lh mt ll mu lp mv lt mw mx my mz bi translated"><strong class="la iu">日期列</strong> —要应用增量刷新的表必须包含日期列，可以是日期/时间或整数数据类型。这是因为您需要设置用于在分区之间分离数据的参数</li><li id="012d" class="mr ms it la b lb na le nb lh nc ll nd lp ne lt mw mx my mz bi translated"><strong class="la iu">查询折叠</strong> —现在，您可能会问自己:什么是查询折叠？所以，我们先来解释一下这一条。我已经在<a class="ae nf" href="https://data-mozart.com/what-is-a-query-folding-in-power-bi-and-why-should-i-care/" rel="noopener ugc nofollow" target="_blank">这篇文章</a>中更详细地描述了它，但是，简单地说，查询折叠是Power Query生成单个SQL查询的能力，该查询将在SQL数据源端执行。为什么查询折叠对增量刷新很重要？嗯，您的日期范围参数需要转换成SQL中的WHERE子句，以便在相关分区中分隔数据。因此，如果没有查询折叠，就没有WHERE子句，不可能进行分区，因此也不可能进行增量刷新</li><li id="923c" class="mr ms it la b lb na le nb lh nc ll nd lp ne lt mw mx my mz bi translated"><strong class="la iu">单一数据源</strong> —意味着所有分区都必须从单一数据源查询数据</li></ul><h1 id="e36e" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">等等……还有呢！</h1><p id="b609" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">通过利用<a class="ae nf" href="https://data-mozart.com/hybrid-tables-in-power-bi-the-ultimate-guide/" rel="noopener ugc nofollow" target="_blank">混合表特性</a>，您可以进一步增强数据刷新过程。本质上，这种想法是为表设置增量刷新，但在DirectQuery模式下设置具有最新数据的分区，同时将较旧的数据保留在使用导入模式的分区中。</p><p id="927e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过这种方式，您可以两全其美:针对旧数据的分析查询的超快的性能，以及与来自原始数据源的最新数据的实时同步。但是，目前，混合表功能仅适用于Power BI Premium许可证。</p><h1 id="eaa4" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">在Power BI中设置增量刷新</h1><p id="8edf" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">配置过程的第一步是定义参数，并设置在过滤应加载到Power BI Desktop中的数据时应用的默认值。您应该保持这个范围较短，并且只包括最近的数据(在我的例子中是3天)，因为一旦您配置了增量刷新策略，这些值无论如何都会被覆盖。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/ee1e15ad9ef0739dfc326748720f0ed8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZJ4uJLPgMRZDDU851LAMUw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="d056" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请记住，您应该为参数使用预定义的RangeStart和RangeEnd名称。这样，Power BI“知道”这些参数将用于设置增量刷新。</p><p id="6df4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下一步是根据我们新创建的参数过滤数据:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/2584860b41fa39edea4f41aaf8906e64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yPYF6GkS-aaoiz0Gyo2Dzg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a24e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">设置过滤条件时要小心，您应该避免在两个参数上使用等式(即，是在之后或等于/是在之前或等于)，因为这可能会提取重复的数据，并在您的报告中产生不正确的结果！</p><p id="3fb7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我现在可以在Power Query Editor中点击Close&amp;Apply，您可能会注意到Power BI将只加载一小部分数据——在我的例子中，不是最初的1260万行，而是这次只加载36000行。</p><p id="8b55" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在到了工作流的关键部分—我们将为我们庞大的事实表定义增量刷新策略:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/f5bccccb6cb76f7e4ae3363dea1b7d3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DGbaaPmL02SB1_vjIOFmNg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">单击表名旁边的三个点，然后选择增量刷新</p></figure><p id="121d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">弹出增量刷新对话框后，有各种选项可供选择:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/53a84f641282ba7353496fc608a931d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NvhvVQtnL5HVvVKDKMxRpA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3e8c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我打开增量刷新该表属性后，我将定义归档周期(在我的示例中为3年)和应用增量刷新策略的周期(3天)。最酷的是，您可以立即看到哪些日期将包含在哪个分区中。</p><p id="c31e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在可选设置下，如果您勾选了<em class="ni">使用DirectQuery实时获取最新数据旁边的框，</em>您可以利用我们在上一篇文章中已经描述过的<a class="ae nf" href="https://data-mozart.com/hybrid-tables-in-power-bi-the-ultimate-guide/" rel="noopener ugc nofollow" target="_blank">混合表特性</a>。</p><p id="0c38" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="ni">如果您将数据刷新过程安排在比如说凌晨3点(假设此时底层数据源的压力较小)，但是您不希望仅将午夜和凌晨3点之间插入源系统的这些记录导入Power BI，那么仅刷新完整天数</em>选项非常方便。启用此选项后，将只加载已完成天数的记录。</p><p id="24ba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="ni">检测数据更改可能会为数据刷新过程带来</em>更大的性能提升，因为它仅支持处理自上次运行以来发生更改的记录。要使该选项起作用，您需要在数据源中有一个包含特定记录上次更新时间信息的特定列(例如，LastUpdated、LoadDate等)。该列必须是日期/时间数据类型，并且<em class="ni">不应该是用于对事实表</em>进行分区的同一列(在我们的例子中，它不应该是DateKey列)。</p><p id="9a14" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，如果向下滚动，您可以看到可视化的增量刷新滚动窗口:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/6e5308b5b9ae4b279036b69efb472c90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kfZYSlSE8192HkI03bDXUA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4103" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">点击“应用”,现在我已经准备好发布报表和数据集了。一旦数据集位于Power BI工作区中，您必须刷新它。第一次刷新将加载所选存储期间的历史数据，以及增量刷新策略中定义的新数据和更新数据。</p><p id="f773" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第一次数据加载可能需要一段时间，具体取决于数据量，但所有后续刷新的运行速度应该会快得多，因为只会加载增量刷新策略中指定时间段内的数据。</p><h1 id="4143" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">结论</h1><p id="eef0" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">当您处理相对较小的数据模型时，您可能会偷偷摸摸地不实现数据的增量刷新。但是，一旦数据量开始扩大，增量刷新将很快成为您优化数据刷新流程的最佳选择。</p><p id="db1c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">而且，这不仅仅是将新数据引入Power BI数据集所需的时间，还包括重新处理整个巨大的表所需的资源。</p><p id="b7af" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读！</p><p id="c7db" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae nf" href="https://datamozart.medium.com/membership" rel="noopener">成为会员，阅读媒体上的每一个故事！</a></p></div></div>    
</body>
</html>