<html>
<head>
<title>Fast Anomaly Detection With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python实现快速异常检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/hbos-vs-iforest-on-macbook-pro-m1-c258d2b5fe6b#2022-07-01">https://towardsdatascience.com/hbos-vs-iforest-on-macbook-pro-m1-c258d2b5fe6b#2022-07-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7120" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">M1 MacBook Pro上的HBOS vs iForest</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ccae02a49b9da767ce4e8af5fd6a35ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G3KqeK6HCnkLc3tp8RhOGw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">HBOS算法图解(图片由作者提供)</p></figure><p id="6b43" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这篇博文中，我们将比较基于直方图的异常值分数(HBOS ),一种基于邻近度的异常值检测算法，该算法被证明是快速的，具有线性时间复杂度，以及一种称为隔离森林的集成方法。</p><p id="0095" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将讨论这两种算法背后的工作原理，以及它们在MacBook Pro M1上针对17个不同数据集的各自性能。</p><p id="4bd2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae lu" href="http://odds.cs.stonybrook.edu/" rel="noopener ugc nofollow" target="_blank">异常检测数据集(ODDS) </a>组公开提供可用于测试异常检测算法的数据集。它们为几个领域提供不同种类的数据，并且总是提供我们可以用来评估异常值检测项目的基础事实。</p><h1 id="0b1f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">HBOS</h1><p id="d2f0" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">基于直方图的异常值分数(HBOS)是一种识别数据异常值的机器学习算法。该算法于2012年由Goldstein、Markus和Andreas Dengel在一篇名为“基于直方图的异常值得分(HBOS):一种快速无监督异常检测算法”的论文中发表[1].</p><blockquote class="ms mt mu"><p id="347a" class="ky kz mv la b lb lc ju ld le lf jx lg mw li lj lk mx lm ln lo my lq lr ls lt im bi translated">这是通过为每个维度创建数据的直方图，然后基于特定数据点落入每个维度的直方图区间的可能性来计算分数来实现的。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/cf798f36653483cb8b770adb5a2b0155.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iHAxnmCGbNh_NakT0LeKkw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">每个维度的直方图分布(图片由作者提供)</p></figure><blockquote class="ms mt mu"><p id="5b32" class="ky kz mv la b lb lc ju ld le lf jx lg mw li lj lk mx lm ln lo my lq lr ls lt im bi translated">分数越高，数据点越有可能是异常值。</p></blockquote><p id="c589" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了计算一个实例(一个数据点)的得分，我们查看该实例属于哪个箱。大多数情况下，特征向量将占用非常可能的条柱，如下图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/6d3d396aae152a7b4712dc031a85c7dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s4Uv7RwR9YpOl5GO-59ZDQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">推导过程中获得的非常可能的特征向量的图示(图片由作者提供)</p></figure><p id="5dbb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">另一方面，来自异常的特征向量将在其一个或几个维度中占据不太可能的面元，如下图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/3f58c0a8eca3a703dc7468f5c0fed0a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NoL0iYVF8Q64nO5ld2f1lQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">推导过程中获得的非常不可能的特征向量的图示(图片由作者提供)</p></figure><p id="22f8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">原始论文[1]中提出的计算异常分数的指标如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/aba1b8fc31a8b79b3259f20722cbfbeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Hkf2WRL2IfXzFjf1rqSwg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">HBOS方程(来源:[1])</p></figure><blockquote class="ms mt mu"><p id="b617" class="ky kz mv la b lb lc ju ld le lf jx lg mw li lj lk mx lm ln lo my lq lr ls lt im bi translated">想法是将每个特征向量维度的结果二进制数的倒数相乘。</p></blockquote><p id="de5e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">根据我们之前的示例，描述落入非常不可能的箱中的异常值的第一个特征向量的分数明显更高:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/e4315f957452b33f5e478e01debb97c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CeN647HySXWi7lpkxUCbww.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">异常示例的HBOS异常分数(图片由作者提供)</p></figure><p id="e0c3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">并且更可能的特征向量将具有较低的分数:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/e544239b2e3f89c1d88651f695d4cd68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2N7SqRUttxMPlLlmI-7uKw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">无异常示例的HBOS异常分数(图片由作者提供)</p></figure><p id="e83c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可能想知道为什么HBOS方程使用<em class="mv">对数</em>函数？</p><p id="74b4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">应用日志的目标是获得对极小bin值不太敏感的异常分值，以及由于浮点精度不可避免的误差而可能带来的误差。</p><blockquote class="ms mt mu"><p id="0f9f" class="ky kz mv la b lb lc ju ld le lf jx lg mw li lj lk mx lm ln lo my lq lr ls lt im bi translated"><em class="it">对数</em>是单调递增的，因此不会改变分数的顺序。</p></blockquote><p id="d3b8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">HBOS可以有效地识别低维和高维数据中的异常值。然而，每个维度的直方图的宁滨方法将影响时间复杂度。在固定宁滨方法的情况下(如上图所示)，面元具有相等的大小，并且时间复杂度是线性的，即O(n)。</p><p id="b770" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们不知道每个维度的分布，或者如果我们面临长尾分布，那么动态绑定方法也是可能的，并且受到鼓励。但那样的话，时间复杂度就变成O(n log(n))。</p><h1 id="ed7e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">iForest</h1><p id="9ac9" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">隔离森林(iForest)是一种异常检测算法，其工作原理是隔离样本，并根据样本隔离的难易程度为其分配一个分数。2008年，刘、和在一篇名为“隔离森林”的论文中首次提出了该算法[2]。</p><p id="a8f5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">iForest算法实现简单，可用于任何类型的数据(数值型、分类型等)。).</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/41c2b8aae9cb0e26e6fcb6c892ddab97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Fok3E1zhxwju5nESsXQ_g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">隔离树算法的图示(图片由作者提供)</p></figure><p id="18ab" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过递归分割数据来构建隔离树。例如，要在100个数据点上构建一个具有10个维度的决策树，我们首先将这100个数据点分成两部分，然后将分开的部分再分成其他部分，以此类推。</p><blockquote class="ms mt mu"><p id="beac" class="ky kz mv la b lb lc ju ld le lf jx lg mw li lj lk mx lm ln lo my lq lr ls lt im bi translated">要拆分数据点，我们只需从10个维度中选择一个随机属性，并根据所选属性上设置的随机值拆分数据。</p></blockquote><p id="dcb3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">即使在选择用于分割数据的属性和值时涉及到许多随机过程，也更有可能在早期分割异常值。</p><p id="6257" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">比如说我们要建一个隔离树，把人民按照财富来隔离。埃隆·马斯克预计将成为世界上第一个亿万富翁。因此，该属性的可能值范围是0到1万亿。我们从0到1万亿中随机选择一个数字——比如25亿——我们已经把拥有财富少于1万亿的人群从富人中分离出来。</p><blockquote class="ms mt mu"><p id="28b3" class="ky kz mv la b lb lc ju ld le lf jx lg mw li lj lk mx lm ln lo my lq lr ls lt im bi translated">事实上，离群值最终出现在隔离树中较短的路径上。路径越小，数据点越有可能是异常值，异常值越高。</p></blockquote><p id="ec80" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，iForest算法构建一组隔离树，输出异常分数，并计算所有隔离树之间的平均异常分数。</p><h1 id="a4e5" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">MacBook Pro M1的结果</h1><p id="b320" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">在这篇博文中，我们使用了<a class="ae lu" href="https://pyod.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> Pyod </a>库来测试异常值检测算法。</p><p id="4c21" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它提供了一种简单的方法来比较不同的算法，并为给定的数据集选择最佳的算法。PyOD还提供了多种功能，方便研究和生产。如果您想在不同的机器上运行相同的基准测试，这里有他们网站的链接:</p><div class="ng nh gp gr ni nj"><a href="https://pyod.readthedocs.io/en/latest/benchmark.html" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">基准— pyod 1.0.2文档</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">对于每个数据集，首先将其分为60%用于训练，40%用于测试。所有实验重复10次…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">pyod.readthedocs.io</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx ks nj"/></div></div></a></div><p id="1954" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">关于测试的设置，基准测试是通过以下配置完成的:</p><ul class=""><li id="fb77" class="ny nz it la b lb lc le lf lh oa ll ob lp oc lt od oe of og bi translated">型号名称:MacBook Pro</li><li id="e253" class="ny nz it la b lb oh le oi lh oj ll ok lp ol lt od oe of og bi translated">芯片:苹果M1</li><li id="658d" class="ny nz it la b lb oh le oi lh oj ll ok lp ol lt od oe of og bi translated">最大值CPU时钟速率:3.2 GHz</li><li id="f79e" class="ny nz it la b lb oh le oi lh oj ll ok lp ol lt od oe of og bi translated">内核总数:8 (4个性能和4个效率)</li><li id="e8c8" class="ny nz it la b lb oh le oi lh oj ll ok lp ol lt od oe of og bi translated">内存:16 GB</li></ul><p id="044e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是10次独立试验的平均结果:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">10次独立试验的平均执行时间(源代码:<a class="ae lu" href="https://pyod.readthedocs.io/en/latest/benchmark.html" rel="noopener ugc nofollow" target="_blank"> PyOD </a></p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">10次独立试验的平均ROC性能(源代码:<a class="ae lu" href="https://pyod.readthedocs.io/en/latest/benchmark.html" rel="noopener ugc nofollow" target="_blank"> PyOD </a></p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">10次独立试验的N个样本的平均精度(源代码:<a class="ae lu" href="https://pyod.readthedocs.io/en/latest/benchmark.html" rel="noopener ugc nofollow" target="_blank"> PyOD </a></p></figure><h1 id="25ae" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="6e10" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">在异常检测领域，有许多竞争者，但是对于这篇博文，我们决定比较HBOS和iForest。这两种方法在实时应用中都被证明是有效的，但是哪一种更好呢？</p><blockquote class="ms mt mu"><p id="b70f" class="ky kz mv la b lb lc ju ld le lf jx lg mw li lj lk mx lm ln lo my lq lr ls lt im bi translated">总的来说，HBOS通常是一种更快的方法，但它可能没有iForest准确，这取决于数据集的类型。</p></blockquote><p id="02ec" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以，这真的取决于你的需要，至于哪种方法更好。如果速度更重要，那么HBOS是最好的选择。但是，如果准确性是最重要的，并且您正在使用高维特征向量，那么您可能希望使用iForest。</p></div><div class="ab cl oo op hx oq" role="separator"><span class="or bw bk os ot ou"/><span class="or bw bk os ot ou"/><span class="or bw bk os ot"/></div><div class="im in io ip iq"><p id="e13f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好奇想了解更多关于Anthony的工作和项目吗？在<a class="ae lu" href="https://medium.com/@anthonycvn" rel="noopener">中</a>、<a class="ae lu" href="https://www.linkedin.com/in/anthonycavin/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>、<a class="ae lu" href="https://twitter.com/Anthony66333223" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注他。</p><p id="2dfc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="mv">需要技术写手？将您的请求发送到</em><a class="ae lu" href="https://amigocci.io/blog/mlops-at-medium-scale/" rel="noopener ugc nofollow" target="_blank"><em class="mv">https://amigo CCI . io</em></a><em class="mv">。</em></p></div><div class="ab cl oo op hx oq" role="separator"><span class="or bw bk os ot ou"/><span class="or bw bk os ot ou"/><span class="or bw bk os ot"/></div><div class="im in io ip iq"><p id="cfe0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">[1]戈尔茨坦、马库斯和安德烈亚斯·登格尔。"基于直方图的异常值分数(hbos):一种快速无监督异常检测算法."<em class="mv"> KI-2012:海报和演示音轨</em> 9 (2012)。</p><p id="a5f6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">[2]刘，费托尼，，丁，.“隔离林。”<em class="mv"> 2008年第八届ieee数据挖掘国际会议</em>。IEEE，2008年。</p></div></div>    
</body>
</html>